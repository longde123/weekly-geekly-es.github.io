<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🌯 🎆 🔧 Por que fotos e vídeos autodestrutivos no Telegram não são seguros 🕤 📝 🤛</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Mais recentemente, vi um artigo que falava sobre a introdução de mensagens autodestrutivas no messenger do WhatsApp . Ele terá funcionalidade semelhan...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Por que fotos e vídeos autodestrutivos no Telegram não são seguros</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/470225/"><img src="https://habrastorage.org/webt/pb/vz/ur/pbvzuriwtjebtwfbawzykgzjnek.png" alt="imagem"><br><br>  Mais recentemente, vi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">um artigo</a> que falava sobre a introdução de <b>mensagens autodestrutivas</b> no messenger do <b>WhatsApp</b> .  Ele terá funcionalidade semelhante ao Telegram, mas se no messenger de Durov a exclusão se aplicar a mensagens comuns (bate-papos secretos), eles também poderão ser usados ​​em fotos em bate-papos regulares.  Ou seja, depois de enviar suponha a foto, o interlocutor poderá visualizá-la por um período limitado de tempo e, depois, teoricamente, será excluído dos dois interlocutores (de preferência também do servidor), então o WhatsApp planeja introduzir a exclusão de mensagens regulares (e até o momento) . <br><br>  Hoje, porém, não estamos falando sobre o WhatsApp (porque eu não uso), mas sobre o Telegram.  A própria idéia de mensagens autodestrutivas dificilmente é muito procurada, mas existem usuários que as usam, por exemplo, quando enviam documentos ou fotos que só podem ser vistas uma vez (ahem). <br><br>  Para quem tem preguiça de ler, <b>as mensagens autodestrutivas no Telegram não são seguras</b> nem confidenciais.  Não pense que, se você enviar um documento importante para alguém com quem conversar dessa maneira, ele não será capaz de salvá-lo (e não estou falando de uma captura de tela rápida ou fotografias de telas de telefone, Deus permita) - use bate-papos secretos para isso.  E para aqueles que estão interessados ​​na própria implementação dessas mensagens, você pode continuar lendo. <a name="habracut"></a><br><br>  Eu também os usei, embora não com frequência, e sim que eram apenas "entretenimento" e não os assisti especialmente.  No mês de junho deste ano, enquanto pesquisava o <b>Telegram</b> da <b>UserAPI</b> , testei o envio e o recebimento de fotos.  Eu me diverti, não mais.  E apareceu interesse em ver a "visão" do envio de mensagens e como elas geralmente são exibidas na resposta.  Fiquei me perguntando como essa função é implementada “de dentro”, se os arquivos são excluídos do servidor Telegram ou podem ser criptografados de alguma forma. <br><br>  E para minha surpresa, essas mensagens não são praticamente diferentes das usuais.  Direto mesmo.  Eles têm o mesmo <b>file_id</b> que as fotos comuns, com as quais você pode obter o próprio arquivo.  E mesmo que você tenha olhado para a mensagem e ela desapareceu no bate-papo, <b>você pode salvar / enviar / encaminhar com segurança</b> e fazer o mesmo que faria com fotos / vídeos comuns.  Ou seja, não é excluído do próprio servidor Telegram. <br><br>  Repito, essas mensagens não se aplicam a bate-papos secretos, onde a correspondência está em dois dispositivos, e de outro cliente não consigo acessá-los.  Esse recurso foi desenvolvido para bate-papos regulares e parece ser considerado "seguro".  Mas aqui é interessante, não encontrei uma descrição detalhada dessas mensagens autodestrutivas em nenhum lugar.  Ou seja, o Telegram parece não nos dizer que essas mensagens são tão seguras em termos de acesso (se você tiver acesso à própria conta) como, por exemplo, os mesmos chats secretos.  A única coisa que vi foi que o próprio Telegram disse que nenhuma mensagem, mesmo bate-papos secretos, tem 100% de segurança e que todos são responsáveis ​​pelas mensagens que ele envia, mas ... <br>  Confesso que ele seria implementado em alguns WhatsApp / Viber / VK, eu nem prestaria atenção nele, mas o Telegram é um mensageiro muito conveniente que eu realmente amo, mas o que odeio é seu apoio cheio de voluntários. <br><br>  No mesmo mês de junho, escrevi para support@telegram.org, onde escrevi uma carta inteira em dois idiomas.  Ele disse não apenas sobre mensagens autodestrutivas, mas também sobre mensagens comuns e que o Telegram não estabelece limites para o encaminhamento, mas mais sobre isso mais tarde. <br><br>  Dois meses depois, eles não me responderam, então eu tive que escrever para o próprio Telegrama de "suporte" sobre como explicar o que fazer e onde escrever ao encontrar esse tipo de "Vulnerabilidade". <br><br>  Lá, eles me surpreenderam três horas depois, onde me disseram que você deveria escrever sobre vulnerabilidades sérias no protocolo em security@telegram.org ou compartilhar os detalhes aqui.  Anexo o texto da resposta original do suporte: <br><br><div class="spoiler">  <b class="spoiler_title">5 de julho, resposta de suporte</b> <div class="spoiler_text">  <i>Oi</i>  <i>Você pode compartilhar os detalhes aqui ou escrever para security@telegram.org se realmente estivermos falando sobre algum tipo de vulnerabilidade em nossos aplicativos ou protocolo.</i> <br></div></div><br>  Decidi escrever para o próprio suporte sobre os "detalhes" das vulnerabilidades, aplicando o vídeo, o próprio script e as soluções para o problema (abaixo está a minha mensagem), mas até agora não recebi resposta, nem por correio nem pelo próprio suporte.  Aparentemente, até agora, isso não os incomoda.  <s>Melhor vamos fazer uma animação de emojis únicos.</s> <br><br>  Além da opção com mensagens autodestrutivas, também notei que qualquer mensagem excluída, por exemplo, em um bate-papo particular, grupo ou canal, também é fácil de interceptar.  Isso é feito usando o <b>encaminhamento usual de todas as mensagens</b> , por exemplo, em um grupo separado e depois de obtê-las <b>usando o ID da mensagem excluída</b> (agora as bibliotecas têm manipuladores). <br><br>  Também descrevi todo o processo em minha carta (embora de fato seja simples), com uma solução para o problema na forma de limitar o encaminhamento das próprias mensagens.  E se você não limitar completamente, proíba o encaminhamento constante de todas as mensagens.  Eu acho que a equipe de desenvolvimento será capaz de fazer alguns anti-flood a partir de agora. <br><br>  E com os autodestrutivos, exclua-os do servidor.  Isso não resolverá o problema; as mensagens ainda podem ser interceptadas exatamente no momento em que são recebidas.  Para uma eliminação completa, todo o algoritmo para lê-los deve ser reformulado.  Por exemplo, para criar uma chave de acesso para cada mensagem e, ao usar essa tecla, a imagem / vídeo estará disponível apenas por um certo tempo.  Agora é difícil criar todo o algoritmo para a equipe de desenvolvimento, admito, eu mesmo não sou capaz de pensar em todos os aspectos e, de qualquer forma, há uma maneira de interceptá-los.  Mas, no momento, eles são implementados de maneira terrível, o (s) desenvolvedor (es) envolvido (s) nessa função devem ser mais responsáveis ​​pelo desenvolvimento desse tipo de função.  Bem, ou em casos extremos, basta escrever, em vermelho e em negrito, que as mensagens autodestrutivas são fáceis de interceptar e isso não passa de um brinquedo. <br><br>  Vou falar sobre você, um estudante de 15 anos, recentemente apaixonado por desenvolver em Python, se interessou pela API do usuário e encontrou esse tipo de "falha / vulnerabilidade".  Quanto mais me enfureceu e me forçou a escrever tudo isso aqui - uma péssima implementação do suporte do Telegram, que simplesmente me ignorou três vezes em quatro meses. <br><br>  Para alguns, essa função não será útil, não encontrará nada de ruim na má implementação dessas mensagens, mas acho que, como o próprio Telegram não está interessado em melhorar as funções atuais, será útil que outros apenas levem isso em consideração. <br><br>  Estou escrevendo artigos pela primeira vez, posso deixar erros em algum lugar, mas espero que eles me corrijam nos comentários, indicando.  Ou, em geral, eles me dizem que tudo está errado e ignorar o suporte foi uma boa solução e finalmente vou me acalmar.  Também anexo minha mensagem: <br><br><div class="spoiler">  <b class="spoiler_title">Mensagem de suporte para a qual nenhuma resposta foi recebida</b> <div class="spoiler_text">  <i>Olá, meu nome é Khamidov Amal.</i> <i><br><br></i>  <i>Recentemente, escrevi uma experiência de usuário para o meu projeto.</i>  <i>Em algum momento, notei como meu amigo me enviou uma foto com remoção automática.</i>  <i>Eu olhei para ele no meu cliente Android e ele foi removido como deveria ser após 10 segundos.</i> <i><br><br></i>  <i>Mas me perguntei como essas mensagens são criptografadas e como são armazenadas em qualquer lugar.</i>  <i>Afinal, acontece que o cliente de telegrama primeiro carrega a foto no telefone e, após a leitura, deve removê-la.</i> <i><br><br></i>  <i>Escrevi um pequeno script python usando a biblioteca Pyrogram e queria ver como eles chegavam ao cliente.</i> <i><br><br></i>  <i>Fiquei surpreso quando vi que essas "fotos com exclusão automática" se parecem com fotos comuns (o que?).</i> <i><br></i>  <i>Ou seja, se eu mandasse uma foto comum, não era diferente da "auto-depreciativa".</i> <i><br></i>  <i>Depois disso, escrevi um script que envia essa foto no arquivo e, naquele momento, a foto foi para o meu canal de teste como uma foto normal.</i>  <i>E no telefone do qual enviei a foto mais "auto-extraível", ela nem foi lida.</i> <i><br><br></i>  <i>Também me permitiu ver a foto no meu cliente de desktop.</i>  <i>Ou seja, esse script ignora a essência mais importante da foto "Extração automática".</i> <i><br><br></i>  <i>Considero uma vulnerabilidade e uma solução para reconsiderar o método de envio de mensagens de "exclusão automática" e processá-las no servidor e não no dispositivo.</i> <i><br><br></i>  <i>Além disso, encontrei o segundo (quase uma vulnerabilidade), que foi criado usando o próprio telegrama da API e não é proibido.</i> <i><br><br></i>  <i>Então, estamos falando de mensagens comuns.</i> <i><br><br></i>  <i>Também escrevi um script regular que envia (encaminha) todas as mensagens do bate-papo para o meu grupo e as marca por seu ID.</i> <i><br><br></i>  <i>Eu adicionei um manipulador a esse script que responde a todas as mensagens excluídas e fornece o ID dessas mensagens excluídas (hello pyrogram).</i> <i><br><br></i>  <i>Depois disso, adicionei um script e agora, quando o manipulador responde a todas as mensagens excluídas, ele as verifica com as mensagens do grupo (que contém todas as mensagens) e procura essa mensagem por ID.</i> <i><br><br></i>  <i>Por um lado, isso não viola nada, porque os telegramas têm um código aberto, todos podem escrever seus userbots.</i>  <i>mas, por outro lado (o russo é bom), na última atualização, você adicionou a função de excluir as suas próprias mensagens e as de outras pessoas por questões de segurança, mas scripts simples escritos por um estudante de 15 anos parecem ignorar isso. muita segurança.</i> <i><br><br></i>  <i>Entendo que todo mundo responde em resposta ao que ele envia, mas uma pessoa pode enviar arquivos importantes a uma pessoa desnecessária por engano e, nesse momento, ele exclui a mensagem (enquanto o interlocutor não leu) sem saber que todas essas mensagens podem ser comprometidas e o mais importante, que as mensagens não são marcadas como lidas.</i> <i><br><br></i>  <i>A decisão, eu acho, é adicionar limites ao encaminhamento de mensagens e revisar a maneira de "ler" as mensagens.</i> <i><br><br></i>  <i>No segundo vídeo anexado, como posso salvar todas as mensagens excluídas sem lê-las.</i> <i><br></i>  <i>Anexo o vídeo e o script que escrevi para mostrar claramente como ele funciona.</i> <br></div></div><br><br>  E como fica no código (usado na biblioteca Telethon, no Pyrogram é quase o mesmo): <br><br><div class="spoiler">  <b class="spoiler_title">A parte mais importante do código.</b>  <b class="spoiler_title">O resto é apenas uma indicação da conta, número de telefone etc.</b> <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">@client.on(events.NewMessage(func=lambda e: e.is_private and getattr(e, 'photo'))) async def handler(event: message.Message): # event.input_chat may be None, use event.get_input_chat() chat: InputPeerUser = await event.get_input_chat() sender: User = await event.get_sender() photo: Photo = event.photo await client.send_message(img_channel, file=MessageMediaPhoto(photo), message=f'&lt;code&gt;{chat.user_id}&lt;/code&gt;\n' f'&lt;code&gt;{sender.first_name}&lt;/code&gt;\n', parse_mode='HTML')</span></span></code> </pre> <br></div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt470225/">https://habr.com/ru/post/pt470225/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt470215/index.html">CAGR como uma maldição para especialistas, ou erros na previsão de processos exponenciais</a></li>
<li><a href="../pt470217/index.html">DS18B20 falso à prova d'água: o que fazer?</a></li>
<li><a href="../pt470219/index.html">F # 5: Operadores</a></li>
<li><a href="../pt470221/index.html">Holivar. História do Runet. Parte 3. Motores de busca: Yandex vs Rambler. Como não fazer um investimento</a></li>
<li><a href="../pt470223/index.html">Diretrizes de design de jogos para celular UX</a></li>
<li><a href="../pt470227/index.html">Como entrevistar um empregador?</a></li>
<li><a href="../pt470229/index.html">Sons para a interface do usuário: uma compilação de recursos temáticos</a></li>
<li><a href="../pt470233/index.html">Como escrever um robô de negociação: ferramentas para iniciantes</a></li>
<li><a href="../pt470235/index.html">Entrevista com Dmitry Simonov, criador do canal CTORECORDS: “A principal qualidade do techdir é o hábito de vencer”</a></li>
<li><a href="../pt470237/index.html">Literatura de fim de semana: leitura fácil para técnicos</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>