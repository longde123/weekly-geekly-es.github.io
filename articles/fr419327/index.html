<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>⏬ 🙎🏿 🛰️ Guide de la liste des interfaces sur MikroTik 📭 🖖🏽 🛢️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Des listes d'interfaces sont apparues dans MikroTik RouterOS depuis longtemps, mais par observation, tout le monde ne les connaît pas et ne les utilis...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Guide de la liste des interfaces sur MikroTik</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/419327/">  Des listes d'interfaces sont apparues dans MikroTik RouterOS depuis longtemps, mais par observation, tout le monde ne les connaît pas et ne les utilise donc pas. <br><br><h2>  La description </h2><br>  Qu'est-ce qui ressort clairement du nom - Liste des interfaces, identique aux listes d'adresses, uniquement avec les interfaces.  Ne le confondez pas avec les ponts et les interfaces de délimitation, ce sont trois technologies différentes pour des tâches différentes.  Cette fonctionnalité est apparue il y a environ un an et est présente dans toutes les versions actuelles (actuelles et correctives) de RouterOS 6. <br><br>  La principale chose à retenir: les interfaces dans les listes restent indépendantes, le trafic ne commencera pas à les traverser (comme dans le cas du pont) et ne sera pas parallélisé (comme dans le cas de la délimitation), c'est ridicule pour vous, mais il y a des sages. <br><a name="habracut"></a><br><h2>  Listes standard </h2><br>  [Interfaces] -&gt; [Liste des interfaces] -&gt; [Listes] <br>  Par défaut, il existe trois listes: toutes, aucune, dynamiques.  Avec les deux premiers, tout est clair, la dynamique est actuellement peuplée à partir de certaines connexions ppp et Détecter Internet. <br><br>  Option console: <br><br><pre><code class="hljs kotlin">/<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">list</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">print</span></span></span></span></code> </pre> <br>  <b>Créez votre liste</b> <br>  [Interfaces] -&gt; [Liste des interfaces] -&gt; [Listes] -&gt; [+] <br>  nom - nom <br>  include - inclut les interfaces de la liste spécifiée dans la nouvelle liste <br>  exclude - exclut les interfaces de la liste spécifiée de la nouvelle liste <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/o8/7u/ei/o87ueiwn9n0infdw2bhp2xx9fla.png"></div><br>  Option console: <br><br><pre> <code class="hljs cs">/<span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">list</span></span> <span class="hljs-title"><span class="hljs-title">add</span></span> <span class="hljs-title"><span class="hljs-title">name</span></span>=test</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Inclure un exemple</b> <div class="spoiler_text">  Les interfaces suivantes sont disponibles pour accéder à Internet: <br>  ether1-wan (véritable ip) <br>  ether2-wan (véritable ip) <br>  l2tp-vpn1 (ip gris) <br>  l2tp-vpn2 (ip gris) <br><br>  À partir des deux premiers, nous attendons des connexions entrantes de l'extérieur, à partir du second, s'ils le font, alors nous ne sommes pas intéressés. <br><br>  Les interfaces ether1-wan et ether2-wan sont combinées dans une liste de wan.  Lignes vertes. <br><br>  Les interfaces l2tp-vpn1 et l2tp-vpn2 sont combinées dans une liste vpn.  Lignes rouges. <br><br>  La liste inet contient (inclut) wan et vpn.  Lignes noires. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/hr/v7/yc/hrv7yclcksuwd13nk2pzqcbe7lq.png"></div><br>  Maintenant, dans le pare-feu, vous pouvez diviser le trafic entrant (et passant du côté wan / vpn) avec wan et vpn et écrire des règles distinctes, et le filtre sortant (et passant du côté wan / vpn) ensemble (il y aura très probablement un banal établi, nouveau) via inet . <br><br>  Un exemple est maladroit, mais je n'en ai pas d'autre. <br></div></div><br><h2>  Ajout d'interfaces </h2><br>  Vous pouvez ajouter n'importe quelle interface: ethernet, wlan, bridge, vlan, vpn, vif, ... Tout se fait depuis le menu principal [Listes d'interfaces]. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ts/hf/3o/tshf3op7znm8obwadjr2lmsauqe.png"></div><br>  Option console: <br><br><pre> <code class="hljs cmake">/interface <span class="hljs-keyword"><span class="hljs-keyword">list</span></span> member add interface=ether1 <span class="hljs-keyword"><span class="hljs-keyword">list</span></span>=<span class="hljs-keyword"><span class="hljs-keyword">test</span></span></code> </pre> <br><h2>  Utilisation dans le filtre de pare-feu </h2><br>  L'application principale est de simplifier les règles du pare-feu, disons que vous avez un hub vpn et que vous devez configurer les règles pour le trafic passant, mais soyez aussi clair que possible. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/oj/0d/nw/oj0dnwl132fwezywphoqywsif_i.png"></div><br>  Avant: <br><br>  Vérifiez dans l'interface, envoyez à la chaîne-1. <br>  Dans la chaîne 1, vérifiez l'interface, envoyez à la chaîne 2. <br>  Dans la chaîne 2, nous avons établi les règles. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/qe/z9/ja/qez9jawzudxpqwsg11hfq8hj8mg.png"></div><br>  Et donc pour chaque interface.  4 connexions - 8 règles, 8 connexions - 16 règles.  Les connexions sont-elles dynamiques?  Vous pouvez sortir et utiliser tous les ppp, les jeter dans chain-1, puis revenir 'vous avez besoin d'interfaces supplémentaires de chain-1. <br><br>  Maintenant: <br><br>  Nous ajoutons toutes les interfaces à une liste et créons une règle avec la même liste d'entrée d'interface et la liste d'interface de sortie, qui se transfère en chaînes avec des règles de filtrage.  Il est devenu nettement plus court. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ce/my/m3/cemym38bkxwc9gr08bkecjvfcii.png"></div><br>  <i>Il y a un inconvénient dans ce schéma, si vous regardez le «plus tôt», alors pour chaque interface, les sous-réseaux d'adresses sont attendus sur l'interface, dans le nouveau schéma, vous pouvez conduire toutes les interfaces dans la liste d'adresses, mais les adresses des sous-réseaux ne seront plus clairement connectées aux interfaces.</i> <br><br>  Un autre exemple est que vous avez plusieurs fournisseurs et que vous êtes trop paresseux pour dupliquer les règles de chacun: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/_t/sz/bx/_tszbx0l1jgo5eenl9ro07by7l8.png"></div><br><h2>  Utilisation dans le pare-feu nat </h2><br>  Lorsque les listes d'interfaces viennent d'apparaître, sur le forum mikrotik s'est plaint du travail des listes d'interfaces en nat, maintenant il semble avoir été réparé.  J'ai décidé d'enquêter <br><br>  Banc d'essai: <br><br><img src="https://habrastorage.org/webt/e8/ko/ye/e8koyeez2ohyxyitrjoj9ycdheg.png"><br>  <i>Le schéma n'a pas suffisamment d'adresses pour le même</i> <br><br>  Résultats: <br><br>  Chaîne src-nat: <br>  * mascarade - fonctionne.  En fonction de l'interface de sortie, remplacez l'ip correspondante. <br>  * src-nat - fonctionne.  Remplace l'adresse IP spécifiée uniquement pour l'interface sur laquelle cette adresse IP est présente. <br>  * même - fonctionne.  De même avec src-nat. <br><br>  Chaîne dst-nat: <br><br>  * redirection - fonctionne. <br>  * dst-nat - fonctionne.  Y compris en combinaison avec la mascarade. <br>  * netmap - fonctionne.  Si vous l'utilisez au lieu de dst-nat.  Lorsqu'il est utilisé comme prévu, il fonctionne également. <br><br><h2>  Utilisation dans le pare-feu mangle </h2><br>  Ça marche.  Par exemple, si vous devez marquer tout le trafic entrant provenant des interfaces pour l'arborescence de files d'attente. <br><br><h2>  Utilisation dans les profils VPN </h2><br>  Nous rappelons un exemple avec vpn régional.  La cinquième région a été ajoutée et vous l'ajoutez manuellement à la liste des interfaces, mais vous pouvez le faire plus facilement et spécifier dans le profil vpn quelle liste l'interface sera placée lors de la connexion, qu'elle soit contraignante ou créée automatiquement lorsque le client déconnecte l'interface de la liste supprimé.  Pour le vpn sortant, cela fonctionne également. <br><br>  [PPP] -&gt; [Profils] <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/8m/vh/sh/8mvhsh4bgd0y2k0hykyvf2jyywc.png"></div><br>  Tout va bien, mais il y a un bug (au moment de la publication, version RoS 6.42.6).  Si vous avez créé une liaison et l'avez ajoutée statiquement à la liste spécifiée dans les profils, la connexion ne sera pas établie.  Dans les journaux (serveur) sera quelque chose comme ceci: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/gz/kx/ye/gzkxyeja-4c0hmcbrzkokqbmity.png"></div><br><h2>  Utilisation en bridge </h2><br>  Vous pouvez spécifier la liste des interfaces en tant que membre du pont, mais seules les interfaces capables de travailler sur la couche 2 (ethernet, wlan, bounding, eoip, ovpn-ethernet, ...) seront ajoutées, à l'exception des autres ponts. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/fl/ne/k2/flnek2nq-wlt7ebooedlaccvxn4.png"></div><br><h2>  Détecter Internet </h2><br>  La fonctionnalité est apparue dans la version actuelle du firmware et n'est pas encore prête à l'emploi. <br>  [Interfaces] -&gt; [Détecter intranet] <br>  * Détecter la liste des interfaces - une liste avec les interfaces sur lesquelles les contrôles seront effectués. <br>  * Liste des interfaces LAN - une liste à laquelle toutes les interfaces couche2 actives sont ajoutées.  Obtenez le statut LAN. <br>  * Liste des interfaces WAN - une liste à laquelle toutes les interfaces tunnels lte et vpn sont ajoutées.  S'interface également avec le statut LAN qui n'a pas de serveur DHCP et à partir duquel l'adresse 8.8.8.8 est disponible.  En plus de tout, mikrotik ajoutera un client DHCP à l'interface pour essayer d'obtenir automatiquement les paramètres. <br>  * Liste des interfaces Internet - une liste des interfaces avec le statut Wan, si cloud.mikrotik.com opin0000 est disponible auprès d'eux.  Revérifiant toutes les minutes, après 3 tentatives infructueuses, l'interface revient à l'état Wan.  Modifiez l'adresse de vérification, ou les intervalles ne peuvent pas. <br><br>  [Statuts d'interface] - résultats des tests. <br><br>  C'est ainsi que cela devrait fonctionner, mais dans la pratique, les demandes de cloud.mikrotik.com ne sont pas envoyées.  Nous attendons et espérons que: ils le répareront;  supprimer les restrictions;  ajouter la possibilité d'exécuter des scripts lors du changement de l'état de l'interface. <br><br><div class="spoiler">  <b class="spoiler_title">Cap de spoiler</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/3a/lk/lu/3alkluuy0cepvpkwqbyra0_txus.png"></div></div><br><h2>  Autre </h2><br>  Dans la branche actuelle, MikroTik a décidé qu'il valait mieux utiliser la liste d'interfaces et maintenant les options suivantes sont configurées via des listes d'interfaces, au lieu d'interfaces spécifiques: <br>  * [IP] -&gt; [Voisins] -&gt; [Paramètres de découverte] <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/eu/go/at/eugoatfefz1tapspzq9aaujzlu8.png"></div><br>  * [Outils] -&gt; [MAC-Server] -&gt; [Mac-Telnet Server] &amp; [Mac-Winbox Server] <br><img src="https://habrastorage.org/webt/pf/bx/gr/pfbxgrlkcsrorvbwweyi7png9ps.png"><img src="https://habrastorage.org/webt/nv/jk/cc/nvjkccfj5qcpk_n31qetk2zqo8e.png"><br>  Après la mise à niveau, n'oubliez pas de reconfigurer. <br><br><h2>  Scripts et cli </h2><br>  Vous pouvez rencontrer une situation où l'une des interfaces de la liste devient inconnue (si vous supprimez l'interface avant de la supprimer de la liste) et je n'ai personnellement pas pu trouver un moyen de supprimer simplement (sans effacer la liste entière et en remplissant) une telle interface à l'aide de cli et de scripts.  Si quelqu'un sait - écrivez dans les commentaires. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ra/iy/hh/raiyhhhvhno-5p3troq4-dfflma.png"></div><br>  C’est tout.  J'espère que dans le monde il y aura moins de configurations avec l'union d'interfaces en bridge afin de réduire les règles du pare-feu. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr419327/">https://habr.com/ru/post/fr419327/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr419315/index.html">Durée de vie du moteur après la mort d'une fusée</a></li>
<li><a href="../fr419319/index.html">Comment démarrer Istio en utilisant Kubernetes en production. Partie 1</a></li>
<li><a href="../fr419321/index.html">SamsPcbGuide Partie 7: Traçage des lignes de signal Paires différentielles</a></li>
<li><a href="../fr419323/index.html">Installer Kubernetes sur Hetzner Cloud</a></li>
<li><a href="../fr419325/index.html">Relocaliser un étudiant en France</a></li>
<li><a href="../fr419329/index.html">Événements numériques à Moscou du 6 au 12 août</a></li>
<li><a href="../fr419331/index.html">Le Continuum de Haken: un instrument électronique à réactivité acoustique</a></li>
<li><a href="../fr419333/index.html">Tic Tac Toe sur DNS</a></li>
<li><a href="../fr419335/index.html">Le condensé de matières fraîches du monde du front-end de la dernière semaine n ° 325 (30 juillet - 5 août 2018)</a></li>
<li><a href="../fr419339/index.html">Les défis de Boeing et les succès de SpaceX à la conférence du Groupe consultatif de la sécurité aérospatiale</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>