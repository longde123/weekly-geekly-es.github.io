<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ˜‹ ğŸšµğŸ¿ ğŸŒ åœ¨Soil Xilinx Zynq 7000ä¸Šå¼€å‘æ¥å£å¡ï¼Œä»¥æ¨¡æ‹Ÿå’Œæ•°å­—æ ¼å¼è¿›è¡Œè¯­éŸ³è®°å½• ğŸ•·ï¸ ğŸ‘‹ğŸ¾ â™Œï¸</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†åˆ†äº«æˆ‘ä»¬åœ¨å¼€å‘åŸºäºSoC ARM + FPGA Xilinx Zynq 7000çš„æ¥å£å•å…ƒçš„æ¥å£å¡æ–¹é¢çš„ç»éªŒã€‚è¿™äº›æ¿å¡æ—¨åœ¨è®°å½•æ¨¡æ‹Ÿå’Œæ•°å­—PRI / BRIæ ¼å¼ï¼ˆISDNï¼ŒE1 / T1ï¼‰çš„è¯­éŸ³ä¿¡å·ã€‚ æœ€ç»ˆè®¾å¤‡æœ¬èº«å°†ç”¨äºè®°å½•æ°‘èˆªè°ˆåˆ¤ã€‚ 

 é“ï¼šè®¾å¤‡ç¡¬ä»¶å¹³å°çš„é€‰æ‹© 
 ç¡¬ä»¶å¹³å°çš„é€‰æ‹©å–...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>åœ¨Soil Xilinx Zynq 7000ä¸Šå¼€å‘æ¥å£å¡ï¼Œä»¥æ¨¡æ‹Ÿå’Œæ•°å­—æ ¼å¼è¿›è¡Œè¯­éŸ³è®°å½•</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/415435/"><img src="https://habrastorage.org/webt/rg/2_/55/rg2_55mpm_gc8ip2vlemo9tel9k.jpeg"><br><br> åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†åˆ†äº«æˆ‘ä»¬åœ¨å¼€å‘åŸºäºSoC ARM + FPGA Xilinx Zynq 7000çš„æ¥å£å•å…ƒçš„æ¥å£å¡æ–¹é¢çš„ç»éªŒã€‚è¿™äº›æ¿å¡æ—¨åœ¨è®°å½•æ¨¡æ‹Ÿå’Œæ•°å­—PRI / BRIæ ¼å¼ï¼ˆISDNï¼ŒE1 / T1ï¼‰çš„è¯­éŸ³ä¿¡å·ã€‚ æœ€ç»ˆè®¾å¤‡æœ¬èº«å°†ç”¨äºè®°å½•æ°‘èˆªè°ˆåˆ¤ã€‚ <br><a name="habracut"></a><br><h2> é“ï¼šè®¾å¤‡ç¡¬ä»¶å¹³å°çš„é€‰æ‹© </h2><br> ç¡¬ä»¶å¹³å°çš„é€‰æ‹©å–å†³äºPRI / BRIåè®®çš„æ”¯æŒï¼Œè¯¥åè®®åªèƒ½åœ¨FPGAç«¯å®ç°ã€‚ å¾®æ§åˆ¶å™¨ï¼ˆMCUï¼‰å’Œå¾®å¤„ç†å™¨ï¼ˆMPUï¼‰ä¸åˆé€‚ã€‚ <br><br> ä¸€ä¸ªäººå¯ä»¥é€‰æ‹©ä¸¤ä¸ªè§£å†³æ–¹æ¡ˆæ¥è§£å†³æ­¤é—®é¢˜ï¼š <br><br><ol><li>  Microblaze IPæ ¸å¿ƒåˆæˆ </li><li>  SoC Zynq-7000ã€‚ </li></ol><br> æˆ‘ä»¬é€‰æ‹©äº†Zynq 7000èŠ¯ç‰‡ï¼ˆSoCï¼‰ä¸Šçš„ç³»ç»Ÿï¼Œå› ä¸º ç¼–å†™è½¯ä»¶åº”ç”¨ç¨‹åºæ›´å®¹æ˜“ï¼Œå¹¶ä¸ºå½“å‰å’Œå°†æ¥çš„ä»»åŠ¡æä¾›æ›´å¤šåŠŸèƒ½ã€‚ <br><br> æ€»çš„æ¥è¯´ï¼Œè¯¥é¡¹ç›®æ”¶é›†äº†ä»¥ä¸‹é“æ¸…å•ï¼š <br><br>  <b>1.Xilinx Zynq 7020</b> ï¼ˆ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Mars-ZX3</a>å’Œ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Mars EB1</a> ï¼‰ <br><img src="https://habrastorage.org/webt/ls/g9/4w/lsg94w0qj20bxkf5t8k2gzvzx1e.jpeg"><br>  <i>Enclustraç«æ˜ŸZX3 SOM</i> <br><img src="https://habrastorage.org/webt/ft/z3/4t/ftz34tc8zkk-9gddjcx2atmufc8.jpeg"><br>  <i>Enclustra Mars EB1åº•æ¿</i> <br><br>  <b>2. TI TLV320AIC34</b> ï¼ˆ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">tlv320aic34evm-k</a>å’ŒUSBä¸»æ¿ï¼‰ã€‚ <br><br><img src="https://habrastorage.org/webt/3z/ls/g-/3zlsg-yry1k4e4qyqu1g-o0xt4a.jpeg"><br>  <i>TLV320AIC34çš„è°ƒè¯•æ¿ï¼ˆTLV320AIC34EVM-Kï¼‰</i> <br><br><img src="https://habrastorage.org/webt/pb/mk/84/pbmk84mawx1rbpmqreghow9fjim.jpeg"><br>  <i>é€‚ç”¨äºTLV320AIC34EVM-Kçš„USB-MODEVMæ‰©å±•æ¿</i> <br><br>  <b>3. IDT82P2288-PRIï¼ŒXHFC-4SU-BRIå¾®ç”µè·¯ï¼Œ</b>å› ä¸ºæ²¡æœ‰è°ƒè¯•å·¥å…·åŒ…ï¼Œæ‰€ä»¥æˆ‘ä»¬åªæ˜¯ä¸ºæµ‹è¯•çš„ipå†…æ ¸å¥ å®šäº†åŸºç¡€ï¼Œå¹¶ä¸”åœ¨åˆ¶ä½œåŸå‹æ¿åå°±åœ¨è¿‡ç¨‹ä¸­å‘ç”Ÿäº†æ´—ç¤¼ã€‚ <br><br><h2> åœ¨Xilinx Zynq 7000èŠ¯ç‰‡ä¸Šä½¿ç”¨ç³»ç»Ÿ </h2><br><br><img src="https://habrastorage.org/webt/t5/2n/ka/t52nkauzukagn0mp_aruobwjigm.png"><br>  <i>SoC Xilinx Zynq 7000çš„å†…éƒ¨ç»“æ„</i> <br><br><img src="https://habrastorage.org/webt/u9/nn/nl/u9nnnlwp0nib8s4td2drrorqm54.png"><br>  <i>ä¸ºXilinx Zynqç”Ÿæˆå¯åŠ¨æ–‡ä»¶çš„æ­¥éª¤</i> <br><br>  Zynqçš„åˆ·æ–°/ä¸‹è½½å¯æ‰§è¡Œæ–‡ä»¶ä¸MPUçš„å¸¸è§„ä¸‹è½½ä¸åŒã€‚  Cortex-Aå¤„ç†å™¨çš„é€šå¸¸å·¥ä½œæ˜¯åŠ è½½u-bootï¼Œå†…æ ¸linuxï¼Œrootfsã€‚ åœ¨Zynqä¸Šï¼Œå‡ºç°æ¯”ç‰¹æµï¼Œè¿™æ˜¯FPGAçš„å›ºä»¶æ–‡ä»¶ã€‚ æ¯”ç‰¹æµåŒ…å«å¯¹FPGAä¸Šç¡¬ä»¶æ¨¡å—ä»¥åŠä¸å¤„ç†å™¨å†…éƒ¨é€šä¿¡çš„æè¿°ã€‚ è¯¥æ–‡ä»¶åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶åŠ è½½ã€‚ åŒæ ·åœ¨linuxç«¯ï¼Œæœ‰ä¸€ç§æœºåˆ¶å…è®¸æ‚¨åœ¨æ“ä½œè¿‡ç¨‹ä¸­ç«‹å³åˆ·æ–°PLéƒ¨åˆ†ï¼Œè¿™ç§è®¾å¤‡ç§°ä¸ºxdevcfgï¼ˆ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è‡ª2018.1å¼€å§‹ä¸ºZYNQ FPGAç®¡ç†å™¨</a> ï¼‰ã€‚ <br><br><h2>  PRI / BRIæ¥å£ </h2><br><img src="https://habrastorage.org/webt/om/zo/dr/omzodrzsfz9d5oqyo-ukvvsozve.jpeg"><br>  <i>æ•°å­—ç½‘ç»œPRI / BRIçš„åŠŸèƒ½</i> <br><br> ä¸»é€Ÿç‡æ¥å£ï¼ˆPRIï¼‰æ˜¯æ ‡å‡†çš„ISDNç½‘ç»œæ¥å£ï¼Œå®ƒå®šä¹‰äº†å°†ISDNç«™è¿æ¥åˆ°è¿æ¥æœ¬åœ°å’Œä¸­å¤®äº¤æ¢æœºæˆ–ç½‘ç»œäº¤æ¢æœºçš„å®½å¸¦ä¸­ç»§çš„åŸåˆ™ã€‚ <br><br><img src="https://habrastorage.org/webt/_5/p0/5k/_5p05km2btytoe7ptkdrfuz_-8o.png"><br>  <i>PRIçš„ä¼ è¾“å¸§ç±»å‹</i> <br><br><img src="https://habrastorage.org/webt/rp/ux/hd/rpuxhdxujlk8c2cnxxgdga74-tk.png"><br>  <i>BRIä¼ è¾“å¸§çš„è§†å›¾</i> <br><br><img src="https://habrastorage.org/webt/-i/1c/90/-i1c90_mrzspj2jhrog9akk_u4g.png"><br>  <i>PRIç‰©ç†çš„å†…éƒ¨ç»“æ„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">-IDT82P2288</a></i> <br><br><img src="https://habrastorage.org/webt/ca/iv/s5/caivs5jr2frxcu_xiign_my2db8.png"><br>  <i>BRIç‰©ç†çš„å†…éƒ¨ç»“æ„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">-XHFC-4SU</a></i> <br><br><h2> éŸ³é¢‘ç¼–è§£ç å™¨TLV320AIC34 </h2><br> ç”¨äºä¾¿æºå¼éŸ³é¢‘å’Œç”µè¯çš„å››é€šé“ä½åŠŸè€—<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">TLV320AIC34éŸ³é¢‘ç¼–è§£ç å™¨</a>æ˜¯ç”¨äºæ¨¡æ‹Ÿç”µè¯çš„è‰¯å¥½è§£å†³æ–¹æ¡ˆã€‚ <br><br><img src="https://habrastorage.org/webt/7i/7g/lr/7i7glrlam_fmxm2inkwcgqinrl8.png"><br>  <i>Tlv320aic34 A-éƒ¨åˆ†ï¼ŒéŸ³é¢‘ç¼–è§£ç å™¨åŒ…å«ä¸¤ä¸ªæ­¤ç±»åŠŸèƒ½å—</i> <br><br> æ•°æ®å¯ä»¥é€šè¿‡I2Sæ¥å£ä»¥åŠDSPï¼ŒPCMï¼ŒTDMè¿›è¡Œä¼ è¾“ã€‚ <br><br>  I2Sæ˜¯ä¸²è¡Œæ€»çº¿æ¥å£æ ‡å‡†ï¼Œç”¨äºè¿æ¥æ•°å­—éŸ³é¢‘è®¾å¤‡ï¼Œå¹¶ç”µæ°”è¡¨ç¤ºä»æœ‰æºè®¾å¤‡åˆ°æ— æºè®¾å¤‡çš„3æ¡å¯¼ä½“ï¼Œä»¥åŠä¸ä¹‹å¯¹åº”çš„4æ¡ä¿¡å·ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š <br><br><ol><li> ä½æ—¶é’Ÿï¼ˆBCLKï¼‰ã€‚ </li><li> æ—¶é’Ÿä¿¡å·å¸§ï¼ˆæ ¹æ®å­—ï¼‰åŒæ­¥ï¼ˆWCLKï¼‰ã€‚ </li><li> å¯ä»¥å‘é€æˆ–æ¥æ”¶2ä¸ªæ—¶åˆ†é€šé“ï¼ˆDIN / DOUTï¼‰çš„æ•°æ®ä¿¡å·ã€‚ </li></ol><br> æ¥æ”¶å’Œå‘é€æ•°æ®çš„é€šé“æ˜¯åˆ†å¼€çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæœ‰ä¸€ä¸ªå•ç‹¬çš„é€šé“ç”¨äºæ¥æ”¶æ•°æ®å’Œä¸€ä¸ªå‘é€é€šé“ã€‚ æ§åˆ¶å™¨æ¥æ”¶ç”±éŸ³é¢‘ç¼–è§£ç å™¨ä¼ è¾“çš„æ•°æ®ï¼Œä½†æ˜¯ç›¸åçš„æ“ä½œä¹Ÿæ˜¯å¯èƒ½çš„ã€‚ <br><br><img src="https://habrastorage.org/webt/p5/op/th/p5opthpov06xstxalowbqz_emt8.png"><br>  <i>I2Sæ¡†æ¶ï¼ŒI2Sæ¥å£çš„åŠŸèƒ½</i> <br><br> é€‰æ‹©æ‰€æœ‰ç¡¬ä»¶ç»„ä»¶åï¼Œæˆ‘ä»¬è§£å†³äº†å°†éŸ³é¢‘ç¼–è§£ç å™¨ä¸Xilinx Zynq 7020è¿æ¥çš„é—®é¢˜ã€‚ <br><br><h2> æœç´¢I2Så†…æ ¸ </h2><br> åœ¨Xilinx Zynq 7020ä¸­ä½¿ç”¨éŸ³é¢‘æµæ—¶ï¼Œæœ€å›°éš¾çš„æ—¶åˆ»å¯èƒ½æ˜¯è¯¥ç³»ç»Ÿçš„å¤„ç†å™¨éƒ¨åˆ†ä¸ŠåŸºæœ¬ä¸Šæ²¡æœ‰I2Sæ€»çº¿ï¼Œå› æ­¤æˆ‘å¿…é¡»æ‰¾åˆ°I2Så†…æ ¸ã€‚  ipå†…æ ¸åº”ä¸ºç©ºé—²çŠ¶æ€ï¼Œä½¿æ­¤ä»»åŠ¡å˜å¾—å¤æ‚ã€‚ <br><br> æˆ‘ä»¬ç¡®å®šäº†å‡ ä¸ªIPå†…æ ¸ã€‚ å‘ç°ç”¨äºè£¸æœºæ ¸å¿ƒI2S <b>Digilent</b> ã€‚ æˆ‘ä»¬åœ¨<b>opencore</b>ä¸Šæ‰¾åˆ°äº†å‡ ä¸ªipå†…æ ¸ï¼Œä¹Ÿè®¸å¯¹æˆ‘ä»¬æ¥è¯´æœ€å¥½çš„é€‰æ‹©æ˜¯<b>ADIå…¬å¸çš„</b> ipå†…æ ¸ã€‚ ä»–ä»¬ä¸ºè‡ªå·±çš„è®¾å¤‡ç”Ÿäº§IPå†…æ ¸ï¼Œä»¥è¿›è¡ŒFPGA / FPGAäº¤äº’ã€‚ <br><br> æˆ‘ä»¬å¯¹ç§°ä¸º<b>AXI-I2S-ADI</b>çš„IPæ ¸æ„Ÿå…´è¶£<b>ã€‚</b>  ADIå…¬å¸æœ¬èº«æ­£åœ¨ä¸ºå…¶ç¡¬ä»¶å¹³å°æ¨å¹¿è¿™äº›IPå†…æ ¸ã€‚ <br><br> ç”¨ä¾‹åˆ—è¡¨ï¼š <br><br><ol><li> è£¸æœº-I2Sçš„IPå†…æ ¸ï¼ˆDigilent ZYBOéŸ³é¢‘ï¼‰ </li><li>  opencores.org </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">AXI-I2S-ADIæ§åˆ¶å™¨</a> ï¼ˆæ¨¡æ‹Ÿè®¾å¤‡ï¼‰ </li></ol><br><h3>  AXI-I2S-ADI IPå†…æ ¸ </h3><br>  ipæ ¸å¿ƒæœ¬èº«çœ‹èµ·æ¥åƒè¿™æ ·ï¼šå®ƒåŒ…å«bclkï¼Œwclkï¼Œdinå’Œdoutè¡Œã€‚ å®ƒè¿æ¥åˆ°DMA Xilinx Zynq 7000ï¼Œåœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼Œä½¿ç”¨äº†DMA PSéƒ¨åˆ†ã€‚ æ‰€æœ‰æ•°æ®äº¤æ¢éƒ½é€šè¿‡DMAè¿›è¡Œã€‚  DMAå¯ä»¥æ˜¯ç‹¬ç«‹å•å…ƒï¼Œä¹Ÿå¯ä»¥æ˜¯PS SoCçš„ç»„æˆéƒ¨åˆ†ã€‚ <br><br> é…ç½®æ­¤ipå†…æ ¸æ—¶ï¼Œé‡è¦çš„æ˜¯ä¸è¦å¿˜è®°å°†mclkä¸»é¢‘ç‡æäº¤ç»™tlv320aic34æœ¬èº«ï¼Œä½œä¸ºå¯¹tlv320aic34ä½¿ç”¨è°ƒè¯•å·¥å…·åŒ…çš„ä¸€ä¸ªé€‰é¡¹-æäº¤å¤–éƒ¨ä¸»é¢‘ç‡ã€‚ <br><br><img src="https://habrastorage.org/webt/i8/xn/z4/i8xnz4rijta_07gc1zgc2a8vfxc.png"><br>  <i>åŠŸèƒ½å—ï¼Œå·²è¿æ¥axi-i2s-adi</i> <br><br> å®Œæˆé…ç½®è¿‡ç¨‹åï¼Œä»»åŠ¡æ˜¯åœ¨Linux OSä¸­å¯åŠ¨åŠŸèƒ½ã€‚ <br><br><h2> å¯åŠ¨å’Œé…ç½®TLV320AIC34çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è®¾å¤‡æ ‘</a> </h2><br> é…ç½®i2cï¼ˆåœ¨æ­¤æ¥å£ä¸Šé…ç½®äº†tlv320aic34ï¼‰ï¼š <br><br><pre><code class="cpp hljs">i2c0: i2c@e0004000 { ... tlv320aic3x: tlv320aic3x@<span class="hljs-number"><span class="hljs-number">18</span></span> { <span class="hljs-meta"><span class="hljs-meta">#sound-dai-cells = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;0&gt;; compatible = "ti,tlv320aic3x"; reg = &lt;0x18&gt;; gpio-reset = &lt;&amp;axi_gpio_0 0 0&gt;; ai3x-gpio-func = &lt;&amp;axi_gpio_0 1 0&gt;, /* AIC3X_GPIO1_FUNC_DISABLED */ &lt;&amp;axi_gpio_0 2 0&gt;; /* AIC3X_GPIO2_FUNC_DIGITAL_MIC_INPUT */ AVDD-supply = &lt;&amp;vmmc2&gt;; DRVDD-supply = &lt;&amp;vmmc2&gt;; IOVDD-supply = &lt;&amp;vmmc2&gt;; DVDD-supply = &lt;&amp;vmmc2&gt;; ai3x-micbias-vg = &lt;1&gt;; }; ... };</span></span></span></span></code> </pre> <br> é…ç½®i2ï¼ˆé€šè¿‡æ­¤æ¥å£ä¼ è¾“éŸ³é¢‘æ•°æ®ï¼‰ï¼š <br><br><pre> <code class="cpp hljs">i2s_clk: i2s_clk { <span class="hljs-meta"><span class="hljs-meta">#clock-cells = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;0&gt;; compatible = "fixed-clock"; clock-frequency = &lt;11289600&gt;; clock-output-names = "i2s_clk"; }; axi_i2s_adi_0: axi_i2s_adi@43C00000 { compatible = "adi,axi-i2s-1.00.a"; reg = &lt;0x43C00000 0x1000&gt;; xlnx,bclk-pol = &lt;0x0&gt;; xlnx,dma-type = &lt;0x1&gt;; xlnx,has-rx = &lt;0x1&gt;; xlnx,has-tx = &lt;0x1&gt;; xlnx,lrclk-pol = &lt;0x0&gt;; xlnx,num-ch = &lt;0x1&gt;; xlnx,s-axi-min-size = &lt;0x000001FF&gt;; xlnx,slot-width = &lt;0x18&gt;; }; &amp;axi_i2s_adi_0 { #sound-dai-cells = &lt;0&gt;; compatible = "adi,axi-i2s-1.00.a"; clocks = &lt;&amp;clkc 15&gt;, &lt;&amp;i2s_clk&gt;; clock-names = "axi", "ref"; dmas = &lt;&amp;dmac_s 0 &amp;dmac_s 1&gt;; dma-names = "tx", "rx"; };</span></span></span></span></code> </pre> <br> åœ¨è®¾å¤‡æ ‘ä¸­è®¾ç½®å£°å¡ï¼ˆå£°å¡ï¼‰ï¼š <br><br><pre> <code class="cpp hljs"> sound { compatible = <span class="hljs-string"><span class="hljs-string">"simple-audio-card"</span></span>; simple-audio-card,name = <span class="hljs-string"><span class="hljs-string">"TLV320AIC34"</span></span>; simple-audio-card,format = <span class="hljs-string"><span class="hljs-string">"i2s"</span></span>; simple-audio-card,bitclock-master = &lt;&amp;dailink0_master&gt;; simple-audio-card,frame-master = &lt;&amp;dailink0_master&gt;; simple-audio-card,widgets = ... simple-audio-card,routing = ... dailink0_master: simple-audio-card,cpu { clocks = &lt;&amp;i2s_clk&gt;; sound-dai = &lt;&amp;axi_i2s_adi_0&gt;; }; simple-audio-card,codec { clocks = &lt;&amp;i2s_clk&gt;; sound-dai = &lt;&amp;tlv320aic3x&gt;; }; }; };</code> </pre> <br> åœ¨Linuxçš„è®¾å¤‡æ ‘ä¸­é…ç½®å’Œé…ç½®äº†ç¼–è§£ç å™¨çš„æ‰€æœ‰æ“ä½œå®Œæˆä¹‹åï¼Œä»¤äººå‚æ¶çš„å£°å¡å‡ºç°äº†ï¼Œæˆ‘ä»¬èƒ½å¤Ÿå¬åˆ°éŸ³ä¹äº†ï¼ˆæˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªéŸ³ä¹æ›²ç›®æ˜¯AC / DCçš„â€œåœ°ç‹±ä¹‹è·¯â€ï¼‰ã€‚ <br><br> è¿™æ˜¯æˆ‘ä»¬è¦åšçš„ï¼š <br><br><ul><li> ä½¿ç”¨clk_wizï¼ˆè®¡æ—¶å‘å¯¼ï¼‰ç”Ÿæˆäº†å¿…è¦çš„é¢‘ç‡ </li><li> æ­£ç¡®é…ç½®äº†tlv320aic34çš„DTS </li><li> æ·»åŠ äº†å¯¹tlv320aic3xé©±åŠ¨ç¨‹åºçš„æ”¯æŒ </li><li> å‘buildrootæ·»åŠ äº†éŸ³é¢‘åŒ…ä»¥æ’­æ”¾éŸ³é¢‘æµï¼ˆaplayï¼Œmadplayç­‰ï¼‰ </li></ul><br> åœ¨å¼€å‘ç»ˆç«¯è®¾å¤‡çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬é¢ä¸´ç€è¿æ¥4ä¸ªtlv320aic34å¾®ç”µè·¯çš„ä»»åŠ¡ã€‚ ä¸Šè¿°tlv320aic34èŠ¯ç‰‡åŒ…å«2ä¸ªç”¨äºå¤„ç†éŸ³é¢‘æµçš„æ¨¡å—ï¼Œæ¯ä¸ªæ¨¡å—éƒ½æœ‰è‡ªå·±çš„i2cçº¿ï¼Œç”¨äºé…ç½®å’Œè®¾ç½®éŸ³é¢‘å‚æ•°ã€‚ ä¸€ä¸ªå—åªèƒ½åˆ†åˆ«å…·æœ‰å››ä¸ªåœ°å€ï¼Œä¸å¯èƒ½å°†å››ä¸ªtlv320aic34å¾®ç”µè·¯è¿æ¥åˆ°ä¸€ä¸ªi2cæ¥å£ï¼Œæ‚¨éœ€è¦ä½¿ç”¨ä¸¤ä¸ªi2cæ¥å£ï¼ˆ8ä¸ªç‹¬ç«‹çš„éŸ³é¢‘å—ï¼‰ã€‚ å¯¹äºæ¯ä¸ªæ¨¡å—ï¼Œå¦‚æœåˆ†åˆ«å¯åŠ¨mclkï¼Œblckï¼Œwclkï¼Œdin / doutï¼Œåˆ™æ€»å…±éœ€è¦æ·»åŠ 40æ¡ä¿¡å·çº¿ï¼Œè¿™å¯¹äºæˆ‘ä»¬é€‰æ‹©çš„somæ¨¡å—æ¥è¯´ï¼Œä»ç”µè·¯çš„è§’åº¦æ¥çœ‹æ˜¯ä¸å¯èƒ½çš„ï¼Œè€Œä¸”æ˜¯ä¸åˆç†çš„ï¼Œå› ä¸ºé™¤äº†è¿™äº›ä¿¡å·ä¹‹å¤–ï¼Œæ‚¨è¿˜å¿…é¡»è¿æ¥è®¸å¤šå…¶ä»–çº¿è·¯ï¼Œæ¥å£ã€‚ <br><br> ç»“æœï¼Œæˆ‘ä»¬å†³å®šå°†å£°å¡åˆ‡æ¢ä¸º<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">TDMæ¨¡å¼</a> ï¼Œåœ¨è¯¥<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ¨¡å¼ä¸‹</a> ï¼Œå°†æ‰€æœ‰mclkï¼Œbclkï¼Œdinï¼Œdoutçº¿ç»„åˆåœ¨ä¸€èµ·ï¼Œä»è€Œå‡å°‘äº†é€šä¿¡çº¿çš„æ€»æ•°ã€‚ è¯¥å†³å®šå½±å“äº†axi-i2s-adiçš„æ“ä½œï¼Œå› ä¸ºipå†…æ ¸æœ¬èº«åœ¨ä¸»æ¨¡å¼ä¸‹å·¥ä½œã€‚ åŒæ ·ï¼Œæ­¤æ›´æ”¹ä¸å…è®¸æˆ‘ä»¬åœ¨TDMæ¨¡å¼ä¸‹ä½¿ç”¨ip-coreï¼Œå› æ­¤æˆ‘ä»¬åšå†³å†³å®šæ”¾å¼ƒä½¿ç”¨é€‰å®šçš„ip-coreã€‚ æˆ‘å¿…é¡»ç¼–å†™ä¸€ä¸ªipå†…æ ¸æ¥ä¾¦å¬i2sæµé‡å¹¶å°†å…¶å‘é€åˆ°dmaï¼Œè¯¥è§£å†³æ–¹æ¡ˆä½¿æˆ‘ä»¬èƒ½å¤Ÿåˆ›å»ºä¸€ä¸ªé€šç”¨æ¥å£æ¥æ¥æ”¶æ•°æ®ï¼Œè¯¥æ¥å£ä¸ä¾èµ–äºç”¨äºè®°å½•å‘¼å«çš„å¡çš„ç±»å‹ï¼ˆæ¨¡æ‹Ÿå¡å’Œæ•°å­—å¡ï¼‰ã€‚ <br><br> é€šè¿‡i2sæ¥å£æ¥æ”¶éŸ³é¢‘æµåŠå…¶å¤„ç†çš„åˆå§‹æ¶æ„ï¼š <br><br><img src="https://habrastorage.org/webt/yn/24/2d/yn242d_8cm4kazs2ycwceevqqe8.jpeg"><br><br> é€šè¿‡i2sæ¥å£æ¥æ”¶éŸ³é¢‘æµåŠå…¶å¤„ç†çš„æœ€ç»ˆæ¶æ„ï¼š <br><br><img src="https://habrastorage.org/webt/mz/py/dt/mzpydtgravupatvivp_zmpiitig.jpeg"><br><br> æ¥æ”¶PRIæµçš„ç»“æ„åŠå…¶å¤„ç†ï¼š <br><br><img src="https://habrastorage.org/webt/qx/ee/7w/qxee7wt1mdazgm0tu0eukbm5rmy.jpeg"><br><br>  BRIæµæ¥æ”¶å’Œå¤„ç†çš„ä½“ç³»ç»“æ„ï¼š <br><br><img src="https://habrastorage.org/webt/wd/uf/ny/wdufnykenpfxgwyhrnr3x6ep2kg.jpeg"><br><br><h2> é˜¿è¥¿ç› </h2><br> è¿™æ˜¯dmaåŒæ­¥ç³»ç»Ÿçš„é‡è¦å…ƒç´ ã€‚ <br><br><img src="https://habrastorage.org/webt/v7/fx/pk/v7fxpk_3eemrqnlmy3iejsjrup4.png"><br>  <i>Xilinx Vivadoä¸­çš„AXI DMAé…ç½®çª—å£</i> <br><br> åœ¨æ‰“å°å±å¹•ä¸Šï¼Œå°†æ˜¾ç¤ºAXI DMAæ¨¡å—æœ¬èº«ã€‚ å®ƒæœ‰å¾ˆå¤šå‚æ•°ã€‚ æ‚¨å¯ä»¥é…ç½®æ€»çº¿ä¼ è¾“å¤šå°‘æ•°æ®ã€‚ æ•°æ®å¯ä»¥å¯¹é½æˆ–é‡‡ç”¨ä»»ä½•æ ¼å¼ã€‚  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æŠ€æœ¯æ–‡æ¡£ä¸­</a>æè¿°<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">äº†</a>ä¸axi dmaçš„æ“ä½œå’Œäº¤äº’çš„è¯¦ç»†è¯´æ˜ï¼ˆä»ä¸€ä¸ªç‰ˆæœ¬åˆ°å¦ä¸€ä¸ªç‰ˆæœ¬ï¼Œè¯´æ˜ä¸­å­˜åœ¨ä¸æ­£ç¡®ä¹‹å¤„çš„è¡¥å……å’Œæ›´æ­£ï¼Œä»¥åŠipå†…æ ¸çš„å®Œå–„ï¼‰ã€‚ <br><br><h2> é€šè¿‡AXI DMAï¼ŒAXI DMAæµ‹è¯•é€‰é¡¹éªŒè¯æ•°æ®ä¼ è¾“ </h2><br> åœ¨å¼€å‘é©±åŠ¨ç¨‹åºæ—¶ï¼Œæˆ‘ä»¬å†³å®šå¯»æ‰¾å¼€æºå¹¶ä½¿å…¶é€‚åº”æˆ‘ä»¬çš„ä»»åŠ¡ã€‚ ç»“æœï¼Œæˆ‘ä»¬é€‰æ‹©äº†<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">github-project ezdma</a> ï¼ˆåŒå…³è¯­ï¼Œç®€ç§°ä¸ºeasy dmaï¼‰çš„æºä»£ç ã€‚ <br><br> ä¸‹ä¸€æ­¥æ˜¯æµ‹è¯•é©±åŠ¨ç¨‹åºçš„å¼€å‘ï¼Œè¿™æ˜¯ä»FPGAå¼€å‘éƒ¨é—¨è·å¾—å…·æœ‰ç°æˆåŠŸèƒ½çš„ipå†…æ ¸åˆ°æˆ‘ä»¬ï¼ˆæè¿°çš„å¼€å‘è¿‡ç¨‹ç”±åµŒå…¥å¼ç¨‹åºå‘˜å½¢æˆï¼‰çš„æ—¶åˆ»çš„å‡†å¤‡é˜¶æ®µã€‚ åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬å†³å®šé‡‡ç”¨AXI DMAï¼ŒAXI DATA FIFOå¹¶è¿›è¡Œç¯å›ï¼Œä»¥ç¡®ä¿å°†æ¥ä¸ä¼šå‡ºç°é”™è¯¯ã€‚ æˆ‘ä»¬å¾ªç¯äº†æ•°æ®çš„å‘é€å’Œæ¥æ”¶ï¼Œå› æ­¤æˆ‘ä»¬æ£€æŸ¥äº†å·¥ä½œç»“æœå’Œé©±åŠ¨ç¨‹åºçš„æ€§èƒ½ã€‚ æˆ‘ä»¬å¯¹åŠŸèƒ½è¿›è¡Œäº†ä¸€äº›è°ƒæ•´ï¼Œä½¿å…¶åœ¨äº¤äº’ç•Œé¢ä¸Šè¾¾åˆ°äº†æˆ‘ä»¬çš„æœŸæœ›ï¼Œå¹¶å†æ¬¡æ£€æŸ¥äº†é©±åŠ¨ç¨‹åºçš„å¯æ“ä½œæ€§å’Œæ‰€é€‰çš„äº¤äº’åŸç†ã€‚ <br><br><img src="https://habrastorage.org/webt/iw/si/uj/iwsiujsbv1tckuamu1lsjalzrao.png"><br>  <i>å›æº¯æ¨¡å—è®¾è®¡ï¼Œæµ‹è¯•AXI DMAçš„ç¬¬ä¸€ç§æ–¹æ³•</i> <br><br> è®¾å¤‡æ ‘ä¸­çš„DMAå’Œezdmaæè¿°çš„ç¤ºä¾‹ï¼š <br><br><pre> <code class="cpp hljs">/ { amba_pl: amba_pl { <span class="hljs-meta"><span class="hljs-meta">#address-cells = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;1&gt;; #size-cells = &lt;1&gt;; compatible = "simple-bus"; ranges ; axi_dma_1: axi_dma { #dma-cells = &lt;1&gt;; compatible = "xlnx,axi-dma-1.00.a"; reg = &lt;0x40400000 0x10000&gt;; clock-names = "s_axi_lite_aclk", "m_axi_sg_aclk", "m_axi_mm2s_aclk", "m_axi_s2mm_aclk"; clocks = &lt;&amp;clkc 15&gt;, &lt;&amp;clkc 15&gt;, &lt;&amp;clkc 15&gt;, &lt;&amp;clkc 15&gt;; interrupt-parent = &lt;&amp;intc&gt;; interrupts = &lt;0 29 4 0 30 4&gt;; xlnx,addrwidth = &lt;0x20&gt;; xlnx,include-sg; dma-channel@40400000 { compatible = "xlnx,axi-dma-mm2s-channel"; dma-channels = &lt;0x1&gt;; interrupts = &lt;0 29 4&gt;; xlnx,datawidth = &lt;0x20&gt;; xlnx,device-id = &lt;0x0&gt;; xlnx,include-dre ; }; dma-channel@40400030 { compatible = "xlnx,axi-dma-s2mm-channel"; dma-channels = &lt;0x1&gt;; interrupts = &lt;0 30 4&gt;; xlnx,datawidth = &lt;0x20&gt;; xlnx,device-id = &lt;0x0&gt;; xlnx,include-dre ; }; }; ezdma0 { compatible = "ezdma"; dmas = &lt;&amp;axi_dma_1 0 &amp;axi_dma_1 1&gt;; dma-names = "loop_tx", "loop_rx"; // used when obtaining reference to above DMA core using dma_request_slave_channel() ezdma,dirs = &lt;2 1&gt;; // direction of DMA channel: 1 = RX (dev-&gt;cpu), 2 = TX (cpu-&gt;dev) }; ... }; };</span></span></span></span></code> </pre> <br> æ‚¨å¯ä»¥ä½¿ç”¨â€œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è®¾å¤‡æ ‘ç”Ÿæˆå™¨â€å·¥å…·</a>è½»æ¾ç”Ÿæˆdts / dtsiæ–‡ä»¶ã€‚ <br><br> æˆ‘ä»¬å¼€å‘è¿‡ç¨‹çš„ç¬¬äºŒæ­¥æ˜¯åˆ›å»ºä¸€ä¸ªæµ‹è¯•ip-kernelï¼Œç”¨äºæ£€æŸ¥é©±åŠ¨ç¨‹åºçš„æ€§èƒ½ï¼Œåªæœ‰è¿™æ¬¡æ•°æ®æ‰æœ‰æ„ä¹‰ï¼Œå¹¶é€šè¿‡AXISä¼ è¾“åˆ°AXI_DMAï¼ˆå°†åœ¨ip-kernelçš„æœ€ç»ˆç‰ˆæœ¬ä¸­è¿›è¡Œï¼‰ã€‚ <br><br><img src="https://habrastorage.org/webt/uc/nc/iz/ucncizx2gwl3am9mxz5iursdy1q.png"><br>  <i>AXISç•Œé¢å·¥ä½œæµç¨‹</i> <br><br> æˆ‘ä»¬å®ç°äº†ipå†…æ ¸çš„ä¸¤ä¸ªå˜ä½“æ¥ç”Ÿæˆæ•°æ®ï¼Œç¬¬ä¸€ä¸ªç»è¿‡æµ‹è¯•çš„ç‰ˆæœ¬æ˜¯é€šè¿‡verilogå®ç°çš„ï¼Œç¬¬äºŒä¸ªæ˜¯åœ¨HLSä¸Šå®ç°çš„ï¼ˆåœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒHLSå‡ºç°åœ¨â€œ stylish-fashion-youthâ€çš„å£å·ä¸‹ï¼‰ã€‚ <br><br> å¼€å‘æ­¤ç±»ipå†…æ ¸æ—¶ï¼Œverilogæ•°æ®ç”Ÿæˆå™¨ï¼ˆé€šå¸¸ä½¿ç”¨hdlç³»åˆ—çš„è¯­è¨€-verilogï¼Œvhdlç­‰ï¼‰æ˜¯ä¸€ç§æ ‡å‡†è§£å†³æ–¹æ¡ˆã€‚ ä»¥ä¸‹æ˜¯ä¸­é—´ipå†…æ ¸çš„ä¸€äº›ä»£ç æ®µï¼š <br><br><pre> <code class="hljs sql">module GenCnt ( â€¦. assign HandsHake = m_axis_din_tready &amp; m_axis_dout_tvalid; always @(posedge Clk) <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Rst) <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> smCnt &lt;= sIDLE; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> (smCnt) sIDLE: <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> smCnt &lt;= sDATA; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> sDATA: <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Cnt == cTopCnt - <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> smCnt &lt;= sLAST; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> ... endmodule</code> </pre> <br> ç”±äºè¿™æ˜¯FPGAè®¾è®¡äººå‘˜çš„å…¸å‹ä»»åŠ¡ï¼Œå› æ­¤æ— éœ€è¿›è¡Œæ›´è¯¦ç»†çš„æè¿°ã€‚ <br><br> è¿™é‡Œæ›´æœ‰è¶£çš„â€œé‡å…½â€æ˜¯HLSã€‚  <b>Vivado HLSï¼ˆé«˜çº§ç»¼åˆï¼‰</b>æ˜¯æ–°çš„Xilinx CADè½¯ä»¶ï¼Œç”¨äºä½¿ç”¨é«˜çº§è¯­è¨€ï¼ˆä¾‹å¦‚OpenCLï¼ŒCæˆ–C ++ï¼‰åˆ›å»ºæ•°å­—è®¾å¤‡ã€‚ <br><br>  C / C ++æ˜¯åµŒå…¥å¼è½¯ä»¶å·¥ç¨‹å¸ˆçš„ä¸»è¦è¯­è¨€ï¼Œå› æ­¤ä½¿ç”¨è¿™äº›è¯­è¨€è§£å†³é—®é¢˜å¯¹äºå°†æ¥çš„é¡¹ç›®çš„å®ç°å’Œæ¯”è¾ƒåˆ†æè€Œè¨€æ›´ä¸ºæœ‰è¶£ã€‚ <br><br> è¿™æ˜¯ä½¿ç”¨HLSçš„ä¸¤ä¸ªå°ç¤ºä¾‹ã€‚ ç¬¬ä¸€ä¸ªç¤ºä¾‹æ˜¯AXI_DMAçš„æ•°æ®ç”Ÿæˆå™¨ï¼Œç¬¬äºŒä¸ªç¤ºä¾‹æ˜¯é€šè¿‡s_axiliteæ¥å£åœ¨å¤„ç†å™¨éƒ¨åˆ†å’Œå¯ç¼–ç¨‹é€»è¾‘ä¹‹é—´äº¤æ¢æ•°æ®ã€‚ <br><br> å®ç°äº†é€šè¿‡s_axiliteæ¥å£è¿›è¡Œæ•°æ®äº¤æ¢ï¼ˆç¬¬äºŒä¸ªç¤ºä¾‹ï¼‰ï¼Œä»¥ä¾¿å¯ä»¥éšæ—¶éšæ—¶å‡å»åŠ è½½çš„ä½æµï¼Œä»è€Œå¯ä»¥é€šè¿‡å¯¹SoCçš„PLéƒ¨åˆ†è¿›è¡Œç‰ˆæœ¬æ§åˆ¶æ¥è·Ÿè¸ªå·¥ä½œçš„æ­£ç¡®æ€§ã€‚ åœ¨è¿™é‡Œï¼Œä½¿ç”¨s_axiliteå‡ºç°äº†ä¸€ä¸ªéå¸¸æœ‰è¶£çš„è§‚ç‚¹ï¼šVivado HLSä¸ºLinuxç”Ÿæˆäº†ä¸€ä¸ªé©±åŠ¨ç¨‹åºï¼ˆè¯¥é©±åŠ¨ç¨‹åºåˆç›¸åº”åœ°é€šè¿‡procfsè¿›è¡Œäº†ä¿®æ”¹ï¼Œä»¥ä¿ç•™ç¼–å†™çš„é—ä¼ ä¿¡æ¯ï¼‰ã€‚ ä¸‹é¢æ˜¯ä¸ºLinuxç”Ÿæˆçš„ä»£ç çš„ç¤ºä¾‹ï¼ˆæºè§£å†³æ–¹æ¡ˆ1 â€‹â€‹/ impl / ip / drivers / name_xxx / src /çš„è·¯å¾„ï¼‰ã€‚ <br><br><img src="https://habrastorage.org/webt/ss/kd/rh/sskdrh3olokqp7miv9qm-ni1gnq.png"><br>  <i>HLSåˆæˆå’Œrtlä»£ç ç”Ÿæˆçš„é˜¶æ®µ</i> <br><br>  HLSæ•°æ®ç”Ÿæˆå™¨ï¼Œç”¨äºæ£€æŸ¥AXI_DMAçš„æ“ä½œï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;ap_axi_sdata.h&gt; #include &lt;hls_stream.h&gt; #define SIZE_STREAM 1024 struct axis { int tdata; bool tlast; }; void data_generation(axis outStream[SIZE_STREAM]) { #pragma HLS INTERFACE axis port=outStream int i = 0; do{ outStream[i].tdata = i; outStream[i].tlast = (i == (SIZE_STREAM - 1)) ? 1 : 0; i++; }while( i &lt; SIZE_STREAM); }</span></span></span></span></code> </pre> <br> è·å–æ¥å£æ¿ç‰ˆæœ¬å’Œç±»å‹çš„ç¤ºä¾‹ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdio.h&gt; void info( int &amp;aVersion, int &amp;bSubVersion, int &amp;cTypeBoard, int version, int subVersion, int typeBoard ){ #pragma HLS INTERFACE s_axilite port=aVersion #pragma HLS INTERFACE s_axilite port=bSubVersion #pragma HLS INTERFACE s_axilite port=cTypeBoard #pragma HLS INTERFACE ap_ctrl_none port=return aVersion = version; bSubVersion = subVersion; cTypeBoard = typeBoard; }</span></span></span></span></code> </pre> <br> æ‚¨å·²ç»æ³¨æ„åˆ°ï¼Œå¯¹äºhlsçš„å¼€å‘ï¼Œäº†è§£å„ç§ç¼–è¯‘æŒ‡ç¤ºï¼ˆHLSç¼–è¯‘æŒ‡ç¤ºï¼‰çš„å·¥ä½œå’Œåº”ç”¨éå¸¸é‡è¦ï¼Œå› ä¸ºåˆæˆè¿‡ç¨‹ç›´æ¥ä¸ç¼–è¯‘æŒ‡ç¤ºç›¸å…³ã€‚ <br><br> ç”Ÿæˆçš„s_axiliteé©±åŠ¨ç¨‹åºï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// ============================================================== // File generated by Vivado(TM) HLS - High-Level Synthesis from C, C++ and SystemC // Version: 2016.4 // Copyright (C) 1986-2016 Xilinx, Inc. All Rights Reserved. // // ============================================================== #ifdef __linux__ /***************************** Include Files *********************************/ #include "xinfo.h" /***************** Macros (Inline Functions) Definitions *********************/ #define MAX_UIO_PATH_SIZE 256 #define MAX_UIO_NAME_SIZE 64 #define MAX_UIO_MAPS 5 #define UIO_INVALID_ADDR 0 /**************************** Type Definitions ******************************/ typedef struct { u32 addr; u32 size; } XInfo_uio_map; typedef struct { int uio_fd; int uio_num; char name[ MAX_UIO_NAME_SIZE ]; char version[ MAX_UIO_NAME_SIZE ]; XInfo_uio_map maps[ MAX_UIO_MAPS ]; } XInfo_uio_info; /***************** Variable Definitions **************************************/ static XInfo_uio_info uio_info; /************************** Function Implementation *************************/ static int line_from_file(char* filename, char* linebuf) { char* s; int i; FILE* fp = fopen(filename, "r"); if (!fp) return -1; s = fgets(linebuf, MAX_UIO_NAME_SIZE, fp); fclose(fp); if (!s) return -2; for (i=0; (*s)&amp;&amp;(i&lt;MAX_UIO_NAME_SIZE); i++) { if (*s == '\n') *s = 0; s++; } return 0; } static int uio_info_read_name(XInfo_uio_info* info) { char file[ MAX_UIO_PATH_SIZE ]; sprintf(file, "/sys/class/uio/uio%d/name", info-&gt;uio_num); return line_from_file(file, info-&gt;name); } static int uio_info_read_version(XInfo_uio_info* info) { char file[ MAX_UIO_PATH_SIZE ]; sprintf(file, "/sys/class/uio/uio%d/version", info-&gt;uio_num); return line_from_file(file, info-&gt;version); } static int uio_info_read_map_addr(XInfo_uio_info* info, int n) { int ret; char file[ MAX_UIO_PATH_SIZE ]; info-&gt;maps[n].addr = UIO_INVALID_ADDR; sprintf(file, "/sys/class/uio/uio%d/maps/map%d/addr", info-&gt;uio_num, n); FILE* fp = fopen(file, "r"); if (!fp) return -1; ret = fscanf(fp, "0x%x", &amp;info-&gt;maps[n].addr); fclose(fp); if (ret &lt; 0) return -2; return 0; } static int uio_info_read_map_size(XInfo_uio_info* info, int n) { int ret; char file[ MAX_UIO_PATH_SIZE ]; sprintf(file, "/sys/class/uio/uio%d/maps/map%d/size", info-&gt;uio_num, n); FILE* fp = fopen(file, "r"); if (!fp) return -1; ret = fscanf(fp, "0x%x", &amp;info-&gt;maps[n].size); fclose(fp); if (ret &lt; 0) return -2; return 0; } int XInfo_Initialize(XInfo *InstancePtr, const char* InstanceName) { XInfo_uio_info *InfoPtr = &amp;uio_info; struct dirent **namelist; int i, n; char* s; char file[ MAX_UIO_PATH_SIZE ]; char name[ MAX_UIO_NAME_SIZE ]; int flag = 0; assert(InstancePtr != NULL); n = scandir("/sys/class/uio", &amp;namelist, 0, alphasort); if (n &lt; 0) return XST_DEVICE_NOT_FOUND; for (i = 0; i &lt; n; i++) { strcpy(file, "/sys/class/uio/"); strcat(file, namelist[i]-&gt;d_name); strcat(file, "/name"); if ((line_from_file(file, name) == 0) &amp;&amp; (strcmp(name, InstanceName) == 0)) { flag = 1; s = namelist[i]-&gt;d_name; s += 3; // "uio" InfoPtr-&gt;uio_num = atoi(s); break; } } if (flag == 0) return XST_DEVICE_NOT_FOUND; uio_info_read_name(InfoPtr); uio_info_read_version(InfoPtr); for (n = 0; n &lt; MAX_UIO_MAPS; ++n) { uio_info_read_map_addr(InfoPtr, n); uio_info_read_map_size(InfoPtr, n); } sprintf(file, "/dev/uio%d", InfoPtr-&gt;uio_num); if ((InfoPtr-&gt;uio_fd = open(file, O_RDWR)) &lt; 0) { return XST_OPEN_DEVICE_FAILED; } // </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">NOTE:</span></span></span><span class="hljs-comment"> slave interface 'Axilites' should be mapped to uioX/map0 InstancePtr-&gt;Axilites_BaseAddress = (u32)mmap(NULL, InfoPtr-&gt;maps[0].size, PROT_READ|PROT_WRITE, MAP_SHARED, InfoPtr-&gt;uio_fd, 0 * getpagesize()); assert(InstancePtr-&gt;Axilites_BaseAddress); InstancePtr-&gt;IsReady = XIL_COMPONENT_IS_READY; return XST_SUCCESS; } int XInfo_Release(XInfo *InstancePtr) { XInfo_uio_info *InfoPtr = &amp;uio_info; assert(InstancePtr != NULL); assert(InstancePtr-&gt;IsReady == XIL_COMPONENT_IS_READY); munmap((void*)InstancePtr-&gt;Axilites_BaseAddress, InfoPtr-&gt;maps[0].size); close(InfoPtr-&gt;uio_fd); return XST_SUCCESS; } #endif</span></span></code> </pre> <br> å‘Šè¯‰æ‚¨å˜é‡ï¼ˆå¯„å­˜å™¨ï¼‰åœ¨åœ°å€ç©ºé—´ä¸­çš„ä½ç½®çš„é‡è¦æ–‡ä»¶æ˜¯æ–‡ä»¶xï¼ƒyour_nameï¼ƒ_hw.hã€‚ æ‚¨å§‹ç»ˆå¯ä»¥ä½¿ç”¨devmemå·¥å…·æ¥éªŒè¯ä¹¦é¢ipå†…æ ¸çš„æ­£ç¡®æ€§ã€‚ <br><br> è¯¥æ–‡ä»¶çš„å†…å®¹ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// ============================================================== // File generated by Vivado(TM) HLS - High-Level Synthesis from C, C++ and SystemC // Version: 2016.4 // Copyright (C) 1986-2016 Xilinx, Inc. All Rights Reserved. // // ============================================================== // AXILiteS // 0x00 : reserved // 0x04 : reserved // 0x08 : reserved // 0x0c : reserved // 0x10 : Data signal of aVersion // bit 31~0 - aVersion[31:0] (Read) // 0x14 : Control signal of aVersion // bit 0 - aVersion_ap_vld (Read/COR) // others - reserved // 0x18 : Data signal of bSubVersion // bit 31~0 - bSubVersion[31:0] (Read) // 0x1c : Control signal of bSubVersion // bit 0 - bSubVersion_ap_vld (Read/COR) // others - reserved // 0x20 : Data signal of cTypeBoard // bit 31~0 - cTypeBoard[31:0] (Read) // 0x24 : Control signal of cTypeBoard // bit 0 - cTypeBoard_ap_vld (Read/COR) // others - reserved // (SC = Self Clear, COR = Clear on Read, TOW = Toggle on Write, COH = Clear on Handshake) #define XINFO_AXILITES_ADDR_AVERSION_DATA 0x10 #define XINFO_AXILITES_BITS_AVERSION_DATA 32 #define XINFO_AXILITES_ADDR_AVERSION_CTRL 0x14 #define XINFO_AXILITES_ADDR_BSUBVERSION_DATA 0x18 #define XINFO_AXILITES_BITS_BSUBVERSION_DATA 32 #define XINFO_AXILITES_ADDR_BSUBVERSION_CTRL 0x1c #define XINFO_AXILITES_ADDR_CTYPEBOARD_DATA 0x20 #define XINFO_AXILITES_BITS_CTYPEBOARD_DATA 32 #define XINFO_AXILITES_ADDR_CTYPEBOARD_CTRL 0x24</span></span></code> </pre><br> è¯¥æ–‡ä»¶æè¿°äº†å¯„å­˜å™¨çš„åœ°å€ï¼Œè¿™äº›å¯„å­˜å™¨ä¸å‡½æ•°ä¸­å‚æ•°çš„ä½ç½®ç›¸å¯¹åº”ã€‚ é¡¹ç›®ç»¼åˆåï¼Œæ‚¨å¯ä»¥çœ‹åˆ°å¦‚ä½•ä»¥å‘¨æœŸæ–¹å¼æ‰§è¡Œåˆ›å»ºçš„é¡¹ç›®ã€‚ <br><br><img src="https://habrastorage.org/webt/lj/jw/na/ljjwnalfpfgcsi4yindklhqvowe.png"><br>  <i>é¡¹ç›®èŠ‚æ‹ç¤ºä¾‹</i> <br><br> ä¸hlsçš„åˆä½œè¡¨æ˜ï¼Œè¯¥å·¥å…·é€‚ç”¨äºå¿«é€Ÿè§£å†³ä»»åŠ¡ï¼Œå°¤å…¶æ˜¯å®ƒå·²ç»è¯æ˜å¯ä»¥è§£å†³è®¡ç®—æœºè§†è§‰çš„æ•°å­¦é—®é¢˜ï¼Œå¯ä»¥è½»æ¾åœ°ç”¨C ++æˆ–Cæè¿°ï¼Œä»¥åŠåˆ›å»ºç”¨äºäº¤äº’å’Œäº¤æ¢çš„å°å‹ipå†…æ ¸ã€‚æ ‡å‡†FPGAæ¥å£æä¾›çš„ä¿¡æ¯ã€‚ <br><br> åŒæ—¶ï¼ŒHLSä¸é€‚åˆå®ç°ç‰¹å®šçš„ç¡¬ä»¶æ¥å£ï¼Œä¾‹å¦‚ï¼Œåœ¨æˆ‘ä»¬çš„æƒ…å†µä¸‹ä¸ºI2Sï¼Œå¹¶ä¸”ç”Ÿæˆçš„rtlä»£ç åœ¨FPGAä¸Šçš„å ç”¨ç©ºé—´æ¯”ç”¨æ ‡å‡†hdlè¯­è¨€ç¼–å†™çš„è¦å¤šã€‚ <br><br> é©±åŠ¨ç¨‹åºæµ‹è¯•çš„æœ€åä¸€æ­¥æ˜¯å¼€å‘I2Sæµé‡ç”Ÿæˆå™¨ã€‚ è¯¥ipå†…æ ¸é‡å¤äº†ä»¥å‰ipå†…æ ¸çš„åŠŸèƒ½ï¼Œé™¤äº†å®ƒä¼šç”Ÿæˆä¸TDMæ¨¡å¼ä¸‹çš„å®é™…I2Sæ•°æ®ç›¸å¯¹åº”çš„å¢é‡æ•°æ®ï¼ˆæµé‡ï¼‰ã€‚ <br><br><img src="https://habrastorage.org/webt/vc/81/xz/vc81xzbieylxtzhrp6lz-psikva.png"><br>  <i>æœªæ¥å®šåˆ¶I2Sæ ¸å¿ƒæµ‹è¯•å’ŒI2Sæµé‡ç”Ÿæˆå™¨çš„æ¨¡å—è®¾è®¡</i> <br><br> ç»“æœï¼Œæˆ‘ä»¬å¾—åˆ°äº†hlsï¼Œaxi dmaå’Œs_axiliteçš„ç»“æœï¼Œæ£€æŸ¥äº†æˆ‘ä»¬çš„è½¯ä»¶å’Œé©±åŠ¨ç¨‹åºçš„æ€§èƒ½ã€‚ <br><br><h2> ç»“è®º </h2><br> æˆ‘ä»¬è®¾æ³•å¼€å‘äº†å¿…è¦ç±»å‹çš„æ¥å£å¡ï¼Œä»¥åŠç”¨äºtdmï¼Œpriå’Œbriçš„ipå†…æ ¸ã€‚ æˆ‘ä»¬å·²å¤§å¤§æ”¹è¿›äº†å½“å‰å¼€å‘æ­¤ç±»è®¾å¤‡çš„æ–¹æ³•ï¼Œå¹¶åˆ›å»ºäº†ä¸€ä¸ªå…¨é¢çš„è§£å†³æ–¹æ¡ˆï¼Œå¯ä»¥ä¸<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Asterick</a> ï¼Œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">patton</a>ç­‰å…¬å¸çš„ç±»ä¼¼æ¥å£æ¿ç«äº‰ã€‚ æˆ‘ä»¬è§£å†³æ–¹æ¡ˆçš„ä¼˜åŠ¿åœ¨äºï¼Œå¼€å‘äººå‘˜ä¸éœ€è¦PCå’ŒPCIä¹‹é—´çš„ä¸­é—´é“¾æ¥å³å¯è¿›è¡Œæ•°æ®ä¼ è¾“ï¼Œä»–å°†èƒ½å¤Ÿé€šè¿‡ä»¥å¤ªç½‘ç›´æ¥ä¼ è¾“æ¥æ”¶åˆ°çš„ä¿¡æ¯ã€‚ </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN415435/">https://habr.com/ru/post/zh-CN415435/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN415423/index.html">å…¬é’¥åŸºç¡€ç»“æ„ï¼šåŸºäºOpenSSLå’ŒSQLite3å®ç”¨ç¨‹åºçš„è¯ä¹¦é¢å‘æœºæ„ï¼ˆPostcryptumï¼‰</a></li>
<li><a href="../zh-CN415427/index.html">æ¥è‡ªColin Wallsçš„å…³äºRTOSçš„å…¨éƒ¨çœŸç›¸ã€‚ ç¬¬4æ¡ ä»»åŠ¡ï¼Œä¸Šä¸‹æ–‡åˆ‡æ¢å’Œä¸­æ–­</a></li>
<li><a href="../zh-CN415429/index.html">æ¥è‡ªColin Wallsçš„å…³äºRTOSçš„å…¨éƒ¨çœŸç›¸ã€‚ ç¬¬5æ¡ ä»»åŠ¡äº¤äº’å’ŒåŒæ­¥</a></li>
<li><a href="../zh-CN415431/index.html">Hackathonå…¬å‘ŠSmartMail Hack 2ï¼šæ•°æ®è°ƒç”¨</a></li>
<li><a href="../zh-CN415433/index.html">ç®¡ç†æœ‰å…³GISä½æˆ¿å’Œå…¬å…±æœåŠ¡çš„å‘å¸ƒ-æˆ‘ä»¬åˆ†äº«ç»éªŒå¹¶å‡­ç›´è§‰è¿›è¡Œæ–—äº‰</a></li>
<li><a href="../zh-CN415437/index.html">å¦‚ä½•åœ¨äº§å“ä¸­æ¨å‡ºMLï¼šæˆ‘ä»¬è¸©äº†å…­æŠŠè€™å­</a></li>
<li><a href="../zh-CN415439/index.html">å…¬å¸æ²Ÿé€šä¼šè¿«ä½¿æ‚¨è¾èŒè¿˜æ˜¯å°†æ‚¨æ‹–å…¥æ¸¸æˆä¹‹ç±»çš„é¡¹ç›®ä¸­ï¼Ÿ</a></li>
<li><a href="../zh-CN415441/index.html">åœ¨ç¾å›½ï¼Œå¯¹æ”¿åºœæœºæ„çš„å‹’ç´¢è½¯ä»¶æ”»å‡»è¶Šæ¥è¶Šå¤š</a></li>
<li><a href="../zh-CN415443/index.html">MDGå’ŒITMOå¤§å­¦é‚€è¯·å‚åŠ æœºå™¨å­¦ä¹ æš‘æœŸå­¦æ ¡</a></li>
<li><a href="../zh-CN415445/index.html">2018å¹´7æœˆITé¢†åŸŸäººåŠ›èµ„æºä¸“ä¸šäººå‘˜çš„äº‹ä»¶æ‘˜è¦</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>