<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üôÄ üëêüèª üôÖüèª Crie seu pr√≥prio controlador de jogo üò´ üç† ‚è±Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Fonte de inspira√ß√£o 
 Nas exposi√ß√µes de jogos, os desenvolvedores do Objects in Space mostraram uma demonstra√ß√£o de seu jogo com um controlador no coc...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Crie seu pr√≥prio controlador de jogo</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/442816/"><h2>  Fonte de inspira√ß√£o </h2><br>  Nas exposi√ß√µes de jogos, os desenvolvedores do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="external nofollow">Objects in Space</a> mostraram uma demonstra√ß√£o de seu jogo com um controlador no cockpit de uma enorme nave espacial.  Foi complementado por bot√µes iluminados, dispositivos anal√≥gicos, indicadores de status, interruptores, etc. ... Isso afeta muito a imers√£o no jogo: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e96/44d/1ad/e9644d1ad417a9a97f888feea64d0e8a.jpg"></div><br>  Um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="external nofollow">tutorial do Arduino foi</a> publicado no site do jogo com uma descri√ß√£o do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="external nofollow">protocolo de comunica√ß√£o</a> para esses controladores. <br><br>  <strong>Eu quero criar o mesmo para o meu jogo</strong> <br><br>  Neste exemplo, gastarei cerca de US $ 40 para adicionar switches bonitos, grandes e pesados ‚Äã‚Äãao cockpit de um simulador de corrida.  Os principais custos est√£o associados a essas op√ß√µes - se eu usasse op√ß√µes / bot√µes simples, o pre√ßo seria metade do valor!  Este √© um equipamento real que pode suportar 240 watts de pot√™ncia, e eu os deixarei absorver apenas 0,03 watts. <br><br>  Aviso: decidi economizar dinheiro, por isso deixo um link para um site chin√™s barato, onde compro v√°rios componentes / ferramentas diferentes.  Uma das desvantagens de comprar componentes baratos √© que eles geralmente n√£o possuem documenta√ß√£o, portanto, neste artigo, resolverei esse problema. <br><a name="habracut"></a><br><h2>  Componentes principais </h2><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="external nofollow">Arduino Mega2560</a> - $ 9 <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="external nofollow">Ignition Switch Racing Panel</a> - $ 26 <br></li><li>  Um monte de fios de conex√£o ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="external nofollow">"macho para macho"</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="external nofollow">"macho para f√™mea"</a> etc.) - $ 2 </li></ul><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f5c/e18/fb6/f5ce18fb6e69f6d2dd322d5295a8c7db.jpg"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c43/2d0/b89/c432d0b89b271194d7e3c72a96f4a458.jpg"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/454/485/de1/454485de13be106ba6733352efa8c249.jpg"></div><br><h2>  Ferramentas em destaque </h2><br><ul><li>  Ferro de soldar ( <em>vale a pena escolher um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">bom</a> , mas tamb√©m √© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">barato</a> lidar com o trabalho</em> ) </li><li>  Solda ( <em><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">com resina 60/40</a> - √© f√°cil trabalhar com ela, embora seja prejudicial ao meio ambiente</em> ). <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Tubula√ß√£o termoencolh√≠vel</a> ( <em>e secador de cabelo industrial, secador de cabelo ou isqueiro</em> ) ou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">fita isolante</a> <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Pistola de cola</a> ( <em>e varetas</em> ), ou algum tipo de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ep√≥xi</a> <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Mult√≠metro</a> <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Pin√ßas / alicates para descascar os fios</a> ou apenas tesouras, se voc√™ precisar economizar dinheiro. </li></ul><br><h2>  De software </h2><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="external nofollow">Arduino IDE</a> para programar o processador Arduino </li><li>  Para criar um controlador que aparece como um controlador / joystick USB de hardware real: <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="external nofollow">FLIP</a> para piscar novo firmware no controlador USB do Arduino </li><li>  Biblioteca <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="external nofollow">Arduino-usb</a> no github </li></ul></li><li>  Para criar um controlador com o qual o jogo se comunica diretamente ( <em>ou que apare√ßa como um controlador / joystick USB virtual</em> ) <ul><li>  Minha biblioteca <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="external nofollow">ois_protocol</a> no github <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="external nofollow">Driver VJoy,</a> se voc√™ quiser usar o controlador como um controlador / joystick USB virtual. </li></ul></li></ul><br><h2>  Advert√™ncia </h2><br>  Estudei eletr√¥nica no ensino m√©dio, aprendi a usar um ferro de soldar, aprendi que os fios vermelhos precisam ser conectados ao vermelho e do preto ao preto ... Volts, amperes, resist√™ncia e as equa√ß√µes que os conectam - isso foi tudo que esgotou meu treinamento formal em eletr√¥nica. <br><br>  Para mim, foi um projeto de treinamento, por isso pode ter maus conselhos ou erros! <br><br><h1>  Parte 1. Montando o Controlador! </h1><br><h2>  Trabalhamos com switches sem documenta√ß√£o ... </h2><br>  Como mencionado acima, compro pe√ßas baratas de um revendedor de baixa margem; portanto, a primeira coisa a fazer √© descobrir como esses interruptores / bot√µes funcionam. <br><br><h3>  Bot√£o simples / interruptor </h3><br>  Com o bot√£o, tudo √© simples - n√£o h√° LEDs e apenas dois contatos.  Coloque o mult√≠metro no modo de continuidade / discagem ( <img src="https://habrastorage.org/getpro/habr/post_images/628/15d/e9f/62815de9fa4516b533fa2a44197455da.gif">  ) e toque nas sondas de contatos diferentes - OL (circuito aberto, circuito aberto) ser√° exibido na tela: isso significa que n√£o h√° conex√£o entre as duas sondas.  Em seguida, pressionamos o bot√£o, ainda tocando as sondas de contato - algo como 0,1Œ© agora deve ser exibido na tela e o mult√≠metro emitir√° um bipe ( <em>informando que h√° uma resist√™ncia muito baixa entre as sondas - um circuito fechado</em> ). <br><br>  Agora sabemos que, quando o bot√£o √© pressionado, o circuito fecha e, quando pressionado, ele se abre.  No diagrama, isso pode ser descrito como uma op√ß√£o simples: <img src="https://habrastorage.org/getpro/habr/post_images/ff1/078/8d9/ff10788d996450509595baba45cad58e.png"><br><br><h2>  Conectamos o switch ao Arduino </h2><br>  Encontre dois pinos na placa do Arduino: GND e ‚Äú2‚Äù (ou qualquer outro n√∫mero arbitr√°rio - esses s√£o pinos de E / S de uso geral que podemos controlar atrav√©s do software). <br><br>  Se conectarmos o comutador dessa maneira e solicitarmos ao Arduino que configure o pino ‚Äú2‚Äù como o pino de ENTRADA, obteremos o circuito mostrado √† esquerda (na figura abaixo).  Quando o bot√£o √© pressionado, o pino 2 ser√° conectado diretamente ao terra / 0V e, quando pressionado, o pino 2 n√£o ser√° conectado a nada.  Esse estado ( <em>n√£o conectado a nada</em> ) √© chamado de "flutuante" (estado de alta imped√¢ncia) e, infelizmente, n√£o √© uma condi√ß√£o muito boa para nossos prop√≥sitos.  Quando lemos dados de um contato no software ( <em>usando digitalRead (2)</em> ), obtemos BAIXO se o contato estiver aterrado e um resultado imprevis√≠vel (BAIXO ou ALTO) se o contato estiver flutuando! <br><br>  Para corrigir isso, podemos configurar o contato para estar no modo INPUT_PULLUP, que se conecta ao resistor dentro do processador e cria o circuito mostrado √† direita.  Neste circuito, com o interruptor aberto, o pino 2 tem um caminho de + 5V, portanto, quando for lido, o resultado ser√° sempre ALTO.  Quando o comutador estiver fechado, o contato ainda ter√° um caminho com alta resist√™ncia a + 5V, assim como um caminho sem resist√™ncia ao terra / 0V, que ‚Äúvence‚Äù, portanto, quando lemos o contato, obtemos um BAIXO. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/450/a26/fa9/450a26fa93dae881e4f2aca3f68d52ad.png"></div><br>  Para desenvolvedores de software, a ordem pode parecer invertida - quando clicamos no bot√£o, lemos false / LOW e, quando pressionados, lemos true / HIGH. <br><br>  Voc√™ pode fazer o oposto, mas o processador possui apenas resistores de pull-up integrados e n√£o h√° resistores de pull-down, portanto, manteremos esse modelo. <br><br>  O programa mais simples para o Arduino, que l√™ o status do comutador e informa ao PC sobre seu status, se parece com o mostrado abaixo.  Voc√™ pode clicar no bot√£o de download no IDE do Arduino e abrir o Serial Monitor (no menu Ferramentas) para ver os resultados. <br><br><pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ Serial.begin(<span class="hljs-number"><span class="hljs-number">9600</span></span>); pinMode(<span class="hljs-number"><span class="hljs-number">2</span></span>, INPUT_PULLUP); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> state = digitalRead(pin); Serial.println( state == HIGH ? <span class="hljs-string"><span class="hljs-string">"Released"</span></span> : <span class="hljs-string"><span class="hljs-string">"Pressed"</span></span> ); delay(<span class="hljs-number"><span class="hljs-number">100</span></span>);<span class="hljs-comment"><span class="hljs-comment">//artifically reduce the loop rate so the output is at a human readable rate... }</span></span></code> </pre> <br><h2>  Outros switches quase sem documenta√ß√£o ... </h2><br><h3>  Interruptor LED de tr√™s pinos </h3><br>  Felizmente, nos principais comutadores do meu painel, existem marcas de tr√™s contatos: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/43a/9c1/8e7/43a9c18e7e7c13e8ce02744fe8320bb6.jpg"></div><br>  N√£o tenho certeza de como ele funciona, portanto, voltaremos ao mult√≠metro para o modo cont√≠nuo e tocaremos em todos os pares de contatos quando o interruptor for ligado e desligado ... no entanto, desta vez, o mult√≠metro n√£o emitir√° um bipe quando tocarmos nas sondas [GND] e [+] com " ligue!  A √∫nica configura√ß√£o na qual o mult√≠metro emite <em>um</em> bipe ( <em>detecta uma conex√£o</em> ) √© quando o interruptor est√° ‚Äúligado‚Äù e as pontas de prova est√£o acesas [+] e [l√¢mpada]. <br><br>  O LED dentro do comutador bloqueia as medi√ß√µes de continuidade; portanto, a partir dos testes acima, podemos assumir que o LED est√° conectado diretamente ao pino [GND] e n√£o aos contatos [+] e [lamp].  Em seguida, mudaremos o mult√≠metro para o modo de teste de diodo (s√≠mbolo <img src="https://habrastorage.org/getpro/habr/post_images/aa4/e65/abe/aa4e65abeb894a55aa7074cbb67543aa.jpg">  ) e verifique o par de contatos novamente, mas desta vez a polaridade √© importante ( <em>sonda vermelha e preta</em> ).  Agora, se conectarmos a sonda vermelha a [lamp] e a preta a [GND], o LED acender√° e 2,25 V ser√£o exibidos no mult√≠metro.  Esta √© a tens√£o direta do diodo ou a tens√£o m√≠nima necess√°ria para lig√°-lo.  Independentemente da posi√ß√£o do interruptor, 2,25 V de [l√¢mpada] a [GND] acende o LED.  Se conectarmos a sonda vermelha a [+] e a preta a [GND], o LED acender√° apenas quando a chave estiver ligada. <br><br>  A partir dessas leituras, podemos assumir que o interior dessa op√ß√£o se parece com o diagrama abaixo: <br><br><ol><li>  [+] e [l√¢mpada] ficam em curto-circuito quando o interruptor est√° ligado / fechado. <br></li><li>  Uma voltagem positiva de [l√¢mpada] a [GND] sempre acende o LED. <br></li><li>  Uma tens√£o positiva de [+] a [GND] acende o LED somente quando o interruptor est√° ligado / fechado. </li></ol><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bd6/34a/728/bd634a728856e82e71eecafa5d42d8a4.png"></div><br>  Honestamente, s√≥ podemos adivinhar a presen√ßa de um resistor.  O LED <strong>deve</strong> estar conectado ao resistor apropriado para limitar a corrente fornecida, ou queimar√°.  O meu n√£o se esgotou e parece que est√° funcionando corretamente.  No f√≥rum do site do vendedor, eu encontrei um post que fala sobre um resistor instalado suportando at√© 12 V, e isso me poupou tempo na verifica√ß√£o / c√°lculo de um resistor adequado. <br><br><h3>  Conectamos o switch ao Arduino </h3><br>  A maneira mais f√°cil √© usar o comutador com o Arduino, ignorando o pino [lamp]: conecte [GND] ao GND no Arduino e conecte [+] a um dos contatos numerados do Arduino, por exemplo 3. <br><br>  Se configurarmos o pino 3 como INPUT_PULLUP ( <em>igual ao bot√£o anterior</em> ), obteremos o resultado mostrado abaixo.  O canto superior esquerdo mostra o valor que receberemos executando ‚ÄúdigitalRead (3)‚Äù no c√≥digo do Arduino. <br><br>  Quando o interruptor est√° ligado / fechado, lemos LOW e o LED acende!  Para usar esse comutador nessa configura√ß√£o, podemos usar o mesmo c√≥digo do Arduino que no exemplo do bot√£o. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fd5/cc5/8ba/fd5cc58ba50f376abbd42806718b0f92.png"></div><br><h3>  Problemas desta solu√ß√£o </h3><br>  Ap√≥s conectar-se ao Arduino, o circuito completo fica assim: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/92c/305/f91/92c305f91bf0cf6fac213e2eba1db65e.png"></div><br>  No entanto, aqui podemos ver que quando o interruptor √© fechado, al√©m do pequeno resistor limitador de corrente na frente do LED (suponho que sua resist√™ncia seja 100 Ohms), tamb√©m h√° um resistor de pull up de 20 kOhm, o que reduz ainda mais a quantidade de corrente que flui atrav√©s do LED.  Isso significa que, embora o circuito funcione, o LED n√£o ficar√° muito claro. <br><br>  Outra desvantagem desse esquema √© que n√£o temos controle de software sobre o LED - ele √© ativado quando o comutador est√° ligado e desativado no caso oposto. <br><br>  Voc√™ pode ver o que acontece se conectarmos o pino [l√¢mpada] a 0V ou + 5V. <br><br>  Se a [l√¢mpada] estiver conectada a 0V, o LED estar√° constantemente apagado ( <em>independentemente da posi√ß√£o do interruptor</em> ) e o reconhecimento da posi√ß√£o do Arduino ainda ser√° realizado.  Isso nos permite desativar programaticamente o LED! <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a55/de7/6d3/a55de76d395358050d3c96139e47df73.png"></div><br>  Se a [l√¢mpada] estiver conectada a + 5V, o LED estar√° constantemente aceso ( <em>independentemente da posi√ß√£o da chave</em> ), <strong>no entanto, o</strong> reconhecimento da posi√ß√£o do Arduino ser√° interrompido - HIGH sempre ser√° lido a partir do contato. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/310/ea5/4a8/310ea54a861f7f89bc624261abd71ce5.png"></div><br><h3>  Conectamos esse switch ao Arduino corretamente </h3><br>  Podemos superar as limita√ß√µes descritas acima ( <em>baixa corrente / brilho do LED e a falta de controle do programa sobre o LED</em> ) escrevendo mais c√≥digo!  Para resolver o conflito entre a capacidade de controlar o LED e o reconhecimento de posi√ß√£o que foi quebrado devido a ele, podemos separar as duas tarefas no tempo, ou seja, desligar temporariamente o LED ao ler o contato do sensor (3). <br><br>  Primeiro, conecte o pino [l√¢mpada] a outro pino Arduino de uso geral, por exemplo, a 4 para que voc√™ possa controlar a l√¢mpada. <br><br>  Para criar um programa que leia corretamente a posi√ß√£o do comutador e controle o LED (faremos piscar), basta desligar o LED antes de ler o status do comutador.  O LED se apaga apenas uma fra√ß√£o de milissegundo, portanto o tremula√ß√£o n√£o deve ser percept√≠vel: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> pinSwitch = <span class="hljs-number"><span class="hljs-number">3</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> pinLed = <span class="hljs-number"><span class="hljs-number">4</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//connect to the PC Serial.begin(9600); //connect our switch's [+] connector to a digital sensor, and to +5V through a large resistor pinMode(pinSwitch, INPUT_PULLUP); //connect our switch's [lamp] connector to 0V or +5V directly pinMode(pinLed, OUTPUT); } void loop() { int lampOn = (millis()&gt;&gt;8)&amp;1;//make a variable that alternates between 0 and 1 over time digitalWrite(pinLed, LOW);//connect our [lamp] to +0V so the read is clean int state = digitalRead(pinSwitch); if( lampOn ) digitalWrite(pinLed, HIGH);//connect our [lamp] to +5V Serial.println(state);//report the switch state to the PC }</span></span></code> </pre> <br>  No Arduino Mega, os pinos 2-13 e 44-46 podem usar a fun√ß√£o analogWrite, que na verdade n√£o gera tens√£o de 0V a + 5V, mas a aproxima usando uma onda quadrada.  Se desejar, voc√™ pode us√°-lo para controlar o brilho do LED!  Este c√≥digo far√° a luz pulsar, n√£o apenas piscar: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> lampState = (millis()&gt;&gt;<span class="hljs-number"><span class="hljs-number">1</span></span>)&amp;<span class="hljs-number"><span class="hljs-number">0xFF</span></span>;<span class="hljs-comment"><span class="hljs-comment">//make a variable that alternates between 0 and 255 over time digitalWrite(pinLed, LOW);//connect our [lamp] to +0V so the read is clean int state = digitalRead(pinSwitch); if( lampState &gt; 0 ) analogWrite(pinLed, lampState); }</span></span></code> </pre> <br><h2>  Dicas de montagem </h2><br>  A postagem j√° √© muito grande, ent√£o n√£o adicionarei o tutorial de solda, voc√™ pode pesquisar no Google! <br><br>  No entanto, darei as dicas mais b√°sicas: <br><br><ul><li>  Ao conectar fios com contatos de metal grandes, primeiro verifique se o ferro de solda est√° quente e aque√ßa o contato de metal por um tempo.  O significado da solda √© formar uma junta permanente criando uma liga, mas se apenas uma parte da junta estiver quente, √© poss√≠vel obter facilmente uma ‚Äújunta fria‚Äù que se parece com uma junta, mas na verdade n√£o est√° conectada. <br></li><li>  Ao conectar os dois fios, <i>primeiro</i> coloque um deles em um tubo termo-retr√°til - ap√≥s a conex√£o, o tubo n√£o pode ser colocado.  Isso parece √≥bvio, mas sempre o esque√ßo e preciso usar fita isolante em vez do tubo ... Puxe o tubo de contra√ß√£o da conex√£o para que n√£o aque√ßa antes do tempo.  Depois de verificar a conex√£o soldada, deslize o tubo e aque√ßa-o. <br></li><li>  Os pequenos e finos fios de conex√£o que mencionei no in√≠cio s√£o adequados para conex√µes sem solda (por exemplo, quando conectados a um Arduino!), Mas bastante fr√°geis.  Ap√≥s a solda, use uma pistola de cola para corrigi-los e remover todas as tens√µes da pr√≥pria conex√£o.  Por exemplo, os fios vermelhos na figura abaixo podem ser puxados acidentalmente durante a opera√ß√£o; portanto, ap√≥s a solda, fixei-os com uma gota de cola quente: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a0d/fa0/1d4/a0dfa01d48145b489d680cc6e7f43bc8.jpg"></div></li></ul><br><h1>  Parte 2. Transformamos o dispositivo em um controlador de jogo! </h1><br>  Para que o sistema operacional reconhe√ßa o dispositivo como um controlador de jogos USB, voc√™ precisa de um c√≥digo bastante simples, mas, infelizmente, tamb√©m precisa substituir o firmware do chip USB do Arduino por outro, que pode ser obtido aqui: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="external nofollow">https://github.com/harlequin-tech/arduino-usb</a> . <br><br>  Por√©m, ap√≥s o upload deste firmware para o Arduino, o dispositivo se torna um joystick USB e deixa de ser Arduino.  Portanto, para reprogram√°-lo, √© necess√°rio atualizar novamente o firmware original do Arduino.  Essas itera√ß√µes s√£o bastante dolorosas - carregue o c√≥digo do Arduino, atualize o firmware do joystick, teste, atualize o firmware do arduino, repita ... <br><br>  Um exemplo de programa para o Arduino que pode ser usado com este firmware √© mostrado abaixo - ele configura os tr√™s bot√µes como entradas, l√™ seus valores, copia os valores para a estrutura de dados esperada por esse firmware e envia os dados.  Lave, sabonete, repita. <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// define DEBUG if you want to inspect the output in the Serial Monitor // don't define DEBUG if you're ready to use the custom firmware #define DEBUG //Say we've got three buttons, connected to GND and pins 2/3/4 int pinButton1 = 2; int pinButton2 = 3; int pinButton3 = 4; void setup() { //configure our button's pins properly pinMode(pinButton1, INPUT_PULLUP); pinMode(pinButton2, INPUT_PULLUP); pinMode(pinButton3, INPUT_PULLUP); #if defined DEBUG Serial.begin(9600); #else Serial.begin(115200);//The data rate expected by the custom USB firmware delay(200); #endif } //The structure expected by the custom USB firmware #define NUM_BUTTONS 40 #define NUM_AXES 8 // 8 axes, X, Y, Z, etc typedef struct joyReport_t { int16_t axis[NUM_AXES]; uint8_t button[(NUM_BUTTONS+7)/8]; // 8 buttons per byte } joyReport_t; void sendJoyReport(struct joyReport_t *report) { #ifndef DEBUG Serial.write((uint8_t *)report, sizeof(joyReport_t));//send our data to the custom USB firmware #else // dump human readable output for debugging for (uint8_t ind=0; ind&lt;NUM_AXES; ind++) { Serial.print("axis["); Serial.print(ind); Serial.print("]= "); Serial.print(report-&gt;axis[ind]); Serial.print(" "); } Serial.println(); for (uint8_t ind=0; ind&lt;NUM_BUTTONS/8; ind++) { Serial.print("button["); Serial.print(ind); Serial.print("]= "); Serial.print(report-&gt;button[ind], HEX); Serial.print(" "); } Serial.println(); #endif } joyReport_t joyReport = {}; void loop() { //check if our buttons are pressed: bool button1 = LOW == digitalRead( pinButton1 ); bool button2 = LOW == digitalRead( pinButton2 ); bool button3 = LOW == digitalRead( pinButton3 ); //write the data into the structure joyReport.button[0] = (button1?0x01:0) | (button2?0x02:0) | (button3?0x03:0); //send it to the firmware sendJoyReport(joyReport) }</span></span></code> </pre> <br><h1>  Parte 3. N√≥s integramos o dispositivo ao nosso pr√≥prio jogo! </h1><br>  Se voc√™ tem controle sobre o jogo com o qual o dispositivo deve interagir, como alternativa, voc√™ pode se comunicar diretamente com o controlador - n√£o h√° necessidade de torn√°-lo vis√≠vel para o sistema operacional como um joystick!  No come√ßo do post, mencionei Objects In Space;  essa √© a abordagem usada pelos desenvolvedores.  Eles criaram um protocolo de comunica√ß√£o ASCII simples que permite que o controlador e o jogo se comuniquem.  Simplesmente liste as portas seriais do sistema ( <em>s√£o portas COM no Windows; a prop√≥sito, <a href="" rel="external nofollow">veja o qu√£o horr√≠vel √© em C</a></em> ), encontre a porta √† qual o dispositivo chamado ‚ÄúArduino‚Äù est√° conectado e comece a ler / gravar ASCII nesse link. <br><br>  No lado do Arduino, usamos apenas as fun√ß√µes Serial.print que foram usadas nos exemplos acima. <br><br>  No in√≠cio deste post, tamb√©m mencionei minha biblioteca para resolver esse problema: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="external nofollow">https://github.com/hodgman/ois_protocol</a> . <br><br>  Ele cont√©m c√≥digo C ++ que pode ser integrado ao jogo e usado como um "servidor" e c√≥digo Arduino que pode ser executado no controlador para us√°-lo como um "cliente". <br><br><h2>  Personalizar Arduino </h2><br>  Em <a href="" rel="external nofollow">example_hardware.h,</a> criei classes para abstrair bot√µes / bot√µes de op√ß√£o individuais;  por exemplo, ‚ÄúSwitch‚Äù √© um bot√£o simples do primeiro exemplo. e ‚ÄúLedSwitch2Pin‚Äù √© um switch com um LED controlado do segundo exemplo. <br><br>  O c√≥digo de exemplo para minha barra de bot√µes est√° em <a href="" rel="external nofollow">example.ino</a> . <br><br>  Como um pequeno exemplo, digamos que temos um √∫nico bot√£o que precisa ser enviado ao jogo e um LED controlado pelo jogo.  O c√≥digo necess√°rio do Arduino se parece com o seguinte: <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"ois_protocol.h"</span></span></span><span class="hljs-meta"> </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//instantiate the library OisState ois; //inputs are values that the game will send to the controller struct { OisNumericInput myLedInput{"Lamp", Number}; } inputs; //outputs are values the controller will send to the game struct { OisNumericOutput myButtonOutput{"Button", Boolean}; } outputs; //commands are named events that the controller will send to the game struct { OisCommand quitCommand{"Quit"}; } commands; int pinButton = 2; int pinLed = 3; void setup() { ois_setup_structs(ois, "My Controller", 1337, 42, commands, inputs, outputs); pinMode(pinButton, INPUT_PULLUP); pinMode(pinLed, OUTPUT); } void loop() { //read our button, send it to the game: bool buttonPressed = LOW == digitalRead(pin); ois_set(ois, outputs.myButtonOutput, buttonPressed); //read the LED value from the game, write it to the LED pin: analogWrite(pinLed, inputs.myLedInput.value); //example command / event: if( millis() &gt; 60 * 1000 )//if 60 seconds has passed, tell the game to quit ois_execute(ois, commands.quitCommand); //run the library code (communicates with the game) ois_loop(ois); }</span></span></span></span></code> </pre> <br><h2>  Personalize o jogo </h2><br>  O c√≥digo do jogo √© escrito no estilo de "cabe√ßalho √∫nico".  Para importar a biblioteca, inclua <a href="" rel="external nofollow">oisdevice.h</a> no jogo. <br><br>  No arquivo CPP √∫nico, antes de executar o cabe√ßalho #include, escreva #define OIS_DEVICE_IMPL e #define OIS_SERIALPORT_IMPL - isso adicionar√° o c√≥digo-fonte das classes ao arquivo CPP.  Se voc√™ possui suas pr√≥prias instru√ß√µes, log, seq√º√™ncias de caracteres ou vetores, existem v√°rias outras macros OIS_ * que voc√™ pode definir antes de importar o cabe√ßalho para aproveitar os recursos do mecanismo. <br><br>  Para listar portas COM e criar uma conex√£o com um dispositivo espec√≠fico, voc√™ pode usar o seguinte c√≥digo: <br><br><pre> <code class="cpp hljs">OIS_PORT_LIST portList; OIS_STRING_BUILDER sb; SerialPort::EnumerateSerialPorts(portList, sb, <span class="hljs-number"><span class="hljs-number">-1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> it = portList.begin(); it != portList.end(); ++it ) { <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> label = it-&gt;name + <span class="hljs-string"><span class="hljs-string">'('</span></span> + it-&gt;path + <span class="hljs-string"><span class="hljs-string">')'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( <span class="hljs-comment"><span class="hljs-comment">/*device selection choice*/</span></span> ) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> gameVersion = <span class="hljs-number"><span class="hljs-number">1</span></span>; OisDevice* device = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OisDevice(it-&gt;id, it-&gt;path, it-&gt;name, gameVersion, <span class="hljs-string"><span class="hljs-string">"Game Title"</span></span>); ... } }</code> </pre> <br>  Ap√≥s receber uma inst√¢ncia do OisDevice, voc√™ precisa chamar regularmente sua fun√ß√£o de membro Poll (por exemplo, em cada quadro), pode obter o estado atual da sa√≠da do controlador usando DeviceOutputs (), usar eventos do dispositivo usando PopEvents () e enviar valores para o dispositivo usando SetInput (). <br><br>  Um exemplo de aplicativo que faz tudo isso pode ser encontrado aqui: <a href="" rel="external nofollow">example_ois2vjoy / main.cpp</a> . <br><br><h1>  Parte 4. E se eu quiser as partes 2 e 3 ao mesmo tempo? </h1><br>  Para que o controlador funcione em outros jogos (parte 2), voc√™ precisa instalar seu pr√≥prio firmware e um programa Arduino, mas para que o controlador seja totalmente programado pelo jogo, usamos o firmware padr√£o do Arduino e outro programa do Arduino.  Mas e se quisermos ter as duas possibilidades ao mesmo tempo? <br><br>  O aplicativo de amostra ao qual <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="external nofollow">forneci</a> o link acima ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="external nofollow">ois2vjoy</a> ) resolve esse problema. <br><br>  Esse aplicativo se comunica com o dispositivo OIS (o programa da Parte 3) e, em seguida, no PC converte esses dados em dados regulares do controlador / joystick, que s√£o transferidos para o dispositivo do controlador <em>virtual</em> / joystick.  Isso significa que voc√™ pode permitir que seu controlador use constantemente a biblioteca OIS (nenhum outro firmware √© necess√°rio) e, se quisermos us√°-lo como um controlador / joystick comum, basta executar o aplicativo ois2vjoy no PC, que realiza a convers√£o. <br><br><h1>  Parte 5. Conclus√£o </h1><br>  Espero que algu√©m tenha achado este artigo √∫til ou interessante.  Obrigado por ler at√© o fim! <br><br>  Se voc√™ estiver curioso, convido voc√™ a participar do desenvolvimento da biblioteca <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="external nofollow">ois_protocol</a> !  Eu acho que ser√° √≥timo desenvolver um protocolo √∫nico para suportar todos os tipos de controladores caseiros em jogos e incentivar os jogos a apoiar diretamente controladores caseiros! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt442816/">https://habr.com/ru/post/pt442816/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt442806/index.html">O programa preliminar DUMP-2019 est√° pronto. Palestrantes do Evil Marcianos, Tinkoff.ru, HTML Academy, SkyEng, 2GIS</a></li>
<li><a href="../pt442808/index.html">Convidamos voc√™ para a Festa Droid - uma reuni√£o dedicada a quest√µes pr√°ticas do desenvolvimento de aplicativos e dispositivos Android</a></li>
<li><a href="../pt442810/index.html">Mitos da F√≠sica Popular, continua√ß√£o: Gravidade</a></li>
<li><a href="../pt442812/index.html">"N√£o vejo raz√£o para usar o Python para trabalhar com o Spark, exceto a pregui√ßa"</a></li>
<li><a href="../pt442814/index.html">10 anos se passaram e ningu√©m descobriu como usar o blockchain. E aqui de novo?</a></li>
<li><a href="../pt442818/index.html">10 erros comuns no ingl√™s escrito e como lidar com eles</a></li>
<li><a href="../pt442820/index.html">Corotinas personalizadas em uni√£o com prefer√™ncia e cortes√£s</a></li>
<li><a href="../pt442822/index.html">Data center no mar e em √≥rbita: eles t√™m significado pr√°tico?</a></li>
<li><a href="../pt442824/index.html">Bem-vindo ao Vale do Sil√≠cio</a></li>
<li><a href="../pt442826/index.html">Engenharia social como dramaturgia, ou o que o dom√≠nio de phishing e o rifle Chekhov t√™m em comum</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>