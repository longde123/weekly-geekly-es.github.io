<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üç¶ üë©üèø‚Äçü§ù‚Äçüë©üèæ üë©‚Äç‚úàÔ∏è Autenticaci√≥n autom√°tica de un dispositivo Android en la conexi√≥n Wi-Fi del metro de Mosc√∫ üë©‚Äçüåæ ü§ù ü§æüèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Como saben, casi todos los autom√≥viles del Metro de Mosc√∫ tienen puntos de acceso a Wi-Fi, con los cuales los usuarios pueden acceder a Internet y pas...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Autenticaci√≥n autom√°tica de un dispositivo Android en la conexi√≥n Wi-Fi del metro de Mosc√∫</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/383109/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como saben, casi todos los autom√≥viles del Metro de Mosc√∫ tienen puntos de acceso a Wi-Fi, con los cuales los usuarios pueden acceder a Internet y pasar agradablemente el tiempo del viaje al metro desde el trabajo a casa: leer noticias, consultar el correo, ver sellos en YouTube, etc. . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cada dispositivo debe autenticarse antes de que se le otorgue acceso a Internet. Por primera vez, al usuario se le env√≠a un SMS con un c√≥digo al n√∫mero de tel√©fono especificado, despu√©s de lo cual el sistema recuerda la direcci√≥n MAC del dispositivo y en el futuro, para la autenticaci√≥n, el usuario solo necesita hacer clic en el enlace "Ingresar a Internet" y esperar un poco.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La desventaja de tal organizaci√≥n del sistema es que incluso si el usuario no necesita un navegador, y √©l, por ejemplo, quiere ingresar al correo o leer Twitter usando una aplicaci√≥n especializada, a√∫n necesita iniciar el navegador, intentar acceder a alguna p√°gina, esperar la redirecci√≥n , haga clic en el enlace, espere a que se cargue la p√°gina de bienvenida (opcional: vea el comercial), y solo despu√©s de eso podr√° usar la aplicaci√≥n deseada. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si no es un visitante frecuente del metro, tal esquema puede no causarle irritaci√≥n, pero con el uso diario todav√≠a molesta, por lo tanto, como dijo un pol√≠tico conocido y carism√°tico: "¬°Suficiente para soportar esto!", Hoy automatizaremos la autenticaci√≥n En el metro de Mosc√∫.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En primer lugar, necesitamos la aplicaci√≥n Tasker. Puede obtenerlo </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqu√≠</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (por un poco de dinero), bien, o en </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">alg√∫n lugar aqu√≠</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (bajo su propio riesgo y riesgo). Personalmente, prefer√≠ la primera opci√≥n y no me arrepiento. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tasker es una aplicaci√≥n que permite, seg√∫n ciertas condiciones (fecha / hora / ubicaci√≥n / estado del dispositivo / lecturas del sensor, etc.) realizar ciertas acciones (enviar mensajes / mostrar notificaciones / encender / apagar dispositivos / renderizar interfaces simples, etc. re.). Las listas de condiciones y acciones son simplemente enormes y dependen de la versi√≥n de Android y del hardware del dispositivo, por lo que no tiene sentido traerlas por completo.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entonces, despu√©s de iniciar Tasker, antes que nada, debe traducir la interfaz al ingl√©s, porque la traducci√≥n es poco convincente en ambas partes: </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configuraci√≥n-&gt; Interfaz-&gt; Idioma-&gt; Ingl√©s</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y reinicie la aplicaci√≥n. </font><font style="vertical-align: inherit;">Ahora tenemos cuatro pesta√±as:</font></font><br>
<ul>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Perfiles</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : los perfiles controlan la conexi√≥n entre el estado del dispositivo / varios eventos y tareas;</font></font></li>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tareas</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : las tareas describen la secuencia de acciones que deben realizarse;</font></font></li>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Escenas</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : las escenas son como formas hechas en casa que las tareas pueden crear y personalizar, y controles en los que pueden ejecutar tareas;</font></font></li>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vars</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : una lista de variables globales que se pueden usar para almacenar datos entre lanzamientos de tareas.</font></font></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vaya a la pesta√±a </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tareas</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y cree una nueva tarea, llam√°ndola Metro Auth:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/files/58a/b9f/a77/58ab9fa777894cc2ab48e7d8e40ceb78.png"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En la ventana que se abre, primero necesitamos definir varias variables. </font><font style="vertical-align: inherit;">Las variables se definen de la siguiente manera:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/files/1e0/95a/df8/1e095adf89564c41a1f500df8d671ada.png"></div><br>
<ul>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nombre de la variable</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - el nombre de la variable, debe comenzar con el </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">%</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de s√≠mbolos </font><font style="vertical-align: inherit;">y compuesto de min√∫sculas. </font><font style="vertical-align: inherit;">Si el nombre de la variable contiene al menos una letra may√∫scula, la variable se convertir√° en global, pero no la necesitamos;</font></font></li>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> es el valor de la variable.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entonces, necesitamos crear las siguientes variables:</font></font><br>
<ul>
<li><i>%url</i> ‚Äî    ,          .        ‚Äî   (     ).   HTTPS  ,     HTTP;</li>
<li><i>%forms</i> ‚Äî    HTML-,      .       ‚Äî '<i>auth-form,hidden_form</i>',        - ,         ,          (  );</li>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% de depuraci√≥n</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : esta variable, cuando se establece en un valor distinto de cero, har√° que se muestre informaci√≥n de depuraci√≥n adicional, lo que nos ayudar√° a hacer la lista de formularios anterior.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Adem√°s de acciones simples, Tasker nos brinda la capacidad de escribir scripts de complejidad arbitraria con la ayuda de varias herramientas. </font><font style="vertical-align: inherit;">Usaremos JavaScript simple:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/files/69d/789/3e2/69d7893e20f5443784f873e8fd6e01ab.png"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqu√≠ debe establecer el </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tiempo de espera</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> m√°ximo de </font><font style="vertical-align: inherit;">ejecuci√≥n </font><i><font style="vertical-align: inherit;">del</font></i><font style="vertical-align: inherit;"> script: 50 segundos, por si acaso. </font><font style="vertical-align: inherit;">La </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">casilla de verificaci√≥n Salida autom√°tica</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> es responsable de la finalizaci√≥n autom√°tica de una acci√≥n despu√©s de la finalizaci√≥n del hilo principal del script. </font><font style="vertical-align: inherit;">Si se utilizan solicitudes asincr√≥nicas (nuestro caso) o la funci√≥n </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">setTimeout</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , debe desmarcar esta casilla y determinar la finalizaci√≥n de la acci√≥n usted mismo utilizando la funci√≥n </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exit (); </font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Presentar√© el script en s√≠ mismo en dos opciones de formato: se necesita un formato decente si desea examinar el script sin romper los ojos, y el formateo en una pantalla estrecha permite que el script se vea m√°s o menos decente en la pantalla estrecha del tel√©fono. </font><font style="vertical-align: inherit;">Inicialmente, la secuencia de comandos se escribi√≥ en el tel√©fono en la versi√≥n "estrecha", y solo entonces lo volv√≠ a formatear para el art√≠culo:</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Script en formato decente</font></font></b><div class="spoiler_text"><pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getUrl</span>(<span class="hljs-params">url1,url2</span>)</span>{<font></font>
    url1=url1.split(<span class="hljs-string">'?'</span>)[<span class="hljs-number">0</span>];
    <span class="hljs-keyword">return</span> url2.length?<font></font>
        (<span class="hljs-regexp">/^http(s?):\/\//i</span>.test(url2)?url2:<font></font>
            (url2[<span class="hljs-number">0</span>]==<span class="hljs-string">'/'</span>?url1.split(<span class="hljs-string">'/'</span>).slice(<span class="hljs-number">0</span>,<span class="hljs-number">3</span>).join(<span class="hljs-string">'/'</span>)+url2:url1.split(<span class="hljs-string">'/'</span>).slice(<span class="hljs-number">0</span>,<span class="hljs-number">-1</span>).join(<span class="hljs-string">'/'</span>)+<span class="hljs-string">'/'</span>+url2)<font></font>
        ):url1;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getVars</span>(<span class="hljs-params">form,tag</span>)</span>{<font></font>
    vars=<span class="hljs-string">''</span>;<font></font>
    fields=form.getElementsByTagName(tag);<font></font>
    <span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>;i&lt;fields.length;i++)<font></font>
        vars=vars+(i?<span class="hljs-string">'&amp;'</span>:<span class="hljs-string">''</span>)+fields[i].name+<span class="hljs-string">'='</span>+fields[i].value;
    <span class="hljs-keyword">return</span> vars;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">submit</span>(<span class="hljs-params">xhr,request,form</span>)</span>{<font></font>
    request.url=getUrl(request.url,form.action);<font></font>
    request.method=form.method;<font></font>
    vars1=getVars(form,<span class="hljs-string">'input'</span>);<font></font>
    vars2=getVars(form,<span class="hljs-string">'textarea'</span>);<font></font>
    request.vars=vars1||vars2?(vars1?vars1:<span class="hljs-string">''</span>)+(vars1&amp;&amp;vars2?<span class="hljs-string">'&amp;'</span>:<span class="hljs-string">''</span>)+(vars2?vars2:<span class="hljs-string">''</span>):<span class="hljs-literal">null</span>;<font></font>
    getPage(request,processPage,xhr);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">processPage</span>(<span class="hljs-params">xhr,request</span>)</span>{<font></font>
    redir=xhr.getResponseHeader(<span class="hljs-string">'Location'</span>);
    <span class="hljs-keyword">if</span>(redir){
        <span class="hljs-keyword">if</span>(redir==request.url) finalize(<span class="hljs-string">':  '</span>);
        <span class="hljs-keyword">else</span>{<font></font>
            log(<span class="hljs-string">'\n\n'</span>);<font></font>
            getPage({<span class="hljs-string">'url'</span>:redir},processPage,xhr);<font></font>
        }<font></font>
    } <span class="hljs-keyword">else</span> {<font></font>
        forms=local(<span class="hljs-string">'forms'</span>).split(<span class="hljs-string">','</span>);<font></font>
        id=<span class="hljs-literal">null</span>;
        <span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>;i&lt;forms.length;i++)
            <span class="hljs-keyword">if</span>(xhr.response.getElementById(forms[i])) id=forms[i];
        <span class="hljs-keyword">if</span>(id)submit(xhr,request,xhr.response.getElementById(id));
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-built_in">Number</span>(local(<span class="hljs-string">'debug'</span>))){<font></font>
            log(<span class="hljs-string">'  :\n'</span>);<font></font>
            forms=xhr.response.getElementsByTagName(<span class="hljs-string">'form'</span>);
            <span class="hljs-keyword">if</span>(forms.length)
                <span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>;i&lt;forms.length;i++)<font></font>
                    log((i?<span class="hljs-string">', "'</span>:<span class="hljs-string">'"'</span>)+forms[i].id+<span class="hljs-string">'"'</span>);
            <span class="hljs-keyword">else</span> log(<span class="hljs-string">''</span>);<font></font>
            finalize();<font></font>
        } <span class="hljs-keyword">else</span> finalize(<span class="hljs-string">' '</span>);<font></font>
    }<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">checkConn</span>(<span class="hljs-params">xhr,request</span>)</span>{<font></font>
    redir=xhr.getResponseHeader(<span class="hljs-string">'Location'</span>);
    <span class="hljs-keyword">if</span>(redir){<font></font>
        log(<span class="hljs-string">'\n\n'</span>);<font></font>
        getPage({<span class="hljs-string">'url'</span>:redir},processPage,xhr);<font></font>
    } <span class="hljs-keyword">else</span> {<font></font>
        log(<span class="hljs-string">'  '</span>);<font></font>
        finalize();<font></font>
    }<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">log</span>(<span class="hljs-params">txt</span>)</span>{<font></font>
    logs=logs+(txt?txt:<span class="hljs-string">''</span>);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">requestToText</span>(<span class="hljs-params">request</span>)</span>{
    <span class="hljs-keyword">return</span> <span class="hljs-string">'URL: '</span>+request.url+<span class="hljs-string">'\nMethod: '</span>+request.method+<span class="hljs-string">', Vars: '</span>+request.vars+<span class="hljs-string">'\n\n'</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">finalize</span>(<span class="hljs-params">txt</span>)</span>{<font></font>
    log(txt);<font></font>
    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">Number</span>(local(<span class="hljs-string">'debug'</span>))) alert(logs);
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(txt) flashLong(txt);<font></font>
    exit();<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getPage</span>(<span class="hljs-params">request,func,xhr</span>)</span>{
    <span class="hljs-keyword">if</span>(!request.method) request.method=<span class="hljs-string">'GET'</span>;
    <span class="hljs-keyword">if</span>(!request.vars) request.vars=<span class="hljs-literal">null</span>;
    <span class="hljs-keyword">if</span>(!xhr){<font></font>
        xhr=<span class="hljs-keyword">new</span> XMLHttpRequest();<font></font>
        xhr.responseType=<span class="hljs-string">"document"</span>;<font></font>
        xhr.timeout=<span class="hljs-number">20</span>*<span class="hljs-number">1000</span>;<font></font>
    }<font></font>
    xhr.open(request.method,request.url,<span class="hljs-literal">true</span>);<font></font>
    xhr.onload=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
        <span class="hljs-keyword">if</span>(xhr.status==<span class="hljs-number">200</span> || xhr.status==<span class="hljs-number">401</span>){<font></font>
            log (requestToText(request)+<span class="hljs-string">'HTTP status: '</span>+xhr.status+<span class="hljs-string">' '</span>+xhr.statusText+<span class="hljs-string">'\n'</span>);<font></font>
            func(xhr,request);<font></font>
        } <span class="hljs-keyword">else</span> {<font></font>
            log(requestToText(request));<font></font>
            finalize(<span class="hljs-string">' HTTP: '</span>+xhr.status+<span class="hljs-string">' '</span>+xhr.statusText);<font></font>
        }<font></font>
    }<font></font>
    xhr.onerror=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{<font></font>
        log(requestToText(request));<font></font>
        finalize(<span class="hljs-string">':  '</span>);<font></font>
    }<font></font>
    xhr.ontimeout=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{<font></font>
        log(requestToText(request));<font></font>
        finalize(<span class="hljs-string">':  '</span>);<font></font>
    }<font></font>
    xhr.send(request.vars);<font></font>
}<font></font>
<font></font>
logs=<span class="hljs-string">''</span>;<font></font>
getPage({<span class="hljs-string">'url'</span>:local(<span class="hljs-string">'url'</span>)},checkConn);
</code></pre></div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Script en formato de pantalla angosta</font></font></b><div class="spoiler_text"><pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getUrl</span>(<span class="hljs-params">url1,url2</span>)</span>{<font></font>
  url1=url1.split(<span class="hljs-string">'?'</span>)[<span class="hljs-number">0</span>];
  <span class="hljs-keyword">return</span> url2.length?<font></font>
    (<span class="hljs-regexp">/^http(s?):\/\//i</span>.test(url2)?<font></font>
      url2:<font></font>
        (url2[<span class="hljs-number">0</span>]==<span class="hljs-string">'/'</span>?<font></font>
        url1.split(<span class="hljs-string">'/'</span>).slice(<span class="hljs-number">0</span>,<span class="hljs-number">3</span>).join(<span class="hljs-string">'/'</span>)+url2:<font></font>
        url1.split(<span class="hljs-string">'/'</span>).slice(<span class="hljs-number">0</span>,<span class="hljs-number">-1</span>).join(<span class="hljs-string">'/'</span>)+
      <span class="hljs-string">'/'</span>+url2)<font></font>
    ):url1;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getVars</span>(<span class="hljs-params">form,tag</span>)</span>{<font></font>
  vars=<span class="hljs-string">''</span>;<font></font>
  fields=form.getElementsByTagName(<font></font>
    tag);<font></font>
  <span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>;i&lt;fields.length;i++)<font></font>
    vars=vars+(i?<span class="hljs-string">'&amp;'</span>:<span class="hljs-string">''</span>)+fields[i].name+
      <span class="hljs-string">'='</span>+fields[i].value;
  <span class="hljs-keyword">return</span> vars;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">submit</span>(<span class="hljs-params">xhr,request,form</span>)</span>{<font></font>
  request.url=getUrl(request.url,<font></font>
    form.action);<font></font>
  request.method=form.method;<font></font>
  vars1=getVars(form,<span class="hljs-string">'input'</span>);<font></font>
  vars2=getVars(form,<span class="hljs-string">'textarea'</span>);<font></font>
  request.vars=vars1||vars2?<font></font>
    (vars1?vars1:<span class="hljs-string">''</span>)+<font></font>
    (vars1&amp;&amp;vars2?<span class="hljs-string">'&amp;'</span>:<span class="hljs-string">''</span>)+<font></font>
    (vars2?vars2:<span class="hljs-string">''</span>)<font></font>
    :<span class="hljs-literal">null</span>;<font></font>
  getPage(request,processPage,xhr);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">processPage</span>(<span class="hljs-params">xhr,request</span>)</span>{<font></font>
  redir=xhr.getResponseHeader(<font></font>
    <span class="hljs-string">'Location'</span>);
  <span class="hljs-keyword">if</span>(redir){
    <span class="hljs-keyword">if</span>(redir==request.url)<font></font>
      finalize(<span class="hljs-string">':  '</span>+
        <span class="hljs-string">''</span>);
    <span class="hljs-keyword">else</span>{<font></font>
      log(<span class="hljs-string">'\n\n'</span>);<font></font>
      getPage({<span class="hljs-string">'url'</span>:redir},processPage,<font></font>
        xhr);<font></font>
    }<font></font>
  } <span class="hljs-keyword">else</span> {<font></font>
    forms=local(<span class="hljs-string">'forms'</span>).split(<span class="hljs-string">','</span>);<font></font>
    id=<span class="hljs-literal">null</span>;
    <span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>;i&lt;forms.length;i++)
      <span class="hljs-keyword">if</span>(xhr.response.getElementById(<font></font>
          forms[i]))<font></font>
        id=forms[i];<font></font>
    <span class="hljs-keyword">if</span>(id)submit(xhr,request,<font></font>
      xhr.response.getElementById(id));<font></font>
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-built_in">Number</span>(local(<span class="hljs-string">'debug'</span>))){<font></font>
      log(<span class="hljs-string">'  :\n'</span>);<font></font>
      forms=xhr.response.<font></font>
        getElementsByTagName(<span class="hljs-string">'form'</span>);
      <span class="hljs-keyword">if</span>(forms.length)
        <span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>;i&lt;forms.length;i++)<font></font>
          log((i?<span class="hljs-string">', "'</span>:<span class="hljs-string">'"'</span>)+forms[i].id+<span class="hljs-string">'"'</span>);
      <span class="hljs-keyword">else</span> log(<span class="hljs-string">''</span>);<font></font>
      finalize();<font></font>
    } <span class="hljs-keyword">else</span> finalize(
      <span class="hljs-string">' '</span>);<font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">checkConn</span>(<span class="hljs-params">xhr,request</span>)</span>{<font></font>
  redir=xhr.getResponseHeader(<font></font>
    <span class="hljs-string">'Location'</span>);
  <span class="hljs-keyword">if</span>(redir){<font></font>
    log(<span class="hljs-string">'\n\n'</span>);<font></font>
    getPage({<span class="hljs-string">'url'</span>:redir},processPage,<font></font>
      xhr);<font></font>
  } <span class="hljs-keyword">else</span> {<font></font>
    log(<span class="hljs-string">'  '</span>+
      <span class="hljs-string">''</span>);<font></font>
    finalize();<font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">log</span>(<span class="hljs-params">txt</span>)</span>{logs=logs+(txt?txt:<span class="hljs-string">''</span>);}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">requestToText</span>(<span class="hljs-params">request</span>)</span>{
  <span class="hljs-keyword">return</span> <span class="hljs-string">'URL: '</span>+request.url+
    <span class="hljs-string">'\nMethod: '</span>+request.method+
    <span class="hljs-string">', Vars: '</span>+request.vars+<span class="hljs-string">'\n\n'</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">finalize</span>(<span class="hljs-params">txt</span>)</span>{<font></font>
  log(txt);<font></font>
  <span class="hljs-keyword">if</span>(<span class="hljs-built_in">Number</span>(local(<span class="hljs-string">'debug'</span>))) alert(logs);
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(txt) flashLong(txt);<font></font>
  exit();<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getPage</span>(<span class="hljs-params">request,func,xhr</span>)</span>{
  <span class="hljs-keyword">if</span>(!request.method)<font></font>
    request.method=<span class="hljs-string">'GET'</span>;
  <span class="hljs-keyword">if</span>(!request.vars)request.vars=<span class="hljs-literal">null</span>;
  <span class="hljs-keyword">if</span>(!xhr){<font></font>
    xhr=<span class="hljs-keyword">new</span> XMLHttpRequest();<font></font>
    xhr.responseType=<span class="hljs-string">"document"</span>;<font></font>
    xhr.timeout=<span class="hljs-number">20</span>*<span class="hljs-number">1000</span>;<font></font>
  }<font></font>
  xhr.open(request.method,<font></font>
    request.url,<span class="hljs-literal">true</span>);<font></font>
  xhr.onload=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
    <span class="hljs-keyword">if</span>(xhr.status==<span class="hljs-number">200</span> ||<font></font>
        xhr.status==<span class="hljs-number">401</span>){<font></font>
      log (requestToText(request)+<font></font>
        <span class="hljs-string">'HTTP status: '</span>+xhr.status+<span class="hljs-string">' '</span>+<font></font>
        xhr.statusText+<span class="hljs-string">'\n'</span>);<font></font>
        func(xhr,request);<font></font>
    } <span class="hljs-keyword">else</span> {<font></font>
      log(requestToText(request));<font></font>
      finalize(<span class="hljs-string">' HTTP: '</span>+<font></font>
        xhr.status+<span class="hljs-string">' '</span>+xhr.statusText);<font></font>
    }<font></font>
  }<font></font>
  xhr.onerror=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{<font></font>
    log(requestToText(request));<font></font>
    finalize(<span class="hljs-string">':  '</span>+
      <span class="hljs-string">''</span>);<font></font>
  }<font></font>
  xhr.ontimeout=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{<font></font>
    log(requestToText(request));<font></font>
    finalize(<span class="hljs-string">':  '</span>+
      <span class="hljs-string">''</span>);<font></font>
  }<font></font>
  xhr.send(request.vars);<font></font>
}<font></font>
<font></font>
logs=<span class="hljs-string">''</span>;<font></font>
getPage({<span class="hljs-string">'url'</span>:local(<span class="hljs-string">'url'</span>)},checkConn);
</code></pre></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Escribir un script desde el teclado del tel√©fono, desafortunadamente, no favorece los comentarios, pero describir√© brevemente el algoritmo:</font></font><br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Intentando cargar la p√°gina especificada en la variable </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% url</font></font></i></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si la respuesta no tiene un encabezado de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ubicaci√≥n</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> HTTP </font><font style="vertical-align: inherit;">, entonces no se nos redirige, lo que significa que no se necesita autenticaci√≥n en este momento, salga</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cargamos la p√°gina a la que fuimos dirigidos.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si hay un encabezado de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ubicaci√≥n</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , regrese al paso 3</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si la p√°gina tiene un formulario de la lista en la variable </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% formularios</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , muestre su env√≠o y vuelva al paso 3</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En otros casos, autenticamos con √©xito</font></font></li>
</ol><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despu√©s de completar el script, tenemos esta tarea:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/files/acb/140/3e1/acb1403e172e48acb699aa299c48bace.png"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Usando el primer icono en la fila inferior, puede intentar iniciarlo. ¬°Ahora es el momento de bajar el metro para configurarlo! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En el metro, conectando con el punto de acceso, intentamos comenzar la tarea. Si no hay problemas obvios con la disponibilidad del servidor, veremos un mensaje similar al que se muestra en la siguiente figura a la izquierda. A continuaci√≥n vemos el identificador del formulario que se encuentra en la √∫ltima p√°gina cargada: </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">auth-form</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Este formulario es claramente nuestro cliente, introducimos su nombre en la variable </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% formularios</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y ejecutamos la tarea nuevamente, obtenemos aproximadamente lo que se muestra en la siguiente figura en el centro. El nuevo identificador de formulario es </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hidden_form</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><i><font style="vertical-align: inherit;">Agr√©guelo</font></i><font style="vertical-align: inherit;"> a la variable </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% formularios</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , ahora su valor ser√° ' </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">auth-form, hidden_form</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'. </font><font style="vertical-align: inherit;">Comenzamos la tarea nuevamente y vemos algo como el que se muestra en la siguiente figura a la derecha: habr√° un formulario sin un identificador o la marca "ausente" (seg√∫n la l√≠nea de metro). </font><font style="vertical-align: inherit;">Si ahora iniciamos el navegador, quedar√° claro que hemos pasado la autenticaci√≥n. </font><font style="vertical-align: inherit;">Establezca la variable </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% debug</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en "0" y cierre la tarea; aqu√≠ hemos terminado.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/files/a9c/0c2/6eb/a9c0c26eb5874153a28dc89c0240262b.png"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora depende de usted configurar el inicio autom√°tico de tareas cuando se conecta al punto de acceso deseado. </font><font style="vertical-align: inherit;">Accedemos a la pesta√±a </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Perfiles</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y creamos un nuevo perfil que se activar√° despu√©s de conectarse al punto de acceso del metro de Mosc√∫. </font><font style="vertical-align: inherit;">Despu√©s de que terminemos de formar la descripci√≥n del punto de acceso, el Tasker nos preguntar√° con qu√© tarea asociar este perfil, por supuesto, elegir </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Metro Auth</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/files/3a5/7ef/5b5/3a57ef5b534f48f5a6b3ab5e00206a1f.png"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Otro matiz: aunque es raro, la autenticaci√≥n todav√≠a vuela, aunque no se produjo la desconexi√≥n del punto. </font><font style="vertical-align: inherit;">Si no hubo desconexi√≥n, no hubo reconexi√≥n, lo que significa que el Tasker no volver√° a iniciar la tarea, por lo que configuraremos el Tasker para que la autenticaci√≥n se verifique autom√°ticamente cada 2 minutos (el intervalo m√≠nimo posible), para esto debemos hacer clic largo en la condici√≥n ya configurada para abrir el men√∫, en el que agregar una condici√≥n temporal en la que establecer el intervalo.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/files/2b7/28a/9af/2b728a9affee411abb30c1174d941fb2.png"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entonces eso es todo. </font><font style="vertical-align: inherit;">De ahora en adelante y hasta que tenga que cambiar los identificadores en la variable de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">formularios%</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , el algoritmo de sus acciones al ingresar al carro es el siguiente:</font></font><br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Encienda el wifi;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Espere el mensaje "Autenticaci√≥n completa" en la pantalla;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sonr√≠e misteriosamente y sigue con tus asuntos.</font></font></li>
</ol><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UPD:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sobre el consejo  </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Autoperfecci√≥n</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Export√© el proyecto y lo puse en </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">un archivo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Este archivo debe descargarse y colocarse en la carpeta </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ sdcard / Tasker / projects</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , luego ejecutar Tasker, mantener presionado el √≠cono de la casa en la esquina inferior izquierda para abrir el men√∫ y seleccionar </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Importar</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">En esta versi√≥n, revis√© una vez cada dos minutos en un perfil separado, esto deber√≠a funcionar de manera m√°s eficiente.</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es383109/">https://habr.com/ru/post/es383109/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es383097/index.html">Windows 10 Insider Preview 10525 mata a Google Chrome</a></li>
<li><a href="../es383099/index.html">El futuro de BMW: cilindro de agua y un torpedo en la cabina</a></li>
<li><a href="../es383101/index.html">BioLite ofrece una fuente de electricidad ecol√≥gica</a></li>
<li><a href="../es383103/index.html">Sony SmartBand 2 rastrea la frecuencia card√≠aca y el estr√©s</a></li>
<li><a href="../es383107/index.html">Hora de cerrar: historias de las famosas bolsas de valores de Chicago</a></li>
<li><a href="../es383111/index.html">Hay una guerra civil por Bitcoin</a></li>
<li><a href="../es383115/index.html">La "paleta 3D" pondr√° las cosas en orden en el escritorio del propietario de un l√°piz 3D</a></li>
<li><a href="../es383117/index.html">AfterShokz Trekz Titanium ‚Ñ¢: nueva versi√≥n de auriculares con conducci√≥n √≥sea</a></li>
<li><a href="../es383119/index.html">Otra revisi√≥n del sistema operativo Sailfish o la elecci√≥n de un sistema operativo m√≥vil adecuado</a></li>
<li><a href="../es383121/index.html">Quadrocopter ense√±√≥ a encontrar redes y dispositivos vulnerables a gran altitud</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>