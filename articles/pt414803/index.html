<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üôáüèø üõåüèø üåã Como vimos os pagamentos da IoT em um hackathon em Hong Kong ‚öôÔ∏è üöµ ‚õµÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="10 de junho foi o terceiro dia de nossa climatiza√ß√£o em Hong Kong. E nas √∫ltimas 26 horas que passamos quase sem dormir, desenvolvendo um projeto de p...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Como vimos os pagamentos da IoT em um hackathon em Hong Kong</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/mixbytes/blog/414803/"><p><img src="https://habrastorage.org/webt/fs/nm/lj/fsnmljsf_fjfqn0eqomgc9yyswi.jpeg"></p><br><p>  10 de junho foi o terceiro dia de nossa climatiza√ß√£o em Hong Kong.  E nas √∫ltimas 26 horas que passamos quase sem dormir, desenvolvendo um projeto de prot√≥tipo com o nome de trabalho SensorPay na primeira etapa do hackathon da EOS Global, com um total de pr√™mios de um milh√£o e meio de d√≥lares.  O momento da demonstra√ß√£o do projeto diante dos ju√≠zes estava chegando. </p><br><p>  Se voc√™ est√° ansioso para descobrir como essa hist√≥ria terminou, d√™ uma olhada na √∫ltima parte imediatamente.  Enquanto isso, come√ßaremos a falar sistematicamente sobre as tecnologias de EOS e como chegamos √† ideia de vincular pagamentos de IoT a EOS.  Logo ap√≥s, haver√° uma descri√ß√£o detalhada do material t√©cnico do projeto. </p><a name="habracut"></a><br><h1 id="0-predystoriya">  0. Antecedentes </h1><br><p>  O EOS √© um blockchain de nova gera√ß√£o, alguns at√© o consideram um assassino do Ethereum.  Se de repente voc√™ n√£o souber o que √© um blockchain ou o Ethereum, o Google ajudar√°.  E n√≥s, por acaso, come√ßamos a desenterrar a EOS cerca de um ano atr√°s, inclusive estudando os produtos anteriores de seus autores BitShares e Steem. </p><br><p>  As vantagens do EOS em compara√ß√£o com o Ethereum: o rendimento da transa√ß√£o √© tr√™s ordens de magnitude maior;  sistema de permiss√£o desenvolvido para contratos inteligentes;  a capacidade de restaurar o acesso perdido e corrigir erros no blockchain;  gerenciamento de rede onchain.  Fraquezas: preocupa√ß√µes com a centraliza√ß√£o, consenso de DPoS potencialmente mais vulner√°vel, c√≥digo bruto e uma curva de aprendizado mais acentuada para desenvolvedores. </p><br><p>  Como gostamos dessa tecnologia h√° muito tempo e a consideramos promissora, n√£o podemos desconsiderar a s√©rie de hackathons, que √© apoiada pelos autores da EOS.  N√≥s apenas quer√≠amos estar l√°, realizar nossas id√©ias nesse ambiente inspirador e compartilh√°-las com um amplo p√∫blico.  Obviamente, a oportunidade de ganhar um bom dinheiro tamb√©m se tornou um motivador agrad√°vel adicional. </p><br><p>  Portanto, a EOS √© a √∫nica solu√ß√£o funcional para o blockchain p√∫blico que sabemos onde voc√™ pode realizar MUITAS transa√ß√µes.  Onde √© necess√°rio?  Claro que na Internet das coisas!  De fato, se cada torradeira se tornar micropagamentos, ela pagar√° por cada peda√ßo de p√£o na geladeira (e isso √© legal por padr√£o, como voc√™ entende), haver√° muitas transa√ß√µes.  Sem mencionar todos os tipos de outras aplica√ß√µes na medicina, na ind√∫stria e na vida cotidiana. </p><br><p>  Algumas semanas antes do hackathon, id√©ias alternativas surgiam periodicamente e pequenos brainstorms eram realizados.  Comparamos as ideias com base em crit√©rios de arbitragem conhecidos: aplica√ß√£o dos recursos da EOS, criatividade, impacto social, escalabilidade.  Como resultado, decidimos pela IoT + EOS - uma solu√ß√£o que pegava dados de sensores e enviava muitas transa√ß√µes de pagamento para a EOS. </p><br><p>  A prop√≥sito, realmente quer√≠amos contar aqui tamb√©m como criamos nosso Block Producer para EOS;  como eles planejaram liberar para ele o construtor de tokens do tipo ERC721 e suporte para fun√ß√µes constantes;  como eles arquivaram o protocolo ACL da raiz de Merkle.  Mas tudo isso n√£o se encaixa no artigo, portanto, retornaremos ao nosso projeto principal. </p><br><p><img src="https://habrastorage.org/webt/9j/mu/uk/9jmuukvwx1e6cav3h59txeywaw0.jpeg"></p><br><h1 id="1-podgotovka">  1. Prepara√ß√£o </h1><br><h2 id="11-iot">  1.1  IoT </h2><br><p>  Preparar a parte IoT do projeto √© escolher o hardware certo.  No papel do leitor RFID, o RC522 operando no barramento SPI foi escolhido: √© popular e f√°cil de usar. </p><br><p><img src="https://habrastorage.org/webt/tq/xf/qh/tqxfqh4x5vzlaywel57eqszznpu.jpeg"></p><br><p>  Ao procurar o contador, focamos na presen√ßa de uma sa√≠da de pulso, pois ela permite a leitura de dados com muita simplicidade: um pulso √© X kW‚ãÖh (onde X depende do modelo); como resultado, paramos no contador Mercury 201.5. </p><br><p><img src="https://habrastorage.org/webt/z-/63/sc/z-63scf4m94nnbw30prkmy_nfxa.jpeg"></p><br><p>  O mais dif√≠cil foi decidir sobre o controlador, que deve coletar dados dos sensores, formar uma transa√ß√£o, assin√°-lo com sua chave privada e envi√°-lo √† rede.  Dessa forma, precis√°vamos de um dispositivo com um m√≥dulo de rede que pudesse assinar uma transa√ß√£o usando ECDSA (neste caso, na curva el√≠ptica secp256k1, pois √© usado no EOS para assinatura). </p><br><p>  Inicialmente, a escolha recaiu sobre o microcontrolador ESP8266, possui um m√≥dulo Wi-Fi e todas as interfaces necess√°rias para conectar nossos sensores.  Ao mesmo tempo, √© muito compacto.  Mas nenhum firmware possui uma implementa√ß√£o nativa de primitivas el√≠pticas.  √â poss√≠vel escrever sua pr√≥pria implementa√ß√£o, mas isso n√£o √© uma tarefa para o hackathon.  Como resultado, o Raspberry Pi 3 B foi escolhido para o prot√≥tipo e a biblioteca eosjs foi usada para gerar e assinar transa√ß√µes. </p><br><p><img src="https://habrastorage.org/webt/ww/jo/dg/wwjodgbxktjubpruvb-srqz_9dq.jpeg"></p><br><h2 id="12-infrastruktura">  1.2  A infraestrutura </h2><br><p>  Alguns dias antes da hackathon, preparamos localmente e no servidor eos-hackathon.smartz.io um assembly EOS ( <a href="">fonte</a> ).  A instala√ß√£o, montagem e testes de depend√™ncia foram surpreendentemente tranq√ºilos para um projeto t√£o jovem (usando a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">documenta√ß√£o</a> ).  N√£o havia tempo suficiente para outra prepara√ß√£o da infraestrutura, e eu j√° tinha que lidar com isso durante o hackathon. </p><br><h2 id="13-arhitektura">  1.3  Arquitetura </h2><br><p>  Na v√©spera do hackathon, discutimos a arquitetura e esclarecemos os detalhes do produto.  Ir√≠amos implementar os seguintes casos principais: pagamentos por eletricidade e pagamento por compras marcadas com etiquetas RFID.  Eles tamb√©m planejavam tornar o produto facilmente extens√≠vel e us√°-lo em outras √°reas. </p><br><p><img src="https://habrastorage.org/webt/yh/rh/tm/yhrhtm0ildam8hgnnjnpkf4_l7w.jpeg"></p><br><p>  A id√©ia da arquitetura √© que o provedor de servi√ßos (Produtor) crie um contrato - o ponto central da intera√ß√£o entre o fornecedor e os consumidores.  Cada consumidor tem seu pr√≥prio saldo, que pode ser reabastecido, e os fundos s√£o debitados com base nos sinais dos sensores.  Todos os dados - usu√°rios, sensores, estat√≠sticas - s√£o armazenados no contrato do fornecedor. </p><br><p> As prefer√™ncias do usu√°rio est√£o associadas ao consumidor ou sinalizadores (por exemplo, uma categoria preferencial do usu√°rio) - <code>user_meta</code> .  V√°rios sensores podem ser conectados ao consumidor, para cada um deles s√£o indicados um contrato e configura√ß√µes de cobran√ßa ( <code>billing_meta</code> ).  Assim, voc√™ pode obter um contrato de faturamento ap√°trida imut√°vel, usado para um grande n√∫mero de consumidores;  os dados necess√°rios aparecer√£o durante a chamada do m√©todo de <code>bill(payload, user_meta, billing_meta)</code> .  Al√©m disso, √© apresentada a possibilidade de uma l√≥gica de faturamento diferente, ou seja, contratos diferentes: por exemplo, um considera eletricidade, o outro - bens.  Cada sensor tem um "ponteiro" para seu contrato de cobran√ßa. </p><br><p>  Sup√µe-se que o consumidor confie no fabricante do sensor, mas n√£o confie necessariamente no provedor de servi√ßos.  A interface de intera√ß√£o com o sensor √© extremamente simples: √© uma chamada ao m√©todo de contrato do fornecedor com um par√¢metro num√©rico, que ser√° transferido para o faturamento.  O provedor de servi√ßos inicia consumidores, sensores, contratos de cobran√ßa e seus relacionamentos no contrato, usando transa√ß√µes de controle - setters primitivos.  Quando uma transa√ß√£o √© recebida do sensor, os dados s√£o verificados, os dados para cobran√ßa s√£o gerados, a cobran√ßa √© chamada, o pagamento √© registrado e as estat√≠sticas s√£o registradas. </p><br><p>  Talvez, acima de tudo, tenhamos discutido os seguintes problemas que s√£o importantes para a aplicabilidade do produto no mundo real: </p><br><ul><li>  Adiantamentos ou p√≥s-pagamento?  Reabaste√ßa sua conta e use-a (como uma conex√£o de celular) - ou use-a e depois pague (como a AWS)?  N√£o h√° resposta certa ou errada aqui: empresas diferentes preferem modelos diferentes.  Por uma quest√£o de simplicidade, decidimos fazer pagamentos antecipados. </li><li>  O usu√°rio deve manter uma conta separada para cada fornecedor ou todas as cobran√ßas s√£o provenientes de uma conta?  Novamente - n√£o h√° decis√£o certa e errada;  al√©m disso, a resposta est√° intimamente relacionada √† resposta √† pergunta anterior.  Os adiantamentos s√£o bons amigos de contas de consumidores individuais - eles foram feitos. </li><li>  Cobrar uma taxa no EOS, um token de um provedor de servi√ßos ou moeda est√°vel (vinculada √† moeda fiduci√°ria)?  Naturalmente, outras op√ß√µes que n√£o a moeda est√°vel s√£o inconvenientes para o consumidor devido √† volatilidade, e a moeda est√°vel no √¢mbito do EOS ainda n√£o existe.  Naquela √©poca, nem a principal rede EOS estava l√°!  Por simplicidade, eles receberam um token condicional. </li></ul><br><h1 id="2-koding">  2. Codifica√ß√£o </h1><br><p>  Primeiro, eles especificaram a API e a estrutura do contrato do fornecedor para iniciar simultaneamente o desenvolvimento do frontend, c√≥digo do dispositivo, cobran√ßa e contrato principal ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">fonte</a> ). </p><br><h2 id="21-iot">  2.1  IoT </h2><br><p>  O primeiro a implementar um <a href="">c√≥digo</a> para ler pulsos de um contador.  Para trabalhar com o GPIO (pinos de uso geral), a biblioteca JS onoff foi usada.  Mais tarde, dois LEDs foram adicionados ao circuito para maior clareza: o primeiro piscou quando um sinal foi recebido do contador e o segundo quando uma resposta sobre uma transa√ß√£o bem-sucedida veio do n√≥ EOS.  Da mesma forma, desenvolvemos um esquema e c√≥digo para a leitura de tags RFID, com a √∫nica diferen√ßa: a leitura ocorreu no barramento SPI usando a biblioteca MFRC522-python.  Como se viu, a configura√ß√£o SPI para o Raspberry Pi 3 √© diferente da configura√ß√£o nos modelos anteriores de placa;  Esta <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">instru√ß√£o</a> nos ajudou a entender. </p><br><p>  Os dispositivos foram alimentados pelo banco de pot√™ncia, que foi apresentado com sucesso a todos os participantes do hackathon, e eles tiveram que compartilhar a Internet com o iPhone 5, j√° que o Wi-Fi do hackathon funcionava exclusivamente a 5 GHz, isso n√£o funcionava para o Raspberry Pi. </p><br><h2 id="22-infrastruktura-i-utility">  2.2  Infraestrutura e Utilit√°rios </h2><br><p>  Os organizadores aconselharam tirar a imagem do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">dock</a> do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">eos-dev</a> , mas ficamos confusos com a falta de descri√ß√£o e documenta√ß√£o da imagem.  No servidor, eles continuaram trabalhando com a montagem preparada e, localmente, para evitar a instala√ß√£o sistem√°tica do EOS, eles usaram o eos-dev. </p><br><p>  Imediatamente precisava urgentemente da capacidade de construir e testar rapidamente.  Ideal: criar e executar um arquivo execut√°vel localmente.  No entanto, era imposs√≠vel ignorar o fato de que, ap√≥s a montagem, a sa√≠da exigia o WebAssembly e, no ambiente EOS, com os correspondentes impulsionadores, bibliotecas e contratos do sistema.  As op√ß√µes de compila√ß√£o necess√°rias podem ser <a href="">vistas</a> em <a href="">eosiocpp.in</a> , no entanto, decidimos n√£o jogar este jogo.  O resultado previsto, embora um pouco mais lento, √© mais importante do que uma solu√ß√£o r√°pida com um potencial rake.  Portanto, para a montagem, pegamos o eoscpp, que est√° no cont√™iner eos-dev. </p><br><p>  Acabou sendo mais dif√≠cil com o lan√ßamento, tive que aumentar a blockchain da EOS local e, novamente, n√£o havia solu√ß√£o pronta.  Somente software.  Ent√£o a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">primeira vers√£o da</a> infraestrutura de lan√ßamento apareceu.  A id√©ia √© ocultar as nuances de montagem e configura√ß√£o e obter um conjunto auto-consistente de quatro a cinco "bot√µes" para a√ß√µes t√≠picas.  Menos controle, mas menos chance de erro, al√©m de economia de tempo. </p><br><p>  Os principais componentes do EOS incluem os nodeos, keosd daemons, o utilit√°rio cleos console e o compilador eoscpp: </p><br><ul><li>  nodeos - n√≥ EOS, daemon - participante da rede, fornece acesso ao blockchain e, opcionalmente, produz novos blocos; </li><li>  keosd - um daemon para gerenciar carteiras locais que armazenam pares de chaves; </li><li>  O cleos fornece comandos desde a obten√ß√£o de informa√ß√µes sobre transa√ß√µes at√© o trabalho com chaves; √© implementado com base em chamadas em nodeos e keosd atrav√©s da API HTTP; </li><li>  O eoscpp compila contratos no WebAssembly e tamb√©m permite que voc√™ obtenha a Interface bin√°ria do aplicativo com base no c√≥digo-fonte. </li></ul><br><p>  Imediatamente ficou claro que os comandos cleos relacionados √†s chamadas keosd n√£o funcionavam.  Como foi emitido um erro indicando inacessibilidade da rede keosd, passamos um tempo diagnosticando problemas de rede na rede docker.  No entanto, o strace mostrou que n√£o era a rede: os cleos acessavam o endere√ßo errado, sempre para o host local (e, no caso de nossa infraestrutura, daemons diferentes t√™m endere√ßos de rede diferentes em uma rede docker separada).  Um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">bug</a> foi diagnosticado no cleos: a verifica√ß√£o da disponibilidade do keosd, que √© executada antes de qualquer comando relacionado √†s carteiras, leva em considera√ß√£o a porta transmitida nos argumentos, mas n√£o leva em considera√ß√£o o endere√ßo.  Sob o hackathon, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">mudamos</a> para a rede host no docker como uma solu√ß√£o alternativa. </p><br><p>  A pr√≥xima etapa foi o utilit√°rio de compila√ß√£o do contrato usando o compilador no cont√™iner ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">confirma√ß√£o</a> ).  Diret√≥rios de entrada e sa√≠da foram montados.  E, finalmente, a capacidade de fazer upload de um contrato para o blockchain e enviar transa√ß√µes ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">confirma√ß√£o</a> ).  Novamente - utilit√°rios em um estilo consistente, simples "bot√µes".  Isso encerrou a infraestrutura b√°sica, mas as surpresas continuaram: deparamos com o problema das fun√ß√µes C para trabalhar com mem√≥ria (em mais detalhes abaixo). </p><br><p>  Em conclus√£o, eles come√ßaram a configurar contas em um arquivo (cada contrato e participante exigem contas separadas) junto com pares de chaves criados automaticamente quando o blockchain √© iniciado, para que uma equipe possa elevar o ambiente de teste.  Uma c√≥pia desse ambiente foi implantada no eos-hackathon.smartz.io. </p><br><h2 id="23-smart-kontrakty">  2.3  Contratos inteligentes </h2><br><h3 id="231-kontrakt-postavschika-i-billing-elektrichestva">  2.3.1  Contrato de fornecedor e cobran√ßa de energia el√©trica </h3><br><p>  Ap√≥s o in√≠cio do hackathon, come√ßamos a definir a estrutura dos contratos de acordo com o esquema acima.  O sistema consistia nos seguintes contratos: </p><br><ul><li>  contrato <code>supplier</code> - <code>supplier</code> ; </li><li>  <code>billing_electricity</code> - um contrato para calcular o pagamento de eletricidade para cada tick do medidor. </li></ul><br><p>  No contrato do <code>supplier</code> , a maior parte do trabalho √© realizada por opera√ß√µes CRUD comuns: adi√ß√£o de usu√°rios, tarifas, contadores, aumento ou diminui√ß√£o do saldo do usu√°rio.  M√©todos mais complexos foram respons√°veis ‚Äã‚Äãpor receber dados do medidor, abrir um contrato para calcular um pagamento (cobran√ßa), debitar a conta pessoal de um usu√°rio ap√≥s um retorno de chamada de um contrato de cobran√ßa.  O contrato de cobran√ßa necess√°rio foi determinado com base na tarifa do usu√°rio. </p><br><p>  Ap√≥s a chamada no contrato para cobran√ßa, o pagamento foi calculado e o m√©todo foi chamado para debitar o pagamento da conta pessoal do usu√°rio.  Tendo jogado a l√≥gica principal, at√© pensamos se est√°vamos fazendo contratos muito simples.  Um pouco depois, ap√≥s a implanta√ß√£o dos contratos no n√≥ e seus testes, ficou claro que os contratos podem ser simples, mas h√° nuances.  :) </p><br><p>  Ap√≥s a implanta√ß√£o, verificou-se que as chamadas de contrato esperadas entre si n√£o funcionavam.  Direitos insuficientes.  Diferentemente dos contratos inteligentes no Ethereum, onde um contrato √© chamado de um contrato em nome do contrato de chamada, no EOS, toda a cadeia come√ßa com o iniciador da transa√ß√£o.  Quando um contrato √© chamado de um contrato, √© verificado se o iniciador permitiu que o contrato fizesse isso. </p><br><p>  Os mentores imediatamente sugeriram como agir em um caso simples.  Os direitos s√£o adicionados da seguinte forma (atrav√©s da chamada do contrato inteligente do sistema eosio): </p><br><pre> <code class="hljs swift">./cleos push action eosio updateauth '{<span class="hljs-string"><span class="hljs-string">"account"</span></span>:<span class="hljs-string"><span class="hljs-string">"electricity"</span></span>,<span class="hljs-string"><span class="hljs-string">"permission"</span></span>:<span class="hljs-string"><span class="hljs-string">"active"</span></span>,<span class="hljs-string"><span class="hljs-string">"parent"</span></span>:<span class="hljs-string"><span class="hljs-string">"owner"</span></span>,<span class="hljs-string"><span class="hljs-string">"auth"</span></span>:{<span class="hljs-string"><span class="hljs-string">"keys"</span></span>:[{<span class="hljs-string"><span class="hljs-string">"key"</span></span>:<span class="hljs-string"><span class="hljs-string">"EOS7oPdzdvbHcJ4k9iZaDuG4Foh9YsjQffTGniLP28FC8fbpCDgr5"</span></span>,<span class="hljs-string"><span class="hljs-string">"weight"</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>}],<span class="hljs-string"><span class="hljs-string">"threshold"</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-string"><span class="hljs-string">"accounts"</span></span>:[{<span class="hljs-string"><span class="hljs-string">"permission"</span></span>:{<span class="hljs-string"><span class="hljs-string">"actor"</span></span>:<span class="hljs-string"><span class="hljs-string">"supplier"</span></span>,<span class="hljs-string"><span class="hljs-string">"permission"</span></span>:<span class="hljs-string"><span class="hljs-string">"eosio.code"</span></span>},<span class="hljs-string"><span class="hljs-string">"weight"</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>}],<span class="hljs-string"><span class="hljs-string">"waits"</span></span>:[]}}' -p electricity</code> </pre> <br><p>  Nesse caso, a conta de <code>electricity</code> permite que o contrato do <code>supplier</code> chame outros contratos em seu nome.  Voc√™ pode ler mais sobre direitos no <a href="">Technical WP EOS</a> .  Em nosso pa√≠s, o contrato do <code>supplier</code> causou o contrato de <code>billing</code> e, por sua vez, novamente chamou o <code>supplier</code> .  A adi√ß√£o por analogia de direitos neste formul√°rio n√£o funcionou: </p><br><pre> <code class="hljs swift">./cleos push action eosio updateauth '{<span class="hljs-string"><span class="hljs-string">"account"</span></span>:<span class="hljs-string"><span class="hljs-string">"electricity"</span></span>,<span class="hljs-string"><span class="hljs-string">"permission"</span></span>:<span class="hljs-string"><span class="hljs-string">"active"</span></span>,<span class="hljs-string"><span class="hljs-string">"parent"</span></span>:<span class="hljs-string"><span class="hljs-string">"owner"</span></span>,<span class="hljs-string"><span class="hljs-string">"auth"</span></span>:{<span class="hljs-string"><span class="hljs-string">"keys"</span></span>:[{<span class="hljs-string"><span class="hljs-string">"key"</span></span>:<span class="hljs-string"><span class="hljs-string">"EOS7oPdzdvbHcJ4k9iZaDuG4Foh9YsjQffTGniLP28FC8fbpCDgr5"</span></span>,<span class="hljs-string"><span class="hljs-string">"weight"</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>}],<span class="hljs-string"><span class="hljs-string">"threshold"</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-string"><span class="hljs-string">"accounts"</span></span>:[{<span class="hljs-string"><span class="hljs-string">"permission"</span></span>:{<span class="hljs-string"><span class="hljs-string">"actor"</span></span>:<span class="hljs-string"><span class="hljs-string">"supplier"</span></span>,<span class="hljs-string"><span class="hljs-string">"permission"</span></span>:<span class="hljs-string"><span class="hljs-string">"eosio.code"</span></span>},<span class="hljs-string"><span class="hljs-string">"weight"</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>},{<span class="hljs-string"><span class="hljs-string">"permission"</span></span>:{<span class="hljs-string"><span class="hljs-string">"actor"</span></span>:<span class="hljs-string"><span class="hljs-string">"billelectro"</span></span>,<span class="hljs-string"><span class="hljs-string">"permission"</span></span>:<span class="hljs-string"><span class="hljs-string">"eosio.code"</span></span>},<span class="hljs-string"><span class="hljs-string">"weight"</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>}],<span class="hljs-string"><span class="hljs-string">"waits"</span></span>:[]}}' -p electricity</code> </pre> <br><p>  Um erro foi emitido: autoridade inv√°lida.  Aqui os mentores n√£o podiam mais nos ajudar: eles disseram que eles mesmos n√£o fizeram isso.  E quem fez?  Talvez apenas Dan Larimer.  N√£o conseguimos encontrar rapidamente a causa do erro no c√≥digo EOS e j√° come√ßamos a considerar op√ß√µes alternativas, sem uma cadeia de chamadas.  Impediu lindamente que o mecanismo de convoca√ß√£o de outros contratos no EOS tamb√©m seja diferente do √©ter.  Quando outro contrato √© chamado, esta chamada fica na fila e s√≥ ser√° conclu√≠da ap√≥s a conclus√£o da chamada atual.  N√£o funcionar√° para chamar o contrato e ap√≥s a chamada para ler os dados registrados por este contrato. </p><br><p>  Mais tarde, afinal, eles encontraram no c√≥digo EOS o motivo do erro ao definir os direitos para dois contratos.  Acontece que as contas na lista de direitos devem ser classificadas por conta: <em>Garante que todas as chaves sejam √∫nicas e classificadas e que todas as permiss√µes da conta sejam √∫nicas e classificadas</em> ( <a href="">Authority.hpp</a> ).  Ap√≥s alterar a ordem das contas, a atualiza√ß√£o dos direitos funcionou - e nosso sistema de contratos come√ßou a operar. </p><br><h3 id="232-problema-c-funkciy-raboty-s-pamyatyu">  2.3.2  O problema das fun√ß√µes C com mem√≥ria </h3><br><p>  √â rid√≠culo dizer, mas no final n√£o conseguimos usar as fun√ß√µes prontas para analisar n√∫meros (!) Para ler a configura√ß√£o de cobran√ßa.  Ap√≥s <code>std::istringstream</code> fun√ß√£o <code>std::istringstream</code> foi <code>std::istringstream</code> que √© bastante estranho.  E ao usar <code>atof</code> e similares, assim como <code>sscanf</code> - <code>env.realloc</code> apertado.  Por alguma raz√£o, as fun√ß√µes mencionadas de trabalhar com a mem√≥ria da biblioteca C padr√£o n√£o foram encontradas durante o carregamento de c√≥digo nos n√≥s.  As fun√ß√µes C ++ que trabalham com mem√≥ria funcionaram. </p><br><p>  Obviamente, ao executar o contrato do WebAssembly, n√£o √© usado um alocador de mem√≥ria padr√£o, mas sua pr√≥pria caixa de prote√ß√£o, que √© fornecida a cada transa√ß√£o sob determinadas condi√ß√µes.  Al√©m disso, o suporte √†s fun√ß√µes C do trabalho com mem√≥ria em cima dessa caixa de prote√ß√£o foi implementado por um longo tempo, sua implementa√ß√£o est√° em <a href="">contratos EOS padr√£o</a> .  Provavelmente algo deu errado no est√°gio de vincula√ß√£o. </p><br><p>  Depois de passar cerca de uma hora procurando uma sa√≠da, inclusive com a ajuda de um dos mentores, decidimos n√£o continuar e fazer uma solu√ß√£o alternativa: escreva nosso pr√≥prio c√≥digo que resolva o problema de analisar n√∫meros.  O mecanismo EOS do fluxo de dados n√£o nos convinha: requeria a capacidade de salvar pacotes de dados de estruturas diferentes em um campo e cri√°-los manualmente (as pr√≥prias configura√ß√µes de cobran√ßa). </p><br><h3 id="233-billing-pokupok">  2.3.3  Faturamento do Shopping </h3><br><p>  No segundo vento, que foi aberto pelos engenheiros de energia ou pelo caf√© da manh√£, eles escreveram <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">faturamento</a> para compras na loja.  O esquema geral de trabalho √© o seguinte: </p><br><ol><li>  O fornecedor cria um contrato de faturamento e o prescreve em seu contrato geral. </li><li>  Na sa√≠da da loja, o fornecedor estabelece estruturas que podem ler RFID, interagir com o EOS e ter suas pr√≥prias contas prescritas no contrato de cobran√ßa. </li><li>  Cada produto na loja est√° equipado com uma etiqueta RFID, todas as etiquetas s√£o registradas no contrato de cobran√ßa. </li><li>  O comprador paga pelas mercadorias digitalizando seu RFID e as mercadorias s√£o removidas do contrato de cobran√ßa. </li><li>  Na sa√≠da da loja, os quadros tamb√©m l√™em compras de RFID.  Se as mercadorias ainda estiverem na loja, a transa√ß√£o n√£o passa e o quadro deve soar o alarme (sim, de fato, voc√™ n√£o pode nem enviar a transa√ß√£o, mas apenas ler a tabela). </li></ol><br><p>  N√£o faz sentido insistir no pr√≥prio c√≥digo do contrato: esse √© o C ++ 14 padr√£o com algumas constru√ß√µes e bibliotecas espec√≠ficas do EOS.  Melhor dito no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Wiki</a> do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">EOSIO</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">no Portal do desenvolvedor do EOSIO</a> . </p><br><h3 id="234-frontend">  2.3.4  Frontend </h3><br><p>  A parte frontend do projeto foi implementada usando o React.  Em vez do habitual, muitos Redux decidiram usar o MobX, que acelera significativamente o desenvolvimento e permite gerenciar o status global sem dor de cabe√ßa. </p><br><p>  A fase de integra√ß√£o front-blockchain n√£o correu t√£o bem quanto o esperado.  O pacote <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">eosjs</a> est√° <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">sendo</a> finalizado de forma muito ativa, seguido pela carteira EOS para o navegador <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Scatter</a> .  Nesse grupo, isso geralmente causa problemas.  E n√£o o fato de que o c√≥digo que funcionou ontem funcionar√° bem hoje.  N√≥s pisamos neste rake (e n√£o na primeira vez).  Uma hora tentando e depurando em um estado sonolento - o problema est√° resolvido. </p><br><p>  Considere um diagrama simplificado da intera√ß√£o do lado do cliente do aplicativo com o eos.  Para fazer isso, voc√™ precisa da biblioteca eosjs e da extens√£o do navegador Scatter. </p><br><p>  Lembramos voc√™!  O Scatter √© atualizado ativamente ap√≥s o eosjs, n√£o se esque√ßa de atualizar a biblioteca. </p><br><p>  Em seguida, uma breve olhada em leitura e escrita.  Existem duas maneiras de se comunicar com contratos inteligentes no EOS: enviar transa√ß√µes (faz com que o blockchain seja modificado, sem valores de retorno fornecidos) e ler tabelas (a√ß√£o somente leitura). </p><br><p>  Considere o c√≥digo de envio da transa√ß√£o: </p><br><pre> <code class="hljs markdown"> sendTransaction(funcName, data) { return this.scatter .suggestNetwork(this.network) .then(() =&gt; this.scatter.getIdentity({ accounts: [<span class="hljs-string"><span class="hljs-string">this.network</span></span>] })) .then((identity) =&gt; { let accountName = this.getAccountName(identity); // wrap eos instance const eos = this.scatter.eos(this.network, Eos, this.configEosInstance); return eos.transaction(accountName, (contract) =&gt; { contract[<span class="hljs-string"><span class="hljs-string">funcName</span></span>](<span class="hljs-link"><span class="hljs-link">data, { authorization: accountName }</span></span>); }); }); }</code> </pre> <br><p>  Argumentos de entrada: nome da fun√ß√£o e objeto, seus valores s√£o argumentos dessa fun√ß√£o.  Terceira linha: confirmamos a rede atrav√©s da qual interagimos com o EOS.  Quarta linha: obtemos <code>identity</code> , o par√¢metro √© um objeto com o campo de <code>accounts</code> (para esta rede).  A fun√ß√£o <code>getAccountName</code> retorna a primeira conta da lista de contas recebidas (no objeto de <code>identity</code> ). </p><br><p>  Neste exemplo, o Scatter √© usado para assinar uma transa√ß√£o.  Scatter √© um wrapper sobre uma inst√¢ncia da classe <code>Eos</code> .  Na linha 9, chamamos o m√©todo <code>eos</code> , seus par√¢metros: </p><br><ol><li>  <code>this.network</code> - um objeto com par√¢metros de rede. </li><li>  <code>Eos</code> √© uma inst√¢ncia do eosjs. </li><li>  <code>this.configEosInstance</code> - um objeto com par√¢metros para uma inst√¢ncia do Eos (consulte dock eosjs). </li></ol><br><p>  O √∫ltimo m√©todo de <code>transaction</code> aceita <code>accountName</code> e <code>callback</code> como uma entrada; o argumento de <code>callback</code> √© um contrato localizado na conta <code>accountName</code> .  No <code>callback</code> , chamamos o m√©todo do contrato recebido com o objeto, suas chaves s√£o os argumentos do m√©todo chamado. </p><br><p>  Considere o m√©todo de leitura de tabelas: </p><br><pre> <code class="hljs kotlin"> readTable(<span class="hljs-keyword"><span class="hljs-keyword">data</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.eos = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.scatter.eos(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.network, Eos, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.configEosInstance); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.eos.getTableRows({ json: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, limit: <span class="hljs-number"><span class="hljs-number">1</span></span>, ...<span class="hljs-keyword"><span class="hljs-keyword">data</span></span>, }); }</code> </pre> <br><p>  Aqui para leitura, precisamos apenas de uma inst√¢ncia <code>eos</code> . </p><br><p>  Para projetar a interface, lan√ßamos Materialize, Semantic e Ant, criamos os pr√≥prios estilos.  Nas √∫ltimas horas do hackathon, uma id√©ia apareceu para reviver a interface do usu√°rio, adicionar uma visualiza√ß√£o do processo.  Destacou as novas linhas da tabela por dois segundos em verde e obteve um efeito interessante √† cota√ß√£o das a√ß√µes.  A melhoria aumentou significativamente a atratividade do projeto e se tornou o est√°gio final da cria√ß√£o da interface do usu√°rio. </p><br><h1 id="3-sborka">  3. Montagem </h1><br><p>  Tr√™s horas antes do final do tempo, t√≠nhamos um Raspberry Pi com o medidor de eletricidade Mercury e um leitor RFID conectado a ele, al√©m de uma indica√ß√£o luminosa.  Toda a eletricidade da mesa passou pelo Merc√∫rio.  Para cada 0,3125 Wh / h gasto, bem como para cada "compra", o Raspberry Pi enviava transa√ß√µes para nossa blockchain, e o provedor de servi√ßos podia gerenciar usu√°rios, sensores, cobran√ßa e ver estat√≠sticas de consumo. </p><br><p><img src="https://habrastorage.org/webt/y6/uq/mz/y6uqmz1upvprppiimceoecejewg.jpeg"></p><br><p>  Por mais uma hora, calmamente nos envolvemos em verifica√ß√µes e adicionamos os retoques finais.  Duas horas antes do final dos tempos, recebemos um produto completo com dois casos implementados, ilustrando completamente o conceito e at√© mesmo sem confirma√ß√£o nos √∫ltimos minutos! </p><br><h1 id="4-demonstraciya">  4. Demonstra√ß√£o </h1><br><p>  As demonstra√ß√µes de projetos (tamb√©m conhecidos como arremessos) consistiram em duas etapas.  Na primeira etapa, 69 equipes participantes foram divididas em quatro grupos, cada um deles alimentado separadamente na frente de dois ju√≠zes e sem espectadores.  Os ju√≠zes deram notas (quatro crit√©rios de 5 pontos cada) e, com base nessas notas, as 10 melhores equipes foram selecionadas para a segunda etapa.  Essas equipes tiveram a oportunidade de realizar um projeto em um grande palco diante da plat√©ia e dos oito ju√≠zes. </p><br><p>  Acabamos no primeiro grupo, nossos ju√≠zes eram o CEO e o presidente (imagino como essas posi√ß√µes diferem) da Everipedia.  Tr√™s minutos foram alocados para o desempenho, eles foram rigorosamente monitorados pelo timer.  Terminamos nossa inconsist√™ncia, mas pedimos para impressionar o discurso 30 segundos antes do previsto.  Os ju√≠zes perguntaram algo superficialmente e em pouco tempo, e a manifesta√ß√£o terminou. </p><br><p>  N√≥s, ing√™nuos, ficamos surpresos por n√£o prestarmos aten√ß√£o √† capacidade real de trabalho do produto e, mais ainda, ao c√≥digo do juiz.  Quest√µes t√©cnicas de implementa√ß√£o n√£o lhes interessavam nem um pouco.  Poder√≠amos mostrar as l√¢mpadas piscantes do Raspberry Pi e a foto na frente. </p><br><p>  Havia a sensa√ß√£o de que, com a apresenta√ß√£o do projeto, fracassamos, porque esper√°vamos impressionar com uma solu√ß√£o real, um prot√≥tipo e n√£o apenas uma descri√ß√£o colorida de um projeto socialmente significativo e ambicioso.  Tudo foi tocado como se fosse anota√ß√µes: descrevemos o problema, a dor, nossa solu√ß√£o, mostramos como ele funciona e descrevemos os planos de desenvolvimento do projeto.  Conhecendo antecipadamente os m√©todos de julgamento, ter√≠amos feito muito diferente. </p><br><p>  Os ju√≠zes das quatro s√©ries do primeiro turno reduziram suas pontua√ß√µes e trocaram de opini√£o 15 minutos ap√≥s o final dos arremessos.  Ap√≥s o an√∫ncio dos vencedores come√ßou.  Uma atmosfera nervosa reinou no sal√£o: cansada ap√≥s a maratona de 26 horas, as pessoas queriam vencer, havia muitos times fortes e sabiam que podiam reivindicar a vit√≥ria.  E sab√≠amos disso - e esperamos pelos resultados. </p><br><p>  Para impedir que os espectadores relaxem, os resultados foram anunciados em tr√™s partes.  Os quatro primeiros finalistas, depois mais tr√™s, depois outros tr√™s.  Entre an√∫ncios e no final - performances.  N√£o entramos no top 10 e n√£o tivemos a oportunidade de entrar no grande palco.  Duas equipes de l√≠ngua russa chegaram ao top 10, uma das quais acabou se tornando a terceira.  Parab√©ns aos vencedores, eles merecem seus pr√™mios. </p><br><h1 id="5-zaklyuchenie-i-plany">  5. Conclus√£o e planos </h1><br><p>    AngelHack    .     ,   .     ‚Äî  ,  ,      . ,     ,       ,      ‚Äî   . </p><br><p>  26         IoT-   EOS.         ,   . </p><br><p>    ‚Äî      UI (  ‚Äî  -- <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Smartz</a> ),     .  - ,     blockchain-ready  ,   , ‚Äî    .  :) </p><br><p><img src="https://habrastorage.org/webt/1i/9q/nq/1i9qnqngvpnjizwpepz4n_b4gkc.gif"></p><br><p>   ,    ,         ¬´¬ª, ¬´¬ª  . .  5           .   ,         100    ,          .            SensorPay   ! </p><br><p>     : </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">Yuvasee</a>  (entrepreneur) <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">algs</a>  (hardware &amp; backend developer) <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">therealal</a>  (architect, backend developer, devops) <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">bolbu</a>  (frontend developer) <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">quantum</a>  (blockchain &amp; backend developer) </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt414803/">https://habr.com/ru/post/pt414803/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt414791/index.html">Semin√°rio "Infraestrutura virtual para desenvolvedores: oportunidades, aplicativos e servi√ßos", 28 de junho, S√£o Petersburgo</a></li>
<li><a href="../pt414793/index.html">Como os canais de pagamento e a rede de raios funcionam no Bitcoin?</a></li>
<li><a href="../pt414797/index.html">Como criamos linhas abertas na Bitrix24</a></li>
<li><a href="../pt414799/index.html">LLTR Parte 0: Detec√ß√£o autom√°tica de topologia de rede e comutadores n√£o gerenciados. Miss√£o imposs√≠vel?</a></li>
<li><a href="../pt414801/index.html">Moscow Vue.js Meetup # 2 no grupo Mail.Ru</a></li>
<li><a href="../pt414805/index.html">Semin√°rio on-line aberto "M√©todos alternativos de recrutamento"</a></li>
<li><a href="../pt414809/index.html">Swift 4.1: por que a Apple renomeou flatMap para compactMap</a></li>
<li><a href="../pt414811/index.html">Integrar Telegram e Avaya</a></li>
<li><a href="../pt414813/index.html">Criando modelos no IDE Jetbrains</a></li>
<li><a href="../pt414817/index.html">Av√≥ cibern√©tica, ou como invadimos um dia</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>