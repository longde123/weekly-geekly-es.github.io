<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ§ğŸ½ ğŸš© âœğŸ¼ Kubernetesçš„è§†è§‰æ•…éšœæ’é™¤æŒ‡å— ğŸ¤ğŸ¿ ğŸ‘©ğŸ¾â€ğŸ¤ ğŸš¤</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="æ³¨æ„äº‹é¡¹ ä½©é›·å¤« ï¼šæœ¬æ–‡æ˜¯learnk8sé¡¹ç›®å…è´¹æä¾›çš„ææ–™çš„ä¸€éƒ¨åˆ†ï¼Œè¯¥é¡¹ç›®æ•™å…¬å¸å’Œä¸ªäººç®¡ç†å‘˜å¦‚ä½•ä½¿ç”¨Kubernetesã€‚ åœ¨å…¶ä¸­ï¼Œé¡¹ç›®ç»ç†Daniele Polencicæ˜ç¡®è¯´æ˜äº†åœ¨K8sé›†ç¾¤ä¸­è¿è¡Œçš„åº”ç”¨ç¨‹åºé‡åˆ°ä¸€èˆ¬é—®é¢˜æ—¶åº”é‡‡å–çš„æ­¥éª¤ã€‚ 



 TL; DRï¼šè¿™æ˜¯ä¸€ä¸ªå¯ä»¥å¸®åŠ©æ‚¨è°ƒè¯•Kubern...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Kubernetesçš„è§†è§‰æ•…éšœæ’é™¤æŒ‡å—</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/flant/blog/484954/">  <i><b>æ³¨æ„äº‹é¡¹</b></i>  <i><b>ä½©é›·å¤«</b></i>  <i>ï¼šæœ¬æ–‡æ˜¯<a href="https://learnk8s.io/">learnk8s</a>é¡¹ç›®å…è´¹æä¾›çš„ææ–™çš„ä¸€éƒ¨åˆ†ï¼Œè¯¥é¡¹ç›®æ•™å…¬å¸å’Œä¸ªäººç®¡ç†å‘˜å¦‚ä½•ä½¿ç”¨Kubernetesã€‚</i>  <i>åœ¨å…¶ä¸­ï¼Œé¡¹ç›®ç»ç†Daniele Polencicæ˜ç¡®è¯´æ˜äº†åœ¨K8sé›†ç¾¤ä¸­è¿è¡Œçš„åº”ç”¨ç¨‹åºé‡åˆ°ä¸€èˆ¬é—®é¢˜æ—¶åº”é‡‡å–çš„æ­¥éª¤ã€‚</i> <br><br><img src="https://habrastorage.org/webt/ch/5u/xa/ch5uxanj-3ivwqu88swqyoi6bsu.png"><br><br>  TL; DRï¼šè¿™æ˜¯ä¸€ä¸ªå¯ä»¥å¸®åŠ©æ‚¨è°ƒè¯•Kubernetesä¸­çš„éƒ¨ç½²çš„å›¾è¡¨ï¼š <a name="habracut"></a><br><br> <a href=""><img src="https://habrastorage.org/webt/4r/qp/si/4rqpsie8dnplkqxahaqntpi2ssw.png"></a> <br><br>  <i>æŸ¥æ‰¾å’Œä¿®å¤é›†ç¾¤ä¸­é”™è¯¯çš„æµç¨‹å›¾ã€‚</i>  <i>åŸæ–‡ï¼ˆè‹±æ–‡ï¼‰ä»¥<a href="https://learnk8s.io/a/troubleshooting-kubernetes.pdf">PDF</a>å’Œ<a href="">å›¾åƒå½¢å¼æä¾›</a> ã€‚</i> <br><br> å°†åº”ç”¨ç¨‹åºéƒ¨ç½²åˆ°Kubernetesæ—¶ï¼Œé€šå¸¸éœ€è¦å®šä¹‰ä¸‰ä¸ªç»„ä»¶ï¼š <br><br><ul><li>  <b>éƒ¨ç½²</b>æ˜¯åˆ›å»ºç§°ä¸ºPodçš„åº”ç”¨ç¨‹åºå‰¯æœ¬çš„ç§˜è¯€ã€‚ </li><li>  <b>æœåŠ¡</b> -å†…éƒ¨è´Ÿè½½å¹³è¡¡å™¨ï¼Œç”¨äºåœ¨Podä¹‹é—´åˆ†é…æµé‡ï¼› </li><li>  <b>å…¥å£</b> -æè¿°æµé‡å¦‚ä½•ä»å¤–ç•Œæµå‘æœåŠ¡ã€‚ </li></ul><br> è¿™æ˜¯ä¸€ä¸ªç®€çŸ­çš„å›¾å½¢æ‘˜è¦ï¼š <br><br>  1ï¼‰åœ¨Kubernetesä¸­ï¼Œåº”ç”¨ç¨‹åºé€šè¿‡ä¸¤å±‚è´Ÿè½½å‡è¡¡å™¨ä»å†…éƒ¨ä¸–ç•Œæ¥æ”¶æµé‡ï¼šå†…éƒ¨å’Œå¤–éƒ¨ã€‚ <br><br><img src="https://habrastorage.org/webt/3v/cy/z9/3vcyz9a-2ciiqbh9he7idgvo7uy.png"><br><br>  2ï¼‰å†…éƒ¨å¹³è¡¡å™¨ç§°ä¸ºServiceï¼Œå¤–éƒ¨å¹³è¡¡å™¨ç§°ä¸ºIngressã€‚ <br><br><img src="https://habrastorage.org/webt/23/mn/zc/23mnzcfo_b3niccdivn4bc4vzei.png"><br><br>  3ï¼‰éƒ¨ç½²ä¼šåˆ›å»ºåŠèˆ±å¹¶å¯¹å…¶è¿›è¡Œç›‘è§†ï¼ˆå®ƒä»¬ä¸æ˜¯æ‰‹åŠ¨åˆ›å»ºçš„ï¼‰ã€‚ <br><br><img src="https://habrastorage.org/webt/4j/c2/h9/4jc2h9pgzbxmkon4ewkbeuf0vhc.png"><br><br> å‡è®¾æ‚¨è¦åœ¨<i>Hello Worldä¸­</i>éƒ¨ç½²ä¸€ä¸ªç®€å•çš„åº”ç”¨ç¨‹åºã€‚ å®ƒçš„YAMLé…ç½®å¦‚ä¸‹æ‰€ç¤ºï¼š <br><br><pre><code class="plaintext hljs">apiVersion: apps/v1 kind: Deployment # &lt;&lt;&lt; metadata: name: my-deployment labels: track: canary spec: selector: matchLabels: any-name: my-app template: metadata: labels: any-name: my-app spec: containers: - name: cont1 image: learnk8s/app:1.0.0 ports: - containerPort: 8080 --- apiVersion: v1 kind: Service # &lt;&lt;&lt; metadata: name: my-service spec: ports: - port: 80 targetPort: 8080 selector: name: app --- apiVersion: networking.k8s.io/v1beta1 kind: Ingress # &lt;&lt;&lt; metadata: name: my-ingress spec: rules: - http: paths: - backend: serviceName: app servicePort: 80 path: /</code> </pre> <br> å®šä¹‰å¾ˆé•¿ï¼Œå¾ˆå®¹æ˜“æ··æ·†ç»„ä»¶ä¹‹é—´çš„å…³ç³»ã€‚ <br><br> ä¾‹å¦‚ï¼š <br><br><ul><li> ä»€ä¹ˆæ—¶å€™ä½¿ç”¨ç«¯å£80ï¼Œä»€ä¹ˆæ—¶å€™ä½¿ç”¨8080ï¼Ÿ </li><li> æ˜¯å¦åº”è¯¥ä¸ºæ¯ä¸ªæœåŠ¡åˆ›å»ºä¸€ä¸ªæ–°ç«¯å£ï¼Œä»¥å…å®ƒä»¬å†²çªï¼Ÿ </li><li> æ ‡ç­¾åç§°é‡è¦å—ï¼Ÿ ä»–ä»¬åˆ°å¤„éƒ½åº”è¯¥ä¸€æ ·å—ï¼Ÿ </li></ul><br> åœ¨ä¸“æ³¨äºè°ƒè¯•ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å›é¡¾ä¸€ä¸‹è¿™ä¸‰ä¸ªç»„ä»¶å¦‚ä½•ç›¸äº’å…³è”ã€‚ è®©æˆ‘ä»¬ä»éƒ¨ç½²å’ŒæœåŠ¡å¼€å§‹ã€‚ <br><br><h2> è¿æ¥éƒ¨ç½²'aå’ŒæœåŠ¡'a </h2><br> æ‚¨ä¼šæ„Ÿåˆ°æƒŠè®¶ï¼Œä½†æ˜¯éƒ¨ç½²å’ŒæœåŠ¡æ²¡æœ‰ä»¥ä»»ä½•æ–¹å¼è¿æ¥ã€‚ è€Œæ˜¯ï¼ŒæœåŠ¡ç›´æ¥æŒ‡å‘Podï¼Œç»•è¿‡éƒ¨ç½²ã€‚ <br><br> å› æ­¤ï¼Œæˆ‘ä»¬å¯¹Podå’ŒæœåŠ¡å¦‚ä½•ç›¸äº’å…³è”æ„Ÿå…´è¶£ã€‚ è¦è®°ä½çš„ä¸‰ä»¶äº‹ï¼š <br><br><ol><li> æœåŠ¡<code>selector</code>å¿…é¡»è‡³å°‘åŒ¹é…ä¸€ä¸ªPodæ ‡ç­¾ã€‚ </li><li>  <code>targetPort</code>å¿…é¡»ä¸Podå†…çš„<code>containerPort</code> <code>targetPort</code>ç›¸åŒ¹é…ã€‚ </li><li>  <code>port</code>æœåŠ¡å¯ä»¥æ˜¯ä»»ä½•ä¸œè¥¿ã€‚ ä¸åŒçš„æœåŠ¡å¯ä»¥ä½¿ç”¨åŒä¸€ç«¯å£ï¼Œå› ä¸ºå®ƒä»¬å…·æœ‰ä¸åŒçš„IPåœ°å€ã€‚ </li></ol><br> ä¸‹å›¾ä»¥å›¾å½¢å½¢å¼è¡¨ç¤ºä»¥ä¸Šæ‰€æœ‰å†…å®¹ï¼š <br><br>  1ï¼‰æƒ³è±¡ä¸€ä¸‹ï¼Œè¯¥æœåŠ¡å°†æµé‡å®šå‘åˆ°æŸä¸ªåŠèˆ±ï¼š <br><br><img src="https://habrastorage.org/webt/2a/e5/8f/2ae58fcgoi7aifmcr5rl_0bseym.png"><br><br>  2ï¼‰åˆ›å»ºå®¹å™¨æ—¶ï¼Œå¿…é¡»ä¸ºå®¹å™¨ä¸­çš„æ¯ä¸ªå®¹å™¨æŒ‡å®š<code>containerPort</code> ï¼š <br><br><img src="https://habrastorage.org/webt/xc/fa/ow/xcfaowomhbtqhebhodgzhzrkupc.png"><br><br>  3ï¼‰åˆ›å»ºæœåŠ¡æ—¶ï¼Œå¿…é¡»æŒ‡å®š<code>port</code>å’Œ<code>targetPort</code> ã€‚  <i>ä½†æ˜¯ï¼Œå“ªä¸€ä¸ªæ˜¯é€šè¿‡å®¹å™¨è¿æ¥çš„å‘¢ï¼Ÿ</i> <br><br><img src="https://habrastorage.org/webt/vg/wj/nd/vgwjnde0xyzdblwamomfxjaxb40.png"><br><br>  4ï¼‰é€šè¿‡<code>targetPort</code> ã€‚ å®ƒåº”è¯¥ä¸<code>containerPort</code>åŒ¹é…ã€‚ <br><br><img src="https://habrastorage.org/webt/q4/yx/qn/q4yxqnkxxilupalikahmqqp09x8.png"><br><br>  5ï¼‰å‡è®¾å®¹å™¨ä¸­çš„ç«¯å£3000å·²æ‰“å¼€ï¼Œåˆ™<code>targetPort</code>å€¼åº”ç›¸åŒã€‚ <br><br><img src="https://habrastorage.org/webt/cq/tj/-s/cqtj-srznih70qh7bxs3w_l7bis.png"><br><br> åœ¨YAMLæ–‡ä»¶ä¸­ï¼Œæ ‡ç­¾å’Œ<code>ports</code> / <code>targetPort</code>å¿…é¡»åŒ¹é…ï¼š <br><br><pre> <code class="plaintext hljs">apiVersion: apps/v1 kind: Deployment metadata: name: my-deployment labels: track: canary spec: selector: matchLabels: any-name: my-app template: metadata: labels: # &lt;&lt;&lt; any-name: my-app # &lt;&lt;&lt; spec: containers: - name: cont1 image: learnk8s/app:1.0.0 ports: - containerPort: 8080 # &lt;&lt;&lt; --- apiVersion: v1 kind: Service metadata: name: my-service spec: ports: - port: 80 targetPort: 8080 # &lt;&lt;&lt; selector: # &lt;&lt;&lt; any-name: my-app # &lt;&lt;&lt;</code> </pre> <br>  <i><code>track: canary</code> â€œéƒ¨ç½²â€éƒ¨åˆ†é¡¶éƒ¨çš„â€œ <code>track: canary</code> ï¼Ÿ</i>  <i>åº”è¯¥åŒ¹é…å—ï¼Ÿ</i> <br><br> è¯¥æ ‡ç­¾æŒ‡çš„æ˜¯éƒ¨ç½²ï¼ŒæœåŠ¡ä¸ä½¿ç”¨å®ƒæ¥è·¯ç”±æµé‡ã€‚ æ¢å¥è¯è¯´ï¼Œå¯ä»¥å°†å…¶åˆ é™¤æˆ–åˆ†é…å…¶ä»–å€¼ã€‚ <br><br>  <i>é‚£ä¹ˆ<code>matchLabels</code>é€‰æ‹©å™¨å‘¢ï¼Ÿ</i> <br><br>  <b>å®ƒåº”å§‹ç»ˆä¸Podçš„æ ‡ç­¾åŒ¹é…</b> ï¼Œå› ä¸ºDeploymentä¼šä½¿ç”¨å®ƒæ¥è·Ÿè¸ªPodã€‚ <br><br>  <i>å‡è®¾æ‚¨è¿›è¡Œäº†æ­£ç¡®çš„ç¼–è¾‘ã€‚</i>  <i>å¦‚ä½•æ£€æŸ¥ï¼Ÿ</i> <br><br> æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ£€æŸ¥å®¹å™¨æ ‡ç­¾ï¼š <br><br><pre> <code class="bash hljs">kubectl get pods --show-labels</code> </pre> <br> æˆ–è€…ï¼Œå¦‚æœPodå±äºå¤šä¸ªåº”ç”¨ç¨‹åºï¼š <br><br><pre> <code class="bash hljs">kubectl get pods --selector any-name=my-app --show-labels</code> </pre> <br> å…¶ä¸­<code>any-name=my-app</code>æ˜¯<code>any-name: my-app</code>æ ‡ç­¾ã€‚ <br><br>  <i>æœ‰ä»€ä¹ˆå›°éš¾å—ï¼Ÿ</i> <br><br> æ‚¨å¯ä»¥è¿æ¥åˆ°åŠèˆ±ï¼ ä¸ºæ­¤ï¼Œè¯·åœ¨kubectlä¸­ä½¿ç”¨<code>port-forward</code>å‘½ä»¤ã€‚ å®ƒå…è®¸æ‚¨è¿æ¥åˆ°æœåŠ¡å¹¶æ£€æŸ¥è¿æ¥ã€‚ <br><br><pre> <code class="bash hljs">kubectl port-forward service/&lt;service name&gt; 3000:80</code> </pre> <br> åœ¨è¿™é‡Œï¼š <br><br><ul><li>  <code>service/&lt;service name&gt;</code> -æœåŠ¡åç§°ï¼› å°±æˆ‘ä»¬è€Œè¨€ï¼Œè¿™æ˜¯<code>my-service</code> ï¼› </li><li>  3000-æ‚¨è¦åœ¨è®¡ç®—æœºä¸Šæ‰“å¼€çš„ç«¯å£ï¼› </li><li>  80-æœåŠ¡çš„<code>port</code>å­—æ®µä¸­æŒ‡å®šçš„<code>port</code> ã€‚ </li></ul><br> å¦‚æœèƒ½å¤Ÿå»ºç«‹è¿æ¥ï¼Œåˆ™è¯´æ˜è®¾ç½®æ­£ç¡®ã€‚ <br><br> å¦‚æœæ— æ³•å»ºç«‹è¿æ¥ï¼Œåˆ™è¯´æ˜æ ‡ç­¾æœ‰é—®é¢˜æˆ–ç«¯å£ä¸åŒ¹é…ã€‚ <br><br><h2> æœåŠ¡ä¸å…¥å£çš„è¿æ¥ </h2><br> æä¾›å¯¹åº”ç”¨ç¨‹åºè®¿é—®æƒé™çš„ä¸‹ä¸€æ­¥ä¸é…ç½®Ingressæœ‰å…³ã€‚ å…¥å£åº”è¯¥çŸ¥é“å¦‚ä½•æ‰¾åˆ°æœåŠ¡ï¼Œç„¶åæ‰¾åˆ°è±†èšå¹¶å°†æµé‡å¼•å‘å®ƒä»¬ã€‚  Ingressé€šè¿‡åç§°å’Œå¼€æ”¾ç«¯å£æ‰¾åˆ°æ‰€éœ€çš„æœåŠ¡ã€‚ <br><br> åœ¨Ingresså’ŒServiceçš„æè¿°ä¸­ï¼Œä¸¤ä¸ªå‚æ•°å¿…é¡»åŒ¹é…ï¼š <br><br><ol><li>  Ingressä¸­çš„<code>servicePort</code>å¿…é¡»ä¸Serviceä¸­çš„<code>port</code>å‚æ•°åŒ¹é…ï¼› </li><li>  Ingressä¸­çš„<code>serviceName</code>å¿…é¡»ä¸Serviceä¸­çš„<code>name</code>å­—æ®µåŒ¹é…ã€‚ </li></ol><br> ä¸‹å›¾æ€»ç»“äº†ç«¯å£çš„è¿æ¥ï¼š <br><br>  1ï¼‰å¦‚æ‚¨æ‰€çŸ¥ï¼ŒServiceåœ¨ç‰¹å®š<code>port</code>ä¸Šä¾¦å¬ï¼š <br><br><img src="https://habrastorage.org/webt/9q/t0/fz/9qt0fzsyme9mnrd4ki07ezamnkg.png"><br><br>  2ï¼‰Ingressæœ‰ä¸€ä¸ªåä¸º<code>servicePort</code>çš„å‚æ•°ï¼š <br><br><img src="https://habrastorage.org/webt/rn/du/yw/rnduyw4xvfmpjmhup8fy9ao2d1a.png"><br><br>  3ï¼‰æ­¤å‚æ•°ï¼ˆ <code>servicePort</code> ï¼‰åº”å§‹ç»ˆä¸æœåŠ¡å®šä¹‰ä¸­çš„<code>port</code>åŒ¹é…ï¼š <br><br><img src="https://habrastorage.org/webt/1d/ap/ty/1daptyulxphnbb2dt6uben-lnzk.png"><br><br>  4ï¼‰å¦‚æœåœ¨æœåŠ¡ä¸­æŒ‡å®šäº†ç«¯å£80ï¼Œåˆ™<code>servicePort</code>ä¹Ÿå¿…é¡»ä¸º80ï¼š <br><br><img src="https://habrastorage.org/webt/nc/mi/dl/ncmidlxiegmtmhtozaxxqhznaya.png"><br><br> å®é™…ä¸Šï¼Œæ‚¨éœ€è¦æ³¨æ„ä»¥ä¸‹å‡ è¡Œï¼š <br><br><pre> <code class="plaintext hljs">apiVersion: v1 kind: Service metadata: name: my-service # &lt;&lt;&lt; spec: ports: - port: 80 # &lt;&lt;&lt; targetPort: 8080 selector: any-name: my-app --- apiVersion: networking.k8s.io/v1beta1 kind: Ingress metadata: name: my-ingress spec: rules: - http: paths: - backend: serviceName: my-service # &lt;&lt;&lt; servicePort: 80 # &lt;&lt;&lt; path: /</code> </pre> <br>  <i>å¦‚ä½•æ£€æŸ¥Ingressæ˜¯å¦æ­£å¸¸å·¥ä½œï¼Ÿ</i> <br><br> æ‚¨å¯ä»¥å°†è¯¥æ–¹æ³•ä¸<code>kubectl port-forward</code> ï¼Œä½†éœ€è¦è¿æ¥åˆ°Ingressæ§åˆ¶å™¨è€Œä¸æ˜¯æœåŠ¡ã€‚ <br><br> é¦–å…ˆï¼Œæ‚¨éœ€è¦ä½¿ç”¨Ingressæ§åˆ¶å™¨æ‰¾å‡ºPodçš„åç§°ï¼š <br><br><pre> <code class="bash hljs">kubectl get pods --all-namespaces NAMESPACE NAME READY STATUS kube-system coredns-5644d7b6d9-jn7cq 1/1 Running kube-system etcd-minikube 1/1 Running kube-system kube-apiserver-minikube 1/1 Running kube-system kube-controller-manager-minikube 1/1 Running kube-system kube-proxy-zvf2h 1/1 Running kube-system kube-scheduler-minikube 1/1 Running kube-system nginx-ingress-controller-6fc5bcc 1/1 Running</code> </pre> <br> æ‰¾åˆ°Ingressçª—æ ¼ï¼ˆå®ƒå¯èƒ½å¼•ç”¨å…¶ä»–åç§°ç©ºé—´ï¼‰ï¼Œç„¶åè¿è¡Œ<code>describe</code>å‘½ä»¤æ‰¾å‡ºç«¯å£å·ï¼š <br><br><pre> <code class="bash hljs">kubectl describe pod nginx-ingress-controller-6fc5bcc \ --namespace kube-system \ | grep Ports Ports: 80/TCP, 443/TCP, 18080/TCP</code> </pre> <br> æœ€åï¼Œè¿æ¥åˆ°åŠèˆ±ï¼š <br><br><pre> <code class="bash hljs">kubectl port-forward nginx-ingress-controller-6fc5bcc 3000:80 --namespace kube-system</code> </pre> <br> ç°åœ¨ï¼Œæ¯æ¬¡æ‚¨å°†è¯·æ±‚å‘é€åˆ°è®¡ç®—æœºä¸Šçš„ç«¯å£3000æ—¶ï¼Œå®ƒå°†ä½¿ç”¨Ingressæ§åˆ¶å™¨é‡å®šå‘åˆ°Podçš„ç«¯å£80ã€‚ é€šè¿‡è½¬åˆ°<a href="http://localhost:3000/">httpï¼š// localhostï¼š3000</a> ï¼Œæ‚¨åº”è¯¥çœ‹åˆ°è¯¥åº”ç”¨ç¨‹åºåˆ›å»ºçš„é¡µé¢ã€‚ <br><br><h2> ç«¯å£æ‘˜è¦ </h2><br> è®©æˆ‘ä»¬å†æ¬¡è®°ä½å“ªäº›ç«¯å£å’Œæ ‡ç­¾åº”è¯¥åŒ¹é…ï¼š <br><br><ol><li> æœåŠ¡å®šä¹‰ä¸­çš„é€‰æ‹©å™¨å¿…é¡»ä¸podæ ‡ç­¾åŒ¹é…ï¼› </li><li> æœåŠ¡å®šä¹‰ä¸­<code>targetPort</code>å¿…é¡»ä¸podå†…çš„<code>containerPort</code> containerPortç›¸åŒ¹é…ï¼› </li><li> æœåŠ¡å®šä¹‰ä¸­çš„<code>port</code>å¯ä»¥æ˜¯ä»»ä½•ä¸œè¥¿ã€‚ ä¸åŒçš„æœåŠ¡å¯ä»¥ä½¿ç”¨åŒä¸€ç«¯å£ï¼Œå› ä¸ºå®ƒä»¬å…·æœ‰ä¸åŒçš„IPåœ°å€ã€‚ </li><li>  <code>servicePort</code>å…¥å£å¿…é¡»ä¸æœåŠ¡å®šä¹‰ä¸­çš„<code>port</code>åŒ¹é…ï¼› </li><li> æœåŠ¡åç§°å¿…é¡»ä¸Ingressä¸­çš„<code>serviceName</code>å­—æ®µåŒ¹é…ã€‚ </li></ol><br>  lasï¼Œä»…ä»…çŸ¥é“å¦‚ä½•æ­£ç¡®æ„é€ YAMLé…ç½®è¿˜ä¸å¤Ÿã€‚ <br><br>  <i>å‡ºé—®é¢˜äº†æ€ä¹ˆåŠï¼Ÿ</i> <br><br> åŠèˆ±å¯èƒ½æ— æ³•å¯åŠ¨æˆ–å´©æºƒã€‚ <br><br><h2> è§£å†³Kubernetesä¸­åº”ç”¨ç¨‹åºæ•…éšœçš„3ä¸ªæ­¥éª¤ </h2><br> åœ¨è°ƒè¯•éƒ¨ç½²ä¹‹å‰ï¼Œæ‚¨éœ€è¦å¯¹Kubernetesçš„å·¥ä½œæ–¹å¼æœ‰å……åˆ†çš„äº†è§£ã€‚ <br><br> ç”±äºä¸‹è½½åˆ°K8sçš„æ¯ä¸ªåº”ç”¨ç¨‹åºä¸­éƒ½æœ‰ä¸‰ä¸ªç»„ä»¶ï¼Œå› æ­¤åº”è¯¥ä»æœ€åº•éƒ¨å¼€å§‹ä»¥ä¸€å®šé¡ºåºå¯¹å…¶è¿›è¡Œè°ƒè¯•ã€‚ <br><br><ol><li> é¦–å…ˆï¼Œæ‚¨éœ€è¦ç¡®ä¿åŠèˆ±èƒ½å¤Ÿæ­£å¸¸å·¥ä½œï¼Œç„¶å... </li><li> æ£€æŸ¥æœåŠ¡æ˜¯å¦å°†æµé‡ä¼ é€’åˆ°Podï¼Œç„¶å... </li><li> æ£€æŸ¥æ˜¯å¦æ­£ç¡®é…ç½®äº†Ingressã€‚ </li></ol><br> è§†è§‰å‘ˆç°ï¼š <br><br>  1ï¼‰å¼€å§‹å¯»æ‰¾é—®é¢˜åº”è¯¥ä»åº•éƒ¨å¼€å§‹ã€‚ é¦–å…ˆæ£€æŸ¥Podæ˜¯å¦å…·æœ‰<code>Ready</code>å’Œ<code>Running</code>çŠ¶æ€ï¼š <br><br><img src="https://habrastorage.org/webt/f-/lc/iz/f-lcizmfav5sb1sc7hvu8samwes.png"><br><br>  2ï¼‰å¦‚æœPodä¸º<code>Ready</code> ï¼Œåˆ™åº”ç¡®å®šæœåŠ¡æ˜¯å¦åœ¨Podä¹‹é—´åˆ†é…æµé‡ï¼š <br><br><img src="https://habrastorage.org/webt/yg/we/bu/ygwebumu8ga9lmd7krineuw38mq.png"><br><br>  3ï¼‰æœ€åï¼Œæ‚¨éœ€è¦åˆ†ææœåŠ¡ä¸Ingressä¹‹é—´çš„è¿æ¥ï¼š <br><br><img src="https://habrastorage.org/webt/y7/ze/uz/y7zeuzkhzgsdzcjmng2ei4fjrxg.png"><br><br><h2>  1.åŠèˆ±è¯Šæ–­ </h2><br> åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œé—®é¢˜å‡ºåœ¨è±†èšä¸Šã€‚ ç¡®ä¿åŠèˆ±å¤„äºâ€œ <code>Ready</code>ä¸”æ­£åœ¨<code>Running</code> ã€‚ æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿›è¡ŒéªŒè¯ï¼š <br><br><pre> <code class="bash hljs">kubectl get pods NAME READY STATUS RESTARTS AGE app1 0/1 ImagePullBackOff 0 47h app2 0/1 Error 0 47h app3-76f9fcd46b-xbv4k 1/1 Running 1 47h</code> </pre> <br> åœ¨ä¸Šé¢å‘½ä»¤çš„è¾“å‡ºä¸­ï¼Œæœ€åä¸€ä¸ªPodè¢«åˆ—ä¸º<code>Running</code>å’Œ<code>Ready</code> ï¼Œè€Œå¯¹äºå…¶ä»–ä¸¤ä¸ªPodåˆ™æ²¡æœ‰ã€‚ <br><br>  <i>å¦‚ä½•ç†è§£å‡ºäº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ</i> <br><br> æœ‰å››ä¸ªç”¨äºè¯Šæ–­Podçš„æœ‰ç”¨å‘½ä»¤ï¼š <br><br><ol><li>  <code>kubectl logs &lt; pod'&gt;</code>å…è®¸æ‚¨ä»podçš„å®¹å™¨ä¸­æå–æ—¥å¿—ï¼› </li><li>  <code>kubectl describe pod &lt; pod'&gt;</code>å…è®¸æ‚¨æŸ¥çœ‹ä¸podç›¸å…³çš„äº‹ä»¶åˆ—è¡¨ï¼› </li><li>  <code>kubectl get pod &lt; pod'&gt;</code>å…è®¸æ‚¨è·å–å­˜å‚¨åœ¨Kubernetesä¸­çš„<code>kubectl get pod &lt; pod'&gt;</code>çš„YAMLé…ç½®; </li><li>  <code>kubectl exec -ti &lt; pod'&gt; bash</code>å…è®¸æ‚¨åœ¨å…¶ä¸­ä¸€ä¸ªpodå®¹å™¨ä¸­è¿è¡Œäº¤äº’å¼å‘½ä»¤shell </li></ol><br>  <i>é€‰æ‹©å“ªä¸€ä¸ªï¼Ÿ</i> <br><br> äº‹å®æ˜¯ï¼Œæ²¡æœ‰é€šç”¨å›¢é˜Ÿã€‚ è¿™äº›åº”ç»“åˆä½¿ç”¨ã€‚ <br><br><h3> å¸¸è§åŠèˆ±é—®é¢˜ </h3><br>  podé”™è¯¯ä¸»è¦æœ‰ä¸¤ç§ç±»å‹ï¼šå¯åŠ¨é”™è¯¯å’Œè¿è¡Œæ—¶é”™è¯¯ã€‚ <br><br> å¯åŠ¨é”™è¯¯ï¼š <br><br><ul><li> <code>ImagePullBackoff</code> </li> <li> <code>ImageInspectError</code> </li> <li> <code>ErrImagePull</code> </li> <li> <code>ErrImageNeverPull</code> </li> <li> <code>RegistryUnavailable</code> </li> <li> <code>InvalidImageName</code> </li> </ul><br> è¿è¡Œæ—¶é”™è¯¯ï¼š <br><br><ul><li> <code>CrashLoopBackOff</code> </li> <li> <code>RunContainerError</code> </li> <li> <code>KillContainerError</code> </li> <li> <code>VerifyNonRootError</code> </li> <li> <code>RunInitContainerError</code> </li> <li> <code>CreatePodSandboxError</code> </li> <li> <code>ConfigPodSandboxError</code> </li> <li> <code>KillPodSandboxError</code> </li> <li> <code>SetupNetworkError</code> </li> <li> <code>TeardownNetworkError</code> </li> </ul><br> æœ‰äº›é”™è¯¯æ¯”å…¶ä»–é”™è¯¯æ›´å¸¸è§ã€‚ ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§é”™è¯¯ä»¥åŠè§£å†³æ–¹æ³•ã€‚ <br><br><h4>  ImagePullBackOff </h4><br> å½“Kubernetesæ— æ³•è·å–å…¶ä¸­ä¸€ä¸ªPodå®¹å™¨çš„å›¾åƒæ—¶ï¼Œå°†å‡ºç°æ­¤é”™è¯¯ã€‚ è¿™æ˜¯æœ€å¸¸è§çš„ä¸‰ä¸ªåŸå› ï¼š <br><br><ol><li> å›¾åƒåç§°æŒ‡å®šä¸æ­£ç¡®-ä¾‹å¦‚ï¼Œæ‚¨åœ¨å…¶ä¸­è¾“å…¥é”™è¯¯ï¼Œæˆ–è€…å›¾åƒä¸å­˜åœ¨ï¼› </li><li> æŒ‡å®šäº†ä¸å­˜åœ¨çš„å›¾åƒæ ‡ç­¾ï¼› </li><li> è¯¥å›¾åƒå­˜å‚¨åœ¨ç§æœ‰æ³¨å†Œè¡¨ä¸­ï¼ŒKubernetesæ— æƒè®¿é—®å®ƒã€‚ </li></ol><br> å‰ä¸¤ä¸ªåŸå› å¾ˆå®¹æ˜“æ¶ˆé™¤-åªéœ€ä¿®å¤å›¾åƒåç§°å’Œæ ‡ç­¾å³å¯ã€‚ å¦‚æœæ˜¯åè€…ï¼Œåˆ™éœ€è¦åœ¨Secretä¸­è¾“å…¥ç§æœ‰æ³¨å†Œè¡¨çš„å‡­æ®ï¼Œå¹¶åœ¨podä¸­æ·»åŠ æŒ‡å‘å®ƒçš„é“¾æ¥ã€‚  Kubernetesæ–‡æ¡£ä¸­<a href="https://kubernetes.io/docs/tasks/configure-pod-container/pull-image-private-registry/">æœ‰ä¸€ä¸ª</a>å¦‚ä½•å®Œæˆæ­¤æ“ä½œ<a href="https://kubernetes.io/docs/tasks/configure-pod-container/pull-image-private-registry/">çš„ç¤ºä¾‹</a> ã€‚ <br><br><h4>  CrashLoopBackOff </h4><br> å¦‚æœå®¹å™¨æ— æ³•å¯åŠ¨ï¼Œåˆ™Kubeneteså°†å¼•å‘CrashLoopBackOffé”™è¯¯ã€‚ é€šå¸¸åœ¨ä»¥ä¸‹æƒ…å†µä¸‹å‘ç”Ÿï¼š <br><br><ol><li> åº”ç”¨ç¨‹åºä¸­å­˜åœ¨ä¸€ä¸ªé”™è¯¯ï¼Œæ— æ³•å¯åŠ¨ã€‚ </li><li> å®¹å™¨<a href="https://stackoverflow.com/questions/41604499/my-kubernetes-pods-keep-crashing-with-crashloopbackoff-but-i-cant-find-any-lo">é…ç½®ä¸æ­£ç¡®</a> ï¼› </li><li> æ´»åŠ›æµ‹è¯•å¤±è´¥å¤ªå¤šæ¬¡äº†ã€‚ </li></ol><br> æ‚¨å¿…é¡»å°è¯•ä»å®¹å™¨ä¸­è·å–æ—¥å¿—ï¼Œä»¥æ‰¾å‡ºå…¶å¤±è´¥çš„åŸå› ã€‚ å¦‚æœéš¾ä»¥è®¿é—®æ—¥å¿—ï¼Œå› ä¸ºå®¹å™¨é‡å¯å¤ªå¿«ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š <br><br><pre> <code class="bash hljs">kubectl logs &lt;pod-name&gt; --previous</code> </pre> <br> å®ƒæ˜¾ç¤ºæ¥è‡ªå…ˆå‰å®¹å™¨è½®å›çš„é”™è¯¯æ¶ˆæ¯ã€‚ <br><br><h4>  RunContainerError </h4><br> å½“å®¹å™¨æ— æ³•å¯åŠ¨æ—¶ï¼Œä¼šå‘ç”Ÿæ­¤é”™è¯¯ã€‚ å®ƒå¯¹åº”äºåº”ç”¨ç¨‹åºå¯åŠ¨ä¹‹å‰çš„æ—¶åˆ»ã€‚ é€šå¸¸ï¼Œå…¶åŸå› æ˜¯é…ç½®ä¸æ­£ç¡®ï¼Œä¾‹å¦‚ï¼š <br><br><ul><li> å°è¯•æŒ‚è½½ä¸å­˜åœ¨çš„å·ï¼Œä¾‹å¦‚ConfigMapæˆ–Secretsï¼› </li><li> å°è¯•å°†åªè¯»å·æŒ‚è½½ä¸ºè¯»å†™å·ã€‚ </li></ul><br>  <code>kubectl describe pod &lt;pod-name&gt;</code>å‘½ä»¤éå¸¸é€‚åˆåˆ†ææ­¤ç±»é”™è¯¯ã€‚ <br><br><h3> æš‚æŒ‚çš„è±†èš </h3><br> åˆ›å»ºåï¼Œçª—æ ¼å°†ä¿æŒâ€œ <code>Pending</code>çŠ¶æ€ã€‚ <br><br>  <i>ä¸ºä»€ä¹ˆä¼šè¿™æ ·å‘¢ï¼Ÿ</i> <br><br> ä»¥ä¸‹æ˜¯å¯èƒ½çš„åŸå› ï¼ˆæˆ‘è®¤ä¸ºè°ƒåº¦ç¨‹åºå·¥ä½œæ­£å¸¸ï¼‰ï¼š <br><br><ol><li> ç¾¤é›†æ²¡æœ‰è¶³å¤Ÿçš„èµ„æºï¼ˆä¾‹å¦‚å¤„ç†èƒ½åŠ›å’Œå†…å­˜ï¼‰æ¥è¿è¡ŒPodã€‚ </li><li>  <code>ResourceQuota</code>å¯¹è±¡å®‰è£…åœ¨ç›¸åº”çš„åç§°ç©ºé—´ä¸­ï¼Œåˆ›å»ºpodä¼šä½¿è¯¥åç§°ç©ºé—´è¶…å‡ºé…é¢ã€‚ </li><li>  Podä¸Pending <code>PersistentVolumeClaim</code>ç»‘å®šã€‚ </li></ol><br> åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå»ºè®®ä½¿ç”¨<code>kubectl describe</code>å‘½ä»¤å¹¶æ£€æŸ¥â€œ <code>Events</code>éƒ¨åˆ†ï¼š <br><br><pre> <code class="bash hljs">kubectl describe pod &lt;pod name&gt;</code> </pre> <br> å¦‚æœå‘ç”Ÿä¸<code>ResourceQuotas</code>ç›¸å…³çš„é”™è¯¯ï¼Œå»ºè®®ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹é›†ç¾¤æ—¥å¿— <br><br><pre> <code class="bash hljs">kubectl get events --sort-by=.metadata.creationTimestamp</code> </pre> <br><h3> æœªå‡†å¤‡å¥½è±†èš </h3><br> å¦‚æœçª—æ ¼åˆ—å‡ºä¸ºâ€œæ­£åœ¨<code>Running</code> ï¼Œä½†æœªå¤„äºâ€œ <code>Ready</code>çŠ¶æ€ï¼Œåˆ™â€œå°±ç»ªâ€ <i>æ¢é’ˆ</i>å°†å¤±è´¥ã€‚ <br><br> å‘ç”Ÿè¿™ç§æƒ…å†µæ—¶ï¼Œpodæ— æ³•è¿æ¥åˆ°æœåŠ¡ï¼Œæµé‡ä¹Ÿä¸ä¼šæµå‘è¯¥æœåŠ¡ã€‚ å‡†å¤‡å°±ç»ªæµ‹è¯•ç”±äºåº”ç”¨ç¨‹åºé—®é¢˜è€Œå¤±è´¥ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¦æŸ¥æ‰¾é”™è¯¯ï¼Œæ‚¨éœ€è¦åˆ†æ<code>kubectl describe</code>å‘½ä»¤è¾“å‡ºä¸­çš„â€œ <code>Events</code>éƒ¨åˆ†ã€‚ <br><br><h2>  2.æœåŠ¡è¯Šæ–­ </h2><br> å¦‚æœpodåˆ—ä¸º<code>Running</code> and <code>Ready</code> ï¼Œä½†åº”ç”¨ç¨‹åºä»ç„¶æ²¡æœ‰å“åº”ï¼Œåˆ™åº”æ£€æŸ¥æœåŠ¡è®¾ç½®ã€‚ <br><br> æœåŠ¡æ ¹æ®å…¶æ ‡ç­¾å°†æµé‡è·¯ç”±åˆ°Podã€‚ å› æ­¤ï¼Œè¦åšçš„ç¬¬ä¸€ä»¶äº‹æ˜¯æ£€æŸ¥æœåŠ¡ä¸­æœ‰å¤šå°‘ä¸ªPodã€‚ ä¸ºæ­¤ï¼Œæ‚¨å¯ä»¥æ£€æŸ¥æœåŠ¡ä¸­çš„ç«¯ç‚¹ï¼š <br><br><pre> <code class="bash hljs">kubectl describe service &lt;service-name&gt; | grep Endpoints</code> </pre> <br> ç«¯ç‚¹æ˜¯ä¸€å¯¹æ ¼å¼ä¸º<code>&lt;IP-:&gt;</code> ï¼Œå¹¶ä¸”è¾“å‡ºä¸­å¿…é¡»å­˜åœ¨è‡³å°‘ä¸€å¯¹è¿™æ ·çš„å€¼ï¼ˆå³ï¼Œè‡³å°‘ä¸€ä¸ªpodä¸è¯¥æœåŠ¡ä¸€èµ·ä½¿ç”¨ï¼‰ã€‚ <br><br> å¦‚æœâ€œ <code>Endpoins</code>éƒ¨åˆ†<code>Endpoins</code>ç©ºï¼Œåˆ™å¯èƒ½æœ‰ä¸¤ä¸ªé€‰é¡¹ï¼š <br><br><ol><li> æ²¡æœ‰å¸¦æœ‰æ­£ç¡®æ ‡ç­¾çš„Podï¼ˆæç¤ºï¼šæ£€æŸ¥æ˜¯å¦æ­£ç¡®é€‰æ‹©äº†åç§°ç©ºé—´ï¼‰ï¼› </li><li> é€‰æ‹©å™¨ä¸­çš„æœåŠ¡æ ‡ç­¾æœ‰é”™è¯¯ã€‚ </li></ol><br> å¦‚æœæ‚¨çœ‹åˆ°ç«¯ç‚¹åˆ—è¡¨ï¼Œä½†ä»ç„¶æ— æ³•è®¿é—®åº”ç”¨ç¨‹åºï¼Œåˆ™å¯èƒ½çš„ç½ªé­ç¥¸é¦–æ˜¯æœåŠ¡æè¿°ä¸­<code>targetPort</code>ä¸­çš„é”™è¯¯ã€‚ <br><br>  <i>å¦‚ä½•æ£€æŸ¥æœåŠ¡çš„å¯æœåŠ¡æ€§ï¼Ÿ</i> <br><br> æ— è®ºæœåŠ¡ç±»å‹å¦‚ä½•ï¼Œéƒ½å¯ä»¥ä½¿ç”¨<code>kubectl port-forward</code>å‘½ä»¤è¿æ¥åˆ°è¯¥æœåŠ¡ï¼š <br><br><pre> <code class="bash hljs">kubectl port-forward service/&lt;service-name&gt; 3000:80</code> </pre> <br> åœ¨è¿™é‡Œï¼š <br><br><ul><li>  <code>&lt;service-name&gt;</code> - <code>&lt;service-name&gt;</code> ï¼› </li><li>  3000-æ‚¨åœ¨è®¡ç®—æœºä¸Šæ‰“å¼€çš„ç«¯å£ï¼› </li><li>  80-æœåŠ¡ä¾§çš„ç«¯å£ã€‚ </li></ul><br><h2>  3.å…¥å£è¯Šæ–­ </h2><br> å¦‚æœæ‚¨è¯»è¿‡è¿™ä¸ªåœ°æ–¹ï¼Œé‚£ä¹ˆï¼š <br><br><ul><li> è±†èšåˆ—ä¸ºâ€œ <code>Running</code>å’Œâ€œ <code>Ready</code> ï¼› </li><li> è¯¥æœåŠ¡æˆåŠŸåœ¨Podä¹‹é—´åˆ†é…æµé‡ã€‚ </li></ul><br> ä½†æ˜¯ï¼Œæ‚¨ä»ç„¶æ— æ³•â€œæ‰©å±•â€åˆ°è¯¥åº”ç”¨ç¨‹åºã€‚ <br><br> è¿™æ„å‘³ç€å¾ˆå¯èƒ½æ˜¯Ingressæ§åˆ¶å™¨çš„é…ç½®ä¸æ­£ç¡®ã€‚ ç”±äºIngressæ§åˆ¶å™¨æ˜¯é›†ç¾¤ä¸­çš„ç¬¬ä¸‰æ–¹ç»„ä»¶ï¼Œå› æ­¤æ ¹æ®å…¶ç±»å‹æœ‰å¤šç§è°ƒè¯•æ–¹æ³•ã€‚ <br><br> ä½†æ˜¯åœ¨ä½¿ç”¨ç‰¹æ®Šå·¥å…·é…ç½®Ingressä¹‹å‰ï¼Œæ‚¨å¯ä»¥åšä¸€äº›éå¸¸ç®€å•çš„äº‹æƒ…ã€‚  Ingressä½¿ç”¨<code>serviceName</code>å’Œ<code>servicePort</code>è¿æ¥åˆ°æœåŠ¡ã€‚ æ‚¨å¿…é¡»éªŒè¯å®ƒä»¬æ˜¯å¦æ­£ç¡®é…ç½®ã€‚ æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ‰§è¡Œæ­¤æ“ä½œï¼š <br><br><pre> <code class="bash hljs">kubectl describe ingress &lt;ingress-name&gt;</code> </pre> <br> å¦‚æœâ€œ <code>Backend</code>ç©ºï¼Œåˆ™å¾ˆå¯èƒ½å‡ºç°é…ç½®é”™è¯¯ã€‚ å¦‚æœåç«¯åˆ°ä½ï¼Œä½†æ˜¯ä»ç„¶æ— æ³•è®¿é—®è¯¥åº”ç”¨ç¨‹åºï¼Œåˆ™é—®é¢˜å¯èƒ½ä¸ä»¥ä¸‹æ–¹é¢æœ‰å…³ï¼š <br><br><ul><li> æ¥è‡ªå…¬å…±Internetçš„å…¥å£å¯è®¿é—®æ€§è®¾ç½®ï¼› </li><li> æ¥è‡ªå…¬å…±Internetçš„ç¾¤é›†å¯è®¿é—®æ€§è®¾ç½®ã€‚ </li></ul><br> æ‚¨å¯ä»¥é€šè¿‡ç›´æ¥è¿æ¥åˆ°Ingressçª—æ ¼æ¥è¯†åˆ«åŸºç¡€ç»“æ„é—®é¢˜ã€‚ ä¸ºæ­¤ï¼Œè¯·é¦–å…ˆæ‰¾åˆ°Ingressæ§åˆ¶å™¨çš„Podï¼ˆå®ƒå¯ä»¥åœ¨å…¶ä»–åç§°ç©ºé—´ä¸­ï¼‰ï¼š <br><br><pre> <code class="bash hljs">kubectl get pods --all-namespaces NAMESPACE NAME READY STATUS kube-system coredns-5644d7b6d9-jn7cq 1/1 Running kube-system etcd-minikube 1/1 Running kube-system kube-apiserver-minikube 1/1 Running kube-system kube-controller-manager-minikube 1/1 Running kube-system kube-proxy-zvf2h 1/1 Running kube-system kube-scheduler-minikube 1/1 Running kube-system nginx-ingress-controller-6fc5bcc 1/1 Running</code> </pre> <br> ä½¿ç”¨<code>describe</code>å‘½ä»¤è®¾ç½®ç«¯å£ï¼š <br><br><pre> <code class="bash hljs">kubectl describe pod nginx-ingress-controller-6fc5bcc --namespace kube-system \ | grep Ports</code> </pre> <br> æœ€åï¼Œè¿æ¥åˆ°åŠèˆ±ï¼š <br><br><pre> <code class="bash hljs">kubectl port-forward nginx-ingress-controller-6fc5bcc 3000:80 --namespace kube-system</code> </pre> <br> ç°åœ¨ï¼Œè®¡ç®—æœºä¸Šå¯¹ç«¯å£3000çš„æ‰€æœ‰è¯·æ±‚éƒ½å°†é‡å®šå‘åˆ°ç«¯å£80 podã€‚ <br><br>  <i>ç°åœ¨å¯ä»¥ç”¨å—ï¼Ÿ</i> <br><br><ul><li> å¦‚æœæ˜¯è¿™æ ·ï¼Œåˆ™é—®é¢˜å‡ºåœ¨åŸºç¡€æ¶æ„ä¸Šã€‚ æœ‰å¿…è¦å‡†ç¡®æ‰¾å‡ºæµé‡å¦‚ä½•è·¯ç”±åˆ°ç¾¤é›†ã€‚ </li><li> å¦‚æœä¸æ˜¯ï¼Œåˆ™é—®é¢˜å‡ºåœ¨Ingressæ§åˆ¶å™¨ä¸Šã€‚ </li></ul><br> å¦‚æœæ‚¨æ— æ³•ä½¿Ingressæ§åˆ¶å™¨æ­£å¸¸å·¥ä½œï¼Œåˆ™å¿…é¡»å¯¹å…¶è¿›è¡Œè°ƒè¯•ã€‚ <br><br>  Ingressæ§åˆ¶å™¨çš„ç§ç±»å¾ˆå¤šã€‚ æœ€å—æ¬¢è¿çš„æ˜¯Nginxï¼ŒHAProxyï¼ŒTraefikç­‰<i>ï¼ˆæœ‰å…³ç°æœ‰è§£å†³æ–¹æ¡ˆçš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§<a href="https://habr.com/ru/company/flant/blog/447180/">æˆ‘ä»¬çš„è¯„è®º</a> -å¤§çº¦ç¿»è¯‘ï¼‰ã€‚æ‚¨</i>åº”è¯¥ä½¿ç”¨ç›¸åº”æ§åˆ¶å™¨æ–‡æ¡£ä¸­çš„æ•…éšœæ’é™¤æŒ‡å—ã€‚ ç”±äº<a href="https://github.com/kubernetes/ingress-nginx">Ingress Nginx</a>æ˜¯æœ€å—æ¬¢è¿çš„Ingressæ§åˆ¶å™¨ï¼Œå› æ­¤æˆ‘ä»¬åœ¨æœ¬æ–‡ä¸­åŒ…å«äº†ä¸€äº›è§£å†³ç›¸å…³é—®é¢˜çš„æŠ€å·§ã€‚ <br><br><h3> è°ƒè¯•Ingress Nginxæ§åˆ¶å™¨ </h3><br><br>  Ingress-nginxé¡¹ç›®å…·æœ‰<a href="https://kubernetes.github.io/ingress-nginx/kubectl-plugin/">kubectl</a>çš„å®˜æ–¹<a href="https://kubernetes.github.io/ingress-nginx/kubectl-plugin/">æ’ä»¶</a> ã€‚  <code>kubectl ingress-nginx</code>å‘½ä»¤å¯ç”¨äºï¼š <br><br><ul><li> åˆ†ææ—¥å¿—ï¼Œåç«¯ï¼Œè¯ä¹¦ç­‰ï¼› </li><li> ä¸Ingressçš„è¿æ¥ï¼› </li><li> ç ”ç©¶å½“å‰é…ç½®ã€‚ </li></ul><br> ä»¥ä¸‹ä¸‰ä¸ªå›¢é˜Ÿå°†ä¸ºæ‚¨æä¾›å¸®åŠ©ï¼š <br><br><ul><li>  <code>kubectl ingress-nginx lint</code>æ£€æŸ¥<code>nginx.conf</code> ; </li><li>  <code>kubectl ingress-nginx backend</code> -æ¢ç´¢åç«¯ï¼ˆç±»ä¼¼äº<code>kubectl describe ingress &lt;ingress-name&gt;</code> ï¼‰ï¼› </li><li>  <code>kubectl ingress-nginx logs</code> -æ£€æŸ¥æ—¥å¿—ã€‚ </li></ul><br> è¯·æ³¨æ„ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¯èƒ½éœ€è¦ä½¿ç”¨<code>--namespace &lt;name&gt;</code>æ ‡å¿—ä¸ºIngressæ§åˆ¶å™¨æŒ‡å®šæ­£ç¡®çš„åç§°ç©ºé—´ã€‚ <br><br><h2> æ€»ç»“ </h2><br> å¦‚æœæ‚¨ä¸çŸ¥é“ä»å“ªé‡Œå¼€å§‹ï¼Œé‚£ä¹ˆè¯Šæ–­Kuberneteså¯èƒ½æ˜¯ä¸€é¡¹è‰°å·¨çš„ä»»åŠ¡ã€‚ åº”è¯¥å§‹ç»ˆæŒ‰ç…§è‡ªä¸‹è€Œä¸Šçš„åŸåˆ™æ¥è§£å†³è¯¥é—®é¢˜ï¼šé¦–å…ˆæ˜¯Podï¼Œç„¶åå†è½¬åˆ°æœåŠ¡å’ŒIngressã€‚ æœ¬æ–‡ä¸­æè¿°çš„è°ƒè¯•æ–¹æ³•å¯ä»¥åº”ç”¨äºå…¶ä»–å¯¹è±¡ï¼Œä¾‹å¦‚ï¼š <br><br><ul><li> é—²ç½®çš„ä¹”å¸ƒæ–¯å’ŒCronJobsï¼› </li><li>  StatefulSetså’ŒDaemonSetsã€‚ </li></ul><br> æ„Ÿè°¢<a href="https://github.com/errge">Gergely Risko</a> ï¼Œ <a href="https://medium.com/%40weibeld">Daniel Weibel</a>å’Œ<a href="https://www.linkedin.com/in/charles-christyraj-0bab8a36/">Charles Christyraj</a>æå‡ºçš„å®è´µæ„è§å’Œè¡¥å……ã€‚ <br><br><h2> è¯‘è€…çš„PS </h2><br> å¦è¯·å‚é˜…æˆ‘ä»¬çš„åšå®¢ï¼š <br><br><ul><li>  â€œ <a href="https://habr.com/ru/company/flant/blog/436112/">ç”¨äºKuberneteså®¹å™¨ä¸­è°ƒè¯•çš„Kubectl-debugæ’ä»¶</a> â€ï¼› </li><li>  â€œ <a href="https://habr.com/ru/company/flant/blog/443458/">Kubernetes [åŠå…¶è§£å†³æ–¹æ¡ˆ]æ“ä½œä¸­çš„6ä¸ªæœ‰è¶£çš„ç³»ç»Ÿé”™è¯¯</a> â€ï¼› </li><li>  â€œ <a href="https://habr.com/ru/company/flant/blog/462707/">ä¸ºåœ¨Kubernetesä¸Šè¿è¡Œçš„åº”ç”¨ç¨‹åºå¼€å‘äººå‘˜æä¾›çš„å·¥å…·</a> â€ï¼› </li><li>  â€œ <a href="https://habr.com/ru/company/flant/blog/471892/">æˆ‘ä»¬SREæ—¥å¸¸ç”Ÿæ´»ä¸­çš„6ä¸ªå®ç”¨æ•…äº‹</a> ã€‚â€ </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN484954/">https://habr.com/ru/post/zh-CN484954/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN484936/index.html">å›¢é˜Ÿä¸­çš„çŸ¥è¯†å’Œèƒ½åŠ›ï¼šæŸ¥æ‰¾ï¼ŒæŸ¥çœ‹ï¼Œæå‡</a></li>
<li><a href="../zh-CN484944/index.html">æˆ‘çš„ACIDæ˜¯ä»€ä¹ˆæˆ–ä¸é€‚åˆæˆ‘ä»¬</a></li>
<li><a href="../zh-CN484946/index.html">GPRå»ºæ¨¡</a></li>
<li><a href="../zh-CN484948/index.html">NECå‘å¸ƒäº†æµ·åº•ç”µç¼†ï¼Œè®°å½•äº†20å¯¹å…‰çº¤è®°å½•</a></li>
<li><a href="../zh-CN484952/index.html">ç”¨Observableå’ŒReact Hooksæ›¿æ¢Redux</a></li>
<li><a href="../zh-CN484964/index.html">åœ¨InfoWatch Traffic Monitorä¸Šé…ç½®è´Ÿè½½å¹³è¡¡</a></li>
<li><a href="../zh-CN484966/index.html">ä½¿ç”¨Springè¿›è¡Œæµ‹è¯•çš„ç°æˆæ¨¡æ¿</a></li>
<li><a href="../zh-CN484968/index.html">WPFæ•°æ®ç½‘æ ¼ã€‚ ä¸ºæ¨¡æ¿è€Œæˆ˜</a></li>
<li><a href="../zh-CN484972/index.html">Wine 5.0å‘å¸ƒ</a></li>
<li><a href="../zh-CN484974/index.html">å›¾çµæœºä»¿çœŸç‹ç –</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>