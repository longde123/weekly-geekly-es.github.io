<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🙋🏽 👓 🕳️ 体验没有Reduce的Redux使用 👨‍👧 🎒 ⌚️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="我想分享一下我在企业应用程序中使用redux的经验。 在文章中谈到公司软件时，我将重点介绍以下功能： 



- 首先，这是功能的数量。 这些系统已经开发了很多年，将继续构建新模块，或者无限期地复杂化现有系统。 
- 其次，通常，如果我们考虑的不是演示屏幕，而是某人的工作场所，则可以在一页上安装大量...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>体验没有Reduce的Redux使用</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/424613/"><img src="https://habrastorage.org/webt/nn/at/cx/nnatcxzguqw8cg7b1nx315f3c8y.jpeg"><br><br> 我想分享一下我在企业应用程序中使用redux的经验。 在文章中谈到公司软件时，我将重点介绍以下功能： <br><br><ul><li> 首先，这是功能的数量。 这些系统已经开发了很多年，将继续构建新模块，或者无限期地复杂化现有系统。 </li><li> 其次，通常，如果我们考虑的不是演示屏幕，而是某人的工作场所，则可以在一页上安装大量附加组件。 </li><li> 第三，业务逻辑的复杂性。 如果我们想要获得一个响应迅速且易于使用的应用程序，则逻辑的很大一部分将必须由客户端来完成。 </li></ul><br> 前两点对生产率的限制施加了限制。 稍后再详细介绍。 现在，我建议讨论使用经典的redux（工作流程）遇到的问题，开发比TODO（列表）更复杂的东西。 <br><a name="habracut"></a><br><h3> 经典还原 </h3><br> 例如，请考虑以下应用程序： <br><br><img src="https://image.ibb.co/ej3Pwp/1.png" alt="图片"><br><br> 用户开押韵-对自己的才能进行评估。 引入经文的控制得到控制，并且每次更改都会对评估进行重新计算。 还有一个按钮，通过该按钮可以重置带有结果的文本，并向用户显示一条消息，提示他可以从头开始。 此<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">线程中的</a>源代码。 <br><br> 代码组织： <br><br><img src="https://image.ibb.co/dyXv2U/2.png" alt="图片"><br><br> 有两个模块。 更准确地说，一个模块是poemScoring。 具有整个系统通用功能的应用程序的根源是app。 那里我们有关于用户的信息，向用户显示消息。 每个模块都有其自己的简化器，动作，控件等。随着应用程序的增长，新模块将成倍增加。 <br><br> 使用redux-immutable的级联化简器形成以下完全不可变的状态： <br><br><img src="https://image.ibb.co/nFrYp9/3.png" alt="图片"><br><br> 运作方式： <br><br>  1.控制调度动作创建者： <br><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> at <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../constants/actionTypes'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">poemTextChange</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">text</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">dispatch, getstate</span></span></span><span class="hljs-function">) </span></span>{ dispatch({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: at.POEM_TYPE, <span class="hljs-attr"><span class="hljs-attr">payload</span></span>: text }); }; }</code> </pre> <br> 动作类型的常量将移动到单独的文件中。 首先，我们很容易错别字。 其次，智能感知将向我们提供。 <br><br>  2.然后进入减速器。 <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> logic <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../logic/poem'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">poemScoringReducer</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state = Immutable.Map(</span></span></span><span class="hljs-function">), </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">action</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (action.type) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> at.POEM_TYPE: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> logic.onType(state, action.payload); <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state; } }</code> </pre> <br> 逻辑处理移至单独的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">案例功能</a> 。 否则，reducer代码将很快变得不可读。 <br><br>  3.使用词法分析和人工智能处理点击的逻辑： <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> { onType(state, text) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state .set(<span class="hljs-string"><span class="hljs-string">'poemText'</span></span>, text) .set(<span class="hljs-string"><span class="hljs-string">'score'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.calcScore(text)); }, calcScore(text) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> score = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.floor(text.length / <span class="hljs-number"><span class="hljs-number">10</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> score &gt; <span class="hljs-number"><span class="hljs-number">5</span></span> ? <span class="hljs-number"><span class="hljs-number">5</span></span> : score; } };</code> </pre> <br> 对于“新诗”按钮，我们有以下动作创建者： <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">newPoem</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">dispatch, getstate</span></span></span><span class="hljs-function">) </span></span>{ dispatch({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: at.POEM_TYPE, <span class="hljs-attr"><span class="hljs-attr">payload</span></span>: <span class="hljs-string"><span class="hljs-string">''</span></span> }); dispatch({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: appAt.SHOW_MESSAGE, <span class="hljs-attr"><span class="hljs-attr">payload</span></span>: <span class="hljs-string"><span class="hljs-string">'You can begin a new poem now!'</span></span> }); }; }</code> </pre> <br> 首先，请执行相同的操作以重置我们的文字和得分。 然后，发送动作，该动作将被另一个reducer捕获，并向用户显示一条消息。 <br> 一切都美好。 让我们为自己创造问题： <br><br><h3> 问题： </h3><br> 我们已经发布了我们的申请。 但是，看到他们被要求写诗的用户，自然就开始发表自己的作品，这与诗语言的公司标准不符。 换句话说，我们需要适度淫秽的词语。 <br><br> 我们将做什么： <br><br><ul><li> 在输入文本中，有必要将所有未经训练的单词替换为<b>*删节*</b> </li><li> 另外，如果用户打了脏话，则需要用一条消息警告他做错了。 </li></ul><br> 好啊 除了计算分数之外，我们只需要分析文本即可替换坏词。 没问题 另外，为了通知用户，您需要列出我们删除的内容。 源代码在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">这里</a> 。 <br><br> 我们重新构造了逻辑功能，以便除了新状态外，它还向用户返回消息所需的信息（被替换的单词）： <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> { onType(state, text) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { reductedText, censoredWords } = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.redactText(text); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> newState = state .set(<span class="hljs-string"><span class="hljs-string">'poemText'</span></span>, reductedText) .set(<span class="hljs-string"><span class="hljs-string">'score'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.calcScore(reductedText)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { newState, censoredWords }; }, calcScore(text) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> score = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.floor(text.length / <span class="hljs-number"><span class="hljs-number">10</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> score &gt; <span class="hljs-number"><span class="hljs-number">5</span></span> ? <span class="hljs-number"><span class="hljs-number">5</span></span> : score; }, redactText(text) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> result = { <span class="hljs-attr"><span class="hljs-attr">reductedText</span></span>:text }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> censoredWords = []; obscenseWords.forEach(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">badWord</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (result.reductedText.indexOf(badWord) &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) { result.reductedText = result.reductedText.replace(badWord, <span class="hljs-string"><span class="hljs-string">'*censored*'</span></span>); censoredWords.push(badWord); } }); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (censoredWords.length &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { result.censoredWords = censoredWords.join(<span class="hljs-string"><span class="hljs-string">' ,'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } };</code> </pre> <br> 现在应用它。 但是如何？ 在化简器中，再也没有必要再调用它了，因为我们将文本和评估置于状态中，但是我们应该如何处理该消息？ 为了发送消息，无论如何，我们将必须调度相应的操作。 因此，我们正在确定行动创造者。 <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">poemTextChange</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">text</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">dispatch, getState</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> globalState = getState(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> scoringStateOld = globalState.get(<span class="hljs-string"><span class="hljs-string">'poemScoring'</span></span>); <span class="hljs-comment"><span class="hljs-comment">//        const { newState, censoredWords } = logic.onType(scoringStateOld, text); dispatch({ //        type: at.POEM_TYPE, payload: newState }); if (censoredWords) { //    ,    const userName = globalState.getIn(['app', 'account', 'name']); const message = `${userName}, avoid of using word ${censoredWords}, please!`; dispatch({ type: appAt.SHOW_MESSAGE, payload: message }); } }; }</span></span></code> </pre> <br> 还需要修改reducer，因为它不再调用逻辑函数： <br><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (action.type) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> at.POEM_TYPE: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> action.payload; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state;</code> </pre> <br> 发生了什么： <br><br><img src="https://image.ibb.co/nkmzU9/4.png" alt="图片"><br><br>  <b>现在，问题是。</b> 为什么我们需要一个减速器，在大多数情况下，该减速器将仅返回有效载荷而不是新状态？ 当出现其他处理该操作逻辑的操作时，是否有必要注册新的操作类型？ 或者创建一个通用的SET_STATE？ 可能不是，因为那样的话，检查员会一团糟。 那么我们会产生相同类型的案例吗？ <br><br> 问题的实质如下。 如果逻辑处理涉及处理一个状态，而这个状态由几个化简器负责，那么您就必须编写各种变态。 例如，案例函数的中间结果，然后必须使用几个动作将它们分散在不同的化简器上。 <br><br> 类似的情况是，如果case函数需要比化简器中更多的信息，则您必须对其进行调用，该操作可以访问全局状态，然后将新状态作为有效负载发送。 如果模块中有很多逻辑，则在任何情况下都必须拆分化径器。 这带来了极大的不便。 <br><br> 让我们从一侧来看情况。 在我们的行动中，我们从全球获得了一片状态。 这是使它发生<i>变异的</i>必要条件（ <i>globalState.get（'poemScoring'）;</i> ）。 事实证明，我们已经在行动中知道工作正在进行什么状态。 我们有一个新的状态。 我们知道放在哪里。 但是，与其在全局化的级联器中使用某种文本常量来运行它，不如将其置于全局的状态中，以便它通过每个切换用例并替换一次。 我从意识到这一点起皱纹。 我知道这样做是为了简化开发并减少连接。 但就我们而言，它不再起作用。 <br><br>  <b>现在，我将列出当前实施中我不喜欢的所有要点，如果必须在无限长的时间内进行广度和深度扩展</b> ： <br><br><ol><li> 在异径管外的状态下工作时会带来极大的不便。 </li><li> 代码分离的问题。 每次我们分发动作时，它都会通过每个化简器，并通过每种情况。 当您的应用程序很小时，不打扰是很方便的。 但是，如果您有一个使用数十种减速器和数百个案例构建的怪兽，那么我开始考虑这种方法的可行性。 也许，即使有成千上万的案例，这也不会对性能产生重大影响。 但是，要理解在打印文本时，每次印刷都会导致数百种情况的发生，所以我不能原样保留它。 任何最小的滞后乘以无穷大都趋于无穷大。 换句话说，如果您不考虑此类问题，迟早会出现问题。 <br><br> 有哪些选择？ <br><br>  <b>一个</b> 与自己的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">提供</a>程序隔离的应用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">程序</a> 。 在每个模块（子应用程序）中，您将必须复制状态的一般部分（帐户，消息等）。 <br><br>  <b>b。</b> 使用可插拔<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">异步减速器</a> 。  Dan本人不建议这样做。 <br><br>  <b>c。</b> 在减速器中使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">动作过滤器</a> 。 也就是说，每个调度都应随附有关将其发送到哪个模块的信息。 并在模块的根减速器中编写适当的条件。 我试过了 在此之前或之后，没有如此多的非自愿错误。 人们对行动的去向一直感到困惑。 </li><li> 每次调度动作时，不仅每个减速器都有运行，而且还包含反向状态。 减速器中的状态是否改变都没有关系-它将在CombineReducers中替换。 </li><li> 每次调度都会强制为页面上安装的每个附加组件处理mapStateToProps。 如果拆分减速器，则必须拆分调度。 我们有一个按钮可以覆盖文本并以不同的调度方式显示消息是否至关重要？ 可能不是。 但是我有优化经验，在将处理数量从15减少到3时，可以在相同数量的已处理业务逻辑的情况下显着提高系统的响应速度。 我知道有一些库可以将多个调度合并为一个批处理，但这与使用拐杖进行调查很不容易。 </li><li> 压碎调度时，有时很难看到正在发生的事情。 没有一个地方，一切都分散在不同的文件中。 有必要通过搜索所有源代码中的常量来搜索在哪里执行处理。 </li><li> 在上面的代码中，组件和操作直接访问全局状态： <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> userName = globalState.getIn([<span class="hljs-string"><span class="hljs-string">'app'</span></span>, <span class="hljs-string"><span class="hljs-string">'account'</span></span>, <span class="hljs-string"><span class="hljs-string">'name'</span></span>]); … <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> text = state.getIn([<span class="hljs-string"><span class="hljs-string">'poemScoring'</span></span>, <span class="hljs-string"><span class="hljs-string">'poemText'</span></span>]);</code> </pre> <br> 由于以下几个原因，这不是很好： <br><br>  <b>一个</b> 理想情况下，模块应隔离。 他们不需要知道他们住在哪个州。 <br><br>  <b>b。</b> 在不同位置提及相同路径通常不仅会充满错误/错别字，而且在更改全局状态的配置或更改其存储方式的情况下，重构也变得极为困难。 <br></li><li> 在编写新动作时，我越来越有一种印象，就是为了代码而编写代码。 假设我们要在页面上添加一个复选框，并在故事中反映其布尔状态。 如果我们想要统一的行动/减速器组织，那么我们必须： <br><br>  -注册动作类型常量 <br>  -写一个动作陨石坑 <br>  -在控件中，将其导入并在mapDispatchToProps中注册 <br>  -在PropTypes中注册 <br>  -在控件中创建一个handleCheckBoxClick并在复选框中指定它 <br>  -通过case函数调用在化简器中添加一个开关 <br>  -在逻辑中编写案例函数 <br><br> 为了一次拳击检查！ </li><li> 用combinedReducers生成的状态是静态的。 无论您是否已经进入模块B，这都将成为故事。 空的，但是会的。 当steet中有许多未使用的空节点时，使用检查器是不方便的。 </li></ol><br><h3> 我们如何解决上述一些问题 </h3><br> 因此，我们有了愚蠢的化简器，在动作弹坑/逻辑中，我们编写了用于处理深层嵌入的不可变结构的代码脚注。 为了消除这一点，我使用了层次选择器的机制，该机制不仅允许访问所需的状态，还可以替换状态（方便的setIn）。 我将其发布在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">不可变选择器</a>包中。 <br><br>  <b>让我们看一下示例，它是如何工作的</b> （ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">repository</a> ）： <br> 在poemScoring模块中，我们描述了选择器对象。 我们从希望直接读取/写入访问的状态描述了这些字段。 允许使用任何嵌套和参数访问集合的元素。 不必在本文中描述所有可能的字段。 <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> extendSelectors <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'immutable-selectors'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> selectors = { <span class="hljs-attr"><span class="hljs-attr">poemText</span></span>:{}, <span class="hljs-attr"><span class="hljs-attr">score</span></span>:{} }; extendSelectors(selectors, [ <span class="hljs-string"><span class="hljs-string">'poemScoring'</span></span> ]); <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> selectors;</code> </pre> <br> 此外，extendSelectors方法将对象中的每个字段转换为选择器函数。 第二个参数指示选择器控制的状态部分的路径。 我们不创建新对象，而是更改当前对象。 这以工作情报的形式给了我们额外的好处： <br><br><img src="https://image.ibb.co/iYdDp9/5.png" alt="图片"><br><br> 我们的对象是什么-展开后的选择器： <br><br><img src="https://image.ibb.co/iAGcGp/5_5.png" alt="图片"><br><br>  <i>selectors.poemText（状态）</i>函数仅执行<i>state.getIn（['poemScoring'，'poemText']）</i> 。 <br><br> 函数<i>根（状态）</i> -获取“ poemScoring”。 <br><br> 每个选择器都有其自己的<i>替换</i>功能<i>（globalState，newPart）</i> ，该功能通过setIn返回一个新的全局状态，其中相应的零件已被替换。 <br><br> 此外， <i>还将</i>添加一个<i>平面</i>对象，所有唯一选择器键都将复制到该<i>平面</i>对象上。 也就是说，如果我们使用表单的深层状态 <br><br><pre> <code class="javascript hljs">selectors = { <span class="hljs-attr"><span class="hljs-attr">dive</span></span>:{ <span class="hljs-attr"><span class="hljs-attr">in</span></span>:{ <span class="hljs-attr"><span class="hljs-attr">to</span></span>:{ <span class="hljs-attr"><span class="hljs-attr">the</span></span>:{ <span class="hljs-attr"><span class="hljs-attr">deep</span></span>:{} } } } }}</code> </pre> <br> 您可以作为<i>选择器</i>深入学习<i>（状态），</i>也可以作为<i>选择器</i>展现深度<i>（状态）</i> 。 <br><br> 来吧 我们需要更新控件中的数据采集： <br><br> 诗： <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mapStateToProps</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state, ownprops</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">text</span></span>:selectors.poemText(state) || <span class="hljs-string"><span class="hljs-string">''</span></span> }; }</code> </pre> <br><br> 分数： <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mapStateToProps</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state, ownprops</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> score = selectors.score(state); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { score }; }</code> </pre> <br> 接下来，更改根减速器： <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> initialState <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./initialState'</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setStateReducer</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state = initialState, action</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (action.setState) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> action.setState; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state; <span class="hljs-comment"><span class="hljs-comment">// return combinedReducers(state, action); // } } export default setStateReducer;</span></span></code> </pre> <br> 如果需要，我们可以结合使用CombineReducers。 <br><br> 动作弹坑，例如poemTextChange： <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">poemTextChange</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">text</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">dispatch, getState</span></span></span><span class="hljs-function">) </span></span>{ dispatch({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'Poem typing'</span></span>, <span class="hljs-attr"><span class="hljs-attr">setState</span></span>: logic.onType(getState(), text), <span class="hljs-attr"><span class="hljs-attr">payload</span></span>: text }); }; }</code> </pre> <br> 我们不能再使用动作类型常量，因为类型现在仅用于检查器中的可视化。 我们在该项目中用俄语编写了该动作的全文描述。 您也可以摆脱有效负载，但是我会尝试将其保存，以便在检查器中，如有必要，我可以了解使用什么参数调用了该动作。 <br><br> 而且，实际上，逻辑本身： <br><br><pre> <code class="javascript hljs"> onType(gState, text) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { reductedText, censoredWords } = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.redactText(text); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> poemState = selectors.root(gState) || Immutable.Map(); <span class="hljs-comment"><span class="hljs-comment">//     const newPoemState = poemState //  .set('poemText', reductedText) .set('score', this.calcScore(reductedText)); let newGState = selectors.root.replace(gState, newPoemState); //    if (censoredWords) { //  ,    const userName = appSelectors.flat.userName(gState); const messageText = `${userName}, avoid of using word ${censoredWords}, please!`; newGState = message.showMessage(newGState, messageText); } return newGState; },</span></span></code> </pre> <br> 同时， <i>message.showMessage是</i>从相邻模块的逻辑中导入的，该模块描述了其选择器： <br><br><pre> <code class="javascript hljs"> showMessage(gState, text) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> selectors.message.text.replace(gState, text); }.</code> </pre> <br> 结果是： <br><br><img src="https://image.ibb.co/hviDp9/6.png" alt="图片"><br><br> 请注意，我们进行了一次调度，两个模块中的数据已更改。 <br> 所有这些使我们摆脱了reducers和action-type常量，并解决了或克服了上面概述的大多数瓶颈。 <br><br><h4> 还有什么可以应用的？ </h4><br> 当必须确保您的控件或模块提供具有不同状态的工作时，使用此方法很方便。 假设一首诗对我们来说还不够。 我们希望用户能够在不同学科（儿童，浪漫）的两个不同选项卡上创作诗歌。 在这种情况下，我们不能在逻辑/控件中导入选择器，而是在外部控件中将它们指定为参数： <br><br><pre> <code class="javascript hljs"> &lt;Poem selectors = {selectors.hildPoem}/&gt; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Poem</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">selectors</span></span></span></span><span class="xml"><span class="hljs-tag"> = </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{selectors.romanticPoem}/</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre> <br> 并且，进一步将此参数传递给动作坑。 这足以使组件和逻辑的复杂组合完全封闭，从而易于重用。 <br><br>  <b>使用不可变选择器的限制：</b> <br><br> 在“名称”状态下使用键将不起作用，因为对于父函数，将尝试覆盖保留的属性。 <br><br><h3> 结果如何 </h3><br> 结果，获得了一种相当灵活的方法，消除了文本常量所隐含的代码关系，减少了开销，同时保持了开发的便利性。 还有一个功能齐全的Redux检查器，可能会花费时间。 我不想回到标准减速机。 <br><br> 一般来说，仅此而已。 谢谢您的时间。 也许有人会对尝试一下感兴趣！ </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN424613/">https://habr.com/ru/post/zh-CN424613/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN424603/index.html">《为什么我们错了》一书 在行动中思考陷阱。” 摘录第1部分</a></li>
<li><a href="../zh-CN424605/index.html">扎克伯格的资金：协作+技术+开放科学</a></li>
<li><a href="../zh-CN424607/index.html">直升机场的崛起</a></li>
<li><a href="../zh-CN424609/index.html">如何扩展Kubernetes</a></li>
<li><a href="../zh-CN424611/index.html">如何从自由职业者创建员工</a></li>
<li><a href="../zh-CN424615/index.html">曲线函数输出不仅可以在Wolfram Mathematica中平滑限制参数，信号</a></li>
<li><a href="../zh-CN424621/index.html">非电影超级英雄。 谁以及如何保护Lakhta Center施工现场免于火灾？</a></li>
<li><a href="../zh-CN424623/index.html">让我们在Go上处理声音</a></li>
<li><a href="../zh-CN424625/index.html">Aeroflot Web服务源代码泄漏</a></li>
<li><a href="../zh-CN424627/index.html">更改收银机。 第一部分</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>