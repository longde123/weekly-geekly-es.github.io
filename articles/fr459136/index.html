<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🈵 👨🏽‍🚒 👩🏻‍🎤 Fausse pilule bleue ✒️ 👪 🗓️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Je suis un grand fan de la planche à pain pilule bleue. Ils sont très bons en termes de prix / performances. En fait, mon amour pour eux est visible d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Fausse pilule bleue</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/459136/"> Je suis un grand fan de la planche à pain pilule bleue.  Ils sont très bons en termes de prix / performances.  En fait, mon amour pour eux est visible dans l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">article des poissons d'avril sur le firmware des pédales pour jouer de la balalaïka</a> . <br><br><img src="https://habrastorage.org/webt/6s/wd/xg/6swdxgpdmolly9ywvdylhvgmuj8.png"><br><br>  Ouvrez une boîte avec de telles planches et prenez-en rapidement une pour résoudre certains problèmes - dans l'ordre des choses.  C'est vrai, récemment, j'ai pris la carte suivante, je l'ai flashée avec un «firmware» bien débogué et testé et ... j'ai obtenu un périphérique USB non identifié.  J'ai pris une autre planche, je l'ai «flashée», l'appareil a fonctionné là-bas.  Il y aurait une fin à la question, mais je me demande quelle est la question.  Par conséquent, comme le week-end est arrivé, j'ai commencé une étude détaillée des raisons pour lesquelles cela ne fonctionne pas. <br><a name="habracut"></a><br>  En général, avant de «flasher» les planches, je m'assure que le test versé par le constructeur fonctionne: la LED clignote.  J'étais donc sûr que le processeur, en général, est vivant.  Qu'est-ce à blâmer alors?  Peut-être des lignes USB ou du quartz. <br><br>  Les lignes étaient bien, le quartz n'a pas commencé.  Mais cela peut ne pas commencer pour de nombreuses raisons.  Son lancement se fait par programme, déjà dans les entrailles de la fonction <b>main ()</b> Eh bien, très bien, nous commençons à déboguer le programme. <br><br>  Tout irait bien, mais le débogueur ne va pas à la fonction <b>main ()</b> .  Le programme se bloque quelque part entre le lancement et cette fonction. <br><br><img src="https://habrastorage.org/webt/ko/es/xj/koesxjk9g7tdmkfbvgciacfru1a.png"><br><br>  Nous arrêtons le programme: tout à fait attendu, nous sommes dans le gestionnaire <b>HardFault</b> . <br><br><img src="https://habrastorage.org/webt/3t/ij/c8/3tijc8kk_f5o_cyy0ivc95mnk9o.png"><br><br><img src="https://habrastorage.org/webt/_k/oj/9w/_koj9wd0mzpqfulrmwhacwa7_py.png"><br><br>  Qu'est-ce qui nous amène ici?  Réinitialisez le compteur d'adresses: <br><br><img src="https://habrastorage.org/webt/ng/mh/ch/ngmhchhxo_va_3_ip0r9z_6nnk4.png"><br><br>  Et nous commençons à suivre attentivement le programme.  Ici, sur cette ligne, tout meurt, nous utilisons au moins l'opération <b>Step</b> , au moins <b>Step Over</b> . <br><br><img src="https://habrastorage.org/webt/sa/4k/-1/sa4k-1gc061eyl4i94sv4pwg14a.png"><br><br>  Jolly Keil ... Eh bien, rien.  Réinitialisez tout à nouveau (RST), cliquez avec la souris sur la fenêtre du démonteur et allez-y.  Dans ce cas, nous pouvons comprendre que tout se meurt à l'intérieur de la fonction <b>__scatterload</b> . <br><br><img src="https://habrastorage.org/webt/i9/nw/ps/i9nwpsk8ig7ck8yai1v7i7re0_y.png"><br><br>  En général, si tout meurt dans cette fonction, il y a déjà une raison de chercher si le type de contrôleur est confus.  Mais non, c'est vrai (j'ai également revérifié les paramètres, mais ce firmware fonctionne sur d'autres cartes). <br><br><img src="https://habrastorage.org/webt/tn/fg/ok/tnfgokogkw2yvys7_drk5n9ted4.jpeg"><br><br>  Bon.  Encore une fois, nous réinitialisons tout et suivons déjà cette fonction.  Après quelques essais, accroche et rougit, nous trouvons la ligne coupable ... <br><br><img src="https://habrastorage.org/webt/k6/3z/tz/k63ztz99gszkoxsafwjxid7jvmm.png"><br><br>  Oui oui  Tout meurt en enregistrant les registres sur la pile.  En même temps, on peut voir à gauche que SP est 0x200030A0.  Nous regardons la documentation du contrôleur: <br><br><img src="https://habrastorage.org/webt/0v/u1/u6/0vu1u6su1xs0fahgqoxxajp1fmm.png"><br><br>  Voyons quelle fenêtre est allouée pour SRAM: <br><br><img src="https://habrastorage.org/webt/tb/iu/im/tbiuimemokbgv9fnercmrybq-mm.png"><br><br>  C'est vrai.  Le pointeur de pile (SP) est dans la plage autorisée.  Alors, qu'est-ce à blâmer?  Essayons de remplacer effrontément la valeur SP par 0x200030A0, disons, par 0x200020A0, car le débogueur permet cela ... Chpok!  Le blocage sur la ligne spécifiée s'est arrêté!  Ainsi, notre puce mémoire n'est pas de 20 kilo-octets.  Combien?  Après avoir vérifié plusieurs fois, nous constatons que la dernière valeur de travail de SP est 0x20002800.  Soit 10 kilo-octets.  Cela correspond au cristal STM32F103C6.  Devant nous se trouve un microcircuit scié.  Hélas. <br><br>  Tout irait bien, mais les planches de ce lot dans ma boîte plutôt grande sont faciles à distinguer.  Ils ont une couleur spéciale de cavaliers et une très belle LED émeraude (les autres ont une nuance de vert moins agréable).  Par conséquent, ils sont facilement attribués à partir du tas d'autres cartes.  Bien sûr, je les ai vérifiés.  Bien sûr, toute la fête a été coupée (j'en ai pris une dizaine). <br><br>  Que faire avec cela n'est pas clair.  Quand j'ai eu trois pièces dans une douzaine de cartes mères qui n'avaient pas de test régulier: la LED ne clignote pas (alors maintenant je les vérifie non sélectivement, mais totalement), j'ai passé une semaine à parler au vendeur.  Il "a tourné le fou".  Toujours intéressé par ce que je veux faire, a promis de m'aider avec des conseils.  Et je lui ai répété maintes et maintes fois que je me suis stupidement connecté à l'alimentation, sept cartes clignotent, trois - non.  Ils sont donc morts.  Et il a de nouveau son orgue de Barbarie.  Et donc une semaine.  Mais là, tout était évident.  N'a pas réussi le test du personnel.  Ici, le test à temps plein passe, il n'a pas besoin de beaucoup de mémoire.  Comment prouver qu'un faux est venu n'est pas clair.  Et si vous pouvez le prouver, tout de même, selon les règles d'Ali Express, vous devez renvoyer la marchandise.  En général, tout ressemble au désespoir.  Et surtout, le vendeur final n'avait aucune intention malveillante.  Je lui ai pris un autre lot, plus tard.  Tout y est bien.  Lui-même a été déçu. <br><br>  D'une manière ou d'une autre, j'informe le public que cela se produit.  Vérifiez les cartes non seulement pour les performances globales, mais aussi pour les spécifications du monde réel.  Certes, que faire avec un décalage n'est pas clair. <br><br>  L'article présente un autre avantage pratique.  Il montre comment vous pouvez trouver rapidement la raison pour laquelle la carte ne fonctionne pas soudainement, si le problème n'est pas l'inopérabilité complète du contrôleur (il répond via le port de débogage SWD). </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr459136/">https://habr.com/ru/post/fr459136/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr459122/index.html">Aleksey Savvateev: Prix Nobel de Jean Tyrol pour l'analyse des marchés imparfaits (2014) et de la réputation collective</a></li>
<li><a href="../fr459126/index.html">Réservoir de robot Raspberry Pi avec Intel Neural Computer Stick 2</a></li>
<li><a href="../fr459128/index.html">Interfaces japonaises dans le monde réel</a></li>
<li><a href="../fr459130/index.html">Traitement des erreurs en douceur dans les microservices</a></li>
<li><a href="../fr459134/index.html">Expérience avec BDD</a></li>
<li><a href="../fr459138/index.html">Comment la clé secrète Huawei est entrée dans le firmware des routeurs Cisco</a></li>
<li><a href="../fr459140/index.html">Pose d'implants: comment cela se fait-il?</a></li>
<li><a href="../fr459142/index.html">Création d'un graphique linéaire moyen animé animé dans R. Récupération de données via l'API NBA</a></li>
<li><a href="../fr459144/index.html">Frontend Weekly Digest (1-7 juillet 2019)</a></li>
<li><a href="../fr459146/index.html">Food Design Digest juin 2019</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>