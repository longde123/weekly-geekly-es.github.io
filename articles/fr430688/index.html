<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèº‚Äçüç≥ ‚úçüèø üë∞ Transfert de donn√©es via QR anim√© vers Gomobile et GopherJS üßïüèª üë©üèª‚Äçü§ù‚Äçüë®üèø üíã</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dans cet article, je veux parler d'un petit et dr√¥le projet de week-end pour transf√©rer des fichiers via des codes QR anim√©s. Le projet est √©crit en G...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Transfert de donn√©es via QR anim√© vers Gomobile et GopherJS</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/430688/"><p> Dans cet article, je veux parler d'un petit et dr√¥le projet de week-end pour transf√©rer des fichiers via des codes QR anim√©s.  Le projet est √©crit en Go, en utilisant Gomobile et Gopherjs - le dernier d'une application web pour mesurer automatiquement les taux de transfert de donn√©es.  Si vous √™tes int√©ress√© par l'id√©e de transmettre des donn√©es via des codes visuels, de d√©velopper des applications Web qui ne sont pas sur JS ou sur la v√©ritable plateforme multiplateforme Go - vers Wellcome to Cat. </p><br><p><img src="https://habrastorage.org/webt/2p/zg/t_/2pzgt_2anc92t0udxgl3cnt3xy0.gif" alt="d√©mo txqr"></p><a name="habracut"></a><br><p>  L'id√©e du projet est n√©e d'une t√¢che sp√©cifique pour une application mobile - comment transf√©rer une petite partie de donn√©es (~ 15 Ko) vers un autre appareil de la mani√®re la plus simple et rapide, dans des conditions de blocage du r√©seau.  La premi√®re pens√©e √©tait d'utiliser Bluetooth, mais ce n'est pas aussi pratique qu'il y para√Æt - le processus de d√©tection et de couplage relativement long et pas toujours fonctionnel est trop difficile pour la t√¢che.  Une bonne id√©e serait d'utiliser NFC (Near Field Communication), mais il y a encore trop d'appareils dans lesquels la prise en charge NFC est limit√©e ou inexistante.  Nous avions besoin de quelque chose de plus simple et plus abordable. </p><br><p>  Qu'en est-il des codes QR? </p><br><h1 id="qr-kody">  Codes QR </h1><br><p>  Le code QR (r√©ponse rapide) est le type de code visuel le plus populaire au monde.  Il vous permet d'encoder jusqu'√† 3 Ko de donn√©es arbitraires et poss√®de diff√©rents niveaux de correction d'erreurs, vous permettant de lire en toute confiance m√™me un tiers d'un code ferm√© ou sale. </p><br><p>  Mais avec les codes QR, il y a deux probl√®mes: </p><br><ul><li>  3 Ko ne suffisent pas </li><li>  plus les donn√©es sont encod√©es, plus les exigences de qualit√© pour l'image √† num√©riser sont √©lev√©es </li></ul><br><p>  Voici le code QR de la 40e version (la densit√© d'enregistrement la plus √©lev√©e) avec 1276 octets: </p><br><p><img src="https://habrastorage.org/webt/wp/r1/mp/wpr1mp7p-uz4vzzssaai5zp8v44.gif" alt="qrv40"></p><br><p>  Pour ma t√¢che, j'avais besoin d'apprendre √† transf√©rer ~ 15 Ko de donn√©es sur des appareils standard (smartphones / tablettes), donc la question s'est pos√©e d'elle-m√™me - pourquoi ne pas animer la s√©quence de codes QR et transf√©rer les donn√©es en morceaux? </p><br><p>  Une recherche rapide d'impl√©mentations pr√™tes √† l'emploi a conduit √† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">plusieurs de</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ces</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">projets</a> - principalement des projets sur les hackathons (bien qu'il y ait √©galement une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">th√®se</a> ) - mais ils ont tous √©t√© √©crits en Java, Python ou JavaScript, ce qui, malheureusement, a rendu le code pratiquement non transf√©rable et inutilis√©.  Mais √©tant donn√© la grande popularit√© des codes QR et la faible complexit√© technique de l'id√©e, il a √©t√© d√©cid√© d'√©crire √† partir de z√©ro dans Go - un langage multiplateforme, lisible et rapide.  Habituellement, la multiplateforme implique la possibilit√© de construire du code binaire pour Windows, Mac et Linux, mais dans mon cas, il √©tait √©galement important de le construire pour le web (gopherjs) et pour les syst√®mes mobiles (iOS / Android).  Go vous permet de tout sortir de la bo√Æte avec un co√ªt minimal. </p><br><p>  J'ai √©galement envisag√© des options alternatives pour les codes visuels - tels que le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">code</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">HCCB</a> ou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">JAB</a> , mais pour eux, je devrais √©crire un scanner OpenCV, impl√©menter un encodeur / d√©codeur √† partir de z√©ro et c'√©tait trop pour un projet pour un week-end.  Les codes QR √† tour de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">r√¥le</a> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Shotcodes</a> ), et leurs homologues utilis√©s sur Facebook, Kik et Snapchat, vous permettent d'encoder beaucoup moins d'informations, et l'approche brevet√©e incroyablement cool d'Apple pour coupler Apple Watch et iPhone - un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">nuage anim√© de particules color√©es</a> - est √©galement optimis√©e pour l'effet wow, et pas sous la bande passante maximale.  Les codes QR sont int√©gr√©s dans les cam√©ras SDK natives du syst√®me d'exploitation mobile, ce qui facilite consid√©rablement leur travail. </p><br><h1 id="txqr">  TXQR </h1><br><p>  Ainsi est n√© le projet <em>txqr</em> (issu de la transmission Tx et QR), qui impl√©mente une biblioth√®que d'encodage / d√©codage QR sur Pure Go et un protocole de transmission de donn√©es. </p><br><p>  L'id√©e principale est la suivante: un client s√©lectionne un fichier ou des donn√©es √† envoyer, le programme sur l'appareil d√©compose le fichier en morceaux, les code chacun en trames QR et les affiche dans une boucle sans fin avec une fr√©quence d'images donn√©e jusqu'√† ce que le destinataire re√ßoive toutes les donn√©es.  Le protocole est con√ßu de telle sorte que le destinataire puisse commencer √† partir de n'importe quelle image, recevoir des images QR dans n'importe quel ordre - cela √©vite d'avoir √† synchroniser la fr√©quence d'animation et la fr√©quence de balayage.  Le r√©cepteur peut √™tre un ancien appareil, dont la puissance vous permet de d√©coder 2 images par seconde, et l'exp√©diteur avec un nouveau smartphone qui produit une animation 120Hz, ou vice versa, et ce ne sera pas un probl√®me fondamental pour le protocole. </p><br><p> Ceci est r√©alis√© comme suit - lorsque le fichier est divis√© en morceaux ( <em>cadres</em> plus loin), un pr√©fixe avec des informations sur le d√©calage par rapport √† toutes les donn√©es et la longueur totale - <code>OFFSET/TOTAL|</code>  (o√π OFFSET et TOTAL sont des valeurs enti√®res de d√©calage et de longueur, respectivement).  Les donn√©es binaires sont actuellement cod√©es en Base64, mais ce n'est pas vraiment n√©cessaire - la sp√©cification QR permet non seulement de coder les donn√©es sous forme binaire, mais √©galement d'optimiser diff√©rentes parties des donn√©es pour diff√©rents codages (par exemple, un pr√©fixe avec des modifications mineures peut √™tre cod√© en <em>alphanum√©rique</em> et le reste du contenu - comme <em>binaire</em> ), mais pour simplifier, Base64 a parfaitement rempli sa fonction. </p><br><p>  De plus, la taille et la fr√©quence des trames peuvent m√™me √™tre modifi√©es dynamiquement, en s'adaptant aux capacit√©s du destinataire. </p><br><p><img src="https://habrastorage.org/webt/qm/7g/dg/qm7gdgycvmlhgjflhc_xudrfeu8.png" alt="protocole"></p><br><p>  Le protocole lui-m√™me est tr√®s simple, et son principal inconv√©nient est que pour les fichiers volumineux (bien que cela d√©passe la port√©e de la t√¢che, mais quand m√™me), une image ignor√©e pendant la num√©risation doublera le temps de num√©risation - le destinataire devra attendre √† nouveau le cycle complet.  Dans la th√©orie du codage, il existe des solutions pour de tels cas - les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">codes fontaine</a> , mais je vais laisser cela pour certains des jours libres suivants. </p><br><p>  Le point le plus int√©ressant √©tait d'√©crire une application mobile pouvant utiliser ce protocole. </p><br><h2 id="gomobile">  Gomobile </h2><br><p>  Si vous n'avez pas entendu parler de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">gomobile</a> , alors c'est un projet qui vous permet d'utiliser les biblioth√®ques Go dans les projets iOS et Android et en fait une proc√©dure simple obsc√®ne. </p><br><p>  Le processus standard est le suivant: </p><br><ul><li>  vous √©crivez du code Go normal </li><li>  ex√©cuter <code>gomobile bind ...</code> </li><li>  copiez l'artefact (s) <code>yourpackage.framework.</code> ( <code>yourpackage.framework.</code> ou <code>yourpackage.aar</code> ) dans votre projet mobile </li><li>  importez votre <code>yourpackage</code> et travaillez avec comme avec une biblioth√®que r√©guli√®re </li></ul><br><p>  Vous pouvez essayer √† quel point c'est facile. </p><br><p>  Par cons√©quent, j'ai rapidement √©crit une application sur Swift qui scanne les codes QR (gr√¢ce √† ce <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">merveilleux article</a> ) et les d√©code, les colle ensemble et, lorsque le fichier entier est re√ßu, l'affiche dans la fen√™tre d'aper√ßu. </p><br><p>  En tant que d√©butant chez Swift (m√™me si j'ai lu le livre Swift 4), il y a eu pas mal de moments o√π je me suis retrouv√© coinc√© sur quelque chose de simple, essayant de comprendre comment le faire correctement et, au final, la meilleure solution √©tait d'impl√©menter cette fonctionnalit√© sur Go et d'utiliser via gomobile.  Ne vous m√©prenez pas, Swift est √† bien des √©gards un langage merveilleux, mais, comme la plupart des autres langages de programmation, il fournit trop de fa√ßons de faire la m√™me chose, et a d√©j√† une histoire d√©cente de changements incompatibles en amont.  Par exemple, je devais faire une chose simple: mesurer la dur√©e d'un √©v√©nement avec une pr√©cision d'une milliseconde.  Une recherche sur Google et StackOverflow a conduit √† une multitude de solutions diff√©rentes, conflictuelles et souvent obsol√®tes, dont aucune, en fin de compte, ne m'a sembl√© belle ou correcte pour le compilateur.  Apr√®s 40 minutes de temps pass√©, je viens de <code>time.Since(start) / time.Millisecond</code> une autre m√©thode dans le package Go qui a appel√© <code>time.Since(start) / time.Millisecond</code> et utilis√© directement le r√©sultat de Swift. </p><br><p>  J'ai √©galement √©crit l'utilitaire de console <code>txqr-ascii</code> pour tester rapidement les applications.  Il encode le fichier et anime les QR codes dans le terminal.  Dans l'ensemble, cela a √©tonnamment bien fonctionn√© - j'ai pu envoyer une petite image en quelques secondes, mais d√®s que j'ai commenc√© √† tester diff√©rentes valeurs de la fr√©quence d'images, le nombre d'octets dans chaque trame QR et le niveau de correction d'erreur dans l'encodeur QR, il est devenu clair que la solution du terminal n'√©tait pas fait face √† la haute fr√©quence (plus de 10) de l'animation, et que tester et mesurer les r√©sultats manuellement est une chose d√©sastreuse. </p><br><h1 id="txqr-tester">  Testeur TXQR </h1><br><p><img src="https://habrastorage.org/webt/bc/tp/a6/bctpa6fnru8q-kxbezmo27dcc1w.jpeg"></p><br><p>  Pour trouver la combinaison optimale de la fr√©quence d'images, de la taille des donn√©es dans une trame QR et du niveau de correction d'erreur parmi les limites raisonnables de ces valeurs, j'ai d√ª ex√©cuter plus de 1000 tests, modifier manuellement les param√®tres, attendre un cycle complet avec le t√©l√©phone dans ma main et √©crire les r√©sultats sur une plaque.  Bien s√ªr, cela doit √™tre automatis√©! </p><br><p>  L'id√©e de la prochaine application <code>txqr-tester</code> - <code>txqr-tester</code> .  Initialement, j'avais pr√©vu d'utiliser <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">x / exp / shiny</a> - un cadre d'interface utilisateur exp√©rimental pour les applications de bureau natives sur Go, mais il semble √™tre abandonn√©.  Il y a environ un an, je l'ai essay√©, et l'impression n'√©tait pas mauvaise - il convenait parfaitement aux choses de bas niveau.  Mais aujourd'hui, la branche ma√Ætre n'a m√™me pas √©t√© compil√©e.  Il semble qu'il n'y ait plus d'incitation √† investir dans le d√©veloppement de frameworks de bureau - une t√¢che complexe et lourde, avec une demande presque nulle de nos jours, toutes les solutions d'interface utilisateur ont migr√© sur le Web il y a longtemps. </p><br><p>  En programmation Web, comme vous le savez, les langages de programmation viennent de commencer √† entrer, gr√¢ce √† WebAssembly, mais ce sont encore les premi√®res √©tapes pour les enfants.  Bien s√ªr, il y a toujours du JavaScript et des modules compl√©mentaires, mais les amis ne permettent pas √† leurs amis d'√©crire des applications en JavaScript, j'ai donc d√©cid√© d'utiliser ma r√©cente d√©couverte - le cadre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Vecty</a> , qui vous permet d'√©crire des frontends sur Pure Go, qui sont automatiquement convertis en JavaScript √† l'aide d'un adulte tr√®s et fonctionnant √©tonnamment bien. Projet <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">GopherJS</a> . </p><br><h1 id="vecty-i-gopherjs">  Vecty et GopherJS </h1><br><p><img src="https://habrastorage.org/webt/rf/xc/zz/rfxczzfu4b5efmhjtu_lmf7ema4.png" alt="vecty"></p><br><p>  Dans ma vie, je n'ai pas re√ßu un tel plaisir du d√©veloppement d'interfaces frontales. </p><br><p>  Un peu plus tard, je pr√©vois d'√©crire quelques articles suppl√©mentaires sur mon exp√©rience dans le d√©veloppement de frontends sur Vecty, y compris les applications WebGL, mais le fait est qu'apr√®s plusieurs projets sur React, Angulars et Ember, √©crire un frontend dans un langage de programmation simple et r√©fl√©chi est un vent de fra√Æcheur l'air!  Je peux √©crire de jolis frontends en peu de temps sans √©crire une seule ligne en JavaScript! </p><br><p>  Pour commencer, c'est ainsi que vous d√©marrez un nouveau projet sur Vecty (pas de g√©n√©rateurs de code "projet initial" cr√©ant des tonnes de fichiers et de dossiers) - juste main.go: </p><br><pre> <code class="go hljs">ackage main <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ( <span class="hljs-string"><span class="hljs-string">"github.com/gopherjs/vecty"</span></span> ) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { app := NewApp() vecty.SetTitle(<span class="hljs-string"><span class="hljs-string">"My App"</span></span>) vecty.AddStylesheet(<span class="hljs-comment"><span class="hljs-comment">/* ... add your css... */</span></span>) vecty.RenderBody(app) }</code> </pre> <br><p>  Une application, comme tout composant d'interface utilisateur, n'est qu'un type: une structure qui inclut le type <code>vecty.Core</code> et doit impl√©menter l'interface <code>vecty.Component</code> (constitu√©e d'une m√©thode <code>Render()</code> ).  Et c'est tout!  Ensuite, vous travaillez avec des types, des m√©thodes, des fonctions, des biblioth√®ques pour travailler avec le DOM, etc. - pas de magie cach√©e et de nouveaux termes et concepts.  Voici le code simplifi√© de la page principale: </p><br><pre> <code class="go hljs">/ App is a top-level app component. <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> App <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { vecty.Core session *Session settings *Settings <span class="hljs-comment"><span class="hljs-comment">// any other stuff you need, // it's just a struct } // Render implements the vecty.Component interface. func (a *App) Render() vecty.ComponentOrHTML { return elem.Body( a.header(), elem.Div( vecty.Markup( vecty.Class("columns"), ), // Left half elem.Div( vecty.Markup( vecty.Class("column", "is-half"), ), elem.Div(a.QR()), // QR display zone ), // Right half elem.Div( vecty.Markup( vecty.Class("column", "is-half"), ), vecty.If(!a.session.Started(), elem.Div( a.settings, )), vecty.If(a.session.Started(), elem.Div( a.resultsTable, )), ), ), vecty.Markup( event.KeyDown(a.KeyListener), ), ) }</span></span></code> </pre> <br><p>  Vous √™tes probablement en train de regarder le code et de penser - combien est un travail non fond√© avec le DOM!  Je le pensais aussi au d√©but, mais d√®s que j'ai commenc√© √† travailler, j'ai r√©alis√© √† quel point c'√©tait pratique: </p><br><ol><li>  Il n'y a pas de magie - chaque bloc (Markup ou HTML) est juste une variable du type souhait√©, avec des limites claires o√π vous pouvez mettre quelque chose, gr√¢ce au typage statique. </li><li>  Il n'y a pas de balises d'ouverture / fermeture que vous devez penser √† modifier lors de la refactorisation, ou utiliser l'IDE qui le fait pour vous. </li><li>  La structure devient soudainement claire - par exemple, je n'ai jamais compris pourquoi dans React jusqu'√† la 16√®me version, il √©tait impossible de renvoyer plusieurs balises d'un composant - c'est "juste une cha√Æne".  En voyant comment cela se fait √† Vecty, il est soudainement devenu clair o√π les racines de cette contrainte ont grandi dans React.  Cependant, on ne sait pas pourquoi, apr√®s React 16, cela est devenu possible, mais pas n√©cessaire. </li></ol><br><p>  En g√©n√©ral, d√®s que vous essayez cette approche pour travailler avec le DOM, ses avantages deviendront tr√®s √©vidents.  Il y a aussi des inconv√©nients, bien s√ªr, mais apr√®s les inconv√©nients des m√©thodes habituelles, ils sont invisibles. </p><br><p>  Vecty est appel√© un framework de type React, mais ce n'est pas enti√®rement vrai.  Il existe une biblioth√®que native GopherJS pour React - <a href="">myitcv.io/react</a> , mais je ne pense pas que ce soit une bonne id√©e de r√©p√©ter les solutions architecturales React pour Go.  Lorsque vous √©crivez un frontend sur Vecty, il devient soudain clair √† quel point c'est vraiment plus facile.  Soudain, toute cette magie cach√©e et les nouveaux termes et concepts que chaque framework JavaScript invente deviennent superflus - ils ne sont que de la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">complexit√© suppl√©mentaire</a> , rien de plus.  Il suffit de d√©crire clairement et clairement les composants, leur comportement et de les connecter ensemble - types, m√©thodes et fonctions, et c‚Äôest tout. </p><br><p>  Pour CSS, j'ai utilis√© un framework <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Bulma</a> √©tonnamment d√©cent - il a un nom de classe tr√®s clair et une bonne structure, et le code d'interface utilisateur d√©claratif avec lui est tr√®s lisible. </p><br><p>  La vraie magie, cependant, commence lorsque vous compilez du code Go en JavaScript.  Cela semble tr√®s intimidant, mais, en fait, vous appelez simplement <code>gopherjs build</code> et en moins d'une seconde, vous avez un fichier JavaScript g√©n√©r√© automatiquement pr√™t √† √™tre inclus dans votre page HTML de base (une application r√©guli√®re se compose uniquement d'une balise de corps vide et de l'inclusion de ce Script JS).  Lorsque j'ai ex√©cut√© cette commande pour la premi√®re fois, je m'attendais √† voir beaucoup de messages, d'avertissements et d'erreurs, mais non - cela fonctionne de mani√®re incroyablement rapide et silencieuse, il n'imprime des fichiers sur une seule ligne qu'en cas d'erreurs de compilation g√©n√©r√©es par le compilateur Go, ils sont donc tr√®s clairs.  Mais c'√©tait encore plus cool de voir des erreurs dans la console du navigateur, avec des traces de pile pointant vers des fichiers .go et la ligne correcte!  C'est tr√®s cool. </p><br><h2 id="testirovanie-parametrov-qr-animacii">  Test des param√®tres d'animation QR </h2><br><p>  Pendant plusieurs heures, j'ai eu une application web pr√™te qui m'a permis de changer rapidement les param√®tres de test: </p><br><ul><li>  FPS - fr√©quence d'images </li><li>  Taille de trame QR - combien d'octets doivent √™tre dans chaque trame </li><li>  Niveau de r√©cup√©ration QR - Niveau de correction d'erreur QR </li></ul><br><p>  et ex√©cutez le test automatiquement. </p><br><p><img src="https://habrastorage.org/webt/dl/51/my/dl51myjlg-kfbii5wxjx3ggu9tm.png" alt="app"></p><br><p>  L'application mobile, bien s√ªr, devait √©galement √™tre automatis√©e - elle devait comprendre quand le prochain tour commence avec de nouveaux param√®tres, comprendre quand la r√©ception prend trop de temps et interrompre le tour, envoyer les r√©sultats √† l'application, etc. </p><br><p>  Le hic √©tait que l'application web, lanc√©e dans le sandbox du navigateur, ne pouvait pas cr√©er de nouvelles connexions, et si je ne me trompe pas, la seule possibilit√© d'une v√©ritable connexion peer-to-peer au navigateur est uniquement via WebRTC (je n'ai pas besoin de passer par NAT ), mais c'√©tait trop lourd.  L'application Web ne peut √™tre qu'un client. </p><br><p>  La solution √©tait simple: le service Web Go qui a fourni l'application Web (et lanc√© le navigateur √† l'URL souhait√©e) a √©galement lanc√© le proxy WebSocket pour deux clients.  D√®s que deux clients le rejoignent, il envoie en toute transparence des messages d'une connexion √† une autre, permettant aux clients (application web et client mobile) de communiquer directement.  Ils doivent √™tre pour cela, dans un seul r√©seau WIFI, bien s√ªr. </p><br><p>  Il y avait un probl√®me de savoir comment dire √† un appareil mobile o√π, en fait, se connecter, et cela a √©t√© r√©solu en utilisant ... le code QR! </p><br><p>  Le processus de test ressemble √† ceci: </p><br><ul><li>  une application mobile recherche un code QR avec un marqueur de d√©but et un lien vers un proxy WebSocket </li><li>  d√®s que le jeton est lu, l'application se connecte √† ce proxy WebSocket </li><li>  l'application Web (d√©j√† connect√©e au proxy) comprend que l'application mobile est pr√™te et affiche un code QR avec le marqueur "pr√™t pour le prochain tour?" </li><li>  l'application mobile reconna√Æt le signal, r√©initialise le d√©codeur et envoie un message "yep" via WebSocket. </li><li>  l'application web, apr√®s avoir re√ßu la confirmation, g√©n√®re une nouvelle animation QR et la tord jusqu'√† ce qu'elle re√ßoive les r√©sultats ou le timeout. </li><li>  les r√©sultats sont ajout√©s √† une plaque √† c√¥t√© de laquelle vous pouvez imm√©diatement t√©l√©charger au format CSV </li></ul><br><p><img src="https://habrastorage.org/webt/u_/gm/jx/u_gmjxdtzg16tus3pboxicibyuk.png" alt="conception"></p><br><p>  En cons√©quence, tout ce qui me restait √† faire √©tait simplement de mettre le t√©l√©phone sur un tr√©pied, de lancer l'application, puis les deux programmes eux-m√™mes faisaient tout le sale boulot, communiquant poliment via les codes QR et WebSocket :) </p><br><p><img src="https://habrastorage.org/webt/b-/no/wn/b-nownnc3g_qjijctnqqwpjppri.gif" alt="d√©mo de testeur"></p><br><p>  √Ä la fin, j'ai t√©l√©charg√© le fichier CSV avec les r√©sultats, l'ai conduit vers RStudio et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Plotly Online Chart Maker</a> et analys√© les r√©sultats. </p><br><h1 id="rezultaty">  R√©sultats </h1><br><p>  Le cycle de test complet prend environ 4 heures (malheureusement, la partie la plus difficile du processus - g√©n√©rer une image GIF anim√©e avec des trames QR, a d√ª s'ex√©cuter dans le navigateur, et, puisque le code r√©sultant est toujours en JS, un seul processeur est utilis√©), pendant qui, vous avez d√ª regarder pour que l'√©cran ne soit pas soudainement vide ou qu'une application ne ferme pas la fen√™tre avec l'application Web.  Les param√®tres suivants ont √©t√© test√©s: </p><br><ul><li>  FPS - 3 √† 12 </li><li>  La taille de la trame QR est de 100 √† 1000 octets (par incr√©ments de 50) </li><li>  Les 4 niveaux de correction d'erreur QR (faible, moyen, √©lev√©, le plus √©lev√©) </li><li>  Taille du fichier transf√©r√© - 13 Ko octets g√©n√©r√©s al√©atoirement </li></ul><br><p>  Quelques heures plus tard, j'ai t√©l√©charg√© CSV et j'ai commenc√© √† analyser les r√©sultats. </p><br><p>  Une image est plus importante que mille mots, mais les visualisations 3D interactives sont plus importantes que mille images.  Voici une visualisation des r√©sultats (cliquable): </p><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" title="qr_scan_results"><img src="https://habrastorage.org/getpro/habr/post_images/ba3/833/7f1/ba38337f18e68ef62245173481e497f7.png" alt="qr_scan_results" width="600"></a> <br><br><br><p>  Le meilleur r√©sultat a √©t√© de 1,4 seconde, soit environ 9 Ko / s!  Ce r√©sultat a √©t√© enregistr√© √† une fr√©quence de 11 trames par seconde, une taille de trame de 850 octets et un niveau moyen de correction d'erreur.  Dans la plupart des cas, cependant, √† cette vitesse, le d√©codeur de la cam√©ra a saut√© certaines images et a d√ª attendre la prochaine r√©p√©tition de l'image manqu√©e, ce qui a eu un effet tr√®s n√©gatif sur les r√©sultats - au lieu de deux secondes, il pourrait facilement arriver √† 15, ou un d√©lai d'expiration d√©fini sur 30 secondes. </p><br><p>  Voici les graphiques de la d√©pendance des r√©sultats sur les variables variables: </p><br><h3 id="vremya--razmer-freyma">  Temps d'image / taille </h3><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/pd/9c/rp/pd9crp3igj0djkv3uftlpxcgb2y.png" alt="Temps vs taille"></a> </p><br><p>  Comme vous pouvez le voir, √† des valeurs faibles du nombre d'octets dans chaque trame, le codage excessif est trop grand et le temps de lecture total, respectivement, aussi.  Il y a un minimum local de 500 √† 600 octets par trame, mais les valeurs √† c√¥t√© entra√Ænent toujours des trames perdues.  Le meilleur r√©sultat a √©t√© observ√© √† 900 octets, mais 1000 et plus sont presque une perte de trame garantie. </p><br><h3 id="vremya--fps">  Temps / FPS </h3><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/-g/al/up/-galupwvvmk5k78p2bqgmsg1zme.png" alt="Time vs FPS"></a> </p><br><p>  √Ä ma grande surprise, la valeur du nombre d'images par seconde n'a pas eu un effet tr√®s important - de petites valeurs augmentaient trop le temps de transmission global, et les grandes augmentaient la probabilit√© d'une image manqu√©e.  La valeur optimale, √† en juger par ces tests, est de l'ordre de 6-7 images par seconde pour les appareils sur lesquels j'ai test√©. </p><br><h3 id="vremya--uroven-korrekcii-oshibok">  Temps / Niveau de correction d'erreur </h3><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/c4/2g/di/c42gdiq0sqjxynepawom9j6bpi4.png" alt="Time vs Lvl"></a> </p><br><p>  Le niveau de correction d'erreur a montr√© une relation claire entre le temps de transfert de fichier et le niveau de redondance, ce qui n'est pas surprenant.  Le gagnant clair ici est le faible niveau (L) de correction - les donn√©es moins redondantes, plus le code QR du scanner avec la m√™me taille de donn√©es est plus lisible.  En fait, la redondance n'est pas du tout n√©cessaire pour cette exp√©rience, mais la norme n'offre pas une telle option. </p><br><p>  Bien s√ªr, pour des donn√©es plus objectives, ce test devrait √™tre ex√©cut√© des centaines et des milliers de fois, sur diff√©rents appareils et diff√©rents √©crans, mais pour mon exp√©rience de week-end, c'√©tait un r√©sultat largement suffisant. </p><br><h1 id="vyvody">  Conclusions </h1><br><p>  Ce projet amusant a prouv√© que le transfert de donn√©es √† sens unique via des codes anim√©s est certainement possible, et pour les situations o√π vous devez transf√©rer une petite quantit√© en l'absence de tout type de r√©seaux, il est tout √† fait appropri√©.  Bien que mon r√©sultat maximum soit d'environ 9 Ko / s, dans la plupart des cas, la vitesse r√©elle √©tait de 1 √† 2 Ko / s. </p><br><p>  J'ai √©galement beaucoup aim√© utiliser Gomobile et GopherJS avec Vecty comme outil de r√©solution de probl√®mes de routine.  Ce sont des projets tr√®s matures, avec une excellente rapidit√© de travail, et, dans la plupart des cas, donnant de l'exp√©rience "√ßa marche". </p><br><p>  En fin de compte, j'admire toujours √† quel point vous pouvez √™tre productif avec Go lorsque vous savez clairement ce que vous voulez impl√©menter - le cycle extr√™mement court "changer" - "assembler" - "v√©rifier" vous permet d'exp√©rimenter beaucoup et souvent, du code simple et l'absence d'une hi√©rarchie de classes dans la structure Les programmes permettent de les refactoriser facilement et sans douleur lors de vos d√©placements, et la fantastique plateforme multiplateforme int√©gr√©e au langage depuis le tout d√©but vous permet d'√©crire le code une fois et de l'utiliser sur le serveur, sur le client Web et dans l'application mobile native.  Dans le m√™me temps, malgr√© des performances largement suffisantes, il reste encore beaucoup d'espace pour l'optimisation et l'acc√©l√©ration. </p><br><p>  Donc, si vous n'avez jamais essay√© Gomobile ou GopherJS - je vous recommande d'essayer √† la prochaine occasion.  Cela prendra une heure de votre temps, mais cela peut ouvrir une toute nouvelle couche d'opportunit√©s dans le d√©veloppement Web ou mobile.  N'h√©sitez pas √† essayer! </p><br><h1 id="ssylki">  Les r√©f√©rences </h1><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://github.com/divan/txqr</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://github.com/divan/txqr/tree/master/cmd/txqr-tester</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://github.com/divan/txqr-tester-ios</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://github.com/divan/txqr-reader</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://github.com/gopherjs/vecty</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://github.com/golang/mobile</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr430688/">https://habr.com/ru/post/fr430688/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr430678/index.html">Test de dix gradateurs avec lampes LED</a></li>
<li><a href="../fr430680/index.html">√âcrire un processeur et un environnement simples pour cela</a></li>
<li><a href="../fr430682/index.html">Trois ans du projet de microsatellites lunaires: √©tapes de la croissance</a></li>
<li><a href="../fr430684/index.html">Analyse des contrats Ethereum en direct pour une erreur d'envoi non contr√¥l√©. 2e partie</a></li>
<li><a href="../fr430686/index.html">Pr√©sentation: la premi√®re machine de d√©coupe au jet d'eau de WAZER</a></li>
<li><a href="../fr430690/index.html">Exceptions d√©terministes et gestion des erreurs dans le ¬´C ++ du futur¬ª</a></li>
<li><a href="../fr430692/index.html">Ing√©nierie sociale avec le logiciel Universal Windows Platform (APPX)</a></li>
<li><a href="../fr430694/index.html">Un petit guide pour apprendre le C ++: quoi, quand et sur quoi cr√©er</a></li>
<li><a href="../fr430700/index.html">Un syst√®me unifi√© d'enregistrement des vues de films en ligne commencera √† fonctionner en Russie</a></li>
<li><a href="../fr430702/index.html">Formation tr√®s √©trange</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>