<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üõ•Ô∏è üíÑ üêª Como eu ensinei AI a jogar Tetris para NES. Parte 2: AI üëâüèº üñ§ üßò</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A primeira parte (an√°lise de c√≥digo) est√° aqui: https://habr.com/post/420725/ . 

 Algoritmo 
 Descri√ß√£o do produto 
 O algoritmo executa continuament...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Como eu ensinei AI a jogar Tetris para NES. Parte 2: AI</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/421065/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cfd/2c5/a7e/cfd2c5a7e44131bfc188c3eea6ad5139.png" alt="imagem"></div><br>  A primeira parte (an√°lise de c√≥digo) est√° aqui: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://habr.com/post/420725/</a> . <br><br><h2>  Algoritmo </h2><br><h3>  Descri√ß√£o do produto </h3><br>  O algoritmo executa continuamente as seguintes etapas: <br><br><ol><li>  Ele espera at√© que um novo tetrimino seja criado. </li><li>  Verifica o tipo do tetrimino rec√©m-criado, o tipo do pr√≥ximo tetrimino (figura no campo de visualiza√ß√£o) e o conte√∫do do campo de jogo. </li><li>  Explora todas as maneiras poss√≠veis de adicionar dois tetriminos ao campo de jogo e avalia cada probabilidade. </li><li>  Move o tetrimino rec√©m-criado para que ele corresponda √† localiza√ß√£o da melhor probabilidade detectada. </li></ol><br>  Cada uma dessas etapas √© descrita em detalhes abaixo. <br><br><h3>  Bloquear pesquisa </h3><br>  Considere uma vers√£o simplificada do Tetris, na qual as formas n√£o caem automaticamente.  A √∫nica maneira de reduzir a figura √© baix√°-la suavemente.  Depois de remover os tempos do jogo, podemos descrever completamente o estado do tetrimino ativo por sua posi√ß√£o e orienta√ß√£o.  A figura possui um local conhecido de cria√ß√£o inicial e as seguintes opera√ß√µes s√£o usadas para converter de um estado para outro: <br><br><ul><li>  Um passo para baixo </li><li>  Um passo √† esquerda </li><li>  Mova um passo para a direita </li><li>  Gire um passo no sentido anti-hor√°rio </li><li>  Rota√ß√£o no sentido hor√°rio </li></ul><a name="habracut"></a><br>  Essas opera√ß√µes s√£o aplic√°veis ‚Äã‚Äãapenas quando os quadrados do tetrimino resultante correspondem a c√©lulas vazias do campo de jogo.  Quando √© imposs√≠vel descer um passo, o estado √© considerado bloqueado.  No entanto, como simplificamos o Tetris e a espera pelo bloqueio √© essencialmente infinita, o estado bloqueado pode ser transformado ainda mais por outras opera√ß√µes, deslizando e rolando. <br><br>  Muitos estados bloqueados com uma sequ√™ncia m√≠nima de opera√ß√µes que os criam podem ser encontrados usando a BFS (largura da primeira pesquisa).  Conforme indicado abaixo, ele usa uma fila para armazenar resultados intermedi√°rios. <br><br><ol><li>  Enfileiramos o estado na cria√ß√£o. </li><li>  Deduzimos o estado da fila. </li><li>  Obtemos os seguintes estados usando a opera√ß√£o de convers√£o. </li><li>  Se n√£o houver movimento descendente entre eles, o estado removido da fila ser√° bloqueado. </li><li>  Enfileiramos estados subsequentes que ainda n√£o foram visitados. </li><li>  Se a fila n√£o estiver vazia, repita da etapa 2. </li></ol><br>  O programa representa cada estado como um objeto com os seguintes campos: <br><br> <code>{ x, y, rotation, visited, predecessor }</code> <br> <br>  No processo de prepara√ß√£o, o programa cria uma matriz tridimensional de objetos de estado (20 linhas √ó 10 colunas √ó 4 voltas), inicializando <code>x</code> , <code>y</code> <code>rotation</code> acordo. <br><br>  O campo <code>visited</code> √© marcado quando o estado est√° na fila.  No BFS, isso √© v√°lido porque cada estado subsequente aumenta o comprimento total do caminho em 1. Ou seja, aumentando o comprimento do caminho, √© imposs√≠vel criar um estado subsequente que precisa ser inserido em outro lugar que n√£o seja o final da fila para manter a ordem. <br><br>  O campo <code>predecessor</code> indica o objeto de estado do qual o estado atual √© derivado.  √â definido quando o estado est√° na fila.  O estado de cria√ß√£o n√£o possui estados anteriores. <br><br>  O conjunto de estados bloqueados detectados durante a pesquisa √© determinado pelo tipo de tetrimino e pelos blocos preenchidos no campo de jogo.  A sequ√™ncia dos movimentos que os gerou pode ser esclarecida (na ordem inversa) seguindo os links <code>predecessor</code> ao estado de cria√ß√£o.  Quando a constante <code>PLAY_FAST</code> √© configurada como <code>true</code> no in√≠cio do programa, ela ignora completamente os estados anteriores colocando diretamente o tetrimino no campo e bloqueando-o. <br><br>  Uma matriz tridimensional de objetos de estado, uma fila e BFS s√£o compactados em uma classe.  Ele tem um m√©todo de busca que recebe o campo de jogo (matriz bidimensional), o tipo de tetrimino e o ouvinte.  Cada vez que um estado bloqueado √© detectado, o campo de jogo √© atualizado adicionando tetrimino ao local apropriado.  Em seguida, o campo de jogo alterado, juntamente com as informa√ß√µes sobre as altera√ß√µes, s√£o transmitidos ao ouvinte para processamento.  Depois que o ouvinte completa o retorno, o campo de jogo √© restaurado. <br><br>  O ouvinte √© usado para combinar v√°rias opera√ß√µes de pesquisa em uma cadeia, o que possibilita encontrar todas as maneiras poss√≠veis de adicionar dois (ou mais) tetriminos ao campo de jogo.  O primeiro mecanismo de pesquisa da cadeia executa o BFS apenas uma vez.  No entanto, o segundo mecanismo de pesquisa executa o BFS toda vez que a primeira pesquisa detecta um estado bloqueado.  E assim por diante, se houver outros mecanismos de pesquisa na cadeia. <br><br>  O ouvinte do √∫ltimo mecanismo de pesquisa avalia o campo de jogo alterado.  Quando ele encontra o campo de jogo melhor do que o que foi investigado anteriormente, ele anota o objeto usado do estado bloqueado, que atualmente usa o primeiro mecanismo de pesquisa da cadeia.  Como o primeiro mecanismo de pesquisa executa o BFS apenas uma vez, os campos <code>predecessor</code> de seus objetos de estado permanecem v√°lidos at√© a conclus√£o de todo o processo de pesquisa.  Ou seja, o √∫ltimo ouvinte registra essencialmente o caminho ao longo do qual o primeiro tetrimino deve seguir para obter a melhor configura√ß√£o do campo de jogo como resultado. <br><br><h3>  Fun√ß√£o de avalia√ß√£o </h3><br>  A fun√ß√£o de pontua√ß√£o atribui um valor ao campo de jogo alterado - uma soma ponderada de v√°rios par√¢metros de influ√™ncia.  A fun√ß√£o de avalia√ß√£o usada neste caso √© baseada na fun√ß√£o desenvolvida por <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Islam Al-Ashi</a> .  Ele usa os seguintes par√¢metros: <br><br><ul><li>  <b>N√∫mero total de linhas limpas</b> : este √© o n√∫mero total de linhas que ser√£o limpas pela adi√ß√£o de dois tetriminos. </li><li>  <b>Altura total de bloqueio</b> : a <b>altura de bloqueio</b> √© a altura acima do piso do campo de jogo em que a figura est√° bloqueada.  Esta √© a dist√¢ncia vertical que uma figura bloqueada cairia se voc√™ remover todos os outros quadrados ocupados do campo de jogo e manter a orienta√ß√£o da figura.  A altura total de bloqueio √© a soma das alturas de bloqueio dos dois tetriminos. </li><li>  <b>O n√∫mero total de c√©lulas "boas"</b> : uma c√©lula de po√ßo √© uma c√©lula vazia localizada acima de todas as c√©lulas ocupadas em uma coluna, de modo que seus vizinhos esquerdo e direito sejam c√©lulas ocupadas;  ao determinar os po√ßos, as paredes do campo de jogo s√£o consideradas c√©lulas ocupadas.  A ideia √© que um po√ßo seja uma estrutura aberta no topo, fechada no fundo e cercada por paredes de ambos os lados.  A probabilidade de lacunas intermitentes nas paredes do po√ßo significa que as c√©lulas do po√ßo n√£o ocorrem necessariamente em uma pilha cont√≠nua dentro de uma coluna. </li><li>  <b>N√∫mero total de orif√≠cios nas colunas</b> : o orif√≠cio na coluna √© uma c√©lula vazia localizada imediatamente abaixo da c√©lula ocupada.  O g√™nero do campo de jogo n√£o √© comparado com a c√©lula acima dele.  N√£o h√° furos nas colunas vazias. </li><li>  <b>N√∫mero total de transi√ß√µes em colunas</b> : uma transi√ß√£o em colunas √© uma c√©lula vazia adjacente a uma c√©lula ocupada (ou vice-versa) em uma √∫nica coluna.  A combina√ß√£o do bloco de colunas ocupado mais acima com o espa√ßo vazio acima dele n√£o √© considerada uma transi√ß√£o.  Da mesma forma, o piso do campo de jogo tamb√©m n√£o √© comparado com a c√©lula acima dele.  Portanto, n√£o h√° transi√ß√µes em uma coluna completamente vazia. </li><li>  <b>N√∫mero total de transi√ß√µes em linhas</b> : uma transi√ß√£o em linhas √© uma c√©lula vazia adjacente a uma c√©lula ocupada (ou vice-versa) na mesma linha.  C√©lulas vazias perto das paredes do campo de jogo s√£o consideradas transi√ß√µes.  O valor total √© calculado para todas as linhas do campo de jogo.  No entanto, linhas completamente vazias n√£o s√£o levadas em considera√ß√£o no n√∫mero total de transi√ß√µes. </li></ul><br>  El-Ashi sugeriu que pesos √∫teis podem ser encontrados usando o algoritmo de otimiza√ß√£o de enxame de part√≠culas (PSO), que melhora iterativamente o conjunto de solu√ß√µes, simulando o comportamento do enxame observado na natureza.  No nosso caso, cada solu√ß√£o √© um vetor de peso e a adequa√ß√£o da op√ß√£o √© determinada pelo jogo no Tetris;  este √© o n√∫mero total de tetriminos durante os quais ele sobreviveu at√© o final do jogo. <br><br>  Essas id√©ias s√£o aplicadas na vers√£o Java descrita abaixo;  ele roda fora do FCEUX e pode ser configurado para um jogo na mem√≥ria n√£o gr√°fico, rodando a uma velocidade muito maior.  Depois de preparar o PSO, fiquei surpreso ao ver que o algoritmo n√£o se move mais ap√≥s a itera√ß√£o inicial.  Ap√≥s essa itera√ß√£o, v√°rias variantes de solu√ß√£o geradas aleatoriamente j√° eram muito boas.  Por v√°rios dias, o tamanho desse conjunto diminuiu at√© restar apenas uma op√ß√£o.  Aqui est√£o os valores para esta solu√ß√£o: <br><br><table><tbody><tr><th>  Par√¢metro </th><th>  Peso </th></tr><tr><td>  N√∫mero total de linhas limpas </td><td> <code>1.000000000000000</code> </td> </tr><tr><td>  Altura total de bloqueio </td><td> <code>12.885008263218383</code> </td> </tr><tr><td>  N√∫mero total de c√©lulas de po√ßo </td><td> <code>15.842707182438396</code> </td> </tr><tr><td>  O n√∫mero total de furos nas colunas </td><td> <code>26.894496507795950</code> </td> </tr><tr><td>  O n√∫mero total de transi√ß√µes nas colunas </td><td> <code>27.616914062397015</code> </td> </tr><tr><td>  Total de saltos de linha </td><td> <code>30.185110719279040</code> </td> </tr></tbody></table><br>  O campo de jogo foi estimado multiplicando os par√¢metros pelos respectivos pesos e somando os resultados.  Quanto menor o valor, melhor a solu√ß√£o.  Como todos os par√¢metros e pesos t√™m valores positivos, todos os par√¢metros prejudicam a avalia√ß√£o geral;  cada um deles deve ser minimizado.  Isso tamb√©m significa que a melhor pontua√ß√£o √© 0. <br><br>  Como esses pesos foram selecionados aleatoriamente, a faixa de valores adequados pode ser muito ampla.  Esse conjunto espec√≠fico de n√∫meros e a import√¢ncia relativa estimada de cada par√¢metro podem n√£o ser relevantes.  No entanto, ser√° interessante observ√°-los de perto. <br><br>  O par√¢metro menos prejudicial √© o n√∫mero total de linhas limpas.  O fato de esta op√ß√£o ser prejudicial √© contra-intuitivo.  Mas o principal objetivo da IA ‚Äã‚Äã√© a sobreviv√™ncia.  Ele n√£o se esfor√ßa para obter mais pontos.  Em vez disso, ele joga de maneira conservadora, geralmente limpando as fileiras uma de cada vez.  Para obter Double, Triple ou Tetris, voc√™ precisa cultivar um monte que vai contra o objetivo de longo prazo. <br><br>  O pr√≥ximo na lista √© a altura total do bloqueio.  Pode ser minimizado abaixando o tetrimino o mais pr√≥ximo poss√≠vel do ch√£o.  Essa √© uma estrat√©gia simples que contribui a longo prazo para a sobreviv√™ncia e, a curto prazo, para embalagens de qualidade de pe√ßas. <br><br>  O peso atribu√≠do ao n√∫mero total de c√©lulas de po√ßos parece um pouco surpreendente, porque jogadores experientes geralmente constroem po√ßos profundos intencionalmente para coletar v√°rios Tetris (combina√ß√µes de quatro linhas) seguidas.  Mas, como mencionado acima, este √© um jogo arriscado, ao contr√°rio do objetivo principal - a sobreviv√™ncia.  Al√©m disso, o n√∫mero de po√ßos √© um indicador da "rugosidade" da pilha.  Um certo n√≠vel de irregularidade √© ben√©fico ao colocar determinadas figuras ou combina√ß√µes de figuras.  Mas a alta rugosidade causa danos √† embalagem apertada. <br><br>  O n√∫mero total de furos nas colunas √© aproximadamente metade do n√∫mero total de transi√ß√µes nas colunas.  Esses par√¢metros podem ser combinados e recolhidos em um par√¢metro relacionado comum, obtendo um par√¢metro mais extenso e mais prejudicial: o n√∫mero total de transi√ß√µes. <br><br>  As √°reas densamente compactadas t√™m um pequeno n√∫mero de transi√ß√µes em todas as dire√ß√µes.  Portanto, a principal estrat√©gia, impulsionada pela intelig√™ncia artificial, pode ser brevemente descrita da seguinte forma: empacote as pe√ßas o mais pr√≥ximo poss√≠vel uma da outra. <br><br><h3>  Outras op√ß√µes </h3><br>  Aqui est√° uma lista de mais alguns par√¢metros que experimentei durante o desenvolvimento da IA: <br><br><ul><li>  <b>Altura da pilha</b> : blocos movimentados podem pairar sobre c√©lulas vazias, criando sali√™ncias e buracos;  no entanto, n√£o √© poss√≠vel bloquear blocos ocupados em linhas completamente vazias.  Portanto, altura da pilha √© o n√∫mero de linhas que cont√™m pelo menos um bloco ocupado. </li><li>  <b>N√∫mero total de colunas ocupadas</b> : este √© o n√∫mero de colunas que cont√™m pelo menos uma c√©lula ocupada. </li><li>  <b>N√∫mero total de c√©lulas ocupadas</b> : o n√∫mero de c√©lulas ocupadas no campo de jogo. </li><li>  <b>N√∫mero total de √°reas conectadas</b> : o algoritmo de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">preenchimento</a> √© usado aqui para calcular o n√∫mero de √°reas conectadas continuamente.  Al√©m de encontrar "ilhas" ocupadas, ele descobre buracos que se estendem ao longo dos dois eixos. </li><li>  <b>Dispers√£o da altura da coluna</b> : √© uma medida estat√≠stica da varia√ß√£o nas alturas da coluna.  √â um indicador de rugosidade da superf√≠cie. </li><li>  <b>Valor total de adapta√ß√£o</b> : calcula o valor de adapta√ß√£o do heap para a pr√≥xima figura desconhecida.  Ele conta o n√∫mero total de maneiras pelas quais 7 tipos de formas podem ser adicionados ao campo de jogo sem a apar√™ncia de novos furos.  Para uma contagem precisa, ser√° necess√°rio o uso repetido de BFS.  Mas, para um c√°lculo aproximado, a √°rvore de pesquisa pode ser muito truncada. </li><li>  <b>Classifica√ß√£o m√©dia para a pr√≥xima figura</b> : esse par√¢metro aprofunda a pesquisa analisando todas as possibilidades para a pr√≥xima figura desconhecida.  Ele usa outros par√¢metros para separar a localiza√ß√£o de cada tipo de figura e, em seguida, retorna a m√©dia para 7 classifica√ß√µes.  Para cada posicionamento da figura, √© necess√°rio o BFS. </li><li>  <b>Jogo simulado m√©dio</b> : o par√¢metro simula uma s√©rie de jogos no Tetris, selecionando pe√ßas usando seu pr√≥prio gerador de n√∫meros pseudo-aleat√≥rios e usando a IA para trabalhar com elas.  No final de cada jogo, o campo de jogo √© avaliado usando outros par√¢metros.  O valor m√©dio para todos os lotes √© retornado. </li></ul><br>  Todos os par√¢metros podem ser personalizados adicionando fatores personalizados.  Por exemplo, em vez de simplesmente calcular as linhas limpas, voc√™ pode atribuir seus pr√≥prios pesos para Single, Double, Triple e Tetris, simulando um sistema de pontos.  Se a limpeza simult√¢nea de v√°rias linhas prejudicar o objetivo de sobreviv√™ncia a longo prazo, ent√£o linhas √∫nicas podem receber peso negativo, enquanto outras podem ficar positivas. <br><br>  Outro fator √∫til √© o valor de compensa√ß√£o.  Por exemplo, uma superf√≠cie perfeitamente plana de uma pilha tem uma dispers√£o de alturas de coluna de 0. Mas uma superf√≠cie perfeitamente plana n√£o se adapta a S e Z, assim como a outras combina√ß√µes de formas.  Portanto, subtraindo a constante, a varia√ß√£o deve ser centrada em torno da rugosidade ideal. <br><br>  Os par√¢metros ajustados e tendenciosos podem ser aumentados at√© certo ponto, para que antes do c√°lculo da soma ponderada eles possam escalar logaritmicamente ou exponencialmente.  Todas essas probabilidades podem ser consideradas como pesos adicionais que podem ser potencialmente otimizados por m√©todos como PSO. <br><br>  Muitos dos par√¢metros permitem entender como a pilha pode lidar com pe√ßas adicionais, por exemplo, aquelas que lidam com a rugosidade da superf√≠cie, mas a "quantidade total de adapta√ß√£o", "classifica√ß√£o m√©dia da pr√≥xima figura" e "jogo simulado m√©dio" avaliam o campo de jogo alterado inserir figuras que n√£o est√£o inclu√≠das nos dois conhecidos.  No estudo das figuras subseq√ºentes, devido √† r√°pida elimina√ß√£o das s√©ries, a quantidade de conhecimento adicional obtido diminui com a profundidade.  Isso significa que o longo percurso do partido n√£o √© t√£o importante, e o curso do partido no futuro distante tamb√©m n√£o √© muito importante.  De fato, se uma curta sequ√™ncia de figuras √© aleatoriamente configurada incorretamente, a IA restaura rapidamente o jogo, usando as seguintes figuras para limpar as linhas afetadas.  Determinar o valor ideal para a an√°lise de figuras subsequentes requer mais pesquisas. <br><br>  Outro aspecto da utilidade de um par√¢metro √© o custo computacional.  Os custos aumentam bastante porque a fun√ß√£o de avalia√ß√£o √© chamada para cada coloca√ß√£o poss√≠vel de dois n√∫meros.  Como a IA deve poder reproduzir o Tetris em tempo real, os fatores de custo que fornecem informa√ß√µes valiosas podem ser trocados por t√©cnicas mais aproximadas, que s√£o executadas mais rapidamente. <br><br><h3>  Treinamento de IA </h3><br>  Existem sequ√™ncias patol√≥gicas que podem levar ao Game Over, independentemente da estrat√©gia.  O exemplo mais simples √© a sequ√™ncia intermin√°vel de tetrimino S e Z, que, como mostrado na anima√ß√£o, leva rapidamente a IA a perder. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cb2/66a/2ba/cb266a2ba3575a43876e33f6a2948737.gif"></div><br>  Como leva dias para executar a variante AI antes da conclus√£o de v√°rios lotes e calcular a m√©dia, √© completamente impratic√°vel usar a dura√ß√£o m√©dia do lote como uma m√©trica de controle PSO.  Em vez disso, voc√™ pode aumentar a complexidade do jogo com uma velocidade controlada, aumentando a frequ√™ncia de S e Z, o que com o tempo levar√° √† cria√ß√£o alternativa apenas desse par de figuras. <br><br>  Tentei usar esse m√©todo de ensino, mas descobri que ensinar IA a trabalhar com S e Z freq√ºentes prejudica a capacidade de lidar com formas aleat√≥rias distribu√≠das uniformemente. <br><br>  Em um m√©todo alternativo inspirado no jogo do tipo B, a m√©trica PSO controla a frequ√™ncia da limpeza das linhas.  O campo de jogo √© um diagrama de 10 linhas de blocos de lixo aleat√≥rios e, cada vez que a linha √© limpa, uma nova linha de lixo aparece abaixo, restaurando a altura da pilha.  Como o campo de jogo tem uma largura de 10 colunas e cada tetrimino consiste em 4 quadrados, em m√©dia, a IA deve limpar uma linha a cada 2,5 tetrimino.  E para se livrar do lixo, ele deve faz√™-lo ainda mais r√°pido. <br><br>  Infelizmente, essa t√©cnica tamb√©m n√£o melhorou o desempenho.  Uma raz√£o prov√°vel √© que os buracos de lixo aleat√≥rios n√£o correspondem exatamente √†s strings com as quais a IA lida no jogo real.  Al√©m disso, limpar a linha √© uma meta de curto prazo;  limpeza de linha gananciosa n√£o melhora necessariamente a sobreviv√™ncia a longo prazo.  De tempos em tempos, as linhas n√£o devem ser tocadas para processar certas combina√ß√µes de figuras subseq√ºentes. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Colin Fei</a> sugeriu uma abordagem diferente em sua p√°gina da web.  Ele criou histogramas que mostram a porcentagem de formas bloqueadas em cada linha durante os lotes de teste.  Curiosamente, todos os histogramas parecem quase id√™nticos, independentemente do n√∫mero de figuras criadas.  Com base nisso, ele sugeriu que voc√™ possa usar uma imagem aproximada da fun√ß√£o para qualquer lote de avalia√ß√£o ao avaliar a expectativa estat√≠stica de bloquear uma figura na linha de cria√ß√£o, obtendo assim o tempo durante o qual a IA ser√° reproduzida at√© o final do jogo.  Eu decidi explorar essa possibilidade. <br><br>  Abaixo est√° um mapa de calor de muitos lotes de teste, no total contendo 2.039.900.000 de tetrimino.  Cada c√©lula √© colorida com base na porcentagem de formas bloqueadas nela.  Para aprimorar o contraste visual, uma paleta n√£o linear √© selecionada.  O mapa foi criado normalizando os valores das c√©lulas, dividindo pela porcentagem m√°xima de c√©lulas e anunciando a pot√™ncia de 0,19 (consulte <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">"corre√ß√£o gama"</a> ). <br><br><table><tbody><tr><td><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d13/bcd/196/d13bcd1968b1f71c3311f7007c6f573e.png"></div></td><td><table><tbody><tr><th>  Cor </th><th>  Percentagem </th></tr><tr><td>  <font color="#000000">‚ñ†</font> </td><td> <code>0.00000000</code> </td> </tr><tr><td>  <font color="#0066FF">‚ñ†</font> </td><td> <code>0.00000315</code> </td> </tr><tr><td>  <font color="#00CCFF">‚ñ†</font> </td><td> <code>0.00024227</code> </td> </tr><tr><td>  <font color="#00FFCC">‚ñ†</font> </td><td> <code>0.00307038</code> </td> </tr><tr><td>  <font color="#00FF66">‚ñ†</font> </td><td> <code>0.01860818</code> </td> </tr><tr><td>  <font color="#00FF00">‚ñ†</font> </td><td> <code>0.07527774</code> </td> </tr><tr><td>  <font color="#66FF00">‚ñ†</font> </td><td> <code>0.23582574</code> </td> </tr><tr><td>  <font color="#CCFF00">‚ñ†</font> </td><td> <code>0.61928352</code> </td> </tr><tr><td>  <font color="#FFCC00">‚ñ†</font> </td><td> <code>1.42923040</code> </td> </tr><tr><td>  <font color="#FF6600">‚ñ†</font> </td><td> <code>2.98867416</code> </td> </tr><tr><td>  <font color="#FF0000">‚ñ†</font> </td><td> <code>5.78182519</code> </td> </tr></tbody></table></td></tr></tbody></table><br>  As listras laranja escuro e vermelho nas linhas 17 e 18 significam que a grande maioria das figuras termina ali.  A tonalidade verde p√°lida de baixo √© uma conseq√º√™ncia da geometria das figuras: apenas 4 dos 7 tipos de tetrimino podem aparecer na linha inferior.  Os cantos inferiores s√£o pretos porque √© imposs√≠vel chegar l√°. <br><br>  A cor ao longo de cada linha √© quase uniforme, e isso sugere que as formas s√£o distribu√≠das horizontalmente uniformemente.  Pequenas lacunas podem ser explicadas observando os histogramas de tipos individuais de formas: <br><br><table><tbody><tr><td>  <b>T</b> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/82c/fb3/c14/82cfb3c1456fce7726985859554021d8.png"></div></td><td>  <b>J</b> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ebd/f38/1a2/ebdf381a25323b9c73eaed6c467064b5.png"></div></td><td>  <b>Z</b> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/381/986/389/38198638921c4dcbc3a8f1978e665b89.png"></div></td><td>  <b>O</b> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/669/be1/5e4/669be15e4ba1b9becffb4ee97e398cbb.png"></div></td><td>  <b>S</b> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/dc8/79c/2a5/dc879c2a52f1020a69f76e9554fca978.png"></div></td><td>  <b>L</b> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fbf/204/acb/fbf204acb6d376818fc6e98f8f517e4e.png"></div></td><td>  <b>Eu</b> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7bb/e41/92b/7bbe4192bbb2204d4b677a9a36354da2.png"></div></td></tr></tbody></table><br>  T √© o tipo mais universal: seu histograma √© mais uniforme que todos os outros.  Anomalias no histograma J - o resultado da influ√™ncia das paredes;  apenas <code>Jr</code> e <code>Jl</code> podem estar nas colunas laterais, o que faz com que a IA use as colunas 1 e 9. com mais freq√º√™ncia para compensar.O mesmo se aplica a L. Os histogramas Z e S parecem aproximadamente os mesmos, o que enfatiza o desequil√≠brio devido ao fato de <code>Zv</code> e <code>Sv</code> n√£o s√£o imagens espelhadas perfeitas uma da outra.  O tipo O √© limitado a um campo de jogo de 19 √ó 9 e parece que a IA tem maior probabilidade de usar O nas laterais do que no centro.  Tetrimino I √© deslocado para a direita, porque seu ponto de partida est√° localizado l√°;  portanto, o bloqueio na coluna 1 √© raro. <br><br>  A tabela mostra a porcentagem de n√∫meros bloqueados em cada linha. <br><br><table><tbody><tr><th>  String </th><th>  Percentagem </th></tr><tr><td>  0 0 </td><td>  0,0000000000 </td></tr><tr><td>  1 </td><td>  0,0000000000 </td></tr><tr><td>  2 </td><td>  0.0000004902 </td></tr><tr><td>  3 </td><td>  0.0000026472 </td></tr><tr><td>  4 </td><td>  0.0000066180 </td></tr><tr><td>  5 </td><td>  0.0000172557 </td></tr><tr><td>  6 </td><td>  0.0000512280 </td></tr><tr><td>  7 </td><td>  0.0001759400 </td></tr><tr><td>  8 </td><td>  0.0006681210 </td></tr><tr><td>  9 </td><td>  0.0023187901 </td></tr><tr><td>  10 </td><td>  0.0077928820 </td></tr><tr><td>  11 </td><td>  0.0259672043 </td></tr><tr><td>  12 </td><td>  0.0866187068 </td></tr><tr><td>  13 </td><td>  0.2901315751 </td></tr><tr><td>  14 </td><td>  0.9771663807 </td></tr><tr><td>  15 </td><td>  3.3000408353 </td></tr><tr><td>  16 </td><td>  10.6989059268 </td></tr><tr><td>  17 </td><td>  28.5687976371 </td></tr><tr><td>  18 </td><td>  50.0335706162 </td></tr><tr><td>  19 </td><td>  6.0077671454 </td></tr></tbody></table><br>  Aqui est√° um gr√°fico dos valores: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8a6/943/9d8/8a69439d8d818e46921cc5c9b75bd345.png"></div><br>  Se a linha 19 n√£o for levada em considera√ß√£o, o gr√°fico mostra um crescimento exponencial. <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> A seguir, √© apresentada uma lista das propor√ß√µes do n√∫mero de formas bloqueadas nas linhas adjacentes. </font></font><br><br><table><tbody><tr><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">String </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> / String </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">B</font></font></sub> </th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Rela√ß√£o (%) </font></font></th></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1/2 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 0,00 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 2/3 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 18,52 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 3/4 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 40,00 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 4/5 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 38,35 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 5/6 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 33,68 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 6/7 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 29/12 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 8/7 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 26,33 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 9/8 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 28,81 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 9/10 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 29,76 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 10/11 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 30/01 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 11/12 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 29,98 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 13/12 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 29,85 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 13/14 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 29,69 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 14/15 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 29,61 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 15/16 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 30,84 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 16/17 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 37,45 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 17/18 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 57,10 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 18/19 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 832,81 </font></font></td></tr></tbody></table><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As linhas </font></font><code>16‚Äì19</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">levam em considera√ß√£o as figuras que interagem com o ch√£o do campo de jogo, para que possam ser descartadas. Nas linhas, a </font></font><code>0‚Äì5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sele√ß√£o √© pequena demais para ser significativa. As taxas restantes, pares 6 / 7‚Äì14 / 15, s√£o quase id√™nticas; seu valor m√©dio √© de 29,24%. Isso significa que a probabilidade de o heap crescer uma linha √© aproximadamente a mesma, independentemente da altura do heap. Isso √© l√≥gico, porque as regras do Tetris limitam a intera√ß√£o na parte superior da pilha quando ela est√° compactada. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O gr√°fico a seguir mostra o log de </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> % das figuras nas linhas 6‚Äì15.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fd6/7ec/745/fd67ec745b6509ae7c165ae0ebabedcc.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√â pr√≥ximo a uma linha perfeitamente reta com um </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">coeficiente de determina√ß√£o</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pr√≥ximo a 1 </font><font style="vertical-align: inherit;">. A f√≥rmula derivada da </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">regress√£o linear</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mostrada acima </font><font style="vertical-align: inherit;">nos d√° a interse√ß√£o com o eixo Y, assumindo que a porcentagem de formas na linha 0 seja aproximadamente 10 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚àí7,459</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> %. O inverso desse valor nos d√° uma expectativa estat√≠stica de 2.877.688.349 tetrimino ou 1.151.175.340 linhas at√© o final do jogo. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Isso nos faz entender que o log </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a porcentagem de figuras em cada linha permanece linear at√© a linha 0. No entanto, quando a pilha quase atinge o teto do campo de jogo, a liberdade de movimento √© limitada a tal ponto que essa propriedade √© violada. Al√©m disso, bloquear uma pe√ßa na linha 0 n√£o significa necessariamente game over; voc√™ ainda pode ser salvo se houver um lugar para criar novas figuras. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Outra maneira de avaliar a for√ßa da IA ‚Äã‚Äã√© medir o n√∫mero m√©dio de formas criadas entre a limpeza completa do campo de jogo. A limpeza completa pode ser obtida com apenas 5 tetriminos. Por exemplo, entre outras possibilidades, isso pode ser alcan√ßado por cinco figuras O dispostas no ch√£o do campo de jogo.Em geral, como cada tetrimino consiste em 4 quadrados e a largura do campo de jogo √© 10 quadrados, o n√∫mero de figuras criadas entre a limpeza completa deve ser um m√∫ltiplo de 5 ( desde</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4 √ó 5n = 2 √ó 10n</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Minha IA tem um n√∫mero m√©dio de formas criadas entre as limpezas de campo completo de 1.181 - um n√∫mero bastante pequeno. Como uma limpeza completa √© como reiniciar um jogo, um lote inteiro pode ser visto como uma s√©rie extremamente longa de reinicializa√ß√µes do jogo, seguida por um r√°pido avan√ßo no fim do jogo. Como a sequ√™ncia de alternativas descrita acima </font></font><code>SZ</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, as seq√º√™ncias patol√≥gicas que levam ao final do jogo s√£o geralmente muito curtas. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O histograma abaixo mostra a probabilidade (em porcentagem) de que a IA alcance uma limpeza completa do campo ap√≥s o n√∫mero especificado de figuras criadas.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f7f/665/112/f7f66511246ef114d27d325a21c9b785.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A ordem dos graus na f√≥rmula acima determina a taxa de diminui√ß√£o e, presumivelmente, a for√ßa da IA. De acordo com esta f√≥rmula, cerca de 0,4%, ou cerca de 1 de 253 jogos come√ßando com um campo vazio, termina com uma limpeza completa ap√≥s apenas 5 tetriminos. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em contraste com o que Faye sugeriu, as constantes nas aproxima√ß√µes linear e exponencial requerem um tamanho de amostra muito grande para que R </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">abordado 1, portanto esse m√©todo n√£o √© aplic√°vel ao PSO. </font><font style="vertical-align: inherit;">No entanto, as constantes obtidas com lotes longos podem ser usadas para otimizar a fun√ß√£o de aproxima√ß√£o que cria poss√≠veis valores constantes para lotes curtos. </font><font style="vertical-align: inherit;">Em um tipo de loop de feedback de desenvolvimento, a fun√ß√£o de aproxima√ß√£o otimizada pode ser usada no PSO, o que melhora a IA, que por sua vez pode ser usada para calcular novas constantes, servindo como crit√©rio de refer√™ncia para a fun√ß√£o de aproxima√ß√£o.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Vers√£o Java </font></font></h3><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Sobre o programa </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para desenvolvedores n√£o familiarizados com Lua, adicionei uma </font><font style="vertical-align: inherit;">porta Java AI </font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ao arquivo zip de origem</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Classes s√£o quase tradu√ß√£o linha por linha </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de objetos Lua com base em fechamentos</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Pacotes </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> O c√≥digo √© dividido em dois pacotes: </font></font><br><br><ul><li> <code>tetris.ai</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cont√©m classes e interfaces de IA. </font></font></li><li> <code>tetris.gui</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cria um modelo gr√°fico do campo de jogo. </font></font></li></ul><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Classes e interfaces de IA </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Uma classe com o nome apropriado </font></font><code>Tetriminos</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">descreve o tetrimino. </font><font style="vertical-align: inherit;">√â usado de forma semelhante </font></font><code>enum</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e cont√©m constantes para todos os tipos de tetrimino:</font></font><br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> NONE = -<span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> T = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> J = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Z = <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> O = <span class="hljs-number"><span class="hljs-number">3</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> S = <span class="hljs-number"><span class="hljs-number">4</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> L = <span class="hljs-number"><span class="hljs-number">5</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> I = <span class="hljs-number"><span class="hljs-number">6</span></span>;</code> </pre> <br> <code>NONE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">significa valor n√£o atribu√≠do. </font><font style="vertical-align: inherit;">√â usado para c√©lulas vazias do campo de jogo. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tamb√©m </font></font><code>Tetriminos</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cont√©m dois modelos da tabela de orienta√ß√£o. </font></font><code>PATTERNS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- esta √© uma matriz inteira quadridimensional (tipo √ó rota√ß√£o √ó quadrado √ó coordenadas) contendo as coordenadas relativas dos quadrados; </font><font style="vertical-align: inherit;">as linhas s√£o organizadas de modo que em cada tipo a orienta√ß√£o de cria√ß√£o da forma seja a primeira. </font></font><code>ORIENTATIONS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√â outro modelo, uma matriz bidimensional (tipo √ó rota√ß√£o) de objetos </font></font><code>Orientation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Cada um </font></font><code>Orientation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cont√©m as coordenadas do quadrado como uma matriz de objetos </font></font><code>Point</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Tamb√©m possui campos que descrevem o intervalo de posi√ß√µes permitidas para a orienta√ß√£o correspondente.</font></font><br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Orientation</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Point[] squares = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Point[<span class="hljs-number"><span class="hljs-number">4</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> minX; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> maxX; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> maxY; ... }</code> </pre> <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Point</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> y; ... }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A rota√ß√£o do Tetrimino (o segundo √≠ndice nas duas tabelas de orienta√ß√£o) √© usada em objetos </font></font><code>State</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que o BFS manipula.</font></font><br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">State</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> y; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> rotation; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> visited; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> State predecessor; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> State next; ... }</code> </pre> <br> <code>x</code><font style="vertical-align: inherit;"></font><code>y</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font><font style="vertical-align: inherit;">, </font></font><code>rotation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">juntos, descrevem a posi√ß√£o e a orienta√ß√£o da figura. Como o tipo Tetrimino permanece constante desde o momento da cria√ß√£o at√© o bloqueio, um campo para ele √© opcional. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A classe </font></font><code>Searcher</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que cont√©m o algoritmo BFS cria um conjunto completo de todos os objetos poss√≠veis </font></font><code>State</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">quando criados:</font></font><br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createStates</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ states = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> State[AI.PLAYFIELD_HEIGHT][AI.PLAYFIELD_WIDTH][<span class="hljs-number"><span class="hljs-number">4</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> y = <span class="hljs-number"><span class="hljs-number">0</span></span>; y &lt; AI.PLAYFIELD_HEIGHT; y++) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x = <span class="hljs-number"><span class="hljs-number">0</span></span>; x &lt; AI.PLAYFIELD_WIDTH; x++) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> rotation = <span class="hljs-number"><span class="hljs-number">0</span></span>; rotation &lt; <span class="hljs-number"><span class="hljs-number">4</span></span>; rotation++) { states[y][x][rotation] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> State(x, y, rotation); } } } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Embora o Java tenha uma API de cole√ß√µes rica, ele </font></font><code>Searcher</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cont√©m sua pr√≥pria implementa√ß√£o da fila. A classe </font></font><code>Queue</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">usa </font></font><code>State.next</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para associar objetos </font></font><code>State</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a uma lista vinculada. Como todos os objetos </font></font><code>State</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s√£o predefinidos e cada um </font></font><code>State</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pode ser adicionado √† fila mais de uma vez, a fila pode funcionar no local, o que elimina a necessidade de objetos de cont√™iner tempor√°rio desnecess√°rios usados ‚Äã‚Äãem implementa√ß√µes de fila comuns. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O "cora√ß√£o" do BFS √© o m√©todo mostrado abaixo </font></font><code>search</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">search</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">[][] playfield, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> tetriminoType, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> maxRotation = Tetriminos.ORIENTATIONS[tetriminoType].length - <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> mark = globalMark++; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!addChild(playfield, tetriminoType, mark, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(queue.isNotEmpty()) { State state = queue.dequeue(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (maxRotation != <span class="hljs-number"><span class="hljs-number">0</span></span>) { addChild(playfield, tetriminoType, mark, state, state.x, state.y, state.rotation == <span class="hljs-number"><span class="hljs-number">0</span></span> ? maxRotation : state.rotation - <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (maxRotation != <span class="hljs-number"><span class="hljs-number">1</span></span>) { addChild(playfield, tetriminoType, mark, state, state.x, state.y, state.rotation == maxRotation ? <span class="hljs-number"><span class="hljs-number">0</span></span> : state.rotation + <span class="hljs-number"><span class="hljs-number">1</span></span>); } } addChild(playfield, tetriminoType, mark, state, state.x - <span class="hljs-number"><span class="hljs-number">1</span></span>, state.y, state.rotation); addChild(playfield, tetriminoType, mark, state, state.x + <span class="hljs-number"><span class="hljs-number">1</span></span>, state.y, state.rotation); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!addChild(playfield, tetriminoType, mark, state, state.x, state.y + <span class="hljs-number"><span class="hljs-number">1</span></span>, state.rotation)) { lockTetrimino(playfield, tetriminoType, id, state); } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ele gera uma fila com o estado do tetrimino criado e, em seguida, recupera sequencialmente os elementos filhos dos estados removidos da fila, adicionando-os novamente √† fila quando aparecem no campo de jogo. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um </font></font><code>search</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">campo de jogo que cont√©m uma combina√ß√£o de c√©lulas ocupadas e vazias, o tipo de Tetrimino criado e um identificador arbitr√°rio √© passado para o </font><font style="vertical-align: inherit;">m√©todo </font><font style="vertical-align: inherit;">. Durante a execu√ß√£o do BFS, um ouvinte √© chamado sempre que uma posi√ß√£o de bloqueio √© detectada.</font></font><br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ISearchListener</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handleResult</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">[][] playfield, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> tetriminoType, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id, State state)</span></span></span></span>; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O ouvinte recebe um campo de jogo alterado contendo um tetrimino bloqueado no local. O tipo de Tetrimino criado e um identificador arbitr√°rio tamb√©m s√£o transmitidos. O √∫ltimo par√¢metro est√° </font></font><code>State</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no qual o tetrimino est√° bloqueado. Seguindo a cadeia de links </font></font><code>State.predecessor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, voc√™ pode restaurar todo o caminho de volta para </font></font><code>State</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">criar uma forma. </font></font><br><br> <code>State.visited</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">poderia ser implementado como </font></font><code>boolean</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; mas com todas as comodidades necess√°rias para resolver antes de pesquisar </font></font><code>State</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para al√≠vio </font></font><code>visited</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no </font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Em vez disso, criei um </font></font><code>visited</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">valor </font></font><code>int</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">comparado a um contador, incrementando a cada chamada. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M√©todo</font></font><code>addChild</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pr√©-enfileira estados subseq√ºentes. O estado subsequente deve estar dentro do campo e estar localizado em 4 c√©lulas vazias do campo de jogo. Al√©m disso, o estado subsequente deve ser n√£o visitado </font></font><code>State</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Se a posi√ß√£o for v√°lida, </font></font><code>addChild</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">retornar√° </font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mesmo se o estado subsequente n√£o puder ser colocado na fila porque j√° foi visitado. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O m√©todo </font></font><code>search</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">usa o </font></font><code>addChild</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">valor de </font><font style="vertical-align: inherit;">retorno </font><font style="vertical-align: inherit;">para determinar se uma forma pode ser criada. Se a figura n√£o puder ser criada, o heap alcan√ßou o topo e a pesquisa n√£o poder√° mais ser realizada; portanto, ele retorna </font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Retorn√°vel</font></font><code>addChild</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O significado tamb√©m est√° sendo estudado para a possibilidade de descer mais um passo. Se isso n√£o puder ser feito, o estado atual √© a posi√ß√£o de bloqueio e a chamada √© iniciada </font></font><code>lockTetrimino</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. O m√©todo </font></font><code>lockTetrimino</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">altera o campo de jogo, chama o ouvinte e depois restaura o campo de jogo. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cada linha da matriz </font></font><code>playfield</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cont√©m 1 elemento adicional, que armazena o n√∫mero de c√©lulas ocupadas na linha. Incrementar um elemento √© realizado pelo m√©todo </font></font><code>lockTetrimino</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">porque marca as c√©lulas como ocupadas. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quando o ouvinte recebe um campo de jogo modificado, ele chama</font></font><code>PlayfieldUtil.clearRows</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para excluir linhas preenchidas o m√©todo os reconhece verificando o valor no elemento adicional da matriz. Para remover uma string, o c√≥digo tira vantagem do fato de que em Java, matrizes bidimensionais s√£o essencialmente matrizes de matrizes; apenas pressiona os links para as strings. </font></font><code>PlayfieldUtil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cont√©m linhas livres; ele conclui o processo de limpeza inserindo um link em um deles. Antes de executar o turno, o √≠ndice da linha que est√° sendo limpa √© armazenado em um elemento de linha adicional. Em seguida, o link para a linha √© empurrado para a pilha. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ent√£o o ouvinte chama</font></font><code>PlayfieldUtil.restoreRows</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para descartar as altera√ß√µes feitas no campo de jogo. </font><font style="vertical-align: inherit;">As etapas s√£o canceladas na ordem inversa. </font><font style="vertical-align: inherit;">Primeiro, temos uma linha livre a partir do topo. </font><font style="vertical-align: inherit;">Em seguida, a linha preenchida √© recuperada da pilha e o √≠ndice do elemento adicional √© restaurado. </font><font style="vertical-align: inherit;">√â usado para mudar as refer√™ncias de linha e retornar ao local da linha exclu√≠da. </font><font style="vertical-align: inherit;">Finalmente, um elemento adicional √© restaurado, √© atribu√≠do o valor da largura do campo de jogo - o n√∫mero de c√©lulas ocupadas na linha preenchida. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tamb√©m existe </font></font><code>PlayfieldUtil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">um m√©todo </font></font><code>evaluatePlayfield</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que calcula e grava 4 par√¢metros de avalia√ß√£o na classe de cont√™iner mostrada abaixo.</font></font><br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PlayfieldEvaluation</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> holes; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> columnTransitions; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> rowTransitions; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> wells; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A classe gerencia tudo isso </font></font><code>AI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Ele cont√©m dois objetos </font></font><code>Searcher</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">conectados pelo ouvinte mostrado abaixo.</font></font><br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handleResult</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">[][] playfield, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> tetriminoType, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id, State state)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (id == <span class="hljs-number"><span class="hljs-number">0</span></span>) { result0 = state; } Orientation orientation = Tetriminos.ORIENTATIONS[tetriminoType][state.rotation]; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> rows = playfieldUtil.clearRows(playfield, state.y); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> originalTotalRows = totalRows; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> originalTotalDropHeight = totalDropHeight; totalRows += rows; totalDropHeight += orientation.maxY - state.y; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> nextID = id + <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (nextID == tetriminoIndices.length) { playfieldUtil.evaluatePlayfield(playfield, e); <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> fitness = computeFitness(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fitness &lt; bestFitness) { bestFitness = fitness; bestResult = result0; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { searchers[nextID].search(playfield, tetriminoIndices[nextID], nextID); } totalDropHeight = originalTotalDropHeight; totalRows = originalTotalRows; playfieldUtil.restoreRows(playfield, rows); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Uma classe </font></font><code>AI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pode lidar com qualquer n√∫mero de objetos </font></font><code>Searcher</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, mas o Nintendo Tetris mostra apenas uma forma com anteced√™ncia. Os objetos </font></font><code>Searcher</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s√£o armazenados em uma matriz e o c√≥digo mostrado acima serve como seu ouvinte comum. O identificador aleat√≥rio passado para o m√©todo </font></font><code>Searcher.search</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√© realmente o √≠ndice da matriz, que tamb√©m √© a profundidade da pesquisa. Quando o ouvinte √© chamado, o identificador direciona a chamada para o pr√≥ximo </font></font><code>Searcher</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">na cadeia. Se ele chegar ao final da matriz, avalia o campo de jogo. E quando ele encontra um campo de jogo com uma pontua√ß√£o mais alta de condicionamento f√≠sico, ele anota o bloqueado </font></font><code>State</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">do primeiro </font></font><code>Searcher</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">da cadeia. </font></font><br><br> <code>AI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cont√©m um m√©todo </font></font><code>search</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que recebe o campo de jogo e uma matriz que cont√©m os tipos do tetrimino criado e do pr√≥ximo. Ele volta</font></font><code>State</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">contendo a posi√ß√£o e rota√ß√£o em que o primeiro tetrimino deve ser bloqueado. </font><font style="vertical-align: inherit;">Ele n√£o se concentra no segundo tetrimino; </font><font style="vertical-align: inherit;">da pr√≥xima vez que for chamado, recalcula a pontua√ß√£o. </font><font style="vertical-align: inherit;">Se a pilha for muito alta e a cadeia </font></font><code>Searcher</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">falhar em colocar os dois tetriminos, ela </font></font><code>AI.search</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">retornar√° </font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> State </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">search</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">[][] playfield, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] tetriminoIndices)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.tetriminoIndices = tetriminoIndices; bestResult = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; bestFitness = Double.MAX_VALUE; searchers[<span class="hljs-number"><span class="hljs-number">0</span></span>].search(playfield, tetriminoIndices[<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> bestResult; }</code> </pre> <br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Desafio de IA </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como a vers√£o Java n√£o est√° vinculada ao FCEUX, ela pode potencialmente ser usada para outros projetos. Para aqueles que est√£o interessados ‚Äã‚Äãem integrar a IA em outro lugar, esta se√ß√£o descreve tudo o que voc√™ precisa. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Primeiro, crie uma inst√¢ncia </font></font><code>AI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, inst√¢ncia </font></font><code>PlayfieldUtil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e matriz para armazenar todos os tipos conhecidos de tetrimino. Al√©m disso, crie uma </font></font><code>PlayfieldUtil.createPlayfield</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">inst√¢ncia do campo de jogo </font><font style="vertical-align: inherit;">chamando </font><font style="vertical-align: inherit;">; ele retorna uma matriz bidimensional com uma coluna adicional, que examinamos acima. Voc√™ provavelmente tamb√©m precisar√° de um gerador de n√∫meros aleat√≥rios.</font></font><br><br><pre> <code class="java hljs">AI ai = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AI(); PlayfieldUtil playfieldUtil = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PlayfieldUtil(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[] tetriminos = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[AI.TETRIMINOS_SEARCHED]; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[][] playfield = playfieldUtil.createPlayfield(); Random random = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Random();</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inicialmente, o campo de jogo est√° vazio e todas as c√©lulas s√£o relevantes </font></font><code>Tetriminos.NONE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Se voc√™ preencher as c√©lulas programaticamente, n√£o esque√ßa de anotar o </font></font><code>playfield[rowIndex][AI.PLAYFIELD_WIDTH]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n√∫mero de c√©lulas ocupadas em cada linha. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Preencha a matriz de tipos de tetrimino com os tipos da forma criada inicialmente e a pr√≥xima forma, que geralmente s√£o selecionadas manualmente.</font></font><br><br><pre> <code class="java hljs">tetriminos[<span class="hljs-number"><span class="hljs-number">0</span></span>] = random.nextInt(<span class="hljs-number"><span class="hljs-number">7</span></span>); tetriminos[<span class="hljs-number"><span class="hljs-number">1</span></span>] = random.nextInt(<span class="hljs-number"><span class="hljs-number">7</span></span>);</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em seguida, dar o campo de jogo e tipos de matriz no m√©todo </font></font><code>AI.search</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Ele retornar√° </font></font><code>State</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no qual voc√™ precisar√° bloquear o primeiro tetrimino. </font><font style="vertical-align: inherit;">Se ele voltar </font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, o jogo acabar√° inevit√°vel.</font></font><br><br><pre> <code class="java hljs">State state = ai.search(playfield, tetriminos);</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se voc√™ precisar de uma maneira de criar pe√ßas para bloquear, passar </font></font><code>State</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m√©todo </font></font><code>AI.buildStateList</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><pre> <code class="java hljs">State[] states = ai.buildStatesList(state);</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para atualizar o campo de jogo, n√≥s o transmitiremos </font></font><code>PlayfieldUtil.lockTetrimino</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">junto com seu tipo e objeto </font></font><code>State</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Este m√©todo limpa automaticamente as linhas preenchidas.</font></font><br><br><pre> <code class="java hljs">playfieldUtil.lockTetrimino(playfield, tetriminos[<span class="hljs-number"><span class="hljs-number">0</span></span>], state);</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Antes de ligar novamente, </font></font><code>AI.search</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">voc√™ precisa selecionar aleatoriamente o pr√≥ximo tetrimino.</font></font><br><br><pre> <code class="java hljs">tetriminos[<span class="hljs-number"><span class="hljs-number">0</span></span>] = tetriminos[<span class="hljs-number"><span class="hljs-number">1</span></span>]; tetriminos[<span class="hljs-number"><span class="hljs-number">1</span></span>] = random.nextInt(<span class="hljs-number"><span class="hljs-number">7</span></span>);</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Juntos, fica assim: </font></font><br><br><pre> <code class="java hljs">AI ai = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AI(); PlayfieldUtil playfieldUtil = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PlayfieldUtil(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[] tetriminos = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[AI.TETRIMINOS_SEARCHED]; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[][] playfield = playfieldUtil.createPlayfield(); Random random = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Random(); tetriminos[<span class="hljs-number"><span class="hljs-number">0</span></span>] = random.nextInt(<span class="hljs-number"><span class="hljs-number">7</span></span>); tetriminos[<span class="hljs-number"><span class="hljs-number">1</span></span>] = random.nextInt(<span class="hljs-number"><span class="hljs-number">7</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) { <span class="hljs-comment"><span class="hljs-comment">// ... print playfield ... State state = ai.search(playfield, tetriminos); if (state == null) { break; // game over } playfieldUtil.lockTetrimino(playfield, tetriminos[0], state); tetriminos[0] = tetriminos[1]; tetriminos[1] = random.nextInt(7); }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Em vez de exibir o campo de jogo em forma de texto, voc√™ pode usar uma maneira mais interessante de exibir o que est√° acontecendo ... </font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Exibi√ß√£o do campo de jogo </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A classe </font></font><code>TetrisFrame</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imita os gr√°ficos do Nintendo Tetris, incluindo recursos comportamentais descritos na parte anterior do artigo.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d58/dac/a4c/d58daca4c668408a42efa51ad7508d75.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para v√™-lo em a√ß√£o, execute-o </font></font><code>tetris.gui.Main</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Assim como na vers√£o Lua, podemos ajustar a velocidade do jogo alterando o valor constante no in√≠cio do arquivo.</font></font><br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> PLAY_FAST = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>;</code> </pre> <br> <code>TetrisFrame</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">possui 4 m√©todos para manipular a tela. </font><font style="vertical-align: inherit;">O m√©todo </font></font><code>displayTetrimino</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">processa o tetrimino ativo nas coordenadas especificadas. </font><font style="vertical-align: inherit;">Ele recebe um par√¢metro de atraso, que faz com que o m√©todo aguarde antes de retornar o n√∫mero especificado de quadros de anima√ß√£o.</font></font><br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">displayTetrimino</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> type, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> rotation, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> delay)</span></span></span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O m√©todo </font></font><code>lockTetrimino</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bloqueia a figura no lugar. </font><font style="vertical-align: inherit;">As cores do contador de linhas, pontos, n√≠vel e tetrimino s√£o atualizadas de acordo, demonstrando o comportamento curioso esperado quando os valores excedem os valores permitidos. </font><font style="vertical-align: inherit;">A atribui√ß√£o de um </font></font><code>animate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">valor </font><font style="vertical-align: inherit;">a um par√¢metro </font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">inclui anima√ß√µes de limpeza de linha e tremula√ß√£o da tela ao receber o Tetris. </font><font style="vertical-align: inherit;">O m√©todo √© bloqueado at√© a anima√ß√£o terminar.</font></font><br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">lockTetrimino</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> type, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> rotation, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> animate)</span></span></span></span></code> </pre> <br> <code>updateStatisticsAndNext</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> executa um incremento do contador de estat√≠sticas para o tetrimino rec√©m-criado e atualiza a exibi√ß√£o da pr√≥xima figura. </font></font><br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">updateStatisticsAndNext</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> activeTetrimino, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> nextTetrimino)</span></span></span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O m√©todo </font></font><code>dropTetrimino</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cria uma forma e permite que ela des√ßa sob a influ√™ncia da "gravidade", sem fazer nenhuma tentativa de gir√°-la ou mov√™-la. </font></font><code>Main</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">usa-o para as duas √∫ltimas figuras quando </font></font><code>AI.search</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">retorna </font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Se o par√¢metro for </font></font><code>animate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">importante </font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, se for imposs√≠vel criar uma figura, a cortina do final do jogo cair√°. Como em todos os outros m√©todos, esse m√©todo √© bloqueado at√© a anima√ß√£o terminar. Ele retorna </font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apenas quando pode criar uma figura em um campo de jogo ocupado.</font></font><br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dropTetrimino</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> type, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> animate)</span></span></span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Esses 4 m√©todos devem ser chamados pelo fluxo de trabalho, mas </font></font><code>TetrisFrame</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">devem ser criados no pr√≥prio thread de distribui√ß√£o de eventos. Para ver como isso √© feito, veja a turma </font></font><code>Main</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por uma quest√£o de interesse, ele </font></font><code>Main</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">usa uma classe </font></font><code>Randomizer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que simula um gerador de n√∫meros pseudo-aleat√≥rios da Nintendo Tetris. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O pacote </font></font><code>tetris.gui.images</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cont√©m arquivos relacionados √† exibi√ß√£o. </font></font><code>tiles.png</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Esta √© uma tabela de padr√µes que cont√©m todos os gr√°ficos de blocos. </font></font><code>background.dat</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">armazena os identificadores dos blocos que comp√µem o plano de fundo; dados extra√≠dos de </font></font><code>$BF3F</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. E </font></font><code>colors.dat</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cont√©m bytes que geram cores quadradas incomuns que aparecem no n√≠vel 138. </font></font><br><br> <code>ImageLoader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cont√©m uma tabela de paletas do NES e o </font></font><code>ImagePane</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">conjunto completo de valores de n√≠vel exibidos √© armazenado.</font></font><br><br><h4>  Outros projetos </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Potencialmente, o c√≥digo pode ser usado em vez de gravar no modo de demonstra√ß√£o. De fato, essa demonstra√ß√£o pode ser renderizada para sempre, aproveitando a rapidez com que a IA √© capaz de limpar todo o campo. Para conseguir isso, no gerador de n√∫meros pseudo-aleat√≥rios, voc√™ precisa usar alguma constante arbitr√°ria como semente, o que nos dar√° uma sequ√™ncia tetrimino determin√≠stica. As duas primeiras seq√º√™ncias de tetrimino ser√£o gravadas. Quando a IA atingir a limpeza de campo total, os pr√≥ximos dois tetriminos ser√£o comparados com os dois primeiros da sequ√™ncia. Se eles corresponderem (esse evento √© esperado a cada 49 limpezas de campo completo), o gerador de n√∫meros pseudo-aleat√≥rios pode passar a mesma constante que a semente, o que criar√° um loop de demonstra√ß√£o infinito. A dura√ß√£o do ciclo pode ser muito longa para ocultar o fato de que √© um ciclo. Tamb√©ma demonstra√ß√£o pode come√ßar em um ponto aleat√≥rio no loop, criando uma nova demonstra√ß√£o a cada vez.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Outra possibilidade de usar a IA √© criar um modo "player versus computer". No Tetris para v√°rios jogadores, enquanto limpa v√°rias linhas ao mesmo tempo, linhas de lixo aparecem na parte inferior do campo do oponente, aumentando o campo de jogo. A IA deve poder se proteger de detritos pelo mesmo motivo que pode jogar jogos do tipo B. No entanto, como afirmado anteriormente, a IA √© executada de maneira conservadora, geralmente tentando limpar uma linha de cada vez. Ou seja, ele ser√° capaz de se defender de ataques, mas ele n√£o √© capaz de atacar. Para poder mudar seu comportamento, criei uma interface chamada </font></font><code>IChildFilter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IChildFilter</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">validate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">[][] playfield, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> tetriminoType, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> rotation)</span></span></span></span>; }</code> </pre> <br> <code>AI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">possui um construtor alternativo que obt√©m uma implementa√ß√£o </font></font><code>IChildFilter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Se dispon√≠vel, </font></font><code>IChildFilter.validate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">serve como uma verifica√ß√£o adicional para a permiss√£o do estado filho; se retornar </font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, o estado filho n√£o est√° na fila. </font></font><br><br> <code>WellFilter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√â uma implementa√ß√£o</font></font><code>IChildFilter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">destinado a pegar quatro linhas (Tetris). </font><font style="vertical-align: inherit;">Como jogadores vivos, ela gradualmente constr√≥i um po√ßo na coluna mais √† direita do campo de jogo, subindo linha por linha de baixo para cima. </font><font style="vertical-align: inherit;">Como funciona linha por linha, rejeita os estados filhos que adicionam um quadrado √† coluna mais √† direita. </font><font style="vertical-align: inherit;">Quando a linha inteira, com exce√ß√£o da coluna do po√ßo, est√° completamente cheia, o AI prossegue para a pr√≥xima linha. </font><font style="vertical-align: inherit;">Quando 4 ou mais dessas linhas est√£o prontas, permite que o "bast√£o" caia no po√ßo e obtenha Tetris. </font><font style="vertical-align: inherit;">Al√©m disso, a altura da pilha √© rastreada; </font><font style="vertical-align: inherit;">se ficar muito grande, </font></font><code>WellFilter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">deixa de afetar a IA.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/82b/c27/710/82bc27710c0e5200d599be07bf549206.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para test√°-lo em opera√ß√£o, fa√ßa as </font></font><code>Main</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">seguintes altera√ß√µes:</font></font><br><br><pre> <code class="java hljs">AI ai = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AI(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WellFilter());</code> </pre> <br> <code>WellFilter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">funciona, mas n√£o √© particularmente eficaz. Ele cont√©m uma heur√≠stica simples projetada para demonstrar o conceito. Para obter o Tetris com mais frequ√™ncia, voc√™ precisa usar uma estrat√©gia mais sofisticada, talvez uma que possa ser otimizada usando o PSO. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Al√©m disso, voc√™ pode usar a filtragem de estado filho para gerar padr√µes. Abaixo est√° um exemplo do que ele √© capaz </font></font><code>PatternFilter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/569/e21/15f/569e2115f8936fc3391d1bb330017d8a.png"></div><br> <code>PatternFilter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cria imagens linha por linha de baixo para cima, semelhante √† forma como funciona </font></font><code>WellFilter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">no entanto, em vez de preservar a coluna mais √† direita, ele </font></font><code>PatternFilter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aprova apenas os estados filhos que correspondem a um padr√£o espec√≠fico. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O construtor </font></font><code>PatternFilter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">obt√©m o nome de uma das imagens no pacote </font></font><code>tetris.gui.patterns</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, que ele usa como modelo. </font><font style="vertical-align: inherit;">Cada imagem 20 √ó 10 cont√©m pixels em preto e branco correspondentes √†s c√©lulas no campo de jogo.</font></font><br><br><pre> <code class="java hljs">AI ai = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AI(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PatternFilter(<span class="hljs-string"><span class="hljs-string">"tetriminos"</span></span>));</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> A linha de c√≥digo mostrada acima cria as silhuetas de sete tipos de tetrimino. </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cb3/0c8/d79/cb30c8d795e12e41d3831a0735637a55.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Outro exemplo com um grande tetrimino T girado em √¢ngulo. </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cf0/f95/14c/cf0f9514c3a08b88c4f67117614ade91.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Outro exemplo </font><font style="vertical-align: inherit;">Se voc√™ olhar de perto, ver√° o nome do jogo.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a26/712/284/a267122840a2373e7bb5fb6fa6282018.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como </font></font><code>WellFilter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>PatternFilter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nada mais √© do que uma prova de conceito. </font><font style="vertical-align: inherit;">Os padr√µes que ele processa s√£o limitados ao fundo do campo devido ao fato de que as tentativas de obt√™-los geralmente terminam com o fim do jogo. </font><font style="vertical-align: inherit;">No entanto, essa √© uma ideia interessante que vale a pena estudar mais.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Vers√£o do Gamepad </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O script Lua e o programa Java ignoram a gravidade; para eles, a velocidade de descida n√£o √© importante, pois, dependendo da configura√ß√£o, eles teleportam as figuras imediatamente para o local desejado ou arrastam ao longo de qualquer caminho escolhido. De certa forma, eles apenas imitam Tetris, n√£o o reproduzem. No entanto, no </font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">arquivo zip com as fontes,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> h√° outro script Lua que √© gerado ao gerar os sinais dos bot√µes do gamepad, o que permite ao jogo controlar o movimento de figuras, gravidade e tudo mais. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A adi√ß√£o de gravidade expande bastante o espa√ßo de pesquisa, for√ßando a IA a levar em conta as regras astutas de manipula√ß√£o de formas. Os detalhes dessas regras s√£o descritos na primeira parte do artigo e podem ser totalmente apreciados por um estudo direto do c√≥digo.</font></font> Aqui est√£o os mais importantes: <br><br><ul><li>       : ,   . </li><li>   ¬´¬ª   . </li><li>   ¬´¬ª  ¬´¬ª    . </li><li>         . </li><li>          . </li><li>          . </li><li>          . </li><li>   ,        . </li><li>   A  B           . </li><li>  ¬´¬ª  ¬´¬ª       6      16 .     ¬´¬ª  ¬´¬ª   ,     . </li><li>  ¬´¬ª            3 . </li><li>       96 .    ,    ‚Äî . </li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para acomodar todas essas regras, as informa√ß√µes hist√≥ricas devem ser incorporadas nos estados de pesquisa. Eles precisam de campos nos quais o n√∫mero de quadros de espera para cada bot√£o e o n√∫mero de quadros ap√≥s a √∫ltima libera√ß√£o autom√°tica ser√£o armazenados. Cada conjunto exclusivo de valores, incluindo coordenadas </font></font><code>x</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>y</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e a rota√ß√£o do tetrimino caracterizam um estado separado e √∫nico. Infelizmente, o n√∫mero de possibilidades √© t√£o vasto que uma pesquisa completa desse espa√ßo √© impratic√°vel. A vers√£o AI do gamepad explora apenas um subconjunto dele. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O AI usa um objeto </font></font><code>State</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">com os seguintes campos:</font></font><br><br><pre> <code class="java hljs">{ x, y, rotation, Left, Right, Down, A, B, fallTimer, visited, predecessor }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em vez de usar o deslocamento autom√°tico da IA ‚Äã‚Äãem quadros alternativos, pressione e solte o bot√£o shift. </font><font style="vertical-align: inherit;">Portanto, ele precisa monitorar apenas se o bot√£o est√° pressionado e n√£o por quanto tempo ele √© pressionado. </font><font style="vertical-align: inherit;">Uma vez que nenhuma rota√ß√£o autom√°tica, a mesma ideia se aplica aos bot√µes A e B. Portanto, o campo </font></font><code>Left</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>Right</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>A</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>B</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pode ser interpretado como a listagem contendo um dos seguintes valores:</font></font><br><br><pre> <code class="java hljs">{ RELEASED, PRESSED }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Por outro lado, para descida suave, voc√™ deve inicialmente manter pressionado o bot√£o "Para baixo" por tr√™s quadros, o que requer a exist√™ncia de 4 estados: </font></font><br><br><pre> <code class="java hljs">{ RELEASED, PRESSED_FOR_1_FRAME, PRESSED_FOR_2_FRAMES, PRESSED_FOR_3_FRAMES }</code> </pre> <br> <code>Down</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aumenta incrementalmente do valor </font></font><code>RELEASED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para o </font></font><code>PRESSED_FOR_3_FRAMES</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qual ocorre uma descida suave. Depois disso, ele pode receber um valor </font></font><code>RELEASED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou retornar a </font></font><code>PRESSED_FOR_2_FRAMES</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, causando uma descida suave a cada segundo quadro ap√≥s o atraso inicial. N√£o pode ser </font></font><code>RELEASED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de </font></font><code>PRESSED_FOR_1_FRAME</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou de </font></font><code>PRESSED_FOR_2_FRAMES</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Na verdade, o c√≥digo Lua usa uma constante inteira, mas o princ√≠pio √© o mesmo. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Da mesma forma, </font></font><code>visited</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>predecessor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>fallTimer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ele √© atribu√≠do o valor obtido quando se escreve no estado fila subsidi√°ria; ele </font></font><code>fallTimer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ser√° um a mais que o valor do estado pai. Condi√ß√£o que cont√©m</font></font><code>fallTimer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, igual √† velocidade de descida, implica que a descida autom√°tica ocorra nesse quadro e, para estados subsequentes desse estado, o valor </font></font><code>fallTimer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ser√° 0. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cada </font></font><code>Searcher</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pr√©-define uma </font></font><code>8-</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">matriz que cont√©m todos os estados poss√≠veis ( </font></font><code>20  √ó 10  √ó 4  √ó 2  √ó 2  √ó 4  √ó 2 A √ó 2 B</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) e o BFS √© executado de maneira semelhante ao m√©todo mostrado para a </font></font><code></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">matriz. </font><font style="vertical-align: inherit;">O pseudo-c√≥digo mostrado abaixo descreve como os estados subsequentes s√£o obtidos a partir dos estados inativos.</font></font><br><br><pre> <code class="cpp hljs">Slide = (Left == PRESSED) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> (Right == PRESSED) Rotate = (A == PRESSED) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> (B == PRESSED) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Down == RELEASED <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> Down == PRESSED_FOR_3_FRAMES then <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Down == RELEASED then nextDown = PRESSED_FOR_1_FRAME <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> nextDown = PRESSED_FOR_2_FRAMES end addChild(Down = nextDown) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> Rotate then addChild(A = PRESSED, Down = nextDown) addChild(B = PRESSED, Down = nextDown) end <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Slide then addChild() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> Rotate then addChild(A = PRESSED) addChild(B = PRESSED) end <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> addChild(Left = PRESSED) addChild(Right = PRESSED) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> Rotate then addChild(Left = PRESSED, A = PRESSED) addChild(Left = PRESSED, B = PRESSED) addChild(Right = PRESSED, A = PRESSED) addChild(Right = PRESSED, B = PRESSED) end end <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Down == PRESSED_FOR_1_FRAME then nextDown = PRESSED_FOR_2_FRAMES <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> nextDown = PRESSED_FOR_3_FRAMES end addChild(Down = nextDown) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> Rotate then addChild(A = PRESSED, Down = nextDown) addChild(B = PRESSED, Down = nextDown) end end</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conforme mostrado no pseudo-c√≥digo abaixo, a fun√ß√£o </font></font><code>addChild</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">leva em considera√ß√£o a ordem dos eventos que ocorrem em cada quadro (por exemplo, deslocamento, rota√ß√£o e descida).</font></font><br><br><pre> <code class="cpp hljs">nextFallTimer = fallTimer + <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Left == PRESSED <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> testPosition(x - <span class="hljs-number"><span class="hljs-number">1</span></span>, y, rotation) then x = x - <span class="hljs-number"><span class="hljs-number">1</span></span> elseif Right == PRESSED <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> testPosition(x + <span class="hljs-number"><span class="hljs-number">1</span></span>, y, rotation) then x = x + <span class="hljs-number"><span class="hljs-number">1</span></span> end <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> A == PRESSED <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> testPosition(x, y, nextClockwiseRotation) then rotation = nextClockwiseRotation elseif B == PRESSED <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> testPosition(x, y, nextCounterclockwiseRotation) then rotation = nextCounterclockwiseRotation end <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Down == PRESSED_FOR_3_FRAMES <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> nextFallTimer &gt;= dropSpeed then <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> testPosition(x, y + <span class="hljs-number"><span class="hljs-number">1</span></span>, rotation) then y = y + <span class="hljs-number"><span class="hljs-number">1</span></span> nextFallTimer = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> lockTetrimino() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> end end childState = states[y][x][rotation][Left][Right][Down][A][B] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> childState.visited then childState.visited = mark childState.predecessor = state childState.fallTimer = nextFallTimer <span class="hljs-built_in"><span class="hljs-built_in">queue</span></span>.enqueue(childState) end</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como na vers√£o anterior, ele </font></font><code>AI.search</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">retorna uma cadeia de objetos </font></font><code>State</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Mas, neste caso, cada um </font></font><code>State</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cont√©m muitos bot√µes que precisam ser pressionados em cada quadro. Campo </font></font><code>x</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>y</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>rotation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n√£o s√£o usados para manipular os n√∫meros, mas pode ser usado para verificar a regularidade do movimento figuras. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Embora o espa√ßo de pesquisa tenha sido significativamente reduzido devido √†s limita√ß√µes descritas acima, leva 1-3 segundos para concluir a pesquisa. Se voc√™ execut√°-lo, notar√° uma pausa ap√≥s criar cada tetrimino. Al√©m disso, os movimentos parecem muito antinaturais; geralmente √© feita uma curva um instante antes de travar. No entanto, essa IA funciona quase da mesma maneira que a vers√£o que ignorou a gravidade, mesmo na velocidade m√°xima.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para verificar, execute-o </font></font><code>lua/NintendoTetrisAIGamepadVersion.lua</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, localizado no </font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">arquivo zip com as fontes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Uma maneira mais simples de explicar a gravidade √© limitar o movimento das figuras apenas girando, seguido de uma mudan√ßa e depois descendo para o fundo. </font><font style="vertical-align: inherit;">A id√©ia √© que, se voc√™ se livrar do deslizamento e da rolagem, a velocidade vertical das figuras ter√° pouco efeito na IA; </font><font style="vertical-align: inherit;">tudo o que ele precisa fazer √© entregar a figura na coluna desejada, e a gravidade far√° o resto. </font><font style="vertical-align: inherit;">Outra vantagem dessa t√©cnica √© que o espa√ßo de pesquisa √© muito pequeno, o que permite que voc√™ jogue em tempo real, sem demora para c√°lculos. </font><font style="vertical-align: inherit;">No entanto, a desvantagem dessa abordagem √© que, sem deslizar e rolar, a IA √© muito pior. </font><font style="vertical-align: inherit;">No entanto, o Tetris AI, incapaz de jogar em tempo real, √© praticamente in√∫til.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Adi√ß√£o </font></font></h2><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cfd/2c5/a7e/cfd2c5a7e44131bfc188c3eea6ad5139.png" alt="Tetris"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anteriormente, escrevi um plug-in que simulava processualmente um jogador no Tetris. </font><font style="vertical-align: inherit;">No entanto, meu projeto teve algumas desvantagens:</font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O bot desligou a gravidade, permitindo executar deslizamentos e rolagem, excedendo as capacidades do jogador no n√≠vel m√≠nimo do Nintendo Tetris. </font><font style="vertical-align: inherit;">Ele nunca eleva os n√∫meros, mas a √∫nica maneira de reduzi-los √© uma descida suave controlada. </font><font style="vertical-align: inherit;">Ou seja, ele joga em um mundo idealizado e te√≥rico. </font><font style="vertical-align: inherit;">Para ser franco, ele trapaceia.</font></font></li><li>   .    ‚Äî  ,      .     Double, Triple  Tetris,         ‚Äî  ,    .         90.    ,   ,       29   -     . </li><li>          .      .       .     ,  Tetris      . </li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nesta se√ß√£o, falarei sobre um bot avan√ßado que joga o Nintendo Tetris sem desativar a gravidade. </font><font style="vertical-align: inherit;">Ele avalia o risco e o gerencia, esfor√ßando-se agressivamente para obter o n√∫mero m√°ximo de pontos antes de atingir uma alta velocidade de descida.</font></font><br><br><hr><br><h1>  V√≠deo </h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Veja o bot ganhar o n√∫mero m√°ximo de pontos do Nintendo Tetris a partir do n√≠vel 19 em todos os v√≠deos mostrados abaixo. </font></font><br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/l2YOt_GdfA0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><iframe width="560" height="315" src="https://www.youtube.com/embed/zsd3eAYMlN0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><iframe width="560" height="315" src="https://www.youtube.com/embed/efh-_zeQH4Y" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><hr><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Baixar </font></font></h1><br> <a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TetrisAI_2018-01-28.zip</font></font></a> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> O arquivo </font></font><code>.zip</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cont√©m:</font></font><br><br><ul><li> <code>src</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - √°rvore de c√≥digo fonte. </font></font></li><li> <code>TetrisAI.jar</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - arquivo bin√°rio compilado. </font></font></li><li> <code>lgpl-2.1.txt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - licen√ßa de software livre. </font></font></li></ul><br><hr><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Lan√ßamento </font></font></h1><br><h2>  Pr√©-requisitos </h2><br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nintaco</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √© um emulador de NES / Famicom.</font></font></li><li> <code>Tetris (U) [!].nes</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - arquivo ROM Nintendo Tetris. </font></font></li></ul><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Lan√ßamento do plug-in </font></font></h2><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inicie o Nintaco e abra </font></font><code>Tetris (U) [!].nes</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Extrair </font></font><code>TetrisAI.jar</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">do baixado </font></font><code>.zip</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abra a janela Executar Programa, escolhendo Ferramentas | </font><font style="vertical-align: inherit;">Executar programa ...</font></font></li><li>        JAR        Find JAR‚Ä¶ . </li><li>  Load JAR,   . </li><li>  Run. </li><li>        ,       <code>GAME TYPE</code>  <code>MUSIC TYPE</code> .   <code>D-pad</code> (     )  <code>A-TYPE</code>   .   Start (Enter),      . </li><li>    <code>A-TYPE</code>  <code>D-pad</code> (  )   <code>LEVEL 9</code> . ,    <code>A</code>    Start (   <code>X</code>   Enter),     19,    . </li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vale a pena considerar que o bot foi projetado apenas para o n√≠vel 19 e acima. </font><font style="vertical-align: inherit;">Em n√≠veis mais baixos, ele n√£o ser√° capaz de controlar as pe√ßas.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Refer√™ncia de velocidade </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para que o jogo acelere, selecione M√°quina | </font><font style="vertical-align: inherit;">Velocidade </font><font style="vertical-align: inherit;">M√°x.</font></font><br><br><hr><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Detalhes </font></font></h1><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Plat√¥ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abaixo do n√≠vel 10, a velocidade de descida em cada n√≠vel √© um pouco mais alta que na anterior. </font><font style="vertical-align: inherit;">Mas no n√≠vel 10 e acima, existem v√°rios planaltos nos quais a velocidade permanece constante por v√°rios n√≠veis. </font><font style="vertical-align: inherit;">Isso √© uma consequ√™ncia da maneira como o mecanismo de gatilho funciona. </font><font style="vertical-align: inherit;">A velocidade √© apresentada como o n√∫mero de quadros por descida, que √© um valor inteiro. </font><font style="vertical-align: inherit;">Ou seja, para n√≠veis mais altos n√£o existem muitas op√ß√µes: 10‚Äì12, 13‚Äì15, 16‚Äì18, 19‚Äì28 e 29+ s√£o 5, 4, 3, 2 e 1 quadro para descida.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O bot foi desenvolvido levando em considera√ß√£o apenas o plat√¥ 19‚Äì28. Nos quadros pares, ele clica no gamepad "Esquerda", "Direita", A, B ou nada. E em quadros √≠mpares, permite a descida autom√°tica sem pressionar nenhum bot√£o. Parece que o jogo n√£o percebe o movimento horizontal coincidindo com a rota√ß√£o; portanto, cada bot√£o √© pressionado independentemente em quadros pares. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Diferentemente dos mestres que tocam em n√≠veis altos, o bot n√£o tira proveito do DAS (Delayed Auto Shift), tamb√©m conhecido como repeti√ß√£o autom√°tica, e t√©cnicas relacionadas. Seu trabalho lembra mais </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a t√©cnica do polegar vibrat√≥rio de Thor Akerlund</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . No entanto, aumenta a frequ√™ncia da vibra√ß√£o para o m√°ximo te√≥rico permitido pelo jogo.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Os jogadores s√£o recompensados ‚Äã‚Äãcom 40, 100, 300 e 1200 pontos por Single, Double, Triple e Tetris. </font><font style="vertical-align: inherit;">E os pontos s√£o multiplicados pelo n√∫mero do n√≠vel mais 1. Em outras palavras, para obter a pontua√ß√£o m√°xima, o jogador deve se esfor√ßar para obter o n√∫mero m√°ximo de Tetris, jogando o maior tempo poss√≠vel em n√≠veis altos. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O n√≠vel 19 √© o mais alto que pode ser selecionado como o inicial, o que permite que o bot salte diretamente para o plat√¥ 19‚Äì28. </font><font style="vertical-align: inherit;">No entanto, devido a um erro no mecanismo de c√°lculo de n√≠vel que mencionei na parte anterior, o jogo passar√° para o n√≠vel 20 ap√≥s limpar 140 linhas, em vez dos 200 esperados. Depois disso, o jogo mudar√° de n√≠vel a cada 10 linhas. </font><font style="vertical-align: inherit;">No entanto, depois de atingir 230 linhas, o bot subir√° do plat√¥ e desistir√° rapidamente. </font><font style="vertical-align: inherit;">Ou seja, ele precisa discar o m√°ximo de Tetris poss√≠vel antes de limpar 230 linhas.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Descida suave </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A descida suave tamb√©m pode aumentar o n√∫mero de pontos. </font><font style="vertical-align: inherit;">Para ganhar pontos, a figura deve ser suavemente abaixada para travar no campo de jogo. </font><font style="vertical-align: inherit;">Qualquer descida suave de curto prazo que ocorra ao longo do caminho ao posicionar uma figura n√£o afetar√° a pontua√ß√£o. </font><font style="vertical-align: inherit;">Se a descida for bem sucedida, o jogador receber√° um ponto para cada linha cruzada durante a descida suave. </font><font style="vertical-align: inherit;">E o valor resultante n√£o √© multiplicado pelo n√∫mero do n√≠vel, mesmo que uma descida suave leve √† limpeza das linhas. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A descida suave tem pouco efeito na pontua√ß√£o geral. </font><font style="vertical-align: inherit;">No entanto, se poss√≠vel, o bot conclui o posicionamento da figura clicando em "Para baixo" para obter esses pontos. </font><font style="vertical-align: inherit;">Em casos raros, pode calcular a diferen√ßa entre uma pontua√ß√£o muito alta e exceder a pontua√ß√£o m√°xima.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Algoritmo AI </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ao criar uma forma, o bot explora todos os posicionamentos poss√≠veis das formas atuais e seguintes. Posicionamento permitido √© a posi√ß√£o em que a figura repousa nas c√©lulas ocupadas ou no ch√£o do campo de jogo. A partir do local de cria√ß√£o da figura, essa posi√ß√£o pode ser alcan√ßada atrav√©s de uma sequ√™ncia de movimentos horizontais, curvas e descidas. Locais v√°lidos e seq√º√™ncias de caminhos s√£o encontrados usando o BSF. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A coloca√ß√£o de uma pe√ßa no campo de jogo tem consequ√™ncias: 4 c√©lulas vazias ficam ocupadas e todas as linhas preenchidas s√£o limpas, deixando as linhas descerem. Para cada posicionamento permitido da figura atual e as consequ√™ncias associadas a ela, o bot verifica cada posicionamento v√°lido da figura seguinte, avaliando a combina√ß√£o de consequ√™ncias. Essa cadeia de pesquisa √© apresentada </font></font><code>SearchChain</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cada uma das consequ√™ncias combinadas √© transferida para uma fun√ß√£o de avalia√ß√£o que calcula o conte√∫do do campo de jogo. </font><font style="vertical-align: inherit;">A combina√ß√£o com a menor pontua√ß√£o vence e a pe√ßa atual √© colocada de acordo. </font><font style="vertical-align: inherit;">Os resultados da cadeia de pesquisa afetam apenas a forma atual. </font><font style="vertical-align: inherit;">Ao criar a pr√≥xima figura, ela √© avaliada em combina√ß√£o com a figura a seguir e assim por diante.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Fun√ß√£o de avalia√ß√£o </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> A fun√ß√£o de avalia√ß√£o √© uma soma ponderada dos seguintes par√¢metros: </font></font><br><br><ul><li> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O n√∫mero total de linhas limpas</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √© o n√∫mero de linhas limpas pela adi√ß√£o de ambos os tetriminos.</font></font></li><li> <strong>  </strong> ‚Äì      ,   .     ‚Äî   ,        ,       . </li><li> <strong>  -</strong> ‚Äì    . </li><li> <strong>   </strong> ‚Äì  ,     -. </li><li> <strong>    </strong> ‚Äì   ,      .         .     . </li><li> <strong>     </strong> ‚Äì      .       ,   1.   ,         ,           . </li><li> <strong>     </strong> ‚Äì         ,    .  ‚Äî        ,    ‚Äî          . </li><li> <strong>    </strong> ‚Äì     .   ,         (20). </li><li> <strong>    </strong> ‚Äì     .   ,      0. </li><li> <strong>    </strong> ‚Äì   ,     ( )    . </li><li> <strong>    </strong> :    ‚Äî   ,     ( )    .         .        .          . </li><li> <strong>   </strong> ‚Äì           . ,   1  ,   1,     ‚Äî  0. </li><li> <strong> </strong> ‚Äì   . </li><li> <strong>  </strong> ‚Äì         . </li><li> <strong>   </strong> ‚Äì      . </li><li> <strong>    </strong> ‚Äì     .     . </li><li> <strong>  </strong> ‚Äì        . </li></ul><br><h2>  Aprendizado de m√°quina </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para encontrar os pesos da fun√ß√£o de avalia√ß√£o, usamos uma variante do m√©todo Particle Swarm Optimization (PSO) descrito na nota de rodap√© [1]. Para obter um bom comportamento convergente, s√£o aplicados os coeficientes de in√©rcia e acelera√ß√£o propostos. E os tamanhos m√°ximos dos passos das part√≠culas s√£o determinados pela limita√ß√£o de seus valores de velocidade. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Durante cada itera√ß√£o, as part√≠culas foram avaliadas em paralelo para fazer pleno uso dos recursos de computa√ß√£o dispon√≠veis. Al√©m disso, depois que a converg√™ncia foi detectada (nenhuma melhoria ap√≥s um certo n√∫mero de itera√ß√µes), o PSO foi configurado para reiniciar automaticamente com pesos selecionados aleatoriamente, o que nos permitiu explorar ainda mais o espa√ßo de pesquisa.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cada vetor de posi√ß√£o das part√≠culas foi avaliado simulando a conclus√£o de 100 lotes em um plat√¥ de n√≠veis 19 a 28. Um lote completo envolve a limpeza de 230 linhas, mas muitos terminaram com um estouro de campo. As pontua√ß√µes dos lotes foram classificadas e as pontua√ß√µes das part√≠culas foram determinadas como a m√©dia de 33 dos 100 lotes. A ideia era escolher com base na agressividade. As part√≠culas no ter√ßo superior se acostumam apenas √†s seq√º√™ncias desejadas de figuras, o que limita a necessidade de um jogo conservador. Como resultado, eles tendem a empurrar o jogo usual para o limiar, esperando o pr√≥ximo "stick".</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sequ√™ncias de padr√µes para 100 lotes foram geradas antes do PSO, e as mesmas sequ√™ncias foram usadas repetidamente. Isso foi necess√°rio para corrigir o espa√ßo de pesquisa, para que as op√ß√µes de solu√ß√£o pudessem ser comparadas. As seq√º√™ncias foram criadas usando a l√≥gica de um verdadeiro PRNG Nintendo Tetris, que √© projetado para reduzir as chances de duplicatas se sucederem. Mas o PRNG tamb√©m tem pontos fracos (consulte a se√ß√£o ‚ÄúEscolhendo o Tetrimino‚Äù de um artigo anterior): ele n√£o seleciona os n√∫meros uniformemente. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As tentativas iniciais resultaram em bots agindo de forma muito agressiva. Se eles superaram o plat√¥ 19‚Äì28, geralmente atingiram a pontua√ß√£o m√°xima. Infelizmente, por√©m, muitas vezes cedo demais, levavam a estouros de campo. Em resposta a isso, quatro medidas foram tomadas para "acalmar" os bots:</font></font><br><br><ol><li>    :        Tetris,   .      ¬´¬ª          .          .     ;     230 .  ,      Tetris   .        Single, Double  Triple.          ;        . </li><li>          .      ,   ,      7 .         . </li><li>  ,          ,           .        ,       7 . </li><li>          ,      ,      .       ,       .         ,      . </li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Depois de aplicar todas essas regras para "acalmar" os bots, o m√©todo PSO forneceu os seguintes pesos: </font></font><br><br><table><tbody><tr><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Par√¢metro </font></font></th><th>  Peso </th></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> N√∫mero total de linhas limpas </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 0.286127095297893900 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Altura total de bloqueio </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1.701233676909959200 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> N√∫mero total de c√©lulas de po√ßo </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 0.1111304230768307700 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> N√∫mero total de po√ßos profundos </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 0.910665415998680400 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> O n√∫mero total de furos nas colunas </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1.879338064244357000 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Furos de coluna ponderados totais </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 2.168463848297177000 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> N√∫mero total de profundidades de furo em colunas </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ‚àí0.265587111961757270 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Profundidade m√≠nima do furo da coluna </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 0.289886584949610500 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Profundidade m√°xima do furo da coluna </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 0.362361055261181730 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> O n√∫mero total de transi√ß√µes nas colunas </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ‚àí0,028668795795469625 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Total de saltos de linha </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 0.874179981113233100 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Alturas totais da coluna </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ‚àí0.507409683144361900 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Altura da pilha </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ‚àí2.148676202831281000 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Dispers√£o das alturas da coluna </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ‚àí1.187558540281141700 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> N√∫mero total de c√©lulas ocupadas </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ‚àí2.645656132241128000 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> N√∫mero total ponderado de c√©lulas ocupadas </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 0.242043416268706620 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Dispers√£o das alturas das colunas </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 0.287838126164431440 </font></font></td></tr></tbody></table><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como a cadeia busca uma combina√ß√£o que minimize a fun√ß√£o de avalia√ß√£o, par√¢metros com pesos positivos podem ser considerados b√¥nus e o restante √© multado. </font><font style="vertical-align: inherit;">Mas os pesos n√£o mostram necessariamente o significado dos par√¢metros correspondentes; </font><font style="vertical-align: inherit;">eles n√£o s√£o normalizados, portanto, n√£o podem ser comparados.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> For√ßa da IA </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para avaliar a for√ßa da IA, foram coletados aproximadamente 1,7 milh√£o de resultados (em pontos) de jogos simulados em um plat√¥ de 19 a 28. A pontua√ß√£o n√£o reflete o jogo no n√≠vel 29 ou superior e n√£o leva em considera√ß√£o os pontos obtidos em descidas suaves. No entanto, inclui jogos conclu√≠dos prematuramente devido a estouros de campo. A l√≥gica Nintendo Tetris PRNG foi usada para gerar as seq√º√™ncias de Tetrimino. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Entre esses resultados, a maior pontua√ß√£o √© de 1.313.600. A m√≠nima √© 0. A </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m√©dia √© 816.379 e parece pequena. Mas, como mencionado abaixo, os dados s√£o distorcidos, portanto, a pontua√ß√£o m√©dia de 989.200 pontos d√° uma id√©ia melhor do valor t√≠pico.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como mencionado acima, o PSO otimizou os pesos com base na m√©dia do melhor ter√ßo dos lotes. </font><font style="vertical-align: inherit;">Nesse caso, a pontua√ß√£o m√©dia do melhor ter√ßo √© de 1 108 860. Na verdade, a pontua√ß√£o m√©dia dos melhores 75% √© de 1.000.000. O </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bot tem uma probabilidade de 47% de atingir o limite de pontos do n√≠vel 29. Ele tem uma probabilidade de 61% de obter 900.000 pontos ao n√≠vel 29. O gr√°fico abaixo mostra as probabilidades de pontua√ß√£o at√© o n√≠vel 29.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5a8/082/43a/5a808243a35de546e886bcf6cc8663aa.png" alt="densidade de probabilidade"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parece que a probabilidade diminui linearmente para cerca de 900.000 pontos. </font><font style="vertical-align: inherit;">Ent√£o entra em uma curva sigm√≥ide invertida. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abaixo est√° um histograma suavizado com o n√∫mero de participantes para cada um dos pontos marcados. </font><font style="vertical-align: inherit;">Sua forma √© determinada pela derivada do gr√°fico mostrado acima.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7b4/cf4/a7c/7b4cf4a7cfc06203bedef3b81243d20b.png" alt="histograma"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se voc√™ ignorar as flutua√ß√µes, at√© cerca de 900.000 s√£o planas e depois entra em uma distribui√ß√£o normal com o centro em torno de 1.050.000 pontos. </font><font style="vertical-align: inherit;">As raz√µes para as flutua√ß√µes n√£o s√£o claras. </font><font style="vertical-align: inherit;">Parece que o n√∫mero de pontos prefere pular em incrementos de 20.000 pontos. </font><font style="vertical-align: inherit;">Talvez isso se deva ao ciclo de constru√ß√£o da pilha e √† obten√ß√£o do Tetris.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Aloca√ß√£o de RAM e ROM </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para manipular a mem√≥ria da CPU, transmitir cliques no bot√£o e receber eventos de renderiza√ß√£o de quadro, o plug-in usa a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> do </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">Nintaco</font></a><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Todos os endere√ßos de mem√≥ria foram descobertos usando as ferramentas de depura√ß√£o do Nintaco e as informa√ß√µes foram adicionadas ao </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wiki</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> do </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">Data Crystal ROMhacking.net</font></a><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">No c√≥digo fonte, eles se parecem com constantes na interface </font></font><code>Addresses</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><hr><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Refer√™ncias </font></font></h1><br><ol><li> van den Bergh, F.; Engelbrecht, AP (2006) <br> A study of particle swarm optimization particle trajectories <br> In: <i>Information Sciences 176 (2006)</i> (pp. 937‚Äì971) <br> Retrieved from <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">http://researchspace.csir.co.za/dspace/bitstream/handle/10204/1155/van%20den%20bergh_2006_D.pdf</a> </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt421065/">https://habr.com/ru/post/pt421065/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt421055/index.html">Desenvolvimento web personalizado: como escalar em um projeto sempre crescente</a></li>
<li><a href="../pt421057/index.html">Como montar vag√µes para trens de passageiros</a></li>
<li><a href="../pt421059/index.html">Acelerando sites com dicas iniciais</a></li>
<li><a href="../pt421061/index.html">PostgreSQL: como e por que o WAL aumenta</a></li>
<li><a href="../pt421063/index.html">Novos livros sobre programa√ß√£o infantil no zero</a></li>
<li><a href="../pt421067/index.html">Como desenvolvemos o aplicativo AR para revisar lugares hist√≥ricos</a></li>
<li><a href="../pt421069/index.html">Bobby Urban Backpack: dentro do castelo</a></li>
<li><a href="../pt421071/index.html">Mod e restante n√£o s√£o os mesmos</a></li>
<li><a href="../pt421073/index.html">Epis√≥dio 1. Custo do Hack</a></li>
<li><a href="../pt421075/index.html">Dicion√°rio digital de A a Z</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>