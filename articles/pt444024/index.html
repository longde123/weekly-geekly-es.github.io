<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üï¥üèº ü§¢ üí® Como implementar uma linguagem de programa√ß√£o em JavaScript. Parte 3: Int√©rprete de CPS ü§¥üèæ üé∏ üë©üèΩ‚Äçüåæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ol√° Apresento a voc√™ a terceira parte da minha tradu√ß√£o do guia para implementar minha linguagem de programa√ß√£o JavaScript - PL Tutorial . 
 Do tradut...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Como implementar uma linguagem de programa√ß√£o em JavaScript. Parte 3: Int√©rprete de CPS</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/444024/"><p>  Ol√°  Apresento a voc√™ a terceira parte da minha tradu√ß√£o do guia para implementar minha linguagem de programa√ß√£o JavaScript - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">PL Tutorial</a> . </p><br><h1 id="ot-perevodchika">  Do tradutor </h1><br><p>  Criaremos nossa pr√≥pria linguagem de programa√ß√£o - <strong>linguagem Œª</strong> (no original - <strong>linguagem Œª</strong> ).  No processo de cria√ß√£o, usaremos muitas t√©cnicas interessantes, como descida recursiva, estilo de transfer√™ncia de controle e t√©cnicas b√°sicas de otimiza√ß√£o.  Ser√£o criadas duas vers√µes do int√©rprete - o regular e o CPS, o transcompilador em JavaScript. </p><br><p>  O autor do original √© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Mihai Bazon</a> , o autor da famosa biblioteca UglifyJS (uma ferramenta para minimizar e formatar o c√≥digo JS). </p><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">Conte√∫do</b> <div class="spoiler_text"><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Como implementar uma linguagem de programa√ß√£o em JavaScript.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Parte 1: Analisador</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Como implementar uma linguagem de programa√ß√£o em JavaScript.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Parte 2: Int√©rprete</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Como implementar uma linguagem de programa√ß√£o em JavaScript.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Parte 3: Int√©rprete de CPS</a> </li><li>  Como implementar uma linguagem de programa√ß√£o em JavaScript.  Parte 4: Trans Compilando em JS </li></ol></div></div><br><p> PS Existe um erro no interpretador e compilador: em express√µes como <code>a() &amp;&amp; b()</code> ou <code>a() || b()</code>  <code>a() || b()</code> ambas as partes s√£o sempre executadas.  Obviamente, isso est√° errado porque <code>a()</code> falso para o operador <code>&amp;&amp;</code> ou falso para o <code>||</code>  , o valor de <code>b()</code> n√£o desempenha nenhum papel.  Isso n√£o √© dif√≠cil de corrigir. </p><br><h1 id="cps-interpretator">  Int√©rprete CPS </h1><br><p>  Nossa linguagem Œª tem duas desvantagens: </p><br><ul><li>  A recurs√£o √© limitada √† pilha JS, portanto, n√£o temos uma maneira normal de fazer loops. </li><li>  O int√©rprete √© lento, ent√£o a recurs√£o √© muito lenta. </li></ul><br><p>  Agora, corrigiremos a primeira falha sem prestar aten√ß√£o ao fato de que o int√©rprete se tornar√° ainda mais lento.  Reescreveremos o int√©rprete no estilo "estilo de passagem de continua√ß√£o" (CPS). </p><br><h2 id="chto-takoe-peredacha-prodolzheniya">  O que √© uma "transfer√™ncia de continua√ß√£o" </h2><br><p>  Voc√™ faz isso no NodeJS o tempo todo: </p><br><pre> <code class="javascript hljs">fs.readFile(<span class="hljs-string"><span class="hljs-string">"file.txt"</span></span>, <span class="hljs-string"><span class="hljs-string">"utf8"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CC</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">error, data</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-comment"><span class="hljs-comment">//   - "" //     'return', // 'readFile'  ,  . });</span></span></code> </pre> <br><p>  A cada passo, h√° um retorno de chamada que ser√° chamado quando voc√™ precisar continuar.  O estilo de transfer√™ncia de continua√ß√£o torna a transfer√™ncia de controle "expl√≠cita" - voc√™ n√£o usa <code>return</code> , <code>throw</code> , <code>break</code> ou <code>continue</code> .  N√£o h√° saltos impl√≠citos no c√≥digo.  Voc√™ n√£o pode nem usar loops <code>for</code> ou <code>while</code> com fun√ß√µes ass√≠ncronas.  Nesse caso, por que precisamos deles na linguagem de programa√ß√£o? </p><br><p>  Escrever c√≥digo no estilo de transmitir uma continua√ß√£o √© dif√≠cil e f√°cil de cometer erros, mas apenas reescreveremos o int√©rprete nesse estilo. </p><br><h2 id="funkciya-evaluate">  <code>evaluate</code> fun√ß√£o </h2><br><p>  A fun√ß√£o <code>evaluate</code> receber√° tr√™s argumentos: express√£o (AST), contexto (ambiente) e a fun√ß√£o que ser√° chamada quando o resultado for.  Aqui est√° o c√≥digo, para cada fragmento, h√° uma explica√ß√£o: </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">evaluate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">exp, env, callback</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (exp.type) {</code> </pre> <br><p>  Para constantes, apenas retornaremos seu valor.  Mas lembre-se, n√£o temos <code>return</code> - apenas chamamos o retorno e passamos o valor. </p><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"num"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"str"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"bool"</span></span>: callback(exp.value); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>;</code> </pre> <br><p>  O n√≥ <code>var</code> tamb√©m √© simples - obtenha a vari√°vel do contexto e passe-a para a fun√ß√£o: </p><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"var"</span></span>: callback(env.get(exp.value)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>;</code> </pre> <br><p>  Para <code>assign</code> n√≥s, precisamos obter o valor da express√£o esquerda ( <code>right</code> ).  Para fazer isso, chamamos de <code>evaluate</code> , passando uma fun√ß√£o que obter√° o resultado (para o lado direito da express√£o).  E ent√£o chamamos o <code>callback</code> com o valor da vari√°vel, configurando a vari√°vel no contexto atual: </p><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"assign"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (exp.left.type != <span class="hljs-string"><span class="hljs-string">"var"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Error</span></span>(<span class="hljs-string"><span class="hljs-string">"Cannot assign to "</span></span> + <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify(exp.left)); evaluate(exp.right, env, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">right</span></span></span><span class="hljs-function">)</span></span>{ callback(env.set(exp.left.value, right)); }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>;</code> </pre> <br><p>  Quase o mesmo para n√≥s do tipo <code>binary</code> , mas aqui precisamos primeiro obter o valor do campo <code>left</code> e, somente ent√£o, o valor do campo <code>right</code> .  Depois, chamamos o retorno de chamada, passando o resultado da opera√ß√£o: </p><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"binary"</span></span>: evaluate(exp.left, env, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">left</span></span></span><span class="hljs-function">)</span></span>{ evaluate(exp.right, env, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">right</span></span></span><span class="hljs-function">)</span></span>{ callback(apply_op(exp.operator, left, right)); }); }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>;</code> </pre> <br><p>  O n√≥ <code>let</code> parece mais complicado, mas na verdade √© simples.  Temos algum n√∫mero de vari√°veis.  O campo <code>def</code> (valor inicial) pode estar vazio; nesse caso, o definiremos como <code>false</code> .  Mas se houver um valor, precisamos chamar <code>evaluate</code> recursivamente para obt√™-lo. </p><br><p>  Se voc√™ j√° trabalhou com o NodeJS antes, j√° fez isso v√°rias vezes.  Devido aos retornos de chamada, n√£o podemos usar, portanto, devemos interpretar essas express√µes uma por vez (imagine a fun√ß√£o de <code>evaluate</code> como ass√≠ncrona).  A fun√ß√£o de <code>loop</code> abaixo (chamada imediatamente) obt√©m o contexto e o n√∫mero da defini√ß√£o que precisa ser processada: </p><br><ul><li>  Se esse n√∫mero for igual ao n√∫mero de vari√°veis ‚Äã‚Äã( <code>vars.length</code> ), isso significa que j√° definimos todas as express√µes para poder executar o corpo da express√£o.  Observe que desta vez n√£o ligamos para <code>callback</code> , mas passamos para <code>evaluate</code> , que ser√° chamado. </li><li>  Se esse n√∫mero for menor, ser√° necess√°rio calcular a defini√ß√£o atual e passar uma fun√ß√£o que chamar√° <code>loop(scope, i + 1)</code> , antes de copiar o contexto. <br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"let"</span></span>: (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loop</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">env, i</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (i &lt; exp.vars.length) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> v = exp.vars[i]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (v.def) evaluate(v.def, env, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">value</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> scope = env.extend(); scope.def(v.name, value); loop(scope, i + <span class="hljs-number"><span class="hljs-number">1</span></span>); }); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> scope = env.extend(); scope.def(v.name, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); loop(scope, i + <span class="hljs-number"><span class="hljs-number">1</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { evaluate(exp.body, env, callback); } })(env, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>;</code> </pre> </li></ul><br><p>  O n√≥ <code>lambda</code> ser√° processado em uma fun√ß√£o separada, como antes: </p><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"lambda"</span></span>: callback(make_lambda(env, exp)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>;</code> </pre> <br><p>  Para interpretar <code>if</code> , primeiro interpretamos a condi√ß√£o.  Se n√£o for falso, interpretaremos a express√£o <code>then</code> , em outro caso, interpretaremos <code>else</code> se houver um ou retornaremos <code>false</code> se n√£o houver.  Como antes, por enquanto e apenas passamos o <code>callback</code> como a "a√ß√£o a ser executada ap√≥s a execu√ß√£o" da express√£o: </p><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"if"</span></span>: evaluate(exp.cond, env, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">cond</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cond !== <span class="hljs-literal"><span class="hljs-literal">false</span></span>) evaluate(exp.then, env, callback); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (exp.else) evaluate(exp.else, env, callback); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> callback(<span class="hljs-literal"><span class="hljs-literal">false</span></span>); }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>;</code> </pre> <br><p>  O n√≥ <code>prog</code> √© interpretado de maneira semelhante ao n√≥ <code>let</code> , mas com a diferen√ßa de que n√£o precisamos copiar o contexto ou definir vari√°veis.  E, novamente, temos uma fun√ß√£o de <code>loop</code> que recebe um n√∫mero de express√£o.  Quando √© igual a <code>prog.length</code> , conclu√≠mos todas as express√µes e simplesmente retornamos o resultado da √∫ltima express√£o (com a palavra "return", quero dizer que chamamos de <code>callback</code> chamada).  Observe que lembramos o √∫ltimo valor passando-o como um argumento para a fun√ß√£o <code>loop</code> (no in√≠cio, √© <code>false</code> no caso em que o corpo est√° vazio): </p><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"prog"</span></span>: (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loop</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">last, i</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (i &lt; exp.prog.length) evaluate(exp.prog[i], env, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">val</span></span></span><span class="hljs-function">)</span></span>{ loop(val, i + <span class="hljs-number"><span class="hljs-number">1</span></span>); }); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { callback(last); } })(<span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>;</code> </pre> <br><p>  Para um n√≥ do tipo <code>call</code> precisamos interpretar <code>func</code> e, em seguida, todos os argumentos est√£o em ordem.  E, novamente, h√° uma fun√ß√£o de <code>loop</code> que funciona com o mesmo princ√≠pio que <code>let</code> ou <code>prog</code> , com a diferen√ßa de que agora cria uma matriz como resultado: </p><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"call"</span></span>: evaluate(exp.func, env, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">func</span></span></span><span class="hljs-function">)</span></span>{ (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loop</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">args, i</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (i &lt; exp.args.length) evaluate(exp.args[i], env, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">arg</span></span></span><span class="hljs-function">)</span></span>{ args[i + <span class="hljs-number"><span class="hljs-number">1</span></span>] = arg; loop(args, i + <span class="hljs-number"><span class="hljs-number">1</span></span>); }); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { func.apply(<span class="hljs-literal"><span class="hljs-literal">null</span></span>, args); } })([ callback ], <span class="hljs-number"><span class="hljs-number">0</span></span>); }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>;</code> </pre> <br><p>  Bem, o final padr√£o: se n√£o sabemos o que fazer, lance uma exce√ß√£o: </p><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Error</span></span>(<span class="hljs-string"><span class="hljs-string">"I don't know how to evaluate "</span></span> + exp.type); } }</code> </pre> <br><p>  Voc√™ pode perceber que cada <code>case</code> acima termina com a palavra-chave <code>return</code> .  Mas n√£o h√° valor de retorno - o resultado √© sempre passado para a fun√ß√£o de <code>callback</code> . </p><br><h3 id="novaya-funkciya-make_lambda">  Nova fun√ß√£o <code>make_lambda</code> </h3><br><p>  Nesse int√©rprete, todas as fun√ß√µes receber√£o uma ‚Äúcontinua√ß√£o‚Äù como o primeiro argumento - a fun√ß√£o que devemos chamar para passar o resultado.  Depois s√£o os argumentos usuais para a fun√ß√£o.  Aqui est√° o novo c√≥digo para a fun√ß√£o <code>make_lambda</code> : </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">make_lambda</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">env, exp</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (exp.name) { env = env.extend(); env.def(exp.name, lambda); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">lambda</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">callback</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> names = exp.vars; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> scope = env.extend(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; names.length; ++i) scope.def(names[i], i + <span class="hljs-number"><span class="hljs-number">1</span></span> &lt; <span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>.length ? <span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>[i + <span class="hljs-number"><span class="hljs-number">1</span></span>] : <span class="hljs-literal"><span class="hljs-literal">false</span></span>); evaluate(exp.body, scope, callback); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> lambda; }</code> </pre> <br><p>  Ele n√£o √© muito diferente.  Ele adiciona novas vari√°veis ‚Äã‚Äãa um novo contexto.  Al√©m disso, devemos considerar que o primeiro argumento √© <code>callback</code> .  Finalmente, a fun√ß√£o de <code>evaluate</code> √© usada para executar o c√≥digo da fun√ß√£o em um novo contexto, mas, como antes, passamos um <code>callback</code> . </p><br><p>  A prop√≥sito, este √© o √∫nico lugar que usei o loop <code>for</code> .  Isso ocorre porque os valores do argumento j√° est√£o calculados quando o n√≥ da <code>call</code> foi processado. </p><br><h2 id="nativnye-funkcii">  Fun√ß√µes nativas </h2><br><p>  Nesse int√©rprete, fun√ß√µes nativas recebem um <code>callback</code> como o primeiro argumento.  Devemos lembrar disso quando definimos fun√ß√µes nativas.  Aqui est√° o c√≥digo de exemplo para o novo int√©rprete: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> code = <span class="hljs-string"><span class="hljs-string">"sum = lambda(x, y) x + y; print(sum(2, 3));"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ast = parse(TokenStream(InputStream(code))); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> globalEnv = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Environment(); <span class="hljs-comment"><span class="hljs-comment">// define the "print" primitive function globalEnv.def("print", function(callback, txt){ console.log(txt); callback(false); // call the continuation with some return value // if we don't call it, the program would stop // abruptly after a print! }); // run the evaluator evaluate(ast, globalEnv, function(result){ // the result of the entire program is now in "result" });</span></span></code> </pre> <br><h2 id="malenkiy-test">  Little test </h2><br><p>  Vamos tentar calcular os n√∫meros de Fibonacci novamente: </p><br><pre> <code class="javascript hljs">fib = Œª(n) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> n &lt; <span class="hljs-number"><span class="hljs-number">2</span></span> then n <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> fib(n - <span class="hljs-number"><span class="hljs-number">1</span></span>) + fib(n - <span class="hljs-number"><span class="hljs-number">2</span></span>); time( Œª() println(fib(<span class="hljs-number"><span class="hljs-number">10</span></span>)) );</code> </pre> <br><p>  Mas, se tentarmos encontrar o 27¬∫ n√∫mero, obtemos um estouro de pilha.  Em geral, a pilha agora est√° crescendo muito mais r√°pido, portanto, agora podemos contar o n√∫mero de Fibonacci apenas at√© o dia 12 (pelo menos no meu navegador).  Isso n√£o √© muito bom, ent√£o voc√™ precisa corrigi-lo de alguma forma. </p><br><h1 id="zaschischaem-stek">  Protegemos a pilha </h1><br><p>  Em um int√©rprete CPS, a pilha cresce muito mais rapidamente porque o int√©rprete sempre chama fun√ß√µes recursivamente, nunca retornando um resultado.  Embora tenhamos <code>return</code> ao int√©rprete, precisamos deles, mas no caso de recurs√£o muito profunda, nunca os alcan√ßamos. </p><br><p>  Vamos imaginar como nossa pilha procura um programa muito simples.  Vou mostrar o pseudo-c√≥digo e n√£o adicionei o <code>env</code> porque ele n√£o desempenha nenhum papel aqui: </p><br><pre> <code class="python hljs">print(<span class="hljs-number"><span class="hljs-number">1</span></span> + <span class="hljs-number"><span class="hljs-number">2</span></span> * <span class="hljs-number"><span class="hljs-number">3</span></span>); <span class="hljs-comment"><span class="hljs-comment">## : evaluate( print(1 + 2 * 3), K0 ) evaluate( print, K1 ) K1(print) #  'var',      evaluate( 1 + 2 * 3, K2 ) evaluate( 2 * 3, K3 ) evaluate( 2, K4 ) K4(2) # 2  ,      evaluate( 3, K5 ) #    3,      K5(3) K3(6) #  2*3 evaluate( 1, K6 ) #  ,  K6(1) K2(7) #  1+2*3 print(K0, 7) # ,     'print' K0(false) #  . 'print'  'false'.</span></span></code> </pre> <br><p>  Somente ap√≥s a √∫ltima chamada, uma longa sequ√™ncia de <code>return</code> in√∫til reduz a pilha.  Se usarmos tanto espa√ßo de pilha para um programa simples, √© dif√≠cil imaginar o que acontecer√° com a <code>fib(13)</code> . </p><br><h2 id="zaschita-steka">  Prote√ß√£o de pilha </h2><br><p>  Em nosso novo int√©rprete, a pilha simplesmente n√£o √© necess√°ria.  Tudo o que precisa ser feito depois que alguma express√£o ocorre em um <code>callback</code> , que √© passado como argumento.  Ent√£o, aqui temos uma pergunta: e se o JavaScript tornasse poss√≠vel "despejar" a pilha.  Depois, podemos largar a pilha e a recurs√£o infinitamente profunda funcionar√°. </p><br><p>  Vamos imaginar que temos uma fun√ß√£o <code>GUARD</code> que pode fazer isso.  Ele obt√©m dois valores: a fun√ß√£o a ser chamada e os argumentos que precisam ser passados.  Ele verifica: se a pilha for muito profunda, ela limpar√° a pilha e chamar√° a fun√ß√£o passada.  Em outro caso, ela n√£o faz nada. </p><br><p>  Usando a nova fun√ß√£o, reescrevemos o int√©rprete como mostrado abaixo.  N√£o vou comentar sobre cada caso individual, existe o c√≥digo descrito anteriormente, mas usando a fun√ß√£o <code>GUARD</code> : </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">evaluate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">exp, env, callback</span></span></span><span class="hljs-function">) </span></span>{ GUARD(evaluate, <span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (exp.type) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"num"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"str"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"bool"</span></span>: callback(exp.value); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"var"</span></span>: callback(env.get(exp.value)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"assign"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (exp.left.type != <span class="hljs-string"><span class="hljs-string">"var"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Error</span></span>(<span class="hljs-string"><span class="hljs-string">"Cannot assign to "</span></span> + <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify(exp.left)); evaluate(exp.right, env, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CC</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">right</span></span></span><span class="hljs-function">)</span></span>{ GUARD(CC, <span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>); callback(env.set(exp.left.value, right)); }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"binary"</span></span>: evaluate(exp.left, env, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CC</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">left</span></span></span><span class="hljs-function">)</span></span>{ GUARD(CC, <span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>); evaluate(exp.right, env, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CC</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">right</span></span></span><span class="hljs-function">)</span></span>{ GUARD(CC, <span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>); callback(apply_op(exp.operator, left, right)); }); }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"let"</span></span>: (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loop</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">env, i</span></span></span><span class="hljs-function">)</span></span>{ GUARD(loop, <span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (i &lt; exp.vars.length) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> v = exp.vars[i]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (v.def) evaluate(v.def, env, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CC</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">value</span></span></span><span class="hljs-function">)</span></span>{ GUARD(CC, <span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> scope = env.extend(); scope.def(v.name, value); loop(scope, i + <span class="hljs-number"><span class="hljs-number">1</span></span>); }); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> scope = env.extend(); scope.def(v.name, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); loop(scope, i + <span class="hljs-number"><span class="hljs-number">1</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { evaluate(exp.body, env, callback); } })(env, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"lambda"</span></span>: callback(make_lambda(env, exp)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"if"</span></span>: evaluate(exp.cond, env, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CC</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">cond</span></span></span><span class="hljs-function">)</span></span>{ GUARD(CC, <span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cond !== <span class="hljs-literal"><span class="hljs-literal">false</span></span>) evaluate(exp.then, env, callback); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (exp.else) evaluate(exp.else, env, callback); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> callback(<span class="hljs-literal"><span class="hljs-literal">false</span></span>); }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"prog"</span></span>: (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loop</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">last, i</span></span></span><span class="hljs-function">)</span></span>{ GUARD(loop, <span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (i &lt; exp.prog.length) evaluate(exp.prog[i], env, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CC</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">val</span></span></span><span class="hljs-function">)</span></span>{ GUARD(CC, <span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>); loop(val, i + <span class="hljs-number"><span class="hljs-number">1</span></span>); }); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { callback(last); } })(<span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"call"</span></span>: evaluate(exp.func, env, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CC</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">func</span></span></span><span class="hljs-function">)</span></span>{ GUARD(CC, <span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>); (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loop</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">args, i</span></span></span><span class="hljs-function">)</span></span>{ GUARD(loop, <span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (i &lt; exp.args.length) evaluate(exp.args[i], env, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CC</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">arg</span></span></span><span class="hljs-function">)</span></span>{ GUARD(CC, <span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>); args[i + <span class="hljs-number"><span class="hljs-number">1</span></span>] = arg; loop(args, i + <span class="hljs-number"><span class="hljs-number">1</span></span>); }); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { func.apply(<span class="hljs-literal"><span class="hljs-literal">null</span></span>, args); } })([ callback ], <span class="hljs-number"><span class="hljs-number">0</span></span>); }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Error</span></span>(<span class="hljs-string"><span class="hljs-string">"I don't know how to evaluate "</span></span> + exp.type); } }</code> </pre> <br><p>  Para fun√ß√µes an√¥nimas, precisamos adicionar um nome para que possamos pass√°-los para a fun√ß√£o <code>GUARD</code> .  Eu usei o nome <code>CC</code> ( <code>current continuation</code> ).  Voc√™ pode usar <code>arguments.callee</code> , mas esta √© uma API desatualizada. </p><br><p>  Al√©m disso, a mesma altera√ß√£o no <code>make_lambda</code> : </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">make_lambda</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">env, exp</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (exp.name) { env = env.extend(); env.def(exp.name, lambda); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">lambda</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">callback</span></span></span><span class="hljs-function">) </span></span>{ GUARD(lambda, <span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>); <span class="hljs-comment"><span class="hljs-comment">// &lt;--  var names = exp.vars; var scope = env.extend(); for (var i = 0; i &lt; names.length; ++i) scope.def(names[i], i + 1 &lt; arguments.length ? arguments[i + 1] : false); evaluate(exp.body, scope, callback); } return lambda; }</span></span></code> </pre> <br><p>  A implementa√ß√£o do <code>GUARD</code> muito simples.  Como sair de uma chamada profunda?  Usando exce√ß√µes.  Para fazer isso, haver√° uma vari√°vel global que indicar√° quanto mais recurs√£o podemos fazer.  Se chegar a zero, lan√ßamos o objeto <code>Continuation</code> , no qual haver√° uma continua√ß√£o - fun√ß√£o e argumentos: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> STACKLEN; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GUARD</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">f, args</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (--STACKLEN &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Continuation(f, args); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Continuation</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">f, args</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.f = f; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.args = args; }</code> </pre> <br><p>  E no final, precisamos de um loop que capture objetos de <code>Continuation</code> .  Devemos chamar o int√©rprete atrav√©s deste loop para que tudo funcione: </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Execute</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">f, args</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-literal"><span class="hljs-literal">true</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { STACKLEN = <span class="hljs-number"><span class="hljs-number">200</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> f.apply(<span class="hljs-literal"><span class="hljs-literal">null</span></span>, args); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span>(ex) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ex <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> Continuation) f = ex.f, args = ex.args; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> ex; } }</code> </pre> <br><p>  A fun√ß√£o <code>Execute</code> aceita a fun√ß√£o a ser chamada e os argumentos para ela.  Funciona em loop, mas preste aten√ß√£o para <code>return</code> se a fun√ß√£o funcionar sem excesso de pilha, paramos imediatamente.  <code>STACKLEN</code> redefinido toda vez que iniciamos uma itera√ß√£o de loop.  Um valor de <code>200</code> - se encaixa bem.  Quando capturamos o objeto <code>Continuation</code> , substitu√≠mos uma nova fun√ß√£o e argumentos e continuamos o loop.  Al√©m disso, devido a uma exce√ß√£o, a pilha √© limpa, para que possamos continuar. </p><br><p>  Para iniciar o int√©rprete, agora usamos <code>Execute</code> : </p><br><pre> <code class="javascript hljs">Execute(evaluate, [ ast, globalEnv, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">result</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">"*** Result:"</span></span>, result); }]);</code> </pre> <br><h2 id="test">  Teste </h2><br><p>  A fun√ß√£o <code>fib</code> agora funcionar√°: </p><br><pre> <code class="python hljs">fib = Œª(n) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> n &lt; <span class="hljs-number"><span class="hljs-number">2</span></span> then n <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> fib(n - <span class="hljs-number"><span class="hljs-number">1</span></span>) + fib(n - <span class="hljs-number"><span class="hljs-number">2</span></span>); time( Œª() println(fib(<span class="hljs-number"><span class="hljs-number">20</span></span>)) ); <span class="hljs-comment"><span class="hljs-comment"># 6765, ~300ms</span></span></code> </pre> <br><p>  √â uma pena, mas se voc√™ tentar encontrar a <code>fib(27)</code> , levar√° cerca de quatro vezes o tempo que um int√©rprete comum.  Mas agora temos recurs√£o infinita: </p><br><pre> <code class="javascript hljs">sum = Œª(n, ret) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> n == <span class="hljs-number"><span class="hljs-number">0</span></span> then ret <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> sum(n - <span class="hljs-number"><span class="hljs-number">1</span></span>, ret + n); # compute <span class="hljs-number"><span class="hljs-number">1</span></span> + <span class="hljs-number"><span class="hljs-number">2</span></span> + ... + <span class="hljs-number"><span class="hljs-number">50000</span></span> time( Œª() println(sum(<span class="hljs-number"><span class="hljs-number">50000</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)) ); # <span class="hljs-number"><span class="hljs-number">1250025000</span></span>, ~<span class="hljs-number"><span class="hljs-number">700</span></span>ms</code> </pre> <br><p>  Obviamente, a linguagem Œª √© muito mais lenta que o JavaScript.  Imagine, todo acesso a uma vari√°vel passa por um objeto <code>Environment</code> .  N√£o faz sentido tentar otimizar o int√©rprete - n√£o obteremos um ganho significativo de desempenho.  Para melhorar o desempenho, existe uma solu√ß√£o: compile a linguagem Œª em JS, e √© isso que faremos.  Primeiro, vamos ver o que podemos fazer de interessante com um int√©rprete do CPS. </p><br><h1 id="prodolzheniya">  Continua√ß√£o </h1><br><p>  Agora que o int√©rprete trabalha no estilo de transmiss√£o de continua√ß√£o, e todas as fun√ß√µes, fun√ß√µes da linguagem Œª e fun√ß√µes JS nativas, recebem a fun√ß√£o de continua√ß√£o como o primeiro argumento a retornar o resultado (esse argumento √© necess√°rio para as fun√ß√µes JavaScript, embora seja invis√≠vel para as fun√ß√µes da linguagem Œª). </p><br><p>  O <code>callback</code> vari√°vel significa a continua√ß√£o de todo o programa.  <em>Tudo o que o programa far√° a seguir.</em>  Vamos chamar essa vari√°vel de 'continua√ß√£o atual' ou <code>k</code> no c√≥digo. </p><br><p>  Al√©m disso, se n√£o causarmos uma continua√ß√£o, o programa ser√° interrompido.  N√£o podemos fazer isso a partir da linguagem Œª porque <code>make_lambda</code> chama continua√ß√£o de qualquer maneira.  Mas podemos fazer isso a partir de uma fun√ß√£o nativa.  Eu criei uma fun√ß√£o para mostrar como isso funciona: </p><br><pre> <code class="javascript hljs">globalEnv.def(<span class="hljs-string"><span class="hljs-string">"halt"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">k</span></span></span><span class="hljs-function">)</span></span>{});</code> </pre> <br><p>  Esta √© uma fun√ß√£o que n√£o faz nada.  Ela recebe a continua√ß√£o ( <code>k</code> ), mas n√£o a chama: </p><br><pre> <code class="python hljs">println(<span class="hljs-string"><span class="hljs-string">"foo"</span></span>); halt(); println(<span class="hljs-string"><span class="hljs-string">"bar"</span></span>);</code> </pre> <br><p>  Conclus√£o: </p><br><pre> <code class="plaintext hljs">foo</code> </pre> <br><p>  Se voc√™ excluir a chamada <code>halt()</code> , a sa√≠da ser√°: <code>foo / bar / ***Result: false</code> (porque o √∫ltimo <code>println</code> retorna <code>false</code> ).  Mas com <code>halt()</code> isso apenas gera <code>foo</code> .  * Agora n√£o h√° resultado, porque <code>halt()</code> n√£o causa continua√ß√£o e, portanto, o retorno de chamada que passamos para <code>evaluate</code> - aquele que exibe a string <code>***Result</code> , nunca √© chamado.  A fun√ß√£o chamada <code>evaluate</code> n√£o percebe que o programa foi interrompido.  No NodeJS, isso seria um tiro no p√©. </p><br><hr><br><p>  Imagine que precisamos de uma fun√ß√£o <code>sleepe</code> que interrompa um programa sem interromper o navegador (portanto, sem loops est√∫pidos).  Podemos facilmente implementar isso usando uma fun√ß√£o nativa: </p><br><pre> <code class="javascript hljs">globalEnv.def(<span class="hljs-string"><span class="hljs-string">"sleep"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">k, milliseconds</span></span></span><span class="hljs-function">)</span></span>{ setTimeout(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ Execute(k, [ <span class="hljs-literal"><span class="hljs-literal">false</span></span> ]); <span class="hljs-comment"><span class="hljs-comment">//   ,  'false' }, milliseconds); });</span></span></code> </pre> <br><p>  Um pequeno inconveniente √© que precisamos usar o <code>Execute</code> , pois o <code>setTimeout</code> causar√° um retorno de chamada, que acionar√° <code>Continuation</code> , e ningu√©m o capturar√°.  Veja como us√°-lo: </p><br><pre> <code class="python hljs">let loop (n = <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> n &lt; <span class="hljs-number"><span class="hljs-number">10</span></span> { println(n); sleep(<span class="hljs-number"><span class="hljs-number">250</span></span>); loop(n + <span class="hljs-number"><span class="hljs-number">1</span></span>); } }; println(<span class="hljs-string"><span class="hljs-string">"And we're done"</span></span>);</code> </pre> <br><p>  Conclus√£o: </p><br><pre> <code class="plaintext hljs">0 1 2 3 4 5 6 7 8 9 And we're done ***Result: false</code> </pre> <br><p>  Observe que h√° um pequeno atraso entre cada linha.  Voc√™ pode tentar executar esse c√≥digo no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">artigo original</a> . </p><br><p>  Isso j√° √© algo que voc√™ n√£o pode fazer no JavaScript normal, exceto pelo uso da transmiss√£o manual de continua√ß√£o (e tamb√©m n√£o √© poss√≠vel usar um loop <code>for</code> ): </p><br><pre> <code class="javascript hljs">(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loop</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">n</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (n &lt; <span class="hljs-number"><span class="hljs-number">10</span></span>) { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(n); setTimeout(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ loop(n + <span class="hljs-number"><span class="hljs-number">1</span></span>); }, <span class="hljs-number"><span class="hljs-number">250</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { println(<span class="hljs-string"><span class="hljs-string">"And we're done"</span></span>); <span class="hljs-comment"><span class="hljs-comment">//    } })(0);</span></span></code> </pre> <br><hr><br><p>  Imagine como voc√™ pode usar a API do NodeJS em uma linguagem Œª: </p><br><pre> <code class="javascript hljs">globalEnv.def(<span class="hljs-string"><span class="hljs-string">"readFile"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">k, filename</span></span></span><span class="hljs-function">)</span></span>{ fs.readFile(filename, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">err, data</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-comment"><span class="hljs-comment">// error handling is a bit more complex, ignoring for now Execute(k, [ data ]); // hope it's clear why we need the Execute }); }); globalEnv.def("writeFile", function(k, filename, data){ fs.writeFile(filename, data, function(err){ Execute(k, [ false ]); }); });</span></span></code> </pre> <br><p>  Uso: </p><br><pre> <code class="python hljs">copyFile = Œª(source, dest) { writeFile(dest, readFile(source)); }; copyFile(<span class="hljs-string"><span class="hljs-string">"foo.txt"</span></span>, <span class="hljs-string"><span class="hljs-string">"bar.txt"</span></span>);</code> </pre> <br><p>  E tudo isso funciona de forma ass√≠ncrona.  N√£o h√° mais retorno de chamada. </p><br><hr><br><p>  Aqui est√° um exemplo mais interessante.  Eu escrevi a seguinte fun√ß√£o nativa: </p><br><pre> <code class="javascript hljs">globalEnv.def(<span class="hljs-string"><span class="hljs-string">"twice"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">k, a, b</span></span></span><span class="hljs-function">)</span></span>{ k(a); k(b); });</code> </pre> <br><p>  O programa usa dois argumentos <code>b</code> e chama continua√ß√£o duas vezes, uma vez para cada argumento.  Vamos tentar cham√°-lo: </p><br><pre> <code class="python hljs">println(<span class="hljs-number"><span class="hljs-number">2</span></span> + twice(<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>)); println(<span class="hljs-string"><span class="hljs-string">"Done"</span></span>);</code> </pre> <br><p>  Conclus√£o: </p><br><pre> <code class="plaintext hljs">5 Done ***Result: false 6 Done ***Result: false</code> </pre> <br><p>  A conclus√£o √© estranha se voc√™ nunca trabalhou com continua√ß√µes anteriores, mas tente entender esse c√≥digo por conta pr√≥pria.  Uma pequena dica: o programa inicia uma vez, mas retorna o resultado duas vezes. </p><br><h2 id="obobschenie-callcc">  Generaliza√ß√£o: <code>CallCC</code> </h2><br><p>  Costum√°vamos brincar com o fogo quando escrev√≠amos fun√ß√µes nativas.  N√£o h√° nenhuma maneira na linguagem Œª para interromper a execu√ß√£o da continua√ß√£o atual.  <code>CallCC</code> ajudar√° a resolver esse problema.  O nome √© a abrevia√ß√£o da fun√ß√£o de Scheme - <code>call-with-current-continuation</code> (que geralmente √© chamada de chamada / cc no esquema). </p><br><pre> <code class="javascript hljs">globalEnv.def(<span class="hljs-string"><span class="hljs-string">"CallCC"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">k, f</span></span></span><span class="hljs-function">)</span></span>{ f(k, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CC</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">discarded, ret</span></span></span><span class="hljs-function">)</span></span>{ k(ret); }); });</code> </pre> <br><p>  Ele <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">reifica a</a> continua√ß√£o atual em uma fun√ß√£o que pode ser chamada diretamente da linguagem Œª.  Esta fun√ß√£o ignorar√° sua continua√ß√£o <code>discarded</code> original e chamar√° a continua√ß√£o que foi passada para a fun√ß√£o <code>CallCC</code> . </p><br><p>  Usando esta fun√ß√£o, podemos implementar (j√° diretamente na linguagem, n√£o atrav√©s de fun√ß√µes nativas!) Um grande conjunto de instru√ß√µes de controle para o fluxo de execu√ß√£o em que nem pens√°vamos antes - come√ßando pelas exce√ß√µes e terminando com <code>return</code> .  Vamos come√ßar do √∫ltimo. </p><br><h3 id="realizaciya-return">  <code>return</code> implementa√ß√£o </h3><br><pre> <code class="python hljs">foo = Œª(<span class="hljs-keyword"><span class="hljs-keyword">return</span></span>){ println(<span class="hljs-string"><span class="hljs-string">"foo"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>(<span class="hljs-string"><span class="hljs-string">"DONE"</span></span>); println(<span class="hljs-string"><span class="hljs-string">"bar"</span></span>); }; CallCC(foo);</code> </pre> <br><p>  Conclus√£o: </p><br><pre> <code class="plaintext hljs">foo ***Result: DONE</code> </pre> <br><p>  A fun√ß√£o <code>foo</code> recebe um argumento que faz o mesmo que <code>return</code> do JavaScript (mas √© chamado como uma fun√ß√£o regular).  Ignora a continua√ß√£o atual (que produziria 'bar') e sai da fun√ß√£o, retornando o valor fornecido ("DONE").  Obviamente, isso s√≥ funciona se voc√™ chamar uma fun√ß√£o usando o <code>CallCC</code> para passar a continua√ß√£o como <code>return</code> .  Podemos criar um wrapper para isso: </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> = Œª(f) Œª() CallCC(f); foo = <span class="hljs-keyword"><span class="hljs-keyword">with</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">return</span></span>(Œª(<span class="hljs-keyword"><span class="hljs-keyword">return</span></span>){ println(<span class="hljs-string"><span class="hljs-string">"foo"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>(<span class="hljs-string"><span class="hljs-string">"DONE"</span></span>); println(<span class="hljs-string"><span class="hljs-string">"bar"</span></span>); }); foo();</code> </pre> <br><p>  Conclus√£o: </p><br><pre> <code class="plaintext hljs">foo ***Result: DONE</code> </pre> <br><p>  A vantagem desse m√©todo √© que n√£o precisamos mais usar o <code>CallCC</code> quando chamamos <code>foo</code> .  Seria bom, √© claro, se n√£o precis√°ssemos aceitar <code>return</code> como argumento ou usar a fun√ß√£o <code>with-return</code> , mas na linguagem n√£o h√° como adicionar a√ß√∫car sint√°tico diretamente a partir dele, para isso precisamos pelo menos modificar o analisador (+1 para Lisp). </p><br><h3 id="perehody">  Transi√ß√µes </h3><br><p>  Por exemplo, precisamos escrever um programa que procure todos os pares de n√∫meros inteiros positivos de at√© 100, de modo que, se a multiplica√ß√£o deles der 84. Esta n√£o √© uma tarefa dif√≠cil e voc√™ poder√° imaginar imediatamente dois loops aninhados para resolv√™-lo, mas aqui vamos de uma maneira diferente.  Vamos criar duas fun√ß√µes: <code>guess</code> e <code>fail</code> .  O primeiro escolhe o n√∫mero e o segundo diz a ela "tente outro n√∫mero".  Vamos us√°-los assim: </p><br><pre> <code class="python hljs">a = guess(<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-comment"><span class="hljs-comment">#  -  &gt;= 1 b = guess(a); #  -  &gt;= a if a * b == 84 { #    : print(a); print(" x "); println(b); }; fail(); #    `guess`    </span></span></code> </pre> <br><p>  : </p><br><pre> <code class="python hljs">fail = Œª() false; guess = Œª(current) { CallCC(Œª(k){ let (prevFail = fail) { fail = Œª(){ current = current + <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> current &gt; <span class="hljs-number"><span class="hljs-number">100</span></span> { fail = prevFail; fail(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { k(current); }; }; k(current); }; }); }; a = guess(<span class="hljs-number"><span class="hljs-number">1</span></span>); b = guess(a); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> a * b == <span class="hljs-number"><span class="hljs-number">84</span></span> { print(a); print(<span class="hljs-string"><span class="hljs-string">" x "</span></span>); println(b); }; fail();</code> </pre> <br><p>     ,  ,      <code>a</code> ,    <code>84</code> ,   <code>b</code> ,  <code>84 / a</code> .           <code>guess</code> : <code>start</code>  <code>end</code> ‚Äî      .   ,  . </p><br><h3 id="try-i-catch-iz-common-lisp"> <code>try</code>  <code>catch</code>  Common Lisp </h3><br><p>     ‚Äî <code>catch</code>  <code>throw</code> .     : </p><br><pre> <code class="python hljs">f1 = Œª() { throw(<span class="hljs-string"><span class="hljs-string">"foo"</span></span>, <span class="hljs-string"><span class="hljs-string">"EXIT"</span></span>); print(<span class="hljs-string"><span class="hljs-string">"not reached"</span></span>); }; println(catch(<span class="hljs-string"><span class="hljs-string">"foo"</span></span>, Œª() { f1(); print(<span class="hljs-string"><span class="hljs-string">"not reached"</span></span>); })); <span class="hljs-comment"><span class="hljs-comment">#  EXIT</span></span></code> </pre> <br><ul><li>  <code>catch(TAG, function)</code>  ,    ,  <code>TAG</code> ',   <code>function</code> . </li><li>  <code>throw(TAG, value)</code>  ,     ,  <code>TAG</code> '  ,     <code>value</code> . </li></ul><br><p>  : </p><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">##  , 'throw'   . ##       `error`, ##     JavaScript.    . throw = Œª(){ println("ERROR: No more catch handlers!"); halt(); }; catch = Œª(tag, func){ CallCC(Œª(k){ let (rethrow = throw, ret) { ##   ,     . throw = Œª(t, val) { throw = rethrow; #   ,   . if t == tag then k(val) else throw(t, val); }; ##      . ret = func(); ##       (  'throw') ##    .   . throw = rethrow; # XXX ##  . ret; }; }); };</span></span></code> </pre> <br><p>  Um exemplo: </p><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># ... f1 = Œª() { throw("foo", "EXIT"); print("not reached"); }; println(catch("foo", Œª() { f1(); print("not reached"); }));</span></span></code> </pre> <br><h2 id="temnaya-storona-sily">    </h2><br><p>    <code>catch</code> ,     ,    ,    .   ,    , ,  <code>CallCC</code>     .    ,     .    "   " ‚Äî      ‚Äî  .    ,  ,     ,  <code>catch</code> / <code>throw</code>    ,  . </p><br><p>    .   ,    <code>catch</code> . ,   <code>throw</code>   , ,  <code>catch</code>   ,     .  Por exemplo: </p><br><pre> <code class="python hljs">exit = false; <span class="hljs-comment"><span class="hljs-comment">#  . x = 0; # :   ,   'exit()'  CallCC( Œª(k) exit = k ); ## 'exit()'   ... if x == 0 then catch("foo", Œª(){ println("in catch"); x = 1; #  exit(); }); println("After catch"); throw("foo", "FOO");</span></span></code> </pre> <br><p>  Conclus√£o: </p><br><pre> <code class="plaintext hljs">After catch After catch ERROR: No more catch handlers!</code> </pre> <br><p>    'After catch' ,   'ERROR: No more catch handlers!'. -  ,   'After catch'   ,   . ,  ''  ,  <code>catch</code> . ,    'XXX'   <code>catch</code>   ,         <code>throw</code> ,   <code>catch</code>   . </p><br><p> (       ,     .) </p><br><p>     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">  CallCC</a> (, <em>   ,   CallCC</em> ).  ,    ‚Äî  <code>CallCC</code>           . </p><br><h1 id="yield"> Yield </h1><br><p> ,    ,   <code>yield</code> : </p><br><pre> <code class="python hljs">foo = <span class="hljs-keyword"><span class="hljs-keyword">with</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>(Œª(<span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>){ <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>(<span class="hljs-number"><span class="hljs-number">2</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>(<span class="hljs-number"><span class="hljs-number">3</span></span>); <span class="hljs-string"><span class="hljs-string">"DONE"</span></span>; }); println(foo()); <span class="hljs-comment"><span class="hljs-comment"># 1 println(foo()); # 2 println(foo()); # 3 println(foo()); # DONE</span></span></code> </pre> <br><p>    <code>yield</code> ,       .  ,  <code>return</code> .      ,       ,    <code>yield</code> ,       . </p><br><p>  : </p><br><pre> <code class="python hljs">fib = <span class="hljs-keyword"><span class="hljs-keyword">with</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>(Œª(<span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>){ let loop (a = <span class="hljs-number"><span class="hljs-number">1</span></span>, b = <span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>(b); loop(b, a + b); }; }); <span class="hljs-comment"><span class="hljs-comment">##   50   let loop (i = 0) { if i &lt; 50 { println(fib()); loop(i + 1); }; };</span></span></code> </pre> <br><p>  <code>fib</code>   .    .  <code>yield</code>      .     ,    ,         50  ,      50 . </p><br><p> ,      ,     , ,            . </p><br><h2 id="neudachnaya-popytka-realizacii">    </h2><br><p>          ,         . </p><br><p>   <code>yield</code> ,  ,       .   ,        ,      <code>return</code> . ,  ,    <code>yield</code> ,       <code>yield</code> ,         <em></em> .   ,   .      : </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> = Œª(func) { <span class="hljs-comment"><span class="hljs-comment">## with-yield     Œª() { CallCC(Œª(kret){ # kret     let (yield) { ##  yield yield = Œª(value) { # yield  ,    CallCC(Œª(kyld){ # kyld    yield... func = kyld; # ...     kret(value); #  . }); }; ## , ,  ,   yield. func(yield); }; }); }; };</span></span></code> </pre> <br><p>       <code>yield</code>  ,     . ,         ,     ,      "DONE". </p><br><p> ,     .   ,     - ,     ,    4   : </p><br><pre> <code class="python hljs">println(foo()); foo();</code> </pre> <br><p>    . </p><br><h3 id="problema-1-yield-nikogda-ne-izmenyaetsya">  ‚Ññ1: yield    </h3><br><p>  ,   ,  ,   ,     <code>yield</code> ( <code>kyld</code> ,    ,   )    : </p><br><pre> <code class="python hljs"> <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>(<span class="hljs-number"><span class="hljs-number">2</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>(<span class="hljs-number"><span class="hljs-number">3</span></span>); <span class="hljs-string"><span class="hljs-string">"DONE"</span></span>;</code> </pre> <br><p>    <code>yield</code>   ?     <code>yield</code> ,       ,    <code>yield</code>    . ,    .  ,     <code>yield</code>        <code>return</code> ,      : </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> = Œª(func) { let (<span class="hljs-keyword"><span class="hljs-keyword">return</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> = Œª(value) { CallCC(Œª(kyld){ func = kyld; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>(value); <span class="hljs-comment"><span class="hljs-comment"># 'return'  ,     }); #        . }; # Œª(val) { # CallCC(Œª(kret){ # return = kret; # &lt;-  func(val || yield); }); }; }; };</span></span></code> </pre> <br><p> ,  ,       <code>yield</code>  ,   <code>yield</code>       (  ).      <code>yield</code> . </p><br><p>   ,    ,    <code>println(foo())</code>   : </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> = Œª(func) { let (<span class="hljs-keyword"><span class="hljs-keyword">return</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> = Œª(value) { CallCC(Œª(kyld){ func = kyld; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>(value); }); }; Œª(val) { CallCC(Œª(kret){ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> = kret; func(val || <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>); }); }; }; }; foo = <span class="hljs-keyword"><span class="hljs-keyword">with</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>(Œª(<span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>){ <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>(<span class="hljs-number"><span class="hljs-number">2</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>(<span class="hljs-number"><span class="hljs-number">3</span></span>); <span class="hljs-string"><span class="hljs-string">"DONE"</span></span>; }); println(foo()); println(foo()); println(foo());</code> </pre> <br><p> ,    .        ,      <code>print(foo()); foo()</code> .   ,     <code>println(foo())</code> ?   ... </p><br><h3 id="problema-2-wtf">  ‚Ññ2: WTF? </h3><br><p>     .     :    ,          <code>foo()</code> .  ,     ? ‚Äî    . </p><br><pre> <code class="python hljs">println(foo()); <span class="hljs-comment"><span class="hljs-comment">## yield 1 &lt;-----------------  ---------------------------+ println(foo()); ## yield 2 | println(foo()); ## yield 3 | println(foo()); ##   "DONE",   foo()  --&gt;--+</span></span></code> </pre> <br><p>       <code>with-yield</code> : </p><br><pre> <code class="python hljs"> func(val || <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>); <span class="hljs-comment"><span class="hljs-comment">#...</span></span></code> </pre> <br><p>     <code>yield</code> ,   ,       <code>#...</code> .   ,   ,     ( <code>"DONE"</code> ),     ,   <code>"DONE"</code>   ,     . <code>foo()</code>     ,    <code>"DONE"</code>   .      : </p><br><pre> <code class="python hljs">println(foo()); println(<span class="hljs-string"><span class="hljs-string">"bar"</span></span>); println(foo()); println(foo()); foo();</code> </pre> <br><p>   : <code>1, bar, 2, 3, DONE, bar, DONE, bar, ...</code> . </p><br><p>      <code>func</code>  - ,    .   ,    <code>"no more continuations"</code> : </p><br><pre> <code class="python hljs"> val = func(val || <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>); func = Œª() <span class="hljs-string"><span class="hljs-string">"NO MORE CONTINUATIONS"</span></span>; kret(val);</code> </pre> <br><p>     : </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> = Œª(func) { let (<span class="hljs-keyword"><span class="hljs-keyword">return</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> = Œª(value) { CallCC(Œª(kyld){ func = kyld; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>(value); }); }; Œª(val) { CallCC(Œª(kret){ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> = kret; val = func(val || <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>); func = Œª() <span class="hljs-string"><span class="hljs-string">"NO MORE CONTINUATIONS"</span></span>; kret(val); }); }; }; }; foo = <span class="hljs-keyword"><span class="hljs-keyword">with</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>(Œª(<span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>){ <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>(<span class="hljs-number"><span class="hljs-number">2</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>(<span class="hljs-number"><span class="hljs-number">3</span></span>); <span class="hljs-string"><span class="hljs-string">"DONE"</span></span>; }); println(foo()); println(foo()); println(foo()); println(foo());</code> </pre> <br><p>      ,     : </p><br><pre> <code class="plaintext hljs">1 2 3 DONE NO MORE CONTINUATIONS NO MORE CONTINUATIONS NO MORE CONTINUATIONS ***Result: false</code> </pre> <br><p>    <code>1, 2, 3, DONE</code> ,      <code>"NO MORE CONTINUATIONS"</code>  .  ,       : </p><br><pre> <code class="python hljs">print(<span class="hljs-string"><span class="hljs-string">"A. "</span></span>); println(foo()); print(<span class="hljs-string"><span class="hljs-string">"B. "</span></span>); println(foo()); print(<span class="hljs-string"><span class="hljs-string">"C. "</span></span>); println(foo()); print(<span class="hljs-string"><span class="hljs-string">"D. "</span></span>); println(foo()); <span class="hljs-comment"><span class="hljs-comment">##   : A. 1 B. 2 C. 3 D. DONE B. NO MORE CONTINUATIONS C. NO MORE CONTINUATIONS D. NO MORE CONTINUATIONS ***Result: false</span></span></code> </pre> <br><p>  ,     :       , , ,      ,  <code>"B."</code>   . </p><br><p>       ,         <code>yield</code> ,     : </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> = Œª(func) { let (<span class="hljs-keyword"><span class="hljs-keyword">return</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> = Œª(value) { CallCC(Œª(kyld){ func = kyld; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>(value); }); }; Œª(val) { CallCC(Œª(kret){ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> = kret; val = func(val || <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>); func = Œª() <span class="hljs-string"><span class="hljs-string">"NO MORE CONTINUATIONS"</span></span>; kret(val); }); }; }; }; fib = <span class="hljs-keyword"><span class="hljs-keyword">with</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>(Œª(<span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>){ let loop (a = <span class="hljs-number"><span class="hljs-number">1</span></span>, b = <span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>(b); loop(b, a + b); }; }); <span class="hljs-comment"><span class="hljs-comment">##   50   let loop (i = 0) { if i &lt; 50 { println(fib()); loop(i + 1); }; };</span></span></code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Conclus√£o</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">1 2 3 5 8 13 21 34 55 89 144 233 377 610 987 1597 2584 4181 6765 10946 17711 28657 46368 75025 121393 196418 317811 514229 832040 1346269 2178309 3524578 5702887 9227465 14930352 24157817 39088169 63245986 102334155 165580141 267914296 433494437 701408733 1134903170 1836311903 2971215073 4807526976 7778742049 12586269025 20365011074 ***Result: false</code> </pre> </div></div><br><p> ,      (,       ),       " ". </p><br><h2 id="otdelennye-prodolzheniya-reset-i-shift">  : <code>reset</code>  <code>shift</code> </h2><br><p>    <code>yield</code>    : <code>reset</code>  <code>shift</code> .   " " ‚Äî ,     .  <code>reset</code>  ,   <code>shift</code>     ,   <code>CallCC</code> . </p><br><p>  , <code>reset</code>  <code>shift</code>    ‚Äî .     <code>reset</code> ,  <code>shift</code>      ,    <code>reset</code> . </p><br><p>  ,    <code>with-yield</code> : </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> = Œª(func) { let (<span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>) { <span class="hljs-comment"><span class="hljs-comment">## 'yield'  'shift'     ##  'reset'.  ,   ,    ##   'func' ‚Äî ,   `func()` ##    ,    . yield = Œª(val) { shift(Œª(k){ func = k; #    val; #    }); }; ##  `with-yield`      ##   'reset',    ,  ##   'yield' ( )    ##    Œª(val) { reset( Œª() func(val || yield) ); }; } };</span></span></code> </pre> <br><p>  ,      <code>reset</code> .  ,  ,       ,     <code>reset</code> .  ,    .     ,           . </p><br><p>     : </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> = Œª(func) { let (<span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> = Œª(val) { shift(Œª(k){ func = k; val; }); }; Œª(val) { reset( Œª() func(val || <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>) ); }; } }; foo = <span class="hljs-keyword"><span class="hljs-keyword">with</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>(Œª(<span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>){ <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>(<span class="hljs-number"><span class="hljs-number">2</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>(<span class="hljs-number"><span class="hljs-number">3</span></span>); <span class="hljs-string"><span class="hljs-string">"DONE"</span></span>; }); println(foo()); <span class="hljs-comment"><span class="hljs-comment">#  1 println(foo()); #  2 println(foo()); #  3 println(foo()); #  DONE</span></span></code> </pre> <br><h2 id="realizaciya-reset-i-shift">  <code>reset</code>  <code>shift</code> </h2><br><p>       ,      .    .     .     ,     ,        ,   .    <a href="">  Scheme</a> ( ‚Äî <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Oleg Kiselyov</a> ).   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> </a>     . </p><br><h3 id="ispolzuya-nativnye-funkcii">    </h3><br><p>      ,      (    <code>CallCC</code> )         .   : </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pstack = []; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_goto</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">f</span></span></span><span class="hljs-function">) </span></span>{ f(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">KGOTO</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">r</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> h = pstack.pop(); h(r); }); } globalEnv.def(<span class="hljs-string"><span class="hljs-string">"reset"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">KRESET, th</span></span></span><span class="hljs-function">)</span></span>{ pstack.push(KRESET); _goto(th); }); globalEnv.def(<span class="hljs-string"><span class="hljs-string">"shift"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">KSHIFT, f</span></span></span><span class="hljs-function">)</span></span>{ _goto(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">KGOTO</span></span></span><span class="hljs-function">)</span></span>{ f(KGOTO, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SK</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">k1, v</span></span></span><span class="hljs-function">)</span></span>{ pstack.push(k1); KSHIFT(v); }); }); });</code> </pre> <br><p>   ,   <code>reset</code> ,   <code>shift</code>  <code>_goto</code> ,  ‚Äî  .     .  <code>_goto</code>         ( <code>KGOTO</code> ).  ,       <code>f</code> (  <code>CallCC</code> )    -      <code>KGOTO</code> ,     .  ,  <code>f</code> ,   ,    <code>KGOTO</code> ,      ,     . </p><br><p>  <code>reset</code>      ( <code>KRESET</code> )     <code>_goto(th)</code> .      ,    , ,      <code>_goto</code> . ,     , <code>KGOTO</code>   <code>KRESET</code> . </p><br><p>   , <code>shift</code>     <code>KGOTO</code>     ,  <code>KGOTO</code>    <code>pstack</code> ,      <code>SK</code> ,     ,   <code>shift</code>   (   <code>shift</code> ‚Äî <code>KSHIFT</code> ).  <code>SK</code> ‚Äî   ‚Äî              ( <code>k1</code> )   .   ,     <code>shift2</code> ,    ,    <code>pstack.push(k1);</code> : </p><br><pre> <code class="python hljs">println(reset(Œª(){ <span class="hljs-number"><span class="hljs-number">1</span></span> + shift( Œª(k) k(k(<span class="hljs-number"><span class="hljs-number">2</span></span>)) ); })); println(reset(Œª(){ <span class="hljs-number"><span class="hljs-number">1</span></span> + shift2( Œª(k) k(k(<span class="hljs-number"><span class="hljs-number">2</span></span>)) ); }));</code> </pre> <br><p>  Conclus√£o: </p><br><pre> <code class="plaintext hljs">4 3 ***Result: false</code> </pre> <br><p>  <code>shift</code>    ( <code>k</code> ),       <code>reset</code> .     ‚Äî  1   <code>shift</code> : </p><br><pre> <code class="python hljs"><span class="hljs-number"><span class="hljs-number">1</span></span> + [?]</code> </pre> <br><p>    <code>k</code> ,   <code>?</code> .     ‚Äî <code>k(k(2))</code> .   2   ,   <code>k(2)</code>  3. ,  <code>k(3)</code>  3     ,     4. </p><br><p> <code>shift2</code>  :  k(2)    . </p><br><h3 id="ispolzuya-callcc">  <code>CallCC</code> </h3><br><p>   ,       ,     <code>CallCC</code> ,    .     ,     JS, ,      ,       .    ,    <code>CallCC</code> ,    . </p><br><p>      ‚Äî    <code>goto</code> ,       (    ): </p><br><pre> <code class="plaintext hljs">pstack = NIL; goto = false; reset = Œª(th) { CallCC(Œª(k){ pstack = cons(k, pstack); goto(th); }); }; shift = Œª(f) { CallCC(Œª(k){ goto(Œª(){ f(Œª(v){ CallCC(Œª(k1){ pstack = cons(k1, pstack); k(v); }); }); }); }); }; let (v = CallCC( Œª(k){ goto = k; k(false) } )) { if v then let (r = v(), h = car(pstack)) { pstack = cdr(pstack); h(r); } };</code> </pre> <br><p>          ‚Äî        ! </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt444024/">https://habr.com/ru/post/pt444024/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt444014/index.html">Microsoft abre escola de neg√≥cios para aprender estrat√©gias, cultura e responsabilidade de IA</a></li>
<li><a href="../pt444016/index.html">Obtenha mais com o Microsoft Game Stack</a></li>
<li><a href="../pt444018/index.html">Como uma altera√ß√£o na configura√ß√£o do PostgreSQL melhora o desempenho lento da consulta 50 vezes</a></li>
<li><a href="../pt444020/index.html">Kart na URSS: como o hobby dos pilotos americanos se tornou um enorme hobby de bricolage na Uni√£o Sovi√©tica</a></li>
<li><a href="../pt444022/index.html">Beego n√£o √© mais Go</a></li>
<li><a href="../pt444026/index.html">MODX Digest # 1.1 (25 de fevereiro a 11 de mar√ßo de 2019)</a></li>
<li><a href="../pt444028/index.html">Apresentando o Microsoft Game Stack</a></li>
<li><a href="../pt444030/index.html">A varejista on-line chinesa Gearbest deixou em aberto um banco de dados com milh√µes de dados pessoais de clientes</a></li>
<li><a href="../pt444032/index.html">Por que uma impressora 3D n√£o √© uma impressora</a></li>
<li><a href="../pt444034/index.html">7 pecados capitais de um gerente</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>