<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>游뚺 游 游냕 ADSM3. Sistemas IPAM / DCIM 游댥 游낻 游똁游낕</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En la serie ADSM anterior, desarrollamos el marco de automatizaci칩n, descubrimos por qu칠 apareci칩 la virtualizaci칩n y c칩mo funciona. En la 칰ltima part...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ADSM3. Sistemas IPAM / DCIM</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/486000/"> En la serie ADSM anterior, desarrollamos el marco de automatizaci칩n, descubrimos por qu칠 apareci칩 la virtualizaci칩n y c칩mo funciona.  En la <a href="https://linkmeup.ru/blog/479.html" rel="nofollow">칰ltima parte,</a> seleccionamos y justificamos el dise침o de la red, los roles de los dispositivos, los fabricantes, decidimos sobre LLD (direccionamiento, enrutamiento, n칰meros de sistemas aut칩nomos). <br><br>  Ahora estamos listos para pensar en c칩mo almacenar toda esta monta침a de informaci칩n y recuperarla convenientemente en el futuro. <br><br>  No, por supuesto, hoy hay empresas que realizan un seguimiento de las direcciones IP asignadas en una hoja de c치lculo de Excel.  Pero este no es nuestro camino. <br><br>  Incluso para la oficina de menor tama침o en un par de sucursales, la presencia de un sistema de gesti칩n de espacio IP centralizado no afectar치. <br><br>  La necesidad de un sistema de inventario es obvia sin una palabra. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b44/a21/5cc/b44a215cc7c93ecf6eeca48c41d721d9.svg" width="800"><br><br>  Todos los problemas de ADSM: <br><br>  <a href="https://habr.com/ru/post/453516/">0. ADSM.</a>  <a href="https://habr.com/ru/post/453516/">Parte Cero.</a>  <a href="https://habr.com/ru/post/453516/">Planificacion</a> <br>  <a href="https://habr.com/ru/post/458622/">1. ADSM.</a>  <a href="https://habr.com/ru/post/458622/">Primera parte (que es despu칠s de cero).</a>  <a href="https://habr.com/ru/post/458622/">Virtualizaci칩n de red</a> <br>  <a href="https://habr.com/ru/post/475614/">2. ADSM.</a>  <a href="https://habr.com/ru/post/475614/">Segunda parte</a>  <a href="https://habr.com/ru/post/475614/">Dise침o de red</a> <br>  <a href="https://habr.com/ru/post/485618/">3. ADSM.</a>  <a href="https://habr.com/ru/post/485618/">Tercera parte</a>  <a href="https://habr.com/ru/post/485618/">Sistema IPAM / DCIM</a> <br><br>  Este tema lo dedicar칠 a los sistemas integrales en la automatizaci칩n de redes: el sistema de gesti칩n del espacio de direcciones y el sistema de inventario. <br><br>  Lo seleccionaremos e instalaremos, nos ocuparemos de la arquitectura, el esquema de la base de datos, las interfaces de interacci칩n y lo rellenaremos.  Y en las siguientes partes, comenzaremos a escribir scripts simples que automatizan las operaciones repetitivas, como agregar nuevos bastidores. <br><br>  Adem치s, ya publiqu칠 un art칤culo separado sobre la <a href="https://habr.com/ru/post/485618/">API RESTful</a> , en el que ofrec칤 una breve descripci칩n de sus principios y trabajo, lo necesitaremos. <br><a name="habracut"></a><br><h1>  Contenido </h1><br><ul><li>  <b>Arquitectura del sistema</b> </li><li>  <b>Esquema de datos de NetBox</b> </li><li>  <b>Conclusi칩n</b> </li><li>  <b>Algunos matices de la instalaci칩n de NetBox</b> </li><li>  <b>Un poco sobre PostgreSQL</b> </li><li>  <b>Enlaces utiles</b> </li></ul><br>  Hoy, el mercado ofrece alrededor de una docena de herramientas que implementan esta tarea: tanto de pago como de c칩digo abierto. <br><br>  Para las tareas en esta serie de art칤culos, eleg칤 NetBox por las siguientes razones: <br><br><ol><li>  Es gratis </li><li>  Contiene las dos partes necesarias: inventario y gesti칩n del espacio IP. </li><li>  Tiene una API RESTful. </li><li>  Fue desarrollado por Digital Ocean (y m치s espec칤ficamente, querido por todos Jeremy Stretch) para s칤 mismo, es decir, para centros de datos.  Por lo tanto, hay casi todo lo que necesita, y casi nada m치s. </li><li>  Es activamente compatible (Slack, Github, Google Newsletters) y se est치 actualizando. </li><li>  Esto es de c칩digo abierto </li></ol><br><blockquote>  Para las necesidades de ADSM, implement칠 NetBox en un virtualochka en nuestro servidor (gracias a Anton Klochkov y <a href="https://miran.ru/" rel="nofollow">Miran</a> ): <a href="http://netbox.linkmeup.ru:45127/" rel="nofollow">http://netbox.linkmeup.ru:45127</a> <br>  Adem치s, complet칠 casi todos los datos que necesitamos en el futuro. <br>  Por lo tanto, puede probar casi todos los ejemplos y estudiar el esquema de datos en modo de lectura hasta que implemente su instalaci칩n. <br></blockquote>  Un poco 칰til antes de comenzar: <br><br><ul><li>  <a href="https://github.com/netbox-community/netbox" rel="nofollow">NetBox en s칤 mismo en github</a> </li><li>  <a href="https://github.com/netbox-community/netbox-docker" rel="nofollow">Versi칩n contenedor</a> </li><li>  <a href="https://netbox.readthedocs.io/en/stable/" rel="nofollow">Instrucciones completas de instalaci칩n y toda la documentaci칩n del producto.</a> </li><li>  <a href="https://github.com/digitalocean/pynetbox" rel="nofollow">Python NetKox SDK</a> </li><li>  <a href="http://netbox.linkmeup.ru:45127/api/docs/" rel="nofollow">Documentaci칩n API</a> </li><li>  <a href="https://groups.google.com/forum/" rel="nofollow">Lista de correo</a> </li><li>  <a href="https://networktocode.slack.com/" rel="nofollow">NetworkToCode Slack Channel</a> </li><li>  <a href="https://habr.com/ru/post/485618/">쯈u칠 es REST?</a> </li><li>  <a href="http://netbox.linkmeup.ru:45127/" rel="nofollow">Instalaci칩n de NetBox para ADSM</a> </li></ul><br><hr><br><h1>  Arquitectura del sistema </h1><br><ul><li>  NetBox est치 escrito en Python3.  Lo cual es bueno, porque varias otras soluciones est치n escritas en php y cambiarlas si es necesario no es tan simple. </li><li>  El marco para el sitio en s칤 es Django. </li><li>  PostgreSQL se usa como la base de datos. </li><li>  WEB-frontend (servicio HTTP) - NGINX - env칤a solicitudes a Gunicron. </li><li>  WSGI - Gunicorn: la interfaz entre Nginx y la aplicaci칩n misma. </li><li>  Marco de documentaci칩n de API - Swagger. </li><li>  Para demonizar NetBox - Systemd. </li></ul><br><blockquote>  NetBox es un proyecto joven y acelerado.  Por ejemplo, en 2.7 abandonaron la supervisi칩n y Python 2.7 busc칩 en favor de systemd.  No hace mucho tiempo, no hab칤a almacenamiento en cach칠 o Webhooks. <br><br>  Por lo tanto, todo cambia r치pidamente y la informaci칩n del art칤culo puede quedar desactualizada en el momento de la lectura. <br></blockquote><br>  En otras palabras, todos los componentes son maduros y probados. <br><br>  Seg칰n el autor, NetBox no refleja el estado real de la red, sino el objetivo.  Por lo tanto, no se carga nada en la NetBox desde la red; esta red se configura de acuerdo con el contenido de la NetBox. <br>  Por lo tanto, NetBox act칰a como la 칰nica fuente de verdad (papel de calco con una sola fuente de verdad). <br><br>  Y los cambios en la red deben ser activados por cambios en NetBox. <br><br>  Y encaja muy bien con la ideolog칤a que profeso en esta serie de art칤culos, si desea realizar cambios en la red, primero debe hacerlos en el sistema. <br><br><hr><br><h1>  Esquema de datos de NetBox </h1><br>  Las dos tareas principales que resuelve NetBox son la gesti칩n del espacio de direcciones y el inventario. <br><br>  Es poco probable que NetBox se convierta en el 칰nico sistema de inventario en la compa침칤a; m치s bien, ser치 un sistema adicional espec칤fico para inventariar la red, tomando datos del principal. <br><br>  Obviamente, en nuestro caso, solo habr치 NetBox para fines ADSM. <br><blockquote>  En este punto, la mayor칤a de los datos iniciales en NetBox ya se han ingresado. <br>  Con estos datos, demostrar칠 varios ejemplos de trabajo a trav칠s de la API. <br>  Simplemente puedes subir y ver: <a href="http://netbox.linkmeup.ru/" rel="nofollow">netbox.linkmeup.ru</a> : 45127 <br>  Y se necesitar치n los mismos datos en el futuro, cuando pasemos a la automatizaci칩n. <br></blockquote>  En t칠rminos generales, el esquema de la base de datos en Postgres puede ver el esquema de datos. <br><br><pre><code class="bash hljs">List of relations Schema | Name | Type | Owner --------+------------------------------------+-------+-------- public | auth_group | table | netbox public | auth_group_permissions | table | netbox public | auth_permission | table | netbox public | auth_user | table | netbox public | auth_user_groups | table | netbox public | auth_user_user_permissions | table | netbox public | circuits_circuit | table | netbox public | circuits_circuittermination | table | netbox public | circuits_circuittype | table | netbox public | circuits_provider | table | netbox public | dcim_cable | table | netbox public | dcim_consoleport | table | netbox public | dcim_consoleporttemplate | table | netbox public | dcim_consoleserverport | table | netbox public | dcim_consoleserverporttemplate | table | netbox public | dcim_device | table | netbox public | dcim_devicebay | table | netbox public | dcim_devicebaytemplate | table | netbox public | dcim_devicerole | table | netbox public | dcim_devicetype | table | netbox public | dcim_frontport | table | netbox public | dcim_frontporttemplate | table | netbox public | dcim_interface | table | netbox public | dcim_interface_tagged_vlans | table | netbox public | dcim_interfacetemplate | table | netbox public | dcim_inventoryitem | table | netbox public | dcim_manufacturer | table | netbox public | dcim_platform | table | netbox public | dcim_powerfeed | table | netbox public | dcim_poweroutlet | table | netbox public | dcim_poweroutlettemplate | table | netbox public | dcim_powerpanel | table | netbox public | dcim_powerport | table | netbox public | dcim_powerporttemplate | table | netbox public | dcim_rack | table | netbox public | dcim_rackgroup | table | netbox public | dcim_rackreservation | table | netbox public | dcim_rackrole | table | netbox public | dcim_rearport | table | netbox public | dcim_rearporttemplate | table | netbox public | dcim_region | table | netbox public | dcim_site | table | netbox public | dcim_virtualchassis | table | netbox public | django_admin_log | table | netbox public | django_content_type | table | netbox public | django_migrations | table | netbox public | django_session | table | netbox public | extras_configcontext | table | netbox public | extras_configcontext_platforms | table | netbox public | extras_configcontext_regions | table | netbox public | extras_configcontext_roles | table | netbox public | extras_configcontext_sites | table | netbox public | extras_configcontext_tags | table | netbox public | extras_configcontext_tenant_groups | table | netbox public | extras_configcontext_tenants | table | netbox public | extras_customfield | table | netbox public | extras_customfield_obj_type | table | netbox public | extras_customfieldchoice | table | netbox public | extras_customfieldvalue | table | netbox public | extras_customlink | table | netbox public | extras_exporttemplate | table | netbox public | extras_graph | table | netbox public | extras_imageattachment | table | netbox public | extras_objectchange | table | netbox public | extras_reportresult | table | netbox public | extras_tag | table | netbox public | extras_taggeditem | table | netbox public | extras_webhook | table | netbox public | extras_webhook_obj_type | table | netbox public | ipam_aggregate | table | netbox public | ipam_ipaddress | table | netbox public | ipam_prefix | table | netbox public | ipam_rir | table | netbox public | ipam_role | table | netbox public | ipam_service | table | netbox public | ipam_service_ipaddresses | table | netbox public | ipam_vlan | table | netbox public | ipam_vlangroup | table | netbox public | ipam_vrf | table | netbox public | secrets_secret | table | netbox public | secrets_secretrole | table | netbox public | secrets_secretrole_groups | table | netbox public | secrets_secretrole_users | table | netbox public | secrets_sessionkey | table | netbox public | secrets_userkey | table | netbox public | taggit_tag | table | netbox public | taggit_taggeditem | table | netbox public | tenancy_tenant | table | netbox public | tenancy_tenantgroup | table | netbox public | users_token | table | netbox public | virtualization_cluster | table | netbox public | virtualization_clustergroup | table | netbox public | virtualization_clustertype | table | netbox public | virtualization_virtualmachine | table | netbox</code> </pre> <br>  <a href="https://netbox.readthedocs.io/en/stable/" rel="nofollow">Funciones de NetBox</a> : <br><br><ul><li>  <b>Administraci칩n de direcciones IP (IPAM)</b> : prefijos IP, direcciones, VRF y VLAN </li><li>  <b>Bastidores de equipos: bastidores de equipos</b> organizados por sitio, grupo y rol </li><li>  <b>Dispositivos</b> : dispositivos, sus modelos, roles, componentes e implementaci칩n </li><li>  <b>Conexiones</b> : <b>conexiones de</b> red, consola y alimentaci칩n entre dispositivos </li><li>  <b>Virtualizaci칩n</b> : m치quinas virtuales y cl칰steres inform치ticos </li><li>  <b>Circuitos de datos</b> - Conexiones de proveedor </li><li>  <b>Secretos</b> : almacenamiento de credenciales de usuario cifrado </li></ul><br>  En este art칤culo tocar칠 las siguientes cosas: DCIM - Administraci칩n de Infraestructura del Centro de Datos, IPAM - Administraci칩n de Direcci칩n IP, Virtualizaci칩n, Cosas buenas adicionales. <br><br><hr><br>  Lo primero es lo primero. <br><br><h2>  DCIM </h2><br>  La parte m치s importante es, sin duda, qu칠 equipo tenemos y c칩mo est치 conectado entre s칤.  Pero todo comienza <b>donde</b> est치 parado. <br><br><h3>  Regiones y sitios (regiones / sitios) </h3><br>  En el paradigma de NetBox, un dispositivo se instala en un sitio, un sitio pertenece a una regi칩n, las regiones se pueden anidar.  Sin embargo, el dispositivo no se puede instalar simplemente en la regi칩n.  Si existe tal necesidad, se debe establecer un sitio separado. <br><br>  Para nuestro caso, esto puede (y se ver치) as칤: <br><br><ul><li>  <a href="http://netbox.linkmeup.ru:45127/dcim/sites/%3Fregion%3Dru" rel="nofollow">Rusia</a> : <a href="http://netbox.linkmeup.ru:45127/dcim/sites/msk/" rel="nofollow">Mosc칰</a> , <a href="http://netbox.linkmeup.ru:45127/dcim/sites/kzn/" rel="nofollow">Kaz치n</a> </li><li>  <a href="http://netbox.linkmeup.ru:45127/dcim/sites/%3Fregion%3Dsp" rel="nofollow">Espa침a</a> : <a href="http://netbox.linkmeup.ru:45127/dcim/sites/bcn/" rel="nofollow">Barcelona</a> , <a href="http://netbox.linkmeup.ru:45127/dcim/sites/mlg/" rel="nofollow">M치laga.</a> </li><li>  <a href="http://netbox.linkmeup.ru:45127/dcim/sites/%3Fregion%3Dcn" rel="nofollow">China</a> : <a href="http://netbox.linkmeup.ru:45127/dcim/sites/sha/" rel="nofollow">Shangai</a> , <a href="http://netbox.linkmeup.ru:45127/dcim/sites/Sia/" rel="nofollow">Xi'an</a> . </li></ul><br><img src="https://habrastorage.org/getpro/habr/post_images/703/ab7/358/703ab73587ab4d1fe9079aa548ba93d1.png" width="800"><br><br>  Les recuerdo d칩nde y c칩mo planeamos nuestra red: <a href="https://linkmeup.ru/blog/479.html" rel="nofollow">ADSM2.</a>  <a href="https://linkmeup.ru/blog/479.html" rel="nofollow">Dise침o de red</a> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1df/012/888/1df0128888e0708959f6108e176a0de9.png" width="700"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/d5d/b34/709/d5db34709814c8e1fe07f74b8c9f96fd.png" width="800"><br><br>  Veamos qu칠 permite la API. <br><br>  Aqu칤 hay una lista de todas las regiones: <br><br><pre> <code class="bash hljs">curl -X GET <span class="hljs-string"><span class="hljs-string">"http://netbox.linkmeup.ru:45127/api/dcim/regions/"</span></span> -H <span class="hljs-string"><span class="hljs-string">"Accept: application/json; indent=4"</span></span></code> </pre> <br><pre> <code class="python hljs">nb.dcim.regions.all()</code> </pre> <br><blockquote>  A continuaci칩n dar칠 ejemplos de curl y pynetbox sin generar el resultado. <br>  <b>No olvides la</b> barra diagonal al final de la URL; sin ella, no funcionar치. <br>  Habl칠 sobre c칩mo usar pynetbox en un art칤culo sobre la <a href="https://habr.com/ru/post/485618/">API RESTful</a> . <br></blockquote>  Obtenga la lista de sitios: <br><br><pre> <code class="bash hljs">curl -X GET <span class="hljs-string"><span class="hljs-string">"http://netbox.linkmeup.ru:45127/api/dcim/sites/"</span></span> -H <span class="hljs-string"><span class="hljs-string">"Accept: application/json; indent=4"</span></span></code> </pre> <br><pre> <code class="python hljs">nb.dcim.sites.all()</code> </pre><br>  Lista de sitios en una regi칩n espec칤fica: <br><br><pre> <code class="bash hljs">curl -X GET <span class="hljs-string"><span class="hljs-string">"http://netbox.linkmeup.ru:45127/api/dcim/sites/?region=ru"</span></span> -H <span class="hljs-string"><span class="hljs-string">"Accept: application/json; indent=4"</span></span></code> </pre> <br><pre> <code class="python hljs">nb.dcim.sites.filter(region=<span class="hljs-string"><span class="hljs-string">"ru"</span></span>)</code> </pre><br><blockquote>  Tenga en cuenta que la b칰squeda no es por nombre completo, sino por la llamada <a href="https://qna.habr.com/q/375615" rel="nofollow">babosa</a> . <br>  <b>Slug</b> es un identificador que contiene solo caracteres seguros: [0-9A-Za-z-_], que se pueden usar en la URL.  Se establece al crear un objeto, por ejemplo, "bcn" en lugar de "Barcelona". <br><img src="https://habrastorage.org/getpro/habr/post_images/3db/6cc/f89/3db6ccf89097c571900457aebbc922fe.png" width="400"><br></blockquote><br><hr><br><h3>  Dispositivos </h3><br>  El dispositivo en s칤 tiene un <a href="http://netbox.linkmeup.ru:45127/dcim/device-roles/" rel="nofollow">papel</a> , por ejemplo, hoja, columna vertebral, borde, borde. <br><br>  Obviamente, es alg칰n tipo de <a href="http://netbox.linkmeup.ru:45127/dcim/device-types/" rel="nofollow">modelo de</a> alg칰n <a href="http://netbox.linkmeup.ru:45127/dcim/manufacturers/" rel="nofollow">proveedor</a> . <br>  Por ejemplo, <a href="http://netbox.linkmeup.ru:45127/dcim/device-types/%3Fmanufacturer%3Darista" rel="nofollow">Arista</a> . <br><br>  Por lo tanto, primero se crea un proveedor, luego dentro del modelo. <br><br>  <a href="http://netbox.linkmeup.ru:45127/dcim/device-types/2/" rel="nofollow">El modelo se</a> caracteriza por un nombre, un conjunto de interfaces de servicio, una interfaz de control remoto, un puerto de consola y un conjunto de m칩dulos de alimentaci칩n. <br><br>  Adem치s de conmutadores, enrutadores y hosts con interfaces Ethernet, puede crear servidores de consola. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/826/9a4/f9f/8269a4f9ffb7f7e66096eff89dc19013.png" width="800"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/c81/cce/0f9/c81cce0f9d543eedd4f7c1e1ede5f43f.png" width="500"><br><br>  Obtenga una lista de todos los dispositivos: <br><br><pre> <code class="bash hljs">curl -X GET <span class="hljs-string"><span class="hljs-string">"http://netbox.linkmeup.ru:45127/api/dcim/devices/"</span></span> -H <span class="hljs-string"><span class="hljs-string">"Accept: application/json; indent=4"</span></span></code> </pre> <br><pre> <code class="python hljs">nb.dcim.devices.all()</code> </pre><br>  Todos los dispositivos para un sitio en particular: <br><br><pre> <code class="bash hljs">curl -X GET <span class="hljs-string"><span class="hljs-string">"http://netbox.linkmeup.ru:45127/api/dcim/devices/?site=mlg"</span></span> -H <span class="hljs-string"><span class="hljs-string">"Accept: application/json; indent=4"</span></span></code> </pre> <br><pre> <code class="python hljs">nb.dcim.devices.filter(site=<span class="hljs-string"><span class="hljs-string">"mlg"</span></span>)</code> </pre><br>  Todos los dispositivos de cierto modelo. <br><br><pre> <code class="bash hljs">curl -X GET <span class="hljs-string"><span class="hljs-string">"http://netbox.linkmeup.ru:45127/api/dcim/devices/?model=veos"</span></span> -H <span class="hljs-string"><span class="hljs-string">"Accept: application/json; indent=4"</span></span></code> </pre> <br><pre> <code class="python hljs">nb.dcim.devices.filter(device_type_id=<span class="hljs-number"><span class="hljs-number">2</span></span>)</code> </pre><br>  Todos los dispositivos con un rol espec칤fico: <br><br><pre> <code class="bash hljs">curl -X GET <span class="hljs-string"><span class="hljs-string">"http://netbox.linkmeup.ru:45127/api/dcim/devices/?role=leaf"</span></span> -H <span class="hljs-string"><span class="hljs-string">"Accept: application/json; indent=4"</span></span></code> </pre> <br><pre> <code class="python hljs">nb.dcim.devices.filter(role=<span class="hljs-string"><span class="hljs-string">"leaf"</span></span>)</code> </pre><br>  El dispositivo puede estar en diferentes estados: activo, sin conexi칩n, planificado, etc. <br><br>  Todos los dispositivos activos: <br><br><pre> <code class="bash hljs">curl -X GET <span class="hljs-string"><span class="hljs-string">"http://netbox.linkmeup.ru:45127/api/dcim/devices/?status=active"</span></span> -H <span class="hljs-string"><span class="hljs-string">"Accept: application/json; indent=4"</span></span></code> </pre> <br><pre> <code class="python hljs">nb.dcim.devices.filter(status=<span class="hljs-string"><span class="hljs-string">"active"</span></span>)</code> </pre><br><hr><br><h3>  Interfaces </h3><br>  NetBox admite muchos tipos de <a href="http://netbox.linkmeup.ru:45127/api/dcim/_choices/" rel="nofollow">interfaces</a> f칤sicas y LAG, sin embargo, todos los virtuales, como Vlan / IRB y loopback, se combinan en un solo tipo: virtual. <br>  Cada interfaz est치 vinculada a un dispositivo. <br><br>  Las interfaces del dispositivo se pueden conectar entre s칤.  Esto se mostrar치 tanto en la interfaz como en las respuestas de la API (atributo connected_endpoint). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/aea/c56/b47/aeac56b47e58145211f5726c8e48cb91.png" width="800"><br><br>  La interfaz puede estar en varios modos: Etiquetado o Acceso. <br><br>  En consecuencia, se puede iniciar en la etiqueta con o sin VLAN, este sitio o global. <br><br>  Obtenga una lista de todas las interfaces de dispositivo: <br><br><pre> <code class="bash hljs">curl -X GET <span class="hljs-string"><span class="hljs-string">"http://netbox.linkmeup.ru:45127/api/dcim/interfaces/?device=mlg-leaf-0"</span></span> -H <span class="hljs-string"><span class="hljs-string">"Accept: application/json; indent=4"</span></span></code> </pre> <br><pre> <code class="python hljs">nb.dcim.interfaces.filter(device=<span class="hljs-string"><span class="hljs-string">"mlg-leaf-0"</span></span>)</code> </pre><br>  Obtenga una lista de VLAN de una interfaz espec칤fica. <br><br><pre> <code class="bash hljs">curl -X GET <span class="hljs-string"><span class="hljs-string">"http://netbox.linkmeup.ru:45127/api/dcim/interfaces/?device=mlg-leaf-0&amp;name=Ethernet7"</span></span> -H <span class="hljs-string"><span class="hljs-string">"Accept: application/json; indent=4"</span></span></code> </pre> <br><pre> <code class="python hljs">nb.dcim.interfaces.get(device=<span class="hljs-string"><span class="hljs-string">"mlg-leaf-0"</span></span>, name=<span class="hljs-string"><span class="hljs-string">"Ethernet7"</span></span>).untagged_vlan.vid</code> </pre><br><blockquote>  Tenga en cuenta que aqu칤 ya uso el m칠todo <b>get en</b> lugar del <b>filtro</b> .  El filtro devuelve una lista, incluso si el resultado es un solo objeto.  Obtener: devuelve un solo objeto o falla si el resultado de la consulta es una lista de objetos. <br><br>  Por lo tanto, get debe usarse solo cuando est칠 absolutamente seguro de que el resultado estar치 en una sola copia. <br><br>  Aqu칤, justo despu칠s de la solicitud, me dirijo a los atributos del objeto.  Estrictamente hablando, esto est치 mal: si la solicitud no encontr칩 nada, entonces pynetbox devolver치 None y no tiene el atributo "untagged_vlan". <br><br>  Y tambi칠n tenga en cuenta que no en todas partes pynetbox espera babosa, en alg칰n lugar y nombre. <br></blockquote>  Averig칲e a qu칠 interfaz de qu칠 dispositivo est치 conectada una interfaz particular: <br><br><pre> <code class="bash hljs">curl -X GET <span class="hljs-string"><span class="hljs-string">"http://netbox.linkmeup.ru:45127/api/dcim/interfaces/?device=mlg-leaf-0&amp;name=Ethernet1"</span></span> -H <span class="hljs-string"><span class="hljs-string">"Accept: application/json; indent=4"</span></span></code> </pre> <br><pre> <code class="python hljs">iface = nb.dcim.interfaces.get(device=<span class="hljs-string"><span class="hljs-string">"mlg-leaf-0"</span></span>, name=<span class="hljs-string"><span class="hljs-string">"Ethernet1"</span></span>) iface.connected_endpoint.device iface.connected_endpoint.name</code> </pre><br>  Descubra el nombre de la interfaz de administraci칩n: <br><br><pre> <code class="bash hljs">curl -X GET <span class="hljs-string"><span class="hljs-string">"http://netbox.linkmeup.ru:45127/api/dcim/interfaces/?device=mlg-leaf-0&amp;mgmt_only=true"</span></span> -H <span class="hljs-string"><span class="hljs-string">"Accept: application/json; indent=4"</span></span></code> </pre> <br><pre> <code class="python hljs">nb.dcim.interfaces.get(device=<span class="hljs-string"><span class="hljs-string">"mlg-leaf-0"</span></span>, mgmt_only=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>)</code> </pre><br><hr><br><h3>  Puertos de consola </h3><br>  Los puertos de la consola no son interfaces, por lo tanto, se representan como puntos finales separados. <br>  Los puertos del dispositivo se pueden asociar con los puertos del servidor de consola. <br><br>  Averig칲e a qu칠 puerto en qu칠 servidor de consola est치 conectado un dispositivo espec칤fico. <br><br><pre> <code class="bash hljs">curl -X GET <span class="hljs-string"><span class="hljs-string">"http://netbox.linkmeup.ru:45127/api/dcim/console-ports/?device=mlg-leaf-0"</span></span> -H <span class="hljs-string"><span class="hljs-string">"Accept: application/json; indent=4"</span></span></code> </pre> <br><pre> <code class="python hljs">nb.dcim.console_ports.get(device=<span class="hljs-string"><span class="hljs-string">"mlg-leaf-0"</span></span>).serialize()</code> </pre><br><blockquote>  El m칠todo de <b>serializaci칩n</b> en pynetbox le permite convertir los atributos de una instancia de una clase en un diccionario. <br></blockquote><hr><br><h2>  Ipam </h2><br><h3>  VLAN y VRF </h3><br>  Se pueden vincular a una ubicaci칩n, 칰til para VLAN. <br><br>  Al crear un VRF, puede especificar si se permite que el espacio de direcciones se cruce con otros VRF. <br><br>  Obtenga una lista de todas las VLAN: <br><br><pre> <code class="bash hljs">curl -X GET <span class="hljs-string"><span class="hljs-string">"http://netbox.linkmeup.ru:45127/api/ipam/vlans/"</span></span> -H <span class="hljs-string"><span class="hljs-string">"Accept: application/json; indent=4"</span></span></code> </pre> <br><pre> <code class="python hljs">nb.ipam.vlans.all()</code> </pre><br>  Obtenga una lista de todos los VRF: <br><br><pre> <code class="bash hljs">curl -X GET <span class="hljs-string"><span class="hljs-string">"http://netbox.linkmeup.ru:45127/api/ipam/vrfs/"</span></span> -H <span class="hljs-string"><span class="hljs-string">"Accept: application/json; indent=4"</span></span></code> </pre> <br><pre> <code class="python hljs">nb.ipam.vrfs.all()</code> </pre><br><hr><br><h3>  Prefijos IP </h3><br>  Tienen una estructura jer치rquica.  Puede pertenecer a cualquier VRF (si no lo hace, entonces Global). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/94b/ea6/8c4/94bea68c425c9a8bd601c9a0da74193e.png" width="800"><br><br>  NetBox tiene una representaci칩n visual muy conveniente de prefijos gratuitos: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1be/90e/14d/1be90e14da8f4c3bedc4bcb892cb5156.png" width="800"><br><br>  Puede seleccionarlo simplemente haciendo clic en la l칤nea verde. <br><br>  Se puede adjuntar a una ubicaci칩n.  Puede seleccionar el siguiente sub-prefijo gratuito del tama침o requerido o la siguiente direcci칩n IP libre a trav칠s de la API. <br><br>  La marca de verificaci칩n / par치metro "Es un grupo" determina si la direcci칩n 0 de este prefijo se resaltar치 durante la selecci칩n autom치tica, o si comenzar치 desde el 1er. <br><br>  Obtenga una lista de prefijos IP del sitio de M치laga con el rol Underlay y una longitud de 19: <br><br><pre> <code class="bash hljs">curl -X GET <span class="hljs-string"><span class="hljs-string">"http://netbox.linkmeup.ru:45127/api/ipam/prefixes/?site=mlg&amp;role=underlay&amp;mask_length=19"</span></span> -H <span class="hljs-string"><span class="hljs-string">"Accept: application/json; indent=4"</span></span></code> </pre> <br><pre> <code class="python hljs">prefix = nb.ipam.prefixes.get(site=<span class="hljs-string"><span class="hljs-string">"mlg"</span></span>, role=<span class="hljs-string"><span class="hljs-string">"underlay"</span></span>, mask_length=<span class="hljs-string"><span class="hljs-string">"19"</span></span>)</code> </pre><br>  Obtenga una lista de prefijos gratuitos en la regi칩n de Rusia con el rol Underlay: <br><br><pre> <code class="bash hljs">curl -X GET <span class="hljs-string"><span class="hljs-string">"http://netbox.linkmeup.ru:45127/api/ipam/prefixes/40/available-prefixes/"</span></span> -H <span class="hljs-string"><span class="hljs-string">"Accept: application/json; indent=4"</span></span></code> </pre> <br><pre> <code class="bash hljs">prefix.available_prefixes.list()</code> </pre> <br>  Resalte el siguiente prefijo gratuito 24: <br><br><pre> <code class="bash hljs">curl -X POST <span class="hljs-string"><span class="hljs-string">"http://netbox.linkmeup.ru:45127/api/ipam/prefixes/40/available-prefixes/"</span></span> \ -H <span class="hljs-string"><span class="hljs-string">"accept: application/json"</span></span> \ -H <span class="hljs-string"><span class="hljs-string">"Content-Type: application/json"</span></span> \ -H <span class="hljs-string"><span class="hljs-string">"Authorization: TOKEN a9aae70d65c928a554f9a038b9d4703a1583594f"</span></span> \ -d <span class="hljs-string"><span class="hljs-string">"{\"prefix_length\": 24}"</span></span></code> </pre> <br><pre> <code class="bash hljs">prefix.available_prefixes.create({<span class="hljs-string"><span class="hljs-string">"prefix_length"</span></span>:24})</code> </pre> <br><blockquote>  Cuando necesitamos seleccionar alg칰n ni침o dentro de un objeto, se usa el m칠todo POST y necesitamos especificar la ID del objeto padre, en este caso, <b>40</b> .  Lo descubrimos llamando del ejemplo anterior. <br>  En el caso de pynetbox, primero (en el ejemplo anterior) guardamos el resultado en la variable <b>prefijo</b> , y luego recurrimos a su atributo <b>available_prefixes</b> y al m칠todo <b>create</b> . <br>  Este ejemplo <b>no funcionar치</b> para usted, ya que el token con el derecho de escritura ya no es v치lido. <br></blockquote><hr><br><h3>  Direcciones IP </h3><br>  Si hay un prefijo que incluye esta direcci칩n, ser치n parte de 칠l.  Pueden estar solos. <br>  Puede pertenecer a cualquier VRF o estar en Global. <br>  Se pueden conectar a la interfaz, pero pueden colgarse en el aire. <br>  Puede seleccionar la siguiente direcci칩n IP libre en el prefijo. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4a1/c4d/442/4a1c4d4428f703d9a90766ffa9351fe8.png" width="800"><br><br>  Para hacer esto, simplemente haga clic en la l칤nea verde. <br><br>  Obtenga una lista de direcciones IP para una interfaz espec칤fica: <br><br><pre> <code class="bash hljs">curl -X GET <span class="hljs-string"><span class="hljs-string">"http://netbox.linkmeup.ru:45127/api/ipam/ip-addresses/?interface_id=8"</span></span> -H <span class="hljs-string"><span class="hljs-string">"Accept: application/json; indent=4"</span></span></code> </pre> <br><pre> <code class="python hljs">nb.ipam.ip_addresses.filter(interface_id=<span class="hljs-number"><span class="hljs-number">8</span></span>)</code> </pre><br>  O: <br><br><pre> <code class="bash hljs">curl -X GET <span class="hljs-string"><span class="hljs-string">"http://netbox.linkmeup.ru:45127/api/ipam/ip-addresses/?device=mlg-leaf-0&amp;interface=Ethernet1"</span></span> -H <span class="hljs-string"><span class="hljs-string">"Accept: application/json; indent=4"</span></span></code> </pre> <br><pre> <code class="python hljs">nb.ipam.ip_addresses.filter(device=<span class="hljs-string"><span class="hljs-string">"mlg-leaf-0"</span></span>, interface=<span class="hljs-string"><span class="hljs-string">"Ethernet1"</span></span>)</code> </pre><br>  Obtenga una lista de todas las direcciones IP del dispositivo: <br><br><pre> <code class="bash hljs">curl -X GET <span class="hljs-string"><span class="hljs-string">"http://netbox.linkmeup.ru:45127/api/ipam/ip-addresses/?device=mlg-leaf-0"</span></span> -H <span class="hljs-string"><span class="hljs-string">"Accept: application/json; indent=4"</span></span></code> </pre> <br><pre> <code class="python hljs">nb.ipam.ip_addresses.filter(device=<span class="hljs-string"><span class="hljs-string">"mlg-leaf-0"</span></span>)</code> </pre><br>  Obtenga una lista de direcciones IP de prefijo disponibles: <br><br><pre> <code class="bash hljs">curl -X GET <span class="hljs-string"><span class="hljs-string">"http://netbox.linkmeup.ru:45127/api/ipam/prefixes/28/available-ips/"</span></span> -H <span class="hljs-string"><span class="hljs-string">"Accept: application/json; indent=4"</span></span></code> </pre> <br><pre> <code class="python hljs">prefix = nb.ipam.prefixes.get(site=<span class="hljs-string"><span class="hljs-string">"mlg"</span></span>, role=<span class="hljs-string"><span class="hljs-string">"leaf-loopbacks"</span></span>) prefix.available_ips.list()</code> </pre><br><blockquote>  Una vez m치s, debe especificar la ID del prefijo en la URL de la que seleccionamos la direcci칩n; esta vez es 28. <br></blockquote>  Resalte la siguiente direcci칩n IP libre en el prefijo: <br><br><pre> <code class="bash hljs">curl -X POST <span class="hljs-string"><span class="hljs-string">"http://netbox.linkmeup.ru:45127/api/ipam/prefixes/28/available-ips/"</span></span> \ -H <span class="hljs-string"><span class="hljs-string">"accept: application/json"</span></span> \ -H <span class="hljs-string"><span class="hljs-string">"Content-Type: application/json"</span></span> \ -H <span class="hljs-string"><span class="hljs-string">"Authorization: TOKEN a9aae70d65c928a554f9a038b9d4703a1583594f"</span></span></code> </pre> <br><pre> <code class="bash hljs">prefix.available_ips.create()</code> </pre> <br><hr><br><h2>  Virtualizaci칩n </h2><br>  Todav칤a estamos luchando por el t칤tulo de DC moderno.  Donde sin virtualizaci칩n. <br><br>  NetBox no se ve y no es un lugar donde valga la pena almacenar informaci칩n sobre m치quinas virtuales (incluso puede especular sobre la necesidad de almacenar m치quinas f칤sicas en 칠l).  Sin embargo, esto puede resultarnos 칰til, por ejemplo, puede ingresar informaci칩n sobre Reflectores de ruta, m치quinas de servicio, como NTP, Syslog, servidores S-Flow y m치quinas de control. <br><br>  La VM tiene su propia lista de interfaces: son diferentes de las interfaces de los dispositivos f칤sicos y tienen su propio Endpoint separado. <br><br>  Para que pueda enumerar todas las m치quinas virtuales: <br><br><pre> <code class="bash hljs">curl -X GET <span class="hljs-string"><span class="hljs-string">"http://netbox.linkmeup.ru:45127/api/virtualization/virtual-machines/"</span></span> -H <span class="hljs-string"><span class="hljs-string">"Accept: application/json; indent=4"</span></span></code> </pre> <br><pre> <code class="python hljs">nb.virtualization.virtual_machines.all()</code> </pre><br>  Entonces, de todas las interfaces de todas las m치quinas virtuales: <br><br><pre> <code class="bash hljs">curl -X GET <span class="hljs-string"><span class="hljs-string">"http://netbox.linkmeup.ru:45127/api/virtualization/interfaces/"</span></span> -H <span class="hljs-string"><span class="hljs-string">"Accept: application/json; indent=4"</span></span></code> </pre> <br><pre> <code class="python hljs">nb.virtualization.interfaces.all()</code> </pre><br>  Para una VM, no puede especificar el hipervisor / m치quina f칤sica espec칤fica en la que se est치 ejecutando, pero puede especificar un cl칰ster.  Aunque no todo es tan desesperado.  Sigue leyendo. <br><br><hr><br><h2>  Cosas extra bonitas </h2><br>  La funcionalidad b치sica de NetBox cubre la mayor칤a de las tareas de muchos usuarios, pero no todas.  A칰n as칤, el producto fue escrito originalmente para resolver los problemas de una empresa en particular.  Sin embargo, se est치 desarrollando activamente y los nuevos lanzamientos salen con bastante <a href="https://github.com/netbox-community/netbox/releases" rel="nofollow">frecuencia</a> .  En consecuencia, aparecen nuevas funciones. <br><br>  Entonces, por ejemplo, desde mi primera instalaci칩n de NetBox hace un par de a침os, aparecieron etiquetas, contextos de configuraci칩n, webhooks, almacenamiento en cach칠, supervisi칩n cambi칩 a systemd, almacenamiento de archivos externo. <br><br>  Cuidado <br><br><h3>  Campos personalizados </h3><br>  En ocasiones, desea agregar un campo a cualquier entidad en la que pueda colocar datos arbitrarios. <br><br>  Por ejemplo, indique el n칰mero del acuerdo de suministro mediante el cual se compr칩 el conmutador o el nombre de la m치quina f칤sica en la que se ejecuta la VM. <br><br>  Aqu칤 es donde los campos personalizados vienen al rescate, solo un campo con un valor de texto que se puede agregar a casi cualquier entidad en NetBox. <br><br>  Crear campos personalizados en el panel de administraci칩n <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1cf/10e/568/1cf10e56808f227ce7f7270581b84a31.png" width="600"><br><br>  As칤 es como se ve al editar el dispositivo para el que se cre칩 el campo personalizado: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d3a/c2b/c78/d3ac2bc78d80acccc3895463f7ed7295.png" width="450"><br><br>  Solicite una lista de dispositivos por valor custom_field <br><br><pre> <code class="bash hljs">curl -X GET <span class="hljs-string"><span class="hljs-string">"http://netbox.linkmeup.ru:45127/api/dcim/devices/?cf_contract_number=0123456789"</span></span> -H <span class="hljs-string"><span class="hljs-string">"Accept: application/json; indent=4"</span></span></code> </pre> <br><pre> <code class="python hljs">nb.dcim.devices.filter(cf_contract_number=<span class="hljs-string"><span class="hljs-string">"0123456789"</span></span>)</code> </pre><br><hr><br><h3>  Contexto de configuraci칩n </h3><br>  A veces quieres algo m치s que texto no estructurado.  Entonces el <a href="http://netbox.linkmeup.ru:45127/extras/config-contexts/1/" rel="nofollow">contexto de configuraci칩n</a> viene al rescate. <br><br>  Esta es una oportunidad para introducir un conjunto de datos estructurados en formato JSON, que no tiene otro lugar para colocar. <br><br>  Esto podr칤a ser, por ejemplo, un conjunto de comunidades BGP o una lista de servidores Syslog. <br><br>  El contexto de configuraci칩n puede ser local, configurado para un objeto en particular, o global, cuando se configura una vez, y luego se aplica a todos los objetos que cumplen ciertas condiciones (por ejemplo, ubicados en el mismo sitio o que se ejecutan en la misma plataforma). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/97a/406/224/97a406224499ed35e9c471c3709a8d98.png" width="800"><br><br>  El contexto de configuraci칩n se agrega autom치ticamente a los resultados de la consulta.  Al mismo tiempo, los contextos locales y globales se fusionan en uno. <br><br>  Por ejemplo, para un dispositivo solo una simple chica rusa, para la cual hay un contexto local, la salida contendr치 la clave "config_context": <br><br><pre> <code class="bash hljs">curl -X GET <span class="hljs-string"><span class="hljs-string">"http://netbox.linkmeup.ru:45127/api/dcim/devices/?q=russian"</span></span> -H <span class="hljs-string"><span class="hljs-string">"Accept: application/json; indent=4"</span></span></code> </pre> <br><img src="https://habrastorage.org/getpro/habr/post_images/031/608/4bd/0316084bd52d028434631298a22ba33e.png" width="204"><br><br><hr><br><h3>  Etiquetas </h3><br>  Es dif칤cil decir algo nuevo sobre las etiquetas.  Ellos son.  Son convenientes para agregar cualquier caracter칤stica.  Por ejemplo, puede etiquetar los conmutadores "byada" del lote en el que falla la memoria. <br><br><hr><br><h3>  Webhooks </h3><br>  Algo irremplazable cuando necesita otros servicios para conocer los cambios en NetBox. <br>  Por ejemplo, cuando se inicia un nuevo interruptor, se env칤a un gancho al sistema de automatizaci칩n, que inicia el proceso de configuraci칩n del dispositivo y su puesta en funcionamiento. <br><br><hr><br><h1>  Conclusi칩n </h1><br>  En este art칤culo, no pretendo considerar todas las caracter칤sticas de NetBox, por lo que le dar칠 todo lo dem치s.  Comprende, prueba. <br><br>  Adem치s, como parte de la construcci칩n del sistema de automatizaci칩n, tocar칠 solo aquellas partes que realmente necesitamos. <br><br>  Entonces, arriba, habl칠 brevemente sobre qu칠 es NetBox y c칩mo se almacenan los datos en 칠l. <br><br>  Repito que ya ingres칠 casi todos los datos necesarios all칤, y puede arrastrar un <a href="" rel="nofollow">volcado de base de datos</a> usted mismo. <br><br>  Todo est치 listo para la siguiente etapa de automatizaci칩n: escribir un sistema (jajaja, solo scripts) para inicializar los dispositivos y administrar la configuraci칩n. <br><br><hr><br>  Pero, antes de terminar el art칤culo, dir칠 algunas palabras sobre la instalaci칩n y el funcionamiento de los componentes de NetBox. <br><br><h1>  Algunos matices de la instalaci칩n de NetBox </h1><br>  No describir칠 el proceso de instalaci칩n en detalle, es m치s que famoso en la <a href="https://netbox.readthedocs.io/en/stable/installation/" rel="nofollow">documentaci칩n oficial</a> . <br><br>  Puede ver el proceso de lanzamiento de la imagen acoplable de NetBox y trabajar en la GUI en el video de Dima Figol ( <a href="https://www.youtube.com/watch%3Fv%3DGGXgAlWm9aY%26t%3D9655s" rel="nofollow">una</a> y <a href="https://www.youtube.com/watch%3Fv%3Da3yK_WAisPw" rel="nofollow">dos veces</a> ) y <a href="https://www.youtube.com/watch%3Fv%3DI_Ra3PIR2Lc%26feature%3Dyoutu.be" rel="nofollow">Emil Garipov</a> . <br><br>  En general, si sigue estrictamente los pasos de instalaci칩n / inicio, todo saldr치 bien. <br>  Pero aqu칤 est치n los matices que puede olvidarse accidentalmente. <br><br><ul><li>  En el archivo configuration.py, se debe completar el par치metro <a href="https://netbox.readthedocs.io/en/stable/installation/2-netbox/" rel="nofollow">ALLOWED_HOSTS</a> : <br><pre> <code class="bash hljs">ALLOWED_HOSTS = [<span class="hljs-string"><span class="hljs-string">'netbox.linkmeup.ru'</span></span>, <span class="hljs-string"><span class="hljs-string">'localhost'</span></span>]</code> </pre> <br>  Aqu칤 debe especificar todos los posibles nombres de NetBox a los que acceder치, por ejemplo, puede haber una direcci칩n IP externa o 127.0.0.1 o alias DNS. <br>  Si esto no se hace, el sitio web de NetBox no se abrir치 y mostrar치 400. </li><li>  En el mismo archivo, se debe especificar <a href="https://netbox.readthedocs.io/en/stable/installation/2-netbox/" rel="nofollow">SECRET_KEY</a> , que puede inventar usted mismo o generar un script. </li><li>  La p치gina principal mostrar치 502 Bad Gateway si algo est치 mal con la configuraci칩n de la base de datos PostgreSQL: verifique el host (si est치 instalado en otra m치quina), puerto, nombre de la base de datos, nombre de usuario, contrase침a. </li><li>  Desde hace <a href="" rel="nofollow">alg칰n tiempo,</a> NetBox no otorga por defecto ning칰n derecho de lectura sin autorizaci칩n. <br><br>  Todo esto cambia en la misma configuraci칩n.py: <br><br><pre> <code class="bash hljs">EXEMPT_VIEW_PERMISSIONS = [<span class="hljs-string"><span class="hljs-string">'*'</span></span>]</code> </pre> </li><li>  Y tambi칠n las solicitudes de API devolver치n 200 y no funcionar치n si no hay una barra diagonal en la URL de API al final. <br><pre> <code class="bash hljs">curl -X GET -H <span class="hljs-string"><span class="hljs-string">"Accept: application/json; indent=4"</span></span> <span class="hljs-string"><span class="hljs-string">"http://netbox.linkmeup.ru:45127/api/dcim/devices"</span></span></code> </pre> <br></li></ul><br><hr><br><h1>  Un poco sobre PostgreSQL </h1><br>  Para conectarse al servidor: <br><br><pre> <code class="bash hljs">psql -U &lt;i&gt;username&lt;/i&gt; -h &lt;i&gt;hostname&lt;/i&gt; &lt;i&gt;db_name&lt;/i&gt;</code> </pre> <br>  Por ejemplo: <br><br><pre> <code class="bash hljs">psql -U netbox -h localhost netbox</code> </pre> <br>  Para mostrar todas las tablas: <br><br><pre> <code class="bash hljs">/dt</code> </pre> <br>  Para salir: <br><br><pre> <code class="bash hljs">/q</code> </pre> <br>  Para un volcado de base de datos: <br><br><pre> <code class="bash hljs">pg_dump -U &lt;i&gt;username&lt;/i&gt; -h &lt;i&gt;hostname&lt;/i&gt; &lt;i&gt;db_name&lt;/i&gt; &gt; netbox.sql</code> </pre> <br>  Si no desea ingresar una contrase침a cada vez: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> *:*:*:&lt;i&gt;username&lt;/i&gt;:&lt;i&gt;password&lt;/i&gt; &gt; ~/.pgpass chmod 600 ~/.pgpass</code> </pre> <br>  Si tiene su propia instalaci칩n y no desea hacer todo a mano, simplemente puede hacerlo volcando la base de datos actual de NetBox <a href="" rel="nofollow">aqu칤</a> : <br><br><pre> <code class="bash hljs">psql -U &lt;i&gt;username&lt;/i&gt; -h &lt;i&gt;hostname&lt;/i&gt; &lt;i&gt;db_name&lt;/i&gt; &lt; netbox_initial_db.sql</code> </pre> <br>  Si primero necesita descartar todas las tablas (y tiene que hacer esto), puede preparar el archivo con anticipaci칩n: <br><br><pre> <code class="bash hljs">psql -U &lt;i&gt;username&lt;/i&gt; -h &lt;i&gt;hostname&lt;/i&gt; &lt;i&gt;db_name&lt;/i&gt; \o drop_all_tables.sql select <span class="hljs-string"><span class="hljs-string">'drop table '</span></span> || tablename || <span class="hljs-string"><span class="hljs-string">' cascade;'</span></span> from pg_tables; \q psql -U &lt;i&gt;username&lt;/i&gt; -h &lt;i&gt;hostname&lt;/i&gt; &lt;i&gt;db_name&lt;/i&gt; -f drop_all_tables.sql</code> </pre> <br><hr><br><h1>  Enlaces utiles </h1><br><ul><li>  <a href="https://github.com/netbox-community/netbox" rel="nofollow">NetBox en s칤 mismo en guthub</a> </li><li>  <a href="https://github.com/netbox-community/netbox-docker" rel="nofollow">Versi칩n contenedor</a> </li><li>  <a href="https://netbox.readthedocs.io/en/stable/" rel="nofollow">Instrucciones completas de instalaci칩n y toda la documentaci칩n del producto.</a> </li><li>  <a href="http://karneliuk.com/2019/04/documenting-your-network-infrastructure-in-netbox-integrating-with-ansible-over-rest-api-and-automating-provisioning-of-cumulus-linux-arista-eos-nokia-sr-os-and-cisco-ios-xr/" rel="nofollow">Documentar su infraestructura de red en NetBox, integr치ndose con Ansible sobre REST API</a> </li><li>  <a href="https://www.youtube.com/watch%3Fv%3DGGXgAlWm9aY%26t%3D9655s" rel="nofollow">IPAM NetBox y su API, Docker, Postman</a> </li><li>  <a href="https://www.youtube.com/watch%3Fv%3Da3yK_WAisPw" rel="nofollow">IPAM NetBox y su API, plantillas de configuraci칩n con Python</a> </li><li>  <a href="https://github.com/digitalocean/pynetbox" rel="nofollow">Python NetKox SDK</a> </li><li>  <a href="http://netbox.linkmeup.ru:45127/api/docs/" rel="nofollow">Documentaci칩n API</a> </li><li>  <a href="https://groups.google.com/forum/" rel="nofollow">Lista de correo</a> </li><li>  <a href="https://networktocode.slack.com/" rel="nofollow">NetworkToCode Slack Channel</a> </li><li>  <a href="https://habr.com/ru/post/485618/">쯈u칠 es REST?</a> </li><li>  <a href="http://netbox.linkmeup.ru:45127/" rel="nofollow">Instalaci칩n de NetBox para ADSM</a> </li></ul></div></div><p>Source: <a href="https://habr.com/ru/post/486000/">https://habr.com/ru/post/486000/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../485972/index.html">M칠todos de an치lisis de regresi칩n en ciencia de datos</a></li>
<li><a href="../485974/index.html">Raspberry Pi y SIM7600E 4G HAT Modem</a></li>
<li><a href="../485986/index.html">Las 5 principales tendencias de localizaci칩n en 2020</a></li>
<li><a href="../485988/index.html">[Case Locomizer] C칩mo acelerar el c치lculo de un mapa de calor en 20,000 veces en dos a침os y medio</a></li>
<li><a href="../485998/index.html">LyX: Observaciones generales. Parte 2</a></li>
<li><a href="../486006/index.html">Almacenar el estado del chat en la pila</a></li>
<li><a href="../486010/index.html">Hacer una demostraci칩n para un tel칠fono antiguo - AONDEMO</a></li>
<li><a href="../486014/index.html">Recorrido de SLAC: Laboratorio nacional de aceleraci칩n del Departamento de Energ칤a de EE. UU. En Stanford</a></li>
<li><a href="../486018/index.html">Resultados de la encuesta de la sesi칩n</a></li>
<li><a href="../486024/index.html">Gr치ficos realmente simples en R para ciencia y periodismo.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>