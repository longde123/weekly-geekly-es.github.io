<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§µüèΩ üö£üèΩ üöó Memoria virtual en ARMv7 üé• üöï üè¥‚Äç‚ò†Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola 

 El art√≠culo revisa la arquitectura del sistema de memoria virtual ARMv7. 

 Encabezado de spoiler  Las sutilezas del almacenamiento en cach√©, ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Memoria virtual en ARMv7</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/422385/">  Hola <br><br>  El art√≠culo revisa la arquitectura del sistema de memoria virtual ARMv7. <br><br><div class="spoiler">  <b class="spoiler_title">Encabezado de spoiler</b> <div class="spoiler_text">  Las sutilezas del almacenamiento en cach√©, DMA, LPAE y similares no se consideran aqu√≠.  Para una descripci√≥n m√°s detallada, consulte la literatura al final del art√≠culo. <br></div></div><a name="habracut"></a><br><h2>  Introduccion </h2><br>  El sistema de memoria virtual realiza varias tareas.  En primer lugar, le permite ubicar los procesos del usuario en espacios de memoria separados y aislados entre s√≠.  Esto le permite aumentar la confiabilidad del sistema, los errores de un proceso no afectan la operaci√≥n de otros procesos.  En segundo lugar, el sistema operativo puede proporcionar al proceso m√°s memoria que la que tiene el sistema.  Las p√°ginas de memoria no utilizadas se guardan en un almacenamiento permanente, y las necesarias se cargan desde all√≠, formando la ilusi√≥n de una mayor cantidad de memoria de lo que realmente es.  En tercer lugar, el espacio virtual continuo facilita la escritura de software personalizado.  Todos los procesos se ejecutan en el mismo espacio, el sistema operativo les oculta la configuraci√≥n de memoria real en el sistema. <br><br><h2>  Definiciones </h2><br>  Las siguientes definiciones se utilizan en el art√≠culo: <br>  Direcci√≥n virtual: la direcci√≥n utilizada por el n√∫cleo del procesador.  El puntero de la pila, el contador de instrucciones, el registro de retorno usan una direcci√≥n virtual. <br>  Direcci√≥n f√≠sica: la direcci√≥n de salida en el bus del procesador. <br>  Una p√°gina es una unidad de direccionamiento de memoria virtual. <br>  Secci√≥n: un an√°logo de la p√°gina, tiene un tama√±o m√°s grande. <br>  Un marco es una unidad de direccionamiento de memoria f√≠sica. <br>  Tabla de p√°ginas: una matriz de registros para traducir direcciones. <br>  <abbr title="Identificador del espacio de direcciones">ASID</abbr> es el identificador de espacio de direcciones. <br>  <abbr title="Traducci√≥n Lookaside Buffer">TLB</abbr> - b√∫fer de traducci√≥n r√°pida de direcciones. <br>  <abbr title="Unidad de gesti√≥n de memoria">MMU</abbr> es una unidad de gesti√≥n de memoria. <br><br><h2>  TLB </h2><br>  TLB es un b√∫fer de hardware muy r√°pido que contiene los resultados de las √∫ltimas traducciones de direcciones.  La solicitud del n√∫cleo para traducir la direcci√≥n de la p√°gina y el ASID actual llegan al TLB.  Si hay una entrada v√°lida all√≠, se verifican los permisos para acceder a esta memoria, el m√©todo de acceso y la direcci√≥n de trama correspondiente se devuelven a la MMU.  Si se deniega el acceso a la memoria, se genera una excepci√≥n de hardware.  Si se produjo un error de TLB (no se encontr√≥ ning√∫n registro), TTBCR distingue entre may√∫sculas y min√∫sculas.  Se puede realizar una b√∫squeda en las tablas de p√°ginas o se genera una excepci√≥n. <br><br>  Es importante tener en cuenta que al manipular tablas de p√°ginas, debe restablecer correctamente el TLB, porque  la informaci√≥n irrelevante puede almacenarse all√≠. <br><br>  La actualizaci√≥n de entradas en el TLB es transparente para el programador round-robin. <br>  Tambi√©n es posible cargar y asegurar algunas entradas en el TLB para evitar su desplazamiento. <br><br><img src="https://habrastorage.org/webt/rt/5y/pi/rt5ypi6o5l1n8yvzl1moompfsny.png" alt="imagen"><br>  <i>Figura 1. TLB</i> <br><br><h2>  Tablas de p√°gina </h2><br>  ARMv7 es una arquitectura de 32 bits, por lo que tenemos 4 GB de memoria virtual direccionable. <br>  Las tablas de p√°ginas se dividen en 2 niveles: L1 y L2. <br><br>  La Tabla L1 describe los 4 GB de espacio de direcciones.  Se compone de 4096 registros de 32 bits, cada uno de los cuales describe 1 Mb.  Las entradas en la tabla son seleccionadas por los 12 bits altos de la direcci√≥n virtual. <br><br><img src="https://habrastorage.org/webt/fi/yg/ud/fiygudienjoeqqzqayx1gjhmm9m.png" alt="imagen"><br>  <i>Fig.</i>  <i>2 Buscar entradas en la tabla L1</i> <br><br>  La tabla L1 se encuentra en la memoria f√≠sica y est√° alineada con un borde de 16 KB.  Hay 4 opciones para estas entradas: para describir p√°ginas, secciones y supersecciones.  Bueno, un registro vac√≠o, para la memoria que a√∫n no est√° asignada. <br><br><img src="https://habrastorage.org/webt/pg/25/_k/pg25_kieahrtebnqw7qtau7fdq0.png" alt="imagen"><br>  <i>Fig.</i>  <i>3 tipos de entradas en L1</i> <br><br>  Los bits 0 y 1 indican el tipo de registro 00b-Fault, 01b es el descriptor de p√°gina, 10b es el descriptor de secci√≥n (y la supersecci√≥n). <br><br>  Si la memoria f√≠sica est√° paginada, entonces la tabla L1 almacena la direcci√≥n de la tabla L2 (f√≠sica, alineada a 1Kb).  El fabricante determina el bit 9 (implementaci√≥n definida), bits [8: 5] - para el mecanismo de dominio (obsoleto en ARMv7), SBZ - ceros. <br><br>  Si decidimos dividir la memoria en secciones, entonces en L1 es necesario escribir la direcci√≥n f√≠sica correspondiente.  La secci√≥n se refiere directamente al √°rea de memoria f√≠sica alineada de 1 MB.  No hay necesidad de la tabla L2.  La sustituci√≥n es un caso especial de particionamiento, la entrada en la tabla L1 debe repetirse 16 veces, la alineaci√≥n de los bloques asignados de memoria f√≠sica y virtual tambi√©n es de 16 MB. <br><br>  La tabla L2 consta de 256 entradas de 32 bits.  Debe estar alineado a 1Kb. <br><br><img src="https://habrastorage.org/webt/b9/ik/bj/b9ikbjt3gsmcuekx-wofiseptwi.png" alt="imagen"><br>  <i>Fig.</i>  <i>4 Buscar entradas en la tabla L2</i> <br><br>  Los √≠ndices en la tabla L2 se forman a partir del promedio de 8 bits [19:12] de la direcci√≥n virtual.  Cada entrada de la tabla contiene la direcci√≥n del marco. <br><br><img src="https://habrastorage.org/webt/cd/hh/vl/cdhhvl4c4rfl3fnqrmoslorfcka.png" alt="imagen"><br>  <i>Fig.</i>  <i>5 tipos de entradas en L2</i> <br><br>  Las p√°ginas pueden ser de dos tama√±os: 64 Kb (p√°gina grande) y 4Kb (p√°gina peque√±a). <br>  Los bits AP y APX establecen permisos de lectura / escritura en modo privilegiado / no privilegiado (kernel / usuario).  Los bits TEX, C, B, S son responsables del tipo de memoria, su almacenamiento en cach√© y el almacenamiento en b√∫fer de lectura y escritura.  El bit nG - no Global permite el acceso a la p√°gina para todos los procesos o solo para un ASID espec√≠fico. <br><br>  El uso de p√°ginas grandes reduce el n√∫mero de entradas en el TLB.  En lugar de 16 entradas (4Kb * 16 = 64Kb), solo una se almacenar√° all√≠.  Sin embargo, se deben ingresar 16 entradas id√©nticas en la tabla L2. <br><br>  La capacidad de abordar diferentes tama√±os de bloques permite, por un lado, asignar memoria con la granularidad deseada, por otro lado, reducir el n√∫mero de llamadas a tablas de p√°ginas en una memoria relativamente lenta. <br><br><h2>  Registros </h2><br>  Para controlar el sistema (incluida la MMU) en la arquitectura ARM, se dise√±a un coprocesador CP15 especial.  Para la gesti√≥n de memoria hay una docena y media de sus registros.  Estamos interesados ‚Äã‚Äãen varios de ellos: Control, TTBR0 / 1, TTBCR, ContextID. <br><br>  En el registro de Control, el bit menos significativo es responsable de encender / apagar la MMU, todo es simple. <br><br>  El par de registros TTBR0 / 1 contiene las direcciones f√≠sicas de las tablas del primer nivel.  En estas direcciones, la MMU comienza a buscar la p√°gina deseada. <br><br>  El registro TTBCR le permite dividir todo el espacio de direcciones en 2 partes entre TTBR0 y TTBR1.  Cada uno de ellos transmitir√° su parte de las direcciones.  Los bits [2: 0] se utilizan para establecer el tama√±o.  El n√∫mero registrado (de 0 a 7 decimales) enmascara la parte m√°s antigua de las direcciones virtuales.  Si su valor es "0", todas las direcciones se transmiten a trav√©s de TTBR0.  Si "1", las direcciones de 31 bits est√°n enmascaradas y los 2 GB m√°s bajos de espacio virtual pasan a trav√©s de TTBR0, los superiores a trav√©s de TTBR1.  "2": se enmascaran 31 y 30 bits y se obtiene la divisi√≥n en 1 GB y 3 GB, respectivamente.  Por lo tanto, la parte inferior de las direcciones se puede usar para aplicaciones de usuario, sobrecargando el registro TTBR0 para un nuevo proceso, y la parte superior se puede dejar para las necesidades del sistema. <br><br><img src="https://habrastorage.org/webt/yp/fp/so/ypfpsohyn943gmkrfz7fmrm1z30.png" alt="imagen"><br>  <i>Fig.</i>  <i>6 espacio de direcciones dividido</i> <br><br>  Los bits [5: 4] son ‚Äã‚Äãresponsables del comportamiento de falta de TLB: busque en tablas de p√°ginas o una excepci√≥n. <br>  El registro ContextID contiene el campo ASID para el proceso actual.  Debe cambiarse junto con el contenido del registro TTBR0 al cambiar el contexto. <br><br><h2>  Traducci√≥n de direcciones </h2><br>  El algoritmo para convertir direcciones virtuales a f√≠sicas es el siguiente: <br><br><ul><li>  Busque la direcci√≥n virtual solicitada y el ASID en el b√∫fer TLB </li><li>  Si el TLB no tiene la direcci√≥n requerida, se realiza una b√∫squeda de hardware en las tablas de p√°ginas </li></ul><br>  Si el n√∫cleo solicit√≥ previamente una p√°gina virtual, se almacena en el TLB.  En este caso, la MMU lo saca del cach√© y no se necesita hacer nada.  Si la p√°gina se solicita por primera vez (o si se forz√≥ a salir de all√≠, el TLB no es muy grande), se realiza la b√∫squeda en las tablas L1-L2.  Por lo tanto, la asignaci√≥n de las direcciones virtuales y f√≠sicas es la siguiente: <br><ul><li>  En el registro TTBR0 \ TTBR1, se busca la direcci√≥n de la tabla L1. </li><li>  Los 10 bits superiores de la direcci√≥n virtual forman un √≠ndice en la tabla. </li><li>  a) Si el registro corresponde a la secci√≥n (supersecci√≥n), se verifican los atributos de la secci√≥n y, si todo est√° bien, la direcci√≥n f√≠sica resultante se compone de la direcci√≥n base de la secci√≥n (supersecci√≥n) y los 20 (24) bits inferiores de la direcci√≥n virtual. <br><br><div class="spoiler">  <b class="spoiler_title">Encabezado de spoiler</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/v_/ay/fk/v_ayfkww22u6szvud73uwehhmne.png" alt="imagen"><br>  <i>Fig.</i>  <i>7 Traducci√≥n de direcciones en supersecci√≥n</i> <br></div></div><br>  b) Si el registro es una tabla L2, la b√∫squeda contin√∫a en √©l.  La parte central de la direcci√≥n virtual de la p√°gina forma el √≠ndice de la tabla. <br><br><div class="spoiler">  <b class="spoiler_title">Encabezado de spoiler</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/dz/5c/j9/dz5cj9mw-p9r07bvdhxwqm_3a2a.png" alt="imagen"><br>  <i>Fig.</i>  <i>8 Traducci√≥n de direcciones en la Tabla L2</i> <br></div></div><br></li><li>  Actualizaci√≥n de TLB en progreso </li></ul><br>  En total, el subsistema de memoria virtual consta de las siguientes partes: <br><br><ul><li>  M√∫ltiples registros de control CP15 </li><li>  Tablas de p√°ginas que contienen reglas de traducci√≥n de direcciones </li><li>  TLB: cach√© de transmisiones exitosas </li><li>  MMU es una unidad de traducci√≥n de direcciones. </li></ul><br><h2>  Literatura </h2><br>  Manual de referencia de arquitectura ARM Edici√≥n ARMv7-A y ARMv7-R <br>  Gu√≠a del programador de la serie ARM Cortex-A </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es422385/">https://habr.com/ru/post/es422385/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es422375/index.html">Los contratos son diferentes, o para qu√© te inscribiste</a></li>
<li><a href="../es422377/index.html">ESP8266 + FLProg - Par√°metros del sistema del usuario y sincronizaci√≥n con el servidor horario exacto</a></li>
<li><a href="../es422379/index.html">C√≥mo luch√© contra el robo ... usando php</a></li>
<li><a href="../es422381/index.html">TOP 10 ICO 2018 Q3 (votaci√≥n)</a></li>
<li><a href="../es422383/index.html">No es dif√≠cil para el robot: c√≥mo la log√≠stica del correo se est√° volviendo m√°s inteligente</a></li>
<li><a href="../es422389/index.html">El arte olvidado de la flexi√≥n: c√≥mo proteger la columna vertebral en otras culturas</a></li>
<li><a href="../es422395/index.html">Una novedad muy olvidada: despu√©s de a√±os, sale el sucesor del MikroTik RB2011</a></li>
<li><a href="../es422397/index.html">‚ÄúLo principal es que lo pas√©‚Äù: qu√© y c√≥mo se les ense√±a a los futuros especialistas de TI en Berl√≠n</a></li>
<li><a href="../es422399/index.html">El proceso de revisi√≥n de c√≥digo en hh.ru</a></li>
<li><a href="../es422401/index.html">Otro marco de plugin de C ++</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>