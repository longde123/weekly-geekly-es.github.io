<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üò≠ üéÉ üíê √âtats mondiaux: pourquoi et comment les √©viter üë®‚ÄçüöÄ ü§∏üèæ üéπ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Conditions mondiales. Cette phrase provoque la peur et la douleur au c≈ìur de chaque d√©veloppeur qui a eu le malheur de faire face √† ce ph√©nom√®ne. Avez...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>√âtats mondiaux: pourquoi et comment les √©viter</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/mailru/blog/454946/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/il/xm/yl/ilxmyllyrjl50zu_shop-i-3fus.jpeg"></div><br>  Conditions mondiales.  Cette phrase provoque la peur et la douleur au c≈ìur de chaque d√©veloppeur qui a eu le malheur de faire face √† ce ph√©nom√®ne.  Avez-vous d√©j√† rencontr√© un comportement d'application inattendu, ne comprenant pas ses raisons, comme un malheureux chevalier essayant de tuer Hydra avec plusieurs t√™tes?  Vous vous retrouvez dans un cycle sans fin d'essais et d'erreurs, 90% du temps vous vous demandez ce qui se passe? <br><br>  Tout cela peut √™tre des cons√©quences g√™nantes des globales: des variables cach√©es qui changent leur √©tat dans des endroits inconnus, pour des raisons que vous n'avez pas encore compris. <br><a name="habracut"></a><br>  Aimez-vous vous promener dans le noir pendant que vous essayez de changer l'application?  Bien s√ªr, je ne l'aime pas.  Heureusement, j'ai des bougies pour vous: <br><br><ol><li>  Tout d'abord, je d√©crirai ce que nous appelons le plus souvent des √âtats mondiaux.  Ce terme n'est pas toujours utilis√© avec pr√©cision, il doit donc √™tre clarifi√©. <br></li><li>  Ensuite, nous d√©couvrirons pourquoi les globaux sont nuisibles √† notre base de code. <br></li><li>  Ensuite, je vais expliquer comment couper la port√©e des globales pour les transformer en variables locales. <br></li><li>  Enfin, je parlerai de l'encapsulation et pourquoi la croisade contre les variables globales n'est qu'une partie du gros probl√®me. <br></li></ol><br>  J'esp√®re que cet article explique tout ce que vous devez savoir sur les √©tats mondiaux.  Si vous pensez que j'ai beaucoup manqu√© et que vous me d√©testez pour cela et que vous ne voulez plus me voir, √©crivez √† ce sujet dans les commentaires.  Ce sera agr√©able pour moi, mes lecteurs et tous ceux qui sont soudainement apparus sur cette page. <br><br>  √ätes-vous pr√™t, cher lecteur, √† sauter sur un cheval et √† conna√Ætre votre ennemi?  Allez trouver ces globales et faites-leur go√ªter l'acier de nos √©p√©es! <br><br><h1>  Qu'est-ce qu'une condition? </h1><br><img src="https://habrastorage.org/getpro/habr/post_images/7dd/561/59c/7dd56159c2c3d32176e249ea71ed13ad.jpg"><br><br>  Commen√ßons par les bases pour que les d√©veloppeurs se comprennent. <br><br>  Un √©tat est une d√©finition d'un syst√®me ou d'une entit√©.  Les √©tats se trouvent dans la vraie vie: <br><br><ul><li>  Lorsque l'ordinateur est √©teint, son √©tat est d√©sactiv√©. <br></li><li>  Quand une tasse de th√© est chaude, son √©tat est chaud. <br></li></ul><br>  Dans le d√©veloppement de logiciels, certaines constructions (telles que des variables) peuvent avoir des √©tats.  Disons que la cha√Æne ¬´bonjour¬ª ou le nombre 11 ne sont pas consid√©r√©s comme des √©tats, ce sont des valeurs.  Ils deviennent √©tat lorsqu'ils sont attach√©s √† une variable et plac√©s en m√©moire. <br><br><pre><code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"hello"</span></span>; <span class="hljs-comment"><span class="hljs-comment">// No state here! $lala = "hello"; // The variable $lala has the state 'hello'.</span></span></code> </pre> <br>  On distingue deux types d'√©tats: <br><br>  √âtats variables: apr√®s leur initialisation, ils peuvent √©voluer √† tout moment lors de l'ex√©cution de votre application. <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> $lala = <span class="hljs-string"><span class="hljs-string">"hello"</span></span>; <span class="hljs-comment"><span class="hljs-comment">// Initialisation of the variable. $lala = "hallo"; // The state of the variable $lala can be changed at runtime.</span></span></code> </pre> <br>  √âtats immuables: ne peut pas changer pendant l'ex√©cution.  Vous affectez le premier √©tat √† votre variable et sa valeur ne change pas par la suite.  Les "constantes" de la vie quotidienne sont appel√©es des exemples d'√©tats immuables: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> define(<span class="hljs-string"><span class="hljs-string">"GREETING"</span></span>, <span class="hljs-string"><span class="hljs-string">"hello"</span></span>); <span class="hljs-comment"><span class="hljs-comment">// Constant definition. echo GREETING; GREETING = "hallo"; // This line will produce an error!</span></span></code> </pre> <br>  √âcoutons maintenant une conversation hypoth√©tique entre Denis et Vasily, vos coll√®gues d√©veloppeurs: <br><br>  - Dan!  Vous avez cr√©√© des variables globales partout!  Ils ne peuvent pas √™tre modifi√©s sans que tout se brise!  Je vais te tuer! <br>  - Nifiga, Vasek!  Mes fortunes mondiales sont impressionnantes!  J'y mets mon √¢me, ce sont des chefs-d'≈ìuvre!  J'adore mes globales! <br><br>  Le plus souvent, les d√©veloppeurs appellent des √©tats globaux, des variables globales ou des globaux ce qu'ils devraient appeler des √©tats mutables globaux.  Autrement dit, les √©tats qui peuvent √™tre modifi√©s dans la plus grande des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">√©tendues</a> √† votre disposition: dans l'application enti√®re. <br><br>  Lorsqu'une variable n'a pas la totalit√© de l'application comme √©tendue, nous parlons de variables locales ou locales.  Ils existent dans certaines zones de visibilit√© donn√©es, moins que la zone de l'application enti√®re. <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Ecommerce</span></span>; $global = <span class="hljs-string"><span class="hljs-string">"I'm a mutable global variable!"</span></span>; <span class="hljs-comment"><span class="hljs-comment">// global variable class Shipment { public $warehouse; // local variable existing in the whole class public function __construct() { $info = "You're creating a shipment object!"; // local variable bound to the constructor scope echo $info; } } class Product { public function __construct() { global $global; $global = "I change the state now 'cause I can!"; echo "You're creating a product object!"; // no state here } }</span></span></code> </pre> <br>  Vous pourriez penser: combien il est pratique d'avoir des variables auxquelles vous pouvez acc√©der de partout et de les changer!  Je peux transf√©rer des √©tats d'une partie de l'application √† une autre!  Pas besoin de les passer par des fonctions et d'√©crire autant de code!  Salut, √©tat mutable mondial! <br><br>  Si vous le pensez vraiment, je vous recommande fortement de continuer la lecture. <br><br><h1>  Des √âtats mondiaux pires que la peste et le chol√©ra? </h1><br><h2>  Le plus grand diagramme de liens </h2><br>  R√©alit√©: il vous sera plus facile de cr√©er un diagramme de connexion d'application pr√©cis s'il ne contient que des param√®tres r√©gionaux avec des √©tendues petites et d√©finies, sans globaux. <br><br>  Pourquoi? <br><br>  Disons que vous avez une grande application avec des variables globales.  Chaque fois que vous devez changer quelque chose, vous devez: <br><br><ul><li>  Rappelons que ces √©tats mondiaux mutables existent. <br></li><li>  Estimez si elles affecteront la port√©e que vous allez modifier. <br></li></ul><br>  Habituellement, vous n'avez pas besoin de penser aux variables locales qui se trouvent dans d'autres √©tendues, mais quoi que vous fassiez, vous devez toujours garder dans votre cerveau fatigu√© un endroit pour les √©tats mutables globaux, car ils peuvent affecter toutes les √©tendues. <br><br>  De plus, vos √©tats mutables globaux peuvent changer n'importe o√π dans l'application.  Il faut g√©n√©ralement se demander quel est leur √©tat actuel.  Cela signifie que vous √™tes oblig√© de rechercher dans l'application, en essayant de calculer les valeurs des globales dans la port√©e modifiable. <br><br>  Ce n'est pas tout.  Si vous devez changer l'√©tat des globales, vous n'imaginerez pas quelle port√©e cela affectera.  Cela conduira-t-il √† un comportement inattendu d'une autre classe, m√©thode ou fonction?  Succ√®s dans la recherche. <br><br>  En bref, vous combinez toutes les classes, m√©thodes et fonctions qui utilisent le m√™me √©tat global.  N'oubliez pas: les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">d√©pendances augmentent consid√©rablement la complexit√©</a> .  Cela vous fait-il peur?  √áa devrait l'√™tre.  Les petites zones de visibilit√© sp√©cifiques sont tr√®s utiles: vous n'avez pas besoin de garder √† l'esprit l'ensemble de l'application, il suffit de ne se souvenir que des zones avec lesquelles vous travaillez. <br><br>  Les gens ne suivent pas imm√©diatement une grande quantit√© d'informations.  Lorsque nous essayons de le faire, nous √©puisons rapidement l'offre de capacit√©s cognitives, il devient difficile pour nous de nous concentrer et nous commen√ßons √† cr√©er des bugs et des choses stupides.  C'est pourquoi il est si d√©sagr√©able d'agir dans le cadre global de votre application. <br><br><h2>  Collisions de noms mondiaux </h2><br>  Il est difficile d'utiliser des biblioth√®ques tierces.  Imaginez que vous souhaitez utiliser cette biblioth√®que super cool qui colore au hasard chaque personnage avec un effet de scintillement.  Le r√™ve de tout d√©veloppeur!  Si cette biblioth√®que utilise √©galement des globales qui ont les m√™mes noms que les v√¥tres, vous appr√©cierez les collisions de noms.  Votre application va planter et vous en devinerez les raisons, probablement pour longtemps: <br><br><ul><li>  Tout d'abord, vous devrez d√©couvrir que votre biblioth√®que utilise des variables globales. <br></li><li>  Deuxi√®mement, vous devez calculer quelle variable a √©t√© utilis√©e pendant l'ex√©cution - la v√¥tre ou les biblioth√®ques?  Ce n'est pas si simple, les noms sont les m√™mes! <br></li><li>  Troisi√®mement, puisque vous ne pouvez pas modifier la biblioth√®que vous-m√™me, vous devez renommer vos variables mutables globales.  S'il est utilis√© tout au long de l'application, vous pleurerez. <br></li></ul><br>  √Ä chaque √©tape, vous arracherez vos cheveux de rage et de d√©sespoir.  Bient√¥t, vous n'aurez plus besoin d'un peigne.  Il est peu probable que ce sc√©nario vous s√©duise.  Peut-√™tre que quelqu'un se souviendra que les biblioth√®ques JavaScript Mootools, Underscore et jQuery se heurtaient toujours si elles n'√©taient pas plac√©es dans des port√©es plus petites.  Oh, et le c√©l√®bre objet global <code>$</code> dans jQuery! <br><br><h2>  Les tests se transformeront en cauchemar </h2><br>  Si je ne vous ai pas encore convaincu, regardons la situation du point de vue des tests unitaires: comment √©crire des tests en pr√©sence de variables globales?  √âtant donn√© que les tests peuvent changer les globaux, vous ne savez pas dans quel test se trouvait l‚Äô√©tat.  Vous devez isoler les tests les uns des autres et les √©tats globaux les lient ensemble. <br><br>  L'avez-vous d√©j√† eu pour que les tests d'isolement fonctionnent correctement et que lorsque vous ex√©cutez le package entier, √©chouent-ils?  Non?  Et je l'avais.  Chaque fois que je m'en souviens, je souffre. <br><br><h2>  Probl√®mes de concurrence </h2><br>  Les √©tats globaux variables peuvent causer beaucoup de probl√®mes si vous avez besoin de simultan√©it√©.  Lorsque vous modifiez l'√©tat des globaux dans plusieurs threads d'ex√©cution, alors dirigez-vous sur les talons dans un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">√©tat</a> puissant <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">de la course</a> . <br><br>  Si vous √™tes un d√©veloppeur PHP, cela ne vous d√©range pas, sauf si vous utilisez des biblioth√®ques qui vous permettent de cr√©er du parall√©lisme.  Cependant, lorsque vous <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">apprenez une nouvelle langue</a> dans laquelle le parall√©lisme est facile √† mettre en ≈ìuvre, j'esp√®re que vous vous souviendrez de ma prose. <br><br><h1>  √âviter les √©tats mutables mondiaux </h1><br><img src="https://habrastorage.org/getpro/habr/post_images/6df/acf/801/6dfacf801044e2e081ffd24ed7502a98.jpg"><br><br>  Bien que les √âtats mutables mondiaux puissent causer une tonne de probl√®mes, ils sont parfois difficiles √† √©viter. <br><br>  Prenez l'API REST: les points de terminaison re√ßoivent une sorte de requ√™tes HTTP avec des param√®tres et envoient des r√©ponses.  Ces param√®tres HTTP envoy√©s au serveur peuvent √™tre demand√©s √† plusieurs niveaux de votre application.  Il est tr√®s tentant de rendre ces param√®tres globaux lors de la r√©ception d'une requ√™te HTTP, en les modifiant avant d'envoyer une r√©ponse.  Ajoutez du parall√©lisme au-dessus de chaque demande et la recette du sinistre est pr√™te. <br><br>  Les √©tats mutables globaux peuvent √©galement √™tre directement pris en charge dans les impl√©mentations de langage.  Par exemple, en PHP, il y a des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">superglobaux</a> . <br><br>  Si les globaux viennent de quelque part, comment y faire face?  Comment refactoriser l'application de Denis, votre coll√®gue d√©veloppeur qui a cr√©√© des globaux partout o√π c'est possible, car il n'a rien lu sur le d√©veloppement depuis 20 ans? <br><br><h2>  Arguments de fonction </h2><br>  Le moyen le plus simple d'√©viter les globaux est de passer des variables √† l'aide d'arguments de fonction.  Prenons un exemple simple: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Router</span></span>\<span class="hljs-title"><span class="hljs-title">HttpRequest</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Product</span></span>\<span class="hljs-title"><span class="hljs-title">ProductData</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Exceptions</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ProductController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(HttpRequest $httpReq)</span></span></span><span class="hljs-function"> </span></span>{ $productData = $httpReq-&gt;get(<span class="hljs-string"><span class="hljs-string">"productData"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;productModel-&gt;validateProduct($productData)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ValidationException(sprintf(<span class="hljs-string"><span class="hljs-string">"The product %d is not valid"</span></span>, $productData[<span class="hljs-string"><span class="hljs-string">"id"</span></span>])); } $product = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;productModel-&gt;createProduct($productData); } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Product</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createProduct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(array $productData)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Product</span></span></span><span class="hljs-function"> </span></span>{ $productData[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] = <span class="hljs-string"><span class="hljs-string">"SuperProduct"</span></span>.$productData[<span class="hljs-string"><span class="hljs-string">"name"</span></span>]; <span class="hljs-comment"><span class="hljs-comment">// This is not what you should do; I talk about it later in the article. try { $product = $this-&gt;productDao-&gt;find($productData["id"]); return product; } catch (NotFoundException $e) { $product = $this-&gt;productDao-&gt;save($productData); return $product; } } } class ProductDao { private $db; public function find(int $id): array { return $this-&gt;db-&gt;find(['product' =&gt; $id]); } public function save(array $productData): array { return $this-&gt;db-&gt;saveProduct($productData); } }</span></span></code> </pre> <br>  Comme vous pouvez le voir, le <code>$productData</code> du contr√¥leur, via une requ√™te HTTP, passe par diff√©rents niveaux: <br><br><ol><li>  Le contr√¥leur a re√ßu une demande HTTP. <br></li><li>  Param√®tres pass√©s au mod√®le. <br></li><li>  Param√®tres pass√©s au <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">DAO</a> . <br></li><li>  Les param√®tres sont enregistr√©s dans la base de donn√©es d'application. <br></li></ol><br>  Nous pourrions rendre ce tableau de param√®tres global lorsque nous le r√©cup√©rons de la requ√™te HTTP.  Cela semble si simple: pas besoin de transf√©rer des donn√©es vers 4 fonctions diff√©rentes.  Cependant, en passant des param√®tres comme arguments aux fonctions: <br><br><ul><li>  Cela montrera √©videmment que ces fonctions utilisent le <code>$productData</code> . <br></li><li>  Il montrera √©videmment quelles fonctions utilisent quels param√®tres.  On peut voir que pour <code>ProductDao::find</code> partir du <code>$productData</code> , seul <code>$id</code> n√©cessaire, et pas tout. <br></li></ul><br>  Les globaux rendent le code moins compr√©hensible et associent les m√©thodes entre elles, ce qui est un prix tr√®s √©lev√© pour un manque presque complet d'avantages. <br><br>  Vous entendez d√©j√† Denis protester: ¬´Et si une fonction a trois arguments ou plus?  Si vous devez en ajouter encore plus, la complexit√© de la fonction augmentera!  Et qu'en est-il des variables, des objets et des autres constructions n√©cessaires partout?  Les transmettrez-vous √† chaque fonction de l'application? ¬ª <br><br>  Les questions sont justes, cher lecteur.  En <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">bon d√©veloppeur</a> , vous devez expliquer √† Denis, en utilisant vos comp√©tences en communication, voici ce que: <br><br>  <i>¬´Denis, si vos fonctions ont trop d'arguments, alors les fonctions elles-m√™mes peuvent √™tre un probl√®me.</i>  <i>Ils en font probablement trop, sont responsables de trop de choses.</i>  <i>Vous ne pensiez pas √† les diviser en fonctions plus petites? "</i>  . <br><br>  Se sentant comme un orateur √† l'Acropole d'Ath√®nes, vous continuez: <br><br>  <i>¬´Si vous avez besoin de variables dans de nombreux domaines de visibilit√©, alors c'est un probl√®me, et bient√¥t nous en parlerons.</i>  <i>Mais si vous en avez vraiment besoin, qu'y a-t-il de mal √† les passer par des arguments de fonction?</i>  <i>Oui, vous devrez les taper au clavier, mais nous sommes des d√©veloppeurs, c'est notre travail d'√©crire du code. ¬ª</i> <br><br>  Cela peut sembler plus compliqu√© lorsque vous avez plus d'arguments (c'est peut-√™tre le cas), mais je le r√©p√®te, les avantages l'emportent sur les inconv√©nients: il est pr√©f√©rable que le code soit aussi clair que possible et n'utilise pas d'√©tats mutables globaux cach√©s. <br><br><h2>  Objets de contexte </h2><br>  Les objets contextuels sont ceux qui contiennent des donn√©es d√©finies par un certain contexte.  En r√®gle g√©n√©rale, ces donn√©es sont stock√©es sous la forme d'une construction de paires de cl√©s, comme un tableau associatif en PHP.  Un tel objet n'a aucun comportement, seulement des donn√©es, semblable <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">√† un objet de valeur</a> . <br><br>  Un objet de contexte peut remplacer n'importe quel √©tat mutable global.  Revenez √† l'exemple de code pr√©c√©dent.  Au lieu de transmettre des donn√©es de la demande √† travers les niveaux, nous pouvons utiliser un objet qui encapsule ces donn√©es. <br><br>  Le contexte sera la requ√™te elle-m√™me: une autre requ√™te - un autre contexte - un autre ensemble de donn√©es.  Ensuite, l'objet contextuel sera transmis √† toute m√©thode qui a besoin de ces donn√©es. <br><br>  Vous dites: "C'est g√©nial et tout √ßa, mais qu'est-ce que √ßa donne?" <br><br><ul><li>  Les donn√©es sont encapsul√©es dans un objet.  Le plus souvent, votre t√¢che consistera √† rendre les donn√©es immuables, c'est-√†-dire afin que vous ne puissiez pas changer l'√©tat - la valeur des donn√©es dans l'objet apr√®s l'initialisation. <br></li><li>  √âvidemment, le contexte a besoin des donn√©es de l'objet contextuel, car il est transf√©r√© √† toutes les fonctions (ou m√©thodes) qui ont besoin de ces donn√©es. <br></li><li>  Cela r√©sout le probl√®me de concurrence: si chaque demande a son propre objet contextuel, vous pouvez les √©crire ou les lire en toute s√©curit√© dans leurs propres threads d'ex√©cution. <br></li></ul><br>  Mais tout dans le d√©veloppement a un prix.  Les objets contextuels peuvent √™tre nuisibles: <br><br><ul><li>  En regardant les arguments de la fonction, vous ne saurez pas quelles sont les donn√©es dans l'objet contextuel. <br></li><li>  Vous pouvez mettre n'importe quoi dans un objet contextuel.  Veillez √† ne pas en mettre trop, par exemple, toute la session utilisateur, ou m√™me la plupart de vos donn√©es d'application.  Et cela peut arriver: <code>$context-&gt;getSession()-&gt;getUser()-&gt;getProfil()-&gt;getUsername()</code> .  Brisez la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">loi de D√©m√©ter</a> et votre mal√©diction deviendra une complexit√© insens√©e. <br></li><li>  Plus l'objet contextuel est grand, plus il est difficile de savoir quelles donn√©es et dans quelle port√©e il les utilise. <br></li></ul><br>  En g√©n√©ral, j'√©viterais autant que possible d'utiliser des objets contextuels.  Ils peuvent provoquer beaucoup de doutes.  L'immuabilit√© des donn√©es est un gros plus, mais il ne faut pas oublier les lacunes.  Si vous utilisez un objet contextuel, assurez-vous qu'il est suffisamment petit et passez-le dans une port√©e petite et soigneusement d√©finie. <br><br>  Si, avant d'ex√©cuter un programme, vous n'avez aucune id√©e du nombre d'√©tats qui seront transmis √† vos fonctions (par exemple, les param√®tres d'une requ√™te HTTP), les objets de contexte peuvent √™tre utiles.  Par cons√©quent, certains d'entre eux les utilisent, rappelez-vous, par exemple, l'objet <code>Request</code> dans Symfony. <br><br><h2>  Injection de d√©pendance </h2><br>  Une autre bonne alternative aux √©tats mutables globaux serait d'incorporer directement les donn√©es dont vous avez besoin dans l'objet d√®s que vous le cr√©ez.  C'est la d√©finition de l'injection de d√©pendance: un ensemble de techniques pour incorporer des objets dans vos composants (classes). <br><br><h3>  Pourquoi exactement l'injection de d√©pendance? </h3><br>  Le but est de limiter l'utilisation de vos variables, objets ou autres constructions et de les placer dans une port√©e limit√©e.  Si vous avez des d√©pendances qui sont incorpor√©es et ne peuvent donc agir que dans le cadre d'un objet, il vous sera plus facile de d√©couvrir dans quel contexte elles sont utilis√©es et pourquoi.  Pas d'angoisse ni de tourment! <br><br>  L'injection de d√©pendance divise le cycle de vie de l'application en deux phases importantes: <br><br><ol><li>  Cr√©ation d'objets d'application et impl√©mentation de leurs d√©pendances. <br></li><li>  Utilisez des objets pour atteindre vos objectifs. <br></li></ol><br>  Cette approche rend le code plus clair; vous n'avez pas besoin d'instancier tout √† des endroits al√©atoires ou, pire encore, d'utiliser des objets globaux partout. <br><br>  De nombreux frameworks utilisent l'injection de d√©pendances, parfois dans des sch√©mas assez complexes, avec des fichiers de configuration et un conteneur d'injection de d√©pendances (DIC).  Mais ce n'est pas du tout n√©cessaire de compliquer les choses.  Vous pouvez simplement cr√©er des d√©pendances √† un niveau et les impl√©menter √† un niveau inf√©rieur.  Par exemple, dans le monde de Go, je ne connais personne qui utiliserait DIC.  Vous cr√©ez simplement les d√©pendances dans le fichier principal avec le code (main.go), puis les transf√©rez au niveau suivant.  Vous pouvez √©galement tout instancier dans diff√©rents packages afin d'indiquer clairement que la ¬´phase d'injection de d√©pendance¬ª ne doit √™tre effectu√©e qu'√† ce niveau sp√©cifique.  Dans Go, la port√©e des packages peut rendre les choses plus faciles qu'en PHP, dans lequel les DIC sont largement utilis√©s dans tous les frameworks que je connais, y compris Symfony et Laravel. <br><br><h3>  Impl√©mentation via constructeur ou setters </h3><br>  Il existe deux fa√ßons d'injecter des d√©pendances: via le constructeur ou les setters.  Je conseille, si possible, de s'en tenir √† la premi√®re m√©thode: <br><br><ul><li>  Si vous avez besoin de savoir ce que sont les d√©pendances de classe, il vous suffit de trouver un constructeur.  Pas besoin de chercher des m√©thodes dispers√©es dans la classe. <br></li><li>  La d√©finition de d√©pendances lors de l'installation vous donnera confiance dans la s√©curit√© d'utilisation de l'objet. <br></li></ul><br>  Parlons un peu du dernier point: cela s'appelle ¬´forcer l'invariant¬ª.  En cr√©ant une instance d'un objet et en impl√©mentant ses d√©pendances, vous savez que peu importe ce dont votre objet a besoin, il est configur√© correctement.  Et si vous utilisez des setters, comment savez-vous que vos d√©pendances sont d√©j√† d√©finies au moment de l'utilisation de l'objet?  Vous pouvez aller sur la pile et essayer de savoir si les setters ont √©t√© appel√©s, mais je suis s√ªr que vous ne voulez pas faire √ßa. <br><br><h1>  Violation d'encapsulation </h1><br>  Apr√®s tout, la seule diff√©rence entre les √âtats locaux et mondiaux est leur port√©e.  Ils sont limit√©s pour les √âtats locaux et pour le monde entier, l'application enti√®re est disponible.  Cependant, vous pouvez rencontrer des probl√®mes sp√©cifiques aux √©tats globaux si vous utilisez des √©tats locaux.  Pourquoi? <br><br><h2>  Vous avez dit encapsulation? </h2><br>  L'utilisation d'√©tats globaux finira par rompre l'encapsulation, tout comme vous pouvez la rompre avec des √©tats locaux. <br><br>  Commen√ßons par le d√©but.  Que nous dit <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Wikipedia</a> sur la d√©finition de l'encapsulation?  Le m√©canisme de langage pour restreindre l'acc√®s direct √† certains composants d'un objet.  Restriction d'acc√®s?  Pourquoi? <br><br>  Eh bien, comme nous l'avons vu ci-dessus, il est beaucoup plus facile de raisonner sur le plan local que sur le plan mondial.  Les √©tats mutables mondiaux sont, par d√©finition, disponibles partout, et c'est contre l'encapsulation!  Aucune restriction d'acc√®s pour vous. <br><br><h2>  Port√©e croissante et fuite d'√©tat </h2><br><img src="https://habrastorage.org/getpro/habr/post_images/0a4/466/ed1/0a4466ed1a0cb8710127f819e160be0f.jpg"><br><br>  Imaginons un √©tat dans sa petite port√©e.  Malheureusement, au fil du temps, l'application grandit, cet √©tat local est pass√© en argument √† la fonction tout au long de l'application.  D√©sormais, vos param√®tres r√©gionaux sont utilis√©s dans de nombreuses √©tendues et, dans tous, l'acc√®s direct aux param√®tres r√©gionaux est autoris√©.  Il est d√©sormais difficile pour vous de calculer l'√©tat exact des param√®tres r√©gionaux sans examiner toutes les zones de visibilit√© dans lesquelles ils existent et o√π ils peuvent √™tre modifi√©s.  Tout cela, nous l'avons d√©j√† vu avec les √âtats mutables mondiaux. <br><br>  Prenons un exemple: le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">mod√®le de domaine an√©mique</a> peut augmenter la port√©e de vos mod√®les mutables.  En fait, le mod√®le de domaine an√©mique divise les donn√©es et le comportement de vos objets de domaine en deux groupes: les mod√®les (objets avec donn√©es uniquement) et les services (objets uniquement avec comportement).  Le plus souvent, ces mod√®les seront utilis√©s dans tous les services.  Par cons√©quent, il est probable qu'une sorte de mod√®le augmentera constamment la port√©e.  Vous ne comprendrez pas quel mod√®le est utilis√© dans quel contexte, leur √©tat changera et tous les m√™mes probl√®mes vous tomberont dessus. <br><br>  Je veux transmettre une id√©e importante: si vous √©vitez les √©tats mutables mondiaux, cela ne signifie pas que vous pouvez vous d√©tendre, tenir un cocktail dans une main et appuyer sur les boutons de l'autre, en profitant de la vie et de votre code l√©gendaire. -, <a href="https://res.cloudinary.com/practicaldev/image/fetch/s--CWGA3Ax4--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/">    </a> ,  -,     ,           . <br><br>       ,       .   ,        . <br><br>     ?  -  .     ,         ,  -. <br><br> ,  -    ,    ,    .     ,      ,   ‚Äî  .    ,   :       ,   .           .      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a> . <br><br><h2>    </h2><br>            .      <code>Product</code> , ,   : <br><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Product</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createProduct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(array $productData)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Product</span></span></span><span class="hljs-function"> </span></span>{ $productData[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] = <span class="hljs-string"><span class="hljs-string">"SuperProduct"</span></span>.$productData[<span class="hljs-string"><span class="hljs-string">"name"</span></span>]; <span class="hljs-comment"><span class="hljs-comment">// This is not what you should do; I talk about it later in the article. try { $product = $this-&gt;productDao-&gt;find($productData["id"]); return product; } catch (NotFoundException $e) { $product = $this-&gt;productDao-&gt;save($productData); return $product; } } }</span></span></code> </pre> <br>  <code>$productData</code>   .      ,     ,      ,     . <br><br>         ,  .   ,   -   ?   ,        .         . <br><br>    ,       ,    .    . <br><br>   : <br><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Product</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createProduct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(array $productData)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Product</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// Since $productData is passed to other variable, it has to be immutable. $name = "SuperProduct".$productData["name"]; try { $product = $this-&gt;productDao-&gt;find($productData["id"]); return product; } catch (NotFoundException $e) { $product = $this-&gt;productDao-&gt;save($name, $productData); return $product; } } }</span></span></code> </pre> <br>   ,      ,       <code>$productData</code> .  ,   .      <code>$productData</code>    ,    ,        HTTP-. <br><br>          ,    : ¬´,     ¬ª. <br><br><h1>     ? </h1><br><img src="https://habrastorage.org/getpro/habr/post_images/0cd/d30/a3f/0cdd30a3fbd1097b15e7f5457d3d5c55.jpg"><br><br>        . ,    . <br><br>    ? <br><br><ul><li>      ,      ,      . <br></li><li>  ,      ,        (,     ) . <br></li></ul><br>          .  ,      . <br><br>  ,  <code>ShipmentDelay</code>  , ,  ,     .   ,  -,   <code>ShipmentDelay</code>   ,    ,      ,     . ?    ,         <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> DRY</a> . <br><br>           ,      ,     .       :      ,   ,        .  ,       ,    ,      .          ,    ,        . <br><br><h1>        ? </h1><br>  ,      (,   ),   ,    ,        .       ,    ,   ,    ,   . <br><br>    .  : <br><br><ul><li>        . <br></li><li>            ,     . <br></li><li>   ‚Äî   :         ,    ,        . <br></li><li>     ,        . <br></li></ul><br>           .       ,       ‚Äî      .  ,      . <br><br>   ,         ,  . <br><br>        ,   ,   .    ,        .  ,     ,     .  ,       ! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr454946/">https://habr.com/ru/post/fr454946/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr454932/index.html">Investissements et logiciels: 5 terminaux de trading pour n√©gocier en bourse</a></li>
<li><a href="../fr454936/index.html">Vivaldi: le blocage des publicit√©s devrait √™tre le choix de l'utilisateur</a></li>
<li><a href="../fr454938/index.html">D√©veloppement de son propre noyau pour l'int√©gration dans un syst√®me de processeur bas√© sur FPGA</a></li>
<li><a href="../fr454940/index.html">Assurance sant√© voyage: instructions d√©taill√©es</a></li>
<li><a href="../fr454944/index.html">Fonctionnement du format JPEG</a></li>
<li><a href="../fr454958/index.html">Un regard int√©rieur: √©cole doctorale √† l'EPFL. Partie 4.1: vie quotidienne</a></li>
<li><a href="../fr454960/index.html">Microbiota. Comment les m√©dicaments affectent les bact√©ries intestinales</a></li>
<li><a href="../fr454962/index.html">Comment les entreprises informatiques dans le monde se prot√®gent-elles des concurrents face aux anciens employ√©s?</a></li>
<li><a href="../fr454964/index.html">L'utilisation de la vision par ordinateur dans la recherche marine ou 12 personnes sur la poitrine d'un homme mort</a></li>
<li><a href="../fr454966/index.html">Cr√©ez des jeux instantan√©s sur Unity sur Google Play Instantan√©e</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>