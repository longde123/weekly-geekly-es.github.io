<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üåßÔ∏è üö≤ üë©‚Äç‚ù§Ô∏è‚Äçüë® Implementaci√≥n t√≠pica de monitoreo. Nikolay Sivko üòà üëÑ üë©üèæ‚Äçü§ù‚Äçüë®üèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Decodificaci√≥n del informe "Implementaci√≥n t√≠pica de monitoreo" por Nikolay Sivko. 


 Me llamo Nikolai Sivko. Tambi√©n hago monitoreo. Okmeter es el 5...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Implementaci√≥n t√≠pica de monitoreo. Nikolay Sivko</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/473728/"><p>  Decodificaci√≥n del informe "Implementaci√≥n t√≠pica de monitoreo" por Nikolay Sivko. </p><br><p>  Me llamo Nikolai Sivko.  Tambi√©n hago monitoreo.  Okmeter es el 5 monitoreo que hago.  Decid√≠ que salvar√≠a a todas las personas del infierno de la vigilancia y salvaremos a alguien de este sufrimiento.  Siempre trato de no anunciar un okmeter en mis presentaciones.  Naturalmente, las fotos ser√°n de all√≠.  Pero la idea de lo que quiero decir es que hacemos que el monitoreo sea un enfoque ligeramente diferente de lo que todos usualmente hacen.  Hablamos mucho de esto.  Cuando tratamos de convencer a cada persona individual en esto, al final se convence.  Quiero hablar sobre nuestro enfoque precisamente para que si usted mismo realiza el monitoreo, evite nuestro rastrillo. </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/btKYOueAAzc" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><a name="habracut"></a><br><p><img src="https://habrastorage.org/webt/za/jq/fi/zajqfi-zfkopot4qxgmw79zgnp8.png"></p><br><p>  Sobre el Okmeter en pocas palabras.  Hacemos lo mismo que usted, pero hay todo tipo de fichas.  Chips: </p><br><ul><li>  detalles; </li><li>  una gran cantidad de disparadores preconfigurados que se basan en los problemas de nuestros clientes; </li><li>  Configuraci√≥n autom√°tica </li></ul><br><p><img src="https://habrastorage.org/webt/nj/n0/vs/njn0vsnh6hfcyvjuejxy7qtopek.png"></p><br><p>  Un cliente t√≠pico viene a nosotros.  √âl tiene dos tareas: </p><br><p>  1) comprender que todo se descompuso de la supervisi√≥n, cuando no hay nada en absoluto. </p><br><p>  2) arreglarlo r√°pidamente. </p><br><p>  Viene a monitorear las respuestas de lo que le est√° sucediendo. </p><br><p><img src="https://habrastorage.org/webt/ig/ff/fl/igffflnnpqwybqqxxw1yd0nb9tw.png"></p><br><p>  Lo primero que hacen las personas que no tienen nada es poner <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://www.pingdom.com/</a> y otros servicios para su verificaci√≥n.  La ventaja de esta soluci√≥n es que se puede hacer en 5 minutos.  Ya no aprender√° sobre el problema de las llamadas de los clientes.  Hay problemas con la precisi√≥n para que se salten los problemas.  Pero para sitios simples, esto es suficiente. </p><br><p><img src="https://habrastorage.org/webt/cz/hb/td/czhbtddbrnh7n0msqxzrqxn8_wq.png"></p><br><p>  Lo segundo que recomendamos es contar por los registros de acuerdo con las estad√≠sticas de los usuarios reales.  Eso es lo que un usuario en particular obtiene errores 5xx.  ¬øCu√°l es el tiempo de respuesta de los usuarios?  Hay desventajas, pero en general, tal cosa funciona. </p><br><p><img src="https://habrastorage.org/webt/4g/ka/bk/4gkabkle1j9w96av-pkspnlwtis.png"></p><br><p>  Acerca de nginx: lo hicimos para que cualquier cliente que venga inmediatamente coloque al agente en la interfaz y todo lo recoja autom√°ticamente, comience a analizarse, comiencen a aparecer errores, etc.  No tiene casi nada que configurar. </p><br><p><img src="https://habrastorage.org/webt/cf/ef/5p/cfef5pftq8hwwmmb1zqfwiqyf7m.png"></p><br><p>  Pero la mayor√≠a de los clientes no tienen temporizadores en los registros est√°ndar de nginx.  Este 90 por ciento de los clientes no quiere saber el tiempo de respuesta de su sitio.  Nos enfrentamos a esto todo el tiempo.  Es necesario expandir el registro nginx.  Luego, fuera de la caja, autom√°ticamente comenzamos a mostrar histogramas fuera de la caja.  Este es probablemente un aspecto importante del hecho de que el tiempo debe medirse. </p><br><p><img src="https://habrastorage.org/webt/qv/yx/_x/qvyx_xrqm7dg8vqcxkonum__aws.png"></p><br><p>  ¬øQu√© estamos sacando de all√≠?  En la pr√°ctica, tomamos m√©tricas en tales dimensiones.  Estas no son m√©tricas planas.  La m√©trica se llama index.request.rate, el n√∫mero de consultas por segundo.  Se detalla por: </p><br><ul><li>  el host del que elimin√≥ los registros; </li><li>  el registro del que se tomaron estos datos; </li><li>  http por m√©todo; </li><li>  estado http; </li><li>  estado de cach√© </li></ul><br><p>  Esta NO es cada URL espec√≠fica con todos los argumentos.  No queremos eliminar 100,000 m√©tricas del registro. </p><br><p><img src="https://habrastorage.org/webt/u6/ah/0r/u6ah0rgp43jp3mnzdrqjpet5sza.png"></p><br><p>  Queremos tomar 1000 m√©tricas.  Por lo tanto, estamos tratando de normalizar la URL, si es posible.  Toma la URL superior.  Y para las URL que son significativas, mostramos un gr√°fico de barras separado, 5xx por separado. </p><br><p><img src="https://habrastorage.org/webt/ij/dr/ir/ijdrirnx6vwpo9jfteyepp3ax_e.png"></p><br><p>  Aqu√≠ hay un ejemplo de c√≥mo esta m√©trica simple se convierte en gr√°ficos utilizables.  Este es nuestro DSL en la parte superior.  Prob√© este DSL para explicar la l√≥gica aproximada.  Tomamos todas las solicitudes nginx por segundo y las distribuimos en todas las m√°quinas que tenemos.  Conoc√≠ c√≥mo lo equilibramos, cu√°nto tenemos RPS total (solicitud por segundo, solicitudes por segundo). </p><br><p><img src="https://habrastorage.org/webt/mc/hv/sv/mchvsvendei8dswx2umciwkg8qu.png"></p><br><p>  Por otro lado, podemos filtrar esta m√©trica y mostrar solo 4xx.  En un gr√°fico 4xx, se pueden dise√±ar de acuerdo con el estado real.  Les recuerdo que esta es la misma m√©trica. </p><br><p><img src="https://habrastorage.org/webt/uk/14/vc/uk14vcumvrmenkg4mubhonkv5gu.png"></p><br><p>  En el gr√°fico, puede mostrar 4xx por URL.  Esta es la misma m√©trica. </p><br><p><img src="https://habrastorage.org/webt/1l/n4/g8/1ln4g8sgwvteebpsdsbg_xmtly8.png"></p><br><p>  Tambi√©n disparamos un histograma desde los registros.  Un histograma es la m√©trica response_time.histrogram, que en realidad es RPS con un par√°metro de nivel adicional.  Esto es solo un l√≠mite de tiempo en el que se obtiene la solicitud. </p><br><p><img src="https://habrastorage.org/webt/cb/3b/nh/cb3bnh0wosk9il_ntyywe3z1kiq.png"></p><br><p>  Dibujamos una solicitud: resuma todo el histograma y ord√©nelo en niveles: </p><br><ul><li>  Solicitudes lentas </li><li>  solicitudes r√°pidas; </li><li>  consultas promedio; </li></ul><br><p>  Tenemos una imagen que ya ha sido resumida por los servidores.  La m√©trica es la misma.  Su significado f√≠sico es comprensible.  Pero lo aprovechamos de maneras completamente diferentes. </p><br><p><img src="https://habrastorage.org/webt/og/_q/0a/og_q0acmw4ianhc6n5sc3z4aokq.png"></p><br><p>  En el gr√°fico, puede mostrar el histograma solo por URL que comience con "/ api".  Por lo tanto, miramos el histograma por separado.  Miramos cu√°nto en este momento.  Vemos cu√°ntas RPS hab√≠a en la URL "/ api".  La misma m√©trica, pero una aplicaci√≥n diferente. </p><br><p><img src="https://habrastorage.org/webt/lt/jw/46/ltjw46topobrcyeyyhkkigncknm.png"></p><br><p>  Algunas palabras sobre tiempos en nginx.  Hay request_time, que incluye el tiempo desde el inicio de la solicitud hasta la transferencia del √∫ltimo byte al socket al cliente.  Y hay upstream_response_time.  Necesitan ser medidos ambos.  Si simplemente eliminamos request_time, entonces ver√° retrasos debido a problemas de conectividad del cliente con su servidor, ver√° retrasos all√≠ si tenemos configurado el l√≠mite de solicitud c burst y el cliente en el ba√±o.  No entender√° si necesita reparar el servidor o llamar al proveedor de alojamiento.  En consecuencia, eliminamos ambos y queda aproximadamente claro lo que est√° sucediendo. </p><br><p><img src="https://habrastorage.org/webt/uy/xy/a9/uyxya9gyu-fr0ccab75sa7fjt3q.png"></p><br><p>  Con la tarea de comprender si el sitio funciona o no, creo que lo hemos resuelto m√°s o menos.  Hay errores  Hay imprecisiones.  Los principios generales son los siguientes. </p><br><p>  Ahora sobre el monitoreo de la arquitectura multinivel.  Porque incluso la tienda en l√≠nea m√°s simple tiene al menos una interfaz, seguida de un bitrix y una base.  Esto ya es muchos enlaces.  El punto general es que necesitas disparar algunos indicadores de cada nivel.  Es decir, el usuario est√° pensando en frontend.  Frontend est√° pensando en el backend.  Backend piensa en el backend vecino.  Y todos piensan en la base.  Entonces, por capas, por dependencias, pasamos.  Cubrimos todo con alg√∫n tipo de m√©trica.  Tenemos algo en la salida. </p><br><p><img src="https://habrastorage.org/webt/nq/ov/rx/nqovrxw3la9pl8bkrufpklydrii.png"></p><br><p>  ¬øPor qu√© no limitarse a una capa?  T√≠picamente, entre las capas hay una red.  Una red grande bajo carga es una sustancia extremadamente inestable.  Por lo tanto, todo sucede all√≠.  Adem√°s, esas medidas que haces en qu√© capa pueden estar.  Si toma medidas en la capa "A" y la capa "B", y si interact√∫an entre s√≠ a trav√©s de la red, puede comparar sus lecturas, encontrar algunas anomal√≠as e inconsistencias. </p><br><p><img src="https://habrastorage.org/webt/7a/kq/ov/7akqovksuz3bhdmaxez5vcibepk.png"></p><br><p>  Sobre el backend.  Queremos entender c√≥mo monitorear el backend.  Qu√© hacer con √©l para comprender r√°pidamente lo que est√° sucediendo.  Les recuerdo que ya hemos pasado a la tarea de minimizar el tiempo de inactividad.  Y sobre el backend, sugerimos de manera est√°ndar la comprensi√≥n: </p><br><ul><li>  ¬øCu√°nto come este recurso? </li><li>  ¬øNos topamos con alg√∫n l√≠mite? </li><li>  ¬øQu√© est√° pasando con el tiempo de ejecuci√≥n?  Por ejemplo, la plataforma de tiempo de ejecuci√≥n JVM, el tiempo de ejecuci√≥n de Golang y otros tiempos de ejecuci√≥n. </li><li>  Cuando ya hemos cubierto todo esto, es interesante para nosotros ya m√°s cerca de nuestro c√≥digo.  Podemos usar la intrumetr√≠a autom√°tica (statsd, * -metric), que nos mostrar√° todo esto.  O instruirse estableciendo temporizadores, contadores, etc. </li></ul><br><p><img src="https://habrastorage.org/webt/wk/xq/6p/wkxq6ptxbigdvp3evm4t2mqh3lq.png"></p><br><p>  Sobre los recursos.  Nuestro agente est√°ndar elimina el consumo de recursos en todos los procesos.  Por lo tanto, para el backend, no necesitamos capturar datos por separado.  Tomamos y vemos cu√°nto consume la CPU el proceso, por ejemplo Python en los servidores enmascarados.  Mostramos todos los servidores en el cl√∫ster en el mismo gr√°fico, porque queremos entender si tenemos un desequilibrio y si algo explot√≥ en una m√°quina.  Vemos el consumo total de ayer a hoy. </p><br><p><img src="https://habrastorage.org/webt/t0/fl/oe/t0floe26e2hgev70o5fs18yf4ua.png"></p><br><p>  Lo mismo vale para la memoria.  Cuando lo dibujamos as√≠.  Seleccionamos Python RSS (RSS es el tama√±o de las p√°ginas de memoria asignadas al proceso por el sistema operativo y actualmente ubicadas en la RAM).  Suma por anfitri√≥n.  No miramos a ning√∫n lado la memoria fluye.  En todas partes la memoria se distribuye de manera uniforme.  En principio, recibimos una respuesta a nuestras preguntas. </p><br><p><img src="https://habrastorage.org/webt/zl/cu/yz/zlcuyz_bgzybypkgcndsotzdcsk.png"></p><br><p>  Ejemplo de tiempo de ejecuci√≥n.  Nuestro agente est√° escrito en Golang.  El agente de Golang se env√≠a m√©tricas de su tiempo de ejecuci√≥n.  Esta es, en particular, la cantidad de segundos que el recolector de basura de Golang dedica a la recolecci√≥n de basura por segundo.  Vemos aqu√≠ que algunos servidores tienen m√©tricas diferentes de otros servidores.  Vimos una anomal√≠a.  Estamos tratando de explicar esto. </p><br><p><img src="https://habrastorage.org/webt/oj/ir/pu/ojirpuokww_ym6e1hg1yrwz_8ao.png"></p><br><p>  Hay otra m√©trica de tiempo de ejecuci√≥n.  Cu√°nta memoria se asigna por unidad de tiempo.  Vemos que los agentes con un tipo en la parte superior asignan m√°s memoria que los agentes que disminuyen.  A continuaci√≥n se muestran los agentes con un recolector de basura menos agresivo.  Esto es l√≥gico.  Cuanta m√°s memoria pase a trav√©s de usted, se asigna, se libera, mayor es la carga en el recolector de basura.  Adem√°s, de acuerdo con nuestras m√©tricas internas, entendemos por qu√© queremos tanta memoria en esas m√°quinas y menos en estas m√°quinas. </p><br><p><img src="https://habrastorage.org/webt/8h/4s/yq/8h4syq_g35fjhfdztsheuybzyrc.png"></p><br><p>  Cuando hablamos de instrumentaci√≥n, vienen todo tipo de herramientas como <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">http://pinba.org/</a> para php.  Pinba es una extensi√≥n para php de Badoo, que instala y conecta a php.  Le permite eliminar y enviar protobuf inmediatamente a trav√©s de UDP.  Tienen un servidor pinba.  Pero creamos un servidor Pinba incrustado en el agente.  PHP se env√≠a a s√≠ mismo cu√°nto gast√≥ CPU y memoria para tales scripts, cu√°nto tr√°fico es dado por dichos scripts, etc.  Aqu√≠ hay un ejemplo con Pinba.  Mostramos los 5 mejores scripts sobre consumo de CPU.  Vemos un valor at√≠pico violeta que es un punto manchado de PHP.  Repararemos el punto manchado de PHP o entenderemos por qu√© consume la CPU.  Ya hemos reducido el alcance del problema para que comprendamos los siguientes pasos.  Vamos a ver el c√≥digo y repararlo. </p><br><p><img src="https://habrastorage.org/webt/kx/el/vv/kxelvvi9xxzv4bfefhf4m0xbhay.png"></p><br><p>  Lo mismo ocurre con el tr√°fico.  Observamos los 5 scripts de tr√°fico principales.  Si esto es importante para nosotros, entonces vamos y entendemos. </p><br><p><img src="https://habrastorage.org/webt/nz/io/zs/nziozsp_7pzn3ej88j8t3bdpenk.png"></p><br><p>  Este es un cuadro sobre nuestras herramientas internas.  Cuando configuramos el temporizador a trav√©s de statsd y medimos las m√©tricas.  Lo hicimos para que la cantidad de tiempo total que pasa en la CPU o en anticipaci√≥n de alg√∫n recurso sea establecida por el controlador que estamos procesando actualmente, y por las etapas importantes de su c√≥digo: esperaron el cassander, esperaron la b√∫squeda el√°stica.  El gr√°fico muestra las 5 etapas principales para el manejador / metric / query.  En el gr√°fico, puede mostrar los 5 mejores controladores para el consumo de CPU, por lo que sucede dentro.  Est√° claro qu√© arreglar. </p><br><p>  Sobre el backend puedes ir m√°s profundo.  Hay cosas que hacen el rastreo.  Es decir, puede ver esta solicitud de usuario en particular con una cookie regular e IP regular que genera tantas solicitudes a la base de datos que esperaron tanto tiempo.  No podemos rastrear.  No estamos rastreando.  Todav√≠a podemos creer que no hacemos aplicaciones y monitoreo del rendimiento. </p><br><p><img src="https://habrastorage.org/webt/pr/zy/yf/przyyfqriaulwy_fe4swdvq2bco.png"></p><br><p>  Sobre la base de datos.  Lo mismo  Las bases de datos son el mismo proceso.  √âl consume recursos.  Si la base es muy sensible a la latencia, entonces hay caracter√≠sticas ligeramente diferentes.  Sugerimos verificar que no haya menos recursos, ni degradaci√≥n en los recursos.  Es ideal entender que si la base comenz√≥ a consumir m√°s de lo que consumi√≥, entonces entienda qu√© ha cambiado exactamente en su c√≥digo. </p><br><p><img src="https://habrastorage.org/webt/az/zc/lj/azzcljm0hkvcfxc1lgeqeukrdgq.png"></p><br><p>  Sobre los recursos.  Del mismo modo, observamos cu√°nto genera el proceso MySQL en nuestro disco.  Vemos que en promedio hay mucho, pero ocurren algunos picos.  Por ejemplo, entra una gran cantidad de inserci√≥n y comienza a escribir en el disco a las 15.15, 16.15, 17.15. </p><br><p><img src="https://habrastorage.org/webt/u8/vb/rc/u8vbrcgbovxfcalnkk7sph4rw2i.png"></p><br><p>  Sobre la degradaci√≥n de los recursos.  Por ejemplo, una bater√≠a RAID ha entrado en modo de mantenimiento.  Ella dej√≥ de ser un controlador como una bater√≠a en vivo.  En este punto, la cach√© de escritura se desconecta, la latencia de los discos de escritura aumenta.  En este punto, si la base de datos comenz√≥ a aburrirse mientras esperaba el disco, y usted sabe aproximadamente que con la misma carga en su escritura en el disco la latencia fue diferente, entonces verifique la bater√≠a en RAID. </p><br><p><img src="https://habrastorage.org/webt/j_/ap/qb/j_apqbgrlnp5zkiopa794hq0v4y.png"></p><br><p>  Recursos bajo demanda.  No es tan simple aqu√≠.  Depende de la base.  La base deber√≠a poder contar sobre s√≠ misma: qu√© solicitudes gasta recursos, etc.  El l√≠der en esto es PostgreSQL.  Tiene pg_stat_statements.  Puede comprender qu√© tipo de solicitud tiene utilizando una gran cantidad de CPU, disco de lectura y escritura y tr√°fico. </p><br><p>  En MySQL, para ser honesto, todo es mucho peor.  Tiene performance_schema.  De alguna manera funciona desde la versi√≥n 5.7.  A diferencia de una vista √∫nica en PostgreSQL, performance_schema es una tabla de vista del sistema 27 o 23 en MySQL.  A veces, si realiza consultas en las tablas incorrectas (en la vista incorrecta), puede malgastar MySQL. </p><br><p>  Redis tiene estad√≠sticas del equipo.  Ver√° que cierto comando usa mucha CPU, etc. </p><br><p>  Cassandra tiene momentos para consultar tablas espec√≠ficas.  Pero dado que Cassandra est√° dise√±ada para que se realice un tipo de consulta en la tabla, esto es suficiente para el monitoreo. </p><br><p><img src="https://habrastorage.org/webt/qx/gt/wo/qxgtwoplv8i3wnce0ncygyipfgw.png"></p><br><p>  Esta es Redis  Vemos que el morado usa mucha CPU.  Violet es un setex.  Setex - registro de clave con instalaci√≥n TTL.  Si esto es importante para nosotros, vamos a lidiar con eso.  Si esto no es importante para nosotros, solo sabemos a d√≥nde van todos los recursos. </p><br><p><img src="https://habrastorage.org/webt/78/x_/ng/78x_nghhya3bc-3zd2xtgd2kyxy.png"></p><br><p>  Cassandra  Vemos las 5 tablas principales para solicitudes de lectura por el tiempo de respuesta total.  Vemos este aumento.  Estas son consultas a la tabla, y aproximadamente entendemos que una consulta a esta tabla constituye una pieza de c√≥digo.  Cassandra no es una base de datos SQL en la que podemos hacer diferentes consultas en las tablas.  Cassandra se est√° volviendo cada vez m√°s miserable. </p><br><p><img src="https://habrastorage.org/webt/z3/ho/s3/z3hos3wz7mgt5yvh3jbw9sgodxi.png"></p><br><p>  Algunas palabras sobre el flujo de trabajo funcionan con incidentes.  Como yo lo veo. </p><br><p>  Sobre alerta.  Nuestra visi√≥n del flujo de trabajo de incidentes es diferente de lo que generalmente se acepta. </p><br><p><img src="https://habrastorage.org/webt/px/zd/n4/pxzdn4r9vdjznfd6hrr2x63nmxi.png"></p><br><p>  Severy cr√≠tico.  Le notificamos por SMS y todos los canales de comunicaci√≥n en tiempo real. </p><br><p>  Severy Info es una bombilla que puede ayudarlo con algo cuando trabaja con incidentes.  La informaci√≥n no se notifica en ning√∫n lado.  La informaci√≥n simplemente se cuelga y te dice que algo est√° sucediendo. </p><br><p>  Severy Warning es algo que puede ser notificado, tal vez no. </p><br><p><img src="https://habrastorage.org/webt/op/hd/az/ophdazu-e1tchrtymsdxetidpq8.png"></p><br><p>  Ejemplos cr√≠ticos </p><br><p>  El sitio no funciona en absoluto.  Por ejemplo, 5xx 100% o el tiempo de respuesta ha aumentado y los usuarios comenzaron a irse. </p><br><p>  Errores de l√≥gica de negocios.  Lo que es cr√≠tico  Es necesario medir dinero por segundo.  El dinero por segundo es una buena fuente de datos para Critical.  Por ejemplo, el n√∫mero de pedidos, promoci√≥n de anuncios y otros. </p><br><p><img src="https://habrastorage.org/webt/it/n3/em/itn3emdzqhe7lapptysa1nvlwjy.png"></p><br><p>  Flujo de trabajo con Cr√≠tico tal que este incidente no puede posponerse.  No puede hacer clic en Aceptar e ir a casa.  Si se le ocurri√≥ Critical y est√° tomando el metro, entonces debe salir del metro, salir, tomar un banco y comenzar a reparar.  De lo contrario, no es cr√≠tico.  A partir de estas consideraciones, construimos la gravedad restante para el atributo residual. </p><br><p><img src="https://habrastorage.org/webt/pq/ct/ww/pqctww-7nkjkjjdvmujjl9ntjrm.png"></p><br><p>  Advertencia  Ejemplos de advertencia. </p><br><ul><li>  El espacio en disco se agota. </li><li>  El servicio interno funciona durante mucho tiempo, pero si no tiene Cr√≠tico, significa que est√° condicionado de todos modos. </li><li>  Muchos errores en la interfaz de red. </li><li>  Lo m√°s controvertido es que el servidor no est√° disponible.  De hecho, si tiene m√°s de un servidor y el servidor no est√° disponible, esto es Advertencia.  Si no tiene 1 back-end de 100, entonces es est√∫pido despertarse de un SMS y se pondr√° nervioso. </li></ul><br><p>  Todos los dem√°s Severy est√°n dise√±ados para ayudarlo a lidiar con Critical. </p><br><p><img src="https://habrastorage.org/webt/ze/rv/je/zervjevqnr3gnnaqugze3h1jf-g.png"></p><br><p>  Advertencia  Abogamos por este enfoque para trabajar con Advertencia.  Preferiblemente Advertencia cerrada durante el d√≠a.  La mayor√≠a de nuestros clientes han deshabilitado la Notificaci√≥n de advertencia.  Por lo tanto, no tienen la llamada ceguera de monitoreo.  Esto significa doblar letras en el correo sin leer un directorio separado.  Los clientes han deshabilitado la alerta de advertencia. </p><br><p>  (Seg√∫n tengo entendido, el monitoreo puro es alertas innecesarias y desencadenantes agregados a las excepciones - nota del autor de la publicaci√≥n) </p><br><p>  Si utiliza la t√©cnica de monitoreo puro, si tiene 5 Advertencias nuevas, puede repararlas en modo silencioso.  No tuvieron tiempo de arreglarlo hoy, pero lo pospusieron hasta ma√±ana, si no de manera cr√≠tica.  Si la advertencia se enciende y se extingue, entonces esto debe ser torcido en el monitoreo para que nuevamente no se moleste.  Entonces ser√°s m√°s tolerante con ellos y, en consecuencia, la vida mejorar√°. </p><br><p><img src="https://habrastorage.org/webt/xp/92/lv/xp92lvui1q6xbawczc9ltl0osys.png"></p><br><p>  Ejemplos de informaci√≥n.  Es discutible que la alta utilizaci√≥n de CPU de muchos cr√≠ticos.  De hecho, si nada afecta, puede ignorar esta notificaci√≥n. </p><br><p><img src="https://habrastorage.org/webt/xb/nn/p1/xbnnp13tktiqtspilpycu2oaxba.png"></p><br><p>  Advertencia (tal vez veo informaci√≥n, una nota del autor de la publicaci√≥n), estas son las luces que se encienden cuando viene a reparar el Cr√≠tico.  Ver√° dos se√±ales de advertencia una al lado de la otra (tal vez haya un enlace de informaci√≥n - nota del autor de la publicaci√≥n).  Pueden ayudarlo a resolver el incidente con Critical.  Por qu√© no est√° claro el alto uso de CPU por separado en SMS o en una carta. </p><br><p>  La informaci√≥n sin sentido tambi√©n es mala.  Si los configura como una excepci√≥n, le encantar√° demasiado la informaci√≥n. </p><br><p><img src="https://habrastorage.org/webt/ra/rc/uc/rarcucyuedf9vp6v6keycnnjbz4.png"></p><br><p>  Principios generales para el dise√±o de alertas.  La alerta debe mostrar el motivo.  Esto es perfecto  Pero esto es dif√≠cil de lograr.  Aqu√≠ estamos trabajando a tiempo completo en la tarea y resulta ser una parte del √©xito. </p><br><p>  Todos hablan de la necesidad de adicci√≥n, auto-magia.  De hecho, si no recibe notificaciones de algo que no le interesa, entonces no habr√° demasiado.  En mi pr√°ctica, las estad√≠sticas muestran que una persona mirar√° el momento de un incidente cr√≠tico con sus ojos alrededor de cien bombillas en diagonal.  Encontrar√° el correcto all√≠ y no pensar√° que la dependencia ha ocultado las bombillas que me ayudar√≠an ahora.  En la pr√°ctica, esto funciona.  Todo lo que necesita hacer es limpiar las alertas innecesarias. </p><br><p><img src="https://habrastorage.org/webt/wq/i8/mm/wqi8mmyravgx7yllannlhsgdvg8.png"></p><br><p>  (Aqu√≠ se salt√≥ el video - nota del autor de la publicaci√≥n) </p><br><p><img src="https://habrastorage.org/webt/ys/t_/0d/yst_0dqqfwqnra1yz0krnccw7ae.png"></p><br><p>  Ser√≠a bueno clasificar estos tiempos de inactividad para poder trabajar con ellos m√°s adelante.  Por ejemplo, sacar conclusiones organizacionales.  Necesitas entender por qu√© estabas mintiendo.  Proponemos clasificar / dividir en las siguientes clases: </p><br><ul><li>  hecho por el hombre </li><li>  establecimiento de hoster </li><li>  vinieron bots </li></ul><br><p>  Si los clasificas, todos estar√°n felices. </p><br><p><img src="https://habrastorage.org/webt/_c/kz/ll/_ckzllbldi_jkamyonco194favy.png"></p><br><p>  SMS ha llegado.  Que estamos haciendo  Primero corremos para reparar todo.  Hasta ahora, nada es importante para nosotros, excepto el final del tiempo de inactividad.  Porque estamos motivados para mentir menos.  Luego, cuando el incidente se cerr√≥, deber√≠a cerrarse al sistema de monitoreo.  Creemos que el incidente debe verificarse mediante monitoreo.  Si su monitoreo no est√° configurado, es suficiente para asegurarse de que el problema haya terminado.  Esto debe ser retorcido.  Una vez cerrado el incidente, en realidad no est√° cerrado.  √âl espera mientras llegas al fondo de la raz√≥n.  Cualquier l√≠der, de hecho, primero debe asegurarse de que los problemas no se repitan.  Para que los problemas no se repitan, debe llegar al fondo de la raz√≥n.  Despu√©s de llegar al fondo del motivo, tenemos datos para clasificarlos.  Analizamos los motivos.  Luego, a medida que llegamos al fondo de la raz√≥n, debemos hacerlo en el futuro para que el incidente no vuelva a ocurrir: </p><br><ul><li>  Se necesitan dos personas por trimestre para escribir tal y tal l√≥gica en el backend. </li><li>  Necesito poner m√°s r√©plicas. </li></ul><br><p>  Es necesario asegurarse de que no ocurra exactamente el mismo incidente.  Cuando trabajas en ese flujo de trabajo a trav√©s de N iteraciones, la felicidad te espera, buen tiempo de actividad. </p><br><p>  ¬øPor qu√© los clasificamos?  Podemos tomar las estad√≠sticas del trimestre y comprender qu√© tiempo de inactividad le dio m√°s.  Entonces trabaje en esta direcci√≥n.  Puede trabajar en todos los frentes no ser√° muy efectivo, especialmente si tiene pocos recursos all√≠. </p><br><p><img src="https://habrastorage.org/webt/b9/os/oh/b9osohrb-qilf4mcb7ddcqjckju.png"></p><br><p>  Calculamos que quedamos all√≠ por tanto tiempo, por ejemplo, 90% debido al hoster.  Cobramos cambiamos este hoster.  Si la gente se mete con nosotros, los enviamos a cursos.   ,      - ‚Äî  .   .     ,     .    ,    . </p><br><p><img src="https://habrastorage.org/webt/js/gl/wp/jsglwpchvythu9tvkjnbruwtcr8.png"></p><br><p>  .      : </p><br><ul><li>  . </li><li>  . </li></ul><br><p>     ,    ,    .      ,    ,  . </p><br><p><img src="https://habrastorage.org/webt/nn/rb/fl/nnrbflbnglbwbwggjdxuipfuxss.png"></p><br><p> :    ,  .     : ,  ,    .   False Positive ( ),   ,    .       ? </p><br><p> :      .    10- frontend ,      .    9 frontend     nginx,   10-  ,     warning alert  .            .     ,     .          .    . </p><br><p> :       . ,      ,   load avarage 4  , -   load avarage 20  . </p><br><p> :        load avarage.      100       .   CPU usage   Hadoop  .          .       .    .     ,       ,     .      PostgreSQL    autovacuum,  worker autovacuum      .          99  . Warning     .  Critical     .    Critical 10 5  ,     Critical. </p><br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pregunta: ¬øEn qu√© punto y c√≥mo se determina el umbral? </font><font style="vertical-align: inherit;">¬øQui√©n est√° haciendo esto?</font></font></p><br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Respuesta: vienes a nosotros y dices: queremos hacer algunas cr√≠ticas de nuestro proyecto. </font><font style="vertical-align: inherit;">Si pones 10 5xx por segundo ahora, entonces cu√°ntas notificaciones recibir√≠as hace una semana.</font></font></p><br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Pregunta: ¬øCu√°l es la carga de todo este buen monitoreo? </font></font></p><br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Respuesta: En promedio, generalmente es invisible. </font><font style="vertical-align: inherit;">Pero si analiza 50,000 RPS ser√° del 1% al 10% de una CPU. </font><font style="vertical-align: inherit;">Como solo estamos monitoreando, optimizamos nuestro agente. </font><font style="vertical-align: inherit;">Medimos el desempe√±o del agente. </font><font style="vertical-align: inherit;">Si no tiene los recursos para monitorear en el servidor, est√° haciendo algo mal. </font><font style="vertical-align: inherit;">Siempre debe haber recursos para monitorear. </font><font style="vertical-align: inherit;">Si no lo hace, estar√° tan ciego al tacto para administrar su proyecto.</font></font></p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/473728/">https://habr.com/ru/post/473728/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../473716/index.html">Widgets accionados por mouse. Arrastra y suelta dentro de la ventana</a></li>
<li><a href="../473718/index.html">C√≥mo agregar cheques a NoVerify sin escribir una sola l√≠nea de c√≥digo Go</a></li>
<li><a href="../473720/index.html">Dos formas de hacer pruebas unitarias confiables</a></li>
<li><a href="../473722/index.html">Aislamiento remoto, ansiedad y depresi√≥n.</a></li>
<li><a href="../473726/index.html">No es suficiente saber qu√© son Mutex, Semaphore y async / await. Necesitas saber todo de quanta</a></li>
<li><a href="../473732/index.html">La historia del fraude en la construcci√≥n de una red de cable bajo el √Årtico por $ 1 mil millones</a></li>
<li><a href="../473740/index.html">CreateRemoteThread para Linux</a></li>
<li><a href="../473742/index.html">Impresoras de ingenier√≠a Epson para CAD y GIS y algunas palabras sobre "dise√±o robusto"</a></li>
<li><a href="../473748/index.html">Curva de Bezier al servicio de los economistas laborales</a></li>
<li><a href="../473750/index.html">Stereopi + WebRTC = telepresense en casa</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>