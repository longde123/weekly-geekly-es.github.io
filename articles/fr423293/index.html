<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🕕 💚 🚣🏾 Comment ne pas se tirer une balle dans la jambe avec une machine d'état 👩‍🔬 👋🏾 🥩</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="La machine à états est rarement utilisée par les développeurs mobiles. Bien que la majorité connaisse les principes du travail et les mette en œuvre f...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comment ne pas se tirer une balle dans la jambe avec une machine d'état</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/oleg-bunin/blog/423293/"> La machine à états est rarement utilisée par les développeurs mobiles.  Bien que la majorité connaisse les principes du travail et les mette en œuvre facilement de manière indépendante.  Dans l'article, nous allons déterminer quelles tâches sont résolues par la machine d'état en utilisant l'exemple des applications iOS.  L'histoire est appliquée dans la nature et est consacrée aux aspects pratiques du travail. <br><br>  Sous la coupe, vous trouverez une transcription étendue du discours d'Alexander <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">Sychev</a> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">Brain89</a> ) sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">AppsConf</a> , dans laquelle il a partagé ses options pour utiliser la machine d'état dans le développement d'applications non-jeu. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/GKMrJe3mfwU" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <b>À propos du conférencier:</b> Alexander Sychev a été engagé dans le développement iOS pendant huit ans, au cours desquels il a participé à la création d'applications simples et de clients complexes pour les réseaux sociaux et le secteur financier.  À l'heure actuelle, est un responsable technique chez Sberbank. <br><a name="habracut"></a><br>  Ils viennent à la programmation de nombreux domaines, ayant des antécédents et des expériences différents, donc nous rappelons d'abord la théorie de base. <br><br><h2>  Énoncé du problème <br></h2><br><img src="https://habrastorage.org/webt/ow/wa/vd/owwavd51w_12g14nwehehu4yfu4.jpeg"><br><br>  Une machine à états est une abstraction mathématique qui se compose de trois éléments principaux: <br><br><ul><li>  de nombreux états internes </li><li>  l'ensemble des signaux d'entrée qui déterminent la transition de l'état actuel au suivant, </li><li>  ensembles d'états finaux, à la transition vers lesquels l'automate termine son travail ("admet le mot d'entrée x"). </li></ul><br><h3>  Condition <br></h3><br>  Par état, nous entendons une variable ou un groupe de variables qui déterminent le comportement d'un objet.  Par exemple, dans l'application iOS standard «Paramètres <strong>»,</strong> il y a un élément «Gras» («Basique → Accès universel»).  La valeur de cet élément vous permet de basculer entre deux options pour afficher du texte sur l'écran de l'appareil. <br><br><img src="https://habrastorage.org/webt/mx/if/68/mxif68m4rgadt4kgjqovnzswvny.jpeg"><br><br>  En envoyant le même signal «Changer la valeur de l'interrupteur à bascule <strong>»</strong> , nous obtenons une réaction différente du système: soit le style de police habituel soit en gras - tout est simple.  Étant dans des états différents et recevant le même signal, un objet réagit différemment à un changement d'état. <br><br><h2>  Tâches traditionnelles <br></h2><br>  En pratique, les programmeurs rencontrent souvent une machine à états finis. <br><br><h3>  Applications de jeux <br></h3><br>  C'est la première chose qui me vient à l'esprit - dans le cadre du gameplay, presque tout est déterminé par l'état actuel du jeu.  Ainsi, Apple suppose l'utilisation de machines d'état principalement dans les applications de jeu (nous en discuterons en détail plus tard). <br><br>  Le comportement du système lors du traitement du même signal mais avec un état interne différent peut être illustré par les exemples suivants.  Par exemple: <br><br>  ● le personnage du jeu peut être de différentes forces: l'un en armure mécanique et avec un pistolet laser, et l'autre est faiblement pompé.  En fonction de cet état, le comportement des ennemis est déterminé: ils attaquent ou s'enfuient. <br><br><img src="https://habrastorage.org/webt/-9/ur/ci/-9urcijninqy6zo8as2i8adn46o.jpeg"><br><br>  ● le jeu est en pause - pas besoin de dessiner l'image actuelle;  le joueur en mode menu ou en cours de jeu - le rendu est complètement différent. <br><br><h3>  Analyse de texte <br></h3><br>  L'une des tâches d'analyse de texte les plus courantes associées à l'utilisation d'une machine d'état est les filtres anti-spam.  Soit un ensemble de mots vides et une séquence d'entrée.  Vous devez soit filtrer cette séquence, soit ne pas l'afficher du tout. <br><br><img src="https://habrastorage.org/webt/vo/ka/c2/vokac2-lpmhmsapxqmtked5buo4.jpeg"><br><br>  Formellement, c'est la tâche de trouver une sous-chaîne dans une chaîne.  Pour le résoudre, l'algorithme Knut-Morris-Pratt est utilisé, dont l'implémentation logicielle est une machine à états finis.  L'état est le décalage de la séquence d'entrée et le nombre de caractères trouvés dans le motif - mot d'arrêt. <br><br>  De plus, <strong>lors de l'analyse d'expressions régulières</strong> , des machines à états finis sont souvent utilisées. <br><br><h3>  Traitement parallèle des requêtes <br></h3><br>  Une machine d'état est l'une des options pour implémenter le traitement des demandes et exécuter un ensemble strict d'instructions. <br><br><img src="https://habrastorage.org/webt/i_/ll/n9/i_lln9kr6-tfmnr0ejx7mjn3ytk.jpeg"><br><br>  Par exemple, dans le serveur Web nginx, les demandes d'entrée de divers protocoles sont traitées à l'aide de machines d'état.  Selon le protocole spécifique, une implémentation spécifique de la machine à états est sélectionnée et, par conséquent, un ensemble d'instructions bien connu est exécuté. <br><br>  En général, deux classes de problèmes sont obtenues: <br><br><ul><li>  gérer la logique d'un objet complexe avec un état interne complexe, </li><li>  formation des flux de contrôle et de données (description de l'algorithme). </li></ul><br>  De toute évidence, ces tâches courantes sont rencontrées dans la pratique de tout programmeur.  Par conséquent, l'utilisation d'une machine d'état est possible, y compris dans les applications de contenu non liées aux jeux, qui sont impliquées dans la plupart des développeurs mobiles. <br><br>  Ensuite, nous analyserons où et quand la machine d'état peut être utilisée pour créer des applications iOS typiques. <br><br>  La plupart des applications mobiles ont une architecture en couches.  Il existe trois couches de base. <br><br><ul><li>  Couche de présentation. </li><li>  Couche logique métier. </li><li>  Un ensemble d'aides, de clients réseau, etc. (couche principale). </li></ul><br>  Comme indiqué ci-dessus, la machine à états contrôle les objets ayant un comportement complexe, c'est-à-dire  avec un état complexe.  Ces objets sont définitivement dans la couche de présentation, car il prend des décisions en traitant les entrées utilisateur ou les messages du système d'exploitation.  Examinons les différentes approches de son exécution. <br><br><img src="https://habrastorage.org/webt/ic/iq/pw/iciqpwtfuuokmoik0j5abflppg4.jpeg"><br><br>  Dans la métaphore architecturale classique de Model-View-Controller, l'état sera dans le contrôleur: il décide ce qui est affiché dans la vue et comment répondre aux signaux d'entrée: en appuyant sur un bouton, en changeant le curseur, etc.  Il est logique que l'une des implémentations du contrôleur soit une machine à états. <br><br><img src="https://habrastorage.org/webt/xt/sv/cr/xtsvcrd3ehffxfreo8ivtwx7jy8.jpeg"><br><br>  Dans VIPER, l'état est dans le présentateur: c'est lui qui détermine la transition de navigation spécifique à partir de l'écran courant et l'affichage des données dans la Vue. <br><br><img src="https://habrastorage.org/webt/_p/ob/xb/_pobxbwjjwduuken8qiucqg5o30.jpeg"><br><br>  Dans Model-View-ViewModel, l'état est dans le ViewModel.  Que nous ayons ou non des liants réactifs, le comportement du module défini dans la métaphore MVVM sera enregistré dans le ViewModel.  De toute évidence, sa mise en œuvre via une machine à états est une option acceptable. <br><br><img src="https://habrastorage.org/webt/x0/8e/kf/x08ekfoc9zyg1s9_9jiirethpgm.jpeg"><br><br>  Des objets complexes avec un ensemble d'états non triviaux sont également rencontrés sur la couche logique métier de l'application.  Par exemple, un client réseau, qui, selon qu'une connexion au serveur est établie ou non, envoie ou bloque les demandes.  Ou un objet pour travailler avec une base de données qui doit traduire des fonctions de langage en une requête SQL, l'exécuter, obtenir une réponse, la traduire en objets, etc. <br><br><img src="https://habrastorage.org/webt/pb/bq/yt/pbbqytlwgtmbcutdlliqv5xkwjs.jpeg"><br><br>  Dans des tâches plus spécifiques, comme un module de paiement, dans lequel un ensemble d'états plus large, une logique complexe, l'utilisation d'une machine d'état est également correcte. <br><br>  En conséquence, nous constatons que dans les applications mobiles, il existe de nombreux objets dont l'état et la logique de comportement sont décrits plus compliqués qu'avec une seule phrase.  Ils doivent être capables de gérer. <br><br>  Prenons un <strong>exemple réel</strong> et comprenez à quel point une machine à états finis est vraiment nécessaire et où son application n'est pas justifiée. <br><br><img src="https://habrastorage.org/webt/96/hk/lw/96hklw8ditorh2imz2zcx36wmga.jpeg"><br><br>  Considérez le ViewController de l'application iOS Championship, une ressource sportive populaire.  Ce contrôleur affiche un ensemble de commentaires sous forme de tableau.  Les utilisateurs entrent la description du match, regardent les photos, lisent les nouvelles et laissent leurs commentaires.  L'écran est assez simple: la couche sous-jacente donne des données, elles sont traitées et affichées à l'écran. <br><img src="https://habrastorage.org/webt/m7/m1/yz/m7m1yz9--h4qttlcuxjrozagl48.jpeg"><br><br>  Des données réelles ou une erreur peuvent être transmises à l'écran.  Ainsi, le premier opérateur conditionnel apparaît, la première branche, qui détermine le comportement ultérieur de l'application. <br><br>  La question suivante est de savoir quoi faire s'il n'y a pas de données.  Cette condition est-elle une erreur?  Probablement pas: toutes les nouvelles ne contiennent pas de commentaires des utilisateurs.  Par exemple, le hockey en Égypte intéresse peu de monde; dans un tel article, il n'y a généralement pas de commentaires.  Il s'agit d'un comportement normal et de l'état normal de l'écran que vous devez pouvoir afficher.  Ainsi, le deuxième opérateur conditionnel apparaît. <br><br>  Il est logique de supposer qu'il existe également un état de démarrage dans lequel l'utilisateur attend des données (par exemple, lorsque l'écran de commentaire n'apparaît qu'à l'écran).  Dans ce cas, affichez correctement l'indicateur de chargement.  Il s'agit de la troisième déclaration conditionnelle. <br><br>  Nous avons donc déjà quatre états sur un seul écran, dont la logique d'affichage est décrite par la construction if-else-if-else. <br><br><img src="https://habrastorage.org/webt/ys/yg/mq/ysygmq4fbj3mog3p6mjb0t5av9o.jpeg"><br><br>  Mais que se passe-t-il s'il y en a plus?  Le développement itératif de l'écran conduit à un enchevêtrement complexe de constructions conditionnelles, à un tas de drapeaux ou à un boîtier de commutation multiple encombrant.  Ce code fait peur.  Imaginez que le développeur qui le soutiendra sache où vous vivez et qu'il a une tronçonneuse qu'il porte toujours avec lui.  Et vous voulez vraiment vivre votre petite pension bien méritée. <br><br>  Je pense que dans ce cas, il vaut la peine de considérer s'il vaut la peine de laisser une telle implémentation dans l'application. <br><br><h3>  Inconvénients <br></h3><br>  Comprenons ce que nous n'aimons pas à propos de ce code. <br><br><img src="https://habrastorage.org/webt/2u/a-/67/2ua-67iwmlvw9zki5oxmjf4mfqe.jpeg"><br><br>  Tout d'abord, c'est <strong>difficile à lire</strong> . <br><br>  Étant donné que le code est mal lu, cela signifie qu'il sera difficile pour un nouveau développeur de comprendre exactement ce qui est implémenté à un endroit particulier du projet.  Par conséquent, cela passera beaucoup de temps à analyser la logique de comportement des applications - le <strong>coût du support et du développement augmentera</strong> . <br><br>  Ce code n'est pas <strong>flexible</strong> .  Si vous devez ajouter un nouvel état qui ne découle pas de l'échelle actuelle, il peut ne pas réussir du tout!  Si vous avez besoin d'un passage traversant - arrêtez brusquement de passer les contrôles sur cette échelle - comment le faire?  Presque rien. <br><br>  De plus, avec cette approche, <strong>il n'y a aucune protection contre les états fictifs</strong> .  Lorsque les transitions sont décrites via un boîtier de commutation, le comportement par défaut est très probablement implémenté.  Cet état est logique en termes de comportement du programme, mais difficilement logique en termes de logique humaine ou métier de l'application. <br><br>  Quelle peut être la solution aux lacunes indiquées?  Bien sûr, c'est la construction de la logique de chaque module / contrôleur / objet complexe, non pas basée sur l'intuition, mais en utilisant une bonne approche formalisée.  Par exemple, une machine à états finis. <br><br><h2>  Gameplaykit <br></h2><br>  À titre d' <strong>exemple,</strong> nous prenons ce que propose Apple.  Dans le cadre du cadre GameplayKit, il existe deux classes qui nous aident à travailler avec la machine à états. <br><br><ul><li>  GKState. </li><li>  GKStateMachine. </li></ul><br>  Le nom du cadre indique clairement qu'Apple voulait être utilisé dans les jeux.  Mais <strong>dans les applications non ludiques,</strong> cela sera utile. <br><br><img src="https://habrastorage.org/webt/pz/ez/de/pzezdem8jc81mab3alsm3e8pqwo.png"><br><br>  La classe <strong>GKState</strong> définit l'état.  Pour le décrire, vous devez effectuer des étapes simples.  Nous héritons de cette classe, définissons le nom de l'état et définissons trois méthodes. <br><br><ul><li>  isValidNextState - si l'état actuel est valide sur la base du précédent. </li><li>  didEnterFrom - actions sur la transition vers cet état. </li><li>  willExitTo - actions à la sortie de cet état. </li></ul><br><br><img src="https://habrastorage.org/webt/z2/q2/gj/z2q2gj0bg2-vsoejvz0crdbhmb4.png"><br><br>  <strong>GKStateMachine est</strong> une classe de machine à états.  C’est encore plus simple.  Il suffit d'effectuer deux actions. <br><br><ul><li>  Nous passons l'ensemble des états d'entrée au tableau typé via l'initialiseur. </li><li>  Nous faisons des transitions en fonction des signaux d'entrée en utilisant la méthode enter.  Grâce à elle, l'état initial est également défini. </li></ul><br>  Il peut être déroutant que n'importe quelle classe soit passée comme argument à la méthode <strong>enter</strong> .  Mais il convient de noter qu'un objet de n'importe quelle classe ne peut pas être défini dans un tableau d'états <strong>-</strong> cela interdit le typage strict.  Par conséquent, si vous définissez une classe arbitraire comme classe d'état suivante, rien ne se produira et la méthode enter retournera false. <br><br><h3>  États et transitions entre eux <br></h3><br>  Après avoir pris connaissance du framework d'Apple, revenons à l'exemple.  Il est nécessaire de décrire les états et les transitions entre eux.  Vous devez le faire de la manière la plus compréhensible.  Il existe deux options courantes: un tableau ou un graphique de transition.  Le graphique de transition, à mon avis, est une option plus compréhensible.  Il est en UML de manière standardisée.  Par conséquent, nous le choisissons. <br><br>  Dans le graphique de transition, il y a des états qui sont décrits par des noms et des flèches qui relient ces états pour décrire les transitions.  Dans l'exemple, il y a un état initial <strong>-</strong> nous attendons des données <strong>-</strong> et il y a trois états qui peuvent être atteints à partir de celui initial: données reçues, pas de données et erreur. <br><br><img src="https://habrastorage.org/webt/cg/dn/gs/cgdngsj7omvfgbfvkpdgtazpeva.jpeg"><br><br>  Dans l'implémentation, nous obtenons quatre petites classes. <br><br><img src="https://habrastorage.org/webt/qo/tc/rq/qotcrq6wbihios-sonhj8ajfhey.png"><br><br>  Analysons l'état "Données en attente".  A l'entrée, il vaut la peine d'afficher l'indicateur de téléchargement.  Et lorsque vous quittez cet état <strong>,</strong> cachez-le.  Pour ce faire, vous devez avoir un lien faible vers le ViewController, qui est contrôlé par la machine d'état créée. <br><br><img src="https://habrastorage.org/webt/p8/41/aa/p841aapjpxsvcqirsklkcy9o4us.png"><br><br><h3>  Paramètres machine <br></h3><br>  La deuxième étape à effectuer <strong>consiste</strong> à définir les paramètres de la machine d'état.  Pour ce faire, créez des états et transférez-les vers l'objet automate. <br><br><img src="https://habrastorage.org/webt/zd/ww/pm/zdwwpm8i_i6lxoxjkzh_a2deqzi.jpeg"><br><br>  Veillez également à définir l'état initial <br><br><img src="https://habrastorage.org/webt/mx/sg/ka/mxsgkacbkni4fjczcvsagtec8lm.png"><br><br>  En principe, tout, la machine est prête.  Maintenant, il est nécessaire de traiter les réactions aux événements externes, en changeant l'état de l'automate. <br><br><img src="https://habrastorage.org/webt/_c/jt/hf/_cjthf0r7-5d5u0fdxucgksdz2w.png"><br><br>  Rappelez l'énoncé du problème.  Nous avons obtenu une échelle de if-else, sur la base de laquelle il a été décidé de l'action à effectuer.  En tant que contrôle pour un automate simple, une telle option d'implémentation peut être (en fait, un simple commutateur <strong>-</strong> il s'agit d'une implémentation primitive d'une machine à états finis), mais nous ne nous débarrassons pratiquement pas des inconvénients mentionnés précédemment. <br><br>  Il existe une autre approche qui vous permettra de vous éloigner de ces échelles.  Il est proposé par les classiques de la programmation <strong>- le</strong> soi-disant «gang de quatre». <br><br><img src="https://habrastorage.org/webt/qv/if/sf/qvifsfqe0iqs3rsroauy4bptayg.jpeg"><br><br>  Il existe un modèle de conception spécial, appelé «État». <br><br><img src="https://habrastorage.org/webt/nd/eh/wp/ndehwptccwh7lh90dmsixkzybo0.jpeg"><br><br>  Il s'agit d'un modèle de comportement similaire à une stratégie qui décrit une abstraction de la machine à états.  Il permet à l'objet de changer son comportement en fonction de l'état.  Le but principal de l'application <strong>est d'</strong> encapsuler le comportement et les données associés à un état particulier dans une classe distincte.  Ainsi, la machine à états, qui a initialement pris la décision de l'état à provoquer, va maintenant transmettre un signal, le traduire en état, et l'état prendra une décision.  Déchargez donc partiellement l'échelle et le code deviendra plus agréable à utiliser. <br><br>  Le cadre standard ne sait pas comment.  Il suggère que <strong>GKStateMachine</strong> prendra la décision.  Par conséquent, nous développons la machine à états finis avec une nouvelle méthode, où en tant que configuration, nous passons la description de toutes les variables conditionnelles qui déterminent de manière unique l'état suivant.  Dans cette méthode, vous pouvez déléguer la sélection de l'état suivant à l'état actuel. <br><br><img src="https://habrastorage.org/webt/gu/sw/nr/guswnro2dw8m3fsctqqjx8_7js8.png"><br><br>  Il est recommandé de décrire l'état avec un seul objet et de toujours le transmettre, plutôt que d'écrire de nombreux paramètres d'entrée.  Ensuite, nous déléguons le choix de l'état suivant à l'état actuel.  C'est toute la mise à niveau. <br><br><img src="https://habrastorage.org/webt/te/9t/5a/te9t5acirqz1o5awpxzy1tsbyia.png"><br><br>  <strong>Avantages de GameplayKit.</strong> <br><br><ul><li>  Bibliothèque standard.  Pas besoin de télécharger quoi que ce soit, d'utiliser des cocoapodes ou des carthages. </li><li>  La bibliothèque est assez facile à apprendre. </li><li>  Il existe deux implémentations à la fois: sur Objective-C et sur Swift. </li></ul><br>  <strong>Inconvénients:</strong> <br><br><ul><li>  Les réalisations des états et des transitions sont étroitement liées. <br>  Le principe de la responsabilité exclusive est violé: l'État sait où il va et comment. </li><li>  Les états en double ne sont en aucun cas contrôlés. <br>  Un tableau est transmis à la machine d'état, pas beaucoup d'états.  Si vous transférez plusieurs états identiques, le dernier de la liste sera utilisé. </li></ul><br>  Quelles sont les autres implémentations de machines à états finis?  Jetez un œil à GitHub. <br><br><h2>  Implémentations Objective-C <br></h2><br><img src="https://habrastorage.org/webt/vo/zt/zy/voztzyatty-amllrmtl8ny4ke3c.png"><br><br><h3>  TransitionKit <br></h3><br>  Il s'agit de la bibliothèque Objective-C la plus populaire depuis longtemps, sans carences identifiées dans GamePlayKit.  Il nous permet d'implémenter une machine à états et toutes les actions qui lui sont associées sur des blocs. <br><br>  <strong>L'état est séparé des transitions</strong> . <br><br>  Dans TransitionKit, il y a 2 classes. <br><br><ol><li>  TKState - pour définir les états et les actions d'entrée et de sortie. </li><li>  TKEvent est une classe pour décrire la transition. <br>  TKEvent lie certains États à d'autres.  L'événement lui-même est défini simplement par une chaîne. </li></ol><br>  De plus, il y a des avantages supplémentaires. <br><br>  <strong>Vous pouvez transférer des données utiles pendant la transition</strong> .  Cela fonctionne de la même manière que lorsque vous utilisez NSNotificationCenter.  Toute charge utile utile se présente sous la forme d'un dictionnaire userInfo, et l'utilisateur analyse les informations. <br><br>  <strong>La transition erronée a une description</strong> .  Lorsque nous essayons de faire une transition inexistante - impossible - nous obtenons non seulement la valeur NO lors du retour de la méthode de transition, mais aussi une description détaillée de l'erreur, qui est utile lors du débogage d'une machine à états. <br><br><img src="https://habrastorage.org/webt/hi/x9/bx/hix9bx5ctgjldoay4btqajopgb0.jpeg"><br><br>  TransitionKit est utilisé dans la moissonneuse réseau populaire RestKit.  Ceci est un assez bon exemple de la façon dont une machine d'état peut être utilisée dans le noyau d'application lors de l'implémentation des opérations réseau. <br><br><img src="https://habrastorage.org/webt/ls/os/d3/lsosd3z1zbg5knnmbrggmpq2zro.jpeg"><br><br>  RestKit a une classe spéciale - RKOperationStateMachine - pour gérer les opérations simultanées.  En entrée, il accepte l'opération en cours de traitement et la file d'attente pour son exécution. <br><br><img src="https://habrastorage.org/webt/r2/pn/mc/r2pnmcfsl_6uzdzhsin_mrq_vkg.jpeg"><br><br>  En interne, la machine à états est très simple: trois états (prêt, exécuté, terminé) et deux transitions: début et fin d'exécution.  Après le début du traitement (et à toutes les transitions), la machine d'état commence à contrôler un bloc de code utilisateur prédéfini dans la file d'attente spécifiée lors de la création de la file d'attente. <br><br>  Une opération associée à son automate transfère des événements externes à l'automate et effectue des transitions entre les états et toutes les actions associées.  La machine d'état prend soin de <br><br><ul><li>  exécution de code asynchrone, </li><li>  exécution de code atomique lors des transitions, </li><li>  contrôle de transition </li><li>  Annulation des opérations </li><li>  l'exactitude des variables d'état de changement de fonctionnement: isReady, isExecuting, isFinished. </li></ul><br><h3>  Shift <br></h3><br>  En plus de TransitionKit, il convient de mentionner séparément <strong>Shift</strong> - une minuscule bibliothèque implémentée en tant que catégorie sur NSObject.  Cette approche vous permet de transformer n'importe quel objet en machine à états, décrivant son état sous la forme de constantes de chaîne et d'actions en blocs pendant les transitions.  Bien sûr, il s'agit davantage d'un projet de formation, mais assez intéressant et vous permet d'essayer ce qu'est une machine d'état à un coût minimal. <br><br><h2>  Implémentations rapides <br></h2><br><img src="https://habrastorage.org/webt/_t/dx/kd/_tdxkdwt0sqzgy78o-q-_z0c_nq.png"><br><br>  Il existe de nombreuses implémentations de machines à états finis sur Swift.  J'en citerai un ( <strong>remarque</strong> : malheureusement, le projet n'a pas évolué au cours des deux dernières années après le rapport, mais les idées qu'il contient méritent d'être racontées dans l'article). <br><br><h3>  SwiftyStateMachine <br></h3><br>  Dans SwiftyStateMachine, la machine à états est représentée par une structure non stable; grâce aux méthodes didSet de la propriété, vous pouvez facilement détecter les changements d'état. <br><br>  Dans cette bibliothèque, la machine à états est définie à travers la table de correspondance des états et des transitions entre eux.  Ce schéma est décrit séparément de l'objet que la machine contrôlera.  Ceci est implémenté via un boîtier de commutation imbriqué. <br><br><img src="https://habrastorage.org/webt/y5/cz/dl/y5czdlkikmxb4kyylgwgxfsdxuy.png"><br><br>  ,    . <br><br><ul><li>       . <br>       ,        . </li><li>    . <br>    state machine ,         state machine. </li><li>    ,   ,      . </li><li> ,     DOT. <br>        state- — DOT.    ,  ,     . </li></ul><br><img src="https://habrastorage.org/webt/wb/zg/du/wbzgduy9duy-shpt0pcjjjt0ru8.jpeg"><br><br><h2>  Conclusion <br></h2><br>          . <br><br><ul><li> <strong>.</strong> <br>           ,     .    ,         . ,   . <br></li><li> <strong>  .</strong> <br>     ( ). <br></li><li> <strong> .</strong> <br>       ,    ,        . </li><li> <strong>       .</strong> , SwiftyStateMachine     ,    ,     .     . </li><li> <strong> .</strong> <br>   ,    . , ,      .       . <br></li></ul><br>        . <br><br><img src="https://habrastorage.org/webt/wb/ek/ww/wbekwwlr0a_w8wzt6z0bo12jdmm.jpeg"><br><br>       .      ,    .    , ,    switch case:  ,  ,  —     . <br><br><img src="https://habrastorage.org/webt/hq/ay/db/hqaydbygw58xgcalwyvph1haeho.jpeg"><br><br>  .    .    ,  .  ,    ,  ,     .    . <br><br><img src="https://habrastorage.org/webt/b9/mb/ze/b9mbze-xdkufz2mbs7p61obsjqo.jpeg"><br><br>      ,      ,      .     . <br><br><img src="https://habrastorage.org/webt/bc/qp/hr/bcqphramltmjhaakirn_uo00e4i.png"><br><br>    —  <strong> </strong> .       :      , —    . <br><br><img src="https://habrastorage.org/webt/iw/qz/we/iwqzwefnjh4xnqexwoovxccugqo.jpeg"><br><br><img src="https://habrastorage.org/webt/i4/80/vk/i480vkfuwmhwpdd31totlvl5298.jpeg"><br><br>   «-»     <strong> </strong> . <br><br><img src="https://habrastorage.org/webt/s-/kf/ox/s-kfoxsckujhbrzsslebpzuqwei.jpeg"><br><br> ,    .         . <br><br><img src="https://habrastorage.org/webt/le/oo/ju/leoojuz3yycfncczpfbgftsa1tq.jpeg"><br><br>        <strong>app coordinators</strong> —   ,     ,    : ,     .       ,       . <br><br>  , app coordinator ,  state machine.            . ,    app coordinators  state machine,         , ,  , <strong>  </strong> .      , ,   ,         .    . <br><br><img src="https://habrastorage.org/webt/mx/yu/1q/mxyu1qczcjazzunuhe7jfoolv2e.png"><br><br> , state machine  ,    ,         . <br><br>     state machine  ,     if-else.   ,         . <br><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cette année, à Apps Conf 2018, qui se tiendra les 8 et 9 octobre, Alexander </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">prévoit de discuter de</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cinq principes de base de la programmation orientée objet et des limites de leur applicabilité. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour plus de rapports sur le développement mobile, consultez notre </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">chaîne YouTube</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Et si vous souhaitez recevoir des informations sur les nouvelles transcriptions et les rapports intéressants, abonnez-vous à la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">newsletter</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br></blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr423293/">https://habr.com/ru/post/fr423293/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr423279/index.html">Comment j'ai développé la tablette russe</a></li>
<li><a href="../fr423281/index.html">Feedback dans l'équipe, 360 et 14 février</a></li>
<li><a href="../fr423283/index.html">Modélisation de l'effet Sagnac à l'aide de l'optique géométrique</a></li>
<li><a href="../fr423285/index.html">Ingénierie sociale: l'ennemi insaisissable dans le monde de la cybersécurité</a></li>
<li><a href="../fr423291/index.html">Les Russes établissent un record: 110 films piratés par personne</a></li>
<li><a href="../fr423295/index.html">Conférence de développement mobile la plus utile</a></li>
<li><a href="../fr423297/index.html">Du développeur Android au DevOps</a></li>
<li><a href="../fr423299/index.html">Coordinateur d'applications dans les applications iOS</a></li>
<li><a href="../fr423303/index.html">AI, cours pratique. Transformation musicale basée sur l'émotion</a></li>
<li><a href="../fr423305/index.html">Performance de la ruine</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>