<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üïï üíö üö£üèæ Comment ne pas se tirer une balle dans la jambe avec une machine d'√©tat üë©‚Äçüî¨ üëãüèæ ü•©</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="La machine √† √©tats est rarement utilis√©e par les d√©veloppeurs mobiles. Bien que la majorit√© connaisse les principes du travail et les mette en ≈ìuvre f...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comment ne pas se tirer une balle dans la jambe avec une machine d'√©tat</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/oleg-bunin/blog/423293/"> La machine √† √©tats est rarement utilis√©e par les d√©veloppeurs mobiles.  Bien que la majorit√© connaisse les principes du travail et les mette en ≈ìuvre facilement de mani√®re ind√©pendante.  Dans l'article, nous allons d√©terminer quelles t√¢ches sont r√©solues par la machine d'√©tat en utilisant l'exemple des applications iOS.  L'histoire est appliqu√©e dans la nature et est consacr√©e aux aspects pratiques du travail. <br><br>  Sous la coupe, vous trouverez une transcription √©tendue du discours d'Alexander <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">Sychev</a> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">Brain89</a> ) sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">AppsConf</a> , dans laquelle il a partag√© ses options pour utiliser la machine d'√©tat dans le d√©veloppement d'applications non-jeu. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/GKMrJe3mfwU" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <b>√Ä propos du conf√©rencier:</b> Alexander Sychev a √©t√© engag√© dans le d√©veloppement iOS pendant huit ans, au cours desquels il a particip√© √† la cr√©ation d'applications simples et de clients complexes pour les r√©seaux sociaux et le secteur financier.  √Ä l'heure actuelle, est un responsable technique chez Sberbank. <br><a name="habracut"></a><br>  Ils viennent √† la programmation de nombreux domaines, ayant des ant√©c√©dents et des exp√©riences diff√©rents, donc nous rappelons d'abord la th√©orie de base. <br><br><h2>  √ânonc√© du probl√®me <br></h2><br><img src="https://habrastorage.org/webt/ow/wa/vd/owwavd51w_12g14nwehehu4yfu4.jpeg"><br><br>  Une machine √† √©tats est une abstraction math√©matique qui se compose de trois √©l√©ments principaux: <br><br><ul><li>  de nombreux √©tats internes </li><li>  l'ensemble des signaux d'entr√©e qui d√©terminent la transition de l'√©tat actuel au suivant, </li><li>  ensembles d'√©tats finaux, √† la transition vers lesquels l'automate termine son travail ("admet le mot d'entr√©e x"). </li></ul><br><h3>  Condition <br></h3><br>  Par √©tat, nous entendons une variable ou un groupe de variables qui d√©terminent le comportement d'un objet.  Par exemple, dans l'application iOS standard ¬´Param√®tres <strong>¬ª,</strong> il y a un √©l√©ment ¬´Gras¬ª (¬´Basique ‚Üí Acc√®s universel¬ª).  La valeur de cet √©l√©ment vous permet de basculer entre deux options pour afficher du texte sur l'√©cran de l'appareil. <br><br><img src="https://habrastorage.org/webt/mx/if/68/mxif68m4rgadt4kgjqovnzswvny.jpeg"><br><br>  En envoyant le m√™me signal ¬´Changer la valeur de l'interrupteur √† bascule <strong>¬ª</strong> , nous obtenons une r√©action diff√©rente du syst√®me: soit le style de police habituel soit en gras - tout est simple.  √âtant dans des √©tats diff√©rents et recevant le m√™me signal, un objet r√©agit diff√©remment √† un changement d'√©tat. <br><br><h2>  T√¢ches traditionnelles <br></h2><br>  En pratique, les programmeurs rencontrent souvent une machine √† √©tats finis. <br><br><h3>  Applications de jeux <br></h3><br>  C'est la premi√®re chose qui me vient √† l'esprit - dans le cadre du gameplay, presque tout est d√©termin√© par l'√©tat actuel du jeu.  Ainsi, Apple suppose l'utilisation de machines d'√©tat principalement dans les applications de jeu (nous en discuterons en d√©tail plus tard). <br><br>  Le comportement du syst√®me lors du traitement du m√™me signal mais avec un √©tat interne diff√©rent peut √™tre illustr√© par les exemples suivants.  Par exemple: <br><br>  ‚óè le personnage du jeu peut √™tre de diff√©rentes forces: l'un en armure m√©canique et avec un pistolet laser, et l'autre est faiblement pomp√©.  En fonction de cet √©tat, le comportement des ennemis est d√©termin√©: ils attaquent ou s'enfuient. <br><br><img src="https://habrastorage.org/webt/-9/ur/ci/-9urcijninqy6zo8as2i8adn46o.jpeg"><br><br>  ‚óè le jeu est en pause - pas besoin de dessiner l'image actuelle;  le joueur en mode menu ou en cours de jeu - le rendu est compl√®tement diff√©rent. <br><br><h3>  Analyse de texte <br></h3><br>  L'une des t√¢ches d'analyse de texte les plus courantes associ√©es √† l'utilisation d'une machine d'√©tat est les filtres anti-spam.  Soit un ensemble de mots vides et une s√©quence d'entr√©e.  Vous devez soit filtrer cette s√©quence, soit ne pas l'afficher du tout. <br><br><img src="https://habrastorage.org/webt/vo/ka/c2/vokac2-lpmhmsapxqmtked5buo4.jpeg"><br><br>  Formellement, c'est la t√¢che de trouver une sous-cha√Æne dans une cha√Æne.  Pour le r√©soudre, l'algorithme Knut-Morris-Pratt est utilis√©, dont l'impl√©mentation logicielle est une machine √† √©tats finis.  L'√©tat est le d√©calage de la s√©quence d'entr√©e et le nombre de caract√®res trouv√©s dans le motif - mot d'arr√™t. <br><br>  De plus, <strong>lors de l'analyse d'expressions r√©guli√®res</strong> , des machines √† √©tats finis sont souvent utilis√©es. <br><br><h3>  Traitement parall√®le des requ√™tes <br></h3><br>  Une machine d'√©tat est l'une des options pour impl√©menter le traitement des demandes et ex√©cuter un ensemble strict d'instructions. <br><br><img src="https://habrastorage.org/webt/i_/ll/n9/i_lln9kr6-tfmnr0ejx7mjn3ytk.jpeg"><br><br>  Par exemple, dans le serveur Web nginx, les demandes d'entr√©e de divers protocoles sont trait√©es √† l'aide de machines d'√©tat.  Selon le protocole sp√©cifique, une impl√©mentation sp√©cifique de la machine √† √©tats est s√©lectionn√©e et, par cons√©quent, un ensemble d'instructions bien connu est ex√©cut√©. <br><br>  En g√©n√©ral, deux classes de probl√®mes sont obtenues: <br><br><ul><li>  g√©rer la logique d'un objet complexe avec un √©tat interne complexe, </li><li>  formation des flux de contr√¥le et de donn√©es (description de l'algorithme). </li></ul><br>  De toute √©vidence, ces t√¢ches courantes sont rencontr√©es dans la pratique de tout programmeur.  Par cons√©quent, l'utilisation d'une machine d'√©tat est possible, y compris dans les applications de contenu non li√©es aux jeux, qui sont impliqu√©es dans la plupart des d√©veloppeurs mobiles. <br><br>  Ensuite, nous analyserons o√π et quand la machine d'√©tat peut √™tre utilis√©e pour cr√©er des applications iOS typiques. <br><br>  La plupart des applications mobiles ont une architecture en couches.  Il existe trois couches de base. <br><br><ul><li>  Couche de pr√©sentation. </li><li>  Couche logique m√©tier. </li><li>  Un ensemble d'aides, de clients r√©seau, etc. (couche principale). </li></ul><br>  Comme indiqu√© ci-dessus, la machine √† √©tats contr√¥le les objets ayant un comportement complexe, c'est-√†-dire  avec un √©tat complexe.  Ces objets sont d√©finitivement dans la couche de pr√©sentation, car il prend des d√©cisions en traitant les entr√©es utilisateur ou les messages du syst√®me d'exploitation.  Examinons les diff√©rentes approches de son ex√©cution. <br><br><img src="https://habrastorage.org/webt/ic/iq/pw/iciqpwtfuuokmoik0j5abflppg4.jpeg"><br><br>  Dans la m√©taphore architecturale classique de Model-View-Controller, l'√©tat sera dans le contr√¥leur: il d√©cide ce qui est affich√© dans la vue et comment r√©pondre aux signaux d'entr√©e: en appuyant sur un bouton, en changeant le curseur, etc.  Il est logique que l'une des impl√©mentations du contr√¥leur soit une machine √† √©tats. <br><br><img src="https://habrastorage.org/webt/xt/sv/cr/xtsvcrd3ehffxfreo8ivtwx7jy8.jpeg"><br><br>  Dans VIPER, l'√©tat est dans le pr√©sentateur: c'est lui qui d√©termine la transition de navigation sp√©cifique √† partir de l'√©cran courant et l'affichage des donn√©es dans la Vue. <br><br><img src="https://habrastorage.org/webt/_p/ob/xb/_pobxbwjjwduuken8qiucqg5o30.jpeg"><br><br>  Dans Model-View-ViewModel, l'√©tat est dans le ViewModel.  Que nous ayons ou non des liants r√©actifs, le comportement du module d√©fini dans la m√©taphore MVVM sera enregistr√© dans le ViewModel.  De toute √©vidence, sa mise en ≈ìuvre via une machine √† √©tats est une option acceptable. <br><br><img src="https://habrastorage.org/webt/x0/8e/kf/x08ekfoc9zyg1s9_9jiirethpgm.jpeg"><br><br>  Des objets complexes avec un ensemble d'√©tats non triviaux sont √©galement rencontr√©s sur la couche logique m√©tier de l'application.  Par exemple, un client r√©seau, qui, selon qu'une connexion au serveur est √©tablie ou non, envoie ou bloque les demandes.  Ou un objet pour travailler avec une base de donn√©es qui doit traduire des fonctions de langage en une requ√™te SQL, l'ex√©cuter, obtenir une r√©ponse, la traduire en objets, etc. <br><br><img src="https://habrastorage.org/webt/pb/bq/yt/pbbqytlwgtmbcutdlliqv5xkwjs.jpeg"><br><br>  Dans des t√¢ches plus sp√©cifiques, comme un module de paiement, dans lequel un ensemble d'√©tats plus large, une logique complexe, l'utilisation d'une machine d'√©tat est √©galement correcte. <br><br>  En cons√©quence, nous constatons que dans les applications mobiles, il existe de nombreux objets dont l'√©tat et la logique de comportement sont d√©crits plus compliqu√©s qu'avec une seule phrase.  Ils doivent √™tre capables de g√©rer. <br><br>  Prenons un <strong>exemple r√©el</strong> et comprenez √† quel point une machine √† √©tats finis est vraiment n√©cessaire et o√π son application n'est pas justifi√©e. <br><br><img src="https://habrastorage.org/webt/96/hk/lw/96hklw8ditorh2imz2zcx36wmga.jpeg"><br><br>  Consid√©rez le ViewController de l'application iOS Championship, une ressource sportive populaire.  Ce contr√¥leur affiche un ensemble de commentaires sous forme de tableau.  Les utilisateurs entrent la description du match, regardent les photos, lisent les nouvelles et laissent leurs commentaires.  L'√©cran est assez simple: la couche sous-jacente donne des donn√©es, elles sont trait√©es et affich√©es √† l'√©cran. <br><img src="https://habrastorage.org/webt/m7/m1/yz/m7m1yz9--h4qttlcuxjrozagl48.jpeg"><br><br>  Des donn√©es r√©elles ou une erreur peuvent √™tre transmises √† l'√©cran.  Ainsi, le premier op√©rateur conditionnel appara√Æt, la premi√®re branche, qui d√©termine le comportement ult√©rieur de l'application. <br><br>  La question suivante est de savoir quoi faire s'il n'y a pas de donn√©es.  Cette condition est-elle une erreur?  Probablement pas: toutes les nouvelles ne contiennent pas de commentaires des utilisateurs.  Par exemple, le hockey en √âgypte int√©resse peu de monde; dans un tel article, il n'y a g√©n√©ralement pas de commentaires.  Il s'agit d'un comportement normal et de l'√©tat normal de l'√©cran que vous devez pouvoir afficher.  Ainsi, le deuxi√®me op√©rateur conditionnel appara√Æt. <br><br>  Il est logique de supposer qu'il existe √©galement un √©tat de d√©marrage dans lequel l'utilisateur attend des donn√©es (par exemple, lorsque l'√©cran de commentaire n'appara√Æt qu'√† l'√©cran).  Dans ce cas, affichez correctement l'indicateur de chargement.  Il s'agit de la troisi√®me d√©claration conditionnelle. <br><br>  Nous avons donc d√©j√† quatre √©tats sur un seul √©cran, dont la logique d'affichage est d√©crite par la construction if-else-if-else. <br><br><img src="https://habrastorage.org/webt/ys/yg/mq/ysygmq4fbj3mog3p6mjb0t5av9o.jpeg"><br><br>  Mais que se passe-t-il s'il y en a plus?  Le d√©veloppement it√©ratif de l'√©cran conduit √† un enchev√™trement complexe de constructions conditionnelles, √† un tas de drapeaux ou √† un bo√Ætier de commutation multiple encombrant.  Ce code fait peur.  Imaginez que le d√©veloppeur qui le soutiendra sache o√π vous vivez et qu'il a une tron√ßonneuse qu'il porte toujours avec lui.  Et vous voulez vraiment vivre votre petite pension bien m√©rit√©e. <br><br>  Je pense que dans ce cas, il vaut la peine de consid√©rer s'il vaut la peine de laisser une telle impl√©mentation dans l'application. <br><br><h3>  Inconv√©nients <br></h3><br>  Comprenons ce que nous n'aimons pas √† propos de ce code. <br><br><img src="https://habrastorage.org/webt/2u/a-/67/2ua-67iwmlvw9zki5oxmjf4mfqe.jpeg"><br><br>  Tout d'abord, c'est <strong>difficile √† lire</strong> . <br><br>  √âtant donn√© que le code est mal lu, cela signifie qu'il sera difficile pour un nouveau d√©veloppeur de comprendre exactement ce qui est impl√©ment√© √† un endroit particulier du projet.  Par cons√©quent, cela passera beaucoup de temps √† analyser la logique de comportement des applications - le <strong>co√ªt du support et du d√©veloppement augmentera</strong> . <br><br>  Ce code n'est pas <strong>flexible</strong> .  Si vous devez ajouter un nouvel √©tat qui ne d√©coule pas de l'√©chelle actuelle, il peut ne pas r√©ussir du tout!  Si vous avez besoin d'un passage traversant - arr√™tez brusquement de passer les contr√¥les sur cette √©chelle - comment le faire?  Presque rien. <br><br>  De plus, avec cette approche, <strong>il n'y a aucune protection contre les √©tats fictifs</strong> .  Lorsque les transitions sont d√©crites via un bo√Ætier de commutation, le comportement par d√©faut est tr√®s probablement impl√©ment√©.  Cet √©tat est logique en termes de comportement du programme, mais difficilement logique en termes de logique humaine ou m√©tier de l'application. <br><br>  Quelle peut √™tre la solution aux lacunes indiqu√©es?  Bien s√ªr, c'est la construction de la logique de chaque module / contr√¥leur / objet complexe, non pas bas√©e sur l'intuition, mais en utilisant une bonne approche formalis√©e.  Par exemple, une machine √† √©tats finis. <br><br><h2>  Gameplaykit <br></h2><br>  √Ä titre d' <strong>exemple,</strong> nous prenons ce que propose Apple.  Dans le cadre du cadre GameplayKit, il existe deux classes qui nous aident √† travailler avec la machine √† √©tats. <br><br><ul><li>  GKState. </li><li>  GKStateMachine. </li></ul><br>  Le nom du cadre indique clairement qu'Apple voulait √™tre utilis√© dans les jeux.  Mais <strong>dans les applications non ludiques,</strong> cela sera utile. <br><br><img src="https://habrastorage.org/webt/pz/ez/de/pzezdem8jc81mab3alsm3e8pqwo.png"><br><br>  La classe <strong>GKState</strong> d√©finit l'√©tat.  Pour le d√©crire, vous devez effectuer des √©tapes simples.  Nous h√©ritons de cette classe, d√©finissons le nom de l'√©tat et d√©finissons trois m√©thodes. <br><br><ul><li>  isValidNextState - si l'√©tat actuel est valide sur la base du pr√©c√©dent. </li><li>  didEnterFrom - actions sur la transition vers cet √©tat. </li><li>  willExitTo - actions √† la sortie de cet √©tat. </li></ul><br><br><img src="https://habrastorage.org/webt/z2/q2/gj/z2q2gj0bg2-vsoejvz0crdbhmb4.png"><br><br>  <strong>GKStateMachine est</strong> une classe de machine √† √©tats.  C‚Äôest encore plus simple.  Il suffit d'effectuer deux actions. <br><br><ul><li>  Nous passons l'ensemble des √©tats d'entr√©e au tableau typ√© via l'initialiseur. </li><li>  Nous faisons des transitions en fonction des signaux d'entr√©e en utilisant la m√©thode enter.  Gr√¢ce √† elle, l'√©tat initial est √©galement d√©fini. </li></ul><br>  Il peut √™tre d√©routant que n'importe quelle classe soit pass√©e comme argument √† la m√©thode <strong>enter</strong> .  Mais il convient de noter qu'un objet de n'importe quelle classe ne peut pas √™tre d√©fini dans un tableau d'√©tats <strong>-</strong> cela interdit le typage strict.  Par cons√©quent, si vous d√©finissez une classe arbitraire comme classe d'√©tat suivante, rien ne se produira et la m√©thode enter retournera false. <br><br><h3>  √âtats et transitions entre eux <br></h3><br>  Apr√®s avoir pris connaissance du framework d'Apple, revenons √† l'exemple.  Il est n√©cessaire de d√©crire les √©tats et les transitions entre eux.  Vous devez le faire de la mani√®re la plus compr√©hensible.  Il existe deux options courantes: un tableau ou un graphique de transition.  Le graphique de transition, √† mon avis, est une option plus compr√©hensible.  Il est en UML de mani√®re standardis√©e.  Par cons√©quent, nous le choisissons. <br><br>  Dans le graphique de transition, il y a des √©tats qui sont d√©crits par des noms et des fl√®ches qui relient ces √©tats pour d√©crire les transitions.  Dans l'exemple, il y a un √©tat initial <strong>-</strong> nous attendons des donn√©es <strong>-</strong> et il y a trois √©tats qui peuvent √™tre atteints √† partir de celui initial: donn√©es re√ßues, pas de donn√©es et erreur. <br><br><img src="https://habrastorage.org/webt/cg/dn/gs/cgdngsj7omvfgbfvkpdgtazpeva.jpeg"><br><br>  Dans l'impl√©mentation, nous obtenons quatre petites classes. <br><br><img src="https://habrastorage.org/webt/qo/tc/rq/qotcrq6wbihios-sonhj8ajfhey.png"><br><br>  Analysons l'√©tat "Donn√©es en attente".  A l'entr√©e, il vaut la peine d'afficher l'indicateur de t√©l√©chargement.  Et lorsque vous quittez cet √©tat <strong>,</strong> cachez-le.  Pour ce faire, vous devez avoir un lien faible vers le ViewController, qui est contr√¥l√© par la machine d'√©tat cr√©√©e. <br><br><img src="https://habrastorage.org/webt/p8/41/aa/p841aapjpxsvcqirsklkcy9o4us.png"><br><br><h3>  Param√®tres machine <br></h3><br>  La deuxi√®me √©tape √† effectuer <strong>consiste</strong> √† d√©finir les param√®tres de la machine d'√©tat.  Pour ce faire, cr√©ez des √©tats et transf√©rez-les vers l'objet automate. <br><br><img src="https://habrastorage.org/webt/zd/ww/pm/zdwwpm8i_i6lxoxjkzh_a2deqzi.jpeg"><br><br>  Veillez √©galement √† d√©finir l'√©tat initial <br><br><img src="https://habrastorage.org/webt/mx/sg/ka/mxsgkacbkni4fjczcvsagtec8lm.png"><br><br>  En principe, tout, la machine est pr√™te.  Maintenant, il est n√©cessaire de traiter les r√©actions aux √©v√©nements externes, en changeant l'√©tat de l'automate. <br><br><img src="https://habrastorage.org/webt/_c/jt/hf/_cjthf0r7-5d5u0fdxucgksdz2w.png"><br><br>  Rappelez l'√©nonc√© du probl√®me.  Nous avons obtenu une √©chelle de if-else, sur la base de laquelle il a √©t√© d√©cid√© de l'action √† effectuer.  En tant que contr√¥le pour un automate simple, une telle option d'impl√©mentation peut √™tre (en fait, un simple commutateur <strong>-</strong> il s'agit d'une impl√©mentation primitive d'une machine √† √©tats finis), mais nous ne nous d√©barrassons pratiquement pas des inconv√©nients mentionn√©s pr√©c√©demment. <br><br>  Il existe une autre approche qui vous permettra de vous √©loigner de ces √©chelles.  Il est propos√© par les classiques de la programmation <strong>- le</strong> soi-disant ¬´gang de quatre¬ª. <br><br><img src="https://habrastorage.org/webt/qv/if/sf/qvifsfqe0iqs3rsroauy4bptayg.jpeg"><br><br>  Il existe un mod√®le de conception sp√©cial, appel√© ¬´√âtat¬ª. <br><br><img src="https://habrastorage.org/webt/nd/eh/wp/ndehwptccwh7lh90dmsixkzybo0.jpeg"><br><br>  Il s'agit d'un mod√®le de comportement similaire √† une strat√©gie qui d√©crit une abstraction de la machine √† √©tats.  Il permet √† l'objet de changer son comportement en fonction de l'√©tat.  Le but principal de l'application <strong>est d'</strong> encapsuler le comportement et les donn√©es associ√©s √† un √©tat particulier dans une classe distincte.  Ainsi, la machine √† √©tats, qui a initialement pris la d√©cision de l'√©tat √† provoquer, va maintenant transmettre un signal, le traduire en √©tat, et l'√©tat prendra une d√©cision.  D√©chargez donc partiellement l'√©chelle et le code deviendra plus agr√©able √† utiliser. <br><br>  Le cadre standard ne sait pas comment.  Il sugg√®re que <strong>GKStateMachine</strong> prendra la d√©cision.  Par cons√©quent, nous d√©veloppons la machine √† √©tats finis avec une nouvelle m√©thode, o√π en tant que configuration, nous passons la description de toutes les variables conditionnelles qui d√©terminent de mani√®re unique l'√©tat suivant.  Dans cette m√©thode, vous pouvez d√©l√©guer la s√©lection de l'√©tat suivant √† l'√©tat actuel. <br><br><img src="https://habrastorage.org/webt/gu/sw/nr/guswnro2dw8m3fsctqqjx8_7js8.png"><br><br>  Il est recommand√© de d√©crire l'√©tat avec un seul objet et de toujours le transmettre, plut√¥t que d'√©crire de nombreux param√®tres d'entr√©e.  Ensuite, nous d√©l√©guons le choix de l'√©tat suivant √† l'√©tat actuel.  C'est toute la mise √† niveau. <br><br><img src="https://habrastorage.org/webt/te/9t/5a/te9t5acirqz1o5awpxzy1tsbyia.png"><br><br>  <strong>Avantages de GameplayKit.</strong> <br><br><ul><li>  Biblioth√®que standard.  Pas besoin de t√©l√©charger quoi que ce soit, d'utiliser des cocoapodes ou des carthages. </li><li>  La biblioth√®que est assez facile √† apprendre. </li><li>  Il existe deux impl√©mentations √† la fois: sur Objective-C et sur Swift. </li></ul><br>  <strong>Inconv√©nients:</strong> <br><br><ul><li>  Les r√©alisations des √©tats et des transitions sont √©troitement li√©es. <br>  Le principe de la responsabilit√© exclusive est viol√©: l'√âtat sait o√π il va et comment. </li><li>  Les √©tats en double ne sont en aucun cas contr√¥l√©s. <br>  Un tableau est transmis √† la machine d'√©tat, pas beaucoup d'√©tats.  Si vous transf√©rez plusieurs √©tats identiques, le dernier de la liste sera utilis√©. </li></ul><br>  Quelles sont les autres impl√©mentations de machines √† √©tats finis?  Jetez un ≈ìil √† GitHub. <br><br><h2>  Impl√©mentations Objective-C <br></h2><br><img src="https://habrastorage.org/webt/vo/zt/zy/voztzyatty-amllrmtl8ny4ke3c.png"><br><br><h3>  TransitionKit <br></h3><br>  Il s'agit de la biblioth√®que Objective-C la plus populaire depuis longtemps, sans carences identifi√©es dans GamePlayKit.  Il nous permet d'impl√©menter une machine √† √©tats et toutes les actions qui lui sont associ√©es sur des blocs. <br><br>  <strong>L'√©tat est s√©par√© des transitions</strong> . <br><br>  Dans TransitionKit, il y a 2 classes. <br><br><ol><li>  TKState - pour d√©finir les √©tats et les actions d'entr√©e et de sortie. </li><li>  TKEvent est une classe pour d√©crire la transition. <br>  TKEvent lie certains √âtats √† d'autres.  L'√©v√©nement lui-m√™me est d√©fini simplement par une cha√Æne. </li></ol><br>  De plus, il y a des avantages suppl√©mentaires. <br><br>  <strong>Vous pouvez transf√©rer des donn√©es utiles pendant la transition</strong> .  Cela fonctionne de la m√™me mani√®re que lorsque vous utilisez NSNotificationCenter.  Toute charge utile utile se pr√©sente sous la forme d'un dictionnaire userInfo, et l'utilisateur analyse les informations. <br><br>  <strong>La transition erron√©e a une description</strong> .  Lorsque nous essayons de faire une transition inexistante - impossible - nous obtenons non seulement la valeur NO lors du retour de la m√©thode de transition, mais aussi une description d√©taill√©e de l'erreur, qui est utile lors du d√©bogage d'une machine √† √©tats. <br><br><img src="https://habrastorage.org/webt/hi/x9/bx/hix9bx5ctgjldoay4btqajopgb0.jpeg"><br><br>  TransitionKit est utilis√© dans la moissonneuse r√©seau populaire RestKit.  Ceci est un assez bon exemple de la fa√ßon dont une machine d'√©tat peut √™tre utilis√©e dans le noyau d'application lors de l'impl√©mentation des op√©rations r√©seau. <br><br><img src="https://habrastorage.org/webt/ls/os/d3/lsosd3z1zbg5knnmbrggmpq2zro.jpeg"><br><br>  RestKit a une classe sp√©ciale - RKOperationStateMachine - pour g√©rer les op√©rations simultan√©es.  En entr√©e, il accepte l'op√©ration en cours de traitement et la file d'attente pour son ex√©cution. <br><br><img src="https://habrastorage.org/webt/r2/pn/mc/r2pnmcfsl_6uzdzhsin_mrq_vkg.jpeg"><br><br>  En interne, la machine √† √©tats est tr√®s simple: trois √©tats (pr√™t, ex√©cut√©, termin√©) et deux transitions: d√©but et fin d'ex√©cution.  Apr√®s le d√©but du traitement (et √† toutes les transitions), la machine d'√©tat commence √† contr√¥ler un bloc de code utilisateur pr√©d√©fini dans la file d'attente sp√©cifi√©e lors de la cr√©ation de la file d'attente. <br><br>  Une op√©ration associ√©e √† son automate transf√®re des √©v√©nements externes √† l'automate et effectue des transitions entre les √©tats et toutes les actions associ√©es.  La machine d'√©tat prend soin de <br><br><ul><li>  ex√©cution de code asynchrone, </li><li>  ex√©cution de code atomique lors des transitions, </li><li>  contr√¥le de transition </li><li>  Annulation des op√©rations </li><li>  l'exactitude des variables d'√©tat de changement de fonctionnement: isReady, isExecuting, isFinished. </li></ul><br><h3>  Shift <br></h3><br>  En plus de TransitionKit, il convient de mentionner s√©par√©ment <strong>Shift</strong> - une minuscule biblioth√®que impl√©ment√©e en tant que cat√©gorie sur NSObject.  Cette approche vous permet de transformer n'importe quel objet en machine √† √©tats, d√©crivant son √©tat sous la forme de constantes de cha√Æne et d'actions en blocs pendant les transitions.  Bien s√ªr, il s'agit davantage d'un projet de formation, mais assez int√©ressant et vous permet d'essayer ce qu'est une machine d'√©tat √† un co√ªt minimal. <br><br><h2>  Impl√©mentations rapides <br></h2><br><img src="https://habrastorage.org/webt/_t/dx/kd/_tdxkdwt0sqzgy78o-q-_z0c_nq.png"><br><br>  Il existe de nombreuses impl√©mentations de machines √† √©tats finis sur Swift.  J'en citerai un ( <strong>remarque</strong> : malheureusement, le projet n'a pas √©volu√© au cours des deux derni√®res ann√©es apr√®s le rapport, mais les id√©es qu'il contient m√©ritent d'√™tre racont√©es dans l'article). <br><br><h3>  SwiftyStateMachine <br></h3><br>  Dans SwiftyStateMachine, la machine √† √©tats est repr√©sent√©e par une structure non stable; gr√¢ce aux m√©thodes didSet de la propri√©t√©, vous pouvez facilement d√©tecter les changements d'√©tat. <br><br>  Dans cette biblioth√®que, la machine √† √©tats est d√©finie √† travers la table de correspondance des √©tats et des transitions entre eux.  Ce sch√©ma est d√©crit s√©par√©ment de l'objet que la machine contr√¥lera.  Ceci est impl√©ment√© via un bo√Ætier de commutation imbriqu√©. <br><br><img src="https://habrastorage.org/webt/y5/cz/dl/y5czdlkikmxb4kyylgwgxfsdxuy.png"><br><br>  ,    . <br><br><ul><li>       . <br>       ,        . </li><li>    . <br>    state machine ,         state machine. </li><li>    ,   ,      . </li><li> ,     DOT. <br>        state- ‚Äî DOT.    ,  ,     . </li></ul><br><img src="https://habrastorage.org/webt/wb/zg/du/wbzgduy9duy-shpt0pcjjjt0ru8.jpeg"><br><br><h2>  Conclusion <br></h2><br>          . <br><br><ul><li> <strong>.</strong> <br>           ,     .    ,         . ,   . <br></li><li> <strong>  .</strong> <br>     ( ). <br></li><li> <strong> .</strong> <br>       ,    ,        . </li><li> <strong>       .</strong> , SwiftyStateMachine     ,    ,     .     . </li><li> <strong> .</strong> <br>   ,    . , ,      .       . <br></li></ul><br>        . <br><br><img src="https://habrastorage.org/webt/wb/ek/ww/wbekwwlr0a_w8wzt6z0bo12jdmm.jpeg"><br><br>       .      ,    .    , ,    switch case:  ,  ,  ‚Äî     . <br><br><img src="https://habrastorage.org/webt/hq/ay/db/hqaydbygw58xgcalwyvph1haeho.jpeg"><br><br>  .    .    ,  .  ,    ,  ,     .    . <br><br><img src="https://habrastorage.org/webt/b9/mb/ze/b9mbze-xdkufz2mbs7p61obsjqo.jpeg"><br><br>      ,      ,      .     . <br><br><img src="https://habrastorage.org/webt/bc/qp/hr/bcqphramltmjhaakirn_uo00e4i.png"><br><br>    ‚Äî  <strong> </strong> .       :      , ‚Äî    . <br><br><img src="https://habrastorage.org/webt/iw/qz/we/iwqzwefnjh4xnqexwoovxccugqo.jpeg"><br><br><img src="https://habrastorage.org/webt/i4/80/vk/i480vkfuwmhwpdd31totlvl5298.jpeg"><br><br>   ¬´-¬ª     <strong> </strong> . <br><br><img src="https://habrastorage.org/webt/s-/kf/ox/s-kfoxsckujhbrzsslebpzuqwei.jpeg"><br><br> ,    .         . <br><br><img src="https://habrastorage.org/webt/le/oo/ju/leoojuz3yycfncczpfbgftsa1tq.jpeg"><br><br>        <strong>app coordinators</strong> ‚Äî   ,     ,    : ,     .       ,       . <br><br>  , app coordinator ,  state machine.            . ,    app coordinators  state machine,         , ,  , <strong>  </strong> .      , ,   ,         .    . <br><br><img src="https://habrastorage.org/webt/mx/yu/1q/mxyu1qczcjazzunuhe7jfoolv2e.png"><br><br> , state machine  ,    ,         . <br><br>     state machine  ,     if-else.   ,         . <br><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cette ann√©e, √† Apps Conf 2018, qui se tiendra les 8 et 9 octobre, Alexander </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pr√©voit de discuter de</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cinq principes de base de la programmation orient√©e objet et des limites de leur applicabilit√©. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour plus de rapports sur le d√©veloppement mobile, consultez notre </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cha√Æne YouTube</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Et si vous souhaitez recevoir des informations sur les nouvelles transcriptions et les rapports int√©ressants, abonnez-vous √† la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">newsletter</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br></blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr423293/">https://habr.com/ru/post/fr423293/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr423279/index.html">Comment j'ai d√©velopp√© la tablette russe</a></li>
<li><a href="../fr423281/index.html">Feedback dans l'√©quipe, 360 et 14 f√©vrier</a></li>
<li><a href="../fr423283/index.html">Mod√©lisation de l'effet Sagnac √† l'aide de l'optique g√©om√©trique</a></li>
<li><a href="../fr423285/index.html">Ing√©nierie sociale: l'ennemi insaisissable dans le monde de la cybers√©curit√©</a></li>
<li><a href="../fr423291/index.html">Les Russes √©tablissent un record: 110 films pirat√©s par personne</a></li>
<li><a href="../fr423295/index.html">Conf√©rence de d√©veloppement mobile la plus utile</a></li>
<li><a href="../fr423297/index.html">Du d√©veloppeur Android au DevOps</a></li>
<li><a href="../fr423299/index.html">Coordinateur d'applications dans les applications iOS</a></li>
<li><a href="../fr423303/index.html">AI, cours pratique. Transformation musicale bas√©e sur l'√©motion</a></li>
<li><a href="../fr423305/index.html">Performance de la ruine</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>