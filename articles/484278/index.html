<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üíáüèæ ‚úãüèª üë©üèæ‚Äçüî¨ L√°mpara controlada por gestos en Arduino ‚ô®Ô∏è üçí üë©üèº‚Äçü§ù‚Äçüë®üèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola a todos !!! 
 Me alegra poder mostrarte mi nuevo oficio de nuevo. 
 Esta vez arm√© una l√°mpara arduino controlada por gestos. 

 Este proyecto me ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>L√°mpara controlada por gestos en Arduino</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/484278/"><img src="https://habrastorage.org/webt/d4/ag/wq/d4agwqmzn7bi_rgmhdau05bcc8c.jpeg" alt="imagen"><br><br>  Hola a todos !!! <br>  Me alegra poder mostrarte mi nuevo oficio de nuevo. <br>  Esta vez arm√© una l√°mpara arduino controlada por gestos. <br><br>  Este proyecto me llev√≥ mucho tiempo, que siempre me falta. <br>  Ensambl√© la primera versi√≥n de la l√°mpara muy r√°pidamente y funcion√≥ perfectamente para m√≠ en el tablero, pero cuando la mov√≠ a un lugar permanente en el estuche, todo comenz√≥, todos los problemas con congelamientos, falsos positivos y otros problemas salieron.  Buscando en Internet, encontr√© en sitios extranjeros muchas quejas relacionadas con los problemas del sensor APDS9960, pero no encontr√© soluciones a estos problemas.  Tuve que pasar un poco de tiempo estudiando la hoja de datos de este sensor y entendiendo su funcionamiento.  Al final, vali√≥ la pena y pude escribir un c√≥digo de trabajo estable. <br><br>  Y as√≠, todo en orden. <br><a name="habracut"></a><br><h4>  Descripci√≥n de la l√°mpara </h4><br>  El √©nfasis principal en esta l√°mpara no estaba en la visualizaci√≥n, sino en el control de gestos, todas las dem√°s funciones son secundarias. <br><br>  La l√°mpara se enciende con gestos hacia la izquierda o hacia la derecha, y tambi√©n puede encenderla con un gesto hacia usted, pero esto no es del todo conveniente.  A continuaci√≥n, con los gestos hacia la izquierda y hacia la derecha, puede desplazarse por los efectos de iluminaci√≥n.  Si comienza a girar hacia la derecha, la l√°mpara primero cambiar√° sus colores de blanco a rojo, incluidos todos los colores primarios y las transiciones entre ellos. <br><br>  Si despu√©s de encender la l√°mpara comenzamos a girar hacia la izquierda, veremos efectos de iluminaci√≥n din√°micos, como "Fuego", "Matriz", "L√°mpara de lava", "Arco iris", "Confeti", "Chispas", "L√°mpara ardiente".  Si necesita volver a una l√°mpara normal, en lugar de dar la vuelta, puede apagar la l√°mpara con un gesto suyo y encender cualquiera de los tres gestos. <br>  El apagado se realiza mediante un gesto tuyo. <br><br><img src="https://habrastorage.org/webt/zr/zi/4m/zrzi4maxu4cyqtt9qfh7hzgqu1q.gif"><br><br>  El brillo est√° regulado por el gesto de acercarse y alejarse del sensor.  Primero debe acercar la palma de la mano al sensor lo m√°s posible y luego levantarla bruscamente.  La l√°mpara cambiar√° al modo de ajuste de brillo, acercando cada vez m√°s la palma de su mano, necesita encontrar el brillo apropiado y fijar su mano durante un par de segundos, para que se conserve el valor del brillo.  Cuando se mantiene el brillo, la l√°mpara le informar√° apagando suavemente la luz y luego encendi√©ndola con un nuevo nivel de brillo. <br><br>  No prest√© mucha atenci√≥n a los efectos visuales, ya que planeo hacer una segunda versi√≥n de la l√°mpara en el mini controlador Wemos D1.  En el que planeo llevar todo al ideal.  Por la misma raz√≥n, sigo usando solo una l√≠nea de LED, que consta de 4 tiras ws2812b, en lugar de cuatro. <br><br><h4>  APDS9960 Interrupciones </h4><br>  En realidad, los principales problemas de la l√°mpara LED est√°n asociados con ella.  Las interrupciones en apds9960 viven sus propias vidas, puede funcionar desde cualquier cosa, por ejemplo, por interferencia EM o por estar cerca del sensor de una persona, por la ondulaci√≥n en la nutrici√≥n y posiblemente por otra cosa. <br><br><img src="https://habrastorage.org/webt/vn/iz/or/vnizoragveyxcjqiw3oq74y8dom.jpeg"><br><br>  Primero intent√© solucionar el problema con los cambios en el hardware.  El filtrado de energ√≠a no ayud√≥, incluso con una bater√≠a 18650, el sensor a√∫n segu√≠a viviendo.  Trat√© de cambiar la resistencia de carga de la se√±al INT a + 5V y esto tampoco tuvo √©xito. <br><br>  Cuando se realiz√≥ el estudio, se comprendi√≥ por qu√© ocurrieron interrupciones falsas.  El principal problema son los reflejos aleatorios de la se√±al IR.  El fabricante recomienda cubrir el sensor y todo lo que lo rodea con una capa de goma negra.  No tengo esa pintura y no me molest√© con ella.  Aunque con seguridad esto podr√≠a reducir ligeramente la cantidad de falsos positivos. <br><br>  Escrib√≠ un c√≥digo que filtra todos los disparadores aleatorios, pero encontr√© otro problema.  Despu√©s de que se dispara la interrupci√≥n, la informaci√≥n del gesto se transmite a trav√©s del bus I2C no al instante, pero tiene un cierto retraso.  Y si la fuente de alimentaci√≥n debido a la tira de LED de direcci√≥n es ruidosa, el tiempo de transmisi√≥n, teniendo en cuenta estas interferencias, siempre ser√° diferente.  Tuve que tener en cuenta este hecho y reescribir el c√≥digo para determinar los gestos de una manera nueva. <br><br><h4>  Definici√≥n de gestos </h4><br>  Si el c√≥digo no utiliza la interrupci√≥n del sensor, entonces no hay problemas con la definici√≥n del gesto.  Pero en este caso, se pierde la multitarea.  Si se activa un efecto din√°mico en la l√°mpara, entonces requiere un c√≥digo c√≠clico, constantemente ejecutable, y se requerir√°n interrupciones para eliminar el controlador del ciclo. <br><br>  Para mejorar la estabilidad del reconocimiento de gestos, tambi√©n era necesario reducir la sensibilidad del receptor en la biblioteca.  Para hacer esto, reemplace la l√≠nea en el archivo SparkFun_APDS9960.h: <br><br>  <i>if (! setLEDBoost (LED_BOOST_300))</i> <br>  en <br>  <i>if (! setLEDBoost (LED_BOOST_150))</i> <br><br>  Si descarg√≥ la biblioteca de este art√≠culo, no necesita hacer nada, todo ya se ha solucionado all√≠. <br>  Tambi√©n seleccion√© experimentalmente la corriente del LED de 50 mA, en el que los gestos son m√°s estables y no hay necesidad de forzar el LED infrarrojo con una corriente de 100 mA. <br><br>  Y tambi√©n comet√≠ un error al colocar el microcontrolador en la parte inferior de la l√°mpara y el sensor de gestos en la cubierta superior.  Debido a esto, para conectar arduino y apds9960, tuve que usar cables de 30 cm de largo, lo que tambi√©n agreg√≥ inestabilidad adicional al sensor.  Como resultado, derrot√© todos estos problemas mediante programaci√≥n. <br><br><h4>  Esquema </h4><br><img src="https://habrastorage.org/webt/xe/uu/bi/xeuubilb8sr-rjoyuzi_swhliua.jpeg"><br><br>  Para alimentar el dispositivo, uso un cargador de mi tel√©fono inteligente, con un voltaje de salida de 5V y una corriente de 2A.  Pero, de hecho, una l√°mpara con luz blanca encendida con el brillo m√°ximo no consume m√°s de 1.3 A. Por lo tanto, cualquier fuente de energ√≠a con una corriente de salida de al menos 1.3 A es adecuada. <br><br>  El estabilizador dc-dc mini360 se puede reemplazar con cualquier otro convertidor de voltaje reductor, con una corriente de salida de al menos 150 mA. <br><br>  En el diagrama a continuaci√≥n, no uso un convertidor de nivel l√≥gico, pero esta es mi decisi√≥n personal.  Y, por lo tanto, no acepto responsabilidad por adelantado en caso de que, si falla, el sensor APDS9960 se conecte sin un convertidor de nivel TTL. <br><br>  En lugar de Arduino Nano, puede usar el controlador Arduino UNO o sus clones. <br><br>  Aseg√∫rese de verificar la presencia de puentes en el sensor de gestos, est√°n marcados en rojo en la foto a continuaci√≥n.  En caso de ausencia, se debe aplicar un soldador a estos caminos de contacto, aplicar y calentar la soldadura hasta que se forme una gota uniforme.  Ahora los chinos est√°n suministrando estos sensores sin puentes.  Sin estos puentes, el funcionamiento del sensor no est√° garantizado. <br><br><img src="https://habrastorage.org/webt/kj/u0/dm/kju0dmvpbqiuuif-hetiy5hb0f8.jpeg"><br><br><h4>  Componentes utilizados </h4><br>  Arduino Nano - 1 pieza <br>  Sensor de gestos APDS9960 - 1 pieza <br>  Tiras de LED ws2812b - 4 piezas <br>  Convertidor reductor Mini360 - 1 pieza <br>  Cables de conexi√≥n - 1 juego. <br><br><h4>  C√≥digo de programa para Arduino </h4><br>  El c√≥digo se divide en dos partes.  En la primera parte est√° el c√≥digo principal que funciona con el sensor, y en la segunda parte est√° el c√≥digo para todos los efectos de iluminaci√≥n. <br><br>  Puede agregar cualquier efecto usted mismo por analog√≠a con mi c√≥digo, pero lo m√°s importante, no olvide agregar una funci√≥n para salir del gesto del efecto en bucle.  Para hacer esto, agregue la siguiente l√≠nea al final del ciclo <i>if (check_int ()) return;</i> <br><br>  Descripci√≥n de las funciones principales del programa. <br>  ProcessingGesture () procesa interrupciones del sensor de gestos. <br>  processingProximity () procesa interrupciones desde el sensor de proximidad. <br>  gesto_int () - interrumpe el manejador desde el sensor de gestos. <br>  proximidad_int () - interrumpe el controlador del sensor de proximidad. <br><br><h4>  Descripci√≥n de constantes </h4><br>  APDS9960_INT - entrada para una interrupci√≥n externa.  Arduino Nano y UNO tienen solo dos entradas de este tipo, 2 y 3. <br><br>  PIN: aqu√≠ debe especificar la salida a la tira de LED.  Puede especificar cualquier pin digital al que est√©n conectadas las correas ws2812b. <br><br>  NUM_PIX: aqu√≠ indicamos el n√∫mero de LED de direcci√≥n en la cinta utilizada. <br>  rango: el l√≠mite de error es de 0 a 10. Si, al ajustar el brillo, se fija una mano sobre el sensor durante 2 segundos, entonces las lecturas deben guardarse, pero si las lecturas no se guardan, aumente gradualmente el l√≠mite de error. <br><br>  <a href="" rel="nofollow">Descargue la biblioteca APDS9960</a> <br>  <a href="" rel="nofollow">Descargar el boceto de la l√°mpara</a> <br><br><h4>  Video que muestra el funcionamiento de la l√°mpara. </h4><br><iframe width="560" height="315" src="https://www.youtube.com/embed/C4QELMzOpiA" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h4>  Resumen </h4><br>  La l√°mpara en vivo se ve mejor que en el video.  Ahora a todos los que lo vieron de m√≠ se les pide que recojan lo mismo para ellos.  Por el momento, no me gusta c√≥mo funciona el ajuste de brillo, pero estoy trabajando en ello.  No lo prometo pronto, pero la pr√≥xima versi√≥n de la l√°mpara ya est√° en desarrollo. <br><br>  ¬°Gracias por leer el art√≠culo hasta el final!  Si a√∫n tiene preguntas, puede hacerlas en los comentarios del art√≠culo. <br><br><h4>  PS </h4><br>  Idea de l√°mpara inspirada <a href="https://www.youtube.com/channel/UCOG6Bi2kvpDa1c8gHWZI5CQ/videos" rel="nofollow">aqu√≠</a> <br>  Tom√© los principales efectos <a href="https://www.tweaking4all.com/hardware/arduino/adruino-led-strip-effects/" rel="nofollow">aqu√≠</a> </div></div><p>Source: <a href="https://habr.com/ru/post/484278/">https://habr.com/ru/post/484278/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../484252/index.html">Antig√ºedades: 20 a√±os de tecnolog√≠a inform√°tica en publicaciones medi√°ticas</a></li>
<li><a href="../484254/index.html">C√≥mo: infograf√≠as o infograf√≠as?</a></li>
<li><a href="../484270/index.html">Vamos a resolver algo de dinero</a></li>
<li><a href="../484274/index.html">Chip Qualcomm ADAS</a></li>
<li><a href="../484276/index.html">Problema n. ¬∞ 29: capacitaci√≥n en TI: problemas y desaf√≠os actuales de compa√±√≠as l√≠deres</a></li>
<li><a href="../484282/index.html">El misterioso programa LyX. Parte 3</a></li>
<li><a href="../484284/index.html">[Por los muelles] Aleteo. Parte 3. Para desarrolladores nativos de React</a></li>
<li><a href="../484288/index.html">C√≥mo la confrontaci√≥n de la Guerra Fr√≠a ayuda a los chinos a comenzar la producci√≥n de computadoras</a></li>
<li><a href="../484290/index.html">La hoja de trucos que se necesita en el yate</a></li>
<li><a href="../484292/index.html">El mejor fisico</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>