<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü•ù üèÅ üò∑ Test Python avec pytest. Configuration, CHAPITRE 6 ‚úàÔ∏è üå¶Ô∏è üéóÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Retour Suivant 


 Dans ce chapitre, nous examinerons les fichiers de configuration qui affectent pytest, discuterons de la fa√ßon dont pytest modifie ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Test Python avec pytest. Configuration, CHAPITRE 6</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/448796/"><p><img src="https://habrastorage.org/webt/jl/jn/bb/jljnbbjr-ejh473xy_eccsmknpk.png">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Retour</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Suivant</a> <img src="https://habrastorage.org/webt/rw/dy/-g/rwdy-grsvbpcetjttrmecdkxtlk.png"></p><br><p>  <em>Dans ce chapitre, nous examinerons les fichiers de configuration qui affectent pytest, discuterons de la fa√ßon dont pytest modifie son comportement en fonction d'eux et apporterons quelques modifications aux t√¢ches de configuration du projet T√¢ches.</em> </p><br><p><img src="https://habrastorage.org/webt/hd/--/9w/hd--9w134j0rxhmxftrflbbdopy.png"></p><a name="habracut"></a><br><p>  Les exemples de ce livre sont √©crits en utilisant Python 3.6 et pytest 3.2.  pytest 3.2 prend en charge Python 2.6, 2.7 et Python 3.3+. </p><br><blockquote> Le code source du projet T√¢ches, ainsi que pour tous les tests pr√©sent√©s dans ce livre, est disponible sur le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" title="https://pragprog.com/titles/bopytest/source_code">lien</a> sur la page Web du livre √† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" title="https://pragprog.com/titles/bopytest">pragprog.com</a> .  Vous n'avez pas besoin de t√©l√©charger le code source pour comprendre le code de test;  le code de test est pr√©sent√© sous une forme pratique dans les exemples.  Mais pour suivre les t√¢ches du projet ou adapter des exemples de test pour tester votre propre projet (vos mains ne sont pas li√©es!), Vous devez vous rendre sur la page Web du livre et t√©l√©charger le travail.  L√†, sur la page Web du livre, il y a un lien pour les messages d' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" title="https://pragprog.com/titles/bopytest/errata">erreur</a> et un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" title="https://forums.pragprog.com/forums/438">forum de discussion</a> . </blockquote><p>  Sous le spoiler se trouve une liste d'articles de cette s√©rie. </p><br><div class="spoiler">  <b class="spoiler_title">Table des mati√®res</b> <div class="spoiler_text"><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><strong>Pr√©sentation</strong></a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><strong>Chapitre 1: Premiers pas avec Pytest</strong></a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><strong>Chapitre 2: √âcriture des fonctions de test</strong></a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><strong>Chapitre 3: Appareils Pytest</strong></a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><strong>Chapitre 4: Luminaires int√©gr√©s</strong></a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><strong>Chapitre 5: Plugins</strong></a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><strong>Chapitre 6: Configuration</strong></a> (cet article) </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><strong>Chapitre 7: Utilisation de pytest avec d'autres outils</strong></a> </li></ul></div></div><br><h2 id="konfiguraciya">  La configuration </h2><br><p>  Jusqu'√† pr√©sent, dans ce livre, j'ai parl√© de divers fichiers non-test qui affectent pytest principalement en passant, √† l'exception de conftest.py, que j'ai trait√© en d√©tail dans le chapitre 5, Plugins, √† la page 95. Dans ce chapitre, nous examinerons les fichiers de configuration, qui affectent pytest, discutez de la mani√®re dont pytest modifie son comportement en fonction de ceux-ci et apportez quelques modifications aux fichiers de configuration du projet T√¢ches. </p><br><h2 id="ponimanie-faylov-konfiguracii-pytest">  Comprendre les fichiers de configuration pytest </h2><br><p>  Avant de vous dire comment vous pouvez changer le comportement par d√©faut dans pytest, passons en revue tous les fichiers non test dans pytest et, en particulier, qui devrait s'en occuper. </p><br><p>  Vous devez savoir ce qui suit: </p><br><ul><li> <em>pytest.ini</em> : il s'agit du fichier de configuration Pytest principal qui vous permet de modifier le comportement par d√©faut.  √âtant donn√© que vous pouvez effectuer plusieurs modifications de configuration, la majeure partie de ce chapitre est consacr√©e aux param√®tres que vous pouvez effectuer dans <code>pytest.ini</code> . </li><li>  <em>conftest.py</em> : il s'agit d'un plugin local qui permet aux fonctions de hook et aux appareils d'√™tre connect√©s au r√©pertoire dans lequel le fichier <code>conftest.py</code> et √† tous ses sous-r√©pertoires.  Le fichier <code>conftest.py</code> d√©crit dans le chapitre 5 ¬´Plugins¬ª √† la page 95. </li><li>  <em><code>__init__.py</code></em> : Lorsqu'il est plac√© dans chaque sous-r√©pertoire de test, ce fichier vous permet d'avoir des noms de fichier de test identiques dans plusieurs r√©pertoires de test.  Nous allons voir un exemple de ce qui pourrait mal se passer sans les fichiers <code>__init__.py</code> dans les r√©pertoires de test dans l'article ¬´√âviter les collisions de noms de fichiers¬ª √† la page 120. </li></ul><br><p>  Si vous utilisez tox, vous serez int√©ress√© par: </p><br><ul><li>  <em>tox.ini</em> : Ce fichier est similaire √† <code>pytest.ini</code> , mais pour <code>tox</code> .  Cependant, vous pouvez placer votre configuration <code>pytest</code> au lieu d'avoir √† la fois le fichier <code>tox.ini</code> et le fichier <code>pytest.ini</code> , vous √©conomisant un fichier de configuration.  Tox est abord√© au chapitre 7, ¬´Utilisation de pytest avec d'autres outils¬ª, page 125. </li></ul><br><p>  Si vous souhaitez distribuer un package Python (par exemple T√¢ches), ce fichier sera int√©ressant: </p><br><ul><li>  <em>setup.cfg</em> : il s'agit √©galement d'un fichier INI qui affecte le comportement de <code>setup.py</code> .  Vous pouvez ajouter quelques lignes √† <code>setup.py</code> pour ex√©cuter le <code>python setup.py test</code> et ex√©cuter tous vos tests pytest.  Si vous distribuez le package, vous disposez peut-√™tre d√©j√† du fichier <code>setup.cfg</code> et vous pouvez utiliser ce fichier pour stocker la configuration Pytest.  Vous verrez comment cela se fait dans l'annexe 4, ¬´Empaquetage et distribution de projets Python¬ª, page 175. </li></ul><br><p>  Quel que soit le fichier dans lequel vous mettez la configuration pytest, le format sera fondamentalement le m√™me. </p><br><p>  Pour <code>pytest.ini</code> : </p><br><blockquote>  <strong>ch6 / format / pytest.ini</strong> </blockquote><br><pre> <code class="plaintext hljs">[pytest] addopts = -rsxX -l --tb=short --strict xfail_strict = true ... more options ...</code> </pre> <br><p>  Pour <code>tox.ini</code> : </p><br><blockquote>  <strong>ch6 / format / tox.ini</strong> </blockquote><br><pre> <code class="plaintext hljs">... tox specific stuff ... [pytest] addopts = -rsxX -l --tb=short --strict xfail_strict = true ... more options ...</code> </pre> <br><p>  Pour <code>setup.cfg</code> : </p><br><blockquote>  <strong>ch6 / format / setup.cfg</strong> </blockquote><br><pre> <code class="plaintext hljs">... packaging specific stuff ... [tool:pytest] addopts = -rsxX -l --tb=short --strict xfail_strict = true ... more options ...</code> </pre> <br><p>  La seule diff√©rence est que l'en-t√™te de section pour setup.cfg est <code>[tool:pytest]</code> au lieu de <code>[pytest]</code> . </p><br><h3 id="list-the-valid-ini-file-options-with-pytest-help">  Liste des options valides de fichier ini avec pytest ‚Äìhelp </h3><br><p>  Vous pouvez obtenir une liste de tous les param√®tres valides pour <code>pytest.ini</code> partir de <code>pytest --help</code> : </p><br><pre> <code class="plaintext hljs">$ pytest --help ... [pytest] ini-options in the first pytest.ini|tox.ini|setup.cfg file found: markers (linelist) markers for test functions empty_parameter_set_mark (string) default marker for empty parametersets norecursedirs (args) directory patterns to avoid for recursion testpaths (args) directories to search for tests when no files or directories are given in the command line. console_output_style (string) console output: classic or with additional progress information (classic|progress). usefixtures (args) list of default fixtures to be used with this project python_files (args) glob-style file patterns for Python test module discovery python_classes (args) prefixes or glob names for Python test class discovery python_functions (args) prefixes or glob names for Python test function and method discovery xfail_strict (bool) default for the strict parameter of xfail markers when not given explicitly (default: False) junit_suite_name (string) Test suite name for JUnit report junit_logging (string) Write captured log messages to JUnit report: one of no|system-out|system-err doctest_optionflags (args) option flags for doctests doctest_encoding (string) encoding used for doctest files cache_dir (string) cache directory path. filterwarnings (linelist) Each line specifies a pattern for warnings.filterwarnings. Processed after -W and --pythonwarnings. log_print (bool) default value for --no-print-logs log_level (string) default value for --log-level log_format (string) default value for --log-format log_date_format (string) default value for --log-date-format log_cli (bool) enable log display during test run (also known as "live logging"). log_cli_level (string) default value for --log-cli-level log_cli_format (string) default value for --log-cli-format log_cli_date_format (string) default value for --log-cli-date-format log_file (string) default value for --log-file log_file_level (string) default value for --log-file-level log_file_format (string) default value for --log-file-format log_file_date_format (string) default value for --log-file-date-format addopts (args) extra command line options minversion (string) minimally required pytest version xvfb_width (string) Width of the Xvfb display xvfb_height (string) Height of the Xvfb display xvfb_colordepth (string) Color depth of the Xvfb display xvfb_args (args) Additional arguments for Xvfb xvfb_xauth (bool) Generate an Xauthority token for Xvfb. Needs xauth. ...</code> </pre> <br><p>  Vous verrez tous ces param√®tres dans ce chapitre, √† l'exception de <code>doctest_optionflags</code> , qui est abord√© dans le chapitre 7, ¬´Utilisation de pytest avec d'autres outils¬ª, page 125. </p><br><h3 id="plaginy-mogut-dobavlyat-opcii-ini-faylov">  Les plugins peuvent ajouter des options de fichier ini </h3><br><p>  La liste de param√®tres pr√©c√©dente n'est pas une constante.  Pour les plugins (et les fichiers conftest.py), il est possible d'ajouter des options de fichier ini.  Les options ajout√©es seront √©galement ajout√©es √† la sortie de la commande pytest --help. <br>  Examinons maintenant quelques modifications de configuration que nous pouvons effectuer en utilisant les param√®tres int√©gr√©s du fichier .ini disponibles dans core pytest. </p><br><h3 id="izmenenie-parametrov-komandnoy-stroki-po-umolchaniyu">  Modifier les options de ligne de commande par d√©faut </h3><br><p>  Vous avez d√©j√† utilis√© certaines options de ligne de commande pour <em>pytest</em> , telles que <code>-v/--verbose</code> pour la sortie verbeuse <code>-l/--showlocals</code> pour afficher les variables locales avec une trace de pile pour les tests ayant √©chou√©.  Vous constaterez peut-√™tre que vous utilisez toujours certaines de ces <code>options‚Äîor</code> que vous pr√©f√©rez les utiliser <code>them‚Äîfor a project</code> .  Si vous installez <code>addopts</code> dans <code>pytest.ini</code> pour les param√®tres dont vous avez besoin, vous n'avez plus √† les saisir.  Voici un ensemble que j'aime: </p><br><pre> <code class="plaintext hljs">[pytest] addopts = -rsxX -l --tb=short --strict</code> </pre> <br><p>  Le <code>-rsxX</code> permet √† pytest de signaler les raisons de tous les tests <code>skipped</code> , <code>xfailed</code> ou <code>xpassed</code> .  Le commutateur <code>-l</code> permet √† pytest d'afficher une trace de pile pour les variables locales en cas de chaque √©chec.  <code>--tb=short</code> supprimera la majeure partie de la trace de la pile.  Cependant, il laissera le fichier et le num√©ro de ligne.  L' <code>--strict</code> d√©sactive l'utilisation des jetons s'ils ne sont pas enregistr√©s dans le fichier de configuration.  Vous verrez comment proc√©der dans la section suivante. </p><br><h3 id="registraciya-markerov-chtoby-izbezhat-opechatok-markera">  Enregistrement des marqueurs pour √©viter les fautes de frappe </h3><br><p>  Les marqueurs personnalis√©s, comme d√©crit dans ¬´√âtiquetage des fonctions de test¬ª √† la page 31, sont parfaits pour vous permettre de marquer un sous-ensemble de tests √† ex√©cuter avec un marqueur sp√©cifique.  Cependant, il est trop facile de faire une erreur dans le marqueur et finalement certains tests sont marqu√©s <code>@pytest.mark.smoke</code> et certains sont marqu√©s <code>@pytest.mark.somke</code> .  Par d√©faut, ce n'est pas une erreur.  pytest pense juste que vous avez cr√©√© deux marqueurs.  Cependant, cela peut √™tre r√©solu en enregistrant des jetons dans pytest.ini, par exemple comme ceci: </p><br><pre> <code class="plaintext hljs">[pytest] ... markers = smoke: Run the smoke test test functions get: Run the test functions that test tasks.get() ...</code> </pre> <br><p>  En enregistrant ces marqueurs, vous pouvez d√©sormais les voir √©galement avec les <code>pytest --markers</code> avec leurs descriptions: </p><br><pre> <code class="plaintext hljs">$ cd /path/to/code/ch6/b/tasks_proj/tests $ pytest --markers @pytest.mark.smoke: Run the smoke test test functions @pytest.mark.get: Run the test functions that test tasks.get() @pytest.mark.skip(reason=None): skip the ... ...</code> </pre> <br><p>  Si les marqueurs ne sont pas enregistr√©s, ils n'appara√Ætront pas dans la liste <code>--markers</code> .  Lorsqu'ils sont enregistr√©s, ils sont affich√©s dans la liste et si vous utilisez <code>--strict</code> , tous les jetons avec des erreurs ou non enregistr√©s sont affich√©s comme des erreurs.  La seule diff√©rence entre <code>ch6/a/tasks_proj</code> et <code>ch6/b/tasks_proj</code> est le contenu du fichier pytest.ini.  Dans <code>ch6/a</code> vide.  Essayons d'ex√©cuter les tests sans enregistrer de marqueurs: </p><br><pre> <code class="plaintext hljs">$ cd /path/to/code/ch6/a/tasks_proj/tests $ pytest --strict --tb=line ============================= test session starts ============================= collected 45 items / 2 errors =================================== ERRORS ==================================== ______________________ ERROR collecting func/test_add.py ______________________ 'smoke' not a registered marker ________________ ERROR collecting func/test_api_exceptions.py _________________ 'smoke' not a registered marker !!!!!!!!!!!!!!!!!!! Interrupted: 2 errors during collection !!!!!!!!!!!!!!!!!!! =========================== 2 error in 1.10 seconds ===========================</code> </pre> <br><p>  Si vous utilisez des marqueurs dans <code>pytest.ini</code> pour enregistrer vos marqueurs, vous pouvez √©galement ajouter <code>--strict</code> √† vos <code>addopts</code> pendant que vous y √™tes.  Tu me remercieras plus tard.  Allons de l'avant et ajoutons un fichier pytest.ini au projet de t√¢ches: </p><br><p>  Si vous utilisez des marqueurs dans <code>pytest.ini</code> pour enregistrer vos marqueurs, vous pouvez √©galement ajouter <code>--strict</code> √† vos <code>addopts</code> .  Vous me remercierez plus tard.  Continuons et ajoutons le fichier pytest.ini au projet de t√¢che: </p><br><p>  Si vous utilisez des jetons dans <code>pytest.ini</code> pour enregistrer des jetons, vous pouvez √©galement ajouter <code>--strict</code> √† ceux existants avec <code>addopts</code> .  Cool?!  <code>pytest.ini</code> remerciements et ajoutez le fichier <code>pytest.ini</code> au projet de <code>tasks</code> : </p><br><blockquote>  ch6 / b / tasks_proj / tests / pytest.ini </blockquote><br><pre> <code class="plaintext hljs">[pytest] addopts = -rsxX -l --tb=short --strict markers = smoke: Run the smoke test test functions get: Run the test functions that test tasks.get()</code> </pre> <br><p>  Voici la combinaison de drapeaux pr√©f√©r√©e par d√©faut: </p><br><ul><li>  <code>-rsxX</code> pour <code>-rsxX</code> quels tests sont ignor√©s, √©chou√©s ou xpass√©s, </li><li>  <code>--tb = short</code> pour une trace plus courte des pannes, </li><li>  <code>--strict</code> pour autoriser uniquement les jetons d√©clar√©s. <br>  Et une liste de marqueurs pour le projet. </li></ul><br><p>  Cela devrait nous permettre d'effectuer des tests, y compris des tests de fum√©e: </p><br><pre> <code class="plaintext hljs">$ cd /path/to/code/ch6/b/tasks_proj/tests $ pytest --strict -m smoke ===================== test session starts ====================== collected 57 items func/test_add.py . func/test_api_exceptions.py .. ===================== 54 tests deselected ====================== =========== 3 passed, 54 deselected in 0.06 seconds ============</code> </pre> <br><h3 id="trebovanie-minimalnoy-versii-pytest">  Exigence minimale de Pytest </h3><br><p>  Le param√®tre <code>minversion</code> permet de sp√©cifier la version minimale de pytest attendue pour les tests.  Par exemple, j'avais l'intention d'utiliser <code>approx()</code> lors du test de nombres √† virgule flottante pour d√©terminer l'√©galit√© ¬´assez proche¬ª dans les tests.  Mais cette fonction n'a √©t√© introduite dans pytest qu'√† partir de la version 3.0.  Pour √©viter toute confusion, j'ajoute ce qui suit aux projets qui utilisent <code>approx()</code> : </p><br><pre> <code class="plaintext hljs">[pytest] minversion = 3.0</code> </pre> <br><p>  Ainsi, si quelqu'un essaie d'ex√©cuter des tests √† l'aide d'une ancienne version de pytest, un message d'erreur appara√Æt. </p><br><h3 id="ostanovka-pytest-ot-poiska-v-nepravilnyh-mestah">  Emp√™chez Pytest de chercher au mauvais endroit </h3><br><p>  Saviez-vous que l'une des d√©finitions de ¬´recurse¬ª est de jurer deux fois dans votre propre code?  Et bien non.  En fait, cela signifie tenir compte des sous-r√©pertoires.  pytest permettra la d√©tection des tests en examinant r√©cursivement un tas de r√©pertoires.  Mais il y a certains r√©pertoires que vous souhaitez exclure de l'affichage de pytest. </p><br><p>  La valeur par d√©faut de <code>norecurse</code> est <code>'. * Build dist CVS _darcs {arch} and *.egg. Having '.*'</code> <code>'. * Build dist CVS _darcs {arch} and *.egg. Having '.*'</code>  <code>'. * Build dist CVS _darcs {arch} and *.egg. Having '.*'</code> Est une bonne raison de nommer votre environnement virtuel '.venv', car tous les r√©pertoires commen√ßant par un point ne seront pas visibles. </p><br><p>  Dans le cas du projet T√¢ches, <code>src</code> n'aura pas de mal √† le sp√©cifier, car la recherche dans les fichiers de test √† l'aide de pytest sera une perte de temps. </p><br><pre> <code class="plaintext hljs">[pytest] norecursedirs = .* venv src *.egg dist build</code> </pre> <br><p>  Lorsque vous remplacez un param√®tre qui a d√©j√† une valeur utile, comme ce param√®tre, il est utile de conna√Ætre les valeurs par d√©faut et de renvoyer celles dont vous avez besoin, comme je l'ai fait dans le code pr√©c√©dent avec la construction <code>*.egg dist build</code> . <br>  <code>norecursedirs</code> est une sorte de cons√©quence pour les chemins de test, nous allons donc y jeter un ≈ìil plus tard. </p><br><h3 id="specifikaciya-dereva-testovogo-kataloga">  tester la sp√©cification de l'arborescence </h3><br><p>  Alors que <code>norecursedirs</code> indique √† pytest o√π chercher, <code>testpaths</code> indique √† pytest o√π chercher.  <code>testspaths</code> est une liste de r√©pertoires relatifs au r√©pertoire racine pour rechercher des tests.  Il n'est utilis√© que si le r√©pertoire, le fichier ou le <code>nodeid</code> pas sp√©cifi√© comme argument. </p><br><p>  Supposons que pour un projet <code>Tasks</code> , nous pla√ßons <code>pytest.ini</code> dans le r√©pertoire <code>tasks_proj</code> au lieu de tests: </p><br><pre> <code class="plaintext hljs">\code\tasks_proj&gt;tree/f . ‚îÇ pytest.ini ‚îÇ ‚îú‚îÄ‚îÄ‚îÄsrc ‚îÇ ‚îî‚îÄ‚îÄ‚îÄtasks ‚îÇ api.py ‚îÇ ... ‚îÇ ‚îî‚îÄ‚îÄ‚îÄtests ‚îÇ conftest.py ‚îÇ pytest.ini ‚îÇ ‚îú‚îÄ‚îÄ‚îÄfunc ‚îÇ test_add.py ‚îÇ ... ‚îÇ ‚îú‚îÄ‚îÄ‚îÄunit ‚îÇ test_task.py ‚îÇ __init__.py ‚îÇ ...</code> </pre> <br><p>  Ensuite, il pourrait √™tre judicieux de placer les tests dans des <code>testpaths</code> de <code>testpaths</code> : </p><br><pre> <code class="plaintext hljs">[pytest] testpaths = tests</code> </pre> <br><p>  Maintenant, si vous ex√©cutez pytest √† partir du r√©pertoire tasks_proj, pytest ne recherchera que dans <code>tasks_proj/tests</code> .  Le probl√®me ici est que lors du d√©veloppement et du d√©bogage des tests, je parcours souvent le r√©pertoire de test, donc je peux facilement tester un sous-r√©pertoire ou un fichier sans sp√©cifier le chemin complet.  Par cons√©quent, cette option m'aide un peu dans les tests interactifs. </p><br><p>  Cependant, il est id√©al pour les tests ex√©cut√©s √† partir d'un serveur d'int√©gration continue ou tox.  Dans ces cas, vous savez que le r√©pertoire racine sera fixe et vous pouvez r√©pertorier les r√©pertoires relatifs √† ce r√©pertoire racine fixe.  Ce sont √©galement les cas o√π vous voulez vraiment r√©duire le temps de test, donc se d√©barrasser de la recherche de tests est super. </p><br><p>  √Ä premi√®re vue, il peut sembler idiot d'utiliser √† la fois des chemins de test et des <code>norecursedirs</code> .  Cependant, comme vous l'avez d√©j√† vu, les chemins de test aident peu dans les tests interactifs √† partir de diff√©rentes parties du syst√®me de fichiers.  Dans ces cas, les <code>norecursedirs</code> peuvent aider.  De plus, si vous avez des r√©pertoires de test qui ne contiennent pas de tests, vous pouvez utiliser <code>norecursedirs</code> pour les √©viter.  Mais en fait, quel est l'int√©r√™t de mettre des r√©pertoires suppl√©mentaires dans des tests qui n'ont pas de tests? </p><br><h2 id="izmenenie-pravil-obnaruzheniya-testov">  Modification des r√®gles de d√©tection des tests </h2><br><p>  pytest trouve les tests √† ex√©cuter en fonction de r√®gles de d√©couverte de test sp√©cifiques.  R√®gles de d√©tection de test standard: </p><br><p>  ‚Ä¢ Commencez avec un ou plusieurs r√©pertoires.  Vous pouvez sp√©cifier les noms de fichiers ou de r√©pertoires sur la ligne de commande.  Si vous n'avez rien sp√©cifi√©, le r√©pertoire courant est utilis√©. <br>  ‚Ä¢ Rechercher dans le catalogue et tous ses sous-r√©pertoires des modules de test. <br>  ‚Ä¢ Un module de test est un fichier avec un nom similaire √† <code>test_*.py</code> ou <code>*_test.py</code> . <br>  ‚Ä¢ Recherchez dans les modules de test les fonctions qui commencent par test <em>.</em> <em><br></em>  <em>‚Ä¢ Recherchez les classes qui commencent par Test.</em>  <em>Recherchez les m√©thodes dans les classes qui commencent par `test</em> <code>,    </code> <strong>init`</strong> . </p><br><p>  Ce sont des r√®gles de d√©tection standard;  Cependant, vous pouvez les modifier. </p><br><h3 id="python_classes">  python_classes </h3><br><p>  La r√®gle habituelle pour trouver des tests pour pytest et des classes est de consid√©rer une classe comme une classe de test potentielle si elle commence par <code>Test*</code> .  La classe ne peut pas non plus avoir la <code>__init__()</code> .  Mais que se passe-t-il si nous voulons nommer nos classes de test en tant que <code>&lt;something&gt;Test</code> ou <code>&lt;something&gt;Suite</code> ?  C'est l√† <code>python_classes</code> : </p><br><pre> <code class="plaintext hljs">[pytest] python_classes = *Test Test* *Suite</code> </pre> <br><p>  Cela nous permet de nommer les classes comme ceci: </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DeleteSuite</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">()</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_delete_1</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_delete_2</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> ... ....</code> </pre> <br><h3 id="python_files">  python_files </h3><br><p>  Comme <code>pytest_classes</code> , <code>python_files</code> modifie la r√®gle de d√©tection de test par d√©faut, qui consiste √† rechercher des fichiers commen√ßant par <code>test_*</code> ou ayant <code>*_test</code> √† la fin. <br>  Supposons que vous ayez un cadre de test personnalis√© dans lequel vous avez nomm√© tous vos fichiers de test <code>check_&lt;something&gt;.py</code> .  Semble raisonnable.  Au lieu de renommer tous vos fichiers, ajoutez simplement une ligne √† <code>pytest.ini</code> comme suit: </p><br><pre> <code class="plaintext hljs">[pytest] python_files = test_* *_test check_*</code> </pre> <br><p>  Tr√®s simple.  Vous pouvez maintenant transf√©rer progressivement la convention de d√©nomination si vous le souhaitez, ou simplement la laisser sous <code>check_*</code> . </p><br><h3 id="python_functions">  fonctions_python </h3><br><p>  <code>python_functions</code> agit comme les deux param√®tres pr√©c√©dents, mais pour les fonctions de test et les noms de m√©thode.  La valeur par d√©faut est <code>test_*</code> .  Et pour ajouter <code>check_*</code> devin√© - faites ceci: </p><br><pre> <code class="plaintext hljs">[pytest] python_functions = test_* check_*</code> </pre> <br><p>  Les <code>pytest</code> d√©nomination <code>pytest</code> ne semblent pas si restrictives, n'est-ce pas?  Donc, si vous n'aimez pas la convention de d√©nomination par d√©faut, changez-la simplement.  N√©anmoins, je vous exhorte √† avoir une raison plus imp√©rieuse pour de telles d√©cisions.  La migration de centaines de fichiers de test est certainement une bonne raison. </p><br><h2 id="zapret-xpass">  Interdiction XPASS </h2><br><p>  La d√©finition de <code>xfail_strict = true</code> signifie que les tests marqu√©s avec <code>@pytest.mark.xfail</code> ne sont pas reconnus comme provoquant l'erreur.  Je pense que ce param√®tre devrait toujours √™tre.  Pour plus d'informations sur le jeton <code>xfail</code> voir ¬´Marquage des tests en attente d'√©chec¬ª, page 37. </p><br><h2 id="predotvraschenie-konfliktov-imen-faylov">  Emp√™cher les conflits de noms de fichiers </h2><br><p>  L'utilit√© d'avoir le fichier <code>__init__.py</code> dans chaque sous-r√©pertoire de test du projet m'a longtemps d√©rout√©.  Cependant, la diff√©rence entre les avoir ou ne pas les avoir est simple.  Si vous avez des fichiers <code>__init__.py</code> dans tous vos sous-r√©pertoires de test, vous pouvez avoir le m√™me nom de fichier de test dans plusieurs r√©pertoires.  Et sinon, cela ne fonctionnera pas. </p><br><p>  Voici un exemple.  Les r√©pertoires <code>a</code> et <code>b</code> ont tous deux le fichier <code>test_foo.py</code> .  Peu importe ce que ces fichiers contiennent, mais pour cet exemple, ils ressemblent √† ceci: </p><br><blockquote>  <strong>ch6 / dups / a / test_foo.py</strong> <br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_a</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span></code> </pre> <br><br>  <strong>ch6 / dups / b / test_foo.py</strong> <br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_b</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span></code> </pre> <br></blockquote><p>  Avec cette structure de r√©pertoire: </p><br><pre> <code class="plaintext hljs">dups ‚îú‚îÄ‚îÄ a ‚îÇ ‚îî‚îÄ‚îÄ test_foo.py ‚îî‚îÄ‚îÄ b ‚îî‚îÄ‚îÄ test_foo.py</code> </pre> <br><p>  Ces fichiers n'ont m√™me pas le m√™me contenu, mais les tests sont corrompus.  Vous pourrez les ex√©cuter s√©par√©ment, mais il n'y a aucun moyen d'ex√©cuter <code>pytest</code> partir du r√©pertoire <code>dups</code> : </p><br><pre> <code class="plaintext hljs">$ cd /path/to/code/ch6/dups $ pytest a ============================= test session starts ============================= collected 1 item a\test_foo.py . ========================== 1 passed in 0.05 seconds =========================== $ pytest b ============================= test session starts ============================= collected 1 item b\test_foo.py . ========================== 1 passed in 0.05 seconds =========================== $ pytest ============================= test session starts ============================= collected 1 item / 1 errors =================================== ERRORS ==================================== _______________________ ERROR collecting b/test_foo.py ________________________ import file mismatch: imported module 'test_foo' has this __file__ attribute: /path/to/code/ch6/dups/a/test_foo.py which is not the same as the test file we want to collect: /path/to/code/ch6/dups/b/test_foo.py HINT: remove __pycache__ / .pyc files and/or use a unique basename for your test file modules !!!!!!!!!!!!!!!!!!! Interrupted: 1 errors during collection !!!!!!!!!!!!!!!!!!! =========================== 1 error in 0.34 seconds ===========================</code> </pre> <br><p>  Rien n'est clair! <br>  Ce message d'erreur n'indique pas ce qui s'est mal pass√©. </p><br><p>  Pour corriger ce test, ajoutez simplement le fichier <code>__init__.py</code> vide aux sous-r√©pertoires.  Voici un exemple du r√©pertoire <code>dups_fixed</code> avec les m√™mes noms de fichiers en double, mais avec des fichiers <code>__init__.py</code> ajout√©s: </p><br><pre> <code class="plaintext hljs">dups_fixed/ ‚îú‚îÄ‚îÄ a ‚îÇ ‚îú‚îÄ‚îÄ __init__.py ‚îÇ ‚îî‚îÄ‚îÄ test_foo.py ‚îî‚îÄ‚îÄ b ‚îú‚îÄ‚îÄ __init__.py ‚îî‚îÄ‚îÄ test_foo.py</code> </pre> <br><p>  Essayons maintenant √† nouveau √† partir du niveau sup√©rieur dans <code>dups_fixed</code> : </p><br><pre> <code class="plaintext hljs">$ cd /path/to/code/ch6/ch6/dups_fixed/ $ pytest ============================= test session starts ============================= collected 2 items a\test_foo.py . b\test_foo.py . ========================== 2 passed in 0.15 seconds ===========================</code> </pre> <br><p>  Ce sera donc mieux. </p><br><p>  Bien s√ªr, vous pouvez vous convaincre que vous n'aurez jamais de noms de fichiers en double, donc cela n'a pas d'importance.  Tout, comme, est normal.  Mais les projets grandissent et les catalogues de tests se d√©veloppent, et vous voulez vraiment attendre que cela vous arrive avant de vous en occuper?  Je dis, il suffit de mettre ces fichiers l√†-bas.  Faites-en une habitude et ne vous en souciez plus. </p><br><h2 id="uprazhneniya">  Exercices </h2><br><p>  Au Chapitre 5, Plugins, √† la page 95, vous avez cr√©√© un plugin appel√© pytest-nice qui incluait une option de ligne de commande --nice.  √âtendons cela pour inclure une option pytest.ini appel√©e nice. </p><br><p>  Au chapitre 5, ¬´Plugins¬ª √† la page 95, vous avez cr√©√© un plugin appel√© <code>pytest-nice</code> qui inclut l' <code>--nice</code> ligne de commande <code>--nice</code> .  D√©veloppons ceci pour inclure l'option <code>pytest.ini</code> appel√©e <code>nice</code> . </p><br><ol><li>  Ajoutez la ligne suivante √† la fonction de crochet <code>pytest_addoption</code> <code>pytest_nice.py</code> : <code>parser.addini('nice', type='bool', help='Turn failures into opportunities.')</code> </li><li>  Les endroits du plugin qui utilisent <code>getoption()</code> devront √©galement appeler <code>getini('nice')</code> .  Apportez ces modifications. </li><li>  V√©rifiez cela manuellement en ajoutant <code>nice</code> au fichier <code>pytest.ini</code> . </li><li>  N'oubliez pas les tests de plugin.  Ajoutez un test pour v√©rifier que le <code>nice</code> param√®tre de <code>pytest.ini</code> fonctionne correctement. </li><li>  Ajoutez des tests au r√©pertoire du plugin.  Vous devez trouver des fonctionnalit√©s <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">suppl√©mentaires de Pytester</a> . </li></ol><br><h2 id="chto-dalshe">  Et ensuite </h2><br><p>  Bien que pytest soit extr√™mement puissant en soi - en particulier avec les plugins - il s'int√®gre √©galement bien avec d'autres outils de d√©veloppement et de test de logiciels.  Dans le chapitre suivant, nous examinerons l'utilisation de pytest conjointement avec d'autres outils de test puissants. </p><br><p><img src="https://habrastorage.org/webt/jl/jn/bb/jljnbbjr-ejh473xy_eccsmknpk.png">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Retour</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Suivant</a> <img src="https://habrastorage.org/webt/rw/dy/-g/rwdy-grsvbpcetjttrmecdkxtlk.png"></p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr448796/">https://habr.com/ru/post/fr448796/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr448784/index.html">Nouvelles fonctionnalit√©s pour les auteurs d'extensions dans Visual Studio 2019 version 16.1</a></li>
<li><a href="../fr448786/index.html">Test Python avec pytest. CHAPITRE 3 Appareils pytest</a></li>
<li><a href="../fr448790/index.html">SpaceVIL - Framework GUI multiplateforme pour le d√©veloppement sur .Net Core, .Net Standard et JVM</a></li>
<li><a href="../fr448792/index.html">Test Python avec pytest. Luminaires int√©gr√©s, Chapitre 4</a></li>
<li><a href="../fr448794/index.html">Test Python avec pytest. Plugins CHAPITRE 5</a></li>
<li><a href="../fr448798/index.html">Test Python avec pytest. Utilisation de pytest avec d'autres outils, CHAPITRE 7</a></li>
<li><a href="../fr448800/index.html">Configurer Visual Studio dans votre organisation avec .vsconfig</a></li>
<li><a href="../fr448802/index.html">Penser avec des portails: cr√©er des portails dans Unreal Engine 4</a></li>
<li><a href="../fr448804/index.html">Se pr√©parer pour le runtime et le notaire renforc√©s de macOS</a></li>
<li><a href="../fr448806/index.html">Cr√©ation d'un syst√®me d'extension sur la biblioth√®que Qt</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>