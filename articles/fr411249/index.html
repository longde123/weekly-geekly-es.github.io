<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘©â€â¤ï¸â€ğŸ‘© ğŸ”¢ ğŸ‘¨ğŸ¾â€ğŸ³ Comment j'ai fait mon Yandex.Transport avec les horaires et les bus ğŸ‘— ğŸ“¡ ğŸ¹</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="PubliÃ© par Mikhail Aksenov, dÃ©veloppeur .NET, DataArt 



- Site Internet du projet Vrnbus (Voronezh Buses); 
- Bot tÃ©lÃ©gramme: @vrnbusbot ; 
- Projet...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comment j'ai fait mon Yandex.Transport avec les horaires et les bus</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dataart/blog/411249/"><img src="https://habrastorage.org/webt/a0/8u/mi/a08umi6_8yn4eobkvs63zv_s9tq.jpeg"><br><br>  <i>PubliÃ© par Mikhail Aksenov, dÃ©veloppeur .NET, DataArt</i> <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Site Internet du projet Vrnbus</a> (Voronezh Buses); </li><li>  Bot tÃ©lÃ©gramme: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">@vrnbusbot</a> ; </li><li>  Projet <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Github</a> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">vrntrans / vrnbus</a> . </li></ul><br><h2>  Comment tout a commencÃ© </h2><br>  Ã€ l'automne 2014, il y avait de bonnes nouvelles que Yandex.Transport a Ã©tÃ© lancÃ© Ã  Voronej, qui montre le mouvement des bus et des trolleybus.  C'Ã©tait trÃ¨s cool juste Ã  l'arrÃªt de bus pour ouvrir un horaire et dÃ©couvrir que votre bus fonctionnera en 5 minutes. <br><br>  Mais aprÃ¨s quelques mois, tout s'est dÃ©roulÃ© selon un scÃ©nario complÃ¨tement prÃ©visible.  Ã‰tant donnÃ© que tout le transport Ã  Voronej du chariot au minibus fonctionne en espÃ¨ces, chaque chauffeur est intÃ©ressÃ© Ã  transporter le plus de passagers possible.  En consÃ©quence, ils organisent des courses entre eux. <br><br>  Les conducteurs ont utilisÃ© le nouveau service pour se suivre sur la carte, doubler et couper les concurrents sur la route.  Certains ont commencÃ© Ã  baisser leurs revenus, ils ont commencÃ© Ã  se plaindre aux propriÃ©taires des itinÃ©raires, et ils sont allÃ©s voir des gens vendre des Ã©quipements avec GLONASS et GPS et envoyer des donnÃ©es sur les mouvements de voitures Ã  Yandex.  Ã€ la demande des propriÃ©taires de la flotte, ils ont cessÃ© d'envoyer des informations et les bus ont immÃ©diatement commencÃ© Ã  disparaÃ®tre de la carte.  Maintenant, il y en a un peu plus, mais c'est encore beaucoup moins qu'en rÃ©alitÃ©. <a name="habracut"></a><br><br><img src="https://habrastorage.org/webt/hy/2p/d9/hy2pd9kotq6w2jrb__n5gm8nzx0.jpeg"><br><br>  Pour ceux qui sont trop paresseux pour lire plus loin, je propose un reportage vidÃ©o sur ce sujet: <iframe width="560" height="315" src="https://www.youtube.com/embed/1OtHwGqSL04" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br>  Pour le reste - je dÃ©crirai le projet sous forme de texte. <br><br><h2>  OÃ¹ obtenir les donnÃ©es? </h2><br>  Dans le mÃªme temps, Ã  Voronej, il y a un endroit oÃ¹ toutes les donnÃ©es sont collectÃ©es - le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Centre pour l'organisation de la circulation routiÃ¨re</a> (DPC).  Ils ont une application Web volumineuse et lourde sur leur site avec JavaScript non durable et d'autres artefacts, tandis que tout y est livrÃ© avec des requÃªtes POST et rien n'est mis en cache.  En utilisant ce site lui-mÃªme, vous pouvez facilement mettre en place un service de collecte de donnÃ©es sur la circulation des bus. <br><br>  Il y avait une option qui vous permet de fouiller sur la carte et de savoir quand le bus arrivera et ce qu'il sera.  Pourvu que vous arriviez approximativement Ã  un arrÃªt (Â± 50 mÃ¨tres).  Dans le menu, vous pouvez ouvrir une liste d'itinÃ©raires et voir exactement oÃ¹ vont les bus, mais il y avait un problÃ¨me - ils conduisaient Ã©trangement.  Par exemple, le long de Koltsovskaya, une rue du centre oÃ¹ vous ne pouvez pas particuliÃ¨rement accÃ©lÃ©rer, le bus a avancÃ© et reculÃ© Ã  une vitesse d'environ 200 km / h. <br><br><br><h2>  Pourquoi Python? </h2><br>  J'ai choisi Python parce que c'est cool, les piles sont regroupÃ©es, etc. Et 3.6 parce qu'il y a un formatage pour les littÃ©raux de chaÃ®ne, la frappe, c'est tout.  Voyons ce que j'ai essentiellement utilisÃ©: <br><br><ul><li>  Beaucoup se sont plaints que conduire le nom exact d'un arrÃªt avec toutes sortes de signes de ponctuation est trÃ¨s difficile.  Ensuite, j'ai rÃ©alisÃ© la possibilitÃ© d'une recherche floue et crÃ©Ã© le premier test unitaire pour cela. </li><li>  L'ensemble du systÃ¨me est hÃ©bergÃ© sur Heroku.  C'est gratuit, parce que je n'ai pas de base de donnÃ©es - j'espÃ¨re m'en sortir avec la base de donnÃ©es du centre de donnÃ©es.  J'ai convenu de son utilisation avec le Centre lorsque j'ai rÃ©alisÃ© que les donnÃ©es que je collectais via l'interface Web n'Ã©taient pas suffisantes. </li><li>  En fait, l'hÃ©bergement passe par le serveur Web Tornado.  Je pense qu'il est familier Ã  tous ceux qui ont rencontrÃ© des demandes Web en Python. </li><li>  J'avais besoin du package Pytz car le serveur Heroku est dans un fuseau horaire diffÃ©rent et les donnÃ©es me parviennent sans spÃ©cifier de fuseau horaire.  J'ai donc moi-mÃªme pris en charge la localisation. </li><li>  Pour crÃ©er le bot, j'ai utilisÃ© la bibliothÃ¨que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Python-telegram-bot</a> recommandÃ©e.  La documentation ici est tout Ã  fait adÃ©quate et, en gÃ©nÃ©ral, la bibliothÃ¨que rÃ©pond aux exigences minimales du produit viable.  Initialement, l'ensemble du projet Ã©tait un bot Telegram, qui en rÃ©ponse Ã  l'envoi de votre emplacement a envoyÃ© un horaire de bus. </li><li>  Firebird, un ancien Interbase, est une base de donnÃ©es open source avec laquelle je pense que beaucoup d'entre vous ont travaillÃ©.  Bien sÃ»r, ce n'est pas aussi cool que le mÃªme PostgreSQL, mais pour un trÃ¨s grand nombre de requÃªtes c'est suffisant.  Dans notre cas, il n'en faut plus. </li><li>  Cachetools est un module trÃ¨s simple qui vous permet de mettre en cache les calculs.  Bien sÃ»r, cela ne concerne pas la mise en cache ou la mise en cache des pages Web, mais les cas oÃ¹ vous avez besoin de mÃ©morisation pour de longues requÃªtes.  Prenez-le, ajoutez le dÃ©corateur appropriÃ© - et tout fonctionne.  Le cache a diffÃ©rentes options, j'utilise la version TTL, qui enregistre les donnÃ©es pour le temps spÃ©cifiÃ©, car je sais que les donnÃ©es ne seront pas mises Ã  jour plus souvent qu'Ã  certains intervalles (dans mon cas - 30 secondes). </li></ul><br><br><h2>  FonctionnalitÃ© du bot </h2><br><ul><li>  / nom du prochain arrÃªt de bus - heure d'arrivÃ©e prÃ©vue; </li><li>  / derniers numÃ©ros d'itinÃ©raire sÃ©parÃ©s par des espaces - derniers arrÃªts; </li><li>  Envoi du lieu - l'heure d'arrivÃ©e prÃ©vue pour les trois prochains arrÃªts; </li><li>  EntrÃ©e gratuite - numÃ©ros d'itinÃ©raire et distance par rapport aux bus (lors de l'envoi de la position). </li></ul><br><br>  J'ai essayÃ© de dÃ©crire les commandes suffisamment pour que les gens ne demandent pas comment les utiliser.  Il existe essentiellement deux commandes de base: nextbus, lorsque vous Ã©crivez le nom de l'arrÃªt, et l'envoi de l'emplacement. <br><br><h2>  FonctionnalitÃ© du site </h2><br>  J'ai rendu le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">site Web</a> aussi minimaliste que possible.  Parmi les bibliothÃ¨ques tierces, je n'en ai utilisÃ© que deux pour prendre en charge la rÃ©cupÃ©ration et la promesse, car les anciennes versions des navigateurs prÃ©installÃ©s dans les tÃ©lÃ©phones ne peuvent pas s'en passer.  Si vous ne supportez pas ces mÃ©thodes, vous obtiendrez des nouilles de rappel assez lourdes pour les demandes elles-mÃªmes.  Avec fetch, tout semble plus Ã©lÃ©gant. <br><br><img src="https://habrastorage.org/webt/vn/sd/gu/vnsdgutglxminl8j6wi07w4nkp0.jpeg"><br><br>  En fait, la fonctionnalitÃ© se compose ici de 4 points: <br><br><ol><li>  <b>ArrivÃ©e</b>  Vous pouvez simplement regarder l'arrÃªt.  En cliquant sur le bouton (au fait, cela vaut peut-Ãªtre la peine d'en faire un peu plus - j'y pense!), Vous envoyez votre position, le systÃ¨me recherche les trois arrÃªts les plus proches de vous et affiche des informations Ã  leur sujet.  Vous pouvez entrer le nom de l'arrÃªt et obtenir des informations Ã  ce sujet.  Comme vous n'avez pratiquement pas besoin de tous les 20-30 bus pouvant arriver Ã  l'arrÃªt de bus, vous pouvez les filtrer par itinÃ©raire. </li><li>  <b>Autobus</b>  La deuxiÃ¨me page contient des informations sur les bus.  Cela est dÃ» Ã  une autre histoire qui m'a poussÃ© Ã  ce projet.  Un beau jour, j'ai oubliÃ© le chapeau dans le bus, appelÃ© la salle de contrÃ´le, expliquÃ© oÃ¹ c'Ã©tait arrivÃ©.  Le rÃ©partiteur a suggÃ©rÃ© que j'attrape mon bus au centre, oÃ¹ il reviendra, se retournant au terminal.  Je me souvenais que j'avais un identifiant et un mot de passe du systÃ¨me Center for Traffic Management, mais il s'est avÃ©rÃ© que je ne pouvais toujours pas suivre l'emplacement de la voiture dont j'avais besoin via l'interface Web.  J'ai rendu le chapeau, mais avec beaucoup de difficultÃ©. <br>  Je pensais que trouver un bus pourrait Ãªtre beaucoup plus facile.  J'ai Ã©crit le numÃ©ro de l'itinÃ©raire et le systÃ¨me vous montre les voitures sur la ligne, leur emplacement actuel et l'heure Ã  laquelle elles sont passÃ©es s'arrÃªte en cours de route.  Et mÃªme si vous connaissez le numÃ©ro de l'itinÃ©raire, mais que vous connaissez le numÃ©ro de bus (cela se produit Ã©galement), vous pouvez toujours le trouver. </li><li>  <b>Carte.</b>  Carte sur le site sans animation.  Ici, vous pouvez sÃ©lectionner des bus dans la liste ou entrer des numÃ©ros manuellement, vous pouvez les filtrer.  Jusqu'Ã  600 bus peuvent Ãªtre indiquÃ©s sur la carte, bien qu'aprÃ¨s 20, il devienne difficile de trouver quelque chose au centre, simplement parce que les itinÃ©raires sont tous concentrÃ©s ici.  Par consÃ©quent, il est prÃ©fÃ©rable de limiter la recherche Ã  des paramÃ¨tres plus stricts. </li><li>  <b>Ã€ propos du projet.</b>  Maintenant, le projet a un site Web, il y a un bot Telegram, des groupes dans les rÃ©seaux sociaux. </li></ol><br><br>  *** <br>  Heureusement, Python est un langage avec des piles prÃªtes Ã  l'emploi.  Pour les choses simples, vous n'avez mÃªme pas besoin de tÃ©lÃ©charger quoi que ce soit, il suffit de lire attentivement la documentation. <br><br>  Bien sÃ»r, de tels services peuvent Ãªtre effectuÃ©s pour d'autres villes, d'ailleurs, dans certaines, ils travaillent dÃ©jÃ .  Cela dÃ©pend beaucoup du centre de donnÃ©es local, Ã  certains endroits, par exemple, Ã  Saint-PÃ©tersbourg, il existe mÃªme une API pour les dÃ©veloppeurs.  Mais le plus important, ce sont les citadins qui veulent changer leur ville pour le mieux. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr411249/">https://habr.com/ru/post/fr411249/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr411239/index.html">DIY-crÃ©ativitÃ© dÃ¨s l'enfance: inculquer l'amour des produits faits maison</a></li>
<li><a href="../fr411241/index.html">"Kepler" a dÃ©couvert une Ã©trange supernova: a rapidement pris feu, est rapidement sorti</a></li>
<li><a href="../fr411243/index.html">DÃ©chets - vers le four</a></li>
<li><a href="../fr411245/index.html">Montrons-nous Ã  l'Univers: les phares qui resteront aprÃ¨s notre civilisation</a></li>
<li><a href="../fr411247/index.html">Les enfants les plus Â«intelligentsÂ» regardent VTech Kidizoom. Comment les choses sont vraiment</a></li>
<li><a href="../fr411251/index.html">Les utilisateurs ne sont pas satisfaits des fichiers de numÃ©risation Chrome sur le disque local</a></li>
<li><a href="../fr411253/index.html">La fusion des Ã©toiles Ã  neutrons a mis fin aux alternatives de la matiÃ¨re noire et de l'Ã©nergie noire</a></li>
<li><a href="../fr411255/index.html">Des applications dÃ©centralisÃ©es pour des millions d'utilisateurs sur Ethereum</a></li>
<li><a href="../fr411257/index.html">Aux Ã‰tats-Unis, ils crÃ©ent un systÃ¨me laser qui effrayera l'ennemi par le son</a></li>
<li><a href="../fr411259/index.html">Nous connectons un compteur d'eau Ã  une maison intelligente</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>