<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üê¢ ‚óºÔ∏è üòé Interacci√≥n de R con bases de datos en el ejemplo de Microsoft SQL Server y otros DBMS üõ∑ üõéÔ∏è üèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dado que la mayor parte de la informaci√≥n comercial se almacena en bases de datos. En cualquier lenguaje de programaci√≥n que escriba, debe realizar va...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Interacci√≥n de R con bases de datos en el ejemplo de Microsoft SQL Server y otros DBMS</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/461063/"><p>  Dado que la mayor parte de la informaci√≥n comercial se almacena en bases de datos.  En cualquier lenguaje de programaci√≥n que escriba, debe realizar varias acciones con ellos. </p><br><p>  En este art√≠culo hablar√© sobre dos interfaces para trabajar con bases de datos en R. La mayor√≠a de los ejemplos demuestran trabajar con Microsoft SQL Server, sin embargo, todos los ejemplos de c√≥digo funcionar√°n con otras bases de datos, tales como: MySQL, PostgreSQL, SQLite, ClickHouse , Google BigQuery, etc. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/925/a23/786/925a23786a89917d9a314a793545cbb1.jpg" alt="imagen"></p><a name="habracut"></a><br><h1 id="soderzhanie">  Contenido </h1><br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Software requerido</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Paquete DBI</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Lista de funciones b√°sicas de DBI</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Conectividad de base de datos</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Un ejemplo de conexi√≥n a Microsoft SQL Server usando el paquete odbc</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Un ejemplo de conexi√≥n a Microsoft SQL Server usando el paquete RMSSQL</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">C√≥mo ocultar contrase√±as de bases de datos en scripts R</a> </li></ul></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Crear tablas y escribir en la base de datos</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Leer datos de un DBMS</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Manipulaci√≥n de datos en DBMS (DML)</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Transacciones en el DBMS</a> </li></ul></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Paquete RODBC</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Caracter√≠sticas clave del paquete RODBC</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Un ejemplo de trabajo con RODBC</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Transaccional</a> </li></ul></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Conclusi√≥n</a> </li></ul><br><h1 id="trebuemoe-programmnoe-obespechenie">  Software requerido </h1><br><p>  Para repetir todos los ejemplos de trabajo con el DBMS descritos en el art√≠culo, necesitar√° el siguiente software gratuito que se detalla a continuaci√≥n: </p><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Lenguaje R</a> ; </li><li>  Entorno de desarrollo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">RStudio</a> ; </li><li>  Sistema de gesti√≥n de bases de datos, para elegir: <br>  3.1.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Microsoft SQL Server</a> <br>  3.2.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">MySQL</a> <br>  3.3.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">PostgreSQL</a> </li></ol><br><h1 id="paket-dbi">  Paquete DBI </h1><br><p> El paquete <code>DBI</code> es la forma m√°s popular y conveniente de interactuar con bases de datos en R. </p><br><p>  <code>DBI</code> proporciona un conjunto de funciones con las que puede administrar bases de datos.  Pero para conectarse a las bases de datos, debe instalar paquetes adicionales que sean controladores para varios sistemas de administraci√≥n de bases de datos (DBMS). </p><br><h3 id="spisok-osnovnyh-funkciy-dbi">  Lista de funciones b√°sicas de DBI </h3><br><ul><li>  <code>dbConnect</code> - conexi√≥n a la base de datos; </li><li>  <code>dbWriteTable</code> : escribe una tabla en la base de datos; </li><li>  <code>dbReadTable</code> : carga una tabla desde una base de datos; </li><li>  <code>dbGetQuery</code> : carga el resultado de la ejecuci√≥n de la consulta; </li><li>  <code>dbSendQuery</code> - enviando una consulta a la base de datos; </li><li>  <code>dbFetch</code> : extrae elementos de un conjunto de resultados; </li><li>  <code>dbExecute</code> : ejecuci√≥n de solicitudes para actualizar / eliminar / insertar datos en tablas; </li><li>  <code>dbGetInfo</code> : solicita informaci√≥n sobre el resultado de la solicitud o conexi√≥n; </li><li>  <code>dbListFields</code> : solicitud de una lista de campos de tabla; </li><li>  <code>dbListTables</code> : consulta una lista de tablas de base de datos; </li><li>  <code>dbExistsTable</code> : verifica la presencia de una tabla en la base de datos; </li><li>  <code>dbRemoveTable</code> : elimina una tabla de la base de datos; </li><li>  <code>dbDisconnect</code> : desconectarse de la base de datos. </li></ul><br><h3 id="podklyuchenie-k-bazam-dannyh">  Conectividad de base de datos </h3><br><p>  Para interactuar con las bases de datos, primero debe conectarse a ellas.  Dependiendo del DBMS con el que planea trabajar, necesitar√° un paquete adicional, a continuaci√≥n encontrar√° una lista de los m√°s utilizados. </p><br><ul><li>  <code>odbc</code> : controlador para conectarse a trav√©s de la interfaz ODBC; </li><li>  <code>RSQLite</code> - Controlador para SQLite; </li><li>  <code>RMySQL</code> / <code>RMariaDB</code> - Controlador para MySQL y MariaDB; </li><li>  <code>RPostgreSQL</code> - Controlador para PosrtgreSQL; </li><li>  <code>bigrquery</code> - Controlador para Google BigQuery; </li><li>  <code>RClickhouse</code> / <code>clickhouse</code> - Controlador para ClickHouse; </li><li>  <code>RMSSQL</code> : el controlador para Microsoft SQL Server (MS SQL), <em>en el momento de la escritura, solo est√° presente en GitHub</em> . </li></ul><br><p>  El paquete <code>DBI</code> viene con el paquete b√°sico R, pero los paquetes que son controladores de base de datos deben instalarse utilizando el comando <code>install.packages(" ")</code> . </p><br><p>  Para instalar paquetes desde GitHub, tambi√©n necesitar√° un paquete adicional: <code>devtools</code> .  Por ejemplo, el paquete <code>RMSSQL</code> no est√° publicado actualmente en el repositorio principal del paquete R, use el siguiente c√≥digo para instalarlo: </p><br><pre> <code class="plaintext hljs">install.packages("devtools") devtools::install_github("bescoto/RMSSQL")</code> </pre> <br><h4 id="primer-podklyucheniya-k-microsoft-sql-server-s-pomoschyu-paketa-odbc">  Un ejemplo de conexi√≥n a Microsoft SQL Server usando el paquete odbc </h4><br><p>  Antes de usar cualquier paquete en una sesi√≥n R, primero debe conectarse usando la funci√≥n de <code>library(" ")</code> . </p><br><p>  No sin raz√≥n eleg√≠ Microsoft SQL Server como el DBMS principal, que proporcionar√° la mayor√≠a de los ejemplos en este art√≠culo.  El hecho es que esta es una base de datos bastante popular, pero al mismo tiempo todav√≠a no tiene un controlador para conectarse desde R publicado en CRAN. </p><br><p>  Pero afortunadamente, SQL Server, como casi cualquier otra base de datos, tiene una interfaz <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ODBC</a> (English Open Database Connectivity) para conectarse.  Hay varios paquetes para conectarse al DBMS a trav√©s de la interfaz ODBC en R.  Primero, veremos la conexi√≥n a trav√©s del paquete <code>odbc</code> . </p><br><div class="spoiler">  <b class="spoiler_title">F√°cil conexi√≥n a la base de datos a trav√©s de la interfaz odbc</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">#   odbc install.packages("odbc") #   library(odbc) #   MS SQL con &lt;- dbConnect(drv = odbc(), Driver = "SQL Server", Server = "localhost", Database = "mybase", UID = "my_username", PWD = "my_password", Port = 1433)</code> </pre> </div></div><br><p>  En la funci√≥n <code>dbConnect()</code> , debe pasar la funci√≥n, que es el controlador para conectarse al DBMS ( <code>odbc()</code> ), como primer argumento para <em>drv</em> .  Dichas funciones generalmente se llaman igual que el DBMS y vienen con paquetes que son controladores para <code>DBI</code> . </p><br><p>  A continuaci√≥n, debe enumerar los par√°metros de conexi√≥n.  Para conectarse a MS SQL a trav√©s de ODBC, debe especificar los siguientes par√°metros: </p><br><ul><li>  Controlador: nombre del controlador ODBC; </li><li>  Servidor: direcci√≥n IP del servidor SQL; </li><li>  Base de datos: el nombre de la base de datos para conectarse; </li><li>  UID: nombre de usuario de la base de datos; </li><li>  PWD - Contrase√±a; </li><li>  Puerto: el puerto con el que conectarse, SQL Server tiene un puerto predeterminado de 1433. </li></ul><br><p>  Un controlador ODBC para conectarse a Microsoft SQL Server se incluye con Windows, pero puede tener un nombre diferente.  Puede ver la lista de controladores instalados en el Administrador de fuente de datos ODBC.  Puede iniciar el administrador de la fuente de datos en Windows 10 de la siguiente manera: </p><br><ul><li>  Versi√≥n de 32 bits: <code>%systemdrive%\Windows\SysWoW64\Odbcad32.exe</code> </li><li>  Versi√≥n de 64 bits: <code>%systemdrive%\Windows\System32\Odbcad32.exe</code> </li></ul><br><p><img src="https://habrastorage.org/getpro/habr/post_images/c6c/816/934/c6c816934a70e2386a4547d7626d515f.png"></p><br><p>  Tambi√©n puede obtener una lista de todos los controladores instalados en su PC utilizando la funci√≥n <code>odbcListDrivers()</code> . </p><br><pre> <code class="plaintext hljs"> name attribute value &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; 1 SQL Server APILevel 2 2 SQL Server ConnectFunctions YYY 3 SQL Server CPTimeout 60 4 SQL Server DriverODBCVer 03.50 5 SQL Server FileUsage 0 6 SQL Server SQLLevel 1 7 SQL Server UsageCount 1 8 MySQL ODBC 5.3 ANSI Driver UsageCount 1 9 MySQL ODBC 5.3 Unicode Driver UsageCount 1 10 Simba ODBC Driver for Google BigQuery Description Simba ODBC Driver for Google BigQuery2.0 # ... with 50 more rows</code> </pre> <br><p>  Puede descargar los controladores ODBC para otros DBMS en los siguientes enlaces: </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">MySQL</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">PostgreSQL</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Google bigquery</a> </li></ul><br><p>  Para varios DBMS, el nombre de los par√°metros para la conexi√≥n puede ser diferente, por ejemplo: </p><br><ul><li>  PostgreSQL / MySQL / MariaDB: usuario, contrase√±a, host, puerto, dbname; </li><li>  GoogleBigQuery - proyecto, conjunto de datos; </li><li>  ClickHouse: usuario, contrase√±a, base de datos, puerto, host; </li></ul><br><p>  Con el administrador de la fuente de datos ODBC, puede ejecutar el asistente para crear una fuente de datos ODBC.  Para hacer esto, simplemente abra el administrador, vaya a la pesta√±a "DSN personalizado" y haga clic en el bot√≥n "Agregar ...". </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/9ae/e92/ba3/9aee92ba30bdc8de811623aae1fb58fa.png"></p><br><p>  Al crear un origen de datos con un administrador, debe asignarle un nombre, DSN (Nombre del origen de datos). </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/b03/a0c/a7c/b03a0ca7c90fa0d5bddccb53575563a3.png"></p><br><p>  En el ejemplo anterior, creamos una fuente de datos con el DSN "my_test_source".  Ahora podemos usar esta fuente para conectarnos a Microsoft SQL Server y no especificar otros par√°metros de conexi√≥n en el c√≥digo. </p><br><div class="spoiler">  <b class="spoiler_title">Conexi√≥n a la base de datos a trav√©s de la interfaz odbc usando DSN</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">#   DSN con &lt;- dbConnect(odbc(), DSN = "my_test_source", UID = "my_username", PWD = "my_password")</code> </pre> </div></div><br><p>  Puede ver los nombres de todas las fuentes de datos ODBC creadas en su PC utilizando la funci√≥n <code>odbcListDataSources()</code> . </p><br><pre> <code class="plaintext hljs"> name description &lt;chr&gt; &lt;chr&gt; 1 BQ Simba ODBC Driver for Google BigQuery 2 BQ_main Simba ODBC Driver for Google BigQuery 3 BQ ODBC Simba ODBC Driver for Google BigQuery 4 OLX Simba ODBC Driver for Google BigQuery 5 Multicharts Simba ODBC Driver for Google BigQuery 6 PostgreSQL35W PostgreSQL Unicode(x64) 7 hillel_bq Simba ODBC Driver for Google BigQuery 8 blog_bq Simba ODBC Driver for Google BigQuery 9 MyClientMSSQL SQL Server 10 local_mssql SQL Server 11 MSSQL_localhost SQL Server 12 my_test_source SQL Server 13 Google BigQuery Simba ODBC Driver for Google BigQuery</code> </pre> <br><h3 id="primer-podklyucheniya-k-microsoft-sql-server-s-pomoschyu-paketa-rmssql">  Un ejemplo de conexi√≥n a Microsoft SQL Server usando el paquete RMSSQL </h3><br><p>  <code>RMSSQL</code> no <code>RMSSQL</code> publicado en CRAN, por lo que puede instalarlo desde GitHub utilizando el paquete <code>devtools</code> . </p><br><pre> <code class="plaintext hljs">install.packages("devtools") devtools::install_github("bescoto/RMSSQL")</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Ejemplo de conexi√≥n con el controlador DBI RMSSQL</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">#    library(RJDBC) library(RMSSQL) library(DBI) #  RMSSQL con &lt;- dbConnect(MSSQLServer(), host = 'localhost', user = 'my_username', password = 'my_password', dbname = "mybase")</code> </pre> </div></div><br><p>  En la mayor√≠a de los casos, utilizando el paquete <code>DBI</code> para trabajar con bases de datos, se conectar√° de esta manera.  Es decir  instale uno de los paquetes de controladores necesarios, pasando la funci√≥n <code>dbConnect</code> como el valor del argumento <em>drv</em> , la funci√≥n del controlador para conectarse al DBMS que necesita. </p><br><div class="spoiler">  <b class="spoiler_title">Un ejemplo de conexi√≥n a MySQL, PostgreSQL, SQLite y BigQuery</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">#   MySQL library(RMySQL) con &lt;- dbConnect(MySQL(), host = 'localhost', user = 'my_username', password = 'my_password', dbname = "mybase", host = "localhost") #   PostrgeSQL library(RPostgreSQL) con &lt;- dbConnect(PostgreSQL(), host = 'localhost', user = 'my_username', password = 'my_password', dbname = "mybase", host = "localhost") #   PostrgeSQL library(RPostgreSQL) con &lt;- dbConnect(PostgreSQL(), host = 'localhost', user = 'my_username', password = 'my_password', dbname = "mybase", host = "localhost") #   SQLite library(RSQLite) # connection or create base con &lt;- dbConnect(drv = SQLite(), "localhost.db") #   Google BigQuery library(bigrquery) con &lt;- dbConnect(drv = bigquery(), project = "my_proj_id", dataset = "dataset_name")</code> </pre> </div></div><br><h3 id="kak-skryt-paroli-ot-bazy-dannyh-v-r-skriptah">  C√≥mo ocultar contrase√±as de bases de datos en scripts R </h3><br><p>  Arriba, di algunos ejemplos que pueden usarse para conectarse a cualquier base de datos, pero hay un inconveniente en ellos, de esta forma todos los accesos a la base de datos, incluidas las contrase√±as, se almacenan como texto en los propios scripts. </p><br><p>  Si todas sus secuencias de comandos se implementan y se ejecutan exclusivamente localmente en su PC, y est√° protegido con contrase√±a al mismo tiempo, lo m√°s probable es que no haya ning√∫n problema.  Pero si trabaja con alguien en el mismo servidor, almacenar las contrase√±as de las bases de datos en el texto de sus scripts no es la mejor soluci√≥n. </p><br><p>  Cada sistema operativo tiene una utilidad para administrar credenciales.  Por ejemplo, en Windows, este es el Administrador de credenciales.  Puede agregar la contrase√±a que usa para conectarse a la base de datos a trav√©s del paquete de <code>keyring</code> a este repositorio.  El paquete es multiplataforma y el ejemplo anterior funcionar√° en cualquier sistema operativo, al menos en Windows, MacOS y Linux. </p><br><pre> <code class="plaintext hljs"># install.packages("keyring") #   library(keyring) library(RMSSQL) #   key_set_with_value(service = "mssql", username = "my_username", password = "my_password") #   RMSSQL con &lt;- dbConnect(MSSQLServer(), host = 'localhost', user = 'my_username', password = key_get("mssql", "my_username"), dbname = "mybase")</code> </pre> <br><p>  Es decir  usando la funci√≥n <code>key_set_with_value()</code> , agrega una contrase√±a al almacenamiento de credenciales, y usando <code>key_get()</code> solicita, y solo el usuario que la agreg√≥ a la tienda puede solicitar una contrase√±a.  Con el <code>keyring</code> puede almacenar contrase√±as no solo de bases de datos, sino tambi√©n de cualquier servicio, as√≠ como tokens de autorizaci√≥n cuando trabaje con la API. </p><br><h3 id="sozdanie-tablic-i-zapis-v-bazu-dannyh">  Crear tablas y escribir en la base de datos </h3><br><p>  La funci√≥n <code>dbWriteTable()</code> realiza la escritura en la base de datos. </p><br><p>  Argumentos a la funci√≥n <code>dbWriteTable()</code> : </p><br><p>  <em>Los argumentos requeridos est√°n en negrita, las cursivas son opcionales</em> </p><br><ul><li>  <strong>conn</strong> : objeto de conexi√≥n DBMS creado con la funci√≥n <code>dbConnect</code> ; </li><li>  <strong>nombre</strong> : el nombre de la tabla en el DBMS en el que se escribir√°n los datos; </li><li>  <strong>valor</strong> : una tabla (un objeto de la clase data.frame / data.table / tibble_frame) en R, cuyos datos se escribir√°n en el DBMS; </li><li>  <em>row.names</em> : agrega una columna row_names con n√∫meros de fila a la tabla, por <em>defecto es FALSE</em> . </li><li>  <em>sobrescribir</em> : sobrescriba la tabla si la tabla con el nombre especificado en el argumento de <em>nombre</em> ya est√° presente en el DBMS; <em>el valor predeterminado es FALSO</em> ; </li><li>  <em>append</em> : agrega datos si una tabla con el nombre especificado en el argumento de <em>nombre</em> ya est√° presente en el DBMS; <em>el valor predeterminado es FALSE</em> ; </li><li>  <em>field.types</em> : acepta un vector con nombre y establece el tipo de datos en cada campo al escribir en el DBMS, por <em>defecto es NULL</em> ; </li><li>  <em>temporal</em> : le permite crear tablas temporales en el DBMS, que estar√°n disponibles hasta que se desconecte la conexi√≥n con la base de datos; <em>el valor predeterminado es FALSO</em> . </li></ul><br><div class="spoiler">  <b class="spoiler_title">Un ejemplo de escritura de datos en un DBMS a trav√©s de DBI</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">#   library(odbc) #     DSN con &lt;- dbConnect(odbc(), DSN = "my_test_source", UID = "my_username", PWD = "my_password") #     iris,         R  iris dbWriteTable(conn = con, name = "iris", value = iris) #     dbDisconnect(con)</code> </pre> </div></div><br><p>  Para ver tablas en la base de datos, use la funci√≥n <code>dbListTables()</code> , para eliminar tablas <code>dbRemoveTable()</code> </p><br><div class="spoiler">  <b class="spoiler_title">Un ejemplo de consulta de una lista de tablas y eliminaci√≥n de una tabla de un DBMS</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">#   library(odbc) #    con &lt;- dbConnect(odbc(), DSN = "my_test_source", UID = "my_username", PWD = "my_password") #    dbListTables(con) #   iris dbRemoveTable(con, "iris") #     dbDisconnect(con)</code> </pre> </div></div><br><h3 id="chtenie-dannyh-iz-subd">  Leer datos de un DBMS </h3><br><p>  Con <code>DBI</code> puede consultar tablas completas o el resultado de ejecutar su consulta SQL.  Las <code>dbReadTable()</code> y <code>dbGetQuery()</code> se utilizan para realizar estas operaciones. </p><br><div class="spoiler">  <b class="spoiler_title">Ejemplo de consulta de una tabla de iris desde un DBMS</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">#   library(odbc) #    con &lt;- dbConnect(odbc(), DSN = "my_test_source", UID = "my_username", PWD = "my_password") #   iris   iris dbiris &lt;- dbReadTable(con, "iris") #     dbDisconnect(con)</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Un ejemplo de cargar el resultado de ejecutar SQL desde un DBMS</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">#   library(odbc) #    con &lt;- dbConnect(odbc(), DSN = "my_test_source", UID = "my_username", PWD = "my_password") #     setosa &lt;- dbGetQuery(con, "SELECT * FROM iris WHERE Species = 'setosa'") #     dbDisconnect(con)</code> </pre> </div></div><br><h3 id="manipulirovanie-dannymi-v-subd-dml">  Manipulaci√≥n de datos en DBMS (DML) </h3><br><p>  La funci√≥n <code>dbGetQuery()</code> anteriormente se usa exclusivamente para consultar muestras de datos (SELECT). </p><br><p>  Para las operaciones de manipulaci√≥n de datos, como UPDATE, INSERT, DELETE, la funci√≥n <code>dbExecute()</code> existe en <code>DBI</code> . </p><br><div class="spoiler">  <b class="spoiler_title">C√≥digo de muestra para manipular datos en un DBMS</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">#   library(odbc) #    con &lt;- dbConnect(odbc(), DSN = "my_test_source", UID = "my_username", PWD = "my_password") #   (INSERT) dbExecute(con, "INSERT INTO iris (row_names, [Sepal.Length], [Sepal.Width], [Petal.Length], [Petal.Width], [Species]) VALUES (51, 5.0, 3.3, 1.7, 0.3, 'new_values')") #   (UPDATE) dbExecute(con, "UPDATE iris SET [Species] = 'old_value' WHERE row_names = 51") #     (DELETE) dbExecute(con, "DELETE FROM iris WHERE row_names = 51") #     dbDisconnect(con)</code> </pre> </div></div><br><h3 id="tranzakcii-v-subd">  Transacciones en el DBMS </h3><br><blockquote>  Una transacci√≥n es una operaci√≥n de lectura y escritura secuencial.  El final de una transacci√≥n puede ser guardar cambios (commit, commit) o ‚Äã‚Äãcancelar cambios (rollback, rollback).  En relaci√≥n con la base de datos, una transacci√≥n es una serie de consultas, que se tratan como una sola consulta. </blockquote><p>  <em><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Cita del art√≠culo "Transacciones y los mecanismos de su control"</a></em> </p><br><p>  Una transacci√≥n encapsula varias declaraciones SQL en una unidad elemental.  En <code>DBI</code> inicio de una transacci√≥n se inicia con <code>dbBegin()</code> y luego se confirma con <code>dbCommit()</code> o se cancela con <code>dbRollback()</code> .  En cualquier caso, el DBMS garantiza que: todas o ninguna de las declaraciones se aplicar√°n a los datos. </p><br><p>  Por ejemplo, durante la transacci√≥n, agreguemos 51 filas a la tabla de iris, luego cambie el valor de <em>Sepal.Width</em> a 5 l√≠neas y <em>eliminemos</em> 43 l√≠neas de la tabla. </p><br><div class="spoiler">  <b class="spoiler_title">Ejemplo de c√≥digo de transacci√≥n</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">#   library(odbc) #    con &lt;- dbConnect(odbc(), DSN = "my_test_source", UID = "my_username", PWD = "my_password") #      dbGetQuery(con, "SELECT * FROM iris WHERE row_names IN (5, 43, 51)") # row_names Sepal.Length Sepal.Width Petal.Length Petal.Width Species # 1 5 5.0 3.6 1.4 0.2 setosa # 2 43 4.4 3.2 1.3 0.2 setosa # 3 51 7.0 3.2 4.7 1.4 versicolor #    dbBegin(con) #   dbExecute(con, "INSERT INTO iris (row_names, [Sepal.Length], [Sepal.Width], [Petal.Length], [Petal.Width], [Species]) VALUES (51, 5.0, 3.3, 1.7, 0.3, 'new_values')") #   dbExecute(con, "UPDATE iris SET [Sepal.Width] = 8 WHERE row_names = 5") #   43 dbExecute(con, "DELETE FROM iris WHERE row_names = 43") #   dbCommit(con) #      dbGetQuery(con, "SELECT * FROM iris WHERE row_names IN (5, 43, 51)") # row_names Sepal.Length Sepal.Width Petal.Length Petal.Width Species # 1 5 5 8.0 1.4 0.2 setosa # 2 51 7 3.2 4.7 1.4 versicolor # 3 51 5 3.3 1.7 0.3 new_values</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Ejemplo de c√≥digo de cancelaci√≥n de transacci√≥n</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">#   library(odbc) #    con &lt;- dbConnect(odbc(), DSN = "my_test_source", UID = "my_username", PWD = "my_password") #      dbGetQuery(con, "SELECT * FROM iris WHERE row_names IN (5, 43, 51)") # row_names Sepal.Length Sepal.Width Petal.Length Petal.Width Species # 1 5 5.0 3.6 1.4 0.2 setosa # 2 43 4.4 3.2 1.3 0.2 setosa # 3 51 7.0 3.2 4.7 1.4 versicolor #    dbBegin(con) #   dbExecute(con, "INSERT INTO iris (row_names, [Sepal.Length], [Sepal.Width], [Petal.Length], [Petal.Width], [Species]) VALUES (51, 5.0, 3.3, 1.7, 0.3, 'new_values')") #   dbExecute(con, "UPDATE iris SET [Sepal.Width] = 8 WHERE row_names = 5") #   43 dbExecute(con, "DELETE FROM iris WHERE row_names = 43") #   dbRollback(con) #      dbGetQuery(con, "SELECT * FROM iris WHERE row_names IN (5, 43, 51)") # row_names Sepal.Length Sepal.Width Petal.Length Petal.Width Species # 1 5 5.0 3.6 1.4 0.2 setosa # 2 43 4.4 3.2 1.3 0.2 setosa # 3 51 7.0 3.2 4.7 1.4 versicolor</code> </pre> </div></div><br><h1 id="paket-rodbc">  Paquete RODBC </h1><br><p>  El paquete <code>RODBC</code> proporciona una interfaz independiente para conectarse y trabajar con un DBMS a trav√©s de una interfaz ODBC. </p><br><p>  <code>RODBC</code> no <code>RODBC</code> compatible con <code>DBI</code> , es decir  no puede usar el objeto de conexi√≥n creado usando <code>RODBC</code> en las funciones proporcionadas por el paquete <code>DBI</code> . </p><br><h3 id="osnovnye-funkcii-paketa-rodbc">  Caracter√≠sticas clave del paquete RODBC </h3><br><ul><li>  <code>odbcConnect</code> - Conexi√≥n al DBMS a trav√©s de DSN; </li><li>  <code>odbcDriverConnect</code> - Conexi√≥n a la base de datos a trav√©s de la cadena de conexi√≥n; </li><li>  <code>sqlQuery</code> : env√≠a una consulta al DBMS y obtiene el resultado de su ejecuci√≥n.  Admite consultas de cualquier tipo: SELECCIONAR, ACTUALIZAR, INSERTAR, ELIMINAR. </li><li>  <code>sqlFetch</code> - Obtiene la tabla completa del DBMS; </li><li>  <code>sqlTables</code> : <code>sqlTables</code> una lista de tablas en la base de datos. </li><li>  <code>sqlSave</code> : <code>sqlSave</code> una nueva tabla en la base de datos o agrega nuevos datos a una tabla existente; </li><li>  <code>sqlUpdate</code> : actualizaci√≥n de datos en una tabla que ya existe en el DBMS; </li><li>  <code>sqlDrop</code> - Eliminar una tabla en un DBMS; </li><li>  <code>odbcClose</code> - Finaliza una conexi√≥n a un DBMS. </li></ul><br><h3 id="primer-raboty-s-rodbc">  Un ejemplo de trabajo con RODBC </h3><br><p>  Desde mi punto de vista, <code>RODBC</code> menos funcional que <code>DBI</code> , pero tiene todas las funciones necesarias para trabajar con un DBMS. </p><br><div class="spoiler">  <b class="spoiler_title">Un ejemplo de interacci√≥n con un DBMS a trav√©s de RODBC</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">#   library(RODBC) #   con_string &lt;- odbcDriverConnect(connection = "Driver=SQL Server;Server=localhost;Database=mybase;UID=my_username;PWD=my_password;Port=1433") #   DSN con_dsn &lt;- odbcConnect(dsn = "my_test_source", uid = "my_username", pwd = "my_password") #     sqlSave(con_dsn, dat = iris, tablename = "iris") #     iris sqlSave(con_dsn, dat = iris, tablename = "iris", append = TRUE) #   4  sqlFetch(con_dsn, "iris", rownames = FALSE, max = 4) #      R iris[1, 5] &lt;- "virginica" #     sqlUpdate(con_dsn, dat = iris, tablename = "iris") #   4     sqlFetch(con_dsn, "iris", rownames = FALSE, max = 4) #   sqlDrop(con_dsn, sqtable = "iris") #     odbcCloseAll()</code> </pre> </div></div><br><h1 id="tranzakcionnost">  Transaccional </h1><br><p>  Por defecto, la transaccionalidad en <code>RODBC</code> desactivada.  La gesti√≥n de transacciones se lleva a cabo mediante dos funciones. </p><br><ul><li>  <code>odbcSetAutoCommit</code> - Cambia entre los modos de operaci√≥n DBMS normal y transaccional; </li><li>  <code>odbcEndTran</code> - Confirma o cancela una transacci√≥n. </li></ul><br><p>  <code>odbcSetAutoCommit</code> funci√≥n <code>odbcSetAutoCommit</code> y desactiva el modo de transacci√≥n mediante el argumento <em>autoCommit</em> . </p><br><div class="spoiler">  <b class="spoiler_title">Ejemplo de trabajo en modo transaccional en RODBC</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">#   library(RODBC) #   DSN con_dsn &lt;- odbcConnect(dsn = "my_test_source", uid = "my_username", pwd = "my_password") #     sqlSave(con_dsn, dat = iris, tablename = "iris") #    odbcSetAutoCommit(con_dsn, autoCommit = FALSE) #   4  sqlFetch(con_dsn, "iris", rownames = FALSE, max = 4) # rownames SepalLength SepalWidth PetalLength PetalWidth Species # 1 1 5.1 3.5 1.4 0.2 setosa # 2 2 4.9 3.0 1.4 0.2 setosa # 3 3 4.7 3.2 1.3 0.2 setosa # 4 4 4.6 3.1 1.5 0.2 setosa #      R iris[1, 5] &lt;- "virginica" #     sqlUpdate(con_dsn, dat = iris, tablename = "iris") #   4  sqlFetch(con_dsn, "iris", rownames = FALSE, max = 4) # rownames SepalLength SepalWidth PetalLength PetalWidth Species # 1 1 5.1 3.5 1.4 0.2 virginica # 2 2 4.9 3.0 1.4 0.2 setosa # 3 3 4.7 3.2 1.3 0.2 setosa # 4 4 4.6 3.1 1.5 0.2 setosa #   odbcEndTran(con_dsn, commit = FALSE) #   4  sqlFetch(con_dsn, "iris", rownames = FALSE, max = 4) # rownames SepalLength SepalWidth PetalLength PetalWidth Species # 1 1 5.1 3.5 1.4 0.2 setosa # 2 2 4.9 3.0 1.4 0.2 setosa # 3 3 4.7 3.2 1.3 0.2 setosa # 4 4 4.6 3.1 1.5 0.2 setosa #     sqlUpdate(con_dsn, dat = iris, tablename = "iris") #   odbcEndTran(con_dsn, commit = TRUE) #   4     sqlFetch(con_dsn, "iris", rownames = FALSE, max = 4) # rownames SepalLength SepalWidth PetalLength PetalWidth Species # 1 1 5.1 3.5 1.4 0.2 virginica # 2 2 4.9 3.0 1.4 0.2 setosa # 3 3 4.7 3.2 1.3 0.2 setosa # 4 4 4.6 3.1 1.5 0.2 setosa #     odbcClose(con_dsn)</code> </pre> </div></div><br><h1 id="zaklyuchenie">  Conclusi√≥n </h1><br><p>  Los dos m√©todos para trabajar con bases de datos en los idiomas R, <code>DBI</code> y <code>RODBC</code> descritos en el art√≠culo son bastante universales y funcionar√°n con casi cualquier DBMS. </p><br><p>  La √∫nica diferencia en la operaci√≥n entre diferentes DBMS es el proceso de conexi√≥n.  Para los DBMS m√°s populares, hay paquetes separados que son controladores.  Para el resto del DBMS, es necesario configurar la conexi√≥n a trav√©s de la interfaz ODBC utilizando <code>RODBC</code> <code>odbc</code> o <code>RODBC</code> .  Todas las dem√°s manipulaciones, independientemente del DBMS que haya elegido, no se modificar√°n.  Una excepci√≥n es enviar consultas SQL, dependiendo del dialecto SQL admitido por el DBMS con el que est√° trabajando. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/461063/">https://habr.com/ru/post/461063/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../461053/index.html">Conectamos mapas en l√≠nea al navegador en el tel√©fono inteligente. Parte 2 - tarjetas de vectores</a></li>
<li><a href="../461055/index.html">Rekko Challenge 2019: como fue</a></li>
<li><a href="../461057/index.html">Canales de Telegram sobre desarrollo de juegos</a></li>
<li><a href="../461059/index.html">Escribir una aplicaci√≥n de Android para fan√°ticos del cine - Parte 1 (creaci√≥n de prototipos)</a></li>
<li><a href="../461061/index.html">Aleaciones de magnesio, l√≠mites gemelos y segregaci√≥n</a></li>
<li><a href="../461067/index.html">Las 65 preguntas principales de SQL de las entrevistas de trabajo para las que deber√≠a estar preparado en 2019. Parte 1</a></li>
<li><a href="../461069/index.html">C√°maras IP Nobelic para exteriores: pruebas, tecnolog√≠as y capacidades de los sistemas de videovigilancia Ivideon</a></li>
<li><a href="../461071/index.html">Optimizaci√≥n de consultas de bases de datos en el ejemplo de servicio B2B para constructores</a></li>
<li><a href="../461073/index.html">Conectamos mapas en l√≠nea al navegador en el tel√©fono inteligente. Parte 3 - OverpassTurbo</a></li>
<li><a href="../461075/index.html">Inteligencia empresarial. Objetos inform√°ticos, componentes, herramientas.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>