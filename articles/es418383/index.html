<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>锔   Animaciones de Android basadas en Kotlin y RxJava   </title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola Habr! El a帽o pasado, Ivan kori de PSPDFKit habl贸 en MBLT DEV con un informe sobre la creaci贸n de animaciones en Android basado en Kotlin y la b...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Animaciones de Android basadas en Kotlin y RxJava</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/e-Legion/blog/418383/"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><img src="https://habrastorage.org/webt/2g/5z/pi/2g5zpitzszs5lxzgdighjoo14u4.png"></a> <br><br>  Hola Habr!  El a帽o pasado, Ivan kori de PSPDFKit habl贸 en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">MBLT DEV</a> con un informe sobre la creaci贸n de animaciones en Android basado en Kotlin y la biblioteca RxJava. <br><br>  Ahora uso las t茅cnicas del informe para trabajar en mi proyecto, me ayudan mucho.  Debajo de la escena se encuentra la transcripci贸n del informe y el video, ahora puede aprovechar estos trucos. <a name="habracut"></a><br><br><h2>  Animaci贸n </h2><br>  En Android, hay 4 clases que se aplican como si por defecto: <br><br><ol><li>  <b>ValueAnimator</b> : esta clase proporciona un mecanismo de sincronizaci贸n simple para ejecutar animaciones que calculan valores animados y los configuran para la Vista. </li><li>  <b>ObjectAnimator</b> es una subclase de ValueAnimator que le permite admitir animaciones para propiedades de objeto. </li><li>  <b>AnimatorSet</b> se usa para crear una secuencia de animaci贸n.  Por ejemplo, tiene una secuencia de animaciones: <br><br><ol><li>  Ver hojas a la izquierda de la pantalla. </li><li>  Despu茅s de completar la primera animaci贸n, queremos realizar una animaci贸n de apariencia para otra Vista, etc. </li></ol></li><li>  <b>ViewPropertyAnimator</b> : inicia y optimiza autom谩ticamente las animaciones para la propiedad de vista seleccionada.  Lo usaremos principalmente.  Por lo tanto, utilizaremos esta API y luego la pondremos en RxJava como parte de la programaci贸n reactiva. </li></ol><br><cut></cut><br><h3>  ValueAnimator </h3><br>  Analicemos <b>el</b> marco <b>ValueAnimator</b> .  Se usa para cambiar el valor.  Puede especificar un rango de valores a trav茅s de <b>ValueAnimator.ofFloat</b> para el tipo flotante primitivo de 0 a 100. Especifique un valor de <b>Duraci贸n</b> e inicie la animaci贸n. <br>  Considere un ejemplo: <br><br><pre><code class="hljs kotlin"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> animator = ValueAnimator.ofFloat(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">100f</span></span>) animator.duration = <span class="hljs-number"><span class="hljs-number">1000</span></span> animator.start() animator.addUpdateListener(<span class="hljs-keyword"><span class="hljs-keyword">object</span></span> : ValueAnimator.AnimatorUpdateListener { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onAnimationUpdate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(animation: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ValueAnimator</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> animatedValue = animation.animatedValue <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Float</span></span> textView.translationX = animatedValue } })</code> </pre> <br>  Aqu铆 agregamos <b>UpdateListener</b> y con cada actualizaci贸n moveremos nuestra Vista horizontalmente y cambiaremos su posici贸n de 0 a 100, aunque esta no es una muy buena manera de realizar esta operaci贸n. <br><br><h3>  ObjectAnimator </h3><br>  Otro ejemplo de implementaci贸n de animaci贸n es ObjectAnimator: <br><br><pre> <code class="hljs pgsql">val objectAnimator = ObjectAnimator.ofFloat(textView, "translationX", <span class="hljs-number"><span class="hljs-number">100</span></span>f) objectAnimator.duration = <span class="hljs-number"><span class="hljs-number">1000</span></span> objectAnimator.<span class="hljs-keyword"><span class="hljs-keyword">start</span></span>()</code> </pre> <br>  Le damos un comando para cambiar el par谩metro de Vista espec铆fico al valor especificado a la Vista deseada y establecer la hora usando el m茅todo <b>setDuration</b> .  La conclusi贸n es que su clase debe tener el m茅todo <b>setTranslationX</b> , luego el sistema encontrar谩 este m茅todo a trav茅s de la reflexi贸n, y luego la Vista se animar谩.  El problema es que aqu铆 se usa la reflexi贸n. <br><br><h3>  Animatorset </h3><br>  Ahora considere la clase <b>AnimatorSet</b> : <br><br><pre> <code class="hljs pgsql">val bouncer = AnimatorSet() bouncer.play(bounceAnim).<span class="hljs-keyword"><span class="hljs-keyword">before</span></span>(squashAnim1) bouncer.play(squashAnim1).<span class="hljs-keyword"><span class="hljs-keyword">before</span></span>(squashAnim2) val fadeAnim = ObjectAnimator.ofFloat(newBall, "alpha", <span class="hljs-number"><span class="hljs-number">1</span></span>f, <span class="hljs-number"><span class="hljs-number">0</span></span>f) fadeAnim.duration = <span class="hljs-number"><span class="hljs-number">250</span></span> val animatorSet = AnimatorSet() animatorSet.play(bouncer).<span class="hljs-keyword"><span class="hljs-keyword">before</span></span>(fadeAnim) animatorSet.<span class="hljs-keyword"><span class="hljs-keyword">start</span></span>()</code> </pre> <br>  De hecho, no es muy conveniente de usar, especialmente para una gran cantidad de objetos.  Si desea realizar animaciones m谩s complejas, por ejemplo, establezca un retraso entre la aparici贸n de las animaciones y cuantas m谩s animaciones desee realizar, m谩s dif铆cil ser谩 controlarla. <br><br><h3>  ViewPropertyAnimator </h3><br>  La clase final es <b>ViewPropertyAnimator</b> .  Es una de las mejores clases para animar View.  Esta es una gran API para presentar una secuencia de animaciones que ejecuta: <br><br><pre> <code class="hljs kotlin">ViewCompat.animate(textView) .translationX(<span class="hljs-number"><span class="hljs-number">50f</span></span>) .translationY(<span class="hljs-number"><span class="hljs-number">100f</span></span>) .setDuration(<span class="hljs-number"><span class="hljs-number">1000</span></span>) .setInterpolator(AccelerateDecelerateInterpolator()) .setStartDelay(<span class="hljs-number"><span class="hljs-number">50</span></span>) .setListener(<span class="hljs-keyword"><span class="hljs-keyword">object</span></span> : Animator.AnimatorListener { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onAnimationRepeat</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(animation: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Animator</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> {} <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onAnimationEnd</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(animation: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Animator</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> {} <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onAnimationCancel</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(animation: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Animator</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> {} <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onAnimationStart</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(animation: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Animator</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> {} })</code> </pre><br>  Iniciamos el m茅todo <b>ViewCompat.animate</b> , que devuelve <b>ViewPropertyAnimator</b> , y para la <b>traducci贸n de</b> animaci贸n <b>X</b> establecemos el valor en 50, para el par谩metro <b>translatonY</b> en 100. Luego especificamos la duraci贸n de la animaci贸n, as铆 como el interpolador.  El interpolador determina la secuencia en la que aparecen las animaciones.  Este ejemplo utiliza un interpolador que acelera el inicio de la animaci贸n y agrega una desaceleraci贸n al final.  Tambi茅n agregamos un retraso para comenzar la animaci贸n.  Adem谩s, tenemos un <b>AnimatorListener</b> .  Con 茅l, puede suscribirse a ciertos eventos que ocurren durante la animaci贸n.  Esta interfaz tiene 4 m茅todos: <b>onAnimationStart</b> , <b>onAnimationCancel</b> , <b>onAnimationEnd</b> , <b>onAnimationRepeat</b> . <br><br>  Como regla, solo estamos interesados en completar la animaci贸n.  En API Nivel 16 <br>  agregado con EndAction: <br><br><pre> <code class="hljs pgsql">.withEndAction({ //API <span class="hljs-number"><span class="hljs-number">16</span></span>+ //<span class="hljs-keyword"><span class="hljs-keyword">do</span></span> something here <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> animation ends })</code> </pre> <br>  En 茅l, puede definir la interfaz <b>Runnable</b> , y despu茅s de completar la visualizaci贸n de una animaci贸n espec铆fica, se realiza una acci贸n. <br><br>  Ahora algunos comentarios sobre el proceso de creaci贸n de animaciones en general: <br><br><ol><li>  El m茅todo <b>start ()</b> es opcional: tan pronto como llame al m茅todo <b>animate ()</b> , se introduce una secuencia de animaciones.  Cuando se configura <b>ViewPropertyAnimator</b> , el sistema comenzar谩 la animaci贸n tan pronto como est茅 listo para hacerlo. </li><li>  Solo una clase <b>ViewPropertyAnimator</b> puede animar solo una vista espec铆fica.  Por lo tanto, si desea realizar varias animaciones, por ejemplo, desea que algo se mueva y, al mismo tiempo, aumente de tama帽o, debe especificar esto en un animador. </li></ol><br><h3>  驴Por qu茅 elegimos RxJava? </h3><br>  Comencemos con un ejemplo simple.  Supongamos que creamos un m茅todo fadeIn: <br><br><pre> <code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fadeIn</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(view: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">View</span></span></span></span><span class="hljs-function"><span class="hljs-params">, duration: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Long</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: Completable { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> animationSubject = CompletableSubject.create() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> animationSubject.doOnSubscribe { ViewCompat.animate(view) .setDuration(duration) .alpha(<span class="hljs-number"><span class="hljs-number">1f</span></span>) .withEndAction { animationSubject.onComplete() } } }</code> </pre> <br>  Esta es una soluci贸n bastante primitiva, y para aplicarla a su proyecto, deber谩 tener en cuenta algunos matices. <br><br>  Vamos a crear un <b>CompletableSubject</b> , que usaremos para esperar a que se completen las animaciones, y luego usaremos el m茅todo <b>onComplete</b> para enviar mensajes a los suscriptores.  Para ejecutar animaciones secuencialmente, debe iniciar la animaci贸n no inmediatamente, sino tan pronto como alguien se suscriba a ella.  De esta forma, se pueden ejecutar varias animaciones de estilo reactivo de forma secuencial. <br><br>  Considera la animaci贸n en s铆.  En 茅l, transferimos la Vista, sobre la cual se realizar谩 la animaci贸n, y tambi茅n indicamos la duraci贸n de la animaci贸n.  Y dado que esta animaci贸n es apariencia, debemos indicar la transparencia 1. <br><br>  Tratemos de usar nuestro m茅todo y creemos una animaci贸n simple.  Supongamos que tenemos 4 botones en la pantalla, y queremos agregarles una animaci贸n de la aparici贸n de 1 segundo de duraci贸n: <br><br><pre> <code class="hljs go">val durationMs = <span class="hljs-number"><span class="hljs-number">1000</span></span>L button1.alpha = <span class="hljs-number"><span class="hljs-number">0f</span></span> button2.alpha = <span class="hljs-number"><span class="hljs-number">0f</span></span> button3.alpha = <span class="hljs-number"><span class="hljs-number">0f</span></span> button4.alpha = <span class="hljs-number"><span class="hljs-number">0f</span></span> fadeIn(button1, durationMs) .andThen(fadeIn(button2, durationMs)) .andThen(fadeIn(button3, durationMs)) .andThen(fadeIn(button4, durationMs)) .subscribe()</code> </pre><br>  El resultado es un c贸digo tan conciso.  Usando el operador <b>andThen</b> , puede ejecutar animaciones secuencialmente.  Cuando nos suscribamos, enviar谩 el evento <b>doOnSubscribe</b> a <b>Completable</b> , que es el primero en la cola de ejecuci贸n.  Despu茅s de su finalizaci贸n, se suscribir谩 a la segunda, tercera y as铆 sucesivamente en la cadena.  Por lo tanto, si se produce un error en alg煤n momento, la secuencia completa arroja un error.  Tambi茅n debe especificar alfa 0 antes del inicio de la animaci贸n para que los botones sean invisibles.  Y as铆 es como se ver谩: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/sq/-m/02/sq-m02uv2i1uu85udver9fwzqww.gif"></div><br>  Usando <b>Kotlin</b> , podemos usar las extensiones: <br><br><pre> <code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> View.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fadeIn</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(duration: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Long</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: Completable { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> animationSubject = CompletableSubject.create() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> animationSubject.doOnSubscribe { ViewCompat.animate(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) .setDuration(duration) .alpha(<span class="hljs-number"><span class="hljs-number">1f</span></span>) .withEndAction { animationSubject.onComplete() } } }</code> </pre> <br>  Para la clase View, se agreg贸 una funci贸n de extensi贸n.  En el futuro, no es necesario pasar el argumento View al m茅todo fadeIn.  Ahora puede reemplazar todas las llamadas a Ver con esta palabra clave dentro del m茅todo.  Esto es lo que <b>Kotlin</b> es capaz de hacer <b>.</b> <br><br>  Veamos c贸mo ha cambiado la llamada a esta funci贸n en nuestra cadena de animaci贸n: <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">button1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.fadeIn</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">durationMs</span></span>) <span class="hljs-selector-class"><span class="hljs-selector-class">.andThen</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">button2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.fadeIn</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">durationMs</span></span>)) <span class="hljs-selector-class"><span class="hljs-selector-class">.andThen</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">button3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.fadeIn</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">durationMs</span></span>)) <span class="hljs-selector-class"><span class="hljs-selector-class">.andThen</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">button4</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.fadeIn</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">durationMs</span></span>)) <span class="hljs-selector-class"><span class="hljs-selector-class">.subscribe</span></span>()</code> </pre><br>  Ahora el c贸digo se ve m谩s comprensible.  Establece claramente que queremos aplicar animaci贸n con una cierta duraci贸n a la visualizaci贸n deseada.  Usando el operador <b>andThen</b> , creamos una cadena secuencial de animaciones para el segundo, tercer bot贸n, y as铆 sucesivamente. <br><br>  Siempre indicamos la duraci贸n de las animaciones, este valor es el mismo para todas las pantallas: 1000 milisegundos.  <b>Kotlin</b> viene al rescate nuevamente.  Podemos hacer un valor de tiempo predeterminado. <br><br><pre> <code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> View.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fadeIn</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(duration: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> = </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1000</span></span></span></span><span class="hljs-function"><span class="hljs-params">L)</span></span></span></span>:</code> </pre> <br>  Si no especifica el par谩metro de <b>duraci贸n</b> , el tiempo se establecer谩 autom谩ticamente en 1 segundo.  Pero si queremos que el bot贸n en el n煤mero 2 aumente este tiempo a 2 segundos, simplemente especificamos este valor en el m茅todo: <br><br><pre> <code class="hljs erlang">button1.fadeIn() .<span class="hljs-keyword"><span class="hljs-keyword">and</span></span>Then(button2.fadeIn(duration = <span class="hljs-number"><span class="hljs-number">2000</span></span>L)) .<span class="hljs-keyword"><span class="hljs-keyword">and</span></span>Then(button3.fadeIn()) .<span class="hljs-keyword"><span class="hljs-keyword">and</span></span>Then(button4.fadeIn()) .subscribe()</code> </pre><br><h3>  Ejecutando dos animaciones </h3><br>  Pudimos ejecutar una secuencia de animaciones usando el operador <b>andThen</b> .  驴Qu茅 sucede si necesito ejecutar 2 animaciones al mismo tiempo?  Para hacer esto, hay un operador <b>mergeWith</b> en <b>RxJava</b> que le permite combinar elementos <b>Completables</b> de tal manera que se <b>inicien</b> simult谩neamente.  Esta declaraci贸n inicia todos los elementos y termina despu茅s de que se muestra el 煤ltimo elemento.  Si cambiamos y <b>luego</b> <b>fusionamos con</b> , obtenemos una animaci贸n en la que todos los botones aparecen al mismo tiempo, pero el bot贸n 2 aparecer谩 un poco m谩s que los dem谩s: <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">button1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.fadeIn</span></span>() <span class="hljs-selector-class"><span class="hljs-selector-class">.mergeWith</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">button2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.fadeIn</span></span>(2000)) <span class="hljs-selector-class"><span class="hljs-selector-class">.mergeWith</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">button3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.fadeIn</span></span>()) <span class="hljs-selector-class"><span class="hljs-selector-class">.mergeWith</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">button4</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.fadeIn</span></span>()) <span class="hljs-selector-class"><span class="hljs-selector-class">.subscribe</span></span>()</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/jd/fw/xb/jdfwxbgedu3gnufrsrfqezc46ga.gif"></div><br>  Ahora podemos agrupar animaciones.  Intentemos complicar la tarea: por ejemplo, queremos que el bot贸n 1 y el bot贸n 2 aparezcan al mismo tiempo, y luego el bot贸n 3 y el bot贸n 4: <br><br><pre> <code class="hljs css">(<span class="hljs-selector-tag"><span class="hljs-selector-tag">button1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.fadeIn</span></span>()<span class="hljs-selector-class"><span class="hljs-selector-class">.mergeWith</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">button2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.fadeIn</span></span>())) <span class="hljs-selector-class"><span class="hljs-selector-class">.andThen</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">button3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.fadeIn</span></span>()<span class="hljs-selector-class"><span class="hljs-selector-class">.mergeWith</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">button4</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.fadeIn</span></span>())) <span class="hljs-selector-class"><span class="hljs-selector-class">.subscribe</span></span>()</code> </pre> <br>  Combinamos los botones primero y segundo con el operador <b>mergeWith</b> , repetimos la acci贸n para el tercero y cuarto, y comenzamos estos grupos secuencialmente con el operador <b>andThen</b> .  Ahora mejoraremos el c贸digo agregando el m茅todo <b>fadeInTogether</b> : <br><br><pre> <code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fadeInTogether</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(first: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">View</span></span></span></span><span class="hljs-function"><span class="hljs-params">, second: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">View</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: Completable { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> first.fadeIn() .mergeWith(second.fadeIn()) }</code> </pre> <br>  Le permitir谩 ejecutar la animaci贸n de fadeIn para dos vistas al mismo tiempo.  C贸mo ha cambiado la cadena de animaci贸n: <br><br><pre> <code class="hljs erlang"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fadeInTogether</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(button1, button2)</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">andThen</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(fadeInTogether(button3, button4))</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">subscribe</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span></code> </pre> <br>  El resultado es la siguiente animaci贸n: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/hk/xw/pe/hkxwpemdtbmksyv_r7mq2qx3bcw.gif"></div><br>  Considere un ejemplo m谩s complejo.  Supongamos que necesitamos mostrar una animaci贸n con cierto retraso.  La declaraci贸n de <b>intervalo</b> ayudar谩: <br><br><pre> <code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">animate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> timeObservable = Observable.interval(<span class="hljs-number"><span class="hljs-number">100</span></span>, TimeUnit.MILLISECONDS) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> btnObservable = Observable.just(button1, button2, button3, button4) }</code> </pre> <br>  Generar谩 valores cada 100 milisegundos.  Cada bot贸n aparecer谩 despu茅s de 100 milisegundos.  A continuaci贸n, indicamos otro Observable que emitir谩 botones.  En este caso, tenemos 4 botones.  Usamos el operador <b>zip</b> . <br><br><img src="https://habrastorage.org/webt/g5/qq/yi/g5qqyih178patmj5cjpfyoevkkw.png" alt="imagen"><br><br>  Ante nosotros est谩n las corrientes de eventos: <br><br><pre> <code class="hljs mel">Observable.zip(timeObservable, btnObservable, BiFunction&lt;Long, View, Disposable&gt; { _, <span class="hljs-keyword"><span class="hljs-keyword">button</span></span> -&gt; <span class="hljs-keyword"><span class="hljs-keyword">button</span></span>.fadeIn().subscribe() })</code> </pre> <br>  El primero corresponde a <b>timeObservable</b> .  Este <b>observable</b> generar谩 n煤meros a intervalos regulares.  Supongamos que ser谩n 100 milisegundos. <br><br>  El segundo <b>observable</b> generar谩 una vista.  El operador <b>zip</b> espera hasta que el primer objeto aparezca en el primer hilo y lo conecta con el primer objeto del segundo hilo.  A pesar de que todos estos 4 objetos en el segundo hilo aparecer谩n inmediatamente, 茅l esperar谩 hasta que los objetos comiencen a aparecer en el primer hilo.  Por lo tanto, el primer objeto de la primera secuencia se conectar谩 al primer objeto del segundo en la forma de nuestra vista, y 100 milisegundos despu茅s, cuando aparezca un nuevo objeto, el operador lo combinar谩 con el segundo objeto.  Por lo tanto, la vista aparecer谩 con cierto retraso. <br><br>  Tratemos con <b>BiFinction</b> en <b>RxJava</b> .  Esta funci贸n recibe dos objetos como entrada, realiza algunas operaciones en ellos y devuelve un tercer objeto.  Queremos tomar tiempo y ver objetos y obtener <b>Desechables</b> debido al hecho de que llamamos a la animaci贸n <b>fadeIn</b> y nos suscribimos para <b>suscribirnos</b> .  El valor del tiempo no es importante para nosotros.  Como resultado, obtenemos esta animaci贸n: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/8q/wa/1z/8qwa1z75xolp2jb-hsznqzncykw.gif"></div><br><h3>  Vanogogh </h3><br>  Te contar茅 sobre el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">proyecto</a> que Ivan comenz贸 a desarrollar para MBLT DEV 2017. <br><br>  La biblioteca desarrollada por Ivan presenta varios proyectiles para animaciones.  Ya hemos considerado esto arriba.  Tambi茅n contiene animaciones listas para usar que puede usar.  Obtiene un conjunto generalizado de herramientas para crear sus propias animaciones.  Esta biblioteca le proporcionar谩 componentes m谩s potentes para la programaci贸n reactiva. <br><br>  Considere la biblioteca usando un ejemplo: <br><br><pre> <code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fadeIn</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(view:</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">View</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> : AnimationCompletable { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> AnimationBuilder.forView(view) .alpha(<span class="hljs-number"><span class="hljs-number">1f</span></span>) .duration(<span class="hljs-number"><span class="hljs-number">2000L</span></span>) .build().toCompletable() }</code> </pre> <br>  Suponga que desea crear una animaci贸n que aparece, pero esta vez aparece un <b>AnimationCompletable en</b> lugar del objeto <b>Completable</b> .  Esta clase hereda de <b>Completable</b> , por lo que ahora aparecen m谩s funciones.  Una caracter铆stica importante del c贸digo anterior era que era imposible cancelar animaciones.  Ahora puede crear un objeto <b>AnimationCompletable</b> que haga que la animaci贸n se detenga tan pronto como nos demos de baja. <br><br>  Cree una animaci贸n emergente utilizando <b>AnimationBuilder</b> , una de las clases de la biblioteca.  Especifique a qu茅 Vista se aplicar谩 la animaci贸n.  En esencia, esta clase copia el comportamiento de <b>ViewPropertyAnimator</b> , pero con la diferencia de que la salida es una secuencia. <br><br>  A continuaci贸n, configure alfa 1f y la duraci贸n es de 2 segundos.  Luego recogemos la animaci贸n.  Tan pronto como <b>invoquemos la</b> declaraci贸n de <b>compilaci贸n</b> , aparece la animaci贸n.  Asignamos animaciones a la propiedad de un objeto inmutable, por lo que guardar谩 estas caracter铆sticas para su lanzamiento.  Pero la animaci贸n en s铆 no comenzar谩. <br><br>  Llama a <b>toCompletable</b> , que crear谩 un <b>AnimationCompletable</b> .  Envolver谩 los par谩metros de esta animaci贸n en una especie de shell para la programaci贸n reactiva, y tan pronto como se suscriba, comenzar谩 la animaci贸n.  Si lo apaga antes de que se complete el proceso, la animaci贸n finalizar谩.  Ahora tambi茅n puede agregar una funci贸n de devoluci贸n de llamada.  Puede escribir los operadores <b>doOnAnimationReady</b> , <b>doOnAnimationStart</b> , <b>doOnAnimationEnd</b> y similares: <br><br><pre> <code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fadeIn</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(view:</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">View</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> : AnimationCompletable { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> AnimationBuilder.forView(view) .alpha(<span class="hljs-number"><span class="hljs-number">1f</span></span>) .duration(<span class="hljs-number"><span class="hljs-number">2000L</span></span>) .buildCompletable() .doOnAnimationReady { view.alpha = <span class="hljs-number"><span class="hljs-number">0f</span></span> } }</code> </pre> <br>  En este ejemplo, mostramos lo conveniente que es usar <b>AnimationBuilder</b> y cambiamos el estado de nuestra Vista antes de comenzar la animaci贸n. <br><br><h3>  Informar video </h3><br>  Analizamos una de las opciones para crear, componer y ajustar animaciones usando Kotlin y RxJava.  Aqu铆 hay un enlace a un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">proyecto</a> que describe animaciones b谩sicas y ejemplos para ellos, as铆 como los shells principales para trabajar con animaciones. <br><br>  Adem谩s del descifrado, comparto un video del informe: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/Yv80bdUnJgw" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h3>  Altavoces MBLT DEV 2018 </h3><br>  Antes de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">MBLT DEV 2018</a> , quedan poco m谩s de dos meses.  Tendremos las siguientes actuaciones: <br><br><ul><li>  Laura Morinigo, experta en desarrolladores de Google </li><li>  Kaushik Gopal, autor del podcast fragmentado </li><li>  Artyom Rudoi, Badoo </li><li>  Dina Sidorova, Google y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">otros</a> . </li></ul><br>  Ma帽ana el precio del boleto cambiar谩.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Reg铆strese</a> hoy </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es418383/">https://habr.com/ru/post/es418383/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es418371/index.html">Microtask para programadores y un m茅todo alternativo de pago de criptomonedas</a></li>
<li><a href="../es418375/index.html">Descripci贸n general de la impresora fotogr谩fica Uniz Slash + 3D</a></li>
<li><a href="../es418377/index.html">Kotlin: dos cucharadas de alquitr谩n en un barril de miel</a></li>
<li><a href="../es418379/index.html">Pr贸tesis bioel茅ctrica infantil. Parte 2</a></li>
<li><a href="../es418381/index.html">Novedades de DevTools en Chrome Versi贸n 68</a></li>
<li><a href="../es418385/index.html">C贸mo ensambl茅 una computadora para juegos antiguos</a></li>
<li><a href="../es418387/index.html">Di谩logo f铆sico sobre el alma.</a></li>
<li><a href="../es418389/index.html">RabbitMQ vs. Kafka: uso de Kafka en aplicaciones orientadas a eventos</a></li>
<li><a href="../es418391/index.html">OSPF (primera parte)</a></li>
<li><a href="../es418393/index.html">[Viernes] C贸mo vimos Web 3D</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>