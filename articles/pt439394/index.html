<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü¶Å ‚õìÔ∏è üå≠ Como programador, os kernels do datacenter escreveram üíÆ üë®üèø‚Äçü§ù‚Äçüë®üèΩ üë®</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Poucas pessoas acreditam que a pilha moderna de ci√™ncia de dados pode ser constru√≠da n√£o no Python, mas existem esses precedentes :). A pilha Odnoklas...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Como programador, os kernels do datacenter escreveram</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/odnoklassniki/blog/439394/"><img src="https://habrastorage.org/getpro/habr/post_images/ff7/128/e7e/ff7128e7e376b301570865e4d2436d4e.png"><br><p>  Poucas pessoas acreditam que a pilha moderna de ci√™ncia de dados pode ser constru√≠da n√£o no Python, mas existem esses precedentes :).  A pilha Odnoklassniki foi formada por muitos anos, principalmente por programadores que mudaram para a ci√™ncia de dados, mas ainda permaneciam pr√≥ximos do produto, por isso √© baseada nas tecnologias abertas da pilha JVM: Hadoop, Spark, Kafka, Cassandra, etc.  Isso nos ajuda a reduzir o tempo e o custo de colocar modelos em opera√ß√£o, mas √†s vezes cria dificuldades.  Por exemplo, ao preparar solu√ß√µes b√°sicas para os participantes do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">SNA Hackathon 2019</a> , eles tiveram que comprimir sua for√ßa de vontade e mergulhar no mundo da digita√ß√£o din√¢mica.  Detalhes (e f√°cil trolling) sob o corte :) </p><a name="habracut"></a><br><h3>  Instala√ß√£o </h3><br><img src="https://habrastorage.org/getpro/habr/post_images/dc2/4eb/aff/dc24ebaff7995594e4a9abdef0f65bf6.jpg"><br><p> Existe algum tipo de python em quase qualquer m√°quina de desenvolvimento.  Ele foi encontrado no meu, j√° em duplicado - 2.7 e 3.4.  Tendo vasculhado os compartimentos da mem√≥ria, lembrei-me de que instalei a vers√£o 3.4 h√° tr√™s anos, depois que os participantes enfrentaram problemas √©picos no SNA Hackathon 2016, tentando expandir um gr√°fico de meio gigabyte na mem√≥ria (como resultado de um pequeno <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">v√≠deo de treinamento</a> e uma <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">competi√ß√£o separada</a> ), mas hoje √© a economia j√° √© moralmente obsoleta e precisa ser atualizada. </p><br><p>  No mundo Java, cada projeto durante a montagem indica tudo o que deseja incorporar em si mesmo, e continua com isso.  Em teoria, tudo √© simples e bonito, mas na pr√°tica, quando voc√™ precisa da biblioteca A e da biblioteca B, certamente descobrir√° que ambos precisam da biblioteca C, com duas vers√µes incompat√≠veis diferentes :).  Em tentativas v√£s de romper esse c√≠rculo vicioso, algumas bibliotecas empacotam todas as suas depend√™ncias em <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">si mesmas</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">se</a> escondem do resto, enquanto as demais giram como podem. </p><br><p>  O que h√° com isso em python?  N√£o existe um projeto como tal, mas existe um "ambiente" e, em cada ambiente, um ecossistema independente pode ser formado a partir de pacotes de determinadas vers√µes.  Ao mesmo tempo, existem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ferramentas para os pregui√ßosos</a> , com a ajuda da qual n√£o √© mais dif√≠cil gerenciar o ambiente Python local, do que um cluster heterog√™neo distribu√≠do de Clauder ou Horton.  Mas os conflitos m√∫tuos entre as vers√µes dos pacotes n√£o v√£o a lugar algum.Eu imediatamente enfrentei o fato de que o lan√ßamento do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Pandas 0.24</a> transferiu o m√©todo privado _maybe_box_datetimelike para a API p√∫blica e, de repente, verificou-se que muitas pessoas o usaram em sua forma anterior e agora ca√≠ram :) (e sim, em O mundo Java √© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">o mesmo</a> ).  Mas, no final, tudo foi consertado, al√©m dos terr√≠veis avisos sobre a nova depriycheyshin, funcionou. </p><br><h3>  Linha de base colaborativa </h3><br><img src="https://habrastorage.org/getpro/habr/post_images/014/e7e/7b5/014e7e7b5ff3aa7c85a439e588e738fd.png" alt="imagem"><br><p>  As tarefas do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">SNA Hackathon 2019 s√£o</a> divididas em tr√™s √°reas - recomenda√ß√µes sobre logs, textos e imagens.  Vamos come√ßar com os logs (spoiler - megapattern Cmd + C / Cmd + V com stackoverflow tamb√©m funciona com python).  Os dados foram coletados a partir de uma produ√ß√£o ao vivo - cada usu√°rio, aleatoriamente, sem pesar, mostrou alguns alimentos de seu ambiente, ap√≥s o qual todos os sinais no momento do show e a rea√ß√£o final foram registrados no log.  A tarefa do peda√ßo de bolo: pegamos sinais, empurramos um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">logg</a> , lucro! </p><br><p>  Mas o plano brilhou na primeira etapa, na leitura de dados.  Em teoria, existe um maravilhoso pacote <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Apache Arrow</a> , que deveria unificar o trabalho com dados em diferentes ecossistemas e, em particular, permitir ler <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">arquivos "parquet"</a> de python sem fa√≠scas.  Na pr√°tica, acabou.  que mesmo lendo estruturas simples e aninhadas, ele tem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">problemas</a> , e nossa bela hierarquia se transformou em uma mis√©ria plana :(. </p><br><p>  Mas havia aspectos positivos.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Jupyter</a> , em geral, ficou satisfeito, √© quase t√£o confort√°vel, embora n√£o t√£o bonito quanto o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Zeppelin</a> .  Existe at√© um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">n√∫cleo de rock</a> !  Bem, a velocidade da regress√£o log√≠stica em um pequeno peda√ßo de dados na mem√≥ria agradou - n√£o atinge o poder da op√ß√£o distribu√≠da, mas aprende instantaneamente em quatro sinais e algumas centenas de milhares de exemplos. </p><br><p>  Entretanto, o entusiasmo que surgiu foi duramente atingido: se a transforma√ß√£o de dados necess√°ria (agrupar por chave e agrupar em uma lista) n√£o estiver na lista padr√£o e aplicar ou mapa aparecer, a velocidade cair√° em ordens de magnitude.  Como resultado, 80% do tempo da linha de base n√£o √© a leitura de dados, associa√ß√µes, treinamento e classifica√ß√£o de modelos, mas a compila√ß√£o banal da lista. </p><br><p>  A prop√≥sito, √© precisamente por causa desse recurso que eu sempre fico surpreso com os usu√°rios do pySpark - afinal, quase todas as funcionalidades padr√£o est√£o dispon√≠veis na forma de Spark SQL, que √© a mesma em python e rock, e depois do primeiro yudf-in tipo python com algo pessoal de dez n√∫cleos o cluster se transforma em uma ab√≥bora ... </p><br><p>  Mas, no final, todos os obst√°culos foram superados e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">nove</a> pontos foram suficientes para marcar 0,65! </p><br><h3>  Linha de base do texto </h3><br><img src="https://habrastorage.org/webt/f2/tq/ei/f2tqei-pbxqoaan8z1jhmyesija.png"><br><p>  Bem, agora nossa tarefa √© mais complicada - se o logreg puder ser encontrado em centenas de implementa√ß√µes para todas as plataformas, haver√° mais variedade de ferramentas para trabalhar com textos em python.  Felizmente, os textos j√° est√£o sendo enviados n√£o apenas na forma bruta, mas tamb√©m processados ‚Äã‚Äãpelo nosso sistema regular de pr√©-processamento baseado no Spark e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Lucene</a> .  Portanto, voc√™ pode pegar imediatamente a lista de tokens e n√£o se preocupar com tokeniza√ß√£o / lematiza√ß√£o / stemming. </p><br><p>  Por algum tempo, duvidei do que levar: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">BigARTM</a> dom√©stico ou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Gensim</a> importado.  Como resultado, decidi pelo segundo e copiei o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">tutorial doc2vec</a> :).  Espero que os colegas da equipe BigARTM n√£o deixem de aproveitar a oportunidade e mostrem as vantagens de sua biblioteca na competi√ß√£o. </p><br><p>  Novamente, temos um plano simples: pegamos todos os textos do teste, treinamos o modelo Doc2Vec, depois o inferimos no trem e aprendemos o registro dos resultados (o empilhamento √© tudo!).  Mas, como sempre, os problemas come√ßaram imediatamente.  Apesar da quantidade relativamente modesta de textos na amostra de treinamento (apenas um gigabyte e meio), ao tentar arrast√°-los para a rampa, o python comeu 20 (20 Karl!) Gigabytes de mem√≥ria, trocou e n√£o voltou.  Eu tive que comer um elefante em partes. </p><br><p>  Ao ler, sempre indicamos quais colunas levantar do ch√£o, o que nos permite n√£o ler o texto bruto na mem√≥ria.  Isso economiza seu uso pela metade, os documentos do conjunto de testes s√£o carregados na mem√≥ria para treinamento sem problemas.  Com um conjunto de treinamento desse tipo, n√£o √© suficiente; portanto, em um momento, n√£o fazemos upload de mais de um arquivo "parquet".  Al√©m disso, no arquivo baixado, deixamos apenas o ID dos dias que queremos usar para o treinamento e j√° os inferimos sobre eles. </p><br><p>  Entrar em cima disso funciona t√£o r√°pido quanto, e no final obtemos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">14 par√°grafos</a> e obtemos 0,54 :) </p><br><h3>  Linha de base da imagem </h3><br><p><img src="https://habrastorage.org/webt/7_/6s/aw/7_6sawssmwohrrk1spxk9_zuqy8.jpeg"></p><br><p>  O que poderia ser mais popular que o aprendizado profundo?  Apenas gatos!  Portanto, para a imagem de linha de base, fizemos um plano brilhantemente simples: execute um detector de gato nas imagens do conjunto de teste e depois classifique o conte√∫do de acordo com a pontua√ß√£o :) </p><br><p>  E, novamente, h√° muito por onde escolher.  Classifica√ß√£o ou detec√ß√£o?  pyTorch ou Tensorflow?  O principal crit√©rio √© a facilidade de implementa√ß√£o pelo m√©todo copiar e colar.  E o vencedor √© ... <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">YOLOv3 na MXNet</a> :).  A concis√£o de sua demo cativou √† primeira vista, mas depois, como sempre, come√ßaram os problemas. </p><br><p>  O que geralmente funciona com big data come√ßa?  Com estimativas de desempenho e o tempo necess√°rio da m√°quina!  Eu queria tornar a linha de base o mais aut√¥noma poss√≠vel, ent√£o eles a ensinaram a trabalhar diretamente com o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">arquivo tar</a> e rapidamente perceberam que a uma velocidade de extrair 200 fotos por segundo do tar para o tmpfs, levaria cerca de meia hora, normas para processar 352.758 imagens.  Adicione carregamento e pr√©-processamento de fotos - 100 por segundo, cerca de uma hora para tudo, normas.  Adicione o c√°lculo da rede neural - 20 fotos por segundo, 5 horas, bem ... Ok. Adicione a extra√ß√£o do resultado - 1 foto por segundo, semana, WTF? </p><br><p>  Depois de algumas horas dan√ßando com pandeiros, o entendimento √© de que o NDArray que observamos nunca fica entorpecido e a estrutura interna do MXNet, que faz todos os c√°lculos pregui√ßosamente.  Bingo!  O que fazer?  Qualquer diplomacia novato sabe que √© tudo sobre o tamanho do lote!  Se o MXNet calcula a pontua√ß√£o pregui√ßosamente, se primeiro solicitarmos algumas d√∫zias de fotos e come√ßarmos a extra√≠-las, talvez o processamento das fotos seja em lotes?  E sim, depois de adicionar o lote a uma velocidade de 10 fotos por segundo, consegui encontrar todos os gatos :). </p><br><p>  Em seguida, aplicamos a engenharia bem conhecida e, em <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">10 par√°grafos</a> , obtemos pontua√ß√£o 0,504 :). </p><br><h3>  Conclus√µes </h3><br><img src="https://habrastorage.org/webt/aq/yf/0n/aqyf0navjrowlvcgvn0k3a7hcne.jpeg"><br><p>  Quando um sensei s√°bio foi perguntado: ‚ÄúQuem vencer√°, mestre de Aikido ou karat√™?‚Äù, Ele respondeu: ‚ÄúMestre vencer√°‚Äù.  Fomos levados a aproximadamente as mesmas conclus√µes por esse experimento: n√£o existe e n√£o pode ser uma linguagem ideal para todas as ocasi√µes.  Com o Python, voc√™ pode montar rapidamente uma solu√ß√£o a partir de blocos prontos, mas tentar se afastar deles com quantidades de dados suficientemente grandes trar√° muita dor.  Em Java e Scala, voc√™ tamb√©m pode encontrar muitas ferramentas prontas e implementar facilmente suas pr√≥prias id√©ias, mas as pr√≥prias linguagens ser√£o mais exigentes quanto √† qualidade do c√≥digo. </p><br><p>  E, claro, boa sorte a todos os membros do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">SNA Hackathon 2019</a> ! </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt439394/">https://habr.com/ru/post/pt439394/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt439382/index.html">Usando Ansible, Terraform, Docker, Consul, Nomad nas nuvens (Alexey Vakhov, Uchi.ru)</a></li>
<li><a href="../pt439384/index.html">Modelagem Metr√≥pole</a></li>
<li><a href="../pt439388/index.html">Rob√¥s no jornalismo ou como usar a intelig√™ncia artificial para criar conte√∫do</a></li>
<li><a href="../pt439390/index.html">As melhores inova√ß√µes das redes sociais em 2018</a></li>
<li><a href="../pt439392/index.html">A temporada de campeonato 2019 est√° aberta! SNA Hackathon Ala ML Boot Camp 8 come√ßa</a></li>
<li><a href="../pt439396/index.html">Redefinir senha do controlador UniFi</a></li>
<li><a href="../pt439402/index.html">JavaScript: O grande po√ßo inteiro Por que</a></li>
<li><a href="../pt439404/index.html">Uma breve hist√≥ria dos contratos p√∫blicos eletr√¥nicos na R√∫ssia</a></li>
<li><a href="../pt439408/index.html">Pseudo Lens Flare</a></li>
<li><a href="../pt439410/index.html">Jeff Hawkins est√° finalmente pronto para explicar sua pesquisa sobre o c√©rebro</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>