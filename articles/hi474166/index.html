<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯЪЦ ЁЯР╕ ЁЯФк рдЬреАрдПрд╕рдЯреА рдХреЗ рд▓рд┐рдП рдЕрдиреБрдХреНрд░рдордгрд┐рдХрд╛ рдХреЛ рдХрд╡рд░ рдХрд░реЗрдВ ЁЯСЙЁЯП╜ ЁЯда ЁЯШ╡</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рдХрд╡рд░рд┐рдВрдЧ рдЗрдВрдбреЗрдХреНрд╕ рдХреЗрд╡рд▓ рдПрдХ рдФрд░ рд╡рд┐рд╢реЗрд╖рддрд╛ рдирд╣реАрдВ рд╣реИ рдЬреЛ рдХрд╛рдо рдореЗрдВ рдЖ рд╕рдХрддрд╛ рд╣реИред рдпрд╣ рдмрд╛рдд рдкреВрд░реА рддрд░рд╣ рд╕реЗ рд╡реНрдпрд╛рд╡рд╣рд╛рд░рд┐рдХ рд╣реИред рдЙрдирдХреЗ рдмрд┐рдирд╛, рдХреЗрд╡рд▓ рдЗрдВрдбреЗрдХреНрд╕ рд╕реНрдХреИрди рдПрдХ рдЬреАрдд рдирд╣реАрдВ рджреЗ рд╕рдХрддрд╛ рд╣реИ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>рдЬреАрдПрд╕рдЯреА рдХреЗ рд▓рд┐рдП рдЕрдиреБрдХреНрд░рдордгрд┐рдХрд╛ рдХреЛ рдХрд╡рд░ рдХрд░реЗрдВ</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/postgrespro/blog/474166/">  рдХрд╡рд░рд┐рдВрдЧ рдЗрдВрдбреЗрдХреНрд╕ рдХреЗрд╡рд▓ рдПрдХ рдФрд░ рд╡рд┐рд╢реЗрд╖рддрд╛ рдирд╣реАрдВ рд╣реИ рдЬреЛ рдХрд╛рдо рдореЗрдВ рдЖ рд╕рдХрддрд╛ рд╣реИред  рдпрд╣ рдмрд╛рдд рдкреВрд░реА рддрд░рд╣ рд╕реЗ рд╡реНрдпрд╛рд╡рд╣рд╛рд░рд┐рдХ рд╣реИред  рдЙрдирдХреЗ рдмрд┐рдирд╛, рдХреЗрд╡рд▓ рдЗрдВрдбреЗрдХреНрд╕ рд╕реНрдХреИрди рдПрдХ рдЬреАрдд рдирд╣реАрдВ рджреЗ рд╕рдХрддрд╛ рд╣реИред  рд╣рд╛рд▓рд╛рдВрдХрд┐ рдЕрд▓рдЧ-рдЕрд▓рдЧ рд╕реНрдерд┐рддрд┐рдпреЛрдВ рдореЗрдВ рдХрд╡рд░рд┐рдВрдЧ рдЗрдВрдбреЗрдХреНрд╕ рдЕрд▓рдЧ-рдЕрд▓рдЧ рддрд░реАрдХреЛрдВ рд╕реЗ рдкреНрд░рднрд╛рд╡реА рд╣реЛрддрд╛ рд╣реИред <br><br>  рдпрд╣ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдЗрдВрдбреЗрдХреНрд╕ рдХреЛ рдХрд╡рд░ рдХрд░рдиреЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдирд╣реАрдВ рд╣реИ: рд╕рдЦреНрддреА рд╕реЗ рдмреЛрд▓рдирд╛, рдкреЛрд╕реНрдЯрдЧреНрд░реЗрд╕ рдореЗрдВ рддрдерд╛рдХрдерд┐рдд рд╕рдорд╛рд╡реЗрд╢реА рдЗрдВрдбреЗрдХреНрд╕ рджрд┐рдЦрд╛рдИ рджрд┐рдП рд╣реИрдВред  рд▓реЗрдХрд┐рди, рдХреНрд░рдо рдореЗрдВ: рдПрдХ рдХрд╡рд░рд┐рдВрдЧ рдЗрдВрдбреЗрдХреНрд╕ рдПрдХ рдРрд╕рд╛ рдЗрдВрдбреЗрдХреНрд╕ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдХреНрд╡реЗрд░реА рджреНрд╡рд╛рд░рд╛ рдЖрд╡рд╢реНрдпрдХ рд╕рднреА рдХреЙрд▓рдо рдорд╛рди рд╢рд╛рдорд┐рд▓ рд╣реЛрддреЗ рд╣реИрдВ;  рд╣рд╛рд▓рд╛рдБрдХрд┐, рддрд╛рд▓рд┐рдХрд╛ рддрдХ рдкрд╣реБрдБрдЪ рдХреА рдЕрдм рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИред  рд▓рдЧрднрдЧред  рдЖрдк "рд▓рдЧрднрдЧ" рдФрд░ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">Yegor Rogov рдХреЗ</a> рдПрдХ рд▓реЗрдЦ рдореЗрдВ рдЕрдиреНрдп рдмрд╛рд░реАрдХрд┐рдпреЛрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдкрдврд╝</a> рд╕рдХрддреЗ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╣реИрдВ</a> , рдЬреЛ рдХрд┐ 10 (!) рднрд╛рдЧреЛрдВ рдХреА рдЙрдирдХреА рд╢реНрд░рдВрдЦрд▓рд╛ рд╢реНрд░реГрдВрдЦрд▓рд╛ рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реИред  рдФрд░ <b>рд╕рдорд╛рд╡реЗрд╢реА рд╕реВрдЪрдХрд╛рдВрдХ</b> рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдкреНрд░рд╢реНрдиреЛрдВ рдкрд░ рдЦреЛрдЬ рдХреЗ рд▓рд┐рдП рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ: рдЬрд┐рди рдХреНрд╖реЗрддреНрд░реЛрдВ рдХреЗ рдЦреЛрдЬ рдирд╣реАрдВ рдХрд┐рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВ рдЙрдирдХреЗ рдореВрд▓реНрдпреЛрдВ рдХреЛ рдЦреЛрдЬ рд╕реВрдЪрдХрд╛рдВрдХ рдореЗрдВ рдЬреЛрдбрд╝рд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЙрдиреНрд╣реЗрдВ рдХреЗрд╡рд▓ рдЗрд╕рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рд╣реИ рддрд╛рдХрд┐ рддрд╛рд▓рд┐рдХрд╛ рдХреЛ рдлрд┐рд░ рд╕реЗ рд╕рдВрджрд░реНрднрд┐рдд рди рдХрд┐рдпрд╛ рдЬрд╛рдПред  рдЗрд╕ рддрд░рд╣ рдХреЗ рдЗрдВрдбреЗрдХреНрд╕ INCLUDE рдХреАрд╡рд░реНрдб рдХреЗ рд╕рд╛рде рдмрдирддреЗ рд╣реИрдВред <br><br>  рдЕрдирд╛рд╕реНрддрд╛рд╕рд┐рдпрд╛ рд▓реБрдмреЗрдиреАрдХреЛрд╡рд╛ (рдкреЛрд╕реНрдЯрдЧреНрд░реЗрдЬрд╝ рдкреНрд░реЛрдлреЗрд╢рдирд▓) рдиреЗ рдмреАрдЯреАрдЖрд░рдЖрдИ рдкрджреНрдзрддрд┐ рдХреЛ рдЕрдВрддрд┐рдо рд░реВрдк рджрд┐рдпрд╛ рддрд╛рдХрд┐ рд╕реВрдЪрдХрд╛рдВрдХ рдореЗрдВ рдЕрддрд┐рд░рд┐рдХреНрдд рд╕реНрддрдВрднреЛрдВ рдХреЛ рд╢рд╛рдорд┐рд▓ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред  рдЗрд╕ рдкреИрдЪ рдХреЛ PostgreSQL 11. рдореЗрдВ рд╢рд╛рдорд┐рд▓ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛, рд▓реЗрдХрд┐рди GiST / SP-GiST рдкрд╣реБрдБрдЪ рд╡рд┐рдзрд┐рдпреЛрдВ рдХреЗ рд▓рд┐рдП рдкреИрдЪ рдореЗрдВ рдЗрд╕ рд╕рдВрд╕реНрдХрд░рдг рдХреЗ рд░рд┐рд▓реАрдЬрд╝ рд╣реЛрдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдкрд░рд┐рдкрдХреНрд╡ рд╣реЛрдиреЗ рдХрд╛ рд╕рдордп рдирд╣реАрдВ рдерд╛ред  12 рд╡реЗрдВ рддрдХ рдЬреАрдПрд╕рдЯреА рд▓рд╛рдЧреВ рд╣реЛ рдЧрдпрд╛ред <br><a name="habracut"></a><br>  GiST рдХреЗ рд▓рд┐рдП рд╕рдорд╛рд╡реЗрд╢реА рдЕрдиреБрдХреНрд░рдорд┐рдд рдХрд░рдиреЗ рдХреА рд░рдЪрдирд╛рддреНрдордХ рдЗрдЪреНрдЫрд╛ рдмрд╣реБрдд рдкрд╣рд▓реЗ рдкреИрджрд╛ рд╣реБрдИ: рдПрдВрдбреНрд░реА рдмреЛрд░реЛрдбрд┐рди рджреНрд╡рд╛рд░рд╛ рдПрдХ рдкрд░реАрдХреНрд╖рдг рдкреИрдЪ рдЕрдкреНрд░реИрд▓ 2018 рдХреЗ рдордзреНрдп рдореЗрдВ рд╕рдореБрджрд╛рдп рдХреЛ рд╡рд╛рдкрд╕ <a href="">рдХрд░рдиреЗ рдХреА рдкреЗрд╢рдХрд╢ рдХреА рдЧрдИ</a> рдереАред  рдЙрдиреНрд╣реЛрдВрдиреЗ рд╕рднреА рдмреБрдирд┐рдпрд╛рджреА, рдмрд╣реБрдд рдореБрд╢реНрдХрд┐рд▓ рдХрд╛рдо рдХрд┐рдПред <br><br>  рдЕрдЧрд╕реНрдд 2019 рдХреА рд╢реБрд░реБрдЖрдд рдореЗрдВ, рдЕрд▓реЗрдХреНрдЬреЗрдВрдбрд░ рдХреЛрд░реЛрдЯрдХреЛрд╡ рдиреЗ рдХреЙрд╕реНрдореЗрдЯрд┐рдХ рд╕реБрдзрд╛рд░реЛрдВ рдХреЛ рдЬреЛрдбрд╝рд╛ рдФрд░ рдкреИрдЪ рдХреЛ рдкреНрд░рддрд┐рдмрджреНрдз рдХрд┐рдпрд╛ред <br><br>  рдкреНрд░рджрд░реНрд╢рди рдФрд░ рдХреБрдЫ рд╢реЛрдз рдХреЗ рд▓рд┐рдП, рд╣рдо 3 рдорд┐рд▓рд┐рдпрди рдЖрдпрддреЛрдВ рдХрд╛ рдПрдХ рд╕реЗрдЯ рддреИрдпрд╛рд░ рдХрд░реЗрдВрдЧреЗред  рдЙрд╕реА рд╕рдордп, рдмреЙрдХреНрд╕ рдкреНрд░рдХрд╛рд░ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдХреБрдЫ рд╢рдмреНрдж, рдХреНрдпреЛрдВрдХрд┐ рдЗрд╕рдХреЗ рд╕рд╛рде рд╕рднреА рдЬреЛрдбрд╝рддреЛрдбрд╝ рд╕рд╣рдЬ рдирд╣реАрдВ рд╣реИрдВред <br><br>  рдмреЙрдХреНрд╕ рдХрд╛ рдкреНрд░рдХрд╛рд░ - рдЕрд░реНрдерд╛рдд, рдЖрдпрдд - рд▓рдВрдмреЗ рд╕рдордп рд╕реЗ Postgres рдореЗрдВ рд╣реИ, рдЗрд╕реЗ 2 рдмрд┐рдВрджреБрдУрдВ (рдЬреНрдпрд╛рдорд┐рддреАрдп рдкреНрд░рдХрд╛рд░ рдмрд┐рдВрджреБ) рджреНрд╡рд╛рд░рд╛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ - рдЖрдпрдд рдХреЗ рд╡рд┐рдкрд░реАрдд рдХреЛрдиреЗ (рдпрд╛рдиреА, рдЖрдпрдд рддрд┐рд░рдЫреА рдирд╣реАрдВ рд╣реЛ рд╕рдХрддреА рд╣реИ, рдХрд┐рдирд╛рд░реЗ рдкрд░ рд▓рд┐рдЯ рдЧрдИ)ред  рд╣рдо <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рджрд╕реНрддрд╛рд╡реЗрдЬрд╝</a> рдореЗрдВ рдкрдврд╝рддреЗ рд╣реИрдВ: "рдЯрд╛рдЗрдк рдмреЙрдХреНрд╕ рдХреЗ рдорд╛рди рдирд┐рдореНрди рд░реВрдкреЛрдВ рдореЗрдВ рд╕реЗ рдПрдХ рдореЗрдВ рд▓рд┐рдЦреЗ рдЧрдП рд╣реИрдВ: <br><br><pre><code class="plaintext hljs">( ( x1 , y1 ) , ( x2 , y2 ) ) ( x1 , y1 ) , ( x2 , y2 ) x1 , y1 , x2 , y2</code> </pre> <br>  рд╡реНрдпрд╡рд╣рд╛рд░ рдореЗрдВ, рдЖрдкрдХреЛ рдЗрд╕ рддрд░рд╣ рд▓рд┐рдЦрдирд╛ рд╣реЛрдЧрд╛: <br><br><pre> <code class="pgsql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> box(<span class="hljs-string"><span class="hljs-string">'1,2'</span></span>, <span class="hljs-string"><span class="hljs-string">'3,4'</span></span>); <span class="hljs-type"><span class="hljs-type">box</span></span> <span class="hljs-comment"><span class="hljs-comment">------------- (3,4),(1,2) (1 row)</span></span></code> </pre> <br>  рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, Postgres рд╣рдореЗрдВ рд╢реАрд░реНрд╖ рджрд╛рдИрдВ рдУрд░ рд╢реАрд░реНрд╖ рджрд┐рдЦрд╛рддрд╛ рд╣реИ, рдлрд┐рд░ рдиреАрдЪреЗ рдмрд╛рдИрдВ рдУрд░ред  рдЕрдЧрд░ рд╣рдо рдРрд╕рд╛ рд▓рд┐рдЦрддреЗ рд╣реИрдВ, <br><br><pre> <code class="pgsql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> box(<span class="hljs-string"><span class="hljs-string">'5,2'</span></span>, <span class="hljs-string"><span class="hljs-string">'3,4'</span></span>); <span class="hljs-type"><span class="hljs-type">box</span></span> <span class="hljs-comment"><span class="hljs-comment">------------- (5,4),(3,2) (1 row)</span></span></code> </pre> <br>  рдлрд┐рд░ рд╣рдо рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░реЗрдВрдЧреЗ рдХрд┐ рдкреЛрд╕реНрдЯрдЧреНрд░реЗрдЯреНрд╕ рдЙрди рдЪреЛрдЯрд┐рдпреЛрдВ рдХреЛ рди рджреЗрдВ рдЬреЛ рдЙрдиреНрд╣реЛрдВрдиреЗ рдЙрд╕реЗ рджреА рдереАрдВред  рдЙрдиреНрд╣реЛрдВрдиреЗ рд╣рдорд╛рд░реЗ рдКрдкрд░реА рдмрд╛рдПрдБ рдФрд░ рдирд┐рдЪрд▓реЗ рджрд╛рдПрдБ рд╕реЗ рдКрдкрд░реА рджрд╛рдПрдБ рдФрд░ рдирд┐рдЪрд▓реЗ рдмрд╛рдПрдБ рдХреА рдЧрдгрдирд╛ рдХреАред  рдпрд╣ рдПрдХ рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рд╕рдВрдкрддреНрддрд┐ рд╣реИ рдЬрдм рдмреЗрддрд░рддреАрдм рдврдВрдЧ рд╕реЗ рдкреАрдврд╝реА рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ рдЕрдЧреНрд░рд┐рдо рдореЗрдВ рдирд╣реАрдВ рдЬрд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИ - рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдПред  рдЕрдВрдХрди '1,2', '3,4' рдмрд┐рдВрджреБ (1,2), рдмрд┐рдВрджреБ (3,4) рдХреЗ рдмрд░рд╛рдмрд░ рд╣реИред  рдпрд╣ рд░реВрдк рдХрднреА-рдХрднреА рдЕрдзрд┐рдХ рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рд╣реЛрддрд╛ рд╣реИред <br><br><br><h3>  рд╡реНрдпрд╛рдкрд╛рд░ рдХреЗ рд▓рд┐рдП: 3 рдорд┐рд▓рд┐рдпрди рдЖрдпрддреЛрдВ рдореЗрдВ рдЦреЛрдЬреЗрдВ </h3><br><pre> <code class="pgsql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> boxes(id <span class="hljs-type"><span class="hljs-type">serial</span></span>, thebox <span class="hljs-type"><span class="hljs-type">box</span></span>, <span class="hljs-type"><span class="hljs-type">name</span></span> <span class="hljs-type"><span class="hljs-type">text</span></span>);</code> </pre><br>  рд╣рдо 3 рдорд┐рд▓рд┐рдпрди рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рдЖрдпрддреЗрдВ рдЙрддреНрдкрдиреНрди рдХрд░реЗрдВрдЧреЗред  рд╣рдо рдПрдХ рд╕рд╛рдорд╛рдиреНрдп рд╡рд┐рддрд░рдг рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЯреЗрдмрд▓рдлрдВрдХ</a> рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо "рдЦрд░рд╛рдм" рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ: рд╣рдо рдпрд╛рджреГрдЪреНрдЫрд┐рдХ () - рдпрд╛рджреГрдЪреНрдЫрд┐рдХ () рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ, рдЬреЛ рдПрдХ рдЕрдЪреНрдЫреА рддрд╕реНрд╡реАрд░ рднреА рджреЗрддрд╛ рд╣реИ (рдЕрдВрдЬреАрд░ рджреЗрдЦреЗрдВред) рдЖрдпрддреЛрдВ рдХреЗ рд╕рд╛рде, рдХреЗрдВрджреНрд░ рдХреЗ рдХрд░реАрдм рдмрдбрд╝рд╛ред  рдЧреБрд░реБрддреНрд╡рд╛рдХрд░реНрд╖рдг рдХреЗ рдЙрдирдХреЗ рдХреЗрдВрджреНрд░ рднреА рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рд╣реИрдВред  рдЗрд╕ рддрд░рд╣ рдХреЗ рд╡рд┐рддрд░рдг рдХреБрдЫ рдкреНрд░рдХрд╛рд░ рдХреЗ рд╡рд╛рд╕реНрддрд╡рд┐рдХ рд╢рд╣рд░ рдбреЗрдЯрд╛ рдХреА рд╡рд┐рд╢реЗрд╖рддрд╛ рд╣реИрдВред  рдФрд░ рдЬреЛ рдЖрдВрдХрдбрд╝реЗ рдпрд╛ рддрд╛рдЬрд╝рд╛ рдпрд╛рджреЛрдВ рдХреЗ рдирд┐рдпрдореЛрдВ рдореЗрдВ рддрд▓реНрд▓реАрди рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рд╡реЗ рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рдЪрд░ рдХреЗ рдЕрдВрддрд░ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдкрдврд╝ рд╕рдХрддреЗ рд╣реИрдВ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдпрд╣рд╛рдВ</a> ред <br><br><img src="https://habrastorage.org/webt/2p/df/j4/2pdfj4sxnjja1ztiikvrkzrdniw.jpeg"><br><br><br><pre> <code class="pgsql hljs"><span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> boxes(thebox, <span class="hljs-type"><span class="hljs-type">name</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> box( <span class="hljs-type"><span class="hljs-type">point</span></span>( random()-random(), random()-random() ), <span class="hljs-type"><span class="hljs-type">point</span></span>( random()-random(), random()-random() ) ), <span class="hljs-string"><span class="hljs-string">'box no.'</span></span> || x <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> generate_series(<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">3000000</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> g(x);</code> </pre> <br><br>  рддрд╛рд▓рд┐рдХрд╛ рдХрд╛ рдЖрдХрд╛рд░ рдЬреЛ рджрд┐рдЦрд╛рддрд╛ рд╣реИ рдХрд┐ <code>\dt+</code> 242MB рд╣реИред  рдЕрдм рдЖрдк рдЦреЛрдЬ рд╢реБрд░реВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред <br><br>  рд╣рдо рдПрдХ рд╕реВрдЪрдХрд╛рдВрдХ рдХреЗ рдмрд┐рдирд╛ рджреЗрдЦ рд░рд╣реЗ рд╣реИрдВ: <br><br><br><pre> <code class="pgsql hljs"><span class="hljs-keyword"><span class="hljs-keyword">EXPLAIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ANALYZE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> thebox, <span class="hljs-type"><span class="hljs-type">name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> boxes <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> thebox @&gt; box(<span class="hljs-string"><span class="hljs-string">'0.5, 0.4'</span></span>,<span class="hljs-string"><span class="hljs-string">'0.3, 0.2'</span></span>); QUERY PLAN <span class="hljs-comment"><span class="hljs-comment">-------------------------------------------------------------------------------------- Gather (cost=1000.00..47853.00 rows=3000 width=46) (actual time=0.140..246.998 rows=139189 loops=1) Workers Planned: 2 Workers Launched: 2 -&gt; Parallel Seq Scan on boxes (cost=0.00..46553.00 rows=1250 width=46) (actual time=0.011..106.708 rows=46396 loops=3) Filter: (thebox @&gt; '(0.5,0.4),(0.3,0.2)'::box) Rows Removed by Filter: 953604 Planning Time: 0.040 ms Execution Time: 259.262 ms (8 rows)</span></span></code> </pre> <br>  рд╣рдо рджреЗрдЦрддреЗ рд╣реИрдВ рдХрд┐ рдПрдХ рд╕рдорд╛рдирд╛рдВрддрд░ Seq рд╕реНрдХреИрди рд╣реИ - рдЕрдиреБрдХреНрд░рдорд┐рдХ рд╕реНрдХреИрди (рдпрджреНрдпрдкрд┐ рд╕рдорд╛рдирд╛рдВрддрд░)ред <br><br>  рдПрдХ рдирд┐рдпрдорд┐рдд, рдЧреИрд░-рд╕рдорд╛рд╡реЗрд╢реА рд╕реВрдЪрдХрд╛рдВрдХ рдмрдирд╛рдПрдБ: <br><br><pre> <code class="pgsql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> boxes <span class="hljs-keyword"><span class="hljs-keyword">USING</span></span> gist(thebox);</code> </pre> <br>  <code>boxes_thebox_idx</code> рдЗрдВрдбреЗрдХреНрд╕ рдХрд╛ рдЖрдХрд╛рд░, рдЬреЛ <code>\di+</code> , 262MB рджрд┐рдЦрд╛рддрд╛ рд╣реИред  рдЙрд╕реА рдЕрдиреБрд░реЛрдз рдХреЗ рдЬрд╡рд╛рдм рдореЗрдВ, рд╣рдо: <br><br><br><pre> <code class="pgsql hljs"><span class="hljs-keyword"><span class="hljs-keyword">EXPLAIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ANALYZE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> thebox, <span class="hljs-type"><span class="hljs-type">name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> boxes <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> thebox @&gt; box(<span class="hljs-string"><span class="hljs-string">'0.5, 0.4'</span></span>,<span class="hljs-string"><span class="hljs-string">'0.3, 0.2'</span></span>); QUERY PLAN <span class="hljs-comment"><span class="hljs-comment">-------------------------------------------------------------------------------- Bitmap Heap Scan on boxes (cost=159.66..9033.30 rows=3000 width=46) (actual time=29.101..80.283 rows=139189 loops=1) Recheck Cond: (thebox @&gt; '(0.5,0.4),(0.3,0.2)'::box) Heap Blocks: exact=30629 -&gt; Bitmap Index Scan on boxes_thebox_idx (cost=0.00..158.91 rows=3000 width=0) (actual time=25.029..25.029 rows=139189 loops=1) Index Cond: (thebox @&gt; '(0.5,0.4),(0.3,0.2)'::box) Planning Time: 0.053 ms Execution Time: 86.206 ms (7 rows)</span></span></code> </pre><br>  рдЦреЛрдЬ рдХрд╛ рд╕рдордп рддреАрди рдХреЗ рдПрдХ рдХрд╛рд░рдХ рд╕реЗ рдХрдо рд╣реЛ рдЧрдпрд╛ рдерд╛, рдФрд░ рд╕рдорд╛рдирд╛рдВрддрд░ рд╕реАрдХ рд╕реНрдХреИрди рдХреЗ рдмрдЬрд╛рдп, рдЙрдиреНрд╣реЗрдВ рдПрдХ рдмрд┐рдЯрдореИрдк рдЗрдВрдбреЗрдХреНрд╕ рд╕реНрдХреИрди рдкреНрд░рд╛рдкреНрдд рд╣реБрдЖред  рдпрд╣ рд╕рдорд╛рдирд╛рдВрддрд░ рдирд╣реАрдВ рд╣реИ, рд▓реЗрдХрд┐рди рдпрд╣ рддреЗрдЬреА рд╕реЗ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИред <br><br>  рдЕрдм рдкреБрд░рд╛рдиреЗ рд╕реВрдЪрдХрд╛рдВрдХ рдХреЛ рдорд╛рд░реЗрдВ рдФрд░ рдПрдХ рд╕рдорд╛рд╡реЗрд╢реА рдмрдирд╛рдПрдВ: <br><br><pre> <code class="pgsql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> boxes <span class="hljs-keyword"><span class="hljs-keyword">USING</span></span> spgist(thebox) <span class="hljs-keyword"><span class="hljs-keyword">INCLUDE</span></span>(<span class="hljs-type"><span class="hljs-type">name</span></span>);</code> </pre> <br>  <code>boxes_thebox_name_idx</code> рдХрд╛ <code>boxes_thebox_name_idx</code> : 356 рдПрдордмреАред  рдЖрдЗрдП рдЬрд╛рдиреЗ: <br><br><br><pre> <code class="pgsql hljs"><span class="hljs-keyword"><span class="hljs-keyword">EXPLAIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ANALYZE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> thebox, <span class="hljs-type"><span class="hljs-type">name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> boxes <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> thebox @&gt; box(<span class="hljs-string"><span class="hljs-string">'0.5, 0.4'</span></span>,<span class="hljs-string"><span class="hljs-string">'0.3, 0.2'</span></span>); QUERY PLAN <span class="hljs-comment"><span class="hljs-comment">------------------------------------------------------------------------------ Bitmap Heap Scan on boxes (cost=207.66..9081.30 rows=3000 width=46) (actual time=86.822..152.014 rows=139189 loops=1) Recheck Cond: (thebox @&gt; '(0.5,0.4),(0.3,0.2)'::box) Heap Blocks: exact=30629 -&gt; Bitmap Index Scan on boxes_thebox_name_idx (cost=0.00..206.91 rows=3000 width=0) (actual time=83.044..83.044 rows=139189 loops=1) Index Cond: (thebox @&gt; '(0.5,0.4),(0.3,0.2)'::box) Planning Time: 3.807 ms Execution Time: 157.997 ms (7 rows)</span></span></code> </pre> <br><br>  рдЗрдВрдбреЗрдХреНрд╕ рдУрдирд▓реА рд╕реНрдХреИрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рддрд╕реНрд╡реАрд░ рджреБрдЦрдж рд╣реИ: рд╕рдордп рдЗрд╕рдХреЗ рдмрд┐рдирд╛ рд▓рдЧрднрдЧ 2 рдЧреБрдирд╛ рд▓рдВрдмрд╛ рд╣реИред  рд╣рдо рд╕реВрдЪрдХрд╛рдВрдХреЛрдВ рдХреЗ рдирд┐рд░реНрдорд╛рддрд╛ рдХреА рд╣реИрдВрдбрдмреБрдХ рдХреЛ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рднрд╛рдЧ I</a> рдореЗрдВ рдкрдврд╝рддреЗ рд╣реИрдВ: <br><br>  ред рд░рдВрдЧ PostgreSQL рдЕрдиреБрдХреНрд░рдорд┐рдд рдореЗрдВ рдРрд╕реА рдЬрд╛рдирдХрд╛рд░реА рдирд╣реАрдВ рд╣реЛрддреА рд╣реИ рдЬреЛ рдЖрдкрдХреЛ рдкрдВрдХреНрддрд┐рдпреЛрдВ рдХреА рджреГрд╢реНрдпрддрд╛ рдХрд╛ рдиреНрдпрд╛рдп рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИред  рдЗрд╕рд▓рд┐рдП, рдПрдХреНрд╕реЗрд╕ рд╡рд┐рдзрд┐ рдЦреЛрдЬ рд╕реНрдерд┐рддрд┐ рдХреЗ рддрд╣рдд рдЖрдиреЗ рд╡рд╛рд▓реА рдкрдВрдХреНрддрд┐рдпреЛрдВ рдХреЗ рд╕рднреА рд╕рдВрд╕реНрдХрд░рдгреЛрдВ рдХреЛ рд▓реМрдЯрд╛ рджреЗрддреА рд╣реИ, рднрд▓реЗ рд╣реА рд╡реЗ рд╡рд░реНрддрдорд╛рди рд▓реЗрдирджреЗрди рдХреЗ рд▓рд┐рдП рджрд┐рдЦрд╛рдИ рджреЗрдВ рдпрд╛ рдирд╣реАрдВред  рд╣рд╛рд▓рд╛рдБрдХрд┐, рдпрджрд┐ рджреГрд╢реНрдпрддрд╛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдиреБрдХреНрд░рдордг рддрдВрддреНрд░ рдХреЛ рд╣рд░ рдмрд╛рд░ рддрд╛рд▓рд┐рдХрд╛ рдореЗрдВ рджреЗрдЦрдирд╛ рд╣реЛрддрд╛ рд╣реИ, рддреЛ рдпрд╣ рд╕реНрдХреИрдирд┐рдВрдЧ рд╡рд┐рдзрд┐ рд╕рд╛рдорд╛рдиреНрдп рд╕реВрдЪрдХрд╛рдВрдХ рд╕реНрдХреИрдирд┐рдВрдЧ рд╕реЗ рдЕрд▓рдЧ рдирд╣реАрдВ рд╣реЛрдЧреАред  рд╕рдорд╕реНрдпрд╛ рдЗрд╕ рддрдереНрдп рд╕реЗ рд╣рд▓ рд╣реЛрддреА рд╣реИ рдХрд┐ PostgreSQL рддрд╛рд▓рд┐рдХрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рддрдерд╛рдХрдерд┐рдд рджреГрд╢реНрдпрддрд╛ рдорд╛рдирдЪрд┐рддреНрд░ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рд╡реИрдХреНрдпреВрдо рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдЙрди рдкреГрд╖реНрдареЛрдВ рдХреЛ рдЪрд┐рд╣реНрдирд┐рдд рдХрд░рддреА рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдбреЗрдЯрд╛ рд╕рднреА рд▓реЗрди-рджреЗрди рдХреЗ рд▓рд┐рдП рд▓рдВрдмреЗ рд╕рдордп рддрдХ рдирд╣реАрдВ рдмрджрд▓рд╛ рд╣реИ, рднрд▓реЗ рд╣реА рдпрд╣ рд╢реБрд░реБрдЖрддреА рд╕рдордп рдФрд░ рдЕрд▓рдЧрд╛рд╡ рд╕реНрддрд░ рдХреА рдкрд░рд╡рд╛рд╣ рдХрд┐рдП рдмрд┐рдирд╛ рд╣реЛред  рдпрджрд┐ рд╕реВрдЪрдХрд╛рдВрдХ рджреНрд╡рд╛рд░рд╛ рджреА рдЧрдИ рдкрдВрдХреНрддрд┐ рдХреА рдкрд╣рдЪрд╛рдирдХрд░реНрддрд╛ рдРрд╕реЗ рдкреГрд╖реНрда рдХреЛ рд╕рдВрджрд░реНрднрд┐рдд рдХрд░рддрд╛ рд╣реИ, рддреЛ рджреГрд╢реНрдпрддрд╛ рдХреА рдЬрд╛рдБрдЪ рдирд╣реАрдВ рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИред&gt; <br><br>  рд╣рдо VACUUM рдХрд░рддреЗ рд╣реИрдВред  рд╣рдо рджреЛрд╣рд░рд╛рдиреЗ: <br><br><pre> <code class="pgsql hljs"><span class="hljs-keyword"><span class="hljs-keyword">EXPLAIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ANALYZE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> thebox, <span class="hljs-type"><span class="hljs-type">name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> boxes <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> thebox @&gt; box(<span class="hljs-string"><span class="hljs-string">'0.5, 0.4'</span></span>,<span class="hljs-string"><span class="hljs-string">'0.3, 0.2'</span></span>); QUERY PLAN <span class="hljs-comment"><span class="hljs-comment">-------------------------------------------------------------------------------- Index Only Scan using boxes_thebox_name_idx on boxes (cost=0.41..236.91 rows=3000 width=46) (actual time=0.104..38.651 rows=139189 loops=1) Index Cond: (thebox @&gt; '(0.5,0.4),(0.3,0.2)'::box) Heap Fetches: 0 Planning Time: 0.052 ms Execution Time: 44.337 ms (5 rows)</span></span></code> </pre> <br>  рдПрдХ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдЕрд▓рдЧ рдорд╛рдорд▓рд╛!  рдЧреИрд░-рд╕рдорд╛рд╡реЗрд╢реА рд╕реВрдЪрдХрд╛рдВрдХ рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рджреЛ рдмрд╛рд░ рд▓рд╛рднред <br><br><br><h3>  рдЪрдпрдирд╛рддреНрдордХрддрд╛ рдФрд░ рд▓рд╛рдн </h3><br>  рд╕рдорд╛рд╡реЗрд╢реА рд╕реВрдЪрдХрд╛рдВрдХ рдХрд╛ рдкреНрд░рджрд░реНрд╢рди рдкреНрд░рд╢реНрдиреЛрдВ рдореЗрдВ рдкрд░рд┐рд╕реНрдерд┐рддрд┐рдпреЛрдВ рдХреА рдЪрдпрдирд╛рддреНрдордХрддрд╛ рдкрд░ рдЕрддреНрдпрдзрд┐рдХ рдирд┐рд░реНрднрд░ рд╣реИред  рдЗрд╕ рдирд┐рд░реНрднрд░рддрд╛ рдХреЛ рдереЛрдбрд╝рд╛ рдЬрд╛рдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рд╡реНрдпреБрддреНрдХреНрд░рдо рд╕рдорд╕реНрдпрд╛ рдХреЛ рд╣рд▓ рдХрд░реЗрдВрдЧреЗ: рд╣рдо рдПрдХ рдкреНрд░рдХрд╛рд░ рдХреЗ рд╕реВрдЪрдХрд╛рдВрдХ рдХреЗ рд╕рд╛рде рдПрдХ рд▓реЗрдмрд▓ рдЙрддреНрдкрдиреНрди рдХрд░реЗрдВрдЧреЗ рдФрд░ рд╣рдо рджреЗрдЦреЗрдВрдЧреЗ рдХрд┐ рджрд┐рдП рдЧрдП рдмреЙрдХреНрд╕ рдореЗрдВ рдХрд┐рддрдиреЗ рдЕрдВрдХ рдЧрд┐рд░реЗрдВрдЧреЗред  рд╕рдорд╛рди рд░реВрдк рд╕реЗ рдбреЙрдЯреНрд╕ рдлреИрд▓рд╛рдПрдВред <br><br><pre> <code class="pgsql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> test_covergist(id <span class="hljs-type"><span class="hljs-type">serial</span></span>, tochka <span class="hljs-type"><span class="hljs-type">point</span></span>, <span class="hljs-type"><span class="hljs-type">name</span></span> <span class="hljs-type"><span class="hljs-type">text</span></span>);</code> </pre> <br><pre> <code class="pgsql hljs"><span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> test_covergist(tochka, <span class="hljs-type"><span class="hljs-type">name</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-type"><span class="hljs-type">point</span></span>(trunc(<span class="hljs-number"><span class="hljs-number">1000000</span></span>*random()), trunc(<span class="hljs-number"><span class="hljs-number">1000000</span></span>*random())), <span class="hljs-string"><span class="hljs-string">'point no.'</span></span> || gx <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> generate_series(<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">3000000</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> g(x);</code> </pre> <br>  рддрд╛рд▓рд┐рдХрд╛ рдХрд╛ рдЖрдХрд╛рд░ 211 рдПрдордмреА рд╣реИред <br><br><pre> <code class="pgsql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> test_covergist <span class="hljs-keyword"><span class="hljs-keyword">USING</span></span> gist(tochka);</code> </pre> <br>  рдЖрдХрд╛рд░ 213 рдПрдордмреАред <br><br>  рд╣рдо рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рд╕рднреА рдЙрдкрд▓рдмреНрдз рдмрд┐рдВрджреБрдУрдВ рдХреЛ рдПрдХ рд╡рд░реНрдЧ рдореЗрдВ рд▓реЗ рдЬрд╛рдПрдВрдЧреЗ: <br><br><pre> <code class="pgsql hljs"><span class="hljs-keyword"><span class="hljs-keyword">EXPLAIN</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">ANALYZE</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">buffers</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> tochka, <span class="hljs-type"><span class="hljs-type">name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> test_covergist <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> box(<span class="hljs-string"><span class="hljs-string">'0,0'</span></span>,<span class="hljs-string"><span class="hljs-string">'3000000,3000000'</span></span>) @&gt; tochka; QUERY PLAN <span class="hljs-comment"><span class="hljs-comment">------------------------------------------------------------------------------------- Bitmap Heap Scan on test_covergist (cost=135.66..8778.83 rows=3000 width=32) (actual time=1087.964..1864.059 rows=3000000 loops=1) Recheck Cond: ('(3000000,3000000),(0,0)'::box @&gt; tochka) Heap Blocks: exact=27025 Buffers: shared read=54287 -&gt; Bitmap Index Scan on test_covergist_tochka_idx (cost=0.00..134.91 rows=3000 width=0) (actual time=1084.949..1084.949 rows=3000000 loops=1) Index Cond: (tochka &lt;@ '(3000000,3000000),(0,0)'::box) Buffers: shared read=27262 Planning Time: 0.102 ms Execution Time: 2029.501 ms (9 rows)</span></span></code> </pre> <br>  рд╣рдордиреЗ EXPLAIN рдХреЛ рдмрдлрд╝рд░реНрд╕ рджрд┐рдЦрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд╣рд╛ред  рдпрд╣ рдХрд╛рдо рдЖрдПрдЧрд╛ред  рдЕрдм рдЕрдиреБрд░реЛрдз рдирд┐рд╖реНрдкрд╛рджрди рдХрд╛ рд╕рдордп 2 рд╕реЗрдХрдВрдб рд╕реЗ рдЕрдзрд┐рдХ рд╣реИ, рдпрд╣ рджреЗрдЦрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдХрд┐ рдмрдлрд░: рд╕рд╛рдЭрд╛ рдкрдврд╝рд╛ = 54287ред  рдПрдХ рдЕрдиреНрдп рд╕реНрдерд┐рддрд┐ рдореЗрдВ, рд╣рдо рд╕рд╛рдЭрд╛ рд░реАрдб рдФрд░ рд╢реЗрдпрд░реНрдб рд╣рд┐рдЯ рдХрд╛ рдорд┐рд╢реНрд░рдг рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ - рдЕрд░реНрдерд╛рдд, рдХреБрдЫ рдмрдлрд╝рд░реНрд╕ рдбрд┐рд╕реНрдХ (рдпрд╛ OS рдХреИрд╢ рд╕реЗ) рдФрд░ рдХреБрдЫ рдмрдлрд░ рдХреИрд╢ рд╕реЗ рдкрдврд╝реЗ рдЬрд╛рддреЗ рд╣реИрдВред  рд╣рдо рддрд╛рд▓рд┐рдХрд╛ рдФрд░ рдЕрдиреБрдХреНрд░рдорд┐рдд рдХреЗ рдЕрдиреБрдорд╛рдирд┐рдд рдЖрдХрд╛рд░ рдХреЛ рдЬрд╛рдирддреЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рд╣рдо рд╕рд╛рдЭрд╛ рдмрдлрд╝рд░реНрд╕ рд╕реЗрдЯ рдХрд░рдХреЗ рдЦреБрдж рдХреА рд░рдХреНрд╖рд╛ рдХрд░реЗрдВрдЧреЗ рддрд╛рдХрд┐ рд╕рдм рдХреБрдЫ рдлрд┐рдЯ рд╣реЛ рдЬрд╛рдП - рдкреБрдирд░рд╛рд░рдВрдн рдХрд░реЗрдВ рд╡рд┐рдХрд▓реНрдк рдХреЗ рд╕рд╛рде рдкреЛрд╕реНрдЯрдЧреНрд░реЗрдЯреНрд╕ <br><br><pre> <code class="plaintext hljs">-o "-c shared_buffers=1GB"</code> </pre> <br>  рдЕрдм: <br><br><pre> <code class="pgsql hljs"><span class="hljs-keyword"><span class="hljs-keyword">EXPLAIN</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">ANALYZE</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">buffers</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> tochka, <span class="hljs-type"><span class="hljs-type">name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> test_covergist <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> box(<span class="hljs-string"><span class="hljs-string">'0,0'</span></span>,<span class="hljs-string"><span class="hljs-string">'3000000,3000000'</span></span>) @&gt; tochka; QUERY PLAN <span class="hljs-comment"><span class="hljs-comment">------------------------------------------------------------------------------- Bitmap Heap Scan on test_covergist (cost=135.66..8778.83 rows=3000 width=32) (actual time=231.032..613.326 rows=3000000 loops=1) Recheck Cond: ('(3000000,3000000),(0,0)'::box @&gt; tochka) Heap Blocks: exact=27025 Buffers: shared hit=54248 -&gt; Bitmap Index Scan on test_covergist_tochka_idx (cost=0.00..134.91 rows=3000 width=0) (actual time=228.068..228.068 rows=3000000 loops=1) Index Cond: (tochka &lt;@ '(3000000,3000000),(0,0)'::box) Buffers: shared hit=27223 Planning Time: 0.070 ms Execution Time: 755.915 ms (9 rows)</span></span></code> </pre> <br>  рдЕрд░реНрдерд╛рддреН, рд╕рд╛рдЭрд╛ рдкрдврд╝рд╛ рдЧрдпрд╛ рдПрдХ рд╕рд╛рдЭрд╛ рд╣рд┐рдЯ рдмрди рдЧрдпрд╛, рдФрд░ рд╕рдордп рддреАрди рдмрд╛рд░ рдХрдо рд╣реЛ рдЧрдпрд╛ред <br><br>  EXPLAIN рдореЗрдВ рдПрдХ рдФрд░ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╡рд┐рд╡рд░рдг: 3 рдорд┐рд▓рд┐рдпрди рдЕрдВрдХ рд▓реМрдЯрд╛рдП рдЧрдП рд╣реИрдВ, рдФрд░ рд░рд┐рдХреЙрд░реНрдб рдХреА рдЧрдИ рд╕рдВрдЦреНрдпрд╛ рдХрд╛ рдкреВрд░реНрд╡рд╛рдиреБрдорд╛рди 3 рд╣рдЬрд╛рд░ рд╣реИред Spoiler: рдпрд╣ рд╕рдВрдЦреНрдпрд╛ рдХрд┐рд╕реА рднреА рдЪрдпрдирд╛рддреНрдордХрддрд╛ рдХреЗ рд╕рд╛рде рдирд╣реАрдВ рдмрджрд▓реЗрдЧреАред  рдмреЙрдХреНрд╕ рдпрд╛ рдкреЙрдЗрдВрдЯ рдкреНрд░рдХрд╛рд░реЛрдВ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдиреЗ рдкрд░ рдЖрд╢рд╛рд╡рд╛рджреА рдХреЛ рдХрд╛рд░реНрдбрд┐рдирд┐рдЯреА рдХрд╛ рдореВрд▓реНрдпрд╛рдВрдХрди рдХрд░рдиреЗ рдХрд╛ рддрд░реАрдХрд╛ рдирд╣реАрдВ рдкрддрд╛ рд╣реИред  рдФрд░ рдпреЛрдЬрдирд╛ рдирд╣реАрдВ рдмрджрд▓реЗрдЧреА: рдЖрдпрдд рдХреЗ рдХрд┐рд╕реА рднреА рдЖрдХрд╛рд░ рдХреЗ рд▓рд┐рдП, test_covergist_tochka_idx рдкрд░ рдПрдХ рдмрд┐рдЯрдореИрдк рдЗрдВрдбреЗрдХреНрд╕ рд╕реНрдХреИрди рд╣реЛрдЧрд╛ред <br><br>  рдЬрд╛рд░реА рдХрд┐рдП рдЧрдП рд░рд┐рдХреЙрд░реНрдб рдХреА рд╕рдВрдЦреНрдпрд╛ рдХреЗ рд╕рд╛рде рдпрд╣рд╛рдВ рджреЛ рдФрд░ рдорд╛рдк рджрд┐рдП рдЧрдП рд╣реИрдВ, рдкрд░рд┐рдорд╛рдг рдХреЗ рдЖрджреЗрд╢реЛрдВ рдХреЗ рдЕрдиреБрд╕рд╛рд░ рднрд┐рдиреНрди: <br><br><pre> <code class="pgsql hljs"><span class="hljs-keyword"><span class="hljs-keyword">EXPLAIN</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">ANALYZE</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">buffers</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> tochka, <span class="hljs-type"><span class="hljs-type">name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> test_covergist <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> box(<span class="hljs-string"><span class="hljs-string">'0,0'</span></span>,<span class="hljs-string"><span class="hljs-string">'300000,300000'</span></span>) @&gt; tochka; QUERY PLAN <span class="hljs-comment"><span class="hljs-comment">--------------------------------------------------------------------------------------- Bitmap Heap Scan on test_covergist (cost=135.66..8778.83 rows=3000 width=32) (actual time=27.889..134.054 rows=269882 loops=1) Recheck Cond: ('(300000,300000),(0,0)'::box @&gt; tochka) Heap Blocks: exact=27024 Buffers: shared hit=29534 -&gt; Bitmap Index Scan on test_covergist_tochka_idx (cost=0.00..134.91 rows=3000 width=0) (actual time=24.847..24.847 rows=269882 loops=1) Index Cond: (tochka &lt;@ '(300000,300000),(0,0)'::box) Buffers: shared hit=2510 Planning Time: 0.074 ms Execution Time: 151.269 ms (9 rows)</span></span></code> </pre> <br>  рдпрд╣ 10-рд╡рд┐рд╖рдо рдмрд╛рд░ рдХрдо рд░рд┐рдХреЙрд░реНрдб (рд╡рд╛рд╕реНрддрд╡рд┐рдХ ... рдкрдВрдХреНрддрд┐рдпрд╛рдБ = 269882) рджреЗрддрд╛ рд╣реИ, рд╕рдордп рд▓рдЧрднрдЧ 5 рдЧреБрдирд╛ рдХрдо рд╣реЛ рдЧрдпрд╛ рд╣реИред <br><br><pre> <code class="pgsql hljs"><span class="hljs-keyword"><span class="hljs-keyword">EXPLAIN</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">ANALYZE</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">buffers</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> tochka, <span class="hljs-type"><span class="hljs-type">name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> test_covergist <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> box(<span class="hljs-string"><span class="hljs-string">'0,0'</span></span>,<span class="hljs-string"><span class="hljs-string">'30000,30000'</span></span>) @&gt; tochka; QUERY PLAN <span class="hljs-comment"><span class="hljs-comment">---------------------------------------------------------------------------------------------- Bitmap Heap Scan on test_covergist (cost=135.66..8778.83 rows=3000 width=32) (actual time=1.882..16.095 rows=2780 loops=1) Recheck Cond: ('(30000,30000),(0,0)'::box @&gt; tochka) Heap Blocks: exact=2624 Buffers: shared hit=2655 -&gt; Bitmap Index Scan on test_covergist_tochka_idx (cost=0.00..134.91 rows=3000 width=0) (actual time=1.035..1.035 rows=2780 loops=1) Index Cond: (tochka &lt;@ '(30000,30000),(0,0)'::box) Buffers: shared hit=31 Planning Time: 0.154 ms Execution Time: 16.702 ms (9 rows)</span></span></code> </pre> <br>  рдПрдХ 30K ├Ч 30K рд╡рд░реНрдЧ (2780) рдХреА рд╕рд╛рдордЧреНрд░реА рдХреЛ рдХреЗрд╡рд▓ 16 рдПрдордПрд╕ рдореЗрдВ рдЧрд┐рдирд╛ рдЬрд╛рддрд╛ рд╣реИред  рдФрд░ рдЬрдм рджрд░реНрдЬрдиреЛрдВ рд░рд┐рдХреЙрд░реНрдб рд╣реЛрддреЗ рд╣реИрдВ, рддреЛ рдЙрдиреНрд╣реЗрдВ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдПрдХ рдПрдордПрд╕ рдХреЗ рдЕрдВрд╢реЛрдВ рдореЗрдВ рдирд┐рдХрд╛рд▓рд╛ рдЬрд╛рддрд╛ рд╣реИ, рдФрд░ рдРрд╕реЗ рдорд╛рдк рдмрд╣реБрдд рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рдирд╣реАрдВ рд╣реЛрддреЗ рд╣реИрдВред <br><br>  рдЕрдВрдд рдореЗрдВ, рд╕рдорд╛рд╡реЗрд╢реА рд╕реВрдЪрдХрд╛рдВрдХ рдХреЗ рд╕рд╛рде рд╣реА рдорд╛рдкреЗрдВ: <br><br><pre> <code class="pgsql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> test_covergist <span class="hljs-keyword"><span class="hljs-keyword">USING</span></span> gist(tochka) <span class="hljs-keyword"><span class="hljs-keyword">INCLUDE</span></span>(<span class="hljs-type"><span class="hljs-type">name</span></span>);</code> </pre> <br>  рд╕рд╛рдЗрдЬ 316 рдПрдордмреАред <br><br><pre> <code class="pgsql hljs"><span class="hljs-keyword"><span class="hljs-keyword">EXPLAIN</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">ANALYZE</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">buffers</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> tochka, <span class="hljs-type"><span class="hljs-type">name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> test_covergist <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> box(<span class="hljs-string"><span class="hljs-string">'0,0'</span></span>,<span class="hljs-string"><span class="hljs-string">'3000000,3000000'</span></span>) @&gt; tochka; QUERY PLAN <span class="hljs-comment"><span class="hljs-comment">--------------------------------------------------------------------------------------- Index Only Scan using test_covergist_tochka_name_idx on test_covergist (cost=0.41..216.91 rows=3000 width=32) (actual time=0.160..568.707 rows=3000000 loops=1) Index Cond: (tochka &lt;@ '(3000000,3000000),(0,0)'::box) Heap Fetches: 0 Buffers: shared hit=40492 Planning Time: 0.090 ms Execution Time: 709.837 ms (6 rows)</span></span></code> </pre> <br>  рд╕рдордп рд▓рдЧрднрдЧ рдПрдХ рдкрд╛рд░рдВрдкрд░рд┐рдХ рд╕реВрдЪрдХрд╛рдВрдХ рдХреЗ рд╕рд╛рде рд╣реА рд╣реИ, рд╣рд╛рд▓рд╛рдВрдХрд┐ рд╕реВрдЪрдХрд╛рдВрдХ рдХреЗрд╡рд▓ рд╕реНрдХреИрдиред <br><br>  рд▓реЗрдХрд┐рди: <br><br><pre> <code class="pgsql hljs"><span class="hljs-keyword"><span class="hljs-keyword">EXPLAIN</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">ANALYZE</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">buffers</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> tochka, <span class="hljs-type"><span class="hljs-type">name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> test_covergist <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> box(<span class="hljs-string"><span class="hljs-string">'0,0'</span></span>,<span class="hljs-string"><span class="hljs-string">'300000,300000'</span></span>) @&gt; tochka; QUERY PLAN <span class="hljs-comment"><span class="hljs-comment">-------------------------------------------------------------------------------------------- Index Only Scan using test_covergist_tochka_name_idx on test_covergist (cost=0.41..216.91 rows=3000 width=32) (actual time=0.083..53.277 rows=269882 loops=1) Index Cond: (tochka &lt;@ '(300000,300000),(0,0)'::box) Heap Fetches: 0 Buffers: shared hit=3735 Planning Time: 0.077 ms Execution Time: 66.162 ms (6 rows)</span></span></code> </pre> <br>  рдФрд░ рдпрд╣ 151 рдорд┐ред  рдФрд░, рддрджрдиреБрд╕рд╛рд░: <br><br><pre> <code class="pgsql hljs"><span class="hljs-keyword"><span class="hljs-keyword">EXPLAIN</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">ANALYZE</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">buffers</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> tochka, <span class="hljs-type"><span class="hljs-type">name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> test_covergist <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> box(<span class="hljs-string"><span class="hljs-string">'0,0'</span></span>,<span class="hljs-string"><span class="hljs-string">'300000,300000'</span></span>) @&gt; tochka; QUERY PLAN <span class="hljs-comment"><span class="hljs-comment">-------------------------------------------------------------------------------------------- Index Only Scan using test_covergist_tochka_name_idx on test_covergist (cost=0.41..216.91 rows=3000 width=32) (actual time=0.043..0.639 rows=2780 loops=1) Index Cond: (tochka &lt;@ '(30000,30000),(0,0)'::box) Heap Fetches: 0 Buffers: shared hit=52 Planning Time: 0.053 ms Execution Time: 0.791 ms (6 rows)</span></span></code> </pre><br>  рдпрд╣ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА 2780 рдмрд┐рдВрджреБ рд░рд┐рдХреЙрд░реНрдб рдХреЗ рд▓рд┐рдП рдПрдордПрд╕ рдХрд╛ рдПрдХ рдЕрдВрд╢ рд╣реИред <br><br><h3>  рдмрдлрд╝рд░реНрд╕ рдХреЛ рдмрдВрджреВрдХреЗрдВ рдкрд╕рдВрдж рд╣реИрдВ </h3><br>  рдПрдХ рд╕реНрдкрд╖реНрдЯреАрдХрд░рдг рдорд╛рдВрдЧрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдПрдХ рд╢реЙрдЯрдЧрди рдореЗрдВ рдкрд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдЬрд┐рд╕рдиреЗ рдЕрднреА рддрдХ рдЧреЛрд▓реА рдирд╣реАрдВ рд▓реА рд╣реИ рд▓реЗрдХрд┐рди рд╡рд╣ рджреАрд╡рд╛рд░ рдкрд░ рд▓рдЯрдХрд╛ рд╣реБрдЖ рдерд╛: рдмреНрд▓реЙрдХ рдХреА рд╕рдВрдЦреНрдпрд╛ рдкрдврд╝реА рдЧрдИред  рдПрдХ рд╕рдорд╛рд╡реЗрд╢реА рд╕реВрдЪрдХрд╛рдВрдХ рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ, рд╕реВрдЪрдХрд╛рдВрдХ рдХреЗ рдХреЗрд╡рд▓ рдмреНрд▓реЙрдХреЛрдВ рдХреЛ рд╣реА рдкрдврд╝рд╛ рдЬрд╛рддрд╛ рд╣реИ (рд╣реАрдк рдлреЗрдЯреЗрдХ: 0)ред  рддреАрди рдорд╛рдорд▓реЛрдВ рдореЗрдВ, рдпреЗ рд╕рдВрдЦреНрдпрд╛ 40492, 3735 рдФрд░ 52 рдереАред рд▓реЗрдХрд┐рди рдирд┐рдпрдорд┐рдд рд╕реВрдЪрдХрд╛рдВрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╕рдордп, рдмреНрд▓реЙрдХ рдмрд┐рдЯрдореИрдк рд╣реАрдк рд╕реНрдХреИрди рдЗрдВрдбреЗрдХреНрд╕ (54248 рдореЗрдВ 3 рдорд┐рд▓рд┐рдпрди рд░рд┐рдХреЙрд░реНрдб) рдХреЗ рд╕рд╛рде рдкрдврд╝реЗ рдЧрдП рдмрд┐рдЯреНрд╕ рдХреЗ рдпреЛрдЧ рдХреЛ рдкрдврд╝рддреЗ рд╣реИрдВ рдФрд░ рдЬрд┐рдиреНрд╣реЗрдВ рдвреЗрд░ рд╕реЗ рдкрдврд╝рдирд╛ рдкрдбрд╝рддрд╛ рдерд╛ (27223) , рдХреНрдпреЛрдВрдХрд┐ рдирд╛рдо рдХреНрд╖реЗрддреНрд░ рдХреЛ рдПрдХ рдирд┐рдпрдорд┐рдд рд╕реВрдЪрдХрд╛рдВрдХ рд╕реЗ рдирд╣реАрдВ рдирд┐рдХрд╛рд▓рд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред  54248 + 27223 = 81471ред  рдЕрдирдиреНрдп 40492 рдерд╛ред рджреЛ рдЕрдиреНрдп рдорд╛рдорд▓реЛрдВ рдХреЗ рд▓рд┐рдП: 29534 + 2510 = 31044 рдФрд░ 2655 + 31 = 2686ред  рдПрдХ рдирд┐рдпрдорд┐рдд рд╕реВрдЪрдХрд╛рдВрдХ рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ, рд╡реИрд╕реЗ рднреА рдЕрдзрд┐рдХ рдмреНрд▓реЙрдХ рдкрдврд╝реЗ рдЬрд╛рддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдЪрдпрдирд╛рддреНрдордХрддрд╛ рдореЗрдВ рд╕реБрдзрд╛рд░ рдХреЗ рд╕рд╛рде, рд░реАрдб рдмреНрд▓реЙрдХ рдХреА рд╕рдВрдЦреНрдпрд╛ 2 рдЧреБрдирд╛ рдХреЗ рдмрдЬрд╛рдп рдкрд░рд┐рдорд╛рдг рдХреЗ рдЖрджреЗрд╢реЛрдВ рд╕реЗ рднрд┐рдиреНрди рд╣реЛрдиреЗ рд▓рдЧрддреА рд╣реИ рдЗрд╕ рддрдереНрдп рдХреЗ рдХрд╛рд░рдг рдХрд┐ рдвреЗрд░ рдмреНрд▓реЙрдХ рд╕реЗ рдЖрд╡рд╢реНрдпрдХ рдмреНрд▓реЙрдХ рдХреА рд╕рдВрдЦреНрдпрд╛ рдЗрдВрдбреЗрдХреНрд╕ рдмреНрд▓реЙрдХ рдХреЛ рдкрдврд╝рдиреЗ рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рдзреАрд░реЗ-рдзреАрд░реЗ рдХрдо рд╣реЛ рдЬрд╛рддреА рд╣реИред <br><br><div class="scrollable-table"><table><tbody><tr><td>  <b>рдХреБрд▓ рд░рд┐рдХреЙрд░реНрдб рд╡рд╛рдкрд╕</b> (рд╣рдЬрд╛рд░) </td><td>  <b>3000</b> </td><td>  <b>270</b> </td><td>  <b>2.7</b> </td></tr><tr><td>  <b>рдмреНрд▓реЙрдХ рдкрдврд╝реЗрдВ</b> (рд╕рд╛рдорд╛рдиреНрдп / рд╕рдорд╛рд╡реЗрд╢реА) </td><td>  81471/40492 </td><td>  31044/3735 </td><td>  2686/52 </td></tr><tr><td>  <b>рд╕рдордп</b> </td><td>  755/710 </td><td>  151/66 </td><td>  16 / 0.7 </td></tr></tbody></table></div><br><br>  рд▓реЗрдХрд┐рди рд╢рд╛рдпрдж рдмрд┐рдВрджреБ рдЪрдпрдирд╛рддреНрдордХрддрд╛ рдирд╣реАрдВ рд╣реИ, рд▓реЗрдХрд┐рди рдХреЗрд╡рд▓ рддрд╛рд▓рд┐рдХрд╛ рдХрд╛ рдЖрдХрд╛рд░?  рдмрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рд╣рдо рдЙрд╕реА рдЪрд░рдгреЛрдВ рдХреЛ рджреЛрд╣рд░рд╛рддреЗ рд╣реИрдВ, рдЬрд┐рд╕рдореЗрдВ 300 рд╣рдЬрд╝рд╛рд░ рдХреЗ рд╕рд╛рде рдПрдХ рддрд╛рд▓рд┐рдХрд╛ рд╣реЛрддреА рд╣реИ, рдФрд░ 3 рдорд┐рд▓рд┐рдпрди рд░рд┐рдХреЙрд░реНрдб рдирд╣реАрдВ: <br><br><pre> <code class="pgsql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> test_covergist_small(id <span class="hljs-type"><span class="hljs-type">serial</span></span>, tochka <span class="hljs-type"><span class="hljs-type">point</span></span>, <span class="hljs-type"><span class="hljs-type">name</span></span> <span class="hljs-type"><span class="hljs-type">text</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> test_covergist_small(tochka, <span class="hljs-type"><span class="hljs-type">name</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-type"><span class="hljs-type">point</span></span>(trunc(<span class="hljs-number"><span class="hljs-number">1000000</span></span>*random()), trunc(<span class="hljs-number"><span class="hljs-number">1000000</span></span>*random())), <span class="hljs-string"><span class="hljs-string">'point no.'</span></span> || gx <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> generate_series(<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">300000</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> g(x); <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> test_covergist_small <span class="hljs-keyword"><span class="hljs-keyword">USING</span></span> gist(tochka); <span class="hljs-keyword"><span class="hljs-keyword">EXPLAIN</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">ANALYZE</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">buffers</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> tochka, <span class="hljs-type"><span class="hljs-type">name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> test_covergist_small <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> box(<span class="hljs-string"><span class="hljs-string">'0,0'</span></span>,<span class="hljs-string"><span class="hljs-string">'3000000,3000000'</span></span>) @&gt; tochka; QUERY PLAN <span class="hljs-comment"><span class="hljs-comment">---------------------------------------------------------------------------- Bitmap Heap Scan on test_covergist_small (cost=14.61..867.19 rows=300 width=31) (actual time=36.115..130.435 rows=300000 loops=1) Recheck Cond: ('(3000000,3000000),(0,0)'::box @&gt; tochka) Heap Blocks: exact=2500 Buffers: shared hit=5225 -&gt; Bitmap Index Scan on test_covergist_small_tochka_idx (cost=0.00..14.53 rows=300 width=0) (actual time=35.894..35.895 rows=300000 loops=1) Index Cond: (tochka &lt;@ '(3000000,3000000),(0,0)'::box) Buffers: shared hit=2725 Planning Time: 0.060 ms Execution Time: 158.580 (9 rows)</span></span></code> </pre><br>  рдЕрдЧрд▓рд╛, рд╕рдорд╛рд╡реЗрд╢реА рд╕реВрдЪрдХрд╛рдВрдХ рдХреЗ рд▓рд┐рдП рд╕рдорд╛рди рджреЛрд╣рд░рд╛рдПрдВред  рдпрд╣рд╛рдБ рдкрд░рд┐рдгрд╛рдо рд╣реИрдВ: <br><br><div class="scrollable-table"><table><tbody><tr><td>  <b>рдХреБрд▓ рд░рд┐рдХреЙрд░реНрдб рд╡рд╛рдкрд╕</b> (рд╣рдЬрд╛рд░) </td><td>  <b>300</b> </td><td>  <b>27</b> </td><td>  <b>0.25</b> </td></tr><tr><td>  <b>рдмреНрд▓реЙрдХ рдкрдврд╝реЗрдВ</b> (рд╕рд╛рдорд╛рдиреНрдп / рд╕рдорд╛рд╡реЗрд╢реА) </td><td>  5225/3726 </td><td>  3026/352 </td><td>  270/8 </td></tr><tr><td>  <b>рд╕рдордп</b> </td><td>  158/178 </td><td>  20/13 </td><td>  0.4 / 0.2 </td></tr></tbody></table></div><br><br>  рдЕрдВрдХреЛрдВ рдХреЗ 100% рдХрд╡рд░реЗрдЬ рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ, рдХреНрд╡реЗрд░реА рд╕рд╛рдорд╛рдиреНрдп рд╕реВрдЪрдХрд╛рдВрдХ рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рдереЛрдбрд╝реА рдзреАрдореА рдереАред  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, 3 рдорд┐рд▓рд┐рдпрди рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ, рд╕рдм рдХреБрдЫ рдЬрдЧрд╣ рдореЗрдВ рдЧрд┐рд░ рдЧрдпрд╛ред  рдпрд╣реА рд╣реИ, рдЪрдпрдирд╛рддреНрдордХрддрд╛ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИред <br><br>  рдореЙрд╕реНрдХреЛ рдХреЗ рдирдХреНрд╢реЗ рдкрд░ рдХрдИ рдорд┐рд▓рд┐рдпрди рдЖрдпрддреЛрдВ рдХреЗ рд╕рд╛рде рдПрдХ рд╕реЗрдЯ - рд╣рдорд╛рд░реА рдХрдВрдкрдиреА рдиреЗ рд╡рд╛рд╕реНрддрд╡рд┐рдХ рдбреЗрдЯрд╛ рдкрд░ рд╕рдорд╛рд╡реЗрд╢реА рдЬреАрдПрд╕рдЯреА рд╕реВрдЪрдХрд╛рдВрдХреЛрдВ рдХрд╛ рдкрд░реАрдХреНрд╖рдг рдХрд┐рдпрд╛ред  рдирд┐рд╖реНрдХрд░реНрд╖ рд╕рдорд╛рди рд╣реИ: рдХрдИ рд╕реНрдерд┐рддрд┐рдпреЛрдВ рдореЗрдВ, рдЗрд╕ рддрд░рд╣ рдХреЗ рд╕реВрдЪрдХрд╛рдВрдХ рдкреНрд░рд╢реНрдиреЛрдВ рдХреЛ рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рдЧрддрд┐ рджреЗрддреЗ рд╣реИрдВред  рд▓реЗрдХрд┐рди рд▓реЗрдЦ рдХреЛ рдЪрд┐рддреНрд░реЛрдВ рдФрд░ рдкрд░реАрдХреНрд╖рдгреЛрдВ рдХреА рд╕рдВрдЦреНрдпрд╛ рдХреЗ рд╕рд╛рде рдЪрд┐рддреНрд░рд┐рдд рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ: рдпрд╣ рдбреЗрдЯрд╛ рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдбреЛрдореЗрди рдореЗрдВ рдирд╣реАрдВ рд╣реИред <br><br><h3>  рдПрдХ рдирд┐рд╖реНрдХрд░реНрд╖ рдХреЗ рдмрдЬрд╛рдп </h3><br>  рдЖрдЗрдП рдПрдХ рдкрд▓ рдХреЗ рд▓рд┐рдП рдмреЗрддрд░рддреАрдм рдЖрдпрддреЛрдВ рдкрд░ рд▓реМрдЯрддреЗ рд╣реИрдВред  рдЖрдЗрдП рд╕реНрдкрд┐рдЧрд┐рд╕реНрдЯ рдХреЗ рд╕рд╛рде рднреА рдРрд╕рд╛ рд╣реА рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдВред  рдЖрдк <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">PostgreSQL - 6 рдореЗрдВ</a> рд▓реЗрдЦ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЗрдВрдбреЗрдХреНрд╕</a> рдкрдврд╝рдХрд░ рдПрд╕рдкреА-рдЬреАрдПрд╕рдЯреА рдФрд░ рдЬреАрдПрд╕рдЯреА рдХреЗ рдмреАрдЪ рдХреЗ рдЕрдВрддрд░ рдХреЛ рд╕рдордЭ рд╕рдХрддреЗ рд╣реИрдВ рдпрд╛ рдпрд╛рдж рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рдПрдХ рд╕рдорд╛рд╡реЗрд╢реА рд╕реВрдЪрдХрд╛рдВрдХ рдмрдирд╛рдПрдБ: <br><br><pre> <code class="pgsql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> boxes <span class="hljs-keyword"><span class="hljs-keyword">USING</span></span> spgist(thebox) <span class="hljs-keyword"><span class="hljs-keyword">INCLUDE</span></span>(<span class="hljs-type"><span class="hljs-type">name</span></span>); ERROR: <span class="hljs-keyword"><span class="hljs-keyword">access</span></span> <span class="hljs-keyword"><span class="hljs-keyword">method</span></span> "spgist" does <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> support included <span class="hljs-keyword"><span class="hljs-keyword">columns</span></span></code> </pre> <br>  рдХрд╛рд╢, SP-GiST рдХреЗ рд▓рд┐рдП, рд╕рдорд╛рд╡реЗрд╢реА рд╕реВрдЪрдХрд╛рдВрдХ рдЕрднреА рддрдХ рд▓рд╛рдЧреВ рдирд╣реАрдВ рдХрд┐рдП рдЧрдП рд╣реИрдВред <br>  рддреЛ рд╕реБрдзрд╛рд░ рдХреА рдЧреБрдВрдЬрд╛рдЗрд╢ рд╣реИ! <br><br><br><br></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi474166/">https://habr.com/ru/post/hi474166/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi474144/index.html">рд╕реНрдЯрд╛рд░реНрдЯрдЕрдк рдХреИрд╕реЗ рдмрдирд╛рдПрдВ: рдЖрдЗрдУрдЯреА рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдЖрдЗрдбрд┐рдпрд╛ рд╕реЗ рд▓реЗрдХрд░ рдкреНрд░реЛрдбрдХреНрд╢рди рддрдХ</a></li>
<li><a href="../hi474146/index.html">рдмреИрдХрдЕрдк рдЧрддрд┐ рдФрд░ Zextras рдмреИрдХрдЕрдк рдХреЗ рдирдП рд╕рдВрд╕реНрдХрд░рдг рдореЗрдВ рд╕рдВрдкреАрдбрд╝рди рдЕрдиреБрдкрд╛рдд рдЪреБрдирдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рдореЗрдВ рд╡реГрджреНрдзрд┐ рд╣реБрдИ рд╣реИ</a></li>
<li><a href="../hi474150/index.html">рдПрдХ рдордирдорд╛рдирд╛ рд░реЗрдЦреАрдп рдкреНрд░рдгрд╛рд▓реА рдХреЗ рд▓рд┐рдП рдЕрд╕рддрдд рдХрд▓рдорди рдлрд╝рд┐рд▓реНрдЯрд░ рдХреЗ рдПрдХ рдЧрддрд┐рд╢реАрд▓ рдкреНрд░рдгрд╛рд▓реА рдХреЗ рдПрдХ рдореЙрдбрд▓ рдХреА рд╡реНрдпреБрддреНрдкрддреНрддрд┐</a></li>
<li><a href="../hi474154/index.html">рд╡рд┐рдЯреЗрдХреНрдЯреЛрдореА - рд╣рдо рдЖрдВрдЦ рдХреА рдЧреБрд╣рд╛ рд╕реЗ рдмрдВрдзреЗ рд╣реБрдП рджреБрдирд┐рдпрд╛ рдХреЗ рдЦреБрд▓реЗ рд╕реНрдерд╛рдиреЛрдВ рдХреЛ рд╣рд▓ рдХрд░рддреЗ рд╣реИрдВ</a></li>
<li><a href="../hi474164/index.html">рдЬреЛрдмрд░рд╛ рд╣рдорд╛рд░рд╛ рд╕рдм рдХреБрдЫ рд╣реИ</a></li>
<li><a href="../hi474170/index.html">рдбрд┐рдЬрд╛рдЗрди рд╕реНрд╡реАрдХрд╛рд░реЛрдХреНрддрд┐ - 15 рдирд╡рдВрдмрд░, рдореЙрд╕реНрдХреЛ, рдбреАрдЖрдИ рдЯреЗрд▓реАрдЧреНрд░рд╛рдл</a></li>
<li><a href="../hi474172/index.html">рдХреБрдХреАрдЬрд╝ рдХреЗ рдЕрд╡реИрдз рдЙрдкрдпреЛрдЧ рдХреЗ рд▓рд┐рдП 30 рд╣рдЬрд╛рд░ рдпреВрд░реЛ рдХрд╛ рдЬреБрд░реНрдорд╛рдирд╛</a></li>
<li><a href="../hi474176/index.html">рдХреИрд▓рд┐рдирд┐рдирдЧреНрд░рд╛рдж рдореЗрдВ DevFest 2019 рдХреЗ рдкрд╣рд▓реЗ рджрд┐рди рд╕реЗ 11 рд╡реАрдбрд┐рдпреЛ</a></li>
<li><a href="../hi474178/index.html">рд╡реЗрдмрд╣реБрдХ рдкрд░ рдЖрдИрд╡реАрдЖрд░</a></li>
<li><a href="../hi474180/index.html">Mail.ru Cloud Solutions рдХреЗ рдкреНрд▓реЗрдЯрдлрд╝реЙрд░реНрдо рдореЗрдВ рджреЛрд╖-рд╕рд╣рд┐рд╖реНрдгреБ рд╡реЗрдм рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░ рдХреИрд╕реЗ рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>