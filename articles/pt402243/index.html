<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚õîÔ∏è üïµüèΩ üåô Ionistores de micro-UPS ü•â üòõ üç≥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bom dia a toda comunidade respeitada. Tenho a honra de oferecer aos hubrovites interessados ‚Äã‚Äãem eletr√¥nica de r√°dio algumas considera√ß√µes e uma imple...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Ionistores de micro-UPS</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/402243/">  Bom dia a toda comunidade respeitada.  Tenho a honra de oferecer aos hubrovites interessados ‚Äã‚Äãem eletr√¥nica de r√°dio algumas considera√ß√µes e uma implementa√ß√£o espec√≠fica da fonte de alimenta√ß√£o de backup em ionistores (eles s√£o supercapacitores com dupla camada el√©trica), projetados para garantir a conclus√£o correta do m√≥dulo do processador em um microcontrolador ARM em execu√ß√£o no Linux Debian padr√£o. <br><a name="habracut"></a><br>  O problema surgiu na frente do seu humilde servidor, da seguinte forma: voc√™ precisa extinguir corretamente o sistema operacional Linux (executando na solu√ß√£o incorporada) quando a energia externa estiver desligada.  Essa energia foi fornecida a partir de uma porta USB 2.0 padr√£o para um dispositivo de caixa fabricado anteriormente atrav√©s de pelo menos um conector USB-B padr√£o.  O usu√°rio inexperiente deste dispositivo preferiu retirar o cabo USB, seguindo o princ√≠pio de "UnPlug-NoPlay-NoProblem".  √â claro que uma solu√ß√£o incorporada sem discos r√≠gidos e com mem√≥ria virtual zerada durante a configura√ß√£o √© resistente a essa for√ßa maior, mas algumas milhares de horas de opera√ß√£o do usu√°rio mostraram que nem sempre funciona ‚Äúsem problemas‚Äù. <br><br>  Eu tive que enrugar meu c√©rebro e entrar em um transe criativo.  Ao sair do transe, a primeira maneira poss√≠vel de resolver o problema se materializou - a psicol√≥gica, que a princ√≠pio parecia a mais atraente.  A linha de pensamento foi aproximadamente a seguinte - por que o usu√°rio comum puxa um peda√ßo de pau na porta USB com uma m√£o inabal√°vel?  Provavelmente porque nem ele nem seus conhecidos mais pr√≥ximos perderam desta maneira sua tese, disserta√ß√£o ou relat√≥rio anual.  Por que o mesmo usu√°rio n√£o puxou um cabo de impressora de uma impressora em funcionamento nos dias da ona?  Provavelmente porque ele viu, ou ouviu dos l√°bios de algu√©m, como ele teve que comprar um novo MB ou Centronics no ISA (PCI).  N√£o quero (da palavra em geral) que minha caixa tenha sido retirada sem a menor cerim√¥nia.  O que precisa ser feito para isso?  Correto, forme o comportamento do usu√°rio necess√°rio. <br><br>  Eu tive que mudar as habilidades de circuito e rastreamento, e a pr√≥xima vers√£o da caixa recebeu um LED RGB e um bot√£o no painel frontal, al√©m de um sinal piezo com um timbre desagrad√°vel no interior.  Um programa simples determinou se o desligamento extremo passou corretamente.  Se estava incorreto e a m√° conduta do usu√°rio foi a primeira em sua mem√≥ria flash, a a√ß√£o de controle se seguiu: em vez de o indicador agradar a amarelo e verde, a caixa piscou com um olho cortante vermelho e gritou repentinamente alguns minutos antes de se acalmar e come√ßar a carregar.  A reca√≠da foi punida em cinco minutos, uma urze ainda mais vil e uma linha no manual que a caixa, bloqueada devido a desligamento incorreto repetido, √© removida da garantia aqui. <br><br>  Voc√™ sabe, o m√©todo acabou sendo surpreendentemente eficaz.  Mas aqui o Prezado Cliente apresentou um desejo de que antes de desconectar a caixa ainda informasse o servidor que estava demorando um pouco para sair da cena.  Agora alguns, mas uma fonte de energia era necess√°ria.  O c√©rebro do pr√≥ximo transe criativo voltou com o pensamento: uma bateria de pol√≠mero de l√≠tio √© o nosso tudo!  O pensamento comum acrescentou muito ceticismo a esse pensamento: eu realmente n√£o queria carregar a bateria toda vez que a ligava, porque o n√∫mero de descargas de carga √© um recurso consumido, bem como objeto de decep√ß√£o c√≠nica por fabricantes de baterias de clientes inocentes.  Carregue n√£o sempre que lig√°-lo, mas quando ele descarregar?  Portanto, √© necess√°rio cercar todo o jardim, calibrar a bateria, medir a tens√£o com boa precis√£o.  Em geral, isso e aquilo, e ent√£o o Samsung Galaxy entrou em cena com suas baterias incendi√°rias.  Imaginando um inc√™ndio no local onde a caixa deveria estar, tive que acenar voluntariamente com um sabre e parar a dolorosa delibera√ß√£o da segunda id√©ia. <br><br>  Entrando em transe pela terceira vez, um g√™nio criativo trouxe √† luz ionistores.  E o que, n√£o parece ruim.  A capacidade est√° em farads, o n√∫mero de ciclos de carga-descarga n√£o √© limitado, por assim dizer, o volt realmente n√£o √© suficiente - 2,7 no m√°ximo por c√©lula, e eles n√£o s√£o muito em cascata.  J√° n√£o havia nada para refletir sobre a falta de op√ß√µes e, novamente, tive que enfrentar o circuito junto com o tra√ßo. <br><br>  A pesquisa nas vastas extens√µes da Internet trouxe alguns problemas e, por um momento, foi decidido parar no microcircuito Linear LTC3110.  Olhando para o futuro, direi que mais algumas op√ß√µes foram testadas, mas n√£o particularmente bem-sucedidas.  Se o leitor estiver interessado nos detalhes da escolha - seja bem-vindo ao PM.  Das op√ß√µes dispon√≠veis, o LTC3110 cont√©m quase tudo o que voc√™ precisa para criar uma fonte de energia de backup em ionistores: <br>  - possui um conversor intensivo, o que torna o projetista n√£o particularmente limitado na escolha da tens√£o de alimenta√ß√£o; <br>  - este conversor utiliza indut√¢ncia para o armazenamento de energia, o que aumenta significativamente a efici√™ncia e permite dar um par de amperes √† carga; <br>  - √© poss√≠vel limitar a corrente consumida durante o carregamento na faixa de 125mA - 2A, o que √© especialmente importante quando alimentado por USB; <br>  - existe um circuito interno para balanceamento individual de ionistores conectados em s√©rie para aumentar a pot√™ncia e a confiabilidade armazenadas; <br>  - o chip est√° equipado com fios indicando o grau de carga dos ionistores; <br>  - e, para a sobremesa, h√° um comparador adicional, cujos limites s√£o definidos pelo usu√°rio. <br><br>  Para detalhes e exemplos de aplica√ß√µes, envio o curioso leitor para a folha de dados do microcircuito, o todo-poderoso Google com o feiti√ßo "LTC3110 pdf" para ajud√°-lo. <br><br>  Em teoria, para construir um Micro-UPS vi√°vel, o pr√≥prio LTC3110 precisa adicionar um circuito que forne√ßa energia √† caixa no modo normal, se houver uma conex√£o com um USB em funcionamento.  O IC ST1S10PHR foi escolhido para esse papel honroso, cuja disposi√ß√£o despretensiosa e baixo pre√ßo s√£o conhecidos e testados h√° muito tempo.  Eu tamb√©m tive que adicionar uma chave que interrompe o circuito de alimenta√ß√£o dos principais consumidores durante o carregamento inicial dos ionistores.  Essa chave permite resolver dois problemas: primeiro, o tempo de carregamento inicial √© reduzido (j√° que quase tudo consumido por USB vai para os ionistores) e, em segundo lugar, elimina a possibilidade desagrad√°vel de blecaute quando o no-break est√° t√£o sobrecarregado que o suprimento de energia ainda n√£o √© suficiente para o correto desligamento.  Al√©m disso, o ‚Äúin√≠cio alto‚Äù dos ionistores totalmente carregados permite que o circuito √†s vezes (mas n√£o com muita frequ√™ncia) consuma mais corrente do que a porta USB pode emitir - o d√©ficit ser√° reabastecido pelos ionistores.  Essa situa√ß√£o pode surgir, por exemplo, ao gravar um grande bloco de informa√ß√µes em uma ampla unidade flash USB alimentada com a caixa. <br><br>  Penso que a parte introdut√≥ria pode ser completada e seguir para um esquema de trabalho espec√≠fico. <br><br><img src="https://habrastorage.org/files/249/ae5/0b7/249ae50b7dff4c188249bbb255dc9b05.GIF" alt="imagem"><br><br>  √â assim que o circuito do micro-UPS nos ionistores se parece. <br><br>  A energia √© fornecida a partir da porta USB 2.0 (canto superior esquerdo do circuito).  No DA1, de acordo com o esquema recomendado, um conversor descendente 5V -&gt; 3,3V √© montado a partir de uma folha de dados.  Sua √∫nica caracter√≠stica √© um filtro adicional do toque de alta frequ√™ncia em L2 e C7.  Se desejado, esses elementos podem ser exclu√≠dos.  Os resistores R3 ... R5 s√£o usados ‚Äã‚Äãpara descarga de emerg√™ncia de ionistores antes do transporte, por exemplo, ou antes da montagem de toda a placa como um todo; caso contr√°rio, a fonte de energia permanece nela e √© suficientemente potente para queimar qualquer coisa.  Os resistores de descarga s√£o conectados ou desconectados pelo jumper SA1.  VT1, C16, R17 e R18 - a chave para alimentar os principais consumidores, j√° foi mencionado acima e ter√° que adicionar algumas palavras abaixo.  Tudo o resto √© o chicote padr√£o LTC3110 da folha de dados. <br><br>  3V3SBY √© a energia em espera do circuito de controle; na caixa, √© implementado no CPLD EPM240T100 da Altera, mas nada impede que ele seja executado em um microcontrolador ou l√≥gica discreta.  3V3 √© a principal fonte de alimenta√ß√£o da caixa reservada pela UPS.  As informa√ß√µes de status do micro-UPS s√£o exibidas em PWRFAIL, BATFULL e BATLOW com nomes auto-explicativos.  PWRFAIL √© ativado quando h√° uma perda de energia do USB, BATFULL indica que a carga atinge o n√≠vel de 95% (5,2V), BATLOW mostra uma diminui√ß√£o no n√≠vel de carga para 40% (2,1V).  Se desejado, esse n√≠vel pode ser ajustado selecionando R6 e R7, guiados pela folha de dados.  Infelizmente, esse truque n√£o funciona com o n√≠vel BATFULL - ele √© martelado no IC com pregos. <br><br>  O micro UPS controla dois sinais: PWRON e BATOFF.  PWRON liga a energia principal, BATOFF desliga o no-break como um todo. <br><br>  A l√≥gica geral da opera√ß√£o do micro UPS √© a seguinte: <br><br><ol><li>  no estado inicial, C8 e C9 s√£o completamente descarregados, o jumper SA1 na posi√ß√£o esquerda, a alimenta√ß√£o USB de 5V n√£o √© fornecida; </li><li>  o dispositivo est√° conectado a uma porta USB-B 2.0; </li><li>  o conversor no DA1 come√ßa a fornecer corrente para a linha 3V3SBY, energizando o circuito de controle no CPLD, que, por sua vez, abre a tecla VT1, removendo o sinal PWRON;  al√©m disso, o circuito de controle remove o sinal BATOFF, incluindo DA2; </li><li>  DA2 come√ßa a carregar os ionistores;  enquanto eles carregam, o sinal BATLOW √© desativado (a 2,1 V), e BATFULL √© ativado (a 5,2 V nos ionistores); </li><li>  a apar√™ncia do sinal BATFULL, o circuito de controle considera a prontid√£o do micro UPS para funcionar e liga o VT1, fornecendo energia ao circuito principal;  Ao mesmo tempo, o DA2 continua a monitorar os ionistores e, quando a carga cai abaixo de 95%, come√ßa a carregar;  a conex√£o do VT1 ao pino RSENS DA2 garante que essa corrente seja utilizada para recarregar e que n√£o exceda o limite USB, levando em considera√ß√£o o circuito principal consumido;  se o consumo do circuito principal exceder esse limite, a descarga de ionistores come√ßar√° a compensar despesas desnecess√°rias; </li><li>  ao desconectar o USB de 5V, a linha PWRFAIL √© ativada, informando ao dispositivo de controle que a fonte externa desapareceu;  o circuito de controle gera uma solicita√ß√£o para interromper o processador ARM para executar o script de desligamento correto;  durante todo esse tempo, a energia √© fornecida pelo DA2; </li><li>  ap√≥s a conclus√£o do procedimento de desligamento, o ARM emite um sinal de que tudo est√° pronto para a extin√ß√£o e o circuito de controle define BATOFF, desativando o DA2;  nesse estado, a caixa est√° localizada antes de a energia ser fornecida ao USB de 5V (consulte o ponto 1, exceto a carga residual em C8 e C9); </li><li>  se o ARM hesitou muito e n√£o conseguiu fechar tudo at√© o sinal BATLOW, o circuito ter√° que ser desenergizado √† for√ßa. </li></ol><br>  Se desejar, √© f√°cil organizar qualquer outra l√≥gica de controle do micro-UPS, por exemplo, aumentando o n√≠vel de habilita√ß√£o BATLOW para 60% (selecionando R6 e R7), use-o como um sinal para parar, desconectando √† for√ßa da descarga total C8 e C9. <br><br>  No final, repasse rapidamente os par√¢metros configur√°veis ‚Äã‚Äãdo circuito.  R1 e R2 determinam a tens√£o de sa√≠da de DA1, outra tens√£o pode exigir a substitui√ß√£o de C1, C2, C4-C6 e L1.  As classifica√ß√µes de C8 e C9 determinam apenas os tempos de carga e descarga do no-break, eu pessoalmente tentei de 4,7 a 100 Farads, teoricamente n√£o h√° restri√ß√µes.  R6 e R7 determinam o n√≠vel de ativa√ß√£o de BATLOW.  A tens√£o da carga m√°xima dos ionistores depende da raz√£o R8 / R9.  R11 determina a corrente consumida a partir de 5V USB, na resist√™ncia indicada, o circuito consome 0,5A.  A propor√ß√£o R12 / R14 define um n√≠vel de queda de 5V USB, que ser√° definido como falha de energia (PWRFAIL).  R15 / R16 determina a tens√£o de sa√≠da do DA2 no modo de descarga. <br><br>  Os sinais de sa√≠da do LTC3110 s√£o feitos de acordo com o esquema de "dreno aberto" para n√£o serem ligados a uma tens√£o de alimenta√ß√£o espec√≠fica.  No meu circuito, resistores pull-up para eles est√£o envolvidos no CPLD, n√£o √© um problema us√°-los em qualquer microcontrolador moderno.  Bem, se voc√™ decidir montar um circuito de controle no K155, precisar√° cuidar dos resistores. <br><br>  Algumas palavras sobre o C16.  A obten√ß√£o desse conhecimento levou mais tempo gasto na placa prot√≥tipo da UPS.  Afinal, qual √© o problema?  Na folha de dados, o preto em ingl√™s indica que se voc√™ deseja que a soma da corrente consumida pelo circuito principal e a corrente de carregamento dos ionistores n√£o excedam o limite definido por R11, por favor, ligue o circuito principal a partir da sa√≠da RSENS.  OK, concordou.  E ent√£o mais interessante.  Como o seu circuito pode ter qualquer coisa, at√© um curto-circuito (curto-circuito, √© um curto-circuito, √© curto-circuito), diz a ficha t√©cnica, o LTC3110 est√° equipado com um circuito de prote√ß√£o especial.  OK, muito legal.  E agora a parte divertida.  Lemos mais a folha de dados: e para que o esquema de prote√ß√£o n√£o se engane, forne√ßa a capacidade total da linha de energia NOT MORE, Karl, 10 microFarads.  Pateta ... Por tudo sobre tudo, e n√£o se negue nada.  De fato, qualquer carga maior que 10uF quando as cunhas conectadas ... N√£o se deixe enganar, Basurman.  Eu tive que fazer um pequeno atraso na chave no VT1, o que d√° C16.  Entendo que por algum tempo o VT1 n√£o estar√° no modo principal, mas entre o c√©u e a terra (no sentido, entre o VCC e o GND), o que n√£o √© nada bom.  Mas pelo menos funciona.  Tal √© o "novo hawa".  Para os fan√°ticos pela pureza dos modos principais, acrescentarei que tentei n√£o colocar C16, mas uma indut√¢ncia de 1,5 ŒºH em s√©rie com VT1 - tudo funciona muito bem. <br><br>  Abaixo, dou uma imagem de uma placa de circuito impresso com o circuito descrito, √© claro, a numera√ß√£o dos componentes difere da indicada no diagrama de circuito - √© transversal para toda a caixa. <br><br><img src="https://habrastorage.org/files/ca6/497/465/ca6497465973465483dabf323d12be70.jpg" alt="imagem"><br><br>  Se voc√™ tiver d√∫vidas - por favor. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt402243/">https://habr.com/ru/post/pt402243/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt402233/index.html">N√≥s fazemos overclock no roteador JTAG</a></li>
<li><a href="../pt402235/index.html">Roteiros detalhados s√£o necess√°rios para carros inteligentes, n√£o para pessoas</a></li>
<li><a href="../pt402237/index.html">Por que Intel Mobileye?</a></li>
<li><a href="../pt402239/index.html">Rede Religiosa</a></li>
<li><a href="../pt402241/index.html">PLC CONTROLLINO compat√≠vel com Arduino, parte 1</a></li>
<li><a href="../pt402245/index.html">Os preparativos para o lan√ßamento do primeiro cargueiro chin√™s chegaram √† linha de chegada</a></li>
<li><a href="../pt402247/index.html">Dicas de impress√£o da Epson</a></li>
<li><a href="../pt402249/index.html">Astell & Kern AK70 - Harvester de bolso para amantes de m√∫sica</a></li>
<li><a href="../pt402251/index.html">A primeira cidade particular na R√∫ssia. Parte 3</a></li>
<li><a href="../pt402253/index.html">O poder das redes naturais est√° em excesso de loops</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>