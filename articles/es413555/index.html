<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üôéüèæ üë®‚Äç‚ù§Ô∏è‚Äçüíã‚Äçüë® ü§∏üèΩ Interoperabilidad segura en sistemas distribuidos üéõÔ∏è üï∫üèæ üé£</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola habr 

 Mi nombre es Alexey Solodky, soy desarrollador de PHP en Badoo. Y hoy compartir√© una versi√≥n de texto de mi charla para el primer Badoo P...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Interoperabilidad segura en sistemas distribuidos</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/badoo/blog/413555/"><img src="https://habrastorage.org/webt/ag/m-/8r/agm-8r1daffwnqqhzqagmayd4uc.png" width="800"><br><br>  Hola habr <br><br>  Mi nombre es Alexey Solodky, soy desarrollador de PHP en Badoo.  Y hoy compartir√© una versi√≥n de texto de mi charla para el primer Badoo PHP Meetup.  Un video de este y otros informes del mitap se puede encontrar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> . <br><br>  Cualquier sistema que consta de al menos dos componentes (y si tiene PHP y una base de datos, entonces estos son dos componentes), enfrenta clases enteras de riesgos en la interacci√≥n entre estos componentes. <br><br>  El departamento de plataformas en el que trabajo integra nuevos servicios internos con nuestra aplicaci√≥n.  Y para resolver estos problemas, hemos acumulado experiencia, que quiero compartir. <br><br>  Nuestro backend es un monolito PHP que interact√∫a con muchos servicios (actualmente hay alrededor de 50 de ellos).  Los servicios rara vez interact√∫an entre s√≠.  Pero los problemas de los que hablo en el art√≠culo tambi√©n son relevantes para la arquitectura de microservicios.  De hecho, en este caso, los servicios interact√∫an muy activamente entre s√≠, y cuanta m√°s interacci√≥n tenga, m√°s problemas tendr√°. <br><br>  Considere qu√© hacer cuando el servicio se bloquea o no, c√≥mo organizar la recopilaci√≥n de m√©tricas y qu√© hacer cuando todo lo anterior no lo salva. <br><a name="habracut"></a><br><h2>  Servicio fallido </h2><br>  Tarde o temprano, el servidor en el que est√° instalado su servicio caer√°.  Suceder√° con seguridad, y no puedes defenderte contra eso, solo reduce la probabilidad.  Puede decepcionarse por hardware, red, c√≥digo, implementaci√≥n fallida, cualquier cosa.  Y cuantos m√°s servidores tenga, m√°s a menudo suceder√° esto. <br><br>  ¬øC√≥mo hacer que sus servicios sobrevivan en un mundo en el que los servidores se bloquean constantemente?  Un enfoque general para resolver esta clase de problemas es la redundancia. <br><br>  La redundancia se usa en todas partes en diferentes niveles: desde el hierro hasta centros de datos completos.  Por ejemplo, RAID1 para proteger contra fallas del disco duro o una fuente de alimentaci√≥n de respaldo para su servidor en caso de falla de la primera.  Adem√°s, este esquema se aplica ampliamente a las bases de datos.  Por ejemplo, puede usar master-slave para esto. <br><br>  Consideremos problemas t√≠picos de redundancia usando el esquema m√°s simple como ejemplo: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/lo/9b/rb/lo9brbsy29ca8b0i-1ygtyckncq.png" width="300"></div><br>  La aplicaci√≥n se comunica exclusivamente con el maestro, mientras que en segundo plano, de forma as√≠ncrona, los datos se transfieren al esclavo.  Cuando el maestro falla, cambiaremos al esclavo y continuaremos trabajando. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ga/lt/o5/galto5cgws3ed44dfwhnqq9zvd4.png" width="300"></div><br><br>  Despu√©s de restaurar al maestro, solo hacemos un nuevo esclavo, y el viejo se convierte en un maestro. <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/6h/c8/gc/6hc8gc6qzhzso3xscnjblfn1frm.png" width="300"></div><br>  El esquema es simple, pero incluso tiene muchos matices caracter√≠sticos de cualquier esquema redundante. <br><br><h3>  Carga </h3><br>  Digamos que un servidor del ejemplo anterior puede soportar aproximadamente 100k RPS.  Ahora la carga es de 60k RPS, y todo funciona como un reloj. <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/99/gw/j1/99gwj19rezs-ywa-hdopmqcudk8.png" width="300"></div><br>  Pero con el tiempo, la carga en la aplicaci√≥n, y por lo tanto la carga en el maestro, aumenta.  Es posible que desee equilibrarlo moviendo parte de la lectura a un esclavo. <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/sv/r4/si/svr4sicizgym8gqndznsygpi0-o.png" width="300"></div><br>  Se ve bastante bien.  Mantiene la carga, el servidor ya no est√° inactivo.  Pero esta es una mala idea.  Es importante recordar por qu√© inicialmente criaste al esclavo, para cambiarlo en caso de problemas con el principal.  Si comenz√≥ a cargar ambos servidores, cuando su maestro se bloquee, y tarde o temprano se bloquee, tendr√° que cambiar el tr√°fico principal del servidor maestro al servidor de respaldo, y ya est√° cargado.  Tal sobrecarga har√° que su sistema sea terriblemente lento o lo deshabilitar√° por completo. <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/9t/py/la/9tpylanqp3whk7tcr4csdln6yo0.png" width="300"></div><br><h3>  Datos </h3><br>  El principal problema al agregar tolerancia a fallas a un servicio es el estado local.  Si su servicio no tiene estado, es decir, no almacena ning√∫n dato mutable, entonces escalarlo no presenta un problema.  Simplemente planteamos todas las instancias que necesitamos y equilibramos las solicitudes entre ellas. <br><br>  En el caso de que el servicio tenga estado, ya no podemos hacerlo.  Debe pensar en c√≥mo almacenar los mismos datos en todas las instancias de nuestro servicio para que sean coherentes. <br><br>  Para resolver este problema, se utiliza uno de dos enfoques: replicaci√≥n sincr√≥nica o asincr√≥nica.  En el caso general, le aconsejo que use la opci√≥n asincr√≥nica, ya que generalmente es m√°s simple y r√°pido de escribir y, seg√∫n las circunstancias, vea si necesita cambiar a s√≠ncrono. <br><br>  Un matiz importante a considerar cuando se trabaja con replicaci√≥n as√≠ncrona es la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">consistencia eventual</a> .  Esto significa que en un punto particular en el tiempo en diferentes esclavos, los datos pueden quedar rezagados con respecto al maestro en intervalos de tiempo impredecibles y diferentes. <br>  En consecuencia, no puede leer datos cada vez desde un servidor aleatorio, porque entonces pueden surgir diferentes respuestas a las mismas solicitudes de los usuarios.  Para evitar este problema, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">se utiliza</a> el mecanismo de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">sesiones fijas</a> , lo que garantiza que todas las solicitudes de un usuario vayan a una instancia. <br><br>  Las ventajas de un enfoque sincr√≥nico son que los datos siempre est√°n en un estado consistente y el riesgo de perder datos es menor (porque se considera que se registra solo despu√©s de que todos los servidores lo hayan hecho).  Sin embargo, debe pagar por esto con la velocidad de escritura y la complejidad del sistema en s√≠ (por ejemplo, varios algoritmos de qu√≥rum para protecci√≥n contra <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">cerebro dividido</a> ). <br><br><h3>  Conclusiones </h3><br><ul><li>  <b>Reserva</b>  Si los datos en s√≠ y la disponibilidad de un servicio en particular son importantes, aseg√∫rese de que su servicio sobrevivir√° a la ca√≠da de una m√°quina en particular. <br></li><li>  <b>Al calcular la carga, tenga en cuenta la ca√≠da de algunos servidores.</b>  Si su cl√∫ster tiene cuatro servidores, aseg√∫rese de que cuando uno se caiga, los tres restantes tirar√°n de la carga. <br></li><li>  <b>Elija el tipo de replicaci√≥n seg√∫n las tareas.</b> <br></li><li>  <b>No ponga todos sus huevos en una canasta.</b>  Aseg√∫rese de estar lo suficientemente lejos de los servidores.  Dependiendo de la importancia de la disponibilidad del servicio, sus servidores pueden estar en diferentes racks en un centro de datos, o en diferentes centros de datos en diferentes pa√≠ses.  Todo depende de la cantidad de desastre global que desee y est√© listo para sobrevivir. <br></li></ul><br><h2>  Servicio de silencio </h2><br>  En alg√∫n momento, su servicio puede comenzar a funcionar muy lentamente.  Este problema puede ocurrir por muchas razones: carga excesiva, retrasos en la red, problemas de hardware o errores de c√≥digo.  Parece un problema no tan terrible, pero de hecho es m√°s insidioso de lo que parece. <br><br>  Imag√≠nese: un usuario solicita una p√°gina.  Simult√°neamente y secuencialmente accedemos a los cuatro demonios para dibujarlo.  Responden r√°pidamente, todo funciona bien. <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/vo/u9/q5/vou9q5svtrqqptnxti-vkeuhmbm.png" width="400"></div><br>  Supongamos que este caso se maneja usando nginx con un n√∫mero fijo de trabajadores PHP FPM (con diez, por ejemplo).  Si cada solicitud se procesa durante aproximadamente 20 ms, con la ayuda de c√°lculos simples se puede entender que nuestro sistema es capaz de procesar aproximadamente quinientas solicitudes por segundo. <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/tq/h2/o2/tqh2o239lvw7qiobm8scwzrjma4.png" width="450"></div><br>  ¬øQu√© sucede cuando uno de estos cuatro servicios comienza a disminuir y el procesamiento de solicitudes aumenta de 20 ms a un tiempo de espera de 1000 ms?  Es importante recordar que cuando trabajamos con la red, el retraso puede ser infinitamente grande.  Por lo tanto, siempre debe establecer un tiempo de espera (en este caso, es igual a un segundo). <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/rn/uq/ae/rnuqaevpyknuwpgd9a94oygknia.png" width="400"></div><br>  Resulta que el back-end se ve obligado a esperar a que expire el tiempo de espera y recibir y procesar el error del demonio.  Esto significa que el usuario recibe la p√°gina en un segundo en lugar de diez milisegundos.  Lento, pero no fatal. <br><br>  Pero, ¬øcu√°l es el verdadero problema aqu√≠?  El hecho es que cuando tenemos cada solicitud procesada por segundo, el rendimiento cae tr√°gicamente a diez solicitudes por segundo.  Y el und√©cimo usuario ya no podr√° obtener una respuesta, incluso si solicit√≥ una p√°gina que de ninguna manera est√° asociada con un servicio aburrido.  Solo porque los diez trabajadores est√°n esperando un tiempo de espera y no pueden procesar nuevas solicitudes. <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/sk/tn/dz/sktndzfsfdbjsgobqxmm5sy_xkw.png" width="450"></div><br>  Es importante comprender que este problema no se puede resolver aumentando el n√∫mero de trabajadores.  Despu√©s de todo, cada trabajador requiere una cierta cantidad de RAM para su trabajo, incluso si no realiza un trabajo real, sino que simplemente se cuelga en anticipaci√≥n de un tiempo de espera.  Por lo tanto, si no limita el n√∫mero de trabajadores de acuerdo con las capacidades de su servidor, entonces aumentar cada vez m√°s trabajadores nuevos colocar√° todo el servidor.  Este caso es un ejemplo de una falla en cascada, cuando la ca√≠da de cualquier servicio, incluso si no es cr√≠tico para el usuario, causa una falla en todo el sistema. <br><br><h3>  Soluci√≥n </h3><br>  Hay un patr√≥n llamado <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">disyuntor</a> .  Su tarea es bastante simple: en alg√∫n momento debe reducir un servicio aburrido.  Para esto, se coloca un proxy entre el servicio y los trabajadores.  Puede ser c√≥digo PHP con almacenamiento o un demonio en el host local.  Es importante tener en cuenta que si tiene varias instancias (su servicio se replica), este proxy debe realizar un seguimiento por separado de cada una de ellas. <br><br>  Hemos escrito nuestra implementaci√≥n de este patr√≥n.  Pero no porque nos encanta escribir c√≥digo, sino porque cuando resolvimos este problema hace muchos a√±os, no hab√≠a soluciones preparadas. <br><br>  Ahora describir√© en t√©rminos generales nuestra implementaci√≥n y c√≥mo ayuda a evitar este problema.  Y se puede escuchar m√°s sobre ella y sus diferencias con respecto a otras soluciones <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">en un informe de Mikhail Kurmaev sobre Highload Siberia</a> a fines de junio.  La transcripci√≥n de su informe tambi√©n estar√° en este blog. <br><br>  Se parece a esto: <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/dz/em/-d/dzem-dkkbiq6qx04cknxzdo99bc.png" width="500"></div><br>  Hay un servicio abstracto de Sphinx, que se enfrenta a un interruptor autom√°tico.  El disyuntor almacena el n√∫mero de conexiones activas a un demonio espec√≠fico.  Tan pronto como este valor alcanza el umbral, que establecemos como un porcentaje de los trabajadores de FPM disponibles en la m√°quina, creemos que el servicio comenz√≥ a disminuir.  Al llegar al primer umbral, enviamos una notificaci√≥n a la persona responsable del servicio.  Tal situaci√≥n es una se√±al de que los l√≠mites deben ser revisados, o un presagio de problemas de aburrimiento. <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/_g/ou/k6/_gouk6h_xfurcn_o04rslmiwsh8.png" width="500"></div><br>  Si la situaci√≥n empeora y el n√∫mero de trabajadores inhibidores alcanza el segundo valor umbral, en nuestra producci√≥n es de aproximadamente el 10%, reducimos este host por completo.  M√°s precisamente, el servicio en realidad contin√∫a funcionando, pero dejamos de enviarle solicitudes.  El navegador del circuito los rechaza e inmediatamente les da a los trabajadores un error, como si el servicio estuviera mintiendo. <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/co/ao/pd/coaopdx7tp0swvu8qu0t01jf81u.png" width="500"></div><br>  De vez en cuando, omitimos autom√°ticamente una solicitud de un trabajador para ver si el servicio ha cobrado vida.  Si responde adecuadamente, lo incluimos nuevamente en el trabajo. <br><br>  Todo esto se hace para reducir la situaci√≥n al esquema de replicaci√≥n anterior.  En lugar de esperar un segundo antes de darnos cuenta de que el host no est√° disponible, inmediatamente recibimos un error y vamos al host de respaldo. <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/9c/s8/iz/9cs8iz-aepaztqroslluwwregt0.png" width="400"></div><br><br><h3>  Implementaciones </h3><br>  Afortunadamente, Open Source no se detiene, y hoy puede tomar una soluci√≥n llave en mano en Github. <br><br>  Existen dos enfoques principales para implementar el interruptor autom√°tico: una biblioteca de nivel de c√≥digo y un demonio independiente que representa las solicitudes por s√≠ mismo. <br><br>  La opci√≥n con la biblioteca es m√°s adecuada si tiene un monolito principal en PHP, que interact√∫a con varios servicios, y los servicios casi no se comunican entre s√≠.  Aqu√≠ hay algunas implementaciones disponibles: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Ganesha</a> <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Disyuntor PHP</a> <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Phystrix</a> <br></li></ul><br>  Si tiene muchos servicios en diferentes idiomas y todos interact√∫an entre s√≠, entonces la opci√≥n a nivel de c√≥digo deber√° duplicarse en todos estos idiomas.  Esto es inconveniente en el soporte y, en √∫ltima instancia, conduce a diferencias en las implementaciones. <br><br>  Poner un demonio en este caso es mucho m√°s f√°cil.  En este caso, no tiene que editar especialmente el c√≥digo.  El demonio est√° tratando de hacer que la interacci√≥n sea transparente.  Sin embargo, esta opci√≥n es <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">mucho m√°s complicada arquitect√≥nicamente</a> . <br><br>  Aqu√≠ hay algunas opciones (la funcionalidad es m√°s rica all√≠, pero tambi√©n hay un interruptor autom√°tico): <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Enviado</a> <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Linkerd</a> <br></li></ul><br><h3>  Conclusiones </h3><br><ul><li>  No conf√≠es en la red. <br></li><li>  Todas las solicitudes de red deben tener un tiempo de espera, porque la red puede dar un tiempo infinitamente largo. <br></li><li>  Use un disyuntor si desea evitar bloqueos de aplicaciones en cascada debido al hecho de que un peque√±o servicio se ralentiza. <br></li></ul><br><h2>  Monitoreo y telemetria </h2><br><h3>  Que da </h3><br><ul><li>  <b>Previsibilidad</b>  Es importante predecir cu√°l es la carga y lo que ser√° en un mes para aumentar oportunamente el n√∫mero de instancias de servicio.  Esto es especialmente cierto si se trata de una infraestructura de hierro, ya que ordenar nuevos servidores lleva tiempo. </li><li>  <b>Investigaci√≥n de incidentes.</b>  Tarde o temprano, algo saldr√° mal de todos modos, y tendr√° que investigarlo.  Y es importante tener suficientes datos para comprender el problema y poder prevenir tales situaciones en el futuro. </li><li>  <b>Prevenci√≥n de accidentes.</b>  Idealmente, debe comprender qu√© patrones conducen a bloqueos.  Es importante realizar un seguimiento de estos patrones y notificar al equipo sobre ellos de manera oportuna. </li></ul><br><br><h3>  Que medir </h3><br>  <b>M√©tricas de integraci√≥n</b> <br><br>  Como estamos hablando de la interacci√≥n entre servicios, monitoreamos todo lo que es posible en relaci√≥n con la comunicaci√≥n del servicio con la aplicaci√≥n.  Por ejemplo: <br><br><ul><li>  cantidad de solicitudes; <br></li><li>  solicitar tiempo de procesamiento (incluidos los percentiles); <br></li><li>  n√∫mero de errores l√≥gicos; <br></li><li>  N√∫mero de errores del sistema. <br></li></ul><br>  Es importante distinguir los errores l√≥gicos de los errores del sistema.  Si el servicio cae, esta es una situaci√≥n regular: simplemente cambiamos a la segunda.  Pero no da tanto miedo.  Si inicia alg√∫n tipo de error l√≥gico, por ejemplo, datos extra√±os ingresan al servicio o lo dejan, entonces esto ya debe investigarse.  Lo m√°s probable es que el error est√© relacionado con un error en el c√≥digo.  Ella misma no pasar√°. <br><br>  <b>M√©tricas internas</b> <br><br>  Por defecto, el servicio es un cuadro negro que hace su trabajo de manera incomprensible.  Todav√≠a es deseable comprender y recopilar los datos m√°ximos que el servicio puede proporcionar.  Si el servicio es una base de datos especializada que almacena algunos datos de su l√≥gica comercial, realice un seguimiento de la cantidad exacta de datos, de qu√© tipo es y otras m√©tricas de contenido.  Si tiene una interacci√≥n asincr√≥nica, tambi√©n es importante controlar las colas a trav√©s de las cuales se comunica su servicio: su velocidad de llegada y salida, el tiempo en diferentes etapas (si tiene varios puntos intermedios), el n√∫mero de eventos en la cola. <br><br>  Veamos qu√© m√©tricas se pueden recopilar usando memcached como ejemplo: <br><br><ul><li>  proporci√≥n de aciertos / fallas; <br></li><li>  tiempo de respuesta para varias operaciones; <br></li><li>  RPS de varias operaciones; <br></li><li>  desglose de los mismos datos en diferentes claves; <br></li><li>  teclas cargadas en la parte superior; <br></li><li>  todas las m√©tricas internas dadas por el comando de estad√≠sticas. <br></li></ul><br><br><h3>  Como hacerlo </h3><br>  Si tiene una empresa peque√±a, un proyecto peque√±o y pocos servidores, entonces es una buena soluci√≥n para conectar alg√∫n tipo de SaaS para recopilar y ver: es m√°s f√°cil y m√°s barato.  En este caso, generalmente SaaS tiene una amplia funcionalidad y no tiene que preocuparse por muchas cosas.  Ejemplos de tales servicios: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Datadog</a> <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Rollbar</a> <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Nueva reliquia</a> <br></li></ul><br>  Alternativamente, siempre puede instalar Zabbix, Grafana o cualquier otra soluci√≥n autohospedada en su propia m√°quina. <br><br><h3>  Conclusiones </h3><br><ul><li>  <b>Recoge todas las m√©tricas que puedas.</b>  Los datos no son superfluos.  Cuando tenga que investigar algo, dir√° gracias por su previsi√≥n. </li><li>  <b>No te olvides de la interacci√≥n asincr√≥nica.</b>  Si tiene l√≠neas que llegan gradualmente, es importante comprender qu√© tan r√°pido llegan, qu√© sucede con sus eventos en el cruce entre los servicios. </li><li>  <b>Si escribe su servicio, ens√©√±ele a dar estad√≠sticas sobre el trabajo.</b>  Parte de los datos se pueden medir en la capa de integraci√≥n cuando nos comunicamos con este servicio.  El resto del servicio deber√≠a poder proporcionar estad√≠sticas de acuerdo con el comando condicional.  Por ejemplo, en todos nuestros servicios en Go, esta funcionalidad es est√°ndar. </li><li>  <b>Personaliza los disparadores.</b>  <b>Los gr√°ficos son buenos, pero solo mientras los miras.</b>  Es importante que tenga un sistema personalizado que le permita saber si algo sale mal. </li></ul><br><h2>  Memento mori </h2><br>  Y ahora un poco sobre cosas tristes.  Puede tener la sensaci√≥n de que lo anterior es una panacea, y ahora nada caer√° nunca.  Pero incluso si aplica todo lo descrito anteriormente, de todos modos, algo caer√°.  Es importante considerar esto. <br>  Las razones de la ca√≠da son muchas.  Por ejemplo, puede elegir un esquema de replicaci√≥n insuficientemente paranoico.  Un meteorito cay√≥ en su centro de datos, y luego en el segundo.  O simplemente despleg√≥ el c√≥digo con un error complicado que apareci√≥ inesperadamente. <br><br>  Por ejemplo, en Badoo hay una p√°gina "Personas cercanas".  All√≠, los usuarios buscan a otras personas cercanas para chatear con ellos. <br><br><img src="https://habrastorage.org/webt/3q/l4/xm/3ql4xmmqeobxu4vsrqygagstflw.png"><br><br>  Ahora, para representar la p√°gina, el backend realiza llamadas sincr√≥nicas a unos siete servicios.  Para mayor claridad, reduzca este n√∫mero a dos.  Un servicio es responsable de representar el bloque central con fotos.  El segundo es para el bloque publicitario en la parte inferior izquierda.  Aquellos que quieran hacerse m√°s visibles pueden llegar all√≠.  Si tenemos un servicio que muestra este anuncio, el bloqueo simplemente desaparece. <br><br><img src="https://habrastorage.org/webt/rg/tu/pj/rgtupjtztftw7pgvxpwg7auwa1q.png"><br><br>  La mayor√≠a de los usuarios ni siquiera saben sobre este hecho: nuestro equipo responde r√°pidamente y pronto el bloqueo simplemente vuelve a aparecer. <br><br>  Pero no todas las funcionalidades podemos eliminar silenciosamente.  Si perdemos el servicio responsable de la parte central de la p√°gina, esto no funcionar√° para ocultarlo.  Por lo tanto, es importante decirle al usuario en su idioma lo que est√° sucediendo. <br><br><img src="https://habrastorage.org/webt/eh/1q/c3/eh1qc3sr6laokkydqscq_ydilue.png"><br><br>  Tambi√©n es deseable que la falla de un servicio no conduzca a una falla en cascada.  Para cada servicio, se debe escribir un c√≥digo que maneje su ca√≠da; de lo contrario, la aplicaci√≥n puede bloquearse en su conjunto. <br><br>  Pero eso no es todo.  A veces algo cae, sin el cual no puedes vivir de ninguna manera.  Por ejemplo, una base de datos central o servicio de sesi√≥n.  Es importante resolverlo correctamente y mostrarle al usuario algo adecuado, de alguna manera entretenerlo, para decirle que todo est√° bajo control.  Al mismo tiempo, es importante que todo est√© realmente bajo control, y los monitores son notificados del problema. <br><br><img src="https://habrastorage.org/webt/e6/hs/wt/e6hswt9cdlv2kfnt47zuujzyoyq.png"><br><br><img src="https://habrastorage.org/webt/lr/ch/g9/lrchg9mdfortw-jjnzi9ejdzr8u.png"><br><br><h3>  Morir tan bien </h3><br><ul><li>  <b>Prep√°rate para el oto√±o.</b>  No hay una bala de plata, as√≠ que siempre coloque pajitas en caso de que el servicio caiga por completo, incluso si usa redundancia. </li><li>  <b>Evite fallas en cascada</b> cuando los problemas con uno de los servicios maten a toda la aplicaci√≥n. </li><li>  <b>Deshabilitar la funcionalidad de usuario no cr√≠tica.</b>  Esto es normal  Muchos servicios se usan solo para necesidades internas y no afectan la funcionalidad proporcionada.  Por ejemplo, un servicio de estad√≠sticas.  Al usuario no le importa si las estad√≠sticas se recopilan de usted o no.  Es importante para √©l que el sitio funcione. </li></ul><br><h2>  Resumen </h2><br>  Para integrar de manera confiable el nuevo servicio en el sistema, escribimos una API de envoltura especial alrededor de √©l en Badoo, que asume las siguientes tareas: <br><br><ul><li>  balanceo de carga; </li><li>  tiempos de espera; </li><li>  conmutaci√≥n por error l√≥gica; </li><li>  disyuntor </li><li>  monitoreo y telemetr√≠a; </li><li>  l√≥gica de autorizaci√≥n; </li><li>  serializaci√≥n y deserializaci√≥n de datos. </li></ul><br>  Es mejor asegurarse de que todos estos elementos tambi√©n est√©n cubiertos en su capa de integraci√≥n.  Especialmente si est√° utilizando un cliente API de c√≥digo abierto listo para usar.  Es importante recordar que la capa de integraci√≥n es una fuente de mayor riesgo de falla en cascada de su aplicaci√≥n. <br><br>  Gracias por su atencion! <br><br>  <b>Literatura</b> <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">¬°Sueltalo!</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Ingenier√≠a de confiabilidad del sitio</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Creando microservicios</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es413555/">https://habr.com/ru/post/es413555/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es413545/index.html">Humor en la marca: por qu√© no siempre es bueno</a></li>
<li><a href="../es413547/index.html">Experimenta 2 millones de sesiones sin cabeza</a></li>
<li><a href="../es413549/index.html">Curso de conferencia sobre desarrollo web</a></li>
<li><a href="../es413551/index.html">Desplazamiento y atenci√≥n (estudio 2018)</a></li>
<li><a href="../es413553/index.html">El registrador REG.RU priv√≥ al socio del acceso a 70 mil dominios y tom√≥ su servicio para s√≠ mismo</a></li>
<li><a href="../es413557/index.html">NewSQL: SQL no va a ninguna parte</a></li>
<li><a href="../es413559/index.html">Degradaci√≥n web o c√≥mo hacer que la web sea legible por humanos</a></li>
<li><a href="../es413561/index.html">Velocidad de √°rbol de expresi√≥n de Linq compilada</a></li>
<li><a href="../es413563/index.html">4 formas de importar un paquete en Go</a></li>
<li><a href="../es413565/index.html">An√°lisis de pirateo de Kubernetes - puerta trasera a trav√©s de kubelet</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>