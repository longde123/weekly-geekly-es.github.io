<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üçë ü•ê üÉè Utilisation du code mbed dans votre propre projet STM32 - exp√©rience de l'overclocking de l'√©cran LCD chinois üßúüèΩ üê® üë®üèø‚Äçü§ù‚Äçüë®üèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Parfois, le code de quelqu'un d'autre aide vraiment √† connecter le fer p√©riph√©rique au microcontr√¥leur. Malheureusement, l'adaptation du code de quelq...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Utilisation du code mbed dans votre propre projet STM32 - exp√©rience de l'overclocking de l'√©cran LCD chinois</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/390909/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parfois, le code de quelqu'un d'autre aide vraiment √† connecter le fer p√©riph√©rique au microcontr√¥leur. </font><font style="vertical-align: inherit;">Malheureusement, l'adaptation du code de quelqu'un d'autre √† votre projet peut √™tre plus difficile que de le r√©√©crire vous-m√™me, surtout quand il s'agit de m√©ga frameworks comme Arduino ou mbed. </font><font style="vertical-align: inherit;">Voulant connecter un √©cran LCD chinois bas√© sur ILI9341 √† la carte STM32L476G DISCOVERY, l'auteur a d√©cid√© d'utiliser le pilote √©crit pour mbed dans le projet de d√©monstration de ST sans changer une seule ligne dans son code. </font><font style="vertical-align: inherit;">En cons√©quence, il √©tait possible en m√™me temps d'overclocker l'√©cran √† des vitesses de mise √† jour sans pr√©c√©dent de 27 ips.</font></font><br>
<br>
<img src="https://habrastorage.org/files/e3a/44f/7c3/e3a44f7c39d643e29471ee044ea6ea38.jpg"><br>
<br>
<a name="habracut"></a><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Introduction au probl√®me</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ST Microelectronics produit des microcontr√¥leurs tr√®s int√©ressants, √† la fois en termes de capacit√©s et de prix, ainsi que des cartes de sortie pour un d√©veloppement rapide. L'un d'eux sera discut√© - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">STM32L476G DISCOVERY</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Les capacit√©s de calcul de cette carte sont tr√®s encourageantes - un ARM 32 bits avec une fr√©quence d'horloge maximale de 80 MHz peut effectuer des op√©rations en virgule flottante. Dans le m√™me temps, il est capable de r√©duire la consommation d'√©nergie au minimum et de travailler sur batterie, en attendant la possibilit√© de faire quelque chose d'utile. J'ai d√©cid√© de connecter un √©cran LCD couleur chinois bon march√© avec une r√©solution de 320 par 240 en travaillant sur l'interface SPI √† cet appareil. Comment l'utiliser avec mbed est d√©crit en d√©tail </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mbed</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Il s'agit d'un environnement de programmation en ligne o√π vous pouvez compiler votre firmware sans avoir de compilateur sur votre ordinateur, apr√®s quoi vous pouvez le t√©l√©charger et le flasher en le copiant simplement sur votre carte compatible mbed, qui ressemble √† un disque amovible lorsqu'il est connect√© √† USB. Tout cela est super, mais il y a quelques probl√®mes. Premi√®rement, toutes les cartes ne sont pas compatibles avec mbed. Deuxi√®mement, il existe de nombreux projets existants qui ne sont en aucun cas compatibles avec mbed, y compris les logiciels fournis par ST. Et enfin, tous les d√©veloppeurs ne sont pas compatibles avec mbed, certains (par exemple, l'auteur de ces lignes) trouvent plus d'inconv√©nients que d'avantages dans ce merveilleux outil. Quels sont ces inconv√©nients, nous en discuterons ci-dessous, pour l'instant il suffit de mentionner qu'apr√®s avoir connect√© </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">le pilote d'affichage</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> au projet de d√©monstration de ST et √† quelques optimisations simples, il a commenc√© √† fonctionner environ 10 fois plus rapidement.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apprendre le code du conducteur</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il est temps de t√©l√©charger et d'√©tudier le code source </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">du pilote d'affichage</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. L'utilisation des ports dans mbed est organis√©e via des appels aux m√©thodes de classe qui repr√©sentent les ports d'E / S. Par exemple, la classe DigitalOut impl√©mente l'acc√®s au port de sortie. L'affectation d'une instance de cet objet √† z√©ro ou √† un lance l'initialisation du bit correspondant sur le port de sortie. La classe DigitalOut est initialis√©e par le type √©num√©r√© PinName, dont le seul but est d'identifier la jambe du processeur. L'un des principaux inconv√©nients de l'impl√©mentation de DigitalOut et d'autres classes qui impl√©mentent les E / S est que le port est initialis√© dans le constructeur de l'instance de classe. C'est id√©al pour faire clignoter une LED si une instance de la classe DigitalOut est cr√©√©e sur la pile dans la fonction principale. Mais imaginez que nous avons beaucoup de fer diff√©rent, dont l'initialisation est dispers√©e sur plusieurs modules.Si nous rendons les instances de nos classes d'E / S statiques, nous perdons tout contr√¥le sur l'initialisation, car elle se produira avant la fonction principale et dans un ordre arbitraire. Les biblioth√®ques ST (appel√©es HAL - niveau d'abstraction mat√©rielle) utilisent un paradigme diff√©rent et plus flexible. Chaque port d'entr√©e / sortie a son propre contexte et un ensemble de fonctions qui fonctionnent avec lui, mais ils peuvent √™tre appel√©s exactement lorsque cela est n√©cessaire. Les contextes de port sont g√©n√©ralement cr√©√©s sous forme de variables statiques, mais aucune initialisation automatique non contr√¥l√©e ne se produit (les biblioth√®ques ST sont √©crites en C). Un utilitaire extr√™mement pratique m√©rite √©galement d'√™tre mentionn√©.Les biblioth√®ques ST (appel√©es HAL - niveau d'abstraction mat√©rielle) utilisent un paradigme diff√©rent et plus flexible. Chaque port d'entr√©e / sortie a son propre contexte et un ensemble de fonctions qui fonctionnent avec lui, mais ils peuvent √™tre appel√©s exactement lorsque cela est n√©cessaire. Les contextes de port sont g√©n√©ralement cr√©√©s sous forme de variables statiques, mais aucune initialisation automatique non contr√¥l√©e ne se produit (les biblioth√®ques ST sont √©crites en C). Un utilitaire extr√™mement pratique m√©rite √©galement d'√™tre mentionn√©.Les biblioth√®ques ST (appel√©es HAL - niveau d'abstraction mat√©rielle) utilisent un paradigme diff√©rent et plus flexible. Chaque port d'entr√©e / sortie a son propre contexte et un ensemble de fonctions qui fonctionnent avec lui, mais ils peuvent √™tre appel√©s exactement lorsque cela est n√©cessaire. Les contextes de port sont g√©n√©ralement cr√©√©s sous forme de variables statiques, mais aucune initialisation automatique non contr√¥l√©e ne se produit (les biblioth√®ques ST sont √©crites en C). Un utilitaire extr√™mement pratique m√©rite √©galement d'√™tre mentionn√©.mais aucune initialisation automatique non contr√¥l√©e ne se produit dans ce cas (les biblioth√®ques ST sont √©crites en C). Un utilitaire extr√™mement pratique m√©rite √©galement d'√™tre mentionn√©.mais aucune initialisation automatique non contr√¥l√©e ne se produit dans ce cas (les biblioth√®ques ST sont √©crites en C). Un utilitaire extr√™mement pratique m√©rite √©galement d'√™tre mentionn√©.</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CubeMX</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , qui peut g√©n√©rer tout le code d'initialisation n√©cessaire pour l'ensemble de ports dont vous avez besoin et vous permet m√™me de modifier ult√©rieurement cet ensemble de ports sans affecter votre propre code. Son seul inconv√©nient est l'impossibilit√© de l'utiliser avec des projets existants, vous devez d√©marrer le projet avec l'utilisation de cet utilitaire. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La biblioth√®que mbed utilise les m√™mes fonctions HAL de la biblioth√®que ST pour initialiser les ressources du microcontr√¥leur, mais cela le rend √©tonnamment irr√©fl√©chi par endroits. Pour s'en assurer, il suffit de regarder le code d'initialisation du port SPI (dont nous avons besoin pour travailler avec l'affichage) dans le fichier </font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">spi_api.c</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">La fonction spi_init recherche d'abord un port SPI appropri√© par les segments qu'elle utilisera, puis appelle la fonction init_spi, qui initialise en fait le port. </font><font style="vertical-align: inherit;">Dans ce cas, les 3 ports SPI possibles utilisent une seule structure de contexte statique</font></font><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> SPI_HandleTypeDef SpiHandle;
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il s'agit essentiellement d'un exemple classique d'utilisation de variables globales au lieu de variables locales. </font><font style="vertical-align: inherit;">M√™me en tenant compte du fait que nous avons un c≈ìur de calcul, le contexte global n'est pas prot√©g√© de l'utilisation simultan√©e √† diff√©rents endroits du code, il y a encore des interruptions, ainsi que l'√©viction du multit√¢che.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Connectez la biblioth√®que √† votre projet</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je ne veux donc pas √©crire tout le code sur mbed. J'aime beaucoup plus les exemples ST fournis avec </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CubeMX</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Je n'ai pas trouv√© le pilote fini pour mon LCD pour les biblioth√®ques ST, je ne voulais pas l'√©crire moi-m√™me. Il restait un moyen alternatif de s'amuser en quelque sorte: connecter le pilote √©crit pour mbed, et pour qu'il ne n√©cessite rien de changer. Pour ce faire, il vous suffit d'impl√©menter les biblioth√®ques mbed d'une mani√®re alternative. En fait, la t√¢che est plus simple qu'il n'y para√Æt, en raison de toutes les biblioth√®ques mbed, le pilote LCD utilise uniquement le port de sortie et SPI. De plus, il a besoin de fonctions de g√©n√©ration de retard et de classes de fichiers et de flux. Avec ce dernier, tout est simple - nous n'en avons pas besoin et sommes remplac√©s par des prises qui ne font rien. Les fonctions de g√©n√©ration de retard sont faciles √† √©crire - elles sont dans le fichier</font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wait_api.h</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . L'impl√©mentation de classes d'E / S n√©cessite une approche l√©g√®rement plus cr√©ative. Nous allons corriger le manque de biblioth√®ques mbed et ne pas faire l'initialisation mat√©rielle dans le constructeur. Le constructeur recevra un lien vers le contexte du port situ√© ailleurs, son code d'initialisation sera compl√®tement ind√©pendant de nos classes d'interface. Il existe le seul moyen de transmettre ces informations au constructeur sans modifier le code du pilote - via PinName, qui au lieu de simplement r√©pertorier les jambes stockera d√©sormais le pointeur sur le port, le num√©ro de la jambe et √©ventuellement le pointeur sur la ressource (comme SPI) √† laquelle cette jambe est connect√©e.</font></font><br>
<pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PinName</span></span></span><span class="hljs-class"> {</span></span>
<span class="hljs-keyword"><span class="hljs-keyword">public</span></span>:<font></font>
	PinName() : m_port(<span class="hljs-number"><span class="hljs-number">0</span></span>), m_pin(<span class="hljs-number"><span class="hljs-number">0</span></span>), m_obj(<span class="hljs-number"><span class="hljs-number">0</span></span>) {}<font></font>
	PinName(GPIO_TypeDef* port, <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> pin, <span class="hljs-keyword"><span class="hljs-keyword">void</span></span>* obj = <span class="hljs-number"><span class="hljs-number">0</span></span>)<font></font>
		: m_port(port), m_pin(pin), m_obj(obj)<font></font>
		{<font></font>
			assert_param(m_port != <span class="hljs-number"><span class="hljs-number">0</span></span>);<font></font>
		}<font></font>
<font></font>
	GPIO_TypeDef* m_port;<font></font>
	<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span>      m_pin;
	<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>*         m_obj;<font></font>
<font></font>
	<span class="hljs-keyword"><span class="hljs-keyword">static</span></span> PinName not_connected;<font></font>
};<font></font>
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'impl√©mentation du port de sortie est assez banale. Pour am√©liorer les performances, nous essaierons d'utiliser moins les fonctions HAL, et travaillerons directement avec les registres de ports, si possible, ainsi que d'√©crire du code en ligne, ce qui permettra au compilateur d'√©viter les appels de fonction.</font></font><br>
<pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DigitalOut</span></span></span><span class="hljs-class"> {</span></span>
<span class="hljs-keyword"><span class="hljs-keyword">public</span></span>:<font></font>
	DigitalOut(GPIO_TypeDef* port, <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> pin)<font></font>
		: m_port(port), m_pin(pin)<font></font>
		{<font></font>
			assert_param(m_port != <span class="hljs-number"><span class="hljs-number">0</span></span>);<font></font>
		}<font></font>
	DigitalOut(PinName <span class="hljs-keyword"><span class="hljs-keyword">const</span></span>&amp; N)<font></font>
		: m_port(N.m_port), m_pin(N.m_pin)<font></font>
		{<font></font>
			assert_param(m_port != <span class="hljs-number"><span class="hljs-number">0</span></span>);<font></font>
		}<font></font>
	<span class="hljs-keyword"><span class="hljs-keyword">void</span></span> <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span> =(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> bit) {
		<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (bit) m_port-&gt;BSRR = m_pin;
		<span class="hljs-keyword"><span class="hljs-keyword">else</span></span>     m_port-&gt;BRR  = m_pin;<font></font>
	}<font></font>
<span class="hljs-keyword"><span class="hljs-keyword">private</span></span>:<font></font>
	GPIO_TypeDef* m_port;<font></font>
	<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span>      m_pin;<font></font>
};<font></font>
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le code d'impl√©mentation du port SPI n'est pas beaucoup plus compliqu√©, vous pouvez le voir </font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Puisque nous avons s√©par√© l'initialisation du port du code d'interface, nous ignorons les demandes de modifications de configuration. </font><font style="vertical-align: inherit;">La profondeur de bits du mot est simplement m√©moris√©e. </font><font style="vertical-align: inherit;">Si l'utilisateur souhaite transmettre un mot de 16 bits et que le port est configur√© sur 8 bits, il nous suffit de r√©organiser les octets et de les transf√©rer un par un - jusqu'√† 4 octets sont toujours plac√©s dans la m√©moire tampon du port. </font><font style="vertical-align: inherit;">Tous les fichiers n√©cessaires √† la compilation du pilote sont collect√©s dans le r√©pertoire </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">compat</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Vous pouvez maintenant connecter les </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fichiers du pilote d'</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> origine </font><font style="vertical-align: inherit;">au projet et les compiler. </font><font style="vertical-align: inherit;">Nous aurons √©galement besoin d'un </font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">code</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> qui initialise les ports, cr√©e une instance du pilote et dessine quelque chose de significatif √† l'√©cran.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Overclocking</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si l'√©cran LCD est utilis√© pour produire quelque chose de dynamique, il y a un d√©sir naturel de rendre la communication avec lui plus rapide. La premi√®re chose qui me vient √† l'esprit est d'augmenter la fr√©quence d'horloge SPI, que le pilote d√©finit √† 10 MHz, mais nous ignorons ses souhaits et pouvons tout r√©gler. Il s'est av√©r√© que l'√©cran fonctionne correctement et √† une fr√©quence de 40 MHz - c'est la fr√©quence maximale dont notre processeur avec une fr√©quence d'horloge de 80 MHz est capable. Pour √©valuer les performances, un code simple a √©t√© √©crit qui affiche une image bitmap de 100x100 pixels dans une boucle. Le r√©sultat a ensuite √©t√© extrapol√© √† l'ensemble de l'√©cran (un bitmap occupant tout l'√©cran ne tient tout simplement pas en m√©moire). Le r√©sultat - 11fps est tr√®s loin de la limite th√©orique de 32fps, qui est obtenue si vous transf√©rez 16 bits √† chaque pixel sans s'arr√™ter. La raison devient claire si vous regardez</font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">code source du pilote</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">S'il a besoin de transmettre une s√©quence d'octets, il les transf√®re simplement un par un, dans le meilleur des cas, en mots de 16 bits. </font><font style="vertical-align: inherit;">La raison de cette conception inefficace r√©side dans l'API mbed. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La classe SPI</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> a une m√©thode pour transmettre un tableau de donn√©es, mais elle ne peut √™tre utilis√©e que de mani√®re asynchrone, en appelant la fonction de notification √† la fin et dans le contexte d'un gestionnaire d'interruption. </font><font style="vertical-align: inherit;">Il n'est pas surprenant que peu de gens utilisent cette m√©thode. </font><font style="vertical-align: inherit;">J'ai compl√©t√© mon impl√©mentation de la classe SPI avec une fonction qui envoie un tampon et attend la fin du transfert. </font><font style="vertical-align: inherit;">Apr√®s avoir ajout√© un appel √† cette fonction au code de transfert bitmap, les performances ont augment√© √† 27 ips, ce qui est d√©j√† tr√®s proche de la limite th√©orique.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Code source</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se trouve </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Pour la compilation, IAR Embedded Workbench pour ARM 7.50.2 a √©t√© utilis√©. </font><font style="vertical-align: inherit;">Bas√© sur le firmware de d√©monstration de code de ST. </font><font style="vertical-align: inherit;">Description de la broche, qui est connect√© √† l'√©cran se trouve dans le fichier </font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lcd.h</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr390909/">https://habr.com/ru/post/fr390909/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr390899/index.html">Professeur Gotche: ¬´Le comportement de la Grande Ferme r√©pond au crit√®re du¬´ crime organis√© ¬ª¬ª</a></li>
<li><a href="../fr390901/index.html">L'arm√©e allemande a test√© un laser HEL de 10 kilowatts</a></li>
<li><a href="../fr390903/index.html">Google a montr√© un r√©seau de neurones qui pouvait reconna√Ætre un pays √† partir d'une photo (ainsi qu'une ville et une rue), m√™me si la photo avait √©t√© prise dans une maison</a></li>
<li><a href="../fr390905/index.html">Hausse des ventes de phablets en Russie</a></li>
<li><a href="../fr390907/index.html">Apple a r√©pondu aux exigences du FBI. En cour, l'entreprise soutiendra Google, Facebook et Microsoft</a></li>
<li><a href="../fr390911/index.html">Geektimes + MWC2016 et tout-tout-tout</a></li>
<li><a href="../fr390913/index.html">Probl√®mes RH et recherche de sp√©cialistes IT</a></li>
<li><a href="../fr390915/index.html">A Mumbai, 16 zones ont √©t√© identifi√©es o√π vous ne pouvez pas prendre de selfies: pour que les touristes ne meurent pas</a></li>
<li><a href="../fr390917/index.html">CHIP - 9 $ Raspberry Pi Killer</a></li>
<li><a href="../fr390919/index.html">Raspberry Pi 3 obtiendra le Wi-Fi, Bluetooth LE - les premi√®res photos de mini-PC sont d√©j√† sur le Web</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>