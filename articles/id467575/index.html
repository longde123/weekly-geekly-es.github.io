<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🙅🏻 🙆 ❣️ Salah satu cara untuk mendapatkan profil beban kerja dan menunggu sejarah di PostgreSQL 👩🏿‍🤝‍👨🏻 🏟️ 🚳</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Kelanjutan artikel " Mencoba membuat analog ASH untuk PostgreSQL ". 

 Artikel akan dipertimbangkan dan ditampilkan pada pertanyaan dan contoh spesifi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Salah satu cara untuk mendapatkan profil beban kerja dan menunggu sejarah di PostgreSQL</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/467575/"> Kelanjutan artikel " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Mencoba membuat analog ASH untuk PostgreSQL</a> ". <br><br>  Artikel akan dipertimbangkan dan ditampilkan pada pertanyaan dan contoh spesifik - informasi bermanfaat apa yang dapat diperoleh dengan menggunakan riwayat presentasi pg_stat_activity. <br><blockquote>  Peringatan <br>  Karena kebaruan topik dan periode pengujian yang tidak lengkap, artikel mungkin mengandung kesalahan.  Kritik dan komentar sangat didorong dan diharapkan. </blockquote><a name="habracut"></a><h2>  Masukkan data </h2><br><h3>  Lihat Riwayat pg_stat_statements </h3><br><div class="spoiler">  <b class="spoiler_title">pg_stat_history</b> <div class="spoiler_text"><pre><code class="pgsql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> pg_stat_history ( id <span class="hljs-type"><span class="hljs-type">SERIAL</span></span>, snapshot_timestamp <span class="hljs-type"><span class="hljs-type">timestamp</span></span> <span class="hljs-type"><span class="hljs-type">without time zone</span></span>, database_id <span class="hljs-type"><span class="hljs-type">integer</span></span>, dbid <span class="hljs-type"><span class="hljs-type">oid</span></span>, userid <span class="hljs-type"><span class="hljs-type">oid</span></span>, queryid <span class="hljs-type"><span class="hljs-type">bigint</span></span>, query <span class="hljs-type"><span class="hljs-type">text</span></span>, calls <span class="hljs-type"><span class="hljs-type">bigint</span></span>, total_time <span class="hljs-type"><span class="hljs-type">double</span></span> <span class="hljs-type"><span class="hljs-type">precision</span></span>, min_time <span class="hljs-type"><span class="hljs-type">double</span></span> <span class="hljs-type"><span class="hljs-type">precision</span></span>, max_time <span class="hljs-type"><span class="hljs-type">double</span></span> <span class="hljs-type"><span class="hljs-type">precision</span></span>, mean_time <span class="hljs-type"><span class="hljs-type">double</span></span> <span class="hljs-type"><span class="hljs-type">precision</span></span>, stddev_time <span class="hljs-type"><span class="hljs-type">double</span></span> <span class="hljs-type"><span class="hljs-type">precision</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">rows</span></span> <span class="hljs-type"><span class="hljs-type">bigint</span></span>, shared_blks_hit <span class="hljs-type"><span class="hljs-type">bigint</span></span>, shared_blks_read <span class="hljs-type"><span class="hljs-type">bigint</span></span>, shared_blks_dirtied <span class="hljs-type"><span class="hljs-type">bigint</span></span>, shared_blks_written <span class="hljs-type"><span class="hljs-type">bigint</span></span>, local_blks_hit <span class="hljs-type"><span class="hljs-type">bigint</span></span>, local_blks_read <span class="hljs-type"><span class="hljs-type">bigint</span></span>, local_blks_dirtied <span class="hljs-type"><span class="hljs-type">bigint</span></span>, local_blks_written <span class="hljs-type"><span class="hljs-type">bigint</span></span>, temp_blks_read <span class="hljs-type"><span class="hljs-type">bigint</span></span>, temp_blks_written <span class="hljs-type"><span class="hljs-type">bigint</span></span>, blk_read_time <span class="hljs-type"><span class="hljs-type">double</span></span> <span class="hljs-type"><span class="hljs-type">precision</span></span>, blk_write_time <span class="hljs-type"><span class="hljs-type">double</span></span> <span class="hljs-type"><span class="hljs-type">precision</span></span>, baseline_id <span class="hljs-type"><span class="hljs-type">integer</span></span> );</code> </pre> </div></div><br>  Tabel diisi setiap jam menggunakan dblink ke database target.  Kolom yang paling menarik dan bermanfaat dalam tabel, tentu saja, adalah <b>queryid</b> . <br><br><h3>  Pg_stat_activity melihat riwayat </h3><br><div class="spoiler">  <b class="spoiler_title">archive_pg_stat_activity</b> <div class="spoiler_text"><pre> <code class="pgsql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> archive_pg_stat_activity ( timepoint <span class="hljs-type"><span class="hljs-type">timestamp</span></span> <span class="hljs-type"><span class="hljs-type">without time zone</span></span>, datid <span class="hljs-type"><span class="hljs-type">oid</span></span>, datname <span class="hljs-type"><span class="hljs-type">name</span></span>, pid <span class="hljs-type"><span class="hljs-type">integer</span></span>, usesysid <span class="hljs-type"><span class="hljs-type">oid</span></span>, usename <span class="hljs-type"><span class="hljs-type">name</span></span>, application_name <span class="hljs-type"><span class="hljs-type">text</span></span>, client_addr <span class="hljs-type"><span class="hljs-type">inet</span></span>, client_hostname <span class="hljs-type"><span class="hljs-type">text</span></span>, client_port <span class="hljs-type"><span class="hljs-type">integer</span></span>, backend_start <span class="hljs-type"><span class="hljs-type">timestamp</span></span> <span class="hljs-type"><span class="hljs-type">without time zone</span></span>, xact_start <span class="hljs-type"><span class="hljs-type">timestamp</span></span> <span class="hljs-type"><span class="hljs-type">without time zone</span></span>, query_start <span class="hljs-type"><span class="hljs-type">timestamp</span></span> <span class="hljs-type"><span class="hljs-type">without time zone</span></span>, state_change <span class="hljs-type"><span class="hljs-type">timestamp</span></span> <span class="hljs-type"><span class="hljs-type">without time zone</span></span>, wait_event_type <span class="hljs-type"><span class="hljs-type">text</span></span>, wait_event <span class="hljs-type"><span class="hljs-type">text</span></span>, state <span class="hljs-type"><span class="hljs-type">text</span></span>, backend_xid xid, backend_xmin xid, query <span class="hljs-type"><span class="hljs-type">text</span></span>, backend_type <span class="hljs-type"><span class="hljs-type">text</span></span>, queryid <span class="hljs-type"><span class="hljs-type">bigint</span></span> );</code> </pre> </div></div><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Tabelnya adalah tabel history_pg_stat_activity</a> jam-dipartisi (Untuk lebih jelasnya <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">lihat pg_stat_statements + pg_stat_activity + loq_query = pg_ash?</a> Dan di sini ada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">upaya untuk membuat analog ASH untuk PostgreSQL.)</a> <br><br><h2>  Jejak </h2><br><h3>  CLUSTER CPU TIME (SYSTEM + CLIENTS) </h3><br><div class="spoiler">  <b class="spoiler_title">Minta</b> <div class="spoiler_text"><pre> <code class="pgsql hljs"><span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> t <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> date_trunc(<span class="hljs-string"><span class="hljs-string">'second'</span></span>, timepoint) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> activity_hist.archive_pg_stat_activity aa <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> timepoint <span class="hljs-keyword"><span class="hljs-keyword">BETWEEN</span></span> pg_stat_history_begin+(current_hour_diff * <span class="hljs-type"><span class="hljs-type">interval</span></span> <span class="hljs-string"><span class="hljs-string">'1 hour'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> pg_stat_history_end+(current_hour_diff * <span class="hljs-type"><span class="hljs-type">interval</span></span> <span class="hljs-string"><span class="hljs-string">'1 hour'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> ( aa.wait_event_type <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> aa.state = <span class="hljs-string"><span class="hljs-string">'active'</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> count(*) <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> cpu_total <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> t ;</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Contoh</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">CLUSTER CPU TIME (SYSTEM + CLIENTS ) : 28:37:46</code> </pre> </div></div><br><h3>  WAKTU TUNGGU KLUB </h3><br><div class="spoiler">  <b class="spoiler_title">Minta</b> <div class="spoiler_text"><pre> <code class="pgsql hljs"><span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> t <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> date_trunc(<span class="hljs-string"><span class="hljs-string">'second'</span></span>, timepoint) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> activity_hist.archive_pg_stat_activity aa <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> timepoint <span class="hljs-keyword"><span class="hljs-keyword">BETWEEN</span></span> pg_stat_history_begin+(current_hour_diff * <span class="hljs-type"><span class="hljs-type">interval</span></span> <span class="hljs-string"><span class="hljs-string">'1 hour'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> pg_stat_history_end+(current_hour_diff * <span class="hljs-type"><span class="hljs-type">interval</span></span> <span class="hljs-string"><span class="hljs-string">'1 hour'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> ( aa.wait_event_type <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> aa.state = <span class="hljs-string"><span class="hljs-string">'active'</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> count(*) <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> cpu_total <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> t ;</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Contoh</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">CLUSTER WAITINGS TIME : 30:12:49</code> </pre> </div></div><br><h3>  Total nilai pg_stat_statements </h3><br><div class="spoiler">  <b class="spoiler_title">Minta</b> <div class="spoiler_text"><pre> <code class="pgsql hljs"> <span class="hljs-comment"><span class="hljs-comment">--TOTAL pg_stat SELECT SUM(calls) AS calls, SUM(total_time) AS total_time, SUM(rows) AS rows , SUM(shared_blks_hit) AS shared_blks_hit,SUM(shared_blks_read) AS shared_blks_read , SUM(shared_blks_dirtied) AS shared_blks_dirtied,SUM(shared_blks_written) AS shared_blks_written , SUM(local_blks_hit) AS local_blks_hit , SUM(local_blks_read) AS local_blks_read , SUM(local_blks_dirtied) AS local_blks_dirtied , SUM(local_blks_written) AS local_blks_written, SUM(temp_blks_read) AS temp_blks_read, SUM(temp_blks_written) temp_blks_written , SUM(blk_read_time) AS blk_read_time , SUM(blk_write_time) AS blk_write_time INTO pg_total_stat_history_rec FROM pg_stat_history WHERE snapshot_timestamp BETWEEN pg_stat_history_begin AND pg_stat_history_end AND queryid IS NULL;</span></span></code> </pre> </div></div><br><h3>  SQL DBTIME - Total Query Runtime </h3><br><div class="spoiler">  <b class="spoiler_title">Minta</b> <div class="spoiler_text"><pre> <code class="pgsql hljs">dbtime_total = <span class="hljs-type"><span class="hljs-type">interval</span></span> <span class="hljs-string"><span class="hljs-string">'1 millisecond'</span></span> * pg_total_stat_history_rec.total_time ;</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Contoh</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">SQL DBTIME : 136:49:36</code> </pre> </div></div><br><h3>  SQL CPU WAKTU waktu dari CPU yang dihabiskan untuk mengeksekusi query </h3><br><div class="spoiler">  <b class="spoiler_title">Minta</b> <div class="spoiler_text"><pre> <code class="pgsql hljs"><span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> t <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> date_trunc(<span class="hljs-string"><span class="hljs-string">'second'</span></span>, timepoint) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> activity_hist.archive_pg_stat_activity aa <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> timepoint <span class="hljs-keyword"><span class="hljs-keyword">BETWEEN</span></span> pg_stat_history_begin+(current_hour_diff * <span class="hljs-type"><span class="hljs-type">interval</span></span> <span class="hljs-string"><span class="hljs-string">'1 hour'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> pg_stat_history_end+(current_hour_diff * <span class="hljs-type"><span class="hljs-type">interval</span></span> <span class="hljs-string"><span class="hljs-string">'1 hour'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> ( aa.wait_event_type <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> backend_type = <span class="hljs-string"><span class="hljs-string">'client backend'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> aa.state = <span class="hljs-string"><span class="hljs-string">'active'</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> count(*) <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> cpu_total <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> t ;</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Contoh</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">SQL CPU TIME : 27:40:15</code> </pre> </div></div><br><h3>  SQL WAITINGS TIME - Total Waktu Tunggu untuk Permintaan </h3><br><div class="spoiler">  <b class="spoiler_title">Minta</b> <div class="spoiler_text"><pre> <code class="pgsql hljs"><span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> t <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> date_trunc(<span class="hljs-string"><span class="hljs-string">'second'</span></span>, timepoint) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> activity_hist.archive_pg_stat_activity aa <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> timepoint <span class="hljs-keyword"><span class="hljs-keyword">BETWEEN</span></span> pg_stat_history_begin+(current_hour_diff * <span class="hljs-type"><span class="hljs-type">interval</span></span> <span class="hljs-string"><span class="hljs-string">'1 hour'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> pg_stat_history_end+(current_hour_diff * <span class="hljs-type"><span class="hljs-type">interval</span></span> <span class="hljs-string"><span class="hljs-string">'1 hour'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> ( aa.wait_event_type <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> aa.state = <span class="hljs-string"><span class="hljs-string">'active'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> backend_type = <span class="hljs-string"><span class="hljs-string">'client backend'</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> count(*) <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> waiting_total <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> t ;</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Contoh</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">SQL WAITINGS TIME : 30:04:09</code> </pre> </div></div><br>  Pertanyaan berikut sepele dan untuk menghemat ruang, detail implementasi dihilangkan: <br><br><div class="spoiler">  <b class="spoiler_title">Contoh</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">| SQL IOTIME : 19:44:50 | SQL READ TIME : 19:44:32 | SQL WRITE TIME : 00:00:17 | | SQL CALLS : 12188248 ------------------------------------------------------------- | SQL SHARED BLOCKS READS : 7997039120 | SQL SHARED BLOCKS HITS : 8868286092 | SQL SHARED BLOCKS HITS/READS % : 110.89 | SQL SHARED BLOCKS DIRTED : 419945 | SQL SHARED BLOCKS WRITTEN : 19857 | | SQL TEMPORARY BLOCKS READS : 7836169 | SQL TEMPORARY BLOCKS WRITTEN : 10683938</code> </pre></div></div><br>  Kami melewati bagian paling menarik <br><br><h2>  STATISTIK TUNGGU </h2><br><h3>  TOP 10 MENUNGGU OLEH TOTAL TUNGGU WAKTU UNTUK PROSES KLIEN </h3><br><div class="spoiler">  <b class="spoiler_title">Minta</b> <div class="spoiler_text"><pre> <code class="pgsql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> wait_event_type , wait_event , get_system_waiting_duration( wait_event_type , wait_event ,pg_stat_history_begin+(current_hour_diff * <span class="hljs-type"><span class="hljs-type">interval</span></span> <span class="hljs-string"><span class="hljs-string">'1 hour'</span></span>) ,pg_stat_history_end+(current_hour_diff * <span class="hljs-type"><span class="hljs-type">interval</span></span> <span class="hljs-string"><span class="hljs-string">'1 hour'</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> duration <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> activity_hist.archive_pg_stat_activity aa <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> timepoint <span class="hljs-keyword"><span class="hljs-keyword">BETWEEN</span></span> pg_stat_history_begin+(current_hour_diff * <span class="hljs-type"><span class="hljs-type">interval</span></span> <span class="hljs-string"><span class="hljs-string">'1 hour'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> pg_stat_history_end+(current_hour_diff * <span class="hljs-type"><span class="hljs-type">interval</span></span> <span class="hljs-string"><span class="hljs-string">'1 hour'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> backend_type != <span class="hljs-string"><span class="hljs-string">'client backend'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> wait_event_type <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> wait_event_type, wait_event <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LIMIT</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span></code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Contoh</b> <div class="spoiler_text"><pre>  + ------------------------------------------------- -----------------------------------
 |  TOP 10 MENUNGGU OLEH TOTAL TUNGGU WAKTU UNTUK PROSES SISTEM
 + ----- + ------------------------------ + ------------ -------- + --------------------
 |  # |  wait_event_type |  wait_event |  durasi
 + ----- + ------------------------------ + ------------ -------- + --------------------
 |  1 |  Aktivitas |  LogicalLauncherMain |  10:43:28
 |  2 |  Aktivitas |  AutoVacuumMain |  10:42:49
 |  3 |  Aktivitas |  WalWriterMain |  10:28:53
 |  4 |  Aktivitas |  CheckpointerMain |  10:23:50
 |  5 |  Aktivitas |  BgWriterMain |  09:11:59
 |  6 |  Aktivitas |  BgWriterHibernate |  01:37:46
 |  7 |  IO |  BufFileWrite |  00:02:35
 |  8 |  LWLock |  buffer_mapping |  00:01:54
 |  9 |  IO |  DataFileRead |  00:01:23
 |  10 |  IO |  WALWrite |  00:00:59
 + ----- + ------------------------------ + ------------ -------- + --------------------
</pre></div></div><br><h3>  TOP 10 MENUNGGU OLEH TOTAL TUNGGU WAKTU UNTUK PROSES KLIEN </h3><br><div class="spoiler">  <b class="spoiler_title">Minta</b> <div class="spoiler_text"><pre> <code class="pgsql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> wait_event_type , wait_event , get_clients_waiting_duration( wait_event_type , wait_event , pg_stat_history_begin+(current_hour_diff * <span class="hljs-type"><span class="hljs-type">interval</span></span> <span class="hljs-string"><span class="hljs-string">'1 hour'</span></span>) , pg_stat_history_end+(current_hour_diff * <span class="hljs-type"><span class="hljs-type">interval</span></span> <span class="hljs-string"><span class="hljs-string">'1 hour'</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> duration <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> activity_hist.archive_pg_stat_activity aa <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> timepoint <span class="hljs-keyword"><span class="hljs-keyword">BETWEEN</span></span> pg_stat_history_begin+(current_hour_diff * <span class="hljs-type"><span class="hljs-type">interval</span></span> <span class="hljs-string"><span class="hljs-string">'1 hour'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> pg_stat_history_end+(current_hour_diff * <span class="hljs-type"><span class="hljs-type">interval</span></span> <span class="hljs-string"><span class="hljs-string">'1 hour'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> backend_type = <span class="hljs-string"><span class="hljs-string">'client backend'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> wait_event_type <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> wait_event_type, wait_event <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LIMIT</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span></code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Contoh</b> <div class="spoiler_text"><pre>  + ----- + ------------------------------ + ------------ -------- + -------------------- + ----------
 |  # |  wait_event_type |  wait_event |  durasi |  % dbtime
 + ----- + ------------------------------ + ------------ -------- + -------------------- + ----------
 |  1 |  Kunci |  transactionid |  08:16: 47 |  6.05
 |  2 |  IO |  DataFileRead |  06: 13: 41 |  4.55
 |  3 |  Batas waktu |  PgSleep |  02: 53: 21 |  2.11
 |  4 |  LWLock |  buffer_mapping |  00:40: 42 |  0,5
 |  5 |  LWLock |  buffer_io |  00:17: 17 |  0,21
 |  6 |  IO |  BufFileWrite |  00:01:34 |  0,02
 |  7 |  Kunci |  tuple |  00: 01: 32 |  0,02
 |  8 |  Klien |  ClientRead |  00:01:19 |  0,02
 |  9 |  IO |  BufFileRead |  00.00: 37 |  0,01
 |  10 |  LWLock |  buffer_content |  00:00: 08 |  0
 + ----- + ------------------------------ + ------------ -------- + -------------------- + ----------
</pre></div></div><br><h3>  JENIS TUNGGU OLEH TOTAL TUNGGU WAKTU, UNTUK PROSES SISTEM </h3><br><div class="spoiler">  <b class="spoiler_title">Minta</b> <div class="spoiler_text"><pre> <code class="pgsql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> wait_event_type , get_system_waiting_type_duration( wait_event_type , pg_stat_history_begin+(current_hour_diff * <span class="hljs-type"><span class="hljs-type">interval</span></span> <span class="hljs-string"><span class="hljs-string">'1 hour'</span></span>) , pg_stat_history_end+(current_hour_diff * <span class="hljs-type"><span class="hljs-type">interval</span></span> <span class="hljs-string"><span class="hljs-string">'1 hour'</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> duration <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> activity_hist.archive_pg_stat_activity aa <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> timepoint <span class="hljs-keyword"><span class="hljs-keyword">BETWEEN</span></span> pg_stat_history_begin+(current_hour_diff * <span class="hljs-type"><span class="hljs-type">interval</span></span> <span class="hljs-string"><span class="hljs-string">'1 hour'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> pg_stat_history_end+(current_hour_diff * <span class="hljs-type"><span class="hljs-type">interval</span></span> <span class="hljs-string"><span class="hljs-string">'1 hour'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> backend_type != <span class="hljs-string"><span class="hljs-string">'client backend'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> wait_event_type <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> wait_event_type <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span></code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Contoh</b> <div class="spoiler_text"><pre>  + ----- + ------------------------------ + ------------ --------
 |  # |  wait_event_type |  durasi
 + ----- + ------------------------------ + ------------ --------
 |  1 |  Aktivitas |  53:08:45
 |  2 |  IO |  00:06:24
 |  3 |  LWLock |  00:03:02
 + ----- + ------------------------------ + ------------ --------
</pre></div></div><br><h3>  JENIS TUNGGU OLEH TOTAL TUNGGU WAKTU, UNTUK PROSES KLIEN </h3><br><div class="spoiler">  <b class="spoiler_title">Minta</b> <div class="spoiler_text"><pre> <code class="pgsql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> wait_event_type , get_clients_waiting_type_duration( wait_event_type , pg_stat_history_begin+(current_hour_diff * <span class="hljs-type"><span class="hljs-type">interval</span></span> <span class="hljs-string"><span class="hljs-string">'1 hour'</span></span>) , pg_stat_history_end+(current_hour_diff * <span class="hljs-type"><span class="hljs-type">interval</span></span> <span class="hljs-string"><span class="hljs-string">'1 hour'</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> duration <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> activity_hist.archive_pg_stat_activity aa <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> timepoint <span class="hljs-keyword"><span class="hljs-keyword">BETWEEN</span></span> pg_stat_history_begin+(current_hour_diff * <span class="hljs-type"><span class="hljs-type">interval</span></span> <span class="hljs-string"><span class="hljs-string">'1 hour'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> pg_stat_history_end+(current_hour_diff * <span class="hljs-type"><span class="hljs-type">interval</span></span> <span class="hljs-string"><span class="hljs-string">'1 hour'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> backend_type = <span class="hljs-string"><span class="hljs-string">'client backend'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> wait_event_type <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> wait_event_type <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span></code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Contoh</b> <div class="spoiler_text"><pre>  + ----- + ------------------------------ + ------------ -------- + --------------------
 |  # |  wait_event_type |  durasi |  % dbtime
 + ----- + ------------------------------ + ------------ -------- + --------------------
 |  1 |  Kunci |  08:18: 19 |  6.07
 |  2 |  IO |  06: 16: 01 |  4.58
 |  3 |  Batas waktu |  02: 53: 21 |  2.11
 |  4 |  LWLock |  00: 58: 12 |  0,71
 |  5 |  Klien |  00:01:19 |  0,02
 |  6 |  IPC |  00.00: 04 |  0
 + ----- + ------------------------------ + ------------ -------- + --------------------
</pre></div></div><br>  Durasi harapan, untuk proses sistem dan permintaan individu. <br><br><h3>  MENUNGGU PROSES SISTEM </h3><br><div class="spoiler">  <b class="spoiler_title">Minta</b> <div class="spoiler_text"><pre> <code class="pgsql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> backend_type , datname , wait_event_type , wait_event , get_backend_type_waiting_duration( backend_type , wait_event_type , wait_event , pg_stat_history_begin+(current_hour_diff * <span class="hljs-type"><span class="hljs-type">interval</span></span> <span class="hljs-string"><span class="hljs-string">'1 hour'</span></span>) , pg_stat_history_end+(current_hour_diff * <span class="hljs-type"><span class="hljs-type">interval</span></span> <span class="hljs-string"><span class="hljs-string">'1 hour'</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> duration <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> activity_hist.archive_pg_stat_activity aa <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> timepoint <span class="hljs-keyword"><span class="hljs-keyword">BETWEEN</span></span> pg_stat_history_begin+(current_hour_diff * <span class="hljs-type"><span class="hljs-type">interval</span></span> <span class="hljs-string"><span class="hljs-string">'1 hour'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> pg_stat_history_end+(current_hour_diff * <span class="hljs-type"><span class="hljs-type">interval</span></span> <span class="hljs-string"><span class="hljs-string">'1 hour'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> backend_type != <span class="hljs-string"><span class="hljs-string">'client backend'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> wait_event_type <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> backend_type , datname , wait_event_type , wait_event <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span></code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Contoh</b> <div class="spoiler_text"><pre>  + ----- + ----------------------------- + ---------- + - ------------------ + ---------------------- + -------- ------------
 |  # |  backend_type |  dbname |  wait_event_type |  wait_event |  durasi
 + ----- + ----------------------------- + ---------- + - ------------------ + ---------------------- + -------- ------------
 |  1 |  peluncur replikasi logis |  |  Aktivitas |  LogicalLauncherMain |  10:43:28
 |  2 |  peluncur autovacuum |  |  Aktivitas |  AutoVacuumMain |  10:42:49
 |  3 |  walwriter |  |  Aktivitas |  WalWriterMain |  10:28:53
 |  4 |  checkpointer |  |  Aktivitas |  CheckpointerMain |  10:23:50
 |  5 |  penulis latar belakang |  |  Aktivitas |  BgWriterMain |  09:11:59
 |  6 |  penulis latar belakang |  |  Aktivitas |  BgWriterHibernate |  01:37:46
 |  7 |  pekerja paralel |  tdb1 |  IO |  BufFileWrite |  00:02:35
 |  8 |  pekerja paralel |  tdb1 |  LWLock |  buffer_mapping |  00:01:41
 |  9 |  pekerja paralel |  tdb1 |  IO |  DataFileRead |  00:01:22
 |  10 |  pekerja paralel |  tdb1 |  IO |  BufFileRead |  00:00:59
 |  11 |  walwriter |  |  IO |  WALWrite |  00:00:57
 |  12 |  pekerja paralel |  tdb1 |  LWLock |  buffer_io |  00:00:47
 |  13 |  pekerja autovacuum |  tdb1 |  LWLock |  buffer_mapping |  00:00:13
 |  14 |  penulis latar belakang |  |  IO |  DataFileWrite |  00:00:12
 |  15 |  checkpointer |  |  IO |  DataFileWrite |  00:00:11
 |  16 |  walwriter |  |  LWLock |  WALWriteLock |  00:00:09
 |  17 |  checkpointer |  |  LWLock |  WALWriteLock |  00:00:06
 |  18 |  penulis latar belakang |  |  LWLock |  WALWriteLock |  00:00:06
 |  19 |  walwriter |  |  IO |  WALInitWrite |  00:00:02
 |  20 |  pekerja autovacuum |  tdb1 |  LWLock |  WALWriteLock |  00:00:02
 |  21 |  walwriter |  |  IO |  WALInitSync |  00:00:02
 |  22 |  pekerja autovacuum |  tdb1 |  IO |  DataFileRead |  00:00:01
 |  23 |  checkpointer |  |  IO |  ControlFileSyncUpdate |  00:00:01
 |  24 |  penulis latar belakang |  |  IO |  WALWrite |  00:00:01
 |  25 |  penulis latar belakang |  |  IO |  DataFileFlush |  00:00:01
 |  26 |  checkpointer |  |  IO |  SLRUFlushSync |  00:00:01
 |  27 |  pekerja autovacuum |  tdb1 |  IO |  WALWrite |  00:00:01
 |  28 |  checkpointer |  |  IO |  DataFileSync |  00:00:01
 + ----- + ----------------------------- + ---------- + - ------------------ + ---------------------- + -------- ------------ </pre></div></div><br><h3>  MENUNGGU SQL - harapan untuk permintaan individu oleh queryid </h3><br><div class="spoiler">  <b class="spoiler_title">Minta</b> <div class="spoiler_text"><pre> <code class="pgsql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> queryid , datname , wait_event_type , wait_event , get_query_waiting_duration( queryid , wait_event_type , wait_event , pg_stat_history_begin+(current_hour_diff * <span class="hljs-type"><span class="hljs-type">interval</span></span> <span class="hljs-string"><span class="hljs-string">'1 hour'</span></span>) , pg_stat_history_end+(current_hour_diff * <span class="hljs-type"><span class="hljs-type">interval</span></span> <span class="hljs-string"><span class="hljs-string">'1 hour'</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> duration <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> activity_hist.archive_pg_stat_activity aa <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> timepoint <span class="hljs-keyword"><span class="hljs-keyword">BETWEEN</span></span> pg_stat_history_begin+(current_hour_diff * <span class="hljs-type"><span class="hljs-type">interval</span></span> <span class="hljs-string"><span class="hljs-string">'1 hour'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> pg_stat_history_end+(current_hour_diff * <span class="hljs-type"><span class="hljs-type">interval</span></span> <span class="hljs-string"><span class="hljs-string">'1 hour'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> backend_type = <span class="hljs-string"><span class="hljs-string">'client backend'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> wait_event_type <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> queryid <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> queryid , datname , wait_event_type , wait_event <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> , <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span></code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Contoh</b> <div class="spoiler_text"><pre>  + ----- + ------------------------- + ---------- + ------ -------------- + -------------------- + -------------- ------ + --------------------
 |  # |  queryid |  dbname |  wait_event_type |  wait_event |  menunggu |  total
 |  |  |  |  |  |  durasi |  durasi
 + ----- + ------------------------- + ---------- + ------ -------------- + -------------------- + -------------- ------ + --------------------
 |  1 |  -8247416849404883188 |  tdb1 |  Klien |  ClientRead |  00.00: 02 |
 |  2 |  -6572922443698419129 |  tdb1 |  Klien |  ClientRead |  00:00:05 |
 |  3 |  -6572922443698419129 |  tdb1 |  IO |  DataFileRead |  00:00: 01 |
 |  4 |  -5917408132400665328 |  tdb1 |  Klien |  ClientRead |  00.00: 04 |
 |  5 |  -4091009262735781873 |  tdb1 |  Klien |  ClientRead |  00:00: 03 |
 |  6 |  -1473395109729441239 |  tdb1 |  Klien |  ClientRead |  00:00: 01 |
 |  7 |  28942442626229688 |  tdb1 |  IO |  BufFileWrite |  00:01:34 |  00:46:06
 |  8 |  28942442626229688 |  tdb1 |  LWLock |  buffer_mapping |  00: 01: 05 |  00:46:06
 |  9 |  28942442626229688 |  tdb1 |  IO |  DataFileRead |  00:00:44 |  00:46:06
 |  10 |  28942442626229688 |  tdb1 |  IO |  BufFileRead |  00.00: 37 |  00:46:06
 |  11 |  28942442626229688 |  tdb1 |  LWLock |  buffer_io |  00:00:35 |  00:46:06
 |  12 |  28942442626229688 |  tdb1 |  Klien |  ClientRead |  00:00:05 |  00:46:06
 |  13 |  28942442626229688 |  tdb1 |  IPC |  MessageQueueReceive |  00:00: 03 |  00:46:06
 |  14 |  28942442626229688 |  tdb1 |  IPC |  BgWorkerShutdown |  00:00: 01 |  00:46:06
 |  15 |  389015618226997618 |  tdb1 |  Kunci |  transactionid |  03.55: 09 |  04:14:15
 |  16 |  389015618226997618 |  tdb1 |  IO |  DataFileRead |  03: 23: 09 |  04:14:15
 |  17 |  389015618226997618 |  tdb1 |  LWLock |  buffer_mapping |  00: 12: 09 |  04:14:15
 |  18 |  389015618226997618 |  tdb1 |  LWLock |  buffer_io |  00:10:18 |  04:14:15
 |  19 |  389015618226997618 |  tdb1 |  Kunci |  tuple |  00:00:35 |  04:14:15
 |  20 |  389015618226997618 |  tdb1 |  LWLock |  WALWriteLock |  00.00: 02 |  04:14:15
 |  21 |  389015618226997618 |  tdb1 |  IO |  DataFileWrite |  00:00: 01 |  04:14:15
 |  22 |  389015618226997618 |  tdb1 |  LWLock |  SyncScanLock |  00:00: 01 |  04:14:15
 |  23 |  389015618226997618 |  tdb1 |  Klien |  ClientRead |  00:00: 01 |  04:14:15
 |  24 |  734234407411547467 |  tdb1 |  Klien |  ClientRead |  00:00:11 |
 |  25 |  734234407411547467 |  tdb1 |  LWLock |  buffer_mapping |  00:00:05 |
 |  26 |  734234407411547467 |  tdb1 |  IO |  DataFileRead |  00.00: 02 |
 |  27 |  1237430309438971376 |  tdb1 |  LWLock |  buffer_mapping |  00:02:18 |  02:45:40
 |  28 |  1237430309438971376 |  tdb1 |  IO |  DataFileRead |  00:00:27 |  02:45:40
 |  29 |  1237430309438971376 |  tdb1 |  Klien |  ClientRead |  00.00: 02 |  02:45:40
 |  30 |  2404820632950544954 |  tdb1 |  Klien |  ClientRead |  00:00: 01 |
 |  31 |  2515308626622579467 |  tdb1 |  Klien |  ClientRead |  00.00: 02 |
 |  32 |  4710212362688288619 |  tdb1 |  LWLock |  buffer_mapping |  00: 03: 08 |  02:18:21
 |  33 |  4710212362688288619 |  tdb1 |  IO |  DataFileRead |  00:00:22 |  02:18:21
 |  34 |  4710212362688288619 |  tdb1 |  Klien |  ClientRead |  00:00: 06 |  02:18:21
 |  35 |  4710212362688288619 |  tdb1 |  LWLock |  buffer_io |  00.00: 02 |  02:18:21
 |  36 |  9150846928388977274 |  tdb1 |  IO |  DataFileRead |  00:01:19 |
 |  37 |  9150846928388977274 |  tdb1 |  LWLock |  buffer_mapping |  00.00: 34 |
 |  38 |  9150846928388977274 |  tdb1 |  Klien |  ClientRead |  00:00:10 |
 |  39 |  9150846928388977274 |  tdb1 |  LWLock |  buffer_io |  00:00: 01 |
 + ----- + ------------------------- + ---------- + ------ -------------- + -------------------- + -------------- ------ + -------------------- </pre></div></div><br><h3>  KLIEN SQL STATICTICS - TOP query </h3><br>  Namun, permintaan untuk menerima lagi sepele dan menghemat ruang, tidak diberikan. <br><br><div class="spoiler">  <b class="spoiler_title">Contohnya</b> <div class="spoiler_text"><pre>  + ------------------------------------------------- -----------------------------------
 |  CLIENT SQL dipesan oleh Elapsed Time
 + -------------------- + ---------- + ---------- + ------ ---- + ---------- + ---------- + --------------------
 |  waktu yang telah berlalu |  panggilan |  % dbtime |  % CPU |  % IO |  dbname |  kueri
 + -------------------- + ---------- + ---------- + ------ ---- + ---------- + ---------- + --------------------
 |  04: 14: 15 |  19 |  3.1 |  10.83 |  11.52 |  tdb1 |  389015618226997618
 |  02:45: 40 |  746 |  2.02 |  4.23 |  0,08 |  tdb1 |  1237430309438971376
 |  02:18: 21 |  749 |  1.69 |  3.39 |  0,1 |  tdb1 |  4710212362688288619
 |  00: 46: 06 |  375 |  0,56 |  0,94 |  0,41 |  tdb1 |  28942442626229688
 + -------------------- + ---------- + ---------- + ------ ---- + ---------- + ---------- + --------------------
 |  CLIENT SQL dipesan oleh CPU Time
 + -------------------- + ---------- + ---------- + ------ ---- + ---------- + ---------- + ---------- + ------------ --------
 |  waktu cpu |  panggilan |  % dbtime | total_time |  % CPU |  % IO |  dbname |  kueri
 + -------------------- + ---------- + ---------- + ------ ---- + ---------- + ---------- + ---------- + ------------ --------
 |  02: 59: 49 |  19 |  3.1 |  04: 14: 15 |  10.83 |  11.52 |  tdb1 |  389015618226997618
 |  01:10 - 12 |  746 |  2.02 |  02:45: 40 |  4.23 |  0,08 |  tdb1 |  1237430309438971376
 |  00: 56:15 |  749 |  1.69 |  02:18: 21 |  3.39 |  0,1 |  tdb1 |  4710212362688288619
 |  00:15:35 |  375 |  0,56 |  00: 46: 06 |  0,94 |  0,41 |  tdb1 |  28942442626229688
 + -------------------- + ---------- + ---------- + ------ ---- + ---------- + ---------- + ---------- + ------------ --------
 |  CLIENT SQL dipesan oleh Pengguna I / O Waktu Tunggu
 + -------------------- + ---------- + ---------- + ------ ---- + ---------- + ---------- + ---------- + ------------ --------
 |  io_unggu waktu |  panggilan |  % dbtime | total_time |  % CPU |  % IO |  dbname |  kueri
 + -------------------- + ---------- + ---------- + ------ ---- + ---------- + ---------- + ---------- + ------------ --------
 |  03: 23: 10 |  19 |  3.1 |  04: 14: 15 |  10.83 |  11.52 |  tdb1 |  389015618226997618
 |  00: 02: 54 |  375 |  0,56 |  00: 46: 06 |  0,94 |  0,41 |  tdb1 |  28942442626229688
 |  00:00:27 |  746 |  2.02 |  02:45: 40 |  4.23 |  0,08 |  tdb1 |  1237430309438971376
 |  00:00:22 |  749 |  1.69 |  02:18: 21 |  3.39 |  0,1 |  tdb1 |  4710212362688288619
 + -------------------- + ---------- + ---------- + ------ ---- + ---------- + ---------- + ---------- + ------------ --------
 |  CLIENT SQL dipesan oleh Shared Buffers Reads
 + -------------------- + ---------- + ---------- + ------ ---- + ---------- + ---------- + ---------- + ------------ --------
 |  buffer berbunyi |  panggilan |  % dbtime | total_time |  % CPU |  % IO |  dbname |  kueri
 + -------------------- + ---------- + ---------- + ------ ---- + ---------- + ---------- + ---------- + ------------ --------
 |  1056388566 |  19 |  3.1 |  04: 14: 15 |  10.83 |  11.52 |  tdb1 |  389015618226997618
 |  11709251 |  375 |  0,56 |  00: 46: 06 |  0,94 |  0,41 |  tdb1 |  28942442626229688
 |  3439004 |  746 |  2.02 |  02:45: 40 |  4.23 |  0,08 |  tdb1 |  1237430309438971376
 |  3373330 |  749 |  1.69 |  02:18: 21 |  3.39 |  0,1 |  tdb1 |  4710212362688288619
 + -------------------- + ---------- + ---------- + ------ ---- + ---------- + ---------- + ---------- + ------------ --------
 |  CLIENT SQL dipesan oleh Disk Reads Time
 + -------------------- + ---------- + ---------- + ------ ---- + ---------- + ---------- + ---------- + ------------ --------
 |  baca waktu |  panggilan |  % dbtime | total_time |  % CPU |  % IO |  dbname |  kueri
 + -------------------- + ---------- + ---------- + ------ ---- + ---------- + ---------- + ---------- + ------------ --------
 |  02: 16: 30 |  19 |  3.1 |  04: 14: 15 |  10.83 |  11.52 |  tdb1 |  389015618226997618
 |  00:10:50 |  375 |  0,56 |  00: 46: 06 |  0,94 |  0,41 |  tdb1 |  28942442626229688
 |  00: 01: 10 |  749 |  1.69 |  02:18: 21 |  3.39 |  0,1 |  tdb1 |  4710212362688288619
 |  00.00: 57 |  746 |  2.02 |  02:45: 40 |  4.23 |  0,08 |  tdb1 |  1237430309438971376
 + -------------------- + ---------- + ---------- + ------ ---- + ---------- + ---------- + ---------- + ------------ --------
 |  CLIENT SQL dipesan oleh Eksekusi
 + -------------------- + ---------- + ---------- + ------ ---- + ---------- + ---------- + ---------- + ------------ --------
 |  panggilan |  baris |  % dbtime | total_time |  % CPU |  % IO |  dbname |  kueri
 + -------------------- + ---------- + ---------- + ------ ---- + ---------- + ---------- + ---------- + ------------ --------
 |  749 |  749 |  1.69 |  02:18: 21 |  3.39 |  0,1 |  tdb1 |  4710212362688288619
 |  746 |  746 |  2.02 |  02:45: 40 |  4.23 |  0,08 |  tdb1 |  1237430309438971376
 |  375 |  0 |  0,56 |  00: 46: 06 |  0,94 |  0,41 |  tdb1 |  28942442626229688
 |  19 |  19 |  3.1 |  04: 14: 15 |  10.83 |  11.52 |  tdb1 |  389015618226997618
 + -------------------- + ---------- + ---------- + ------ ---- + ---------- + ---------- + ---------- + ------------ -------- </pre></div></div><br><h2>  Ringkasan </h2><br>  Dengan menggunakan permintaan yang diajukan dan pelaporan yang dihasilkan, Anda bisa mendapatkan gambaran yang lebih lengkap untuk menganalisis dan memecahkan masalah penurunan kinerja untuk permintaan individual dan seluruh kluster secara keseluruhan. <br><br><h2>  Pengembangan </h2><br>  Sejauh ini, rencana pengembangan adalah sebagai berikut: <br><br><ul><li>  Pelaporan pelengkap dengan riwayat kunci.  Permintaan sedang diuji dan akan dikirimkan segera. </li><li>  Gunakan ekstensi TimescaleDB untuk menyimpan sejarah pg_stat_activity dan pg_locks. </li><li>  Siapkan solusi batch di github untuk penyebaran massal di basis produksi. </li></ul><br>  Dilanjutkan ... </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id467575/">https://habr.com/ru/post/id467575/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id467559/index.html">Acara digital di Moskow dari 16 September hingga 22 September</a></li>
<li><a href="../id467561/index.html">Satu Hari dari Dukungan Pengguna PVS-Studio</a></li>
<li><a href="../id467563/index.html">Suatu hari dari dukungan pengguna PVS-Studio</a></li>
<li><a href="../id467567/index.html">Dukungan untuk warna 24-bit di terminal dalam banyak ssh + tmux + neovim</a></li>
<li><a href="../id467573/index.html">8 Filter Analytics Teratas yang Bermanfaat</a></li>
<li><a href="../id467577/index.html">Ulasan Mono: perangkat combo Playme P600SG teratas</a></li>
<li><a href="../id467581/index.html">Render warna yang benar dari retroconsoles di emulator</a></li>
<li><a href="../id467583/index.html">Manajer lisensi LMTOOLS. Mendaftar lisensi untuk pengguna produk Autodesk</a></li>
<li><a href="../id467587/index.html">Semua konten Wi-Fi berguna di satu tempat</a></li>
<li><a href="../id467589/index.html">Apa yang perlu Anda ketahui tentang GDPR pada tahun 2019</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>