<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëÇ üî§ üßò Streaming WebRTC bas√© sur le cloud sur DigitalOcean ‚§¥Ô∏è üè° üíó</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="L'h√©bergement cloud populaire DigitalOcean a r√©cemment lanc√© son nouveau march√© vendant des images pr√©configur√©es qui peuvent aider √† d√©ployer rapidem...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Streaming WebRTC bas√© sur le cloud sur DigitalOcean</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/flashphoner/blog/476554/"><p><img src="https://habrastorage.org/webt/qu/k2/rk/quk2rkqml_odwigj2khcbkjsgaa.png"></p><br><p>  L'h√©bergement cloud populaire DigitalOcean a r√©cemment lanc√© son nouveau march√© vendant des images pr√©configur√©es qui peuvent aider √† d√©ployer rapidement un serveur d'applications.  C'est un peu comme AWS, mais DO est pour ceux qui utilisent d√©j√† les services de ce fournisseur.  Voyons comment d√©ployer un serveur simple pour la diffusion WebRTC avec un compte DO moyennant des frais de 10 $ / mois bas√©s sur Flashphoner WebCallServer et comment un tel serveur peut √™tre utile. </p><a name="habracut"></a><br><h2 id="deployment">  D√©ploiement </h2><br><p>  Entrez le compte DO, choisissez l'image Flashphoner WebCallServer dans Marketplace et appuyez sur "Cr√©er une droplet Flashphoner Web Call Server". </p><br><p><img src="https://habrastorage.org/webt/3l/_f/35/3l_f35kar7y9bm3thyu1hvynmbk.png"></p><br><p>  Choisissez les performances du serveur et le plan tarifaire.  DO proposera automatiquement un produit de milieu de gamme, mais nous sommes int√©ress√©s par le prix minimum. </p><br><p><img src="https://habrastorage.org/webt/er/y4/ck/ery4ckt3mvppfgrv10ui5a9st9u.png"></p><br><p>  Choisissez la r√©gion d'emplacement du centre de donn√©es, par exemple, Francfort. </p><br><p><img src="https://habrastorage.org/webt/dt/sw/3g/dtsw3gy3cy76buk6p2dgtikr_oc.png"></p><br><p>  Choisissez le type d'authentification, par exemple, un mot de passe √† usage unique. </p><br><p><img src="https://habrastorage.org/webt/jm/vn/5g/jmvn5g5yy6m702li7ovvxluzu8a.png"></p><br><p>  Sp√©cifiez le nombre de serveurs (nous sommes int√©ress√©s par un serveur pour l'instant) et nommez le serveur.  Ce nom sera enregistr√© parmi d'autres emplacements dans / etc / hostname. </p><br><br><p>  Appuyez sur "Cr√©er une goutte" </p><br><p><img src="https://habrastorage.org/webt/fm/q1/ql/fmq1qlgnbpz5bq7r8ncqiyr40sw.png"></p><br><p>  D√®s que le serveur est cr√©√©, il d√©marre automatiquement.  Nous pouvons maintenant nous y connecter via SSH et modifier le mot de passe si un mot de passe √† usage unique a √©t√© choisi comme m√©thode d'authentification.  Une br√®ve description de Flashphoner WebCallServer avec des liens vers la documentation sera affich√©e dans la console. </p><br><p><img src="https://habrastorage.org/webt/rm/h2/xc/rmh2xcmpcjs5tvut5aybhumulgi.png"></p><br><h2 id="this-is-a-test-can-you-see-me">  "Ceci est un test. Pouvez-vous me voir?" </h2><br><p>  Au moment o√π Flashphoner WebCallServer est d√©marr√©, il est en mode pr√™t √† l'emploi, une licence d'essai de 30 jours est activ√©e automatiquement.  L'interface Web est utilis√©e pour tester les fonctions cl√©s.  Nous allons simplement v√©rifier la publication et la lecture du flux WebRTC. </p><br><p>  Ouvrez dans le navigateur la page <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https: // droplet_ip: 8444 / admin /</a> .  Le serveur est livr√© avec un certificat auto-sign√© par d√©faut;  par cons√©quent, nous devrons confirmer l'exception de s√©curit√©.  Les certificats peuvent √™tre remplac√©s ult√©rieurement par les v√¥tres.  Entrez le nom d'utilisateur et le mot de passe ( <em>d√©mo</em> par d√©faut). </p><br><p><img src="https://habrastorage.org/webt/-a/xu/qw/-axuqw0izvkcml9ycx4qev8dbam.png"></p><br><p>  Choisissez l'exemple de streaming bidirectionnel dans la barre lat√©rale, appuyez sur "Connecter", puis sur "Publier".  Pour lire le flux, appuyez sur "Play". </p><br><p><img src="https://habrastorage.org/webt/gg/uu/vg/gguuvghawemad1ch60ka4voke0a.png"></p><br><h2 id="for-a-handful-of-dollars">  Pour une poign√©e de dollars </h2><br><p>  Que peut faire un serveur √† 10 $ / mois en tant que plate-forme mat√©rielle pour la diffusion WebRTC?  Voyons ce que Digital Ocean offre en termes de processeur </p><br><pre><code class="bash hljs">lscpu</code> </pre> <br><p><img src="https://habrastorage.org/webt/gz/my/dw/gzmydw2rmby7xbf_jfefcegdj14.png"></p><br><p>  et m√©moire </p><br><pre> <code class="bash hljs">free -h</code> </pre> <br><p><img src="https://habrastorage.org/webt/0f/m8/fl/0fm8fllsykumuxadaai1zqlf-lk.png"></p><br><p>  En ex√©cutant des tests de charge sur le serveur, nous pouvons voir que les capacit√©s de performances du serveur ne sont pas si petites. </p><br><p>  Par exemple, nous allons publier un √©chantillon de flux et voir combien d'utilisateurs pourront publier ce flux simultan√©ment sans d√©passer 90% des ressources du processeur: </p><br><div class="scrollable-table"><table><thead><tr><th>  R√©solution </th><th>  D√©bit Kbps </th><th>  Nombre de publications </th><th>  Nombre de t√©l√©spectateurs </th></tr></thead><tbody><tr><td>  360p </td><td>  1300 </td><td>  1 </td><td>  70 </td></tr><tr><td>  480p </td><td>  1800 </td><td>  1 </td><td>  70 </td></tr><tr><td>  720p </td><td>  3000 </td><td>  1 </td><td>  50 </td></tr></tbody></table></div><br><p>  Avec plusieurs publications simultan√©es, le nombre maximum de flux trait√©s reste le m√™me;  lorsque 7 flux sont publi√©s, jusqu'√† 10 t√©l√©spectateurs peuvent s'abonner √† chacun. </p><br><p>  Supposons que nous devions transcoder le flux sur le serveur afin de r√©duire la r√©solution ou d'aligner le FPS.  Pour ce faire, nous allons v√©rifier le nombre maximum de publications: </p><br><div class="scrollable-table"><table><thead><tr><th>  R√©solution </th><th>  D√©bit Kbps </th><th>  Nombre de flux </th></tr></thead><tbody><tr><td>  360p </td><td>  1300 </td><td>  5 </td></tr><tr><td>  480p </td><td>  1800 </td><td>  3 </td></tr><tr><td>  720p </td><td>  3000 </td><td>  2 </td></tr></tbody></table></div><br><p>  De cette mani√®re, le serveur avec le prix le plus bas sur DO avec les param√®tres 1 c≈ìur de processeur, 2 Go de RAM, 2 To de trafic convient non seulement pour tester le streaming WebRTC mais aussi pour les petits projets.  Par exemple, il est possible de </p><br><ul><li>  fournir un flux via WebRTC √† partir d'une cam√©ra IP afin d'assurer une surveillance vid√©o interne de base; </li><li>  organiser un webinaire pour le personnel d'une petite entreprise; </li><li>  d√©ployez votre propre radio Internet (les flux audio n√©cessitent moins de ressources processeur). </li></ul><br><p>  En outre, ce serveur peut √™tre consid√©r√© comme une plate-forme de r√©f√©rence pour l'estimation de la mise √† l'√©chelle.  C'est ce dont nous traiterons plus loin. </p><br><h2 id="i-deserve-more">  "Je m√©rite plus!" </h2><br><p>  Pour la plupart, les r√®gles sont assez simples: il n'y a pas trop de c≈ìurs et trop de m√©moire.  Selon le nombre d'utilisateurs pr√©vu, les recommandations de configuration DO seront les suivantes: </p><br><div class="scrollable-table"><table><thead><tr><th>  Nombre d'utilisateurs </th><th>  vCPU </th><th>  RAM, Gb </th><th>  Trafic, TB </th><th>  Cas d'utilisation </th></tr></thead><tbody><tr><td>  jusqu'√† 200 </td><td>  4 </td><td>  8 </td><td>  5 </td><td>  Syst√®me de vid√©osurveillance </td></tr><tr><td>  jusqu'√† 500 </td><td>  8 </td><td>  16 </td><td>  6 </td><td>  Webinaires </td></tr><tr><td>  jusqu'√† 1000 </td><td>  16 </td><td>  64 </td><td>  9 </td><td>  Chat vid√©o </td></tr><tr><td>  jusqu'√† 2000 </td><td>  20 </td><td>  96 </td><td>  10 </td><td>  Streaming vid√©o HD </td></tr></tbody></table></div><br><p>  Si une nouvelle augmentation du nombre d'utilisateurs est pr√©vue, nous devrons d√©ployer le serveur CDN projetant 1 serveur Edge pour 2 000 utilisateurs.  Supposons que nous devions fournir une vid√©o HD, le nombre de t√©l√©spectateurs pr√©vu est de 10000. Dans ce cas, 2 serveurs Origin pour la publication et 5 serveurs Edge pour la visualisation seront n√©cessaires. </p><br><p><img src="https://habrastorage.org/webt/d2/ky/xw/d2kyxwehzmckmsc09bltxy5epes.png"></p><br><p>  Exemple de configuration: </p><br><ul><li>  Origine 1 </li></ul><br><pre> <code class="plaintext hljs">cdn_enabled=true cdn_ip=origin1.flashponer.com cdn_nodes_resolve_ip=false cdn_role=origin</code> </pre> <br><ul><li>  Origine 2 </li></ul><br><pre> <code class="plaintext hljs">cdn_enabled=true cdn_ip=origin2.flashponer.com cdn_point_of_entry=origin1.flashponer.com cdn_nodes_resolve_ip=false cdn_role=origin</code> </pre> <br><ul><li>  Edge 1 - Edge 5 (ici, nous modifions uniquement l'adresse du serveur dans le param√®tre <code>cdn_ip</code> ) </li></ul><br><pre> <code class="plaintext hljs">cdn_enabled=true cdn_ip=edge1.flashphoner.com cdn_point_of_entry=origin1.flashponer.com cdn_nodes_resolve_ip=false cdn_role=edge</code> </pre> <br><p>  Le CDN peut √©galement √™tre utile si les utilisateurs sont dispers√©s g√©ographiquement.  Par exemple, nos publics cibles sont bas√©s en Europe et en Am√©rique. </p><br><p><img src="https://habrastorage.org/webt/gd/45/2b/gd452bd762x9ou7zie8svwpvi8c.png"></p><br><p>  Exemple de configuration: </p><br><ul><li>  Origine UE </li></ul><br><pre> <code class="plaintext hljs">cdn_enabled=true cdn_ip=origin_eu.flashponer.com cdn_nodes_resolve_ip=false cdn_role=origin cdn_groups=EU</code> </pre> <br><ul><li>  Origine US </li></ul><br><pre> <code class="plaintext hljs">cdn_enabled=true cdn_ip=origin_us.flashponer.com cdn_point_of_entry=origin_eu.flashponer.com cdn_nodes_resolve_ip=false cdn_role=origin cdn_groups=US</code> </pre> <br><ul><li>  Edge 1 EU </li></ul><br><pre> <code class="plaintext hljs">cdn_enabled=true cdn_ip=edge1_eu.flashphoner.com cdn_point_of_entry=origin_eu.flashponer.com cdn_nodes_resolve_ip=false cdn_role=edge cdn_groups=EU</code> </pre> <br><ul><li>  Edge 1 US </li></ul><br><pre> <code class="plaintext hljs">cdn_enabled=true cdn_ip=edge1_us.flashphoner.com cdn_point_of_entry=origin_eu.flashponer.com cdn_nodes_resolve_ip=false cdn_role=edge cdn_groups=US</code> </pre> <br><p>  Plus le nombre de t√©l√©spectateurs est grand, plus les appareils de lecture et les canaux vers ces appareils sont diversifi√©s.  Pour fournir une bonne qualit√© de diffusion √† divers appareils, il sera tr√®s probablement n√©cessaire de transcoder la vid√©o, ce qui peut √™tre impos√© sur des serveurs Transcoder sp√©ciaux. </p><br><p><img src="https://habrastorage.org/webt/da/wi/n1/dawin1lf1bz_cqnovovjmcg5tms.png"></p><br><p>  Exemple de configuration: </p><br><ul><li>  Origine </li></ul><br><pre> <code class="plaintext hljs">cdn_enabled=true cdn_ip=origin.flashponer.com cdn_nodes_resolve_ip=false cdn_role=origin cdn_groups=default</code> </pre> <br><ul><li>  Transcoder EU </li></ul><br><pre> <code class="plaintext hljs">cdn_enabled=true cdn_ip=transcoder_eu.flashponer.com cdn_point_of_entry=origin.flashponer.com cdn_nodes_resolve_ip=false cdn_role=transcoder cdn_groups=EU</code> </pre> <br><ul><li>  Edge 1 EU </li></ul><br><pre> <code class="plaintext hljs">cdn_enabled=true cdn_ip=edge1_eu.flashphoner.com cdn_point_of_entry=origin.flashponer.com cdn_nodes_resolve_ip=false cdn_role=edge cdn_groups=EU</code> </pre> <br><p>  Comme nous l'avons constat√© au cours du test, le nombre de c≈ìurs de processeur est essentiel aux fins du transcodage.  La configuration la plus appropri√©e dans la ligne de configuration optimis√©e pour le processeur est la plus ch√®re - 32 vCPU, 64 Go de RAM.  Dans le m√™me temps, les prix des configurations de CPU similaires en quantit√© et avec une plus grande m√©moire dans d'autres lignes peuvent √™tre consid√©rablement plus √©lev√©s.  Malheureusement, on ne parvient pas √† √©conomiser de l'argent sur les transcodeurs: comme la vid√©o est encod√©e image par image, il doit y avoir suffisamment d'espace m√©moire pour toutes les images et suffisamment de processeurs pour traiter tous les flux. </p><br><p>  Pendant le d√©ploiement CDN, la cr√©ation simultan√©e de plusieurs serveurs avec la m√™me configuration sera utile.  Cependant, dans le cas de serveurs Edge et Transcoder CDN de m√™me type dispers√©s g√©ographiquement, ils devront √™tre h√©berg√©s dans diff√©rents centres de donn√©es. </p><br><h2 id="conclusion">  Conclusion </h2><br><p>  Pour conclure, nous avons d√©ploy√© et test√© un petit serveur pour le streaming vid√©o WebRTC √† faible latence sur Digital Ocean et avons constat√© qu'un serveur avec une configuration minimale est un bon choix non seulement pour les tests mais aussi pour les petits projets.  Nous avons obtenu les donn√©es de mise √† l'√©chelle en fonction du nombre pr√©vu de t√©l√©spectateurs et avons abord√© le sujet du d√©ploiement CDN, qui en tant que tel m√©rite d'√™tre discut√© dans un article s√©par√©.  Pour continuer, veuillez rester avec nous. </p><br><h2 id="related-links">  Liens connexes </h2><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Image Flashphoner WebCallServer dans DigitalOcean Marketplace</a> - image du serveur d'appels Web dans DigitalOcean. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">CDN pour le streaming WebRTC √† faible latence</a> - R√©seau de distribution de contenu bas√© sur le serveur d'appels Web. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr476554/">https://habr.com/ru/post/fr476554/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr476538/index.html">Protocoles de distribution de cl√©s cryptographiques asym√©triques: Denning - Sacco, DASS, Wu Lama</a></li>
<li><a href="../fr476540/index.html">Smart Home - commande vocale en trois √©tapes. Framboise + HomeKit</a></li>
<li><a href="../fr476546/index.html">Streaming WebRTC Cloud chez DigitalOcean</a></li>
<li><a href="../fr476548/index.html">Qu'est-ce que l'overclocking et la r√©duction des effectifs ont en commun?</a></li>
<li><a href="../fr476550/index.html">Slurm Basic √† Moscou. Deuxi√®me jour Mizaru, Kikazaru, Iwazaru et le support technique sont toujours de service</a></li>
<li><a href="../fr476556/index.html">R√©cit et "donjons": comment un concepteur de jeux pour associer des lieux √† une intrigue</a></li>
<li><a href="../fr476558/index.html">Test ONYX BOOX Max 3: lecteur d'√©cran maximum</a></li>
<li><a href="../fr476566/index.html">Comment comprendre si les actifs num√©riques sont des titres? Instruction SEC</a></li>
<li><a href="../fr476570/index.html">Opinion priv√©e sur Yandex.Turbo</a></li>
<li><a href="../fr476576/index.html">JSON-RPC? Prenez le REST d√©licat</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>