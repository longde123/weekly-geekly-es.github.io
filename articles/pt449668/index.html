<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚òïÔ∏è ‚ö™Ô∏è üõÄüèø Notas do provedor de IoT. Armadilhas do levantamento de medidores de servi√ßos p√∫blicos üå≤ üññüèΩ üëèüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ol√° queridos amantes da Internet das Coisas. Neste artigo, gostaria de falar novamente sobre servi√ßos de habita√ß√£o e comunit√°rios e uma pesquisa sobre...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Notas do provedor de IoT. Armadilhas do levantamento de medidores de servi√ßos p√∫blicos</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/449668/">  Ol√° queridos amantes da Internet das Coisas.  Neste artigo, gostaria de falar novamente sobre servi√ßos de habita√ß√£o e comunit√°rios e uma pesquisa sobre dispositivos de medi√ß√£o. <br><br>  Periodicamente, outro grande jogador de telecomunica√ß√µes diz em quanto tempo ele entrar√° neste mercado e esmagar√° todos.  Cada vez com essas hist√≥rias, penso: "pessoal, boa sorte!" <br>  Voc√™ n√£o tem id√©ia de onde est√° subindo. <br><br>  Para que voc√™ entenda a escala do problema, descreverei brevemente uma pequena parte de nossa experi√™ncia no desenvolvimento da plataforma Smart City.  A parte dele respons√°vel pelo agendamento. <br><br><img src="https://habrastorage.org/webt/xu/49/vl/xu49vludx9l7aqn72w0jfxfhndo.jpeg"><br><br><a name="habracut"></a><h3>  Ideia geral e primeiras dificuldades </h3><br>  Se n√£o estamos falando de dispositivos de medi√ß√£o individuais, mas daqueles que est√£o em por√µes, caldeiras e empresas, ent√£o a maioria deles est√° agora equipada com uma sa√≠da telem√©trica.  Com menos frequ√™ncia, com mais frequ√™ncia - RS-485/232 ou Ethernet.  Como regra, os dispositivos de medi√ß√£o com mais "p√£o" s√£o aqueles que consideram o calor.  S√£o eles que est√£o prontos para pagar pelo envio, em primeiro lugar. <br>  J√° mencionei em detalhes em meu artigo os recursos do RS-485.  Em resumo, √© apenas uma interface de transfer√™ncia de dados.  Em ess√™ncia - os requisitos para pulsos el√©tricos e linhas de comunica√ß√£o.  A descri√ß√£o dos pacotes vai para o padr√£o de transfer√™ncia de dados, que roda em cima do RS-485.  E que tipo de padr√£o estar√° l√° - √© deixado para o fabricante.  Frequentemente Modbus, mas n√£o √© obrigat√≥rio.  Mesmo se o Modbus, ele ainda pode ser ligeiramente modificado. <br><br>  De fato, para cada medidor, voc√™ precisa do seu pr√≥prio script de pesquisa, que sabe "conversar" com ele e interrog√°-lo.  Isso significa que o sistema de despacho √© um conjunto de scripts para cada contador individual.  Um banco de dados onde tudo isso √© armazenado.  E uma certa interface de usu√°rio na qual ele pode gerar o relat√≥rio de que precisa. <br><br><img src="https://habrastorage.org/webt/_o/5_/r8/_o5_r8yi41f7wlnhbwxbu0bajny.png"><br><br>  Parece f√°cil.  O diabo, como sempre, est√° nos detalhes. <br><br>  Vamos come√ßar com a primeira parte. <br><br><h3>  Scripts </h3><br>  Como escrev√™-los?  Obviamente, compre um medidor, pegue-o, aprenda a se comunicar com ele e integr√°-lo a uma plataforma comum. <br><br>  Infelizmente, esta solu√ß√£o cobre apenas parte de nossas necessidades.  Como regra, um contador popular tem v√°rias gera√ß√µes e o script para cada gera√ß√£o pode ser diferente.  √Äs vezes um pouco, √†s vezes significativamente.  Comprando algo, voc√™ obt√©m a √∫ltima gera√ß√£o.  √â muito prov√°vel que o assinante seja algo mais antigo.  N√£o √© mais vendido nas lojas.  E o assinante n√£o alterar√° o n√≥ de medi√ß√£o. <br><br>  Da√≠ o primeiro problema.  Escrever esses scripts √© um monte de desenvolvedores e engenheiros de software "no terreno".  Compramos a √∫ltima gera√ß√£o, escrevemos alguns modelos iniciais e depois modificamos em dispositivos reais.  Fazer isso no laborat√≥rio n√£o √© realista, apenas durante o trabalho com assinantes ao vivo. <br><br>  Demoramos muito tempo para criar esse pacote.  Agora o algoritmo est√° resolvido.  Os modelos iniciais eram constantemente ajustados e complementados, dependendo do que conhecemos em nossa pr√°tica.  Obviamente, o assinante foi avisado se, de repente, seu contador fosse um pouco "n√£o assim".  Quando esse dispositivo aparece, ele √© conectado de acordo com o esquema padr√£o e o script de pesquisa √© modificado ao longo do caminho.  No momento da integra√ß√£o, o assinante trabalha de gra√ßa.  Ele √© notificado de que ainda vive no modo de teste.  O pr√≥prio processo de integra√ß√£o √© algo imprevis√≠vel.  Acontece que voc√™ precisa fazer um m√≠nimo de corre√ß√µes.  H√° um processo complexo com uma visita de estudo, escavando literatura e superando consecutivamente um ancinho. <br><br>  A tarefa n√£o √© simples, mas solucion√°vel.  O resultado √© um script de trabalho.  Quanto maior a biblioteca de scripts, mais f√°cil √© viver. <br><br>  O segundo problema. <br><br><h3>  Cart√µes tecnol√≥gicos de conex√£o </h3><br>  Para torn√°-lo consciente da complexidade deste trabalho, darei um exemplo.  Pegue o medidor de calor VKT-7 extremamente popular. <br><br>  O nome em si n√£o significa nada para n√≥s.  O VKT-7 possui v√°rias solu√ß√µes de ferro.  Que tipo de interface est√° dentro? <br><br><img src="https://habrastorage.org/webt/6a/vj/2v/6avj2vxzeg84mfssvgarpqkyb-4.jpeg"><br><br>  Existem op√ß√µes diferentes.  Pode haver uma sa√≠da no bloco DB-9 padr√£o (este √© o RS-232).  Poderia ser apenas um bloco de terminais com contatos RS-485.  Talvez at√© uma placa de rede com RJ-45 (neste caso, o ModBus esteja embalado em Ethernet). <br><br>  Ou talvez nada.  Apenas um metro.  Voc√™ pode instalar uma interface de sa√≠da, que √© vendida separadamente pelo fabricante e custa dinheiro.  O principal problema - para instal√°-lo, voc√™ precisa abrir o balc√£o e quebrar os selos.  Ou seja, uma organiza√ß√£o fornecedora de recursos est√° inclu√≠da nesse processo.  Ela √© notificada de que os selos ser√£o quebrados, um dia √© marcado e nosso engenheiro, na presen√ßa de um representante do recurso, realiza as melhorias necess√°rias, ap√≥s as quais o medidor √© selado novamente. <br><br>  Dependendo da interface instalada, um refinamento adicional √© realizado.  Por exemplo, decidimos conectar um medidor para o fio.  Essa √© a op√ß√£o mais f√°cil, se nosso switch estiver a 100 metros de acessibilidade, ser√° redundante ser mais s√°bio com o LoRa.  Cabo mais f√°cil para a nossa rede, em uma VLAN isolada. <br><br>  O RS-485/232 precisa de um conversor Ethernet.  Muitos se lembrar√£o imediatamente do MOX, mas √© caro.  Para nossas solu√ß√µes, escolhemos uma solu√ß√£o chinesa mais barata. <br><br>  Se a sa√≠da for Ethernet imediatamente, um conversor n√£o ser√° necess√°rio. <br><br>  Pergunta  Suponha que definimos n√≥s mesmos a sa√≠da da interface.  Pode facilitar a vida dele e instalar a Ethernet imediatamente em qualquer lugar? <br><br>  Isso nem sempre √© poss√≠vel.  Devemos olhar para o desempenho do caso.  Ele pode n√£o ter o orif√≠cio certo para a interface se levantar como deveria.  E o balc√£o, lembro-me, est√° em nosso por√£o.  Ou na sala da caldeira.  H√° alta umidade, o aperto n√£o pode ser quebrado.  Terminar o arquivo com um arquivo √© uma m√° ideia.  Melhor colocar algo que inicialmente n√£o requer grandes altera√ß√µes.  Freq√ºentemente - o RS-485 √© a √∫nica sa√≠da. <br><br>  Mais longe.  O medidor est√° conectado √† energia garantida?  Caso contr√°rio, ele funciona com bateria.  Nesse modo, ele foi projetado para pesquisa manual uma vez por m√™s por tr√™s minutos.  O apelo constante ao VKT-7 descarrega a bateria.  Portanto, voc√™ precisa obter energia garantida e instalar um conversor de tens√£o. <br><br>  Para cada fabricante de medidor, o m√≥dulo de energia √© diferente.  Pode ser uma unidade externa em um trilho DIN ou um conversor integrado. <br><br>  Acontece que um conjunto de diferentes interfaces e m√≥dulos de energia para cada medidor sempre deve ser armazenado em nosso armaz√©m.  A nomenclatura √© impressionante. <br><br>  Obviamente, tudo isso ser√° pago pelo assinante.  Mas ele n√£o vai esperar um m√™s at√© que o dispositivo desejado chegue.  E ele precisa de uma estimativa para conex√£o aqui e agora.  Portanto, o estoque tecnol√≥gico cai sobre nossos ombros. <br><br>  Tudo o que descrevi se transforma em um mapa t√©cnico claro de conex√£o, para que os engenheiros de campo n√£o pensem que tipo de animal encontraram no por√£o e o que precisam para o seu trabalho. <br><br>  A lista de tarefas √© adjacente aos regulamentos gerais de conex√£o.  Afinal, n√£o basta incluir o contador em nossa rede, voc√™ ainda precisa jogar a mesma VLAN na porta do switch, √© necess√°rio realizar diagn√≥sticos, fazer uma pesquisa de teste.  N√≥s nos esfor√ßamos para automatizar todo o processo, tanto quanto poss√≠vel, a fim de evitar erros e n√£o atrair as for√ßas extras dos engenheiros. <br><br>  Bem, eles escreveram mapas t√©cnicos, regulamentos, automa√ß√£o.  Log√≠stica estabelecida. <br><br><h3>  Onde mais est√£o as armadilhas √† espreita? </h3><br>  Os dados s√£o lidos e derramados no banco de dados. <br><br>  O assinante desses n√∫meros n√£o √© quente nem frio.  Ele precisa de um relat√≥rio.  De prefer√™ncia na forma em que ele √© usado.  Melhor ainda, se imediatamente na forma de um relat√≥rio que ele entende, que ele pode imprimir, coloque uma assinatura e entregue.  Isso significa que voc√™ precisa de uma interface simples e intuitiva que exiba informa√ß√µes no medidor e possa gerar automaticamente um relat√≥rio. <br><br>  Aqui nosso zool√≥gico continua.  O fato √© que existem v√°rios formul√°rios de relat√≥rio.  Em sua ess√™ncia, eles refletem a mesma coisa (calor consumido), mas de maneiras diferentes. <br><br>  Alguns dos assinantes relatam valores absolutos (ou seja, os valores s√£o gravados no gr√°fico de consumo de calor, come√ßando com a instala√ß√£o do medidor), outros em deltas (√© quando escrevemos o consumo por um per√≠odo de tempo sem refer√™ncia aos valores iniciais).  De fato, eles n√£o usam padr√µes comuns, mas pr√°ticas estabelecidas.  Houve casos em que os assinantes veem todos os valores necess√°rios (a quantidade de calor consumida, a quantidade de refrigerante fornecida e deixada, a diferen√ßa de temperatura), mas as colunas no relat√≥rio n√£o est√£o na mesma sequ√™ncia. <br>  Da√≠ o pr√≥ximo passo - o relat√≥rio deve ser personaliz√°vel.  Ou seja, o pr√≥prio assinante escolhe qual sequ√™ncia est√° chegando e quais recursos est√£o em seu documento. <br><br>  Aqui est√° um ponto interessante.  Tudo est√° bem se nosso medidor estiver instalado corretamente.  Mas acontece que a organiza√ß√£o da instala√ß√£o, ao instalar o ITP, estragou tudo e definiu incorretamente o tempo para o medidor.  Conhecemos dispositivos que pensam - no quintal de 2010.  Em nosso sistema, parecer√° zero leituras para a data atual e consumo real - se voc√™ escolher 2010.  Os deltas s√£o muito √∫teis aqui.  Ou seja, dizemos que nos √∫ltimos dias muita coisa chegou. <br><br>  Parece, por que essas dificuldades?  T√£o dif√≠cil deixar o rel√≥gio para baixo? <br><br>  √â precisamente com o VKT-7 que isso levar√° a uma redefini√ß√£o completa do contador e a exclus√£o de arquivos dele. <br>  O assinante ser√° for√ßado a provar ao pessoal de recursos que ele definiu o ITP n√£o ontem, mas apenas cerca de cinco anos atr√°s. <br><br>  E, finalmente, uma cereja no bolo. <br><br><h3>  Certifica√ß√£o </h3><br>  Temos um dispositivo de medi√ß√£o, temos um relat√≥rio.  Entre eles est√° o nosso sistema, que gera este relat√≥rio.  Voc√™ acredita nela? <br><br>  Eu sou  Mas como provar que nada est√° mudando dentro de n√≥s, que n√£o estamos distorcendo o significado.  Este √© um problema de certifica√ß√£o.  O sistema de pesquisa deve ter um certificado que confirme sua imparcialidade.  Todos os sistemas grandes, como LERS, I Energetik e outros, possuem um certificado semelhante.  N√≥s conseguimos, embora seja caro e demorado. <br><br>  Claro, voc√™ sempre pode cortar a esquina e comprar algo pronto.  Mas para isso voc√™ tem que pagar ao desenvolvedor.  E o desenvolvedor pode solicitar n√£o apenas uma taxa de entrada, mas tamb√©m uma taxa mensal.  Ou seja, seremos for√ßados a compartilhar parte de nossa torta com ele. <br><br><h3>  Por que tudo isso? </h3><br>  Este n√£o √© o principal problema.  Desenvolver seu pr√≥prio sistema tamb√©m √© muito caro e muito mais dif√≠cil.  No entanto, d√° uma vantagem importante.  Entendemos claramente como isso funciona.  N√≥s o escalamos facilmente, podemos modific√°-lo se essa necessidade surgir repentinamente.  O assinante recebe um servi√ßo mais completo e, da nossa parte, cem por cento de controle sobre o processo. <br><br>  Por isso escolhemos o segundo caminho.  Investimos nele um ano de vida de nossos desenvolvedores e engenheiros de campo.  Mas agora entendemos claramente o trabalho de toda a cadeia. <br><br>  Olhando para tr√°s, entendo que, sem o conhecimento adquirido, simplesmente n√£o conseguia interpretar corretamente o comportamento anormal de um ou outro contador. <br><br>  Al√©m disso, algo mais pode ser constru√≠do com base no sistema de expedi√ß√£o.  Alarmes de excesso de consumo, relat√≥rio de acidente.  Em breve, estamos nos preparando para lan√ßar um aplicativo m√≥vel. <br><br>  Fomos ainda mais longe e adicionamos √† nossa plataforma (caso contr√°rio, voc√™ n√£o pode mais cham√°-la), acrescentamos a capacidade de receber chamadas de residentes, a capacidade de gerenciar nossos "intercomunicadores inteligentes", controlar imediatamente a ilumina√ß√£o p√∫blica e mais alguns projetos sobre os quais ainda n√£o escrevi. <br><br><img src="https://habrastorage.org/webt/_v/zl/bw/_vzlbw1q-ue01p8udfadwdu3nuq.png"><br><br>  Tudo isso √© complicado, de quebrar o c√©rebro e longo.  Mas o resultado vale a pena.  Os assinantes recebem um produto abrangente acabado. <br><br>  Cada operador que planeja ir para habita√ß√£o e servi√ßos comunit√°rios definitivamente seguir√° esse caminho.  Isso vai passar? <br>  H√° uma pergunta.  N√£o √© nem pelo dinheiro.  Como escrevi acima, aqui precisamos de um monte de trabalho no campo e desenvolvimento.  Nem todos os principais players est√£o acostumados a isso.  Se seus desenvolvedores est√£o em Moscou e as conex√µes s√£o feitas em Novosibirsk, o tempo para o produto final √© significativamente reduzido. <br><br>  O tempo dir√° quem ficar√° neste mercado e quem dir√° - bem, deixe-o ir para o inferno!  Mas uma coisa eu tenho certeza - vir e ganhar participa√ß√£o de mercado exclusivamente com dinheiro n√£o funcionar√°.  Esse processo requer abordagens n√£o convencionais, bons engenheiros, escavando o regulador, comunicando-se com recursos e assinantes, identificando e superando constantemente o rake. <br><br>  <b>PS</b> Neste artigo, concentrei-me deliberadamente no calor e n√£o mencionei eletricidade ou √°gua.  Tamb√©m descrevo a conex√£o a cabo.  Se tivermos uma sa√≠da de pulso, existem algumas nuances, como reconcilia√ß√µes obrigat√≥rias ap√≥s a instala√ß√£o.  Pode ser que o fio n√£o alcance, ent√£o LoRaWAN √© usado.  √â simplesmente irrealista descrever toda a plataforma e os est√°gios de seu desenvolvimento em um artigo. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt449668/">https://habr.com/ru/post/pt449668/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt449656/index.html">Como se divertir com vk api</a></li>
<li><a href="../pt449658/index.html">Ovo de P√°scoa novo do Google - Thanos e a luva do infinito x resultados de pesquisa do Google</a></li>
<li><a href="../pt449662/index.html">Bem-vindo a falar na PyCon R√∫ssia 2019</a></li>
<li><a href="../pt449664/index.html">Configurando o GitLab CI para carregar um projeto java no maven central</a></li>
<li><a href="../pt449666/index.html">DevOpsForum 2019. Implantar DevOps n√£o pode esperar</a></li>
<li><a href="../pt449670/index.html">Para apoiar a musa: como as doa√ß√µes para serpentinas s√£o organizadas</a></li>
<li><a href="../pt449672/index.html">Noerden Life2 - rel√≥gio anal√≥gico com controle "gesto" e vidro "toque"</a></li>
<li><a href="../pt449674/index.html">Suporte atualizado ao Razor no Visual Studio Code, agora com suporte ao Blazor</a></li>
<li><a href="../pt449676/index.html">Gest√£o competente - mito ou realidade? Responda ao Grupo Kolesa, Evil Marcianos e Wrike</a></li>
<li><a href="../pt449678/index.html">Por que as tarefas de software sempre levam mais tempo do que voc√™ pensa</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>