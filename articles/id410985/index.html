<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🙎 💧 🎧 Solusi open-source untuk pengurangan sepuluh kali lipat dalam latensi pembacaan data dengan Apache Cassandra 🧘 🔃 🧙🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Instagram memiliki salah satu basis data Apache Cassandra terbesar di dunia. Proyek ini mulai menggunakan Cassandra pada 2012 untuk menggantikan Redis...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Solusi open-source untuk pengurangan sepuluh kali lipat dalam latensi pembacaan data dengan Apache Cassandra</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/wirex/blog/410985/"><img src="https://habrastorage.org/webt/8h/qz/qy/8hqzqyfytcsvjn_xc9y5uj9j7ns.jpeg"><br><br>  Instagram memiliki salah satu basis data Apache Cassandra terbesar di dunia.  Proyek ini mulai menggunakan Cassandra pada 2012 untuk menggantikan Redis dan mendukung penerapan fitur aplikasi seperti sistem pengenalan penipuan, Tape dan Direct.  Pada awalnya, cluster Cassandra bekerja di AWS, tetapi kemudian insinyur memigrasikannya ke infrastruktur Facebook bersama dengan semua sistem Instagram lainnya.  Cassandra tampil sangat baik dalam hal keandalan dan toleransi kesalahan.  Pada saat yang sama, metrik latensi saat membaca data jelas dapat ditingkatkan. <br><br>  Tahun lalu, tim pendukung Instagram Cassandra mulai mengerjakan proyek yang bertujuan mengurangi latensi dalam membaca data secara signifikan di Cassandra, yang disebut oleh para insinyur bernama Rocksandra.  Dalam artikel ini, penulis menceritakan apa yang mendorong tim untuk mengimplementasikan proyek ini, kesulitan yang harus diatasi, dan metrik kinerja yang digunakan insinyur di lingkungan cloud internal dan eksternal. <br><br><h3>  Alasan untuk Transisi </h3><br>  Instagram aktif dan banyak menggunakan Apache Cassandra sebagai layanan penyimpanan nilai kunci.  Sebagian besar permintaan Instagram terjadi secara online, oleh karena itu, untuk memberikan pengalaman pengguna yang andal dan menyenangkan bagi ratusan juta pengguna Instagram, SLA sangat menuntut kinerja sistem. <a name="habracut"></a><br><br>  Instagram mematuhi peringkat keandalan lima-sembilan.  Ini berarti bahwa jumlah kegagalan pada waktu tertentu tidak dapat melebihi 0,001%.  Untuk meningkatkan kinerja, para insinyur secara aktif memantau bandwidth dan latensi dari berbagai kelompok Cassandra, dan memastikan bahwa 99% dari semua permintaan masuk ke dalam indikator tertentu (penundaan P99). <br><br>  Di bawah ini adalah grafik yang menunjukkan penundaan sisi klien dari satu untuk satu kelompok tempur Cassandra.  Biru menunjukkan kecepatan baca rata-rata (5 ms), dan oranye menunjukkan kecepatan baca untuk 99%, mulai dari 25-60 ms.  Perubahannya sangat tergantung pada lalu lintas klien. <br><br> <a href=""><img src="https://habrastorage.org/webt/hh/w0/qq/hhw0qq_z9ce4zqkys5m8irabeja.png"></a> <br><br> <a href=""><img src="https://habrastorage.org/webt/h3/bs/oz/h3bsoz7oxelnn-sm9xse1wcn4u4.png"></a> <br><br>  Studi ini menemukan bahwa ledakan keterlambatan yang tajam sebagian besar disebabkan oleh pekerjaan pengumpul sampah JVM.  Insinyur memperkenalkan metrik yang disebut "persentase pemberhentian CM" untuk mengukur persentase waktu yang dihabiskan untuk "menghentikan dunia" oleh server Cassandra, dan disertai dengan penolakan permintaan pelanggan.  Berikut adalah grafik di atas yang menunjukkan jumlah waktu (dalam persen) yang pergi ke SM berhenti menggunakan contoh dari salah satu server tempur Cassandra.  Indikator berkisar dari 1,25% pada saat lalu lintas terkecil hingga 2,5% pada saat beban puncak. <br><br>  Grafik menunjukkan bahwa instance server Cassandra ini dapat menghabiskan 2,5% waktunya mengumpulkan sampah daripada melayani permintaan klien.  Operasi pencegahan kolektor jelas memiliki dampak signifikan pada keterlambatan P99, dan karenanya menjadi jelas bahwa jika kita dapat mengurangi laju penghentian CM, maka para insinyur dapat secara signifikan mengurangi laju keterlambatan P99. <br><br><h3>  Solusi </h3><br>  Apache Cassandra adalah database terdistribusi berbasis Java dengan mesin penyimpan datanya sendiri berdasarkan pada pohon-pohon LSM.  Insinyur menemukan bahwa komponen mesin seperti tabel memori, alat kompresi, jalur baca / tulis, dan beberapa lainnya menciptakan banyak objek dalam memori dinamis Java, yang menyebabkan JVM harus melakukan banyak operasi overhead tambahan.  Untuk mengurangi dampak dari mekanisme penyimpanan pada pekerjaan pengumpul sampah, tim dukungan mempertimbangkan berbagai pendekatan dan akhirnya memutuskan untuk mengembangkan mesin C ++ dan menggantikan yang sudah ada dengannya. <br><br>  Insinyur tidak ingin melakukan semuanya dari awal, dan karena itu memutuskan untuk mengambil RocksDB sebagai dasar. <br><br>  RocksDB adalah database tertanam open-source berkinerja tinggi untuk penyimpanan nilai kunci.  Ini ditulis dalam C ++, dan API-nya memiliki binding bahasa resmi untuk C ++, C, dan Java.  RocksDB dioptimalkan untuk kinerja tinggi, terutama pada drive cepat seperti SSD.  Ini banyak digunakan dalam industri sebagai mesin penyimpanan untuk MySQL, mongoDB, dan database populer lainnya. <br><br><h3>  Kesulitan </h3><br>  Dalam proses penerapan mesin penyimpanan baru di RocksDB, para insinyur menghadapi tiga tugas sulit dan menyelesaikannya. <br><br>  Kesulitan pertama adalah bahwa Cassandra masih kekurangan arsitektur yang memungkinkan prosesor data pihak ketiga untuk dihubungkan.  Ini berarti bahwa pekerjaan mesin yang ada agak berhubungan erat dengan komponen basis data lainnya.  Untuk menemukan keseimbangan antara refactoring skala besar dan iterasi cepat, para insinyur mendefinisikan API mesin baru, termasuk antarmuka baca, tulis, dan streaming yang paling umum.  Dengan demikian, tim dukungan dapat menerapkan mekanisme pemrosesan data baru untuk API dan memasukkannya ke jalur eksekusi kode yang sesuai di dalam Cassandra. <br><br>  Kesulitan kedua adalah bahwa Cassandra mendukung tipe data terstruktur dan skema tabel, sementara RocksDB hanya menyediakan antarmuka kunci-nilai.  Para insinyur dengan cermat mendefinisikan algoritma pengodean dan pengodean ulang untuk mendukung model data Cassandra dalam struktur data RocksDB dan memastikan kesinambungan semantik dari pertanyaan serupa di antara kedua basis data. <br><br>  Kesulitan ketiga dikaitkan dengan komponen penting untuk setiap komponen basis data terdistribusi saat bekerja dengan aliran data.  Setiap kali sebuah node ditambahkan atau dihapus dari cluster Cassandra, perlu untuk mendistribusikan data dengan benar antara node yang berbeda untuk menyeimbangkan beban dalam cluster.  Implementasi yang ada dari mekanisme ini didasarkan pada memperoleh data terperinci dari mesin database yang ada.  Oleh karena itu, para insinyur harus memisahkan mereka satu sama lain, membuat lapisan abstraksi dan menerapkan opsi baru untuk memproses aliran menggunakan API RocksDB.  Untuk mendapatkan aliran arus yang tinggi, tim dukungan sekarang pertama-tama mendistribusikan data ke file sst sementara, dan kemudian menggunakan API RocksDB khusus untuk "menelan" file, memungkinkan mereka untuk dimuat secara bersamaan ke dalam instance RocksDB. <br><br><h3>  Indikator kinerja </h3><br>  Setelah hampir satu tahun pengembangan dan pengujian, para insinyur menyelesaikan versi pertama implementasi dan berhasil "meluncurkannya" di beberapa cluster Instagram Instagram Cassandra.  Pada salah satu cluster tempur, penundaan P99 turun dari 60 ms menjadi 20 ms.  Pengamatan juga menunjukkan bahwa perhentian SM di kluster ini turun dari 2,5% menjadi 0,3%, yaitu hampir 10 kali lipat! <br><br>  Para insinyur juga ingin memeriksa apakah Rocksandra dapat bekerja dengan baik di lingkungan cloud publik.  Tim dukungan menyiapkan cluster Cassandra di AWS menggunakan tiga instance EC3 i3.8 xlarge, masing-masing dengan prosesor 32-core, 244 GB RAM, dan nol serangan dari empat flash drive NVMe. <br><br>  Untuk pengujian komparatif, kami menggunakan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">NDBench</a> , dan skema tabel default untuk framework. <br><br><pre><code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> emp ( emp_uname <span class="hljs-type"><span class="hljs-type">text</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PRIMARY KEY</span></span>, emp_dept <span class="hljs-type"><span class="hljs-type">text</span></span>, emp_first <span class="hljs-type"><span class="hljs-type">text</span></span>, emp_last <span class="hljs-type"><span class="hljs-type">text</span></span> )</code> </pre> <br>  Insinyur telah melakukan pra-muat 250 juta 6 baris masing-masing 6 KB (sekitar 500 GB data disimpan di setiap server).  Selanjutnya, atur 128 pembaca dan penulis di NDBench. <br><br>  Tim dukungan menguji berbagai muatan dan mengukur latensi baca dan tulis / P99 / P999 rata-rata.  Grafik di bawah ini menunjukkan bahwa Rocksandra menunjukkan latensi baca dan tulis yang jauh lebih rendah dan lebih stabil. <br><br><img src="https://habrastorage.org/webt/sc/7j/im/sc7jim4homfpkase00fbjixjhyq.png"><br><br><img src="https://habrastorage.org/webt/z1/ol/pw/z1olpwd4z6q-bp-kihfcf58j9bo.png"><br><br>  Insinyur juga memeriksa beban dalam mode baca tanpa menulis dan menemukan bahwa dengan penundaan baca P99 yang sama (2 ms), Rocksandra mampu memberikan lebih dari 10 kali lipat dalam kecepatan membaca informasi (300 K / d untuk Rocksandra dibandingkan 30 K / d untuk C * 3.0). <br><br><img src="https://habrastorage.org/webt/jn/sy/fu/jnsyfumtlax15y1p0tkkalrc_f4.png"><br><br><img src="https://habrastorage.org/webt/iv/js/fs/ivjsfsiexo3bzmuklo_ughr0tju.png"><br><br><h3>  Rencana masa depan </h3><br>  Tim dukungan Instagram telah membuka kode dan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">kerangka kerja</a> <a href="">Rocksandra</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">untuk mengevaluasi kinerja</a> .  Anda dapat mengunduhnya dari Github dan mencoba di lingkungan Anda sendiri.  Pastikan untuk memberi tahu kami apa yang terjadi! <br><br>  Sebagai langkah selanjutnya, tim secara aktif bekerja untuk menambahkan dukungan yang lebih luas untuk fungsionalitas C *, seperti indeks sekunder, perbaikan, dan banyak lagi.  Dan selain itu, para insinyur sedang mengembangkan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">arsitektur mesin basis data plug-in di C *</a> untuk lebih lanjut mentransfer perkembangan ini ke komunitas Apache Cassandra. <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><img src="https://habrastorage.org/files/4bd/bf6/597/4bdbf659775744b1bdbb4d8a00a0a980.png" alt="gambar"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id410985/">https://habr.com/ru/post/id410985/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id410969/index.html">5 teknologi untuk periode lima tahun ke depan: perkiraan dari IBM</a></li>
<li><a href="../id410973/index.html">Drone apa yang digunakan di bioskop dunia</a></li>
<li><a href="../id410977/index.html">Upaya untuk membuat perangkat input informasi universal</a></li>
<li><a href="../id410979/index.html">"Meretas" otak menggunakan "gambar-kontradiksi"</a></li>
<li><a href="../id410981/index.html">Yandex menambahkan perlindungan terhadap penambang crypto ke browsernya</a></li>
<li><a href="../id410987/index.html">GLONASS akan dibuat seakurat sistem navigasi GPS</a></li>
<li><a href="../id410989/index.html">Pendahulu gelang kebugaran: pedometer, monitor detak jantung, komputer siklus</a></li>
<li><a href="../id410991/index.html">Dompet hardware cryptocurrency Ledger diretas oleh hacker 15 tahun</a></li>
<li><a href="../id410993/index.html">Seseorang mengirim mainan seks dari Amazon ke orang asing. Amazon tidak tahu bagaimana menghentikannya</a></li>
<li><a href="../id410995/index.html">Telegram mengeluhkan tentang Rusia ke Pengadilan Hak Asasi Manusia Eropa</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>