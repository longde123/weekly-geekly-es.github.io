<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßñüèø üë®üèæ‚Äç‚öïÔ∏è ‚óæÔ∏è Identificaci√≥n del cliente en sitios sin contrase√±as y cookies: solicitud de est√°ndar ü§æ üë®‚Äçüîß üë©üèø‚Äçü§ù‚Äçüë©üèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Estimado habrozhitel! Estimados expertos! Presento para su evaluaci√≥n un nuevo concepto de identificaci√≥n de usuario en sitios web, que espero que con...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Identificaci√≥n del cliente en sitios sin contrase√±as y cookies: solicitud de est√°ndar</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/472310/"><img src="https://habrastorage.org/webt/zx/gv/lz/zxgvlzpzrabaux0m9y-brjkhhpi.jpeg" alt="imagen"><br><br>  Estimado habrozhitel!  Estimados expertos!  Presento para su evaluaci√≥n un nuevo concepto de identificaci√≥n de usuario en sitios web, que espero que con su ayuda se convierta en un est√°ndar abierto de Internet, haciendo que este mundo de Internet sea un poco mejor.  Esta es una versi√≥n preliminar del protocolo de autenticaci√≥n sin contrase√±a, dise√±ado como un art√≠culo gratuito.  Y si la idea subyacente recibe una evaluaci√≥n positiva de usted, querido lector, continuar√© public√°ndola en reddit.com y rfc-editor.org.  Y espero poder interesar a los desarrolladores de los principales navegadores en su implementaci√≥n.  Por lo tanto, espero una cr√≠tica constructiva de su parte. <br><br>  Atenci√≥n: mucho texto. <br><br><a name="habracut"></a><br>  Entonces la pregunta es.  ¬øEs posible identificar inequ√≠vocamente a los visitantes del sitio sin revelar sus datos personales y realizar un seguimiento entre diferentes sitios?  ¬øEs posible, al resolver este problema, abandonar por completo la forma m√°s primitiva de autorizaci√≥n mediante inicio de sesi√≥n / contrase√±a y usar cookie / localStorage? <br><br>  Por un lado, los sitios necesitan reconocer a un cliente para, por ejemplo, "restaurar" su configuraci√≥n, cesta de productos, anuncios, art√≠culos, etc.  Por otro lado, los visitantes desean permanecer lo m√°s an√≥nimos posible, sin revelar sus datos personales y evitar que sitios de terceros los rastreen.  Y este √∫ltimo puede hacer esto intercambiando entre ellos los datos recopilados. <br><br>  Parece una tarea asegurarse de que los lobos est√©n llenos y que las ovejas est√©n a salvo.  ¬øEs esto real? <br><br>  Yo, hasta cierto punto, creo, de verdad. <br><br><h1>  Tabla de contenidos </h1><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">1 concepto de autenticaci√≥n sin contrase√±a</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">1.1 Claves y tokens en lugar de inicios de sesi√≥n y contrase√±as</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">1.2 Estructura del token</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/472310/&amp;usg=ALkJrhi2f4Htow_HqD9WX6bfTeRVMgy1OQ#">1.3 encabezados de protocolo HTTP</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">1.4 ¬øC√≥mo identifican los clientes los sitios?</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">1.4.2 ¬øC√≥mo s√© si un sitio admite este protocolo?</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">1.5 ¬øC√≥mo autorizan los clientes los sitios?</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">1.6 ¬øC√≥mo implementar una identificaci√≥n confiable del cliente?</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">1.7 Autorizaci√≥n en el sitio a trav√©s de los ojos del usuario</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">1.8 ¬øC√≥mo cambia una clave de sitio?</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">1.9 ¬øC√≥mo se implementa la autorizaci√≥n entre dominios?</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">1.10 ¬øC√≥mo implementar la autenticaci√≥n entre dominios?</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">1.11 Movilidad de cuenta</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">2 Descripci√≥n t√©cnica del protocolo</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Algoritmo de generaci√≥n de clave de dominio 2.0</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">2.1 el algoritmo para calcular el token de origen</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">2.2 Algoritmo de protecci√≥n de tokens durante la transferencia</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">2.3 Procedimiento de intercambio de sal entre navegador y servidor</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">2.4 Reglas para la formaci√≥n del campo Contexto</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">2.5 Reglas para definir los campos Remitente y Destinatario</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">2.6 Detalles sobre tablas de definici√≥n de contexto</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">2.7 Escenarios de protocolo</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">2.8 Procesando tokens en el servidor</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">2.9 Autenticaci√≥n entre dominios</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">3 Recomendaciones de seguridad</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">3.1 Protecci√≥n de la informaci√≥n clave del acceso no autorizado</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">3.2 Acerca de las contrase√±as como claves de dominio</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">3.3 Riesgos de perder / comprometer claves y minimizarlas</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">4 Ataques al esquema de autorizaci√≥n</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">4.1 Seguimiento de usuarios</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">4.2 ataque XSS</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">4.3 ataque CSRF</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">4.4 Seguimiento con SSO</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">4.5 Compromiso clave para SSO</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">4.6 Compromiso del token durante la transferencia</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">4.7 Hackear un sitio web y tokens comprometedores</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Conclusi√≥n</a> <br><br><br><div class="spoiler">  <b class="spoiler_title">¬øQu√© hay de malo con las contrase√±as?</b> <div class="spoiler_text">  S√≠, no es as√≠.  Se pueden perder.  Pueden ser robados.  Deben ser recordados.  De todos modos, ¬øpor qu√© estoy obligado a completar alguna forma de registro y encontrar otra contrase√±a para ver el clima o descargar este archivo?  Finalmente, las contrase√±as son un poco menos que muchas.  Cu√°ntos sitios te gustan, tantas contrase√±as.  Y, por lo tanto, muchos realmente usan una contrase√±a en todos los sitios.  Alguien usa un algoritmo complicado para recordarlos.  O un administrador de contrase√±as.  O, est√∫pidamente, un cuaderno.  O prefiere la autenticaci√≥n entre dominios: inicia sesi√≥n una vez en un sitio, ¬°y eso es todo!  Si, no todos.  Esto es si el sitio lo admite. <br>  Todos estos enfoques tienen desventajas. <br>  Use una contrase√±a en diferentes sitios: Moveton.  Lo que dos personas saben, el cerdo tambi√©n lo sabe.  No todos los sitios (incluso grandes y de buena reputaci√≥n) cumplen honestamente con las reglas de seguridad para almacenar sus contrase√±as.  Algunos sitios almacenan contrase√±as en forma abierta, mientras que otros piensan que almacenar hashes de contrase√±as ya los protege lo suficiente.  Como resultado, las filtraciones de contrase√±as y otros datos personales de los clientes ocurren regularmente. <br>  Con el administrador de contrase√±as ya est√° mejor.  Es cierto que nadie le garantiza que no combine sus contrase√±as en alg√∫n lugar.  Y busque un administrador que pueda sincronizar sus cuentas en todos los dispositivos (netbook dom√©stico, tel√©fono, computadora de trabajo).  No excluyo que tal exista. <br>  Pero, en cualquier caso, la idea en s√≠ misma: primero reg√≠strese en nuestro sitio web (al mismo tiempo, env√≠e un correo electr√≥nico, m√≥vil, done sangre para an√°lisis), luego invente / recuerde su nombre de usuario y contrase√±a y tenga la amabilidad de recordarlos, pero mant√©ngalos en secreto. enfoque, te digo, m√°s o menos.  Y ni un solo administrador de contrase√±as lo resolver√°.  Pero resuelve el <abbr title="Tecnolog√≠a de inicio de sesi√≥n √∫nico implementada por varios protocolos como SAML, OAuth, Kerberos">SSO</abbr> . <br>  Eso es solo mala suerte: si pierde la contrase√±a del sitio SSO y la olvida, o se la roban ... Pierde el acceso de todos sus sitios a la vez o se la regala voluntariamente a alguien y no est√° claro con qu√© intenciones.  <b>¬°No almacene todos los huevos en una canasta!</b> <br>  Y no es un hecho que el sitio de SSO sea confiable.  O no almacena sus contrase√±as en texto claro.  O no los fusiona voluntariamente, adem√°s brinda una oportunidad para que otros lo rastreen entre sitios.  Bueno, entiendes el punto. <br>  Por lo tanto: inicio de sesi√≥n + contrase√±a = mal.  Y todo el mal del mundo deber√≠a estar borracho en serio y durante mucho tiempo.  Y una galleta tambi√©n.  Junto con su sesi√≥n cocodrilos PHPSESSIONID, JSESSIONID, y sus an√°logos. <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Y que hacer</b> <div class="spoiler_text">  Primero, debe considerar situaciones t√≠picas, de las cuales quedar√° claro: ¬øpor qu√© los sitios quieren recordar a sus clientes y es realmente necesario para ellos? <br><ol><li>  Blog personal "Vasya Pupkina", en el que, por ejemplo, se permiten comentarios.  El registro solo es necesario para protegerse de los robots, realizar votaciones sin cargo, contar "me gusta" y otros "miau miau" y asignar una calificaci√≥n a los comentaristas.  Es decir  Aqu√≠ <b>, la funcionalidad de seguimiento es necesaria exclusivamente por el sitio</b> , y solo en peque√±a medida, por el usuario (si valora su calificaci√≥n de "comentarista" en este sitio). </li><li>  Sitios de redes sociales y otras personas que hablan en Internet (ICQ, Skype, all√≠ tambi√©n).  El registro es necesario para implementar contenido con nombre (autor), para identificar a los visitantes entre s√≠.  Es decir  Aqu√≠ <b>, la funcionalidad de identificaci√≥n es necesaria en mayor medida por los propios usuarios</b> .  Aunque los sitios de redes sociales son los primeros en la lista de "pecadores", recopilan la informaci√≥n m√°s completa sobre los visitantes y los recuerdan seriamente y durante mucho tiempo.  Por lo tanto, a√∫n no se sabe qui√©n necesita m√°s identificaci√≥n. </li><li>  Sitio corporativo con contenido cerrado.  El registro o autorizaci√≥n aqu√≠ es necesario principalmente para restringir el acceso al contenido.  Todo tipo de: escuelas en l√≠nea, bibliotecas, sitios privados no p√∫blicos, etc.  Aqu√≠ <b>, la funcionalidad de autorizaci√≥n es necesaria en mayor medida por el sitio</b> .  Como regla general, no hay formularios de registro abiertos.  Las credenciales se comparten a trav√©s de otros canales. </li><li>  Una tienda en l√≠nea y otra plataforma similar que vende art√≠culos, servicios o contenido.  Tambi√©n incluir√© sitios de anuncios clasificados pagados / gratuitos.  El registro es necesario principalmente para almacenar el historial de pedidos de los clientes, y para que pueda rastrear su estado actual, almacenar sus preferencias (favoritos);  con el fin de formular ofertas personales para el cliente en funci√≥n del historial de compras y las preferencias.  Aqu√≠ <b>, la funcionalidad de identificaci√≥n es igualmente necesaria tanto para el cliente como para la tienda</b> .  Pero m√°s, por supuesto, a la tienda.  Al vapor, vapor y vapor. </li><li>  Cualquier cuenta personal de usuarios de servicios de Internet: correo electr√≥nico, servicios p√∫blicos, Sberbank en l√≠nea, meg√°fono en l√≠nea, oficinas de proveedores, CMS de proveedores de servicios de alojamiento, etc.  Aqu√≠ <b>, el usuario mismo est√° principalmente interesado en la identificaci√≥n correcta y confiable</b> .  Despu√©s de todo, maneja informaci√≥n que es importante para s√≠ mismo, que en algunas situaciones tiene consecuencias legales y financieras.  No huele a anonimato.  Ella es da√±ina aqu√≠. </li><li>  Enrutadores, consolas de administraci√≥n, versiones web de administrar algo en su red dom√©stica o corporativa. </li></ol><br><br>  Est√° claro que en diferentes situaciones, puede haber diferentes riesgos.  En algunos casos, la identificaci√≥n incorrecta, la p√©rdida de datos de autenticaci√≥n, o incluso el robo / falsificaci√≥n de los mismos, no tendr√° consecuencias significativas para el sitio o para el usuario.  En otros, ser√° desagradable (perd√≠ karma en Habr√© - "es un desastre ...") o provocar√° inconvenientes (no puedo pasar por debajo de m√≠ mismo en Yula, ver mis anuncios; tengo un perfil de acceso a mis proyectos en github, - est√° bien cuenta nueva, proyectos fork).  En tercer lugar, puede conllevar consecuencias legales y financieras.  Por lo tanto, debe suponerse que el esquema de autorizaci√≥n propuesto no es una "bala de plata" para todos los casos, especialmente "desnudo".  <b>Cuando se gestiona informaci√≥n confidencial, vale la pena usar otros m√©todos de identificaci√≥n y autenticaci√≥n</b> o su combinaci√≥n (autenticaci√≥n de dos factores, criptograf√≠a de clave asim√©trica, 3D-secure, eToken, OTP-Token, etc.). <br><br>  Oh bien  ¬øCu√°l es tu TK? <br></div></div><br><div class="spoiler">  <b class="spoiler_title">¬øQu√© ofrece el nuevo protocolo?</b> <div class="spoiler_text">  Desde la perspectiva del usuario final: <br><ol><li>  El sitio debe recordar y reconocer al visitante sin ning√∫n aporte del usuario;  el sitio debe reconocerlo tanto dentro de la sesi√≥n como entre diferentes sesiones.  Sin cookies, contrase√±as o registros.  Al mismo tiempo, diferentes sitios no deber√≠an poder identificar de forma exclusiva al mismo visitante, pudiendo realizar un seguimiento de su actividad en estos y otros sitios.  Es decir  los sitios no deber√≠an poder agregar informaci√≥n para sus visitantes. </li><li>  El usuario debe poder " <b>olvidar cualquier sitio</b> " en cualquier momento;  y el sitio olvidar√° al usuario.  Debe existir la posibilidad de otorgar derechos al sitio para recordar al cliente por iniciativa del cliente (sin ventanas emergentes obsesivas).  El usuario debe poder migrar de manera segura su identidad virtual entre diferentes dispositivos y navegadores (si lo necesita) para tener una autorizaci√≥n √∫nica en sus sitios favoritos. </li></ol><br><br>  Ya veo  ¬øY qu√© bonificaciones deber√≠an obtener los desarrolladores de sitios de esto? <br><ol><li>  Un procedimiento de identificaci√≥n m√°s simple: no es necesario crear por en√©sima vez la siguiente forma de inicio de sesi√≥n, cierre de sesi√≥n, registro, cambio y recuperaci√≥n de contrase√±a.  Es suficiente activar el m√≥dulo de soporte de protocolo para su marco favorito, implementado sobre la base del est√°ndar. </li><li>  No es necesario que un dise√±ador dibuje un formulario de inicio de sesi√≥n y piense d√≥nde ocultarlo en una peque√±a pantalla m√≥vil.  El protocolo hace que los formularios sean innecesarios en absoluto.  Bueno, excepto que el formulario de registro.  ¬øD√≥nde est√° sin ellos entonces?  Por desgracia </li></ol><br><br>  Por √∫ltimo: <br><ol><li>  El protocolo de autenticaci√≥n debe estar unificado y estandarizado;  Verificado por expertos en seguridad  Aprobado y recomendado por los comit√©s de estandarizaci√≥n web.  Como resultado, la posibilidad de cometer errores cl√°sicos por parte de los webmasters al desarrollar formularios de inicio de sesi√≥n / cierre de sesi√≥n est√°ndar, cambiar / recuperar contrase√±as (transferir contrase√±as en forma clara, uso incorrecto de hash, almacenar contrase√±as o hashes "no salados" en la base de datos, secuestrar contrase√±as de usuario cuando sitio de pirater√≠a). </li><li>  La autorizaci√≥n debe ser confiable hasta cierto punto (protegida de la falsificaci√≥n, acceso no autorizado, con autenticaci√≥n garantizada);  No cree nuevas vulnerabilidades en p√°ginas web y navegadores;  si es posible, reduzca los riesgos de ataques de red conocidos de inmediato.  Bueno, o al menos una reducci√≥n significativa en los riesgos de su implementaci√≥n exitosa. </li></ol><br><br>  En base a estos requisitos, pasamos a lo m√°s interesante: dise√±ar un nuevo protocolo. <br></div></div><br><br><a name="part1"></a><h1>  1 concepto de autenticaci√≥n sin contrase√±a </h1><br><br><a name="tokens_vs_passwords"></a><h2>  1.1 Claves y tokens en lugar de inicios de sesi√≥n y contrase√±as </h2><br>  Para cada dominio, incluidos los secundarios, el navegador del cliente genera aleatoriamente una clave √∫nica de 256 bits <math></math><img src="https://habrastorage.org/getpro/habr/formulas/8b1/9d8/49a/8b19d849a66473b36d68c78d06462129.svg" alt="$ K $" data-tex="inline">  .  <b>Esta clave nunca se transmite.</b>  Permanece constante dentro de la sesi√≥n del usuario.  Cada nueva sesi√≥n crea una nueva clave. <br>  Clave basada <math></math><img src="https://habrastorage.org/getpro/habr/formulas/8b1/9d8/49a/8b19d849a66473b36d68c78d06462129.svg" alt="$ K $" data-tex="inline">  el navegador genera un token de 256 bits <sup>*</sup> usando un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">algoritmo especial</a> <math></math><img src="https://habrastorage.org/getpro/habr/formulas/175/f98/839/175f98839ab732db76d5f20cd6ce2ce9.svg" alt="$ T $" data-tex="inline">  para identificar al usuario con un dominio espec√≠fico.  Token de identificaci√≥n <math></math><img src="https://habrastorage.org/getpro/habr/formulas/175/f98/839/175f98839ab732db76d5f20cd6ce2ce9.svg" alt="$ T $" data-tex="inline">  el usuario (en lo sucesivo, simplemente denominado token) sirve como reemplazo de las cookies de sesi√≥n como PHPSESSIONID y JSESSIONID. <br>  Clave <math></math><img src="https://habrastorage.org/getpro/habr/formulas/8b1/9d8/49a/8b19d849a66473b36d68c78d06462129.svg" alt="$ K $" data-tex="inline">  puede ser " <b>arreglado</b> " por el usuario.  La fijaci√≥n de la clave permitir√° al usuario permanecer autorizado en el sitio por un tiempo ilimitado en diferentes sesiones del navegador y devolver la autorizaci√≥n existente anteriormente.  Este es <b>un an√°logo de la funci√≥n "recordarme"</b> . <br>  Cuando se cancela la confirmaci√≥n, el navegador "olvidar√°" esta clave y nuevamente comenzar√° a generar una clave aleatoria para este dominio para cada nueva sesi√≥n (comenzando desde la actual), que <b>es an√°loga a la "salida"</b> del sitio <b>del</b> usuario.  La salida es instant√°nea, no requiere una recarga de p√°gina. <br>  El usuario puede <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">crear una clave permanente para el dominio</a> .  La clave permanente, as√≠ como la fija, permitir√°n al usuario devolver la autorizaci√≥n previa.  De hecho, esta <b>clave se convierte en un reemplazo para la conexi√≥n de inicio de sesi√≥n-contrase√±a.</b> <br>  El usuario tiene la oportunidad de controlar cu√°ndo el navegador para el dominio usar√° una clave constante y cu√°ndo, al azar.  Este es <b>un an√°logo de la funci√≥n de inicio / cierre de sesi√≥n</b> .  El concepto <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">se presenta en las capturas de pantalla a continuaci√≥n</a> . <br>  Los m√©todos para generar claves de dominio persistentes proporcionan la movilidad de las cuentas de usuario entre diferentes dispositivos.  El protocolo define lo siguiente: <br><ul><li>  generaci√≥n de una clave de dominio basada en una clave maestra de usuario </li><li>  formando individualmente una clave de dominio basada en un sensor biol√≥gico de n√∫meros aleatorios </li><li>  Importar claves existentes desde un archivo de claves desde otro dispositivo </li></ul><br><br><a name="token_structure"></a><h2>  1.2 Estructura del token </h2><br>  El token es una estructura de 256 bits, representada como una cadena hexadecimal: <br><div class="scrollable-table"><table><tbody><tr><td>  84bc3da1b3e33a18e8d5e1bdd7a18d7a </td><td>  166d77ac1b46a1ec38aa35ab7e628ab5 </td></tr><tr><td>  parte de identificaci√≥n </td><td>  parte de autenticaci√≥n </td></tr></tbody></table></div><br>  La parte de identificaci√≥n del token (los 128 bits m√°s altos) es similar al inicio de sesi√≥n.  Mediante esta secuencia de bits, el servidor puede identificar de forma exclusiva al usuario. <br>  La parte de autenticaci√≥n del token (los 128 bits inferiores) es similar a la contrase√±a.  Esta secuencia de bits ayuda al servidor a validar el token. <br>  Las reglas de validaci√≥n de tokens se <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">describen a continuaci√≥n</a> . <br><br><a name="http_headers"></a><h2>  1.3 encabezados de protocolo HTTP </h2><br>  <b>Encabezados utilizados por el cliente:</b> <br><br>  <b>CSI-Token</b> : &lt;Token&gt; se usa para enviar un token al servidor <br>  <b>Ficha CSI</b> : &lt;Token1&gt;;  <b>Changed-To</b> &lt;Token2&gt; se usa para cambiar el token actual: <br><ul><li>  al autorizar en una clave permanente, </li><li>  al registrar una clave permanente, </li><li>  al cambiar la clave permanente. </li></ul><br>  <b>Token CSI</b> : &lt;Token&gt; <b>Permanente se</b> utiliza cuando el usuario fija la clave aleatoria actual. <br>  <b>Token CSI</b> : &lt;Token&gt; <b>Cerrar sesi√≥n se</b> utiliza para finalizar prematuramente la sesi√≥n actual. <br><br>  <b>Encabezados utilizados por el servidor:</b> <br>  <b>Soporte CSI: s√≠</b> le dice al cliente que el servidor admite el protocolo de autorizaci√≥n CSI. <br>  <b>CSI-Token-Action: el √©xito se</b> utiliza para notificar al navegador sobre la aceptaci√≥n de un nuevo token de usuario (tecla Cambiar a). <br>  <b>CSI-Token-Action: abort</b> cancela el procedimiento para cambiar los tokens (retroceder al token anterior). <br>  <b>CSI-Token-Action: el registro</b> le dice al navegador que el nuevo token de usuario todav√≠a est√° en proceso de registro. <br>  <b>CSI-Token-Action:</b> error de verificaci√≥n de token del lado del servidor <b>no v√°lido</b> . <br><br>  Finalmente <br>  <b>CSI-Salt es</b> enviado tanto por el navegador como por el servidor al intercambiar la "sal" utilizada para proteger el token (parte de autenticaci√≥n).  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Ver abajo para</a> m√°s detalles. <br><br><a name="how_site_identify_us"></a><h2>  1.4 ¬øC√≥mo identifican los clientes los sitios? </h2><br>  Un sitio puede usar un token para identificar a un visitante del sitio.  Al mismo tiempo, el esquema de generaci√≥n de tokens y su capacidad de 256 bits <b>garantizan tokens √∫nicos para cada par:</b> dominio de usuario.  Otro dominio ver√° otro token de usuario.  Incluso si se ejecuta en el contexto del sitio de destino (a trav√©s de IFRAME, IMG, LINK, SCRIPT).  Adem√°s, un algoritmo especial de generaci√≥n de tokens protege a los usuarios de los ataques XSS, SRF y hace que sea imposible rastrear a un usuario sin su conocimiento.  Pero al mismo tiempo, la tecnolog√≠a <abbr title="Tecnolog√≠a de inicio de sesi√≥n √∫nico implementada por varios protocolos como SAML, OAuth, Kerberos">SSO sigue siendo</abbr> posible con su permiso e identificaci√≥n entre dominios. <br>  El token <b>se transmite en el encabezado HTTP CSI-Token</b> <u>con cada solicitud</u> a cualquier recurso de dominio (p√°gina, documento, imagen, script, estilo, fuente, archivo, solicitud ajax, ...): <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ki/mv/0k/kimv0kx4wvesmftizvvlgpfe088.png"></div><br>  El token se <b>recalcula <i>en cada</i> solicitud HTTP (S)</b> : p√°gina, imagen, solicitud ajax. <br>  Para optimizar los c√°lculos, se permite el almacenamiento en cach√© de tokens por parte del navegador, pero solo durante la duraci√≥n de la sesi√≥n y solo si las condiciones para cumplir con la solicitud permanecen sin cambios. <br>  Como se se√±al√≥ anteriormente, el token puede servir como un reemplazo para las cookies de sesi√≥n como PHPSESSIONID y JSESSIONID.  La √∫nica diferencia es que si el sitio gener√≥ previamente un identificador para que el visitante rastree a un usuario espec√≠fico entre sus diferentes solicitudes (despu√©s de todo, miles de solicitudes de diferentes usuarios llegan al sitio al mismo tiempo), ahora el cliente realiza esta funci√≥n. <br>  Dicha identificaci√≥n es suficiente para permitirle realizar compras en la tienda en l√≠nea, anunciarse en sitios apropiados, escribir en foros, redes sociales, Wikipedia o Habr√©. <br>  S√≠, el usuario permanece an√≥nimo para el sitio.  Pero puede ser un an√≥nimo "familiar" para el sitio.  Y el servidor puede guardar el token de dicho usuario de su lado, junto con sus datos (cuenta personal con compras, preferencias, karma, bollos, me gusta y otras bonificaciones).  Pero solo para mantener bajo la condici√≥n de completar cualquier proceso comercial: compra, presentaci√≥n del anuncio, etc.  Las condiciones est√°n determinadas por el sitio en s√≠. <br>  Como puede ver, el protocolo es lo m√°s simple posible para los sitios que no necesitan registrarlo antes de darle la oportunidad de tomar cualquier medida.  Pero aquellos que lo necesiten tendr√°n un poco m√°s de dificultad.  Pero m√°s sobre eso a continuaci√≥n. <br><br><a name="how_we_know_what_sci_supported"></a><h3> 1.4.2  ,     ? </h3><br>    http- <b>CSI-Support: yes</b>   Response Headers  : <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ly/gs/zu/lygszusqavjk8yjnljig4pgojdm.png"></div><br>   ,    ,       . ,     : <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ar/ff/bt/arffbt4ibbg__wlp7eyvaei_gvq.jpeg"></div><br>   , ,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">www.youtube.com</a> : <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/fq/7c/4p/fq7c4piubz15qir9xtxchg9639o.jpeg"></div><br><blockquote>         . </blockquote><br>         . <br><br><a name="how_make_authorization"></a><h3> 1.5     ? </h3><br>  ,          , ‚Äì  . ,     ,     ‚Äì   ¬´¬ª. <br>         ,    , ,  .        . <br><blockquote>   :      .      .        -    . </blockquote><br>     ¬´   ¬ª .            .   ¬´   ¬ª: <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/__/0i/1x/__0i1xkyu82-ne_cnghuongzrfy.png"></div><br> ,  ,       .      . <br> , ,        .      . <br>    ,   HTTP- <b>CSI-Token-Action</b>  ,     .    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="> II</a> . <br><br><a name="how_implement_reliable_identification"></a><h2> 1.6      ? </h2><br>     (  , , )      ,             :   , ,      . (, .    ,      ). <br><br><a name="user_view_concept"></a><h2> 1.7      </h2><br>   ,     CSI,      .       ,      .           : <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/up/et/3q/upet3q-qbs8ikn4ba9t0ycn8voy.gif"></div><br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text">     ,  .       ,   ,  ,   .    ,   .    .    .   ,   , ,      .   .  . <br></div></div><br>   ,           .  : <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/32/82/tm/3282tmri0zwdfx1jqi_zgd76zu0.gif"></div><br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text">   .   .  .      . <br>     ,  ¬´ ¬ª.      . <br></div></div><br>             ,     : <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/u4/cm/_g/u4cm_gdewg2j7ree3gq3phuz6x4.gif"></div><br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text">   . ,    .  ,  ¬´¬ª.   ,  . <br></div></div><br>    ,         -.     <u>        </u> .    . ,       -    / : <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/xs/ye/tx/xsyetxguxoesirmridywcy-2rts.gif"></div><br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text">      .       -.  .    (  ). <br></div></div><br>    -  ¬´¬ª   : <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/du/ab/cl/duabclss3t9nkxpnjygrqfxjdha.gif"></div><br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text">   .   .       .   ;    .   . <br></div></div><br>    .    ¬´¬ª  : <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/do/2r/fe/do2rfebsd3orgwphl0ujrt_o52q.jpeg"></div><br>     (   )   HEAD,     CSI-Token &lt;&gt;; Logout. <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/mt/gj/s1/mtgjs1i1jmtbehjyus_hfukqsq4.gif"></div><br> ,   ,  Logout.     ,        (     ).     ,   . <br>          :  ,   ajax-,    .. ‚Äì    ,      . <br><blockquote>       :   ,     ,      .  ¬´¬ª     .     . </blockquote><br><br><a name="how_user_can_change_key"></a><h2> 1.8     ? </h2><br>       ,        .      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="> II</a> . <br>      ,       ,  <i>   </i>  <b>CSI-Token</b>   <b>Changed-To</b> : <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/xk/rp/75/xkrp75ivdr3kjj1_i2sh9iwfqaa.png"></div><br>      . ,        ,    .             .       (Response Headers) : <b>CSI-Token-Action: success</b> ,    . <br>        (,               )  <b>CSI-Token-Action: aborted.</b> <br>   ,      CSI-Token-Action,         CSI-Token    Changed-To. <br>  <b> ¬´ ¬ª .</b> <br><br><a name="how_make_cross_domain_auth"></a><h2> 1.9   - ? </h2><br>  La autorizaci√≥n cl√°sica entre dominios utilizando la tecnolog√≠a <abbr title="Tecnolog√≠a de inicio de sesi√≥n √∫nico implementada por varios protocolos como SAML, OAuth, Kerberos">SSO</abbr> tiene muchas ventajas para el usuario.  No necesita recordar un mont√≥n de contrase√±as de un mont√≥n de sitios.  No es necesario registrarse y completar los formularios tristes.  Algunos servidores de autorizaci√≥n preguntan qu√© derechos otorgar al sitio que solicit√≥ el SSO. <br>  Pero tambi√©n hay desventajas.  <b>Depende del proveedor de SSO.</b>  Si el servidor SSO no funciona, no acceder√° al sitio de destino.  Si pierde su contrase√±a o le roban su cuenta, pierde el acceso de todos los sitios a la vez. <br>  Para los desarrolladores web, las cosas son un poco m√°s complicadas.  Desde el principio, debe registrar su sitio en el servidor de autorizaci√≥n, obtener las claves, aprender a trabajar con el protocolo ( <abbr title="Un est√°ndar abierto para el intercambio de datos de autenticaci√≥n y autorizaci√≥n entre un proveedor de cuenta y un proveedor de servicios.">SAML</abbr> , <abbr title="Un protocolo de autorizaci√≥n abierto que permite proporcionar a un tercero acceso limitado a los recursos protegidos del usuario sin tener que transferir un nombre de usuario y contrase√±a a un tercero.">OAuth</abbr> , etc.) y las bibliotecas correspondientes, asegurarse de que la clave no caduque, que el servidor de autorizaci√≥n no bloquee su sitio por sus razones y etc.  Esta es una tarifa por el hecho de que no necesita mantener cuentas de usuario, hacer formularios de registro, iniciar sesi√≥n, etc.  La verdad aumenta el costo de mantenimiento (en forma de reparaci√≥n de fallas repentinas).  Nuevamente, si el servidor de repente no est√° disponible para el sitio, desafortunadamente. <br>  Este esquema de autorizaci√≥n hace que SSO sea un poco m√°s seguro, y la autorizaci√≥n para todos los participantes es m√°s f√°cil.  Sobre la seguridad se discutir√° a continuaci√≥n en la secci√≥n <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">"Compromiso clave para SSO".</a> <br><br>  Eche un vistazo al sitio S, que admite el SSO de Google.  Supongamos que tiene una cuenta de Google.  Para iniciar sesi√≥n, haga clic en el enlace "Iniciar sesi√≥n con Google", que abrir√° la pesta√±a de autorizaci√≥n de Google.  El navegador le dir√° que tiene una clave para Google.  Y Google le dir√° qu√© derechos solicita S. <br>  Si est√° de acuerdo, haga clic en "Iniciar sesi√≥n" en el administrador de claves.  La p√°gina se volver√° a cargar.  Google ya recibir√° su token v√°lido, lo reconocer√° y lo autorizar√°.  Y con una solicitud entre servidores, informar√° al Sitio S sobre la informaci√≥n de su cuenta de acuerdo con los campos solicitados. <br>  La p√°gina recargada contendr√° un bot√≥n "Siguiente" que lo regresar√° al sitio de destino. <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/w5/u1/aa/w5u1aahv-_os9k2d81c819d5zhg.gif"></div><br><div class="spoiler">  <b class="spoiler_title">En la ilustracion</b> <div class="spoiler_text">  Dar√° un ejemplo de este algoritmo cuando se registre en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">www.youtube.com</a> utilizando la autorizaci√≥n entre dominios a trav√©s de accounts.google.com. <br></div></div><br>  El Sitio S puede decidir guardar datos sobre usted en su base de datos o no.  Este problema est√° m√°s all√° del alcance del esquema de autorizaci√≥n propuesto.  Pero adem√°s, donde consideraremos los riesgos de perder la clave para SSO, se recomienda que el sitio mantenga el token de usuario y el identificador de SSO a su lado, y se recomienda al usuario que cree una clave permanente para S. <br><blockquote>  <b>Vulnerabilidad:</b> despu√©s de dicha autorizaci√≥n, los sitios S1, S2, S3, ... (donde inici√≥ sesi√≥n a trav√©s de Google) podr√°n reconocerlo (por el identificador que le asign√≥ Google) y, como resultado, realizar un seguimiento de su actividad. </blockquote><br><blockquote>  <b>Opci√≥n de protecci√≥n:</b> no trabaje simult√°neamente en sitios si se registr√≥ a trav√©s del SSO del mismo proveedor.  Si es posible, cierre sesi√≥n en el servidor de autorizaci√≥n inmediatamente despu√©s de que se complete la autorizaci√≥n ("salida autom√°tica" para el dominio). </blockquote><br><br><a name="how_make_sub_domain_identify"></a><h2>  1.10 ¬øC√≥mo implementar la autenticaci√≥n entre dominios? </h2><br>  Todo esto, por supuesto, es bueno.  Si bien el trabajo se lleva a cabo en un navegador, todo est√° bien.  Pero, ¬øqu√© pasa con las realidades modernas cuando una persona tiene dos tel√©fonos m√≥viles, una computadora que funciona y varios navegadores, una computadora dom√©stica y otra computadora port√°til?  Adem√°s de una tableta com√∫n para la esposa / hijos. <br>  Tendremos que resolver de alguna manera el problema de transferir claves de dominio entre navegadores y dispositivos.  Y tambi√©n resuelva el problema de su correcta sincronizaci√≥n. <br>  Uno de los mecanismos para resolver este problema es calcular varias claves de dominio basadas en una clave maestra com√∫n sin la posibilidad de recuperaci√≥n inversa de la clave maestra a partir de una clave de dominio conocida. <br>  Al crear una clave personal K para el dominio D utilizando la clave maestra M en un dispositivo, el usuario podr√° crear la misma clave K para el dominio D y en cualquier otra utilizando la misma clave maestra M y un solo algoritmo.  M√°s precisamente, esto no lo har√° el usuario, sino su navegador.  Con este enfoque, es suficiente que el usuario distribuya su clave maestra entre todos los navegadores utilizados por √©l y que "transfiera todas sus claves" de dominios a la vez.  Al mismo tiempo realiza copias de seguridad de esta manera. <br>  M√°xima comodidad para el usuario.  <b>Pero tambi√©n el riesgo m√°ximo</b> en caso de compromiso de la clave maestra.  Por lo tanto, este √∫ltimo debe protegerse en consecuencia.  Los riesgos de p√©rdida o compromiso de la clave maestra, y las formas de minimizar dichos riesgos se describen en el cap√≠tulo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">"3 Recomendaciones de seguridad"</a> . <br>  Usar solo una clave maestra para generar todas las claves para todos los dominios no siempre es una opci√≥n conveniente.  En primer lugar, ¬øqu√© hacer si de repente la clave de dominio se ve comprometida y necesita ser cambiada?  En segundo lugar, ¬øqu√© sucede si necesita compartir una clave de dominio con otra persona?  Por ejemplo, entre miembros de la familia.  ¬øO es una cuenta corporativa de acceso al correo p√∫blico?  ¬øC√≥mo "recoger" su clave (porque de hecho se ha visto comprometida)? <br>  Por lo tanto, la generaci√≥n de claves de dominio individuales utilizando un sensor biol√≥gico de n√∫meros aleatorios debe ser compatible con los navegadores.  Pero luego volvemos a la cuesti√≥n de nuestra movilidad y los problemas de sincronizaci√≥n, las funciones de exportaci√≥n e importaci√≥n de claves en el navegador y la creaci√≥n de copias de seguridad. <br><br><h3>  Transferencia a trav√©s de un dispositivo f√≠sico enajenable </h3><br>  Las tarjetas inteligentes y los tokens usb pueden ser bastante adecuados como un almacenamiento seguro de informaci√≥n clave (porque fueron creados para esto).  La autenticaci√≥n de dos factores protege las claves del acceso no autorizado con acceso directo al dispositivo. <br>  Es cierto que las tarjetas inteligentes requieren lectores especiales (sin mencionar los controladores), lo que limita su uso solo a estaciones de trabajo equipadas con dichos lectores. <br>  Con tokens USB un poco m√°s f√°cil.  Solo se requieren conductores.  Pero no puedes pegar tal token en el tel√©fono.  Y aunque para los tel√©fonos m√≥viles hay tokens hechos en forma de tarjetas SD, no quiere decir que esta soluci√≥n aumente la movilidad.  Intente sacar una tarjeta de un tel√©fono m√≥vil, pero ins√©rtela en otra.  Y no es que esto sea imposible.  La cosa es que no es conveniente. <br>  ¬øY si se rompe la ficha?  Entonces todas tus llaves ir√°n al Gran Cthulhu. <br>  Por lo tanto, habr√° una tentaci√≥n con este esquema para usar varios dispositivos duplicados.  Pero a√∫n debe resolver el problema de sincronizaci√≥n de claves si tiene varias tarjetas inteligentes. <br>  Y, francamente, tales dispositivos no est√°n protegidos de los keyloggers.  Ahora, si el c√≥digo pin se ingresara desde la tarjeta / token.  Entonces otra cosa.  Pero no he visto tal en la naturaleza. <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/gq/1g/js/gq1gjsgtxvfjjvs79syif5_u8_w.png"></div><br><blockquote>  <b>Pros:</b> se pueden usar claves aleatorias de 256 bits;  alta seguridad mediante el uso de autenticaci√≥n de dos factores;  El m√°s alto nivel de protecci√≥n contra la manipulaci√≥n directa. <br>  <b>Contras:</b> dependencia del dispositivo;  requiere costos financieros;  baja movilidad;  la necesidad de reservar tarjetas y, como resultado, sincronizar datos entre ellas;  la vulnerabilidad a los keyloggers permanece. <br></blockquote><br><h3>  Sincronizaci√≥n a trav√©s del servicio en l√≠nea </h3><br>  La "tecnolog√≠a en la nube" ahora se utiliza siempre que sea posible.  Parece que, junto con la cadena de bloques, se han convertido en un sustituto de la "tecnolog√≠a bananera".  Naturalmente, existe el deseo de utilizar una determinada plataforma de Internet para el intercambio de informaci√≥n clave.  Una especie de tarjeta inteligente "en l√≠nea". <br>  Que?  Inicia sesi√≥n utilizando nuestro esquema de forma an√≥nima en dicho sitio;  env√≠e sus claves encriptadas con una contrase√±a all√≠;  Pasas de otro dispositivo al mismo sitio con la misma clave / contrase√±a;  obtienes las llaves desde all√≠;  Sincroniza los cambios por la fecha de edici√≥n.  Similar al administrador de contrase√±as, solo esto est√° en l√≠nea. <br>  Es solo que nadie garantiza que el servicio en l√≠nea no ser√° pirateado o no combinar√° sus claves, aunque encriptadas, "cuando sea necesario".  Qui√©n implementar√° dicho servicio de forma gratuita.  Eso es todo <br>  Aunque, por supuesto, la contrase√±a protege las claves del uso directo.  ¬øPero su contrase√±a es resistente a la fuerza bruta "fuera de l√≠nea"?  Esa es otra pregunta. <br><blockquote>  <b>Pros:</b> alta movilidad de credenciales;  independencia del dispositivo y del navegador;  solo necesita una contrase√±a (aunque no dejaron la contrase√±a, ya es mejor). <br>  <b>Desventajas:</b> menos seguro que almacenar claves en un medio alienable.  De hecho, la seguridad de las claves se basa en la fuerza de la contrase√±a para la selecci√≥n. <br></blockquote><br>  Por supuesto, puede usar una clave maestra para cifrar otras claves.  Con la que se calculan otras claves de dominio.  Como una opcion. <br><br><a name="part2"></a><h1>  2 Descripci√≥n t√©cnica del protocolo </h1><br><br><a name="perm_key_algo"></a><h2>  Algoritmo de generaci√≥n de clave de dominio 2.0 </h2><br>  Este protocolo define solo 2 m√©todos para generar claves de dominio. <br><br><ul><li>  basado en un generador de n√∫meros aleatorios (preferiblemente biol√≥gico) </li><li>  basado en una clave maestra de 256 bits </li></ul><br>  En el √∫ltimo caso, la clave de dominio se calcula como: <br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/3aa/d39/ac7/3aad39ac79fc322d157a9f4c58a793f2.svg" alt="$ K = HMAC_ {M_ {clave}} (Dominio) $" data-tex="display"></p>  donde <math></math><img src="https://habrastorage.org/getpro/habr/formulas/0b7/f4d/5a6/0b7f4d5a6dcc0d36804bd9dfc0ff9403.svg" alt="$ M_ {clave} $" data-tex="inline">  - Clave maestra de 256 bits, Dominio: nombre de dominio para el que est√° hecha la clave. <br>  De aqu√≠ en adelante, <i>HMAC</i> es <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">un algoritmo criptogr√°fico hash</a> basado en una implementaci√≥n de 256 bits de la funci√≥n hash <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">SHA-2</a> . <br><blockquote>  El compromiso o la divulgaci√≥n voluntaria de una clave de dominio no compromete la clave maestra original. </blockquote><br>  La clave maestra proporciona un mecanismo para la movilidad de las credenciales de usuario. <br><div class="spoiler">  <b class="spoiler_title">Nota</b> <div class="spoiler_text">  En la versi√≥n inicial del protocolo, se consideraba que la opci√≥n de generar claves de dominio basadas en la contrase√±a del usuario garantizaba la movilidad del usuario y la protecci√≥n contra el compromiso de la contrase√±a al piratear un sitio.  Pero en el cap√≠tulo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">"3 Recomendaciones de seguridad", se</a> dar√°n explicaciones de por qu√© se decidi√≥ rechazar dicho esquema. </div></div><br>  Si la clave creada sobre la base del "maestro" se vio comprometida, o la ficha calculada a partir de dicha clave (como resultado de la pirater√≠a del sitio) se vio comprometida, entonces la clave debe cambiarse.  Puede cambiarlo a una clave aleatoria de 256 bits, o generarlo desde el mismo "asistente", con la adici√≥n de una versi√≥n: <br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/eae/301/46b/eae30146bac887a402418464641e617e.svg" alt="$ K = HMAC_ {Mkey} (Dominio \ Versi√≥n de copa) $" data-tex="display"></p>  De aqu√≠ en adelante, el s√≠mbolo <math></math><img src="https://habrastorage.org/getpro/habr/formulas/a47/285/a28/a47285a2828b9a69edf64fea3e240a0d.svg" alt="$ \ cup $" data-tex="inline">  se usar√° para la operaci√≥n de concatenaci√≥n de cadenas (conjuntos de bytes). <br><br><a name="token_algo"></a><h2>  2.1 el algoritmo para calcular el token de origen </h2><br>  El token de autenticaci√≥n del usuario se calcula con cada solicitud de cualquier recurso de dominio.  Para calcular el token de solicitud, se toman los siguientes datos: <br><br><ul><li>  <i>Remitente</i> : el nombre de dominio del iniciador de la solicitud (puede ser una p√°gina con un iframe o un script del dominio de otra persona que realiza la b√∫squeda), </li><li>  <i>Destinatario</i> : nombre de dominio del destinatario (donde se env√≠a la solicitud), </li><li>  <i>Contexto</i> : contexto de ejecuci√≥n de solicitud, </li><li>  <i>Protecci√≥n</i> : una secuencia aleatoria de 32 bytes (256 bits), si el Contexto est√° vac√≠o;  de lo contrario vac√≠o </li></ul><br>  Estos datos se concatenan y se combinan con SHA-2 de 256 bits <b>en la clave K del dominio que inicia la solicitud</b> : <br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/8d1/bd1/cbc/8d1bd1cbc81815e0121976c9bb5e4ccc.svg" alt="$ K = HMAC_M (Remitente \ destinatario de copa \ Contexto de copa \ Protecci√≥n de copa) $" data-tex="display"></p><blockquote>  Se obtiene un token v√°lido cuando el Contexto no est√° vac√≠o.  Para una identificaci√≥n adecuada en el sitio de destino, se debe cumplir la condici√≥n Remitente = Destinatario = Contexto. </blockquote><br>  El campo Contexto, junto con Protecci√≥n, se usa para proteger contra ataques <abbr title="Scripting entre sitios - &quot;scripting entre sitios&quot;">XSS</abbr> y <abbr title="Falsificaci√≥n de solicitud de sitio cruzado - &quot;falsificaci√≥n de solicitud de sitio cruzado&quot;">CSRF</abbr> , as√≠ como contra el seguimiento de usuarios. <br>  A continuaci√≥n se dar√°n explicaciones m√°s detalladas sobre las reglas para determinar el Remitente / Destinatario / Contexto. <br><br><a name="token_validation_algo"></a><h2>  2.2 Algoritmo de protecci√≥n de tokens durante la transferencia </h2><br>  El token original del cliente se transmite extremadamente raramente.  Solo cuando se transfiere un token no registrado en el momento en que se cre√≥ la sesi√≥n. <br>  <b>Un token se considera no registrado</b> si: se crea sobre la base de una clave aleatoria (no fija);  no fue aceptado por el servidor despu√©s de enviar la clave Cambiar a o Permanente.  Para obtener m√°s detalles, consulte <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">"Procesamiento de tokens en el servidor"</a> . <br>  El navegador y el servidor generan conjuntamente un par de n√∫meros aleatorios, los llamados  sal (Salt), con la que se dividen los 128 bits inferiores del token.  Ambos intercambian estos n√∫meros de acuerdo con el protocolo.  Para obtener m√°s informaci√≥n, consulte <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">"Servidor-navegador de procedimientos de intercambio de sal"</a> . <br>  Por lo tanto, el servidor del sitio ve el siguiente token: <br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/8ea/b59/cc3/8eab59cc3e5060cfec9956f984807b5f.svg" alt="$ T = Hola (T_s) \ cup HMAC_ {salt} (Lo (T_s)) $" data-tex="display"></p>  donde <math></math><img src="https://habrastorage.org/getpro/habr/formulas/69c/826/a5b/69c826a5bc2d0953c3db1dbcc842a035.svg" alt="$ Hola (T_s) $" data-tex="inline">  - alto 128 bits, <math></math><img src="https://habrastorage.org/getpro/habr/formulas/73a/cbf/6b4/73acbf6b426b5d3dff599b4cba44ebfd.svg" alt="$ Lo (T_s) $" data-tex="inline">  - los 128 bits inferiores del token original, <math></math><img src="https://habrastorage.org/getpro/habr/formulas/a47/285/a28/a47285a2828b9a69edf64fea3e240a0d.svg" alt="$ \ cup $" data-tex="inline">  - Concatenaci√≥n de cuerdas.  En este caso, el token inicial <math></math><img src="https://habrastorage.org/getpro/habr/formulas/c39/070/036/c39070036bed1c9b371606081981a5fb.svg" alt="$ T_s $" data-tex="inline">  ya deber√≠a ser conocido por el servidor. <br><br>  Idealmente, CSI-Salt deber√≠a cambiar cada vez que un navegador solicite un servidor.  Sin embargo, esto puede ser un requisito costoso en t√©rminos de recursos inform√°ticos.  Adem√°s, puede "matar" la capacidad de enviar solicitudes paralelas al servidor. <br>  Por lo tanto, para optimizar los c√°lculos, se permite mantener los valores de CSI-Salt sin cambios en diferentes solicitudes, <u>pero no m√°s de una sesi√≥n</u> .  Esto puede ser un l√≠mite de tiempo (cambio de CSI-Salt cada 5 minutos), o una reacci√≥n a la intensidad de las solicitudes (cambio de CSI-Salt cada 100 solicitudes), o despu√©s de cada serie de solicitudes (en el momento de la pausa, cliente-servidor), o una versi√≥n mixta.  Aqu√≠ la decisi√≥n se deja a los desarrolladores del navegador. <br>  Mantener CSI-Salt sin cambios durante demasiado tiempo debilita la protecci√≥n del token transmitido, lo que permite al atacante interceptar el token mientras el usuario leg√≠timo ha completado el cierre de sesi√≥n y ejecutar una solicitud no autorizada en nombre de la v√≠ctima. <br><br><a name="salt_exchange_algo"></a><h2>  2.3 Procedimiento de intercambio de sal entre navegador y servidor </h2><br>  2.3.1 Token basado en una clave de servidor aleatoria o no registrada <sup>[1]</sup> . <br><div class="scrollable-table"><table><tbody><tr><th>  <b>Navegador</b> </th><th>  <b>Servidor</b> </th></tr><tr><td colspan="2">  <b>Solicitud inicial (inicializaci√≥n de sesi√≥n de usuario)</b> </td></tr><tr><td>  El navegador env√≠a el token tal como est√°. <br>  <b>Falta su solicitud CSI-Salt.</b> <br></td><td>  El servidor ve primero un token de este tipo. <br><div class="spoiler">  <b class="spoiler_title">por cierto</b> <div class="spoiler_text">  Es posible que el servidor no sea el primero en ver dicho token.  Y el navegador se considera no registrado.  Esto puede suceder <u>cuando recrea la clave basada en la clave maestra en otro dispositivo</u> .  Por lo tanto, esta situaci√≥n tambi√©n debe tenerse en cuenta. </div></div><br>  Lo percibe como es (lo considera desprotegido).  Utiliza este token como identificador de sesi√≥n. <br>  Genera su <i><sub>sal</sub> S.</i> <br>  <b>Lo devuelve en la respuesta en el encabezado CSI-Salt.</b> <br></td></tr><tr><td colspan="2">  <b>Segunda solicitud</b> </td></tr><tr><td>  Genera sal <i>con <sub>sal</sub></i> . <br>  El navegador conecta <sup>[3]</sup> su sal y la sal del servidor. <br>  El navegador env√≠a la solicitud, pasando un token de sal compartido. <br>  <b>Env√≠a CSI-Sal.</b> <br></td><td>  El servidor recibe la solicitud y <b>recupera el cliente CSI-Salt</b> . <br>  El servidor conecta la sal del navegador con la suya y la usa para verificar el token. <br><br>  Si la validaci√≥n del token es exitosa, proporciona al usuario contenido de acuerdo con sus derechos. <br><br>  En los errores de verificaci√≥n, devuelve la <b>CSI-Token-Action:</b> encabezado <b>no v√°lido</b> al cliente.  Devolver contenido o devolver una respuesta vac√≠a: depende del servidor. <br></td></tr><tr><td colspan="2">  <b>Solicitudes posteriores</b> </td></tr><tr><td>  El navegador env√≠a la solicitud, pasando un token de sal compartido. <br>  <b>Falta su solicitud CSI-Salt.</b> <br></td><td>  El servidor recibe la solicitud y verifica su token. <br><br>  Si la validaci√≥n del token es exitosa, proporciona al usuario contenido de acuerdo con sus derechos. <br><br>  En los errores de verificaci√≥n, devuelve la <b>CSI-Token-Action:</b> encabezado <b>no v√°lido</b> al cliente.  Devolver contenido o devolver una respuesta vac√≠a: depende del servidor. <br></td></tr><tr><td colspan="2">  <b>Despu√©s de un tiempo <sup>[2]</sup></b> </td></tr><tr><td>  Genera una nueva sal <i>C <sub>sal</sub></i> . <br>  Conecte la nueva sal al servidor de sal. <br>  Env√≠a una solicitud, pasando una ficha protegida por una nueva sal com√∫n. <br>  <b>Env√≠a CSI-Sal.</b> <br></td><td>  El servidor recibe la solicitud y <b>recupera el nuevo cliente CSI-Salt</b> . <br>  El servidor conecta la sal del navegador con la suya y la usa para verificar el token. <br><br>  Si la validaci√≥n del token es exitosa, proporciona al usuario contenido de acuerdo con sus derechos. <br><br>  En los errores de verificaci√≥n, devuelve la <b>CSI-Token-Action:</b> encabezado <b>no v√°lido</b> al cliente.  Devolver contenido o devolver una respuesta vac√≠a: depende del servidor. <br></td></tr></tbody></table></div><br>  2.3.2 Token basado en la clave registrada por el servidor <sup>[1]</sup> . <br><div class="scrollable-table"><table><tbody><tr><th>  <b>Navegador</b> </th><th>  <b>Servidor</b> </th></tr><tr><td colspan="2">  <b>Solicitud inicial (inicializaci√≥n de sesi√≥n de usuario)</b> </td></tr><tr><td>  Genera sal <i>con <sub>sal</sub></i> . <br>  <b>Env√≠a CSI-Sal.</b> <br>  Transfiere el token de forma protegida. <br></td><td>  El servidor recibe la solicitud y <b>recupera el cliente CSI-Salt</b> . <br>  Lee una ficha protegida. <br>  Encuentra el token de cliente completo en su base de datos (usa el primer token de 128 bits recibido en la solicitud de b√∫squeda). <br>  Porque  esta es la solicitud inicial, el servidor no envi√≥ sal al cliente, luego la <b>validaci√≥n</b> del <b>token en esta etapa se realiza solo por la sal del cliente</b> . <br><br>  En los errores de verificaci√≥n, devuelve la <b>CSI-Token-Action:</b> encabezado <b>no v√°lido</b> al cliente.  Devolver contenido o devolver una respuesta vac√≠a: depende del servidor. <br><br>  Si la validaci√≥n del token es exitosa, proporciona al usuario contenido de acuerdo con sus derechos. <br><br>  Genera su <i><sub>sal</sub> S.</i> <br>  <b>Lo devuelve en la respuesta en el encabezado CSI-Salt</b> . <br></td></tr><tr><td colspan="2">  <b>Solicitudes posteriores</b> </td></tr><tr><td>  El navegador combina su sal y la sal del servidor. <br>  El navegador env√≠a la solicitud, pasando un token de sal compartido. <br>  <b>Falta su solicitud CSI-Salt</b> . <br></td><td>  El servidor recibe la solicitud y verifica su token. <br><br>  Si la validaci√≥n del token es exitosa, proporciona al usuario contenido de acuerdo con sus derechos. <br><br>  En los errores de verificaci√≥n, devuelve la <b>CSI-Token-Action:</b> encabezado <b>no v√°lido</b> al cliente.  Devolver contenido o devolver una respuesta vac√≠a: depende del servidor. <br></td></tr><tr><td colspan="2">  <b>Despu√©s de un tiempo <sup>[2]</sup></b> </td></tr><tr><td>  Genera una nueva sal <i>C <sub>sal</sub></i> . <br>  El navegador conecta la nueva sal al servidor sal. <br>  El navegador env√≠a la solicitud, pasando un token protegido por la nueva sal compartida. <br>  <b>Env√≠a CSI-Sal</b> . <br></td><td>  El servidor recibe la solicitud y <b>recupera el nuevo cliente CSI-Salt</b> . <br>  El servidor conecta la sal del navegador con la suya y la usa para verificar el token. <br><br>  Si la validaci√≥n del token es exitosa, proporciona al usuario el contenido de acuerdo con sus derechos. <br><br>  En los errores de verificaci√≥n, devuelve la <b>CSI-Token-Action:</b> encabezado <b>no v√°lido</b> al cliente.  Devolver contenido o devolver una respuesta vac√≠a: depende del servidor. <br></td></tr></tbody></table></div><hr>  <sup>[1] Un token se considera no registrado si: se crea sobre la base de una clave aleatoria;</sup>  <sup>no fue aceptado por el servidor despu√©s de enviar la clave de cambio o permanente con CSI-Token-Action: respuesta de √©xito.</sup> <sup><br></sup>  <sup>[2] El tiempo a trav√©s del cual se realiza el cambio CSI-Salt lo determinan los propios navegadores.</sup>  <sup>Esto puede suceder despu√©s de una serie de solicitudes, despu√©s de un tiempo de espera, despu√©s de un cierto n√∫mero de solicitudes.</sup> <sup>  ‚Äì <b>     CSI-Salt    </b> . <br> [3]     16-  128- .     ,   : <i> <sub>salt</sub></i> || <i>S <sub>salt</sub></i> .       ‚Äì     ,    .      ,    ,    .</sup> <br><br><a name="context_rules"></a><h2> 2.4    Context </h2><br><div class="spoiler"> <b class="spoiler_title">  </b> <div class="spoiler_text">      .   ,  -  .            . <br>       ,   .      ,     . <br></div></div><br>   <i></i>  ,     (    ).     <i></i> .      . <br><br>   <i></i> ,       .   <i></i> ,       .    , , ajax-    . <br><br>   ,       . ,     &lt;script&gt;,   ,    . ,     &lt;script&gt;,  ,    ,           .      &lt;script&gt;         . <br><br>   LINK, SCRIPT, IMG, IFAME  ,      - ,      DOM ‚Äì <i> </i> . <br><br>   FORM, A, META  ,         (submit, click, timeout) ‚Äì <i> </i> . <br><br>   <i></i> ,          .   <i></i> ,        . <br><br>  FORM  ,       ,      INPUT,    . <br><br>    <i></i> ,    ,   ,     ,   ,   ,   .        <i></i> . <br><br> <b>    .</b>         ,   ,    click ( ),  submit ( )       onclick/onsubmit. <br><br>         .    ‚Äì META   http-equiv=¬´refresh¬ª content=¬´0¬ª. <br><br> <sup> P.  Context     </sup> <br><a name="context_table_P"></a><div class="scrollable-table"><table><tbody><tr><th colspan="3" rowspan="2">   </th><th colspan="4">    ? </th></tr><tr><th>  Usuario </th><th> . JS </th><th> . JS </th><th>  </th></tr><tr><td rowspan="3">  <sup>1</sup> </td><td colspan="2">  </td><td> P1. Referrer </td><td> P2. Variant <sup>3</sup> </td><td> P3. Empty </td><td> P4. Inherit </td></tr><tr><td rowspan="2">  </td><td>  </td><td> P5. Inherit </td><td> P6. Variant <sup>3</sup> </td><td> P7. Empty </td><td> P8. Inherit </td></tr><tr><td>  </td><td> P9. Empty </td><td> PA. Empty </td><td> PB. Empty </td><td> PC. Empty </td></tr><tr><td colspan="3">  </td><td> PD. Domain </td><td> PE. Variant <sup>3</sup> </td><td> PF. Empty </td><td> PG. Variant <sup>4</sup> </td></tr></tbody></table></div><br><div class="spoiler"> <b class="spoiler_title">  ,  </b> <div class="spoiler_text">  <img src="https://habrastorage.org/webt/cq/l-/6e/cql-6eob6gouvsqsrdy5ltykhfg.gif" align="right"></div></div><br>       (  SRC  IMG),      ,  ,   /  ,   ‚Äî ,      ¬´¬ª. <br><br> <sup> R.  Context    <b> /</b></sup> <br><a name="context_table_R"></a><div class="scrollable-table"><table><tbody><tr><th colspan="3" rowspan="2">   </th><th colspan="3">    ? </th></tr><tr><th> DOM Parser </th><th> . JS </th><th> . JS </th></tr><tr><td rowspan="3">  <sup>2</sup> </td><td colspan="2">  </td><td> R1. Page </td><td></td><td></td></tr><tr><td rowspan="2">  </td><td>  </td><td> R4. Page </td><td></td><td></td></tr><tr><td>  </td><td> R7. Empty </td><td></td><td></td></tr><tr><td colspan="3">  </td><td> RA. Referrer </td><td> RB. Page </td><td> RC. Referrer </td></tr></tbody></table></div><br><div class="spoiler"> <b class="spoiler_title">  ,  </b> <div class="spoiler_text">  <img src="https://habrastorage.org/webt/dl/zi/mn/dlzimnup-7etmrsysxzlxjw1zd8.gif" align="right"></div></div><br><hr> <sup>[1]   <br> [2]   <br> [3] Inherit    , Empty      <br> [4] Inherit      , Empty            (. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a> )</sup> <br><br><div class="spoiler"> <b class="spoiler_title">  </b> <div class="spoiler_text"> <b>Referrer</b> ‚Äì     Referrer. <br> <b>Page</b> ‚Äì   (Tab)      . <br> <b>Empty</b> ‚Äì  . <br> <b>Domain</b> ‚Äì  Context     <br> <b>Inherit</b> ‚Äì  Context     <br> <b>Variant</b> ‚Äì  Context    ¬´-¬ª   <br></div></div><br>   P1..PF, R1..RC            . <br><blockquote>     <b>Referrer</b>  <b>Domain</b>   .       ,       ,      ,       . </blockquote><br><br><a name="sender_recipient_rules"></a><h2> 2.5    Sender  Recipient </h2><br> Sender ‚Äì   //,    .   , , .     ajax.     .   . <br><br> Recipient ‚Äì  ,     . <br><br>    ,    . <br><br>    site.net.     : <ul><li>  site.net/css/common.css </li><li>   common.css   fonts.google.com/fonts/Roboto.css </li><li>  Roboto.css   fonts.google.com/fonts/Roboto.ttf </li><li> ,   img.site.net/picture1.jpg </li><li> ,   adriver.ru/frame </li><li>   adm.site.net/admin.js </li></ul><br>    ( adriver.ru) : <ul><li>   adriver.ru/style.css </li><li>   img.adriver.ru/img/01.png </li><li>   adriver.ru/libs.js </li><li>   api.adriver.ru/v1/ad.js </li></ul><br>  Sender / Recipient     DOM <br><div class="scrollable-table"><table><tbody><tr><th>   </th><th>  Sender </th><th>  Recipient </th></tr><tr><td> site.net/css/common.css </td><td> site.net </td><td> site.net </td></tr><tr><td> fonts.google.com/fonts/Roboto.css </td><td> site.net </td><td> fonts.google.com </td></tr><tr><td> fonts.google.com/fonts/Roboto.ttf </td><td> fonts.google.com </td><td> fonts.google.com </td></tr><tr><td> img.site.net/picture1.jpg </td><td> site.net </td><td> img.site.net </td></tr><tr><td> adriver.ru/frame </td><td> site.net </td><td> adriver.ru </td></tr><tr><td> adm.site.net/admin.js </td><td> site.net </td><td> adm.site.net </td></tr><tr><td> adriver.ru/style.css </td><td> adriver.ru </td><td> adriver.ru </td></tr><tr><td> img.adriver.ru/img/01.png </td><td> adriver.ru </td><td> img.adriver.ru </td></tr><tr><td> adriver.ru/libs.js </td><td> adriver.ru </td><td> adriver.ru </td></tr><tr><td> api.adriver.ru/v1/ad.js </td><td> adriver.ru </td><td> api.adriver.ru </td></tr></tbody></table></div><br>    Sender / Recipient        ajax-. <br><br>  Sender / Recipient     <br><div class="scrollable-table"><table><tbody><tr><th>   </th><th>    </th><th> Sender </th><th> Recipient </th></tr><tr><td> adm.site.net/admin.js </td><td> site.net/api/ </td><td> adm.site.net </td><td> site.net </td></tr><tr><td> adriver.ru/libs.js </td><td> adriver.ru/api/ </td><td> adriver.ru </td><td> adriver.ru </td></tr><tr><td> api.adriver.ru/v1/ad.js </td><td> api.2gis.ru/‚Ä¶ </td><td> api.adriver.ru </td><td> api.2gis.ru </td></tr></tbody></table></div><br><br><a name="context_tables_comments"></a><h2> 2.6      Context </h2><br>  ,     (  )   ,    Context    . <br><br><a name="P1"></a> <b>P1</b> ‚Äì          submit  .      /     .  .        . <br><br>    site.net    google.com, Context     (google.com).      site.net   (      ,   ). <br><br>     (  )           <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">P1</a> ,  Context     site.net, ..   Context = Referrer. <br><br>      <abbr title="ross Site Request Forgery ‚Äî ¬´  ¬ª">CSRF</abbr> -. <br><br><a name="P5"></a> <b>P5</b> ‚Äì       , / ,     ;         submit , /  (  FORM,    INPUT).      /     . <br><br><a name="P9"></a> <b>P9</b> ‚Äì ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">P5</a> ,    ,          (       ). <br><br><a name="PD"></a> <b>PD</b> ‚Äì      .  . <br><blockquote>       URL   .      . </blockquote><br>      ,   ,   ,       ,  ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">PG</a> (    ).     F5,   ,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">PG</a> .          Enter     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">PD</a> . <br><br>     CSRF-   . <br><br>                  Context,   ,     F5 ( ).      ,    -     ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">P1</a> ). <br><br>  ,              site.net,    ,        .           ,     ,   ‚Ä¶ ,   ,  ,     site.net. <br><br><a name="P2"></a> <b>P2</b> ‚Äì       ,    ,       click/submit.      ,   .      . <br><br>       , Context    .      , Context  . <br><br><a name="P6"></a> <b>P6</b> ‚Äì  ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">P2</a> ,  /  /  . <br><br><a name="PA"></a> <b>PA</b> ‚Äì  ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">P2</a> ,  /  /  . <br><br><a name="PE"></a> <b>PE</b> ‚Äì          window.location.href  window.open(‚Ä¶). <br><br>   site.net        ,  Context     .    Context = site.net. <br><br>     ya.ru,      maps.ya.ru,  Context     .     Context     ,      . <br><br>  ,      ‚Äì  .           CSRF-. <br><br><a name="P3"></a> <b>P3</b> ‚Äì  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">P2</a> ,   click/submit    . Context   (     ),        ( ). <br><br><a name="P7"></a> <b>P7</b> ‚Äì  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">P6</a> ,  /  /  . <br><br><a name="PB"></a> <b>PB</b> ‚Äì  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">PA</a> ,  /  /  . <br><br><a name="PF"></a> <b>PF</b> ‚Äì  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">PE</a> ,     . <br><br><a name="P4"></a> <b>P4</b> ‚Äì        &lt;META&gt;.     .  . Context     .     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">PE</a> . <br><br><a name="P8"></a> <b>P8</b> ‚Äî        &lt;META&gt;.    /  .  ,  Context     .     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">PE</a> .        . <br><br><a name="PC"></a> <b>PC</b> ‚Äì  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">P8</a> ,   .      Context  . <br><br><a name="PG"></a> <b>PG</b> ‚Äì       .   ,       ,     .    ,    ,   .       ,   Context       . <br><br>     CSRF-   . <br><br><blockquote>       ,  Context          . </blockquote><br>  ,      ,        (   )    HTTP- Header.       ,   Context .      ‚Äì . <br><br>      - -. <br><br><blockquote> ,         - .     SSO-         ‚Äì    . </blockquote><br>   ¬´ ¬ª     ,     - .    : <br><br><ol><li>         ; </li><li>      SSO- ,   ; </li><li>      SSO-; </li><li> SSO-,   Changed-To,  -    ; </li><li>      - ¬´¬ª,       ; </li><li>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">P1</a> ,        -,     (,     ). </li><li>   -,  ,       . </li></ol><br>   ,   , ,   .  UI-   : <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/w5/u1/aa/w5u1aahv-_os9k2d81c819d5zhg.gif"></div><br><blockquote>           SSO-.     . </blockquote><br><br>   ,       ,    Context    . <br><br><a name="R1"></a> <b>R1</b> ‚Äì        (   ).  Context         Context    . <br><br> ,    site.net   adriver.ru,       img.disk.com,    HTTP-  img.disk.com    Context  ,      site.net. <br><br><a name="R4"></a> <b>R4</b> ‚Äì ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">R1</a> .     /  ,     DOM Parser . ,   site.net/index.html   site.net/require.js      ( &lt;script src=‚Ä¶&gt;) site.net/min.js,         main.js.  Context       ,      site.net. <br><br><a name="R7"></a> <b>R7</b> ‚Äì ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">R1</a> .      /  ,          Context   256- .      evil.com/drop.js,      site.net,       site.net     , ..            . <br><br><a name="RA"></a> <b>RA</b> ‚Äì         . ,   site.net/css/common.css,    site.net/index.html,    fonts.google.com/fonts/Roboto.css,        fonts.google.com   Referrer = site.net/css/common.css.  Context      Referrer.    Roboto.css   Roboto.ttf,        fonts.google.com/fonts/Roboto.ttf   Referrer = fonts.google.com/fonts/Roboto.css.  Context       Referrer,   . <br><br> , ,   Roboto.css ( )   /,    CSRF-  : <pre><code class="css">@import "https://site.net/api/payment?victim_params"</code> </pre>  con la esperanza de cumplir con la solicitud en site.net en nombre de un usuario autorizado.  Pero el problema para el atacante es que site.net espera recibir un token del usuario: <br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/18c/ba0/6d3/18cba06d3ab48142219dbf3e3f4e2330.svg" alt="$ T_s ^ 1 = HMAC_k (sitio.net \ cup site.net \ cup site.net) $" data-tex="display"></p><br>  Luego, como con una solicitud CSRF, el navegador crear√° un token: <br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/466/929/b86/466929b86ade0b848996042a3ac12f25.svg" alt="$ T_s ^ 2 = HMAC_k (fonts.google.com \ cup site.net \ cup fonts.google.com) $" data-tex="display"></p><br>  Y una solicitud al sitio vendr√° en nombre de un sitio an√≥nimo que no tiene derechos de acceso para realizar estas operaciones. <br><br><a name="RB"></a>  <b>RB</b> : el contenido se carga mediante el script propio del sitio.  En este caso, Context se usa para calcular el token de solicitud, que es igual a la p√°gina que contiene el script.  Para el script site.net/1.js de la p√°gina de contexto de site.net, ser√° igual al contexto de la p√°gina en s√≠. <br><blockquote>  Tenga en cuenta que el contexto de la p√°gina en s√≠ no siempre es igual al nombre de dominio de la p√°gina y depende de c√≥mo se abri√≥ originalmente. </blockquote>  Suponga que el sitio del atacante evil.com abre la p√°gina del sitio atacado site.net, donde el script site.net/util.js ejecuta una solicitud con par√°metros que pasan a trav√©s de la URL de la p√°gina.  El atacante espera, al deslizar "sus par√°metros" a trav√©s de la URL, forzar su propio script site.net/util.js para ejecutar una solicitud ajax para realizar acciones importantes en nombre de la v√≠ctima. <br><br>  Supongamos que el usuario mismo fue a evil.com a trav√©s de un enlace directo.  Entonces el contexto de evil.com ser√° evil.com.  Adem√°s evil.com abre el script site.net/api/payment?victim_params con un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">script</a> , con la esperanza de llevar a cabo un ataque, pero el campo Contexto para site.net estar√° vac√≠o (caso PE / PF).  El script site.net/utils.js, al ejecutar una solicitud ajax, obligar√° al navegador a tomar Contexto de la p√°gina site.net.  Y est√° vac√≠o con nosotros.  Pero entonces site.net recibir√° una solicitud ajax con este token: <br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/866/a41/990/866a41990a710d17dbe34a04ecb2e28c.svg" alt="$ T = HMAC_ {site.ru-key} (site.net \ cup site.net \ cup random) $" data-tex="display"></p><br>  mientras que para un usuario autorizado se espera: <br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/025/1b3/fad/0251b3fadaf0e4f1535b6aa8a67df332.svg" alt="$ T_s = HMAC_ {site.ru-key} (sitio.net \ cup site.net \ cup site.net) $" data-tex="display"></p><br>  site.net ver√° un token desconocido y no podr√° identificar al usuario.  La protecci√≥n funcion√≥. <br><blockquote>  Por cierto, hablando, debido a tal esquema, la realizaci√≥n de autorizaciones entre dominios a trav√©s de ventanas emergentes no ser√° realista. </blockquote>  Para implementar SSO bajo el protocolo, debe abrir una nueva pesta√±a para la p√°gina del servidor de autorizaci√≥n.  Y al mismo tiempo, el usuario debe abrir dicha pesta√±a.  La mejor opci√≥n es abrir al usuario el enlace apropiado desde el sitio de destino. <br><br><a name="RC"></a>  <b>RC</b> : el contenido se carga con un script de sitio web externo.  En este caso, el contexto se usa para calcular el token de solicitud, que es igual al campo Remitente de solicitud. <br><br>  A pesar de que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">RA</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">RB</a> y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">RC</a> protegen contra los ataques CSRF, sin embargo conducen a la generaci√≥n de tokens constantes.  Y <b>esto le permite implementar la autenticaci√≥n entre dominios y</b> la <b>autenticaci√≥n de</b> usuarios entre <b>dominios</b> (cuando necesita determinar que varias solicitudes a diferentes servidores provienen de este usuario).  Lo que se puede implementar para proporcionarle la misma autoridad en un grupo de dominios relacionados. <br><br>  Si la <b>p√°gina</b> del <b>sitio se abri√≥ autom√°ticamente</b> desde otro sitio, no podr√° iniciar sesi√≥n all√≠, incluso si vuelve a cargar este sitio usted mismo.  Porque Source heredar√° de un valor nulo.  El navegador debe indicarle al usuario sobre este hecho (Fuente = Aleatorio): <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/1h/pr/ew/1hprewdwumpuwpzmzkqfmbds104.jpeg"></div><br>  Esto se hace para proteger contra los sitios que obligan a abrir otras ventanas emergentes (ellos mismos o sus scripts externos), y en los sitios que se abren, se reiniciar√°n o crear√°n botones falsos de "cierre" en toda la pantalla que conducen a los mismos sitios.  Es decir  Esto evita un intento de rastrearlo, con la esperanza de obtener un token v√°lido. <br><br>  <b>Cualquier intento por parte del sitio de imitar sus acciones con un script externo</b> , o un intento de un script externo para crear directa o indirectamente una etiqueta de inicio y deslizarla hacia usted, conducir√° a una Fuente vac√≠a y a la adici√≥n de bytes aleatorios al momento de calcular el token hash. <br><br>  El truco para crear o modificar la etiqueta &lt;script&gt; en la p√°gina atacada en el DOM no ayudar√°.  El campo Fuente permanecer√° en blanco. <br><br>  Pero bajo las mismas condiciones, los scripts internos conducir√°n a consultas con Source igual a su valor anterior.  Y si la p√°gina original tuviera Source = Domain, todo estar√≠a bien.  El usuario seguir√° estando autorizado para tales solicitudes. <br><br>  Pero con los scripts descargados de recursos de terceros (CDN), pueden surgir problemas en algunos casos.  Y es correcto, porque  La integridad del c√≥digo CDN no est√° garantizada.  Si no desea perder la autorizaci√≥n del usuario, mantenga los scripts en su sitio y desc√°rguelos de su dominio.  Esto es algo as√≠ como la prohibici√≥n de usar enlaces http en p√°ginas https. <br><br>  Describimos la situaci√≥n en la que podr√≠a caer un desarrollador.  Como resultado de las acciones del usuario, su script redirige a un usuario autorizado a una de las p√°ginas del sitio (por ejemplo, esto se hace mediante un formulario), lo que requiere que el usuario permanezca autorizado.  Su script llama, por ejemplo, $ (form) .submit () usando un script jQuery cargado desde el CDN.  En este caso, el navegador ve que en la pila de llamadas que activ√≥ el evento de env√≠o del formulario, hay una funci√≥n de un script externo.  Para evitar ataques <abbr title="Scripting entre sitios - &quot;scripting entre sitios&quot;">XSS</abbr> / <abbr title="Falsificaci√≥n de solicitud de sitio cruzado - &quot;falsificaci√≥n de solicitud de sitio cruzado&quot;">CSRF</abbr> , el navegador vac√≠a el campo Fuente y agrega bytes aleatorios a la generaci√≥n del token (caso <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">P9</a> ).  Como resultado, el usuario en la nueva p√°gina de repente queda sin autorizaci√≥n y no puede completar la operaci√≥n.  Esto puede ser confuso para los desarrolladores que est√°n acostumbrados a usar CDN. <br><br><a name="protocol_scenario"></a><h2>  2.7 Escenarios de protocolo </h2><br>  Estos son los principales escenarios probables del usuario que trabaja con el sitio, que afectan todas las situaciones posibles y las etapas de su implementaci√≥n (inicio de sesi√≥n an√≥nimo, "recordarme", "olvidarme", cambiar a una clave permanente, autorizaci√≥n y salida, registro y autenticaci√≥n de dos factores, exportaci√≥n / importaci√≥n de claves, reemplazo de claves, etc.) <br><div class="scrollable-table"><table><tbody><tr><th colspan="3">  1 Foro, Blog, Wikipedia </th></tr><tr><th>  Usuario </th><th>  Navegador </th><th>  Servidor del sitio </th></tr><tr><td>  1.1 Primer acceso a este sitio. </td><td>  Genera una clave aleatoria.  Env√≠a un token inseguro desde una clave aleatoria. </td><td>  Consideramos al usuario an√≥nimo.  Utilizamos este token como el identificador de la sesi√≥n del usuario. </td></tr><tr><td>  1.2 Ver p√°ginas. </td><td>  Env√≠a un token seguro contra una clave aleatoria. </td><td>  Proporciona contenido p√∫blico.  Comprueba el bit de token inferior de 128 bits. </td></tr><tr><td>  1.3 Intentar hacer acciones (agregar comentarios, etc.) </td><td>  Env√≠a un token seguro contra una clave aleatoria. </td><td>  Le dice al usuario que necesita presentarse al sistema.  En esta etapa, el sitio conf√≠a en que la clave es aleatoria. </td></tr><tr><td>  1.4 Le dice al navegador que haga que el sitio lo recuerde. </td><td>  Corrige la clave actual.  Env√≠a una clave permanente.  El token, como antes, se transmite de forma protegida.  Env√≠a esta clave hasta que recibe el √©xito del servidor. </td><td>  Ahora el sitio sabe que la clave est√° arreglada.  Env√≠a CSI-Token-Action: √©xito.  Puede aplicar la t√©cnica de recordar al usuario durante mucho tiempo: guarda el token en la base de datos para la recuperaci√≥n futura de la sesi√≥n con el usuario.  O mantiene la sesi√≥n durante m√°s tiempo (guardar en archivo). </td></tr><tr><td>  1.5 Realiza acciones (agregar publicaciones, votar, etc.) </td><td>  Env√≠a un token CSI seguro desde una clave fija. </td><td>  Registra acciones de este usuario. </td></tr><tr><td>  1.6 Cierra la pesta√±a del navegador. </td><td>  Nada </td><td>  Est√° esperando las siguientes solicitudes de usuario. </td></tr><tr><td>  1.7 Regresa al sitio. </td><td>  Env√≠a una clave fija segura. </td><td>  Contin√∫a trabajando con el usuario.  Los datos de la sesi√≥n se toman de la base de datos o del archivo temporal por token. </td></tr><tr><td>  1.8 Deshace la fijaci√≥n de la clave (olv√≠dame en este sitio) </td><td>  Env√≠a una clave de cierre de sesi√≥n </td><td>  Elimina datos de usuario en la base de datos, como  era una clave fija, y el usuario nunca podr√° recuperarla nuevamente.  Termina la sesi√≥n.  El navegador nunca volver√° a enviar ese token. </td></tr><tr><td>  1.9 Cuando accede por primera vez al sitio despu√©s de Cerrar sesi√≥n. </td><td>  Genera una clave aleatoria.  Env√≠a un token inseguro desde una clave aleatoria. </td><td>  Este sitio ya es un usuario nuevo.  Consideramos al usuario an√≥nimo.  Usamos el token como el identificador de la sesi√≥n del usuario. </td></tr><tr><td>  1.10 Examinar p√°ginas. </td><td>  Env√≠a un token seguro contra una clave aleatoria. </td><td>  Proporciona contenido p√∫blico.  Comprueba el bit de token inferior de 128 bits. </td></tr><tr><td>  1.11 Cierra la pesta√±a del navegador. </td><td>  Nada </td><td>  Rompe una sesi√≥n despu√©s de un tiempo de espera. </td></tr><tr><td>  1.12 Regresa al sitio. </td><td>  Genera una clave aleatoria.  Env√≠a un token inseguro desde una clave aleatoria. </td><td>  Consideramos al usuario an√≥nimo.  Utilizamos este token como el identificador de la sesi√≥n del usuario. </td></tr><tr><td>  1.13 Crea una clave de sitio permanente. </td><td>  Nada </td></tr><tr><td>  1.14 Activaci√≥n de la clave permanente. </td><td>  <b>Pregunta al usuario: ¬ørealmente quieres que el sitio recuerde tu clave?</b>  <b>Aseg√∫rese de que este sitio sea quien dice ser.</b> <br>  Env√≠a cambio a.  Solo en este momento el navegador pasa el token a los desprotegidos.  En todos los tiempos siguientes, el navegador siempre transmitir√° un token protegido al iniciar sesi√≥n.  Pero para esto, el sitio debe confirmar el cambio de tokens a trav√©s de CSI-Token-Action: √©xito. </td><td>  Recuerde el nuevo token de usuario en la base de datos.  Cambia la ID de sesi√≥n.  Contin√∫a esperando solicitudes del nuevo token.  Env√≠a CSI-Token-Action: √©xito. </td></tr><tr><td>  1.15 Realiza acciones (agregar publicaciones, votar, etc.) </td><td>  Env√≠a un token seguro desde una clave permanente </td><td>  Registra acciones de este usuario.  Comprueba el token inferior de 128 bits. </td></tr><tr><td>  1.16 Hace la "Salida". </td><td>  Env√≠a una clave de cierre de sesi√≥n </td><td>  Rompe la sesi√≥n </td></tr><tr><td>  1.17 Regresa al sitio. </td><td>  Genera una clave aleatoria.  Env√≠a un token inseguro desde una clave aleatoria. </td><td>  Consideramos al usuario an√≥nimo.  Usamos el token como el identificador de la sesi√≥n del usuario. </td></tr><tr><td>  1.18 Activaci√≥n de la clave permanente. </td><td>  Env√≠a cambio a.  El token ya est√° protegido, porque  la √∫ltima vez que el sitio nos respondi√≥ CSI-Token-Action: √©xito. </td><td>  Cargamos los datos de usuario guardados de la base de datos.  Cambia la ID de sesi√≥n.  Trabajamos con el token guardado.  Sabemos que un token se basa en una clave permanente. </td></tr><tr><td>  1.19 Cierra la pesta√±a del navegador. </td><td>  Nada  O la tecla Cerrar sesi√≥n, si la "salida autom√°tica" est√° configurada cuando la pesta√±a est√° cerrada. </td><td>  Rompe una sesi√≥n despu√©s de un tiempo de espera o al recibir una clave de cierre de sesi√≥n. </td></tr><tr><th colspan="3">  2 Tienda en l√≠nea o sitio de anuncios </th></tr><tr><th>  Usuario </th><th>  Navegador </th><th>  Servidor del sitio </th></tr><tr><td>  2.1 Primero incluido en este sitio. </td><td>  Genera una clave aleatoria.  Env√≠a un token inseguro desde una clave aleatoria. </td><td>  Consideramos al usuario an√≥nimo.  Utilizamos este token como el identificador de la sesi√≥n del usuario. </td></tr><tr><td>  2.2 Ver p√°ginas. </td><td>  Env√≠a un token seguro contra una clave aleatoria. </td><td>  Proporciona contenido p√∫blico.  Comprueba el bit de token inferior de 128 bits. </td></tr><tr><td>  2.3 Intentar hacer acciones (agregar anuncios, compras, etc.) </td><td>  Env√≠a un token seguro contra una clave aleatoria. </td><td>  Le dice al usuario que necesita presentarse al sistema.  En esta etapa, el sitio conf√≠a en que la clave es aleatoria. </td></tr><tr><td>  2.4 Le dice al navegador que haga que el sitio lo recuerde. </td><td>  Corrige la clave actual.  Antes de la primera solicitud, env√≠a un token CSI seguro con la clave permanente.  Despu√©s de recibir el √©xito, deja de enviar esta clave. </td><td>  Ahora el sitio sabe que la clave est√° arreglada.  Puede aplicar la t√©cnica de recordar al usuario durante mucho tiempo: guarda el token en la base de datos para la recuperaci√≥n futura de la sesi√≥n con el usuario.  O mantiene la sesi√≥n durante m√°s tiempo (varios d√≠as). </td></tr><tr><td>  2.5 Realiza acciones (agregar anuncios, compras, etc.) </td><td>  Env√≠a un token CSI seguro desde una clave fija. </td><td>  Registra acciones de este usuario.  Comprueba el token. </td></tr><tr><td>  2.6 Cierra la pesta√±a del navegador. </td><td>  Nada </td><td>  Sostiene la sesi√≥n.  Con una inactividad prolongada, guarda los datos de la sesi√≥n de la RAM en un archivo o base de datos. </td></tr><tr><td>  2.7 Inicia sesi√≥n de nuevo en el sitio. </td><td>  Env√≠a una clave fija segura. </td><td>  La sesi√≥n contin√∫a.  Trabajamos con el usuario, como si nada hubiera pasado. </td></tr><tr><td>  2.8 <b>Crea o importa una</b> clave de sitio persistente. </td><td>  Nada </td></tr><tr><td>  2.9 Activaci√≥n de la clave permanente.  Aqu√≠, de hecho, hay una transici√≥n del uso de una clave fija a una permanente. </td><td>  Env√≠a una tecla Cambiar a.  El token se transmite <b>sin protecci√≥n</b> para la clave reci√©n creada y el token no registrado en el servidor.  El token se transfiere <b>protegido</b> para la clave importada. </td><td>  2.9.A.  Token basado en la nueva clave. <br>  Si el token anterior se guard√≥ en la base de datos, simplemente cambie el token en la base de datos. <br><br>  2.9.V.  Token basado en la clave importada. <br>  Si el token anterior se guard√≥ en la base de datos, elim√≠nelo.  Al fusionar dos perfiles de un usuario (sobre qu√© puede preguntarle), porque  de hecho, el usuario tiene dos tokens almacenados en la base de datos: de una clave fija y de una clave importada.  Cambia la ID de sesi√≥n.  Env√≠a CSI-Token-Action: √©xito.  Contin√∫a esperando solicitudes del nuevo token. </td></tr><tr><td>  2.10 Realiza acciones (compras, publicaci√≥n de anuncios, carrito de compras, favoritos, comentarios, comparaciones) </td><td>  Env√≠a un token seguro desde una clave permanente </td><td>  Registra acciones de este usuario.  Comprueba el token inferior de 128 bits. </td></tr><tr><td>  2.11 Cierra la pesta√±a del navegador. </td><td>  Nada  O la tecla Cerrar sesi√≥n, si la "salida autom√°tica" est√° configurada cuando la pesta√±a est√° cerrada. </td><td>  Rompe una sesi√≥n despu√©s de un tiempo de espera o al recibir una clave de cierre de sesi√≥n. </td></tr><tr><th colspan="3">  3 Sitios con preinscripci√≥n obligatoria (red social) </th></tr><tr><th>  Usuario </th><th>  Navegador </th><th>  Servidor del sitio </th></tr><tr><td>  3.1 Incluido en este sitio. </td><td>  Genera una clave aleatoria.  Env√≠a un token inseguro desde una clave aleatoria. </td><td>  Consideramos al usuario an√≥nimo.  Utilizamos este token como el identificador de la sesi√≥n del usuario.  Solo dejamos entrar en secciones p√∫blicas.  Cuando intenta acceder a contenido cerrado, lo traducimos al formulario de autorizaci√≥n. </td></tr><tr><td>  3.2 Crea una clave de sitio permanente </td><td>  Nada </td></tr><tr><td>  3.3 Activaci√≥n de la clave permanente. </td><td>  <b>Pregunta al usuario: ¬ørealmente quieres que el sitio recuerde tu clave?</b>  <b>Aseg√∫rese de que este sitio sea quien dice ser.</b> <br><br>  Env√≠a cambio a. <br>  <b>El token se transmite en claro</b> . </td><td>  Recuerda la nueva ficha.  No tenemos prisa por guardar en la base de datos hasta que se haya completado el registro.  Mantenemos al usuario en el formulario de "Registro" hasta que se confirme la propiedad (por tel√©fono, correo).  Env√≠a CSI-Token-Action: registro </td></tr><tr><td>  3.4 Ingrese sus datos de contacto. </td><td>  Env√≠a solicitudes ajax.  Env√≠a cambio a.  Token antiguo en la misma clave aleatoria. <br>  <b>El nuevo token ya se est√° transfiriendo de forma protegida</b> . <br><br>  Tan pronto como recibe el √©xito, procede a usar un nuevo token (clave permanente). </td><td>  Verifica los detalles de contacto.  Si todo tiene √©xito, env√≠a CSI-Token-Action: √©xito.  De lo contrario: CSI-Token-Action: registro.  Si se env√≠a CSI-Token-Action: abort, el registro no es exitoso.  El navegador debe volver a usar un n√∫mero aleatorio (cancelando la entrada).  E informar de esto al usuario. </td></tr><tr><td>  3.5 Va a la secci√≥n cerrada del sitio </td><td>  Env√≠a un token seguro desde una clave permanente. </td><td>  Proporciona acceso comprobando el token inferior de 128 bits. </td></tr><tr><td>  3.6 Realiza acciones (compras, publicaci√≥n de anuncios, carrito de compras, favoritos, opiniones, comparaciones) </td><td>  Env√≠a un token seguro desde una clave permanente. </td><td>  Registra acciones de este usuario.  Comprueba el token inferior de 128 bits. </td></tr><tr><td>  3.7 Cierra la pesta√±a del navegador. </td><td>  Nada  O la tecla Cerrar sesi√≥n, si la "salida autom√°tica" est√° configurada cuando la pesta√±a est√° cerrada. </td><td>  Rompe una sesi√≥n despu√©s de un tiempo de espera o al recibir una clave de cierre de sesi√≥n. </td></tr><tr><td>  3.8 Incluido en este sitio. </td><td>  Genera una clave aleatoria.  Env√≠a un token inseguro desde una clave aleatoria. </td><td>  Consideramos al usuario an√≥nimo.  Utilizamos este token como el identificador de la sesi√≥n del usuario.  Solo dejamos entrar en secciones p√∫blicas.  Cuando intentamos acceder a contenido cerrado, informamos al usuario que es un usuario an√≥nimo. </td></tr><tr><td>  3.9 Activaci√≥n de la clave permanente. </td><td>  Env√≠a cambio a.  Ambos tokens se transmiten de manera segura. </td><td>  Cargamos los datos de los usuarios de la base de datos por token (el m√°s alto de 128 bits).  Ahora el sitio sabe qui√©n es este usuario. </td></tr><tr><td>  3.10 Cambia la clave permanente del dominio (a otra permanente) </td><td>  <b>Pregunta al usuario: ¬ørealmente desea que el sitio recuerde su nueva clave?</b>  <b>Aseg√∫rese de que este sitio sea quien dice ser.</b> <br><br>  Env√≠a cambio a. <br>  <b>El nuevo token se transfiere en claro;</b>  <b>viejo - en protegido</b> <br></td><td>  Cambia el token en la base de datos a uno nuevo.  Carga datos de perfil.  Utiliza un nuevo token de las siguientes solicitudes.  Env√≠a CSI-Token-Action: √©xito </td></tr><tr><td>  3.11 Realiza acciones (agregar publicaciones, votar, etc.) </td><td>  Env√≠a un token seguro desde una nueva clave </td><td>  Registra acciones de este usuario.  Comprueba el token inferior de 128 bits. </td></tr><tr><td>  3.12 Hace una "Salida". </td><td>  Env√≠a una clave de cierre de sesi√≥n </td><td>  Rompe la sesi√≥n </td></tr><tr><td>  3.13 Incluido en este sitio. </td><td>  Genera una clave aleatoria.  Env√≠a un token inseguro desde una clave aleatoria. </td><td>  Consideramos al usuario an√≥nimo.  Utilizamos este token como el identificador de la sesi√≥n del usuario.  Traducimos al formulario de autorizaci√≥n. </td></tr><tr><td>  3.14 Activaci√≥n de una clave permanente </td><td>  Env√≠a cambio a.  Ambos tokens se transmiten de manera segura. </td><td>  Cargamos los datos de los usuarios de la base de datos por token (el m√°s alto de 128 bits). </td></tr><tr><td>  3.15 Importa una clave diferente para este dominio. <br>  <b>Importante: la clave importada debe estar registrada en el servidor.</b> <br></td><td>  Env√≠a una clave Cerrar sesi√≥n Cambia al uso de una clave aleatoria. </td><td>  Rompe la sesi√≥n </td></tr><tr><td>  3.16 Activa una nueva clave </td><td>  Env√≠a cambio a. <br>  <b>Ambos tokens se transmiten de manera segura.</b> <br><br>  Tenga en cuenta que la clave "anterior" ya es una clave aleatoria (consulte 3.15). </td><td>  Esta clave debe ser conocida por la base de datos.  <b>La exportaci√≥n de claves</b> desde el navegador est√° permitida solo para tokens registrados.  Por lo tanto, el navegador est√° seguro de que <b>el servidor conoce la clave importada</b> y la env√≠a de forma segura.  De lo contrario, el servidor no puede reconocer el token de usuario y no puede autorizarlo. </td></tr><tr><td>  3.17 Realiza acciones (agregar publicaciones, votar, etc.) </td><td>  Env√≠a un token seguro desde una nueva clave </td><td>  Registra acciones de este usuario.  Comprueba el token inferior de 128 bits. </td></tr><tr><td>  3.18 sale </td><td>  Env√≠a una clave de cierre de sesi√≥n </td><td>  Rompe la sesi√≥n </td></tr><tr><th colspan="3">  4 sitios con autorizaci√≥n de dos factores (Sberbank Online) </th></tr><tr><th>  Usuario </th><th>  Navegador </th><th>  Servidor del sitio </th></tr><tr><td>  4.1 Incluido en este sitio. </td><td>  Genera una clave aleatoria.  Env√≠a un token inseguro desde una clave aleatoria. </td><td>  Consideramos al usuario an√≥nimo.  Utilizamos este token como el identificador de la sesi√≥n del usuario.  Traducimos al formulario de autorizaci√≥n. </td></tr><tr><td>  4.2 Crea una clave de sitio permanente </td><td>  Nada </td></tr><tr><td>  4.3 Activaci√≥n de la clave permanente. </td><td>  <b>Pregunta al usuario: ¬ørealmente quieres que el sitio recuerde tu clave?</b>  <b>Aseg√∫rese de que este sitio sea quien dice ser.</b> <br><br>  Env√≠a cambio a. <br>  <b>El token se transmite en claro</b> . </td><td>  El token no es conocido por el sitio.  Recuerda la nueva ficha.     .  CSI-Token-Action: registration. </td></tr><tr><td> 4.4     .  ¬´¬ª </td><td>  Change-To      success.       . <br> <b>      .</b> <br></td><td>   .    . </td></tr><tr><td> 4.5      . </td><td>  ajax-.      Change-To. <br><br>    success,      ( ). </td><td>   .      ( ).  CSI-Token-Action: success <br>       . <br>    ,  CSI-Token-Action: registration. <br><br>      CSI-Token-Action: abort.    ,      . </td></tr><tr><td> 4.6    . </td><td>   Token    </td><td>        . </td></tr><tr><td> 4.7  ¬´¬ª   </td><td>   Logout </td><td>   </td></tr><tr><td> 4.8    . </td><td>   .      . </td><td>   .        .          ¬´¬ª. </td></tr><tr><td> 4.9   . </td><td>  Change-To. <br> <b>    </b> (..   ;    ). </td><td>        ( 128-).  ,        .      ,   .    .   CSI-Token-Action: success </td></tr><tr><td> 4.10      . </td><td>  ajax-.         . </td><td>  .  .  .       . </td></tr><tr><td> 4.11    . </td><td>   Token   . </td><td>        . </td></tr><tr><td> 4.12  ¬´¬ª   </td><td>   Logout </td><td>   </td></tr><tr><td> 4.12     (). </td><td>    Logout,   ¬´¬ª   .  . </td><td>  ,     Logout.   . </td></tr><tr><th colspan="3"> 5  :   ESXi </th></tr><tr><th>  Usuario </th><th>  Navegador </th><th>   </th></tr><tr><td> 5.1    . </td><td>   .      . </td><td>   .        .   . </td></tr><tr><td> 5.2    . </td><td></td><td></td></tr><tr><td> 5.3     ( ,   ).  ,   <i></i> . </td><td></td><td></td></tr><tr><td> 5.4     (SSH, RDP).      (  .htaccess ‚Äì .  ) </td><td></td><td></td></tr><tr><td> 5.5   </td><td>  </td><td>     </td></tr><tr><td> 5.6    . </td><td>   .      . </td><td>   .        .   . </td></tr><tr><td> 5.7   . </td><td>  Change-To. <br> <b>    </b> (..  ,         ;     <i></i> ). </td><td>        (. ). <br><br>     ( 128-). <br>    128-.     . <br>   CSI-Token-Action: success. <br>   CSI-Token-Action: abort (    ),   403 ‚Äì Forbidden. <br>     . </td></tr><tr><td> 5.8    </td><td>      . </td><td>        . </td></tr><tr><td> 5.9   </td><td>    Logout,   ¬´¬ª   .  . </td><td>  ,     Logout.   . </td></tr><tr><th colspan="3"> 6  :   </th></tr><tr><th>  Usuario </th><th>  Navegador </th><th>   </th></tr><tr><td> 6.1    . </td><td>   .      . </td><td>   .        . <b>   .</b>   CSI-Support: yes; </td></tr><tr><td> 6.2   . </td><td></td><td></td></tr><tr><td> 6.3   . </td><td> <b> :   ,     ? ,     ,    .</b> <br><br>  Change-To. <br> <b>    </b> . </td><td>  ,   CSI-Token-Action: registration, ..   . </td></tr><tr><td> 6.4  /  ¬´ ¬ª </td><td>  / POST-  .      Change-To,    . </td><td>  /.    .    .  CSI-Token-Action: success </td></tr><tr><td> 6.5           ¬´¬ª </td><td>     Token    </td><td>    /.  . </td></tr><tr><td> 6.6  </td><td>   Logout </td><td>   </td></tr><tr><td> 6.7    . </td><td>   .      . </td><td>   . <b>  ¬´ ¬ª</b> <br></td></tr><tr><td> 6.8   . </td><td>  Change-To. <b>    </b> (..   ;    ). </td><td>     128- .   . </td></tr><tr><td> 6.9    </td><td>   Token    </td><td>       . </td></tr><tr><td> 6.10  </td><td>   Logout </td><td>   </td></tr></tbody></table></div><br>         .htaccess. <br><pre> <code class="apache">&lt;Directory "/var/www/html"&gt; AuthType CSI AuthName "Restricted Content" AuthTokensFile /etc/apache2/.csi_keys Require valid-user &lt;/Directory&gt;</code> </pre><br><pre> cat /etc/apache2/.csi_keys </pre><pre> <code class="bash"># # Client Self Identification tokens file # # CSI-Domain-Key UserName Role 84bc3da1b3e33a18e8d5e1bdd7a18d7a166d77ac1b46a1ec38aa35ab7e628ab5 MelnikovIN admin 6d7fce9fee471194aa8b5b6e47267f0348a24b70a0b376535542b996af517398 BoshirovAM user</code> </pre> <br><br><a name="token_algo_for_server"></a><h2> 2.7.1          </h2><br>     K ,      ¬´¬ª  T ,     .   ,    :  ,           .  ,      vsphere.local, : <br><pre> <code class="plaintext">Sender = Recipient = Context = vsphere.local</code> </pre> <br>   ()  , : <br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/af8/1c2/5b0/af81c25b054111db5d526fcfb8c4fb8c.svg" alt="$T_s = HMAC_{K}(Sender \cup Recipient \cup Context)$" data-tex="display"></p><br>  ,     .  128     ,     CSI-Salt <sup>*</sup> .  ,    : <br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/8ea/b59/cc3/8eab59cc3e5060cfec9956f984807b5f.svg" alt="$T = Hi(T_s) \cup HMAC_{salt}( Lo(T_s) )$" data-tex="display"></p><br>  <i>Hi</i> ‚Äì  128 , <i>Lo</i> ‚Äì  128   . <br> ,       , -    ,   ..        . <br><hr> <sup>*   .   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">¬´      ¬ª.</a></sup> <br><br><a name="server_token_processing"></a><h2> 2.8     </h2><br><h3>    ( ) </h3><br><div class="scrollable-table"><table><tbody><tr><th>       </th><th>      </th></tr><tr><td>  </td><td>         ,              . <br><br>   .   . <br>   128       . <br>     .      CSI-Salt. <br><br></td></tr><tr><td>  ( 128 ) </td><td>   . <br>      CSI-Salt ‚Äì   . <br>    .       CSI-Token. <br><br>   ,  CSI-Token-Action: invalid.    400. <br><br>    ‚Äì  200. <br><br></td></tr></tbody></table></div><br><br><h3>     Permanent </h3><br>    .  ,     ,    .        ‚Äì   .   CSI-Token-Action: success  CSI-Token-Action: abort. <br><br><h3>     Logout </h3><br>   ,        .     ¬´¬ª  ,       (   ),       (¬´    ¬ª). <br><blockquote> , ,   .   . </blockquote><br><br><h3>     Change-To </h3><br>    T,  ‚Äì '. <br><br> <b>:</b>     T'     (  ,  ),       ( 128 ). <br><div class="scrollable-table"><table><tbody><tr><td colspan="2">      <sup>*</sup> </td><td rowspan="2">      </td></tr><tr><td> T </td><td> T' </td></tr><tr><td>  no </td><td>  no </td><td> : <b> </b> . <br><br>      T' <br>   CSI-Token-Action: success. <br><br>         ¬´¬ª.        .        (   ). <br><br>    CSI-Token-Action: registration,   ,     (        ).        Change-To (   )   ,     success  abort.   ,  ,     .   ‚Äì      (  ). <br></td></tr><tr><td>  no </td><td>  </td><td> : <b> Login</b> . <br><br>    T'  .   .   .   CSI-Token-Action: success. <br><br> <b></b> .         Change-To   ,    CSI-Token-Action: success, <b>  </b>    Change-To   <b>  </b> . <br>    ,       .          . <br>  <b>     </b> ,       ¬´¬ª .    <b>      </b> ,       -.  Porque    ¬´  ¬ª,    . <br></td></tr><tr><td>  </td><td>  no </td><td> : <b>  </b>   . <br><br>    T     T'.   . <br>   CSI-Token-Action: success. <br></td></tr><tr><td> , <br>  <br>  <br></td><td>  </td><td> : <b>     </b> <br><br>  ,         ,      -.                  -     . <br><br>            (  ).      ‚Äì . <br><br>   .   CSI-Token-Action: success <br></td></tr><tr><td> , <br>  <br>  <br> . <br></td><td>  </td><td>  .            .   .  CSI-Token-Action: abort.   . <br><br>  256-       SHA-2.      ( )         . <br><br>          : <ul><li>      ; </li><li>         ; </li><li>    </li></ul>      .   , ‚Äì  -    . <br>     ,      .        Logout   .   Login  .  . <br></td></tr></tbody></table></div><hr> <sup>*        ,    .</sup> <br><br><a name="sub_domain_identify"></a><h2> 2.9 -  </h2><br>    ,      -   -,      .   ,    site.ru      img.site.ru,  download.site.ru,     . <br><br>     site.ru      -,       . ,     site.ru,         ,  - .       . <br><br>  ,         . <br>      site.ru      : <br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/a5a/e9b/500/a5ae9b500f4fd8f2600eafdb3a315d32.svg" alt="$T_1 = HMAC_{site.ru-key}(site.ru \cup site.ru \cup site.ru)$" data-tex="display"></p><br>  ,     site.ru   site.ru  : <br><ul><li>    (   ) </li><li>   </li></ul>    T <sub>1</sub> (.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">R1</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">R4</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">RB</a> ).      site.ru. <br><br>          site.ru,     download.site.ru.        ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">R1</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">R4</a> ): <br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/445/897/361/445897361e99df033e11f354f37071af.svg" alt="$T_2 = HMAC_{site.ru-key}(site.ru \cup download.site.ru \cup site.ru)$" data-tex="display"></p><br><br>      download.site.ru ,      ajax-    site.ru ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">RB</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">RC</a> ). <br><br>   domain   : <br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/231/d05/899/231d058996ea04e27a4a67dbdadf68ee.svg" alt="$T_3 = HMAC_{site.ru-key}(site.ru \cup domain \cup site.ru)$" data-tex="display"></p><br><br> ,  ,      ,      A, B, C      .     - . , . <br><br>   site.ru  ajax-  .   ID != T <sub>1</sub> ,    site.ru.       ID  T <sub>x</sub> .         ID .    ID        . <br><br>   .  ,      , ..     site.ru   . <br><br><a name="part3"></a><h1> 3    </h1><br><div class="spoiler">  <b class="spoiler_title">Nota</b> <div class="spoiler_text">      .          . </div></div><br><br><a name="keys_NAA_protection"></a><h2> 3.1      </h2><br>        ,   ,        . <br><br>          . <br><br>     : <br><br><ul><li>      ( ) </li><li>        ¬´¬ª ( ) </li><li>      </li></ul><br>  ,      - (      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">¬´  ¬ª</a> ),         .      ,     PIN-;     . <br><br>  -            .  :     ? <br><br>        ,  -,      ¬´¬ª, -, ,   ,    : ¬´ - ¬ª. <br><br>    <b>   <sup>*</sup>     </b> (     ).       ,       .     100%  ,      .        ,   ,  ,     . <br><br>          ,         (..     ).       (  )  ,          ‚Äì .    -              . <br><br>    :     +        (   API ).     ¬´ ¬ª.      . <br><br>  ,      ,   .         ,     ,      ,             .  :   . <br><br>        (   ). , ,           . <br><hr> <sup>*, 32-      64-  .            .</sup> <br><br><a name="why_password_for_keys_not_good"></a><h2> 3.2       </h2><br>              .   ,            . <br><br>        .         .    : <br><br><ol><li>     ,     ¬´¬ª ,        ,   .   ,       -,          . <br><br>  (),     8-  ,       ,    .: ~!@#$%^&amp;.   : 26 + 26 + 10 + 8 = 70 . 8-       70 <sup>8</sup> . <br><br> ,     ,         10 <sup>12</sup>   .      70 <sup>8</sup> / 10 <sup>12</sup> = ~576 .  Es decir       ~10 .          5       . 10-      15 .      10 ,      1-2 . <br><br>           ,        . </li><li>       ,     . </li><li>                ,     .  Es decir      (       SHA-2). </li><li>  , ,  ,      .        . </li></ol><br><br><a name="risks_loss_keys"></a><h2> 3.3  /     </h2><br> <b>     -?</b> <br><br>   ,       .  ? <br><br>      ,   .     -,    -,   .  . <br><br> ,             ,     ? ,        ( ¬´ ¬ª)?     ¬´ ¬ª ? <br><br>    ,      ,         , <i></i>   . ,       .      ,    (email, mobile). ,     (, ).  ,     ,  100% ,    ‚Äì  . <br><br>  -,    -. <br><blockquote> <b>  ?</b>   ,        .  , ,       bitcoin.  ,   -       .    .     .      ¬´¬ª,  . <br></blockquote><br> <b>      -?</b> <br>   .       - (   )     ,    ,   ,   - .  ,    .            javascript.  .    ‚Ä¶ <br><br> <b>    -?</b> <br><br>              .               .  Tranquilo y silencioso.         .  .   . <br><br>          . ,   ,          , ‚Äì   .     :      ,           .      ,  -. <br><blockquote> <b>  .</b>      (    ).     .   IP-  ,      ,       . <br></blockquote><br><br><a name="part4"></a><h1> 4     </h1><br><br><a name="attack_user_tracking"></a><h2> 4.1   </h2><br> ,   ,        .    -,        . -, - ‚Äì     . <br><br>      ,        ,   : <br><br><ol><li>              (     ,     ). </li><li>       (    )       . </li></ol><br>   2   : <b>  </b> ,  .    == . <br><br> ,         ‚Ññ 2.     ¬´¬ª    (  ),         ¬´¬ª,    ,   .      ,   <b>  </b> . <br><br>          ‚Ññ 1.   . <br><br>  1     H <sub>1</sub> ,   2,     1 ‚Äì  H <sub>2</sub> . ,      (H <sub>1</sub> , H <sub>2</sub> )      -. <br>      3,       2,   .  3     H <sub>3</sub> ,   2,     3 ‚Äì  H <sub>2'</sub> != H <sub>2</sub> (.   ).  ,    , ..     . <br><br>  <b>  ,        fingerprint </b> .    ,             . <br><br> <b> :</b>   ,     .        . <br><br><a name="attack_XSS"></a><h2> 4.2   XSS </h2><br><br> <abbr title="Cross-Site Scripting ‚Äî ¬´ ¬ª">XSS</abbr> ‚Äì  ,        victim.com  . ,      CDN  . <br><br>                    .           - ( ),    ( ),      ( ). <br><br>           ‚Äì      Source   . <br><br> <b></b> :   XSS (              ),   .         ¬´¬ª.         -. <br><br><a name="attack_CSRF"></a><h2> 4.3   SRF </h2><br><br>     evil.com,  .      (GET/POST/HEAD/PUT/DELETE)  ,     (,    ).       (,     ).   ,     Referer        .  ,   . <br><br>          <abbr title="ross Site Request Forgery ‚Äî ¬´  ¬ª">CSRF</abbr> ,     .             .  ,          .     GET-      ( )      . <br><br>       . <br><br><a name="attack_SSO"></a><h2> 4.4     SSO </h2><br>   S <sub>1</sub>  S <sub>2</sub> ,        ,   ,  SSO,   .  ..       (-     ),       (   ),   S <sub>1</sub>    . <br><br>         A,   .     S <sub>2</sub> ,       ( S <sub>1</sub> )   H <sub>1</sub> .    .      S <sub>1</sub> ,       S <sub>2</sub> . <br><br>    S <sub>2</sub>    .         <br><pre> <code class="xml">&lt;meta http-equiv="refresh" content="0"&gt;</code> </pre>  . <br><br>  S <sub>2</sub>    A         ¬´¬ª: <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/is/n5/jh/isn5jhlcnubhl580cvv6lgdloye.jpeg"></div><br>     ,   .        S <sub>2</sub>    H <sub>2</sub> (..   2.4 P1:      ). <br><br>   S <sub>2</sub>         S <sub>1</sub> ,   H <sub>1</sub>   H <sub>2</sub> ,   H <sub>2</sub>    S <sub>1</sub> .    S <sub>1</sub>  S <sub>2</sub>        , ..       <b>   </b> . <br><blockquote>       , ..          ,    . </blockquote> <b> :</b>      .   S <sub>2</sub>         ,        .      ,         S <sub>1</sub>  S <sub>2</sub> .       . <br><br><a name="attack_sso_key_discredit"></a><h2> 4.5    SSO </h2><br>       ,  SSO, .       . <br><br>          . <br><blockquote> <b>          .</b> </blockquote>  ,        SSO,             SSO.   ,          .  Es decir     SSO    ‚Äì       . <br><br>          .            . <br><br>        - :           Id- SSO    .        Id   SSO  .   ,       . <br>          (. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">¬´  ¬ª</a> ). <br><br> <b>.</b>  ,         ,      SSO,     - ,     . <br><br> <b>   .</b>   ,   ‚Äì         .    -       Id-    .  ,       ,    ,      . <br><br> <b> :</b>        (    ).     .      .        ,          .  , ,   ,     . <br><br> <b> .</b>    SSO ( ,            ).   SSO (      !). <br><br>  SSO          (, ),         . <br><br><a name="attack_token_compromise_due_transmit"></a><h2> 4.6     </h2><br> ,        <b>  100% </b>  .           (     ),  .    . <br><br>   SSL .     HTTPS  .    ,   HTTP.   . <br><br>      ,            .   . <br><br>    ‚Äì          .    ,           .                 .     -  ,  . <br><blockquote>  , ,   ,      Javascript .  Cookie   HttpOnly.    ajax- . </blockquote> <b> :</b>   ,    ,        (     ).        cookie      . <br><br> <b> :</b>       , ,    ;        ( ,  ). <br><br><a name="attack_token_compromise_due_site_hacking"></a><h2> 4.7      </h2><br>    .       .   :   ,   ¬´¬ª.      -  ‚Äì   . <br><br>   ,  -,        . <br><blockquote> <b>       </b> ,      .   <b>       </b> .   ,       . </blockquote>   ,         -:   - . <br><br>      ,    , ,   , .   . <br><br>   ,    ,       ,    -,    : <br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/b1c/9ee/9ac/b1c9ee9ac9a8f065c9a394045a24edb9.svg" alt="$DomainKey = HMAC_{M_{key}}( DomainName \cup VersionNumber )$" data-tex="display"></p><br><br><a name="epilog"></a><h1>  Conclusi√≥n </h1><br>   ,    ,         : ¬´     ?¬ª <br><br><div class="spoiler"> <b class="spoiler_title">   </b> <div class="spoiler_text">  ,        (     ),     (?)  ,   . <br><br> ,     ,  -  .  ,    ,       ,           .       (   ,   ).    ,        ¬´ ¬ª      ¬´-¬ª. <br><br>  -    ¬´ ¬ª. <s>  </s>    ,  <s></s> ¬´¬ª.     ,    .     (   Google ,  Facebook ‚Äì       ).     (  DDOS-    . ‚Äì <abbr title="            "><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a></abbr>  )   - .   ,     SSO       ,        .   ? <br><br>   , , ,       .  ,     -     -.  ,     .,     .     email,  .      .  ,             .    ? <br><br> <b>  -.  ?</b> SSO ‚Äì    . <br><br> ,        ¬´ ¬ª.         .      .       .             .   , . <br><br>      -      ¬´¬ª  .    ,    ¬´ ¬ª.          ,    . <br><br>  -,         ? <br></div></div><br> <b>    !</b>  Por desgracia    ,      ¬´/¬ª. <br><br> 1. , ,       popup <br><blockquote> ¬´   cookie!     ,      !  ¬´¬ª,       ¬ª. </blockquote>    popup         .      GDPR (   ). <br><br>  .   , cookie      !   ¬´¬ª.        ,       . <b>   , +1   .</b> <br><br> 2.          .      SSO    : OAuth, SAML, Kerberos  ..,     ,   ,    ;   -       SSO,    : ¬´   ,  ¬ª.            .  .   ,  ‚Ä¶          ,      . <b> = </b> . <br><br><div class="spoiler"> <b class="spoiler_title"> ...</b> <div class="spoiler_text">      .     .       ,   -  -  .       . .  . <br><br>    -, -,  ¬´ ¬ª   . <br></div></div><br><br> 3.        .           .        ,    .     -,      -  .  -. <b>  ?</b> <br><br> 4.   ,    .    .           . <br><br> 5.        .         XSS, CSRF.   -     .    ‚Äî . <br><br> 6.         . <b>   .</b> <br><br> 7. ,  <b>     </b> .  ,     , <u>     </u> ,         ,      , ,  , .        SQL-. <br><br>   ,     ,  <b>     </b>  .       ¬´¬ª  , -     .       .   ,  ¬´-¬ª   . <br><br><blockquote> <i>‚Äì ,     </i> <br> .  <br></blockquote><br><br><hr>  <b>PS</b> <br>          .     Habr    .      ,         ()  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">  </a> .       sergey201991[].   ,   .   /      .     .     -. <br><br> ,  ,      : <br><ol><li>         ,       ,   ;    </li><li>      ;           ,  SSO </li><li>       ¬´¬ª, -  : -      (   ) </li><li>    -  </li></ol><br>   . 1 ‚Äî             ,         : ,      1000.                . <br><br>   . 2 ‚Äî   .     .    ,   .   80-   ,        . <br><br>  ,     ! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/472310/">https://habr.com/ru/post/472310/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../472296/index.html">Sistema de protecci√≥n contra fugas para lavadora</a></li>
<li><a href="../472298/index.html">El resumen de materiales frescos del mundo del front-end para la √∫ltima semana No. 385 (14-20 de octubre de 2019)</a></li>
<li><a href="../472300/index.html">Descenso de gradiente estoc√°stico (SGD) para la funci√≥n de p√©rdida logar√≠tmica (LogLoss) en un problema de clasificaci√≥n binaria</a></li>
<li><a href="../472304/index.html">NASA contrata ingenieros para desarrollar robot humanoide de pr√≥xima generaci√≥n</a></li>
<li><a href="../472306/index.html">PHP Digest No. 166 (7-21 de octubre de 2019)</a></li>
<li><a href="../472312/index.html">Experiencia transfiriendo un proyecto Maven a Jar de lanzamiento m√∫ltiple: ya es posible, pero a√∫n dif√≠cil</a></li>
<li><a href="../472314/index.html">Me gusta la gente de carton</a></li>
<li><a href="../472318/index.html">Rastreo Distribuido en Istio</a></li>
<li><a href="../472320/index.html">Entrevista con Zabbix: 12 respuestas francas</a></li>
<li><a href="../472326/index.html">Nuestra industria espacial ... ¬øY si nos fijamos en los problemas de la industria desde la perspectiva de un geek?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>