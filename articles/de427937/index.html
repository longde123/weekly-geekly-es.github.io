<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèæ‚Äçüç≥ üëèüèæ üöÇ Codierbar f√ºr API-Anfragen und wie man Code ordnet üë≤üèª ü§üüèª üìÆ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo Habr! 

 Ab Swift 4 haben wir Zugriff auf das neue Codable-Protokoll, mit dem Modelle einfach codiert / decodiert werden k√∂nnen. Meine Projekte ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Codierbar f√ºr API-Anfragen und wie man Code ordnet</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/427937/"> Hallo Habr! <br><br>  Ab Swift 4 haben wir Zugriff auf das neue Codable-Protokoll, mit dem Modelle einfach codiert / decodiert werden k√∂nnen.  Meine Projekte enthalten viel Code f√ºr API-Aufrufe, und im letzten Jahr habe ich viel Arbeit geleistet, um dieses riesige Code-Array in etwas sehr Leichtes, Pr√§gnantes und Einfaches zu optimieren, indem sich wiederholender Code beendet und Codable auch f√ºr mehrteilige Anforderungen und URL-Abfrageparameter verwendet wurde.  Meiner Meinung nach stellte sich heraus, dass es mehrere hervorragende Klassen f√ºr das Senden von Anfragen und das Parsen von Antworten vom Server gab.  Sowie eine praktische Dateistruktur, die die Controller f√ºr jede Gruppe von Anforderungen darstellt, die ich bei der Verwendung von Vapor 3 im Backend als Root verwendet habe.  Vor einigen Tagen habe ich alle meine Entwicklungen einer separaten Bibliothek zugeordnet und sie CodyFire genannt.  Ich m√∂chte in diesem Artikel √ºber sie sprechen. <br><a name="habracut"></a><br><h4>  Haftungsausschluss </h4><br>  CodyFire basiert auf Alamofire, ist jedoch mehr als nur ein Wrapper f√ºr Alamofire. Es ist ein ganzheitlicher Systemansatz f√ºr die Arbeit mit der REST-API f√ºr iOS.  Deshalb mache ich mir keine Sorgen, dass Alamofire die f√ºnfte Version s√§gt, in der es Codable-Unterst√ºtzung geben wird, weil  es wird meine Sch√∂pfung nicht t√∂ten. <br><br><h2>  Initialisierung </h2><br>  Beginnen wir ein wenig von weitem, n√§mlich dass wir oft drei Server haben: <br><br>  <b>dev</b> - f√ºr die Entwicklung, was wir von Xcode ausgehen <br>  <b>Stufe</b> - zum Testen vor der Ver√∂ffentlichung, normalerweise in TestFlight oder InHouse <br>  <b>Produktproduktion</b> f√ºr den AppStore <br><br>  Und viele iOS-Entwickler sind sich nat√ºrlich der Existenz von <i>Umgebungsvariablen</i> und der Startschemata in Xcode bewusst, aber in meiner (√ºber 8-j√§hrigen) Praxis schreiben 90% der Entwickler den richtigen Server w√§hrend des Testens oder vor dem Zusammenbau manuell in einer Konstanten, und das ist es Was ich beheben m√∂chte, indem ich ein gutes Beispiel daf√ºr zeige, wie man es richtig macht. <br><br>  Standardm√§√üig ermittelt CodyFire automatisch, in welcher Umgebung die Anwendung gerade ausgef√ºhrt wird. Dies macht es sehr einfach: <br><br><pre><code class="hljs cs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> DEBUG //DEV environment #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">else</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> Bundle.main.appStoreReceiptURL?.lastPathComponent == "sandboxReceipt" { //TESTFLIGHT environment } </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">else</span></span></span><span class="hljs-meta"> { //APPSTORE environment } #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span></span></code> </pre> <br>  Dies ist nat√ºrlich unter der Haube, und im Projekt in AppDelegate m√ºssen Sie nur drei URLs registrieren <br><br><pre> <code class="hljs objectivec">import CodyFire @<span class="hljs-built_in"><span class="hljs-built_in">UIApplicationMain</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> AppDelegate: <span class="hljs-built_in"><span class="hljs-built_in">UIResponder</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">UIApplicationDelegate</span></span> { func application(_ application: <span class="hljs-built_in"><span class="hljs-built_in">UIApplication</span></span>, didFinishLaunchingWithOptions launchOptions: [<span class="hljs-built_in"><span class="hljs-built_in">UIApplication</span></span>.LaunchOptionsKey : Any]? = <span class="hljs-literal"><span class="hljs-literal">nil</span></span>) -&gt; Bool { let dev = CodyFireEnvironment(baseURL: <span class="hljs-string"><span class="hljs-string">"http://localhost:8080"</span></span>) let testFlight = CodyFireEnvironment(baseURL: <span class="hljs-string"><span class="hljs-string">"https://stage.myapi.com"</span></span>) let appStore = CodyFireEnvironment(baseURL: <span class="hljs-string"><span class="hljs-string">"https://api.myapi.com"</span></span>) CodyFire.shared.configureEnvironments(dev: dev, testFlight: testFlight, appStore: appStore) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span> } }</code> </pre><br>  Und man k√∂nnte sich einfach dar√ºber freuen und nichts anderes tun. <br><br>  Aber im wirklichen Leben m√ºssen wir oft Entwickler-, B√ºhnen- und Produktserver in Xcode testen, und daf√ºr fordere ich Sie dringend auf, Startschemata zu verwenden. <br><br><img src="https://habrastorage.org/webt/u_/rp/t_/u_rpt_jk71avrzwwasrgviv7rgk.png" alt="Bild"><br><blockquote>  <i>Tipp: Vergessen Sie im Abschnitt <i>Schemata verwalten</i> nicht, das Kontrollk√§stchen "Freigegeben" f√ºr jedes Schema zu aktivieren, damit sie allen Entwicklern im Projekt zur Verf√ºgung stehen.</i> </blockquote><br>  In jedem Schema m√ºssen Sie die Umgebungsvariable "env" schreiben, die drei Werte annehmen kann: dev, testFlight, appStore. <br><br><img src="https://habrastorage.org/webt/ur/j4/ee/urj4eeqtonszxwlo8uv-w8fdt4a.png" alt="Bild"><br><br>  Damit diese Schemata mit CodyFire funktionieren, m√ºssen Sie <i>AppDelegate.didFinishLaunchingWithOptions</i> nach der Initialisierung von CodyFire den folgenden Code hinzuf√ºgen <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">CodyFire</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.shared</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.setupEnvByProjectScheme</span></span>()</code> </pre> <br>  Dar√ºber hinaus werden Sie h√§ufig vom Chef oder den Testern Ihres Projekts aufgefordert, den Server im <i>laufenden Betrieb</i> irgendwo auf <i>LoginScreen</i> zu <i>wechseln</i> .  Mit CodyFire k√∂nnen Sie dies einfach implementieren, indem Sie den Server in einer Zeile wechseln und die Umgebung √§ndern: <br><br><pre> <code class="hljs vhdl">CodyFire.<span class="hljs-keyword"><span class="hljs-keyword">shared</span></span>.environmentMode = .appStore</code> </pre> <br><blockquote>  Dies funktioniert so lange, bis die Anwendung neu gestartet wird. Wenn Sie m√∂chten, dass sie nach dem Start gespeichert wird, speichern Sie den Wert in <i>UserDefaults</i> , √ºberpr√ºfen Sie, wann die Anwendung in <i>AppDelegate gestartet wird,</i> und wechseln Sie die Umgebung in die erforderliche Umgebung. </blockquote>  Ich sagte zu diesem wichtigen Punkt, ich hoffe, dass es mehr Projekte geben wird, in denen das Umschalten der Umgebung wunderbar durchgef√ºhrt wird.  Gleichzeitig haben wir die Bibliothek bereits initialisiert. <br><br><h2>  Dateistruktur und Controller </h2><br>  Jetzt k√∂nnen Sie √ºber meine Vision der Dateistruktur f√ºr alle API-Aufrufe sprechen. Dies kann als Ideologie von CodyFire bezeichnet werden. <br><br>  Mal sehen, wie es im Projekt endlich aussieht <br><br><img src="https://habrastorage.org/webt/0f/pn/l8/0fpnl8_sb2a6uhivnubvfwdgddy.png" alt="Bild"><br><br>  Schauen wir uns nun die Dateilisten an und beginnen wir mit <i>API.swift</i> . <br><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">API</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">typealias</span></span> auth = <span class="hljs-type"><span class="hljs-type">AuthController</span></span> <span class="hljs-keyword"><span class="hljs-keyword">typealias</span></span> post = <span class="hljs-type"><span class="hljs-type">PostController</span></span> }</code> </pre><br>  Hier werden Links zu allen Controllern aufgelistet, damit sie einfach √ºber "API.controller.method" aufgerufen werden k√∂nnen. <br><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AuthController</span></span></span><span class="hljs-class"> </span></span>{}</code> </pre><br>  <i>API + Login.swift</i> <br><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AuthController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LoginResponse</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Codable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> token: <span class="hljs-type"><span class="hljs-type">String</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">login</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(email: String, password: String)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">APIRequest</span></span>&lt;<span class="hljs-type"><span class="hljs-type">LoginResponse</span></span>&gt; { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">APIRequest</span></span>(<span class="hljs-string"><span class="hljs-string">"login"</span></span>).method(.post) .basicAuth(email: email, password: password) .addCustomError(.notFound, <span class="hljs-string"><span class="hljs-string">"User not found"</span></span>) } }</code> </pre><br>  In diesem Dekorator deklarieren wir eine Funktion zum Aufrufen unserer API: <br><br>  - Endpunkt angeben <br>  - HTTP-POST-Methode <br>  - Verwenden Sie den Wrapper f√ºr die Basisauthentifizierung <br>  - Deklarieren Sie den gew√ºnschten Text f√ºr eine bestimmte Antwort vom Server (dies ist praktisch). <br>  - und geben Sie das Modell an, mit dem die Daten dekodiert werden <br><br>  Was bleibt verborgen? <br><br>  - Sie m√ºssen nicht die vollst√§ndige Server-URL angeben, da  es ist bereits global eingestellt <br>  - musste nicht angeben, dass wir <i>200 OK</i> erwarten, wenn alles in Ordnung ist <br><blockquote>  200 OK ist der Standardstatuscode, den CodyFire f√ºr alle Anforderungen erwartet. In diesem Fall werden Daten dekodiert und ein R√ºckruf aufgerufen. Alles ist in Ordnung. Hier sind Ihre Daten. </blockquote>  Au√üerdem k√∂nnen Sie irgendwo im Code f√ºr Ihren <i>LoginScreen</i> einfach anrufen <br><br><pre> <code class="hljs lua">API.auth.login(email: <span class="hljs-string"><span class="hljs-string">"test@mail.com"</span></span>, password: <span class="hljs-string"><span class="hljs-string">"qwerty"</span></span>).onError { <span class="hljs-built_in"><span class="hljs-built_in">error</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> switch <span class="hljs-built_in"><span class="hljs-built_in">error</span></span>.code { case .notFound: <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">error</span></span>.description) //: User <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> found default: <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">error</span></span>.description) } }.onSuccess { token <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //TODO:  auth token    <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"Received auth token: "</span></span>+ token) }</code> </pre><br>  <i>onError</i> und <i>onSuccess</i> sind nur ein kleiner Teil der R√ºckrufe, die APIRequest zur√ºckgeben kann. Wir werden sp√§ter darauf eingehen. <br><br>  Im Eingabebeispiel haben wir nur die Option ber√ºcksichtigt, wenn die zur√ºckgegebenen Daten automatisch dekodiert werden. Sie k√∂nnen jedoch sagen, dass Sie sie selbst implementieren k√∂nnten, und Sie haben Recht.  Betrachten wir daher die M√∂glichkeit, Daten gem√§√ü dem Modell am Beispiel des Registrierungsformulars zu senden. <br><br>  <i>API + Signup.swift</i> <br><br><pre> <code class="hljs rust">extension AuthController { <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SignupRequest</span></span></span></span>: JSONPayload { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> email, password: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> firstName, lastName, mobileNumber: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span> init(email: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>, password: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>, firstName: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>, lastName: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>, mobileNumber: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.email = email <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.password = password <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.firstName = firstName <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.lastName = lastName <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.mobileNumber = mobileNumber } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SignupResponse</span></span></span></span>: Codable { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> token: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> func signup(_ request: SignupRequest) -&gt; APIRequest&lt;SignupResponse&gt; { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> APIRequest(<span class="hljs-string"><span class="hljs-string">"signup"</span></span>, payload: request).method(.post) .addError(.conflict, <span class="hljs-string"><span class="hljs-string">"Account already exists"</span></span>) } }</code> </pre><br>  Im Gegensatz zur Anmeldung √ºbertragen wir bei der Registrierung eine gro√üe Datenmenge. <br><br>  In diesem Beispiel haben wir ein <i>SignupRequest-</i> Modell, das dem <i>JSONPayload-</i> Protokoll entspricht (daher versteht CodyFire den Nutzlasttyp), sodass der Hauptteil unserer Anforderung in Form von JSON vorliegt.  Wenn Sie x-www-form-urlencoded ben√∂tigen, verwenden Sie <i>FormURLEncodedPayload</i> . <br><br>  Als Ergebnis erhalten Sie eine einfache Funktion, die das Nutzlastmodell akzeptiert <br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">API</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.auth</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.signup</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">request</span></span>)</code> </pre> <br>  und was Ihnen bei Erfolg ein bestimmtes Antwortmodell zur√ºckgibt. <br><br>  Ich finde es cool, oder? <br><br><h4>  Aber was ist, wenn mehrteilig? </h4><br>  Schauen wir uns ein Beispiel an, in dem Sie einen <i>Beitrag</i> erstellen k√∂nnen. <br><br>  <i>Post + Create.swift</i> <br><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PostController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CreateRequest</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MultipartPayload</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> text: <span class="hljs-type"><span class="hljs-type">String</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tags: [<span class="hljs-type"><span class="hljs-type">String</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> images: [<span class="hljs-type"><span class="hljs-type">Attachment</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> video: <span class="hljs-type"><span class="hljs-type">Data</span></span> <span class="hljs-keyword"><span class="hljs-keyword">init</span></span> (text: <span class="hljs-type"><span class="hljs-type">String</span></span>, tags: [<span class="hljs-type"><span class="hljs-type">String</span></span>], images: [<span class="hljs-type"><span class="hljs-type">Attachment</span></span>], video: <span class="hljs-type"><span class="hljs-type">Data</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.text = text <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.tags = tags <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.images = images <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.video = video } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Post</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Codable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> text: <span class="hljs-type"><span class="hljs-type">String</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> tags: [<span class="hljs-type"><span class="hljs-type">String</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> linksToImages: [<span class="hljs-type"><span class="hljs-type">String</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> linkToVideo: <span class="hljs-type"><span class="hljs-type">String</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">create</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> request: CreateRequest)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">APIRequest</span></span>&lt;<span class="hljs-type"><span class="hljs-type">CreateRequest</span></span>&gt; { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">APIRequest</span></span>(<span class="hljs-string"><span class="hljs-string">"post"</span></span>, payload: request).method(.post) } }</code> </pre><br>  Dieser Code kann ein mehrteiliges Formular mit einer Reihe von Bilddateien und einem Video senden. <br>  Mal sehen, wie man einen Versand anruft.  Hier ist der interessanteste Moment √ºber <i>Anhang</i> . <br><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> videoData = <span class="hljs-type"><span class="hljs-type">FileManager</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">default</span></span>.contents(atPath: <span class="hljs-string"><span class="hljs-string">"/path/to/video.mp4"</span></span>)! <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> imageAttachment = <span class="hljs-type"><span class="hljs-type">Attachment</span></span>(data: <span class="hljs-type"><span class="hljs-type">UIImage</span></span>(named: <span class="hljs-string"><span class="hljs-string">"cat"</span></span>)!.jpeg(.high)!, fileName: <span class="hljs-string"><span class="hljs-string">"cat.jpg"</span></span>, mimeType: .jpg) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> payload = <span class="hljs-type"><span class="hljs-type">PostController</span></span>.<span class="hljs-type"><span class="hljs-type">CreateRequest</span></span>(text: <span class="hljs-string"><span class="hljs-string">"CodyFire is awesome"</span></span>, tags: [<span class="hljs-string"><span class="hljs-string">"codyfire"</span></span>, <span class="hljs-string"><span class="hljs-string">"awesome"</span></span>], images: [imageAttachment], video: videoData) <span class="hljs-type"><span class="hljs-type">API</span></span>.post.create(payload).onProgress { progress <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">" : \(progress)"</span></span>) }.onError { error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(error.description) }.onSuccess { createdPost <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"  : \(createdPost)"</span></span>) }</code> </pre><br>  <i>Anhang</i> ist ein Modell, bei dem neben <i>Daten auch der</i> Dateiname und sein MimeType √ºbertragen werden. <br><br>  Wenn Sie jemals ein mehrteiliges Formular von Swift mit Alamofire oder einer nackten <i>URLRequest eingereicht haben, werden</i> Sie die Einfachheit von <i>CodyFire</i> sicher zu sch√§tzen <i>wissen</i> . <br><br>  Jetzt einfachere, aber nicht weniger coole Beispiele f√ºr GET-Aufrufe. <br><br>  <i>Post + Get.swift</i> <br><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PostController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ListQuery</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Codable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> offset, limit: <span class="hljs-type"><span class="hljs-type">Int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">init</span></span> (offset: <span class="hljs-type"><span class="hljs-type">Int</span></span>, limit: <span class="hljs-type"><span class="hljs-type">Int</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.offset = offset <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.limit = limit } } <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> query: ListQuery? = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">nil</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">APIRequest</span></span>&lt;[<span class="hljs-type"><span class="hljs-type">Post</span></span>]&gt; { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">APIRequest</span></span>(<span class="hljs-string"><span class="hljs-string">"post"</span></span>).query(query) } <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(id: UUID)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">APIRequest</span></span>&lt;<span class="hljs-type"><span class="hljs-type">Post</span></span>&gt; { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">APIRequest</span></span>(<span class="hljs-string"><span class="hljs-string">"post/"</span></span> + id.uuidString) } }</code> </pre><br>  Das einfachste Beispiel ist <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">API</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.post</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.get</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">id</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:)</span></span></code> </pre> <br>  In <i>onSuccess</i> wird das <i>Post-</i> Modell an Sie zur√ºckgegeben. <br><br>  Hier ist ein interessanteres Beispiel. <br><br><pre> <code class="hljs pgsql">API.post.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>(PostController.ListQuery(<span class="hljs-keyword"><span class="hljs-keyword">offset</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">limit</span></span>: <span class="hljs-number"><span class="hljs-number">100</span></span>))</code> </pre> <br>  welches ein <i>ListQuery-</i> Modell als Eingabe nimmt, <br>  welche APIRequest schlie√ülich in einen URL-Pfad des Formulars konvertiert <br><br><pre> <code class="hljs pgsql">post?<span class="hljs-keyword"><span class="hljs-keyword">limit</span></span>=<span class="hljs-number"><span class="hljs-number">0</span></span>&amp;<span class="hljs-keyword"><span class="hljs-keyword">offset</span></span>=<span class="hljs-number"><span class="hljs-number">100</span></span></code> </pre> <br>  und gibt das Array <i>[Post]</i> an <i>onSuccess zur√ºck</i> . <br><br>  Nat√ºrlich k√∂nnen Sie den URL-Pfad auf die alte Art und Weise schreiben, aber jetzt wissen Sie, dass Sie vollst√§ndig codierbar sind. <br><br>  Die letzte Beispielanforderung lautet L√ñSCHEN <br><br>  <i>Post + Delete.swift</i> <br><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PostController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">delete</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(id: UUID)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">APIRequest</span></span>&lt;<span class="hljs-type"><span class="hljs-type">Nothing</span></span>&gt; { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">APIRequest</span></span>(<span class="hljs-string"><span class="hljs-string">"post/"</span></span> + id.uuidString) .method(.delete) .desiredStatusCode(.noContent) } }</code> </pre><br>  Es gibt zwei interessante Punkte. <br><br>  - Der R√ºckgabetyp ist APIRequest. Er gibt den generischen Typ <i>Nothing an</i> , bei dem es sich um ein leeres <i>codierbares</i> Modell handelt. <br>  - Wir haben ausdr√ºcklich darauf hingewiesen, dass wir 204 NO CONTENT erwarten, und CodyFire wird in diesem Fall nur <i>onSuccess</i> aufrufen. <br><br>  Sie wissen bereits, wie Sie diesen Endpunkt von Ihrem ViewController aus aufrufen. <br><br>  Es gibt jedoch zwei Optionen: die erste mit <i>onSuccess</i> und die zweite ohne.  Wir werden ihn ansehen <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">API</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.post</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.delete</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">id</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:).execute()</span></span></code> </pre> <br>  Das hei√üt, wenn es Ihnen egal ist, ob die Anforderung <i>funktioniert</i> , k√∂nnen Sie einfach <i>.execute ()</i> aufrufen und <i>fertig.</i> Andernfalls wird sie nach der <i>onSuccess-</i> Deklaration des <i>Handlers gestartet</i> . <br><br><h2>  Verf√ºgbare Funktionen </h2><br><h4>  Autorisierung jeder Anfrage </h4><br>  Um jede Anforderungs-API mit beliebigen http-Headern zu signieren, wird ein globaler Handler verwendet, den Sie irgendwo in <i>AppDelegate festlegen k√∂nnen</i> .  Dar√ºber hinaus k√∂nnen Sie das klassische [String: String] oder Codable-Modell zur Auswahl verwenden. <br><br>  Beispiel f√ºr Autorisierungstr√§ger. <br><br>  1. Codierbar (empfehlen) <br><pre> <code class="hljs ruby">CodyFire.shared.fillCodableHeaders = { struct <span class="hljs-symbol"><span class="hljs-symbol">Headers:</span></span> Codable { <span class="hljs-regexp"><span class="hljs-regexp">//</span></span><span class="hljs-symbol"><span class="hljs-symbol">NOTE:</span></span>  <span class="hljs-literal"><span class="hljs-literal">nil</span></span>,     headers var <span class="hljs-symbol"><span class="hljs-symbol">Authorization:</span></span> String? var <span class="hljs-symbol"><span class="hljs-symbol">anythingElse:</span></span> String } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Headers(<span class="hljs-symbol"><span class="hljs-symbol">Authorization:</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">anythingElse:</span></span> <span class="hljs-string"><span class="hljs-string">"hello"</span></span>) }</code> </pre><br>  2. Klassisch [String: String] <br><pre> <code class="hljs swift"><span class="hljs-type"><span class="hljs-type">CodyFire</span></span>.shared.fillHeaders = { <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> apiToken = <span class="hljs-type"><span class="hljs-type">LocalAuthStorage</span></span>.savedToken <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [:] } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [<span class="hljs-string"><span class="hljs-string">"Authorization"</span></span>: <span class="hljs-string"><span class="hljs-string">"Bearer \(apiToken)"</span></span>] }</code> </pre><br><h4>  F√ºgen Sie der Anfrage selektiv einige http-Header hinzu </h4><br>  Dies kann beim Erstellen von APIRequest erfolgen, zum Beispiel: <br><br><pre> <code class="hljs powershell">APIRequest(<span class="hljs-string"><span class="hljs-string">"some/endpoint"</span></span>).headers([<span class="hljs-string"><span class="hljs-string">"someKey"</span></span>: <span class="hljs-string"><span class="hljs-string">"someValue"</span></span>])</code> </pre> <br><h4>  Bearbeitung nicht autorisierter Anfragen </h4><br>  Sie k√∂nnen sie global verarbeiten, beispielsweise in <i>AppDelegate</i> <br><br><pre> <code class="hljs objectivec">CodyFire.shared.unauthorizedHandler = { <span class="hljs-comment"><span class="hljs-comment">//   WelcomeScreen }</span></span></code> </pre><br>  oder lokal in jeder Anfrage <br><br><pre> <code class="hljs objectivec">API.post.create(request).onNotAuthorized { <span class="hljs-comment"><span class="hljs-comment">//   }</span></span></code> </pre><br><h4>  Wenn das Netzwerk nicht verf√ºgbar ist </h4><br><pre> <code class="hljs objectivec">API.post.create(request). onNetworkUnavailable { <span class="hljs-comment"><span class="hljs-comment">//   ,  ,     }</span></span></code> </pre>  Andernfalls wird in <i>onError</i> die Fehlermeldung <i>._notConnectedToInternet angezeigt</i> <br><br><h4>  Starten Sie etwas, bevor die Anforderung beginnt </h4><br>  Sie k√∂nnen <i>.onRequestStarted festlegen</i> und beispielsweise einen Loader darin <i>anzeigen</i> . <br>  Dies ist ein praktischer Ort, da er bei fehlendem Internet nicht aufgerufen wird und Sie nicht vergeblich erscheinen m√ºssen, um beispielsweise einen Lader anzuzeigen. <br><br><h4>  So deaktivieren / aktivieren Sie die Protokollausgabe global </h4><br><pre> <code class="hljs vhdl">CodyFire.<span class="hljs-keyword"><span class="hljs-keyword">shared</span></span>.logLevel = .debug CodyFire.<span class="hljs-keyword"><span class="hljs-keyword">shared</span></span>.logLevel = .<span class="hljs-literal"><span class="hljs-literal">error</span></span> CodyFire.<span class="hljs-keyword"><span class="hljs-keyword">shared</span></span>.logLevel = .info CodyFire.<span class="hljs-keyword"><span class="hljs-keyword">shared</span></span>.logLevel = .off</code> </pre><br><h4>  So deaktivieren Sie die Protokollausgabe f√ºr eine einzelne Anforderung </h4><br><pre> <code class="hljs css"><span class="hljs-selector-class"><span class="hljs-selector-class">.avoidLogError</span></span>()</code> </pre> <br><h4>  Verarbeiten Sie Protokolle auf Ihre eigene Weise </h4><br><pre> <code class="hljs pgsql">CodyFire.shared.logHandler = { <span class="hljs-keyword"><span class="hljs-keyword">level</span></span>, <span class="hljs-type"><span class="hljs-type">text</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> print("  CodyFire: " + <span class="hljs-type"><span class="hljs-type">text</span></span>) }</code> </pre><br><h4>  So legen Sie den erwarteten http-Antwortcode des Servers fest </h4><br>  Wie oben erw√§hnt, erwartet CodyFire standardm√§√üig <i>200 OK.</i> Wenn dies der Fall ist, werden Daten analysiert und <i>onSuccess aufgerufen</i> . <br><br>  Der erwartete Code kann jedoch in Form einer praktischen Aufz√§hlung festgelegt werden, z. B. f√ºr <i>201 CREATED</i> <br><br><pre> <code class="hljs css"><span class="hljs-selector-class"><span class="hljs-selector-class">.desiredStatusCode</span></span>(<span class="hljs-selector-class"><span class="hljs-selector-class">.created</span></span>)</code> </pre><br>  oder Sie k√∂nnen sogar benutzerdefinierten erwarteten Code festlegen <br><br><pre> <code class="hljs css"><span class="hljs-selector-class"><span class="hljs-selector-class">.desiredStatusCode</span></span>(<span class="hljs-selector-class"><span class="hljs-selector-class">.custom</span></span>(777))</code> </pre><br><h4>  Anfrage abbrechen </h4><br><pre> <code class="hljs css"><span class="hljs-selector-class"><span class="hljs-selector-class">.cancel</span></span>()</code> </pre><br>  und Sie k√∂nnen herausfinden, dass die Anforderung abgebrochen wurde, indem Sie einen <i>.onCancellation-</i> Handler deklarieren <br><br><pre> <code class="hljs objectivec">.onCancellation { <span class="hljs-comment"><span class="hljs-comment">//   }</span></span></code> </pre><br>  Andernfalls wird <i>onError ausgel√∂st</i> <br><br><h4>  Festlegen eines Zeitlimits f√ºr eine Anforderung </h4><br><pre> <code class="hljs objectivec">.responseTimeout(<span class="hljs-number"><span class="hljs-number">30</span></span>) <span class="hljs-comment"><span class="hljs-comment">//   30 </span></span></code> </pre><br>  Ein Handler kann auch an ein Timeout-Ereignis geh√§ngt werden <br><br><pre> <code class="hljs objectivec">. onTimeout { <span class="hljs-comment"><span class="hljs-comment">//    }</span></span></code> </pre><br>  Andernfalls wird <i>onError ausgel√∂st</i> <br><br><h4>  Festlegen eines interaktiven zus√§tzlichen Zeitlimits </h4><br>  Dies ist meine Lieblingsfunktion.  Ein Kunde aus den USA hat mich einmal nach ihr gefragt, weil  Es gefiel ihm nicht, dass das Anmeldeformular zu schnell funktionierte. Seiner Meinung nach sah es nicht nat√ºrlich aus, als w√§re es eine F√§lschung, keine Autorisierung. <br><br>  Die Idee ist, dass die E-Mail- / Passwortpr√ºfung mindestens 2 Sekunden dauern soll.  Und wenn es nur 0,5 Sekunden dauert, m√ºssen Sie weitere 1,5 werfen und erst dann <i>onSuccess aufrufen</i> .  Und wenn es genau 2 oder 2,5 Sekunden dauert, rufen <i>Sie</i> sofort <i>onSuccess auf</i> . <br><br><pre> <code class="hljs objectivec">.additionalTimeout(<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-comment"><span class="hljs-comment">// 2    </span></span></code> </pre><br><h4>  Benutzerdefinierter Datumscodierer / -decodierer </h4><br>  CodyFire verf√ºgt √ºber eine eigene <i>DateCodingStrategy-Enumeration</i> , in der drei Werte enthalten sind <br><br>  - Sekunden seit 1970 <br>  - Millisekunden seit 1970 <br>  - formatiert (_ customDateFormatter: DateFormatter) <br><br>  <i>DateCodingStrategy</i> kann auf drei Arten und separat zum Decodieren und Codieren festgelegt werden <br>  - global in <i>AppDelegate</i> <br><br><pre> <code class="hljs vhdl">CodyFire.<span class="hljs-keyword"><span class="hljs-keyword">shared</span></span>.dateEncodingStrategy = .secondsSince1970 let customDateFormatter = DateFormatter() CodyFire.<span class="hljs-keyword"><span class="hljs-keyword">shared</span></span>.dateDecodingStrategy = .formatted(customDateFormatter)</code> </pre><br>  - f√ºr eine Anfrage <br><br><pre> <code class="hljs objectivec">APIRequest(<span class="hljs-string"><span class="hljs-string">"some/endpoint"</span></span>) .dateDecodingStrategy(.millisecondsSince1970) .dateEncodingStrategy(.secondsSince1970)</code> </pre><br>  - oder sogar separat f√ºr jedes Modell, Sie ben√∂tigen nur das Modell, das mit <i>CustomDateEncodingStrategy</i> und / oder <i>CustomDateDecodingStrategy √ºbereinstimmt</i> . <br><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SomePayload</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">JSONPayload</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CustomDateEncodingStrategy</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CustomDateDecodingStrategy</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dateEncodingStrategy: <span class="hljs-type"><span class="hljs-type">DateCodingStrategy</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dateDecodingStrategy: <span class="hljs-type"><span class="hljs-type">DateCodingStrategy</span></span> }</code> </pre><br><h2>  So f√ºgen Sie dem Projekt hinzu </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Die Bibliothek ist auf GitHub unter der MIT-Lizenz verf√ºgbar.</a> <br><br>  Die Installation ist derzeit nur √ºber CocoaPods m√∂glich <br><pre> <code class="ruby hljs">pod <span class="hljs-string"><span class="hljs-string">'CodyFire'</span></span></code> </pre> <br><br>  Ich hoffe wirklich, dass CodyFire f√ºr andere iOS-Entwickler n√ºtzlich sein wird, die Entwicklung f√ºr sie vereinfacht und die Welt im Allgemeinen ein wenig besser und die Menschen freundlicher macht. <br><br>  Das ist alles, danke f√ºr deine Zeit. <br><br>  <b>UPD: Unterst√ºtzung f√ºr ReactiveCocoa und RxSwift hinzugef√ºgt</b> <br><pre> <code class="ruby hljs">pod <span class="hljs-string"><span class="hljs-string">'ReactiveCodyFire'</span></span> <span class="hljs-comment"><span class="hljs-comment"># ReactiveCocoa pod 'RxCodyFire' # RxSwift #      'CodyFire',    </span></span></code> </pre><br>  <u>APIRequest</u> f√ºr ReactiveCoca hat <i>.signalProducer</i> und f√ºr RxSwift <i>.observable</i> <br><br>  <b>UPD2: Jetzt k√∂nnen Sie mehrere Anforderungen ausf√ºhren</b> <br>  Wenn es wichtig ist, dass Sie das Ergebnis jeder Abfrage erhalten, verwenden Sie <i>.and ()</i> <br>  Maximal in diesem Modus k√∂nnen Sie bis zu 10 Anfragen ausf√ºhren, die streng nacheinander ausgef√ºhrt werden. <br><pre> <code class="hljs pgsql">API.employee.<span class="hljs-keyword"><span class="hljs-keyword">all</span></span>() .<span class="hljs-keyword"><span class="hljs-keyword">and</span></span>(API.office.<span class="hljs-keyword"><span class="hljs-keyword">all</span></span>()) .<span class="hljs-keyword"><span class="hljs-keyword">and</span></span>(API.car.<span class="hljs-keyword"><span class="hljs-keyword">all</span></span>()) .<span class="hljs-keyword"><span class="hljs-keyword">and</span></span>(API.event.<span class="hljs-keyword"><span class="hljs-keyword">all</span></span>()) .<span class="hljs-keyword"><span class="hljs-keyword">and</span></span>(API.post.<span class="hljs-keyword"><span class="hljs-keyword">all</span></span>()) .onError { error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> print(error.description) }.onSuccess { employees, offices, cars, events, posts <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //    !!! }</code> </pre><br>  <i>onRequestStarted, onNetworkUnavailable, onCancellation, onNotAuthorized, onTimeout</i> sind ebenfalls verf√ºgbar. <br>  <i>onProgress</i> - noch in der Entwicklung <br><br>  Wenn Sie sich nicht um die Ergebnisse Ihrer Abfragen k√ºmmern, k√∂nnen Sie <i>.flatten () verwenden.</i> <br><pre> <code class="hljs powershell">[<span class="hljs-type"><span class="hljs-type">API.employee.all</span></span>(), <span class="hljs-type"><span class="hljs-type">API.office.all</span></span>(), <span class="hljs-type"><span class="hljs-type">API.car.all</span></span>()].flatten().onError { print(error.description) }.onSuccess { print(<span class="hljs-string"><span class="hljs-string">"flatten finished!"</span></span>) }</code> </pre>  Um sie gleichzeitig <i>auszuf√ºhren,</i> f√ºgen <i>Sie</i> einfach <i>.concurrent (by: 3)</i> hinzu. <i>Dadurch</i> k√∂nnen drei Anforderungen gleichzeitig ausgef√ºhrt werden. Es kann eine beliebige Anzahl angegeben werden. <br>  Um fehlgeschlagene Abfragefehler zu √ºberspringen, f√ºgen Sie <i>.avoidCancelOnError () hinzu.</i> <br>  <i>F√ºgen</i> Sie <i>.onProgress</i> hinzu, um Fortschritte zu <i>erzielen</i> <br><br>  <b>UPD3: Jetzt k√∂nnen Sie f√ºr jede Anforderung einen separaten Server festlegen</b> <br>  Es ist notwendig, die erforderlichen Serveradressen irgendwo zu erstellen, zum Beispiel so <br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> server1 = ServerURL(<span class="hljs-keyword"><span class="hljs-keyword">base</span></span>: <span class="hljs-string"><span class="hljs-string">"https://server1.com"</span></span>, path: <span class="hljs-string"><span class="hljs-string">"v1"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> server2 = ServerURL(<span class="hljs-keyword"><span class="hljs-keyword">base</span></span>: <span class="hljs-string"><span class="hljs-string">"https://server2.com"</span></span>, path: <span class="hljs-string"><span class="hljs-string">"v1"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> server3 = ServerURL(<span class="hljs-keyword"><span class="hljs-keyword">base</span></span>: <span class="hljs-string"><span class="hljs-string">"https://server3.com"</span></span>)</code> </pre>  Und jetzt k√∂nnen Sie sie direkt bei der Initialisierung der Anforderung verwenden, bevor Sie den Endpunkt angeben <br><pre> <code class="hljs lisp">APIRequest(<span class="hljs-name"><span class="hljs-name">server1</span></span>, <span class="hljs-string"><span class="hljs-string">"endpoint"</span></span>, payload: payloadObject) APIRequest(<span class="hljs-name"><span class="hljs-name">server2</span></span>, <span class="hljs-string"><span class="hljs-string">"endpoint"</span></span>, payload: payloadObject) APIRequest(<span class="hljs-name"><span class="hljs-name">server3</span></span>, <span class="hljs-string"><span class="hljs-string">"endpoint"</span></span>, payload: payloadObject)</code> </pre>  oder Sie k√∂nnen den Server nach dem Initialisieren der Anforderung angeben <br><pre> <code class="hljs objectivec">APIRequest(<span class="hljs-string"><span class="hljs-string">"endpoint"</span></span>, payload: payloadObject).serverURL(server1)</code> </pre></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de427937/">https://habr.com/ru/post/de427937/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de427927/index.html">B - Brutalit√§t. Offizielle Seite des Tischtennisverbandes der Republik Baschkortostan (FTN RB)</a></li>
<li><a href="../de427929/index.html">Arbeitsministerium: Testaufgabe ist ein Arbeitsverh√§ltnis</a></li>
<li><a href="../de427931/index.html">Internetinformationsarchitektur Teil 4</a></li>
<li><a href="../de427933/index.html">Meinung der Steam-Entwickler: Maximaler Umsatz und geringe Verantwortung f√ºr das Ventil</a></li>
<li><a href="../de427935/index.html">Neuinstallation von vorinstalliertem Windows 8 Ende 2018</a></li>
<li><a href="../de427939/index.html">Behandlung von asymmetrischem FHRP-Routing</a></li>
<li><a href="../de427941/index.html">Stellen Sie den Kubernetes HA-Cluster auf Baremetal mit Kubeadm und Keepalived bereit (einfache Anleitung).</a></li>
<li><a href="../de427943/index.html">Wir warten auf serielle 8K OLED LG-Fernseher im Juni 2019, die Ver√∂ffentlichung kann sich verz√∂gern</a></li>
<li><a href="../de427945/index.html">Hypervisor f√ºr Dummies</a></li>
<li><a href="../de427947/index.html">Neuronale Netze verstehen nicht, was optische T√§uschungen sind.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>