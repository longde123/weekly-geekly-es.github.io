<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëÉüèª üö† üåõ GameDev TDD ou Rabbit Hell üë®üèæ‚Äçüéì üîÅ üìá</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="TDD raramente √© usado no desenvolvimento de jogos. Geralmente, √© mais f√°cil contratar um testador do que reservar um desenvolvedor para escrever teste...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>GameDev TDD ou Rabbit Hell</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pixonic/blog/455076/">  TDD raramente √© usado no desenvolvimento de jogos.  Geralmente, √© mais f√°cil contratar um testador do que reservar um desenvolvedor para escrever testes - isso economiza recursos e tempo.  Portanto, cada uso bem-sucedido do TDD se torna mais interessante.  Sob o corte, a tradu√ß√£o do material, onde essa t√©cnica de desenvolvimento foi usada para criar o movimento de personagens no jogo ElemenTerra. <br><br><img src="https://habrastorage.org/webt/6x/yz/5c/6xyz5cjyml6vqmszhh-68zfy3_w.gif"><br><a name="habracut"></a><br>  O desenvolvimento orientado a testes ou TDD (desenvolvimento atrav√©s de testes) √© uma t√©cnica de desenvolvimento de software na qual todo o processo √© dividido em muitos pequenos ciclos.  Os testes de unidade s√£o gravados, o c√≥digo que passa nesses testes e a refatora√ß√£o √© feita.  E o algoritmo se repete. <br><br><h3>  TDD Basics </h3><br>  Suponha que escrevamos uma fun√ß√£o que adicione dois n√∫meros.  Em um fluxo de trabalho normal, basta escrev√™-lo.  Mas, para usar o TDD, √© necess√°rio come√ßar criando uma fun√ß√£o de espa√ßo reservado e testes de unidade: <br><br><pre><code class="plaintext hljs">// Placeholder-,    : int add(int a, int b){ return -1; } // Unit-,   ,  add    : void runTests(){ if (add(1, 1) is not equal to 2) throw error; if (add(2, 2) is not equal to 4) throw error; }</code> </pre> <br>  Inicialmente, nossos testes de unidade n√£o funcionar√£o, porque a fun√ß√£o de espa√ßo reservado retorna -1 para cada entrada.  Agora podemos executar <i>add</i> corretamente para retornar <i>a + b</i> .  Os testes ser√£o aprovados.  Isso pode parecer uma solu√ß√£o alternativa, mas h√° v√°rias vantagens: <br><br>  Se escrevermos <i>add</i> por <i>a-b por</i> engano, nossos testes n√£o funcionar√£o e aprenderemos imediatamente como consertar a fun√ß√£o.  Sem testes, n√£o podemos detectar esse erro e ver uma rea√ß√£o n√£o padr√£o que levar√° tempo para depurar. <br>  Podemos continuar os testes e execut√°-los a qualquer momento enquanto escrevemos o c√≥digo.  Isso significa que, se outro programador mudar acidentalmente, ele reconhecer√° imediatamente o erro - os testes falhar√£o novamente. <br><br><h3>  TDD no jogo dev </h3><br>  Existem dois problemas com o TDD no game dev.  Em primeiro lugar, muitas fun√ß√µes do jogo t√™m objetivos subjetivos que n√£o podem ser medidos.  Em segundo lugar, √© dif√≠cil escrever testes que abranjam todas as possibilidades do espa√ßo de mundos cheios de objetos complexos em intera√ß√£o.  Os desenvolvedores que desejam que os movimentos de seus personagens ‚Äúpare√ßam bem‚Äù ou simula√ß√µes f√≠sicas ‚Äún√£o pare√ßam espasm√≥dicos‚Äù ter√£o dificuldade em expressar essas m√©tricas como condi√ß√µes determin√≠sticas ‚Äúpassadas / n√£o passadas‚Äù. <br><br>  No entanto, a t√©cnica TDD √© aplic√°vel a caracter√≠sticas complexas e subjetivas - por exemplo, movimento de caracteres.  E no jogo ElemenTerra n√≥s fizemos. <br><br><h3>  Testes de unidade em rela√ß√£o aos n√≠veis de depura√ß√£o </h3><br>  Antes de come√ßar a praticar, quero distinguir entre um teste de unidade autom√°tico e um "n√≠vel de depura√ß√£o" tradicional.  Criar locais ocultos com condi√ß√µes artificiais √© algo comum no gamedev.  Isso permite que programadores e controle de qualidade monitorem eventos individuais. <br><br><img src="https://habrastorage.org/webt/ln/qv/4e/lnqv4efk5tcmb1pzm7x1qz47eqs.png"><br>  <i>N√≠vel de depura√ß√£o secreto em The Legend of Zelda: The Wind Waker</i> <br><br>  O ElemenTerra possui muitos n√≠veis: um n√≠vel cheio de geometria problem√°tica para o personagem de um jogador, n√≠veis com interfaces de usu√°rio especiais que acionam determinados estados do jogo e outros. <br><br>  Como testes de unidade, esses n√≠veis de depura√ß√£o podem ser usados ‚Äã‚Äãpara reproduzir e diagnosticar erros.  Mas de certa forma eles diferem: <br><br>  Os testes de unidade dividem os sistemas em partes e avaliam cada um individualmente, enquanto os n√≠veis de depura√ß√£o conduzem os testes de maneira mais hol√≠stica.  Depois de encontrar o erro no n√≠vel de depura√ß√£o, os desenvolvedores ainda podem precisar procurar manualmente o ponto de erro. <br>  Os testes de unidade s√£o automatizados e devem sempre fornecer resultados determin√≠sticos, enquanto muitos n√≠veis de depura√ß√£o s√£o "controlados" pelo jogador.  Isso faz a diferen√ßa nas sess√µes. <br><br>  Mas isso n√£o significa que os testes de unidade sejam melhores que os n√≠veis de depura√ß√£o.  Estes √∫ltimos costumam ser mais pr√°ticos.  No entanto, o teste de unidade pode at√© ser usado em sistemas onde tradicionalmente n√£o existe. <br><br><h3>  Bem-vindo ao inferno do coelho </h3><br>  No ElemenTerra, os jogadores usam as for√ßas m√≠sticas da natureza para salvar criaturas afetadas por uma tempestade espacial.  Uma dessas for√ßas √© a capacidade de pavimentar o caminho que leva as criaturas a alimento e abrigo.  Como esses caminhos s√£o grades din√¢micas criadas pelos jogadores, o movimento da criatura deve lidar com casos geom√©tricos incomuns e um terreno arbitrariamente complexo. <br><br>  O movimento do personagem √© um daqueles sistemas complexos em que "tudo afeta todo o resto".  Se voc√™ j√° fez isso, sabe que, ao escrever um novo c√≥digo, √© muito f√°cil quebrar a funcionalidade existente.  Voc√™ precisa de coelhos para escalar pequenas sali√™ncias?  Ok, mas agora eles est√£o tremendo, subindo as encostas.  Deseja que os caminhos dos lagartos n√£o se cruzem?  Funcionou, mas agora seu comportamento t√≠pico est√° arruinado. <br><br>  Como respons√°vel pela IA e pela maior parte do c√≥digo de jogo, eu sabia que n√£o tinha tempo para erros de surpresa.  Eu queria perceber imediatamente a regress√£o, ent√£o o desenvolvimento usando TDD me pareceu uma boa op√ß√£o. <br><br>  O pr√≥ximo passo foi a cria√ß√£o de um sistema no qual eu pudesse identificar facilmente cada caso de movimento na forma de um teste simulado de aprova√ß√£o / reprova√ß√£o: <br><br><img src="https://habrastorage.org/webt/tb/uf/8q/tbuf8ql64djoz57rkpjjsbdc-sq.gif"><br><br>  Esse "inferno dos coelhos" consiste em 18 corredores isolados.  Cada uma com uma criatura e sua pr√≥pria rota, projetada para se mover apenas se uma determinada fun√ß√£o de movimento funcionar.  Os testes s√£o considerados bem-sucedidos se o coelho for capaz de se mover por um tempo infinitamente longo sem ficar preso.  Caso contr√°rio, sem √™xito.  Note que apenas testamos o corpo das criaturas (pe√£o em termos irreais), n√£o a intelig√™ncia artificial.  No ElemenTerra, as criaturas podem comer, dormir e reagir ao mundo, mas no "inferno dos coelhos", sua √∫nica instru√ß√£o √© correr entre dois pontos. <br><br>  Aqui est√£o alguns exemplos de tais testes: <br><br><img src="https://habrastorage.org/webt/s3/pb/9u/s3pb9ucpk-ezq2sg8ehnwjmpo5s.gif"><br>  <i>1, 2, 3: Livre circula√ß√£o, obst√°culos est√°ticos e obst√°culos din√¢micos</i> <br><br><img src="https://habrastorage.org/webt/5e/co/jh/5ecojh5plbr-lpajkm3ttqvyfdu.gif"><br>  <i>8 e 9: Inclina√ß√µes uniformes e terrenos acidentados</i> <br><br><img src="https://habrastorage.org/webt/tl/fp/o0/tlfpo0gylqb4k0vcic6lvnklvp4.gif"><br>  <i>10: Piso desaparecendo</i> <br><br><img src="https://habrastorage.org/webt/t_/et/pd/t_etpdknaotnaxi0ozma56rosos.gif"><br>  <i>13: Reprodu√ß√£o de um bug no qual criaturas giravam sem parar em torno de alvos pr√≥ximos</i> <br><br><img src="https://habrastorage.org/webt/7w/yf/mu/7wyfmuvpvihnaoljhwuvrttqd7c.gif"><br>  <i>14 e 15: Capacidade de navegar por sali√™ncias planas e complexas</i> <i><br></i> <br>  Vamos falar sobre as semelhan√ßas e diferen√ßas entre minha implementa√ß√£o e o TDD "limpo". <br><br>  Meu sistema era semelhante ao TDD nisso: <br><br><ul><li>  Comecei a trabalhar nas fun√ß√µes criando testes e depois escrevi o c√≥digo necess√°rio para execut√°-las. </li><li>  Continuei a executar testes antigos, adicionando novos recursos. </li><li>  Cada teste mediu exatamente uma parte do sistema, o que me permitiu encontrar rapidamente problemas. </li><li>  Os testes foram automatizados e n√£o exigiram a entrada do jogador. </li></ul><br>  E diferia nisso: <br><br><ul><li>  Ao avaliar os testes, houve um elemento de subjetividade.  Enquanto os verdadeiros erros de se mover (o personagem n√£o passou de A para B) puderam ser detectados programaticamente.  Isto √©, por exemplo, uma posi√ß√£o distorcida, problemas de sincroniza√ß√£o da anima√ß√£o e movimento de contra√ß√£o exigem uma avalia√ß√£o humana. </li><li>  Os testes n√£o foram completamente determin√≠sticos.  Fatores aleat√≥rios, como flutua√ß√µes na taxa de quadros, causaram pequenos desvios.  Mas, em geral, as criaturas geralmente seguem os mesmos caminhos e t√™m o mesmo sucesso / fracasso entre as sess√µes. </li></ul><br><h3>  Limita√ß√µes </h3><br>  Usar o TDD para mover uma criatura ElemenTerra foi uma grande vantagem, mas minha abordagem tinha v√°rias limita√ß√µes: <br><br><ul><li>  Os testes de unidade avaliaram cada caracter√≠stica do movimento individualmente, portanto, erros com combina√ß√µes de v√°rias caracter√≠sticas n√£o foram considerados.  √Äs vezes, era necess√°rio complementar os testes de unidade com os n√≠veis tradicionais de depura√ß√£o. </li><li>  O ElemenTerra tem quatro tipos de criaturas, mas os testes cont√™m apenas coelhos.  Esse √© um recurso do nosso cronograma de produ√ß√£o (os outros tr√™s tipos foram adicionados muito mais tarde no desenvolvimento).  Felizmente, todos os quatro t√™m a mesma mobilidade, mas o corpo grande de Mossmork causou v√°rios problemas.  Na pr√≥xima vez, eu teria que fazer testes dinamicamente nas esp√©cies selecionadas, em vez de usar coelhos pr√©-colocados. </li></ul><br><img src="https://habrastorage.org/webt/xo/ua/yq/xouayqg87iiyszdn4tfonai7rou.png"><br>  <i>Este Mossmork requer um pouco mais de espa√ßo do que um coelho.</i> <br><br><h3>  TDD √© sua escolha? </h3><br>  Os desenvolvedores podem gastar muito esfor√ßo em n√≠veis de teste de unidade que o player nunca apreciar√°.  Eu n√£o nego, eu mesmo recebi muito prazer ao criar o ‚Äúinferno dos coelhos‚Äù.  Tais fun√ß√µes internas podem consumir tempo e comprometer marcos mais importantes.  Para evitar que isso aconte√ßa, estude cuidadosamente onde e quando usar testes de unidade.  Abaixo, destaquei v√°rios crit√©rios que justificam o TDD para o movimento de uma criatura ElemenTerra. <br><br>  1. Levar√° muito tempo para concluir manualmente as tarefas de teste? <br><br>  Antes de gastar tempo em testes automatizados, √© necess√°rio verificar se podemos avaliar a fun√ß√£o usando controles de jogo convencionais.  Se voc√™ quiser ter certeza de que suas chaves destrancam as portas, solte a chave e abra a porta para elas.  Criar testes de unidade para esta fun√ß√£o seria uma perda de tempo - o teste manual leva apenas alguns segundos. <br><br>  2. √â dif√≠cil criar casos de teste manualmente? <br><br>  Os testes de unidade automatizados s√£o justificados quando h√° casos conhecidos e dif√≠ceis de reproduzir.  O teste n ¬∞ 7 do ‚Äúinferno dos coelhos‚Äù verifica como eles andam ao longo das bordas - algo que a IA geralmente tenta evitar.  Essa situa√ß√£o pode ser dif√≠cil ou imposs√≠vel de reproduzir usando os controles do jogo, e os testes s√£o f√°ceis. <br><br>  3. Voc√™ sabia que os resultados desejados n√£o ser√£o alterados? <br><br>  O design do jogo √© inteiramente baseado em itera√ß√µes, para que os objetivos dos recursos possam mudar √† medida que o jogo muda.  Mesmo pequenas altera√ß√µes podem invalidar as m√©tricas pelas quais voc√™ avalia seus recursos e, portanto, qualquer teste de unidade.  Se o comportamento das criaturas durante a comida, o sono e a intera√ß√£o com o jogador mudaram v√°rias vezes, a transi√ß√£o do ponto A para o ponto B permaneceu inalterada.  Portanto, o c√≥digo de movimento e seus testes de unidade permaneceram relevantes durante todo o desenvolvimento. <br><br>  4. √â prov√°vel que as regress√µes passem despercebidas? <br><br>  Voc√™ teve uma situa√ß√£o ao concluir uma das √∫ltimas tarefas antes de enviar o jogo e, de repente, encontrou um erro que quebra as regras?  E na fun√ß√£o que voc√™ terminou h√° muitos anos.  Os jogos s√£o sistemas interconectados gigantescos e, portanto, √© natural que a adi√ß√£o de uma nova fun√ß√£o B possa levar √† falha da antiga fun√ß√£o A. <br><br>  N√£o √© t√£o ruim quando uma fun√ß√£o quebrada √© usada em qualquer lugar (por exemplo, um salto) - voc√™ deve notar imediatamente uma falha na mec√¢nica.  Erros descobertos em um desenvolvimento posterior podem atrapalhar a programa√ß√£o e, ap√≥s o lan√ßamento, podem prejudicar a jogabilidade. <br><br>  5. O pior que pode acontecer ao usar testes e sem eles? <br><br>  Criar testes √© uma forma de gerenciamento de riscos.  Imagine que voc√™ decide comprar um seguro de ve√≠culo.  Voc√™ precisa responder tr√™s perguntas: <br><br><ul><li>  Quanto custam os pr√™mios mensais de seguro? </li><li>  Qual a probabilidade de o carro ser danificado? </li><li>  Qu√£o caro seria o pior cen√°rio se voc√™ n√£o estivesse segurado? </li></ul><br>  Para o TDD, podemos imaginar contribui√ß√µes mensais na forma de custos de produ√ß√£o para a manuten√ß√£o de nossos testes de unidade, a probabilidade de danos ao carro na forma da probabilidade de um bug e o custo de uma substitui√ß√£o completa do carro como o pior cen√°rio para um erro de regress√£o. <br><br>  Se demorar muito tempo para criar um teste de recurso, √© simples e improv√°vel que seja alterado (ou pode ser resolvido se for interrompido no desenvolvimento posterior), os testes de unidade podem causar mais problemas do que benef√≠cios.  Se os testes s√£o f√°ceis de executar, a fun√ß√£o √© inst√°vel e interconectada (ou seus erros levar√£o muito tempo), ent√£o os testes ajudar√£o. <br><br><h3>  Limites de automa√ß√£o </h3><br>  Os testes de unidade podem ser um √≥timo complemento para encontrar e eliminar erros, mas n√£o substituem a necessidade de controle de qualidade profissional em jogos de larga escala.  O controle de qualidade √© uma arte que requer criatividade, julgamento subjetivo e excelente comunica√ß√£o t√©cnica. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt455076/">https://habr.com/ru/post/pt455076/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt455062/index.html">Casos de experimentos bem-sucedidos (e n√£o muito) de Yandex.Navigator</a></li>
<li><a href="../pt455064/index.html">Talento vs. Sorte: O Papel da Chance no Sucesso e Fracasso</a></li>
<li><a href="../pt455066/index.html">Transmiss√£o e apresenta√ß√µes do MeetUp UPD2 de an√°lise do sistema</a></li>
<li><a href="../pt455070/index.html">Por que as entrevistas s√£o t√£o frequentemente perguntadas sobre listas vinculadas</a></li>
<li><a href="../pt455072/index.html">Toda a verdade sobre o RTOS. Artigo 28. Temporizadores de software</a></li>
<li><a href="../pt455078/index.html">Onde falar sobre o Apache Ignite e sistemas distribu√≠dos no ver√£o</a></li>
<li><a href="../pt455080/index.html">Os idosos n√£o pertencem aqui? Program√°vel ap√≥s trinta e cinco</a></li>
<li><a href="../pt455082/index.html">Estudamos MITRE ATT & CK. Matrizes m√≥veis: acesso ao dispositivo. Parte 4</a></li>
<li><a href="../pt455094/index.html">Como proteger o 5G em uma cidade inteligente: aplique uma nova arquitetura de seguran√ßa</a></li>
<li><a href="../pt455096/index.html">Testando compet√™ncias com testes - por que e como</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>