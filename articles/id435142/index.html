<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üè¨ ‚õ≤Ô∏è üë®üèª Jejak Belajar Menggunakan eBPF: Sebuah Panduan dan Contoh üêÖ üö¥üèº üë©‚Äçüëß</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Halo, Habr! Saya membawa perhatian Anda pada terjemahan sebuah artikel oleh Brendan Gregg di eBPF 

 Setidaknya ada 24 presentasi eBPF di konferensi L...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Jejak Belajar Menggunakan eBPF: Sebuah Panduan dan Contoh</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/435142/"><blockquote>  Halo, Habr!  Saya membawa perhatian Anda pada terjemahan sebuah <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">artikel oleh</a> Brendan Gregg di eBPF </blockquote><p>  Setidaknya ada 24 presentasi eBPF di konferensi Linux Plumbers.  Dengan cepat menjadi tidak hanya teknologi yang tak ternilai, tetapi juga keterampilan yang dicari.  Mungkin Anda ingin menetapkan beberapa tujuan untuk tahun baru - pelajari eBPF! </p><br><p>  Istilah eBPF harus berarti sesuatu yang substansial, seperti Virtual Kernel Instruction Set (VKIS), tetapi asalnya adalah Berkeley Packet Filter yang diperluas.  Ini berlaku di banyak bidang, seperti kinerja jaringan, firewall, keamanan, tracing, dan driver perangkat.  Bagi sebagian dari mereka, ada banyak informasi yang tersedia secara bebas di Internet - misalnya, penelusuran, tetapi bagi yang lain belum.  Jejak istilah mengacu pada analisis kinerja dan alat pengawasan yang dapat menghasilkan informasi untuk setiap peristiwa.  Anda mungkin sudah menggunakan pelacak - tcpdump dan strace adalah pelacak khusus. </p><br><p> Dalam posting ini, saya akan menjelaskan proses mempelajari penggunaan eBPF untuk tujuan penelusuran, dikelompokkan menjadi beberapa bagian untuk pemula, pengguna tingkat lanjut dan lanjut.  Singkatnya: </p><br><ul><li>  Pemula: meluncurkan alat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">bcc</a> </li><li>  Berpengalaman: mengembangkan alat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">bpftrace</a> </li><li>  Advanced: mengembangkan alat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">bcc</a> , berkontribusi pada bcc dan bpftrace </li></ul><a name="habracut"></a><br><h1>  Pemula </h1><br><h2>  1. Apakah eBPF, bcc, bpftrace, dan iovisor? </h2><br><p>  <strong>eBPF</strong> melakukan hal yang sama untuk Linux seperti JavaScript untuk HTML, semacam.  Jadi, alih-alih situs HTML statis, JavaScript memungkinkan Anda menentukan program mini yang dijalankan pada acara - seperti klik mouse - yang dijalankan di mesin virtual aman di browser.  Dan dengan eBPF - alih-alih mengedit kernel, Anda sekarang dapat menulis program mini yang berjalan pada acara seperti disk I / O pada mesin virtual aman di kernel.  Bahkan, eBPF lebih seperti mesin virtual v8 yang menjalankan JavaScript daripada JavaScript itu sendiri.  eBPF adalah bagian dari kernel Linux. </p><br><p>  Pemrograman langsung di eBPF sangat sulit, seperti halnya bytecode v8.  Tetapi tidak ada yang mengkode dalam v8: semua orang menulis dalam JavaScript, atau sering dalam kerangka kerja di atas JavaScript (jQuery, Angular, React, dll.).  Hal yang sama dengan eBPF.  Orang akan menggunakannya, dan menulis kode melalui kerangka kerja.  Yang utama untuk pelacakan adalah <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">bcc</a></b> dan <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">bpftrace</a></b> .  Mereka tidak tinggal di basis kode kernel, mereka tinggal di proyek Linux Foundation di github bernama <strong>iovisor</strong> . </p><br><h2>  2. Apakah mungkin melacak menggunakan eBPF? </h2><br><p>  Utilitas berbasis eBPF ini menunjukkan sesi TCP yang ditetapkan sepenuhnya dengan ID proses (PID), nama perintah (COMM), byte yang dikirim dan diterima (TX_KB, RX_KB), dan durasi dalam milidetik (MS): </p><p></p><blockquote>  # <b>tcplife</b> <pre> PID COMM LADDR LPORT RADDR RPORT TX_KB RX_KB MS
 22597 recordProg 127.0.0.1 46644 127.0.0.1 28527 0 0 0.23
 3277 redis-serv 127.0.0.1 28527 127.0.0.1 46644 0 0 0.28
 22598 curl 100.66.3.172 61620 52.205.89.26 80 0 1 91.79
 22604 curl 100.66.3.172 44400 52.204.43.121 80 0 1 121.38
 22624 recordProg 127.0.0.1 46648 127.0.0.1 28527 0 0 0.22
 3277 redis-serv 127.0.0.1 28527 127.0.0.1 46648 0 0 0.27
 22647 recordProg 127.0.0.1 46650 127.0.0.1 28527 0 0 0.21
 3277 redis-serv 127.0.0.1 28527 127.0.0.1 46650 0 0 0.26
 [...] </pre><br></blockquote><br><p>  <em>Tidak</em> eBPF ini memungkinkan - saya dapat menulis ulang tcplife untuk menggunakan teknologi kernel yang lebih lama.  Tetapi jika saya melakukannya, kami tidak akan pernah menjalankan alat seperti itu dalam produksi karena berkurangnya kinerja, masalah keamanan, atau keduanya.  eBPF telah menjadikan alat ini <em>praktis</em> : efisien dan aman.  Misalnya, ia tidak melacak setiap paket, seperti yang dilakukan dengan pendekatan sebelumnya, dan itu dapat menyebabkan penurunan kinerja yang berlebihan.  Sebaliknya, ini hanya melacak peristiwa sesi TCP yang terjadi jauh lebih jarang.  Ini membuat biaya overhead sangat rendah sehingga kita dapat menjalankan alat ini dalam mode 24x7. </p><br><h2>  3. Bagaimana saya menggunakan ini? </h2><br><p>  Pemula harus mulai menjelajahi bcc.  Lihat <a href="">instruksi instalasi bcc untuk</a> sistem operasi Anda.  Untuk Ubuntu, tampilannya seperti ini: </p><br><blockquote>  # <b>sudo apt-get update</b> <br>  # <b>sudo apt-get install bpfcc-tools</b> <br>  # <b>sudo / usr / share / bcc / tools / opensnoop</b> <pre> PID COMM FD ERR PATH
 25548 gnome-shell 33 0 / proc / self / stat
 10190 opensnoop -1 2 /usr/lib/python2.7/encodings/ascii.x86_64-linux-gnu.so
 10190 opensnoop -1 2 /usr/lib/python2.7/encodings/ascii.so
 10190 opensnoop -1 2 /usr/lib/python2.7/encodings/asciimodule.so
 10190 opensnoop 18 0 /usr/lib/python2.7/encodings/ascii.py
 10190 opensnoop 19 0 /usr/lib/python2.7/encodings/ascii.pyc
 25548 gnome-shell 33 0 / proc / self / stat
 29588 polling perangkat 4 0 / dev / bus / usb
 ^ C
</pre></blockquote><br><p>  Di sini saya akhirnya membuka noop untuk menguji fungsionalitas alat.  Jika Anda sejauh ini, Anda pasti menggunakan eBPF! </p><br><p>  Untuk perusahaan seperti Netflix dan Facebook, bcc diinstal pada semua server secara default.  Mungkin Anda ingin melakukan hal yang sama. </p><br><h2>  4. Apakah ada panduan pemula? </h2><br><p>  Ya, saya menulis panduan untuk bcc, yang merupakan titik awal yang baik untuk pemula dalam menelusuri dengan eBPF: </p><br><ul><li>  <a href="">Bcc tutorial</a> </li></ul><br><p>  Sebagai pemula, Anda tidak perlu menulis kode apa pun untuk eBPF.  bcc sudah mengandung lebih dari 70 alat yang dapat Anda gunakan segera.  Panduan ini akan memandu Anda melalui langkah-langkah melalui sebelas berikut ini: execsnoop, opensnoop, ext4slower (atau btrfs *, xfs *, zfs *), biolatency, biosnoop, cachestat, tcpconnect, tcpaccept, tcpretrans, runqlat dan profil. </p><br><p>  Setelah Anda mencobanya, Anda hanya perlu tahu bahwa ada banyak cara lain: </p><br><p> <a href=""><img src="https://hsto.org/webt/km/jt/hy/kmjthyb3fxb0e90fwfrvqy6x-t8.png" width="500"></a> </p><br><p>  Mereka juga sepenuhnya didokumentasikan dengan alat halaman manual dan file sampel.  File sampel (* _example.txt dalam bcc / tools) berisi tangkapan layar dengan penjelasan: misalnya, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">biolatency_example.txt</a> .  Saya menulis banyak dari mereka (halaman manual dan alat) yang terlihat seperti 50 posting blog tambahan, Anda akan menemukannya di repositori bcc. </p><br><p>  Apa yang hilang adalah contoh produksi nyata.  Saya menulis dokumentasi ini ketika eBPF sangat baru sehingga hanya tersedia di lingkungan pengujian kami, jadi sebagian besar contoh adalah buatan.  Seiring waktu, kami akan menambahkan contoh dunia nyata.  Di sinilah pemula dapat membantu: jika Anda memecahkan masalah, pertimbangkan untuk menulis artikel dan berbagi tangkapan layar atau menambahkannya sebagai file contoh. </p><br><h1>  Untuk berpengalaman </h1><br><p>  Pada titik ini, Anda harus sudah menjalankan bcc dan mencoba alat-alat ini, serta tertarik untuk memodifikasi mereka dan menulis alat Anda sendiri.  Cara terbaik adalah meningkatkan ke bpftrace, yang berisi bahasa tingkat tinggi yang <em>lebih</em> mudah dipelajari.  Kelemahannya adalah tidak sefleksibel bcc, jadi Anda mungkin mengalami batasan dan ingin kembali ke bcc. </p><br><p>  Lihat <a href="">instruksi instalasi bpftrace</a> .  Ini adalah proyek yang lebih baru, jadi pada saat penulisan ini, paket belum dikompilasi untuk semua sistem.  Di masa depan, seharusnya hanya apt-get install bpftrace atau yang serupa. </p><br><h2>  1. tutorial bpftrace </h2><br><p>  Saya mengembangkan tutorial yang mengajarkan cara menggunakan bpftrace melalui serangkaian baris tunggal: </p><br><ul><li>  <a href="">Bpftrace tutorial dengan contoh baris tunggal</a> </li></ul><br><p>  Ada 12 pelajaran yang akan mengajarkan Anda bagaimana menggunakan bpftrace langkah demi langkah.  Berikut ini sebuah contoh: </p><br><blockquote>  # <b>bpftrace -e 'tracepoint: syscalls: sys_enter_open {printf ("% d% s \ n", pid, str (args-&gt; nama file));</b>  <b>} '</b> <pre> Melampirkan 1 probe ...
 181 / proc / cpuinfo
 181 / proc / stat
 1461 / proc / net / dev
 1461 / proc / net / if_inet6
 ^ C
</pre></blockquote><br><p>  Ia menggunakan panggilan sistem terbuka sebagai titik jejak untuk melacak PID dan membuka jalur file. </p><br><h2>  2. Panduan Referensi bpftrace </h2><br><p>  Untuk informasi lebih lanjut tentang bpftrace, saya menulis panduan yang berisi contoh sintaks, tes, dan perintah bawaan: </p><br><ul><li>  <a href="">Panduan referensi Bpftrace</a> </li></ul><br><p>  Ini demi singkatnya: Saya mencoba menempatkan judul, resume dan tangkapan layar pada satu halaman.  Saya pikir ini terlalu lama - jika Anda mencari sesuatu dan Anda perlu menggulir halaman beberapa kali. </p><br><h2>  3. bpftrace dalam contoh </h2><br><p>  Ada lebih dari 20 alat dalam repositori bpftrace yang dapat Anda lihat dengan contoh: </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Alat Bpftrace</a> </li></ul><br><p>  Sebagai contoh: </p><br><blockquote>  # <b>cat tools / biolatency.bt</b> <pre> [...]
 DIMULAI
 {
     printf ("Menelusuri blok perangkat I / O ... Tekan Ctrl-C untuk mengakhiri. \ n");
 }

 kprobe: blk_account_io_start
 {
     @mulai [arg0] = nsecs;
 }

 kprobe: blk_account_io_completion
 / @ start [arg0] /

 {
     @ usecs = hist ((nsecs - @start [arg0]) / 1000);
     delete (@start [arg0]);
 }
</pre></blockquote><br><p>  Seperti bcc, utilitas ini memiliki halaman manual dan file sampel.  Misalnya, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">biolatency_example.txt</a> . </p><br><h1>  Untuk lanjutan </h1><br><h2>  1. Kami mempelajari pengembangan bcc </h2><br><p>  Saya membuat dua panduan untuk membantu: </p><br><ul><li>  <a href="">Bcc tutorial untuk pengembang Python</a> </li><li>  <a href="">Panduan referensi Bcc</a> </li></ul><br><p>  Ada juga banyak contoh di bcc / tools / *. Py.  Alat Bcc terdiri dari dua bagian: kode BPF untuk kernel yang ditulis dalam C, dan alat tingkat ruang pengguna yang ditulis dalam Python (atau lua, atau C ++).  Pengembangan alat bcc cukup maju dan dapat mencakup beberapa komponen kecil dari kernel atau elemen aplikasi internal. </p><br><h2>  2. Partisipasi dalam pengembangan </h2><br><p>  Bantuan diterima dengan: </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">masalah bcc</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">masalah bpftrace</a> </li></ul><br><p>  Untuk bpftrace, saya membuat <a href="">panduan pengembangan internal bpftrace</a> .  Ini sulit ketika Anda memprogram dalam llvm IR, tetapi jika Anda siap menerima tantangan ... </p><br><p>  Ada juga inti dari eBPF (alias BPF): jika Anda melihat masalah bcc dan bpftrace, Anda akan melihat beberapa permintaan untuk perbaikan di sana.  Sebagai contoh, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">tag kernel di bpftrace</a> .  Juga lihat mailing <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">list netdev</a> untuk pengembangan kernel BPF terbaru yang ditambahkan ke net-next sebelum bergabung dengan garis utama Linux. </p><br><p>  Selain menulis kode, Anda juga dapat ikut serta dalam pengujian, membuat paket, blog, dan diskusi. </p><br><h1>  Kesimpulan </h1><br><p>  eBPF melakukan banyak hal berbeda.  Dalam posting ini, saya melihat penguasaan eBPF untuk penelusuran dan analisis kinerja.  Singkatnya: </p><br><ul><li>  Pemula: meluncurkan alat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">bcc</a> </li><li>  Berpengalaman: mengembangkan alat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">bpftrace</a> </li><li>  Advanced: mengembangkan alat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">bcc</a> , berkontribusi pada bcc dan bpftrace </li></ul><br><p>  Saya juga memiliki halaman terpisah tentang <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Alat Pelacakan eBPF</a></b> , yang mencakup semua ini secara lebih rinci.  Semoga beruntung </p><p></p><p></p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id435142/">https://habr.com/ru/post/id435142/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id435128/index.html">Pi-Sonos: hobi yang tidak terkendali</a></li>
<li><a href="../id435132/index.html">Pengembara: masalah dan solusi</a></li>
<li><a href="../id435134/index.html">Sederhanakan bekerja dengan database di Qt dengan QSqlRelationalTableModel</a></li>
<li><a href="../id435136/index.html">Sergey dan metode ilmiahnya</a></li>
<li><a href="../id435138/index.html">Bagaimana mengendalikan infrastruktur jaringan Anda. Bab Tiga Keamanan jaringan. Bagian satu</a></li>
<li><a href="../id435144/index.html">Pengantar Spring Boot: Membuat API REST Sederhana di Jawa</a></li>
<li><a href="../id435148/index.html">Server DHCP asli menggunakan bash</a></li>
<li><a href="../id435150/index.html">Uji Klinis di ambang pintu - Wawancara dengan Aubrey de Grey</a></li>
<li><a href="../id435152/index.html">Perselisihan paten antara Apple dan Qualcomm menyebabkan penghentian penjualan iPhone 7 dan 8 di Jerman</a></li>
<li><a href="../id435154/index.html">Memoar robot manusiawi, bab 9-12</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>