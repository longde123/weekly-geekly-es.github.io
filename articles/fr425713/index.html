<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üèí üòå üåÑ Int√©gration du moteur HTML dans une application Windows native - choix et architecture üçâ üëßüèæ üìÅ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Comment nous avons traduit le travail avec HTML dans 1C: Enterprise d'Internet Explorer vers WebKit 

 La possibilit√© d'afficher du HTML dans des form...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Int√©gration du moteur HTML dans une application Windows native - choix et architecture</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/1c/blog/425713/">  <b>Comment nous avons traduit le travail avec HTML dans 1C: Enterprise d'Internet Explorer vers WebKit</b> <br><br>  La possibilit√© d'afficher du HTML dans des formulaires 1C est apparue dans la plate-forme 1C: Enterprise en 2003, version 8.0.  Pour travailler avec HTML, la plate-forme a utilis√© le moteur de navigation Internet Explorer (1C: Enterprise fonctionnait √† l'√©poque uniquement sous Windows).  Le moteur de navigation a √©t√© utilis√© par la plateforme √† des fins utilitaires.  Par exemple, pour √©crire √† partir de z√©ro un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">√©l√©ment √†</a> part enti√®re pour √©diter du texte √† la Word - avec la possibilit√© de diff√©rentes solutions de couleurs et de polices, ins√©rer des images, etc.  - une t√¢che tr√®s difficile.  Et si vous utilisez HTML √† ces fins et utilisez le moteur de navigateur Internet comme outil d'affichage, la t√¢che est grandement simplifi√©e.  En outre, avec l'aide du moteur, un certain nombre d'autres m√©canismes (par exemple, l'affichage des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">informations d'aide</a> ) et des √©l√©ments (par exemple, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Scheduler</a> ) ont √©t√© mis en ≈ìuvre. <br><br>  Eh bien, la possibilit√© pour les d√©veloppeurs d'applications d'afficher en utilisant la conception personnalis√©e HTML selon les normes du monde des syst√®mes comptables a parfois permis d'apporter une vari√©t√© de points forts agr√©ables √† l'interface des applications commerciales. <br><br>  Au fil du temps, la plate-forme a commenc√© √† prendre en charge d'abord Linux, puis macOS.  Internet Explorer n'√©tait pas adapt√© pour travailler avec HTML dans ces syst√®mes d'exploitation pour des raisons √©videntes;  sous Linux, nous avons utilis√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">WebKitGTK +</a> , et sur macOs, une biblioth√®que bas√©e sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Cocoa</a> .  Ainsi, l'unit√© de la base de code pour les diff√©rents syst√®mes d'exploitation (que nous essayons de maintenir pour le code client au niveau de 95%) a √©t√© viol√©e dans ce domaine.  Eh bien, le moteur IE √† ce stade est devenu la source d'un certain nombre de probl√®mes. <br><img src="https://habrastorage.org/webt/xo/c6/2k/xoc62k11ifqv9dfeunr279csd4q.png" alt="image"><br><a name="habracut"></a><br>  Les probl√®mes: <br><br><ul><li>  Le moteur IE a un code source ferm√© - cela signifie: <br><ul><li>  Un ajustement flexible du moteur aux besoins de la plate-forme n'est pas possible </li><li>  D√©bogage et compr√©hension des processus √† l'int√©rieur </li><li>  Impossible de corriger les bogues et les erreurs en mettant √† jour la version du moteur </li></ul></li><li>  Le moteur n'est pas adapt√© √† la mise en ≈ìuvre de t√¢ches de programmation Web modernes </li><li>  Probl√®mes de performances sur les machines faibles </li></ul><br>  Ainsi, la traduction de travailler avec HTML dans la version 1C: Enterprise pour Windows du moteur IE √† quelque chose d'autre √©tait √©vidente.  Que choisir? <br><br>  Pour commencer, nous avons formul√© les exigences pour le moteur: <br><br><ul><li>  Prise en charge des technologies de programmation Web modernes </li><li> Open source pour une personnalisation flexible du moteur et la compr√©hension de sa logique </li><li>  Haute performance sur les ordinateurs plus lents </li><li>  Il est souhaitable que le moteur n√©cessite un petit nombre de biblioth√®ques tierces pour fonctionner </li></ul><br><h2>  S√©lection du moteur </h2><br>  De quoi choisir?  Nous avons bien s√ªr commenc√© avec <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">WebKit</a> , avec lequel nous travaillions d√©j√† dans des versions de la plateforme pour Linux et macOS. <br><br>  WebKit a √©t√© d√©velopp√© chez Apple au d√©but des ann√©es 2000 sur la base des moteurs open source <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">KHTML</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">KJS</a> .  Bas√© sur WebKit, le navigateur Safari a √©t√© cr√©√©, plus tard - Chrome (encore plus tard, Chrome est pass√© de WebKit √† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Blink</a> , qui est √† nouveau bas√© sur le code WebCore de WebKit). <br><br>  Le code source de WebKit est open source et sous licence <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">LGPL</a> .  WebKit est √©crit pour macOS, il existe plusieurs ports pour Windows: <br><br><h3>  WebKit AppleWin </h3><br>  Il s'agit du port que les d√©veloppeurs WebKit sugg√®rent de cr√©er sous Windows par d√©faut.  Il a √©t√© fabriqu√© par des employ√©s d'Apple du milieu √† la fin des ann√©es 2000.  Il utilise la biblioth√®que graphique <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">CoreGraphics</a> , qui est une version simplifi√©e de la biblioth√®que pour macOS, port√©e sur Windows.  Pour ex√©cuter JavaScript, le port utilise la biblioth√®que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">JavaScriptCore</a> avec la m√™me API que celle utilis√©e dans l'impl√©mentation de la plate-forme pour Linux.  Cela en fait un candidat de choix pour l'utilisation. <br><br><h3>  WebKit WinCairo </h3><br>  Ce port utilise la biblioth√®que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Cairo</a> pour les graphiques.  Depuis un certain temps, Apple d√©veloppe activement ce port en tant qu'analogue du port principal AppleWin.  L'avantage de ce port est qu'il d√©pend moins des biblioth√®ques sp√©cifiques √† macOS dont CoreGraphics a besoin.  De plus, le port utilise la m√™me biblioth√®que de graphiques ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Cairo</a> ) que le moteur WebKitGTK +, que nous utilisons dans l'impl√©mentation Linux de la plate-forme, ce qui est bon pour standardiser le comportement de notre code. <br><br><h3>  QtWebKit </h3><br>  Une autre impl√©mentation du moteur WebKit pour Windows, d√©sormais ind√©pendante des d√©veloppeurs du moteur lui-m√™me.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Qt</a> est une biblioth√®que multiplateforme populaire avec sa propre biblioth√®que graphique QtGui.  Ce port utilise √©galement la biblioth√®que JavaScriptCore pour g√©rer JavaScript, mais il pr√©sente des inconv√©nients: <br><br><ul><li>  Forte d√©pendance √† l'√©gard des principaux composants de Qt, qui, s'ils sont utilis√©s dans des logiciels tiers, devront √™tre livr√©s avec lui </li><li>  Un ensemble d'interfaces diff√©rent pour travailler avec des composants pour le rendu HTML par rapport √† WebKitGTK et sa propre logique pour travailler avec eux. </li></ul><br><h3>  WebKitGtk + pour Windows </h3><br>  Nous avons d√©j√† utilis√© WebKitGtk + dans la version Linux de la plateforme.  Mais l'option de l'utiliser dans Windows a √©t√© exclue en raison de la complexit√© de l'assemblage, de la mauvaise documentation de ce processus et du manque de prise en charge constante de cette zone de d√©veloppement par les d√©veloppeurs de WebKitGTK +. <br><br><h3>  Chrome (Clignotement) </h3><br>  Le premier et le seul moteur non WebKit, qui a √©t√© consid√©r√© comme un candidat pour r√©soudre le probl√®me.  Il a √©t√© rejet√© en raison de grandes diff√©rences dans la logique des composants de rendu HTML par rapport √† WebKitGTK + et √† une autre biblioth√®que pour travailler avec JavaScript ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V8</a> ). <br><br><h3>  Que choisir? </h3><br>  Apr√®s des recherches, AppleWin et WinCairo ont atteint la finale. <br>  Pour faire le choix final, nous avons √©tudi√© le fonctionnement de WebKit. <br><br><h2>  Structure du moteur WebKit </h2><br>  En r√®gle g√©n√©rale, diff√©rents ports WebKit diff√®rent de deux mani√®res.  Le premier est directement l'impl√©mentation d'un syst√®me d'exploitation particulier √† l'aide de composants sp√©cifiques au syst√®me d'exploitation.  Le second est une biblioth√®que graphique.  La figure ci-dessous d√©crit les diff√©rences en ce sens entre les ports WebKit.  Pour Windows, les d√©veloppeurs WebKit ont √©crit des ports sur la biblioth√®que CoreGraphics et Cairo adapt√©e. <br><br><img src="https://habrastorage.org/webt/y5/m5/mo/y5m5moefn2yjpbt4ohq9iwqqqj4.png" alt="image"><br><br>  Un mod√®le simplifi√© du moteur: trois m√©canismes traditionnels de formatage d'une page Web - HTML, JavaScript et CSS - sont aliment√©s par le moteur, et il forme et affiche la page √† partir d'eux: <br><br><img src="https://habrastorage.org/webt/j4/2n/r5/j42nr5vmxoryxsbq-c_mxe9oots.png" alt="image"><br><br>  Le moteur lui-m√™me se compose de plusieurs composants: <br><br><ul><li>  WTF (Web Template Framework, pas ce que vous auriez pu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">penser</a> ): vous trouverez ici vos propres impl√©mentations de structures de donn√©es pour le fonctionnement du moteur, ainsi que le travail avec des flux </li><li>  JavaScriptCore: un composant, comme son nom l'indique, pour travailler avec le langage JavaScript </li><li>  WebCore: tout le travail avec DOM, les styles, l'analyse HTML et XML est √©crit ici.  Toute la ¬´magie¬ª principale du moteur se fait ici. </li><li>  Plateforme: effectue des actions techniques pour interagir avec le r√©seau, placer des donn√©es dans une base de donn√©es, d√©coder des images, travailler avec des m√©dias </li><li>  API WebKit et WebKit2 - reliant tous les composants et leur donnant acc√®s </li></ul><br><img src="https://habrastorage.org/webt/ao/zr/gp/aozrgpbezfy8ex2ufhbnrzqf68e.png" alt="image"><br>  La relation entre les composants WebKit et les fonctionnalit√©s sp√©cifiques au syst√®me d'exploitation est illustr√©e dans la figure ci-dessous.  Comme vous pouvez le voir, il existe un certain nombre de points sp√©cifiques qui doivent √™tre mis en ≈ìuvre s√©par√©ment pour chaque syst√®me d'exploitation.  Bien que JavaScriptCore vous permette de vous utiliser dans chaque port sans impl√©mentations distinctes. <br><br><img src="https://habrastorage.org/webt/r7/hz/c8/r7hzc8sbq6bcn_qpltvdzpimugu.png" alt="image"><br><br><h3>  Comment une page Web est form√©e </h3><br>  Depuis le r√©seau, une r√©ponse vient √† une requ√™te au serveur avec des donn√©es √† t√©l√©charger.  Le chargeur transmet les donn√©es √† l'analyseur qui, en interagissant avec le composant pour JavaScript, forme le DOM et la feuille de style.  Ensuite, les donn√©es g√©n√©r√©es sont transf√©r√©es dans l'arborescence de rendu et affich√©es dans un contexte graphique. <br><img src="https://habrastorage.org/webt/k-/id/dh/k-iddhrnyvvcw8yzacaigtetlai.png" alt="image"><br>  La page elle-m√™me comprend √©galement des composants individuels.  Le composant WebCore impl√©mente la classe Page, qui permet d'acc√©der √† la page enti√®re.  La page a un cadre principal - MainFrame, un cadre a toujours un document.  Le cadre principal peut avoir un nombre quelconque d'autres cadres, avec √©galement des documents √† l'int√©rieur.  Pour chaque image, certains √©v√©nements sont form√©s s√©par√©ment, ainsi que des contextes graphiques et JavaScript sp√©cifiques. <br><br><img src="https://habrastorage.org/webt/zv/fo/9c/zvfo9cqiclfhckd1wmzpnnv4jx4.png" alt="image"><br><br>  L'analyseur HTML simplifi√© fonctionne comme ceci.  √Ä partir de l'ensemble d'octets re√ßus du serveur, le d√©codeur g√©n√®re un ensemble de caract√®res pour l'analyse.  Les symboles sont convertis en jetons ou jetons, qui sont g√©n√©ralement des √©l√©ments √©l√©mentaires de code avec des m√©ta-informations sur le type de texte qu'il est, qu'il fasse partie de la syntaxe ou du contenu du langage.  Ensuite, les n≈ìuds sont form√©s √† partir de jetons pour construire une arborescence DOM.  Un constructeur d'arborescence √† partir d'un ensemble de n≈ìuds forme un mod√®le d'objet complet pour un document de page Web. <br><br><img src="https://habrastorage.org/webt/iq/9q/b5/iq9qb5qwciws_d-rfzze2afuopw.png" alt="image"><br><br><h2>  Choix final </h2><br><ul><li>  Applewin <ul><li>  Avantages: <ul><li>  Impl√©ment√© sur une biblioth√®que graphique qui s'ex√©cute sur macOS - la principale plate-forme cible pour les d√©veloppeurs WebKit </li></ul></li><li>  Inconv√©nients: <ul><li>  Absence de mise en ≈ìuvre du m√©canisme d'impression </li><li>  Un grand nombre de d√©pendances </li></ul></li></ul></li><li>  Wincairo <ul><li>  Avantages: <ul><li>  La m√™me biblioth√®que graphique (Le Caire), utilis√©e dans le port Linux de la plate-forme 1C </li></ul></li><li>  Inconv√©nients: <ul><li>  Essentiel pour nos t√¢ches introuvable </li></ul></li></ul></li></ul><br>  Vaincu WinCairo.  Pour le d√©veloppement, la derni√®re version de WebKit disponible √† l'√©poque a √©t√© prise - 605.1.11. <br><br><h2>  Impl√©mentation </h2><br>  Bien que le moteur soit assez bien couvert par les tests unitaires (environ 30 000 pour tous les composants du moteur, √©crits par les auteurs du moteur), il existe des erreurs et des lacunes dans les impl√©mentations pour les OS ¬´non principaux¬ª (c'est-√†-dire pour tout ce qui n'est pas macOS).  Ces lacunes d'impl√©mentation ont √©t√© progressivement d√©couvertes au fur et √† mesure que le moteur √©tait d√©velopp√© et test√© dans le cadre de la plateforme 1C: Enterprise. <br><br><h3>  T√©l√©charger HTML via Drag &amp; Drop </h3><br>  Lors du glissement du texte dans la fen√™tre, il a √©t√© constat√© que si le texte gliss√© contient des caract√®res non ASCII, des hi√©roglyphes sont ins√©r√©s dans le document final.  L'erreur est apparue uniquement dans l'impl√©mentation Windows du moteur, car elle fonctionnait avec un m√©canisme sp√©cifique au syst√®me d'exploitation pour faire glisser et d√©poser des √©l√©ments.  Il s'av√®re que le texte n'a pas √©t√© d√©cod√© d'UNICODE en UTF-16 avant d'√™tre transmis au gestionnaire d'√©v√©nement d'insertion. <br><br><h3>  Modifier Maj + Entrer le comportement du clavier </h3><br>  Dans la plupart des √©diteurs de texte (y compris Microsoft Word), cette combinaison ins√®re un saut de ligne.  Le comportement standard de WebKit consiste √† ins√©rer un nouveau paragraphe (comme si vous appuyiez simplement sur Entr√©e).  Nous avons chang√© le moteur, rendant le comportement plus familier aux utilisateurs. <br><br><h3>  Organisation du m√©canisme d'annulation et de r√©tablissement. </h3><br>  WebKit fournit une API pour impl√©menter son propre m√©canisme d'annulation et de r√©p√©tition des actions utilisateur.  Son sch√©ma est le suivant: lorsque l'utilisateur effectue une certaine action discr√®te du point de vue du moteur (par exemple, basculement vers un nouveau paragraphe, mise en forme en italique, collage), WebKit en informe le d√©veloppeur √† l'aide de l'API afin qu'il puisse enregistrer cette action. <br><br>  Lors du test du m√©canisme impl√©ment√©, une chose d√©sagr√©able a √©t√© d√©couverte: le moteur ne signale pas de changements dans la structure des tables.  Des commandes d'ajout et de suppression de cellules et de modification de l'attribut colSpan ont √©t√© ajout√©es, qui sont devenues partie int√©grante des actions composites, telles que, par exemple, l'ajout / la suppression d'une colonne ou d'une ligne dans un tableau.  Ces commandes composites sont enregistr√©es dans la m√™me pile d'annulation et de r√©tablissement et, conjointement avec les commandes du moteur, assurent le bon fonctionnement du m√©canisme. <br><br><h3>  Coller depuis Excel </h3><br>  Ceux qui ont travaill√© avec le presse-papiers Windows et Excel peuvent savoir que, premi√®rement, lors de la copie d'Excel vers HTML, le format du presse-papiers dans le fragment copi√© contient uniquement les balises des cellules et des lignes, mais pas la balise du tableau lui-m√™me, et deuxi√®mement, les styles d'un document Excel ne sont pas transf√©r√©s vers les cellules.  Pour cette raison, l'insertion, par exemple, d'une table des couleurs dans un √©l√©ment modifiable dans Chrome ressemble √† ceci: <br><br>  Original: <br><br><img src="https://habrastorage.org/webt/gp/qu/fd/gpqufdcqtefrrio5zechwq0ufus.png" alt="image"><br><br>  Dans Chrome: <br><br><img src="https://habrastorage.org/webt/gf/6y/uu/gf6yuuqrxmu8il-7bgoeql7xtwy.png" alt="image"><br><br>  Ces deux facteurs n'ont pas √©t√© pris en compte par les d√©veloppeurs de WebKit.  L'ouverture du code moteur nous a permis d'affiner le m√©canisme d'insertion, et maintenant le fragment du tableau ins√©r√© dans le champ HTML du Document est proche de l'original: <br><br><img src="https://habrastorage.org/webt/l8/pi/bo/l8piboap1-odjv6iwb2jd4zdhim.png" alt="image"><br><br><h3>  G√©n√©ration de polices italiques </h3><br>  Si Windows n'a pas de version italique d'une police non standard, la plupart des √©diteurs de texte peuvent g√©n√©rer une telle police √† l'aide de sa version standard.  Cependant, WebKit n'a pas pu le faire et a induit les d√©veloppeurs en erreur √† plusieurs reprises: comment se fait-il que dans le code HTML du document, nous ayons mis le texte dans la balise &lt;i&gt;, mais malgr√© cela, le texte est rest√© droit.  La raison en est que le moteur WebKit s√©lectionne la police souhait√©e dans le port WinCairo que nous utilisons - s'il n'y a pas de version italique, le moteur utilise la version r√©guli√®re.  Ce comportement a √©t√© remplac√© par l'utilisation de la police italique g√©n√©r√©e par la biblioth√®que graphique Cairo. <br><br><h3>  Erreurs de d√©codage d'images et d'animations </h3><br>  Des erreurs dans le comportement du moteur lors de l'utilisation d'√©l√©ments graphiques ont √©t√© trouv√©es.  Lors du chargement de certaines images au format PNG, une distorsion de l'image a √©t√© observ√©e, et parfois son absence du tout.  Il n'a pas √©t√© possible de trouver la raison de ce comportement, car une erreur se produit lors du d√©codage des images dans les entrailles de la biblioth√®que libpng. <br><br>  Empiriquement, il a √©t√© constat√© que lors de la liaison de la biblioth√®que libpng de mani√®re dynamique au lieu d'une biblioth√®que statique, le probl√®me est r√©solu.  Par ailleurs, dans la version actuelle du moteur, la liaison est effectu√©e de cette mani√®re.  Il a √©t√© d√©cid√© de faire de m√™me. <br><br>  Un autre probl√®me √©tait le moteur lors du chargement des animations au format GIF.  L'erreur a √©t√© p√©riodiquement reproduite lors du chargement de la page avec de telles animations et a conduit au crash du programme.  L'erreur a √©t√© caus√©e par le manque de synchronisation lors de l'utilisation du tampon dans lequel la prochaine image de l'animation est plac√©e.  Le probl√®me a √©t√© r√©solu √† l'aide des outils de synchronisation WebKit internes. <br><br><h3>  Support orthographique </h3><br>  Dans l'assembly avec Internet Explorer, dans Windows version 8 et versions ult√©rieures, la v√©rification orthographique peut √™tre activ√©e pour le champ HTML modifiable.  Pour ce faire, il suffisait d'attribuer "v√©rification orthographique" √©gal √† "vrai".  WebKit avait diff√©rentes solutions pour diff√©rents ports: sous Linux c'est la biblioth√®que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Enchant</a> , sur macOS il a son propre m√©canisme, familier √† tous les utilisateurs des produits Apple.  Mais pour Windows, il n'y a pas d'impl√©mentation, mais une API est fournie pour sa propre solution.  Nous avons utilis√© l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">API de v√©rification orthographique de Windows</a> , disponible √† partir de Windows 8, et mis en ≈ìuvre un m√©canisme similaire √† la g√©n√©ration avec Internet Explorer.  Soit dit en passant, maintenant dans un document format√© dans les clients natifs 1C: Enterprise, cette fonctionnalit√© fonctionne √©galement.  Avant la version 8.3.14, il √©tait d√©sactiv√© en raison des performances m√©diocres d'Internet Explorer. <br><br><h3>  Prise en charge de Windows XP </h3><br>  Certains de nos clients fonctionnent toujours sous Windows XP et ne mettront pas √† niveau le syst√®me d'exploitation dans un avenir proche.  Triste pour nous en tant que d√©veloppeurs, mais vrai.  Donc - nous devons les soutenir.  Et ici, nous avons eu une surprise d√©sagr√©able: les d√©veloppeurs de WebKit depuis environ un an n'ont pas pris en charge le moteur dans WinXP.  Une tentative de g√©n√©ration d'une version du moteur avec un ensemble d'outils de g√©n√©ration pour WinXP a √©chou√© - les d√©veloppeurs WebKit utilisent des biblioth√®ques disponibles uniquement avec les versions de Windows Vista et versions ult√©rieures. <br><br>  Que faire  Les options √©taient les suivantes: <br><br><ol><li>  Quittez l'impl√©mentation de WinXP avec le moteur Internet Explorer et utilisez WebKit dans les anciennes versions de Windows </li><li>  Prenez pour le d√©veloppement une version ant√©rieure du moteur WebKit, qui fonctionne dans WinXP, et utilisez cette version dans tous les OS </li><li>  Utilisez la version appropri√©e de WebKit dans WinXP et utilisez le dernier moteur dans les anciennes versions de Windows </li><li>  Portez vous-m√™me la version actuelle du moteur sur WinXP et utilisez-la partout </li></ol><br>  La question n'√©tait pas simple.  La premi√®re option vous permettait d'utiliser la derni√®re version du moteur WebKit, mais vous obligerait √† renvoyer l'ancienne impl√©mentation avec Internet Explorer.  Dans une telle solution, il serait difficile d'assurer un fonctionnement sans erreur du programme et le code lui-m√™me serait tr√®s compliqu√©.  La deuxi√®me option a fourni le m√™me comportement sur tous les syst√®mes d'exploitation Windows, cependant, elle ne nous laisserait pas la possibilit√© de d√©veloppement - la mise √† jour du moteur pour corriger les erreurs et obtenir de nouvelles fonctionnalit√©s des d√©veloppeurs du moteur dans les versions ult√©rieures.  La troisi√®me option vous permettait d'utiliser la version actuelle du moteur dans les anciennes versions de Windows, mais compliquait consid√©rablement la logique d'installation et garantissait le m√™me comportement de version dans tous les syst√®mes d'exploitation.  La quatri√®me option semble pr√©f√©rable √† toutes les autres, mais il est impossible de pr√©voir la complexit√© et, en g√©n√©ral, la possibilit√© d'une telle solution. <br><br>  N√©anmoins, nous avons d√©cid√© de tenter notre chance et de mettre en ≈ìuvre la quatri√®me option, la plus correcte d'un point de vue architectural (en utilisant un code source de moteur unique sur toutes les versions de Windows).  La version port√©e de WebKit fonctionne diff√©remment dans WinXP et les versions plus r√©centes de Windows: <br><br><ul><li>  J'ai d√ª abandonner les outils du nouveau DirectX (d3d11) au profit de l'ancien DirectX9 (d3d9) et adapter ses fichiers d'en-t√™te √† la version plus r√©cente du SDK. </li><li>  Les fonctions du nouveau SDK, lorsqu'elles sont ex√©cut√©es sur de nouvelles versions de Windows, sont appel√©es √† l'adresse (obtenue via <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">GetProcAddress</a> ). </li><li>  Pour transf√©rer des donn√©es entre les flux du moteur, WinXP utilise le stockage local Thread, dans les nouvelles versions - le stockage local Fibre. </li></ul><br><h2>  R√©sum√© </h2><br>  Donc, maintenant dans notre plateforme 1C: Enterprise √† partir de la version 8.3.14 (version - fin 2018), le HTML sera pris en charge au plus haut niveau - HTML5, OpenGL, etc.  Tant la quantit√© que la qualit√© des raisins secs pouvant √™tre amen√©s √† prendre des d√©cisions sur notre plateforme ne sont limit√©es que par l'imagination du d√©veloppeur.  Et pourtant, bien s√ªr, le syst√®me d'exploitation du client - sur WinXP, de nombreux petits pains HTML5 savoureux ne fonctionneront pas, pour des raisons √©videntes. <br><br>  D√©sormais, sur les applications Windows, la plateforme 1C: Enterprise pourra montrer ceci: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/zL6beG-cNEI" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br>  Mais, en utilisant les ¬´goodies¬ª du HTML dans les solutions d'application, n'oubliez pas le bon sens.  L'utilisation de HTML est appropri√©e et recommand√©e pour des t√¢ches sp√©cialis√©es (affichage d'aide, techniques, descriptions de produits, ...), mais pas pour la mise en ≈ìuvre de t√¢ches de logique m√©tier (entr√©e / sortie d'informations structur√©es).  Pour ce faire, vous devez utiliser les m√©canismes d'interface 1C: Enterprise standard qui fournissent une prise en charge automatique des droits d'acc√®s, la gestion des fonctionnalit√©s, l'adaptation au facteur de forme de l'appareil, la prise en charge des param√®tres utilisateur et le travail de nombreux autres m√©canismes, sans lesquels le fonctionnement √† part enti√®re d'une application m√©tier devient presque impossible. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr425713/">https://habr.com/ru/post/fr425713/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr425703/index.html">Kafka √† Wargaming: Blitz</a></li>
<li><a href="../fr425705/index.html">R√©plication de Percona Server pour MySQL vers PostgreSQL √† l'aide de l'outil pg_chameleon</a></li>
<li><a href="../fr425707/index.html">Syst√®me de notification de la console au t√©l√©gramme</a></li>
<li><a href="../fr425709/index.html">Nous avons fait un m√©mo pour les Chinois qui sont venus chez vous</a></li>
<li><a href="../fr425711/index.html">Perte de ligne non adapt√©e</a></li>
<li><a href="../fr425715/index.html">Programme p√©dagogique en chimie: inversion acide des microcircuits (comment exposer un cristal d'un microcircuit pour sa photographie ult√©rieure)</a></li>
<li><a href="../fr425717/index.html">R√©seau de neurones pour les d√©veloppeurs C ++</a></li>
<li><a href="../fr425719/index.html">Le c√©leri dans les projets charg√©s: un peu de pratique</a></li>
<li><a href="../fr425723/index.html">Facebook d√©veloppe activement un service de recherche d'emploi et d'embauche d'employ√©s sur un r√©seau social</a></li>
<li><a href="../fr425725/index.html">√âtui pour brevets Nintendo - Game Boy</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>