<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ÜôÔ∏è üí≥ üå± Sberbank ou l√° e volta üéóÔ∏è üì§ üîÅ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="CAP√çTULO 1. Convidados inesperados 
 Tudo come√ßou naquela manh√£ infeliz, quando o Gerente do Projeto anunciou que os prazos de implementa√ß√£o do projet...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Sberbank ou l√° e volta</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/451188/"><img src="https://habrastorage.org/webt/si/bq/2u/sibq2unjy0i1yoy_7sa0qljphae.jpeg"><br><br><h2>  CAP√çTULO 1. Convidados inesperados </h2><br>  Tudo come√ßou naquela manh√£ infeliz, quando o Gerente do Projeto anunciou que os prazos de implementa√ß√£o do projeto deveriam ser r√°pida e decisivamente reduzidos em um m√™s.  Mais precisamente, o projeto deve estar pronto em 4 dias.  N√£o, nosso PO n√£o √© um animal, e nem parece uma <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">coruja</a> (talvez um pouco como um corvo), apenas aconteceu.  Bem, se for necess√°rio, √© necess√°rio, especialmente porque a equipe (e eu sou a desenvolvedora l√≠der da equipe "C") recebeu algo saboroso.  O rel√≥gio e o calend√°rio eram quinta-feira, 11:00, na segunda-feira, o projeto deveria estar pronto. <br><br>  Para come√ßar, o que estamos fazendo?  Estamos envolvidos na automa√ß√£o de cinemas - controle autom√°tico e remoto de equipamentos, automa√ß√£o de exibi√ß√£o de filmes, monitoramento, pain√©is de v√≠deo e agora tamb√©m terminais para a venda de ingressos e bares.  Especificamente, o √∫ltimo par√°grafo √© dedicado a este artigo. <br><a name="habracut"></a><br>  O projeto em si, que tinha que ser conclu√≠do antes de segunda-feira, √© um tipo de camada entre o servidor principal na Scala e o terminal de pagamento em ferro VeriFone VX 820 (na verdade, existem mais terminais, mas apenas como exemplo).  √â claro que ningu√©m nos dar√° transa√ß√µes dessa maneira, portanto, os utilit√°rios e bibliotecas do Sberbank / Arcus e UCS s√£o usados.  Assim, o esquema de trabalho deve ser o seguinte: <br><br><img src="https://habrastorage.org/webt/ak/k4/do/akk4do9scie61w_tobeuwpk6liu.png"><br><br>  Externamente, fica assim: <br><br><img src="https://habrastorage.org/webt/oh/ul/ts/ohultstzocyw8za06mbxqwmnrma.jpeg"><br><br>  Al√©m disso, esse subsistema deve ser usado em caixas registradoras padr√£o que todos viram em qualquer cinema nos caixas. <br><br>  De acordo com a tradi√ß√£o interna, chamamos cada projeto de nossa equipe de um nome da mitologia n√≥rdica antiga, para esse subsistema o nome Gefjon foi escolhido - o nome da deusa da fertilidade e fertilidade (um bom nome para um servidor de pagamento, n√£o √©? Bem, a lenda sobre os touros que cortam a ilha se encaixa idealmente na arquitetura atual, interromper o trabalho com equipamentos de uma linguagem de alto n√≠vel). <br><br>  O formato das mensagens recebidas e enviadas √© um servidor HTTP com uma carga JSON.  Esse √© o compromisso ideal entre o Scala, que √© dif√≠cil de isolar dados bin√°rios dos fluxos de soquete e o C, que √© dif√≠cil de transferir objetos pela rede.  N√£o h√° muitas opera√ß√µes poss√≠veis que precisam ser operadas: pagamento, cancelamento, devolu√ß√£o, v√°rios tipos de relat√≥rios, abertura do menu de servi√ßo e ping.  Parece nada complicado.  Como existem tr√™s sistemas banc√°rios (e √© esperado um reabastecimento posterior da fam√≠lia), decidiu-se dividir o projeto em componentes: <br><br><img src="https://habrastorage.org/webt/rk/vm/sc/rkvmscw9ret9atfnts-nezxtaqg.png"><br><br>  Os blocos verdes s√£o os que precis√°vamos fazer, os azuis s√£o os que n√£o podem ser alterados e s√£o fornecidos pelo banco. <br><br>  Como os principais problemas surgiram apenas com o software do Sberbank, o artigo como um todo ser√° dedicado √†s armadilhas que contamos com nosso barco. <br><br><h2>  CAP√çTULO 2. Cordeiro assado </h2><br><img src="https://habrastorage.org/webt/zr/-d/ez/zr-dez83p56hekuceyiiqka2rdi.jpeg"><br>  (foto: heaclub.ru) <br><br>  ... parece algo assim.  O c√≥digo desse prot√≥tipo, que foi escrito h√° v√°rios meses para deixar claro para todas as pessoas de n√≠vel superior que podemos trabalhar com aplicativos banc√°rios, parecia o mesmo. <br><br><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">char</span></span> buf[BUF_KB * <span class="hljs-number"><span class="hljs-number">2</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> * null; <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> * grep; <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifdef</span></span></span><span class="hljs-meta"> _WIN32_WINNT char * ptr; null = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"nul"</span></span></span><span class="hljs-meta">; grep = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"findstr"</span></span></span><span class="hljs-meta">; #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">else</span></span></span><span class="hljs-meta"> null = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"/dev/null"</span></span></span><span class="hljs-meta">; grep = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"grep"</span></span></span><span class="hljs-meta">; #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> sprintf(buf, </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"%s %"</span></span></span><span class="hljs-meta">PRIi32</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"= %sops.ini &gt;%s 2&gt;%s || "</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"echo %"</span></span></span><span class="hljs-meta">PRIi32</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"=9,6,PINPAD_TEST &gt;&gt; %sops.ini"</span></span></span><span class="hljs-meta">, grep, TERM_ARCUS_TEST_PINPAD, TERM_PATH, null, null, TERM_ARCUS_TEST_PINPAD, TERM_PATH); #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifdef</span></span></span><span class="hljs-meta"> _WIN32_WINNT ptr = buf; while (*ptr) { </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (*ptr == </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">'/'</span></span></span><span class="hljs-meta">) *ptr = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">'\\'</span></span></span><span class="hljs-meta">; ptr++; } #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span></span></code> </pre> <br>  √â claro que isso n√£o era adequado para a vers√£o de produ√ß√£o, por isso era essencialmente necess√°rio escrever tudo de novo. <br><br>  Cada banco que fornece bibliotecas para trabalhar com o terminal geralmente oferece duas op√ß√µes de conex√£o: atrav√©s das fun√ß√µes da biblioteca (.so / .dll) ou atrav√©s de um utilit√°rio pronto que precisa passar apenas dois valores - o tipo de opera√ß√£o e a quantidade (quando necess√°rio).  Em teoria, nada complicado, apenas algo <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">char</span></span> buffer[<span class="hljs-number"><span class="hljs-number">100</span></span>]; <span class="hljs-built_in"><span class="hljs-built_in">sprintf</span></span>(buffer, <span class="hljs-string"><span class="hljs-string">"%d %d"</span></span>, atoi(argv[<span class="hljs-number"><span class="hljs-number">1</span></span>]), atoi(argv[<span class="hljs-number"><span class="hljs-number">2</span></span>])); system(buffer);</code> </pre> <br>  O resultado da opera√ß√£o ser√° colocado no arquivo "e" e a verifica√ß√£o no arquivo "p".  Envie esses arquivos para o stdout com convers√£o para JSON, para que o servidor HTTP os envie como carga √∫til sem pensar no que est√° l√°. <br><br>  Mas este artigo n√£o teria sido publicado se tudo tivesse sido t√£o simples. <br><br><h2>  CAP√çTULO 4. Do outro lado da montanha e embaixo da montanha </h2><br>  A vers√£o inicial da implementa√ß√£o foi uma chamada de aplicativo simples - o servidor HTTP chamou o wrapper necess√°rio com par√¢metros unificados (por exemplo, o relat√≥rio X √© 4) e o utilit√°rio, por exemplo, gfj_pilot, lan√ßou sb_pilot com o par√¢metro necess√°rio para esta opera√ß√£o (por exemplo, o relat√≥rio X √© 9) .  Em seguida, o utilit√°rio wrapper leu o resultado da opera√ß√£o no arquivo eletr√¥nico (por exemplo, 2000 - "pagamento recusado, repita a opera√ß√£o") e o converteu em um erro universal (por exemplo 3 - "Erro ao ler ou processar o cart√£o / conta, repita a opera√ß√£o").  Depois disso, o arquivo "p" foi convertido em base64 para evitar a quebra da formata√ß√£o e enviado junto com o resultado ao stdout como JSON. <br><br>  Tudo isso funcionou perfeitamente at√© que, em um belo momento, fomos informados de que ... <br><br>  ... isso n√£o funciona no Windows. <br><br><img src="https://habrastorage.org/webt/yp/44/t_/yp44t_qwokissyt75mayl71mcdm.jpeg"><br><br>  Bem, mais precisamente, o pr√≥prio Windows n√£o tem problemas (exceto que o slip √© gerado na codifica√ß√£o Cp-1251 e o console funciona no CP866).  O arquivo "e" simplesmente n√£o foi gerado.  Lan√ßou um utilit√°rio banc√°rio diretamente: <br><br><pre> <code class="plaintext hljs">C:\banks\sber\sb_pilot&gt;dir    C   .   : B401-6B9D   C:\banks\sber\sb_pilot 04.02.2019 12:28 &lt;DIR&gt; . 04.02.2019 12:28 &lt;DIR&gt; .. 31.01.2019 17:12 10 832 F12X24.BIN 31.01.2019 17:12 128 000 gate.dll 31.01.2019 17:12 72 192 loadparm.exe 31.01.2019 17:12 36 204 OPT0.R 31.01.2019 17:12 20 716 OPT1.R 31.01.2019 17:12 1 806 OPT3.R 31.01.2019 17:12 388 608 pilot_nt.dll 31.01.2019 23:06 463 pinpad.ini 31.01.2019 17:12 91 136 posScheduler.exe 31.01.2019 17:12 418 printers.ini 01.02.2019 16:51 91 646 sbkernel1902.log 31.01.2019 17:12 653 312 sbrf.dll 31.01.2019 17:12 840 192 SBRFCOM.dll 31.01.2019 17:12 3 142 656 sb_kernel.dll 01.02.2019 16:51 9 SESS.D 01.02.2019 16:51 715 SPLC.D 31.01.2019 17:12 72 192 upwin.exe 20  5 659 718  2  37 567 004 672   #    (1)  10  (1000 ) C:\banks\sber\sb_pilot&gt;loadparm.exe 1 1000 C:\banks\sber\sb_pilot&gt;dir    C   .   : B401-6B9D   C:\banks\sber\sb_pilot 04.02.2019 12:28 &lt;DIR&gt; . 04.02.2019 12:28 &lt;DIR&gt; .. 04.02.2019 12:28 216 commerr.log 31.01.2019 17:12 10 832 F12X24.BIN 31.01.2019 17:12 128 000 gate.dll 31.01.2019 17:12 72 192 loadparm.exe 31.01.2019 17:12 36 204 OPT0.R 31.01.2019 17:12 20 716 OPT1.R 31.01.2019 17:12 1 806 OPT3.R 01.02.2019 18:51 1 349 p 31.01.2019 17:12 388 608 pilot_nt.dll 31.01.2019 23:06 463 pinpad.ini 31.01.2019 17:12 91 136 posScheduler.exe 31.01.2019 17:12 418 printers.ini 04.02.2019 12:28 92 218 sbkernel1902.log 31.01.2019 17:12 653 312 sbrf.dll 31.01.2019 17:12 840 192 SBRFCOM.dll 31.01.2019 17:12 3 142 656 sb_kernel.dll 01.02.2019 16:51 9 SESS.D 01.02.2019 16:51 715 SPLC.D 31.01.2019 17:12 72 192 upwin.exe 19  5 659 029  2  37 567 008 768   C:\banks\sber\sb_pilot&gt;</code> </pre> <br>  De fato, n√£o h√° arquivo "e".  Pedra em dire√ß√£o a Sberbank # 1.  Estamos escrevendo uma carta para o Sberbank (subsequentemente recebemos uma resposta que deveria ser assim) e, como n√£o h√° tempo para correspond√™ncia e precisamos come√ßar agora, estamos procurando solu√ß√µes para obter o resultado. <br><br><pre> <code class="plaintext hljs">04.02 12:28:55 SBKRNL: Failed to open device \\.\COM1, err 2 04.02 12:28:56 SBKRNL: Failed to open device \\.\COM1, err 2 04.02 12:28:56 SBKRNL: Result = 0 04.02 12:28:56 GATE: unlock:'00000054' 04.02 12:28:56 GATE: lock:'00000054' 'UPOSWINMUTEX2' 04.02 12:28:56 GATE: unlock:'00000054' 04.02 12:28:56 LOADPARM: Unloading GATE.DLL... 04.02 12:28:56 GATE: SB_KERNEL.DLL is unloaded 04.02 12:28:56 LOADPARM: GATE.DLL unloaded</code> </pre> <br>  Sim, o resultado pode ser obtido no log sbkernel.log.  Inconvenientemente, al√©m disso, n√£o h√° hash de mapa para parafusar "obrigado" do Sberbank posteriormente.  N√£o √© bom <br><br>  Voc√™ precisar√° se conectar √† biblioteca pilot_nt.dll e importar fun√ß√µes dela.  Tudo ficaria bem, mas ... Uma pedra para o Sberbank # 2: n√£o existe essa biblioteca no Linux, voc√™ ter√° que criar dois aplicativos diferentes para plataformas diferentes - para linux, chame o utilit√°rio sb_pilot (analogue para loadparm.exe, a prop√≥sito, pedra # 3 para um nome de utilit√°rio diferente em plataformas diferentes) ), no Windows, conecte-se √† biblioteca pilot_nt.dll. <br><br><h2>  CAP√çTULO 5. Enigmas no escuro </h2><br>  √Äs 19:00 horas. <br><br>  O Sberbank √© uma grande empresa, a maioria das solu√ß√µes de software √© produzida de acordo com GOSTs e documentos formais.  Entramos no cat√°logo que o Sberbank fornece com as bibliotecas: <br><br><pre> <code class="plaintext hljs">Sberbank$ ls -l Docs  30160 drwx------ 2 alex alex 4096  17 19:31 FAQ -rw-rw-r-- 1 alex alex 3398465  9 2018   UPOS    ().docx -rw-rw-r-- 1 alex alex 1182078  9 2018   UPOS  .docx -rw-rw-r-- 1 alex alex 853504  9 2018   .doc drwx------ 3 alex alex 4096  31 17:11     -rw-rw-r-- 1 alex alex 5280787  9 2018    POS-.docx -rw-rw-r-- 1 alex alex 1149640  9 2018  .docx drwx------ 2 alex alex 4096  28 2018  UPOS drwx------ 2 alex alex 4096  28 2018    -rw-rw-r-- 1 alex alex 3451601  9 2018     ().docx -rw-rw-r-- 1 alex alex 1956196  9 2018   .docx -rw-rw-r-- 1 alex alex 1043161  9 2018       ()_().docx -rw-rw-r-- 1 alex alex 4348157  9 2018  POS-.docx -rw-rw-r-- 1 alex alex 3970267  9 2018   .docx drwx------ 3 alex alex 4096  28 2018   -rw-rw-r-- 1 alex alex 2644702  9 2018    POS-.docx drwx------ 2 alex alex 4096  28 2018   -rw-rw-r-- 1 alex alex 1558211  9 2018   .png</code> </pre> <br>  Muito bom, mas estamos interessados ‚Äã‚Äãapenas no diret√≥rio para desenvolvedores: <br><br><pre> <code class="plaintext hljs">Sberbank$ ls -l Docs/\ \ \ /  8704 -rw-rw-r-- 1 alex alex 47105  9 2018 1C.docx -rw-rw-r-- 1 alex alex 1824  9 2018 cardtype.h -rw-rw-r-- 1 alex alex 2590378  9 2018 cr_ttk_protocol_ru.rtf -rw-rw-r-- 1 alex alex 208  9 2018 deprtmnt.h -rw-rw-r-- 1 alex alex 16681  9 2018 errors.h drwx------ 6 alex alex 4096  28 2018 examples -rw-rw-r-- 1 alex alex 58575  9 2018 gate.h -rw-rw-r-- 1 alex alex 4218  9 2018 paramsln.h -rw-rw-r-- 1 alex alex 61693  9 2018 pilot_nt.h -rw-rw-r-- 1 alex alex 28160  9 2018 ReadTrack2.doc -rw-rw-r-- 1 alex alex 7417  9 2018 sbkernel.h -rw-rw-r-- 1 alex alex 144896  9 2018 sb_pilot.doc -rw-rw-r-- 1 alex alex 3525323  9 2018     ole- sbrf.dll.rtf -rw-rw-r-- 1 alex alex 46683  9 2018      gate.dll.chi -rw-rw-r-- 1 alex alex 255414  9 2018      gate.dll.chm -rw-rw-r-- 1 alex alex 814653  9 2018      gate.dll.pdf -rw-rw-r-- 1 alex alex 41618  9 2018      pilot_nt.chi -rw-rw-r-- 1 alex alex 241716  9 2018      pilot_nt.chm -rw-rw-r-- 1 alex alex 968753  9 2018      pilot_nt.pdf -rw-rw-r-- 1 alex alex 81  9 2018  .txt</code> </pre> <br>  Um monte de desperd√≠cio de papel, por precau√ß√£o, releia pilot_nt, com o qual aprendemos o seguinte: <br><blockquote>  Tabela 1. SO sb_pilot suportado. <br><div class="scrollable-table"><table><tbody><tr><th>  OS </th><th>  Capacidade </th><th>  Nome do m√≥dulo </th></tr><tr><td>  Windows </td><td>  32. </td><td>  sb_pilot.exe </td></tr><tr><td>  Linux </td><td>  32. </td><td>  sb_pilot </td></tr><tr><td>  Dos </td><td>  16 </td><td>  sb_pilot.exe </td></tr></tbody></table></div></blockquote><br>  Acontece que o utilit√°rio para Windows ainda deve ser chamado de sb_pilot.  Bem, uma pedra para o Sberbank # 4 pela inconsist√™ncia de sua pr√≥pria documenta√ß√£o. <br><blockquote>  Transfer√™ncia dos resultados do programa. <br><br>  No final do programa, dois arquivos de texto s√£o formados - o arquivo de troca e o arquivo de verifica√ß√£o. <br><br>  O primeiro √© nomeado e e destina-se a passar par√¢metros da opera√ß√£o perfeita para o programa de chamada.  A primeira linha deste arquivo cont√©m o c√≥digo do resultado da opera√ß√£o e um texto separado por v√≠rgula explicando a mensagem de texto.  C√≥digo 0 significa pagamento bem-sucedido, qualquer outro valor - recusa ou incapacidade de efetuar o pagamento. </blockquote><br><br><img src="https://habrastorage.org/webt/c8/7f/m2/c87fm26nwcdjtfol6m0vamuvk8e.jpeg"><br><br>  Pregui√ßosamente jogamos mais uma pedra e come√ßamos a estudar a documenta√ß√£o para conectar a biblioteca diretamente. <br><blockquote>  <b>O procedimento para chamar fun√ß√µes de biblioteca</b> <br><br>  Ao pagar (devolver) compras com cart√£o de cr√©dito, o programa de caixa deve chamar a fun√ß√£o card_authorize () da biblioteca Sberbank preenchendo os campos TType e Amount e especificando valores zero nos campos restantes.  No final da fun√ß√£o, voc√™ precisa analisar o campo RCode.  Se contiver o valor "0" ou "00", a autoriza√ß√£o ser√° considerada conclu√≠da com √™xito, caso contr√°rio ser√° rejeitada.  Al√©m disso, voc√™ deve verificar o valor do campo Verificar. <br><br>  Se n√£o for NULL, dever√° ser enviado para impress√£o (no modo n√£o fiscal) e, em seguida, <br>  exclua chamando a fun√ß√£o GlobalFree ().  Ao fechar um turno, o programa de caixa deve chamar a fun√ß√£o close_day () da biblioteca Sberbank preenchendo o campo TType = 7 e especificando valores zero nos campos restantes.  No final da fun√ß√£o, verifique o valor do campo Verificar. <br><br>  Se o campo Verificar n√£o for NULL, ele dever√° ser enviado para impress√£o (no modo n√£o fiscal) e exclu√≠do chamando a fun√ß√£o GlobaFree (). </blockquote>  Parece f√°cil, at√© um arquivo de cabe√ßalho √© fornecido.  Bem, conecte, compile e ... <br><br><pre> <code class="cpp hljs">$ cat main.c &amp;&amp; i686-w64-mingw32-gcc main.c -o main.a <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"pilot_nt.h"</span></span></span><span class="hljs-meta"> int main(void) { return 0; } In file included from main.c:1:0: pilot_nt.h:525:3: </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">error</span></span></span><span class="hljs-meta">: unknown type name </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">'auth_answer'</span></span></span><span class="hljs-meta"> auth_answer ans; </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/**&lt; [in, out]                            .   . ::auth_answer */</span></span></span><span class="hljs-meta"> ^ pilot_nt.h:544:3: </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">error</span></span></span><span class="hljs-meta">: unknown type name </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">'auth_answer'</span></span></span><span class="hljs-meta"> auth_answer ans; </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/**&lt; [in, out]                            .   . ::auth_answer */</span></span></span><span class="hljs-meta"> ^ pilot_nt.h:567:3: </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">error</span></span></span><span class="hljs-meta">: unknown type name </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">'auth_answer'</span></span></span><span class="hljs-meta"> auth_answer ans; </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/**&lt; [in, out]                            .   . ::auth_answer */</span></span></span><span class="hljs-meta"> ^ pilot_nt.h:590:3: </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">error</span></span></span><span class="hljs-meta">: unknown type name </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">'auth_answer'</span></span></span><span class="hljs-meta"> auth_answer ans; </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/**&lt; [in, out]                            .   . ::auth_answer */</span></span></span><span class="hljs-meta"> ^ pilot_nt.h:627:3: </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">error</span></span></span><span class="hljs-meta">: unknown type name </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">'auth_answer'</span></span></span><span class="hljs-meta"> auth_answer ans; </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/**&lt; [in, out]                            .   . ::auth_answer */</span></span></span><span class="hljs-meta"> ^ pilot_nt.h:668:3: </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">error</span></span></span><span class="hljs-meta">: unknown type name </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">'auth_answer'</span></span></span><span class="hljs-meta"> auth_answer ans; </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/**&lt; [in, out]                            .   . ::auth_answer */</span></span></span></span></code> </pre> <br>  Ummm ... o que?  Abra pilot_nt.h: <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifdef</span></span></span><span class="hljs-meta"> __cplusplus extern </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"C"</span></span></span><span class="hljs-meta">{ #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;...&gt; /** *    * ,         . */ struct auth_answer{ int TType; /**&lt; [in]  .  ::OpetationTypes */ unsigned long Amount; /**&lt; [in]    */ char RCode[3]; /**&lt; [out]    */ char AMessage[16]; /**&lt; [out]    */ int CType; /**&lt; [in,out]   */ char* Check; /**&lt; [out]  ,   GlobalFree    */ }; &lt;...&gt; struct auth_answer7{ auth_answer auth_answ; /**&lt; [in, out]   . . ::auth_answer */ &lt;---- THIS char AuthCode[MAX_AUTHCODE]; /**&lt; [out]  . 7 . */ char CardID [CARD_ID_LEN]; /**&lt; [out]  . 25 . */ int SberOwnCard; /**&lt; [out]     */ };</span></span></span></span></code> </pre> <br>  Imediatamente, sem olhar para a pedra para coment√°rios em russo na codifica√ß√£o CP1251. <br><br>  Bem, a pedra mais s√©ria: queridos desenvolvedores de C ++.  Se voc√™ escrever ‚ÄúC‚Äù externo, isso significa que o c√≥digo dentro do bloco deve ser compilado pelo compilador C.  Se voc√™ N√ÉO fez um `typedef` de uma estrutura, toda vez que voc√™ o menciona como refer√™ncia de tipo, deve escrever a palavra-chave` struct`. <br><br>  Corrija o arquivo para desenvolvedores, substituindo a palavra `struct` sempre que necess√°rio.  Link para a biblioteca `pilot_nt.dll`.  Vit√≥ria n√£o?  Lan√ßamos nosso aplicativo. <br><br><h2>  CAP√çTULO 6. Do Fogo √†s Chamas </h2><br>  Bem, voc√™ entendeu, certo?  O aplicativo apenas trava.  At√© o principal.  Medite, adicione o anal√≥gico NIH da fun√ß√£o errno para Windows: GetLastError (pedra # 3 para a Microsoft, os dois primeiros s√£o para codifica√ß√µes). <br><br><pre> <code class="plaintext hljs">C:\banks\sber\WIN&gt;sb_pilot.exe 1 1000 E: !g_sblibrary (0xc0000096)</code> </pre> <br>  0xc0000096?  GetLastError n√£o deve retornar um c√≥digo de erro adequado? <br><blockquote>  Para obter uma lista completa dos c√≥digos de erro fornecidos pelo sistema operacional, consulte C√≥digos de erro do sistema. </blockquote>  Sim, abra o artigo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> : <br><blockquote>  Os t√≥picos a seguir fornecem listas de c√≥digos de erro do sistema.  Esses valores s√£o definidos no arquivo de cabe√ßalho WinError.h. <br><br><ul><li>  C√≥digos de erro do sistema (0-499) (0x0-0x1f3) </li><li>  C√≥digos de erro do sistema (500-999) (0x1f4-0x3e7) </li><li>  C√≥digos de erro do sistema (1000-1299) (0x3e8-0x513) </li><li>  C√≥digos de erro do sistema (1300-1699) (0x514-0x6a3) </li><li>  C√≥digos de erro do sistema (1700-3999) (0x6a4-0xf9f) </li><li>  C√≥digos de erro do sistema (4000-5999) (0xfa0-0x176f) </li><li>  C√≥digos de erro do sistema (6000-8199) (0x1770-0x2007) </li><li>  C√≥digos de erro do sistema (8200-8999) (0x2008-0x2327) </li><li>  C√≥digos de erro do sistema (9000-11999) (0x2328-0x2edf) </li><li>  C√≥digos de erro do sistema (12000-15999) (0x2ee0-0x3e7f) </li></ul></blockquote>  Ok, obtivemos um erro n√£o documentado, jogamos uma pedra e abrimos o onisciente google: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">forum.vingrad.ru/forum/topic-346194/kw-dll-loadlibrary-%D0%BE%D1%82%D0%BB%D0%B0%D0%B4%D0%BA%D0%B0.html</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">bbs.csdn.net/topics/80078275</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">forums.codeguru.com/showthread.php?179566-0xC0000096-Privileged-Instruction</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">www.unknowncheats.me/forum/general-programming-and-reversing/97763-privileged-instruction-error.html</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">cboard.cprogramming.com/windows-programming/146130-prallel-port-programming.html</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">computer-programming-forum.com/82-mfc/dc2481c0ecead2f2.htm</a> </li></ul><br>  A ess√™ncia do erro √© que algumas sub-rotinas usam uma das instru√ß√µes <br><br><ul><li>  _inp () </li><li>  _inpw () </li><li>  _inpd () </li><li>  _outp () </li><li>  _outpw () </li><li>  _outpd () </li></ul><br>  O uso √© proibido nos n√∫cleos do NT, pois eles tentam trabalhar diretamente com a porta paralela.  Aparentemente, esse c√≥digo √© chamado no inicializador da biblioteca, ou seja,  a biblioteca na inicializa√ß√£o deseja pesquisar as portas em busca de dispositivos, mas o kernel do NT requer trabalho atrav√©s do driver. <br><br>  Situa√ß√£o sem esperan√ßa? <br><br><h2>  CAP√çTULO 8. Aranhas e moscas </h2><br>  22:00  Apenas no caso, surge a id√©ia de verificar se isso n√£o se deve ao fato de usarmos a compila√ß√£o cruzada com o Linux usando mingw.  Ao mesmo tempo, entendemos que o Sberbank oferece apenas um aplicativo de 32 bits, por isso n√£o funcionar√° com um aplicativo de 64 bits, tudo bem, mas ainda lan√ßaremos uma pedra no Sberbank para a vers√£o de 32 bits em 2019. <br><br>  <b>Dado</b> : instalado no virtualbox windows 7; <br>  <b>Necess√°rio</b> : Instale o Visual Studio e copie o MVP. <br><br>  Acessamos o site da Microsoft, baixamos o Visual Studio 2017. Tomamos a licen√ßa da comunidade, pois levamos para verifica√ß√£o, para os neg√≥cios, a licen√ßa ser√° comprada se ela decolar. <br>  Baixe algumas centenas de megabytes e ... <br><br>  Vimos que nossa vers√£o do sistema operacional (Windows 7) n√£o √© suportada. <br><br>  Ok, vamos a todos os tipos de sites obscenos, estamos procurando pelo Visual Studio 2008, baixamos algumas centenas de megabytes novamente e ... <br><br>  N√≥s obtemos o arquivo iso. <br><br>  Ok, vamos tentar instalar o Daemon Tools 10 (j√° que esta √© a vers√£o que o site oferece) para inserir esse disco virtual. <br><br>  Execute o bin√°rio baixado.  Erro de igni√ß√£o, requer o .NET Framework 4.5, fa√ßa o download, instale. <br>  Iniciamos o bin√°rio baixado, a instala√ß√£o come√ßou, o carregador de inicializa√ß√£o diz que precisa do 4.5.2, fa√ßa o download, instale. <br>  Iniciamos o bin√°rio baixado, a instala√ß√£o foi iniciada, o carregador de inicializa√ß√£o diz que n√£o ir√° a lugar nenhum at√© instalar a atualiza√ß√£o de seguran√ßa KB3033929, baixar, instalar. <br><br>  E recebemos um tapa na cara da Microsoft como uma mensagem: <br><br><img src="https://habrastorage.org/webt/r6/qe/de/r6qedenl5w3dez4ysscvod8rmjw.png"><br><br>  Lan√ßamos violentamente uma pedra muito afiada contra a Microsoft, baixamos as antigas Daemon Tools de torrents, descompactamos o Visual Studio com √™xito, instalamos e finalmente (00:00) compilamos o MVP, obtemos o mesmo erro.  Bem, havia uma boa vers√£o, mas n√£o cresceu junto. <br><br><h2>  CAP√çTULO 11. No limiar </h2><br>  Estamos escrevendo para o segundo programador, que neste momento conclui urgentemente o servidor e o procedimento de registro.  Ele lembra que existe um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">reposit√≥rio</a> git que se conecta a essa biblioteca no NT e trabalha com ele. <br><br>  Olhando desconfiado para o reposit√≥rio, baixe-o, compile e execute-o.  Isso funciona. <br><br><img src="https://habrastorage.org/webt/mt/gl/q-/mtglq-c68eyegv74wjnzjvpmddi.png"><br><br>  Observamos o c√≥digo ainda mais desconfiado.  O c√≥digo √© id√™ntico, exceto que est√° escrito em C ++ e n√£o em C. <br>  Entendemos que a linguagem n√£o tem nada a ver com isso.  N√≥s olhamos para as bibliotecas do Sberbank, que o c√≥digo extrai. <br>  Vemos o √∫ltimo commit. <br><br>  E aqui estamos esperando por outra surpresa. <br><br>  Acontece que as vers√µes da biblioteca Sberbank podem ser diferentes.  A √∫ltima confirma√ß√£o aumenta a vers√£o de 23 para 27.  Copie a vers√£o do gita para o seu computador de teste - FUNCIONA! <br><br>  Verificamos todos os arquivos enviados pelo Sberbank, comparamos as vers√µes e constru√≠mos um tablet: <br><div class="scrollable-table"><table><tbody><tr><th>  Vers√£o </th><th>  Trabalhos </th></tr><tr><td>  26.0.15 - B√°sico </td><td>  n√£o </td></tr><tr><td>  27.4.12 - Do reposit√≥rio </td><td>  sim </td></tr><tr><td>  23.0.13 - Do reposit√≥rio </td><td>  sim </td></tr><tr><td>  29.0.9 - As √∫ltimas de Sat </td><td>  sim </td></tr><tr><td>  23.0.13 - Com um patch para o sistema Cryptor </td><td>  sim </td></tr></tbody></table></div><br>  √ìtimo, agora vamos curar.  Nos sistemas em que custa 26, atualize para 29 ou 27 e tudo decolar√°. <br>  Jogamos a pedra n¬∫ 9 em dire√ß√£o ao Sberbank por quebrar o comportamento nos sistemas NT. <br><br><h2>  CAP√çTULO 12. O que os esperava l√° dentro </h2><br>  Arquivo e insuficiente?  N√£o importa, pegamos t√≠tulos corrigidos, vinculamos dinamicamente √† biblioteca para retornar corretamente um erro, escrevemos um c√≥digo que simplesmente grava o c√≥digo de retorno da fun√ß√£o no arquivo "e", vamos chamar o biner sb_pilot.exe e ... <br><br>  Para trabalhar, funciona. <br><br>  Essa √© apenas a vers√£o do sistema "Cryptor" n√£o cria um arquivo "p". <br><br>  <i>Tristemente, olhamos para o sangue pingando nas juntas e para o entalhe na parede.</i> <br><br>  Para iniciantes, qual √© o sistema Cryptor. <br><br>  A Cryptera √© uma empresa dinamarquesa que produz equipamentos de criptografia / equipamentos de seguran√ßa / chaves etc. Acho que todos viram uma das c√≥pias de seus produtos: <br><br><img src="https://habrastorage.org/webt/pb/dz/85/pbdz85atzxiscdkdkq0z97ahhsm.png"><br><br>  Portanto, o Sberbank usa seu m√≥dulo de criptografia para pinpads e libera uma biblioteca especial "corrigida", na qual, como j√° entendemos, o arquivo "p" n√£o √© criado.  Escrevemos ao Sberbank sobre isso e em alguns dias obteremos a resposta de que "no sistema original, o arquivo" p "ser√° criado, mas no patch do Cryptor n√£o ser√°".  N√≥s daremos a eles a pedra n¬∫ 10 em alguns dias, porque voc√™ precisa trabalhar agora. <br><br>  Felizmente ou infelizmente, as fun√ß√µes que usamos para conduzir opera√ß√µes retornam a estrutura j√° mencionada: <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">auth_answer</span></span></span><span class="hljs-class">{</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> TType; <span class="hljs-comment"><span class="hljs-comment">/**&lt; [in]  .  ::OpetationTypes */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> Amount; <span class="hljs-comment"><span class="hljs-comment">/**&lt; [in]    */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> RCode[<span class="hljs-number"><span class="hljs-number">3</span></span>]; <span class="hljs-comment"><span class="hljs-comment">/**&lt; [out]    */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> AMessage[<span class="hljs-number"><span class="hljs-number">16</span></span>]; <span class="hljs-comment"><span class="hljs-comment">/**&lt; [out]    */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> CType; <span class="hljs-comment"><span class="hljs-comment">/**&lt; [in,out]   */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>* Check; <span class="hljs-comment"><span class="hljs-comment">/**&lt; [out]  ,   GlobalFree    */</span></span> };</code> </pre> <br>  Ah, tudo bem, a verifica√ß√£o j√° est√° l√°, podemos salv√°-la em um arquivo ou imprimi-la imediatamente em JSON ... <br><br><pre> <code class="cpp hljs"><span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(<span class="hljs-string"><span class="hljs-string">"%s\n"</span></span>, answer.Check);</code> </pre> <br>  E temos o aplicativo travando devido ao acesso a um ponteiro inv√°lido. <br><br><h2>  CAP√çTULO 14. Fogo e √°gua </h2><br>  4 da manh√£  Realizamos Seth Bandha Sarvangasana para nos acalmar e lemos atentamente o manual: <br><blockquote>  [out] imagem do cheque, deve ser liberada pela GlobalFree no programa de chamada </blockquote>  O que isso nos d√°?  Muito.  Primeiro, como o ponteiro precisa ser limpo usando o GlobalFree, ele foi alocado no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">GlobalAlloc</a> .  Portanto, ele n√£o emite um ponteiro para a mem√≥ria, como na vers√£o de 16 bits, mas um n√∫mero de objeto com o tipo semanticamente declarado HGLOBAL, que pode ser alimentado na fun√ß√£o GlobalSize para obter o tamanho do bloco alocado e o GlobalLock para bloquear uma parte da mem√≥ria, mas obter o ponteiro original.  By the way, pedra # 6 em dire√ß√£o √† Microsoft para NIH malloc e gr√°tis, que est√£o na biblioteca padr√£o. <br><br><pre> <code class="cpp hljs"><span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(<span class="hljs-string"><span class="hljs-string">"%s\n"</span></span>, GlobalLock(answer.Check));</code> </pre> <br>  E ainda tem uma gota.  Ok, o que o GlobalSize est√° mostrando?  Zero?  De alguma forma estranha. <br><br>  Verificamos outras fun√ß√µes que tamb√©m devem dar um deslize - vemos a mesma imagem. <br><br>  Ocorre-me apenas que eu gerarei um deslize de acordo com os dados que a fun√ß√£o de pagamento mais legal pode fornecer (sim, o Sberbank tem fun√ß√µes chamadas card_authorize2..14, n√£o jogarei uma pedra para isso): <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">auth_answer14</span></span></span><span class="hljs-class"> {</span></span> auth_answer ans; <span class="hljs-comment"><span class="hljs-comment">/**&lt; [in, out]   . . ::auth_answer */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> AuthCode[MAX_AUTHCODE]; <span class="hljs-comment"><span class="hljs-comment">/**&lt; [out]  . 7 . */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> CardID[CARD_ID_LEN]; <span class="hljs-comment"><span class="hljs-comment">/**&lt; [out]  . 25 .     ,   6   4,    '*'.*/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> ErrorCode; <span class="hljs-comment"><span class="hljs-comment">/**&lt; [out]  . */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> TransDate[TRANSDATE_LEN]; <span class="hljs-comment"><span class="hljs-comment">/**&lt; [out]     */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> TransNumber; <span class="hljs-comment"><span class="hljs-comment">/**&lt; [out]    . , .    */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> SberOwnCard; <span class="hljs-comment"><span class="hljs-comment">/**&lt; [out]     */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> Hash[CARD_HASH_LEN]; <span class="hljs-comment"><span class="hljs-comment">/**&lt; [in, out]  SHA1   ,   ASCII     . 40 .*/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> Track3[CARD_TRACK3_LEN]; <span class="hljs-comment"><span class="hljs-comment">/**&lt; [out]   */</span></span> DWORD RequestID; <span class="hljs-comment"><span class="hljs-comment">/**&lt; [in,out]   .  PCI DSS .*/</span></span> DWORD Department; <span class="hljs-comment"><span class="hljs-comment">/**&lt; [in]     0  14-, .      0xFFFFFFFF,          .        ,      4191. */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> RRN[MAX_REFNUM]; <span class="hljs-comment"><span class="hljs-comment">/**&lt; [in,out]   ,  .    ,     .   12-  .       (   pilot_nt.dll),     ‚Äì  (     ;     ,   ).*/</span></span> DWORD CurrencyCode; <span class="hljs-comment"><span class="hljs-comment">/**&lt; [in]    (810, 643, 840, 978  ..) */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> CardEntryMode; <span class="hljs-comment"><span class="hljs-comment">/**&lt; [out]    ('D'-., 'M'- , 'C'-, 'E'- EMV, 'R'- magstripe, 'F'-fallback)*/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> CardName[MAX_CARD_NAME_LEN]; <span class="hljs-comment"><span class="hljs-comment">/**&lt; [out]    */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> AID[MAX_AID_ASCII_LEN]; <span class="hljs-comment"><span class="hljs-comment">/**&lt; [out] Application ID   (   ASCIIZ-)*/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> FullErrorText[MAX_FULL_ERROR_TEXT]; <span class="hljs-comment"><span class="hljs-comment">/**&lt; [out]     */</span></span> DWORD GoodsPrice; <span class="hljs-comment"><span class="hljs-comment">/**&lt; [in]    ,  (34.99-&gt;3499)*/</span></span> DWORD GoodsVolume; <span class="hljs-comment"><span class="hljs-comment">/**&lt; [in]  ,  .  (30.234-&gt;30234)*/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> GoodsCode[MAX_GOODS_CODE+<span class="hljs-number"><span class="hljs-number">1</span></span>]; <span class="hljs-comment"><span class="hljs-comment">/**&lt; [in]     .*/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> GoodsName[MAX_GOODS_NAME]; <span class="hljs-comment"><span class="hljs-comment">/**&lt; [in]     . !   auth_answer14         gate.dll TGoodsData.     */</span></span> }; <span class="hljs-comment"><span class="hljs-comment">/** @brief     * @param[in] track2      .  NULL,     . * @param[in,out] auth_answer . ::auth_answer14 * @param[in,out] payinfo     * @return int  . */</span></span> <span class="hljs-function"><span class="hljs-function">PILOT_NT_API </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">card_authorize14</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *track2, struct auth_answer14 *auth_answer, struct payment_info_item *payinfo )</span></span></span></span>;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Estamos tentando selecionar os campos ... Descobrimos que apenas uma coisa nos separava da felicidade - Sobrenome e Nome do titular do cart√£o. </font><font style="vertical-align: inherit;">Sem eles, um deslize n√£o √© considerado </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">legal</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Detalhes: identificador de um caixa eletr√¥nico, terminal eletr√¥nico ou outro meio t√©cnico destinado a transa√ß√µes com cart√µes de pagamento; </font><font style="vertical-align: inherit;">tipo de opera√ß√£o; </font><font style="vertical-align: inherit;">data da transa√ß√£o; </font><font style="vertical-align: inherit;">valor da transa√ß√£o; </font><font style="vertical-align: inherit;">moeda de transa√ß√£o; </font><font style="vertical-align: inherit;">c√≥digo de autoriza√ß√£o do valor da comiss√£o; </font><font style="vertical-align: inherit;">detalhes do cart√£o de pagamento.</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√â uma pena, mas formar uma falha legal com os dados que temos n√£o funcionar√°. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vamos cavar na documenta√ß√£o novamente. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Encontramos o exemplo que o Sberbank fornece no diret√≥rio "examples"</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">cout</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">"Authorization completion finished with code '"</span></span> &lt;&lt; result &lt;&lt; <span class="hljs-string"><span class="hljs-string">"'"</span></span> &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-function"><span class="hljs-function">ofstream </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">file</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(CHEQUE_FILENAME)</span></span></span></span>; file &lt;&lt; argument.auth_answ.Check; file.close(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (argument.auth_answ.Check) { <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">cout</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">"Cheque saved to file "</span></span> &lt;&lt; CHEQUE_FILENAME &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>; <span class="hljs-comment"><span class="hljs-comment">//GlobaFree(argument.auth_answ.Check); }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Simplesmente exibe o texto localizado no ponteiro. </font><font style="vertical-align: inherit;">Mas j√° vimos que n√£o funciona assim ... S√≥ por precau√ß√£o, vamos compilar o exemplo deles e execut√°-lo. </font><font style="vertical-align: inherit;">Partida na linha `file &lt;&lt; argument.auth_answ.Check;`, bem, Sberbank, segure a pedra # 11 para exemplos que n√£o funcionam. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7h </font><font style="vertical-align: inherit;">Voc√™ j√° pode escrever para os desenvolvedores de outro wrapper que foi escrito no Delphi h√° v√°rios anos. </font><font style="vertical-align: inherit;">Temos a resposta de que tudo funciona para eles. </font><font style="vertical-align: inherit;">Estamos procurando a base de seu inv√≥lucro e encontramos no </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><pre> <code class="cpp hljs">TAuthAnswer = packed record TType: integer; Amount: UINT; <span class="hljs-comment"><span class="hljs-comment">// IN     Rcode: array [0 .. 2] of AnsiChar; AMessage: array [0 .. 15] of AnsiChar; CType: integer; Check: PAnsiChar; end; Result := Func(nil, @FAuthAnswer); FLastError := Result; FCheque := PAnsiChar(FAuthAnswer.Check);</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Convers√£o simples de tipo para ponteiro sem nenhuma chamada de fun√ß√£o. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Come√ßamos a suspeitar de maus esp√≠ritos.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> CAP√çTULO 17. A tempestade entrou em erup√ß√£o </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As pessoas come√ßam a retornar ao escrit√≥rio, balan√ßando a cabe√ßa com simpatia. </font><font style="vertical-align: inherit;">O PO n√£o parece muito feliz em saber as √∫ltimas not√≠cias. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aqui me lembro de um detalhe. </font><font style="vertical-align: inherit;">Quando exibimos os campos da estrutura n¬∫ 14 para ver seus valores, um byte de cada linha foi cortado. </font><font style="vertical-align: inherit;">Por um lado, por outro</font></font><br><blockquote>  Aten√ß√£o!<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Na estrutura auth_answer14, o nome do produto √© um caractere menor que no gate.dll TGoodsData. </font><font style="vertical-align: inherit;">Corrija este erro como padr√£o</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Talvez ainda esteja conectado com ... Um </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">palpite terr√≠vel surge no c√©rebro como um raio. </font><font style="vertical-align: inherit;">Declare a estrutura como</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> __</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attribute__</span></span></span><span class="hljs-class">((</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">packed</span></span></span><span class="hljs-class">)) {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> TType; <span class="hljs-comment"><span class="hljs-comment">/**&lt; [in]  .  ::OpetationTypes */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> Amount; <span class="hljs-comment"><span class="hljs-comment">/**&lt; [in]    */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> RCode[<span class="hljs-number"><span class="hljs-number">3</span></span>]; <span class="hljs-comment"><span class="hljs-comment">/**&lt; [out]    */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> AMessage[<span class="hljs-number"><span class="hljs-number">16</span></span>]; <span class="hljs-comment"><span class="hljs-comment">/**&lt; [out]    */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> CType; <span class="hljs-comment"><span class="hljs-comment">/**&lt; [in,out]   */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>* Check; <span class="hljs-comment"><span class="hljs-comment">/**&lt; [out]  ,   GlobalFree    */</span></span> };</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E ... </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nada muda. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tamanho est√°tico = 0, Bloqueio est√°tico = NULL. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dor </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Decad√™ncia. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Involuntariamente, voc√™ est√° procurando com seus olhos uma viga confort√°vel no teto, de modo que ela possa suportar o peso. Depois de tantas horas sem parar de codificar e estudar a documenta√ß√£o, fileiras delgadas de bytes flutuam diante de nossos olhos. Mas e se imprimirmos bytes que geralmente s√£o retornados?</font></font><br><br><pre> <code class="cpp hljs"> u32 i; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(answ); i++) { <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(<span class="hljs-string"><span class="hljs-string">"%02x "</span></span>, *((u8 *)&amp;answ + i)); } <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(<span class="hljs-string"><span class="hljs-string">"\n"</span></span>); C:\banks\sber\sb_pilot&gt;sb_pilot.exe <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1000</span></span> <span class="hljs-number"><span class="hljs-number">01</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> e8 <span class="hljs-number"><span class="hljs-number">03</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">30</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> ce e4 ee e1 f0 e5 ed ee <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">02</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> f8 <span class="hljs-number"><span class="hljs-number">6</span></span>c <span class="hljs-number"><span class="hljs-number">7</span></span>a <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬´30 00 00 ce¬ª - o que significa que o Sberbank ainda utiliza estruturas compactadas. </font><font style="vertical-align: inherit;">Mas n√£o h√° uma palavra sobre isso nos cabe√ßalhos. </font><font style="vertical-align: inherit;">Portanto, os exemplos n√£o funcionam, portanto, √© imposs√≠vel obter um ponteiro para o texto no final - porque est√° quebrado devido a uma mudan√ßa de 1 byte. </font><font style="vertical-align: inherit;">Pedra enorme e espinhosa em dire√ß√£o a Sberbank! </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E ent√£o uma nuance maaaalenky chamou minha aten√ß√£o. </font><font style="vertical-align: inherit;">4 + 4 + 3 + 16 + 4 + 4 = 35. E aqui est√£o 36 bytes, Obelix. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se houver 36 bytes, o compilador ainda est√° alinhando a estrutura. </font><font style="vertical-align: inherit;">Portanto, entre RCode e AMessage, um byte extra ainda √© inserido. </font><font style="vertical-align: inherit;">Mas porque? </font><font style="vertical-align: inherit;">Afinal, indicamos `__packed__`!</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> CAP√çTULO 18. A jornada de volta </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Os motivos pelos quais o alinhamento ainda est√° presente apareceram em 2012: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://gcc.gnu.org/bugzilla/show_bug.cgi?id=52991</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Um bug foi corrigido apenas no GCC 8 (uma pedra para 6 anos de buggy!), Que ainda n√£o √© poss√≠vel ser atualizado. </font><font style="vertical-align: inherit;">Felizmente, h√° uma solu√ß√£o alternativa:</font></font><br><br><pre> <code class="cpp hljs">-mno-ms-bitfields</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agora n√£o vamos analisar o mecanismo de opera√ß√£o dessa flag, apenas pass√°-lo para o compilador: </font></font><br><br><img src="https://habrastorage.org/webt/ve/tr/d4/vetrd4m4rsdhmkyxkgrvxbkepko.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Slip! </font><font style="vertical-align: inherit;">Querida! </font><font style="vertical-align: inherit;">Senti sua falta, nem vou jurar por causa do krakozyabry, j√° joguei uma pedra por isso. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E, finalmente, alimentamos a Microsoft com uma pedra, porque o GlobalSize / Lock d√° zeros a ponteiros inv√°lidos.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> CAP√çTULO 19. √öltimo cap√≠tulo </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para minimizar o n√∫mero de ifdefs para a camada sb_pilot, escrevemos um aplicativo separado que imita completamente a vers√£o linux do sb_pilot. </font><font style="vertical-align: inherit;">Assim, deixando o c√≥digo da camada # 1 o mesmo, deixando apenas uma condi√ß√£o:</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> defined(BXI_OS_GLX) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> GFJ_PILOT_EXECUTABLE </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"./sb_pilot"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">elif</span></span></span><span class="hljs-meta"> defined(BXI_OS_WIN) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> GFJ_PILOT_EXECUTABLE </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"./sb_pilot.exe"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span></span></code> </pre> <br><img src="https://habrastorage.org/webt/wo/eu/2g/woeu2gk8m1mvtibiepfxwiijrbo.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Resultados da batalha: </font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Sberbank: 12 pedras </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Microsoft: 7 pedras </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> GCC: 1 pedra </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Recorda√ß√£o de conquistas em nosso painel de comando: </font></font><br><br><img src="https://habrastorage.org/webt/ko/im/3y/koim3ykfftmlltegcqh_rkdkgxc.jpeg"></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt451188/">https://habr.com/ru/post/pt451188/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt451178/index.html">Teste de colis√£o com pouso em paraquedas</a></li>
<li><a href="../pt451180/index.html">PCB substitui dois motores lineares</a></li>
<li><a href="../pt451182/index.html">Como os tamanhos de matrizes C se tornaram parte da interface bin√°ria da biblioteca</a></li>
<li><a href="../pt451184/index.html">Projeto Blue Origin Blue Moon: Pessoas na Lua at√© 2024</a></li>
<li><a href="../pt451186/index.html">Reposit√≥rio LINSTOR e sua integra√ß√£o com o OpenNebula</a></li>
<li><a href="../pt451196/index.html">Separa√ß√£o de perfis de clientes e freelancers</a></li>
<li><a href="../pt451198/index.html">O papel da realidade aumentada e da realidade virtual na NBA</a></li>
<li><a href="../pt451200/index.html">Obten√ß√£o autom√°tica de certificados SSL por Let's Encrypt usando o desafio DNS-01 e AWS</a></li>
<li><a href="../pt451204/index.html">Editores de texto gratuitos para colabora√ß√£o</a></li>
<li><a href="../pt451206/index.html">O que est√° acontecendo com os reposit√≥rios RDF agora?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>