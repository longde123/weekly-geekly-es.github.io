<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßëüèΩ ‚è±Ô∏è üß§ Criando trilhas na neve no Unreal Engine 4 ‚ö∞Ô∏è ü§Ωüèø üë∫</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Se voc√™ joga jogos AAA modernos, pode ter notado uma tend√™ncia a usar paisagens cobertas de neve. Por exemplo, eles est√£o em Horizon Zero Dawn , Rise ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Criando trilhas na neve no Unreal Engine 4</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/416703/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/ox/49/ct/ox49ctzii2nk6gryoeuvbcxf96a.gif"></div><br>  Se voc√™ joga jogos AAA modernos, pode ter notado uma tend√™ncia a usar paisagens cobertas de neve.  Por exemplo, eles est√£o em <i>Horizon Zero Dawn</i> , <i>Rise of the Tomb Raider</i> e <i>God of War</i> .  Em todos esses jogos, a neve tem uma caracter√≠stica importante: voc√™ pode deixar vest√≠gios nela! <br><br>  Gra√ßas a essa intera√ß√£o com o ambiente, a imers√£o do jogador no jogo √© aprimorada.  Torna o ambiente mais realista e vamos ser honestos - √© apenas interessante.  Por que passar longas horas criando um mec√¢nico curioso se voc√™ pode simplesmente deixar o jogador cair no ch√£o e fazer anjos da neve? <br><br>  Neste tutorial, voc√™ aprender√° o seguinte: <br><br><ul><li>  Crie pegadas usando a captura de cena para mascarar objetos pr√≥ximos ao ch√£o </li><li>  Use uma m√°scara com material do terreno para criar neve deform√°vel </li><li>  Para otimizar, exiba pegadas na neve apenas ao lado do jogador </li></ul><a name="habracut"></a><br><blockquote>  <em>Nota:</em> entende-se que voc√™ j√° est√° familiarizado com o b√°sico do trabalho com o Unreal Engine.  Se voc√™ √© novo, confira nossa s√©rie de tutoriais do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Unreal Engine para iniciantes</a> . </blockquote><br><h2>  Come√ßando a trabalhar </h2><br>  Fa√ßa o download de <a href="">materiais</a> para este tutorial.  Descompacte-os, v√° para <em>SnowDeformationStarter</em> e abra <em>SnowDeformation.uproject</em> .  Neste tutorial, criaremos tra√ßos com a ajuda de um personagem e v√°rias caixas. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a1f/8c7/b72/a1f8c7b7279319c558685c1b09858726.gif"></div><br>  Antes de come√ßarmos, voc√™ precisa saber que o m√©todo deste tutorial salvar√° apenas rastreios em uma determinada √°rea, e n√£o em todo o mundo, porque a velocidade depende da resolu√ß√£o da renderiza√ß√£o do destino. <br><br>  Por exemplo, se queremos armazenar rastreamentos para uma grande √°rea, teremos que aumentar a resolu√ß√£o.  Mas tamb√©m aumenta o impacto da captura de cena na velocidade do jogo e no tamanho da mem√≥ria para a renderiza√ß√£o de destino.  Para otimiza√ß√£o, voc√™ precisa limitar o escopo e a resolu√ß√£o. <br><br>  Tendo resolvido isso, vamos descobrir o que √© preciso para perceber as pegadas na neve. <br><br><h2>  Implementa√ß√£o de pegadas na neve </h2><br>  A primeira coisa que voc√™ precisa para criar rastreamentos √© a <em>renderiza√ß√£o de destino</em> .  O destino de renderiza√ß√£o ser√° uma m√°scara em escala de cinza, na qual branco indica a presen√ßa de um tra√ßo e preto indica sua aus√™ncia.  Em seguida, podemos projetar a renderiza√ß√£o alvo no ch√£o e us√°-la para misturar as texturas e mudar os v√©rtices. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ea7/f0c/7f4/ea7f0c7f4eee82e34ebf74afeab25a72.gif"></div><br>  A segunda coisa que precisamos √© uma maneira de mascarar apenas objetos que afetam a neve.  Isso pode ser implementado renderizando primeiro os objetos em <em>Profundidade personalizada</em> .  Voc√™ pode usar a <em>captura de cena</em> com o <em>material p√≥s-processo</em> para mascarar todos os objetos renderizados em Profundidade personalizada.  Ent√£o voc√™ pode exibir a m√°scara na renderiza√ß√£o de destino. <br><br><blockquote>  <em>Nota: a</em> captura de cena √© essencialmente uma c√¢mera com a capacidade de gerar uma renderiza√ß√£o de destino. </blockquote><br>  A parte mais importante da captura de uma cena √© a sua localiza√ß√£o.  A seguir, √© apresentado um exemplo de renderiza√ß√£o de destino capturada de uma <em>vista superior</em> .  Aqui, um personagem de terceira pessoa e caixas s√£o mascaradas. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/886/2e0/4cf/8862e04cfeb3f6ce26918d4ffa8b00a0.jpg"></div><br>  √Ä primeira vista, uma captura com uma vista superior nos conv√©m.  Os formul√°rios parecem apropriados para malhas, ent√£o n√£o deve haver problemas, certo? <br><br>  Na verdade n√£o.  O problema da captura de uma vista superior √© que ela n√£o captura nada no ponto mais amplo.  Aqui est√° um exemplo: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6ae/952/8b1/6ae9528b111143c408aab2642fe4c781.gif"></div><br>  Imagine que as setas amarelas v√£o at√© o ch√£o.  No caso de um cubo e um cone, a ponta da seta sempre permanecer√° dentro do objeto.  No entanto, no caso de uma esfera, o ponto emerge dela quando se aproxima a Terra.  Mas, de acordo com a c√¢mera, a ponta est√° sempre dentro da esfera.  Veja como ser√° a esfera da c√¢mera: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/35f/580/cab/35f580cab1df39d4707c344f9e902e9d.jpg"></div><br>  Portanto, a m√°scara de esfera ser√° maior do que deveria, mesmo que a √°rea de contato com a terra seja pequena. <br><br>  Al√©m disso, esse problema √© complementado pelo fato de que √© dif√≠cil determinar se o objeto diz respeito √† terra. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9e3/df9/a48/9e3df9a4804b5c317f40f57389fc1a8c.gif"></div><br>  Para lidar com esses dois problemas, voc√™ pode usar a captura <em>da parte inferior</em> . <br><br><h3>  Aperto inferior </h3><br>  A captura abaixo √© a seguinte: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c3f/348/aad/c3f348aad117b479acf5fd9505f9c860.gif"></div><br>  Como voc√™ pode ver, a c√¢mera agora captura o lado inferior, ou seja, aquele que toca o ch√£o.  Isso elimina o problema da "√°rea mais larga" que aparece ao capturar de cima. <br><br>  Para determinar se um objeto est√° tocando o ch√£o, voc√™ pode usar o material de p√≥s-processamento para executar uma verifica√ß√£o de profundidade.  Ele verifica se a profundidade do objeto √© maior que a profundidade da Terra <i>e</i> se est√° abaixo de um deslocamento predeterminado.  Se as duas condi√ß√µes forem atendidas, podemos mascarar esse pixel. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a6b/83f/e87/a6b83fe8713950c52f917314de9d7c88.jpg"></div><br>  Abaixo est√° um exemplo dentro de um motor com uma zona de captura de 20 unidades acima do solo.  Observe que a m√°scara aparece apenas quando o objeto passa por um determinado ponto.  Observe tamb√©m que a m√°scara se torna mais branca √† medida que o objeto se aproxima do solo. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/949/1bb/d76/9491bbd768781cbca7c07a652172ba2c.gif"></div><br>  Primeiro, crie um material de p√≥s-processamento para executar uma verifica√ß√£o de profundidade. <br><br><h2>  Criando material de teste de profundidade </h2><br>  Para realizar uma verifica√ß√£o de profundidade, √© necess√°rio usar dois amortecedores de profundidade - um para o solo e outro para objetos que afetam a neve.  Como a captura da cena v√™ apenas a Terra, a <em>Profundidade da Cena</em> inferir√° profundidade para a Terra.  Para obter profundidade para os objetos, apenas renderizamos a <em>profundidade personalizada</em> . <br><br><blockquote>  <em>Nota:</em> para economizar tempo, j√° renderizei o caractere e as caixas em Profundidade personalizada.  Se voc√™ deseja adicionar outros objetos que afetam a neve, ative o <em>Render CustomDepth Pass</em> para eles. </blockquote><br>  Primeiro, voc√™ precisa calcular a dist√¢ncia de cada pixel ao ch√£o.  Abra <em>Materials \ PP_DepthCheck</em> e crie o seguinte: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f32/7bb/226/f327bb226d1764c3f848d1c43a6304ca.jpg"></div><br>  Em seguida, voc√™ precisa criar uma zona de captura.  Para fazer isso, adicione os n√≥s destacados: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/908/37d/0eb/90837d0eb07af42121b2a113b1229230.jpg"></div><br>  Agora, se o pixel estiver dentro de <em>25</em> unidades da Terra, ele aparecer√° na m√°scara.  O brilho da m√°scara depende de qu√£o pr√≥ximo o pixel est√° do ch√£o.  Clique em <em>Aplicar</em> e retorne ao editor principal. <br><br>  Em seguida, voc√™ precisa criar uma captura de cena. <br><br><h2>  Criar captura de cena </h2><br>  Primeiro, precisamos de uma renderiza√ß√£o de destino para capturar uma captura de cena.  V√° para a pasta <em>RenderTargets</em> e crie um novo <em>destino de renderiza√ß√£o</em> chamado <em>RT_Capture</em> . <br><br>  Agora vamos criar uma captura de cena.  Neste tutorial, adicionaremos a captura de cena ao blueprint, pois mais tarde precisaremos de um script para ele.  Abra <em>Blueprints \ BP_Capture</em> e adicione o <em>Scene Capture Component 2D</em> .  Nomeie-o <em>SceneCapture</em> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3d0/df9/915/3d0df9915e8aa04d9577193a53bcfc05.jpg"></div><br>  Primeiro, precisamos definir a curva de captura para que ela olhe para o ch√£o.  V√° para o painel Detalhes e defina a <em>rota√ß√£o para</em> <em>(0, 90, 90)</em> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6e2/c35/407/6e2c354070055e1f427d626b1c0df408.jpg"></div><br>  Em seguida, vem o tipo de proje√ß√£o.  Como a m√°scara √© uma representa√ß√£o 2D da cena, precisamos nos livrar da distor√ß√£o da perspectiva.  Para fazer isso, defina <em>Proje√ß√£o \ Tipo de proje√ß√£o</em> como <em>Ortogr√°fico</em> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/78b/e54/adf/78be54adf3666b52564582f07153f8df.jpg"></div><br>  Em seguida, precisamos informar a captura de cena em que destino renderizar para gravar.  Para fazer isso, selecione o valor de <em>RT_Capture</em> para <em>Scene Capture \ Texture Target</em> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5c6/a76/2c5/5c6a762c53867499e5f3ace3de1b1eee.jpg"></div><br>  Finalmente, precisamos usar o material de verifica√ß√£o de profundidade.  Adicione PP_DepthCheck ao <em>Rendering Features \ Post Process Materials</em> .  Para que o p√≥s-processamento funcione, tamb√©m precisamos alterar a <em>cena Capture \ Capture Source</em> para <em>Final Color (LDR) em RGB</em> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3ec/1f1/26f/3ec1f126fce6ccea0625ae5d33193fdd.jpg"></div><br>  Agora que a captura de cena est√° configurada, precisamos especificar o tamanho da √°rea de captura. <br><br><h3>  Definindo o tamanho da √°rea de captura </h3><br>  Como √© melhor usar baixas resolu√ß√µes para a renderiza√ß√£o de destino, precisamos usar o espa√ßo com efici√™ncia.  Ou seja, devemos escolher qual √°rea um pixel cobrir√°.  Por exemplo, se as resolu√ß√µes da √°rea de captura e a renderiza√ß√£o do destino forem as mesmas, obteremos uma propor√ß√£o de 1: 1.  Cada pixel cobrir√° uma √°rea 1 √ó 1 (em unidades do mundo). <br><br>  Para trilhas na neve, uma propor√ß√£o de 1: 1 n√£o √© necess√°ria, porque provavelmente n√£o precisaremos desses detalhes.  Eu recomendo o uso de propor√ß√µes maiores, pois isso permitir√° aumentar o tamanho da √°rea de captura em baixa resolu√ß√£o.  Mas n√£o aumente a propor√ß√£o, caso contr√°rio os detalhes come√ßar√£o a se perder.  Neste tutorial, usaremos uma propor√ß√£o de 8: 1, ou seja, o tamanho de cada pixel ser√° 8 √ó 8 unidades do mundo. <br><br>  Voc√™ pode redimensionar a √°rea de captura alterando a propriedade <em>Scene Capture \ Ortho Width</em> .  Por exemplo, se voc√™ deseja capturar uma √°rea de 1024 √ó 1024, defina o valor como 1024. Como estamos usando uma propor√ß√£o 8: 1, defina o valor como <em>2048</em> (a resolu√ß√£o padr√£o da renderiza√ß√£o de destino √© 256 √ó 256). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/411/c60/994/411c60994d4b52dc80553a375496363b.jpg"></div><br>  Isso significa que a captura de cena capturar√° a √°rea de <em>2048 √ó 2048</em> .  √â aproximadamente 20 √ó 20 metros. <br><br>  O material do solo tamb√©m precisa de acesso para capturar o tamanho para projetar adequadamente a renderiza√ß√£o de destino.  A maneira mais f√°cil de fazer isso √© salvando o tamanho da captura na <em>cole√ß√£o de par√¢metros de material</em> .  Esta √© essencialmente uma cole√ß√£o de vari√°veis ‚Äã‚Äãque <i>qualquer</i> material pode acessar. <br><br><h3>  Salvando o tamanho da captura </h3><br>  Volte ao editor principal e v√° para a pasta <em>Materiais</em> .  Crie uma <em>cole√ß√£o de par√¢metros de materiais</em> que estar√° em <em>Materiais e texturas</em> .  Renomeie-o para <em>MPC_Capture</em> e abra. <br><br>  Em seguida, crie um novo <em>par√¢metro escalar</em> e <em>chame</em> -o de <em>CaptureSize</em> .  N√£o se preocupe em definir seu valor - faremos isso sem rodeios. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3bd/e83/fd4/3bde83fd4df9a960ef4ebde57830b749.jpg"></div><br>  Volte para <em>BP_Capture</em> e adicione os n√≥s destacados ao <em>Event BeginPlay</em> .  Defina <em>Cole√ß√£o</em> como <em>MPC_Capture</em> e <em>Nome do par√¢metro</em> como <em>CaptureSize</em> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/eed/843/d3d/eed843d3d5ddc063f9e1c7664b514286.jpg"></div><br>  Agora qualquer material pode obter o valor da <em>Largura Orto</em> , lendo-o <em>no</em> par√¢metro <em>CaptureSize</em> .  At√© agora, com a captura da cena, terminamos.  Clique em <em>Compilar</em> e retorne ao editor principal.  O pr√≥ximo passo √© projetar a renderiza√ß√£o do alvo no ch√£o e us√°-lo para deformar a paisagem. <br><br><h2>  Deforma√ß√£o da paisagem </h2><br>  Abra <em>M_Landscape</em> e v√° para o painel Detalhes.  Em seguida, defina as seguintes propriedades: <br><br><ul><li>  Para <em>Frente e verso,</em> selecione <em>ativado</em> .  Como a captura da cena ‚Äúolhar√°‚Äù de baixo, ela ver√° apenas as faces inversas da terra.  Por padr√£o, o mecanismo n√£o renderiza as faces traseiras das malhas.  Isso significa que ele n√£o armazenar√° a profundidade da terra no buffer de profundidade.  Para corrigir isso, precisamos dizer ao mecanismo para renderizar os dois lados da malha. </li><li>  Para o <em>mosaico D3D11,</em> selecione <em>Mosaico</em> <em>plano</em> (tamb√©m podem ser usados ‚Äã‚Äãtri√¢ngulos PN).  O mosaico dividir√° os tri√¢ngulos da malha em outros menores.  Em ess√™ncia, isso aumenta a resolu√ß√£o da malha e nos permite obter detalhes mais refinados ao mudar os v√©rtices.  Sem isso, a densidade dos picos ser√° muito baixa para criar tra√ßos cr√≠veis. </li></ul><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/dc2/99b/a26/dc299ba26cb64d251af3844faf0f5079.jpg"></div><br>  Depois que os mosaicos s√£o ativados, o <em>Deslocador de mundo</em> e o <em>Multiplicador de</em> mosaico s√£o ativados. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e8d/675/c53/e8d675c535ce64980597cf10a16ffafe.jpg"></div><br>  <em>O Multiplicador</em> de mosaico controla a quantidade de mosaico.  Neste tutorial, n√£o vamos conectar este n√≥, ou seja, usamos o valor padr√£o ( <em>1</em> ). <br><br>  <em>Deslocamento mundial</em> obt√©m um valor vetorial que descreve em qual dire√ß√£o e quanto mover o v√©rtice.  Para calcular o valor desse contato, precisamos primeiro projetar a renderiza√ß√£o do destino no ch√£o. <br><br><h3>  Renderiza√ß√£o do destino do projeto </h3><br>  Para projetar a renderiza√ß√£o de destino, voc√™ precisa calcular suas coordenadas UV.  Para fazer isso, crie o seguinte esquema: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cbb/88f/b59/cbb88fb598e75fc8c9bd9991806d5892.jpg"></div><br>  O que est√° acontecendo aqui: <br><br><ol><li>  Primeiro, precisamos obter a posi√ß√£o XY do v√©rtice atual.  Como estamos capturando de baixo, a coordenada X √© invertida; portanto, voc√™ precisa inverter (se quisermos capturar de cima, n√£o precisar√≠amos disso). </li><li>  Esta parte executa duas tarefas.  Em primeiro lugar, centraliza a renderiza√ß√£o do alvo de forma que seu meio esteja nas coordenadas <em>(0, 0) do</em> espa√ßo <em>do</em> mundo.  Ela ent√£o converte as coordenadas do espa√ßo mundial para o espa√ßo UV. </li></ol><br>  Em seguida, crie os n√≥s selecionados e combine os c√°lculos anteriores, como mostrado abaixo.  Para <em>Amostra de textura,</em> selecione <em>RT_Capture</em> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e95/38d/398/e9538d398f9ba02da2aea238c45651dd.jpg"></div><br>  Isso projetar√° a renderiza√ß√£o de destino no ch√£o.  No entanto, todos os v√©rtices fora da √°rea de captura ir√£o amostrar as bordas da renderiza√ß√£o de destino.  Na verdade, isso √© um problema porque a renderiza√ß√£o de destino deve ser usada apenas para v√©rtices na √°rea de captura.  Aqui est√° o que parece em um jogo: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1a4/e28/a04/1a4e28a04c7b6356bff76d8e1c4f4ce9.gif"></div><br>  Para corrigir isso, precisamos mascarar todos os UVs que est√£o fora do intervalo de 0 a 1 (ou seja, a √°rea de captura).  Para isso, criei a fun√ß√£o <em>MF_MaskUV0-1</em> .  Retorna <em>0</em> se o UV transmitido estiver fora da faixa de 0 a 1 e retornar√° <em>1</em> se estiver dentro dele.  Multiplicando o resultado pela renderiza√ß√£o alvo, realizamos mascaramento. <br><br>  Agora que projetamos a renderiza√ß√£o alvo, podemos us√°-la para misturar cores e mover v√©rtices. <br><br><h3>  Usando renderiza√ß√£o de destino </h3><br>  Vamos come√ßar misturando cores.  Para fazer isso, basta conectar <em>1-x</em> ao <em>Lerp</em> : <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bc2/4e2/6fa/bc24e26fab908757ce5a0dded5d9ce21.jpg"></div><br><blockquote>  <em>Nota:</em> se voc√™ n√£o entender por que uso <em>1-x</em> , explicarei - isso √© necess√°rio para inverter a renderiza√ß√£o alvo, para que os c√°lculos se tornem um pouco mais f√°ceis. </blockquote><br>  Agora que temos um rastro, a cor da terra est√° ficando marrom.  Se n√£o houver cor, ela permanecer√° branca. <br><br>  O pr√≥ximo passo √© o deslocamento dos v√©rtices.  Para fazer isso, adicione os n√≥s selecionados e conecte tudo da seguinte maneira: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4d7/6b2/6bd/4d76b26bddbf7640fae8032449bea285.jpg"></div><br>  Isso far√° com que todas as √°reas de neve subam <em>25</em> unidades.  √Åreas sem neve t√™m um deslocamento zero, o que criar√° uma trilha. <br><br><blockquote>  <em>Nota: Voc√™</em> pode alterar <em>DisplacementHeight</em> para aumentar ou diminuir os n√≠veis de neve.  Observe tamb√©m que DisplacementHeight √© o mesmo valor que o deslocamento de captura.  Quando eles t√™m o mesmo significado, isso nos d√° a deforma√ß√£o exata.  Mas h√° casos em que voc√™ precisa alter√°-los individualmente, ent√£o os deixei como par√¢metros separados. </blockquote><br>  Clique em <em>Aplicar</em> e retorne ao editor principal.  Crie uma inst√¢ncia <em>BP_Capture</em> no n√≠vel e forne√ßa as coordenadas <em>(0, 0, -2000)</em> para coloc√°-la no subsolo.  Clique em <em>Play</em> e passeie com as teclas <em>W</em> , <em>A</em> , <em>S</em> e <em>D</em> para entortar a neve. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f6d/a1e/47b/f6da1e47b364e53b0245e53919f4a654.gif"></div><br>  A deforma√ß√£o funciona, mas n√£o h√° vest√≠gios!  Isso aconteceu porque a captura substitui a renderiza√ß√£o de destino toda vez que a captura √© executada.  Precisamos de alguma maneira de tornar as faixas <em>permanentes</em> . <br><br><h2>  Criando rastreamentos permanentes </h2><br>  Para criar persist√™ncia, precisamos de outra renderiza√ß√£o de destino ( <em>buffer constante</em> ), na qual todo o conte√∫do da captura ser√° salvo antes da substitui√ß√£o.  Em seguida, adicionaremos um buffer constante √† captura (ap√≥s a substitui√ß√£o).  Temos um loop no qual cada renderiza√ß√£o de destino grava em outro.  √â assim que criaremos a perman√™ncia do rastreamento. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/04e/3bd/a26/04e3bda26fe04e7832163e2e08abdd64.gif"></div><br>  Primeiro, precisamos criar um buffer constante. <br><br><h3>  Criando um buffer persistente </h3><br>  V√° para a pasta <em>RenderTargets</em> e crie um novo <em>destino de renderiza√ß√£o</em> chamado <em>RT_Persistent</em> .  Neste tutorial, n√£o precisamos alterar os par√¢metros de textura, mas em seu pr√≥prio projeto, voc√™ precisar√° garantir que ambas as renderiza√ß√µes de destino usem a mesma resolu√ß√£o. <br><br>  Em seguida, precisamos de material que copie a captura em um buffer permanente.  Abra <em>Materials \ M_DrawToPersistent</em> e adicione um n√≥ <em>Sample Texture</em> .  Selecione a textura <em>RT_Capture</em> para <em>ela</em> e conecte-a da seguinte maneira: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/29e/b31/328/29eb3132825b6b7ee68ddd5c45a73454.jpg"></div><br>  Agora precisamos usar o material de desenho.  Clique em <em>Aplicar</em> e, em seguida, abra <em>BP_Capture</em> .  Primeiro, crie uma inst√¢ncia din√¢mica do material (depois precisaremos passar valores para ele).  Adicione os n√≥s destacados ao <em>Event BeginPlay</em> : <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ca2/1d0/6a1/ca21d06a1bfa563eee0df19b4da6e129.jpg"></div><br>  <em>Limpar destino de renderiza√ß√£o Os</em> n√≥s <em>2D</em> limpam cada renderiza√ß√£o de destino antes do uso. <br><br>  Em seguida, abra a fun√ß√£o <em>DrawToPersistent</em> e adicione os n√≥s destacados: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c21/88c/051/c2188c0511541f5fcaee1773318653ac.jpg"></div><br>  Em seguida, precisamos garantir que o desenho para o buffer constante seja realizado em cada quadro, porque a captura ocorre em cada quadro.  Para fazer isso, adicione <em>DrawToPersistent</em> ao <em>tick</em> de <em>evento</em> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a88/47a/e9d/a8847ae9d4bafffbaacf448af86f538d.jpg"></div><br>  Finalmente, precisamos adicionar um buffer persistente de volta √† renderiza√ß√£o de captura de destino. <br><br><h3>  Grave de volta para capturar </h3><br>  Clique em <em>Compilar</em> e abra o <em>PP_DepthCheck</em> .  Em seguida, adicione os n√≥s destacados.  Para <em>Exemplo de textura,</em> defina o valor como <em>RT_Persistent</em> : <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/afb/ff2/a99/afbff2a99105d523fd44acf437787e06.jpg"></div><br>  Agora que o destino processa a grava√ß√£o, obtemos tra√ßos que permanecem.  Clique em <em>Aplicar</em> e feche o material.  Clique em <em>Play</em> e comece a deixar faixas! <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d79/b8a/fd8/d79b8afd898378111e1fc6b62464bf2a.gif"></div><br>  O resultado parece √≥timo, mas o circuito resultante funciona apenas para uma √°rea do mapa.  Se voc√™ for al√©m da √°rea de captura, os tra√ßos deixar√£o de aparecer. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/764/641/1a7/7646411a7886c8c1004a34b2d6f3bda9.gif"></div><br>  Voc√™ pode resolver esse problema movendo a √°rea de captura com o player.  Isso significa que os rastros sempre aparecer√£o em torno da √°rea em que o jogador est√° localizado. <br><br>  <em>Nota: √†</em> medida que a captura se move, todas as informa√ß√µes fora da √°rea de captura s√£o removidas.  Isso significa que se voc√™ retornar √† √°rea onde j√° havia vest√≠gios, eles j√° desaparecer√£o.  No pr√≥ximo tutorial, mostrarei como criar faixas parcialmente retidas. <br><br><h2>  Capturar movimento </h2><br>  Voc√™ pode decidir que √© simples o suficiente para vincular a posi√ß√£o de captura XY √† posi√ß√£o XY do jogador.  Mas se voc√™ fizer isso, a renderiza√ß√£o alvo come√ßar√° a ficar emba√ßada.  Isso ocorre porque estamos movendo a renderiza√ß√£o de destino com uma etapa menor que um pixel.  Quando isso acontece, a nova posi√ß√£o do pixel fica <i>entre os</i> pixels.  Como resultado, um pixel √© interpolado por v√°rios pixels.  Aqui est√° o que parece: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d6f/e29/d8e/d6fe29d8ea33db2479e5e897e6d90344.gif"></div><br>  Para corrigir esse problema, precisamos mover a captura em etapas discretas.  Calculamos <em>o tamanho do pixel no mundo</em> e, em seguida, movemos a captura para etapas iguais a esse tamanho.  Ent√£o, cada pixel nunca estar√° entre os outros, portanto o desfoque n√£o aparecer√°. <br><br>  Para come√ßar, vamos criar um par√¢metro no qual o local da captura ser√° armazenado.  O material terrestre precisar√° dele para realizar c√°lculos de proje√ß√£o.  Abra <em>MPC_Capture</em> e adicione um <em>Par√¢metro de Vetor</em> chamado <em>CaptureLocation</em> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1e4/0c7/4c3/1e40c74c3c19e6e8a2520d10874b9c13.jpg"></div><br>  Em seguida, voc√™ precisa atualizar o material terra para usar o novo par√¢metro.  Feche <em>MPC_Capture</em> e abra <em>M_Landscape</em> .  Modifique a primeira parte dos c√°lculos da proje√ß√£o da seguinte maneira: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d22/8e4/411/d228e4411ac885ec3a29878f7b5d930f.jpg"></div><br>  Agora a renderiza√ß√£o alvo sempre ser√° projetada no local da captura.  Clique em <em>Aplicar</em> e feche o material. <br><br>  Em seguida, faremos a captura se mover com uma etapa discreta. <br><br><h3>  Movimento discreto de captura de etapas </h3><br>  Para calcular o tamanho do pixel no mundo, voc√™ pode usar a seguinte equa√ß√£o: <br><br><pre><code class="cpp hljs">(<span class="hljs-number"><span class="hljs-number">1</span></span> / RenderTargetResolution) * CaptureSize</code> </pre> <br>  Para calcular a nova posi√ß√£o, usamos a equa√ß√£o mostrada abaixo para cada componente da posi√ß√£o (no nosso caso, para as coordenadas X e Y). <br><br><pre> <code class="cpp hljs">(<span class="hljs-built_in"><span class="hljs-built_in">floor</span></span>(Position / PixelWorldSize) + <span class="hljs-number"><span class="hljs-number">0.5</span></span>) * PixelWorldSize</code> </pre> <br>  Agora use-os na captura do blueprint.  Para economizar tempo, criei a macro <em>SnapToPixelWorldSize</em> para a segunda equa√ß√£o.  Abra <em>BP_Capture</em> e, em seguida, abra a fun√ß√£o <em>MoveCapture</em> .  Em seguida, crie o seguinte diagrama: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c10/e17/55d/c10e1755df187bb3578d1b496402101f.jpg"></div><br>  Ele calcular√° o novo local e salvar√° a diferen√ßa entre o local novo e o atual no <em>MoveOffset</em> .  Se voc√™ estiver usando uma resolu√ß√£o diferente de 256 √ó 256, altere o valor destacado. <br><br>  Em seguida, adicione os n√≥s selecionados: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1e9/963/879/1e9963879bfe2465f49a71665317db20.jpg"></div><br>  Este circuito mover√° a captura com o deslocamento calculado.  Ela salvar√° o novo local de captura no <em>MPC_Capture</em> para que possa ser usado pelo material do solo. <br><br>  Finalmente, precisamos executar uma atualiza√ß√£o de posi√ß√£o em cada quadro.  Feche a fun√ß√£o e adicione-a ao <em>Tick ‚Äã‚Äãde evento</em> antes de <em>DrawToPersistent</em> <em>MoveCapture</em> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f15/3c6/d54/f153c6d5438ba54a85f2b3749b179bb9.jpg"></div><br>  Mover uma captura √© apenas metade da solu√ß√£o.  Tamb√©m precisamos mover o buffer constante.  Caso contr√°rio, a captura e o buffer persistente ficar√£o fora de sincronia e produzir√£o resultados estranhos. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e1f/4fa/008/e1f4fa0086dc9f41412b70856f246149.gif"></div><br><h3>  Movimento permanente do buffer </h3><br>  Para mudar um buffer constante, precisamos passar pelo deslocamento de deslocamento calculado.  Abra <em>M_DrawToPersistent</em> e adicione os n√≥s destacados: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e65/d15/16b/e65d1516bc33002a2e2a3bc7e9c96b00.jpg"></div><br>  Devido a isso, o buffer constante ser√° alterado pelo valor do deslocamento transmitido.  Como no material da Terra, precisamos inverter a coordenada X e realizar o mascaramento.  Clique em <em>Aplicar</em> e feche o material. <br><br>  Ent√£o voc√™ precisa transferir o deslocamento.  Abra <em>BP_Capture</em> e, em seguida, abra a fun√ß√£o <em>DrawToPersistent</em> .  Em seguida, adicione os n√≥s destacados: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/666/621/f22/666621f22bde013dd710991d5adfa7e4.jpg"></div><br>  √â assim que convertemos o <em>MoveOffset</em> em espa√ßo UV e o passamos para o material de desenho. <br><br>  Clique em <em>Compilar</em> e feche o blueprint.  Clique em <em>Play</em> e corra para o conte√∫do do seu cora√ß√£o!  N√£o importa o qu√£o longe voc√™ corra, os tra√ßos sempre permanecer√£o ao seu redor. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a94/097/5cb/a940975cb157444251cdb31bf195c8f2.gif"></div><br><h2>  Para onde ir a seguir? </h2><br>  O projeto finalizado pode ser baixado aqui. <br><br>  N√£o √© necess√°rio usar as faixas criadas neste tutorial apenas para neve.  Voc√™ pode at√© us√°-los para coisas como grama triturada (no pr√≥ximo tutorial, mostrarei como criar uma vers√£o avan√ßada do sistema). <br><br>  Se voc√™ deseja trabalhar com paisagens e renderiza√ß√µes de alvo, recomendo assistir ao v√≠deo de Chris Murphy: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Construindo efeitos de jogabilidade de √∫ltima gera√ß√£o com o Blueprint</a> .  Este tutorial mostrar√° como criar um enorme laser que queima terra e grama! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt416703/">https://habr.com/ru/post/pt416703/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt416691/index.html">Seguran√ßa de aprendizado de m√°quina: t√©cnicas eficazes de defesa ou novas amea√ßas?</a></li>
<li><a href="../pt416693/index.html">Certificados D-Link e Changing Information Technologies usados ‚Äã‚Äãpara assinar malware</a></li>
<li><a href="../pt416695/index.html">Suporte para o vSphere 6.7 e outros recursos da mais recente Veeam Backup & Replication 9.5 Update 3a</a></li>
<li><a href="../pt416697/index.html">Fus√£o de operadoras de telecomunica√ß√µes em 2018</a></li>
<li><a href="../pt416699/index.html">Atirador de elite nerd ou como fazer um "olho afiado"</a></li>
<li><a href="../pt416707/index.html">Software de gerenciamento de √°rea de trabalho remota - Aspia</a></li>
<li><a href="../pt416709/index.html">IoT e progresso natural: as tecnologias e os gadgets mais controversos</a></li>
<li><a href="../pt416711/index.html">P√°ginas da hist√≥ria da Intel. Inc√™ndio na f√°brica de Penang</a></li>
<li><a href="../pt416713/index.html">Relat√≥rio do Clube de Roma 2018, cap√≠tulo 3.14: ‚ÄúNem um √∫nico PIB ...‚Äù</a></li>
<li><a href="../pt416719/index.html">Extens√£o PHP e Kotlin Native. Parte Dois, Consciente</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>