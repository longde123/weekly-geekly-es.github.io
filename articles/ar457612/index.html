<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ฏ ๐คฒ๐พ ๐ ููููุฉ ุชุณุฑูุน ุงูุถุบุท LZ4 ูู ClickHouseุ ๐จ๐พโ๐ณ ๐บ ๐ค</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ุนูุฏ ุชุดุบูู ุงูุงุณุชุนูุงูุงุช ูู ClickHouse ุ ูุฏ ุชูุงุญุธ ุฃู ุงููููุดุฆ ููุธูุฑ ุบุงูุจูุง ุฏุงูุฉ LZ_decompress_fast ุจุงููุฑุจ ูู ุงูุฌุฒุก ุงูุนููู. ูุง ุงูุฐู ูุญุฏุซุ ูุฐุง ุงูุณุคุงู ุฌุนููุง ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ููููุฉ ุชุณุฑูุน ุงูุถุบุท LZ4 ูู ClickHouseุ</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yandex/blog/457612/" style=";text-align:right;direction:rtl"> ุนูุฏ ุชุดุบูู ุงูุงุณุชุนูุงูุงุช ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ClickHouse</a> ุ ูุฏ ุชูุงุญุธ ุฃู ุงููููุดุฆ ููุธูุฑ ุบุงูุจูุง ุฏุงูุฉ <code>LZ_decompress_fast</code> ุจุงููุฑุจ ูู ุงูุฌุฒุก ุงูุนููู.  ูุง ุงูุฐู ูุญุฏุซุ  ูุฐุง ุงูุณุคุงู ุฌุนููุง ูุชุณุงุกู ุนู ููููุฉ ุงุฎุชูุงุฑ ุฃูุถู ุฎูุงุฑุฒููุฉ ุถุบุท. <br><br>  ุชููู ClickHouse ุจุชุฎุฒูู ุงูุจูุงูุงุช ูู ูููุฐุฌ ูุถุบูุท.  ุนูุฏ ุชุดุบูู ุงูุงุณุชุนูุงูุงุช ุ ูุญุงูู ClickHouse ุงูููุงู ุจุฃูู ูุฏุฑ ูููู ุ ูู ุฃุฌู ุงูุญูุงุธ ุนูู ููุงุฑุฏ ูุญุฏุฉ ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉ.  ูู ูุซูุฑ ูู ุงูุญุงูุงุช ุ ูุชู ุจุงููุนู ุชุญุณูู ุฌููุน ุงูุญุณุงุจุงุช ุงูุชู ูุญุชูู ุฃู ุชุณุชุบุฑู ููุชูุง ูุจูุฑูุง ุ ุจุงูุฅุถุงูุฉ ุฅูู ุฃู ุงููุณุชุฎุฏู ูุชุจ ุงุณุชุนูุงููุง ูุฏุฑูุณูุง ุฌูุฏูุง.  ุซู ูู ูุง ุชุจูู ูู ุงูููุงู ุจุฃุฏุงุก ุงูุถุบุท. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/057/302/aba/057302aba5041790af404c2c781c4dd3.png"><br><br>  ูููุงุฐุง ูุตุจุญ ุงูุถุบุท LZ4 ุนูู ุงูุฒุฌุงุฌุฉุ  ูุจุฏู LZ4 ูุซู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุฎูุงุฑุฒููุฉ ุฎูููุฉ ููุบุงูุฉ</a> : ุนุงุฏุฉู ูุง ูููู ูุนุฏู ุฅูุบุงุก ุถุบุท ุงูุจูุงูุงุช ูู 1 ุฅูู 3 ุฌูุฌุงุจุงูุช / ุซุงููุฉ ููู ููุฑ ูุนุงูุฌ ุ ุงุนุชูุงุฏูุง ุนูู ุงูุจูุงูุงุช.  ูุฐุง ุฃุณุฑุน ุจูุซูุฑ ูู ุงููุธุงู ุงููุฑุนู ูููุฑุต ุงููููุฐุฌู.  ุนูุงูุฉ ุนูู ุฐูู ุ ูุญู ูุณุชุฎุฏู ุฌููุน ุงูููู ุงููุชููุฑุฉ ููุญุฏุฉ ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉ (CPU) ุ ููุง ูุชู ููุงุณ ุงูุถุบุท ุจุดูู ุฎุทู ุนุจุฑ ุฌููุน ุงูููู ุงููุงุฏูุฉ. <br><a name="habracut"></a><br>  ููุน ุฐูู ุ ููุงู ููุทุชุงู ูุฌุจ ูุฑุงุนุงุชููุง.  ุฃููุงู ุ ูุชู ูุฑุงุกุฉ ุงูุจูุงูุงุช ุงููุถุบูุทุฉ ูู ุงููุฑุต ุ ูููู ูุชู ุฅุนุทุงุก ุณุฑุนุฉ ุฅูุบุงุก ุงูุถุบุท ูู ุญูุซ ููุฏุงุฑ ุงูุจูุงูุงุช ุบูุฑ ุงููุถุบูุทุฉ.  ุฅุฐุง ูุงูุช ูุณุจุฉ ุงูุถุบุท ูุจูุฑุฉ ุจุฏุฑุฌุฉ ูุงููุฉ ุ ููุง ููุฌุฏ ุดูุก ุชูุฑูุจูุง ูููุฑุงุกุฉ ูู ุงูุฃูุฑุงุต.  ูููู ุณูููู ููุงู ุงููุซูุฑ ูู ุงูุจูุงูุงุช ุงูุชู ุชู ุฅูุบุงุก ุถุบุทูุง ุ ููุฐุง ูุคุซุฑ ุจุดูู ุทุจูุนู ุนูู ุงุณุชุฎุฏุงู ูุญุฏุฉ ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉ: ูู ุญุงูุฉ LZ4 ุ ูููู ููุฏุงุฑ ุงูุนูู ุงูุถุฑูุฑู ูุฅูุบุงุก ุถุบุท ุงูุจูุงูุงุช ูุชูุงุณุจุงู ุชูุฑูุจูุง ูุน ุญุฌู ุงูุจูุงูุงุช ุงูุชู ุชู ุฅูุบุงุก ุถุบุทูุง ุจููุณูุง. <br><br>  ุซุงููุงู ุ ุฅุฐุง ุชู ุชุฎุฒูู ุงูุจูุงูุงุช ูุคูุชูุง ุ ููุฏ ูุง ุชุญุชุงุฌ ุฅูู ูุฑุงุกุฉ ุงูุจูุงูุงุช ูู ุงูุฃูุฑุงุต ุนูู ุงูุฅุทูุงู.  ููููู ุงูุงุนุชูุงุฏ ุนูู ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ููุตูุญุฉ ุฃู ุงุณุชุฎุฏุงู ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ุงูุฎุงุตุฉ ุจู.  ุงูุชุฎุฒูู ุงููุคูุช ุฃูุซุฑ ูุนุงููุฉ ูู ููุงุนุฏ ุงูุจูุงูุงุช ุงูููุฌูุฉ ููุฃุนูุฏุฉ ุ ุญูุซ ุชุจูู ุงูุฃุนูุฏุฉ ุงููุณุชุฎุฏูุฉ ุจุดูู ูุชูุฑุฑ ูู ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช.  ูุฐุง ูู ุงูุณุจุจ ูู ุฃู LZ4 ุบุงูุจูุง ูุง ูุจุฏู ุฃูู ุนูู ุงูุฒุฌุงุฌุฉ ูู ุญูุซ ุชุญููู ูุญุฏุฉ ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉ. <br><br>  ูุฐุง ูุทุฑุญ ุณุคุงููู ุขุฎุฑูู.  ุฃููุงู ุ ุฅุฐุง ูุงู ุชุฎููู ุงูุถุบุท ูุจุทุฆูุง ุ ููู ูุณุชุญู ุถุบุท ุงูุจูุงูุงุช ูุชุจุฏุฃุ  ููู ูุฐู ุงูุชูููุงุช ูุง ุนูุงูุฉ ููุง ุจุงูููุงุฑุณุฉ.  ุญุชู ููุช ูุฑูุจ ุ ูู ููุฏู ุชูููู ClickHouse ุณูู ุฎูุงุฑูู ูุถุบุท ุงูุจูุงูุงุช - LZ4 ู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Zstandard</a> .  ูุชู ุงุณุชุฎุฏุงู LZ4 ุจุดูู ุงูุชุฑุงุถู.  ุงูุชุญูู ุฅูู Zstandard ูุฌุนู ุงูุถุบุท ุฃููู ูุฃุจุทุฃ.  ูููู ูู ููู ููุงู ุฎูุงุฑ ูุชุนุทูู ุงูุถุบุท ุชูุงููุง ุ ุญูุซ ูููุชุฑุถ ุฃู LZ4 ูููุฑ ุงูุญุฏ ุงูุฃุฏูู ุงููุนููู ูู ุงูุถุบุท ุงูุฐู ูููู ุงุณุชุฎุฏุงูู ุฏุงุฆููุง.  (ููุฐุง ูู ุจุงูุถุจุท ุงูุณุจุจ ูู ุฃููู ุฃุญุจ LZ4.) <br><br>  ูููู ุจุนุฏ ุฐูู ุธูุฑ ุดุฎุต ุบุฑูุจ ุบุงูุถ ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุฏุฑุฏุดุฉ ุฏุนู ClickHouse ุงูุฏูููุฉ ุ</a> ููุงู ุฅู ูุฏูู ูุธุงููุง ูุฑุนููุง ุณุฑูุนูุง ูููุฑุต (ูุน NVMe SSD) ูุฃู ุงูุถุบุท ูู ุงูุดูุก ุงููุญูุฏ ุงูุฐู ูุจุทุฆ ูู ุงุณุชูุณุงุฑุงุชู ุ ูุฐูู ุณูููู ูู ุงูุฌูุฏ ุฃู ุชููู ูุงุฏุฑูุง ุนูู ุชุฎุฒูู ุงูุจูุงูุงุช ุฏูู ุถุบุท.  ุฃุฌุจุช ุฃูู ููุณ ูุฏููุง ูุฐุง ุงูุฎูุงุฑ ุ ููู ุณูููู ูู ุงูุณูู ุฅุถุงูุชู.  ุจุนุฏ ุจุถุนุฉ ุฃูุงู ุ ุชููููุง <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุทูุจ ุณุญุจ</a> ุชุทุจูู ุทุฑููุฉ ุงูุถุบุท <code>none</code> .  ููุฏ ุทูุจุช ูู ุงููุณุงูู ุชูุฏูู ุชูุฑูุฑ ุญูู ููุฏุงุฑ ูุฐุง ุงูุฎูุงุฑ ุงูุฐู ุณุงุนุฏ ูู ุชุณุฑูุน ุงูุงุณุชุนูุงูุงุช.  ูุงู ุงูุฑุฏ ุฃู ูุฐู ุงูููุฒุฉ ุงูุฌุฏูุฏุฉ ูุฏ ุชุญููุช ุฅูู ูุงุฆุฏุฉ ูู ุงููุงุญูุฉ ุงูุนูููุฉ ุ ุญูุซ ุจุฏุฃุช ุงูุจูุงูุงุช ุบูุฑ ุงููุถุบูุทุฉ ุชุดุบู ูุณุงุญุฉ ูุจูุฑุฉ ุนูู ุงููุฑุต ููู ุชุชูุงุณุจ ูุน ูุญุฑูุงุช ุฃูุฑุงุต NVMe ูุฐู. <br><br>  ุงูุณุคุงู ุงูุซุงูู ุงูุฐู ูุทุฑุญ ููุณู ูู ุฃูู ูู ุญุงูุฉ ูุฌูุฏ ุฐุงูุฑุฉ ุชุฎุฒูู ูุคูุช ุ ูููุงุฐุง ูุง ุชุณุชุฎุฏูู ูุชุฎุฒูู ุงูุจูุงูุงุช ุงูุชู ุชู ูู ุถุบุทูุง ุจุงููุนูุ  ูุฐุง ูู ุงุญุชูุงู ูุงุจู ููุชุทุจูู ูู ุดุฃูู ุฃู ููุบู ุงูุญุงุฌุฉ ุฅูู ุชุฎููู ุงูุถุบุท ูู ูุซูุฑ ูู ุงูุญุงูุงุช.  ูุญุชูู ClickHouse ุฃูุถูุง ุนูู ุฐุงูุฑุฉ ุชุฎุฒูู ูุคูุช ูุซู ูุฐุง: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ูููุชู ุงูุชู ุชู ูู ุถุบุทูุง</a> .  ูููู ูู ุงููุคุณู ุฃู ูุถูุน ุงููุซูุฑ ูู ุฐุงูุฑุฉ ุงููุตูู ุงูุนุดูุงุฆู ุนูู ูุฐุง.  ูุฐูู ุนุงุฏุฉ ูุง ูููู ูู ุงูููุทูู ููุท ุงุณุชุฎุฏุงู ุทูุจุงุช ุงูุจุญุซ ุงูุตุบูุฑุฉ ูุงููุชุณูุณูุฉ ุงูุชู ุชุณุชุฎุฏู ุจูุงูุงุช ูุชุทุงุจูุฉ ุชูุฑูุจูุง. <br><br>  ุงุณุชูุชุงุฌูุง ูู ุฃูู ูู ุงูุฃูุถู ุฏุงุฆููุง ุชุฎุฒูู ุงูุจูุงูุงุช ุจุชูุณูู ูุถุบูุท.  ุฏุงุฆูุง ูุชุงุจุฉ ุงูุจูุงูุงุช ุฅูู ุงููุฑุต ูู ุดูู ูุถุบูุท.  ููู ุงูุจูุงูุงุช ุนุจุฑ ุงูุดุจูุฉ ูุน ุงูุถุบุท ุ ูุฐูู.  ูู ุฑุฃูู ุ ูุฅู ุงูุถุบุท ุงูุงูุชุฑุงุถู ูู ูุง ูุจุฑุฑู ุญุชู ุนูุฏ ููู ุงูุจูุงูุงุช ุฏุงุฎู ูุฑูุฒ ุจูุงูุงุช ูุงุญุฏ ูู ุดุจูุฉ ุจุญุฌู 10 ุฌูุฌุงุจุงูุช ุฏูู ุฒูุงุฏุฉ ุงูุงุดุชุฑุงู ุ ูู ุญูู ุฃู ููู ุงูุจูุงูุงุช ุบูุฑ ุงููุถุบูุทุฉ ุจูู ูุฑุงูุฒ ุงูุจูุงูุงุช ุฃูุฑ ุบูุฑ ููุจูู. <br><br><h3 style=";text-align:right;direction:rtl">  ููุงุฐุง LZ4ุ </h3><br>  ููุงุฐุง ุชุฎุชุงุฑ LZ4ุ  ูุง ูููู ุฃู ูุฎุชุงุฑ ุดูุฆุง ุฃุฎู ูุฒูุงุ  ูุธุฑูุง ุ ูููููุง ุ ููุฐุง ูู ุงูููุฑ ุงูุฌูุฏ.  ูููู ุฏุนููุง ูููู ูุธุฑุฉ ุนูู ูุฆุฉ ุงูุฎูุงุฑุฒููุงุช ุงูุชู ููุชูู ุฅูููุง LZ4. <br><br>  ุจุงุฏุฆ ุฐู ุจุฏุก ุ ุฅูู ุนุงู ููุง ูุชููู ูุน ููุน ุงูุจูุงูุงุช.  ุนูู ุณุจูู ุงููุซุงู ุ ุฅุฐุง ููุช ุชุนูู ููุฏููุง ุฃูู ุณูููู ูุฏูู ูุฌููุนุฉ ูู ุงูุฃุนุฏุงุฏ ุงูุตุญูุญุฉ ุ ููููู ุงุณุชุฎุฏุงู ุฅุญุฏู ุฎูุงุฑุฒููุงุช VarInt ูุณูุณุชุฎุฏู ุฐูู ูุญุฏุฉ ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉ ุจุดูู ุฃูุซุฑ ูุนุงููุฉ.  ุซุงููุงู ุ LZ4 ูุง ูุนุชูุฏ ุจุดูู ููุฑุท ุนูู ุงูุชุฑุงุถุงุช ุทุฑุงุฒ ุงูุจูุงูุงุช.  ูููุชุฑุถ ุฃู ูุฏูู ุณูุณูุฉ ุฒูููุฉ ูุฑุชุจุฉ ูู ููู ุงููุณุชุดุนุฑ ุ ููุฌููุนุฉ ูู ุฃุฑูุงู ุงููุงุตูุฉ ุงูุนุงุฆูุฉ.  ุฅุฐุง ุฃุฎุฐุช ูุฐุง ูู ุงูุงุนุชุจุงุฑ ุ ููููู ุญุณุงุจ ุงูุฏูุชุง ุจูู ูุฐู ุงูุฃุฑูุงู ุซู ุถุบุทูุง ุจุงุณุชุฎุฏุงู ุฎูุงุฑุฒููุฉ ุนุงูุฉ ุ ููุง ูุคุฏู ุฅูู ุงุฑุชูุงุน ูุณุจุฉ ุงูุถุบุท. <br><br>  ูู ุชูุงุฌู ุฃู ูุดุงูู ุนูุฏ ุงุณุชุฎุฏุงู LZ4 ูุน ุฃู ุตูุงุฆู ุจุงูุช ุฃู ุฃู ูููุงุช.  ุจุงูุทุจุน ูุฏูู ุชุฎุตุต (ุฃูุซุฑ ุนูู ุฐูู ูุงุญููุง) ุ ููู ุจุนุถ ุงูุญุงูุงุช ูููู ุงุณุชุฎุฏุงูู ุจูุง ูุงุฆุฏุฉ.  ูููู ุฅุฐุง ูุณูููุง ุฎูุงุฑุฒููุฉ ููุฃุบุฑุงุถ ุงูุนุงูุฉ ุ ูุณูููู ูุฑูุจูุง ูู ุงูุญูููุฉ.  ุชุฌุฏุฑ ุงูุฅุดุงุฑุฉ ุฅูู ุฃูู ุจูุถู ุงูุชุตููู ุงูุฏุงุฎูู ุ ุชููู LZ4 ุชููุงุฆููุง ุจุชูููุฐ ุฎูุงุฑุฒููุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">RLE</a> ูุญุงูุฉ ุฎุงุตุฉ. <br><br>  ููุน ุฐูู ุ ูุฅู ุงูุณุคุงู ุงูุฃูุซุฑ ุฃูููุฉ ูู ูุง ุฅุฐุง ูุงู LZ4 ูู ุงูุฎูุงุฑุฒููุฉ ุงููุซูู ููุฐู ุงููุฆุฉ ูู ุญูุซ ุงูุณุฑุนุฉ ุงููููุฉ ูููุฉ ุงูุงูุถุบุงุท.  ุชูุณูู ุงูุฎูุงุฑุฒููุงุช ุงููุซุงููุฉ "ุญุฏูุฏ Pareto" ุ ููุง ูุนูู ุฃูู ูุง ุชูุฌุฏ ุฎูุงุฑุฒููุฉ ุฃุฎุฑู ุฃูุถู ุจุดูู ููุงุฆู ุจุทุฑููุฉ ุฃู ุจุฃุฎุฑู ูู ุฃุณูุฃ (ุจุทุฑู ูุงุณุนุฉ ููุชููุนุฉ ูู ูุฌููุนุงุช ุงูุจูุงูุงุช ุฃูุถูุง).  ุชููู ุจุนุถ ุงูุฎูุงุฑุฒููุงุช ุฃุณุฑุน ูููููุง ุชุคุฏู ุฅูู ูุณุจุฉ ุถุบุท ุฃุตุบุฑ ุ ูู ุญูู ุฃู ุงูุจุนุถ ุงูุขุฎุฑ ูุฏูู ุถุบุท ุฃููู ููููู ุฃุจุทุฃ ูู ุงูุถุบุท ุฃู ุงูุถุบุท. <br><br>  ุจุตุฑุงุญุฉ ุ ููุณุช LZ4 ุญุฏูุฏ Pareto ุญููุง - ูููุงู ุจุนุถ ุงูุฎูุงุฑุงุช ุงููุชุงุญุฉ ุงูุชู ุชุนุฏ ุฃูุถู ููููุงู.  ุนูู ุณุจูู ุงููุซุงู ุ ุงูุธุฑ ุฅูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">LZTURBO</a> ูู ูุทูุฑ ูุทูู ุนููู ุงุณู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">powturbo</a> .  ููุณ ููุงู ุดู ูู ููุซูููุฉ ุงููุชุงุฆุฌ ุ ูุฐูู ุจูุถู ูุฌุชูุน <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">encode.ru</a> (ููู ุฃูุจุฑ ููุชุฏู ุนูู ุงูุฃุฑุฌุญ ูุถุบุท ุงูุจูุงูุงุช).  ูุณูุก ุงูุญุธ ุ ูุง ูููู ุงููุทูุฑ ุจุชูุฒูุน ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ุงููุตุฏุฑ ุฃู ุงูุซูุงุฆูุงุช.  ูุง ุชุชููุฑ ุฅูุง ูุนุฏุฏ ูุญุฏูุฏ ูู ุงูุฃุดุฎุงุต ููุงุฎุชุจุงุฑ ุ ุฃู ููุงุจู ุงููุซูุฑ ูู ุงููุงู (ุนูู ุงูุฑุบู ูู ุฃูู ูุง ูุจุฏู ุฃู ุฃุญุฏุง ูุฏ ุฏูุน ุซูููุง ุ ุญุชู ุงูุขู).  ููููู ุฃูุถูุง ุฅููุงุก ูุธุฑุฉ ุนูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Lizard</a> (LZ5 ุณุงุจููุง) <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุงููุซุงูุฉ</a> .  ูุฏ ุชุนูู ุจุดูู ุฃูุถู ููููุงู ูู LZ4 ุนูุฏ ุชุญุฏูุฏ ูุณุชูู ุถุบุท ูุนูู.  ุฎูุงุฑ ุขุฎุฑ ูุซูุฑ ููุงูุชูุงู ุญูุง ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">LZSSE</a> .  ูููู ุงูุงูุชูุงุก ูู ูุฑุงุกุฉ ูุฐู ุงูููุงูุฉ ูุจู ุงูุชุญูู ูู ุฐูู. <br><br><h3 style=";text-align:right;direction:rtl">  ููู ูุนูู LZ4 </h3><br>  ุฏุนููุง ููุธุฑ ูู ููููุฉ ุนูู LZ4 ุจุดูู ุนุงู.  ูุฐุง ุฃุญุฏ ุชุทุจููุงุช ุฎูุงุฑุฒููุฉ LZ77.  ุชูุซู L ู Z ุฃุณูุงุก ุงููุทูุฑูู (Lempel ู Ziv) ุ ู 77 ูู ุนุงู 1977 ุนูุฏูุง ุชู ูุดุฑ ุงูุฎูุงุฑุฒููุฉ.  ูุฏููุง ุงูุนุฏูุฏ ูู ุงูุชุทุจููุงุช ุงูุฃุฎุฑู: QuickLZ ู FastLZ ู BriefLZ ู LZF ู LZO ู gzip ู zip ุฅุฐุง ุชู ุงุณุชุฎุฏุงู ูุณุชููุงุช ุถุบุท ููุฎูุถุฉ. <br><br>  ุชุญุชูู ูุชูุฉ ุงูุจูุงูุงุช ุงููุถุบูุทุฉ ุจุงุณุชุฎุฏุงู LZ4 ุนูู ุณูุณูุฉ ูู ุงูุฅุฏุฎุงูุงุช (ุงูุฃูุงูุฑ ุฃู ุงูุชุนูููุงุช) ูู ููุนูู: <br><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุญุฑููุฉ: "ุฎุฐ ุงูุจุงูุชุงุช N ุงูุชุงููุฉ ููุง ูู ูุงูุณุฎูุง ุฅูู ุงููุชูุฌุฉ". </li><li style=";text-align:right;direction:rtl">  ุงููุทุงุจูุฉ: "ุฎุฐ N ุจุงูุช ูู ุงููุชูุฌุฉ ุงูุชู ุชู ูู ุถุบุทูุง ุจุฏุกูุง ูู ูููุฉ ุงูุฅุฒุงุญุฉ ุจุงููุณุจุฉ ููููุถุน ุงูุญุงูู". </li></ol><br>  ุงููุซุงู.  ูุจู ุงูุถุบุท: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">Hello world Hello</code> </pre> <br>  ุจุนุฏ ุงูุถุบุท: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">literals 12 "Hello world " match 5 12</code> </pre> <br>  ุฅุฐุง ุฃุฎุฐูุง ูุชูุฉ ูุถุบูุทุฉ ููุฑุฑูุง ุงููุคุดุฑ ุฎูุงูู ุฃุซูุงุก ุชุดุบูู ูุฐู ุงูุฃูุงูุฑ ุ ูุณูุญุตู ุนูู ุงูุจูุงูุงุช ุบูุฑ ุงููุถุบูุทุฉ ุงูุฃุตููุฉ ููุชูุฌุฉ ูุฐูู. <br><br>  ูุฐูู ูุฐุง ูู ุงูุฃุณุงุณ ููู ูุชู ุฅูุบุงุก ุถุบุท ุงูุจูุงูุงุช.  ุงูููุฑุฉ ุงูุฃุณุงุณูุฉ ูุงุถุญุฉ: ูุฅุฌุฑุงุก ุงูุถุบุท ุ ุชููู ุงูุฎูุงุฑุฒููุฉ ุจุชุฑููุฒ ุชุณูุณู ูุชูุฑุฑ ูู ูุญุฏุงุช ุงูุจุงูุช ุจุงุณุชุฎุฏุงู ุงูุชุทุงุจูุงุช. <br><br>  ุจุนุถ ุงูุฎุตุงุฆุต ูุงุถุญุฉ ุฃูุถุง.  ูุฐู ุงูุฎูุงุฑุฒููุฉ ุงูููุฌูุฉ ูุญู ุงูุจุงูุช ูุง ุชุดุฑูุญ ุงูุจุงูุชุงุช ุงููุฑุฏูุฉ ุ  ุงููุง ููุท ูุณุฎูุง ูู ูุฌูููุง.  ูุฐู ูู ุงูุทุฑููุฉ ุงูุชู ูุฎุชูู ุนู ุชุฑููุฒ ุงูุงูุชุฑูุจูุง.  ุนูู ุณุจูู ุงููุซุงู ุ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">zstd</a> ุนุจุงุฑุฉ ุนู ูุฒูุฌ ูู LZ77 ูุชุฑููุฒ ุฅูุชุฑูุจู. <br><br>  ูุงุญุธ ุฃูู ูุฌุจ ุฃูุง ูููู ุญุฌู ุงููุชูุฉ ุงููุถุบูุทุฉ ูุจูุฑูุง ุฌุฏูุง.  ูุชู ุงุฎุชูุงุฑ ุงูุญุฌู ูุชุฌูุจ ุฅูุฏุงุฑ ุงููุซูุฑ ูู ุฐุงูุฑุฉ ุงููุตูู ุงูุนุดูุงุฆู ุฃุซูุงุก ุฅูุบุงุก ุงูุถุบุท ุ ูุชุฌูุจ ุฅุจุทุงุก ุงููุตูู ุงูุนุดูุงุฆู ุฃูุซุฑ ูู ุงููุงุฒู ูู ุงูููู ุงููุถุบูุท (ุงูุฐู ูุชููู ูู ุนุฏุฏ ูุจูุฑ ูู ุงููุชู ุงููุถุบูุทุฉ) ุ ูุฃุญูุงููุง ุญุชู ูุชู ุงุญุชูุงุก ุงููุชูุฉ ูู ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช CPU.  ุนูู ุณุจูู ุงููุซุงู ุ ููููู ุงุฎุชูุงุฑ 64 ูููู ุจุงูุช ุจุญูุซ ูุชู ุงุญุชูุงุก ุงููุฎุงุฒู ุงููุคูุชุฉ ููุจูุงูุงุช ุงููุถุบูุทุฉ ูุบูุฑ ุงููุถุบูุทุฉ ูู ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช L2 ูุน ูุตู ูุง ุฒุงู ูุฌุงูููุง. <br><br>  ุฅุฐุง ุงุญุชุฌูุง ุฅูู ุถุบุท ููู ุฃูุจุฑ ุ ูููููุง ุชูุตูู ุงููุชู ุงููุถุบูุทุฉ.  ูุฐุง ุฃูุถูุง ููุงุณุจ ูุชุฎุฒูู ุจูุงูุงุช ุฅุถุงููุฉ (ูุซู ุงููุฌููุน ุงูุงุฎุชุจุงุฑู) ูุน ูู ูุชูุฉ ูุถุบูุทุฉ. <br><br>  ุงูุญุฏ ุงูุฃูุตู ููุชุนููุถ ุนู ุงููุจุงุฑุงุฉ ูุญุฏูุฏ.  ูู LZ4 ุ ุงูุญุฏ ุงูุฃูุตู ูู 64 ูููู ุจุงูุช.  ูุฐุง ุงููุจูุบ ูุณูู ุงููุงูุฐุฉ ุงูููุฒููุฉ.  ูุฐุง ูุนูู ุฃูู ูููู ุงูุนุซูุฑ ุนูู ุงูุชุทุงุจูุงุช ูู ูุงูุฐุฉ ูู 64 ูููู ุจุงูุช ุชุณุจู ุงููุคุดุฑ ุ ูุงูุฐู ููุฒูู ูุน ุงููุคุดุฑ ุฃุซูุงุก ุชุญุฑูู ููุฃูุงู. <br><br>  ุงูุขู ููููู ูุธุฑุฉ ุนูู ููููุฉ ุถุบุท ุงูุจูุงูุงุช ุ ุฃู ุจูุนูู ุขุฎุฑ ุ ููููุฉ ุงูุนุซูุฑ ุนูู ุชุณูุณูุงุช ูุทุงุจูุฉ ูู ููู.  ููููู ุฏุงุฆููุง ุงุณุชุฎุฏุงู ุงููุงุญูุฉ (ุฅูู ุฃูุฑ ุฑุงุฆุน ุฅุฐุง ููุช ูุฏ ุณูุนุช ุจูุฐุง ุจุงููุนู).  ููุงู ุทุฑู ุชุถูู ูุฌูุฏ ุฃุทูู ุชุทุงุจู ูู ุงูุจุงูุชุงุช ุงูุณุงุจูุฉ ุจุนุฏ ุงูุถุบุท.  ููุณูู ูุฐุง ุงูุชุญููู ุงูุฃูุซู ููููุฑ ุฃูุถู ูุณุจุฉ ุถุบุท ุชูุฑูุจูุง ูููุชูุฉ ุงููุถุบูุทุฉ ุฐุงุช ุงูุชูุณูู ุงูุซุงุจุช.  ูููู ููุงู ุทุฑููุง ุฃูุถู ุ ูุซู ุงูุนุซูุฑ ุนูู ุชุทุงุจู ุฌูุฏ ุจูุง ูููู ููุณ ุจุงูุถุฑูุฑุฉ ุงูุฃุทูู.  ุงูุทุฑููุฉ ุงูุฃูุซุฑ ูุงุนููุฉ ููุนุซูุฑ ุนููู ูู ุงุณุชุฎุฏุงู ุฌุฏูู ุงูุชุฌุฒุฆุฉ. <br><br>  ููููุงู ุจุฐูู ุ ูููู ุจุชูุฑุงุฑ ุงููุคุดุฑ ูู ุฎูุงู ูุชูุฉ ุงูุจูุงูุงุช ุงูุฃุตููุฉ ููุฃุฎุฐ ุจุถุน ุจุงูุชุงุช ุจุนุฏ ุงููุคุดุฑ (ุฏุนูุง ูููู 4 ุจุงูุช).  ูููู ุจุชุฌููุนูุง ููุถุน ุงูุฅุฒุงุญุฉ ูู ุจุฏุงูุฉ ุงููุชูุฉ (ุญูุซ ุชู ููู ูุญุฏุงุช ุงูุจุงูุช ุงูุฃุฑุจุน) ูู ุฌุฏูู ุงูุชุฌุฒุฆุฉ.  ุชุณูู ุงููููุฉ 4 "min-match" - ุจุงุณุชุฎุฏุงู ุฌุฏูู ุงูุชุฌุฒุฆุฉ ูุฐุง ุ ูููููุง ุงูุนุซูุฑ ุนูู ุชุทุงุจูุงุช ูุง ุชูู ุนู 4 ุจุงูุช. <br><br>  ุฅุฐุง ูุธุฑูุง ุฅูู ุฌุฏูู ุงูุชุฌุฒุฆุฉ ููู ุจุงููุนู ุณุฌู ูุทุงุจู ุ ููู ูุชุฌุงูุฒ ุงูุฅุฒุงุญุฉ ุงููุงูุฐุฉ ุงูููุฒูู ุ ูุฅููุง ูุชุญูู ููุนุฑูุฉ ุนุฏุฏ ุงูุจุงูุชุงุช ุงูุฅุถุงููุฉ ุงูุชู ุชุชุทุงุจู ุจุนุฏ ุชูู ุงูุจุงูุชุงุช ุงูุฃุฑุจุนุฉ.  ุฑุจูุง ููุงู ุงููุซูุฑ ูู ุงููุจุงุฑูุงุช.  ูู ุงููููู ุฃูุถูุง ุฃู ูููู ููุงู ุชุตุงุฏู ูู ุฌุฏูู ุงูุชุฌุฒุฆุฉ ููุง ููุฌุฏ ุดูุก ูุทุงุจู ุ ููู ูุฐู ููุณุช ูุดููุฉ ูุจูุฑุฉ.  ููููู ููุท ุงุณุชุจุฏุงู ุงููููุฉ ูู ุฌุฏูู ุงูุชุฌุฒุฆุฉ ุจุขุฎุฑ ุฌุฏูุฏ.  ุณูู ูุคุฏู ุงูุชุตุงุฏู ูู ุฌุฏูู ุงูุชุฌุฒุฆุฉ ุจุจุณุงุทุฉ ุฅูู ุงูุฎูุงุถ ูุณุจุฉ ุงูุถุบุท ุ ุญูุซ ุณูููู ููุงู ุนุฏุฏ ุฃูู ูู ุงูุชุทุงุจูุงุช.  ุจุงูููุงุณุจุฉ ุ ูุณูู ูุฐุง ุงูููุน ูู ุฌุฏูู ุงูุชุฌุฒุฆุฉ (ุจุญุฌู ุซุงุจุช ูุจุฏูู ุฃู ุชุตุงุฏู) "ุฌุฏูู ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช".  ูุฐุง ุงูุงุณู ููุทูู ูุฃูู ูู ุญุงูุฉ ุญุฏูุซ ุชุตุงุฏู ุ ููุณู ุฌุฏูู ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ุจุจุณุงุทุฉ ุงูุฅุฏุฎุงู ุงููุฏูู. <br><br><blockquote style=";text-align:right;direction:rtl">  ุชุญุฏ ูููุงุฑุฆ ุงูุฏููู.  ูููุชุฑุถ ุฃู ุงูุจูุงูุงุช ุนุจุงุฑุฉ ุนู ุตููู ูู ุฃุฑูุงู UInt32 ุจุชูุณูู ุฏุงุฎูู ุตุบูุฑ ููุซู ุฌุฒุกูุง ูู ุณูุณูุฉ ูู ุงูุฃุฑูุงู ุงูุทุจูุนูุฉ: 0 ุ 1 ุ 2 ... ุงุดุฑุญ ููุงุฐุง ูุง ูุชู ุถุบุท ูุฐู ุงูุจูุงูุงุช ุนูุฏ ุงุณุชุฎุฏุงู LZ4 (ุญุฌู ุงูุจูุงูุงุช ุงููุถุบูุทุฉ ููุณ ุฃุตุบุฑ ููุงุฑูุฉู ุจุงูุจูุงูุงุช ุบูุฑ ุงููุถุบูุทุฉ). </blockquote><br><h3 style=";text-align:right;direction:rtl">  ููููุฉ ุชุณุฑูุน ูู ุดูุก </h3><br>  ูุฐูู ุฃุฑูุฏ ุฃู ุชุณุฑูุน LZ4 ุงูุถุบุท.  ุฏุนููุง ูุฑู ููู ุชุจุฏู ุญููุฉ ุงูุถุบุท.  ููู ููุง ูู ุงูููุฏ ุงููุงุฐุจ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">while (...) {    read(input_pos, literal_length, match_length);    copy(output_pos, input_pos, literal_length);    output_pos += literal_length;    read(input_pos, match_offset);    copy(output_pos, output_pos - match_offset,        match_length);    output_pos += match_length; }</code> </pre> <br>  ุชู ุชุตููู ุชูุณูู LZ4 ุจุญูุซ ุชุชูุงูู ุงูููู ุงูุญุฑููุฉ ูุงููุทุงุจูุงุช ูู ููู ูุถุบูุท.  ูู ุงููุงุถุญ ุฃู ุงูุญุฑูู ูุฃุชู ุฏุงุฆููุง ุฃููุงู (ูุฃูู ูุง ููุฌุฏ ููุงู ููุนุจ ูุจุงุฑุงุฉ ูู ุงูุจุฏุงูุฉ).  ูุฐูู ุ ูุชู ุชุฑููุฒ ุฃุทูุงููุง ูุนูุง. <br><br>  ุงููุง ูู ุงููุงูุน ุฃูุซุฑ ุชุนููุฏุง ููููุง ูู ุฐูู.  ุชุชู ูุฑุงุกุฉ ุจุงูุช ูุงุญุฏ ูู ุงูููู ุ ุซู ูุชู ุชูุณููู ุฅูู ูุณููู (ูุตู ุจุงูุช) ูุญุชูู ุนูู ุงูุฃุฑูุงู ุงููุดูุฑุฉ ูู 0 ุฅูู 15. ุฅุฐุง ูุงู ุงูุฑูู ุงูููุงุจู ููุณ 15 ุ ููู ุงูููุชุฑุถ ุฃู ูููู ุทูู ุงูุญุฑูู ูุงููุทุงุจูุฉ ุ ุนูู ุงูุชูุงูู.  ูุฅุฐุง ูุงู ุงูุฑูู 15 ุ ูููู ุงูุทูู ุฃุทูู ููุชู ุชุฑููุฒู ุจุงูุจุงูุชุงุช ุงูุชุงููุฉ.  ุซู ูุชู ูุฑุงุกุฉ ุงูุจุงูุช ุงูุชุงูู ุ ูุชุชู ุฅุถุงูุฉ ูููุชู ุฅูู ุงูุทูู.  ุฅุฐุง ูุงู ูุณุงูู 255 ุ ูุชู ุชูููุฐ ููุณ ุงูุดูุก ูุน ุงูุจุงูุช ุงูุชุงูู. <br><br>  ูุงุญุธ ุฃู ุงูุญุฏ ุงูุฃูุตู ููุณุจุฉ ุงูุถุบุท ูุชูุณูู LZ4 ูุง ูุตู ุฅูู 255. ูููุงู ููุงุญุธุฉ ุฃุฎุฑู ุนุฏููุฉ ุงููุงุฆุฏุฉ ููู ุฃูู ุฅุฐุง ูุงูุช ุจูุงูุงุชู ุฒุงุฆุฏุฉ ุนู ุงูุญุงุฌุฉ ุ ูุฅู ุงุณุชุฎุฏุงู LZ4 ูุฑุชูู ุณูุคุฏู ุฅูู ุชุญุณูู ูุณุจุฉ ุงูุถุบุท. <br><br>  ุนูุฏูุง ููุฑุฃ ุทูู ุงูุญุฑู (ุซู ุทูู ุงููุทุงุจูุฉ ูุฅุฒุงุญุฉ ุงููุทุงุจูุฉ) ุ ูุฅู ูุฌุฑุฏ ูุณุฎ ูุชูุชูู ูู ุงูุฐุงูุฑุฉ ูููู ูุฅูุบุงุก ุถุบุทู. <br><br><h3 style=";text-align:right;direction:rtl">  ููููุฉ ูุณุฎ ูุชูุฉ ุงูุฐุงูุฑุฉ </h3><br>  ูุจุฏู ุฃูู ููููู ููุท ุงุณุชุฎุฏุงู ูุธููุฉ <code>memcpy</code> ุ ุงููุตููุฉ ููุณุฎ ูุชู ุงูุฐุงูุฑุฉ.  ููู ูุฐุง ููุณ ูู ุงูููุฌ ุงูุฃูุซู ูุบูุฑ ุงูููุงุณุจ ุญููุง. <br><br>  ุงุณุชุฎุฏุงู memcpy ููุณ ูู ุงูุฃูุซู ูุฃูู: <br><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุนุงุฏุฉู ูุง ุชููู ููุฌูุฏุฉ ูู ููุชุจุฉ libc (ูุนุงุฏุฉู ูุง ุชููู ููุชุจุฉ libc ูุฑุชุจุทุฉ ุฏููุงูููููุง ุ ูุฐูู ุณูุชู ุฅุฌุฑุงุก ููุงููุฉ memcpy ุจุดูู ุบูุฑ ูุจุงุดุฑ ุนุจุฑ PLT). </li><li style=";text-align:right;direction:rtl">  ูุง ูุชู ุชุถูููู ุจูุงุณุทุฉ ุจุฑูุงูุฌ ุงูุชุญููู ุงูุจุฑูุฌู ุฅุฐุง ูุงูุช ูุณูุทุฉ ุงูุญุฌู ุบูุฑ ูุนุฑููุฉ ูู ููุช ุงูุชุฑุฌูุฉ. </li><li style=";text-align:right;direction:rtl">  ูุจุฐู ุงููุซูุฑ ูู ุงูุฌูุฏ ููุนุงูุฌุฉ ูุฎููุงุช ูุชูุฉ ุงูุฐุงูุฑุฉ ุจุดูู ุตุญูุญ ูุงูุชู ููุณุช ูุถุงุนูุงุช ูุทูู ูููุฉ ุงูุฌูุงุฒ ุฃู ุงูุชุณุฌูู. </li></ol><br>  ุงูููุทุฉ ุงูุฃุฎูุฑุฉ ูู ุงูุฃูุซุฑ ุฃูููุฉ.  ูููุชุฑุถ ุฃููุง ุทูุจูุง ูู ูุธููุฉ memcpy ูุณุฎ 5 ุจุงูุช ุจุงูุถุจุท.  ุณูููู ูู ุงูุฑุงุฆุน ูุณุฎ 8 ุจุงูุช ุนูู ุงูููุฑ ุ ุจุงุณุชุฎุฏุงู ุฅุฑุดุงุฏุงุช movq. <br><br> <code>Hello world <font color="#0fc000">Hello</font> <font color="#ff0000">wo</font> ... <br> ^^^^^ <font color="#ff0000">^^^</font> - src <br> ^^^^^ <font color="#ff0000">^^^</font> - dst</code> <br> <br>  ูููู ุจุนุฏ ุฐูู ุณูููู ุจูุณุฎ ุซูุงุซ ุจุงูุชุงุช ุฅุถุงููุฉ ุ ูุฐูู ุณููุชุจ ุฎุงุฑุฌ ุงูุญุฏูุฏ ุงูุนุงุฒูุฉ.  ูุง ุชููู ูุธููุฉ <code>memcpy</code> ุงูุฅุฐู ููููุงู ุจุฐูู ุ ูุฃููุง ูููู ุฃู ุชุณุชุจุฏู ุจุนุถ ุงูุจูุงูุงุช ูู ุจุฑูุงูุฌูุง ูุชุคุฏู ุฅูู ุฎูู ูู ุงูุฐุงูุฑุฉ.  ูุฅุฐุง ูุชุจูุง ุฅูู ุนููุงู ุบูุฑ ูุญุงุฐู ุ ูุฅู ูุฐู ุงูุจุงูุชุงุช ุงูุฅุถุงููุฉ ูููู ุฃู ุชูุจุท ุนูู ุตูุญุฉ ุบูุฑ ูุฎุตุตุฉ ูู ุงูุฐุงูุฑุฉ ุงูุธุงูุฑูุฉ ุฃู ุนูู ุตูุญุฉ ุจุฏูู ุญู ุงููุตูู ูููุชุงุจุฉ.  ูู ุดุฃููุง ุฃู ุชุนุทููุง ุฎุทุฃ ุชุฌุฒุฆุฉ (ูุฐุง ุฃูุฑ ุฌูุฏ). <br><br>  ูููู ูู ุญุงูุชูุง ุ ูููููุง ุฏุงุฆููุง ูุชุงุจุฉ ุจุงูุชุงุช ุฅุถุงููุฉ.  ูููููุง ูุฑุงุกุฉ ูุญุฏุงุช ุงูุจุงูุช ุงูุฅุถุงููุฉ ูู ูุฎุฒู ุงูุฅุฏุฎุงู ุงููุคูุช ุทุงููุง ุชูุฌุฏ ูุญุฏุงุช ุงูุจุงูุช ุงูุฅุถุงููุฉ ุจุงููุงูู ุฏุงุฎููุง.  ูู ุธู ููุณ ุงูุธุฑูู ุ ูููููุง ูุชุงุจุฉ ุงูุจุงูุชุงุช ุงูุฅุถุงููุฉ ุฅูู ุงููุฎุฒู ุงููุคูุช ููุฅุฎุฑุงุฌ ุ ูุฃููุง ุณูุณุชูุฑ ูู ุงููุชุงุจุฉ ุนูููุง ูู ุงูุชูุฑุงุฑ ุงูุชุงูู. <br><br>  ูุฐุง ุงูุชุญุณูู ููุฌูุฏ ุจุงููุนู ูู ุงูุชุทุจูู ุงูุฃุตูู ูู LZ4: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">inline void copy8(UInt8 * dst, const UInt8 * src) {    memcpy(dst, src, 8); /// Note that memcpy isn't actually called here. } inline void wildCopy8(UInt8 * dst, const UInt8 * src, UInt8 * dst_end) {    do    {        copy8(dst, src);        dst += 8;        src += 8;    } while (dst &lt; dst_end); }</code> </pre> <br>  ููุงุณุชูุงุฏุฉ ูู ูุฐุง ุงูุชุญุณูู ุ ูุญุชุงุฌ ููุท ุฅูู ุงูุชุฃูุฏ ูู ุฃููุง ุจุนูุฏูู ุจูุง ููู ุงูููุงูุฉ ุนู ุงูุญุฏูุฏ ุงูุนุงุฒูุฉ.  ูุง ููุจุบู ุฃู ูููู ูุฐุง ุฃู ุดูุก ุ ูุฃููุง ูุชุญูู ุจุงููุนู ูู ุชุฌุงูุฒ ุณุนุฉ ุงููุฎุฒู ุงููุคูุช.  ููุนุงูุฌุฉ ุงูุจุงูุชุงุช ุงูููููุฉ ุงููุงุถูุฉ ุ ุจูุงูุงุช "ุจูุงูุง" ุ ูููู ุงูููุงู ุจู ุจุนุฏ ุงูุญููุฉ ุงูุฑุฆูุณูุฉ. <br><br>  ููุน ุฐูู ุ ูุง ุชุฒุงู ููุงู ุจุนุถ ุงููุฑูู ุงูุฏูููุฉ.  ูุญุฏุซ ุงููุณุฎ ูุฑุชูู ูู ุงูุญููุฉ: ูุน ุญุฑูู ููุจุงุฑุงุฉ.  ููุน ุฐูู ุ ุนูุฏ ุงุณุชุฎุฏุงู ุงูุฏุงูุฉ <code>LZ4_decompress_fast</code> (ุจุฏูุงู ูู <code>LZ4_decompress_safe</code> ) ุ ูุชู ุฅุฌุฑุงุก ุงูุชุญูู ูุฑุฉ ูุงุญุฏุฉ ููุท ุ ุนูุฏูุง ูุญุชุงุฌ ุฅูู ูุณุฎ ุงูุญุฑูู.  ูุง ูุชู ุฅุฌุฑุงุก ุงูุชุญูู ุนูุฏ ูุณุฎ ุงููุทุงุจูุฉ ุ ูููู <a href="">ููุงุตูุงุช ุชูุณูู LZ4</a> ููุง ุดุฑูุท ุชุณูุญ ูู <a href="">ุจุชุฌูุจู</a> : <br><br><blockquote style=";text-align:right;direction:rtl">  ุงูุจุงูุช ุงูุฎูุณ ุงูุฃุฎูุฑุฉ ูู ุฏุงุฆููุง ุญุฑููุฉ. <br>  ูุฌุจ ุฃู ุชุจุฏุฃ ุงููุทุงุจูุฉ ุงูุฃุฎูุฑุฉ 12 ุจุงูุช ุนูู ุงูุฃูู ูุจู ููุงูุฉ ุงููุชูุฉ. <br>  ูุจุงูุชุงูู ุ ูุง ูููู ุถุบุท ูุชูุฉ ุจูุง ุฃูู ูู 13 ุจุงูุช. </blockquote><br>  ูุฏ ุชุคุฏู ุจูุงูุงุช ุงูุฅุฏุฎุงู ุงููุญุฏุฏุฉ ุจุดูู ุฎุงุต ุฅูู ุชูู ุงูุฐุงูุฑุฉ.  ุฅุฐุง ููุช ุชุณุชุฎุฏู ูุธููุฉ <code>LZ4_decompress_fast</code> ุ ูุฃูุช ุจุญุงุฌุฉ ุฅูู ุงูุญูุงูุฉ ูู ุงูุจูุงูุงุช ุงูุณูุฆุฉ.  ุนูู ุงูุฃูู ุ ูุฌุจ ุนููู ุญุณุงุจ ุงููุฌููุน ุงูุงุฎุชุจุงุฑู ููุจูุงูุงุช ุงููุถุบูุทุฉ.  ุฅุฐุง ููุช ุจุญุงุฌุฉ ุฅูู ุงูุญูุงูุฉ ูู ุงููุชุณูููู ุ <code>LZ4_decompress_safe</code> ุงูุฏุงูุฉ <code>LZ4_decompress_safe</code> .  ุฎูุงุฑุงุช ุฃุฎุฑู: ุฎุฐ ูุธููุฉ ุชุฌุฒุฆุฉ ุงูุชุดููุฑ ูุงุฎุชุจุงุฑู (ุนูู ุงูุฑุบู ูู ุฃู ูุฐุง ูู ุงููุญุชูู ุฃู ูุฏูุฑ ุงูุฃุฏุงุก) ุ  ุชุฎุตูุต ุงููุฒูุฏ ูู ุงูุฐุงูุฑุฉ ูููุฎุงุฒู ุงููุคูุชุฉ ุ  ุชุฎุตูุต ุฐุงูุฑุฉ ูููุฎุงุฒู ุงููุคูุชุฉ ูุน ุงุณุชุฏุนุงุก <code>mmap</code> ูููุตู ูุฅูุดุงุก ุตูุญุฉ ุญูุงูุฉ. <br><br>  ุนูุฏูุง ุฃุฑู ุฑูุฒูุง ูููู ุจูุณุฎ 8 ุจุงูุชุงุช ูู ุงูุจูุงูุงุช ุ ุฃุชุณุงุกู ุนูู ุงูููุฑ ููุงุฐุง ุจุงูุถุจุท 8 ุจุงูุช.  ููููู ูุณุฎ 16 ุจุงูุช ุจุงุณุชุฎุฏุงู ุณุฌูุงุช SSE: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">inline void copy16(UInt8 * dst, const UInt8 * src) { #if __SSE2__    _mm_storeu_si128(reinterpret_cast&lt;__m128i *&gt;(dst),        _mm_loadu_si128(reinterpret_cast&lt;const __m128i *&gt;(src))); #else    memcpy(dst, src, 16); #endif } inline void wildCopy16(UInt8 * dst, const UInt8 * src, UInt8 * dst_end) {    do    {        copy16(dst, src);        dst += 16;        src += 16;    } while (dst &lt; dst_end); }</code> </pre> <br>  ููุณ ุงูุดูุก ูุนูู ููุณุฎ 32 ุจุงูุช ู AVX ู 64 ุจุงูุช ู AVX-512.  ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ููููู ุฅุฒุงูุฉ ุงูุญููุฉ ุนุฏุฉ ูุฑุงุช.  ุฅุฐุง ููุช ูุฏ ูุธุฑุช ูู ุฃู ููุช ูุถู ูู ููููุฉ ุชูููุฐ <code>memcpy</code> ุ ููุฐุง ูู ุจุงูุถุจุท ุงูููุฌ ุงููุณุชุฎุฏู.  (ุจุงูููุงุณุจุฉ ุ ูู ูููู ุจุฑูุงูุฌ ุงูุชุญููู ุงูุจุฑูุฌู ุจุฅูุบุงุก ุฃู ุชุญููู ุงูุญููุฉ ูู ูุฐู ุงูุญุงูุฉ ุ ูุฃู ูุฐุง ุณูุชุทูุจ ุฅุฏุฑุงุฌ ุงุฎุชุจุงุฑุงุช ุถุฎูุฉ.) <br><br>  ููุงุฐุง ูู ุชูููุฐ LZ4 ุงูุฃุตูู ุงูููุงู ุจุฐููุ  ุฃููุงู ุ ููุณ ูู ุงููุงุถุญ ูุง ุฅุฐุง ูุงู ูุฐุง ุฃูุถู ุฃู ุฃุณูุฃ.  ูุนุชูุฏ ุงูุฑุจุญ ุงููุงุชุฌ ุนูู ุญุฌู ุงููุชู ุงููุฑุงุฏ ูุณุฎูุง ุ ูุฐูู ุฅุฐุง ูุงูุช ุฌููุนูุง ูุตูุฑุฉ ุ ูุณูููู ุฐูู ุฅูุดุงุก ุนูู ุฅุถุงูู ููุงุจู ูุง ุดูุก.  ูุซุงููุง ุ ุฅูู ูุฏูุฑ ุงูุฃุญูุงู ูู ุชูุณูู LZ4 ุงูุชู ุชุณุงุนุฏ ุนูู ุชุฌูุจ ูุฑุน ุบูุฑ ุถุฑูุฑู ูู ุงูุญููุฉ ุงูุฏุงุฎููุฉ. <br><br>  ููุน ุฐูู ุ ุณูุถุน ูุฐุง ุงูุฎูุงุฑ ูู ุงูุงุนุชุจุงุฑ ูู ุงูููุช ุงูุญุงูู. <br><br><h3 style=";text-align:right;direction:rtl">  ูุณุฎ ุตุนุจุฉ </h3><br>  ุฏุนูุง ูุนูุฏ ุฅูู ูุณุฃูุฉ ูุง ุฅุฐุง ูุงู ูู ุงููููู ุฏุงุฆููุง ูุณุฎ ุงูุจูุงูุงุช ุจูุฐู ุงูุทุฑููุฉ.  ุฏุนูุง ูููู ุฃููุง ุจุญุงุฌุฉ ุฅูู ูุณุฎ ูุทุงุจูุฉ ุ ุฃู ุฃุฎุฐ ูุทุนุฉ ูู ุงูุฐุงูุฑุฉ ูู ุงููุฎุฒู ุงููุคูุช ุงูุฅุฎุฑุงุฌ ุงูููุฌูุฏ ูู ุฅุฒุงุญุฉ ุจุนุถ ุฎูู ุงููุคุดุฑ ููุณุฎูุง ุฅูู ููุถุน ุงููุคุดุฑ. <br><br>  ุชุฎูู ุญุงูุฉ ุจุณูุทุฉ ุนูุฏูุง ุชุญุชุงุฌ ุฅูู ูุณุฎ 5 ุจุงูุช ูู ุฅุฒุงุญุฉ 12: <br><br> <code><font color="#0fc000">Hello</font> world ........... <br> ^^^^^ - src <br> ^^^^^ - dst <br> <br> Hello world <font color="#0fc000">Hello</font> <font color="#a8a8a8">wo</font> ... <br> ^^^^^ - src <br> ^^^^^ - dst</code> <br> <br>  ูููู ููุงู ุญุงูุฉ ุฃูุซุฑ ุตุนูุจุฉ ุ ุนูุฏูุง ูุญุชุงุฌ ุฅูู ูุณุฎ ูุชูุฉ ูู ุงูุฐุงูุฑุฉ ุฃุทูู ูู ุงูุฅุฒุงุญุฉ.  ุจูุนูู ุขุฎุฑ ุ ูุชุถูู ุจุนุถ ุงูุจูุงูุงุช ุงูุชู ูู ุชุชู ูุชุงุจุชูุง ุจุนุฏ ุฅูู ุงููุฎุฒู ุงููุคูุช ููุฅุฎุฑุงุฌ. <br><br>  ูุณุฎ 10 ุจุงูุช ูู ุฅุฒุงุญุฉ 3: <br><br> <code><font color="#0fc000">abc</font> ............. <br> ^^^^^^^^^^ - src <br> ^^^^^^^^^^ - dst <br> <br> abc <font color="#0fc000">abcabcabca</font> ... <br> ^^^^^^^^^^ - src <br> ^^^^^^^^^^ - dst</code> <br> <br>  ูุฏููุง ุฌููุน ุงูุจูุงูุงุช ุฃุซูุงุก ุนูููุฉ ุงูุถุบุท ุ ููููู ุงูุนุซูุฑ ุนูู ูุซู ูุฐู ุงููุทุงุจูุฉ.  ูุธููุฉ <code>memcpy</code> ููุณุช ููุงุณุจุฉ ููุณุฎูุง ุ ูุฃููุง ูุง ุชุฏุนู ุงูุญุงูุฉ ุนูุฏูุง ุชุชุฏุงุฎู ูุทุงูุงุช ูุชู ุงูุฐุงูุฑุฉ.  ูู ุชุนูู ูุธููุฉ <code>memmove</code> ุฃูุถูุง ุ ูุฃู ูุชูุฉ ุงูุฐุงูุฑุฉ ุงูุชู ูุฌุจ ุฃุฎุฐ ุงูุจูุงูุงุช ูููุง ูู ุชุชู ุชููุฆุชูุง ุจุงููุงูู ุจุนุฏ.  ูุญู ุจุญุงุฌุฉ ุฅูู ูุณุฎ ุจุงูุทุฑููุฉ ููุณูุง ููุง ูู ููุง ูุณุฎ ุจุงูุช ุจุงูุช. <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">op[0] = match[0]; op[1] = match[1]; op[2] = match[2]; op[3] = match[3]; ...</code> </pre> <br>  ุฅููู ููู ุชุนูู: <br><br> <code><font color="#0fc000">a</font> bc <font color="#0fc000">a</font> ............ <br> ^ - src <br> ^ - dst <br> <br> a <font color="#0fc000">b</font> ca <font color="#0fc000">b</font> ........... <br> ^ - src <br> ^ - dst <br> <br> ab <font color="#0fc000">c</font> ab <font color="#0fc000">c</font> .......... <br> ^ - src <br> ^ - dst <br> <br> abc <font color="#0fc000">a</font> bc <font color="#0fc000">a</font> ......... <br> ^ - src <br> ^ - dst <br> <br> abca <font color="#0fc000">b</font> ca <font color="#0fc000">b</font> ........ <br> ^ - src <br> ^ - dst</code> <br> <br>  ุจูุนูู ุขุฎุฑ ุ ูุฌุจ ุนูููุง ุฅูุดุงุก ุชุณูุณู ูุชูุฑุฑ.  ุงุณุชุฎุฏู ุงูุชุทุจูู ุงูุฃุตูู ูู LZ4 ุจุนุถ ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ุงูุบุฑูุจุฉ ุจุดูู ูุฏูุด ููููุงู ุจุฐูู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">const unsigned dec32table[] = {0, 1, 2, 1, 4, 4, 4, 4}; const int dec64table[] = {0, 0, 0, -1, 0, 1, 2, 3}; const int dec64 = dec64table[offset]; op[0] = match[0]; op[1] = match[1]; op[2] = match[2]; op[3] = match[3]; match += dec32table[offset]; memcpy(op+4, match, 4); match -= dec64;</code> </pre> <br>  ูููู ุจูุณุฎ ุงูุจุงูุชุงุช ุงูุฃุฑุจุนุฉ ุงูุฃููู ูุงุญุฏุฉ ุชูู ุงูุฃุฎุฑู ุ ูุชุฎุทู ุจุนุถ ุงูุฃุฑูุงู ุงูุณุญุฑูุฉ ุ ูููุณุฎ ุงูุจุงูุชุงุช ุงูุฃุฑุจุนุฉ ุงูุชุงููุฉ ุจุงููุงูู ุ ููููู ุงููุคุดุฑ ุฅูู ุชุทุงุจู ุจุงุณุชุฎุฏุงู ุฑูู ุณุญุฑู ุขุฎุฑ.  ูุณู ูุคูู ุงูููุฏ ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Yan Collet</a> ) ุจุทุฑููุฉ ูุง ุชุฑู ุชุนููู ุญูู ูุนูู ูุฐุง.  ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ุฃุณูุงุก ูุชุบูุฑ ูุฑุจูุฉ.  ููุงููุง ูุฏุนู dec ... table ุ ูููู ูุชู ุฅุถุงูุฉ ูุงุญุฏ ูุงูุขุฎุฑ ูุชู ุทุฑุญู.  ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ุฃุญุฏููุง ุบูุฑ ููููุน ุ ูุงูุขุฎุฑ int.  ููุน ุฐูู ุ ูุงู ุงููุคูู ูุคุฎุฑูุง ุจุชุญุณูู ูุฐุง ุงูููุงู ูู ุงูููุฏ. <br><br>  ูุฅููู ููู ูุนูู ูู ุงููุงูุน.  ูููู ุจูุณุฎ ุฃูู 4 ุจุงูุช ูุงุญุฏ ูู ูู ูุฑุฉ: <br><br> <code>abc <font color="#0fc000">abca</font> ......... <br> ^^^^ - src <br> ^^^^ - dst</code> <br> <br>  ุงูุขู ูููููุง ูุณุฎ 4 ุจุงูุช ูู ููุช ูุงุญุฏ: <br><br> <code>abcabca <font color="#0fc000">bcab</font> ..... <br> ^^^^ - src <br> ^^^^ - dst</code> <br> <br>  ูููููุง ุงููุชุงุจุนุฉ ูุงููุนุชุงุฏ ุ ููุณุฎ 8 ุจุงูุช ูู ููุช ูุงุญุฏ: <br><br> <code>abcabcabcab <font color="#0fc000">cabcabca</font> ..... <br> ^^^^^^^^ - src <br> ^^^^^^^^ - dst</code> <br> <br>  ููุง ูุนูู ุฌููุนูุง ูู ุงูุชุฌุฑุจุฉ ุ ูุฅู ุฃูุถู ุทุฑููุฉ ูููู ุงูููุฏ ูู ูู ุจุนุถ ุงูุฃุญูุงู ุฅุนุงุฏุฉ ูุชุงุจุชูุง.  ุฅููู ูุง ุชูุตููุง ุฅููู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">inline void copyOverlap8(UInt8 * op, const UInt8 *&amp; match, const size_t offset) {    /// 4 % n.    /// Or if 4 % n is zero, we use n.    /// It gives an equivalent result, but is more CPU friendly for unknown reasons.    static constexpr int shift1[] = { 0, 1, 2, 1, 4, 4, 4, 4 };    /// 8 % n - 4 % n    static constexpr int shift2[] = { 0, 0, 0, 1, 0, -1, -2, -3 };    op[0] = match[0];    op[1] = match[1];    op[2] = match[2];    op[3] = match[3];    match += shift1[offset];    memcpy(op + 4, match, 4);    match += shift2[offset]; }</code> </pre> <br>  ููุง ูู ูุชููุน ุ ูุฐุง ูุง ูุบูุฑ ุงูุฃุฏุงุก ุนูู ุงูุฅุทูุงู.  ุฃุฑุฏุช ุญููุง ุชุฌุฑุจุฉ ุงูุชุญุณูู ููุณุฎ 16 ุจุงูุช ูู ุขู ูุงุญุฏ. <br><br>  ููุน ุฐูู ุ ูุคุฏู ูุฐุง ุฅูู ุชุนููุฏ "ุงูุญุงูุฉ ุงูุฎุงุตุฉ" ููุชุณุจุจ ูู ุงุณุชุฏุนุงุกูุง ุฃูุซุฑ ูู ูุฑุฉ (ูุชู ุชูููุฐ ุดุฑุท <code>offset &lt; 16</code> ุนูู ุงูุฃูู ุจูุฏุฑ <code>offset &lt; 8</code> ).  ูุจุฏู ูุณุฎ ุงููุทุงูุงุช ุงููุชุฏุงุฎูุฉ ูุน ุงููุณุฎ ุฐุงุช 16 ุจุงูุช ููุง ููู (ููุท ุงูุจุฏุงูุฉ ุงูููุถุญุฉ): <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">inline void copyOverlap16(UInt8 * op, const UInt8 *&amp; match, const size_t offset) {    /// 4 % n.    static constexpr int shift1[]        = { 0, 1, 2, 1, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4 };    /// 8 % n - 4 % n    static constexpr int shift2[]        = { 0, 0, 0, 1, 0, -1, -2, -3, -4, 4, 4, 4, 4, 4, 4, 4 };    /// 16 % n - 8 % n    static constexpr int shift3[]        = { 0, 0, 0, -1, 0, -2, 2, 1, 8, -1, -2, -3, -4, -5, -6, -7 };    op[0] = match[0];    op[1] = match[1];    op[2] = match[2];    op[3] = match[3];    match += shift1[offset];    memcpy(op + 4, match, 4);    match += shift2[offset];    memcpy(op + 8, match, 8);    match += shift3[offset]; }</code> </pre> <br>  ูู ูููู ุชูููุฐ ูุฐู ุงููุธููุฉ ุจุดูู ุฃูุซุฑ ูุนุงููุฉุ  ููุฏ ุฃู ูุฌุฏ ุชุนูููุงุช SIMD ุณุญุฑูุฉ ููุฐู ุงูุดูุฑุฉ ุงููุนูุฏุฉ ุ ูุฃู ูู ูุง ูุฑูุฏ ุงูููุงู ุจู ูู ูุชุงุจุฉ 16 ุจุงูุช ุ ูุงูุชู ุชุชููู ุจุงููุงูู ูู ุจุถุน ุจุงูุชุงุช ูู ุจูุงูุงุช ุงูุฅุฏุฎุงู (ูู 1 ุฅูู 15).  ุซู ูุญุชุงุฌูู ููุท ุฃู ุชุชูุฑุฑ ุจุงูุชุฑุชูุจ ุงูุตุญูุญ. <br><br>  ููุงู ุชุนูููุงุช ูุซู ูุฐุง ุชุณูู <code>pshufb</code> (ุจุงูุช ุฎูุท ูุฑู ุงููุนุจ ุงููุนุจุฃ) ุงูุชู ุชุนุฏ ุฌุฒุกูุง ูู SSSE3 (ุซูุงุซ S).  ููุจู ุชุณุฌูููู 16 ุจุงูุช.  ุฃุญุฏ ุงูุณุฌูุงุช ูุญุชูู ุนูู ุงูุจูุงูุงุช ุงููุตุฏุฑ.  ุงูุขุฎุฑ ูุฏูู "ูุญุฏุฏ": ูู ุจุงูุช ูุญุชูู ุนูู ุฑูู ูู 0 ุฅูู 15 ุ ููุฐุง ูุชููู ุนูู ุฃู ุจุงูุช ูู ุณุฌู ุงููุตุฏุฑ ููุญุตูู ุนูู ุงููุชูุฌุฉ ูู.  ุฅุฐุง ูุงูุช ูููุฉ ุงูุจุงูุช ุงููุญุฏุฏ ุฃูุจุฑ ูู 127 ุ ูุชู ููุก ุงูุจุงูุชุฉ ุงูููุงุจูุฉ ูููุชูุฌุฉ ุจุตูุฑ. <br><br>  ููุง ูุซุงู: <br><br><pre style=";text-align:right;direction:rtl">  xmm0: abc .............
 xmm1: 0120120120120120<font></font>
<font></font>
 pshufbูช xmm1 ุูช xmm0<font></font>
<font></font>
 xmm0: abcabcabcabcabca </pre><br>  ูู ุจุงูุชุฉ ูู ุงููุชูุฌุฉ ูููุฆุฉ ุจุงูุจุงูุช ุงููุญุฏุฏ ูู ุงูุจูุงูุงุช ุงููุตุฏุฑ - ูุฐุง ูู ุจุงูุถุจุท ูุง ูุญุชุงุฌู!  ุฅููู ูุง ูุจุฏู ุนููู ุงูุฑูุฒ ูู ุงููุชูุฌุฉ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">inline void copyOverlap16Shuffle(UInt8 * op, const UInt8 *&amp; match, const size_t offset) { #ifdef __SSSE3__    static constexpr UInt8 __attribute__((__aligned__(16))) masks[] =    {        0, 1, 2, 1, 4, 1, 4, 2, 8, 7, 6, 5, 4, 3, 2, 1, /* offset = 0, not used as mask, but for shift amount instead */        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, /* offset = 1 */        0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1,        0, 1, 2, 0, 1, 2, 0, 1, 2, 0, 1, 2, 0, 1, 2, 0,        0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3,        0, 1, 2, 3, 4, 0, 1, 2, 3, 4, 0, 1, 2, 3, 4, 0,        0, 1, 2, 3, 4, 5, 0, 1, 2, 3, 4, 5, 0, 1, 2, 3,        0, 1, 2, 3, 4, 5, 6, 0, 1, 2, 3, 4, 5, 6, 0, 1,        0, 1, 2, 3, 4, 5, 6, 7, 0, 1, 2, 3, 4, 5, 6, 7,        0, 1, 2, 3, 4, 5, 6, 7, 8, 0, 1, 2, 3, 4, 5, 6,        0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 0, 1, 2, 3, 4, 5,        0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 0, 1, 2, 3, 4,        0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 0, 1, 2, 3,        0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 0, 1, 2,        0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 0, 1,        0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 0,    };    _mm_storeu_si128(reinterpret_cast&lt;__m128i *&gt;(op),        _mm_shuffle_epi8(            _mm_loadu_si128(reinterpret_cast&lt;const __m128i *&gt;(match)),            _mm_load_si128(reinterpret_cast&lt;const __m128i *&gt;(masks) + offset)));    match += masks[offset]; #else    copyOverlap16(op, match, offset); #endif }</code> </pre> <br>  ููุง <code>_mm_shuffle_epi8</code> ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุฌููุฑู</a> ุ ูุงูุฐู ูุฌูุน ุฅูู ุชุนูููุงุช <code>pshufb</code> CPU. <br><br>  ูู ูููููุง ุฅุฌุฑุงุก ูุฐู ุงูุนูููุฉ ููุฒูุฏ ูู ูุญุฏุงุช ุงูุจุงูุช ูู ููุช ูุงุญุฏ ุจุงุณุชุฎุฏุงู ุฅุฑุดุงุฏุงุช ุฃุญุฏุซุ  ุจุนุฏ ูู ุดูุก ุ SSSE3 ุนุจุงุฑุฉ ุนู ูุฌููุนุฉ ุชุนูููุงุช ูุฏููุฉ ุฌุฏูุง ููุฌูุฏุฉ ููุฐ ุนุงู 2006. AVX2 ุจูุง ุชุนูููุฉ ุชููู ุจุฐูู ุจู 32 ุจุงูุช ูู ุขู ูุงุญุฏ ุ ูููู ุจุดูู ูููุตู ูููุฑุงุช 16 ุจุงูุช ุงููุฑุฏูุฉ.  ูุณูู ูุฐุง ุจุงูุจุงูุช ุจูุฑููุช ุงููุชุฌู ุ ุจุฏูุงู ูู ุงูุจุงูุชุงุช ุงููุฎุชูุทุฉ ุงููุนุจุฃุฉ - ุงููููุงุช ูุฎุชููุฉ ุ ููู ุงููุนูู ูู ููุณู.  ูุญุชูู AVX-512 VBMI ุนูู ุชุนูููุงุช ุฃุฎุฑู ุชุนูู ูุน 64 ุจุงูุช ูู ุขู ูุงุญุฏ ุ ููู ุงููุนุงูุฌุงุช ุงูุชู ุชุฏุนููุง ูู ุชุธูุฑ ุฅูุง ูุคุฎุฑูุง.  ูุญุชูู ARM NEON ุนูู ุฅุฑุดุงุฏุงุช ูุดุงุจูุฉ ุชุณูู vtbl (ุจุญุซ ุฌุฏูู ุงููุชุฌูุงุช) ุ ููููุง ุชุณูุญ ููุท ุจูุชุงุจุฉ 8 ุจุงูุช. <br><br>  ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ููุงู ุฅุตุฏุงุฑ ูู ุชุนูููุงุช <code>pshufb</code> ูุน ุณุฌูุงุช MMX 64 ุจุช ูู ุฃุฌู ุชุดููู 8 ุจุงูุช.  ุฅูู ููุงุณุจ ุชูุงููุง ูุงุณุชุจุฏุงู ุงููุณุฎุฉ ุงูุฃุตููุฉ ูู ุงูููุฏ.  ููุน ุฐูู ุ ูุฑุฑุช ุงุณุชุฎุฏุงู ุฎูุงุฑ 16 ุจุงูุช ุจุฏูุงู ูู ุฐูู (ูุฃุณุจุงุจ ุฎุทูุฑุฉ). <br><br>  ูู ูุคุชูุฑ Highload ++ Siberia ุ ุญุถุฑูู ุฃุญุฏ ุงูุญุถูุฑ ุจุนุฏ ุนุฑุถู ุงูุชูุฏููู ูุฐูุฑ ุฃูู ุจุงููุณุจุฉ ูุญุงูุฉ 8 ุจุงูุช ุ ููููู ููุท ุงุณุชุฎุฏุงู ุงูุถุฑุจ ุจูุงุณุทุฉ ุซุงุจุช ุชู ุงุฎุชูุงุฑู ุจุดูู ุฎุงุต (ุณุชุญุชุงุฌ ุฃูุถูุง ุฅูู ุฅุฒุงุญุฉ) - ูุฐุง ูู ูุญุฏุซ ุญุชู ูู ูู ูุจู! <br><br><h3 style=";text-align:right;direction:rtl">  ููููุฉ ุฅุฒุงูุฉ ุฒุงุฆุฏุฉ ุฅุฐุง ุงูุจูุงู </h3><br>  ูููุชุฑุถ ุฃููู ุฃุฑูุฏ ุงุณุชุฎุฏุงู ูุชุบูุฑ ููุณุฎ 16 ุจุงูุช.  ููู ูููููู ุชุฌูุจ ุงูุงุถุทุฑุงุฑ ูุฅุฌุฑุงุก ูุญุต ุฅุถุงูู ูุชุฌุงูุฒ ุณุนุฉ ุงููุฎุฒู ุงููุคูุชุ <br><br>  ูุฑุฑุช ุฃููู ููุท ูู ุฃูุนู ูุฐุง ุงูุงุฎุชูุงุฑ.  ุณุชุดูุฑ ุงูุชุนูููุงุช ุนูู ุงููุธููุฉ ุฅูู ุฃูู ูุฌุจ ุนูู ุงููุทูุฑ ุชุฎุตูุต ูุชูุฉ ูู ุงูุฐุงูุฑุฉ ูุนุฏุฏ ูุนูู ูู ุงูุจุงูุชุงุช ุฃูุซุฑ ููุง ูู ูุทููุจ ุ ุญุชู ูุชููู ูู ูุฑุงุกุฉ ููุชุงุจุฉ ุงูุจูุงูุงุช ุงูููููุฉ ุบูุฑ ุงูุถุฑูุฑูุฉ ููุงู.  ุณูููู ูู ุงูุตุนุจ ุงุณุชุฎุฏุงู ูุงุฌูุฉ ุงููุธููุฉ ุ ููู ูุฐู ูุดููุฉ ูุฎุชููุฉ. <br><br>  ูู ุงููุงูุน ุ ูุฏ ุชููู ููุงู ุนูุงูุจ ุณูุจูุฉ.  ุฏุนูุง ูููู ุฃู ุงูุจูุงูุงุช ุงูุชู ูุญุชุงุฌ ุฅูู ูู ุถุบุทูุง ุชู ุชุดููููุง ูู ูุชู ุชุจูุบ 65536 ุจุงูุช ููู ูููุง.  ุซู ูุนุทููุง ุงููุณุชุฎุฏู ูุทุนุฉ ูู ุงูุฐุงูุฑุฉ ุชุจูุบ 65.536 ุจุงูุช ููุจูุงูุงุช ุงูุชู ุชู ูู ุถุบุทูุง.  ูููู ูุน ูุงุฌูุฉ ุงููุธููุฉ ุงูุฌุฏูุฏุฉ ุ ุณููุทูุจ ูู ุงููุณุชุฎุฏู ุชุฎุตูุต ูุชูุฉ ุฐุงูุฑุฉ ุชุจูุบ 65ุ551 ุจุงูุช ุ ุนูู ุณุจูู ุงููุซุงู.  ุซู ูุฏ ูุถุทุฑ ุงูุชุฎุตูุต ุฅูู ุชุฎุตูุต 96 ุฃู ุญุชู 128 ูููู ุจุงูุช ุ ุงุนุชูุงุฏูุง ุนูู ุชูููุฐู.  ุฅุฐุง ูุงู ุงูุชุฎุตูุต ุณูุฆูุง ุฌุฏูุง ุ ููุฏ ูุชููู ุงูุชุฎุฒูู ุงููุคูุช ููุฐุงูุฑุฉ ุจุดูู ููุงุฌุฆ ูู "ุงููููุฉ" ููุจุฏุฃ ูู ุงุณุชุฎุฏุงู <code>mmap</code> ู <code>munmap</code> ูู ูุฑุฉ ูุชุฎุตูุต ุงูุฐุงูุฑุฉ (ุฃู <code>madvice</code> ุงูุฐุงูุฑุฉ ุจุงุณุชุฎุฏุงู <code>madvice</code> ).  ุณุชููู ูุฐู ุงูุนูููุฉ ุจุทูุฆุฉ ููุบุงูุฉ ุจุณุจุจ ุฃุฎุทุงุก ุงูุตูุญุฉ.  ูุชูุฌุฉ ูุฐูู ุ ูุฏ ููุชูู ูุฐุง ุงูุชุญุณูู ุงูุจุณูุท ุจุฅุจุทุงุก ูู ุดูุก. <br><br><h3 style=";text-align:right;direction:rtl">  ูู ููุงู ุฃู ุชุณุงุฑุนุ </h3><br>  ูุฐูู ููุช ุจุนูู ูุณุฎุฉ ูู ุงูููุฏ ุงูุฐู ูุณุชุฎุฏู ุซูุงุซุฉ ุชุญุณููุงุช: <br><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูุณุฎ 16 ุจุงูุช ุจุฏูุงู ูู 8. </li><li style=";text-align:right;direction:rtl">  ุจุงุณุชุฎุฏุงู ุชุนูููุงุช ุฎูุท ูุฑู ุงููุนุจ <code>offset &lt; 16</code> ุญุงูุฉ. </li><li style=";text-align:right;direction:rtl">  ุฅุฒุงูุฉ ูุงุญุฏ ุฅุถุงูู ุฅุฐุง. </li></ol><br>  ุจุฏุฃุช ุงุฎุชุจุงุฑ ูุฐุง ุงูุฑูุฒ ุนูู ูุฌููุนุงุช ูุฎุชููุฉ ูู ุงูุจูุงูุงุช ูุญุตูุช ุนูู ูุชุงุฆุฌ ุบูุฑ ูุชููุนุฉ. <br><br>  ูุซุงู 1: <br>  ุฒููู E2650v2 ุ ุจูุงูุงุช ูุชุตูุญ Yandex ุ ุนููุฏ AppVersion. <br>  ุงููุฑุฌุน: 1.67 ุฌูุฌุงุจุงูุช / ุซุงููุฉ. <br>  16 ุจุงูุช ุ ุฎูุท ูุฑู ุงููุนุจ: 2.94 ุฌูุฌุงุจุงูุช / ุซุงููุฉ (76ูช ุฃุณุฑุน). <br><br>  ูุซุงู 2: <br>  ุฒููู E2650v2 ุ ูุงูุฏูุณ ุงููุจุงุดุฑ ุงูุจูุงูุงุช ุ ุงูุนููุฏ ShowsSumPosition. <br>  ุงููุฑุฌุน: 2.30 ุฌูุฌุงุจุงูุช / ุซุงููุฉ. <br>  16 ุจุงูุช ุ ุฎูุท ูุฑู ุงููุนุจ: 1.91 ุฌูุฌุงุจุงูุช / ุซุงููุฉ (20ูช ุฃุจุทุฃ). <br><br>  ููุช ุณุนูุฏูุง ุญููุง ูู ุงูุจุฏุงูุฉ ุ ุนูุฏูุง ุฑุฃูุช ุฃู ูู ุดูุก ูุฏ ุชุณุงุฑุน ุจูุนุฏู ูุจูุฑ.  ุซู ุฑุฃูุช ุฃู ูุง ุดูุก ูุงู ุฃุณุฑุน ูุน ุงููููุงุช ุงูุฃุฎุฑู.  ูุงู ุฃุจุทุฃ ููููุงู ุจุงููุณุจุฉ ููุจุนุถ ูููู.  ุฎูุตุช ุฅูู ุฃู ุงููุชุงุฆุฌ ุชุนุชูุฏ ุนูู ูุณุจุฉ ุงูุถุบุท.  ูููุง ุฒุงุฏ ุถุบุท ุงูููู ุ ุฒุงุฏุช ุงูุงุณุชูุงุฏุฉ ูู ุงูุชุจุฏูู ุฅูู 16 ุจุงูุช.  ูุฐุง ุดุนูุฑ ุทุจูุนู: ูููุง ุฒุงุฏุช ูุณุจุฉ ุงูุถุบุท ุ ุฒุงุฏ ูุชูุณุท โโุทูู ุงูุฃุฌุฒุงุก ุงููุฑุงุฏ ูุณุฎูุง. <br><br>  ููุชุญููู ุ ุงุณุชุฎุฏูุช ููุงูุจ C ++ ูุฅูุดุงุก ุฎูุงุฑุงุช ุชุนูููุงุช ุจุฑูุฌูุฉ ูุฃุฑุจุน ุญุงูุงุช: ุงุณุชุฎุฏุงู ูุฌููุนุงุช ุฐุงุช 8 ุจุงูุช ุฃู 16 ุจุงูุช ุ ูุน ุฃู ุจุฏูู ุชุนูููุฉ ุฎูุท ูุฑู ุงููุนุจ. <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">template &lt;size_t copy_amount, bool use_shuffle&gt; void NO_INLINE decompressImpl(    const char * const source,    char * const dest,    size_t dest_size)</code> </pre> <br>  ูุงู ุฃุฏุงุก ุงููุชุบูุฑุงุช ุงููุฎุชููุฉ ุชูุงููุง ููุดูุฑุฉ ุฃูุถู ุนูู ูููุงุช ูุฎุชููุฉ ุ ูููู ุนูุฏ ุงูุงุฎุชุจุงุฑ ุนูู ุณุทุญ ุงูููุชุจ ุ ูุณุชุธู ุงููุณุฎุฉ ุงูุชู ูุชู ุฎูุทูุง ุฏุงุฆููุง ุฏุงุฆููุง.  ุงูุงุฎุชุจุงุฑ ุนูู ุณุทุญ ุงูููุชุจ ุบูุฑ ูุฑูุญ ูุฃู ุนููู ุงูููุงู ุจุฐูู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">sudo echo 'performance' | tee /sys/devices/system/cpu/cpu*/cpufreq/scaling_governor kill -STOP $(pidof firefox) $(pidof chromium)</code> </pre> <br>  ุซู ุงูุชููุช ุฅูู ุฃุญุฏ ุฎูุงุฏู "ุงูุชุทููุฑ" ุงููุฏููุฉ (ูุน ูุนุงูุฌ Xeon E5645) ุ ูุงุณุชููุช ุนูู ุงููุฒูุฏ ูู ูุฌููุนุงุช ุงูุจูุงูุงุช ุ ูุญุตูุช ุนูู ูุชุงุฆุฌ ูุนุงูุณุฉ ุชูุฑูุจูุง ุ ุงูุฃูุฑ ุงูุฐู ุฃุฑุจููู ุชูุงููุง.  ุงุชุถุญ ุฃู ุงุฎุชูุงุฑ ุงูุฎูุงุฑุฒููุฉ ุงูุฃูุซู ูุนุชูุฏ ุนูู ุทุฑุงุฒ ุงููุนุงูุฌ ุ ุจุงูุฅุถุงูุฉ ุฅูู ูุณุจุฉ ุงูุถุบุท.  ูุญุฏุฏ ุงููุนุงูุฌ ูุชู ูููู ูู ุงูุฃูุถู ุงุณุชุฎุฏุงู ุชุนูููุฉ ุฎูุท ูุฑู ุงููุนุจ ุ ุจุงูุฅุถุงูุฉ ุฅูู ุนุชุจุฉ ุชุญุฏูุฏ ููุนุฏ ุจุฏุก ุงุณุชุฎุฏุงู ุงููุณุฎ ุฐุงุช 16 ุจุงูุช. <br><br>  ุจุงูููุงุณุจุฉ ุ ุนูุฏ ุงูุงุฎุชุจุงุฑ ุนูู ุฎูุงุฏููุง ุ ูู ุงูููุทูู ุงูููุงู ุจุฐูู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">sudo kill -STOP $(pidof python) $(pidof perl) $(pgrep -u skynet) $(pidof cqudp-client)</code> </pre> <br>  ุฎูุงู ุฐูู ุ ูุฅู ุงููุชุงุฆุฌ ุณุชููู ุบูุฑ ูุณุชูุฑุฉ.  ุงุญุชุฑุณ ุฃูุถูุง ูู ุงูุงุฎุชูุงู ุงูุญุฑุงุฑู ููุถุน ุญุฏ ุฃูุตู ููุทุงูุฉ. <br><br><h3 style=";text-align:right;direction:rtl">  ููููุฉ ุงุฎุชูุงุฑ ุฃูุถู ุงูุฎูุงุฑุฒููุฉ </h3><br>  ูุฐูู ูุฏููุง ุฃุฑุจุนุฉ ุฃููุงุน ูู ุงูุฎูุงุฑุฒููุฉ ููุญุชุงุฌ ุฅูู ุงุฎุชูุงุฑ ุฃูุถู ุฎูุงุฑ ููุธุฑูู.  ูููููุง ุฅูุดุงุก ูุฌููุนุฉ ุชูุซูููุฉ ูู ุงูุจูุงูุงุช ูุงูุฃุฌูุฒุฉ ุ ุซู ุฅุฌุฑุงุก ุงุฎุชุจุงุฑ ุฌุงุฏ ููุญูู ูุงุฎุชูุงุฑ ุงูุทุฑููุฉ ุงูุฃูุถู ูู ุงููุชูุณุท.  ููู ููุณ ูุฏููุง ูุฌููุนุฉ ุจูุงูุงุช ุชูุซูููุฉ.  ูุงุฎุชุจุงุฑ ุ ุงุณุชุฎุฏูุช ุนููุฉ ูู ุงูุจูุงูุงุช ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Yandex Metrica</a> ู Yandex Direct ู Yandex Browser <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุงูุฑุญูุงุช ุงูุฌููุฉ ูู ุงูููุงูุงุช ุงููุชุญุฏุฉ</a> .  ููู ูุฐุง ูุง ูููู ุ ูุฃู ClickHouse ุชุณุชุฎุฏูู ูุฆุงุช ุงูุดุฑูุงุช ูู ุฌููุน ุฃูุญุงุก ุงูุนุงูู.  ูู ุฎูุงู ุงูุฅูุฑุงุท ูู ุงูุชุญุณูู ุนูู ูุฌููุนุฉ ุจูุงูุงุช ูุงุญุฏุฉ ุ ูุฏ ูุชุณุจุจ ูู ุงูุฎูุงุถ ุงูุฃุฏุงุก ูุน ุงูุจูุงูุงุช ุงูุฃุฎุฑู ูุญุชู ูุง ูุฏุฑู ุฐูู.  ูุฅุฐุง ูุงูุช ุงููุชุงุฆุฌ ุชุนุชูุฏ ุนูู ุทุฑุงุฒ ุงููุนุงูุฌ ุ ูุณูุถุทุฑ ุฅูู ูุชุงุจุฉ ุงูุดุฑูุท ูู ุงูุดูุฑุฉ ุจุดูู ุตุฑูุญ ูุงุฎุชุจุงุฑูุง ุนูู ูู ุทุฑุงุฒ (ุฃู ุงูุฑุฌูุน ุฅูู ุงูุฏููู ุงููุฑุฌุนู ุจุดุฃู ุชุนูููุงุช ุงูุชูููุช ุ ูุง ุฑุฃููุ).  ูู ููุชุง ุงูุญุงูุชูู ุ ูุฐุง ูู ูุถูุนุฉ ููููุช ููุบุงูุฉ. <br><br>  ูุฐูู ูุฑุฑุช ุงุณุชุฎุฏุงู ุทุฑููุฉ ุฃุฎุฑู ุ ููู ุฃูุฑ ูุงุถุญ ููุฒููุงุก ุงูุฐูู ุฏุฑุณูุง ูู ูููุฉ ุชุญููู ุงูุจูุงูุงุช ูุฏููุง: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">"ูุทุงุน ุงูุทุฑู ูุชุนุฏุฏ ุงูุฃุณูุญุฉ"</a> .  ุงูููุทุฉ ุงููููุฉ ูู ุฃู ูุชุบูุฑ ุงูุฎูุงุฑุฒููุฉ ูุชู ุงุฎุชูุงุฑู ุนุดูุงุฆููุง ุ ุซู ูุณุชุฎุฏู ุงูุฅุญุตุงุฆูุงุช ุจุดูู ุชุฏุฑูุฌู ูุงุฎุชูุงุฑ ุงูุฎูุงุฑุงุช ุงูุชู ุชุนูู ุจุดูู ุฃูุถู. <br><br>  ูุฏููุง ุงูุนุฏูุฏ ูู ูุชู ุงูุจูุงูุงุช ุงูุชู ุชุญุชุงุฌ ุฅูู ูู ุงูุถุบุท ุ ูุฐูู ูุญู ุจุญุงุฌุฉ ุฅูู ุงุณุชุฏุนุงุกุงุช ุงููุธุงุฆู ุงููุณุชููุฉ ูุฅูุบุงุก ุถุบุท ุงูุจูุงูุงุช.  ูููููุง ุงุฎุชูุงุฑ ูุงุญุฏุฉ ูู ุงูุฎูุงุฑุฒููุงุช ุงูุฃุฑุจุน ููู ูุชูุฉ ูููุงุณ ููุช ุชูููุฐูุง.  ุนุงุฏุฉู ูุง ุชููู ุนูููุฉ ููุฐู ุดูุฆูุง ุจุงูููุงุฑูุฉ ูุน ูุนุงูุฌุฉ ูุชูุฉ ูู ุงูุจูุงูุงุช ุ ููู ClickHouse ุชุจูุบ ูุชูุฉ ุงูุจูุงูุงุช ุบูุฑ ุงููุถุบูุทุฉ 64 ูููู ุจุงูุช ุนูู ุงูุฃูู.  (ุงูุฑุฃ ูุฐุง <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูููุงู</a> ุญูู ููุงุณ ุงูููุช.) <br><br>  ููุญุตูู ุนูู ููู ุฃูุถู ูููููุฉ ุนูู ุฎูุงุฑุฒููุฉ "ูุทุงุน ุงูุทุฑู ูุชุนุฏุฏ ุงูุณูุงุญ" ุ ุฏุนููุง ูููู ูุธุฑุฉ ุนูู ูุตุฏุฑ ุงูุงุณู.  ูุฐุง ุชุดุจูู ุจุขูุงุช ุงูููุงุฑ ูู ุงููุงุฒููู ุงูุชู ุชุญุชูู ุนูู ุนุฏุฉ ุฃุฏูุงุช ูููู ููุงุนุจ ุณุญุจูุง ููุญุตูู ุนูู ูุจูุบ ุนุดูุงุฆู ูู ุงููุงู.  ูููู ููุงุนุจ ุณุญุจ ุงูุฑุงูุนุงุช ุนุฏุฉ ูุฑุงุช ุจุฃู ุชุฑุชูุจ.  ูู ุฐุฑุงุน ูุฏูู ุงุญุชูุงู ุซุงุจุช ูููุจูุบ ุงูููุงุจู ูู ุงูุฃููุงู ุงูููุฏูุฉ ุ ูููู ุงููุงุนุจ ูุง ูุนุฑู ููู ูุนูู ููููู ุฃู ูุชุนูู ููุท ูู ุชุฌุฑุจุฉ ูุนุจ ุงููุนุจุฉ.  ุจูุฌุฑุฏ ูุนุฑูุฉ ุฐูู ุ ูููููู ุฒูุงุฏุฉ ุฃุฑุจุงุญูู ุฅูู ุงูุญุฏ ุงูุฃูุตู. <br><br>  ุชุชูุซู ุฅุญุฏู ุงูุทุฑู ูุชุนุธูู ุงูููุงูุฃุฉ ูู ุชูููู ุชูุฒูุน ุงูุงุญุชูุงูุงุช ููู ุฑุงูุนุฉ ูู ูู ุฎุทูุฉ ุจูุงุกู ุนูู ุฅุญุตุงุฆูุงุช ุงููุนุจุฉ ูู ุงูุฎุทูุงุช ุงูุณุงุจูุฉ.  ุซู "ุนูููุง" ูุฑุจุญ ููุงูุฃุฉ ุนุดูุงุฆูุฉ ููู ุฑุงูุนุฉ ุ ุจูุงุกู ุนูู ุงูุชูุฒูุนุงุช ุงููุณุชููุฉ.  ุฃุฎูุฑูุง ุ ูุฌุฐุจ ุงูุฑุงูุนุฉ ุงูุชู ุญููุช ุฃูุถู ุงููุชุงุฆุฌ ูู ูุนุจุชูุง ุงูุนูููุฉ.  ูุฐุง ุงูููุฌ ูุณูู ุทููุณูู ุฃุฎุฐ ุงูุนููุงุช. <br><br>  ููููุง ูุฎุชุงุฑ ุฎูุงุฑุฒููุฉ ุชุฎููู ุงูุถุบุท.  ูุงููุชูุฌุฉ ูู ููุช ุงูุชูููุฐ ุจุงูุจูู ุซุงููุฉ ููู ุจุงูุช: ูููุง ูุงู ุฐูู ุฃูุถู ุ ูููุง ูุงู ุฐูู ุฃูุถู.  ุณููุธุฑ ูู ููุช ุงูุชูููุฐ ููุชุบูุฑ ุนุดูุงุฆู ูุชูููู ุชูุฒูุนู ุจุงุณุชุฎุฏุงู ุงูุฅุญุตุงุกุงุช ุงูุฑูุงุถูุฉ.  ุบุงูุจูุง ูุง ูุชู ุงุณุชุฎุฏุงู ููุฌ Bayesian ูููุงู ูุซู ูุฐุง ุ ูููู ุณูููู ูู ุงูุตุนุจ ุฅุฏุฎุงู ุตูุบ ูุนูุฏุฉ ูู ุฑูุฒ C ++.  ูููููุง ุงุณุชุฎุฏุงู ููุฌ ุญุฏูุฏู ููููู ุฃู ูุชุบูุฑ ุนุดูุงุฆู ููุชูู ุฅูู ุนุงุฆูุฉ ุญุฏูุฏู ูู ุงููุชุบูุฑุงุช ุงูุนุดูุงุฆูุฉ ุ ููู ุซู ุชูููู ุงููุนููุงุช. <br><br>  ููู ูุฎุชุงุฑ ุนุงุฆูุฉ ุงููุชุบูุฑุงุช ุงูุนุดูุงุฆูุฉุ  ููุซุงู ุ ูุฏ ููุชุฑุถ ุฃู ููุช ุชูููุฐ ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ูู ุชูุฒูุน ุทุจูุนู.  ููู ูุฐุง ุฎุงุทุฆ ุชูุงูุง.  ุฃููุงู ุ ูุง ูููู ุฃู ูููู ููุช ุงูุชูููุฐ ุณุงูุจูุง ุ ูุงูุชูุฒูุน ุงูุนุงุฏู ูุฃุฎุฐ ููููุง ูู ูู ููุงู ุนูู ุฎุท ุงูุฃุฑูุงู.  ุซุงููุงู ุ ุฃูุชุฑุถ ุฃู ููุช ุงูุชูููุฐ ุณูููู ูู "ุฐูู" ุซููู ุนูู ุงูุทุฑู ุงูุฃููู. <br><br>  ููุน ุฐูู ุ ููุงู ุนูุงูู ูููู ุฃู ุชุฌุนู ูู ุงููุณุชุญุณู ุชูุฏูุฑ ุงูุชูุฒูุน ุงูุทุจูุนู ููุท ูุฃุบุฑุงุถ ุฃุฎุฐ Thompson Sampling (ุนูู ุงูุฑุบู ูู ุฃู ุชูุฒูุน ุงููุชุบูุฑ ุงููุณุชูุฏู ููุณ ุทุจูุนููุง ุจุงูุถุฑูุฑุฉ).  ูุงูุณุจุจ ูู ุฐูู ูู ุฃูู ูู ุงูุณูู ุฌุฏูุง ุญุณุงุจ ุงูุชููุน ุงูุฑูุงุถู ูุงูุชุจุงูู ุ ูุจุนุฏ ุนุฏุฏ ูุงู ูู ุงูุชูุฑุงุฑุงุช ุ ูุตุจุญ ุงูุชูุฒูุน ุงูุทุจูุนู ุถูููุง ุฅูู ุญุฏ ูุง ุ ูุง ูุฎุชูู ูุซูุฑูุง ุนู ุงูุชูุฒูุนุงุช ุงูุชู ููุง ุณูุญุตู ุนูููุง ุจุงุณุชุฎุฏุงู ุทุฑู ุฃุฎุฑู.  ุฅุฐุง ูู ููู ููุชููู ุฌุฏูุง ุจูุนุฏู ุงูุชูุงุฑุจ ูู ุงูุฎุทูุงุช ุงูุฃููู ุ ููููู ุชุฌุงูู ูุฐู ุงูุชูุงุตูู. <br><br> This may seem like a somewhat ignorant approach. Experience has shown us that the average time for query execution, website page loading, and so on is "garbage" that isn't worth calculating. It would be better to calculate the median, which is a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">robust statistic</a> . But this is a little more difficult, and as I will show later, the described method justifies itself for practical purposes. <br><br> At first I implemented calculation of the mathematical expectation and variance, but then I decided that this is too good, and I need to simplify the code to make it "worse": <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">/// For better convergence, we don't use proper estimate of stddev. /// We want to eventually separate the two algorithms even in cases /// when there is no statistical significant difference between them. double sigma() const {    return mean() / sqrt(adjustedCount()); } double sample(pcg64 &amp; rng) const {    ...    return std::normal_distribution&lt;&gt;(mean(), sigma())(rng); }</code> </pre> <br> I wrote it so that the first few iterations were not taken into account, to eliminate the effect of memory latencies. <br><br> The result is a test program that can select the best algorithm for the input data, with optional modes that use the reference implementation of LZ4 or a specific version of the algorithm. <br><br> So there are six options: <br> โ Reference (baseline): original LZ4 without our modifications. <br> โ Variant 0: copy 8 bytes at a time without shuffle. <br> โ Variant 1: copy 8 bytes at a time with shuffle. <br> โ Variant 2: copy 16 bytes at a time without shuffle. <br> โ Variant 3: copy 16 bytes at a time with shuffle. <br> โ The "bandit" option, which selects the best of the four optimized variants. <br><br><h3 style=";text-align:right;direction:rtl"> Testing on different CPUs </h3><br> If the result strongly depends on the CPU model, it would be interesting to find out exactly how it is affected. There might be an exceptionally large difference on certain CPUs. <br><br> I prepared a set of datasets from different tables in ClickHouse with real data, for a total of 256 different files each with 100 MB of uncompressed data (the number 256 was coincidental). Then I looked at the CPUs of the servers where I can run benchmarks. I found servers with the following CPUs: <br> โ Intelยฎ Xeonยฎ CPU E5-2650 v2 @ 2.60GHz <br> โ Intelยฎ Xeonยฎ CPU E5-2660 v4 @ 2.00GHz <br> โ Intelยฎ Xeonยฎ CPU E5-2660 0 @ 2.20GHz <br> โ Intelยฎ Xeonยฎ CPU E5645 @ 2.40GHz <br> โ Intel Xeon E312xx (Sandy Bridge) <br> โ AMD Opteron(TM) Processor 6274 <br> โ AMD Opteron(tm) Processor 6380 <br> โ Intelยฎ Xeonยฎ CPU E5-2683 v4 @ 2.10GHz <br> โ Intelยฎ Xeonยฎ CPU E5530 @ 2.40GHz <br> โ Intelยฎ Xeonยฎ CPU E5440 @ 2.83GHz <br> โ Intelยฎ Xeonยฎ CPU E5-2667 v2 @ 3.30GHz <br><br> The most interesting part comes next โ the processors provided by the R&amp;D department: <br> โ AMD EPYC 7351 16-Core Processor, a new AMD server processor. <br> โ Cavium ThunderX2, which is AArch64, not x86. For these, my SIMD optimization needed to be reworked a bit. The server has 224 logical and 56 physical cores. <br><br> There are 13 servers in total, and each of them runs the test on 256 files in 6 variants (reference, 0, 1, 2, 3, adaptive). The test is run 10 times, alternating between the options in random order. It outputs 199,680 results that we can compare. <br><br> For example, we can compare different CPUs with each other. But we shouldn't jump to conclusions from these results, because we are only testing the LZ4 decompression algorithm on a single core (this is a very narrow case, so we only get a micro-benchmark). For example, the Cavium has the lowest performance per single core. But I tested ClickHouse on it myself, and it wins out over Xeon E5-2650 v2 on heavy queries due to the greater number of cores, even though it is missing many optimizations that are made in ClickHouse specifically for the x86. <br><br><pre style=";text-align:right;direction:rtl"> โโcpuโโโโโโโโโโโโโโโโโโโโฌโโrefโโฌโadaptโโฌโโmaxโโฌโbestโโฌโadapt_boostโโฌโmax_boostโโฌโadapt_over_maxโโ<font></font>
โ E5-2667 v2 @ 3.30GHz โ 2.81 โ 3.19 โ 3.15 โ 3 โ 1.14 โ 1.12 โ 1.01 โ<font></font>
โ E5-2650 v2 @ 2.60GHz โ 2.5 โ 2.84 โ 2.81 โ 3 โ 1.14 โ 1.12 โ 1.01 โ<font></font>
โ E5-2683 v4 @ 2.10GHz โ 2.26 โ 2.63 โ 2.59 โ 3 โ 1.16 โ 1.15 โ 1.02 โ<font></font>
โ E5-2660 v4 @ 2.00GHz โ 2.15 โ 2.49 โ 2.46 โ 3 โ 1.16 โ 1.14 โ 1.01 โ<font></font>
โ AMD EPYC 7351 โ 2.03 โ 2.44 โ 2.35 โ 3 โ 1.20 โ 1.16 โ 1.04 โ<font></font>
โ E5-2660 0 @ 2.20GHz โ 2.13 โ 2.39 โ 2.37 โ 3 โ 1.12 โ 1.11 โ 1.01 โ<font></font>
โ E312xx (Sandy Bridge) โ 1.97 โ 2.2 โ 2.18 โ 3 โ 1.12 โ 1.11 โ 1.01 โ<font></font>
โ E5530 @ 2.40GHz โ 1.65 โ 1.93 โ 1.94 โ 3 โ 1.17 โ 1.18 โ 0.99 โ<font></font>
โ E5645 @ 2.40GHz โ 1.65 โ 1.92 โ 1.94 โ 3 โ 1.16 โ 1.18 โ 0.99 โ<font></font>
โ AMD Opteron 6380 โ 1.47 โ 1.58 โ 1.56 โ 1 โ 1.07 โ 1.06 โ 1.01 โ<font></font>
โ AMD Opteron 6274 โ 1.15 โ 1.35 โ 1.35 โ 1 โ 1.17 โ 1.17 โ 1 โ<font></font>
โ E5440 @ 2.83GHz โ 1.35 โ 1.33 โ 1.42 โ 1 โ 0.99 โ 1.05 โ 0.94 โ<font></font>
โ Cavium ThunderX2 โ 0.84 โ 0.87 โ 0.87 โ 0 โ 1.04 โ 1.04 โ 1 โ<font></font>
โโโโโโโโโโโโโโโโโโโโโโโโโดโโโโโโโดโโโโโโโโดโโโโโโโดโโโโโโโดโโโโโโโโโโโโโโดโโโโโโโโโโโโดโโโโโโโโโโโโโโโโโ </pre><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"> ref, adapt, max โ The speed in gigabytes per second (the value that is the reverse of the arithmetic mean of time for all launches on all datasets). </li><li style=";text-align:right;direction:rtl"> best โ The number of the best algorithm among the optimized variants, from 0 to 3. </li><li style=";text-align:right;direction:rtl"> adapt_boost โ The relative advantage of the adaptive algorithm compared to the baseline. </li><li style=";text-align:right;direction:rtl"> max_boost โ The relative advantage of the best of the non-adaptive variants compared to the baseline. </li><li style=";text-align:right;direction:rtl"> adapt_over_max โ The relative advantage of the adaptive algorithm over the best non-adaptive one. </li></ul><br> The results show that we were able to speed up decompression by 12-20% on modern x86 processors. Even on ARM we saw 4% improvement, despite the fact that we didn't optimize much for this architecture. It is also clear that on average for different datasets, the "bandit" algorithm comes out ahead of the pre-selected best variant on all processors (except for very old Intel CPUs). <br><br><h3 style=";text-align:right;direction:rtl">  ุงุณุชูุชุงุฌ </h3><br> In practice, the usefulness of this work is dubious. Yes, LZ4 decompression was accelerated on average by 12-20%, and on some datasets the performance more than doubled. But in general, this doesn't have much effect on query execution time. It's difficult to find real queries that gain more than a couple percent in speed. <br><br> We decided to use ZStandard level 1 instead of LZ4 on several Yandex Metrica clusters intended for executing long queries, because it is more important to save IO and disk space on cold data. Keep this in mind if you have similar workload. <br><br> We observed the greatest benefits from optimizing decompression in highly compressible data, such as columns with mostly duplicate string values. However, we have developed a separate solution specifically for this scenario that allows us to significantly speed up queries over this kind of data. <br><br> Another point to remember is that optimization of decompression speed is often limited by the format of the compressed data. LZ4 uses a very good format, but Lizard, Density and LZSSE have other formats that can work faster. Perhaps instead of trying to accelerate LZ4, it would be better to just integrate LZSSE into ClickHouse. <br><br> It's unlikely that these optimizations will be implemented in the mainstream LZ4 library: in order to use them, the library interface would have to be modified. In fact, this is often the case with improving algorithms โ optimizations don't fit into old abstractions and they have to be revised. However, variable names have already been corrected in the original implementation. For instance, inc and dec tables have been <a href="">corrected</a> . In addition, about a month ago, the original implementation accelerated decompression by the same 12-15% by copying 32 bytes instead of 16, as discussed above. We tried the 32-byte option ourselves and the results were not that great, but they were still <a href="">faster</a> . <br><br> If you look at the profile at the beginning of the article, you may notice that we could have removed one extra copying operation from the page cache to userspace (either using <code>mmap</code> , or using <code>O_DIRECT</code> and userspace page cache, but both options are problematic). We also could have slightly improved the checksum calculation (CityHash128 is currently used without CRC32-C, but we could use HighwayHash, FARSH or XXH3). Acceleration of these two operations is useful for weakly compressed data, since they are performed on compressed data. <br><br> In any case, the changes have already been added to master more than a year ago, and the ideas that resulted from this research have been applied in other tasks. You can also watch the <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">video</a> from HighLoad++ Siberia, or view the <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">presentation</a> (both in Russian). </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar457612/">https://habr.com/ru/post/ar457612/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar457600/index.html">ูุธุฑุฉ ุนุงูุฉ ุนูู ุณูุงุนุงุช ุงูุฑุฃุณ Snom A150 ู Snom A100M ู D</a></li>
<li><a href="../ar457602/index.html">ุงูุจุญุซ ูู ุฃุฏุงุก DBMS MS SQL Server Developer 2016 ู PostgreSQL 10.5 for 1C</a></li>
<li><a href="../ar457606/index.html">ุขูุงู ูุงู: ูุง ุงูุฐู ูููู ุชุณููุชู ุฃูุซุฑ ุงูุฃุดูุงุก ุงููุฏูุดุฉ ุงูุชู ุฌุนูุชูุง ุฃุฌูุฒุฉ ุงูููุจููุชุฑ ููููุฉ</a></li>
<li><a href="../ar457608/index.html">ููููุฉ ุชุตูุฑ ุงูุจูุงูุงุช ูู ูุตุฉ ูููุนุฉ</a></li>
<li><a href="../ar457610/index.html">ุงูุดุฑ ูุง ูุชุฌุฒุฃ ุชุญููู ุงูุถุนู</a></li>
<li><a href="../ar457614/index.html">ุฃุณุฑุงุฑ ุงูุนุซูุฑ ุนูู ูุธููุฉ ูู ุงูุฎุงุฑุฌ ูู ุงูุจุงุญุซ ุนู ููุงุฑุณุฉ</a></li>
<li><a href="../ar457616/index.html">ุจูุฏู "ูุงู ุ ูู ุฃูู ุฃุนุฑู ุฐูู!" ูุญุธุงุช ูุน ุงูุฏุนุงุจุฉ</a></li>
<li><a href="../ar457618/index.html">ูููู ูุทูุฑูุง ุญุฏูุซูุง ุจุงููุงูู</a></li>
<li><a href="../ar457622/index.html">ููุงุณ ุฃุฏุงุก ููู ุชู</a></li>
<li><a href="../ar457624/index.html">ููู ุญุทููุง ุงูููุฎ ุงููุฏูู ูุจูููุง ูุงุทุญุฉ ุณุญุงุจ ูู ููุงูู</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>