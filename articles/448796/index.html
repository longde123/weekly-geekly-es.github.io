<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèº‚Äçüåæ üó≥Ô∏è üçπ Prueba de Python con pytest. Configuraci√≥n, CAP√çTULO 6 üë¥ ‚òÄÔ∏è ü§¶üèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Atr√°s Siguiente 


 En este cap√≠tulo, veremos los archivos de configuraci√≥n que afectan a pytest, discutiremos c√≥mo pytest cambia su comportamiento en...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Prueba de Python con pytest. Configuraci√≥n, CAP√çTULO 6</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/448796/"><p><img src="https://habrastorage.org/webt/jl/jn/bb/jljnbbjr-ejh473xy_eccsmknpk.png">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Atr√°s</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Siguiente</a> <img src="https://habrastorage.org/webt/rw/dy/-g/rwdy-grsvbpcetjttrmecdkxtlk.png"></p><br><p>  <em>En este cap√≠tulo, veremos los archivos de configuraci√≥n que afectan a pytest, discutiremos c√≥mo pytest cambia su comportamiento en funci√≥n de ellos y realizaremos algunos cambios en las tareas de configuraci√≥n del proyecto Tareas.</em> </p><br><p><img src="https://habrastorage.org/webt/hd/--/9w/hd--9w134j0rxhmxftrflbbdopy.png"></p><a name="habracut"></a><br><p>  Los ejemplos en este libro est√°n escritos usando Python 3.6 y pytest 3.2.  pytest 3.2 es compatible con Python 2.6, 2.7 y Python 3.3+. </p><br><blockquote> El c√≥digo fuente para el proyecto Tareas, as√≠ como para todas las pruebas que se muestran en este libro, est√° disponible en el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" title="https://pragprog.com/titles/bopytest/source_code">enlace</a> en la p√°gina web del libro en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" title="https://pragprog.com/titles/bopytest">pragprog.com</a> .  No necesita descargar el c√≥digo fuente para comprender el c√≥digo de prueba;  El c√≥digo de prueba se presenta de forma conveniente en los ejemplos.  Pero para seguir las tareas del proyecto o adaptar ejemplos de prueba para probar su propio proyecto (¬°sus manos est√°n desatadas!), Debe ir a la p√°gina web del libro y descargar el trabajo.  All√≠, en la p√°gina web del libro, hay un enlace para mensajes de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" title="https://pragprog.com/titles/bopytest/errata">erratas</a> y un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" title="https://forums.pragprog.com/forums/438">foro de discusi√≥n</a> . </blockquote><p>  Debajo del spoiler hay una lista de art√≠culos en esta serie. </p><br><div class="spoiler">  <b class="spoiler_title">Tabla de contenidos</b> <div class="spoiler_text"><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><strong>Introduccion</strong></a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><strong>Cap√≠tulo 1: comenzando con pytest</strong></a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><strong>Cap√≠tulo 2: Funciones de prueba de escritura</strong></a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><strong>Cap√≠tulo 3: accesorios de Pytest</strong></a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><strong>Cap√≠tulo 4: Accesorios incorporados</strong></a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><strong>Cap√≠tulo 5: Complementos</strong></a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><strong>Cap√≠tulo 6: Configuraci√≥n</strong></a> (este art√≠culo) </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><strong>Cap√≠tulo 7: Uso de pytest con otras herramientas</strong></a> </li></ul></div></div><br><h2 id="konfiguraciya">  Configuracion </h2><br><p>  Hasta ahora en este libro, he hablado sobre varios archivos que no son de prueba que afectan a pytest principalmente de pasada, con la excepci√≥n de conftest.py, que cubr√≠ con alg√∫n detalle en el Cap√≠tulo 5, Complementos, en la p√°gina 95. En este cap√≠tulo, veremos los archivos de configuraci√≥n, que afectan a pytest, analice c√≥mo pytest cambia su comportamiento en funci√≥n de ellos y realice algunos cambios en los archivos de configuraci√≥n del proyecto Tareas. </p><br><h2 id="ponimanie-faylov-konfiguracii-pytest">  Comprender los archivos de configuraci√≥n de pytest </h2><br><p>  Antes de decirle c√≥mo puede cambiar el comportamiento predeterminado en pytest, repasemos todos los archivos que no son de prueba en pytest y, en particular, qui√©n debe encargarse de ellos. </p><br><p>  Debe saber lo siguiente: </p><br><ul><li> <em>pytest.ini</em> : este es el archivo de configuraci√≥n principal de Pytest que le permite cambiar el comportamiento predeterminado.  Como puede hacer bastantes cambios de configuraci√≥n, la mayor parte de este cap√≠tulo est√° dedicado a la configuraci√≥n que puede realizar en <code>pytest.ini</code> . </li><li>  <em>conftest.py</em> : este es un complemento local que permite conectar funciones y dispositivos de <code>conftest.py</code> al directorio en el que <code>conftest.py</code> archivo <code>conftest.py</code> y todos sus subdirectorios.  El archivo <code>conftest.py</code> describe en el cap√≠tulo 5 "Complementos" en la p√°gina 95. </li><li>  <em><code>__init__.py</code></em> : cuando se coloca en cada subdirectorio de prueba, este archivo le permite tener nombres de archivo de prueba id√©nticos en varios directorios de prueba.  Veremos un ejemplo de lo que podr√≠a salir mal sin los archivos <code>__init__.py</code> en los directorios de prueba en el art√≠culo "C√≥mo evitar colisiones de nombres de archivos" en la p√°gina 120. </li></ul><br><p>  Si usa tox, le interesar√°: </p><br><ul><li>  <em>tox.ini</em> : este archivo es similar a <code>pytest.ini</code> , pero para <code>tox</code> .  Sin embargo, puede poner su configuraci√≥n de <code>pytest</code> lugar de tener el archivo <code>tox.ini</code> y el archivo <code>pytest.ini</code> , lo que le permite guardar un archivo de configuraci√≥n.  Tox se trata en el cap√≠tulo 7, ‚ÄúUso de pytest con otras herramientas‚Äù, en la p√°gina 125. </li></ul><br><p>  Si desea distribuir un paquete de Python (por ejemplo, Tareas), este archivo ser√° de inter√©s: </p><br><ul><li>  <em>setup.cfg</em> : tambi√©n es un archivo INI que afecta el comportamiento de <code>setup.py</code> .  Puede agregar algunas l√≠neas a <code>setup.py</code> para ejecutar la <code>python setup.py test</code> y ejecutar todas sus pruebas de pytest.  Si est√° distribuyendo el paquete, es posible que ya tenga el archivo <code>setup.cfg</code> y puede usar este archivo para almacenar la configuraci√≥n de Pytest.  Ver√° c√≥mo se hace esto en el Ap√©ndice 4, ‚ÄúEmpaquetado y distribuci√≥n de proyectos de Python‚Äù, en la p√°gina 175. </li></ul><br><p>  No importa en qu√© archivo coloque la configuraci√≥n de pytest, el formato ser√° b√°sicamente el mismo. </p><br><p>  Para <code>pytest.ini</code> : </p><br><blockquote>  <strong>ch6 / format / pytest.ini</strong> </blockquote><br><pre> <code class="plaintext hljs">[pytest] addopts = -rsxX -l --tb=short --strict xfail_strict = true ... more options ...</code> </pre> <br><p>  Para <code>tox.ini</code> : </p><br><blockquote>  <strong>ch6 / format / tox.ini</strong> </blockquote><br><pre> <code class="plaintext hljs">... tox specific stuff ... [pytest] addopts = -rsxX -l --tb=short --strict xfail_strict = true ... more options ...</code> </pre> <br><p>  Para <code>setup.cfg</code> : </p><br><blockquote>  <strong>ch6 / format / setup.cfg</strong> </blockquote><br><pre> <code class="plaintext hljs">... packaging specific stuff ... [tool:pytest] addopts = -rsxX -l --tb=short --strict xfail_strict = true ... more options ...</code> </pre> <br><p>  La √∫nica diferencia es que el encabezado de secci√≥n para setup.cfg es <code>[tool:pytest]</code> lugar de <code>[pytest]</code> . </p><br><h3 id="list-the-valid-ini-file-options-with-pytest-help">  Enumere las opciones v√°lidas de ini-file con pytest ‚Äìhelp </h3><br><p>  Puede obtener una lista de todos los par√°metros v√°lidos para <code>pytest.ini</code> de <code>pytest --help</code> : </p><br><pre> <code class="plaintext hljs">$ pytest --help ... [pytest] ini-options in the first pytest.ini|tox.ini|setup.cfg file found: markers (linelist) markers for test functions empty_parameter_set_mark (string) default marker for empty parametersets norecursedirs (args) directory patterns to avoid for recursion testpaths (args) directories to search for tests when no files or directories are given in the command line. console_output_style (string) console output: classic or with additional progress information (classic|progress). usefixtures (args) list of default fixtures to be used with this project python_files (args) glob-style file patterns for Python test module discovery python_classes (args) prefixes or glob names for Python test class discovery python_functions (args) prefixes or glob names for Python test function and method discovery xfail_strict (bool) default for the strict parameter of xfail markers when not given explicitly (default: False) junit_suite_name (string) Test suite name for JUnit report junit_logging (string) Write captured log messages to JUnit report: one of no|system-out|system-err doctest_optionflags (args) option flags for doctests doctest_encoding (string) encoding used for doctest files cache_dir (string) cache directory path. filterwarnings (linelist) Each line specifies a pattern for warnings.filterwarnings. Processed after -W and --pythonwarnings. log_print (bool) default value for --no-print-logs log_level (string) default value for --log-level log_format (string) default value for --log-format log_date_format (string) default value for --log-date-format log_cli (bool) enable log display during test run (also known as "live logging"). log_cli_level (string) default value for --log-cli-level log_cli_format (string) default value for --log-cli-format log_cli_date_format (string) default value for --log-cli-date-format log_file (string) default value for --log-file log_file_level (string) default value for --log-file-level log_file_format (string) default value for --log-file-format log_file_date_format (string) default value for --log-file-date-format addopts (args) extra command line options minversion (string) minimally required pytest version xvfb_width (string) Width of the Xvfb display xvfb_height (string) Height of the Xvfb display xvfb_colordepth (string) Color depth of the Xvfb display xvfb_args (args) Additional arguments for Xvfb xvfb_xauth (bool) Generate an Xauthority token for Xvfb. Needs xauth. ...</code> </pre> <br><p>  Ver√° todas estas configuraciones en este cap√≠tulo, con la excepci√≥n de <code>doctest_optionflags</code> , que se trata en el Cap√≠tulo 7, ‚ÄúUso de pytest con otras herramientas‚Äù, en la p√°gina 125. </p><br><h3 id="plaginy-mogut-dobavlyat-opcii-ini-faylov">  Los complementos pueden agregar opciones de archivo ini </h3><br><p>  La lista anterior de configuraciones no es una constante.  Para complementos (y archivos conftest.py) es posible agregar opciones de archivo ini.  Las opciones agregadas tambi√©n se agregar√°n a la salida del comando pytest --help. <br>  Ahora echemos un vistazo a algunos cambios de configuraci√≥n que podemos hacer usando la configuraci√≥n integrada del archivo .ini disponible en core pytest. </p><br><h3 id="izmenenie-parametrov-komandnoy-stroki-po-umolchaniyu">  Cambiar las opciones de l√≠nea de comando predeterminadas </h3><br><p>  Ya ha utilizado algunas opciones de l√≠nea de comando para <em>pytest</em> , como <code>-v/--verbose</code> para salida detallada <code>-l/--showlocals</code> para ver variables locales con un seguimiento de pila para pruebas fallidas.  Es posible que siempre use algunas de estas <code>options‚Äîor</code> prefiera usarlas <code>them‚Äîfor a project</code> .  Si instala <code>addopts</code> en <code>pytest.ini</code> para los par√°metros que necesita, ya no tendr√° que ingresarlos.  Aqu√≠ hay un conjunto que me gusta: </p><br><pre> <code class="plaintext hljs">[pytest] addopts = -rsxX -l --tb=short --strict</code> </pre> <br><p>  El <code>-rsxX</code> permite a pytest informar los motivos de todas las pruebas <code>skipped</code> , <code>xfailed</code> o <code>xpassed</code> .  El modificador <code>-l</code> permite que pytest muestre un seguimiento de la pila para las variables locales en caso de cada falla.  <code>--tb=short</code> eliminar√° la mayor parte del seguimiento de la pila.  Sin embargo, dejar√° el archivo y el n√∫mero de l√≠nea.  La <code>--strict</code> proh√≠be el uso de tokens si no est√°n registrados en el archivo de configuraci√≥n.  Ver√° c√≥mo hacer esto en la siguiente secci√≥n. </p><br><h3 id="registraciya-markerov-chtoby-izbezhat-opechatok-markera">  Registro de marcadores para evitar errores tipogr√°ficos </h3><br><p>  Los marcadores personalizados, como se describe en ‚ÄúFunciones de prueba de etiquetado‚Äù en la p√°gina 31, son excelentes para permitirle marcar un subconjunto de pruebas para ejecutar con un marcador espec√≠fico.  Sin embargo, es demasiado f√°cil cometer un error en el marcador y, en √∫ltima instancia, algunas pruebas se etiquetan <code>@pytest.mark.smoke</code> y otras se etiquetan <code>@pytest.mark.somke</code> .  Por defecto, esto no es un error.  pytest solo cree que creaste dos marcadores.  Sin embargo, esto se puede solucionar registrando tokens en pytest.ini, por ejemplo, as√≠: </p><br><pre> <code class="plaintext hljs">[pytest] ... markers = smoke: Run the smoke test test functions get: Run the test functions that test tasks.get() ...</code> </pre> <br><p>  Al registrar estos marcadores, ahora tambi√©n puede verlos con <code>pytest --markers</code> con sus descripciones: </p><br><pre> <code class="plaintext hljs">$ cd /path/to/code/ch6/b/tasks_proj/tests $ pytest --markers @pytest.mark.smoke: Run the smoke test test functions @pytest.mark.get: Run the test functions that test tasks.get() @pytest.mark.skip(reason=None): skip the ... ...</code> </pre> <br><p>  Si los marcadores no est√°n registrados, no aparecer√°n en la lista de <code>--markers</code> .  Cuando se registran, se muestran en la lista, y si usa <code>--strict</code> , cualquier token con errores o no registrado se muestra como error.  La √∫nica diferencia entre <code>ch6/a/tasks_proj</code> y <code>ch6/b/tasks_proj</code> es el contenido del archivo pytest.ini.  En <code>ch6/a</code> vac√≠o.  Intentemos ejecutar las pruebas sin registrar ning√∫n marcador: </p><br><pre> <code class="plaintext hljs">$ cd /path/to/code/ch6/a/tasks_proj/tests $ pytest --strict --tb=line ============================= test session starts ============================= collected 45 items / 2 errors =================================== ERRORS ==================================== ______________________ ERROR collecting func/test_add.py ______________________ 'smoke' not a registered marker ________________ ERROR collecting func/test_api_exceptions.py _________________ 'smoke' not a registered marker !!!!!!!!!!!!!!!!!!! Interrupted: 2 errors during collection !!!!!!!!!!!!!!!!!!! =========================== 2 error in 1.10 seconds ===========================</code> </pre> <br><p>  Si usa marcadores en <code>pytest.ini</code> para registrar sus marcadores, tambi√©n puede agregar <code>--strict</code> a sus <code>addopts</code> mientras lo hace.  Me lo agradecer√°s m√°s tarde.  Avancemos y agreguemos un archivo pytest.ini al proyecto de tareas: </p><br><p>  Si usa marcadores en <code>pytest.ini</code> para registrar sus marcadores, tambi√©n puede agregar <code>--strict</code> a sus <code>addopts</code> .  Me lo agradecer√°s m√°s tarde.  Continuemos y agreguemos el archivo pytest.ini al proyecto de tarea: </p><br><p>  Si usa tokens en <code>pytest.ini</code> para registrar tokens, tambi√©n puede agregar <code>--strict</code> a los existentes con <code>addopts</code> .  Genial?  <code>pytest.ini</code> gracias y agregue el archivo <code>pytest.ini</code> al proyecto de <code>tasks</code> : </p><br><blockquote>  ch6 / b / task_proj / tests / pytest.ini </blockquote><br><pre> <code class="plaintext hljs">[pytest] addopts = -rsxX -l --tb=short --strict markers = smoke: Run the smoke test test functions get: Run the test functions that test tasks.get()</code> </pre> <br><p>  Aqu√≠ est√° la combinaci√≥n de banderas preferidas por defecto: </p><br><ul><li>  <code>-rsxX</code> para <code>-rsxX</code> qu√© pruebas se omiten, xfailed o xpassed, </li><li>  <code>--tb = short</code> para una traza m√°s corta en fallas, </li><li>  <code>--strict</code> para permitir solo tokens declarados. <br>  Y una lista de marcadores para el proyecto. </li></ul><br><p>  Esto deber√≠a permitirnos realizar pruebas, incluidas pruebas de humo: </p><br><pre> <code class="plaintext hljs">$ cd /path/to/code/ch6/b/tasks_proj/tests $ pytest --strict -m smoke ===================== test session starts ====================== collected 57 items func/test_add.py . func/test_api_exceptions.py .. ===================== 54 tests deselected ====================== =========== 3 passed, 54 deselected in 0.06 seconds ============</code> </pre> <br><h3 id="trebovanie-minimalnoy-versii-pytest">  Requisito m√≠nimo de Pytest </h3><br><p>  El par√°metro <code>minversion</code> permite especificar la versi√≥n m√≠nima de pytest esperada para las pruebas.  Por ejemplo, ten√≠a la intenci√≥n de usar <code>approx()</code> al probar n√∫meros de punto flotante para determinar la igualdad "bastante cercana" en las pruebas.  Pero esta funci√≥n no se introdujo en pytest hasta la versi√≥n 3.0.  Para evitar confusiones, agrego lo siguiente a los proyectos que usan <code>approx()</code> : </p><br><pre> <code class="plaintext hljs">[pytest] minversion = 3.0</code> </pre> <br><p>  Por lo tanto, si alguien intenta ejecutar pruebas con una versi√≥n anterior de pytest, aparecer√° un mensaje de error. </p><br><h3 id="ostanovka-pytest-ot-poiska-v-nepravilnyh-mestah">  Evite que Pytest busque en los lugares equivocados </h3><br><p>  ¬øSab√≠a que una de las definiciones de "recurse" es jurar dos veces en su propio c√≥digo?  Pues no.  De hecho, esto significa contabilizar subdirectorios.  pytest permitir√° la detecci√≥n de pruebas al examinar de forma recursiva un mont√≥n de directorios.  Pero hay algunos directorios que desea excluir de la visualizaci√≥n de Pytest. </p><br><p>  El valor predeterminado para <code>norecurse</code> es <code>'. * Build dist CVS _darcs {arch} and *.egg. Having '.*'</code> <code>'. * Build dist CVS _darcs {arch} and *.egg. Having '.*'</code>  <code>'. * Build dist CVS _darcs {arch} and *.egg. Having '.*'</code> Es una buena raz√≥n para nombrar su entorno virtual '.venv', porque todos los directorios que comienzan con un punto no ser√°n visibles. </p><br><p>  En el caso del proyecto Tareas, <code>src</code> no har√° da√±o al especificar, porque buscar en los archivos de prueba usando pytest ser√° una p√©rdida de tiempo. </p><br><pre> <code class="plaintext hljs">[pytest] norecursedirs = .* venv src *.egg dist build</code> </pre> <br><p>  Al anular un par√°metro que ya tiene un valor √∫til, como este par√°metro, es √∫til saber cu√°les son los valores predeterminados y devolver los que necesita, como hice en el c√≥digo anterior con <code>*.egg dist build</code> . <br>  <code>norecursedirs</code> es un tipo de consecuencia para las rutas de prueba, as√≠ que echemos un vistazo a esto m√°s adelante. </p><br><h3 id="specifikaciya-dereva-testovogo-kataloga">  especificaci√≥n de √°rbol de directorio de prueba </h3><br><p>  Mientras que <code>norecursedirs</code> le dice a pytest d√≥nde mirar, <code>testpaths</code> le dice a pytest d√≥nde mirar.  <code>testspaths</code> es una lista de directorios relativos al directorio ra√≠z para encontrar pruebas.  Se usa solo si el directorio, archivo o <code>nodeid</code> no se especifica como argumento. </p><br><p>  Supongamos que para un proyecto de <code>Tasks</code> colocamos <code>pytest.ini</code> en el directorio <code>tasks_proj</code> lugar de pruebas: </p><br><pre> <code class="plaintext hljs">\code\tasks_proj&gt;tree/f . ‚îÇ pytest.ini ‚îÇ ‚îú‚îÄ‚îÄ‚îÄsrc ‚îÇ ‚îî‚îÄ‚îÄ‚îÄtasks ‚îÇ api.py ‚îÇ ... ‚îÇ ‚îî‚îÄ‚îÄ‚îÄtests ‚îÇ conftest.py ‚îÇ pytest.ini ‚îÇ ‚îú‚îÄ‚îÄ‚îÄfunc ‚îÇ test_add.py ‚îÇ ... ‚îÇ ‚îú‚îÄ‚îÄ‚îÄunit ‚îÇ test_task.py ‚îÇ __init__.py ‚îÇ ...</code> </pre> <br><p>  Entonces podr√≠a tener sentido poner las pruebas en <code>testpaths</code> de <code>testpaths</code> : </p><br><pre> <code class="plaintext hljs">[pytest] testpaths = tests</code> </pre> <br><p>  Ahora, si ejecuta pytest desde el directorio task_proj, pytest solo buscar√° en <code>tasks_proj/tests</code> .  El problema aqu√≠ es que durante el desarrollo y la depuraci√≥n de las pruebas, a menudo itero sobre el directorio de prueba, por lo que puedo probar f√°cilmente un subdirectorio o archivo sin especificar la ruta completa.  Por lo tanto, esta opci√≥n me ayuda un poco en las pruebas interactivas. </p><br><p>  Sin embargo, es ideal para pruebas que se ejecutan desde un servidor de integraci√≥n continua o tox.  En estos casos, sabe que el directorio ra√≠z ser√° fijo y puede enumerar los directorios relativos a ese directorio ra√≠z fijo.  Estos tambi√©n son los casos en los que realmente desea reducir el tiempo de prueba, por lo que deshacerse de la b√∫squeda de pruebas es excelente. </p><br><p>  A primera vista, puede parecer una tonter√≠a usar tanto rutas de prueba como no <code>norecursedirs</code> al mismo tiempo.  Sin embargo, como ya ha visto, las rutas de prueba ayudan poco en las pruebas interactivas desde diferentes partes del sistema de archivos.  En estos casos, los no <code>norecursedirs</code> pueden ayudar.  Adem√°s, si tiene directorios de prueba que no contienen pruebas, puede usar <code>norecursedirs</code> para evitarlos.  Pero en realidad, ¬øqu√© sentido tiene poner directorios adicionales en pruebas que no tienen pruebas? </p><br><h2 id="izmenenie-pravil-obnaruzheniya-testov">  Cambio de reglas de detecci√≥n de prueba </h2><br><p>  pytest encuentra pruebas para ejecutar en base a reglas espec√≠ficas de descubrimiento de pruebas.  Reglas de detecci√≥n de prueba est√°ndar: </p><br><p>  ‚Ä¢ Comience con uno o m√°s directorios.  Puede especificar los nombres de archivos o directorios en la l√≠nea de comando.  Si no especific√≥ nada, se utiliza el directorio actual. <br>  ‚Ä¢ Busque en el cat√°logo y en todos sus subdirectorios los m√≥dulos de prueba. <br>  ‚Ä¢ Un m√≥dulo de prueba es un archivo con un nombre similar a <code>test_*.py</code> o <code>*_test.py</code> . <br>  ‚Ä¢ Busque en los m√≥dulos de prueba las funciones que comienzan con la prueba <em>.</em> <em><br></em>  <em>‚Ä¢ Busque clases que comienzan con Test.</em>  <em>Busque m√©todos en las clases que comienzan con `test</em> <code>,    </code> <strong>init`</strong> . </p><br><p>  Estas son reglas de detecci√≥n est√°ndar;  Sin embargo, puedes cambiarlos. </p><br><h3 id="python_classes">  python_classes </h3><br><p>  La regla habitual para encontrar pruebas para pytest y clases es considerar una clase como una clase de prueba potencial si comienza con <code>Test*</code> .  La clase tampoco puede tener el <code>__init__()</code> .  Pero, ¬øqu√© pasa si queremos nombrar nuestras clases de prueba como <code>&lt;something&gt;Test</code> o <code>&lt;something&gt;Suite</code> ?  Aqu√≠ es donde entra <code>python_classes</code> : </p><br><pre> <code class="plaintext hljs">[pytest] python_classes = *Test Test* *Suite</code> </pre> <br><p>  Esto nos permite nombrar las clases as√≠: </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DeleteSuite</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">()</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_delete_1</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_delete_2</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> ... ....</code> </pre> <br><h3 id="python_files">  python_files </h3><br><p>  Al igual que <code>pytest_classes</code> , <code>python_files</code> modifica la regla de detecci√≥n de prueba predeterminada, que consiste en encontrar archivos que comienzan con <code>test_*</code> o tienen <code>*_test</code> al final. <br>  Supongamos que tiene un marco de prueba personalizado en el que nombra todos sus archivos de prueba <code>check_&lt;something&gt;.py</code> .  Parece razonable  En lugar de renombrar todos sus archivos, simplemente agregue una l√≠nea a <code>pytest.ini</code> siguiente manera: </p><br><pre> <code class="plaintext hljs">[pytest] python_files = test_* *_test check_*</code> </pre> <br><p>  Muy simple  Ahora puede transferir gradualmente la convenci√≥n de nomenclatura si lo desea, o simplemente dejarla como <code>check_*</code> . </p><br><h3 id="python_functions">  Python_functions </h3><br><p>  <code>python_functions</code> act√∫a como las dos configuraciones anteriores, pero para funciones de prueba y nombres de m√©todos.  El valor predeterminado es <code>test_*</code> .  Y para agregar <code>check_*</code> adivinado, haz esto: </p><br><pre> <code class="plaintext hljs">[pytest] python_functions = test_* check_*</code> </pre> <br><p>  Las <code>pytest</code> nombres de <code>pytest</code> no parecen tan restrictivas, ¬øverdad?  Entonces, si no le gusta la convenci√≥n de nomenclatura predeterminada, simplemente c√°mbiela.  Sin embargo, le insto a que tenga una raz√≥n m√°s convincente para tales decisiones.  La migraci√≥n de cientos de archivos de prueba es definitivamente una buena raz√≥n. </p><br><h2 id="zapret-xpass">  Prohibici√≥n XPASS </h2><br><p>  Establecer <code>xfail_strict = true</code> significa que las pruebas marcadas con <code>@pytest.mark.xfail</code> no se reconocen como causantes del error.  Creo que esta configuraci√≥n siempre deber√≠a ser.  Para obtener m√°s informaci√≥n sobre el token <code>xfail</code> consulte ‚ÄúMarcado de pruebas en espera de falla‚Äù en la p√°gina 37. </p><br><h2 id="predotvraschenie-konfliktov-imen-faylov">  Prevenir conflictos de nombre de archivo </h2><br><p>  La utilidad de tener el archivo <code>__init__.py</code> en cada subdirectorio de prueba del proyecto me confundi√≥ durante mucho tiempo.  Sin embargo, la diferencia entre tenerlos o no tenerlos es simple.  Si tiene archivos <code>__init__.py</code> en todos sus subdirectorios de prueba, puede tener el mismo nombre de archivo de prueba en varios directorios.  Y si no, entonces esto no funcionar√°. </p><br><p>  Aqu√≠ hay un ejemplo.  Los directorios <code>b</code> tienen el archivo <code>test_foo.py</code> .  No importa lo que contengan estos archivos, pero para este ejemplo se ven as√≠: </p><br><blockquote>  <strong>ch6 / dups / a / test_foo.py</strong> <br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_a</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span></code> </pre> <br><br>  <strong>ch6 / dups / b / test_foo.py</strong> <br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_b</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span></code> </pre> <br></blockquote><p>  Con esta estructura de directorios: </p><br><pre> <code class="plaintext hljs">dups ‚îú‚îÄ‚îÄ a ‚îÇ ‚îî‚îÄ‚îÄ test_foo.py ‚îî‚îÄ‚îÄ b ‚îî‚îÄ‚îÄ test_foo.py</code> </pre> <br><p>  Estos archivos ni siquiera tienen el mismo contenido, pero las pruebas est√°n da√±adas.  Podr√° ejecutarlos por separado, pero no hay forma de ejecutar <code>pytest</code> desde el directorio <code>dups</code> : </p><br><pre> <code class="plaintext hljs">$ cd /path/to/code/ch6/dups $ pytest a ============================= test session starts ============================= collected 1 item a\test_foo.py . ========================== 1 passed in 0.05 seconds =========================== $ pytest b ============================= test session starts ============================= collected 1 item b\test_foo.py . ========================== 1 passed in 0.05 seconds =========================== $ pytest ============================= test session starts ============================= collected 1 item / 1 errors =================================== ERRORS ==================================== _______________________ ERROR collecting b/test_foo.py ________________________ import file mismatch: imported module 'test_foo' has this __file__ attribute: /path/to/code/ch6/dups/a/test_foo.py which is not the same as the test file we want to collect: /path/to/code/ch6/dups/b/test_foo.py HINT: remove __pycache__ / .pyc files and/or use a unique basename for your test file modules !!!!!!!!!!!!!!!!!!! Interrupted: 1 errors during collection !!!!!!!!!!!!!!!!!!! =========================== 1 error in 0.34 seconds ===========================</code> </pre> <br><p>  ¬°Nada est√° claro! <br>  Este mensaje de error no indica qu√© sali√≥ mal. </p><br><p>  Para corregir esta prueba, simplemente agregue el archivo <code>__init__.py</code> vac√≠o a los subdirectorios.  Aqu√≠ hay un ejemplo del directorio <code>dups_fixed</code> con los mismos nombres de archivos duplicados, pero con los archivos <code>__init__.py</code> agregados: </p><br><pre> <code class="plaintext hljs">dups_fixed/ ‚îú‚îÄ‚îÄ a ‚îÇ ‚îú‚îÄ‚îÄ __init__.py ‚îÇ ‚îî‚îÄ‚îÄ test_foo.py ‚îî‚îÄ‚îÄ b ‚îú‚îÄ‚îÄ __init__.py ‚îî‚îÄ‚îÄ test_foo.py</code> </pre> <br><p>  Ahora intentemos nuevamente desde el nivel superior en <code>dups_fixed</code> : </p><br><pre> <code class="plaintext hljs">$ cd /path/to/code/ch6/ch6/dups_fixed/ $ pytest ============================= test session starts ============================= collected 2 items a\test_foo.py . b\test_foo.py . ========================== 2 passed in 0.15 seconds ===========================</code> </pre> <br><p>  Entonces ser√° mejor. </p><br><p>  Por supuesto, puede convencerse de que nunca tendr√° nombres de archivos duplicados, por lo que eso no importa.  Todo, como, es normal.  Pero los proyectos est√°n creciendo y los cat√°logos de prueba est√°n creciendo, ¬øy definitivamente quieres esperar a que te suceda antes de ocuparte?  Yo digo, solo pon estos archivos all√≠.  Hazlo un h√°bito y no te preocupes por eso otra vez. </p><br><h2 id="uprazhneniya">  Ejercicios </h2><br><p>  En el Cap√≠tulo 5, Complementos, en la p√°gina 95, cre√≥ un complemento llamado pytest-nice que inclu√≠a una opci√≥n de l√≠nea de comandos --nice.  Extendamos eso para incluir una opci√≥n de pytest.ini llamada nice. </p><br><p>  En el Cap√≠tulo 5, ‚ÄúComplementos‚Äù en la p√°gina 95, cre√≥ un complemento llamado <code>pytest-nice</code> que incluye la <code>--nice</code> l√≠nea de comandos <code>--nice</code> .  <code>pytest.ini</code> esto para incluir la opci√≥n <code>pytest.ini</code> llamada <code>nice</code> . </p><br><ol><li>  Agregue la siguiente l√≠nea a la <code>pytest_addoption</code> <code>pytest_nice.py</code> <code>pytest_addoption</code> <code>pytest_nice.py</code> : <code>parser.addini('nice', type='bool', help='Turn failures into opportunities.')</code> </li><li>  Los lugares en el complemento que usan <code>getoption()</code> tambi√©n tendr√°n que llamar a <code>getini('nice')</code> .  Haz estos cambios. </li><li>  Verifique esto manualmente agregando <code>nice</code> al archivo <code>pytest.ini</code> . </li><li>  No te olvides de las pruebas de complementos.  Agregue una prueba para verificar que el <code>nice</code> par√°metro de <code>pytest.ini</code> funciona correctamente. </li><li>  Agregue pruebas al directorio de complementos.  Necesita encontrar algunas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">caracter√≠sticas adicionales de Pytester</a> . </li></ol><br><h2 id="chto-dalshe">  Que sigue </h2><br><p>  Si bien pytest es extremadamente poderoso en s√≠ mismo, especialmente con complementos, tambi√©n se integra bien con otras herramientas de desarrollo y prueba de software.  En el pr√≥ximo cap√≠tulo, examinaremos el uso de pytest junto con otras potentes herramientas de prueba. </p><br><p><img src="https://habrastorage.org/webt/jl/jn/bb/jljnbbjr-ejh473xy_eccsmknpk.png">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Atr√°s</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Siguiente</a> <img src="https://habrastorage.org/webt/rw/dy/-g/rwdy-grsvbpcetjttrmecdkxtlk.png"></p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/448796/">https://habr.com/ru/post/448796/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../448774/index.html">SQL a CSV usando DBMS_SQL</a></li>
<li><a href="../448776/index.html">RxVMS: una arquitectura pr√°ctica para aplicaciones de flutter</a></li>
<li><a href="../448778/index.html">Presentaci√≥n de la depuraci√≥n de viajes en el tiempo para Visual Studio Enterprise 2019</a></li>
<li><a href="../448792/index.html">Prueba de Python con pytest. Accesorios incorporados, Cap√≠tulo 4</a></li>
<li><a href="../448794/index.html">Prueba de Python con pytest. Complementos CAP√çTULO 5</a></li>
<li><a href="../448798/index.html">Prueba de Python con pytest. Usando pytest con otras herramientas, CAP√çTULO 7</a></li>
<li><a href="../448800/index.html">Configure Visual Studio en toda su organizaci√≥n con .vsconfig</a></li>
<li><a href="../448802/index.html">Pensar con portales: crear portales en Unreal Engine 4</a></li>
<li><a href="../448804/index.html">Prepar√°ndose para el tiempo de ejecuci√≥n y el notario endurecidos de macOS</a></li>
<li><a href="../448806/index.html">Crear un sistema de extensi√≥n en la biblioteca Qt</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>