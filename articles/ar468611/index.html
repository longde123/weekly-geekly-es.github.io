<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ ๐ฉ๐ฟโโ๏ธ ๐ฉโโค๏ธโ๐ฉ . NET multithreading: ุนูุฏูุง ูููุต ุงูุฃุฏุงุก โ๏ธ ๐ข ๐ฏ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ูููุฑ ุงููุธุงู ุงูุฃุณุงุณู .NET ุงูุนุฏูุฏ ูู ุจุฏุงูุงุช ุงูุชุฒุงูู ุงููุฏูุฌุฉ ููุฌููุนุงุช ุณูุงุณู ุฃูุงู ุขููุฉ. ุฅุฐุง ููุช ุจุญุงุฌุฉ ุฅูู ุชูููุฐ ุ ุนูู ุณุจูู ุงููุซุงู ุ ุฐุงูุฑุฉ ุชุฎุฒูู ูุคูุช ุขููุฉ ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>. NET multithreading: ุนูุฏูุง ูููุต ุงูุฃุฏุงุก</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jugru/blog/468611/" style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/rn/su/tj/rnsutjjvg7sllluahknu8brlnbc.jpeg"><br><br>  ูููุฑ ุงููุธุงู ุงูุฃุณุงุณู .NET ุงูุนุฏูุฏ ูู ุจุฏุงูุงุช ุงูุชุฒุงูู ุงููุฏูุฌุฉ ููุฌููุนุงุช ุณูุงุณู ุฃูุงู ุขููุฉ.  ุฅุฐุง ููุช ุจุญุงุฌุฉ ุฅูู ุชูููุฐ ุ ุนูู ุณุจูู ุงููุซุงู ุ ุฐุงูุฑุฉ ุชุฎุฒูู ูุคูุช ุขููุฉ ููุคุดุฑ ุงูุชุฑุงุจุท ุฃู ูุงุฆูุฉ ุงูุชุธุงุฑ ุทูุจ ุนูุฏ ุชุทููุฑ ุชุทุจูู ูุง ุ ุนุงุฏุฉ ูุง ุชุณุชุฎุฏู ูุฐู ุงูุญููู ุงูุฌุงูุฒุฉ ุ ูุฃุญูุงููุง ูุชุนุฏุฏุฉ ูู ููุช ูุงุญุฏ.  ูู ุจุนุถ ุงูุญุงูุงุช ุ ูุคุฏู ูุฐุง ุฅูู ูุดุงูู ูู ุงูุฃุฏุงุก: ุงูุงูุชุธุงุฑ ุงูุทููู ููุฃููุงู ุ ูุงูุงุณุชููุงู ุงูููุฑุท ููุฐุงูุฑุฉ ูุฌูุน ุงูุจูุงูุงุช ุงูููููุฉ ุงูุทูููุฉ. <br><br>  ูููู ุญู ูุฐู ุงููุดููุงุช ุฅุฐุง ุฃุฎุฐูุง ูู ุงูุงุนุชุจุงุฑ ุฃู ุงูุญููู ุงูููุงุณูุฉ ุฃุตุจุญุช ุนุงูุฉ ุชูุงููุง - ูููู ุฃู ูููู ููุง ุชุฃุซูุฑ ูุจูุฑ ูู ุณููุงุฑูููุงุชูุง ุงูุชู ูุง ูุฒูู ููุง.  ููููุง ูุฐูู ุ ููููู ุฃู ุชูุชุจ ุ ุนูู ุณุจูู ุงููุซุงู ุ ูุฌููุนุชู ุงููุนุงูุฉ ูุณูุณูุฉ ุงูุฑุณุงุฆู ุงูุฎุงุตุฉ ุจุญุงูุฉ ูุนููุฉ. <br><br>  ุชุญุช cutscene ูู ููุทุน ููุฏูู ููุณุฎุฉ ูู ุชูุฑูุฑู ูู ูุคุชูุฑ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">DotNext</a> ุ ุญูุซ ุฃููู ุจุชุญููู ุจุนุถ ุงูุฃูุซูุฉ ุนูุฏ ุงุณุชุฎุฏุงู ุฃุฏูุงุช ูู ููุชุจุฉ .NET ุงูููุงุณูุฉ (Task.Delay ู SemaphoreSlim ู ConcurrentDictionary) ุฃุฏุช ุฅูู ุงูุฎูุงุถ ุงูุฃุฏุงุก ุ ูุงูุชุฑุญ ุญูููุงู ูุตููุฉ ุฎุตูุตูุง ูููุงู ูุญุฏุฏุฉ ูุฎุงููุฉ ูู ูุฐู ุงูุนููุจ. <br><a name="habracut"></a><br><iframe width="560" height="315" src="https://www.youtube.com/embed/-tNeYjRNJtY" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  ูู ููุช ุงูุชูุฑูุฑ ุ ูุงู ูุนูู ูู Kontur.  ูููู Kontur ุจุชุทููุฑ ุชุทุจููุงุช ูุฎุชููุฉ ููุฃุนูุงู ุ ูุงููุฑูู ุงูุฐู ุนููุช ููู ูุชุนุงูู ูุน ุงูุจููุฉ ุงูุชุญุชูุฉ ููุทูุฑ ุฎุฏูุงุช ุงูุฏุนู ุงููุฎุชููุฉ ูุงูููุชุจุงุช ุงูุชู ุชุณุงุนุฏ ุงููุทูุฑูู ูู ุงููุฑู ุงูุฃุฎุฑู ุนูู ุฅูุดุงุก ุฎุฏูุงุช ููุชุฌุงุช. <br><br>  ูููู ูุฑูู ุงูุจููุฉ ุงูุชุญุชูุฉ ุจุจูุงุก ูุณุชูุฏุน ุงูุจูุงูุงุช ุงูุฎุงุต ุจู ุ ููุธุงู ุงุณุชุถุงูุฉ ุงูุชุทุจููุงุช ููุธุงู ุงูุชุดุบูู Windows ูุงูููุชุจุงุช ุงููุฎุชููุฉ ูุชุทููุฑ ุงูุฎุฏูุงุช ุงููุตุบุฑุฉ.  ุชุนุชูุฏ ุชุทุจููุงุชูุง ุนูู ุจููุฉ ุงูุฎุฏูุงุช ุงููุตุบุฑุฉ - ุชุชูุงุนู ุฌููุน ุงูุฎุฏูุงุช ูุน ุจุนุถูุง ุงูุจุนุถ ุนุจุฑ ุงูุดุจูุฉ ุ ูุจุงูุทุจุน ุ ูุฅููุง ุชุณุชุฎุฏู ุงููุซูุฑ ูู ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ุบูุฑ ุงููุชุฒุงููุฉ ูุงููุชุนุฏุฏุฉ ุงูุฎููุท.  ุจุนุถ ูุฐู ุงูุชุทุจููุงุช ููุง ุฃูููุฉ ุจุงูุบุฉ ูู ุงูุฃุฏุงุก ุ ููู ุจุญุงุฌุฉ ุฅูู ุฃู ุชููู ูุงุฏุฑุฉ ุนูู ูุนุงูุฌุฉ ุงููุซูุฑ ูู ุงูุทูุจุงุช. <br><br>  ูุง ุงูุฐู ุณูุชุญุฏุซ ุนูู ุงููููุ <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุชุนุฏุฏ ุงูุนูููุงุช ูุชุฒุงูู ูู. NET ุ </li><li style=";text-align:right;direction:rtl">  ุญุดู ุจุฏุงุฆู ุงูุชุฒุงูู ูุงููุฌููุนุงุช ุ </li><li style=";text-align:right;direction:rtl">  ูุงุฐุง ุชูุนู ุฅุฐุง ูุงูุช ุงูุทุฑู ุงูููุงุณูุฉ ูุง ุชุณุชุทูุน ููุงุฌูุฉ ุงูุญููุ </li></ul><br>  ุฏุนูุง ูุญูู ุจุนุถ ููุฒุงุช ุงูุนูู ุจุฑูุฒ ูุชุนุฏุฏ ูุคุดุฑุงุช ุงูุชุฑุงุจุท ูุบูุฑ ูุชุฒุงูู ูู .NET.  ุฏุนููุง ูููู ูุธุฑุฉ ุนูู ุจุนุถ ุจุฏุงุฆู ุงูุชุฒุงูู ูุงููุฌููุนุงุช ุงููุชุฒุงููุฉ ุ ููุฑู ููู ูุชู ุชุฑุชูุจูุง ุจุงูุฏุงุฎู.  ุณููุงูุด ูุง ูุฌุจ ุงูููุงู ุจู ุฅุฐุง ูู ููู ููุงู ุฃุฏุงุก ูุงูู ุ ูุฅุฐุง ูู ุชุชููู ุงููุฆุงุช ุงูููุงุณูุฉ ูู ุงูุชุบูุจ ุนูู ุงูุนุจุก ุ ููุง ุฅุฐุง ูุงู ูููู ุงูููุงู ุจุดูุก ูุง ูู ูุฐุง ุงููููู. <br><br>  ุณุฃุฎุจุฑู ุจุฃุฑุจุนุฉ ูุตุต ุญุฏุซุช ูู ูููุน ุงูุฅูุชุงุฌ ูุฏููุง. <br><br><h2 style=";text-align:right;direction:rtl">  ุงูุชุงุฑูุฎ 1: Task.Delay ู TimerQueue </h2><br>  ูุฐู ุงููุตุฉ ูุนุฑููุฉ ุฌูุฏูุง ุจุงููุนู ุ ุจูุง ูู ุฐูู ุญูููุง ูู DotNext ุงูุณุงุจูุฉ.  ููุน ุฐูู ุ ููุฏ ุญุตูุช ุนูู ุชุชูุฉ ูุซูุฑุฉ ููุงูุชูุงู ุฅูู ุญุฏ ูุง ุ ูุฐูู ุฃุถูุชู.  ุฅุฐู ูุง ูู ุงูููุทุฉุ <br><br><h3 style=";text-align:right;direction:rtl">  1.1 ุงูุงูุชุฑุงุน ูุงูุงูุชุฑุงุน ุงูุทููู </h3><br>  ูููุฐ ุงูุฎุงุฏู ุนูููุงุช ุทูููุฉ ุ ูููุชุธุฑ ุงูุนููู ูุฐู ุงูุนูููุงุช. <br>  <b>ุงูุงูุชุฑุงุน:</b> ูุณุฃู ุงูุนููู ุงูุฎุงุฏู ุจุดูู ุฏูุฑู ุนู ุงููุชูุฌุฉ. <br>  <b>ุงุณุชุทูุงุนุงุช ุทูููุฉ:</b> ูุฑุณู ุงูุนููู ุทูุจูุง ูุน ูููุฉ ุทูููุฉ ุ ููุณุชุฌูุจ ุงูุฎุงุฏู ุนูุฏ ุงูุชูุงู ุงูุนูููุฉ. <br><br>  ุงููุฒุงูุง: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุฃูู ุญุฑูุฉ ุงููุฑูุฑ </li><li style=";text-align:right;direction:rtl">  ูุชุนุฑู ุงูุนููู ุนูู ุงููุชูุฌุฉ ุจุดูู ุฃุณุฑุน </li></ul><br>  ุชุฎูู ุฃู ูุฏููุง ุฎุงุฏู ููููู ูุนุงูุฌุฉ ุจุนุถ ุงูุทูุจุงุช ุงูุทูููุฉ ุ ุนูู ุณุจูู ุงููุซุงู ุ ุชุทุจูู ูุญูู ูููุงุช XML ุฅูู PDF ุ ูููุงู ุนููุงุก ูููููู ุจุชุดุบูู ูุฐู ุงูููุงู ูููุนุงูุฌุฉ ููุฑูุฏูู ุงูุชุธุงุฑ ูุชุงุฆุฌูู ุจุดูู ุบูุฑ ูุชุฒุงูู.  ููู ูููู ุชุญููู ูุฐุง ุงูุชููุนุ <br><br>  ุงูุทุฑููุฉ ุงูุฃููู ูู <b>ุงูุงูุชุฑุงุน</b> .  ูุจุฏุฃ ุงูุนููู ุงููููุฉ ุนูู ุงูุฎุงุฏู ุ ุซู ูุชุญูู ุจุดูู ุฏูุฑู ูู ุญุงูุฉ ูุฐู ุงููููุฉ ุ ุจูููุง ูุนุฑุถ ุงูุฎุงุฏู ุญุงูุฉ ุงููููุฉ ("ููุชูู" / "ูุดู" / "ููุชูู ุจุฎุทุฃ").  ูุฑุณู ุงูุนููู ุทูุจุงุช ุจุดูู ุฏูุฑู ุญุชู ุชุธูุฑ ุงููุชูุฌุฉ. <br><br>  ุงูุทุฑููุฉ ุงูุซุงููุฉ ูู <b>ุงูุงูุชุฑุงุน ุงูุทููู</b> .  ุงููุฑู ููุง ูู ุฃู ุงูุนููู ูุฑุณู ุทูุจุงุช ูุน ูููุฉ ุทูููุฉ.  ุงูุฎุงุฏู ุงูุฐู ูุชููู ูุซู ูุฐุง ุงูุทูุจ ุ ูู ูุจูุบ ุนูู ุงูููุฑ ุจุฃู ุงููููุฉ ูู ุชูุชูู ุ ููููู ุณูุญุงูู ุงูุงูุชุธุงุฑ ุจุนุถ ุงูููุช ุญุชู ุชุธูุฑ ุงููุชูุฌุฉ. <br>  ููุง ูู ููุฒุฉ ุงูุงูุชุฑุงุน ุงูุทููู ุนูู ุงูุงูุชุฑุงุน ุงูููุชุธูุ  ุฃููุงู ุ ูุชู ุฅูุดุงุก ุญุฑูุฉ ูุฑูุฑ ุฃูู.  ูุญู ููุฏู ุนุฏุฏูุง ุฃูู ูู ุทูุจุงุช ุงูุดุจูุฉ - ูุชู ุชุนูุจ ุญุฑูุฉ ูุฑูุฑ ุฃูู ุนุจุฑ ุงูุดุจูุฉ.  ุฃูุถูุง ุ ุณูุชููู ุงูุนููู ูู ูุนุฑูุฉ ุงููุชูุฌุฉ ุจุดูู ุฃุณุฑุน ูู ุงูุงุณุชุทูุงุน ุงูููุชุธู ุ ูุฃูู ูุง ูุญุชุงุฌ ุฅูู ุงูุชุธุงุฑ ุงููุงุตู ุงูุฒููู ุจูู ุงูุนุฏูุฏ ูู ุทูุจุงุช ุงูุงูุชุฑุงุน.  ูุง ูุฑูุฏ ุงูุญุตูู ุนููู ุฃูุฑ ููููู.  ููู ุณูููุฐ ูุฐุง ูู ุงูููุฏุ <br><blockquote style=";text-align:right;direction:rtl">  ุงููููุฉ: ูููุฉ <br>  ูุฑูุฏ ุฃู ููุชุธุฑ ุงููููุฉ ูุน ูููุฉ <br>  ูู ุงูุชุธุงุฑ SendAsync () ุ </blockquote>  ุนูู ุณุจูู ุงููุซุงู ุ ูุฏููุง ูููุฉ ุชุฑุณู ุทูุจูุง ุฅูู ุงูุฎุงุฏู ุ ููุฑูุฏ ุฃู ููุชุธุฑ ูุชูุฌุชูุง ูุน ูููุฉ ุ ุฃู ุฃููุง ุณูุฑุฌุน ูุชูุฌุฉ ูุฐู ุงููููุฉ ุฃู ูุฑุณู ููุนูุง ูู ุงูุฎุทุฃ.  ุณูุจุฏู ุฑูุฒ C # ููุฐุง: <br><br><pre style=";text-align:right;direction:rtl"><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> sendTask = SendAsync(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> delayTask = Task.Delay(timeout); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> task = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> Task.WhenAny(sendTask, delayTask); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (task == delayTask) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Timeout;</code> </pre> <br>  ููุทูู ูุฐุง ุงูุฑูุฒ ูููุชูุง ุ ุงูุชู ูุฑูุฏ ุฃู ููุชุธุฑ ูุชูุฌุฉ ููุง ุ ู Task.Delay.  ุจุนุฏ ุฐูู ุ ุจุงุณุชุฎุฏุงู Task.WhenAny ุ ูุญู ูู ุงูุชุธุงุฑ ุฅูุง Task ุฃู Task.Delay.  ุฅุฐุง ุชุจูู ุฃู Task.Delay ูุชู ุชูููุฐู ุฃููุงู ุ ูุฅู ุงูููุช ูุฏ ุงูุชูู ููุฏููุง ูููุฉ ุ ูุฌุจ ุนูููุง ุฅุฑุฌุงุน ุฎุทุฃ. <br><br>  ูุฐุง ุงูููุฏ ุ ุจุงูุทุจุน ุ ููุณ ูุซุงูููุง ููููู ุชุญุณููู.  ุนูู ุณุจูู ุงููุซุงู ุ ูู ูุถุฑ ุฅูุบุงุก Task.Delay ูู ุญุงูุฉ ุฅุฑุฌุงุน SendAsync ูุณุจููุง ุ ููู ูุฐุง ููุณ ูุซูุฑุงู ููุงูุชูุงู ุจุงููุณุจุฉ ููุง ุงูุขู.  ุฎูุงุตุฉ ุงูููู ูู ุฃูู ุฅุฐุง ูุชุจูุง ูุซู ูุฐุง ุงูุฑูุฒ ููููุง ุจุชุทุจููู ูู ุนูููุฉ ุงูุงูุชุฑุงุน ุงูุทูููุฉ ูุน ูููุงุช ุทูููุฉ ุ ูุณููุงุฌู ุจุนุถ ูุดููุงุช ุงูุฃุฏุงุก. <br><br><h3 style=";text-align:right;direction:rtl">  1.2 ูุดุงูู ุงูุงูุชุฑุงุน ุงูุทููู </h3><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูููุงุช ูุจูุฑุฉ </li><li style=";text-align:right;direction:rtl">  ุงูุนุฏูุฏ ูู ุงูุงุณุชูุณุงุฑุงุช ุงููุชุฒุงููุฉ </li><li style=";text-align:right;direction:rtl">  =&gt; ุงุณุชุฎุฏุงู ูุญุฏุฉ ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉ ุนุงููุฉ </li></ul><br>  ูู ูุฐู ุงูุญุงูุฉ ุ ุชููู ุงููุดููุฉ ูู ุงุฑุชูุงุน ุงุณุชููุงู ููุงุฑุฏ ุงููุนุงูุฌ.  ูุฏ ูุญุฏุซ ุฃู ูุชู ุชุญููู ุงููุนุงูุฌ ุจุงููุงูู ุจูุณุจุฉ 100ูช ุ ูุฃู ุงูุชุทุจูู ูุชููู ุนููููุง ุนู ุงูุนูู.  ูุจุฏู ุฃููุง ูุง ูุณุชููู ููุงุฑุฏ ุงููุนุงูุฌ ุนูู ุงูุฅุทูุงู: ูุญู ูููู ุจุจุนุถ ุงูุนูููุงุช ุบูุฑ ุงููุชุฒุงููุฉ ุ ููุชุธุฑ ุงุณุชุฌุงุจุฉ ูู ุงูุฎุงุฏู ุ ููุง ูุฒุงู ุงููุนุงูุฌ ูุญููุงู. <br><br>  ุนูุฏูุง ูุงุฌููุง ูุฐุง ุงููููู ุ ุฃุฒููุง ููู ุชูุฑูุบ ุงูุฐุงูุฑุฉ ูู ุชุทุจูููุง: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> ~*e!clrstack System.Threading.Monitor.Enter(System.Object) System.Threading.TimerQueueTimer.Change(โฆ) System.Threading.Timer.TimerSetup(โฆ) System.Threading.Timer..ctor(โฆ) System.Threading.Tasks.Task.Delay(โฆ)</code> </pre> <br>  ูุชุญููู ุงูุชูุฑูุบ ุ ุงุณุชุฎุฏููุง ุฃุฏุงุฉ WinDbg.  ููุฏ ุฃุฏุฎููุง ุฃูุฑูุง ููุธูุฑ ุชุชุจุนุงุช ุงูููุฏุณ ูุฌููุน ูุคุดุฑุงุช ุงูุชุฑุงุจุท ุงูููุฏุงุฑุฉ ุ ูุฑุฃููุง ูุฐู ุงููุชูุฌุฉ.  ูุฏููุง ุงููุซูุฑ ูู ุงูุฎููุท ูู ุงูุนูููุฉ ุงูุชู ุชูุชุธุฑ ุจุนุถ ุงูููู.  ุทุฑููุฉ Monitor.Enter ูู ูุง ููุณุน ุฅููู ุจูุงุก ุงูููู ูู C #.  ูุชู ุงูุชูุงุท ูุฐุง ุงูููู ุฏุงุฎู ูุตูู ุชุณูู Timer ู TimerQueueTimer.  ูู Timer ุ ููุฏ ุฃุชููุง ูู Task.Delay ุนูุฏูุง ุญุงูููุง ุฅูุดุงุฆูุง.  ูุง ูุฐุงุ  ุนูุฏ ุจุฏุก ุชุดุบูู Task.Delay ุ ูุชู ุงูุชูุงุท ุงูููู ุฏุงุฎู TimerQueue. <br><br><h3 style=";text-align:right;direction:rtl">  1.3 ููู ุงููุงููุฉ </h3><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุงูุนุฏูุฏ ูู ุงูููุงุถูุน ูุญุงููุฉ ููู ููู ูุงุญุฏ </li><li style=";text-align:right;direction:rtl">  ุชุญุช ุงูููู ุ ูุชู ุชูููุฐ ุฑูุฒ ุตุบูุฑ </li><li style=";text-align:right;direction:rtl">  ููุถู ุงูููุช ูู ุชุฒุงูู ุงูุฎูุท ุ ูููุณ ุชูููุฐ ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ. </li><li style=";text-align:right;direction:rtl">  ูุชู ุญุธุฑ Threadblocks - ููู ููุณุช ูุงููุงุฆูุฉ </li></ul><br>  ูุงู ูุฏููุง ูุงููุฉ ููู ูู ุงูุชุทุจูู.  ุชุญุงูู ุงูุนุฏูุฏ ูู ูุคุดุฑุงุช ุงูุชุฑุงุจุท ุงูุชูุงุท ููุณ ุงูููู.  ุชุญุช ูุฐุง ุงูููู ุ ูุชู ุชูููุฐ ุงููุซูุฑ ูู ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ.  ูุง ูุชู ุฅููุงู ููุงุฑุฏ ุงููุนุงูุฌ ููุง ุนูู ุฑูุฒ ุงูุชุทุจูู ููุณู ุ ูููู ุนูู ุนูููุงุช ูุฒุงููุฉ ูุคุดุฑุงุช ุงูุชุฑุงุจุท ูููุง ุจูููุง ุนูู ูุฐุง ุงูููู.  ุชุฌุฏุฑ ุงูุฅุดุงุฑุฉ ุฃูุถูุง ุฅูู ููุฒุฉ ูุฑุชุจุทุฉ ุจู .NET: ูุคุดุฑุงุช ุงูุชุฑุงุจุท ุงูุชู ุชุดุงุฑู ูู ูุงููุฉ ุงูููู ูู ุณูุงุณู ูุคุดุฑุงุช ูู ุชุฌูุน ูุคุดุฑุงุช ุงูุชุฑุงุจุท. <br><br>  ููููุง ูุฐูู ุ ุฅุฐุง ุชู ุญุธุฑ ูุคุดุฑุงุช ุงูุชุฑุงุจุท ูู ุชุฌูุน ูุคุดุฑุงุช ุงูุชุฑุงุจุท ุ ููุฏ ุชูุชูู - ูููู ุนุฏุฏ ูุคุดุฑุงุช ุงูุชุฑุงุจุท ูู ุชุฌูุน ูุคุดุฑุงุช ุงูุชุฑุงุจุท ูุญุฏูุฏูุง.  ูููู ุชููุฆุชู ุ ููู ูุง ูุฒุงู ููุงู ุญุฏ ุฃุนูู.  ุจุนุฏ ุงููุตูู ุฅููู ุ ุณุชุดุงุฑู ุฌููุน ูุคุดุฑุงุช ุชุฑุงุจุท threadpool ูู ูุงููุฉ ุงูููู ุ ูุฃู ููุฏ ููุทูู ุนูู threadpool ุณูุชููู ุชูููุฐู ูู ุงูุชุทุจูู.  ูุฐุง ููุงูู ุงููุถุน ุฅูู ุญุฏ ูุจูุฑ. <br><br><h3 style=";text-align:right;direction:rtl">  1.4 TimerQueue </h3><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูุฏูุฑ ุงููููุชุงุช ูู ุชุทุจูู .NET. </li><li style=";text-align:right;direction:rtl">  ุชุณุชุฎุฏู ุฃุฌูุฒุฉ ุถุจุท ุงูููุช ูู: <br>  - Task.Delay <br>  - ุงูุฅูุบุงุก. ุฅูุบุงุก <br>  - ุงููุชุดุนุจ </li></ul><br>  TimerQueue ูู ูุฆุฉ ุชุฏูุฑ ุฌููุน ุฃุฌูุฒุฉ ุถุจุท ุงูููุช ูู ุชุทุจูู .NET.  ุฅุฐุง ููุช ุจุงูุจุฑูุฌุฉ ูุฑุฉ ูุงุญุฏุฉ ูู WinForms ุ ููุฏ ุชููู ููุช ุจุฅูุดุงุก ุฃุฌูุฒุฉ ุถุจุท ุงูููุช ูุฏูููุง.  ุจุงููุณุจุฉ ูุฃููุฆู ุงูุฐูู ูุง ูุนุฑููู ูููุชุงุช ุงูููุช: ูุชู ุงุณุชุฎุฏุงููุง ูู Task.Delay (ูุฐู ูู ุญุงูุชูุง ููุท) ุ ููุง ูุชู ุงุณุชุฎุฏุงููุง ุฏุงุฎู CancellationToken ุ ูู ุฃุณููุจ CancelAfter.  ููุฐุง ูุนูู ุฃู ุงุณุชุจุฏุงู Task.Delay ุจู CancellationToken.CancelAfter ูู ูุณุงุนุฏูุง ุจุฃู ุทุฑููุฉ.  ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ูุชู ุงุณุชุฎุฏุงู ุฃุฌูุฒุฉ ุถุจุท ุงูููุช ูู ุงูุนุฏูุฏ ูู ูุฆุงุช .NET ุงูุฏุงุฎููุฉ ุ ุนูู ุณุจูู ุงููุซุงู ุ ูู HttpClient. <br><br>  ุจูุฏุฑ ูุง ุฃุนุฑู ุ ูุฅู ุจุนุถ ุชุทุจููุงุช ูุนุงูุฌุงุช HttpClient ููุง ุฃุฌูุฒุฉ ุถุจุท ุงูููุช.  ุญุชู ุฅุฐุง ูู ุชุณุชุฎุฏููุง ุจุดูู ุตุฑูุญ ุ ููุง ุชุจุฏุฃ ุชุดุบูู Task.Delay ุ ุนูู ุงูุฃุฑุฌุญ ุ ูุง ุชุฒุงู ุชุณุชุฎุฏููุง ุนูู ุฃู ุญุงู. <br><br>  ุงูุขู ุฏุนููุง ูููู ูุธุฑุฉ ุนูู ููููุฉ ุชุฑุชูุจ TimerQueue ุจุงูุฏุงุฎู. <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุงูุญุงูุฉ ุงูุนุงูููุฉ (ููู ูุทุงู): <br>  - ูุงุฆูุฉ ูุฒุฏูุฌุฉ ูุฑุชุจุทุฉ TimerQueueTimer <br>  - ููู ุงููุงุฆู </li><li style=";text-align:right;direction:rtl">  ุงููููุชุงุช ุงูุฑูุชูููุฉ Callbacks </li><li style=";text-align:right;direction:rtl">  ูุคูุชุงุช ุบูุฑ ูุฑุชุจุฉ ุญุณุจ ููุช ุงูุงุณุชุฌุงุจุฉ </li><li style=";text-align:right;direction:rtl">  ุฅุถุงูุฉ ูุคูุช: O (1) + ููู </li><li style=";text-align:right;direction:rtl">  ุฅุฒุงูุฉ ุงููููุช: O (1) + ููู </li><li style=";text-align:right;direction:rtl">  ุจุฏุก ุชูููุช: O (N) + ููู </li></ul><br>  ููุฌุฏ ุฏุงุฎู TimerQueue ุญุงูุฉ ุนููููุฉ ุ ููู ูุงุฆูุฉ ูุฑุชุจุทุฉ ุจุดูู ูุถุงุนู ุจุงููุงุฆูุงุช ูู ุงูููุน TimerQueueTimer.  ูุญุชูู TimerQueueTimer ุนูู ุฑุงุจุท ุฅูู TimerQueueTimer ุขุฎุฑ ุ ูุฌุงูุฑ ูู ูุงุฆูุฉ ูุฑุชุจุทุฉ ุ ููุง ุฃูู ูุญุชูู ุนูู ููุช ุงููุคูุช ูุฅุนุงุฏุฉ ุงูุงุชุตุงู ุ ูุงูุฐู ุณูุชู ุงุณุชุฏุนุงุคู ุนูุฏ ุฅุทูุงู ุงููุคูุช.  ูุฐู ุงููุงุฆูุฉ ุงููุฑุชุจุทุฉ ูุถุงุนูุฉ ูุญููุฉ ุจูุงุณุทุฉ ูุงุฆู ููู ุ ููุท ุชูู ุงูุชู ููุนุช ูุงููุฉ ุงูููู ูู ุทูุจูุง.  ุฃูุถูุง ุฏุงุฎู TimerQueue ุ ููุงู ุฑูุชูู ููุทูู ุนูููุงุช ุฑุฏ ุงุชุตุงู ูุฑุชุจุทุฉ ุจุฃุฌูุฒุฉ ุถุจุท ุงูููุช ูุฏููุง. <br><br>  ูุง ูุชู ุชุฑุชูุจ ุงููููุชุงุช ุจุฃู ุญุงู ูู ุงูุฃุญูุงู ุจููุช ุงูุงุณุชุฌุงุจุฉ ุ ุญูุซ ูุชู ุชุญุณูู ุงููููู ุจุงููุงูู ูุฅุถุงูุฉ / ุฅุฒุงูุฉ ูุคูุชุงุช ุฌุฏูุฏุฉ.  ุนูุฏ ุจุฏุก ุชุดุบูู Routine ุ ูุชู ุชุดุบููู ูู ุฎูุงู ุงููุงุฆูุฉ ุฐุงุช ุงูุงุฑุชุจุงุท ุงููุฒุฏูุฌ ุจุงููุงูู ุ ูุชุญุฏูุฏ ุฃุฌูุฒุฉ ุถุจุท ุงูููุช ุงูุชู ูุฌุจ ุฃู ุชุนูู ุ ูุฅุนุงุฏุฉ ุงูุงุชุตุงู ุจูู. <br><br>  ุชุนููุฏ ุงูุนูููุฉ ููุง ูู ููุฐุง.  ุฅุถุงูุฉ ูุฅุฒุงูุฉ ูููุช ูุญุฏุซ O ููู ูุญุฏุฉ ุ ููุญุฏุซ ุจุฏุงูุฉ ุงููููุชุงุช ูู ูู ุณุทุฑ.  ุนูุงูุฉ ุนูู ุฐูู ุ ุฅุฐุง ูุงู ูู ุดูุก ููุจูููุง ูุน ุงูุชุนููุฏ ุงูุฎูุงุฑุฒูู ุ ูููุงู ูุดููุฉ ูุงุญุฏุฉ: ูู ูุฐู ุงูุนูููุงุช ุชูุชูุท ุงูููู ุ ููู ุฃูุฑ ุบูุฑ ุฌูุฏ ุฌุฏูุง. <br><br>  ูุง ุงููุถุน ูููู ุฃู ูุญุฏุซุ  ูุฏููุง ุงููุซูุฑ ูู ุฃุฌูุฒุฉ ุถุจุท ุงูููุช ุงููุชุฑุงููุฉ ูู TimerQueue ุ ูุฐูู ุนูุฏูุง ูุจุฏุฃ Routine ุ ูุฅูู ูููู ุจุฅุบูุงู ุงูุชุดุบูู ุงูุฎุทู ุงูุทููู ุ ูู ุฐูู ุงูููุช ุ ุฃููุฆู ุงูุฐูู ูุญุงูููู ุจุฏุก ุฃู ุฅุฒุงูุฉ ุฃุฌูุฒุฉ ุถุจุท ุงูููุช ูู TimerQueue ูุง ูููููู ูุนู ุฃู ุดูุก ุญูุงู ุฐูู.  ูุจุณุจุจ ูุฐุง ุ ูุญุฏุซ ูุงููุฉ ุงูููู.  ุชู ุฅุตูุงุญ ูุฐู ุงููุดููุฉ ูู .NET Core. <br><blockquote style=";text-align:right;direction:rtl">  ุชูููู ุงูุชูุงุฒุน ููู ุงููููุช (coreclr # 14527) <br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ููู ุชูุงุณู <br>  - Environment.ProcessorCount TimerQueue's TimerQueueTimer </li><li style=";text-align:right;direction:rtl">  ุทูุงุจูุฑ ูููุตูุฉ ููููุช ูุตูุฑ / ุทููู ุงูุฃุฌู </li><li style=";text-align:right;direction:rtl">  ูุคูุช ูุตูุฑ: ุงูููุช &lt;= 1/3 ุซุงููุฉ </li></ul><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">https://github.com/dotnet/coreclr/issues/14462</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">https://github.com/dotnet/coreclr/pull/14527</a> <br></blockquote>  ููู ุชู ุฅุตูุงุญูุงุ  ููุฏ ุฏุงูููุง TimerQueue: ุจุฏูุงู ูู TimerQueue ูุงุญุฏ ุ ูุงูุฐู ูุงู ุซุงุจุชูุง ููู AppDomain ุจุงููุงูู ุ ููุชุทุจูู ุจุฃูููู ุ ุชู ุฅูุดุงุก TimerQueue ุนุฏุฉ.  ุนูุฏ ูุตูู ูุคุดุฑุงุช ุงูุชุฑุงุจุท ุฅูู ููุงู ููุญุงููุฉ ุจุฏุก ุฃุฌูุฒุฉ ุถุจุท ุงูููุช ุงูุฎุงุตุฉ ุจูู ุ ุณุชูุน ูุฐู ุฃุฌูุฒุฉ ุถุจุท ุงูููุช ูู TimerQueue ุนุดูุงุฆู ุ ูุณุชููู ูุฑุต ุณูุงุณู ุงูุนูู ุฃูู ูู ุงูุงุตุทุฏุงู ุนูู ููู ูุงุญุฏ. <br><br>  ุฃูุถุง ูู. NET ุงูุฃุณุงุณูุฉ ุชุทุจูู ุจุนุถ ุงูุชุญุณููุงุช.  ุชู ุชูุณูู ุฃุฌูุฒุฉ ุถุจุท ุงูููุช ุฅูู ููุช ุทููู ููุตูุฑ ุงูุฃุฌู ุ ูุชุณุชุฎุฏู ุงูุขู TimerQueue ูููุตูุฉ ุจุงููุณุจุฉ ููู.  ูุชู ุชุญุฏูุฏ ุงููุคูุช ูุตูุฑ ุงูุฃุฌู ููููู ุฃูู ูู 1/3 ูู ุงูุซุงููุฉ.  ูุง ุฃุนุฑู ููุงุฐุง ุชู ุงุฎุชูุงุฑ ูุซู ูุฐุง ุงูุซุงุจุช.  ูู .NET Core ุ ูุดููุง ูู ุงูุชุนุฑู ุนูู ูุดุงูู ุฃุฌูุฒุฉ ุถุจุท ุงูููุช. <br><br><img src="https://habrastorage.org/webt/f_/am/cv/f_amcv6bohiq54ciyuunvtrr0ei.jpeg"><br><br>  <a href="">https://github.com/Microsoft/dotnet-framework-early-access/blob/master/release-notes/NET48/dotnet-48-changes.md</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">https://github.com/dotnet/coreclr/labels/netfx-port-consider</a> <br><br>  ูุฐุง ุงูุฅุตูุงุญ ุชู ุชุฑุญููู ุฅูู .NET Framework ุ ุงูุฅุตุฏุงุฑ 4.8.  ูุดุงุฑ ุฅูู ุนูุงูุฉ netfx-port -ูุธุฑ ูู ุงูุฑุงุจุท ุฃุนูุงู ุ ุฅุฐุง ุงูุชููุช ุฅูู ูุณุชูุฏุน .NET Core ุ ู CoreCLR ุ ู CoreFX ุ ููููู ุงูุจุญุซ ุนู ูุฐู ุงููุดููุฉ ุงูุชู ุณูุชู ุชุฑุญูููุง ุฅูู .NET Framework ุ ูููุงู ุงูุขู ุญูุงูู ุฎูุณูู ูููุง.  ููุฐุง ูู ุ ุงููุตุฏุฑ ุงูููุชูุญ. NET ุณุงุนุฏ ูุซูุฑุง ุ ุชู ุฅุตูุงุญ ุนุฏุฏ ุบูุฑ ูููู ูู ุงูุฃุฎุทุงุก.  ููููู ูุฑุงุกุฉ changelog .NET Framework 4.8: ุชู ุฅุตูุงุญ ุงููุซูุฑ ูู ุงูุฃุฎุทุงุก ุ ุฃูุซุฑ ุจูุซูุฑ ูู ุฅุตุฏุงุฑุงุช .NET ุงูุฃุฎุฑู.  ููู ุงููุซูุฑ ููุงูุชูุงู ุ ุฃู ูุฐุง ุงูุฅุตูุงุญ ูุชููู ุนู ุงูุชุดุบูู ุจุดูู ุงูุชุฑุงุถู ูู .NET Framework 4.8.  ูุชู ุชุถูููู ูู ุงูููู ุจุฃูููู ุงูุฐู ุชุนุฑูู ูุณูู App.config <br><br>  ูุณูู ุงูุฅุนุฏุงุฏ ูู App.config ุงูุฐู ููููู ูุฐุง ุงูุฅุตูุงุญ UseNetCoreTimer.  ูุจู ุฃู ูุชู ุฅุตุฏุงุฑ .NET Framework 4.8 ุ ููู ูุนูู ุชุทุจูููุง ููุง ุชุฏุฎู ูู ูุงููุฉ ุงูููู ุ ูุงู ุนููู ุงุณุชุฎุฏุงู ุชุทุจูู Task.Delay.  ูู ุฐูู ุ ุญุงูููุง ุงุณุชุฎุฏุงู ูููุฉ ุซูุงุฆูุฉ ูู ุฃุฌู ููู ุฃูุซุฑ ูุงุนููุฉ ุงููููุชุงุช ุงูุชู ูุฌุจ ุงุณุชุฏุนุงุก ุงูุขู. <br><br><h3 style=";text-align:right;direction:rtl">  1.5 Task.Delay: ุงูุชูููุฐ ุงูุฃุตูู </h3><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  BinaryHeap </li><li style=";text-align:right;direction:rtl">  ุนูููุฉ ุงูุชุฌุฒุฆุฉ </li><li style=";text-align:right;direction:rtl">  ููุฏ ุณุงุนุฏ ุ ูููู ููุณ ูู ุฌููุน ุงูุญุงูุงุช </li></ul><br>  ูุชูุญ ูู ุงุณุชุฎุฏุงู ูููุฉ ุซูุงุฆูุฉ ุซูุงุฆูุฉ ุชุญุณูู "ุงูุฑูุชูู" ุ ุงูุฐู ูุณุชุฏุนู ุนูููุงุช ุงูุงุณุชุฑุฌุงุนุงุช ุ ููููู ูุฒูุฏ ูู ุงูููุช ุงูุฐู ูุณุชุบุฑูู ุฅุฒุงูุฉ ูุคูุช ุชุนุณูู ูู ูุงุฆูุฉ ุงูุงูุชุธุงุฑ - ููุฐุง ุชุญุชุงุฌ ุฅูู ุฅุนุงุฏุฉ ุฅูุดุงุก ุงููููุฉ.  ูุฐุง ุนูู ุงูุฃุฑุฌุญ ุงูุณุจุจ ูุฑุงุก ุงุณุชุฎุฏุงู .NET ููุงุฆูุฉ ูุฒุฏูุฌุฉ ุงูุงุฑุชุจุงุท.  ุจุงูุทุจุน ุ ูุฌุฑุฏ ุงุณุชุฎุฏุงู ูููุฉ ุซูุงุฆูุฉ ูู ูุณุงุนุฏูุง ููุง ุ ูุงู ุนูููุง ุฃูุถูุง ุฃู ููุญุต TimerQueue.  ูุฌุญ ูุฐุง ุงูุญู ูุจุนุถ ุงูููุช ุ ูููู ุจุนุฏ ูู ุฐูู ุ ููุน ูู ุดูุก ูุฑุฉ ุฃุฎุฑู ูู ูุงููุฉ ุงูููู ูุธุฑูุง ูุญูููุฉ ุฃู ุฃุฌูุฒุฉ ุถุจุท ุงูููุช ุชุณุชุฎุฏู ููุณ ููุท ุญูุซ ูุชู ุชุดุบูููุง ูู ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ุจุดูู ุตุฑูุญ ุ ูููู ุฃูุถูุง ูู ููุชุจุงุช ุงูุฃุทุฑุงู ุงูุซุงูุซุฉ ูุฑูุฒ .NET.  ูุฅุตูุงุญ ูุฐู ุงููุดููุฉ ุชูุงููุง ุ ูุฌุจ ุงูุชุฑููุฉ ุฅูู ุงูุฅุตุฏุงุฑ .NET Framework 4.8 ูุชูููู ุงูุฅุตูุงุญ ูู ูุทูุฑู .NET. <br><br><h3 style=";text-align:right;direction:rtl">  1.6 Task.Delay: ุงูุงุณุชูุชุงุฌุงุช </h3><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูุทุจุงุช ูู ูู ููุงู - ุญุชู ูู ุงูุฃุดูุงุก ุงูุฃูุซุฑ ุงุณุชุฎุฏุงูุง </li><li style=";text-align:right;direction:rtl">  ูู ุงุฎุชุจุงุฑ ุงูุฅุฌูุงุฏ </li><li style=";text-align:right;direction:rtl">  ูู ุจุงูุชุจุฏูู ุฅูู Core ุ ูุงุญุตู ุนูู ุฅุตูุงุญุงุช ุงูุฃุฎุทุงุก (ูุงูุฃุฎุทุงุก ุงูุฌุฏูุฏุฉ) ุฃููุงู :) </li></ul><br>  ูุง ูู ุงูุงุณุชูุชุงุฌุงุช ูู ูุฐู ุงููุตุฉ ูููุงุ  ุฃููุงู ุ ูููู ุงูุนุซูุฑ ุนูู ุงููุฒุงูู ูู ูู ููุงู ุญููุง ุ ุญุชู ูู ุงููุตูู ุงูุฏุฑุงุณูุฉ ุงูุชู ุชุณุชุฎุฏููุง ูููููุง ุฏูู ุงูุชูููุฑ ุ ุนูู ุณุจูู ุงููุซุงู ุ ููุณ ุงููููุฉ ุ Task.Delay. <br><br>  ุฃูุตู ุจุฅุฌุฑุงุก ุงุฎุชุจุงุฑ ุงูุฅุฌูุงุฏ ูููุชุฑุญุงุชู.  ูุฐู ุงููุดููุฉ ุงูุชู ุญุฏุฏูุงูุง ููุชู ูู ูุฑุญูุฉ ุงุฎุชุจุงุฑ ุงูุญูู.  ุซู ุฃุทูููุงูุง ุนุฏุฉ ูุฑุงุช ุนูู ุงูุฅูุชุงุฌ ูู ุชุทุจููุงุช ุฃุฎุฑู ุ ููู ูุน ุฐูู ุ ุณุงุนุฏูุง ุงุฎุชุจุงุฑ ุงูุฅุฌูุงุฏ ุนูู ุชุฃุฎูุฑ ุงูููุช ูุจู ุฃู ููุงุฌู ูุฐู ุงููุดููุฉ ูู ุงููุงูุน. <br><br>  ูู ุจุงูุชุจุฏูู ุฅูู .NET Core - ุณุชููู ุฃูู ูู ูุชููู ุฅุตูุงุญุงุช ุงูุฃุฎุทุงุก (ูุงูุฃุฎุทุงุก ุงูุฌุฏูุฏุฉ).  ุฃูู ุจุฏูู ุฃุฎุทุงุก ุฌุฏูุฏุฉุ <br><br>  ุงูุชูุช ูุตุฉ ุฃุฌูุฒุฉ ุถุจุท ุงูููุช ุ ูููุชูู ุฅูู ุงููุฑุญูุฉ ุงูุชุงููุฉ. <br><br><h2 style=";text-align:right;direction:rtl">  ุงููุตุฉ 2: ุณููุงููุฑ ุณููู </h2><br>  ุงููุตุฉ ุงูุชุงููุฉ ุชุฏูุฑ ุญูู SemaphoreSlim ุงููุนุฑููุฉ. <br><br><h3 style=";text-align:right;direction:rtl">  2.1 ุฎุงุฏู ุงูุงุฎุชูุงู </h3><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูุฌุจ ุชุญุฏูุฏ ุนุฏุฏ ุงูุทูุจุงุช ุงูุชู ุชุชู ูุนุงูุฌุชูุง ุจุดูู ูุชุฒุงูู ุนูู ุงูุฎุงุฏู </li></ul><br>  ุฃุฑุฏูุง ุชูููุฐ ุงูุงุฎุชูุงู ุนูู ุงูุฎุงุฏู.  ูุง ูุฐุง  ุฑุจูุง ุชุนุฑู ุฌููุนูุง ุงูุงุฎุชูุงู ุนูู ูุญุฏุฉ ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉ: ุนูุฏูุง ูุณุฎู ุงููุนุงูุฌ ุ ูุฅูู ูููู ูู ุชุฑุฏุฏู ููุจุฑุฏ ุ ููุฐุง ูุญุฏ ูู ุฃุฏุงุฆู.  ูุฐูู ูู ููุง.  ูุญู ูุนูู ุฃู ุฎุงุฏููุง ููููู ูุนุงูุฌุฉ ุทูุจุงุช N ุจุงูุชูุงุฒู ูููุณ ุงูุณููุท.  ูุงุฐุง ูุฑูุฏ ุงู ููุนูุ  ุญุฏุฏ ุนุฏุฏ ุงูุทูุจุงุช ุงูุชู ุชูุช ูุนุงูุฌุชูุง ูู ููุช ูุงุญุฏ ุจูุฐุง ุงูุซุงุจุช ูุงุชุฑููุง ุจุญูุซ ุฅุฐุง ุธูุฑุช ุงููุฒูุฏ ูู ุงูุทูุจุงุช ุ ูุฅููุง ุชูุชุธุฑ ูุชูุชุธุฑ ุญุชู ูุชู ุชูููุฐ ุงูุทูุจุงุช ุงูุชู ุฌุงุกุช ูู ููุช ุณุงุจู.  ููู ูููู ุญู ูุฐู ุงููุดููุฉุ  ูู ุงูุถุฑูุฑู ุงุณุชุฎุฏุงู ููุน ูู ุงูุชุฒุงูู ุงูุจุฏุงุฆู. <br><br>  Semaphore ูู ุจุฏุงุฆูุฉ ุงูุชุฒุงูู ุญูุซ ููููู ุงูุงูุชุธุงุฑ N Times ุ ูุจุนุฏูุง ุงูุดุฎุต ุงูุฐู ูุตู N + ุฃููุงู ููุง ุฅูู ุฐูู ุณูู ููุชุธุฑูุง ุญุชู ูุตุฏุฑ ุฃููุฆู ุงูุฐูู ุฏุฎูููุง ุณุงุจููุง Semaphore.  ุงุชุถุญ ุดูุก ูู ูุฐุง ุงููุจูู: ุฎูุทุงู ูู ุงูุฅุนุฏุงู ุ ูุฐูุจ ุนุงููุงู ุชุญุช ุณููุงููุฑ ุ ูุงูุจุงูู ูู ุงูุตู. <br><br><img src="https://habrastorage.org/webt/6s/bu/h7/6sbuh77p4temzi5yiofjlh-rxoi.png"><br><br>  ุจุทุจูุนุฉ ุงูุญุงู ุ ูุฅู Semaphore ูุง ููุงุณุจูุง ุชูุงููุง ุ ููู ูู .NET ูุชุฒุงูู ุ ูุฐูู ุฃุฎุฐูุง SemaphoreSlim ููุชุจูุง ูุฐุง ุงูุฑูุฒ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> semaphore = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SemaphoreSlim(N); โฆ <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> semaphore.WaitAsync(); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> HandleRequestAsync(request); semaphore.Release();</code> </pre> <br>  ููุดุฆ SemaphoreSlim ุ ุงูุชุธุฑ ุ ุชุญุช Semaphore ูููู ุจูุนุงูุฌุฉ ุทูุจู ุ ุจุนุฏ ุฃู ูุตุฏุฑ Semaphore.  ูุจุฏู ุฃู ูุฐุง ุชุทุจูู ูุซุงูู ูุฎูู ุงูุฎุงุฏู ุ ููู ูุนุฏ ูู ุงููููู ุฃู ูููู ุฃูุถู.  ููู ูู ุดูุก ุฃูุซุฑ ุชุนููุฏูุง. <br><br><h3 style=";text-align:right;direction:rtl">  2.2 ุฎุงุฏู ุงูุงุฎุชูุงู: ุงููุถุงุนูุงุช </h3><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูุนุงูุฌุฉ ุงูุทูุจุงุช ุจุชุฑุชูุจ LIFO </li><li style=";text-align:right;direction:rtl">  SemaphoreSlim </li><li style=";text-align:right;direction:rtl">  ConcurrentStack </li><li style=";text-align:right;direction:rtl">  TaskCompletionSource </li></ul><br>  ูุณููุง ููููุง ุนู ููุทู ุงูุนูู.  ุงูุทูุจุงุช ุงูุชู ุชุฃุชู ุฅูู ุงูุงุฎุชูุงู ูู ุทูุจุงุช http ุญููููุฉ.  ููุงุนุฏุฉ ุนุงูุฉ ุ ูุฏููู ุจุนุถ ุงููููุฉ ุ ุงูุชู ูุชู ุชุนููููุง ูู ูุจู ุฃููุฆู ุงูุฐูู ุฃุฑุณููุง ูุฐุง ุงูุทูุจ ุชููุงุฆููุง ุ ุฃู ูููุฉ ูููุณุชุฎุฏู ุงูุฐู ูุถุบุท F5 ุจุนุฏ ุจุนุถ ุงูููุช.  ููููุง ูุฐูู ุ ุฅุฐุง ููุช ุจูุนุงูุฌุฉ ุงูุทูุจุงุช ูู ุชุฑุชูุจ ูุงุฆูุฉ ุงูุชุธุงุฑ ุ ูุซู ุฅุดุงุฑุฉ ููุชุธูุฉ ุ ูุฑุจูุง ูุชู ุฃููุงู ูุนุงูุฌุฉ ุฌููุน ุงูุทูุจุงุช ุงูููุฏูุฉ ูู ูุงุฆูุฉ ุงูุงูุชุธุงุฑ ุงูุชู ุงููุถุช ูููุชูุง ุจุงููุนู.  ุฅุฐุง ููุช ุชุนูู ุจุชุฑุชูุจ ููุฏุณ - ูู ุฃููุงู ุจูุนุงูุฌุฉ ุฌููุน ุงูุทูุจุงุช ุงูุชู ุฌุงุกุช ุงูุฃุฎูุฑุฉ ุ ูู ุชูุดุฃ ูุซู ูุฐู ุงููุดููุฉ. <br><br>  ุจุงูุฅุถุงูุฉ ุฅูู SemaphoreSlim ุ ูุงู ุนูููุง ุงุณุชุฎุฏุงู ConcurrentStack ุ TaskCompletionSource ุ ูุฑุจุท ุงููุซูุฑ ูู ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ุญูู ูู ูุฐุง ุ ุจุญูุซ ูุงู ูู ุดูุก ูุนูู ุจุงูุชุฑุชูุจ ุงูุฐู ูุญุชุงุฌู.  TaskCompletionSource ุดูุก ูู ูุฐุง ุงููุจูู ุ ูุงูุฐู ูุดุจู CancellationTokenSource ุ ูููู ููุณ ูู CancellationToken ุ ูููู ูู Task.  ููููู ุฅูุดุงุก TaskCompletionSource ุ ูุณุญุจ ูููุฉ ูููุง ุ ูุฅุฎุฑุงุฌู ุ ุซู ุฅุฎุจุงุฑ TaskCompletionSource ุฃูู ุจุญุงุฌุฉ ุฅูู ุชุนููู ุงููุชูุฌุฉ ููุฐู ุงููููุฉ ุ ูุณูุนุฑู ุฃููุฆู ุงูุฐูู ููุชุธุฑูู ูุฐู ุงููููุฉ ูุฐู ุงููุชูุฌุฉ. <br><br>  ููุฏ ููุฐูุงูุง ุฌููุนูุง.  ุงูููุฏ ูุธูุน.  ูุงูุฃุณูุฃ ูู ุฐูู ููู ุ ุงุชุถุญ ุฃููุง ุบูุฑ ุตุงูุญุฉ ููุนูู. <br><br>  ุจุนุฏ ุจุถุนุฉ ุฃุดูุฑ ูู ุจุฏุก ุงุณุชุฎุฏุงูู ูู ุชุทุจูู ูุญููู ุฅูู ุญุฏ ูุจูุฑ ุ ูุงุฌููุง ูุดููุฉ.  ุจููุณ ุงูุทุฑููุฉ ููุง ูู ุงูุญุงูุฉ ุงูุณุงุจูุฉ ุ ุฒุงุฏ ุงุณุชููุงู ูุญุฏุฉ ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉ ุฅูู 100ูช.  ูุนููุง ููุณ ุงูุดูุก ุ ุฃุฒููุง ุงูุชูุฑูุบ ุ ููุธุฑูุง ุฅููู ูู WinDbg ุ ููุฌุฏูุง ูุฑุฉ ุฃุฎุฑู ูุงููุฉ ุงูููู. <br><br><img src="https://habrastorage.org/webt/h_/ef/as/h_efasuul34r0fm7vwopo2hm1bc.jpeg"><br><br>  ูุฐู ุงููุฑุฉ ููุนุช ูุงููุฉ ููู ุฏุงุฎู SemaphoreSlim.WaitAsync ู SemaphoreSlim.Release.  ุงุชุถุญ ุฃู ููุงู ููู ุฏุงุฎู SemaphoreSlim ุ ุฃููุง ููุณุช ุฎุงููุฉ ูู ููู.  ุชุญูู ูุฐุง ุฅูู ุนูุจ ุฎุทูุฑ ุจุงููุณุจุฉ ููุง. <br><br><img src="https://habrastorage.org/webt/0h/-k/qq/0h-kqqxojlujm3dglokmacabvwq.jpeg"><br><br>  ุฏุงุฎู SemaphoreSlim ููุงู ุญุงูุฉ ุฏุงุฎููุฉ (ุนุฏุงุฏ ูุนุฏุฏ ุงูุนูุงู ุงูุฐูู ูุง ูุฒุงู ุจุฅููุงููู ุฎูุถูุง) ุ ููุงุฆูุฉ ูุถุงุนูุฉ ูุฑุชุจุทุฉ ุจุฃููุฆู ุงูุฐูู ููุชุธุฑูู ูู ูุฐุง Semaphore.  ุงูุฃููุงุฑ ููุง ูู ููุณูุง: ููููู ุงูุงูุชุธุงุฑ ูู ูุฐุง Semaphore ุ ููููู ุฅูุบุงุก ุชููุนู - โโูุชุฑู ูุงุฆูุฉ ุงูุงูุชุธุงุฑ ูุฐู.  ููุงู ููู ุฏูุฑ ุญูุงุชูุง ููุชู. <br><br>  ูุฑุฑูุง: ุฃุณูู ูุน ูู ุฑูุฒ ุฑููุจ ูุงู ุนูููุง ุฃู ููุชุจ. <br><br><img src="https://habrastorage.org/webt/ax/ls/3i/axls3iseuxmgjt-vqkeiqs7hvtq.jpeg"><br><br>  ุฏุนูุง ููุชุจ ุฅุดุงุฑุฉ ูุฏููุง ุ ูุงูุชู ุณุชููู ุนูู ุงูููุฑ ุฎุงููุฉ ูู ุงูููู ูุงูุชู ุณุชุนูู ุนูู ุงูููุฑ ูู ุชุฑุชูุจ ููุฏุณ.  ุฅูุบุงุก ุงูุงูุชุธุงุฑ ููุณ ููููุง ุจุงููุณุจุฉ ููุง. <br><br><img src="https://habrastorage.org/webt/rv/rg/wv/rvrgwv8apebibtiymhxpvm5giti.jpeg"><br><br>  ุชุญุฏูุฏ ูุฐุง ุงูุดุฑุท.  ููุง ุณูููู ุงูุฑูู ุงูุญุงููุงูุนุฏุฏ - ููุฐุง ูู ุนุฏุฏ ุงูุฃูุงูู ุงููุชุจููุฉ ูู ุฅุดุงุฑุฉ.  ุฅุฐุง ูู ุชูู ููุงู ููุงุนุฏ ูุชุจููุฉ ูู ุณููุงููุฑ ุ ูุณูููู ูุฐุง ุงูุนุฏุฏ ุณุงูุจูุง ูุณููุธูุฑ ุนุฏุฏ ุงูุนูุงู ูู ูุงุฆูุฉ ุงูุงูุชุธุงุฑ.  ุณูููู ููุงู ุฃูุถูุง ConcurrentStack ุ ูุชููู ูู TaskCompletionSource'ov - ูุฐุง ูุฌุฑุฏ ูููุฉ ูู waiter'ov ุณูุชู ุณุญุจูุง ูููุง ุฅุฐุง ูุฒู ุงูุฃูุฑ.  ุฏุนูุง ููุชุจ ุทุฑููุฉ WaitAsync. <br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> decrementedCount = Interlocked.Decrement(<span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> currentCount); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (decrementedCount &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Task.CompletedTask; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> waiter = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TaskCompletionSource&lt;<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>&gt;(); waiters.Push(waiter); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> waiter.Task;</code> </pre> <br>  ุฃููุงู ุ ูุฎูู ุงูุนุฏุงุฏ ุ ููุฃุฎุฐ ููุงููุง ูุงุญุฏูุง ูู ุณููุงููุฑ ูุฃููุณูุง ุ ุฅุฐุง ูุงู ูุฏููุง ุฃูุงูู ูุฌุงููุฉ ุ ุซู ูููู: "ูุฐุง ูู ุดูุก ุ ููุฏ ุฐูุจุช ุชุญุช ุณููุงููุฑ". <br><br>  ุฅุฐุง ูู ุชูู ููุงู ุฃูุงูู ูู Semaphore ุ ูุณูููู ุจุฅูุดุงุก TaskCompletionSource ุ ูุฑูููุง ุนูู ูููุฉ ูู waiter'ov ูุฅุฑุฌุงุน Task ุฅูู ุงูุนุงูู ุงูุฎุงุฑุฌู.  ุนูุฏูุง ูุญูู ุงูููุช ุ ุณุชูุฌุญ ูุฐู ุงููููุฉ ุ ูุณูููู ุงูุนุงูู ูุงุฏุฑูุง ุนูู ููุงุตูุฉ ุนููู ูุณูุฎุถุน ูุณูุทุฑุฉ ุณููุงููุฑ. <br><br>  ุงูุขู ุฏุนููุง ููุชุจ ุทุฑููุฉ ุงูุฅุตุฏุงุฑ. <br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> countBefore = Interlocked.Increment(<span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> currentCount) - <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (countBefore &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (waiters.TryPop(<span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> waiter)) waiter.TrySetResult(<span class="hljs-literal"><span class="hljs-literal">true</span></span>); }</code> </pre> <br>  ุทุฑููุฉ ุงูุฅุตุฏุงุฑ ูู ููุง ููู: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ููุนุฏ ูุงุญุฏ ูุฌุงูุง ูู ุฅุดุงุฑุฉ </li><li style=";text-align:right;direction:rtl">  ุงูุฒูุงุฏุฉ ุงูุญุงููุฉุงูุนุฏุฏ </li></ul><br>  ุฅุฐุง ุงุณุชุทุนูุง ุฃู ูููู ุจูุงุณุทุฉ currentCount ูุง ุฅุฐุง ูุงู ููุงู ูุงุฏู ุฏุงุฎู ุงูููุฏุณ ูุญุชุงุฌ ุฅูู ุงูุฅุดุงุฑุฉ ุฅููู ุ ููุญู ูุฎุฑุฌ ูุฐุง ุงููุงุฏู ูู ุงูููุฏุณ ูุงูุฅุดุงุฑุฉ.  ููุง ุงููุงุฏู ูู TaskCompletionSource.  ุงูุณุคุงู ุนูู ูุฐุง ุงูููุฏ: ูุจุฏู ููุทูููุง ุ ููู ูู ููุฌุญุ  ูุง ูู ุงููุดุงูู ููุงูุ  ููุงู ูุงุฑู ุจุณูุท ูุชุนูู ุจุงูููุงู ุงูุฐู ูุชู ููู ุฅุทูุงู ุงุณุชูุฑุงุฑ ู TaskCompletionSource'y. <br><br><img src="https://habrastorage.org/webt/_1/zo/hu/_1zohu07rqeiemrkwrcubv7gwhe.png"><br><br>  ุงููุธุฑ ูู ูุฐุง ุงูุฑูุฒ.  ุฃูุดุฃูุง TaskCompletionSource ูุฃุทููุช ุงุซููู ูู ุงูููุงู.  ุงููููุฉ ุงูุฃููู ุชุนุฑุถ ูุญุฏุฉ ุ ูุชุนููู ุงููุชูุฌุฉ ุนูู TaskCompletionSource ุ ุซู ุชุนุฑุถ ุงูุดูุทุงู ุนูู ูุญุฏุฉ ุงูุชุญูู.  ุชูุชุธุฑ ุงููููุฉ ุงูุซุงููุฉ ุนูู TaskCompletionSource ูุฐุง ุ ููู ุงููููุฉ ุงูุฎุงุตุฉ ุจูุง ุ ุซู ุชููู ุฏุงุฆููุง ุจุญุธุฑ ูุคุดุฑ ุงูุชุฑุงุจุท ูู ุชุฌูุน ูุคุดุฑุงุช ุงูุชุฑุงุจุท. <br><br>  ูุงุฐุง ุณูุญุฏุซ ููุงุ  ุณูุชู ุชูุณูู ุงููููุฉ 2 ุนูุฏ ุงูุชุญููู ุงูุจุฑูุฌู ุฅูู ุทุฑููุชูู ุ ูุงูุซุงูู ูู ุงุณุชูุฑุงุฑ ูุญุชูู ุนูู Thread.Sleep.  ุจุนุฏ ุชุนููู ูุชูุฌุฉ TaskCompletionSource ุ ุณูุชู ุชูููุฐ ูุฐู ุงููุชุงุจุนุฉ ูู ููุณ ูุคุดุฑ ุงูุชุฑุงุจุท ุงูุฐู ุชู ููู ุชูููุฐ ุงููููุฉ ุงูุฃููู.  ููููุง ูุฐูู ุ ุณูุชู ุญุธุฑ ุชุฏูู ุงููููุฉ ุงูุฃููู ุฅูู ุงูุฃุจุฏ ุ ููู ุชุชู ุทุจุงุนุฉ ุงูุดุฑุญ ุฅูู ูุญุฏุฉ ุงูุชุญูู. <br><br>  ููู ุงููุซูุฑ ููุงูุชูุงู ุ ุญุงููุช ุชุบููุฑ ูุฐุง ุงูุฑูุฒ ุ ูุฅุฐุง ููุช ุจุฅุฒุงูุฉ ุงูุฅุฎุฑุงุฌ ุฅูู ูุญุฏุฉ ุงูุชุญูู ุ ูุณูุชู ุจุฏุก ุงููุชุงุจุนุฉ ุนูู ูุคุดุฑ ุชุฑุงุจุท ุขุฎุฑ ูู ุชุฌูุน ูุคุดุฑุงุช ุงูุชุฑุงุจุท ูุชู ุทุจุงุนุฉ ุงูุดุฑุญ.  ูู ุฃู ูู ุงูุญุงูุงุช ุ ุณูุชู ุชูููุฐ ุงููุชุงุจุนุฉ ูู ููุณ ุณูุณูุฉ ุงูุฑุณุงุฆู ุ ููููุง - ุณุชุตู ุฅูู ูุฌููุนุฉ ูุคุดุฑุงุช ุงูุชุฑุงุจุท - ุณุคุงู ูููุฑุงุก. <br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tcs = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TaskCompletionSource&lt;<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>&gt;( TaskCreationOptions.RunContinuationsAsynchronously); <span class="hljs-comment"><span class="hljs-comment">/* OR */</span></span> Task.Run(() =&gt; tcs.TrySetResult(<span class="hljs-literal"><span class="hljs-literal">true</span></span>));</code> </pre> <br>  ูุญู ูุฐู ุงููุดููุฉ ุ ูููููุง ุฅูุง ุฅูุดุงุก TaskCompletionSource ูุน ุนูุงูุฉ RunContinuationsAsynchronously ุงูููุงุจูุฉ ุฃู ุงุณุชุฏุนุงุก ุงูุฃุณููุจ TrySetResult ุฏุงุฎู Task.Run/ThreadPool.QueueUserWorkItem ุจุญูุซ ูุง ูุนูู ุนูู ูุคุดุฑ ุงูุชุฑุงุจุท ุงูุฎุงุต ุจูุง.  ุฅุฐุง ุชู ุชูููุฐู ุนูู ุฎูุทูุง ุ ููุฏ ูููู ูุฏููุง ุขุซุงุฑ ุฌุงูุจูุฉ ุบูุฑ ูุฑุบูุจ ูููุง.  ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ููุงู ูุดููุฉ ุซุงููุฉ ุ ุณููุงูุดูุง ุจูุฒูุฏ ูู ุงูุชูุตูู. <br><br><img src="https://habrastorage.org/webt/m9/x8/gx/m9x8gxz7x5tw3mjcps7nygdmkjs.jpeg"><br><br>  ุงูุธุฑ ุฅูู ุฃุณุงููุจ WaitAsync ู Release ูุญุงูู ุงูุนุซูุฑ ุนูู ูุดููุฉ ุฃุฎุฑู ูู ุทุฑููุฉ Release. <br><br>  ุนูู ุงูุฃุฑุฌุญ ุ ููุนุซูุฑ ุนูููุง ุจุจุณุงุทุฉ ูุณุชุญูู.  ููุงู ุณุจุงู ููุง. <br><br><img src="https://habrastorage.org/webt/cs/1e/4q/cs1e4q3yaz4d3084_24z2ucsd6y.jpeg"><br><br>  ูุฑุฌุน ุฐูู ุฅูู ุญูููุฉ ุฃูู ูู ุฃุณููุจ WaitAsync ุ ูุฅู ุชุบููุฑ ุงูุญุงูุฉ ููุณ ุฐุฑููุง.  ุฃููุงู ูููู ุจุชูููู ุงูุนุฏุงุฏ ูุจุนุฏ ุฐูู ููุท ูุฏูุน ุงููุงุฏู ุฅูู ุงูููุฏุณ.  ุฅุฐุง ุญุฏุซ ุฐูู ุ ูุชู ุชูููุฐ ุงูุฅุตุฏุงุฑ ุจูู ุงูุชุฑุงุฌุน ูุงูุฏูุน ุ ููุฏ ูุฎุฑุฌ ุญุชู ูุง ูุณุญุจ ุฃู ุดูุก ูู ุงูููุฏุณ.  ูุฌุจ ุฃู ูุคุฎุฐ ุฐูู ูู ุงูุงุนุชุจุงุฑ ุ ููู ุทุฑููุฉ ุงูุฅุตุฏุงุฑ ุ ุงูุชุธุฑ ุญุชู ูุธูุฑ ุงููุงุฏู ุนูู ุงูููุฏุณ. <br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> countBefore = Interlocked.Increment(<span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> currentCount) - <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (countBefore &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { Waiter waiter; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> spinner = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SpinWait(); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (!waiter.TryPop(<span class="hljs-keyword"><span class="hljs-keyword">out</span></span> waiter)) spinner.SpinOnce(); waiter.TrySetResult(<span class="hljs-literal"><span class="hljs-literal">true</span></span>); }</code> </pre> <br>  ูุญู ููุง ููุนู ุฐูู ูู ุญููุฉ ุญุชู ูุชููู ูู ุณุญุจูุง.  ููู ูุง ูุถูุน ุฏูุฑุงุช ุงููุนุงูุฌ ูุฑุฉ ุฃุฎุฑู ุ ูุณุชุฎุฏู SpinWait. <br><br>  ูู ุงูุชูุฑุงุฑุงุช ุงูููููุฉ ุงูุฃููู ุ ุณูู ุชุฏูุฑ ูู ุญููุฉ.  ุฅุฐุง ูุงู ููุงู ุงููุซูุฑ ูู ุงูุชูุฑุงุฑุงุช ุ ููู ูุธูุฑ ุงููุงุฏู ููุชุฑุฉ ุทูููุฉ ุ ุซู ููุชูู ุฎูุทูุง ุฅูู Thread.Sleep ุ ุญุชู ูุง ูุถูุน ููุงุฑุฏ ูุญุฏุฉ ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉ ูุฑุฉ ุฃุฎุฑู. <br><br>  ูู ุงููุงูุน ุ LIFO-order Semaphore ููุณ ููุท ููุฑุชูุง. <br><blockquote style=";text-align:right;direction:rtl">  <b>LowLevelLifoSemaphore</b> <br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูุชุฒุงูู </li><li style=";text-align:right;direction:rtl">  ุนูู Windows ุ ูุณุชุฎุฏู ูููุฐ ุฅููุงู IO ูููุฉ Windows </li></ul><br>  <a href="">https://github.com/dotnet/corert/blob/master/src/System.Private.CoreLib/src/System/Threading/LowLevelLifoSemaphore.cs</a> </blockquote>  ููุฌุฏ ูุซู ูุฐุง ุงูุฅุดุงุฑุฉ ูู .NET ููุณู ุ ูููู ููุณ ูู CoreCLR ุ ูููุณ ูู CoreFX ุ ูููู ูู CoreRT.  ูู ุงููููุฏ ูู ุจุนุถ ุงูุฃุญูุงู ุฅููุงุก ูุธุฑุฉ ุฎุงุทูุฉ ุนูู ูุณุชูุฏุน .NET.  ููุงู ุฅุดุงุฑุฉ ุชุณูู LowLevelLifoSemaphore.  ูู ููุงุณุจูุง ูุฐุง ุงูุฅุดุงุฑุฉ ุนูู ุฃู ุญุงู: ุฅูู ูุชุฒุงูู. <br><br>  ุจุดูู ููุญูุธ ุ ุนูู ูููุฏูุฒ ูุนูู ูู ุฎูุงู ููุงูุฐ ุฅููุงู IO.  ูุฏููู ุฎุงุตูุฉ ูููู ุฃู ุชูุชุธุฑูุง ูุคุดุฑุงุช ุงูุชุฑุงุจุท ุ ูุณูุชู ุฅุตุฏุงุฑ ูุฐู ุงูุฎููุท ุจุชุฑุชูุจ LIFO ููุท.  ูุชู ุงุณุชุฎุฏุงู ูุฐู ุงูููุฒุฉ ููุงู ุ ุฅููุง ููุฎูุถุฉ ุงููุณุชูู ุญููุง. <br><br><h3 style=";text-align:right;direction:rtl">  2.3 ุงูุงุณุชูุชุงุฌุงุช: </h3><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูุง ุชุฃูู ูู ุฃู ูุธู ููุก ุงูุฅุทุงุฑ ููุฏ ุงูุญูู </li><li style=";text-align:right;direction:rtl">  ูู ุงูุฃุณูู ุญู ูุดููุฉ ูุนููุฉ ูู ุงูุญุงูุฉ ุงูุนุงูุฉ. </li><li style=";text-align:right;direction:rtl">  ุงุฎุชุจุงุฑ ุงูุฅุฌูุงุฏ ูุง ูุณุงุนุฏ ุฏุงุฆูุง </li><li style=";text-align:right;direction:rtl">  ุญุฐุงุฑ ูู ุงูุญุฌุจ </li></ul><br>  ูุง ูู ุงูุงุณุชูุชุงุฌุงุช ูู ูุฐู ุงููุตุฉ ูููุงุ  ุจุงุฏุฆ ุฐู ุจุฏุก ุ ูุง ุชุฃูู ุฃู ุจุนุถ ุงููุฆุงุช ูู ุงูุฅุทุงุฑ ุงูุฐู ุชุณุชุฎุฏูู ูู ุงูููุชุจุฉ ุงูููุงุณูุฉ ุณุชุชุนุงูู ูุน ุญููู.  ูุง ุฃุฑูุฏ ุฃู ุฃููู ุฅู SemaphoreSlim ุฃูุฑ ุณูุฆ ุ ููุฏ ุงุชุถุญ ุฃูู ุบูุฑ ููุงุณุจ ุนูู ูุฌู ุงูุชุญุฏูุฏ ูู ูุฐุง ุงูุณููุงุฑูู. <br><br>  ููุฏ ุฃุตุจุญ ุงูุฃูุฑ ุฃุณูู ุจุงููุณุจุฉ ููุง ููุชุงุจุฉ ุฅุดุงุฑุฉ ูุฏููุง ููููุฉ ูุญุฏุฏุฉ.  ุนูู ุณุจูู ุงููุซุงู ุ ูุง ูุฏุนู ุฅูุบุงุก ุงูุงูุชุธุงุฑ.  ุชุชููุฑ ูุฐู ุงูููุฒุฉ ูู SemaphoreSlim ุงููุนุชุงุฏุฉ ุ ููุญู ูุง ูููููุง ุ ููู ูุฐุง ุณูุญ ููุง ุจุชุจุณูุท ุงูููุฏ. <br><br>  ุงุฎุชุจุงุฑ ุงูุญูู ุ ุนูู ุงูุฑุบู ูู ุฃูู ูุณุงุนุฏ ุ ูุฏ ูุง ูุณุงุนุฏ ุฏุงุฆููุง. <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุนุฑู .NET ุจุฃูู ุบุงูุจูุง ูุง ูุชู ุชุฃูููู ูู ุฃูุงูู ุบูุฑ ูุชููุนุฉ - ูู ุงูุฃูุถู ุงูุญุฐุฑ ูููุง. </font><font style="vertical-align: inherit;">ุฅุฐุง ููุช ุจูุชุงุจุฉ ุจููุฉ ุงูููู ูู ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ุงูุฎุงุตุฉ ุจู ุ ููู ุงูุฃูุถู ุฃู ุชููุฑ: "ูุง ูู ุงูุญูู ุงูุญูููู ููุงุ" </font><font style="vertical-align: inherit;">ูุฅุฐุง ูุงู ุงุณุชููุงู ูุญุฏุฉ ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉ ูุฌุฃุฉ 100ูช ุ ูุณุชุฌุฏ ุฌููุน ูุคุดุฑุงุช ุงูุชุฑุงุจุท ูู ูุถุน ุงูููู ุ ูุฑุจูุง ูุญุฏุซ ูุฐุง ูู ููุงู ูุง ุฏุงุฎู .NET. </font><font style="vertical-align: inherit;">ููุท ุถุน ุฐูู ูู ุงูุงุนุชุจุงุฑ. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฏุนูุง ููุชูู ุฅูู ุงููุตุฉ ุงููุงุฏูุฉ.</font></font><br><br><h2 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุงููุตุฉ 3: (ุฃ) ูุฒุงููุฉ IO </font></font></h2><br>    /,      . <br><br><img src="https://habrastorage.org/webt/84/qh/sz/84qhsz9je7twmgbswt5so0dfx2q.jpeg"><br><br>    lock convoy,    stack trace     Overlapped  PinnableBufferCache.   lock.     : Overlapped  PinnableBufferCache? <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">OVERLAPPED</a> โ    Windows,      /.      ,        .        ,  .       ,     lock convoy.   ,      lock convoy,    ,   . <br><br><img src="https://habrastorage.org/webt/if/j_/fc/ifj_fclqmvkfgfff7zedxpj63mo.jpeg"><br><br>  ,       ,   .NET 4.5.1  4.5.2.     .NET 4.5.2,     ,    .NET 4.5.2.  .NET 4.5.1     OverlappedDataCache,      Overlapped โ ,       ,   .    ,  lock-free,   ConcurrentStack,       .  .NET 4.5.2     :  OverlappedDataCache   PinnableBufferCache. <br><br>   ? PinnableBufferCache     ,   Overlapped     ,    ,       โ      . ,     ,      . PinnableBufferCache     .   , lock-free,   ConcurrentStack.     ,      .        ,        ,  -    lock-free    list  lock'. <br><br><h3 style=";text-align:right;direction:rtl"> 3.1 PinnableBufferCache </h3><br> LockConvoy: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">    </li><li style=";text-align:right;direction:rtl">      </li></ul><br>  lock convoy  ,   -     .        list      ,     lock   ,  ,                . <br><br>     PinnableBufferCache  ,         .    : <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">PinnableBufferCache_System.ThreadingOverlappedData_MinCount</code> </pre> <br>      ,      .  : ยซ !         -  ยป.         -: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs">Environment.SetEnvironmentVariable( <span class="hljs-string"><span class="hljs-string">"PinnableBufferCache_System.Threading.OverlappedData_MinCount"</span></span>, <span class="hljs-string"><span class="hljs-string">"10000"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Overlapped().GetHashCode(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">3</span></span>; i++) GC.Collect(GC.MaxGeneration, GCCollectionMode.Forced);</code> </pre> <br>    ?     ,    Overlapped  ,   ,        .     ,   ,     ,     ,  PinnableBufferCache      lock convoy'.    ,           . <br><br>  .NET Core  PinnableBufferCache <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="></a> ,   OverlappedData   . ,        , Garbage collector     ,      .     .NET Core  .  .NET Framework,   ,     . <br><br><h3 style=";text-align:right;direction:rtl"> 3.2 : </h3><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">      </li><li style=";text-align:right;direction:rtl">      </li><li style=";text-align:right;direction:rtl">   .NET Core </li></ul><br>      ,     .   ,   .NET            ,       . ,  ,  .NET Core. ,     ,         -. <br><br>    key-value . <br><br><h2 style=";text-align:right;direction:rtl">  4: Concurrent key-value collections </h2><br>  .NET   concurrent-.  lock-free  ConcurrentStack  ConcurrentQueu,       .   ConcurrentDictionary,    .   lock-free  ,   ,      .    ConcurrentDictionary? <br><br><h3 style=";text-align:right;direction:rtl"> 4.1 ConcurrentDictionary </h3><br> : <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  </li><li style=";text-align:right;direction:rtl">  </li></ul><br>  ุงูุงูุฌุงุจูุงุช: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">     </li><li style=";text-align:right;direction:rtl">   (TryAdd/TryUpdate/AddOrUpdate) </li><li style=";text-align:right;direction:rtl"> Lock-free  </li><li style=";text-align:right;direction:rtl"> Lock-free enumeration </li></ul><br>      , memory-,  ,        .    ,    ,    .NET Framework.            . ,  ,      (enumeration) lock-free. ,   . <br><br>  ,   ,   -  .NET.  key-value    -    : <br><br><img src="https://habrastorage.org/webt/ff/9f/g_/ff9fg_qzzuzvafep8c-p3seyigm.jpeg"><br><br>  -,     bucket'.      bucket',    .   ,    bucket   ,       . <br><br>    โ   ,  ConcurrentDictionary.  ConcurrentDictionary    ยซ-ยป   .    ,      ,   ,       memory traffic.     ConcurrentDictionary,   lock'.   โ   . <br><br>    ,    Dictionary. <br><br><img src="https://habrastorage.org/webt/-_/dw/jo/-_dwjoxswmd1kecoi3aln8m7bow.jpeg"><br><br>  Dictionary  ,  Concurrent,      .     :  buckets,  entries.   buckets       bucket'   entries.   ยซ-ยป    entries.          .      ยซ-ยป   int,     bucket'. <br><br>   memory overhead,     ConcurrentDictionary   Dictionary. <br><br><img src="https://habrastorage.org/webt/em/aa/ch/emaachor-z_xxt7m_1wc7ntqupm.jpeg"><br><br>    Dictionary. Memory overhea'    ,       .    Dictionary  overhead  -    ,  int'.  8 . <br><br>    ConcurrentDictionary.  ConcurrentDictionary     ConcurrentDictionary.Node.   , .     int hashCode        .       ,    table (  16 ),  int hashCode     .      ,   64-    28  overhead'.       Dictionary. <br><br>  memory overhead', ConcurrentDictionary     GC   ,       .     Benchmark.   ConcurrentDictionary  ,       GC.Collect.    ? <br><br><img src="https://habrastorage.org/webt/on/yj/uq/onyjuq1rqgfkv8iav5x4z8nrnq8.jpeg"><br><br>     .       ConcurrentDictionary  10  ,        ,             ,      .   Dictionary   .      ,   ,  ,    .       . <br><br>     ,     ConcurrentDictionary? <br><br><h3 style=";text-align:right;direction:rtl"> 4.2   </h3><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">    </li><li style=";text-align:right;direction:rtl"> TTL </li><li style=";text-align:right;direction:rtl"> Dictionary+lock </li><li style=";text-align:right;direction:rtl"> Sharding </li></ul><br>     .      ConcurrentDictionary.        10  .   ,     .   TTL  ,    .        Dictionary  lock'. ,  ,  lock    .       Dictionary  lock'      ,   -     ,           lock.      ,     . <br><br><h3 style=";text-align:right;direction:rtl"> 4.3  </h3><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">   in-memory  &lt;Guid,Guid&gt; </li><li style=";text-align:right;direction:rtl">   &gt;10 <sup>6</sup>  </li><li style=";text-align:right;direction:rtl">       </li><li style=";text-align:right;direction:rtl">   </li><li style=";text-align:right;direction:rtl">        </li></ul><br>     .      โ      ,       in-memory   Guid'  Guid,     .       .     - - ,     .  ,            15    .   .     Semaphore     ConcurrentDictionary. <br><br><img src="https://habrastorage.org/webt/u4/kw/kt/u4kwkttmxwpyelqlqoqp9zxahaa.jpeg"><br><br> ,    lock-free    ,    overhead      GC.   ,          .      ,    ,       ,   .   ,     -  ,       ,    .  ,  ,      Large Object Heap.    ? <br><br>       ,     ,     Dictionary   . <br><br><img src="https://habrastorage.org/webt/kx/yn/oi/kxynoiatsy8zcyrc5dei-xohlk4.jpeg"><br><br>   Dictionary   bucket',  Entry.  Entry  , ,   ,   . <br><br><img src="https://habrastorage.org/webt/n8/7a/5r/n87a5rlkgdk62nw82qysi3fmi18.png"><br><br>  Dictionary   ,   ,      . ,     - . <br><br>      ,  -     ? -,  ,       ,     ,      .     .    Dictionary,     , buckets, entries,              Interlocked. ,         . <br><blockquote style=";text-align:right;direction:rtl"> <b>Dictionary</b> <br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">   ,    </li><li style=";text-align:right;direction:rtl">     ,   ? <br> โ  Resize  buckets  entries   <br> โ      - <br> โ    Dictionary.Entry <br> โ   -   </li></ul><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">https://blogs.msdn.microsoft.com/tess/2009/12/21/high-cpu-in-net-app-using-a-static-generic-dictionary/</a> </blockquote>     ,       Dictionary       -  bucket'.       ,      .    ,     ,        .       ,       ,    . <br><br>      Entry  Dictionary.     - -    .  ,     . <br><br><img src="https://habrastorage.org/webt/4p/xb/aq/4pxbaqil2cd4jaxnayxjqz-5yae.jpeg"><br><br>    .NET Framework  1.1.     Hashtable,   Dictionary,    object'.     MSDN ,      .  ,             -.   .  ,  Hashtable  .  ,      . <br><br><h3 style=";text-align:right;direction:rtl"> 4.4    Dictionary.Entry </h3><br><img src="https://habrastorage.org/webt/y2/ww/rs/y2wwrslyuqpioqcalmpnt8dh6cw.jpeg"><br>    ? Dictionary.Entry ,  ,  8 , ,  ,   ,     .   ? <br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> writing; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> version; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.writing = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; buckets[index] = โฆ; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.version++; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.writing = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;</code> </pre> <br>   :  (    ,    )  int-.   ,  .   ,     , ,  ,  . <br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> writing; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> version; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-literal"><span class="hljs-literal">true</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> version = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.version; bucket = bickets[index]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.writing || version != <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.version) <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; }</code> </pre> <br>    ,     ,         .       ,   .       ,  8 . <br><br><h3 style=";text-align:right;direction:rtl"> 4.5   -   </h3><br>  ,   . <br><br><img src="https://habrastorage.org/webt/hh/bp/0l/hhbp0leb95qndz4bmg-2gtvmeue.jpeg"><br><br>  Dictionary     bucket    ,     . <br><br>  Dictionary,    .      : 0  2.   bucket, 1       2.   ?     0.   ,       ,    2.     .   ,  2,       , , 1. 1       2 โ     bucket.   ,      ,   .    1 โ ,     bucket.  Hashtable     ,     bucket'  -.        โ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">double hashing</a> . <br><br><h3 style=";text-align:right;direction:rtl"> 4.6   </h3><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">     </li><li style=";text-align:right;direction:rtl">      </li></ul><br> <b></b> <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">        </li><li style=";text-align:right;direction:rtl">    ,  resize </li></ul><br> <b></b> <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">     ,      </li></ul><br>        .         ,       Buckets,     Entries (   Buckets,     Entries).   -  ,       ,   ,          ,    . <br><br>             .    ,    . <br><br>  :     ,      ,    ,     ,     . ,       ,   . <br><br><img src="https://habrastorage.org/webt/pm/lo/ah/pmloah0wlfbq7ilvlnrvbh3pyuu.png"><br><br>     ,   , โ  . <br><br>   ?   ,  -    2.   -   Capacity  ,            .    โ 2.       ,   .      2.    ?  ,  ,     ,   .    -  ,        ,       3. ,    ,  ,    ,  ,  . <br><br>  ,    Hashtable,  .   ,     double hashing.     ,       ,   ,     . <br><br>   ,      ,     โ   ,            .     Hashtable.   ,    โ     โ       .                 .  ,     bucket',       -  ,       .  . <br><br>     ,  ,   lock-free      LOH. <br><br><img src="https://habrastorage.org/webt/pg/2b/6b/pg2b6bbfkm_3nnkds27g2krziz8.jpeg"><br><br>   lock-free ?  MSDN    Hashtable ,      .    ,            ,            . <br><br><img src="https://habrastorage.org/webt/yu/sg/he/yusghe0crfu9ywaic0aozpr7wri.jpeg"><br><br>      ,     ,        ,   bucket'.         Dictionary  bucket',  -,   bucket'      .    -    bucket,  bucket  .      ,     . <br><br>  ,       Large Object Heap. <br><br><img src="https://habrastorage.org/webt/wf/po/8o/wfpo8ou1_fpzhdkgcdbjzw-7u9q.jpeg"><br><br>      .  CustomDictionary  CustomDictionarySegment    .   Dictionary,    ,      .   โ   Dictionary,      .       ,      Large Object Heap.        ,   bucket'   . ,      ,    ,   bucket,     - - . <br><br>           .       ConcurrentDictionary,     .NET,        ,      . <br><br><h3 style=";text-align:right;direction:rtl"> 4.7  </h3><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"> .NET   </li><li style=";text-align:right;direction:rtl">    </li><li style=";text-align:right;direction:rtl">   </li><li style=";text-align:right;direction:rtl"> ,     </li><li style=";text-align:right;direction:rtl">   </li><li style=";text-align:right;direction:rtl">   </li></ul><br>     ? .NET  .   .   ,     ,       .    -   โ   - .   ,  , ,     . <br><br>  -   , ,   ,     ,   .   ,   ,   ,        , ,          .   โ   , ,   . <br><br><h3 style=";text-align:right;direction:rtl">  ุฑูุงุจุท ูููุฏุฉ </h3><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">   ConcurrentDictionary: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">https://habr.com/ru/company/skbkontur/blog/348508/</a> </li><li style=";text-align:right;direction:rtl"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">https://github.com/vostok/commons.threading</a> </li><li style=";text-align:right;direction:rtl"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">https://github.com/epeshk/dotnext-2019-threading</a> </li></ul><br>   โ          ConcurrentDictionary. ,      ,   ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" class="user_link">Diafilm</a> ),       . <br><br>      GitHub.   โ     ,    ,    LIFO-Semaphore,    .       ,    . <br><blockquote style=";text-align:right;direction:rtl"> 6-7     <b>DotNext 2019 Moscow</b>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ยซ.NET:  ยป</a>    ,        .NET Framework  .NET Core,  ,        . </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar468611/">https://habr.com/ru/post/ar468611/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar468601/index.html">ุชูุฏูุฑ ูุฏุฉ ุงููุดุฑูุน. ููุงุฐุง ูู ุฏุงุฆูุง ุชูุฑูุจุง ูููุช ุฌุฏุง ููุงุฐุง ุชูุนู ุญูุงู ุฐูู</a></li>
<li><a href="../ar468603/index.html">ููุฏ ุดููุช Rutracker eSNI. ููุงูุฉ ุนุตุฑ DPI ูููุงูุฉ ุงูุฃููุงู</a></li>
<li><a href="../ar468605/index.html">ูุคุดุฑุงุช ุซุงุจุชุฉ ุฅูู ูุคุดุฑุงุช ุฅูู ูุคุดุฑุงุช ...</a></li>
<li><a href="../ar468607/index.html">ุฃูุฏุฑููุฏ ููููุฏุณ ุงูุฑุงุฏูู (ุงูุฌุฒุก ุงูุซุงูู)</a></li>
<li><a href="../ar468609/index.html">ุงูุฃุฏุงุก ุบูุฑ ุงูููููู ูุฌุฏููุฉ ูุชุนุฏุฏุฉ</a></li>
<li><a href="../ar468615/index.html">ุฃูุถู 10 ูุบุงุช ูุชูุทูู ุงูุชุทุจููุงุช</a></li>
<li><a href="../ar468621/index.html">ูุชุฑุฌู ุงูุดุจูุฉ ุงูููุฒููุฉ ุฅูู DoH ุ ุฃู ููุฑุฉ ุฃุฎุฑู ุนูู ุฃูู ุงูุชุตููุฉ</a></li>
<li><a href="../ar468623/index.html">ุฃุฑูุฏ ูุฑุงุฌุนุงุช ุนูู ูุจุฑ</a></li>
<li><a href="../ar468625/index.html">Serverless: 15 ูช ุฃุจุทุฃ ูุซูุงู ูุฑุงุช ุฃูุซุฑ ุชูููุฉ</a></li>
<li><a href="../ar468627/index.html">ADAM-6200 I / O ูุญุฏุงุช</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>