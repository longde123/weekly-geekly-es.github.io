<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🚑 🥔 🎭 Energi, panas, dan air 🧀 🚗 ⁉️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Kata Pengantar 
 Tahun 2019. Di hampir semua toko elektronik, Anda dapat membeli satu dari ratusan kemungkinan rumah pintar. Ambil dan konfigurasikan ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Energi, panas, dan air</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/446864/"><h2>  Kata Pengantar </h2><br>  <i>Tahun 2019.</i>  <i>Di hampir semua toko elektronik, Anda dapat membeli satu dari ratusan kemungkinan rumah pintar.</i>  <i>Ambil dan konfigurasikan dalam "2 klik", sambungkan ke awan, terima acara push di aplikasi / SMS, dan secara umum terima semua informasi yang diperlukan di mana pun di dunia.</i> <br><br>  Ideal, tetapi dalam kasus saya itu tidak berhasil.  Beberapa keputusan yang jatuh ke tangan saya ternyata adalah serangkaian fungsi tertentu, yang hanya mencakup sebagian dari pertanyaan saya, dan di samping itu, memaksakan pembatasan yang hampir tidak dapat diatasi.  Dan, seperti yang biasanya terjadi, semakin sedikit batasan, semakin Anda perlu terjun ke bidang subjek, secara mandiri memikirkan solusi, arsitektur.  Oleh karena itu - pertanian kolektif sendiri :) <br><br><h2>  Tugasnya </h2><br>  1. menerima informasi tentang kualitas jaringan daya (lonjakan daya, matikan total, dll.). <br><br>  2. Miliki pemantauan UPS penuh.  Tetapi pada kenyataannya, untuk memiliki UPS yang sama ini berdasarkan pada konsekuensi p2. <br><br>  3. Menerima informasi suhu: <br><br><ol><li>  di jalan </li><li>  di rumah </li><li>  di loteng (ketika sampah dan tomat dibuang di sana membeku) </li></ol><br>  4. Monitor keadaan konsumsi air, waspadai jika konsumsi meningkat (tiba-tiba bocor, Anda tidak dapat menimbang semuanya dengan sensor kelembaban). <br><br>  5. Memahami ketika seseorang ada di rumah untuk mengotomatiskan penutupan / pembukaan air. <br><br>  6. Membaca meteran gas dan waspada ketika cadangan yang dibayar habis. <br>  + semua jenis sensor lainnya (kelembaban, bukaan, tekanan air, tekanan di sirkuit pemanas, dll.). <br><br>  Tujuan global adalah untuk memiliki antarmuka umum di mana Anda dapat melihat semua ini.  Terima pemberitahuan jika terjadi kesalahan.  <s>Dan agar tidak ada apa-apa untuk itu</s> dan memberi kembali tidak banyak uang. <br><br><h2>  Komposisi kompleks saat ini </h2><br><ul><li>  UPS Energy PN-750 + Baterai 100 Ah </li><li>  USB-&gt; RS232 converter berdasarkan PL2303 </li><li>  Router Tp-link tl-wr1043nd + </li><li>  Master jaringan 1wire berdasarkan termometer USB DS18B20 + PL-2303TA yang dibeli </li><li>  1wire 3 sensor DS18B20 </li><li>  1 meter modul meter air radioseti DS2423 </li></ul><br>  Mesin virtual dengan server Zabbix di luar jaringan rumah. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/38f/096/8dc/38f0968dcb30102ff286561853581a96.png" alt="gambar"><br><br><a name="habracut"></a><br><h2>  Tahap 1. Persiapan infrastruktur </h2><br>  Langkah pertama adalah pertanyaan reorganisasi fisik: router dipindahkan ke nakas di dekat poros lubang, tempat UPS direncanakan untuk dipasang.  Antena ke penyedia Internet Ubiquiti Nanostation Loco M2 PoE terhubung ke outlet yang sama dengan router, agar dapat terus didukung oleh UPS. <br><br>  Saya sudah memiliki instalasi khusus Zabbix pada server jarak jauh dan beberapa pengalaman bekerja dengan aplikasi ini, jadi dengan teori mengatur peringatan, dan bahkan dasbor itu sendiri, tidak ada masalah yang diharapkan. <br><br>  Router menyala dalam OpenWRT Chaos Calmer, sebuah VPN dikonfigurasikan ke jaringan di mana server Zabbix berada. <br><br>  Saya segera menambahkan metrik ke zabbix, setelah mendapatkan templat item untuk openwrt.  Jadi, saya mendapat kesempatan untuk memantau sistem dan, misalnya, berapa banyak dan alamat MAC mana yang terhubung ke titik tersebut.  Apa yang di masa depan seharusnya berfungsi sebagai keputusan penutupan air di rumah. <br><br><h2>  Langkah 2. Memilih UPS </h2><br>  Kriteria seleksi adalah: <br><br><ul><li>  kemungkinan boiler gas (buderus) </li><li>  dari 5 jam otonomi ketel + peralatan Internet </li><li>  Kehadiran antarmuka pemantauan </li><li>  kebisingan rendah (penempatan - meja samping tempat tidur di dapur dekat lubang ventilasi) </li><li>  karena pembatasan penempatan dan harga - lebih disukai desain baterai tunggal </li></ul><br>  Kami akan memeriksa kemungkinan memenuhi kriteria secara berurutan. <br><br>  <b>Kemampuan boiler gas untuk bekerja</b> dijelaskan oleh fakta bahwa boiler memerlukan sinus bersih, jika tidak motor pompa akan berdengung dan aus.  Tentang ini, Anda dapat google banyak artikel. <br>  Biasa (UPS komputer) tidak memberikan sinus seperti itu, memberikan gelombang sinus yang diperkirakan. <br>  Faktor penting kedua adalah keberadaan "melalui netral".  Semuanya sedikit lebih rumit di sini, tetapi juga mudah untuk google, jadi saya tidak akan berhenti.  Saya hanya akan mengatakan satu hal - tanpa melalui netral, buderus tidak berfungsi, atau lebih tepatnya jatuh ke dalam kesalahan, karena sensor ionisasi tidak berfungsi dan boiler tidak melihat nyala api. <br><br>  Sebagai pengganti UPS, ada pergeseran fokus ke arah UPS online dan interaktif. <br>  <b>Dari 5 jam otonomi ketel + Peralatan Internet</b> memberi UPS terutama dengan baterai eksternal.  <b>Karena pembatasan lokasi dan harga, desain baterai tunggal diinginkan</b> .  Baterai 100Ah seharusnya bertahan selama 8+ jam. <br><br>  <b>Kehadiran antarmuka pemantauan</b> untuk setidaknya tahu kapan sistem beralih ke baterai, untuk pulang di musim dingin dan mulai generator.  Saya tidak punya persyaratan khusus di sini (juga pengalaman implementasi).  Saya mencari segala sesuatu yang datang dengan antarmuka RS232 atau usb. <br><br>  Persyaratan <b>tingkat kebisingan yang rendah</b> ternyata merupakan batasan serius dan membuang seluruh kelas peralatan - UPS online, karena semuanya bekerja dalam mode ventilasi konstan transformator (kipas tidak dimatikan). <br><br>  Memanggil toko Energi, saya mendapat PN-750 terakhir dengan rs232 dari etalase.  Cukup murah, karena tidak ada kabel di dalam kit. <br><br><h2>  Tahap 3: Pengaturan UPS </h2><br>  Ada masalah dalam menghubungkan UPS.  Saya membeli beberapa konverter USB-&gt; RS232, membaca di forum bahwa energi menggunakan protokol Megatec standar dan Anda setidaknya dapat bekerja dengannya melalui perangkat lunak Upsilon2000.  Tapi tidak peduli berapa banyak saya berjuang, ada keheningan total pada antarmuka serial.  Setelah seminggu mengalami cobaan, saya memutuskan untuk membongkar UPS dan melihat apa yang ada di sana, meludahi garansi.  Masalahnya ternyata biasa - papan RS232 tidak terhubung ke papan utama UPS, dan konektornya sedikit rusak.  Saya mengganti konektor, menghubungkannya dan tentang keajaiban, semuanya lepas landas, meskipun firmware mengeluarkan nama aneh UPS - SIN800 (sepertinya sekarang saya mengerti mengapa energi dalam model baru dipotong oleh rs232). <br><br>  Di bawah OpenWRT, ada P / O standar untuk bekerja dengan UPS: alat peningkatan jaringan, yang memiliki semua yang Anda perlukan untuk menampilkan metrik di konsol. <br><br><pre><code class="bash hljs">root@OpenWrt:/<span class="hljs-comment"><span class="hljs-comment"># upsc myups@127.0.0.1 battery.charge: 100 battery.voltage: 13.32 battery.voltage.high: 13.00 battery.voltage.low: 10.40 battery.voltage.nominal: 12.0 device.mfr: GERMANY device.model: SIN 800S device.type: ups driver.name: blazer_ser driver.parameter.cablepower: both driver.parameter.pollinterval: 2 driver.parameter.port: /dev/ttyUSB0 driver.parameter.protocol: megatec driver.version: 2.6.5 driver.version.internal: 1.55 input.current.nominal: 2.7 input.frequency: 50.0 input.frequency.nominal: 50 input.voltage: 225.7 input.voltage.fault: 225.7 input.voltage.nominal: 220 output.voltage: 219.6 ups.beeper.status: enabled ups.delay.shutdown: 30 ups.delay.start: 180 ups.firmware: Z1911F100 ups.load: 5 ups.mfr: GERMANY ups.model: SIN 800S ups.status: OL ups.temperature: 48.0 ups.type: online</span></span></code> </pre> <br>  Dan yang paling menarik adalah bahwa di bawah Zabbix ada template yang sudah jadi untuk kacang.  Vobschem - kami melihat agen zabbix script shell dari tempate kit dan kami memiliki gambar yang indah di zabbix dalam dinamika.  Tugas 1 dan 2 pada tahap ini diselesaikan (dan gagasan untuk memantau konsumsi energi total muncul di masa depan). <br><br><h2>  Tahap 4: 1wire dan suhu </h2><br>  Beberapa waktu lalu saya membeli termometer USB di ebay (papan konverter gabungan dan sensor). <br>  OpenWRT juga ternyata perangkat lunak yang cocok, utilitas digitemp_DS9097.  Dia menampilkan suhu sensor solder tunggal.  Setelah membaca bahwa ada 1wire, saya menyadari bahwa Anda dapat mencoba untuk tidak terbatas pada satu sensor dan mengambil seluruh bus sensor ke konverter USB yang dibeli.  Setelah mengambil beberapa microcircuits DS18B20 dan "barel" di bawah twisted pair di toko, saya membangun konstruksi dengan sensor dilepas di luar laras dan terhubung secara internal dengan 3 kabel. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/758/029/d61/758029d613c7dfe66d3f45adee62c043.png" alt="gambar"><br><br>  Saya sudah tahu tentang desain ini selama bertahun-tahun, kami menggunakan ini untuk mengambil bacaan di pusat data, tapi kemudian saya masih tidak tahu tentang 1wire.  Saat menghubungkan barel satu sama lain dengan kabel tambalan standar dan mengalihkan tambak ini ke "termometer USB", saya mendapat nilai dari ketiga sensor suhu. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/dc2/7d5/d6f/dc27d5d6fac92cc21834fb59c6e0a759.png" alt="gambar"><br><br>  Masih membuangnya di sekitar lokasi.  Panjang total ban sekitar 30 meter.  Sinyal tidak hilang.  Sebuah tong ditempatkan di jalan diisi dengan lem.  Tinggal musim dingin. <br><br><h2>  Tahap 5: air </h2><br>  Saya harus mengganti meteran air di pintu masuk (itu bukan denyut nadi, tanpa saklar buluh).  Berkat kehidupan di rumah pedesaan, pipa ledeng tidak menimbulkan pertanyaan.  Saya membelinya di toko pipa terdekat dan menggantinya.  Dalam meteran baru, satu pulsa terjadi setiap 10 liter air.  Sekarang impuls-impuls ini perlu dianggap sesuatu. <br><br>  Untuk beberapa alasan, mereka menghentikan rangkaian digital-counter digital yang menarik - DS2423.  Tetapi ternyata orang-orang dari Volgograd (radioseti) memiliki perangkat yang siap pakai, berkat baterai yang terpasang, juga menghitung nilai jumlah pulsa jika terjadi pemadaman listrik.  Namun, perangkat itu sendiri disesuaikan dengan arsitektur jaringannya sendiri.  Dari konektor RJ-11 ke catu daya 12V terpisah.  Dalam kasus saya, saya ingin membatasi diri untuk memberi daya pada bus yang ada (5V).  Saya harus menyiasati tali "ekstra" dan menyolder langsung ke kesimpulan DS2423 secara langsung.  Kemudian perangkat berfungsi, nilai register menjadi terlihat di bus.  Ada dua dari mereka, perangkat ini menyiratkan menghubungkan ke dua meter air pada saat yang sama - air panas dan air panas.  Saya hanya memiliki satu input air, jadi saya menggunakan register kedua hanya untuk tes. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f9b/fd5/05a/f9bfd505a9f2bcb9f93c0b9bc996c33f.png" alt="gambar"><br><br>  Hasil akhir untuk topologi 1wire: <br><br><pre> <code class="bash hljs">root@OpenWrt:/etc/zabbix<span class="hljs-comment"><span class="hljs-comment"># digitemp_DS9097 -c /etc/digitemp.conf -a DigiTemp v3.5.0 Copyright 1996-2007 by Brian C. Lane GNU Public License v2.0 - http://www.digitemp.com Apr 04 16:16:35 Sensor 0 C: 29.81 F: 85.66 Apr 04 16:16:36 Sensor 1 C: 14.00 F: 57.20 Apr 04 16:16:37 Sensor 2 C: 6.56 F: 43.81 Apr 04 16:16:37 Sensor 3 #0 6609 Apr 04 16:16:37 Sensor 3 #1 9</span></span></code> </pre><br><br>  Omong-omong, karena meter air baru dipasang bersamaan dengan meteran pulsa digital, kita dapat menarik kesimpulan tentang perbedaan pembacaan / pantulan kontak.  Secara visual, ketidakcocokan ini hampir tidak ada (hingga beberapa ratus liter saat membaca 60.000). <br><br><h2>  Tahap 6: Peringatan </h2><br>  Dengan menggunakan informasi yang dikumpulkan, dimungkinkan untuk membuat lansiran bermanfaat: <br><br><ul><li>  suhu luar ruangan dalam sms setiap pagi (+ partisipasi sensor dalam proyek narodmon) </li><li>  Pesan Transfer Baterai UPS </li><li>  Baterai UPS rendah </li><li>  pesan tegangan rendah / tinggi </li><li>  pesan tentang panas di nakas dengan peralatan </li><li>  laporan suhu rendah di loteng (penyelamatan tomat) </li><li>  pesan tentang alamat mac "asing / baru" di jaringan </li><li>  pesan tentang konsumsi air yang tinggi (dalam waktu tertentu) </li></ul><br><h2>  Tahap 7: masa depan </h2><br>  Pengukur digital dibeli di aliexpress dengan output rs232 dalam bentuk USB.  Tetapi sementara dia tidak bertengkar dengan dia, dia tidak menanggapi paket.  Kami akan berpikir lebih jauh.  Saya berharap untuk memeras. <br><br>  Saya berencana untuk membeli relai kontrol katup bola (katup itu sendiri sudah ada) untuk kendali jarak jauh katup dan kemungkinan penerapan pematian air secara otomatis tanpa adanya rumah. <br><br>  Entah bagaimana mengintegrasikan meter gas digital gallus ke sirkuit untuk memberi tahu setoran berjalan. <br><br><h3>  Akhirnya, beberapa grafik: </h3><br><img src="https://habrastorage.org/getpro/habr/post_images/802/69c/2a6/80269c2a692b6c6ae3468404b106fbd7.png" alt="gambar"><br><img src="https://habrastorage.org/getpro/habr/post_images/fe6/6ae/85f/fe66ae85fdeb1184ed5a11a141a78d11.png" alt="gambar"><br><img src="https://habrastorage.org/getpro/habr/post_images/9b6/68b/a9a/9b668ba9a480320da3ad48dfab0b56fa.png" alt="gambar"><br><img src="https://habrastorage.org/getpro/habr/post_images/896/aa8/da6/896aa8da673ed49a69f28d4a4f39942b.png" alt="gambar"></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id446864/">https://habr.com/ru/post/id446864/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id446852/index.html">TEMPEST dan EMSEC: Apakah mungkin menggunakan gelombang elektromagnetik dalam serangan dunia maya?</a></li>
<li><a href="../id446854/index.html">Laboratorium teknologi Azure, 11 April di Moskow</a></li>
<li><a href="../id446858/index.html">Cara menggunakan SAP HANA: parsing metode yang berbeda</a></li>
<li><a href="../id446860/index.html">Sejarah 3dfx Voodoo1</a></li>
<li><a href="../id446862/index.html">Apa yang Diharapkan Desainer pada DUMP-2019: Tinjauan Umum Bagian Desain</a></li>
<li><a href="../id446866/index.html">Sistem Operasi: Tiga Potongan Mudah. Bagian 2: Abstraksi: Proses (terjemahan)</a></li>
<li><a href="../id446870/index.html">Sistem partikel: kisah Natal</a></li>
<li><a href="../id446872/index.html">Menjelajahi OpenCV pada StereoPi: Kedalaman Peta dari Video</a></li>
<li><a href="../id446876/index.html">Moskow, 18 April - QIWI SERVER PARTY 4.0</a></li>
<li><a href="../id446880/index.html">Bagan yang salah: pengalaman kami</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>