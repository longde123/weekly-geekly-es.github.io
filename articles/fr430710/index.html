<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ§‘ğŸ¼â€ğŸ¤â€ğŸ§‘ğŸ» ğŸ‘©ğŸ¼â€ğŸ“ ğŸ™‹ğŸ¼ Que faire si le Black Friday est demain et que vos serveurs ne sont pas prÃªts ğŸ‘¨ğŸ¾â€ğŸ’» ğŸ§‘ğŸ¾â€ğŸ¤â€ğŸ§‘ğŸ¼ ğŸ”¨</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pour ceux qui se sont lancÃ©s dans le marketing ou qui se sont lancÃ©s dans le courant, le Â«Black FridayÂ» est un battage mÃ©diatique, des commandes folle...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Que faire si le Black Friday est demain et que vos serveurs ne sont pas prÃªts</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/southbridge/blog/430710/">  Pour ceux qui se sont lancÃ©s dans le marketing ou qui se sont lancÃ©s dans le courant, le Â«Black FridayÂ» est un battage mÃ©diatique, des commandes folles et des foules de clients. <br><br>  Il est bon de prÃ©parer lâ€™infrastructure Ã  lâ€™afflux Ã  lâ€™avance, mais Ã  qui pensons-nous de telles choses Ã  lâ€™avance?  Mais parfois, la dÃ©cision de participer est prise la veille. <br><br>  Ainsi, la fÃªte du consumÃ©risme a commencÃ©, les serveurs de la boutique en ligne commencent Ã  clignoter joyeusement, le centre d'appels surchauffe et les services de livraison proposent la livraison quelque part en janvier. <br>  Que faire, se dÃ©tendre et regarder le fakap philosophiquement ou se battre courageusement? <br><br><img src="https://habrastorage.org/webt/ue/-w/8b/ue-w8bfnunh48ekqvwsgloqmfvs.jpeg"><br><a name="habracut"></a><br>  J'ai accompagnÃ© l'infrastructure des serveurs des boutiques en ligne pendant le Black Friday, et je n'ai jamais Ã©tÃ© contactÃ© Ã  l'avance ni donnÃ© le temps de me prÃ©parer.  Je partage mon expÃ©rience avec ceux qui recevront la mÃªme commande aujourd'hui. <br><br>  (Vous avez de la chance si vous pouvez le faire correctement, c'est-Ã -dire mettre en place une surveillance en quelques mois, analyser le trafic, les goulots d'Ã©tranglement, l'architecture du projet, effectuer des tests de rÃ©sistance, si nÃ©cessaire, reconstruire l'architecture avec les dÃ©veloppeurs, connecter Ã  l'avance des capacitÃ©s de serveur supplÃ©mentaires.  nous parlerons de la bonne approche une autre fois, ici sur les mesures d'incendie). <br><br><h2>  Nous mettons en place un suivi </h2><br>  Je pense que la surveillance est primordiale dans tous les cas.  Il y aura toujours des problÃ¨mes, mais grÃ¢ce aux programmes de surveillance, vous pouvez comprendre oÃ¹ se trouvent maintenant les goulots d'Ã©tranglement. <br><br>  Si possible, j'utilise des solutions comme Zabbix / Prometheus / ELK (selon l'architecture), sinon, je connecte rapidement le SaaS comme okmeter.io.  MÃªme si la vente ne dure qu'une journÃ©e, vous ne pourrez pas regarder un tas d'indicateurs sur un moniteur comme un jour zoulou de suite. <br><br>  Les excellents outils sont encore blackfire.io/newrelic.com pour le profilage, pinba.org pour l'analyse des pages de "ralentissement" en gÃ©nÃ©ral. <br><br>  blackfire / newrelic vous aidera Ã  trier le problÃ¨me sur une page particuliÃ¨re, pinba vous aidera Ã  voir quelles pages sont chargÃ©es le plus souvent et s'exÃ©cutent le plus longtemps (tout cela est sorti de la boÃ®te dans Bitrix, par exemple, mais essayez d'aller dans son panneau d'administration et d'y travailler lorsque le serveur et le site est dÃ©jÃ  trÃ¨s mauvais). <br><br><h2>  Coupez l'excÃ©dent </h2><br>  Je dÃ©sactive tout ce qui peut Ãªtre dÃ©sactivÃ©: des modules inutiles sous condition pour le moment, toutes sortes de jolies choses, etc. <br><br>  La vente est un processus simple, une grande remise sur un certain nombre de produits.  Un visiteur aux yeux brÃ»lants veut choisir un produit jusqu'Ã  ce qu'il soit Ã©puisÃ©, passer une commande, recevoir une remise, effectuer un paiement. <br>  S'abonner Ã  la newsletter, s'inscrire sur le site, interroger sur la qualitÃ© de service - tout cela ne intÃ©resse plus le client maintenant, ces modules peuvent Ãªtre dÃ©sactivÃ©s ou simplifiÃ©s.  Je dÃ©sactive tout sans quoi le site peut fonctionner tranquillement pendant quelques jours. <br><br>  Un exemple de pratique: pendant le Black Friday, j'ai dÃ©boguÃ© sur un serveur en cours d'exÃ©cution sous beaucoup de trafic, et aprÃ¨s 2 heures, il s'est avÃ©rÃ© que le module de service de livraison est extrÃªmement lent, qui accÃ¨de aux services externes et calcule automatiquement le coÃ»t de livraison pour chaque commande.  Lorsque le trafic a augmentÃ© des centaines de fois, ces services externes ont tout simplement cessÃ© de fonctionner. <br><br>  Vous pouvez simplement vous asseoir et rÃ©flÃ©chir, et qu'est-ce qui pourrait tomber sur votre site / dans une application mobile / etc? <br><br><h2>  Laisser tomber </h2><br>  Je me prÃ©pare au fait que tout service tombera de toute faÃ§on.  Dans ce cas, vous devez montrer au moins quelque chose aux visiteurs. <br><br>  Par exemple, un module de service de livraison non fonctionnel ou un formulaire de paiement ne doivent pas bloquer la totalitÃ© de la commande, l'utilisateur peut revenir demain et finaliser sa commande. <br><br>  Sur les pages des erreurs des annÃ©es 50, je montre le mail ou le numÃ©ro de tÃ©lÃ©phone du service commercial. <br><br><pre><code class="plaintext hljs">error_page 500 502 503 504 /50x.html; location = /50x.html { root /srv/www/yourwebsite.com/htdocs/sale-contacts/; }</code> </pre> <br><h2>  Monter une copie du site </h2><br>  S'il est possible d'avoir une copie du site pour tester les changements, c'est trÃ¨s bien.  Je ne parle pas d'un systÃ¨me de dÃ©ploiement Ã©tabli :) <br><br>  Soit dit en passant, les services cloud Ã  la mode vous permettront de faire rapidement et facilement une copie du serveur de combat. <br><br>  Ã‰tude de cas: un site, dont j'ai aidÃ© Ã  maintenir l'infrastructure pendant le Black Friday, aprÃ¨s optimisation par les dÃ©veloppeurs (partiellement en dÃ©placement), ajout de ressources, optimisation des logiciels, a commencÃ© Ã  fonctionner plus ou moins bien avec un trafic important, mais toujours beaucoup ralenti lors de la commande.  Les utilisateurs pensaient que les commandes n'Ã©taient pas envoyÃ©es et, au cas oÃ¹, ils auraient appuyÃ© plusieurs fois sur le bouton de paiement.  Plusieurs personnages ont appuyÃ© sur le bouton 300 fois!  Excellent test de rÃ©sistance :) Des centaines de fois plus de visiteurs et quelque 300 commandes de plus!  :) <br><br><h2>  Services CDN </h2><br>  Vous pouvez vous passer de CDN, mais si les serveurs ne peuvent objectivement pas faire face au retour de la bonne quantitÃ© de statique, c'est nÃ©cessaire. <br><br>  Vous pouvez rapidement connecter un CDN pour les CMS populaires tels que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">1C-Bitrix</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Wordpress</a> .  Mais vous ne pouvez pas configurer le CDN sur la route, vous devez faire attention Ã  l'avance. <br><br><h2>  AntidDoS </h2><br>  Je recommande fortement de connecter les services AntiDDoS et assurez-vous d'avancer (sinon, sous une charge soudaine, sans s'adapter au trafic normal, ils peuvent commencer Ã  bloquer les visiteurs lÃ©gitimes). <br><br>  Pendant une certaine pÃ©riode, cela peut Ãªtre fait gratuitement: <br><br><ul><li>  qrator.net, 10 jours gratuits si vous avez Bitrix - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://www.1c-bitrix.ru/ddos/</a> </li><li>  DDoS-Guard, il y a un tarif gratuit - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://ddos-guard.net/en/store/web</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">cloudflare.com</a> , il y a un tarif gratuit (mais ici je recommande au moins le premier tarif payÃ©, et rappelez-vous que leurs adresses IP sont souvent bloquÃ©es en FÃ©dÃ©ration de Russie) </li></ul><br><h2>  Ajouter des capacitÃ©s de serveur </h2><br>  Nous prÃ©voyons la possibilitÃ© d'ajouter des ressources.  Il sera possible d'ajouter des ressources au serveur principal, de crÃ©er un nouveau nÅ“ud pour parallÃ©liser les requÃªtes, un nÅ“ud pour mysql, etc.  Si ce n'est pas vous-mÃªme, un sous-traitant embauchÃ© sur le cÃ´tÃ© vous en remerciera beaucoup. <br>  C'est pratique si votre fournisseur a la capacitÃ© d'hÃ©berger des serveurs physiques et cloud (Selectel.ru, Servers.com). <br><br><h2>  Fuh, allons-y </h2><br>  La chose la plus dangereuse est les premiÃ¨res minutes aprÃ¨s les newsletters.  Le cache n'est pas encore rÃ©chauffÃ©, il y a peu de statistiques, vous ne connaissez toujours pas les capacitÃ©s du systÃ¨me (si vous n'avez pas effectuÃ© de tests sÃ©rieux Ã  l'avance). <br><br><h2>  Quelques configs </h2><br><h4>  Mise en cache dans Nginx </h4><br>  Nous allons crÃ©er un cache de 500 Mo pendant 3 heures pour toutes les pages Ã  l'exception des pages de commande. <br><br><pre> <code class="plaintext hljs">proxy_cache_path /var/cache/nginx levels=1:2 keys_zone=blackfriday_cache:180m max_size=500m inactive=7d; #  blackfriday_cache,  180  proxy_cache_key "$request_method$scheme$host$request_uri"; proxy_cache_use_stale error timeout invalid_header http_500; map $uri $cookie_nocache { #     ,   ; 1 - , 0 -  "/order" "1"; "/bitrix" "1"; default "0"; } location / { .... proxy_hide_header "Set-Cookie"; #       proxy_ignore_headers "X-Accel-Expires"; proxy_ignore_headers "Expires"; proxy_ignore_headers "Cache-Control"; proxy_ignore_headers "Set-Cookie"; add_header X-Cache $upstream_cache_status; ... proxy_no_cache $cookie_nocache; #  ,   map;  1 -   proxy_cache blackfriday_cache; #    proxy_cache_valid 180m; #  180  proxy_cache_valid 404 1m; # 404  -   1  .... proxy_pass http://backend; #     } location @backend { .... #   }</code> </pre> <br>  Beaucoup de matÃ©riel supplÃ©mentaire, liens: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">habr.com/post/124684</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://nginx.org/ru/docs/http/ngx_">nginx.org/ru/docs/http/ngx_http_proxy_module.html</a> </li></ul><br>  Le canal 100 mbit vous permet de donner 12 pages pesant 1 Mo par seconde, c'est 43 mille par heure;  nginx est capable de fournir un tel volume mÃªme sur un serveur peu coÃ»teux. <br><br><h4>  Nous distribuons les demandes sur plusieurs nÅ“uds (le site doit Ãªtre prÃªt Ã  fonctionner avec plusieurs nÅ“uds Web) </h4><br><br><h5>  Via DNS Round-Robin </h5><br><br>  (attention ici, cette mÃ©thode n'est plus correctement prise en charge par de nombreux fournisseurs DNS) <br><br><pre> <code class="plaintext hljs">$ dig lifehacker.ru +short 136.243.37.180 136.243.37.178</code> </pre> <br><br><h5>  Via les amont nginx </h5><br><br><pre> <code class="plaintext hljs">$ cat nginx.conf upstream backend { server backend1.yoursite.com; server backend2.yoursite.com; } server { server_name yoursite.com; location / { proxy_pass http://backend; } } location @backend { .... #   }</code> </pre> <br><br><h5>  Via Cloudflare, Qrator, etc. </h5><br>  Ils ont la possibilitÃ© de dÃ©finir plusieurs backends directement Ã  partir du panneau, la mise Ã  jour de la configuration est gÃ©nÃ©ralement instantanÃ©e. <br><br><h2>  Calmement </h2><br>  Il arrive qu'il soit impossible d'assurer un travail parfait, mais l'essentiel pour les entreprises est que le systÃ¨me fonctionne essentiellement.  Laissez-le ralentir, mais cela devrait permettre aux utilisateurs de passer des commandes, et ne pas appuyer sans cesse sur F5.  Â«MisÃ©rable, inhibiteur, fracture angoissanteÂ», des milliers de clients l'utilisent en mÃªme temps, et ils font, font, passent des commandes, et chacun d'eux est prÃ©cieux.  J'ai vu des exemples oÃ¹ en un jour le magasin a fait un revirement de six mois, et le rÃ©sultat valait tous les nerfs. <br><br>  Des ventes rÃ©ussies pour vous :) </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr430710/">https://habr.com/ru/post/fr430710/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr430700/index.html">Un systÃ¨me unifiÃ© d'enregistrement des vues de films en ligne commencera Ã  fonctionner en Russie</a></li>
<li><a href="../fr430702/index.html">Formation trÃ¨s Ã©trange</a></li>
<li><a href="../fr430704/index.html">Comment les technologies de l'intelligence artificielle aident les ventes d'avias Ã  se dÃ©velopper: sept exemples</a></li>
<li><a href="../fr430706/index.html">Nouvelle thÃ©orie de l'Ã©volution</a></li>
<li><a href="../fr430708/index.html">Tic Tac Toe Â«Sans FrontiÃ¨resÂ»</a></li>
<li><a href="../fr430712/index.html">NeurIPS: Comment conquÃ©rir la meilleure confÃ©rence ML</a></li>
<li><a href="../fr430714/index.html">VMware achÃ¨te Heptio - qu'est-ce que cela signifie pour Kubernetes</a></li>
<li><a href="../fr430718/index.html">Pour quels objets vaut-il la peine d'utiliser la vidÃ©osurveillance dans le cloud?</a></li>
<li><a href="../fr430720/index.html">Intel RealSense D435i: petite mise Ã  jour et courte digression historique</a></li>
<li><a href="../fr430722/index.html">Performances PHP: planification, profilage, optimisation</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>