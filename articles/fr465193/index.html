<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üôçüèæ üé™ üèïÔ∏è Construire un projet Android dans un conteneur Docker üòπ üë®üèª ‚èØÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Lors du d√©veloppement d'un projet pour la plateforme Android, m√™me le plus petit, t√¥t ou tard, doit faire face √† l'environnement de d√©veloppement. En ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Construire un projet Android dans un conteneur Docker</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/465193/"> Lors du d√©veloppement d'un projet pour la plateforme Android, m√™me le plus petit, t√¥t ou tard, doit faire face √† l'environnement de d√©veloppement.  En plus du SDK Android, vous avez besoin de la derni√®re version de Kotlin, Gradle, plateforme-tools, build-tools.  Et si sur la machine du d√©veloppeur toutes ces d√©pendances sont r√©solues dans une plus grande mesure en utilisant l'IDE Android Studio, alors sur le serveur CI / CD, chaque mise √† jour peut se transformer en mal de t√™te.  Et si dans le d√©veloppement Web, Docker est devenu la solution standard au probl√®me d'environnement, alors pourquoi ne pas essayer de r√©soudre un probl√®me similaire avec lui dans le d√©veloppement Android ... <br><a name="habracut"></a><br>  Pour ceux qui ne savent pas ce qu'est Docker - si c'est assez simple, alors c'est un soi-disant outil de cr√©ation.  "Conteneurs" contenant le noyau minimum du syst√®me d'exploitation et l'ensemble de logiciels n√©cessaire, que nous pouvons d√©ployer o√π nous voulons, tout en pr√©servant l'environnement.  Ce qui sera exactement dans notre conteneur est d√©fini dans le Dockerfile, qui est ensuite assembl√© en une image lanc√©e n'importe o√π et poss√©dant la propri√©t√© idempotency. <br><br>  Le processus d'installation et les bases de Docker sont parfaitement d√©crits sur son <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">site officiel</a> .  Par cons√©quent, un peu en avance, nous avons ici un tel Dockerfile <br><br><pre><code class="plaintext hljs"># ..     Android-  Gradle, #        Docker- #            Gradle FROM gradle:5.4.1-jdk8 #       Android SDK  #     ENV SDK_URL="https://dl.google.com/android/repository/sdk-tools-linux-3859397.zip" \ ANDROID_HOME="/usr/local/android-sdk" \ ANDROID_VERSION=28 \ ANDROID_BUILD_TOOLS_VERSION=28.0.3 #  ,   SDK   , #     RUN mkdir "$ANDROID_HOME" .android \ &amp;&amp; cd "$ANDROID_HOME" \ &amp;&amp; curl -o sdk.zip $SDK_URL \ &amp;&amp; unzip sdk.zip \ &amp;&amp; rm sdk.zip \ #          #  .  .  Android    #          #      #    &amp;&amp; mkdir "$ANDROID_HOME/licenses" || true \ &amp;&amp; echo "24333f8a63b6825ea9c5514f83c2829b004d1" &gt; "$ANDROID_HOME/licenses/android-sdk-license" \ &amp;&amp; echo "84831b9409646a918e30573bab4c9c91346d8" &gt; "$ANDROID_HOME/licenses/android-sdk-preview-license" #   SDK   build-tools, platform-tools RUN $ANDROID_HOME/tools/bin/sdkmanager --update RUN $ANDROID_HOME/tools/bin/sdkmanager "build-tools;${ANDROID_BUILD_TOOLS_VERSION}" \ "platforms;android-${ANDROID_VERSION}" \ "platform-tools"</code> </pre> <br>  Nous l'enregistrons dans le dossier avec notre projet Android et d√©marrons l'assemblage du conteneur avec la commande <br><br><pre> <code class="bash hljs">docker build -t android-build:5.4-28-27 .</code> </pre> <br>  L' <i>option -t</i> sp√©cifie la balise ou le nom de notre conteneur, qui se compose g√©n√©ralement de son nom et de sa version.  Dans notre cas, nous l'avons appel√© android-build, et dans la version, nous avons sp√©cifi√© un ensemble de versions de gradle, android-sdk et platform-tools.  √Ä l'avenir, il nous sera plus facile de rechercher l'image dont nous avons besoin par son nom en utilisant cette ¬´version¬ª. <br><br>  Une fois l'assembly pass√©, nous pouvons utiliser notre image localement, nous pouvons la t√©l√©charger avec la <i>commande docker push</i> vers un r√©f√©rentiel d'images public ou priv√© pour la t√©l√©charger sur d'autres machines. <br><br>  Par exemple, nous collectons le projet localement.  Pour ce faire, ex√©cutez la commande dans le dossier du projet <br><br><pre> <code class="bash hljs">docker run --rm -v <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$PWD</span></span></span><span class="hljs-string">"</span></span>:/home/gradle/ -w /home/gradle android-build:5.4.1-28-27 gradle assembleDebug</code> </pre> <br>  Voyons ce que cela signifie: <br><br>  <i>docker run</i> - la commande de lancement d'image elle-m√™me <br>  <i>-rm</i> - signifie qu'apr√®s l'arr√™t du conteneur, il supprime derri√®re lui tout ce qui a √©t√© cr√©√© au cours de sa vie <br>  <i>-v "$ PWD": / home / gradle /</i> - monte le dossier actuel avec notre projet Android dans le dossier interne du conteneur / home / gradle / <br>  <i>-w / home / gradle</i> - d√©finit le r√©pertoire de travail du conteneur <br>  <i>android-build: 5.4.1-28-27</i> - le nom de notre conteneur que nous avons collect√© <br>  <i>gradle assembleDebug</i> - en fait l'√©quipe de construction qui construit notre projet <br><br>  Si tout se passe bien, apr√®s quelques secondes / minutes, vous verrez sur votre √©cran quelque chose comme <b>CONSTRUIRE R√âUSSI en 8m 3s</b> !  Et dans le dossier app / build / output / apk sera l'application assembl√©e. <br><br>  De la m√™me mani√®re, vous pouvez effectuer d'autres t√¢ches gradle - v√©rifier le projet, ex√©cuter des tests, etc.  Le principal avantage est que si vous avez besoin de construire le projet sur une autre machine, nous n'avons pas besoin de nous soucier de l'installation de l'environnement complet et il suffira de t√©l√©charger l'image n√©cessaire et d'ex√©cuter l'assemblage. <br><br>  Le conteneur ne stocke aucune modification et chaque assemblage part de z√©ro, ce qui garantit d'une part l'identit√© de l'assemblage quel que soit l'endroit o√π il a √©t√© lanc√©, d'autre part, chaque fois que vous devez t√©l√©charger toutes les d√©pendances et recompiler √† nouveau tout le code, ce qui peut parfois prendre un temps consid√©rable.  Par cons√©quent, en plus du d√©marrage "√† froid" habituel, nous avons la possibilit√© de d√©marrer l'assemblage tout en conservant ce que l'on appelle.  "Cache", o√π nous enregistrons le dossier ~ / .gradle simplement en le copiant dans le dossier de travail du projet, et au d√©but de la prochaine g√©n√©ration nous le renvoyons.  Nous avons mis toutes les proc√©dures de copie dans des scripts s√©par√©s et la commande de lancement elle-m√™me a commenc√© √† ressembler √† ceci <br><br><pre> <code class="bash hljs">docker run --rm -v <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$PWD</span></span></span><span class="hljs-string">"</span></span>:/home/gradle/ -w /home/gradle android-build:5.4.1-28-27 /bin/bash -c <span class="hljs-string"><span class="hljs-string">"./pre.sh; gradle assembleDebug; ./post.sh"</span></span></code> </pre> <br>  En cons√©quence, le temps moyen de montage du projet pour nous a √©t√© r√©duit plusieurs fois (en fonction du nombre de d√©pendances sur le projet, mais le projet moyen a donc commenc√© √† se monter en 1 minute au lieu de 5 minutes). <br><br>  Tout cela en soi n'a de sens que si vous avez votre propre serveur CI / CD interne, dont vous √™tes vous-m√™me le support.  Mais maintenant, il existe de nombreux services cloud dans lesquels tous ces probl√®mes ont √©t√© r√©solus et vous n'avez pas √† vous en soucier et vous pouvez √©galement sp√©cifier les propri√©t√©s d'assemblage n√©cessaires dans les param√®tres du projet. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr465193/">https://habr.com/ru/post/fr465193/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr465181/index.html">Endroits glissants en C ++ 17</a></li>
<li><a href="../fr465185/index.html">Nouvelles normes de vid√©osurveillance: couleur la nuit, anti-bruit, ePoE</a></li>
<li><a href="../fr465187/index.html">6 phrases en anglais pouvant √™tre utilis√©es dans les n√©gociations salariales avec des entreprises √©trang√®res</a></li>
<li><a href="../fr465189/index.html">√âquipe de d√©veloppement Workflow One Sprint</a></li>
<li><a href="../fr465191/index.html">Formation Cisco 200-125 CCNA v3.0. Jour 25. √âtude approfondie de l'IPv6</a></li>
<li><a href="../fr465203/index.html">√âl√©phant d'entreprise</a></li>
<li><a href="../fr465209/index.html">Nous apprenons les donn√©es du passeport d'une personne par son nom (s'il y a une garantie)</a></li>
<li><a href="../fr465211/index.html">√âchapper au fourr√© des tests: cr√©er un raccourci d'un appareil vers une assertion</a></li>
<li><a href="../fr465215/index.html">Que lire chef d'√©quipe et station-service: une s√©lection de 50 livres avec notes et plus</a></li>
<li><a href="../fr465217/index.html">Acronis True Image 2020: nouveaux sch√©mas de r√©plication et protection am√©lior√©e</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>