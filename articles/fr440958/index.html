<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßîüèª ‚úãüèæ üå≥ Comment j'ai essay√© de corriger une recherche de carte pour les pilotes. 2e partie üé£ ‚õèÔ∏è üêá</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="La premi√®re chose que je veux dire, c'est que c'√©tait difficile. Beaucoup plus difficile que je ne le pensais. J'ai eu avant cette exp√©rience tr√®s dif...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comment j'ai essay√© de corriger une recherche de carte pour les pilotes. 2e partie</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/440958/">  La premi√®re chose que je veux dire, c'est que c'√©tait difficile.  Beaucoup plus difficile que je ne le pensais.  J'ai eu avant cette exp√©rience tr√®s difficile en apportant des produits √† sortir au travail, mais je n'ai jamais atteint pour des projets personnels.  Ils se sont tous termin√©s avec des prototypes de degr√©s de d√©go√ªt diff√©rents, mais celui-ci semblait survivre.  Pour le moment, il a √©t√© lanc√© pour plus de 80 pays (toute l'Europe, l'Asie et l'Am√©rique du Nord), sur les deux plates-formes mobiles, et √† la fin de l'article, il y aura des liens de t√©l√©chargement - par cons√©quent, j'invite toutes les personnes int√©ress√©es √† essayer, casser et gronder. <br><img src="https://habrastorage.org/webt/bf/sb/yn/bfsbyn-oz8mgre0bdzet4a_k33c.png"><br>  Voici une br√®ve r√©flexion avec laquelle tout a commenc√©: <i>√Ä mon avis, une recherche sur les cartes mobiles existantes est effectu√©e pour les pi√©tons et ne fonctionne pas du tout pour les conducteurs.</i>  <i>Vous devez vous arr√™ter, vous plonger dans les cartes jonch√©es d'informations et de publicit√©s excessives, piquer de petites ic√¥nes.</i>  <i>Ce n'est pas pratique, cela ne vous aidera pas dans un endroit inconnu, au final c'est juste dangereux.</i>  <i>Une solution intuitive et propre est n√©cessaire qui ne distrait pas et ne vous fasse pas ralentir.</i> <i><br></i> <br>  Dans la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">premi√®re partie,</a> j'ai d√©crit mon cheminement de cette simple pens√©e √† une solution de travail, puis je d√©crirai comment j'ai fait glisser cette solution vers la version. <br><a name="habracut"></a><br>  Pour gagner du temps, je vais commencer par une br√®ve relecture de la partie pr√©c√©dente: l√† j'√©cris qu'au lieu de chercher j'ai d√©cid√© d'utiliser la num√©risation en mouvement, et l'interface de l'application a √©t√© simplifi√©e autant que possible.  Au lieu d'une ligne d'entr√©e absurde pour le conducteur, il a ajout√© plusieurs gros boutons pour les choses qui peuvent √™tre utiles sur la route: station-service, recharge, guichet automatique, parking, pharmacie.  Au lieu d'une carte, j'ai fait une liste et lorsque je s√©lectionne un r√©sultat, la navigation dans Apple / Google Maps s'ouvre.  Pour l'application, j'ai d√©cid√© d'utiliser Flutter (en m√™me temps que j'ai rencontr√© quel genre de b√™te c'√©tait), j'ai pris les donn√©es d'OpenStreetMap.  J'ai termin√© mon histoire sur le fait qu'un prototype plus ou moins sain d'esprit √©tait pr√™t. <br><br>  Ensuite, cela a pris environ 4 √† 5 mois, puis les changements dans la vie ont commenc√© et le projet a √©t√© abandonn√© - et j'ai commenc√© √† m'en lasser.  Un mois plus tard, je l'ai d√©poussi√©r√©, rafra√Æchi dans ma t√™te en √©crivant un article sur un hub et j'ai d√©cid√©: finissons-le.  Quiconque conna√Æt la diff√©rence entre un prototype et un produit sourira tristement √† cet endroit. <br><br>  Ce qui s'est pass√© ensuite a pris encore quatre mois.  Je me suis procur√© un tracker de t√¢ches, en termes g√©n√©raux form√© une liste de probl√®mes, collect√© des appareils pour les tests.  Le soir et le week-end, je me suis assis au travail et j'ai fait avancer le projet.  √Ä quels moments il semblait que la liste ne faisait que s'allonger, et je me noyais dans des nuances et des finitions infinies.  Il se prit en main, jeta quelque chose, quelque part au contraire poussa au perfectionnisme.  Ensuite, je vais essayer de parler des points les plus int√©ressants dans le d√©veloppement d'un projet aussi simple en apparence. <br><br><h2>  La technologie </h2><br><h4>  Architecture g√©n√©rale </h4><br>  Quelque part au milieu de l'≈ìuvre, un sentiment a commenc√© √† appara√Ætre que l'architecture se r√©pandait de fa√ßon incontr√¥lable.  Trop de composants et de connexions ont √©t√© rompus, plusieurs goulots d'√©tranglement ont √©t√© recherch√©s.  Heureusement, le projet est petit et je l'ai ressenti √† temps, donc mettre les choses en ordre n'a pas √©t√© difficile.  Au niveau des composants individuels, cela se r√©sumait √† une refactorisation et √† la suppression des biblioth√®ques inutiles; au niveau mondial, j'ai √©tendu la fonctionnalit√© √† 3 petits serveurs que j'ai d√©marr√©s dans <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">DigitalOcean</a> . <br><br><ol><li>  <i>Serveur API</i> (Python) - le serveur principal, nous nous tournons vers lui.  Il n'y a pas beaucoup de logique, principalement la formation de r√©sultats pour la sortie.  Le plus √©conomique en termes de ressources. </li><li>  <i>Serveur √©lastique</i> (Java) - Elasticsearch et Photon (g√©ocodeur open source) tournent dessus.  Ils utilisent le m√™me index dans lequel la plan√®te enti√®re est import√©e d'OpenStreetMap.  Fonctions serveur: recherche de lieux par d√©charge et g√©ocodeur.  De par sa nature, l'√©lastique est tr√®s rapide et l√©ger, donc le serveur n'est pas non plus tr√®s gras. <br></li><li>  <i>Un serveur g√©o</i> (Node) est le plus difficile de tous.  Bas√© sur l'Open Source Routing Machine, j'ai √©crit une petite API, et ses t√¢ches incluent tous les calculs g√©ographiques: pose d'itin√©raires, calcul d'isochrones et g√©n√©ration de tuiles.  Chaque op√©ration individuelle n'est pas tr√®s ing√©nieuse, mais des dizaines d'entre elles sont n√©cessaires pour toute recherche, et cela devient un goulot d'√©tranglement.  Pour le moment, sur ce serveur 16 Go de RAM, et en g√©n√©ral, tout fonctionne en une fraction de seconde - sauf pour g√©n√©rer des tuiles.  Lorsqu'il y en a beaucoup dans la file d'attente, vous pouvez attendre des photos avec des cartes en quelques secondes.  Heureusement, ils apparaissent sur le client de mani√®re asynchrone, et cela ne g√¢che pas beaucoup l'image globale (j'esp√®re). <br></li></ol><br>  De plus, j'ai d√©cid√© d'alimenter les extraits d'OpenStreetMap pour les g√©o-calculs s√©par√©ment par pays.  Cela fonctionne comme ceci: nous faisons la premi√®re demande de coordonn√©es √† notre g√©ocodeur, il d√©termine le pays, puis nous prenons les fichiers t√©l√©charg√©s uniquement de ce pays pour les manipulations dont nous avons besoin.  Cela est n√©cessaire, car m√™me mon serveur plut√¥t puissant n'est pas en mesure de convertir l'extrait de plus de deux gigaoctets - le processus consomme rapidement toute la m√©moire et s'√©touffe.  Heureusement, presque tous les pays entrent dans cette limite, √† l'exception des √âtats-Unis: ce monstre a d√ª √™tre divis√© en √âtats.  Enfin, pour maintenir une centaine et demi d'extraits, j'ai d√©cid√© d'√©crire un tas de scripts qui v√©rifient leur sant√©, leur r√©paration et leur mise √† jour. <br><br><img src="https://habrastorage.org/webt/a4/p1/q5/a4p1q5quwoshyq34ptpfyoxllia.png"><br><br>  En g√©n√©ral, tout cela semble plus compliqu√© que cela ne fonctionne dans la pratique.  En principe, je suis satisfait de la solution qui en r√©sulte - elle a une bonne r√©serve de mise √† l'√©chelle en fonction du nombre de territoires pris en charge et du niveau de charge. <br><br><h4>  Isochron dynamique </h4><br>  Pendant longtemps, l'un des probl√®mes cl√©s pour moi a √©t√© la densit√© h√©t√©rog√®ne des r√©sultats.  La raison est tout √† fait compr√©hensible - c'est la densit√© h√©t√©rog√®ne du r√©seau routier lui-m√™me et des b√¢timents qui le composent.  Dans une ville de taille moyenne dans un rayon de 5 minutes, il peut y avoir 2-3 distributeurs automatiques de billets, et maintenant nous allons nous d√©placer au centre de la m√©tropole - et pour les m√™mes 5 minutes, il peut y avoir 20 ou 30 r√©sultats.  Enfin, nous sautons dans la campagne et observons un r√©sultat presque garanti jusqu'√† ce que nous nous rapprochions de la ville et que le rayon de recherche capture quelque chose. <br><br>  Ce probl√®me donne une charge non lin√©aire et impr√©visible sur le serveur, et surtout - une exp√©rience plut√¥t moche pour l'utilisateur.  L'ajout d'un filtre aux options (5 minutes, 10 minutes, 30 minutes) ne r√©sout fondamentalement rien.  Dans le village, m√™me un rayon de 30 minutes peut ne rien rapporter, mais dans une m√©galopole, m√™me 5 minutes vous accableront de r√©sultats.  De plus, nous avons ajout√© des fonctionnalit√©s suppl√©mentaires aux boutons dont le conducteur devrait se d√©placer.  En g√©n√©ral, non-sens, vous avez besoin d'une solution fondamentalement diff√©rente. <br><br>  Lorsqu'une solution a √©t√© trouv√©e, elle s'est av√©r√©e tr√®s simple.  Au lieu d'aller √† l'oppos√© et d'inviter l'utilisateur √† s√©lectionner un rayon de recherche, nous pouvons rendre ce rayon automatique.  La logique est en fait √©l√©mentaire: <br><br><ol><li>  Vous d√©finissez des limites sur les r√©sultats - par exemple, au moins 1 et pas plus de 20 - et commencez par 10 minutes <br></li><li>  Faites une recherche par lieu.  Jusqu'√† pr√©sent, nous n'avons pas besoin d'obtenir des directions pour eux, nous avons donc juste besoin de calculer l'isochrone et de filtrer par polygone dans l'√©lastique - les deux op√©rations sont tr√®s bon march√© <br></li><li>  Si le nombre de r√©sultats s'√©chappe dans une direction des limites (dans notre cas 0 ou 20+), divisez ou multipliez le temps par 2 et recommencez la recherche.  S'il est inclus dans la limite, alors nous construisons d√©j√† des itin√©raires, trions par temps, etc. <br></li></ol><br>  En fait, c'est un peu plus compliqu√© et il y a quelques nuances, par exemple, un r√©seau urbain ultra-dense, alors que nous avons d√©j√† r√©duit le temps au minimum, et qu'il y a encore trop de r√©sultats.  Ici, il est d√©j√† n√©cessaire de trier, et donc de tracer des itin√©raires, ce qui est un peu cher.  Cependant, ce sont des cas extr√™mes et ils ne sont pas tr√®s frappants. <br><br>  En r√©alit√©, il est peu probable qu'une personne fasse d√©filer la liste en dessous de 5-6 positions, donc dans 95% des sc√©narios, l'isochron dynamique a r√©solu le probl√®me.  Nous avons supprim√© le goulot d'√©tranglement - une quantit√© impr√©visible de r√©sultats - et rendu la charge sur le serveur g√©ographique pour toute demande presque plate.  Le v√©rifier est tr√®s simple: <br><br>  <i>√Ä l'ancienne: prenez un rayon de 10 minutes et 30 r√©sultats</i> <i><br></i>  <i>R√©sultat: 1 demande d'isochron + 30 demandes d'itin√©raires = <b>31</b></i> <i><br><br></i>  <i>Nouvelle fa√ßon: v√©rifiez, 30 r√©sultats sont nombreux, divisez le rayon en deux, maintenant nous obtenons 10 r√©sultats</i> <i><br></i>  <i>R√©sultat: 2 demandes d'isochrone + 10 demandes d'itin√©raires = <b>12</b></i> <br><br><img src="https://habrastorage.org/webt/ta/ry/bs/tarybsvzvwhjow7ak13dgmcda60.png"><br><br><h4>  Nouvelle logique de carte </h4><br>  Dans la derni√®re partie, j'ai d√©crit le m√©canisme de g√©n√©ration de cartes avec des itin√©raires pos√©s.  Il s'est ensuite av√©r√© assez compliqu√© et co√ªteux en informatique, mais je les aimais tellement que j'ai d√©cid√© de les quitter.  En m√™me temps, j'ai compris que sous leur forme actuelle, ils n'avaient que peu d'avantages pratiques - ils ne savaient pas clairement dans quelle direction vous alliez, et ils √©taient tous orient√©s vers le nord.  Il fallait affiner. <br><br>  La premi√®re chose que j'ai d√©cid√© de faire a √©t√© de d√©ployer les cartes en temps r√©el √† l'aide d'une boussole.  En flottement, cela a √©t√© d√©crit par la logique microscopique et a fonctionn√© tr√®s rapidement, cependant, avec plus de 10 r√©sultats qui tournent constamment, les performances ont commenc√© √† s'√©goutter.  De plus, cela avait l'air absolument √©coeurant: en fait, des images statiques tournaient, et c'√©tait plus d√©routant pendant le trajet que cela ne l'aidait en quelque sorte. <br><br>  L'id√©e suivante √©tait d'indiquer sur les cartes le sens de d√©placement de la fl√®che.  C'√©tait tr√®s simple - j'avais d√©j√† un vecteur calcul√©, et tout ce que j'avais √† faire √©tait de g√©n√©rer une forme g√©om√©trique de la fl√®che.  Dans le m√™me temps, dans une position statique, les cartes ont continu√© √† indiquer la position du conducteur avec un marqueur rond.  Il y avait une mise en garde - il √©tait n√©cessaire de normaliser les tailles des marqueurs et des fl√®ches pour diff√©rents niveaux de zoom.  Cela semble √™tre une t√¢che simple, mais j'ai √©t√© coinc√© dessus pendant longtemps.  La chose √©tait la suivante: j'ai g√©n√©r√© tous les symboles sur la carte en m√®tres, et pris comme base la fraction de la hauteur de la carte enti√®re en m√®tres.  Il s'est av√©r√© que lors de la cr√©ation des cartes - d√©termination des bo√Ætes de d√©limitation carr√©es, collage et rognage des tuiles sur celles-ci, etc. - des erreurs se sont accumul√©es, et ces petites erreurs ont finalement conduit √† des tailles de marqueurs visuellement tr√®s diff√©rentes.  La situation des cartes √† petite √©chelle √©tait particuli√®rement infernale.  Je n'entrerai pas dans les d√©tails de la solution, cependant, √† cause de ces erreurs, la logique de g√©n√©ration de carte a d√ª √™tre compl√®tement redessin√©e.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Turf</a> a beaucoup aid√© √† cela - un excellent ensemble d'outils pour manipuler les g√©odonn√©es. <br><br>  Avec les fl√®ches, les cartes √©taient d√©j√† plus utiles, mais il manquait encore quelque chose.  Apr√®s des tests en direct, il est devenu clair que toutes les cartes √©taient retourn√©es vers le nord.  En statique, ce n'√©tait pas frappant, mais cela est imm√©diatement devenu √©vident lorsque vous prenez le volant.  Le conducteur s'attend inconsciemment √† ce que la fl√®che pointe toujours vers le haut lors de la conduite.  Ayant d√©couvert cela, je me suis de nouveau assis pour travailler.  C'√©tait encore une de ces t√¢ches qui semblent tr√®s simples, mais vous passerez quelques jours apr√®s.  Il semblerait - calculer l'azimut et tourner le GeoJSON final avant la pixellisation.  Mais il y avait encore une nuance - ce GeoJSON final a √©t√© g√©n√©r√© par une bo√Æte de d√©limitation directe, et, √©tant tourn√© et recadr√© dessus, il d√©tecte les endroits vides. <br><br><img src="https://habrastorage.org/webt/e8/ru/m-/e8rum-k8gxclkhpgtsk95sdd2sw.png"><br><br>  Dans le diagramme ci-dessus, j'ai donn√© grossi√®rement ma solution.  En cons√©quence, cela s'est av√©r√© peu co√ªteux en termes de ressources et couvrant 99% des sc√©narios (je pense que les bugs vont grimper quelque part pr√®s des p√¥les).  En g√©n√©ral, le serveur de g√©o-calcul est toujours la partie la plus consommatrice de ressources du projet, mais maintenant ses cartes de route, en plus de l'esth√©tique, sont √©galement tr√®s pratiques.  J'ai m√™me essay√© de me rendre sur place en utilisant exclusivement ces cartes, sans compter la navigation.  Et m√™me arriv√©. <br><br><img src="https://habrastorage.org/webt/43/t1/0b/43t10bq_ahbbeizyykpfd4jwl9a.png" width="600"><br><br><h4>  Qualit√© des donn√©es </h4><br>  J'ai pris toutes mes donn√©es de diff√©rentes mani√®res depuis OpenStreetMap.  Comme vous le savez, cette ressource est 100% sans but lucratif et est soutenue par un esprit collectif.  C'est un plus (c'est gratuit et avec une structure claire), c'est aussi un moins - les donn√©es sont tr√®s h√©t√©rog√®nes. <br><br>  √Ä un niveau √©lev√©, cela signifie une couverture in√©gale du globe dans son ensemble: dans les pays et les villes avec un grand nombre de passionn√©s, chaque pelouse et chaque chemin sont d√©crits, et dans d'autres endroits, il y a des zones presque vides avec des objets sommaires de base.  Les donn√©es sont mises √† jour avec exactement la m√™me irr√©gularit√©.  Lors du test de mon application, je suis tomb√© sur plusieurs fois de nouvelles stations-service, des caf√©s et parfois des routes enti√®res que je n'avais pas encore r√©ussi √† mettre sur les cartes.  Se plaindre de cela est stupide: le m√™me Google d√©pense des budgets astronomiques et contient toute une √©quipe de voitures responsables de la pertinence de ses donn√©es.  Ici, le mieux que nous puissions faire est de synchroniser plus souvent avec les extraits d'OpenStreetMap.  Eh bien, je souhaite bonne chance √† leur communaut√©. <br><br>  Mais √† un niveau inf√©rieur, en raison de l'√©dition chaotique des cartes, il existe un certain nombre d'autres probl√®mes qui peuvent √™tre compl√®tement r√©solus.  Cela concerne principalement les donn√©es ind√©sirables et les doublons.  La vari√©t√© de ce g√¢chis est frappante: le m√™me endroit peut √™tre d√©crit 3 fois de diff√©rentes mani√®res, les institutions n'ont pas de noms, les types et les √©tiquettes sont mal inscrits, etc.  Tout cela n'a pas de solution unifi√©e, mais un ensemble de mesures est n√©cessaire pour syst√©matiser le contenu.  Par exemple, j'ai les conditions suivantes: <br><br>  <i>Il existe plusieurs synonymes et variantes de la m√™me balise -&gt; nous d√©crivons des dictionnaires d'alias (par exemple parking, parking_space, parking_entrance, etc.).</i> <i><br><br></i>  <i>Il y a plusieurs endroits avec le m√™me type et les m√™mes coordonn√©es:</i> <i><br><br></i> <ul><li>  si tout le monde n'a pas de nom -&gt; le type de lieu devient le nom </li><li>  un seul a un nom -&gt; prends-le </li><li>  tout le monde a un nom et ils sont diff√©rents -&gt; prendre le nom de famille par ordre chronologique </li></ul><br>  Il y a plusieurs endroits avec le m√™me type et presque les m√™mes coordonn√©es: <br><br><ul><li>  si tout le monde n'a pas de nom -&gt; les doublons les plus probables, nous ne compliquerons pas.  Fusionner en un point avec des coordonn√©es moyennes, dans lequel le type de lieu devient le nom.  Un homme viendra et comprendra </li><li>  un seul a un nom -&gt; la m√™me chose, seulement maintenant nous avons d√©j√† un nom </li><li>  tout le monde a un nom et ils sont diff√©rents -&gt; mais c'est un cluster </li></ul><br>  Le cluster dans notre cas est une carte dans l'en-t√™te dont plusieurs emplacements sont d√©crits.  Le plus souvent, ce sont des grappes de magasins ou de stations-service √† proximit√©.  Ou, par exemple, un guichet automatique est situ√© √† l'int√©rieur du b√¢timent de la banque et l'autre √† l'ext√©rieur.  Ils ne repr√©sentent pas de difficult√© pour nous: nous calculons les coordonn√©es moyennes et tracons l'itin√©raire vers elles.  Dans l'interface, nous le montrons clairement et simplement: <br><br><img src="https://habrastorage.org/webt/ix/ru/jk/ixrujkqilkdxu34qjdsgt8e_pwo.png" width="300"><br><br><h2>  Interface et conception </h2><br>  Il m'est donc arriv√© qu'avant le d√©but du d√©veloppement, j'imagine g√©n√©ralement d√©j√† l'image finale.  En m√™me temps, je n'aime pas dessiner des diagrammes et des concepts, pr√©f√©rant former un design en parall√®le avec des fonctions (si c'est mon projet, bien s√ªr).  Cette approche it√©rative est tr√®s cool d'une part, car elle vous permet de basculer entre les visuels et le code, d'autre part - parfois vous devez tout refaire trop souvent.  La m√™me chose s'est produite ici: il me semble avoir pellet√© l'interface la plus simple cent fois.  √Ä partir de bagatelles telles que des ic√¥nes et des retraits, se terminant par la composition de cartes, de menus, etc.  Je ne d√©crirai pas tout, je passerai rapidement en revue les questions cl√©s.  Si vous n'√™tes pas int√©ress√© par le design, n'h√©sitez pas √† le sauter. <br><br><h4>  Palette de couleurs </h4><br>  Pendant longtemps, je ne pouvais pas comprendre quoi faire avec la palette.  Je voulais vraiment d√©signer les cat√©gories de lieux de diff√©rentes couleurs, √† l'exception du vert - j'ai d√©cid√© de l'enregistrer comme accent.  J'ai choisi des couleurs riches et faciles √† distinguer, tout semble aller bien.  Apr√®s un certain temps, j'ai d√©couvert que le bleu de la station-service fait √©cho au bleu, qui sur la carte indique la position du conducteur.  Il n'a rien fait de tel, l'a laiss√© tel quel - mais le perfectionniste interne n'est pas satisfait. <br><br><img src="https://habrastorage.org/webt/ya/dj/l8/yadjl8ri55axqz9pyzumcah0dfc.png" width="200"><br><br><h4>  ¬´En route¬ª et ¬´Vous √™tes pr√®s¬ª </h4><br>  Apr√®s que la logique soit apparue qui d√©termine la direction du mouvement du conducteur, il est devenu possible de diviser les itin√©raires en ¬´le long du chemin¬ª et le reste.  Comme je l‚Äôai d√©j√† dit, cela est d√©termin√© par le premier segment de l‚Äôitin√©raire trac√© √† l‚Äôendroit: co√Øncide-t-il avec le dernier segment de l‚Äôitin√©raire du conducteur.  Si oui, alors nous allons d√©j√† √† cet endroit.  Ensuite, la question s'est pos√©e de savoir comment afficher cela dans l'interface.  En plus des changements dans la carte que j'ai d√©crits ci-dessus, l'id√©e est venue de la plaque ¬´On the way¬ª (ou ¬´En route¬ª en anglais - il semble qu'ils signifient la m√™me chose).  Je r√©utilise le m√™me d√© pour un autre sc√©nario: lorsque la distance √† l'endroit trouv√© est inf√©rieure √† 25 m√®tres.  Ensuite, cela n'a aucun sens d'obtenir des directions, je cache la carte et j'√©cris que vous √™tes d√©j√† proche (¬´Vous √™tes pr√®s¬ª / ¬´Regardez autour¬ª). <br><br><img src="https://habrastorage.org/webt/g6/1v/u9/g61vu93sak9y6igur-xaeigyc30.png" width="300"><br><br><h4>  Carte communautaire </h4><br>  Au tout d√©but du d√©veloppement du d√©bogage, j'ai utilis√© une carte statique de Google pour voir l'isochron et les r√©sultats.  Puis il a couru avec elle pendant longtemps, sans savoir o√π s'en tenir: il semble que la carte soit une chose int√©ressante, mais il semble qu'elle ne devrait pas prendre de place.  De plus, douloureusement ne voulait m√™me pas d√©pendre de Google dans une si petite bagatelle.  Donc, √† la fin, j'ai retir√© la carte, mais apr√®s un certain temps, j'ai commenc√© √† g√©n√©rer des cartes d'itin√©raire et j'ai r√©alis√© que j'avais moi-m√™me ¬´√©volu√©¬ª technologiquement vers la grande carte.  Il s'est av√©r√© que ce n'√©tait pas si difficile √† faire, m√™me si jusqu'√† pr√©sent la carte commune reste l'√©l√©ment le plus gourmand en ressources de l'ensemble du projet.  Et pour qu'elle ne prenne pas de place dans l'interface, je mets la carte sur une page s√©par√©e (ils la tireront moins souvent). <br><br><img src="https://habrastorage.org/webt/9k/ks/na/9kksnaanyjsobkxxc1mjmhny25c.png" width="300"><br><br><h4>  Localisation </h4><br>  Pour une production normale en production, la localisation est n√©cessaire.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C'est toujours d'une part un travail tr√®s direct et simple, d'autre part - lorsque vous commencez √† le faire, des foules de cafards rampent de partout. Dans mon cas, le contenu principal d'OSM √©tait d√©j√† localis√©, de sorte qu'il ne restait que les types de place et les √©l√©ments d'interface. √Ä l'exception de quelques bouchons (pendant longtemps je n'ai pas pu formuler un d√© ¬´En route¬ª) tout a √©t√© facile. Il convient de noter que les noms de lieux peuvent occuper √† la fois 2 et 3 lignes et ne peuvent pas </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">entrer</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dans des √©crans de petite largeur - par cons√©quent, le widget </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">auto_size_text a</font></a><font style="vertical-align: inherit;"> aid√© ici </font><font style="vertical-align: inherit;">, je le recommande dans des limites raisonnables. </font></font><br><br><img src="https://habrastorage.org/webt/7z/yx/k3/7zyxk3gbrw0bamnfjf4fmgmysxe.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mais sur le plan technique, ce n'√©tait pas si fluide. √Ä ce jour, presque la seule solution de localisation sous flutter est la biblioth√®que </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Intl_translation</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et elle est ... bizarre. </font><font style="vertical-align: inherit;">Il est clair qu'ils doivent s'asseoir sur deux chaises et g√©n√©rer des formats de ligne compl√®tement diff√©rents pour Android et iPhone. </font><font style="vertical-align: inherit;">Cependant, cette approche consiste √† transf√©rer les traductions dans une classe distincte, puis √† ex√©cuter des scripts √† partir de la console (!) Pour cr√©er des fichiers interm√©diaires, puis √† les manipuler ... Tout cela n'est pas √©vident pour un d√©butant et, surtout, difficile √† maintenir, car chaque modification est accompagn√©e de danses manuelles avec un tambourin. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cependant, il est possible que je ne l'ai pas compris jusqu'au bout - ou peut-√™tre que certains environnements de d√©veloppement le font d√©j√† automatiquement. </font><font style="vertical-align: inherit;">En tout cas, mon exp√©rience a √©t√© assez stressante et j'esp√®re que les m√©canismes de localisation du flutter seront retravaill√©s.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Date de sortie </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En fait, il n'y a rien d'int√©ressant √† dire sur la sortie elle-m√™me. Il y avait de vagues soup√ßons que le Apple Store refuserait de flotter l'application, mais ils ne se sont pas mat√©rialis√©s - tout s'est bien pass√©. J'ai redessin√© l'ic√¥ne et esquiss√© une page d'introduction qui rencontre l'utilisateur pour la premi√®re fois. J'ai d√ª bricoler un peu avec des dessins, mais il semble que rien ne se soit produit. Aucun √©cueil avec des permishens et leur localisation ne sont √©galement apparus.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Au dernier moment, la construction de la version de construction pour Android est tomb√©e en panne en raison de la transition du support √† androidx: certaines biblioth√®ques que j'ai utilis√©es ne le supportaient pas imm√©diatement. </font><font style="vertical-align: inherit;">En cons√©quence, j'ai juste attendu quelques jours, mais nous devons rendre hommage aux auteurs de ces biblioth√®ques - ils les ont r√©par√©s tr√®s rapidement. </font><font style="vertical-align: inherit;">N√©anmoins, cet incident m'a encore une fois convaincu: je ne vais pas encore tra√Æner un grand projet commercial. </font><font style="vertical-align: inherit;">Malgr√© le fait que je l'aimais bien, toute l'histoire est encore tr√®s, tr√®s brute. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eh bien, comme promis, t√©l√©chargez les liens:</font></font><br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/e1/3u/p8/e13up8j3vvrxjqwlpo2n6sfzauy.png" width="150"></a> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/k3/oc/vm/k3ocvm5auzce0x4lwl7p57l5qqe.png" width="150"></a> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Plans </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Et quelques mots √† la fin sur les plans. </font><font style="vertical-align: inherit;">Si cette chose est utile pour quelqu'un d'autre que moi et qu'il y a des t√©l√©chargements, j'ai beaucoup d'id√©es pour un d√©veloppement ult√©rieur. </font><font style="vertical-align: inherit;">Voici un exemple de liste de ce que j'aimerais inclure dans la version n ¬∞ 2:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> plus de donn√©es sur les lieux (par exemple, les prix de l'essence ou les types de charges pour les voitures √©lectriques) </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> th√®me sombre pour les conducteurs de nuit </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mode compact pour voir plus de r√©sultats sans faire d√©filer (par exemple, d√©sactivez la mini-carte si vous le souhaitez) </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> acc√©l√©ration de la cartographie (vous devez vraiment tenir compte de ce goulot d'√©tranglement - soit optimiser en quelque sorte d√©licat, soit transf√©rer vers la virtualisation des conteneurs) </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">J'aimerais soutenir encore plus Android Auto et Apple CarPlay. </font><font style="vertical-align: inherit;">Je n'ai jamais fait de demande pour eux, je suis donc curieux de l'essayer moi-m√™me. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C'est tout, merci √† tous pour votre attention.</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr440958/">https://habr.com/ru/post/fr440958/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr440946/index.html">Rollup: vous pouvez d√©j√† cr√©er des applications</a></li>
<li><a href="../fr440948/index.html">Ne soyez pas intelligent avec les formulaires de connexion</a></li>
<li><a href="../fr440950/index.html">Chrome Audit 500: Partie 1. Atterrissage</a></li>
<li><a href="../fr440954/index.html">Cycle de vie d'un article sur Habr√©: nous √©crivons un habraparser. Deuxi√®me partie</a></li>
<li><a href="../fr440956/index.html">Orchestrateur nomade alternatif sur le bureau</a></li>
<li><a href="../fr440960/index.html">Orange Pi 2G-IOT: carte du champ de mines</a></li>
<li><a href="../fr440962/index.html">Les fournisseurs de communication vont obliger √† conclure des contrats pour la connexion de b√¢timents r√©sidentiels</a></li>
<li><a href="../fr440966/index.html">Connexion des capteurs KELLER √† MATLAB</a></li>
<li><a href="../fr440972/index.html">L'Universit√© Innopolis accueillera la premi√®re √©cole internationale de conception de v√©hicules autonomes de Russie</a></li>
<li><a href="../fr440974/index.html">Casse-t√™te Kotlin, Vol. 2: un nouveau lot de puzzles</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>