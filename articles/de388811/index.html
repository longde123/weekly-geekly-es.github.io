<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🛰️ 🙊 👩🏿‍⚕️ FPV-Rennen auf einem Simulator (wir machen einen USB-Joystick von einer Funkfernbedienung) ⛺️ 🗣️ 👩🏼‍🎤</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Der Winter in den nördlichen Breiten ist die Zeit, in der der FPV-Pilot Zeit hat, eine Pause von Rennen und ständigen Pannen einzulegen, einen Lötkolb...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>FPV-Rennen auf einem Simulator (wir machen einen USB-Joystick von einer Funkfernbedienung)</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/388811/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Winter in den nördlichen Breiten ist die Zeit, in der der FPV-Pilot Zeit hat, eine Pause von Rennen und ständigen Pannen einzulegen, einen Lötkolben zu nehmen und etwas Nützliches für sein Hobby herzustellen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Da es kalt ist, draußen zu fliegen, werden wir die Pilotenfähigkeiten auf Simulatoren trainieren. Dazu müssen Sie Ihr Funkgerät über einen speziellen Adapter an den Computer anschließen, der das PPM-Signal von der Fernbedienung in die vom Computer verstandenen USB-Joystick-Signale umwandelt. Solche Adapter sind natürlich keine Seltenheit und kosten in chinesischen Geschäften einen Cent. Die Lieferung der Bestellung muss jedoch lange warten. Funktioniert sie wie erwartet? Zum Beispiel habe ich diese:</font></font><br>
<div style="text-align:center;"><img src="https://habrastorage.org/files/413/a9c/21a/413a9c21a83647e485fd962a55a5b129.jpg"></div> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aus irgendeinem Grund, den ich noch nicht verstanden habe, weigert er sich rundweg, im </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FPV-Freerider-</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Simulator angemessen zu kalibrieren </font><font style="vertical-align: inherit;">, obwohl er in Phoenix RC und Aerofly RC 7 gut funktioniert. FPV-Freerider vermittelt die Physik des Akro-Flugs auf einem Renn-Copter recht gut und außerdem hat einen kostenlosen Demo-Modus.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gelöst - wir machen den Adapter selbst!</font></font><br>
<br>
<h5><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ein bisschen Ausrüstung:</font></font></b></h5><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die meisten mehr oder weniger seriösen RC-Geräte verfügen über einen Anschluss, über den Steuersignale im PPM-Format (Pulse Position Modulation) ausgegeben werden. </font><font style="vertical-align: inherit;">Ein PPM-Signal ist eine Folge von kurzen Impulsen, deren Intervall den Steuerwert jedes Kanals der Funkausrüstung bestimmt. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Essenz von PPM vermittelt perfekt das Bild:</font></font><br>
<div style="text-align:center;"><img src="https://habrastorage.org/files/6ce/643/497/6ce6434973b3487090b212d3950f73c5.jpg"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um PPM zu dekodieren, müssen Sie die Zeitintervalle zwischen aufeinanderfolgenden Impulsen genau messen (es spielt keine Rolle, zwischen welchen Flanken: vorne oder hinten, da die Dauer der Impulse selbst immer gleich ist).</font></font><br>
<br>
<h5><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Implementierung:</font></font></b></h5><br><font style="vertical-align: inherit;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link"><font style="vertical-align: inherit;">Lassen Sie sich</font></a><font style="vertical-align: inherit;"> 
von einem </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Artikel von </font></font></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AlexeyStn</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> über die Erstellung eines PPM-zu-USB-Adapters inspirieren, der auf STM32F3Discovery basiert, aber nur Arduino Pro Micro (Leonardo) mit USB-Hardwareunterstützung enthält. Beginnen wir einen einfachen Weg zu unserem Adapter. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Auf dem Github finden Sie mehrere ähnliche Projekte, und für einige ist nicht einmal Hardware-USB im Controller erforderlich. </font><font style="vertical-align: inherit;">Die meisten von ihnen müssen jedoch ernsthaft mit einer Datei fertig sein, damit etwas funktioniert. </font><font style="vertical-align: inherit;">Das passende Projekt war </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rc-leonardo-joy</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, die fast unmittelbar nach dem Ausfüllen der Skizze zu funktionieren begann, aber sofort einige Mängel aufwies: Alle Joystick-Messwerte waren nicht sehr stabil - die Cursormarkierung im Bedienfeld tanzte die ganze Zeit um den Sollwert. </font><font style="vertical-align: inherit;">Ich kann nicht sagen, dass dies das Handling im Simulator erheblich beeinflusst hat, aber wir möchten mit guter Ausrüstung trainieren! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nun, wir steigen in den Code ein und sehen: Die Berechnung der PPM-Impulsbreite erfolgt durch Verarbeiten eines externen Interrupts und Messen der Intervalle zwischen Aufrufen der Funktion </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">micros ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rxInt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{
  <span class="hljs-keyword"><span class="hljs-keyword">uint16_t</span></span> now,diff;
  <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint16_t</span></span> last = <span class="hljs-number"><span class="hljs-number">0</span></span>;
  <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> chan = <span class="hljs-number"><span class="hljs-number">0</span></span>;<font></font>
<font></font>
  now = micros();<font></font>
  sei();<font></font>
  diff = now - last;<font></font>
  last = now;<font></font>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(diff&gt;<span class="hljs-number"><span class="hljs-number">3000</span></span>) chan = <span class="hljs-number"><span class="hljs-number">0</span></span>;
  <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> {
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-number"><span class="hljs-number">900</span></span>&lt;diff &amp;&amp; diff&lt;<span class="hljs-number"><span class="hljs-number">2200</span></span> &amp;&amp; chan&lt;RC_CHANS ) {<font></font>
      rcValue[chan] = adjust(diff,chan);<font></font>
    }<font></font>
    chan++;<font></font>
  }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Weitere </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Informationen zur</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Funktion </font><i><font style="vertical-align: inherit;">micros () finden Sie</font></i><font style="vertical-align: inherit;"> in der Arduino-Dokumentation:</font></font><br>
<br>
<blockquote><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gibt die Anzahl der Mikrosekunden zurück, seit das Arduino-Board das aktuelle Programm ausgeführt hat. </font><font style="vertical-align: inherit;">Diese Zahl läuft nach ca. 70 Minuten über (auf Null zurück). </font><font style="vertical-align: inherit;">Auf 16-MHz-Arduino-Karten (z. B. Duemilanove und Nano) hat diese Funktion eine Auflösung von vier Mikrosekunden (dh der zurückgegebene Wert ist immer ein Vielfaches von vier). </font><font style="vertical-align: inherit;">Auf 8-MHz-Arduino-Karten (z. B. dem LilyPad) hat diese Funktion eine Auflösung von acht Mikrosekunden.</font></font></i></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das heißt, die Funktion ist nicht nur nicht besonders genau und gibt immer Werte zurück, die ein Vielfaches von 4 μs sind, sondern läuft auch nach 70 Minuten über, was uns eine Art gekrümmten Wert des gemessenen Intervalls gibt. </font><font style="vertical-align: inherit;">Nicht gut. </font><font style="vertical-align: inherit;">Es wäre besser, einen Timer und seine Interrupts zu verwenden, um externe Signale zu erfassen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir schauen weiter: Die meisten Daten zur Position des Joysticks sind künstlich auf ein Byte (0-255) beschränkt:</font></font><br>
<pre><code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Convert a value in the range 1000-2000 to 0-255</span></span>
<span class="hljs-function"><span class="hljs-function">byte </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stickValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> rcVal)</span></span></span><span class="hljs-function"> </span></span>{
  <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">map</span></span>( constrain(rcVal - <span class="hljs-number"><span class="hljs-number">1000</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1000</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1000</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">255</span></span>);<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hmm, ich möchte genauer sein. </font><font style="vertical-align: inherit;">Dazu müssen Sie jedoch den HID-Deskriptor neu schreiben und alle zugehörigen Datentypen korrigieren. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kaum gesagt als getan! </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir teilen das Repository auf und schreiben den Code neu, um mithilfe eines Timers die PPM-Intervalle zu zählen:</font></font><br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initTimer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ 
	<span class="hljs-comment"><span class="hljs-comment">// Input Capture setup</span></span>
	<span class="hljs-comment"><span class="hljs-comment">// ICNC1: =0 Disable Input Capture Noise Canceler to prevent delay in reading</span></span>
	<span class="hljs-comment"><span class="hljs-comment">// ICES1: =1 for trigger on rising edge</span></span>
	<span class="hljs-comment"><span class="hljs-comment">// CS11: =1 set prescaler to 1/8 system clock (F_CPU)</span></span>
	TCCR1A = <span class="hljs-number"><span class="hljs-number">0</span></span>;<font></font>
	TCCR1B = (<span class="hljs-number"><span class="hljs-number">0</span></span>&lt;&lt;ICNC1) | (<span class="hljs-number"><span class="hljs-number">1</span></span>&lt;&lt;ICES1) | (<span class="hljs-number"><span class="hljs-number">1</span></span>&lt;&lt;CS11);<font></font>
	TCCR1C = <span class="hljs-number"><span class="hljs-number">0</span></span>;<font></font>
<font></font>
	<span class="hljs-comment"><span class="hljs-comment">// Interrupt setup</span></span>
	<span class="hljs-comment"><span class="hljs-comment">// ICIE1: Input capture </span></span>
	TIFR1 = (<span class="hljs-number"><span class="hljs-number">1</span></span>&lt;&lt;ICF1); <span class="hljs-comment"><span class="hljs-comment">// clear pending</span></span>
	TIMSK1 = (<span class="hljs-number"><span class="hljs-number">1</span></span>&lt;&lt;ICIE1); <span class="hljs-comment"><span class="hljs-comment">// and enable</span></span><font></font>
}<font></font>
...<font></font>
<font></font>
ISR(TIMER1_CAPT_vect) {<font></font>
	<span class="hljs-keyword"><span class="hljs-keyword">union</span></span> twoBytes {
		<span class="hljs-keyword"><span class="hljs-keyword">uint16_t</span></span> word;
		<span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span>  byte[<span class="hljs-number"><span class="hljs-number">2</span></span>];<font></font>
	} timeValue;<font></font>
<font></font>
	<span class="hljs-keyword"><span class="hljs-keyword">uint16_t</span></span> now, diff;
	<span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint16_t</span></span> last = <span class="hljs-number"><span class="hljs-number">0</span></span>;
	<span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> chan = <span class="hljs-number"><span class="hljs-number">0</span></span>;<font></font>
	<font></font>
	timeValue.byte[<span class="hljs-number"><span class="hljs-number">0</span></span>] = ICR1L;    <span class="hljs-comment"><span class="hljs-comment">// grab captured timer value (low byte)</span></span>
	timeValue.byte[<span class="hljs-number"><span class="hljs-number">1</span></span>] = ICR1H;    <span class="hljs-comment"><span class="hljs-comment">// grab captured timer value (high byte)</span></span><font></font>
<font></font>
	now = timeValue.word;<font></font>
	diff = now - last;<font></font>
	last = now;<font></font>
<font></font>
	<span class="hljs-comment"><span class="hljs-comment">//all numbers are microseconds multiplied by TIMER_COUNT_DIVIDER (as prescaler is set to 1/8 of 16 MHz)</span></span>
	<span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(diff &gt; (NEWFRAME_PULSE_WIDTH * TIMER_COUNT_DIVIDER)) {<font></font>
		chan = <span class="hljs-number"><span class="hljs-number">0</span></span>;  <span class="hljs-comment"><span class="hljs-comment">// new data frame detected, start again</span></span><font></font>
	}<font></font>
	<span class="hljs-keyword"><span class="hljs-keyword">else</span></span> {
		<span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(diff &gt; (MIN_PULSE_WIDTH * TIMER_COUNT_DIVIDER - THRESHOLD) <font></font>
			&amp;&amp; diff &lt; (MAX_PULSE_WIDTH * TIMER_COUNT_DIVIDER + THRESHOLD) <font></font>
			&amp;&amp; chan &lt; RC_CHANNELS_COUNT) <font></font>
		{<font></font>
			rcValue[chan] = adjust(diff, chan); <span class="hljs-comment"><span class="hljs-comment">//store detected value</span></span><font></font>
		}<font></font>
		chan++; <span class="hljs-comment"><span class="hljs-comment">//no value detected within expected range, move to next channel</span></span><font></font>
	}<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Erhöhen Sie die Intervalle für die Stick-Abweichung im HID-Deskriptor auf 0-1000:</font></font><br>
<pre><code class="cpp hljs">	<span class="hljs-comment"><span class="hljs-comment">// Joystick</span></span>
	<span class="hljs-number"><span class="hljs-number">0x05</span></span>, <span class="hljs-number"><span class="hljs-number">0x01</span></span>,			<span class="hljs-comment"><span class="hljs-comment">// USAGE_PAGE (Generic Desktop)</span></span>
	<span class="hljs-number"><span class="hljs-number">0x09</span></span>, <span class="hljs-number"><span class="hljs-number">0x04</span></span>,			<span class="hljs-comment"><span class="hljs-comment">// USAGE (Joystick)</span></span>
	<span class="hljs-number"><span class="hljs-number">0xa1</span></span>, <span class="hljs-number"><span class="hljs-number">0x01</span></span>,			<span class="hljs-comment"><span class="hljs-comment">// COLLECTION (Application)</span></span>
	<span class="hljs-number"><span class="hljs-number">0x85</span></span>, JOYSTICK_REPORT_ID,	<span class="hljs-comment"><span class="hljs-comment">//   REPORT_ID (3)</span></span><font></font>
	...<font></font>
	<span class="hljs-number"><span class="hljs-number">0xA1</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>,		    <span class="hljs-comment"><span class="hljs-comment">//   COLLECTION (Physical)</span></span>
	<span class="hljs-number"><span class="hljs-number">0x09</span></span>, <span class="hljs-number"><span class="hljs-number">0x30</span></span>,		    <span class="hljs-comment"><span class="hljs-comment">//     USAGE (x)</span></span>
	<span class="hljs-number"><span class="hljs-number">0x09</span></span>, <span class="hljs-number"><span class="hljs-number">0x31</span></span>,		    <span class="hljs-comment"><span class="hljs-comment">//     USAGE (y)</span></span>
	<span class="hljs-number"><span class="hljs-number">0x09</span></span>, <span class="hljs-number"><span class="hljs-number">0x33</span></span>,		    <span class="hljs-comment"><span class="hljs-comment">//     USAGE (rx)</span></span>
	<span class="hljs-number"><span class="hljs-number">0x09</span></span>, <span class="hljs-number"><span class="hljs-number">0x34</span></span>,		    <span class="hljs-comment"><span class="hljs-comment">//     USAGE (ry)</span></span>
	<span class="hljs-number"><span class="hljs-number">0x15</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>,		    <span class="hljs-comment"><span class="hljs-comment">//	   LOGICAL_MINIMUM (0)</span></span>
	<span class="hljs-number"><span class="hljs-number">0x26</span></span>, <span class="hljs-number"><span class="hljs-number">0xE8</span></span>, <span class="hljs-number"><span class="hljs-number">0x03</span></span>,	    <span class="hljs-comment"><span class="hljs-comment">//     LOGICAL_MAXIMUM (1000)</span></span>
	<span class="hljs-number"><span class="hljs-number">0x75</span></span>, <span class="hljs-number"><span class="hljs-number">0x10</span></span>,	  	    <span class="hljs-comment"><span class="hljs-comment">//	   REPORT_SIZE (16)</span></span>
	<span class="hljs-number"><span class="hljs-number">0x95</span></span>, <span class="hljs-number"><span class="hljs-number">0x04</span></span>,		    <span class="hljs-comment"><span class="hljs-comment">//     REPORT_COUNT (4)</span></span>
	<span class="hljs-number"><span class="hljs-number">0x81</span></span>, <span class="hljs-number"><span class="hljs-number">0x02</span></span>,		    <span class="hljs-comment"><span class="hljs-comment">//     INPUT (Data,Var,Abs)</span></span>
	<span class="hljs-number"><span class="hljs-number">0xc0</span></span>,			    <span class="hljs-comment"><span class="hljs-comment">//   END_COLLECTION</span></span><font></font>
<font></font>
	<span class="hljs-number"><span class="hljs-number">0xc0</span></span>				<span class="hljs-comment"><span class="hljs-comment">// END_COLLECTION</span></span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ändern </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sie</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> auf </font><font style="vertical-align: inherit;">dem Weg </font><i><font style="vertical-align: inherit;">uint8_t</font></i><font style="vertical-align: inherit;"> in </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">uint16_t,</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> wo immer die Stick-Abweichungswerte übertragen werden. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir entfernen den zusätzlichen Code, fügen ein Dutzend #define hinzu und erhalten eine gute Skizze, die geschärft ist, um als PPM-USB-Adapter zu funktionieren. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das Ergebnis</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ist in github verfügbar: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com/voroshkov/Leonardo-USB-RC-Adapter</font></font></a><br>
<br>
<h5><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Skizzeneinstellungen:</font></font></b></h5><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es ist sinnvoll, die Definition für futaba zu entfernen, wenn Sie andere Hardware haben:</font></font><br>
<pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> FUTABA</span></span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
und passen Sie gegebenenfalls die Werte von Mikrosekunden in den Parametern an, wenn Ihr Gerät andere Timings erzeugt: </font></font><br>
<pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> STICK_HALFWAY 500</span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> STICK_CENTER 1500</span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> THRESHOLD 100</span></span>
</code></pre><br>
<br>
<h5><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zusammenstellung:</font></font></b></h5><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um die Skizze zu kompilieren und hochzuladen, müssen Sie die USB-Bibliotheken in der Arduino-Umgebung selbst ersetzen, nachdem Sie Backups erstellt haben. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dazu gehen wir auf dem Weg in den Darm von Arduino </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">... \ Arduino \ hardware \ arduino \ cores \ arduino \</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , sichern </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">usbapi.h</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hid.cpp</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und überschreiben sie anschließend mit denselben Dateien aus dem </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ArduinoLibs-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ordner des </font><font style="vertical-align: inherit;">Repositorys. </font><font style="vertical-align: inherit;">Öffnen Sie als nächstes die Skizze, verbinden Sie den Arduino Leonardo und füllen Sie ihn aus.</font></font><br>
<br>
<h5><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Verbindung:</font></font></b></h5><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alles ist hässlich einfach: Einerseits stecken wir USB ein, andererseits löten wir zwei Drähte (an Digital Pin 4 und Masse) und stecken sie in das PPM bzw. die Masse des Senders. </font><font style="vertical-align: inherit;">Es stellt sich irgendwie so heraus:</font></font><br>
<div style="text-align:center;"><img src="https://habrastorage.org/files/424/5f1/cb6/4245f1cb61c4485d9eb342ee77e7fef9.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In Windows 7 wird das Gerät als Composite (Tastatur, Maus, Joystick) mit dem Namen Arduino Leonardo erkannt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Besondere Erwähnung verdient den Stecker im Gerät. </font><font style="vertical-align: inherit;">Irgendwo ist es eine normale Audio-Buchse, und irgendwo (wie in meiner Futaba 7C) ist etwas schwieriger:</font></font><br>
<div style="text-align:center;"><img src="https://habrastorage.org/files/abf/859/793/abf8597936a64c5f8bbaa1967181ce59.png"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Für die Montage verschiedener "männlicher" Steckverbinder verwende ich seit langem erfolgreich Heißkleber. </font><font style="vertical-align: inherit;">Dazu legen wir Papier oder Polyethylen auf die „Mutter“, durchstechen dieses Substrat mit Stiften, so dass sie in den Anschluss auf der anderen Seite stecken, und gießen dann allmählich Klebstoff zwischen die Stifte, um ihm gleichzeitig mit nassen Fingern Form zu geben. </font><font style="vertical-align: inherit;">Die Drähte müssen natürlich im Voraus gelötet werden, damit der ausgehärtete Klebstoff beim Löten nicht schmilzt. </font><font style="vertical-align: inherit;">Es stellt sich nicht immer ästhetisch heraus, aber sehr funktional:</font></font><br>
<div style="text-align:center;"><img src="https://habrastorage.org/files/988/49f/b5b/98849fb5b60240a18ced5326a14c8e15.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(Hier im Stecker werden 4 Stifte für die eindeutige Positionierung benötigt, es gibt nur zwei Arbeiter.) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das ist alles. </font><font style="vertical-align: inherit;">Wir laden den Simulator herunter, schließen die Ausrüstung an und trainieren die Pilotenfähigkeiten, während wir an dunklen Winterabenden heißen Tee vor dem Kamin trinken.</font></font><br>
<br>
<h5><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS</font></font></b></h5><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Was ist, wenn es keinen Arduino Leonardo gibt, aber auf dem STM32F103C8T6 ein solches Minimum Development Board vorhanden ist? </font></font><br>
<img align="right" src="https://habrastorage.org/files/610/5dc/823/6105dc823e584fff8219986c52511640.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mach dir keine Sorgen, den ganzen Weg. </font><font style="vertical-align: inherit;">Sowohl für Sie als auch für meine eigene Entwicklung habe ich das bereits erwähnte </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Projekt von</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Alexey Stankevich </font><font style="vertical-align: inherit;">portiert </font><font style="vertical-align: inherit;">. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quellen und kompilierte Binärdateien zum Hochladen auf diesen Controller finden Sie hier: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com/voroshkov/STM32-RC-USB-Adapter</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich werde alle Fragen gerne in den Kommentaren beantworten. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Habt einen schönen Flug!</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de388811/">https://habr.com/ru/post/de388811/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de388801/index.html">Mit CRISPR konnte erstmals eine Gentherapie bei einem erwachsenen Säugetier durchgeführt werden</a></li>
<li><a href="../de388803/index.html">Cassini fängt die drei Satelliten des Saturn auf einem Foto ein</a></li>
<li><a href="../de388805/index.html">Das ist Wissenschaft: Mikronkanonen und Nanokerne</a></li>
<li><a href="../de388807/index.html">Die Unterstützung für microSD-Speicherkarten kehrt zu Samsung Galaxy S7 und S7 Edge zurück</a></li>
<li><a href="../de388809/index.html">Abnahme der Helligkeit beim Heizen an LED-Lampen</a></li>
<li><a href="../de388813/index.html">Lenovo stellt auf der CES2016 neue ThinkPad-Laptops vor</a></li>
<li><a href="../de388815/index.html">Мошенничество при покупке б/у Macbook Pro</a></li>
<li><a href="../de388817/index.html">Toyota hat 1.400 Patente für Robomobile, doppelt so viele wie jedes andere Unternehmen</a></li>
<li><a href="../de388819/index.html">Ein Blick auf den Kaiser der Leiden. Teil zwei</a></li>
<li><a href="../de388821/index.html">Reinigungsroboter</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>