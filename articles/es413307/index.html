<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>💆 🏸 😔 ESET descubrió BackSwap banker utilizando un nuevo método de manipulación del navegador 🤦🏽 🐭 🤵🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Los troyanos bancarios en los últimos años han perdido popularidad entre los ciberdelincuentes. Una de las razones es el desarrollo de tecnologías de ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ESET descubrió BackSwap banker utilizando un nuevo método de manipulación del navegador</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/eset/blog/413307/"> Los troyanos bancarios en los últimos años han perdido popularidad entre los ciberdelincuentes.  Una de las razones es el desarrollo de tecnologías de protección para proveedores de antivirus y desarrolladores de navegadores web.  Es difícil llevar a cabo un ataque con la ayuda de un banquero, por eso muchos escritores de virus están cambiando a herramientas más simples y rentables: encriptadores, mineros y software para robar criptomonedas. <br><br>  Muchos, pero no todos.  Hemos descubierto una nueva familia de banqueros que utilizan nuevas técnicas para manipular el navegador.  En lugar de introducir código complejo en el proceso del navegador para monitorear su actividad, el malware detecta eventos de Windows en el ciclo de espera de mensajes para verificar los valores de los objetos relacionados con las operaciones bancarias. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/tt/a8/ap/tta8apossnqrthcj3zzu208kur8.jpeg"></div><br>  Después de descubrir el trabajo con la banca en línea, el malware inyecta JavaScript malicioso en la página web, a través de la consola del desarrollador en el navegador, o directamente en la barra de direcciones.  Las operaciones se llevan a cabo sin el conocimiento y la participación del usuario.  A primera vista, un esquema simple le permite evitar los mecanismos avanzados para proteger los navegadores de ataques complejos. <br><br><a name="habracut"></a><h3>  Introduccion </h3><br>  Notamos por primera vez este grupo cibernético en enero de 2018, cuando distribuyó los primeros desarrollos, por ejemplo, un programa para robar criptomonedas cambiando la dirección de la billetera en el portapapeles.  El grupo estuvo involucrado en la criptomoneda durante varios meses, después de lo cual lanzó la primera versión del banquero: a partir del 13 de marzo, los productos antivirus ESET lo detectarán como Win32 / BackSwap.A. <br><br>  En el gráfico a continuación, puede ver un salto brusco en las detecciones en comparación con proyectos anteriores, según nuestras estadísticas.  Los autores mejoran al banquero y lanzan nuevas versiones casi todos los días (con descansos para el fin de semana). <br><img src="https://habrastorage.org/webt/2o/m5/bt/2om5btzr06r004jfujqpqlw7bqu.png"><br>  <i>Figura 1. Descubra Win32 / BackSwap.A y proyectos anteriores relacionados</i> <br><br><h3>  Distribución y ejecución. </h3><br>  Win32 / BackSwap.A se distribuye en correos electrónicos no deseados que contienen un cargador de JavaScript ofuscado de la familia Nemucod en el archivo adjunto.  Actualmente, estos boletines están dirigidos a usuarios de Polonia. <br><br>  A menudo encontramos en las máquinas víctimas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">otro</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">conocido</a> cargador de arranque Win32 / TrojanDownloader.Nymaim, que probablemente se extiende de la misma manera.  En la actualidad, no sabemos si esta coincidencia o las familias están relacionadas entre sí. <br><br>  La carga útil se entrega como una versión modificada de una aplicación legítima, parcialmente reescrita por un componente malicioso.  La aplicación utilizada para modificaciones cambia regularmente: observamos TPVCGateway, SQLMon, DbgView, WinRAR Uninstaller, 7Zip, OllyDbg y FileZilla Server en esta calidad. <br><br>  La aplicación se modifica de tal manera que cambia a código malicioso después de su inicialización.  Para hacer esto, los autores agregan un puntero a un componente malicioso en la tabla de funciones <code>_initterm()</code> , el interior del tiempo de ejecución de la biblioteca C, que inicializa las variables globales y otras partes del programa antes de llamar a la función main (). <br><br><img src="https://habrastorage.org/webt/dh/by/ew/dhbyewz8xxhig_uyb8hg7hghk04.png"><br>  <i>Figura 2. Matriz de punteros _initterm de una aplicación legítima, al final de la cual se agrega un puntero al shellcode del banquero</i> <br><br>  El método se asemeja a la trojanización;  la diferencia es que en nuestro caso la aplicación original deja de funcionar después de inicializar el malvari.  El propósito del método no es enmascarar al usuario, sino más bien contrarrestar la detección y la investigación.  Los analistas encuentran más difícil detectar a este banquero, ya que muchas herramientas de ingeniería inversa, como IDA Pro, muestran la función main () original como el inicio legítimo del código de la aplicación.  No es el hecho de que el analista a primera vista notará algo sospechoso. <br><br>  La carga útil es un objeto de código binario independiente de la posición con datos incrustados.  Las cadenas de caracteres se almacenan en texto sin formato, lo que le permite reemplazar trazas ya sutiles, ya que todas las API de Windows requeridas se buscan mediante hash.  Al comienzo del trabajo, el malware proporciona persistencia al copiarse en la carpeta de inicio, luego de lo cual cambia a las funciones del banquero. <br><br><h3>  Métodos de inyección tradicionales </h3><br>  Un banquero ordinario para robar fondos de la cuenta de la víctima a través de la interfaz de banca en línea se presenta a sí mismo o un módulo especial en el espacio de direcciones del proceso del navegador.  Por varias razones, esta no es una tarea fácil.  En primer lugar, la inyección puede ser interceptada por un producto antiviral.  Además, la profundidad de bits del módulo implementado debe coincidir con la profundidad de bits del navegador: el módulo de 32 bits no debe integrarse en el proceso de 64 bits y viceversa.  Como resultado, un ataque requiere dos versiones del mismo módulo: 32- / 64-bit. <br><br>  Después de una inyección exitosa, el módulo bancario debe detectar las funciones relacionadas con el navegador e interceptarlas.  Necesita funciones responsables de enviar y recibir solicitudes HTTP en formato de texto sin formato antes del cifrado y después del descifrado, respectivamente.  La complejidad de encontrar características varía de un navegador a otro.  En Mozilla Firefox, son exportados por la biblioteca nss3.dll, y sus direcciones son fáciles de encontrar por sus nombres conocidos.  Google Chrome y otros navegadores basados ​​en Chromium ocultan estas características.  Esto obliga a los creadores de virus a crear esquemas especiales dirigidos a una versión específica del navegador y cambiar las tácticas cuando se lanzan nuevas versiones. <br><br>  Si se encuentran las funciones y se realiza la intercepción (y la solución antivirus no la detectó), el banquero puede cambiar el tráfico HTTP o redirigir a la víctima a sitios que simulan recursos bancarios en línea legítimos, falsificando certificados.  Los famosos troyanos bancarios <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Dridex</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Ursnif, Zbot, Trickbot, Qbot</a> y muchos otros utilizan métodos similares. <br><br><h3>  Nuevo método de manipulación del navegador. </h3><br>  Win32 / BackSwap.A implementa un enfoque completamente diferente.  Bunker utiliza elementos del shell gráfico de Windows e imitación de la entrada del usuario.  El método puede parecer trivial, pero es efectivo porque le permite resolver los problemas conocidos de la inyección tradicional.  Primero, el malware no interactúa con el navegador a nivel de proceso.  Gracias a esto, no hay necesidad de privilegios especiales y evitar los antivirus que protegen contra la inyección convencional.  La segunda ventaja para los atacantes es que el banquero no depende de la arquitectura del navegador o su versión;  Un código funciona para todos. <br><br>  El malware rastrea la URL de la página visitada configurando enlaces de eventos para un cierto rango de eventos relevantes disponibles a través del ciclo de espera de mensajes de Windows, como EVENT_OBJECT_FOCUS, EVENT_OBJECT_SELECTION, EVENT_OBJECT_NAMECHANGE y varios otros.  El controlador busca valores de URL buscando objetos de cadena que comiencen con HTTP obtenidos llamando al método <code>get_accValue</code> desde la interfaz de eventos <code>IAccessible</code> . <br><br><img src="https://habrastorage.org/webt/kn/ig/xa/knigxazoteqnbwtvih3ytf5p7t0.png"><br>  <i>Figura 3. Recepción utilizada para obtener la URL de la página actual en el navegador.</i>  <i>Estas direcciones se obtienen marcando la subcadena [ht] tp [s] (resaltada en rojo)</i> <br><br>  Luego Win32 / BackSwap.A busca direcciones bancarias y encabezados de ventanas del navegador que indiquen que el usuario está preparando una transferencia de dinero. <br><br><img src="https://habrastorage.org/webt/y5/hq/on/y5hqonykzenyxfnjubhtdp7dwh4.png"><br>  <i>Figura 4. El banquero está buscando líneas de código relacionadas con bancos específicos.</i>  <i>La primera línea es el título de la ventana, la segunda es la parte de la URL</i> <br><br>  Una vez encontrado el deseado, el banquero descarga JavaScript malicioso correspondiente a un banco específico y lo inyecta en el navegador.  La inyección se lleva a cabo de una manera simple pero efectiva. <br><br>  En muestras anteriores, Win32 / BackSwap.A inserta un script malicioso en el portapapeles y simula una pulsación de tecla para abrir la consola del desarrollador (CTRL + SHIFT + J en Google Chrome, CTRL + SHIFT + K en Mozilla Firefox), luego pega el contenido del búfer (CTRL + V) y presiona ENTRAR para ejecutar el contenido de la consola.  El malware luego repite la combinación de teclas para cerrar la consola.  En este momento, la ventana del navegador se vuelve invisible: un usuario común probablemente piense que el navegador se congela durante unos segundos. <br><br>  En nuevas versiones, se mejora el circuito.  En lugar de interactuar con la consola del desarrollador, se ejecuta un script malicioso directamente desde la barra de direcciones a través de un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">protocolo especial de JavaScript</a> , una función infrautilizada que admite la mayoría de los navegadores.  El banquero imita presionar CTRL + L para seleccionar la barra de direcciones, BORRAR para borrar el campo, "ingresa" los caracteres en "javascript" a través de una llamada a SendMessageA en un bucle y luego inserta un script malicioso usando la combinación CTRL + V.  El script se ejecuta después de "presionar" ENTER.  Al final del proceso, la barra de direcciones se borra para eliminar rastros de compromiso. <br><br>  En la Figura 5, puede ver parte del código inyectado en la consola.  Primero, Win32 / BackSwap.A define un navegador al verificar el nombre de la clase de la ventana seleccionada (marcada en azul).  JavaScript malicioso se copia en el búfer (marcado en rojo).  Luego, el valor de transparencia de la ventana del navegador se cambia a "3", lo que lo hace invisible (marcado en púrpura).  La parte relacionada con la función <code>ToggleBrowserConsole</code> , que enciende y apaga la consola, se <code>ToggleBrowserConsole</code> . <br><br><img src="https://habrastorage.org/webt/j2/5n/ro/j25nrotyjbfbbr0f517jfadihjo.png"><br>  <i>Figura 5. Inyección de script</i> <br><br>  Win32 / BackSwap.A admite ataques en Google Chrome y Mozilla Firefox, se ha agregado compatibilidad con Internet Explorer en versiones recientes.  El método es adecuado para la mayoría de los navegadores con una consola de desarrollador o la capacidad de ejecutar código JavaScript desde la barra de direcciones (funciones estándar del navegador). <br><br>  Tres navegadores comprometidos tienen una <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">característica de seguridad</a> interesante diseñada para evitar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ataques Self-XSS</a> : cuando un usuario intenta pegar texto copiado que comienza con "javascript:" en la barra de direcciones, el prefijo del protocolo se elimina y debe ingresarse manualmente nuevamente para ejecutar el script.  Win32 / BackSwap.A evita este obstáculo al simular la entrada de caracteres de un prefijo en la barra de direcciones antes de pegar el script malicioso copiado. <br><br>  Otra herramienta de seguridad se implementa en Mozilla Firefox.  El navegador prohíbe copiar scripts a la consola por defecto;  en su lugar, muestra una notificación de posibles riesgos y obliga al usuario a ingresar primero manualmente la frase "permitir pegar" para permitir la inserción de caracteres copiados.  Para omitir esta medida de seguridad, Win32 / BackSwap.A proporciona la ejecución de un comando de shell (Figura 6), que realiza cambios en el <code>prefs.js</code> configuración <code>prefs.js</code> y elimina esta protección. <br><br><img src="https://habrastorage.org/webt/1t/xb/cn/1txbcnnebubsm5ss93tmdgdugqu.png"><br>  <i>Figura 6. Un comando de shell que elimina la protección de insertar un script en la consola de Firefox</i> <br><br><h3>  Código malicioso de JavaScript </h3><br>  Win32 / BackSwap.A utiliza un script especial para cada uno de los bancos objetivo.  Como todos los bancos tienen sitios diferentes, el código es diferente y tiene diferentes variables.  Los guiones se inyectan en las páginas en las que, según el banquero, se realiza la preparación de la transferencia de dinero.  Los scripts implementados reemplazan en secreto el número de cuenta del destinatario con otro, y cuando la víctima envía la transferencia, el dinero irá a la cuenta de los atacantes.  Las contramedidas contra transferencias no autorizadas (autenticación de dos factores) no tienen poder, ya que el titular de la cuenta confirma el envío de fondos. <br><br>  Los autores de Win32 / BackSwap.A escribieron guiones para trabajar con cinco bancos polacos: PKO Bank Polski, Bank Zachodni WBK SA, mBank, ING y Pekao.  Los operadores eliminan algunos bancos de la lista de objetivos: en la mayoría de las versiones nuevas quedan tres bancos: PKO BP, mBank e ING.  En versiones anteriores, los atacantes envían el número de cuenta del destinatario desde servidores C&amp;C en sitios de WordPress pirateados.  En las nuevas versiones, los números se almacenan en los propios scripts maliciosos.  Las cuentas a menudo cambian: se usa un nuevo número de cuenta en casi todas las campañas nuevas. <br><br>  Los banqueros están interesados ​​en transferencias en un cierto rango, generalmente de 10,000 a 20,000 zlotys polacos (168,000-337,000 rublos).  El script no solo reemplaza el número de cuenta del destinatario, sino que también reemplaza el campo de entrada por uno falso: el usuario ve el número correcto y no sospecha nada. <br><br><img src="https://habrastorage.org/webt/ch/c_/c3/chc_c3eos--kxjcany8nd6hhj6a.png"><br>  <i>Figura 7. Parte del código malicioso de JavaScript.</i>  <i>Los sitios marcados en rojo son responsables de verificar el monto de la transferencia y reemplazar el número de cuenta del destinatario</i> <br><br><h3>  Conclusión </h3><br>  Win32 / BackSwap.A demuestra que la confrontación entre la industria de la seguridad y los creadores de virus no siempre requiere una nueva técnica y táctica sofisticadas.  Los navegadores mejoran la protección contra la inyección de código, por lo que los autores del malware cambiaron a otros métodos de ataque, y solo uno está implementado en Win32 / BackSwap.A. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Los productos</a> antivirus <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ESET</a> detectan una amenaza como Win32 / BackSwap.A. <br><br>  Los especialistas de ESET informaron a los desarrolladores de navegadores comprometidos acerca de un nuevo método de ataque. <br><br><h3>  IoC </h3><br> <code>9BC4C1D5403DDD90712CE87225490A21D1EDC516 JS/Nemucod.EAN trojan <br> CF5A74C268661501156663F74CD5E20603B0F261 Win32/BackSwap.A trojan <br> 6251F9AD0E5F551AC4A6B918EF366E86C4CCFDC4 Win32/BackSwap.A trojan <br> 2DC9760A7C6E9D261C73EFB7B2604840734BC058 Win32/BackSwap.A trojan <br> A68901D0D8C1247FF280F9453E3AE45687C57566 Win32/BackSwap.A trojan (JavaScript)</code> </div> </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es413307/">https://habr.com/ru/post/es413307/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es413291/index.html">El libro "Aprendizaje profundo en Python"</a></li>
<li><a href="../es413293/index.html">Gran éxodo de la industria de los videojuegos.</a></li>
<li><a href="../es413297/index.html">Fuentes web variables</a></li>
<li><a href="../es413303/index.html">La historia de un problema: el recordatorio de JavaScript más corto</a></li>
<li><a href="../es413305/index.html">Baterías, Gigafactory, Northvolt y Siemens. Forastero T</a></li>
<li><a href="../es413309/index.html">Lado oscuro ágil</a></li>
<li><a href="../es413311/index.html">Portar su aplicación web de JavaScript puro a Vue.js</a></li>
<li><a href="../es413315/index.html">Sistema de clima en el apartamento con sus propias manos - parte 2</a></li>
<li><a href="../es413317/index.html">¿Quién le está enseñando a quién? La diferencia entre los verbos enseñar, estudiar y aprender</a></li>
<li><a href="../es413319/index.html">RIT ++ 2018. Moscú, Skolkovo</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>