<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👮 🧞 🔀 Einfacher Bildeditor auf VueJS 👼🏾 🤲🏽 📙</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Vor kurzem hatte ich die Gelegenheit, einen Service für einen Online-Shop zu schreiben, mit dem ich eine Bestellung zum Drucken meiner Fotos aufgeben ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Einfacher Bildeditor auf VueJS</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/417697/">  Vor kurzem hatte ich die Gelegenheit, einen Service für einen Online-Shop zu schreiben, mit dem ich eine Bestellung zum Drucken meiner Fotos aufgeben kann. <br><br>  Der Dienst ging von einem „einfachen“ Bildeditor aus, dessen Erstellung ich teilen möchte.  Und das alles, weil ich unter der Fülle aller Arten von Plugins keine geeignete Funktionalität gefunden habe. Außerdem wurden die Nuancen von CSS-Transformationen für mich plötzlich zu einer nicht ganz trivialen Aufgabe. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/884/ce8/2b3/884ce82b3d7a7c04c28705fd678fa6aa.jpg" alt="Bild"><br><a name="habracut"></a><br><h3>  Die Hauptaufgaben: </h3><br><ol><li>  Möglichkeit zum Hochladen von Bildern von Ihrem Gerät, Google Drive und Instagram. </li><li>  Bildbearbeitung: Bewegen, Drehen, horizontale und vertikale Reflexion, Zoomen, automatische Bildausrichtung zum Ausfüllen des Zuschneidebereichs. </li></ol><br>  Wenn sich das Thema als interessant herausstellt, werde ich in der nächsten Veröffentlichung die Integration mit Google Drive und Instagram im Backend-Teil der Anwendung, in dem das beliebte NodeJS + Express-Bundle verwendet wurde, ausführlich beschreiben. <br><br>  Für die Organisation des Frontends habe ich das wunderbare Vue-Framework gewählt.  Nur weil es mich nach harter Winkel- und nerviger Reaktion inspiriert.  Ich denke, es macht keinen Sinn, die Architektur, Routen und andere Komponenten zu beschreiben. Gehen wir direkt zum Editor. <br><br>  Übrigens kann die Demo des Editors hier gestochert <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">werden</a> . <br><br>  Wir werden zwei Komponenten benötigen: <br><br>  <b>Bearbeiten</b> - enthält die Hauptlogik und Steuerelemente <br>  <b>Vorschau</b> - ist für die Anzeige des Bildes verantwortlich <br><br><div class="spoiler">  <b class="spoiler_title">Bearbeiten von Komponentenvorlagen:</b> <div class="spoiler_text"><pre><code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Edit</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Preview</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">v-if</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"image"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ref</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"preview"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">:matrix</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"matrix"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">:image</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"image"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">:transform</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"transform"</span></span></span><span class="hljs-tag"> @</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">resized</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"areaResized"</span></span></span><span class="hljs-tag"> @</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">loaded</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"imageLoaded"</span></span></span><span class="hljs-tag"> @</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">moved</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"imageMoved"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"range"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">:min</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"minZoom"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">:max</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"maxZoom"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">step</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"any"</span></span></span><span class="hljs-tag"> @</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">change</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"onZoomEnd"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">v-model.number</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"transform.zoom"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">:disabled</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"!imageReady"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> @</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">click</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"rotateMinus"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">:disabled</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"!imageReady"</span></span></span><span class="hljs-tag">&gt;</span></span>Rotate left<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> @</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">click</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"rotatePlus"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">:disabled</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"!imageReady"</span></span></span><span class="hljs-tag">&gt;</span></span>Rotate right<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> @</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">click</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"flipY"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">:disabled</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"!imageReady"</span></span></span><span class="hljs-tag">&gt;</span></span>Flip horizontal<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> @</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">click</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"flipX"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">:disabled</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"!imageReady"</span></span></span><span class="hljs-tag">&gt;</span></span>Flip vertical<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Edit</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br></div></div><br>  Die Vorschau-Komponente kann 3 Ereignisse auslösen: <br><br>  <i>geladen</i> - Bildladeereignis <br>  <i>resized</i> - Fenstergröße <i>ändern</i> Ereignis <br>  Bewegtbild - Bewegtereignis <br><br>  Parameter: <br><br>  <i>Bild</i> - <i>Bild</i> Link <br>  <i>Matrix</i> - Transformationsmatrix für die Transformation der CSS-Eigenschaft <br>  <i>transform</i> - ein Objekt, das die Transformation beschreibt <br><br>  Um die Position des Bildes besser steuern zu können, hat img eine absolute Positionierung, und die Eigenschaft <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">transform-origin</a> , der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Transformationsreferenzpunkt</a> , wird auf den Anfangswert „0 0“ gesetzt, der dem Ursprung in der oberen linken Ecke des Originalbilds (vor der Transformation!) Entspricht. <br><br>  Das Hauptproblem, auf das ich gestoßen bin, besteht darin, dass Sie sicherstellen müssen, dass sich der Transformationsursprungspunkt immer in der Mitte des Bearbeitungsbereichs befindet. Andernfalls verschiebt sich während der Transformationen der ausgewählte Teil des Bildes.  Die Verwendung dieser <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Transformationsmatrix</a> hilft, dieses Problem zu lösen. <br><br><h3>  Komponentenbearbeitung </h3><br><div class="spoiler">  <b class="spoiler_title">Eigenschaften der Edit-Komponente:</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> { <span class="hljs-attr"><span class="hljs-attr">components</span></span>: { Preview }, data () { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">image</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-attr"><span class="hljs-attr">imageReady</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">imageRect</span></span>: {}, <span class="hljs-comment"><span class="hljs-comment">//   areaRect: {}, //   minZoom: 1, //   maxZoom: 1, //   //   transform: { center: { x: 0, y: 0, }, zoom: 1, rotate: 0, flip: false, flop: false, x: 0, y: 0 } } }, computed: { matrix() { let scaleX = this.transform.flop ? -this.transform.zoom : this.transform.zoom; let scaleY = this.transform.flip ? -this.transform.zoom : this.transform.zoom; let tx = this.transform.x; let ty = this.transform.y; const cos = Math.cos(this.transform.rotate * Math.PI / 180); const sin = Math.sin(this.transform.rotate * Math.PI / 180); let a = Math.round(cos)*scaleX; let b = Math.round(sin)*scaleX; let c = -Math.round(sin)*scaleY; let d = Math.round(cos)*scaleY; return { a, b, c, d, tx, ty }; } }, ... }</span></span></code> </pre><br></div></div><br>  Die Werte von imageRect und areaRect werden von der Preview-Komponente an uns übergeben. Dabei werden die Methoden imageLoaded und areaResized aufgerufen. Objekte haben die folgende Struktur: <br><br><pre> <code class="javascript hljs">{ <span class="hljs-attr"><span class="hljs-attr">size</span></span>: { <span class="hljs-attr"><span class="hljs-attr">width</span></span>: <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-attr"><span class="hljs-attr">height</span></span>: <span class="hljs-number"><span class="hljs-number">100</span></span> }, <span class="hljs-attr"><span class="hljs-attr">center</span></span>: { <span class="hljs-attr"><span class="hljs-attr">x</span></span>: <span class="hljs-number"><span class="hljs-number">50</span></span>, <span class="hljs-attr"><span class="hljs-attr">y</span></span>: <span class="hljs-number"><span class="hljs-number">50</span></span> } }</code> </pre><br>  Die Mittelwerte könnten jedes Mal berechnet werden, es ist jedoch einfacher, sie einmal aufzuschreiben. <br><br>  Die berechnete Matrixeigenschaft entspricht den Koeffizienten der Transformationsmatrix. <br><br>  Die erste Aufgabe, die gelöst werden muss, besteht darin, das Bild mit einem beliebigen Seitenverhältnis im Zuschneidebereich zu zentrieren, während das Bild vollständig passen sollte. Ungefüllte Bereiche (nur) oben und unten oder (nur) links und rechts sind akzeptabel.  Bei allen Transformationen muss dieser Zustand beibehalten werden. <br><br>  Zunächst begrenzen wir die Werte für das Zoomen. Dazu überprüfen wir das Seitenverhältnis unter Berücksichtigung der Ausrichtung des Bildes. <br><br><div class="spoiler">  <b class="spoiler_title">Komponentenmethoden:</b> <div class="spoiler_text"><pre> <code class="javascript hljs"> _setMinZoom(){ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> rotate = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.matrix.c !== <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> horizontal = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.imageRect.size.height &lt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.imageRect.size.width; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> areaSize = (horizontal &amp;&amp; !rotate || !horizontal &amp;&amp; rotate) ? <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.areaRect.size.width : <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.areaRect.size.height; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> imageSize = horizontal ? <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.imageRect.size.width : <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.imageRect.size.height; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.minZoom = areaSize/imageSize; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.transform.zoom &lt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.minZoom) <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.transform.zoom = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.minZoom; }, _setMaxZoom(){ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.maxZoom = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.areaRect.size.width/config.image.minResolution; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.transform.zoom &gt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.maxZoom) <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.transform.zoom = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.maxZoom; },</code> </pre><br></div></div><br>  Kommen wir nun zu den Transformationen.  Zunächst beschreiben wir die Reflexionen, da sie den sichtbaren Bereich des Bildes nicht verschieben. <br><br><div class="spoiler">  <b class="spoiler_title">Komponentenmethoden:</b> <div class="spoiler_text"><pre> <code class="javascript hljs">flipX(){ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.matrix.b == <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.matrix.c == <span class="hljs-number"><span class="hljs-number">0</span></span> ? <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.transform.flip = !<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.transform.flip : <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.transform.flop = !<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.transform.flop; }, flipY(){ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.matrix.b == <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.matrix.c == <span class="hljs-number"><span class="hljs-number">0</span></span> ? <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.transform.flop = !<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.transform.flop : <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.transform.flip = !<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.transform.flip; },</code> </pre><br></div></div><br>  Transformationen von Zoomen, Drehen und Verschieben erfordern bereits Anpassungen des Transformationsursprungs. <br><br><div class="spoiler">  <b class="spoiler_title">Komponentenmethoden:</b> <div class="spoiler_text"><pre> <code class="javascript hljs">onZoomEnd(){ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._translate(); }, rotatePlus(){ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.transform.rotate += <span class="hljs-number"><span class="hljs-number">90</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._setMinZoom(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._translate(); }, rotateMinus(){ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.transform.rotate -= <span class="hljs-number"><span class="hljs-number">90</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._setMinZoom(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._translate(); }, imageMoved(translate){ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._translate(); },</code> </pre><br></div></div><br>  Es ist die <b>_translate-</b> Methode <b>,</b> die für alle Feinheiten von Transformationen verantwortlich ist.  Es müssen zwei Referenzsysteme eingeführt werden.  Das erste, nennen wir es Null, beginnt in der oberen linken Ecke des Bildes. Wenn wir die Koordinaten mit der Transformationsmatrix multiplizieren, gehen wir zu einem anderen Koordinatensystem und nennen es lokal.  In diesem Fall können wir den Übergang von lokal zu Null umkehren, indem wir die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">inverse</a> Transformationsmatrix finden. <br><br>  Es stellt sich heraus, dass wir zwei Funktionen benötigen. <br><br>  Die erste besteht darin, von Null auf das lokale System zu wechseln. Der Browser führt dieselben Konvertierungen durch, wenn wir die CSS-Transformationseigenschaft angeben. <br><br><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">img</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">transform</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">matrix</span></span>(a, b, c, d, tx, ty); }</code> </pre><br>  Die zweite - um die ursprünglichen Koordinaten des Bildes zu finden, nachdem bereits Koordinaten transformiert wurden. <br><br>  Es ist am bequemsten, diese Funktionen mit Methoden einer separaten Klasse zu schreiben. <br><br><div class="spoiler">  <b class="spoiler_title">Klasse transformieren:</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Transform</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(center, matrix){ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.init(center, matrix); } init(center, matrix){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(center) <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.center = <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.assign({},center); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(matrix) <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.matrix = <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.assign({},matrix); } getOrigins(current){ <span class="hljs-comment"><span class="hljs-comment">//     let tr = {x: current.x - this.center.x, y: current.y - this.center.y}; //         const det = 1/(this.matrix.a*this.matrix.d - this.matrix.c*this.matrix.b); const x = ( this.matrix.d*(tr.x - this.matrix.tx) - this.matrix.c*(tr.y - this.matrix.ty) ) * det + this.center.x; const y = (-this.matrix.b*(tr.x - this.matrix.tx) + this.matrix.a*(tr.y - this.matrix.ty) ) * det + this.center.y; return {x, y}; } translate(current){ //     const origin = {x: current.x - this.center.x, y: current.y - this.center.y}; //        let x = this.matrix.a*origin.x + this.matrix.c*origin.y + this.matrix.tx + this.center.x; let y = this.matrix.b*origin.x + this.matrix.d*origin.y + this.matrix.ty + this.center.y; return {x, y}; } }</span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">_Übersetzungsmethode mit detaillierten Kommentaren:</b> <div class="spoiler_text"><pre> <code class="javascript hljs">_translate(checkAlign = <span class="hljs-literal"><span class="hljs-literal">true</span></span>){ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> tr = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Transform(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.transform.center, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.matrix); <span class="hljs-comment"><span class="hljs-comment">// , ,  ,       const newCenter = tr.getOrigins(this.areaRect.center); this.transform.center = newCenter; //      this.transform.x = this.areaRect.center.x - newCenter.x; this.transform.y = this.areaRect.center.y - newCenter.y; //   tr.init(this.transform.center, this.matrix); //        ,      let x0y0 = tr.translate({x: 0, y: 0}); let x1y1 = tr.translate({x: this.imageRect.size.width, y: this.imageRect.size.height}); //  (  )       let result = { left: x1y1.x - x0y0.x &gt; 0 ? x0y0.x : x1y1.x, top: x1y1.y - x0y0.y &gt; 0 ? x0y0.y : x1y1.y, width: Math.abs(x1y1.x - x0y0.x), height: Math.abs(x1y1.y - x0y0.y) }; //       ,   "" let rightOffset = this.areaRect.size.width - (result.left + result.width); let bottomOffset = this.areaRect.size.height - (result.top + result.height); let alignedCenter; //   if(this.areaRect.size.width - result.width &gt; 1){ //align center X alignedCenter = tr.getOrigins({x: result.left + result.width/2, y: this.areaRect.center.y}); }else{ //align left if(result.left &gt; 0){ alignedCenter = tr.getOrigins({x: result.left + this.areaRect.center.x, y: this.areaRect.center.y}); //align right }else if(rightOffset &gt; 0){ alignedCenter = tr.getOrigins({x: this.areaRect.center.x - rightOffset, y: this.areaRect.center.y}); } } if(alignedCenter){ this.transform.center = alignedCenter; this.transform.x = this.areaRect.center.x - alignedCenter.x; this.transform.y = this.areaRect.center.y - alignedCenter.y; tr.init(this.transform.center, this.matrix); } //   if(this.areaRect.size.height - result.height &gt; 1){ //align center Y alignedCenter = tr.getOrigins({x: this.areaRect.center.x, y: result.top + result.height/2}); }else{ //align top if(result.top &gt; 0){ alignedCenter = tr.getOrigins({x: this.areaRect.center.x, y: result.top + this.areaRect.center.y}); //align bottom }else if(bottomOffset &gt; 0){ alignedCenter = tr.getOrigins({x: this.areaRect.center.x, y: this.areaRect.center.y - bottomOffset}); } } if(alignedCenter){ this.transform.center = alignedCenter; this.transform.x = this.areaRect.center.x - alignedCenter.x; this.transform.y = this.areaRect.center.y - alignedCenter.y; tr.init(this.transform.center, this.matrix); } },</span></span></code> </pre><br></div></div><br>  Durch die Ausrichtung wird das Bild an den Rändern des Zuschnitts „aufgeklebt“, wodurch leere Felder vermieden werden. <br><br><h3>  Vorschau-Komponente </h3><br>  Die Hauptaufgabe dieser Komponente besteht darin, das Bild anzuzeigen, Transformationen anzuwenden und auf die Bewegung der Maustaste über dem Bild zu reagieren.  Bei der Berechnung des Offsets aktualisieren wir die Parameter <b>transform.x</b> und <b>transform.y</b> . Am Ende der Bewegung lösen wir das <b>verschobene</b> Ereignis aus und teilen der Edit-Komponente mit, dass wir die Position des Transformationszentrums neu berechnen und transform.x und transform.y anpassen müssen. <br><br><div class="spoiler">  <b class="spoiler_title">Vorschau der Komponentenvorlage:</b> <div class="spoiler_text">  &lt;div ref = "area" class = "edit-zone" <br>  @ mousedown = "onMoveStart" <br>  @ touchstart = "onMoveStart" <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">mouseup</a> = "onMoveEnd" <br>  @ touchend = "onMoveEnd" <br>  @ mousemove = "onMove" <br>  @ touchmove = "onMove"&gt; <br>  &lt;img <br>  v-if = "Bild" <br>  ref = "Bild" <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">load</a> = "imageLoaded" <br>  : src = "Bild" <br>  : style = "{'transform': transformStyle, 'transform-origin': transformOrigin}"&gt; <br></div></div><br>  Die Funktionalität des Editors ist sauber vom Hauptprojekt getrennt und liegt <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> . <br><br>  Ich hoffe, dieses Material wird für Sie nützlich sein.  Vielen Dank! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de417697/">https://habr.com/ru/post/de417697/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de417683/index.html">Veralteter Code - Code von Drittanbietern</a></li>
<li><a href="../de417685/index.html">Skillbox Friday Webinars: Kostenloses Weiterlernen</a></li>
<li><a href="../de417687/index.html">Asymmetrie des Lebens</a></li>
<li><a href="../de417689/index.html">Mobio spricht mit Appnext CEO über CPI-Markt und Trends bei mobilen Anwendungen</a></li>
<li><a href="../de417691/index.html">Unser Bücherregal ist ein C # -Programmierer. Was ist mit dir?</a></li>
<li><a href="../de417699/index.html">Western Digital schließt eine weitere Festplattenfabrik aufgrund geringerer Nachfrage</a></li>
<li><a href="../de417701/index.html">Von einfachen Skripten bis hin zu Do-it-yourself-Client-Server-Anwendungen auf WCF: Warum ich gerne in CM arbeite</a></li>
<li><a href="../de417703/index.html">Netzwerkcode Age of Empires: 1.500 Bogenschützen pro 28,8-kbit / s-Modem</a></li>
<li><a href="../de417705/index.html">Wie ein Grafikkartenhersteller die Rentabilität des GPU-Mining beeinflusst</a></li>
<li><a href="../de417709/index.html">Wo und wie bewerten Entwickler ihre Arbeitgeber? Unternehmensbewertungsdienste in der IT-Branche</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>