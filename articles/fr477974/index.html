<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèΩ‚Äç‚öïÔ∏è üî§ üß† Vivado: mode Picasso üë©‚Äçüë©‚Äçüëß ü•† üèÇüèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Annotation 


 Folie tous √¢ges soumis 


 Lors de la conception de modules sur FPGA, l'id√©e d'une utilisation pas tout √† fait standard de l'environnem...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Vivado: mode Picasso</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/477974/"><h2 id="annotaciya">  Annotation </h2><br><p>  <em>Folie tous √¢ges soumis</em> </p><br><p>  Lors de la conception de modules sur FPGA, l'id√©e d'une utilisation pas tout √† fait standard de l'environnement de conception lui-m√™me et des outils qu'il fournit pour la conception vient parfois √† l'esprit.  Dans ce court article, nous verrons comment, √† l'aide de l'outil de gestion environnementale impl√©ment√© sur Tcl, nous pouvons litt√©ralement dessiner des photographies, des peintures, des portraits et des memesics sur le FPGA. </p><br><p>  Un tel ¬´itin√©raire de conception¬ª inhabituel a √©t√© mis en place il y a un an et demi, mais ce n'est que maintenant que l'id√©e est venue de l'organiser sous la forme d'une note, dans laquelle il est peu pratique d'utiliser des scripts Tcl pour g√©rer l'environnement de conception, en l'occurrence Vivado.  Cependant, avec des modifications mineures, tout peut facilement √™tre adapt√© √† d'autres environnements de d√©veloppement, par exemple Quartus II. </p><br><p><img src="https://habrastorage.org/webt/32/h7/xr/32h7xruuubk_cai37jn18jgf8ca.png"></p><a name="habracut"></a><br><h2 id="vvedenie">  Pr√©sentation </h2><br><p>  Bien s√ªr, l'id√©e n'est pas venue de nulle part.  Son apparition a √©t√© favoris√©e par mon emploi √† l'√©poque dans des projets de traitement d'images et de gestion de flux vid√©o sur FPGA.  Il arrive √† tout le monde qu'en s'asseyant sur une solution √† un probl√®me, chaque h√©r√©sie vient √† l'esprit pourquoi cela ne fonctionne pas ou fonctionne exactement comme il se doit, mais pas comme nous nous y attendons. </p><br><p>  Pour r√©soudre le probl√®me, j'ai d√ª recourir √† l'un des outils de l'environnement Vivado, √† savoir colorier les composants et modules correspondants dans le projet apr√®s le placement et le tra√ßage et regarder les chronogrammes sans fin. </p><br><p>  En cons√©quence, j'ai peint plusieurs blocs logiques configurables de CLB dans diff√©rentes couleurs, et cela m'est apparu - ce sont les pixels de l'image, donc je peux essayer de dessiner quel fil l'image est, en faisant correspondre chaque pixel avec son propre CLB color√©? ... eh bien, √ßa a commenc√© </p><br><h2 id="chem-nam-pomozhet-tcl">  Comment Tcl va-t-il nous aider? </h2><br><p>  Supposons que nous ayons une petite image de taille 100x100 pixels.  Supposons maintenant que pour colorer le CLB, nous devons faire deux choses: s√©lectionner le CLB et s√©lectionner la couleur.  Dans l'image 100x100, nous avons 10 000 pixels et faire une telle coloration manuellement est assez fastidieux, d'autant plus que les actions sont les m√™mes et r√©p√©titives.  Ainsi, peindre manuellement chaque CLB n'est pas une option et vous devez utiliser Tcl et des scripts.  Mais par o√π commencer? </p><br><p>  La premi√®re chose qui m'est venue √† l'esprit a √©t√© de trouver la bonne √©quipe responsable de l'attribution de la couleur √† l'√©l√©ment s√©lectionn√©.  Heureusement, lors de l'ex√©cution manuelle des actions, Vivado affiche les commandes Tcl appropri√©es sur la console, et il semble que le probl√®me de recherche devrait √™tre r√©solu le plus rapidement possible.  Mais ce n'√©tait pas l√†.  Vivado ignore simplement la sortie de la commande pour mettre en √©vidence les √©l√©ments s√©lectionn√©s, et la seule option pour trouver la commande, et j'√©tais absolument s√ªr qu'elle devrait l'√™tre, est de plonger t√™te baiss√©e dans le guide Tcl disponible dans Vivado, et cela fait presque 2000 pages [1]. </p><br><p>  Ne d√©sesp√©rez pas, le mot cl√© "highlight" a rapidement trouv√© la commande correspondante, qui s'appelle highlight_objects.  Cette commande met en √©vidence les objets sp√©cifi√©s ou s√©lectionn√©s dans une couleur sp√©cifique, sp√©cifi√©e √† l'aide d'options.  Les options de la commande highlight_objects sont les suivantes: </p><br><p>  - <em>color_index</em> - (facultatif) la valeur valide de l'argument option doit √™tre un nombre compris entre 1 et 20. La couleur dans laquelle l'objet s√©lectionn√© sera peint est d√©termin√©e par son num√©ro de s√©rie dans la palette de couleurs pr√©d√©finie, qui se trouve dans Couleurs ‚Üí Surbrillance dans la section de menu Outils ‚Üí Param√®tres . <br>  - <em>rgb</em> - (facultatif) d√©finit la couleur de l'objet s√©lectionn√© au format RVB <br>  - <em>couleur</em> - (facultatif) met en surbrillance l'objet s√©lectionn√© dans l'une des couleurs suivantes: rouge, vert, bleu, magenta, jaune, cyan et orange </p><br><p>  Les options restantes de la commande se rapportent aux param√®tres syst√®me de la commande elle-m√™me et ne nous seront pas utiles.  Cependant, lorsque vous utilisez la commande highlight_objects, gardez √† l'esprit que deux ou plusieurs options de coloration ne peuvent pas √™tre appliqu√©es en m√™me temps. <br>  De toute √©vidence, une option qui d√©finit une couleur arbitraire au format RVB convient √† notre t√¢che - l'option RVB </p><br><p>  Maintenant, il ne serait pas mauvais d'obtenir les valeurs en pixels de l'image, mais je n'ai pas pu trouver l'image qui serait pr√©sent√©e au format bitmap.  En ouvrant chaque fichier avec un √©diteur de texte, il n'√©tait pas possible de trouver des lignes avec une valeur en pixels.  Bien s√ªr, je n'ai pas √©crit de programme de conversion d'images au format bitmap, mais j'ai simplement grimp√© sur Internet pour chercher une solution toute faite.  La recherche n'a pas √©t√© trop longue.  Il s'est av√©r√© que la t√¢che de convertir une image au format bitmap (c'est-√†-dire lorsque nous voyons les valeurs en pixels d'une image non compress√©e) est tout √† fait pertinente (probablement, une telle t√¢che est confi√©e aux √©tudiants-programmeurs comme devoir pour les travaux de laboratoire).  Une courte recherche a r√©sult√© sur github, d'o√π le programme Image2Bitmap a √©t√© t√©l√©charg√© [2]. </p><br><p>  Le programme n√©cessite une entr√©e d'image et g√©n√®re des valeurs de pixels sous la forme d'un tableau s avec des valeurs de pixels hexad√©cimales au format RGB565.  Ce format indique que le codage couleur du composant rouge utilise 5 bits, 6 bits verts et 5 bits bleus.  Cela s'est av√©r√© suffisant pour le travail.  Maintenant, tout ce qui est n√©cessaire est de mapper les valeurs obtenues directement sur les sections peintes (tranche). </p><br><h2 id="vybor-plis">  S√©lection FPGA </h2><br><p>  Plus le FPGA est grand, plus ses ressources sont logiques, et donc le ¬´champ de cr√©ativit√©¬ª lui-m√™me est plus grand et l'image sera plus claire.  Il convient de noter tout de suite que la ¬´d√©coration¬ª est un processus assez long et peut prendre un temps d√©cent, selon la taille de l'image.  Pour les tests, il vaut la peine de choisir un FPGA avec une petite quantit√© de ressources.  Par exemple, la famille Spartan-7.  Apr√®s le test, vous pouvez changer le FPGA en plus "gras", par exemple, de la famille Ultrascale +. </p><br><ol><li><p>  On d√©marre Vivado et on cr√©e le projet </p><br></li><li><p>  Nous s√©lectionnons le cristal xc7s6cpga196-2, sur lequel nous allons dessiner l'image de test <br><br><img src="https://habrastorage.org/webt/vk/zj/do/vkzjdo6hklo098bevkxuz7qvjhu.png"></p><br></li><li><p>  Pour afficher le dessin, nous devons ouvrir l'image du cristal lui-m√™me, cependant, cela peut √™tre fait apr√®s la phase de synth√®se ou √©labor√©.  Dans Vivado, pour cela, nous devons cr√©er un module factice dans n'importe quelle langue. <br><br><img src="https://habrastorage.org/webt/nb/ss/7k/nbss7kzptxr8ify9ot4ctpijx8u.png"></p><br></li><li><p>  Ajoutez un script au projet Tcl. <br>  a.  Pour ce faire, cr√©ez un fichier avec l'extension ¬´.tcl¬ª dans le dossier avec le projet, par exemple, ¬´fpga_painter.tcl¬ª <br><br><img src="https://habrastorage.org/webt/x9/k8/is/x9k8ismf9abat7cjtkl6kqto-lg.png"></p><br><p>  b.  Acc√©dez √† Vivado et ajoutez ce fichier au projet. <br><br><img src="https://habrastorage.org/webt/zs/we/gd/zswegdciaq_qyj-8x56ar2wfzom.png"></p><br><p>  c.  Apr√®s avoir mis √† jour la hi√©rarchie du projet, d√©sactivez le fichier. <br><br><img src="https://habrastorage.org/webt/ut/h6/-p/uth6-puy3u6amils-egmrxs8cqo.png"></p><br></li><li><p>  Apr√®s avoir cr√©√© le module, il appara√Ætra dans la fen√™tre de hi√©rarchie du projet et le bouton Ouvrir la conception √©labor√©e sera disponible pour nous.  Poussez-le. <br><br><img src="https://habrastorage.org/webt/g8/cy/mk/g8cymkxi_hdpdwm32k7mld50t_s.png"></p><br></li><li><p>  Apr√®s avoir ouvert Elaborate Design, acc√©dez √† Fen√™tre ‚Üí Appareil.  Un affichage du champ de notre FPGA appara√Ætra. <br><br><img src="https://habrastorage.org/webt/sz/_n/cd/sz_ncdlckd-5rqbvicyshqmulxu.png"></p><br></li><li><p>  La pr√©paration est termin√©e, nous commen√ßons √† √©crire un script. </p><br></li></ol><br><h2 id="opredelenie-parametrov-i-procedur">  D√©finition des param√®tres et des proc√©dures </h2><br><h3 id="testovoe-izobrazhenie">  Image de test </h3><br><p>  Commen√ßons par d√©boguer l'algorithme / le code en tant que tel sur une petite image, disons 5x3, puis ex√©cutons-le ¬´au maximum¬ª. </p><br><ol><li><p>  Ouvrez Paint, limitez le champ d'image √† 5x3 pixels (vous pouvez prendre toutes les couleurs).  Enregistrez le fichier sous ¬´5x3.png¬ª <br><br><img src="https://habrastorage.org/webt/nh/vg/l6/nhvgl6sub5ywa74hvrn-p5xq8hm.png"></p><br></li><li><p>  Ouvrez le programme Image2Bitmap et convertissez notre image en un tableau RGB565. <br><br><img src="https://habrastorage.org/webt/aq/vb/u9/aqvbu9m6zhzrjakwux_1clytapk.png"></p><br></li><li><p>  Apr√®s la conversion, le programme nous donnera un tableau de 15 pixels </p><br></li></ol><br><pre><code class="plaintext hljs">*uint16_t image = { 0xf800, 0x07e0, 0x001f, 0x8410, 0x8010, 0xfbe4, 0xff80, 0x2589, 0x051d, 0x3a59, 0xa254, 0xbbca, 0xfd79, 0xef36, 0x9edd, };*</code> </pre> <br><h3 id="podgotovka-dannyh">  Pr√©paration des donn√©es </h3><br><p>  Avant de proc√©der au traitement des pixels, nous transformons les donn√©es g√©n√©r√©es par Image2Bitmap en une simple liste dans laquelle les valeurs hexad√©cimales des pixels sont √©crites.  Nous allons copier les donn√©es du programme et les enregistrer dans le fichier pic_array.dat, qui devrait se trouver dans le dossier du projet. </p><br><p><img src="https://habrastorage.org/webt/1b/xm/dj/1bxmdjjzyzhrqxqchlngx8qmpiu.png"></p><br><p>  Lors du d√©marrage du script cr√©√©, nous devons traiter le fichier "pic_array.dat".  Il convient de noter que le nombre d'√©l√©ments dans la ligne retourn√©e par Image2Bitmap ne correspond pas au nombre de pixels dans la ligne de l'image convertie, pour cette raison, nous allons cr√©er une liste s√©par√©e de "pixels". </p><br><p><img src="https://habrastorage.org/webt/rj/xl/pc/rjxlpcpleobp3ekmfwp4z_sofe0.png"></p><br><p>  Lors de la lecture d'un fichier, vous devez ignorer la premi√®re ligne "uint16_t image = {" et la derni√®re "};".  Pour ignorer la premi√®re ligne lors de la lecture d'un fichier, placez simplement la lecture de la ligne avant le cycle de lecture du fichier entier. </p><br><p><img src="https://habrastorage.org/webt/p0/j0/cl/p0j0clka4-dt-ggaskumsj5zkd8.png"></p><br><p>  Apr√®s avoir lu l'int√©gralit√© du fichier, nous verrons que la derni√®re ligne du fichier ¬´};¬ª est devenue un √©l√©ment de la liste, qui est simplement supprim√©. </p><br><p><img src="https://habrastorage.org/webt/zm/sc/ao/zmscaotma7373mbpnknpxh4xn5m.png"></p><br><p>  Ceci termine la formation de la liste avec des valeurs de pixels hexad√©cimaux.  Commen√ßons maintenant √† les traiter. </p><br><h3 id="opredelenie-razmera-izobrazheniya">  Dimensionnement de l'image </h3><br><p>  Encore une fois, jetez un ≈ìil au champ FPGA et √† l'image.  Le champ FPGA est divis√© en sections (SLICE), qui ont les coordonn√©es horizontales "X" et "Y" verticales correspondantes.  Par exemple, SLICE_X6Y36. </p><br><p><img src="https://habrastorage.org/webt/hm/iz/du/hmizdutpp0x-mieimj5ma07rgnk.png"></p><br><p>  L'image, √† son tour, a des pixels, √©galement avec des coordonn√©es horizontales et verticales.  Lors de la superposition de l'image sur le FPGA, nous devons combiner le pixel sup√©rieur gauche avec la section sup√©rieure gauche du FPGA.  Dans ce cas, le cristal s√©lectionn√© a une section sup√©rieure avec la coordonn√©e X0Y49. </p><br><p><img src="https://habrastorage.org/webt/0h/ip/b-/0hipb-wldjghc-p2xs5-uafdtxe.png"></p><br><p>  La taille de l'image sera d√©termin√©e par le nombre de sections du FPGA horizontalement et verticalement.  Pour le cristal s√©lectionn√©, la coordonn√©e horizontale des sections varie de X0 √† X131 et la coordonn√©e verticale de Y49 √† Y0.  Il s'ensuit que th√©oriquement, nous pouvons dessiner une image de taille 132x50 sur le cristal s√©lectionn√©. </p><br><h3 id="nachalnye-parametry">  Param√®tres initiaux </h3><br><p>  Pour r√©sumer: les param√®tres initiaux de notre script seront: </p><br><ol><li><p>  X position de d√©part de la section: nom de variable start_x <br><br><img src="https://habrastorage.org/webt/l8/qr/gh/l8qrghklltffibctylxjcczbwqk.png"></p><br></li><li><p>  Position de d√©but de section sur l'axe y: nom de variable start_y <br><br><img src="https://habrastorage.org/webt/yf/23/kf/yf23kfl9uxrt5zekli3n16zpzew.png"></p><br></li><li><p>  Largeur de l'image (pour l'image de test est 5): variable w <br><br><img src="https://habrastorage.org/webt/cs/oi/un/csoiunryjazlcstfmab_g3ee9r0.png"></p><br></li><li><p>  Hauteur de l'image (pour l'image de test est 3): variable h <br><br><img src="https://habrastorage.org/webt/oz/d2/09/ozd209wjyznbgt2uvcb7fvrhd2c.png"></p><br></li></ol><br><h3 id="korrektirovka-cveta-piksela">  R√©glage de la couleur des pixels </h3><br><p>  Image2Bitmap fournit un tableau de pixels au format RGB565 sous la forme d'un nombre de 16 bits √©crit au format hexad√©cimal.  Nous devons: </p><br><ol><li><p>  Convertissez la valeur en pixels au format binaire.  Cela peut √™tre fait en utilisant la proc√©dure hex2bin, qui peut √™tre trouv√©e dans [3] <br><br><img src="https://habrastorage.org/webt/fv/su/mt/fvsumtam5vrnkkm0uucn5vx4brc.png"></p><br></li><li><p>  Faites correspondre les bits aux composants de couleur correspondants: <br>  ‚Ä¢ La composante rouge de R [15:11] <br><br><img src="https://habrastorage.org/webt/tj/mh/2k/tjmh2k-ihvuroxwduqm6_ugqmxi.png"></p><br><p>  ‚Ä¢ Composant vert G [10: 5] <br><br><img src="https://habrastorage.org/webt/y6/g0/yd/y6g0ydaosk3gkzzlylaenkh_oxm.png"></p><br><p>  ‚Ä¢ Composant bleu B [4: 0] <br><br><img src="https://habrastorage.org/webt/3i/97/vh/3i97vhrm4ivfevdr-xqwjzi9bzg.png"></p><br></li></ol><br><p>  <em>Explication: l'ordre est modifi√© car la proc√©dure hex2bin renvoie une cha√Æne dans laquelle la num√©rotation des √©l√©ments commence √† 0, c'est-√†-dire que le 15e bit correspond au 0e √©l√©ment de la ligne et le 0e bit correspond au 15e √©l√©ment de la ligne</em> </p><br><ol><li><p>  Convertissez la valeur du composant couleur de binaire en d√©cimal.  Cela peut √™tre fait en utilisant la proc√©dure bin2dec, qui peut √™tre trouv√©e [3]: <br><br><img src="https://habrastorage.org/webt/hc/1n/em/hc1nemkiw4byzq2yc-vka0gckmq.png"><br><br><img src="https://habrastorage.org/webt/hi/td/uy/hitduy-sypn4d7bv7kidwic2g2m.png"></p><br></li><li><p>  Convertissez les valeurs de pixels du format RGB565 au format RGB888, pour un affichage d'image plus fluide.  Cela se fait en utilisant deux listes, qui peuvent √™tre trouv√©es dans [4].  Comment √ßa marche: <br>  ‚Ä¢ La r√©solution des composantes de couleur R et B est de 5 bits.  En prenant la valeur d√©cimale du composant, nous la comparons avec la position du nombre √©crit dans la liste t5, et la valeur du composant devient la valeur du tableau <br><br><img src="https://habrastorage.org/webt/lk/vw/_a/lkvw_abrbpyeylfdoggm5pbpxns.png"><br><br><img src="https://habrastorage.org/webt/ao/mw/tv/aomwtv2q6hz9bg-_lmszmig7euq.png"><br><br><img src="https://habrastorage.org/webt/uy/qh/16/uyqh16vi-qkh9vpfrzcovq-zugs.png"></p><br><p>  ‚Ä¢ De m√™me pour le composant G et le tableau t6 <br><br><img src="https://habrastorage.org/webt/ti/is/lh/tiislhhogy2om7xxhvj_676dm5s.png"><br><br><img src="https://habrastorage.org/webt/pa/bh/3d/pabh3dqnk_3sk3sn6zt5big0t0e.png"></p><br></li></ol><br><h3 id="opredelenie-nalichiya-sekcii">  Disponibilit√© des sections </h3><br><p>  √Ä l'int√©rieur de certains FPGA, il existe des ressources sp√©ciales ou des vides qui peuvent perturber la num√©rotation s√©quentielle des coordonn√©es de section.  Par exemple, dans la figure ci-dessous, vous pouvez voir que la num√©rotation des sections est interrompue (cristal xc7s50) <br><br><img src="https://habrastorage.org/webt/uq/er/yq/uqeryqyfckyqezufafrp-vrxbgi.png"></p><br><p>  Pour cette raison, avant de colorer, nous v√©rifions d'abord l'existence de la section.  S'il existe, peignez, s'il n'existe pas, passez au pixel suivant <br><br><img src="https://habrastorage.org/webt/zx/a8/lt/zxa8lt_n0pb6o7s3ztrfozkuu2k.png"></p><br><h3 id="okrashivanie-sekcii">  Coloration de la section </h3><br><p>  Couleur de section d√©finie, section v√©rifi√©e.  Maintenant, la couleur doit √™tre attribu√©e aux sections √† l'aide de la commande highlight_objects: <br><br><img src="https://habrastorage.org/webt/5i/fv/lp/5ifvlpcm5e70ur9sg7mufhmh4e0.png"></p><br><h3 id="vektor-dvuhmernyy-massiv">  Vecteur ‚Üí R√©seau bidimensionnel </h3><br><p>  Au d√©but, nous avons converti les donn√©es d'image en une liste de pixels, qui stocke un balayage progressif de l'image.  Pour organiser l'image, nous introduisons deux variables, x et y, qui correspondront √† la position des pixels dans l'image.  En lisant s√©quentiellement les √©l√©ments de la liste de pixels, nous formerons une image √† l'aide de deux boucles for: une par le nombre de lignes, la seconde par la position du pixel dans la ligne <br><br><img src="https://habrastorage.org/webt/fk/pu/wa/fkpuwau81hpppxfxkgvvzuvdtr0.png"><br><br><img src="https://habrastorage.org/webt/hf/bj/jh/hfbjjhugkpxwqd2zdtrn0seyzse.png"></p><br><h3 id="polnyy-listing-skripta">  Liste compl√®te des scripts </h3><br><div class="spoiler">  <b class="spoiler_title">Liste de Fpga_painter.tcl</b> <div class="spoiler_text"><pre> <code class="vhdl hljs">#https://tcl.tk/ #http://www.tune-it.ru/web/il/home/-/blogs/-rgb888-&lt;-&gt;-rgb565----- #https://github.com/FoxExe/Image2Bitmap/releases/tag/<span class="hljs-number"><span class="hljs-number">0.5</span></span> #        set start_x <span class="hljs-number"><span class="hljs-number">0</span></span>; # set start_y <span class="hljs-number"><span class="hljs-number">49</span></span>; # set w <span class="hljs-number"><span class="hljs-number">5</span></span>; #  (   ) set h <span class="hljs-number"><span class="hljs-number">3</span></span>; #  ( ) proc hex2bin hex { set t [list <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0001</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">0010</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">0011</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">0100</span></span> \ <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">0101</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span> <span class="hljs-number"><span class="hljs-number">0110</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-number"><span class="hljs-number">0111</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-number"><span class="hljs-number">1000</span></span> <span class="hljs-number"><span class="hljs-number">9</span></span> <span class="hljs-number"><span class="hljs-number">1001</span></span> \ a <span class="hljs-number"><span class="hljs-number">1010</span></span> b <span class="hljs-number"><span class="hljs-number">1011</span></span> c <span class="hljs-number"><span class="hljs-number">1100</span></span> d <span class="hljs-number"><span class="hljs-number">1101</span></span> e <span class="hljs-number"><span class="hljs-number">1110</span></span> f <span class="hljs-number"><span class="hljs-number">1111</span></span> \ A <span class="hljs-number"><span class="hljs-number">1010</span></span> B <span class="hljs-number"><span class="hljs-number">1011</span></span> C <span class="hljs-number"><span class="hljs-number">1100</span></span> D <span class="hljs-number"><span class="hljs-number">1101</span></span> E <span class="hljs-number"><span class="hljs-number">1110</span></span> F <span class="hljs-number"><span class="hljs-number">1111</span></span>] regsub {^<span class="hljs-number"><span class="hljs-number">0</span></span>[xX]} $hex {} hex <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> <span class="hljs-keyword"><span class="hljs-keyword">map</span></span> -nocase $t $hex] } proc bin2dec bin { #returns <span class="hljs-built_in"><span class="hljs-built_in">integer</span></span> equivalent <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> $bin set res <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> {$bin == <span class="hljs-number"><span class="hljs-number">0</span></span>} { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> } elseif {[<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> match -* $bin]} { set sign - set bin [<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> <span class="hljs-keyword"><span class="hljs-keyword">range</span></span> $bin[set bin {}] <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>] } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { set sign {} } foreach i [split $bin {}] { set res [expr {$res*<span class="hljs-number"><span class="hljs-number">2</span></span>+$i}] } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $sign$res } ############### #RGB565 -&gt; RGB888 using tables set t5 [list <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">25</span></span> <span class="hljs-number"><span class="hljs-number">33</span></span> <span class="hljs-number"><span class="hljs-number">41</span></span> <span class="hljs-number"><span class="hljs-number">49</span></span> <span class="hljs-number"><span class="hljs-number">58</span></span> <span class="hljs-number"><span class="hljs-number">66</span></span> <span class="hljs-number"><span class="hljs-number">74</span></span> <span class="hljs-number"><span class="hljs-number">82</span></span> <span class="hljs-number"><span class="hljs-number">90</span></span> <span class="hljs-number"><span class="hljs-number">99</span></span> <span class="hljs-number"><span class="hljs-number">107</span></span> <span class="hljs-number"><span class="hljs-number">115</span></span> <span class="hljs-number"><span class="hljs-number">123</span></span> <span class="hljs-number"><span class="hljs-number">132</span></span>\ <span class="hljs-number"><span class="hljs-number">140</span></span> <span class="hljs-number"><span class="hljs-number">148</span></span> <span class="hljs-number"><span class="hljs-number">156</span></span> <span class="hljs-number"><span class="hljs-number">165</span></span> <span class="hljs-number"><span class="hljs-number">173</span></span> <span class="hljs-number"><span class="hljs-number">181</span></span> <span class="hljs-number"><span class="hljs-number">189</span></span> <span class="hljs-number"><span class="hljs-number">197</span></span> <span class="hljs-number"><span class="hljs-number">206</span></span> <span class="hljs-number"><span class="hljs-number">214</span></span> <span class="hljs-number"><span class="hljs-number">222</span></span> <span class="hljs-number"><span class="hljs-number">230</span></span> <span class="hljs-number"><span class="hljs-number">239</span></span> <span class="hljs-number"><span class="hljs-number">247</span></span> <span class="hljs-number"><span class="hljs-number">255</span></span>] set t6 [list <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span> <span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-number"><span class="hljs-number">28</span></span> <span class="hljs-number"><span class="hljs-number">32</span></span> <span class="hljs-number"><span class="hljs-number">36</span></span> <span class="hljs-number"><span class="hljs-number">40</span></span> <span class="hljs-number"><span class="hljs-number">45</span></span> <span class="hljs-number"><span class="hljs-number">49</span></span> <span class="hljs-number"><span class="hljs-number">53</span></span> <span class="hljs-number"><span class="hljs-number">57</span></span> <span class="hljs-number"><span class="hljs-number">61</span></span> <span class="hljs-number"><span class="hljs-number">65</span></span> <span class="hljs-number"><span class="hljs-number">69</span></span>\ <span class="hljs-number"><span class="hljs-number">73</span></span> <span class="hljs-number"><span class="hljs-number">77</span></span> <span class="hljs-number"><span class="hljs-number">81</span></span> <span class="hljs-number"><span class="hljs-number">85</span></span> <span class="hljs-number"><span class="hljs-number">89</span></span> <span class="hljs-number"><span class="hljs-number">93</span></span> <span class="hljs-number"><span class="hljs-number">97</span></span> <span class="hljs-number"><span class="hljs-number">101</span></span> <span class="hljs-number"><span class="hljs-number">105</span></span> <span class="hljs-number"><span class="hljs-number">109</span></span> <span class="hljs-number"><span class="hljs-number">113</span></span> <span class="hljs-number"><span class="hljs-number">117</span></span> <span class="hljs-number"><span class="hljs-number">121</span></span> <span class="hljs-number"><span class="hljs-number">125</span></span> <span class="hljs-number"><span class="hljs-number">130</span></span> <span class="hljs-number"><span class="hljs-number">134</span></span> <span class="hljs-number"><span class="hljs-number">138</span></span>\ <span class="hljs-number"><span class="hljs-number">142</span></span> <span class="hljs-number"><span class="hljs-number">146</span></span> <span class="hljs-number"><span class="hljs-number">150</span></span> <span class="hljs-number"><span class="hljs-number">154</span></span> <span class="hljs-number"><span class="hljs-number">158</span></span> <span class="hljs-number"><span class="hljs-number">162</span></span> <span class="hljs-number"><span class="hljs-number">166</span></span> <span class="hljs-number"><span class="hljs-number">170</span></span> <span class="hljs-number"><span class="hljs-number">174</span></span> <span class="hljs-number"><span class="hljs-number">178</span></span> <span class="hljs-number"><span class="hljs-number">182</span></span> <span class="hljs-number"><span class="hljs-number">186</span></span> <span class="hljs-number"><span class="hljs-number">190</span></span> <span class="hljs-number"><span class="hljs-number">194</span></span> <span class="hljs-number"><span class="hljs-number">198</span></span>\ <span class="hljs-number"><span class="hljs-number">202</span></span> <span class="hljs-number"><span class="hljs-number">206</span></span> <span class="hljs-number"><span class="hljs-number">210</span></span> <span class="hljs-number"><span class="hljs-number">215</span></span> <span class="hljs-number"><span class="hljs-number">219</span></span> <span class="hljs-number"><span class="hljs-number">223</span></span> <span class="hljs-number"><span class="hljs-number">227</span></span> <span class="hljs-number"><span class="hljs-number">231</span></span> <span class="hljs-number"><span class="hljs-number">235</span></span> <span class="hljs-number"><span class="hljs-number">239</span></span> <span class="hljs-number"><span class="hljs-number">243</span></span> <span class="hljs-number"><span class="hljs-number">247</span></span> <span class="hljs-number"><span class="hljs-number">251</span></span> <span class="hljs-number"><span class="hljs-number">255</span></span>] ############### #  .         set script_path [get_property DIRECTORY [get_projects *]] cd $script_path #       set fId [<span class="hljs-keyword"><span class="hljs-keyword">open</span></span> {pic_array.dat} r] # ,       set pixels [list ] #    .    gets $fId <span class="hljs-literal"><span class="hljs-literal">line</span></span> #  .     . <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> {[gets $fId <span class="hljs-literal"><span class="hljs-literal">line</span></span>] &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>} { set pixels [concat $pixels $<span class="hljs-literal"><span class="hljs-literal">line</span></span>] } #   pixels   <span class="hljs-string"><span class="hljs-string">"};"</span></span>,    Image2Bitmap set pixels [lrange $pixels <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>-<span class="hljs-number"><span class="hljs-number">1</span></span>] #    pixels set pix_num <span class="hljs-number"><span class="hljs-number">0</span></span>; #      <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> {set y <span class="hljs-number"><span class="hljs-number">0</span></span>} { $y &lt; $h } {incr y} { #    ( ) set Y [expr {$start_y - $y}] #    <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> {set x <span class="hljs-number"><span class="hljs-number">0</span></span>} { $x &lt; $w } {incr x } { set pix_val [lindex $pixels $pix_num]; incr pix_num #   binary  set pix_bin [hex2bin $pix_val] ; #     set R_bin [<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> <span class="hljs-keyword"><span class="hljs-keyword">range</span></span> $pix_bin <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>] #    set R_dec [ bin2dec $R_bin ] #       t5 set R [lindex $t5 $R_dec] #       set G_bin [<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> <span class="hljs-keyword"><span class="hljs-keyword">range</span></span> $pix_bin <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>] set G [lindex $t6 [ bin2dec $G_bin ]] set B_bin [<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> <span class="hljs-keyword"><span class="hljs-keyword">range</span></span> $pix_bin <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">15</span></span>] set B [lindex $t5 [ bin2dec $B_bin ] ] #    set X [expr {$start_x + $x}] #,      set cond [get_sites <span class="hljs-string"><span class="hljs-string">"SLICE_X${X}Y${Y}"</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> {$cond ne <span class="hljs-string"><span class="hljs-string">""</span></span>} { #  highlight_objects [get_sites <span class="hljs-string"><span class="hljs-string">"SLICE_X${X}Y${Y}"</span></span>] -rgb <span class="hljs-string"><span class="hljs-string">"$R $G $B"</span></span> } puts <span class="hljs-string"><span class="hljs-string">"X = $XY = $Y; $R $G $B"</span></span> } } close $fId puts <span class="hljs-string"><span class="hljs-string">"Complete::Check FPGA field::Window-&gt;Device"</span></span></code> </pre> </div></div><br><h2 id="testirovanie">  Test </h2><br><ol><li><p>  Pour commencer les tests, assurez-vous que le champ FPGA est disponible, c'est-√†-dire  l'une des √©tapes de conception est ouverte: √©labor√©e, synth√©tis√©e ou mise en ≈ìuvre.  Pour afficher le champ FPGA, s√©lectionnez Fen√™tre ‚Üí P√©riph√©rique <br><br><img src="https://habrastorage.org/webt/sz/_n/cd/sz_ncdlckd-5rqbvicyshqmulxu.png"></p><br></li><li><p>  Ouvrez le fichier pic_array.dat et copiez les donn√©es d'Image2Bitmap dans le fichier.  Enregistrer le fichier <br><br><img src="https://habrastorage.org/webt/gf/bo/qk/gfboqkmege_xbatauuqznugutls.png"></p><br></li><li><p>  Ouvrons le script.  D√©finissez les coordonn√©es du pixel sup√©rieur gauche 0 et 49, la taille de l'image de test est de 5 par 3 et ex√©cutez le script.  Pour ce faire, cliquez avec le bouton droit dans le champ de script et s√©lectionnez Ex√©cuter. <br><br><img src="https://habrastorage.org/webt/z6/ku/xk/z6kuxks3efxqgcg6w-ml18pwaic.png"></p><br></li><li><p>  Acc√©dez √† la console Tcl et assurez-vous que le script a √©t√© ex√©cut√©. <br><br><img src="https://habrastorage.org/webt/km/of/qr/kmofqrtlejamixfiwexviemy4ay.png"></p><br></li><li><p>  Acc√©dez √† l'onglet P√©riph√©rique et assurez-vous que les cellules sont color√©es dans la couleur appropri√©e. <br><br><img src="https://habrastorage.org/webt/xv/ba/nf/xvbanfmjcmx9lqxxofnq04wxwf0.png"></p><br></li><li><p>  Maintenant, nous pouvons prendre n'importe quelle image, la convertir √† la taille souhait√©e et remplir le champ FPGA.  Voici quelques exemples. </p><br></li></ol><br><p>  <em>PS: l'attribution de couleur personnalis√©e remplace le param√®tre de couleur par d√©faut de Vivado</em> <br><br><img src="https://habrastorage.org/webt/oz/hx/f4/ozhxf4slhbnycmhqmpfxbsb7fby.png"></p><br><h2 id="spisok-literatury">  Les r√©f√©rences </h2><br><ol><li>  UG835.  Guide de r√©f√©rence de Vivado Design Suite TclCommand </li><li>  <a href="">https://github.com/FoxExe/Image2Bitmap/releases/tag/0.5</a> </li><li>  <a href="https://tcl.tk/">https://tcl.tk</a> </li><li>  <a href="http://www.tune-it.ru/web/il/home/-/blogs/%25D0%25BF%25D1%2580%25D0%25B5%25D0%25BE%25D0%25B1%25D1%2580%25D0%25B0%25D0%25B7%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5-rgb888">http://www.tune-it.ru/web/il/home/-/blogs/conversion-rgb888</a> - &lt;-&gt; -rgb565-and-protection-mushrooms-from-fading </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr477974/">https://habr.com/ru/post/fr477974/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr477950/index.html">La premi√®re r√®gle d'antifraude est de ne parler √† personne d'antifraude</a></li>
<li><a href="../fr477956/index.html">JavaScript en 3D: une introduction √† Three.js</a></li>
<li><a href="../fr477958/index.html">Top 10 des tendances du nouveau rapport High-Tech-Tech Crime Trends 2019/2020 Group-IB</a></li>
<li><a href="../fr477964/index.html">Deux mois de l'id√©e √† la premi√®re vente: l'exp√©rience de l'√©quipe Genesis</a></li>
<li><a href="../fr477968/index.html">Falling into a Rabbit Hole: A Story about One Varnish Reboot Error - Partie 1</a></li>
<li><a href="../fr477976/index.html">Visualisation et analyse de la structure de la communaut√© √† l'aide de graphiques</a></li>
<li><a href="../fr477978/index.html">O√π regarder les meilleurs prix de l'ann√©e pour les gadgets</a></li>
<li><a href="../fr478472/index.html">Biblioth√®que du noyau Linux: noyau Linux en facteur de forme so ou dll</a></li>
<li><a href="../fr478474/index.html">Le fr√®re Pablo Escobar a √©galement sorti un smartphone flexible</a></li>
<li><a href="../fr478480/index.html">Intelligence artificielle, ITSM et, en g√©n√©ral, d'o√π vient LEAN?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>