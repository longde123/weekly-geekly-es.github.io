<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèΩ‚Äçüè´ üë©‚Äçüëß‚Äçüëß üçö M√©thode de moyenne vectorielle pour mesurer la direction du vent üë∑ üë®‚Äçüë¶ ü•ô</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Il y a un an, j'ai d√©crit une station m√©t√©o avec un instrument de mesure pour la direction et la vitesse du vent. Sur la base de l'exp√©rience de deux ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>M√©thode de moyenne vectorielle pour mesurer la direction du vent</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/423243/"> Il y a un an, j'ai <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">d√©crit une</a> station m√©t√©o avec un instrument de mesure pour la direction et la vitesse du vent.  Sur la base de l'exp√©rience de deux saisons d'exploitation, certains changements et am√©liorations y ont √©t√© apport√©s, qui y sont partiellement d√©crits dans des ajouts au texte principal. <br><br>  L'un de ces changements concerne le calcul de la direction moyenne du vent.  √Ä ma grande surprise, je n'ai rien trouv√© de raisonnable sur ce sujet sur le Web, seulement sur l'un des forums les gens eux-m√™mes ont presque pens√© √† la m√©thode de la moyenne vectorielle (mais seulement presque, ils n'ont pas r√©solu le probl√®me en termes g√©n√©raux).  Par cons√©quent, j'ai trouv√© utile de mettre ce sujet dans une publication s√©par√©e - tout √† coup, quelqu'un d'autre vous sera utile.  La m√©thode peut √™tre utilis√©e pour faire la moyenne de n'importe quelle quantit√© de vecteur, pas seulement le vent ou le courant. <br><a name="habracut"></a><br>  Notez que la m√©thode canonique pour effectuer des mesures m√©t√©orologiques du vent est la suivante: faire la moyenne du vecteur (c'est-√†-dire √† la fois la vitesse et la direction) sur 10 minutes (en Russie et dans la plupart des pays du monde, il est accept√© de cette fa√ßon, disent-ils, aux √âtats-Unis et dans certains autres pays diff√©remment).  Dans ce cas, les mesures sont prises √† une hauteur de 10 m de la surface de la Terre.  Assurer tout cela dans des conditions de genou est assez difficile: on ne peut pas atteindre une hauteur de 10 m dans un espace ouvert (ne pas construire de tour sp√©ciale, loin des maisons et des arbres qui faussent le vent), et la temp√©rature avec l'humidit√© doit, au contraire, √™tre mesur√©e √† l'ombre et √† proximit√© de la surface.  Le capteur portable est transform√© d'un appareil compact en un syst√®me de mesure complet (voir photo du territoire d'une station m√©t√©o de la ville de Kirov). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b03/704/b2b/b03704b2bd492c4455aae265a659d489.jpg" alt="Station m√©t√©o √† Kirov"><br><br>  Et le r√©sultat - en moyenne 10 minutes - sera peu informatif.  Pr√®s de la surface, le vent est beaucoup plus en rafales qu'en altitude, en 10 minutes, il peut changer de vitesse et de direction vingt fois, et les informations sur ces rafales sont beaucoup plus informatives pour la personne moyenne que la valeur moyenne.  Permettez-moi de vous rappeler que le capteur de vitesse montre ici la valeur maximale de quatre mesures par cycle de 8 s, et cela s'est av√©r√© √™tre le bon choix (en fait, nous avons obtenu un capteur d'ondulation au lieu du capteur de vitesse moyenne). <br><br>  Mais la girouette s'est av√©r√©e plus morose que le capteur de vitesse.  Selon l'algorithme initial de ma station m√©t√©orologique (qui a √©t√© s√©lectionn√© en fonction de l'√©conomie d'√©nergie maximale possible), la direction a √©t√© mesur√©e une fois par cycle, c'est-√†-dire que m√™me les pulsations n'ont pas fonctionn√©: il y avait des √©chantillons al√©atoires du processus continu de suspension de la girouette d'avant en arri√®re avec une fr√©quence beaucoup plus grande qu'une fois tous les 8 et plus de 16 secondes. <br><br>  Par cons√©quent, il a √©t√© d√©cid√© de faire la moyenne de la direction du vecteur vitesse par cycle, en prenant des mesures toutes les deux secondes et en calculant la moyenne.  Et le probl√®me n'est pas qu'il puisse √™tre r√©solu avec un demi-coup de pied - les valeurs de direction ne forment pas un tableau pair de nombres qui peuvent √™tre directement ajout√©s et divis√©s (un mot est un vecteur, pas un scalaire de conneries).  Habituellement, un exemple est donn√© avec des valeurs de 1 degr√© et 359 degr√©s: il est facile de comprendre qu'en moyenne ce sera exactement 360 (ou 0, pas de diff√©rence), mais l'arithm√©tique ordinaire donnera le nombre 180 degr√©s. <br><br>  Inutile d'inventer quoi que ce soit - tout a d√©j√† √©t√© invent√© avant vous.  Le probl√®me est r√©solu par la m√©thode de la moyenne vectorielle, bien connue de ceux qui ont trait√© des mesures de vents ou de courants.  La m√©thode est essentiellement tr√®s simple: comme nous ne pouvons pas faire la moyenne directe des angles, alors faisons la moyenne des projections du vecteur sur l'axe des coordonn√©es, qui, par d√©finition, est une valeur scalaire, c'est-√†-dire peut √™tre soumise √† une arithm√©tique ordinaire sans question. <br><br>  Les projections du vecteur vent actuel W '(l'apostrophe joue le r√¥le d'un exposant) sur les axes X et Y sont wx = Wa ‚Ä¢ cos (Œ±) et wy = Wa ‚Ä¢ sin (Œ±), o√π Wa est le module du vecteur (valeur de vitesse), et Œ± - la valeur de l'angle entre le vecteur et l'axe des coordonn√©es nulles.  Si nous faisons la moyenne de ces valeurs des projections, puis reconvertissons les moyennes en un vecteur, alors nous obtenons la vraie valeur de la vitesse et de la direction moyennes du vent. <br><br><div class="spoiler">  <b class="spoiler_title">Remarque pour particuli√®rement corrosif</b> <div class="spoiler_text">  Pour une moyenne compl√®tement correcte de cette mani√®re, il est n√©cessaire que la valeur de Wa (valeur de vitesse) soit mesur√©e strictement simultan√©ment avec la valeur d'angle.  En pratique, cela ne doit √™tre surveill√© que si les p√©riodes de fluctuations importantes de l'amplitude du d√©bit sont inf√©rieures ou comparables au temps des mesures.  Pour le vent (et pour presque tous les cas d'√©coulement naturel de l'eau), il n'est g√©n√©ralement pas n√©cessaire de suivre, car le temps de mesure pour nous est au maximum d'une fraction de seconde, et les pulsations importantes du vent, bien s√ªr, durent plus longtemps.  Nous pouvons n√©gliger les inhomog√©n√©it√©s √† haute fr√©quence du flux, car elles n'affectent rien: l'inertie des corps physiques r√©els (y compris les capteurs) est beaucoup plus grande que ces inhomog√©n√©it√©s, et nous ne les ressentons tout simplement pas - un morceau de papier tremblera, mais rien de plus.  Dans les cas extr√™mes, ils se pr√©sentent sous la forme d'un petit bruit al√©atoire qui n'affecte pas de mani√®re significative la qualit√© des mesures. <br></div></div><br>  Cette merveilleuse m√©thode (appelons-la moyennage vectoriel complet) a un inconv√©nient cardinal d'un point de vue pratique: en l'absence d'un sujet de mesure (c'est-√†-dire lorsqu'elle est compl√®tement calme, ce qui est un cas assez courant), elle donne un r√©sultat math√©matiquement incorrect: puisque la vitesse du vent est nulle, alors et les deux projections sont √©gales √† z√©ro, ce qui ne peut pas l'√™tre (puisque sin et cos sont des fonctions compl√©mentaires).  Plus pr√©cis√©ment, c'est possible, mais il est fondamentalement impossible d'extraire des informations d'une telle situation.  Que voulez-vous montrer √† l'√©cran?  Pour √™tre honn√™te, je ne connais toujours pas la bonne fa√ßon de contourner cette situation (dans les d√©bitm√®tres que j'ai con√ßus, les cycles de calcul de la moyenne √©taient des heures, et on pensait qu'au moins une certaine agitation se produirait). <br><br>  Mais dans notre cas, la t√¢che, heureusement, est plus facile - nous n'avons pas besoin de faire la moyenne de la vitesse, et nous pouvons le faire avec des projections uniques du vecteur, sans prendre en compte l'ampleur de son module.  En d'autres termes, on peut fonctionner avec des sinus et cosinus purs, qui ne prennent jamais z√©ro √† la fois: m√™me quand il n'y a pas de vent, une girouette gel√©e dans l'immobilier montre une certaine direction.  Nous appelons une telle m√©thode un vecteur simplifi√© faisant la moyenne d'une direction (peut-√™tre qu'elle a un nom officiel, mais je ne suis pas au courant). <br><br>  Il n'y avait plus qu'une seule difficult√©: reconvertir les valeurs de projection moyennes calcul√©es en valeur d'angle.  Pour cela, la fonction Œ± = arctan (sin (Œ±) / cos (Œ±)) est g√©n√©ralement utilis√©e, mais si nous calculons √† travers les fonctions trigonom√©triques inverses, alors il est plus simple de prendre simplement arcos (cos (Œ±)) (ou arcsin (sin (Œ±)), de toute fa√ßon), et pour compl√©ter ce r√©sultat pour obtenir un cercle complet (c'est-√†-dire de 0 √† 359 degr√©s), en analysant les signes des projections, il faut quand m√™me le faire: toutes les fonctions inverses donnent le r√©sultat dans un demi-cercle (de 0 √† 180 ou de -90 √† +90).  (Voir UPD √† ce sujet √† la fin de l'article.) <br><br>  Nous formalisons tout ce qui pr√©c√®de en un v√©ritable algorithme (en r√©f√©rence √† Arduino).  Pour commencer, nous lirons les indications de direction non pas √† chaque cycle, mais √† chaque mesure (apr√®s la valeur de la fr√©quence de l'an√©mom√®tre).  Nous convertirons le r√©sultat en code Gray (dans notre pays, il a √©t√© d√©sign√© comme wind_Gray de type octet, voir <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">cette publication</a> ) en un code binaire normal, et, comme la fr√©quence de l'an√©mom√®tre, nous le placerons dans un tableau global, que nous d√©clarerons wDirAvr [4], o√π 4 est le nombre de mesures dans le cycle.  Nous ne peindrons pas la conversion du code Gray √† quatre chiffres en code binaire - cela peut √™tre fait de plusieurs mani√®res √† la discr√©tion du programmeur et est d√©crit dans toute r√©f√©rence. <br><br>  Ce code binaire prendra des valeurs de 0 √† 15, et nous convenons de compter les angles, non pas comme des g√©ographes / topographes / navigateurs d√©cal√©s, mais comme des gens normaux qui ont √©tudi√© la trigonom√©trie √† l'√©cole - dans le sens antihoraire.  Autrement dit, si le nord correspond √† la valeur z√©ro, alors 90 degr√©s ne sont pas l'est, comme dans les ¬´d√©cal√©s¬ª, mais l'ouest.  Comme nous avons 16 gradations de direction, nous devons multiplier la valeur de code par 22,5 (360/16) pour obtenir la direction en degr√©s ordinaires de l'arc. <br><br>  Maintenant, l'algorithme r√©el de moyenne vectorielle simplifi√©e de la direction √† partir de 4 valeurs de code: <br><br><pre><code class="plaintext hljs">. . . . . float wSin=0; // sin float wCos=0; // cos float wind_Rad; //   for (byte i=0; i&lt;4; i++){ wind_Rad= ((float(wDirAvr[i])*22.5)*M_PI/180); //   wSin=wSin+sin(wind_Rad);//    sin wCos=wCos+cos(wind_Rad);//    cos } // wSin=wSin/4;// sin ‚Äì    ,   wCos=wCos/4; // cos wind_Rad = acos(wCos); //     arccos if (wSin&lt;0) wind_Rad=2*M_PI-wind_Rad; //   sin int wind_G = round ((wind_Rad*180/M_PI)/22.5); //    0-15 . . . . .</code> </pre> <br>  La derni√®re ligne, nous convertissons la moyenne, exprim√©e en radians, en moyenne, exprim√©e dans notre code de 0 √† 15. Vous pouvez ensuite la reconvertir en code Gray, puis vous n'avez m√™me pas besoin de changer le programme dans le module principal pour afficher la direction. <br><br>  Voici, en fait, tout l'algorithme.  J'avais peur que le calcul des cosinus-arcsines ralentisse le contr√¥leur Arduino faible (par les temps 32 bits d'aujourd'hui), mais rien ne s'est pass√©: il a aval√© le code sans m√™me clignoter ... une LED, probablement. <br><br>  <b>UPD</b> : Pour l'auteur, l'algorithme fonctionne sous cette forme pendant plusieurs mois sans √©checs.  Cependant, les commentateurs m'ont conduit √† une erreur possible, quoique extr√™mement improbable dans la pratique: si les donn√©es contiennent deux groupes de mesures qui sont √† environ 180 degr√©s l'un de l'autre pr√®s de la valeur de cosinus z√©ro (c'est-√†-dire environ 90 et 270 degr√©s), alors l'algorithme produira une erreur valeur.  Pour l'√©viter, au lieu d'acos (), utilisez la fonction atan2 (wSin, wCos), qui donne imm√©diatement le r√©sultat correct en tenant compte des signes sinus et cosinus (merci <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">aamonster</a> pour l'aide).  La ligne o√π la valeur moyenne de wSin est calcul√©e ne doit pas √™tre comment√©e et la ligne ajust√©e pour le signe wSin n'est pas n√©cessaire.  Au lieu de cela, vous devez ins√©rer le cast √† des valeurs positives de l'angle (car atan2 donne des valeurs de pi √† -pi): <br><pre> <code class="plaintext hljs">if (wind_Rad&lt;0) wind_Rad=2*M_PI+wind_Rad;</code> </pre></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr423243/">https://habr.com/ru/post/fr423243/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr423233/index.html">L'intelligence artificielle dans le monde r√©el</a></li>
<li><a href="../fr423235/index.html">De Dribbble √† Android Motion</a></li>
<li><a href="../fr423237/index.html">Un bras robotique simple mais sophistiqu√©</a></li>
<li><a href="../fr423239/index.html">Cr√©er des packages pour Kubernetes avec Helm: structure de graphique et mod√®les</a></li>
<li><a href="../fr423241/index.html">Pr√©sentation des t√©l√©phones Digip A20 et A25 SIP</a></li>
<li><a href="../fr423247/index.html">Qu'est-ce que l'intelligence?</a></li>
<li><a href="../fr423249/index.html">Rust 1.29 Release</a></li>
<li><a href="../fr423251/index.html">Mon compte de Megafail</a></li>
<li><a href="../fr423253/index.html">Plateforme CAO domestique nanoCAD Plus 10: un complexe universel pour ceux qui con√ßoivent</a></li>
<li><a href="../fr423257/index.html">Arguments de fonction en tant que constantes de bits en PHP</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>