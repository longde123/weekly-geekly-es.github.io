<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👐🏻 🐜 👴🏻 Optimierung der Einheit: Wie die Hierarchie der Szenen Sie stiehlt 🚵🏾 👨🏿‍🤝‍👨🏼 🏇🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Sie haben also die offensichtlichsten Teile Ihres Spiels optimiert. Dies ist jedoch tatsächlich nicht der Fall. Sie haben einen kniffligen, nicht ganz...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Optimierung der Einheit: Wie die Hierarchie der Szenen Sie stiehlt</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/481510/"> <em>Sie haben also die offensichtlichsten Teile Ihres Spiels optimiert.</em>  <em>Dies ist jedoch tatsächlich nicht der Fall.</em>  <em>Sie haben einen kniffligen, nicht ganz erkennbaren Punkt übersehen: die Optimierung der Unity-Szenenhierarchie.</em> <br><br>  Und was ist falsch an der Hierarchie?  Lass mich dir etwas zeigen. <br><br>  Starten Sie Unity und öffnen Sie Ihr Spielprojekt.  Führen Sie dann das Spiel auf dem Zielgerät aus <br>  und verbinden Sie Unity Profiler damit.  Nehmen Sie während des Spiels einige Frames auf. <br><br>  Suchen Sie in Unity Profiler nach den folgenden unangenehmen <strong>Profiler-Markierungen</strong> : <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/7f/ne/0u/7fne0utbubx4brfwo8fadtq1aeq.png"></div><br>  Nicht gefunden?  Suchen Sie weiter, ich bin sicher, dass es mindestens einen gibt. <br><br>  <em>Dies</em> können <em>UpdateRendererBoundingVolumes</em> , <em>Physics.SyncColliderTransform</em> oder <em>TransformChangedDispatch sein</em> . <br><br>  Sie werden angezeigt, wenn Sie bereit sind, aufzugeben.  Sie treten auf, wenn Sie den Mauszeiger bereits über die Schaltfläche zum Schließen des Profilers bewegen. <br><br>  Hast du gefunden?  Wenn ja, haben Sie Glück.  Ich habe sie auch in einem meiner vorherigen Projekte gefunden und herausgefunden, wie ich sie komplett loswerden kann.  Mir wurde klar, was Böses in ihnen verborgen ist ... <br><br>  Möchten Sie die <strong>Geheimnisse der Leistung der Unity-Szenenhierarchie kennenlernen</strong> ? <br><a name="habracut"></a><br><h2>  Level 1 Entwickler: Typische Unity Scene Hierarchie </h2><br>  Ich erinnere mich noch an das erste Unity-Projekt, an dem ich vor über zehn Jahren gearbeitet habe. <br><br>  Ich kannte den Unterschied zwischen Spielobjekten und Komponenten noch nicht wirklich. <br><br>  Aber es war egal, ich habe immer noch Spiele erstellt. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c16/5c6/15b/c165c615b2ac5e9287f9f29d80b1cc66.png" alt="Bild"></div><br>  War mir eine so chaotische Hierarchie der Einheitsszene vertraut?  Eigentlich ja, weil es manchmal viel schlimmer war.  Es ist jedoch merkwürdig, dass auf diese Art von Hierarchie häufig verzichtet werden kann.  Aber du wirst leiden.  Sie müssen später dafür bezahlen. <br><br>  Glücklicherweise lernte ich, bevor ich anfing, Spiele professionell zu entwickeln, strukturiertere Hierarchien zu schätzen. <br><br>  Die Qualitätsstruktur der Szenenhierarchie kann Ihr bester Freund sein.  Die Struktur vereinfacht die Entwicklung und Zusammenarbeit erheblich. <br><br>  Es muss nicht perfekt sein, was auch immer das bedeutet.  Es reicht ihr, gut zu sein.  Aber sei vorsichtig.  <strong>Es ist wichtig.</strong> <br><br>  Eine überfüllte Hierarchie der Szene ist gefährlich und verursacht Probleme, da es sehr unwahrscheinlich ist, dass Sie die Nebenwirkungen direkt bemerken. <br><br>  Ein furchterregender Geist wird dich verfolgen, dich verlangsamen und dich zurückziehen.  Manchmal wirst du zurückblicken, aber es wird nichts dahinter sein.  Deshalb werden Sie sich daran gewöhnen, sich langsam zu bewegen. <br><br>  Im Laufe der Jahre habe ich gelernt, diese Nebenwirkungen zu diagnostizieren.  Das Hauptproblem ist, dass die Nebenwirkungen einer chaotischen Hierarchie nicht so einfach zu verfolgen sind. <br><br>  Sie sehen den Profiler, wissen aber nicht, was die Marker bedeuten.  Ihre Namen sind oft rätselhaft ... Welche Geheimnisse bewahren sie auf?  Es gibt nur eines, dessen Sie sich sicher sein müssen: Die mysteriösen Markierungen verraten uns etwas, das es wert ist, erkundet zu werden. <br><br>  Wenn wir über die Verbesserung der Szenenstruktur sprechen, meinen wir normalerweise die Verbesserung der Verständlichkeit und die Senkung der Supportkosten.  Aber alle vergessen die Leistung. <br><br>  Lassen Sie uns die oben gezeigte Szenenhierarchie analysieren.  Es enthält <strong>2.000 ineinander verschachtelte rotierende Kugeln</strong> . <br><br>  Was wird der Profiler dazu sagen?  Mal sehen <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a8a/e9d/529/a8ae9d529ff633997adba0411f78b7bf.png" alt="Bild"></div><br>  <i>Optimierung der Unity-Szenenhierarchie: Übersicht über den Hierarchie-Profiler</i> <br><br>  Sehr schlechte Leistung für ein einfaches Fertighaus und ein Rotationsskript, das auf eine reguläre Kugel angewendet wird.  Wie Sie sehen, nehmen <em>Physics.SyncColliderTransform</em> und <em>UpdateRendererBoundingVolumes</em> <em>einen</em> großen Teil des Rahmenzeitbudgets ein.  Aber lassen Sie uns die Analyse nicht zu Ende bringen, denn ich bin sehr neugierig auf diesen Fall. <br><br>  Lass uns tiefer gehen. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ca1/4a5/94f/ca14a594f3d5ab80a8fc80153f743d2a.png"></div><br>  <i>Details zum Hierarchie-Profiler</i> <br><br>  <strong>Hier ist die Antwort auf die Frage des Artikels.</strong> <br><br>  Nicht optimierte Hierarchien verursachen in Unity zwei BIG-Probleme. <br><br><ul><li>  Tiefe Hierarchien verhindern, dass das Jobsystem effizient parallel arbeitet </li><li>  Verschachtelte Hierarchien lösen in einigen Unity-Subsystemen Engpässe aus. </li></ul><br>  Vergessen Sie das nicht, denn <strong>es gilt für alle Arten dynamischer Objekte</strong> und insbesondere für Benutzeroberflächen. <br><br>  Als Referenz: Ich arbeite an Threadripper mit 16 physischen Kernen und 32 Threads.  Wissen Sie, wie viele von ihnen in diesem Projekt effektiv arbeiten?  Nur einer. <br><br>  Darunter leidet natürlich die Spieleleistung.  Und wenn Sie versuchen, die Situation zu korrigieren, indem Sie all diese mysteriösen Namen verstehen, werden Sie frühzeitig alt. <br><br>  <strong>Was würde ein Level 2 Entwickler mit 2.000 Objekten machen?</strong> <br><br><h2>  Level 2 Entwickler: Optimierte Unity-Szenenhierarchie </h2><br>  Ein Unity-Entwickler der Stufe 2 weiß, dass Kindertransformationen einen Preis haben.  Er weiß auch, dass der Preis in diesem Fall die Millisekunden der CPU-Zeit ist.  Oder die zusätzlichen Arbeitsstunden des Entwicklers, um dieses Problem zu lösen. <br><br>  Fragen Sie sich: Reicht das CPU-Zeitbudget aus, um eine so umfangreiche Hierarchie zu finanzieren? <br><br>  Aus welchem ​​Bereich Ihres Spiels nehmen Sie diese Millisekunden? <br><br>  Wird dies die Anzahl der schönen Partikel reduzieren müssen?  Oder die Anzahl der Monster, gegen die ein Spieler kämpfen muss?  Ich hoffe, Sie müssen nichts davon tun, aber besser ... <br><br>  Erstellen Sie effektive Szenenhierarchien und zerstören Sie suboptimale. <br><br>  Der Grund, warum die komplexe Verschachtelung von untergeordneten Objekten Spielressourcen stiehlt, ist einfach: <strong>Jede Änderung, die vorgenommen wird, wirkt sich auf die Kinder und möglicherweise auch auf die Eltern mit den Geschwistern aus.</strong> <br><br>  Wenn Sie die Position, Drehung oder Skalierung eines Objekts ändern, werden in Unity viele Aspekte berücksichtigt.  Die Engine tut dies von selbst, so dass Sie sich auf das Spiel konzentrieren können.  Das ist großartig, aber wenn Sie nichts darüber wissen, kann der Preis astronomisch werden. <br><br>  Was ist die Lösung?  Halten Sie die Dinge einfach und halten Sie sich an die goldenen Regeln einer sauberen Unity-Szenenhierarchie: <br><br><ul><li>  Maximal <a href="http://es-from-the-spotlight-team-optimizing-the-hierarchy/">50</a> Kinder pro Spielobjekt </li><li>  Nicht mehr als 4 Verschachtelungsstufen auf einem Spielobjekt. </li></ul><br>  Ist das nicht einfach  Level 2-Entwickler erstellen so flache Hierarchien von Unity-Szenen wie möglich. <br><br>  Schauen Sie sich das Bild unten an.  Die gleiche Anzahl von Objekten, diesmal jedoch in einer flachen Hierarchie strukturiert. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cf1/679/15e/cf167915e7a234e6fedf5195ac4361d5.png"></div><br>  Die Einsparungen sind enorm. <br><br>  Aber leichter gesagt als getan, nicht wahr?  Die Trennung und Zerstörung von Beziehungen zwischen Objekten ist mühsam, fehleranfällig und langwierig. <br><br>  Was würde ein Level 3 Entwickler tun? <br><br><h2>  Level 3 Entwickler: FAP Hierarchy Tool </h2><br>  Ein guter Unity-Entwickler erledigt den Job.  <strong>Ein großartiger</strong> Unity-Entwickler erledigt die Arbeit schneller und genauer.  Aber wie gelingt es ihm?  Mit Hilfe von Werkzeugen.  Da die einzige billige Hierarchie die leere Hierarchie ist, müssen Sie die folgenden Fragen beantworten, um das Spiel zu bewerten ... <br><br>  <strong>Wie komplex sind Ihre Hierarchien?</strong> <br><br>  Diese Frage kann beantwortet werden, indem Hierarchien methodisch analysiert und numerisch bewertet werden. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ls/dj/uw/lsdjuwi6l0nz8msasaku8fbhyya.png"></div><br>  Welche mathematischen Formeln werden benötigt, um diese Schätzung zu berechnen?  Zum Glück keine.  Ich habe alles für dich getan.  Ich habe ein Prototyp-Tool zur automatischen Analyse und Erkennung von Engpässen in Ihrer Hierarchie auf der Grundlage der oben genannten goldenen Regeln geschrieben. <br><br>  Ich habe dieses <strong>fabelhafte Tool für erweiterte Profilhierarchie</strong> aufgerufen.  Starte das Spiel.  Kommen Sie zu einem interessanten Moment.  Öffnen Sie das Tool und lassen Sie es den Rest erledigen. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f3b/65c/4d8/f3b65c4d8a22f7da546e3b5f38fc3f06.png"></div><br>  Das Tool gibt Ihnen eine ganzzahlige Bewertung.  Sobald Sie die Partitur kennen, werden Sie wissen, was zu tun ist ... oder nicht? <br><br>  Denn ich gebe Ihnen nicht nur dieses Tool, sondern auch ein zusätzliches Skript, mit dem Sie Ihre Fähigkeit stärken können, Probleme mit Hierarchien zu beseitigen.  Ich gebe Ihnen die Kraft eines einfachen <em>DetachGameObject.cs-</em> Skripts. <br><br>  Es ist selten, ein Skript mit 27 Zeilen zu finden, mit dem sich die Leistung in so kurzer Zeit verbessern lässt.  Seine Arbeit ist einfach: Während der Programmausführung werden schwere und eingebettete Spielobjekte an die Wurzel der Szenenhierarchie verschoben.  Aus diesem Grund profitieren Sie <strong>zur Entwurfszeit</strong> von <strong>strukturierten Hierarchien</strong> und <strong>erzielen zur Laufzeit enorme Leistungssteigerungen</strong> . <br><br>  Es ist sehr wahrscheinlich, dass Sie dies für einen großen Teil Ihrer Hierarchie tun können, die eine starke Verschachtelungsstruktur aufweist. <br><br>  Sie können das Tool und das Skript am Ende des <a href="https://thegamedev.guru/unity-performance/scene-hierarchy-optimization/">Originalartikels</a> herunterladen. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de481510/">https://habr.com/ru/post/de481510/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de481492/index.html">Wir sammeln Farbmusik für das neue Jahr</a></li>
<li><a href="../de481496/index.html">DDoS-Angriff durch Social Engineering</a></li>
<li><a href="../de481500/index.html">Fanatischer Programmierer. Abstrakter Teil 3 + abstrakter Tisch. Planung und Kiesel in einem Eimer Wasser</a></li>
<li><a href="../de481502/index.html">Einführung in GitHub-Aktionen</a></li>
<li><a href="../de481506/index.html">Die Zusammenstellung interessanter Materialien für den mobilen Entwickler # 327 (16. - 22. Dezember)</a></li>
<li><a href="../de481514/index.html">Arbeiten mit der Newtonsoft.Json-Bibliothek anhand eines realen Beispiels. Teil 1</a></li>
<li><a href="../de481516/index.html">Die Komplexität der Erarbeitung von Raumfahrzeugen</a></li>
<li><a href="../de481518/index.html">Project Management Professional (PMP): 6. Auflage Was? Warum? und warum?</a></li>
<li><a href="../de481522/index.html">Auf der unteren Leiste oder gegen die Vermutung der Vernunft</a></li>
<li><a href="../de481524/index.html">Gleichzeitige Prüfung während der elektronischen Abstimmung</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>