<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ›€ğŸ½ ğŸ‘¨â€ğŸ­ âœ‹ğŸ¿ OpenSceneGraphï¼šå‡ ä½•å’ŒçŠ¶æ€å±æ€§çš„è¿‡ç¨‹åŠ¨ç”» ğŸ¥„ ğŸ‘©ğŸ»â€ğŸ¤â€ğŸ‘¨ğŸ¾ ğŸ‘¦</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="å¼•è¨€ 
 åœ¨è°ˆåˆ°OSGç‰¹æœ‰çš„ç¼–ç¨‹æŠ€æœ¯æ—¶ï¼Œæˆ‘ä»¬æœ€åä¸€æ¬¡è®¨è®ºäº†å›è°ƒæœºåˆ¶åŠå…¶åœ¨å¼•æ“ä¸­çš„å®ç°ã€‚ ç°åœ¨æ˜¯æ—¶å€™çœ‹çœ‹è¿™ç§æœºåˆ¶ä¸ºç®¡ç†ä¸‰ç»´åœºæ™¯çš„å†…å®¹æä¾›çš„å¯èƒ½æ€§äº†ã€‚ 

 å¦‚æœæˆ‘ä»¬è°ˆè®ºå¯¹è±¡åŠ¨ç”»ï¼Œåˆ™OSGä¸ºå¼€å‘äººå‘˜æä¾›äº†ä¸¤ç§å®ç°æ–¹å¼ï¼š 



1. é€šè¿‡å¯¹è±¡åŠå…¶å±æ€§çš„è½¬æ¢ä»¥ç¼–ç¨‹æ–¹å¼å®ç°è¿‡ç¨‹åŠ¨ç”» 
2. ä»3Dç¼–è¾‘å™¨å¯¼å‡º...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>OpenSceneGraphï¼šå‡ ä½•å’ŒçŠ¶æ€å±æ€§çš„è¿‡ç¨‹åŠ¨ç”»</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/437724/"><img src="https://habrastorage.org/webt/py/ks/3w/pyks3wlvjf_zfef-sqocutbnimk.jpeg" alt="å›¾ç‰‡"><br><h1> å¼•è¨€ </h1><br> åœ¨è°ˆåˆ°OSGç‰¹æœ‰çš„ç¼–ç¨‹æŠ€æœ¯<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ—¶ï¼Œ</a>æˆ‘ä»¬<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æœ€åä¸€æ¬¡</a>è®¨è®ºäº†å›è°ƒæœºåˆ¶åŠå…¶åœ¨å¼•æ“ä¸­çš„å®ç°ã€‚ ç°åœ¨æ˜¯æ—¶å€™çœ‹çœ‹è¿™ç§æœºåˆ¶ä¸ºç®¡ç†ä¸‰ç»´åœºæ™¯çš„å†…å®¹æä¾›çš„å¯èƒ½æ€§äº†ã€‚ <br><br> å¦‚æœæˆ‘ä»¬è°ˆè®ºå¯¹è±¡åŠ¨ç”»ï¼Œåˆ™OSGä¸ºå¼€å‘äººå‘˜æä¾›äº†ä¸¤ç§å®ç°æ–¹å¼ï¼š <br><br><ol><li> é€šè¿‡å¯¹è±¡åŠå…¶å±æ€§çš„è½¬æ¢ä»¥ç¼–ç¨‹æ–¹å¼å®ç°è¿‡ç¨‹åŠ¨ç”» </li><li> ä»3Dç¼–è¾‘å™¨å¯¼å‡ºåŠ¨ç”»å¹¶ä»åº”ç”¨ç¨‹åºä»£ç å¯¹å…¶è¿›è¡Œç®¡ç† </li></ol><br> é¦–å…ˆï¼Œè€ƒè™‘ç¬¬ä¸€ç§å¯èƒ½æ€§ï¼Œæœ€æ˜æ˜¾çš„å¯èƒ½æ€§ã€‚ æˆ‘ä»¬ä¸€å®šä¼šç¨åå†è®¨è®ºç¬¬äºŒä¸ªã€‚ <br><a name="habracut"></a><br><h1>  1.ç¨‹åºå˜å½¢åŠ¨ç”» </h1><br> éå†åœºæ™¯å›¾æ—¶ï¼ŒOSGä¼šå°†æ•°æ®ä¼ è¾“åˆ°OpenGLç®¡é“ï¼Œè¯¥ç®¡é“åœ¨å•ç‹¬çš„çº¿ç¨‹ä¸­è¿è¡Œã€‚ è¯¥çº¿ç¨‹å¿…é¡»ä¸æ¯ä¸ªå¸§ä¸­çš„å…¶ä»–å¤„ç†çº¿ç¨‹åŒæ­¥ã€‚ å¦åˆ™ï¼Œå¯èƒ½ä¼šå¯¼è‡´frameï¼ˆï¼‰æ–¹æ³•åœ¨å¤„ç†å‡ ä½•æ•°æ®ä¹‹å‰å®Œæˆã€‚ è¿™å°†å¯¼è‡´ä¸å¯é¢„æµ‹çš„ç¨‹åºè¡Œä¸ºå¹¶å´©æºƒã€‚  OSGä»¥osg :: Objectç±»çš„setDataVarianceï¼ˆï¼‰æ–¹æ³•çš„å½¢å¼æä¾›äº†æ­¤é—®é¢˜çš„è§£å†³æ–¹æ¡ˆï¼Œå®ƒæ˜¯æ‰€æœ‰åœºæ™¯å¯¹è±¡çš„åŸºç¡€ã€‚ æ‚¨å¯ä»¥ä¸ºå¯¹è±¡è®¾ç½®ä¸‰ç§å¤„ç†æ¨¡å¼ <br><br><ol><li> æœªå®šä¹‰ï¼ˆé»˜è®¤ï¼‰-OSGç‹¬ç«‹ç¡®å®šå¯¹è±¡çš„å¤„ç†é¡ºåºã€‚ <br></li><li> é™æ€-å¯¹è±¡æ˜¯ä¸å¯å˜çš„ï¼Œå…¶å¤„ç†é¡ºåºå¹¶ä¸é‡è¦ã€‚ æ˜¾ç€åŠ å¿«äº†æ¸²æŸ“é€Ÿåº¦ã€‚ <br></li><li> åŠ¨æ€-å¿…é¡»åœ¨å¼€å§‹æ¸²æŸ“ä¹‹å‰å¤„ç†å¯¹è±¡ã€‚ <br></li></ol><br> å¯ä»¥éšæ—¶é€šè¿‡ä»¥ä¸‹æ–¹å¼è®¾ç½®æ­¤è®¾ç½®ï¼š <br><br><pre><code class="cpp hljs">node-&gt;setDataVariance( osg::Object::DYNAMIC );</code> </pre> <br> æ™®éæ¥å—çš„åšæ³•æ˜¯â€œåŠ¨æ€â€ä¿®æ”¹å‡ ä½•å½¢çŠ¶ï¼Œå³åœ¨æ¯å¸§ä¸­åŠ¨æ€æ›´æ”¹é¡¶ç‚¹ï¼Œé¢œè‰²æ³•çº¿å’Œçº¹ç†çš„åæ ‡ï¼Œä»¥è·å¾—å¯å˜çš„å‡ ä½•å½¢çŠ¶ã€‚ æ­¤æŠ€æœ¯ç§°ä¸ºå˜å½¢åŠ¨ç”»ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå‡ ä½•å›¾å½¢çš„å¤„ç†é¡ºåºæ˜¯å†³å®šæ€§çš„-å¿…é¡»åœ¨ç»˜åˆ¶å¼€å§‹ä¹‹å‰é‡æ–°è®¡ç®—å…¶æ‰€æœ‰æ›´æ”¹ã€‚ ä¸ºäº†è¯´æ˜è¿™ä¸€æŠ€å·§ï¼Œæˆ‘ä»¬å¯¹å½©è‰²æ–¹å½¢ç¤ºä¾‹è¿›è¡Œäº†ä¸€äº›ä¿®æ”¹ï¼Œè¿«ä½¿å…¶é¡¶ç‚¹ä¹‹ä¸€ç»•Xè½´æ—‹è½¬ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">Animquadç¤ºä¾‹</b> <div class="spoiler_text">  <strong>ä¸»æ–‡ä»¶</strong> <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifndef</span></span></span><span class="hljs-meta"> MAIN_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> MAIN_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;osg/Geometry&gt; #include &lt;osg/Geode&gt; #include &lt;osgViewer/Viewer&gt; #endif</span></span></span></span></code> </pre><br>  <strong>main.cpp</strong> <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"main.h"</span></span></span><span class="hljs-meta"> </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//------------------------------------------------------------------------------ // //------------------------------------------------------------------------------ osg::Geometry *createQuad() { osg::ref_ptr&lt;osg::Vec3Array&gt; vertices = new osg::Vec3Array; vertices-&gt;push_back( osg::Vec3(0.0f, 0.0f, 0.0f) ); vertices-&gt;push_back( osg::Vec3(1.0f, 0.0f, 0.0f) ); vertices-&gt;push_back( osg::Vec3(1.0f, 0.0f, 1.0f) ); vertices-&gt;push_back( osg::Vec3(0.0f, 0.0f, 1.0f) ); osg::ref_ptr&lt;osg::Vec3Array&gt; normals = new osg::Vec3Array; normals-&gt;push_back( osg::Vec3(0.0f, -1.0f, 0.0f) ); osg::ref_ptr&lt;osg::Vec4Array&gt; colors = new osg::Vec4Array; colors-&gt;push_back( osg::Vec4(1.0f, 0.0f, 0.0f, 1.0f) ); colors-&gt;push_back( osg::Vec4(0.0f, 1.0f, 0.0f, 1.0f) ); colors-&gt;push_back( osg::Vec4(0.0f, 0.0f, 1.0f, 1.0f) ); colors-&gt;push_back( osg::Vec4(1.0f, 1.0f, 1.0f, 1.0f) ); osg::ref_ptr&lt;osg::Geometry&gt; quad = new osg::Geometry; quad-&gt;setVertexArray(vertices.get()); quad-&gt;setNormalArray(normals.get()); quad-&gt;setNormalBinding(osg::Geometry::BIND_OVERALL); quad-&gt;setColorArray(colors.get()); quad-&gt;setColorBinding(osg::Geometry::BIND_PER_VERTEX); quad-&gt;addPrimitiveSet(new osg::DrawArrays(GL_QUADS, 0, 4)); return quad.release(); } //------------------------------------------------------------------------------ // //------------------------------------------------------------------------------ class DynamicQuadCallback : public osg::Drawable::UpdateCallback { public: virtual void update(osg::NodeVisitor *, osg::Drawable *drawable); }; //------------------------------------------------------------------------------ // //------------------------------------------------------------------------------ void DynamicQuadCallback::update(osg::NodeVisitor *, osg::Drawable *drawable) { osg::Geometry *quad = static_cast&lt;osg::Geometry *&gt;(drawable); if (!quad) return; osg::Vec3Array *vertices = static_cast&lt;osg::Vec3Array *&gt;(quad-&gt;getVertexArray()); if (!vertices) return; osg::Quat quat(osg::PI * 0.01, osg::X_AXIS); vertices-&gt;back() = quat * vertices-&gt;back(); quad-&gt;dirtyDisplayList(); quad-&gt;dirtyBound(); } //------------------------------------------------------------------------------ // //------------------------------------------------------------------------------ int main(int argc, char *argv[]) { (void) argc; (void) argv; osg::Geometry *quad = createQuad(); quad-&gt;setDataVariance(osg::Object::DYNAMIC); quad-&gt;setUpdateCallback(new DynamicQuadCallback); osg::ref_ptr&lt;osg::Geode&gt; root = new osg::Geode; root-&gt;addDrawable(quad); osgViewer::Viewer viewer; viewer.setSceneData(root.get()); return viewer.run(); }</span></span></span></span></code> </pre><br></div></div><br> æˆ‘ä»¬å°†åœ¨å•ç‹¬çš„å‡½æ•°ä¸­åˆ›å»ºä¸€ä¸ªæ­£æ–¹å½¢ <br><br><pre> <code class="cpp hljs">osg::<span class="hljs-function"><span class="hljs-function">Geometry *</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createQuad</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ osg::ref_ptr&lt;osg::Vec3Array&gt; vertices = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> osg::Vec3Array; vertices-&gt;push_back( osg::Vec3(<span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>) ); vertices-&gt;push_back( osg::Vec3(<span class="hljs-number"><span class="hljs-number">1.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>) ); vertices-&gt;push_back( osg::Vec3(<span class="hljs-number"><span class="hljs-number">1.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">1.0f</span></span>) ); vertices-&gt;push_back( osg::Vec3(<span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">1.0f</span></span>) ); osg::ref_ptr&lt;osg::Vec3Array&gt; normals = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> osg::Vec3Array; normals-&gt;push_back( osg::Vec3(<span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">-1.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>) ); osg::ref_ptr&lt;osg::Vec4Array&gt; colors = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> osg::Vec4Array; colors-&gt;push_back( osg::Vec4(<span class="hljs-number"><span class="hljs-number">1.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">1.0f</span></span>) ); colors-&gt;push_back( osg::Vec4(<span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">1.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">1.0f</span></span>) ); colors-&gt;push_back( osg::Vec4(<span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">1.0f</span></span>, <span class="hljs-number"><span class="hljs-number">1.0f</span></span>) ); colors-&gt;push_back( osg::Vec4(<span class="hljs-number"><span class="hljs-number">1.0f</span></span>, <span class="hljs-number"><span class="hljs-number">1.0f</span></span>, <span class="hljs-number"><span class="hljs-number">1.0f</span></span>, <span class="hljs-number"><span class="hljs-number">1.0f</span></span>) ); osg::ref_ptr&lt;osg::Geometry&gt; quad = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> osg::Geometry; quad-&gt;setVertexArray(vertices.get()); quad-&gt;setNormalArray(normals.get()); quad-&gt;setNormalBinding(osg::Geometry::BIND_OVERALL); quad-&gt;setColorArray(colors.get()); quad-&gt;setColorBinding(osg::Geometry::BIND_PER_VERTEX); quad-&gt;addPrimitiveSet(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> osg::DrawArrays(GL_QUADS, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> quad.release(); }</code> </pre><br> åŸåˆ™ä¸Šä¸éœ€è¦æè¿°ï¼Œå› ä¸ºæˆ‘ä»¬å·²ç»åå¤è¿›è¡Œäº†æ­¤ç±»æ“ä½œã€‚ è¦ä¿®æ”¹æ­¤æ­£æ–¹å½¢çš„é¡¶ç‚¹ï¼Œæˆ‘ä»¬ç¼–å†™DynamicQuadCallbackç±»ï¼Œä»osg :: Drawable :: UpdateCallbackç»§æ‰¿å®ƒ <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DynamicQuadCallback</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> osg::Drawable::UpdateCallback { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(osg::NodeVisitor *, osg::Drawable *drawable)</span></span></span></span>; };</code> </pre><br> è¦†ç›–å…¶ä¸­çš„updateï¼ˆï¼‰æ–¹æ³• <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> DynamicQuadCallback::update(osg::NodeVisitor *, osg::Drawable *drawable) { osg::Geometry *quad = <span class="hljs-keyword"><span class="hljs-keyword">static_cast</span></span>&lt;osg::Geometry *&gt;(drawable); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!quad) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; osg::Vec3Array *vertices = <span class="hljs-keyword"><span class="hljs-keyword">static_cast</span></span>&lt;osg::Vec3Array *&gt;(quad-&gt;getVertexArray()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!vertices) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; osg::<span class="hljs-function"><span class="hljs-function">Quat </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">quat</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(osg::PI * </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.01</span></span></span></span><span class="hljs-function"><span class="hljs-params">, osg::X_AXIS)</span></span></span></span>; vertices-&gt;back() = quat * vertices-&gt;back(); quad-&gt;dirtyDisplayList(); quad-&gt;dirtyBound(); }</code> </pre><br> è¿™é‡Œæˆ‘ä»¬å¾—åˆ°ä¸€ä¸ªæŒ‡å‘å‡ ä½•å¯¹è±¡çš„æŒ‡é’ˆ <br><br><pre> <code class="cpp hljs">osg::Geometry *quad = <span class="hljs-keyword"><span class="hljs-keyword">static_cast</span></span>&lt;osg::Geometry *&gt;(drawable);</code> </pre><br> æˆ‘ä»¬ä»å‡ ä½•ä½“ä¸­è¯»å–é¡¶ç‚¹åˆ—è¡¨ï¼ˆæˆ–æ›´ç¡®åˆ‡åœ°è¯´æ˜¯æŒ‡å‘é¡¶ç‚¹çš„åˆ—è¡¨ï¼‰ <br><br><pre> <code class="cpp hljs">osg::Vec3Array *vertices = <span class="hljs-keyword"><span class="hljs-keyword">static_cast</span></span>&lt;osg::Vec3Array *&gt;(quad-&gt;getVertexArray());</code> </pre><br> è¦è·å–æ•°ç»„ä¸­çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼ˆæœ€åä¸€ä¸ªé¡¶ç‚¹ï¼‰ï¼Œosg :: Arrayç±»æä¾›äº†backï¼ˆï¼‰æ–¹æ³•ã€‚ ä¸ºäº†æ‰§è¡Œé¡¶ç‚¹ç›¸å¯¹äºXè½´çš„æ—‹è½¬ï¼Œæˆ‘ä»¬å¼•å…¥å››å…ƒæ•° <br><br><pre> <code class="cpp hljs">osg::<span class="hljs-function"><span class="hljs-function">Quat </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">quat</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(osg::PI * </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.01</span></span></span></span><span class="hljs-function"><span class="hljs-params">, osg::X_AXIS)</span></span></span></span>;</code> </pre><br> ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬è®¾ç½®ä¸€ä¸ªå››å…ƒæ•°ï¼Œè¯¥å››å…ƒæ•°å®ç°ç»•Xè½´æ—‹è½¬0.01 * Piçš„è§’åº¦ã€‚ é€šè¿‡å°†å››å…ƒæ•°ä¹˜ä»¥å®šä¹‰é¡¶ç‚¹åæ ‡çš„å‘é‡æ¥æ—‹è½¬é¡¶ç‚¹ <br><br><pre> <code class="cpp hljs">vertices-&gt;back() = quat * vertices-&gt;back();</code> </pre><br> æœ€åä¸¤ä¸ªè°ƒç”¨é‡æ–°è®¡ç®—äº†æ˜¾ç¤ºåˆ—è¡¨å’Œä¿®æ”¹åçš„å‡ ä½•å›¾å½¢çš„å°ºå¯¸å¹³è¡Œå…­é¢ä½“ <br><br><pre> <code class="cpp hljs">quad-&gt;dirtyDisplayList(); quad-&gt;dirtyBound();</code> </pre><br> åœ¨mainï¼ˆï¼‰å‡½æ•°çš„ä¸»ä½“ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ­£æ–¹å½¢ï¼Œä¸ºå…¶è®¾ç½®åŠ¨æ€ç»˜åˆ¶æ¨¡å¼ï¼Œå¹¶æ·»åŠ ä¸€ä¸ªä¿®æ”¹å‡ ä½•çš„å›è°ƒ <br><br><pre> <code class="cpp hljs">osg::Geometry *quad = createQuad(); quad-&gt;setDataVariance(osg::Object::DYNAMIC); quad-&gt;setUpdateCallback(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DynamicQuadCallback);</code> </pre><br> æˆ‘å°†ä¸åŠ é€‰æ‹©åœ°åˆ›å»ºæ ¹èŠ‚ç‚¹å¹¶å¯åŠ¨æŸ¥çœ‹å™¨ï¼Œå› ä¸ºæˆ‘ä»¬å·²ç»ä»¥ä¸åŒçš„æ–¹å¼å®Œæˆäº†è‡³å°‘äºŒåæ¬¡ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬æ‹¥æœ‰æœ€ç®€å•çš„å˜å½¢åŠ¨ç”» <br><br><img src="https://habrastorage.org/webt/rk/oy/rf/rkoyrfpjkx_kan0puqvyj1ocxps.gif"><br><br> ç°åœ¨å°è¯•åˆ é™¤ï¼ˆæ³¨é‡Šï¼‰setDataVarianceï¼ˆï¼‰è°ƒç”¨ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¹Ÿè®¸æˆ‘ä»¬çœ‹ä¸åˆ°ä»»ä½•çŠ¯ç½ªè¡Œä¸º-é»˜è®¤æƒ…å†µä¸‹ï¼ŒOSGå°è¯•è‡ªåŠ¨ç¡®å®šä½•æ—¶æ›´æ–°å‡ ä½•æ•°æ®ï¼Œå¹¶å°è¯•ä¸æ¸²æŸ“åŒæ­¥ã€‚ ç„¶åå°è¯•å°†æ¨¡å¼ä»â€œåŠ¨æ€â€æ›´æ”¹ä¸ºâ€œé™æ€â€ï¼Œæ‚¨å°†çœ‹åˆ°å›¾åƒæ˜¾ç¤ºä¸æµç•…ï¼Œå‡ºç°æ˜æ˜¾çš„æŠ–åŠ¨ï¼Œé”™è¯¯å’Œè­¦å‘Šï¼Œä¾‹å¦‚ <br><br><pre> <code class="plaintext hljs">Warning: detected OpenGL error 'invalid value' at after RenderBin::draw(..)</code> </pre><br> å¦‚æœä¸æ‰§è¡ŒdirtyDisplayListï¼ˆï¼‰æ–¹æ³•ï¼Œåˆ™OpenGLå°†å¿½ç•¥å‡ ä½•ä¸­çš„æ‰€æœ‰æ›´æ”¹ï¼Œå¹¶å°†ä½¿ç”¨æœ€å¼€å§‹åˆ›å»ºçš„æ˜¾ç¤ºåˆ—è¡¨æ¥åˆ›å»ºç”¨äºæ¸²æŸ“çš„æ­£æ–¹å½¢ã€‚ åˆ é™¤æ­¤å‘¼å«ï¼Œæ‚¨å°†çœ‹åˆ°æ²¡æœ‰åŠ¨ç”»ã€‚ <br><br> å¦‚æœä¸è°ƒç”¨dirtyBoundï¼ˆï¼‰æ–¹æ³•ï¼Œå°†ä¸ä¼šé‡æ–°è®¡ç®—è¾¹ç•Œæ¡†ï¼Œå¹¶ä¸”OSGå°†é”™è¯¯åœ°ä¿®å‰ªä¸å¯è§çš„é¢ã€‚ <br><br><h1>  2.è¿åŠ¨æ’è¡¥çš„æ¦‚å¿µ </h1><br> å‡è®¾ä»Aç«™åˆ°Bç«™çš„ç«è½¦éœ€è¦15åˆ†é’Ÿçš„è·¯ç¨‹ã€‚ æˆ‘ä»¬å¦‚ä½•é€šè¿‡æ›´æ”¹å›è°ƒä¸­ç«è½¦çš„ä½ç½®æ¥æ¨¡æ‹Ÿè¿™ç§æƒ…å†µï¼Ÿ æœ€ç®€å•çš„æ–¹æ³•æ˜¯å°†è½¦ç«™Açš„ä½ç½®ä¸æ—¶é—´0ç›¸å…³è”ï¼Œå°†è½¦ç«™Bçš„ä½ç½®ä¸15åˆ†é’Ÿç›¸å…³è”ï¼Œå¹¶åœ¨è¿™äº›æ—¶é—´ä¹‹é—´å‡åŒ€åœ°ç§»åŠ¨ç«è½¦ã€‚ è¿™ç§æœ€ç®€å•çš„æ–¹æ³•ç§°ä¸ºçº¿æ€§æ’å€¼ã€‚ åœ¨çº¿æ€§æ’å€¼ä¸­ï¼Œç”¨å…¬å¼æè¿°æŒ‡å®šä¸­é—´ç‚¹ä½ç½®çš„å‘é‡ <br><br><pre> <code class="plaintext hljs">p = (1 - t) * p0 + t * p1</code> </pre><br> å…¶ä¸­p0æ˜¯èµ·ç‚¹ï¼›  p1æ˜¯ç»ˆç‚¹ï¼›  tæ˜¯ä¸€ä¸ªä»0åˆ°1å‡åŒ€å˜åŒ–çš„å‚æ•°ã€‚ä½†æ˜¯ï¼Œç«è½¦çš„è¿åŠ¨è¦å¤æ‚å¾—å¤šï¼šå®ƒç¦»å¼€ç«™Aï¼ŒåŠ é€Ÿï¼Œç„¶åä»¥æ’å®šçš„é€Ÿåº¦è¿åŠ¨ï¼Œç„¶åå‡é€Ÿï¼Œåœåœ¨ç«™Bã€‚è¿™æ ·çš„è¿‡ç¨‹ä¸å†èƒ½å¤Ÿæè¿°çº¿æ€§æ’å€¼å’Œçœ‹èµ·æ¥ä¸è‡ªç„¶ã€‚ <br><br>  OSGä¸ºå¼€å‘äººå‘˜æä¾›äº†osgAnimationåº“ï¼Œè¯¥åº“åŒ…å«è®¸å¤šæ ‡å‡†æ’å€¼ç®—æ³•ï¼Œç”¨äºå¹³æ»‘åœ°åŠ¨ç”»åœºæ™¯å¯¹è±¡çš„è¿åŠ¨ã€‚ è¿™äº›å‡½æ•°ä¸­çš„æ¯ä¸€ä¸ªé€šå¸¸éƒ½æœ‰ä¸¤ä¸ªå‚æ•°ï¼šå‚æ•°çš„åˆå§‹å€¼ï¼ˆé€šå¸¸ä¸º0ï¼‰å’Œå‚æ•°çš„æœ€ç»ˆå€¼ï¼ˆé€šå¸¸ä¸º1ï¼‰ã€‚ è¿™äº›åŠŸèƒ½å¯ä»¥åº”ç”¨äºè¿åŠ¨çš„å¼€å§‹ï¼ˆInMotionï¼‰ï¼Œè¿åŠ¨çš„ç»“æŸï¼ˆOutMotionï¼‰æˆ–è¿åŠ¨çš„å¼€å§‹å’Œç»“æŸï¼ˆInOutMotionï¼‰ <br><br><table><thead><tr><th> æœºèŠ¯ç±»å‹ </th><th> åœ¨è¯¾å ‚ä¸Š </th><th> è¯¾å¤– </th><th> è¿›/å‡ºç­ </th></tr></thead><tbody><tr><td> çº¿æ€§æ’è¡¥ </td><td> çº¿æ€§è¿åŠ¨ </td><td>  -- </td><td>  -- </td></tr><tr><td> äºŒæ¬¡æ’å€¼ </td><td>  InQuadMotion </td><td> è¶…è¶Šè¿åŠ¨ </td><td>  InOutQuadMotion </td></tr><tr><td> ä¸‰æ¬¡æ’å€¼ </td><td> ç«‹æ–¹è¿åŠ¨ </td><td> å‡ºè½¨è¿åŠ¨ </td><td>  InOutCubicMotion </td></tr><tr><td>  4é˜¶æ’è¡¥ </td><td>  InQuartMotion </td><td>  OutQuartMotion </td><td>  InOutQuartMotion </td></tr><tr><td> å¼¹è·³æ•ˆæœæ’å€¼ </td><td>  InBounceMotion </td><td>  OutBounceMotion </td><td>  InOutBounceMotion </td></tr><tr><td> å¼¹æ€§å›å¼¹æ’å€¼ </td><td> å¼¹æ€§è¿åŠ¨ </td><td> å¤–å¼¹æ€§è¿åŠ¨ </td><td>  InOutElasticMotion </td></tr><tr><td> æ­£å¼¦æ’å€¼ </td><td>  InSineMotion </td><td> è¶…è¶Šè¿åŠ¨ </td><td>  InOutSineMotion </td></tr><tr><td> åæ’å€¼ </td><td> å†…å‘è¿åŠ¨ </td><td> å†…å‘è¿åŠ¨ </td><td>  InOutBackMotion </td></tr><tr><td> åœ†å¼§æ’è¡¥ </td><td> å¾ªç¯è¿åŠ¨ </td><td> å¤–å¾ªç¯ </td><td>  InOutCircMotion </td></tr><tr><td> æŒ‡æ•°æ’å€¼ </td><td>  InExpoMotion </td><td> å¤–å±• </td><td>  InOutExpoMotion </td></tr></tbody></table><br> ä¸ºäº†åˆ›å»ºå¯¹è±¡è¿åŠ¨çš„çº¿æ€§æ’å€¼ï¼Œæˆ‘ä»¬ç¼–å†™äº†è¿™æ ·çš„ä»£ç  <br><br><pre> <code class="cpp hljs">osg::ref_ptr&lt;osgAnimation::LinearMotion&gt; motion = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> osgAnimation::LinearMotion(<span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">1.0f</span></span>);</code> </pre><br><h1>  3.è½¬æ¢èŠ‚ç‚¹çš„åŠ¨ç”» </h1><br> è½¨è¿¹åŠ¨ç”»æ˜¯å›¾å½¢åº”ç”¨ç¨‹åºä¸­æœ€å¸¸è§çš„åŠ¨ç”»ç±»å‹ã€‚ æ­¤æŠ€æœ¯å¯ç”¨äºä¸ºæ±½è½¦çš„è¿åŠ¨ï¼Œé£æœºçš„é£è¡Œæˆ–ç›¸æœºçš„è¿åŠ¨è®¾ç½®åŠ¨ç”»ã€‚ è½¨è¿¹æ˜¯é¢„å®šä¹‰çš„ï¼Œæ‰€æœ‰ä½ç½®ï¼Œæ—‹è½¬å’Œæ¯”ä¾‹åœ¨å…³é”®æ—¶é—´ç‚¹éƒ½ä¼šå‘ç”Ÿå˜åŒ–ã€‚ å½“æ¨¡æ‹Ÿå‘¨æœŸå¼€å§‹æ—¶ï¼Œå°†åœ¨æ¯ä¸ªå¸§ä¸­é‡æ–°è®¡ç®—å¯¹è±¡çš„çŠ¶æ€ï¼Œå…¶ä¸­çº¿æ€§æ’å€¼ç”¨äºä½ç½®å’Œç¼©æ”¾ï¼Œçƒå½¢çº¿æ€§æ’å€¼ç”¨äºæ—‹è½¬å››å…ƒæ•°ã€‚ ä¸ºæ­¤ï¼Œè¯·ä½¿ç”¨osg :: Quatç±»çš„slerpï¼ˆï¼‰å†…éƒ¨æ–¹æ³•ã€‚ <br><br>  OSGæä¾›äº†osg :: AnimationPathç±»æ¥æè¿°éšæ—¶é—´å˜åŒ–çš„è·¯å¾„ã€‚ æ­¤ç±»çš„æ–¹æ³•insertï¼ˆï¼‰ç”¨äºå°†ä¸æŸäº›æ—¶é—´ç‚¹ç›¸å¯¹åº”çš„æ§åˆ¶ç‚¹æ·»åŠ åˆ°è½¨è¿¹ä¸­ã€‚ æ§åˆ¶ç‚¹ç”±osg :: AnimationPath :: ControlPointç±»æè¿°ï¼Œè¯¥ç±»çš„æ„é€ å‡½æ•°å°†ä½ç½®ä½œä¸ºå‚æ•°ï¼Œå¹¶å¯é€‰åœ°å°†å¯¹è±¡æ—‹è½¬å’Œç¼©æ”¾å‚æ•°ä½œä¸ºå‚æ•°ã€‚ ä¸¾ä¸ªä¾‹å­ <br><br><pre> <code class="cpp hljs">osg::ref_ptr&lt;osg::AnimationPath&gt; path = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> osg::AnimationPath; path-&gt;insert(t1, osg::AnimationPath::ControlPoint(pos1, rot1, scale1)); path-&gt;insert(t2, ...);</code> </pre><br> è¿™é‡Œçš„t1ï¼Œt2æ˜¯ä»¥ç§’ä¸ºå•ä½çš„æ—¶é—´ç¬é—´ï¼›  rot1æ˜¯æ—¶é—´t1å¤„çš„æ—‹è½¬å‚æ•°ï¼Œç”±osg :: Quatå››å…ƒæ•°æè¿°ã€‚ <br><br> å¯ä»¥é€šè¿‡setLoopModeï¼ˆï¼‰æ–¹æ³•æ§åˆ¶åŠ¨ç”»å¾ªç¯ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œâ€œ LOOPâ€æ¨¡å¼å¤„äºæ‰“å¼€çŠ¶æ€-åŠ¨ç”»å°†è¿ç»­é‡å¤ã€‚ å…¶ä»–å¯èƒ½çš„å€¼ï¼šNO_LOOPING-æ’­æ”¾åŠ¨ç”»ä¸€æ¬¡ï¼ŒSWING-å¾ªç¯å‘å‰å’Œå‘åçš„è¿åŠ¨ã€‚ <br><br> åœ¨å®Œæˆæ‰€æœ‰åˆå§‹åŒ–ä¹‹åï¼Œæˆ‘ä»¬å°†osg :: AnimationPathå¯¹è±¡é™„åŠ åˆ°osg :: AnimationPathCallbackå†…ç½®å¯¹è±¡ï¼Œè¯¥å¯¹è±¡æ˜¯ä»osg :: NodeCallbackç±»æ´¾ç”Ÿçš„ã€‚ <br><br><h1>  4.æ²¿è·¯å¾„è¿åŠ¨çš„åŠ¨ç”»ç¤ºä¾‹ </h1><br> ç°åœ¨ï¼Œæˆ‘ä»¬å°†ä½¿cessnaç»•åœ†å¿ƒç§»åŠ¨ï¼Œåœ†å¿ƒçš„ä¸­å¿ƒä¸ºï¼ˆ0,0,0ï¼‰ã€‚ é£æœºåœ¨è½¨è¿¹ä¸Šçš„ä½ç½®å°†é€šè¿‡çº¿æ€§æ’å€¼å…³é”®å¸§ä¹‹é—´çš„ä½ç½®å’Œæ–¹å‘æ¥è®¡ç®—ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">Animcessnaç¤ºä¾‹</b> <div class="spoiler_text">  <strong>ä¸»æ–‡ä»¶</strong> <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifndef</span></span></span><span class="hljs-meta"> MAIN_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> MAIN_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;osg/AnimationPath&gt; #include &lt;osg/MatrixTransform&gt; #include &lt;osgDB/ReadFile&gt; #include &lt;osgViewer/Viewer&gt; #endif</span></span></span></span></code> </pre><br>  <strong>main.cpp</strong> <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"main.h"</span></span></span><span class="hljs-meta"> </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//------------------------------------------------------------------------------ // //------------------------------------------------------------------------------ osg::AnimationPath *createAnimationPath(double radius, double time) { osg::ref_ptr&lt;osg::AnimationPath&gt; path = new osg::AnimationPath; path-&gt;setLoopMode(osg::AnimationPath::LOOP); unsigned int numSamples = 32; double delta_yaw = 2.0 * osg::PI / (static_cast&lt;double&gt;(numSamples) - 1.0); double delta_time = time / static_cast&lt;double&gt;(numSamples); for (unsigned int i = 0; i &lt; numSamples; ++i) { double yaw = delta_yaw * i; osg::Vec3d pos(radius * sin(yaw), radius * cos(yaw), 0.0); osg::Quat rot(-yaw, osg::Z_AXIS); path-&gt;insert(delta_time * i, osg::AnimationPath::ControlPoint(pos, rot)); } return path.release(); } //------------------------------------------------------------------------------ // //------------------------------------------------------------------------------ int main(int argc, char *argv[]) { (void) argc; (void) argv; osg::ref_ptr&lt;osg::Node&gt; model = osgDB::readNodeFile("../data/cessna.osg.0,0,90.rot"); osg::ref_ptr&lt;osg::MatrixTransform&gt; root = new osg::MatrixTransform; root-&gt;addChild(model.get()); osg::ref_ptr&lt;osg::AnimationPathCallback&gt; apcb = new osg::AnimationPathCallback; apcb-&gt;setAnimationPath(createAnimationPath(50.0, 6.0)); root-&gt;setUpdateCallback(apcb.get()); osgViewer::Viewer viewer; viewer.setSceneData(root.get()); return viewer.run(); }</span></span></span></span></code> </pre><br></div></div><br> æˆ‘ä»¬é¦–å…ˆåˆ›å»ºé£æœºçš„è½¨è¿¹ï¼Œç„¶åå°†æ­¤ä»£ç çº³å…¥ä¸€ä¸ªå•ç‹¬çš„å‡½æ•°ä¸­ <br><br><pre> <code class="cpp hljs">osg::<span class="hljs-function"><span class="hljs-function">AnimationPath *</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createAnimationPath</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> radius, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> time)</span></span></span><span class="hljs-function"> </span></span>{ osg::ref_ptr&lt;osg::AnimationPath&gt; path = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> osg::AnimationPath; path-&gt;setLoopMode(osg::AnimationPath::LOOP); <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> numSamples = <span class="hljs-number"><span class="hljs-number">32</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> delta_yaw = <span class="hljs-number"><span class="hljs-number">2.0</span></span> * osg::PI / (<span class="hljs-keyword"><span class="hljs-keyword">static_cast</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>&gt;(numSamples) - <span class="hljs-number"><span class="hljs-number">1.0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> delta_time = time / <span class="hljs-keyword"><span class="hljs-keyword">static_cast</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>&gt;(numSamples); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; numSamples; ++i) { <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> yaw = delta_yaw * i; osg::<span class="hljs-function"><span class="hljs-function">Vec3d </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pos</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(radius * </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">sin</span></span></span></span><span class="hljs-function"><span class="hljs-params">(yaw), radius * </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">cos</span></span></span></span><span class="hljs-function"><span class="hljs-params">(yaw), </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.0</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; osg::<span class="hljs-function"><span class="hljs-function">Quat </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rot</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(-yaw, osg::Z_AXIS)</span></span></span></span>; path-&gt;insert(delta_time * i, osg::AnimationPath::ControlPoint(pos, rot)); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> path.release(); }</code> </pre><br> ä½œä¸ºå‚æ•°ï¼Œè¯¥å‡½æ•°é‡‡ç”¨å¹³é¢æ²¿å…¶ç§»åŠ¨çš„åœ†çš„åŠå¾„ä»¥åŠæ—‹è½¬ä¸€åœˆçš„æ—¶é—´ã€‚ åœ¨å‡½æ•°å†…éƒ¨ï¼Œåˆ›å»ºè½¨è¿¹å¯¹è±¡å¹¶æ‰“å¼€åŠ¨ç”»å¾ªç¯æ¨¡å¼ <br><br><pre> <code class="cpp hljs">osg::ref_ptr&lt;osg::AnimationPath&gt; path = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> osg::AnimationPath; path-&gt;setLoopMode(osg::AnimationPath::LOOP);</code> </pre><br> ä»¥ä¸‹ä»£ç  <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> numSamples = <span class="hljs-number"><span class="hljs-number">32</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> delta_yaw = <span class="hljs-number"><span class="hljs-number">2.0</span></span> * osg::PI / (<span class="hljs-keyword"><span class="hljs-keyword">static_cast</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>&gt;(numSamples) - <span class="hljs-number"><span class="hljs-number">1.0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> delta_time = time / <span class="hljs-keyword"><span class="hljs-keyword">static_cast</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>&gt;(numSamples);</code> </pre><br> è®¡ç®—è½¨è¿¹çš„è¿‘ä¼¼å‚æ•°ã€‚ æˆ‘ä»¬å°†æ•´ä¸ªè½¨è¿¹åˆ’åˆ†ä¸ºç›´çº¿éƒ¨åˆ†çš„numSamplesï¼Œå¹¶è®¡ç®—å¹³é¢ç»•å‚ç›´è½´ï¼ˆyawï¼‰delta_yawçš„æ—‹è½¬è§’åº¦çš„å˜åŒ–ä»¥åŠä»ä¸€ä¸ªéƒ¨åˆ†ç§»åŠ¨åˆ°å¦ä¸€ä¸ªéƒ¨åˆ†æ—¶æ—¶é—´delta_timeçš„å˜åŒ–ã€‚ ç°åœ¨åˆ›å»ºå¿…è¦çš„æ§åˆ¶ç‚¹ <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; numSamples; ++i) { <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> yaw = delta_yaw * i; osg::<span class="hljs-function"><span class="hljs-function">Vec3d </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pos</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(radius * </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">sin</span></span></span></span><span class="hljs-function"><span class="hljs-params">(yaw), radius * </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">cos</span></span></span></span><span class="hljs-function"><span class="hljs-params">(yaw), </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.0</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; osg::<span class="hljs-function"><span class="hljs-function">Quat </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rot</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(-yaw, osg::Z_AXIS)</span></span></span></span>; path-&gt;insert(delta_time * i, osg::AnimationPath::ControlPoint(pos, rot)); }</code> </pre><br> åœ¨å¾ªç¯ä¸­ï¼Œå°†å¯¹è½¨è¿¹çš„æ‰€æœ‰éƒ¨åˆ†è¿›è¡Œæ’åºã€‚ æ¯ä¸ªæ§åˆ¶ç‚¹éƒ½ä»¥åèˆªè§’ä¸ºç‰¹å¾ <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">double</span></span> yaw = delta_yaw * i;</code> </pre><br> é£æœºè´¨å¿ƒåœ¨å¤ªç©ºä¸­çš„ä½ç½® <br><br><pre> <code class="cpp hljs">osg::<span class="hljs-function"><span class="hljs-function">Vec3d </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pos</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(radius * </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">sin</span></span></span></span><span class="hljs-function"><span class="hljs-params">(yaw), radius * </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">cos</span></span></span></span><span class="hljs-function"><span class="hljs-params">(yaw), </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.0</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>;</code> </pre><br> é£æœºæ—‹è½¬åˆ°æ‰€éœ€çš„åèˆªè§’ï¼ˆç›¸å¯¹äºå‚ç›´è½´ï¼‰ç”±å››å…ƒæ•°è®¾ç½® <br><br><pre> <code class="cpp hljs">osg::<span class="hljs-function"><span class="hljs-function">Quat </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rot</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(-yaw, osg::Z_AXIS)</span></span></span></span>;</code> </pre><br> ç„¶åå°†è®¡ç®—å‡ºçš„å‚æ•°æ·»åŠ åˆ°è·¯å¾„çš„æ§åˆ¶ç‚¹åˆ—è¡¨ä¸­ <br><br><pre> <code class="cpp hljs">path-&gt;insert(delta_time * i, osg::AnimationPath::ControlPoint(pos, rot));</code> </pre><br> åœ¨ä¸»ç¨‹åºä¸­ï¼Œæˆ‘ä»¬åœ¨å¯åŠ¨æ—¶æŒ‡å‡ºé£æœºæ¨¡å‹æ–‡ä»¶çš„åç§°æ—¶è¦æ³¨æ„ç»†å¾®å·®åˆ« <br><br><pre> <code class="cpp hljs">osg::ref_ptr&lt;osg::Node&gt; model = osgDB::readNodeFile(<span class="hljs-string"><span class="hljs-string">"../data/cessna.osg.0,0,90.rot"</span></span>);</code> </pre><br>  -åœ¨æ–‡ä»¶åä¸­æ·»åŠ äº†åç¼€â€œ .0,0,90.rotâ€ã€‚ ä»OSGä¸­ä½¿ç”¨çš„æ–‡ä»¶ä¸­åŠ è½½å‡ ä½•å›¾å½¢çš„æœºåˆ¶å…è®¸æ‚¨æŒ‡å®šåŠ è½½åæ¨¡å‹çš„åˆå§‹ä½ç½®å’Œæ–¹å‘ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›æ¨¡å‹åœ¨åŠ è½½åç»•Zè½´æ—‹è½¬90åº¦ã€‚ <br><br> æ¥ä¸‹æ¥ï¼Œåˆ›å»ºæ ¹èŠ‚ç‚¹ï¼Œå³è½¬æ¢èŠ‚ç‚¹ï¼Œå¹¶å°†æ¨¡å‹å¯¹è±¡ä½œä¸ºå­èŠ‚ç‚¹æ·»åŠ åˆ°è¯¥æ ¹èŠ‚ç‚¹ä¸­ã€‚ <br><br><pre> <code class="cpp hljs">osg::ref_ptr&lt;osg::MatrixTransform&gt; root = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> osg::MatrixTransform; root-&gt;addChild(model.get());</code> </pre><br> ç°åœ¨åˆ›å»ºä¸€ä¸ªè½¨è¿¹åŠ¨ç”»å›è°ƒï¼Œå‘å…¶æ·»åŠ ç”±createAnimationPathï¼ˆï¼‰å‡½æ•°åˆ›å»ºçš„è·¯å¾„ã€‚ <br><br><pre> <code class="cpp hljs">osg::ref_ptr&lt;osg::AnimationPathCallback&gt; apcb = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> osg::AnimationPathCallback; apcb-&gt;setAnimationPath(createAnimationPath(<span class="hljs-number"><span class="hljs-number">50.0</span></span>, <span class="hljs-number"><span class="hljs-number">6.0</span></span>));</code> </pre><br> å°†æ­¤å›è°ƒé™„åŠ åˆ°è½¬æ¢èŠ‚ç‚¹ <br><br><pre> <code class="cpp hljs">root-&gt;setUpdateCallback(apcb.get());</code> </pre><br> æŸ¥çœ‹å™¨å°†ç…§å¸¸åˆå§‹åŒ–å¹¶å¯åŠ¨ã€‚ <br><br><pre> <code class="cpp hljs">osgViewer::Viewer viewer; viewer.setSceneData(root.get()); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> viewer.run();</code> </pre><br> è·å–é£æœºåŠ¨ä½œåŠ¨ç”» <br><br><img src="https://habrastorage.org/webt/ax/01/rl/ax01rlkfna5cfkvzqk3qfao_lmq.gif"><br><br> è®¤ä¸ºæ‚¨åœ¨æ­¤ç¤ºä¾‹ä¸­å‘ç°äº†ä»€ä¹ˆå¥‡æ€ªçš„ä¸œè¥¿ï¼Ÿ ä»¥å‰ï¼Œä¾‹å¦‚ï¼Œåœ¨ç¨‹åºä¸­ï¼Œå½“æ¸²æŸ“åˆ°çº¹ç†æ—¶ï¼Œæ‚¨æ˜¾å¼æ›´æ”¹äº†è½¬æ¢çŸ©é˜µï¼Œä»¥å®ç°æ¨¡å‹åœ¨ç©ºé—´ä¸­çš„ä½ç½®æ›´æ”¹ã€‚ åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬åªæ˜¯åˆ›å»ºä¸€ä¸ªè½¬æ¢èŠ‚ç‚¹ï¼Œå¹¶ä¸”åœ¨ä»£ç ä¸­æ²¡æœ‰ä»»ä½•æ˜ç¡®çš„çŸ©é˜µåˆ†é…ã€‚ <br><br> ç§˜å¯†åœ¨äºç‰¹æ®Šçš„osg :: AnimationPathCallbackç±»å¯ä»¥å®Œæˆæ­¤å·¥ä½œã€‚ æ ¹æ®å¯¹è±¡åœ¨è·¯å¾„ä¸Šçš„å½“å‰ä½ç½®ï¼Œå®ƒè®¡ç®—è½¬æ¢çŸ©é˜µå¹¶å°†å…¶è‡ªåŠ¨åº”ç”¨äºä¸å…¶ç›¸è¿çš„è½¬æ¢èŠ‚ç‚¹ï¼Œä»è€Œä½¿å¼€å‘äººå‘˜å…äºè¿›è¡Œä¸€ç³»åˆ—å¸¸è§„æ“ä½œã€‚ <br><br> åº”å½“æ³¨æ„ï¼Œå°†osg :: AnimationPathCallbacké™„åŠ åˆ°å…¶ä»–ç±»å‹çš„èŠ‚ç‚¹ä¸ä»…æ— æ•ˆï¼Œè€Œä¸”å¯èƒ½å¯¼è‡´æœªå®šä¹‰çš„ç¨‹åºè¡Œä¸ºã€‚ é‡è¦çš„æ˜¯è¦è®°ä½ï¼Œæ­¤å›è°ƒä»…å½±å“è½¬æ¢èŠ‚ç‚¹ã€‚ <br><br><h1>  5.è½¯ä»¶æ§åˆ¶åŠ¨ç”» </h1><br>  osg :: AnimationPathCallbackç±»æä¾›äº†åœ¨ç¨‹åºæ‰§è¡ŒæœŸé—´æ§åˆ¶åŠ¨ç”»çš„æ–¹æ³•ã€‚ <br><br><ol><li>  resetï¼ˆï¼‰-é‡è®¾åŠ¨ç”»å¹¶é¦–å…ˆæ’­æ”¾ã€‚ <br></li><li>  setPauseï¼ˆï¼‰-æš‚åœåŠ¨ç”»ã€‚ å°†å¸ƒå°”å€¼ä½œä¸ºå‚æ•° <br></li><li>  setTimeOffsetï¼ˆï¼‰-è®¾ç½®åŠ¨ç”»å¼€å§‹ä¹‹å‰çš„æ—¶é—´åç§»ã€‚ <br></li><li>  setTimeMultiplierï¼ˆï¼‰-è®¾ç½®åŠ¨ç”»åŠ é€Ÿ/å‡é€Ÿçš„æ—¶é—´å› å­ã€‚ <br></li></ol><br> ä¾‹å¦‚ï¼Œè¦ä»æš‚åœå’Œé‡ç½®ä¸­åˆ é™¤åŠ¨ç”»ï¼Œæˆ‘ä»¬æ‰§è¡Œä»¥ä¸‹ä»£ç  <br><br><pre> <code class="cpp hljs">apcb-&gt;setPause(<span class="hljs-literal"><span class="hljs-literal">false</span></span>); apcb-&gt;reset();</code> </pre><br> å¹¶ä»¥åŒå€åŠ é€Ÿå¯åŠ¨ç¨‹åºåä»ç¬¬å››ç§’å¼€å§‹åŠ¨ç”»ï¼Œä¾‹å¦‚ <br><br><pre> <code class="cpp hljs">apcb-&gt;setTimeOffset(<span class="hljs-number"><span class="hljs-number">4.0f</span></span>); apcb-&gt;setTimeMultiplier(<span class="hljs-number"><span class="hljs-number">2.0f</span></span>);</code> </pre><br><h1>  6. OpenGLä¸­æ¸²æŸ“å›¾å…ƒçš„é¡ºåº </h1><br>  OpenGLå°†é¡¶ç‚¹å’ŒåŸºæœ¬æ•°æ®å­˜å‚¨åœ¨å„ç§ç¼“å†²åŒºä¸­ï¼Œä¾‹å¦‚é¢œè‰²ç¼“å†²åŒºï¼Œæ·±åº¦ç¼“å†²åŒºï¼Œæ¨¡æ¿ç¼“å†²åŒºç­‰ã€‚ æ­¤å¤–ï¼Œä»–ä¸ä¼šè¦†ç›–å·²ç»å‘é€åˆ°ç®¡é“çš„é¡¶ç‚¹å’Œä¸‰è§’å½¢é¢ã€‚ è¿™æ„å‘³ç€ï¼Œæ— è®ºå¦‚ä½•åˆ›å»ºç°æœ‰å‡ ä½•å›¾å½¢ï¼ŒOpenGLéƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å‡ ä½•å›¾å½¢ã€‚ è¿™æ„å‘³ç€å°†åŸºå…ƒå‘é€åˆ°æ¸²æŸ“ç®¡é“çš„é¡ºåºä¼šæ˜¾ç€å½±å“æˆ‘ä»¬åœ¨å±å¹•ä¸Šçœ‹åˆ°çš„æœ€ç»ˆç»“æœã€‚ <br><br> åŸºäºæ·±åº¦ç¼“å†²åŒºæ•°æ®ï¼ŒOpenGLå°†æ­£ç¡®ç»˜åˆ¶ä¸é€æ˜å¯¹è±¡ï¼Œå¹¶æ ¹æ®åƒç´ ä¸è§‚å¯Ÿè€…ä¹‹é—´çš„è·ç¦»å¯¹å…¶è¿›è¡Œæ’åºã€‚ ä½†æ˜¯ï¼Œå½“ä½¿ç”¨é¢œè‰²æ··åˆæŠ€æœ¯æ—¶ï¼Œä¾‹å¦‚ï¼Œå½“å®ç°é€æ˜å’ŒåŠé€æ˜çš„å¯¹è±¡æ—¶ï¼Œå°†æ‰§è¡Œç‰¹æ®Šæ“ä½œä»¥æ›´æ–°é¢œè‰²ç¼“å†²åŒºã€‚ è€ƒè™‘åˆ°alphaé€šé“çš„å€¼ï¼ˆç¬¬å››ç§é¢œè‰²åˆ†é‡ï¼‰ï¼Œå›¾åƒçš„æ–°åƒç´ å’Œæ—§åƒç´ å°†æ··åˆåœ¨ä¸€èµ·ã€‚ è¿™å¯¼è‡´ä»¥ä¸‹äº‹å®ï¼šåŠé€æ˜å’Œä¸é€æ˜è¾¹ç¼˜çš„æ¸²æŸ“é¡ºåºä¼šå½±å“æœ€ç»ˆç»“æœ <br><br><img src="https://habrastorage.org/webt/tz/3w/o4/tz3wo4dfy14oscogqvrb1akmh5m.png"><br><br> åœ¨å›¾ä¸­ï¼Œåœ¨å·¦ä¾§æƒ…å†µä¸‹ï¼Œé¦–å…ˆå°†ä¸é€æ˜çš„å¯¹è±¡ç„¶åæ˜¯é€æ˜çš„å¯¹è±¡å‘é€åˆ°ç®¡é“ï¼Œè¿™å¯¼è‡´é¢œè‰²ç¼“å†²åŒºä¸­çš„æ­£ç¡®åç§»å’Œé¢éƒ¨çš„æ­£ç¡®æ˜¾ç¤ºã€‚ åœ¨æ­£ç¡®çš„æƒ…å†µä¸‹ï¼Œå…ˆç»˜åˆ¶é€æ˜å¯¹è±¡ï¼Œç„¶åç»˜åˆ¶ä¸é€æ˜å¯¹è±¡ï¼Œè¿™å°†å¯¼è‡´æ˜¾ç¤ºä¸æ­£ç¡®ã€‚ <br><br>  osg :: StateSetç±»çš„setRenderingHintï¼ˆï¼‰æ–¹æ³•å‘OSGæŒ‡ç¤ºèŠ‚ç‚¹å’Œå‡ ä½•å¯¹è±¡çš„æ‰€éœ€æ¸²æŸ“é¡ºåºï¼ˆå¦‚æœå¿…é¡»æ˜¾å¼å®Œæˆï¼‰ã€‚ æ­¤æ–¹æ³•ä»…æŒ‡ç¤ºåœ¨æ¸²æŸ“æ—¶æ˜¯å¦åº”è€ƒè™‘åŠé€æ˜çš„é¢éƒ¨ï¼Œä»è€Œç¡®ä¿åœ¨åœºæ™¯ä¸­å­˜åœ¨åŠé€æ˜çš„é¢éƒ¨æ—¶ï¼Œè€ƒè™‘åˆ°è§‚å¯Ÿè€…çš„è·ç¦»ï¼Œé¦–å…ˆç»˜åˆ¶ä¸é€æ˜ç„¶åé€æ˜çš„é¢éƒ¨ã€‚ ä¸ºäº†é€šçŸ¥å¼•æ“è¯¥èŠ‚ç‚¹æ˜¯ä¸é€æ˜çš„ï¼Œæˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹ä»£ç  <br><br><pre> <code class="cpp hljs">node-&gt;getOrCreateStateSet()-&gt;setRenderingHint(osg::StateSet::OPAQUE_BIN);</code> </pre><br> æˆ–åŒ…å«é€æ˜è¾¹ç¼˜ <br><br><pre> <code class="cpp hljs">node-&gt;getOrCreateStateSet()-&gt;setRenderingHint(osg::StateSet::TRANSPARENT_BIN);</code> </pre><br><h1>  7.åŠé€æ˜å¯¹è±¡çš„å®ç°ç¤ºä¾‹ </h1><br> è®©æˆ‘ä»¬å°è¯•ä»¥å®ç°é€æ˜å¯¹è±¡çš„å…·ä½“ç¤ºä¾‹æ¥è¯´æ˜æ‰€æœ‰ä¸Šè¿°ç†è®ºä»‹ç»ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">é€æ˜åº¦ç¤ºä¾‹</b> <div class="spoiler_text">  <strong>ä¸»æ–‡ä»¶</strong> <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifndef</span></span></span><span class="hljs-meta"> MAIN_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> MAIN_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;osg/BlendFunc&gt; #include &lt;osg/Texture2D&gt; #include &lt;osg/Geometry&gt; #include &lt;osgDB/ReadFile&gt; #include &lt;osgViewer/Viewer&gt; #endif</span></span></span></span></code> </pre><br>  <strong>main.cpp</strong> <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"main.h"</span></span></span><span class="hljs-meta"> int main(int argc, char *argv[]) { (void) argc; (void) argv; osg::ref_ptr</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;osg::Vec3Array&gt; vertices = new osg::Vec3Array; vertices-&gt;push_back( osg::Vec3(-0.5f, 0.0f, -0.5f) ); vertices-&gt;push_back( osg::Vec3( 0.5f, 0.0f, -0.5f) ); vertices-&gt;push_back( osg::Vec3( 0.5f, 0.0f, 0.5f) ); vertices-&gt;push_back( osg::Vec3(-0.5f, 0.0f, 0.5f) ); osg::ref_ptr&lt;osg::Vec3Array&gt; normals = new osg::Vec3Array; normals-&gt;push_back( osg::Vec3(0.0f, -1.0f, 0.0f) ); osg::ref_ptr&lt;osg::Vec2Array&gt; texcoords = new osg::Vec2Array; texcoords-&gt;push_back( osg::Vec2(0.0f, 0.0f) ); texcoords-&gt;push_back( osg::Vec2(0.0f, 1.0f) ); texcoords-&gt;push_back( osg::Vec2(1.0f, 1.0f) ); texcoords-&gt;push_back( osg::Vec2(1.0f, 0.0f) ); osg::ref_ptr&lt;osg::Vec4Array&gt; colors = new osg::Vec4Array; colors-&gt;push_back( osg::Vec4(1.0f, 1.0f, 1.0f, 0.5f) ); osg::ref_ptr&lt;osg::Geometry&gt; quad = new osg::Geometry; quad-&gt;setVertexArray(vertices.get()); quad-&gt;setNormalArray(normals.get()); quad-&gt;setNormalBinding(osg::Geometry::BIND_OVERALL); quad-&gt;setColorArray(colors.get()); quad-&gt;setColorBinding(osg::Geometry::BIND_OVERALL); quad-&gt;setTexCoordArray(0, texcoords.get()); quad-&gt;addPrimitiveSet(new osg::DrawArrays(GL_QUADS, 0, 4)); osg::ref_ptr&lt;osg::Geode&gt; geode = new osg::Geode; geode-&gt;addDrawable(quad.get()); osg::ref_ptr&lt;osg::Texture2D&gt; texture = new osg::Texture2D; osg::ref_ptr&lt;osg::Image&gt; image = osgDB::readImageFile("../data/Images/lz.rgb"); texture-&gt;setImage(image.get()); osg::ref_ptr&lt;osg::BlendFunc&gt; blendFunc = new osg::BlendFunc; blendFunc-&gt;setFunction(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA); osg::StateSet *stateset = geode-&gt;getOrCreateStateSet(); stateset-&gt;setTextureAttributeAndModes(0, texture.get()); stateset-&gt;setAttributeAndModes(blendFunc); osg::ref_ptr&lt;osg::Group&gt; root = new osg::Group; root-&gt;addChild(geode.get()); root-&gt;addChild(osgDB::readNodeFile("../data/glider.osg")); osgViewer::Viewer viewer; viewer.setSceneData(root.get()); return viewer.run(); }</span></span></span></span></code> </pre><br></div></div><br> åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæ­¤å¤„æ˜¾ç¤ºçš„ä»£ç ä¸åŒ…å«ä»»ä½•æ–°å†…å®¹ï¼šåˆ›å»ºäº†ä¸¤ä¸ªå‡ ä½•å¯¹è±¡-å¸¦çº¹ç†çš„æ­£æ–¹å½¢å’Œæ‚¬æŒ‚å¼æ»‘ç¿”æœºï¼Œå…¶æ¨¡å‹æ˜¯ä»æ–‡ä»¶ä¸­åŠ è½½çš„ã€‚ ä½†æ˜¯ï¼Œæˆ‘ä»¬å°†ç™½è‰²åŠé€æ˜é¢œè‰²åº”ç”¨äºæ­£æ–¹å½¢çš„æ‰€æœ‰é¡¶ç‚¹ <br><br><pre> <code class="cpp hljs">colors-&gt;push_back( osg::Vec4(<span class="hljs-number"><span class="hljs-number">1.0f</span></span>, <span class="hljs-number"><span class="hljs-number">1.0f</span></span>, <span class="hljs-number"><span class="hljs-number">1.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.5f</span></span>) );</code> </pre><br>  -Alphaé€šé“å€¼ä¸º0.5ï¼Œå½“ä¸çº¹ç†é¢œè‰²æ··åˆæ—¶ï¼Œåº”å…·æœ‰åŠé€æ˜å¯¹è±¡çš„æ•ˆæœã€‚ æ­¤å¤–ï¼Œåº”è®¾ç½®é¢œè‰²æ··åˆåŠŸèƒ½ä»¥è¿›è¡Œé€æ˜åº¦å¤„ç†ã€‚ <br><br><pre> <code class="cpp hljs">osg::ref_ptr&lt;osg::BlendFunc&gt; blendFunc = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> osg::BlendFunc; blendFunc-&gt;setFunction(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);</code> </pre><br> å°†å…¶ä¼ é€’ç»™OpenGLçŠ¶æ€æœº <br><br><pre> <code class="cpp hljs">stateset-&gt;setAttributeAndModes(blendFunc);</code> </pre><br> ç¼–è¯‘å¹¶è¿è¡Œè¯¥ç¨‹åºæ—¶ï¼Œæˆ‘ä»¬å¾—åˆ°ä»¥ä¸‹ç»“æœ <br><br><img src="https://habrastorage.org/webt/_m/mz/kz/_mmzkzrmxvmfll-qi0xli6wq_5g.png"><br><br> åˆ«è¯´äº† é€æ˜åº¦åœ¨å“ªé‡Œï¼Ÿ é—®é¢˜æ˜¯æˆ‘ä»¬å¿˜è®°å‘Šè¯‰å¼•æ“åº”è¯¥å¤„ç†é€æ˜è¾¹ï¼Œè¿™å¾ˆå®¹æ˜“é€šè¿‡è°ƒç”¨æ¥è§£å†³ <br><br><pre> <code class="cpp hljs">stateset-&gt;setRenderingHint(osg::StateSet::TRANSPARENT_BIN);</code> </pre><br> åœ¨æ­¤ä¹‹åï¼Œæˆ‘ä»¬å¾—åˆ°äº†æ‰€éœ€çš„ç»“æœ-æ‚¬æŒ‚å¼æ»‘ç¿”æœºç¿¼é€šè¿‡åŠé€æ˜çš„çº¹ç†æ­£æ–¹å½¢å‘å…‰ <br><br><img src="https://habrastorage.org/webt/py/bl/ta/pybltaqa6xkligouodxgunwoyvs.png"><br><br>  GL_SRC_ALPHAå’ŒGL_ONE_MINUS_SRC_ALPHAæ··åˆå‡½æ•°çš„å‚æ•°æ„å‘³ç€ï¼Œç»˜åˆ¶åŠé€æ˜é¢æ—¶æ‰€å¾—çš„å±å¹•åƒç´ å°†å…·æœ‰é€šè¿‡å…¬å¼è®¡ç®—çš„é¢œè‰²åˆ†é‡ <br><br><pre> <code class="plaintext hljs">R = srcR * srcA + dstR * (1 - srcA) G = srcG * srcA + dstG * (1 - srcA) B = srcB * srcA + dstB * (1 - srcA)</code> </pre><br> å…¶ä¸­[srcRï¼ŒsrcGï¼ŒsrcB]æ˜¯æ­£æ–¹å½¢çº¹ç†çš„é¢œè‰²åˆ†é‡ï¼›<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[dstRï¼ŒdstGï¼ŒdstB]-å‡å®šå·²ç»åœ¨æ­¤ä½ç½®ç»˜åˆ¶äº†æ»‘ç¿”æœºç¿¼çš„èƒŒæ™¯å’Œä¸é€æ˜è¾¹ç¼˜ï¼Œåˆ™åœ¨è¯¥éƒ¨åˆ†ä¸Šå åŠ äº†åŠé€æ˜é¢çš„æ¯ä¸ªåƒç´ çš„é¢œè‰²åˆ†é‡ã€‚</font><font style="vertical-align: inherit;">srcAæ˜¯æŒ‡æ­£æ–¹å½¢é¢œè‰²çš„alphaåˆ†é‡ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">seRenderingHintï¼ˆï¼‰æ–¹æ³•å¯ä»¥å®Œç¾åœ°å®‰æ’åŸºå…ƒçš„å‘ˆç°ï¼Œä½†æ˜¯ä½¿ç”¨å®ƒçš„æ•ˆç‡ä¸æ˜¯å¾ˆé«˜ï¼Œå› ä¸ºåœ¨å‘ˆç°å¸§æ—¶æŒ‰æ·±åº¦å¯¹é€æ˜å¯¹è±¡è¿›è¡Œæ’åºæ˜¯ä¸€é¡¹éå¸¸è€—è´¹èµ„æºçš„æ“ä½œã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œå¦‚æœå¯èƒ½çš„è¯ï¼Œåœ¨åœºæ™¯å‡†å¤‡çš„åˆå§‹é˜¶æ®µï¼Œå¼€å‘äººå‘˜åº”æ³¨æ„è‡ªå·±ç»˜åˆ¶é¢å­”çš„é¡ºåºã€‚</font></font><br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 8.çŠ¶æ€å±æ€§çš„åŠ¨ç”» </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½¿ç”¨åŠ¨ç”»ï¼Œæ‚¨è¿˜å¯ä»¥æ§åˆ¶çŠ¶æ€å±æ€§ã€‚</font><font style="vertical-align: inherit;">é€šè¿‡æ›´æ”¹ä¸€ä¸ªæˆ–å¤šä¸ªæ¸²æŸ“å±æ€§çš„å±æ€§ï¼Œå¯ä»¥ç”Ÿæˆæ•´ä¸ªè§†è§‰æ•ˆæœã€‚</font><font style="vertical-align: inherit;">åœ¨åœºæ™¯æ›´æ–°æ—¶ï¼Œé€šè¿‡å›è°ƒæœºåˆ¶å¾ˆå®¹æ˜“å®ç°è¿™ç§æ”¹å˜æ¸²æŸ“å±æ€§çŠ¶æ€çš„åŠ¨ç”»ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ ‡å‡†æ’å€¼çš„ç±»åˆ«ä¹Ÿå¯ä»¥ç”¨äºæŒ‡å®šæ›´æ”¹å±æ€§å‚æ•°çš„åŠŸèƒ½ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å·²ç»å…·æœ‰åˆ›å»ºåŠé€æ˜å¯¹è±¡çš„ç»éªŒã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬çŸ¥é“ï¼Œå¦‚æœé¢œè‰²çš„alphaåˆ†é‡ä¸ºé›¶ï¼Œæˆ‘ä»¬å°†å¾—åˆ°ä¸€ä¸ªå®Œå…¨é€æ˜çš„å¯¹è±¡ï¼Œå…¶å€¼ä¸º1-å®Œå…¨ä¸é€æ˜ã€‚</font><font style="vertical-align: inherit;">æ˜¾ç„¶ï¼Œé€šè¿‡å°†è¯¥å‚æ•°ä»0æ”¹å˜ä¸º1ï¼Œå¯ä»¥å¾—åˆ°ç‰©ä½“é€æ¸å‡ºç°æˆ–æ¶ˆå¤±çš„æ•ˆæœã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬ç”¨ä¸€ä¸ªå…·ä½“çš„ä¾‹å­æ¥è¯´æ˜è¿™ä¸€ç‚¹ã€‚</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ·¡å…¥ç¤ºä¾‹</font></font></b> <div class="spoiler_text">  <strong>ä¸»æ–‡ä»¶</strong> <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifndef</span></span></span><span class="hljs-meta"> MAIN_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> MAIN_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;osg/Geode&gt; #include &lt;osg/Geometry&gt; #include &lt;osg/BlendFunc&gt; #include &lt;osg/Material&gt; #include &lt;osgAnimation/EaseMotion&gt; #include &lt;osgDB/ReadFile&gt; #include &lt;osgViewer/Viewer&gt; #endif</span></span></span></span></code> </pre><br>  <strong>main.cpp</strong> <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"main.h"</span></span></span><span class="hljs-meta"> </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//------------------------------------------------------------------------------ // //------------------------------------------------------------------------------ class AlphaFadingCallback : public osg::StateAttributeCallback { public: AlphaFadingCallback() { _motion = new osgAnimation::InOutCubicMotion(0.0f, 1.0f); } virtual void operator() (osg::StateAttribute* , osg::NodeVisitor*); protected: osg::ref_ptr&lt;osgAnimation::InOutCubicMotion&gt; _motion; }; //------------------------------------------------------------------------------ // //------------------------------------------------------------------------------ void AlphaFadingCallback::operator()(osg::StateAttribute *sa, osg::NodeVisitor *nv) { (void) nv; osg::Material *material = static_cast&lt;osg::Material *&gt;(sa); if (material) { _motion-&gt;update(0.0005f); float alpha = _motion-&gt;getValue(); material-&gt;setDiffuse(osg::Material::FRONT_AND_BACK, osg::Vec4(0.0f, 1.0f, 1.0f, alpha)); } } //------------------------------------------------------------------------------ // //------------------------------------------------------------------------------ int main(int argc, char *argv[]) { (void) argc; (void) argv; osg::ref_ptr&lt;osg::Drawable&gt; quad = osg::createTexturedQuadGeometry( osg::Vec3(-0.5f, 0.0f, -0.5f), osg::Vec3(1.0f, 0.0f, 0.0f), osg::Vec3(0.0f, 0.0f, 1.0f)); osg::ref_ptr&lt;osg::Geode&gt; geode = new osg::Geode; geode-&gt;addDrawable(quad.get()); osg::ref_ptr&lt;osg::Material&gt; material = new osg::Material; material-&gt;setAmbient(osg::Material::FRONT_AND_BACK, osg::Vec4(0.0f, 0.0f, 0.0f, 1.0f)); material-&gt;setDiffuse(osg::Material::FRONT_AND_BACK, osg::Vec4(0.0f, 1.0f, 1.0f, 0.5f)); material-&gt;setUpdateCallback(new AlphaFadingCallback); geode-&gt;getOrCreateStateSet()-&gt;setAttributeAndModes(material.get()); geode-&gt;getOrCreateStateSet()-&gt;setAttributeAndModes(new osg::BlendFunc(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA)); geode-&gt;getOrCreateStateSet()-&gt;setRenderingHint(osg::StateSet::TRANSPARENT_BIN); osg::ref_ptr&lt;osg::Group&gt; root = new osg::Group; root-&gt;addChild(geode.get()); root-&gt;addChild(osgDB::readNodeFile("../data/glider.osg")); osgViewer::Viewer viewer; viewer.setSceneData(root.get()); return viewer.run(); }</span></span></span></span></code> </pre><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æˆ‘ä»¬é¦–å…ˆåˆ›å»ºä¸€ä¸ªå›è°ƒå¤„ç†ç¨‹åºï¼Œä»¥éšç€æ—¶é—´çš„æ¨ç§»æ›´æ”¹Alphaé€šé“çš„å€¼ </font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AlphaFadingCallback</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> osg::StateAttributeCallback { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: AlphaFadingCallback() { _motion = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> osgAnimation::InOutCubicMotion(<span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">1.0f</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">operator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(osg::StateAttribute* , osg::NodeVisitor*)</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span>: osg::ref_ptr&lt;osgAnimation::InOutCubicMotion&gt; _motion; };</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å—ä¿æŠ¤çš„å‚æ•°_motionå°†ç¡®å®šAlphaå€¼éšæ—¶é—´å˜åŒ–çš„åŠŸèƒ½ã€‚</font><font style="vertical-align: inherit;">å¯¹äºæ­¤ç¤ºä¾‹ï¼Œæˆ‘ä»¬é€‰æ‹©ä¸‰æ¬¡æ ·æ¡æ›²çº¿é€¼è¿‘ï¼Œå¹¶åœ¨ç±»æ„é€ å‡½æ•°ä¸­ç«‹å³è¿›è¡Œè®¾ç½®</font></font><br><br><pre> <code class="cpp hljs">AlphaFadingCallback() { _motion = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> osgAnimation::InOutCubicMotion(<span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">1.0f</span></span>); }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿™ç§ä¾èµ–æ€§å¯ä»¥ç”¨è¿™æ ·çš„æ›²çº¿æ¥è¯´æ˜</font></font><br><br><img src="https://habrastorage.org/webt/ej/gd/cr/ejgdcr97gkb0lru6evved46sk6q.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šåœ¨InOutCubicMotionå¯¹è±¡çš„æ„é€ å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬ç¡®å®šä»0åˆ°1çš„è¿‘ä¼¼å€¼çš„é™åˆ¶ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä»¥è¿™ç§æ–¹å¼é‡æ–°å®šä¹‰æ­¤ç±»çš„operatorï¼ˆï¼‰</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> AlphaFadingCallback::<span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>()(osg::StateAttribute *sa, osg::NodeVisitor *nv) { (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>) nv; osg::Material *material = <span class="hljs-keyword"><span class="hljs-keyword">static_cast</span></span>&lt;osg::Material *&gt;(sa); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (material) { _motion-&gt;update(<span class="hljs-number"><span class="hljs-number">0.0005f</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> alpha = _motion-&gt;getValue(); material-&gt;setDiffuse(osg::Material::FRONT_AND_BACK, osg::Vec4(<span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">1.0f</span></span>, <span class="hljs-number"><span class="hljs-number">1.0f</span></span>, alpha)); } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> è·å–ææ–™çš„æŒ‡é’ˆ </font></font><br><br><pre> <code class="cpp hljs">osg::Material *material = <span class="hljs-keyword"><span class="hljs-keyword">static_cast</span></span>&lt;osg::Material *&gt;(sa);</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å±æ€§çš„æŠ½è±¡å€¼ç”¨äºå›è°ƒï¼Œä½†æ˜¯æˆ‘ä»¬å°†æ­¤å¤„ç†ç¨‹åºé™„åŠ åˆ°ç‰©æ–™ï¼Œå› æ­¤å®ƒæ˜¯å³å°†å‡ºç°çš„ç‰©æ–™çš„æŒ‡é’ˆï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å®‰å…¨åœ°å°†stateå±æ€§è½¬æ¢ä¸ºç‰©æ–™çš„æŒ‡é’ˆã€‚</font><font style="vertical-align: inherit;">æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è®¾ç½®è¿‘ä¼¼å‡½æ•°çš„æ›´æ–°é—´éš”-é—´éš”è¶Šå¤§ï¼Œå‚æ•°åœ¨æŒ‡å®šèŒƒå›´å†…å˜åŒ–çš„é€Ÿåº¦è¶Šå¿«</font></font><br><br><pre> <code class="cpp hljs">_motion-&gt;update(<span class="hljs-number"><span class="hljs-number">0.0005f</span></span>);</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æˆ‘ä»¬è¯»å–è¿‘ä¼¼å‡½æ•°çš„å€¼ </font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">float</span></span> alpha = _motion-&gt;getValue();</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å¹¶èµ‹äºˆæè´¨æ–°çš„æ¼«åå°„è‰²å€¼ </font></font><br><br><pre> <code class="cpp hljs">material-&gt;setDiffuse(osg::Material::FRONT_AND_BACK, osg::Vec4(<span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">1.0f</span></span>, <span class="hljs-number"><span class="hljs-number">1.0f</span></span>, alpha));</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨ï¼Œè®©æˆ‘ä»¬åœ¨mainï¼ˆï¼‰å‡½æ•°ä¸­å½¢æˆåœºæ™¯ã€‚</font><font style="vertical-align: inherit;">æˆ‘è®¤ä¸ºæ‚¨æ¯æ¬¡åœ¨é¡¶ç‚¹ä¸Šå»ºç«‹ä¸€ä¸ªæ­£æ–¹å½¢éƒ½å¾ˆç´¯ï¼Œå› æ­¤æˆ‘ä»¬ç®€åŒ–äº†ä»»åŠ¡-æˆ‘ä»¬ä½¿ç”¨æ ‡å‡†OSGå‡½æ•°ç”Ÿæˆæ­£æ–¹å½¢</font></font><br><br><pre> <code class="cpp hljs">osg::ref_ptr&lt;osg::Drawable&gt; quad = osg::createTexturedQuadGeometry( osg::Vec3(<span class="hljs-number"><span class="hljs-number">-0.5f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">-0.5f</span></span>), osg::Vec3(<span class="hljs-number"><span class="hljs-number">1.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>), osg::Vec3(<span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">1.0f</span></span>));</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä»å…¶æ„å»ºæ­£æ–¹å½¢çš„å·¦ä¸‹è§’çš„ç‚¹ï¼Œå…¶ä»–ä¸¤ä¸ªå‚æ•°æŒ‡å®šå¯¹è§’çº¿çš„åæ ‡ã€‚</font><font style="vertical-align: inherit;">å¼„æ¸…æ¥šæ­£æ–¹å½¢åï¼Œæˆ‘ä»¬ä¸ºå…¶åˆ›å»ºææ–™</font></font><br><br><pre> <code class="cpp hljs">osg::ref_ptr&lt;osg::Material&gt; material = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> osg::Material; material-&gt;setAmbient(osg::Material::FRONT_AND_BACK, osg::Vec4(<span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">1.0f</span></span>)); material-&gt;setDiffuse(osg::Material::FRONT_AND_BACK, osg::Vec4(<span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">1.0f</span></span>, <span class="hljs-number"><span class="hljs-number">1.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.5f</span></span>));</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬æŒ‡å‡ºææ–™çš„é¢œè‰²é€‰é¡¹ã€‚</font><font style="vertical-align: inherit;">ç¯å¢ƒé¢œè‰²æ˜¯è¡¨å¾é˜´å½±åŒºåŸŸä¸­ææ–™é¢œè‰²çš„å‚æ•°ï¼Œé¢œè‰²æºæ— æ³•è®¿é—®ã€‚</font><font style="vertical-align: inherit;">æ¼«åå°„é¢œè‰²æ˜¯ææ–™æœ¬èº«çš„é¢œè‰²ï¼Œå®ƒè¡¨å¾äº†è¡¨é¢æ‰©æ•£æ‰å…¶ä¸Šçš„é¢œè‰²çš„èƒ½åŠ›ï¼Œå³æˆ‘ä»¬åœ¨æ—¥å¸¸ç”Ÿæ´»ä¸­é€šå¸¸æ‰€è¯´çš„é¢œè‰²ã€‚</font><font style="vertical-align: inherit;">FRONT_AND_BACKå‚æ•°æŒ‡ç¤ºæ­¤é¢œè‰²å±æ€§åŒæ—¶åˆ†é…ç»™å‡ ä½•é¢çš„æ­£é¢å’ŒèƒŒé¢ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å°†ç‰©æ–™åˆ†é…ç»™å…ˆå‰åˆ›å»ºçš„å¤„ç†ç¨‹åºã€‚</font></font><br><br><pre> <code class="cpp hljs">material-&gt;setUpdateCallback(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AlphaFadingCallback);</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å°†åˆ›å»ºçš„ææ–™åˆ†é…ç»™æ­£æ–¹å½¢ </font></font><br><br><pre> <code class="cpp hljs">geode-&gt;getOrCreateStateSet()-&gt;setAttributeAndModes(material.get());</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å¹¶è®¾ç½®å…¶ä»–å±æ€§-æ··åˆé¢œè‰²çš„åŠŸèƒ½å¹¶æŒ‡ç¤ºè¯¥å¯¹è±¡å…·æœ‰é€æ˜è¾¹ç¼˜ </font></font><br><br><pre> <code class="cpp hljs">geode-&gt;getOrCreateStateSet()-&gt;setAttributeAndModes(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> osg::BlendFunc(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA)); geode-&gt;getOrCreateStateSet()-&gt;setRenderingHint(osg::StateSet::TRANSPARENT_BIN);</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æˆ‘ä»¬å®Œæˆåœºæ™¯çš„å½¢æˆå¹¶è¿è¡ŒæŸ¥çœ‹å™¨ </font></font><br><br><pre> <code class="cpp hljs">osg::ref_ptr&lt;osg::Group&gt; root = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> osg::Group; root-&gt;addChild(geode.get()); root-&gt;addChild(osgDB::readNodeFile(<span class="hljs-string"><span class="hljs-string">"../data/glider.osg"</span></span>)); osgViewer::Viewer viewer; viewer.setSceneData(root.get()); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> viewer.run();</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æˆ‘ä»¬ä»¥æ­£æ–¹å½¢çš„å½¢å¼å¹³æ»‘åœ°å‡ºç°åœ¨åœºæ™¯ä¸­ </font></font><br><br><img src="https://habrastorage.org/webt/s5/jv/1h/s5jv1h_ebaecadz6owo60nnrdvg.gif"><br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> è€Œä¸æ˜¯ç»“è®ºï¼šå…³äºä¾èµ–é¡¹çš„ä¸€å¥è¯ </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å½“ç„¶ï¼Œæ‚¨çš„ç¤ºä¾‹æ— æ³•ç¼–è¯‘ï¼Œåœ¨æ„å»ºé˜¶æ®µå‡ºç°é”™è¯¯ã€‚</font><font style="vertical-align: inherit;">è¿™ä¸æ˜¯å·§åˆ-æ³¨æ„å¤´æ–‡ä»¶main.hä¸­çš„è¡Œ</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;osgAnimation/EaseMotion&gt;</span></span></span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é€šå¸¸ä»ä¸­è·å–å¤´æ–‡ä»¶çš„OSGå¤´ç›®å½•æŒ‡å‘åŒ…å«è¯¥å¤´ä¸­æè¿°çš„åŠŸèƒ½å’Œç±»çš„å®ç°çš„åº“ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼ŒosgAnimation /ç›®å½•çš„å¤–è§‚åº”å»ºè®®å°†åŒåçš„åº“æ·»åŠ åˆ°é¡¹ç›®æ„å»ºè„šæœ¬çš„é“¾æ¥åˆ—è¡¨ä¸­ï¼Œç±»ä¼¼è¿™æ ·ï¼ˆè€ƒè™‘åˆ°åº“çš„è·¯å¾„å’Œæ„å»ºç‰ˆæœ¬ï¼‰</font></font><br><br><pre> <code class="cmake hljs">LIBS += -losgAnimation</code> </pre><br>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å¾…ç»­...</a></i> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN437724/">https://habr.com/ru/post/zh-CN437724/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN437712/index.html">å¤ªç©ºç«™Roskomnadzor</a></li>
<li><a href="../zh-CN437714/index.html">æˆ‘ä»¬ç»˜åˆ¶äº†180è¡Œè£¸C ++çš„å¡é€šçˆ†ç‚¸å›¾</a></li>
<li><a href="../zh-CN437716/index.html">åˆ›å»ºFlutteré¡¹ç›®çš„ä¸‰ç§ç›¸å¯¹è¯šå®çš„æ–¹æ³•</a></li>
<li><a href="../zh-CN437720/index.html">Erlang / Elixirçš„è´¨é‡è§£å†³æ–¹æ¡ˆä¹‹äº‰</a></li>
<li><a href="../zh-CN437722/index.html">ç¾å›½åœæˆ˜çš„å®‡å®™åæœ</a></li>
<li><a href="../zh-CN437726/index.html">ç”¨Kotlinxåºåˆ—åŒ–Kotlin.Serialization</a></li>
<li><a href="../zh-CN437730/index.html">æˆ‘ä»¬å¦‚ä½•åœ¨ä¸æ·»åŠ å­—èŠ‚çš„æƒ…å†µä¸‹è§£å†³PostgreSQLä¸­çš„å†…å­˜é—®é¢˜</a></li>
<li><a href="../zh-CN437732/index.html">MakeX M-One Pro 70 DLPæ‰“å°æœºæ¦‚è¿°</a></li>
<li><a href="../zh-CN437734/index.html">åœ¨MikroTikè·¯ç”±å™¨ä¸Šä»Rostelecomè®¾ç½®IPTV</a></li>
<li><a href="../zh-CN437736/index.html">æˆ‘ä»¬å¦‚ä½•é€šè¿‡Moonå’ŒOpenShiftè‡ªåŠ¨æ‰§è¡Œç¡’æµ‹è¯•çš„å¯åŠ¨</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>