<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üö£üèº üë©üèø‚Äç‚öïÔ∏è üë®‚Äçüë¶‚Äçüë¶ Erstellen eines Prototyp-Bots f√ºr Schlachten in Clash Royale ‚úùÔ∏è üïé üë®üèæ‚Äçüåæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ist es Ihnen passiert, dass Sie sich auf ein einfaches Spiel eingelassen haben und dachten, k√ºnstliche Intelligenz k√∂nnte damit durchaus fertig werden...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Erstellen eines Prototyp-Bots f√ºr Schlachten in Clash Royale</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/binarydistrict/blog/439352/">  Ist es Ihnen passiert, dass Sie sich auf ein einfaches Spiel eingelassen haben und dachten, k√ºnstliche Intelligenz k√∂nnte damit durchaus fertig werden?  Fr√ºher habe ich mich entschlossen, einen solchen Bot-Player zu entwickeln.  Dar√ºber hinaus gibt es jetzt viele Tools f√ºr Computer Vision und maschinelles Lernen, mit denen Sie Modelle erstellen k√∂nnen, ohne die Details der Implementierung genau zu kennen.  Gew√∂hnliche Sterbliche k√∂nnen einen Prototyp herstellen, ohne monatelang von Grund auf neuronale Netze aufzubauen. <br><br><img src="https://habrastorage.org/webt/fs/7g/yb/fs7gyb9v-o6bessxnliwetns8u0.png"><br><br>  Unter dem Schnitt finden Sie den Prozess der Erstellung eines Proof-of-Concept-Bots f√ºr das Clash Royale-Spiel, in dem ich Scala-, Python- und CV-Bibliotheken verwendet habe.  Mit Computer Vision und maschinellem Lernen habe ich versucht, einen Bot f√ºr ein Spiel zu erstellen, das wie ein Live-Spieler interagiert. <br><a name="habracut"></a><br>  Mein Name ist Sergey Tolmachev, ich bin leitender Scala-Entwickler auf der Waves-Plattform und unterrichte <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">einen Scala-Kurs</a> im Binary District. In meiner Freizeit studiere ich andere Technologien wie KI.  Und ich wollte die erworbenen F√§higkeiten mit etwas praktischer Erfahrung st√§rken.  Im Gegensatz zu KI-Wettbewerben, bei denen Ihr Bot gegen die Bots anderer Benutzer spielt, kann Clash Royale gegen Menschen spielen, was lustig klingt.  Ihr Bot kann lernen, echte Spieler zu schlagen! <br><br><h2>  Spielmechanik in Clash Royale </h2><br>  Die Spielmechanik ist recht einfach.  Sie und Ihr Gegner haben drei Geb√§ude: eine Festung und zwei T√ºrme.  Spieler vor dem Spiel sammeln Decks - 8 verf√ºgbare Einheiten, die dann im Kampf eingesetzt werden.  Sie haben verschiedene Level und k√∂nnen gepumpt werden, indem sie mehr Karten dieser Einheiten sammeln und Updates kaufen. <br>  Nach dem Start des Spiels k√∂nnen Sie verf√ºgbare Einheiten in sicherer Entfernung von den feindlichen T√ºrmen platzieren und gleichzeitig Manaeinheiten ausgeben, die w√§hrend des Spiels langsam wiederhergestellt werden.  Einheiten werden zu feindlichen Geb√§uden geschickt und von Feinden abgelenkt, die auf dem Weg angetroffen werden.  Der Spieler kann nur die Ausgangsposition der Einheiten kontrollieren - er kann ihre weitere Bewegung und ihren Schaden nur durch Einstellen anderer Einheiten beeinflussen. <br><br>  Es gibt immer noch Zauberspr√ºche, die √ºberall auf dem Spielfeld gespielt werden k√∂nnen. Sie verursachen normalerweise Schaden an Einheiten auf unterschiedliche Weise.  Zauber k√∂nnen Einheiten in einem Gebiet klonen, einfrieren oder beschleunigen. <br><br><img src="https://habrastorage.org/webt/bk/xs/s2/bkxss2pfmjmvheqvnex86yy2wdk.png"><br><br>  Das Ziel des Spiels ist es, feindliche Geb√§ude zu zerst√∂ren.  Um einen vollst√§ndigen Sieg zu erringen, m√ºssen Sie die Festung zerst√∂ren oder nach zwei Minuten des Spiels weitere Geb√§ude zerst√∂ren (die Regeln h√§ngen von den Spielmodi ab, aber im Allgemeinen klingen sie so). <br><br>  W√§hrend des Spiels m√ºssen Sie die Bewegung der Einheiten, die m√∂gliche Anzahl an Mana und die aktuellen feindlichen Karten ber√ºcksichtigen.  Sie m√ºssen auch ber√ºcksichtigen, wie sich die Installation des Ger√§ts auf das Spielfeld auswirkt. <br><br><h2>  Eine L√∂sung entwickeln </h2><br>  Clash Royale ist ein Handyspiel, daher habe ich beschlossen, es auf Android auszuf√ºhren und √ºber ADB damit zu interagieren.  Dies w√ºrde die Arbeit mit dem Simulator oder mit einem realen Ger√§t unterst√ºtzen. <br><br>  Ich entschied, dass der Bot, wie viele andere Spiel-AIs, am Perception-Analysis-Action-Algorithmus arbeiten sollte.  Die gesamte Umgebung des Spiels wird auf dem Bildschirm angezeigt, und die Interaktion mit ihr erfolgt durch Klicken auf den Bildschirm.  Daher sollte der Bot ein Programm sein, dessen Eingabe den aktuellen Status des Spiels beschreibt: den Ort und die Eigenschaften von Einheiten und Geb√§uden, die aktuell m√∂glichen Karten und die Menge an Mana.  Am Ausgang sollte der Bot ein Array von Koordinaten angeben, auf denen die Einheit aufgezeichnet werden soll. <br><br>  Bevor der Bot selbst erstellt wurde, musste das Problem des Extrahierens von Informationen √ºber den aktuellen Status des Spiels aus dem Screenshot gel√∂st werden.  Im Gro√üen und Ganzen ist der weitere Inhalt des Artikels dieser Aufgabe gewidmet. <br><br>  Um dieses Problem zu l√∂sen, habe ich mich f√ºr Computer Vision entschieden.  Vielleicht ist dies nicht die beste L√∂sung: Ein Lebenslauf ohne viel Erfahrung und Ressourcen weist eindeutig Einschr√§nkungen auf und kann nicht alles auf menschlicher Ebene erkennen. <br><br>  Es w√§re genauer, Daten aus dem Speicher zu entnehmen, aber ich hatte keine solche Erfahrung.  Root ist erforderlich und insgesamt sieht diese L√∂sung komplizierter aus.  Es ist auch unklar, ob hier eine Geschwindigkeit in Echtzeit erreicht werden kann, wenn Sie nach Objekten mit einer Heap-JVM im Ger√§t suchen.  Au√üerdem wollte ich das CV-Problem mehr als das l√∂sen. <br>  Theoretisch k√∂nnte man einen Proxyserver erstellen und Informationen von dort abrufen.  Das Netzwerkprotokoll des Spiels √§ndert sich jedoch h√§ufig, Proxys im Internet werden angezeigt, sind jedoch schnell veraltet und werden nicht unterst√ºtzt. <br><br><h2>  Verf√ºgbare Spielressourcen </h2><br>  Zun√§chst habe ich mich entschlossen, die verf√ºgbaren Materialien aus dem Spiel kennenzulernen.  Ich fand einen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Club von Handwerkern</a> , die gepackte Spielressourcen herausholten <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">[1]</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">[2]</a> .  Zun√§chst interessierte ich mich f√ºr Bilder von Einheiten, aber im entpackten Spielpaket werden sie in Form einer Kachelkarte (Teile, aus denen eine Einheit besteht) dargestellt. <br><br>  Ich fand auch geklebte (wenn auch nicht perfekte) Skripte von Einheitenanimationsrahmen - sie waren n√ºtzlich f√ºr das Training des Erkennungsmodells. <br><br><img src="https://habrastorage.org/webt/b_/bp/zm/b_bpzm14pv9snavxmruq0k5q0cm.png"><br><br>  Dar√ºber hinaus finden Sie in den Ressourcen CSV mit verschiedenen Spieldaten - der Menge an HP, dem Schaden an Einheiten verschiedener Level usw. Dies ist n√ºtzlich, wenn Sie eine Bot-Logik erstellen.  Aus den Daten ging beispielsweise hervor, dass das Feld in 18 x 29 Zellen unterteilt war und nur Einheiten darauf platziert werden k√∂nnen.  Es gab auch alle Bilder von Einheitenkarten, die uns sp√§ter n√ºtzlich sein werden. <br><br><h2>  Computer Vision f√ºr die Faulen </h2><br>  Nach der Suche nach verf√ºgbaren CV-L√∂sungen wurde klar, dass diese auf jeden Fall an einem gekennzeichneten Datensatz geschult werden m√ºssen.  Ich machte Screenshots und war bereits bereit, eine bestimmte Anzahl von Screenshots mit meinen H√§nden zu markieren.  Dies stellte sich als Herausforderung heraus. <br><br>  Das Auffinden verf√ºgbarer Erkennungsprogramme dauerte einige Zeit.  Ich habe mich f√ºr <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">labelImg entschieden</a> .  Alle Annotationsanwendungen, die ich fand, waren ziemlich primitiv: Viele unterst√ºtzten keine Tastaturk√ºrzel, die Auswahl von Objekten und deren Typen war viel weniger bequem als in labelImg. <br><br>  W√§hrend des Markups erwies es sich als n√ºtzlich, den Quellcode der Anwendung zu haben.  Ich habe alle paar Sekunden des Spiels Screenshots gemacht.  Die Screenshots enthalten viele Objekte (z. B. eine Armee von Skeletten), und ich habe eine √Ñnderung in labelImg vorgenommen. Standardm√§√üig wurden beim Markieren des n√§chsten Bildes die Beschriftungen des vorherigen Bilds √ºbernommen.  Oft mussten sie einfach an eine neue Position der Einheiten gebracht werden, die toten Einheiten entfernen und einige hinzugef√ºgte hinzuf√ºgen, und nicht von Grund auf neu markieren. <br><br><img src="https://habrastorage.org/webt/cx/dh/rf/cxdhrf-uctqed-l84x2mg_9j4u8.png"><br><br>  Der Prozess erwies sich als ressourcenintensiv - in zwei Tagen im stillen Modus habe ich ungef√§hr 200 Screenshots gepostet.  Die Stichprobe sieht sehr klein aus, aber ich habe beschlossen, mit dem Experimentieren zu beginnen.  Sie k√∂nnen jederzeit weitere Beispiele hinzuf√ºgen und die Qualit√§t des Modells verbessern. <br><br>  Zum Zeitpunkt des Markups wusste ich nicht, welches Trainingstool ich verwenden w√ºrde, und entschied mich daher, die Markup-Ergebnisse im VOC-Format zu speichern - einem der konservativen und scheinbar universellen. <br><br>  Es kann sich die Frage stellen: Warum nicht einfach nach Pixel-f√ºr-Pixel-Bildern von Einheiten suchen?  Das Problem ist, dass man daf√ºr nach einer gro√üen Anzahl unterschiedlicher Animationsrahmen verschiedener Einheiten suchen m√ºsste.  Es w√ºrde kaum funktionieren.  Ich wollte eine universelle L√∂sung entwickeln, die verschiedene Berechtigungen unterst√ºtzt.  Dar√ºber hinaus k√∂nnen Einheiten je nach dem auf sie ausge√ºbten Effekt eine andere Farbe haben - Einfrieren, Beschleunigen. <br><br><h2>  Warum habe ich mich f√ºr YOLO entschieden? </h2><br>  Ich begann m√∂gliche Bilderkennungsl√∂sungen zu untersuchen.  Ich habe mir die Anwendung verschiedener Algorithmen angesehen: OpenCV, TensorFlow, Torch.  Ich wollte so schnell wie m√∂glich erkennen, sogar die Genauigkeit opfern und so schnell wie m√∂glich POC erhalten. <br><br>  Nachdem ich die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel</a> gelesen hatte, stellte ich fest, dass meine Aufgabe nicht zu den Klassifizierern HOG / LBP / SVM / HAAR / ... passt.  Obwohl sie schnell sind, m√ºssten sie - je nach Klassifikator f√ºr jede Einheit - viele Male angewendet werden und dann einzeln, um sie f√ºr die Suche auf das Bild anzuwenden.  Dar√ºber hinaus w√ºrde ihr theoretisches Funktionsprinzip zu schlechten Ergebnissen f√ºhren: Einheiten k√∂nnen eine andere Form haben, beispielsweise wenn sie sich nach links und oben bewegen. <br><br>  Theoretisch kann man mit einem neuronalen Netzwerk es einmal auf ein Bild anwenden und alle Einheiten unterschiedlichen Typs mit ihrer Position ermitteln, sodass ich anfing, nach neuronalen Netzwerken zu suchen.  TensorFlow hat Unterst√ºtzung f√ºr Convolutional Neural Networks (CNN) gefunden.  Es stellte sich heraus, dass es nicht erforderlich ist, neuronale Netze von Grund auf neu zu trainieren - Sie k√∂nnen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">das vorhandene leistungsstarke Netz</a> neu trainieren. <br><br>  Dann fand ich einen praktischeren YOLO-Algorithmus, der weniger Komplexit√§t verspricht und daher einen Hochgeschwindigkeits-Suchalgorithmus bereitstellen musste, ohne die Genauigkeit zu beeintr√§chtigen (und in einigen F√§llen andere Modelle zu √ºbertreffen). <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Die YOLO-Website</a> verspricht einen gro√üen Geschwindigkeitsunterschied mit dem winzigen Modell und einem kleineren, optimierten Netzwerk.  Mit YOLO k√∂nnen Sie auch das fertige neuronale Netzwerk f√ºr Ihre Aufgabe neu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">trainieren. Darknet</a> - ein <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Open-</a> Source-Framework f√ºr die Verwendung verschiedener Neuronen, deren Entwickler YOLO entwickelt haben - ist eine einfache native C-Anwendung, und alle Arbeiten damit erfolgen √ºber ihre Parameteraufrufe. <br><br>  TensorFlow, in Python geschrieben, ist in der Tat eine Python-Bibliothek und wird mit selbst geschriebenen Skripten verwendet, die Sie herausfinden oder verfeinern m√ºssen, um sie Ihren Anforderungen anzupassen.  F√ºr einige ist die Flexibilit√§t von TensorFlow wahrscheinlich ein Plus, aber ohne auf Details einzugehen, ist es kaum m√∂glich, es schnell zu nutzen.  Daher fiel in meinem Projekt die Wahl auf YOLO. <br><br><h2>  Modellbau </h2><br>  Um an der Modellschulung zu arbeiten, habe ich Ubuntu 18.10 installiert, Assembly-Pakete, das OpenCL-Paket von NVIDIA und andere Abh√§ngigkeiten geliefert und Darknet erstellt. <br><br>  Github hat einen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Abschnitt mit einfachen Schritten zur Umschulung des YOLO-Modells</a> : Sie m√ºssen das Modell und die Konfigurationen herunterladen, √§ndern und mit der Umschulung beginnen. <br><br>  Zuerst wollte ich versuchen, ein einfaches YOLO-Modell umzuschulen, dann Tiny und sie zu vergleichen.  Es stellte sich jedoch heraus, dass Sie f√ºr das Training einfacher Modelle 4 GB Grafikkartenspeicher ben√∂tigen und ich nur eine 3 GB NVIDIA GeForce GTX 1060-Grafikkarte f√ºr Spiele gekauft habe.  Daher konnte ich sofort nur das Tiny-Modell trainieren. <br><br>  Das Markup der Einheiten auf den Bildern, die ich hatte, war im VOC-Format, und YOLO arbeitete mit seinem eigenen Format. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Daher habe</a> ich das Dienstprogramm <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">convert2Yolo verwendet</a> , um Anmerkungsdateien zu konvertieren. <br><br>  Nach einer Nacht Training in meinen 200 Screenshots bekam ich die ersten Ergebnisse und sie √ºberraschten mich - das Modell konnte wirklich etwas richtig erkennen!  Ich erkannte, dass ich mich in die richtige Richtung bewegte und beschloss, mehr Unterrichtsbeispiele zu machen. <br><br><img src="https://habrastorage.org/webt/ek/rh/ik/ekrhikfcntuxljeawh09ikegnp0.png"><br><br>  Ich wollte keine Screenshots mehr erstellen und erinnerte mich an Frames aus Einheitenanimationen.  Ich habe alle kleinen Bilder mit ihren Klassen markiert und versucht, das Netzwerk auf diesem Set zu trainieren.  Das Ergebnis war sehr schlecht.  Ich gehe davon aus, dass das Modell aus kleinen Bildern nicht die richtigen Muster f√ºr die Verwendung in gro√üen Bildern ausw√§hlen konnte. <br><br>  Danach entschied ich mich, sie auf vorgefertigten Hintergr√ºnden von Kampfarenen zu platzieren und programmgesteuert eine VOC-Markup-Datei zu erstellen.  Es stellte sich heraus, dass es sich um einen synthetischen Screenshot mit einem automatisch 100% genauen Layout handelt. <br><br>  Ich habe in Scala ein Skript geschrieben, das den Screenshot in 16 4x4-Quadrate unterteilt und die Einheiten so in ihre Mitte setzt, dass sie sich nicht √ºberschneiden.  Das Skript erm√∂glichte es mir auch, die Erstellung von Trainingsbeispielen anzupassen - wenn Schaden genommen wird, werden Einheiten in der Farbe ihres Teams (rot / blau) gemalt, und w√§hrend der Klassifizierung erkenne ich Einheiten verschiedener Farben separat.  Zus√§tzlich zur F√§rbung weisen Einheiten verschiedener Teams, die Schaden erlitten haben, geringf√ºgige Unterschiede in der Kleidung auf.  Au√üerdem habe ich die Einheiten zuf√§llig etwas vergr√∂√üert und verkleinert, so dass das Modell gelernt hat, nicht viel von der Gr√∂√üe der Einheit abzuh√§ngen.  Als Ergebnis habe ich gelernt, wie man Zehntausende von Trainingsbeispielen erstellt, die in etwa echten Screenshots √§hneln. <br><br><img src="https://habrastorage.org/webt/uv/zi/_u/uvzi_uwhmohzcx0a7ylmpbyjady.png"><br><br>  Die Generation war nicht perfekt.  Oft wurden Einheiten auf Geb√§uden platziert, obwohl sie sich im Spiel hinter ihnen befanden.  Es gab keine Beispiele f√ºr √ºberlappende Teile der Einheit, obwohl dies keine seltene Situation im Spiel ist.  Aber bisher habe ich beschlossen, es zu vernachl√§ssigen. <br><br><img src="https://habrastorage.org/webt/zo/wk/uq/zowkuqkijfqocemk7_qflhhgavg.png"><br><br>  Das Modell, das nach mehreren Trainingsn√§chten mit einer Mischung aus 200 realen Screenshots und 5000 generierten Bildern erhalten wurde, die w√§hrend des Trainingsprozesses einmal t√§glich neu erstellt wurden, ergab beim Testen mit diesen Screenshots schlechte Ergebnisse.  Es ist nicht √ºberraschend, denn die erzeugten Bilder unterscheiden sich stark von den realen. <br><br>  Daher habe ich das resultierende Modell f√ºr eine Umschulung einer mittleren Stichprobe verwendet, in der nur 200 meiner Screenshots vorhanden waren.  Danach begann sie viel besser zu arbeiten. <br><br><div class="spoiler">  <b class="spoiler_title">Verdammt schade</b> <div class="spoiler_text">  Ich entschuldige mich daf√ºr, dass ich mit solchen unwissenschaftlichen Ma√ünahmen als "viel besser" umgegangen bin, aber ich wei√ü nicht, wie ich Bilder schnell gegenseitig validieren kann. Deshalb habe ich mehrere Screenshots aus einem nicht trainierten Set ausprobiert und nachgefragt, ob die Ergebnisse mich zufriedenstellen.  Das ist das Wichtigste.  Wir sind faul und machen einen Prototyp, oder? <br><br>  Die folgenden Schritte zur Verbesserung des Modells waren verst√§ndlich: Markieren Sie mit diesen H√§nden weitere dieser Screenshots und trainieren Sie sie am Modell, trainiert an den generierten Screenshots. <br></div></div><br><h2>  Kommen wir zum Bot </h2><br>  Ich habe beschlossen, einen Bot in Python zu schreiben - er hat viele Tools f√ºr ML.  Ich entschied mich, mein Modell mit OpenCV zu verwenden, das ab <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">3.5 den Umgang mit neuronalen Netzwerkmodellen lernte</a> , und fand sogar ein <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">einfaches Beispiel</a> .  Nachdem ich mehrere Bibliotheken f√ºr die Arbeit mit ADB ausprobiert hatte, entschied ich mich f√ºr <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">pure-python-adb</a> - alles, was ich brauche, wird einfach dort implementiert: die Bildschirmaufnahmefunktion und die Operation auf dem Shell-Ger√§t;  Ich tippe mit dem 'Eingabetipp'. <br><br>  Nachdem ich einen Screenshot des Spiels erhalten, Einheiten darauf erkannt und auf dem Bildschirm angezeigt hatte, arbeitete ich weiter daran, den Spielstatus zu erkennen.  Zus√§tzlich zu den Einheiten musste ich die aktuelle Manastufe und die Karten, die dem Spieler zur Verf√ºgung stehen, erkennen. <br><br>  Das Mana-Level im Spiel wird als Fortschrittsbalken und Zahlen angezeigt.  Ohne nachzudenken, fing ich an, die Zahl auszuschneiden, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">umzukehren</a> und mit <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Pytesseract zu erkennen</a> . <br><br>  Um die verf√ºgbaren Karten und ihre Position zu bestimmen, habe ich den <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Schl√ºsselpunktdetektor KAZE von OpenCV verwendet</a> .  Bisher wollte ich nicht wieder zum Erlernen des neuronalen Netzwerks zur√ºckkehren, und ich entschied mich f√ºr eine Methode, die schneller und einfacher war, obwohl sich am Ende herausstellte, dass sie f√ºr den Fall, dass Sie nach vielen Objekten suchen m√ºssen, nur eine minimale Genauigkeit aufweist. <br><br>  Beim Starten des Bots habe ich die Schl√ºsselpunkte f√ºr alle Kartenbilder gez√§hlt (es gibt insgesamt mehrere Dutzend) und w√§hrend des Spiels nach √úbereinstimmungen aller Karten mit dem Kartenbereich des Spielers gesucht, um die Anzahl der Fehler zu verringern und die Geschwindigkeit zu erh√∂hen.  Sie wurden nach Genauigkeit und nach der <i>x-</i> Koordinate sortiert, um die Reihenfolge der Karten zu erhalten - Informationen dar√ºber, wie sie sich auf dem Bildschirm befinden. <br><br>  Nachdem ich ein wenig mit den Parametern gespielt hatte, bekam ich in der Praxis viele Fehler, obwohl einige komplexe Bilder von Karten, die manchmal vom Algorithmus mit anderen verwechselt wurden, mit gro√üer Genauigkeit erkannt wurden.  Ich musste einen Puffer aus drei Elementen hinzuf√ºgen: Wenn drei Erkennungen hintereinander dieselben Werte erhalten, glauben wir unter bestimmten Bedingungen, dass wir ihnen vertrauen k√∂nnen. <br><br><img src="https://habrastorage.org/webt/vr/8a/mj/vr8amjw6_mpuh8kzethfk0zbkya.png"><br><br>  Nachdem Sie alle erforderlichen Informationen erhalten haben (Einheiten und ihre ungef√§hre Position, verf√ºgbares Mana und Karten), k√∂nnen Sie einige Entscheidungen treffen. <br><br>  Zun√§chst habe ich mich f√ºr etwas Einfaches entschieden: Wenn beispielsweise auf einer zug√§nglichen Karte gen√ºgend Mana vorhanden ist, spielen Sie es auf dem Spielfeld aus.  Aber der Bot wei√ü immer noch nicht, wie man Karten ‚Äûspielt‚Äú - er wei√ü, welche Karten wir haben, wo sich das Feld befindet. Sie m√ºssen auf die gew√ºnschte Karte und dann auf die gew√ºnschte Zelle im Feld klicken. <br><br>  Wenn Sie die Aufl√∂sung des Screenshots kennen, k√∂nnen Sie die Koordinaten der Karte und der gew√ºnschten Feldzelle verstehen.  Jetzt habe ich mich an die genaue Bildschirmaufl√∂sung gebunden, aber wenn n√∂tig, kann ich dies ignorieren.  Die Entscheidungsfunktion gibt eine Reihe von Abgriffen zur√ºck, die in naher Zukunft ausgef√ºhrt werden m√ºssen.  Im Allgemeinen wird unser Bot eine Endlosschleife sein (vereinfacht): <br><br><pre><code class="plaintext hljs">:     =        :         ( )               :         =  ()         =  ()         =  ()         += (, , , )</code> </pre> <br><br>  Bisher kann der Bot Einheiten nur an einem Punkt platzieren, verf√ºgt jedoch bereits √ºber gen√ºgend Informationen, um eine komplexere Strategie zu entwickeln. <br><br><h3>  Erste Probleme </h3><br>  In Wirklichkeit stie√ü ich auf ein unerwartetes und sehr unangenehmes Problem.  Das Erstellen eines Screenshots √ºber ADB dauert ungef√§hr 100 ms, was zu einer erheblichen Verz√∂gerung f√ºhrt. Ich habe mit einer solchen maximalen Verz√∂gerung gerechnet, wobei alle Berechnungen und die Auswahl der Aktion ber√ºcksichtigt wurden, jedoch nicht in einem Schritt zum Erstellen eines Screenshots.  Eine einfache und schnelle L√∂sung konnte nicht gefunden werden.  Theoretisch k√∂nnen Sie mit dem Android-Emulator Screenshots direkt aus dem Anwendungsfenster machen oder ein Dienstprogramm zum Streamen von Bildern von einem Telefon mit Komprimierung √ºber UDP erstellen und den Bot damit verbinden, aber ich habe hier auch keine schnellen L√∂sungen gefunden. <br><br><h2>  Also </h2><br>  Nachdem ich den Stand meines Projekts n√ºchtern eingesch√§tzt hatte, beschloss ich, mich vorerst mit diesem Modell zu befassen.  Ich habe mehrere Wochen meiner Freizeit damit verbracht, und die Erkennung von Einheiten ist nur ein Teil des Gameplays. <br><br>  Ich beschloss, die Teile des Bots schrittweise zu entwickeln - um die grundlegende Logik der Wahrnehmung, dann die einfache Logik des Spiels und die Interaktion mit dem Spiel zu erstellen, und dann wird es m√∂glich sein, die einzelnen abklingenden Teile des Bots zu verbessern.  Wenn die Stufe des Einheitenerkennungsmodells ausreichend wird, kann das Hinzuf√ºgen von Informationen √ºber HP und die Stufe der Einheiten die Entwicklung des Spielbot zu einer v√∂llig neuen Stufe f√ºhren.  Vielleicht ist dies das n√§chste Ziel, aber im Moment lohnt es sich definitiv nicht, sich auf diese Aufgabe zu konzentrieren. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Github-Projekt-Repository</a> <br><br>  Ich habe viel Zeit mit dem Projekt verbracht und ehrlich gesagt bin ich es leid, aber ich bereue es nicht ein bisschen - ich habe neue Erfahrungen in ML / CV gesammelt. <br><br>  Vielleicht werde ich sp√§ter zu ihm zur√ºckkehren - ich werde froh sein, wenn sich mir jemand anschlie√üt.  Wenn Sie interessiert sind, schlie√üen Sie sich der Gruppe f√ºr <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Telegramm</a> an und besuchen Sie auch meinen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Scala-Kurs</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de439352/">https://habr.com/ru/post/de439352/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de439342/index.html">DIYorDIE Winter Meetup 17. Februar</a></li>
<li><a href="../de439344/index.html">Wie ein Troll: Wie Monopolisten Patente regieren</a></li>
<li><a href="../de439346/index.html">Laravel + Docker: unsere erfolgreiche Erfahrung</a></li>
<li><a href="../de439348/index.html">Sehverlust nach Laserkorrektur - was tun? Oder, Doktor, machen Sie mir eine Verbesserung</a></li>
<li><a href="../de439350/index.html">K√ºnstliche Intelligenz als Erfindungsmaschine</a></li>
<li><a href="../de439354/index.html">Rust News # 5 (Januar 2019)</a></li>
<li><a href="../de439356/index.html">Nicht triviale Metriken f√ºr die Wirksamkeit von Werbekampagnen</a></li>
<li><a href="../de439358/index.html">Excel-Dateimetadaten</a></li>
<li><a href="../de439360/index.html">Schulung Cisco 200-125 CCNA v3.0. Cisco Certified Network Specialist (CCNA). Tag 3. Subnetze</a></li>
<li><a href="../de439362/index.html">Wie unterrichten wir Software Engineering an der St. Petersburg HSE?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>