<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🚞 🌘 ⌛️ Apa yang EXPLAIN tutupi dan bagaimana membicarakannya 🚴 🎿 🧓</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pertanyaan klasik yang diajukan pengembang ke DBA atau pemilik bisnisnya, konsultan PostgreSQL, hampir selalu terdengar sama: "Mengapa kueri berjalan ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Apa yang EXPLAIN tutupi dan bagaimana membicarakannya</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/tensor/blog/477624/">  Pertanyaan klasik yang diajukan pengembang ke DBA atau pemilik bisnisnya, konsultan PostgreSQL, hampir selalu terdengar sama: <i>"Mengapa kueri berjalan pada basis data begitu lama?"</i> <br><br>  Rangkaian alasan tradisional: <br><br><ul><li>  <b>algoritma yang tidak efisien</b> <br>  ketika Anda memutuskan untuk BERGABUNG dari beberapa CTE untuk beberapa puluh ribu catatan </li><li>  <b>statistik yang tidak relevan</b> <br>  jika sebenarnya distribusi data dalam tabel sudah sangat berbeda dari yang terakhir ANALYZE kumpulkan </li><li>  <b>"Gag" oleh sumber daya</b> <br>  dan sudah tidak ada cukup daya komputasi khusus dari CPU, gigabyte memori terus dipompa atau disk tidak mengikuti semua database "Wishlist" </li><li>  <b>menghalangi</b> proses bersaing </li></ul><br>  Dan jika kunci cukup sulit untuk ditangkap dan dianalisis, maka untuk semua yang lain, kita memerlukan <b>rencana kueri</b> yang dapat diperoleh dengan menggunakan <a href="https://postgrespro.ru/docs/postgresql/12/using-explain">operator EXPLAIN</a> ( <i>lebih baik, tentu saja, segera MENJELASKAN (ANALYZE, BUFFERS) ...</i> ) atau <a href="https://postgrespro.ru/docs/postgresql/12/auto-explain">modul auto_explain</a> . <br><br>  Tapi, seperti yang dikatakan dalam dokumentasi yang sama, <blockquote>  "Memahami rencana itu seni, dan untuk menguasainya, kau perlu pengalaman, ..." </blockquote>  Tapi Anda bisa melakukannya tanpanya, jika Anda menggunakan alat yang tepat! <br><a name="habracut"></a><br>  Seperti apa tampilan rencana kueri?  Sesuatu seperti ini: <br><br><pre><code class="plaintext hljs">Index Scan using pg_class_relname_nsp_index on pg_class (actual time=0.049..0.050 rows=1 loops=1) Index Cond: (relname = $1) Filter: (oid = $0) Buffers: shared hit=4 InitPlan 1 (returns $0,$1) -&gt; Limit (actual time=0.019..0.020 rows=1 loops=1) Buffers: shared hit=1 -&gt; Seq Scan on pg_class pg_class_1 (actual time=0.015..0.015 rows=1 loops=1) Filter: (relkind = 'r'::"char") Rows Removed by Filter: 5 Buffers: shared hit=1</code> </pre> <br>  atau seperti ini: <br><br><pre> <code class="plaintext hljs">"Append (cost=868.60..878.95 rows=2 width=233) (actual time=0.024..0.144 rows=2 loops=1)" " Buffers: shared hit=3" " CTE cl" " -&gt; Seq Scan on pg_class (cost=0.00..868.60 rows=9972 width=537) (actual time=0.016..0.042 rows=101 loops=1)" " Buffers: shared hit=3" " -&gt; Limit (cost=0.00..0.10 rows=1 width=233) (actual time=0.023..0.024 rows=1 loops=1)" " Buffers: shared hit=1" " -&gt; CTE Scan on cl (cost=0.00..997.20 rows=9972 width=233) (actual time=0.021..0.021 rows=1 loops=1)" " Buffers: shared hit=1" " -&gt; Limit (cost=10.00..10.10 rows=1 width=233) (actual time=0.117..0.118 rows=1 loops=1)" " Buffers: shared hit=2" " -&gt; CTE Scan on cl cl_1 (cost=0.00..997.20 rows=9972 width=233) (actual time=0.001..0.104 rows=101 loops=1)" " Buffers: shared hit=2" "Planning Time: 0.634 ms" "Execution Time: 0.248 ms"</code> </pre> <br>  Tetapi untuk membaca rencana dengan teks "dari lembaran" sangat sulit dan dicintai: <br><br><ul><li>  node menampilkan <b>jumlah sumber daya subtree</b> <br>  yaitu, untuk memahami berapa banyak waktu yang diperlukan untuk mengeksekusi node tertentu, atau tepatnya berapa banyak pembacaan dari tabel ini mengangkat data dari disk - Anda perlu entah bagaimana mengurangi satu dari yang lain </li><li>  waktu simpul harus <b>dikalikan dengan loop</b> <br>  ya, pengurangan bukan operasi yang paling sulit yang perlu dilakukan "dalam pikiran" - setelah semua, runtime ditunjukkan rata-rata lebih dari satu eksekusi node, dan mungkin ada ratusan dari mereka </li><li>  baik, dan semua ini bersama-sama membuat sulit untuk menjawab pertanyaan utama - jadi siapa <b>"rantai terlemah"</b> ? </li></ul><br>  Ketika kami mencoba menjelaskan semua ini kepada beberapa ratus pengembang kami, kami menyadari bahwa dari luar terlihat seperti ini: <br><br><img src="https://habrastorage.org/webt/s1/za/d-/s1zad-d3claa2klkewtgrj8zdaa.png" alt="gambar"><br><br>  Dan itu berarti kita membutuhkan ... <br><br><h2>  Instrumen </h2><br>  Di dalamnya, kami mencoba mengumpulkan semua mekanik utama yang membantu sesuai dengan rencana dan meminta untuk memahami "siapa yang harus disalahkan dan apa yang harus dilakukan."  Nah, bagikan beberapa pengalaman Anda dengan komunitas. <br>  Temui dan gunakan - <a href="https://explain.tensor.ru/">jelaskan.tensor.ru</a> <br><br><h3>  Rencana yang jelas </h3><br>  Apakah mudah untuk memahami rencana ketika terlihat seperti ini? <br><br><pre> <code class="plaintext hljs">Seq Scan on pg_class (actual time=0.009..1.304 rows=6609 loops=1) Buffers: shared hit=263 Planning Time: 0.108 ms Execution Time: 1.800 ms</code> </pre><br>  Tidak juga. <br><br>  Tapi seperti ini, <b>dalam bentuk singkat</b> , ketika indikator utama dipisahkan - sudah jauh lebih jelas: <br><br><img src="https://habrastorage.org/webt/vp/cw/rt/vpcwrt11zdafq4_qax-dtyxpdjg.png" alt="gambar"><br><br>  Tetapi jika rencana itu lebih rumit, <b>distribusi waktu piechart</b> oleh node akan datang untuk <b>menyelamatkan</b> : <br><br><img src="https://habrastorage.org/webt/3k/3t/mk/3k3tmk07dqwsbvfc_mvxgi6ogvc.png" alt="gambar"><br><br>  Nah, untuk opsi yang paling sulit, <b>diagram eksekusi</b> bergegas untuk membantu: <br><br><img src="https://habrastorage.org/webt/mn/w0/7g/mnw07g4oz0e74lq1vrthjfmldf0.png" alt="gambar"><br><br>  Misalnya, ada beberapa situasi yang tidak sepele ketika sebuah rencana dapat memiliki lebih dari satu root aktual: <br><br><img src="https://habrastorage.org/webt/ru/yd/d6/ruydd6-sukl8pvkvi5fijfl3u2q.png" alt="gambar"><img src="https://habrastorage.org/webt/qz/j8/le/qzj8les-k2ywrb_jdtwcjjt8td8.png" alt="gambar"><br><br><h3>  Tip Struktural </h3><br>  Nah, dan jika seluruh struktur rencana dan titik-titik sakitnya sudah ditata dan terlihat - mengapa tidak menyoroti mereka dengan pengembang dan menjelaskannya dengan "bahasa Rusia"? <br><br><img src="https://habrastorage.org/webt/dn/fd/na/dnfdnavl532tf8uyk6l0n-4y0h8.png" alt="gambar">  Kami telah mengumpulkan beberapa lusin template rekomendasi tersebut. <br><br><h3>  Profiler permintaan </h3><br>  Sekarang, jika Anda menempatkan kueri asli pada paket yang dianalisis, Anda dapat melihat berapa banyak waktu yang dibutuhkan untuk masing-masing operator - seperti ini: <br><br><img src="https://habrastorage.org/webt/64/fa/jg/64fajg351r8maetj5lo3ukromey.png" alt="gambar"><br><br>  ... atau bahkan lebih: <br><br><img src="https://habrastorage.org/webt/yb/b7/5l/ybb75lzou2azjdnh1xe53tvpsg4.png" alt="gambar"><br><br><h3>  Substitusi parameter dalam permintaan </h3><br>  Jika Anda "melampirkan" tidak hanya permintaan pada paket, tetapi juga parameternya dari baris DETAIL log, Anda dapat menyalinnya di salah satu opsi: <br><br><ul><li>  dengan substitusi nilai dalam permintaan <br>  untuk eksekusi langsung pada basisnya dan pembuatan profil lebih lanjut <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-string"><span class="hljs-string">'const'</span></span>, <span class="hljs-string"><span class="hljs-string">'param'</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">text</span></span>;</code> </pre> </li><li>  dengan substitusi nilai melalui PREPARE / EXECUTE <br>  untuk mengemulasi pekerjaan scheduler ketika bagian parametrik dapat diabaikan - misalnya, ketika bekerja pada tabel dipartisi <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">DEALLOCATE</span></span> ALL; <span class="hljs-keyword"><span class="hljs-keyword">PREPARE</span></span> q(<span class="hljs-built_in"><span class="hljs-built_in">text</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-string"><span class="hljs-string">'const'</span></span>, $<span class="hljs-number"><span class="hljs-number">1</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">text</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">EXECUTE</span></span> q(<span class="hljs-string"><span class="hljs-string">'param'</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">text</span></span>);</code> </pre></li></ul><br><h3>  Arsip Rencana </h3><br>  Masukkan, analisis, bagikan dengan kolega!  Paket tersebut akan tetap ada di arsip, dan Anda dapat kembali lagi nanti: <a href="https://explain.tensor.ru/archive/">menjelaskan.tensor.ru/archive</a> <br><br>  Tetapi jika Anda tidak ingin orang lain melihat rencana Anda, jangan lupa untuk mencentang kotak "jangan terbitkan dalam arsip". <br><br>  Dalam artikel-artikel berikut saya akan berbicara tentang kesulitan dan solusi yang muncul dalam analisis rencana. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id477624/">https://habr.com/ru/post/id477624/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id477610/index.html">Penulis, Bajak Laut dan Piastres</a></li>
<li><a href="../id477612/index.html">Saran Insinyur: Cara Membangun Produk Yang Dibutuhkan Pengguna Dan Menjadi Cepat</a></li>
<li><a href="../id477616/index.html">Bagaimana cara masuk ke Apple Arcade? Wawancara dengan pendiri studio Tim Tortuga</a></li>
<li><a href="../id477618/index.html">Lokalisasi Aplikasi Bereaksi</a></li>
<li><a href="../id477622/index.html">Konsep Mengurangi Celah Hanya Dalam 10 Menit</a></li>
<li><a href="../id477628/index.html">Komputasi tanpa server berdasarkan OpenWhisk, bagian 2</a></li>
<li><a href="../id477630/index.html">Jaringan saraf yang akan membantu Anda memilih film - "selera Anda spesifik"</a></li>
<li><a href="../id477634/index.html">Layanan microser dan struktur organisasi. Apa jenis tim yang akan memastikan kesuksesan?</a></li>
<li><a href="../id477638/index.html">Dibeli! = Milik Anda: John Deere merampas hak petani untuk memperbaiki traktor mereka sendiri</a></li>
<li><a href="../id477642/index.html">Visi mesin (radio) melihat melalui dinding</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>