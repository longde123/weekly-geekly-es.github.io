<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏻‍💻 🐗 🥚 MetricKit. Analisis kinerja aplikasi iOS 🎨 🔙 🧒</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Mainan baru 
 Kami terus membiasakan diri dengan materi baru dari Apple yang disajikan di WWDC. Kali ini, pertimbangkan MetricKit , kerangka kerja yan...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>MetricKit. Analisis kinerja aplikasi iOS</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/468347/"><img src="https://habrastorage.org/getpro/habr/post_images/362/bcb/a7d/362bcba7db30e427252ec3bf33b87042.jpg" alt="gambar"><br><br><h3>  Mainan baru </h3><br>  Kami terus membiasakan diri dengan materi baru dari Apple yang disajikan di WWDC.  Kali ini, pertimbangkan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">MetricKit</a> , kerangka kerja yang sama sekali baru yang berfungsi sebagai alat untuk memantau kinerja aplikasi. <br><a name="habracut"></a><br>  Semua orang tahu bahwa mengukur kinerja aplikasi selama pengembangan itu mudah.  Xcode menunjukkan jumlah RAM yang digunakan dan beban prosesor, Anda dapat terhubung menggunakan Instrumen ke simulator atau perangkat yang sedang diuji dan bahkan menulis alat Anda sendiri (untuk rincian lebih lanjut, lihat artikel kami tentang paket alat kustom: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">bagian 1</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">bagian 2</a> ).  Memahami pentingnya penyetelan kinerja tidak memungkinkan Anda mengukur hampir semua yang dilakukan aplikasi.  Tetapi segala sesuatunya menjadi lebih rumit ketika kita berbicara tentang AppStore, jika aplikasi yang dikembangkan ditujukan untuk pengguna nyata.  Tidak peduli seberapa hati-hati Anda menguji aplikasi Anda, dalam kondisi nyata akan selalu ada banyak kejutan yang akan mempengaruhi kinerja dan pengalaman pengguna.  Tentu saja, ada banyak alat untuk mengumpulkan berbagai parameter, tetapi sebagian besar dibatasi oleh <b>iOS SDK</b> , serta dampak pemantauan aktual terhadap perilaku aplikasi. <br><br>  Tahun ini, Apple memutuskan untuk mengisi celah ini dan memberi pengembang alat yang membantu mereka mengumpulkan dan menganalisis metrik kinerja aplikasi di lingkungan dunia nyata.  Mereka mengumumkan <b>MetricKit</b> (kerangka kerja yang menyediakan akses ke opsi yang disediakan OS) dari tab terpisah di penyelenggara Xcode 11, tempat Anda dapat menemukan pengaturan aplikasi.  Kami akan berhenti sebentar di MetricKit, karena tampilan parameter dalam Xcode hanya akan berfungsi dengan aplikasi yang sudah diterbitkan di AppStore. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/78a/64c/612/78a64c6124242358e3ceb0ab5b63fe88.png" alt="gambar"><br><br><h3>  MXMetricManager </h3><br>  Arsitektur kerangka ini cukup sederhana dan mudah.  Bagian pusat ditempati oleh kelas <b>MXMetricManager</b> , yang merupakan struktur elemen tunggal yang menyediakan pengembang dengan seperangkat besar kerangka API. <br><br>  Secara umum, alur kerja terdiri dari 3 langkah utama: <br><br><ol><li>  Anda menginisialisasi MXMetricMnager dan menetapkan pengamat untuk itu. </li><li>  Jika mau, Anda dapat menerapkan metrik Anda sendiri di aplikasi menggunakan API Signpost </li><li>  Dan akhirnya, sekarang kita berurusan dengan data yang diterima dalam metode didReceivePayloads, yaitu  kirim ke backend Anda untuk analisis lebih lanjut. </li></ol><br>  Parameter datang sebagai array contoh <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">MXMetricPayload</a> .  Payload merangkum set metadata dan cap waktu.  Muatan metrik adalah pembungkus sederhana untuk subklas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">MXMetric</a> .  Untuk setiap jenis parameter, ini terpisah. <br><br>  Jenis metrik didokumentasikan dengan cukup baik oleh Apple, jadi jangan terlalu lama membahasnya.  Namun, Anda harus berhenti memperhatikan satu hal menarik - MXMetric menyediakan API terbuka untuk membuat serialisasi dalam NSDictionary atau JSON, yang, menurut saya, agak tidak biasa. <br><br><h3>  Komponen internal MetricKit. </h3><br>  Di luar, MetricKit terlihat sangat sederhana.  Tetapi selalu menarik untuk melihat bagaimana semuanya bekerja dari dalam.  Pencelupan ke dalam sesuatu yang lebih dalam selalu merupakan intrik, jika Anda menghadapi tugas tertentu.  Jadi saya memutuskan bahwa saya ingin memberikan parameter dengan tag MetricKit, dan kemudian meminta mereka untuk memberi saya metrik yang diperbarui kapan saja.  Tentu saja, Anda dapat menggunakan ` <i>Debug -&gt; Simulate MetricKit Payloads`</i> dalam Xcode, tetapi id tidak memungkinkan Anda untuk menampilkan data Anda sendiri.  Benar, ini bukan tim yang sangat berguna, tetapi memberi Anda arahan dalam penelitian Anda, dan itu terlihat sangat lucu;) <br><br>  Untuk memulai tugas, kita jelas membutuhkan MetricKit itu sendiri.  Anda mungkin berpikir bahwa mendapatkan file biner untuk framework itu mudah, karena Xcode memperlihatkannya dalam daftar frameworks segera setelah Anda menambahkannya melalui dialog "link file binary to libraries".  Ini adalah pemikiran yang sangat optimis.  Karena jika Anda membuka <b>MetricKit.framework</b> , Anda akan melihat file <b>MetricKit.tbd</b> .  Ukurannya hanya <b>4kb</b> .  Jelas, ini bukan yang kita cari. <br><br>  Jadi apa yang sebenarnya terjadi di sini? <br><br>  <b>TBD</b> adalah singkatan dari “rintisan dylib berbasis teks” dan sebenarnya adalah file YAML dengan deskripsi yang mengekspor karakter dylib dan jalur ke biner dylib.  Menautkan ke file tbd mengurangi ukuran biner.  Kemudian, saat runtime, biner dylib nyata akan diunduh dari OS di jalur yang ditentukan dalam file tbd.  Seperti inilah tampilan file saat Anda membukanya di Xcode: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/047/3d2/e9e/0473d2e9e853e1c65632c2a1b2500b39.png" alt="gambar"><br><br>  Menggunakan path dari file tbd, Anda dapat dengan mudah mendapatkan biner MetricKit untuk penelitian lebih lanjut, tetapi ada metode yang bahkan lebih sederhana. <br><br>  Biner aplikasi kami berisi jalur ke setiap pustaka yang terhubung secara dinamis di bagian header Mach-O.  Informasi ini mudah diambil menggunakan alat menggunakan flag -l. <br><br>  Berikut ini adalah output untuk proyek uji yang saya buat: <br><br><pre><code class="swift hljs">→ otool -l ./<span class="hljs-type"><span class="hljs-type">Metrics</span></span> | grep -i metrickit name /<span class="hljs-type"><span class="hljs-type">System</span></span>/<span class="hljs-type"><span class="hljs-type">Library</span></span>/<span class="hljs-type"><span class="hljs-type">Frameworks</span></span>/<span class="hljs-type"><span class="hljs-type">MetricKit</span></span>.framework/<span class="hljs-type"><span class="hljs-type">MetricKit</span></span> (offset <span class="hljs-number"><span class="hljs-number">24</span></span>)</code> </pre> <br>  Anda dapat melihat jalur yang sama yang kita lihat sebelumnya di file tbd.  Memiliki file kerangka biner, Anda dapat melihat elemen internalnya.  Untuk ini, saya biasanya menggunakan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Hopper Disassemble</a> .  Ini adalah alat yang mudah digunakan, tetapi sangat ampuh untuk mempelajari file biner dengan cermat. <br><br>  Segera setelah file biner MetricKit terbuka, buka Tab 'Proc.'  dan perluas daftar 'Tag'.  Di sini Anda dapat melihat semua karakter yang diekspor.  Memilih salah satu dari mereka (misalnya, MXMetricManager), kita akan melihat semua metodenya dan, setelah memilih metode, kita akan melihat isinya di sisi kanan: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ac1/f17/71a/ac1f1771a4b061364d898d3c28f4564c.png" alt="gambar"><br><br>  Saat melihat daftar metode MXMetricManager [ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">https://gist.github.com/deszip/88a258ae21d33dc75d7cbac9569c6ec1</a> ], sangat mudah untuk melihat metode _checkAndDeliverMetricReports.  Ini sepertinya adalah apa yang perlu dipanggil untuk mendapatkan MetricKit untuk menyampaikan pembaruan kepada pelanggan. <br><br>  Sayangnya, upaya untuk memanggilnya tidak mengarah ke panggilan ke pelanggan, yang mungkin berarti bahwa parameter ini tidak akan dikirimkan.  Mempertimbangkan implementasi metode ini, kami mencatat beberapa hal menarik: ini menyebutkan isi dari direktori / Library / Caches / MetricKit / Reports. <br><br>  Dia kemudian mencoba membuka zip instance MXMetricPayload untuk setiap item pada disk.  Dan akhirnya, iterates lebih dari pelanggan terdaftar dan memanggil metode didReceive dengan daftar data. <br><br>  Masalahnya mungkin adalah bahwa tidak ada data di <i>/ Library / Caches / MetricKit / Reports</i> , tetapi kita tahu bahwa kita membutuhkan beberapa contoh MXMetricPayload yang diarsipkan.  Jadi, mari kita buat dan letakkan di disk sebelum memanggil ' <i>_checkAndDeliverMetricReports</i> '.  Sekali lagi, rencananya adalah membuat instance MXMetricPayload, lalu membuat dan menambahkan segala jenis MXMetric ke dalamnya, dan kemudian mengarsipkan instance data ke disk.  Setelah semua, panggil metode ' <i>_checkAndDeliverMetricReports</i> ', ini akan menyebabkan memanggil pelanggan kami dengan rintisan sebagai argumen. <br><br>  Melihat melalui dokumen Apple tentang muatan dan metrik, Anda mungkin memperhatikan bahwa mereka tidak memiliki inisialisasi publik, dan sebagian besar properti hanya baca-saja.  Jadi, bagaimana mungkin untuk membuat kelas? <br><br>  Kembali ke Hopper lagi untuk melihat daftar metode <b>MXMetricPayload</b> : <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3d6/e2a/12c/3d6e2a12c6d296f9f88f811068b4762d.png" alt="gambar"><br><br>  Di sini Anda dapat melihat inisialisasi dan metode untuk menetapkan parameter.  Memanggil metode pribadi mudah menggunakan kelas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">NSInvocation</a> dan metode 'performSelector' karena sifat dinamis dari Objective-C. <br><br>  Sebagai contoh, kami akan membuat metrik untuk CPU dan menambahkannya ke payload.  Dengan menggunakan tautan ini, Anda dapat menemukan fragmen kode lengkap: [ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">https://gist.github.com/deszip/a0cf877b07cc2877129e0aaef2fed1e4</a> ]. <br><br>  Dan akhirnya, kami mengarsipkan semua yang kami buat dan menulis data ke <i>direktori / Library / Caches / MetricKit / Reports</i> . <br><br>  Sekarang saatnya memanggil metode ' <i>_checkAndDeliverMetricReports</i> ', yang pada akhirnya akan mengarah pada panggilan ke pelanggan.  Kali ini kami meneruskan data dengan muatan paypal sebagai argumen sebagai argumen. <br><br><h3>  Dari mana metrik berasal </h3><br>  Mendapatkan laporan cukup mudah diimplementasikan melalui <b>MetricKit</b> , tetapi Anda mungkin tertarik mempelajari bagaimana laporan muncul di direktori <i>app / Library</i> .  Begini caranya. <br><br>  Menggali di dalam binary MetricKit, saya perhatikan metode ini: '_createXPCConnection'.  Memeriksa implementasinya mengklarifikasi situasi - ia membangun NSXPCConnection untuk layanan dengan nama <i>com.apple.metrickit.xpc</i> dan dua <b>antarmuka MXXPCServer</b> dan <b>MXXPCClient</b> untuk sisi klien dan server.  Jika Anda melihat deskripsi protokol: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0ae/6ac/fe4/0ae6acfe4f83220d86aa7e61b9690cf5.png" alt="gambar"><br><br><h3>  Kesimpulan </h3><br>  <b>MetricKit</b> adalah alat yang unik dan sangat diperlukan untuk menjaga kinerja aplikasi Anda dalam kondisi nyata dalam produksi. <br><br>  Sayangnya, saat ini tidak memungkinkan untuk melihat antarmuka pengguna 'Metrik' di Xcode, kecuali yang ditunjukkan saat demo di sesi WWDC. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8b9/2ec/8af/8b92ec8aff5e8566f00506333e0e4206.png" alt="gambar"><br><br>  Ini bisa menjadi alat yang tak ternilai untuk membawa pengalaman pengguna ke tingkat berikutnya dengan menghilangkan masalah kinerja dalam kode Anda. <br><br>  Salah satu kelemahan yang saya lihat sekarang di alat ini adalah kurangnya detail untuk setiap jenis: hanya pemisahan yang merupakan versi aplikasi, dan Anda tidak dapat melihat metrik apa pun untuk grup perangkat / versi OS / wilayah tertentu, dll. <br><br>  Tetapi, tentu saja, selalu ada peluang untuk mengirim data kepada diri Anda untuk diproses lebih lanjut bersama dengan informasi penting yang Anda butuhkan.  Anda dapat melampirkannya pada tugas di pelacak bug Anda dan banyak lagi.  Di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">AppSpector,</a> tim kami bekerja untuk memperluas fungsionalitas alat pemantauan kinerja menggunakan data yang diperoleh dari <b>MetricKit</b> . <br><br>  Tetap up to date! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id468347/">https://habr.com/ru/post/id468347/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id468337/index.html">Bekerja dengan cron untuk Android dan menambahkan skrip shell ke autorun saat perangkat melakukan booting</a></li>
<li><a href="../id468339/index.html">Memperkenalkan Tema Gelap untuk Pusat Aplikasi Visual Studio</a></li>
<li><a href="../id468341/index.html">Azure Cloud Shell di Terminal Windows</a></li>
<li><a href="../id468343/index.html">Jeff Bezos: "Pergi ke Luar Angkasa untuk Kebaikan Bumi"</a></li>
<li><a href="../id468345/index.html">GitHub meluncurkan tentakelnya dalam CI / CD dan manajemen artefak</a></li>
<li><a href="../id468351/index.html">Mikrostruktur pasar dan seleksi yang merugikan</a></li>
<li><a href="../id468363/index.html">Magnum opus saya dari dunia mobile gaming</a></li>
<li><a href="../id468367/index.html">Amazon mengumumkan rencana pemanasan global</a></li>
<li><a href="../id468369/index.html">Bagaimana saya menciptakan "WildMAN" - parodi dari banyak game 8-bit dan baru-baru ini memindahkannya ke Android</a></li>
<li><a href="../id468371/index.html">Desain game menjadi hidup. Unduhan tanpa cacat atau pencelupan penuh dalam God of War 4</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>