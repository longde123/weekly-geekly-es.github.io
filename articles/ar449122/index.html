<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐จโ๐ง ๐ง๐ฝ ๐๏ธ ูุฃุณู ูุนุฏู ูุฌูุฏ ุณุงููุฉ ูุงููุฉ ุงููุธุงุฆู ุฅุฐุง ูุงู ูู C ++ ุฃู ... ๐ง๐ฟโ๐คโ๐ง๐ผ ๐ก ๐</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="... ููููุฉ ููุก ูุฆุฉ ุงููุงูุจ ุจูุญุชููุงุช ูุฎุชููุฉ ุญุณุจ ููู ูุนููุงุช ุงููุงูุจุ 


 ุฐุงุช ูุฑุฉ ุ ูุจุนุถ ุงูููุช ุ ุจุฏุฃุช ูุบุฉ D ูุชุตุจุญ "C ++ ุงูุตุญูุญุฉ" ุ ูุน ูุฑุงุนุงุฉ ุงูุฎุจุฑุฉ ุงูููุชุณุจุฉ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ูุฃุณู ูุนุฏู ูุฌูุฏ ุณุงููุฉ ูุงููุฉ ุงููุธุงุฆู ุฅุฐุง ูุงู ูู C ++ ุฃู ...</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/449122/" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl"> <strong>... ููููุฉ ููุก ูุฆุฉ ุงููุงูุจ ุจูุญุชููุงุช ูุฎุชููุฉ ุญุณุจ ููู ูุนููุงุช ุงููุงูุจุ</strong> </p><br><p style=";text-align:right;direction:rtl"> ุฐุงุช ูุฑุฉ ุ ูุจุนุถ ุงูููุช ุ ุจุฏุฃุช ูุบุฉ D ูุชุตุจุญ "C ++ ุงูุตุญูุญุฉ" ุ ูุน ูุฑุงุนุงุฉ ุงูุฎุจุฑุฉ ุงูููุชุณุจุฉ ูู C ++.  ุจูุฑูุฑ ุงูููุช ุ ุฃุตุจุญ D ูุบุฉ ุฃูู ุชุนููุฏูุง ูุฃูุซุฑ ุชุนุจูุฑูุง ูู ูุบุฉ C ++.  ูุจุงููุนู ุจุฏุฃุช C ++ ุจุงูุชุฌุณุณ ุนูู D. ุนูู ุณุจูู ุงููุซุงู ุ ุธูุฑุช ูู C ++ 17 <code>if constexpr</code> ุ ูู ุฑุฃูู ุ ุนุจุงุฑุฉ ุนู ุงุณุชุนุงุฑุฉ ูุจุงุดุฑุฉ ูู D ุ ูุงู ุงููููุฐุฌ ุงูุฃููู ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">D-shny ุซุงุจุช ุฅุฐุง</a> . </p><br><p style=";text-align:right;direction:rtl">  ูุณูุก ุงูุญุธ ุ <code>if constexpr</code> ูุฏู <code>if constexpr</code> ูู C ++ ููุณ ุงูููุฉ ูุซู <code>static if</code> ูู D. ููุงู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุฃุณุจุงุจ ูุฐูู</a> ุ ูููู ูุง ุชุฒุงู ููุงู ุญุงูุงุช ูุง ููููู ุฃู ุชูุฏู ูููุง ุฅูุง <code>if constexpr</code> ูู C ++ ูุง ูุณูุญ ูู ุจุงูุชุญูู ูู ูุญุชูู C + + ุงูุทุจูุฉ.  ุฃูุฏ ุงูุชุญุฏุซ ุนู ุฅุญุฏู ูุฐู ุงูุญุงูุงุช. </p><br><p style=";text-align:right;direction:rtl">  ุณูุชุญุฏุซ ุนู ููููุฉ ุฅูุดุงุก ูุฆุฉ ูุงูุจ ุ ูุงูุชู ูุฏ ุชุชุบูุฑ ูุญุชููุงุชูุง (ุฃู ุชูููู ุงูุฃุณุงููุจ ูููุทู ุจุนุถ ุงูุฃุณุงููุจ) ุงุนุชูุงุฏูุง ุนูู ุงููุนููุงุช ุงูุชู ุชู ุชูุฑูุฑูุง ุฅูู ูุฆุฉ ุงููุงูุจ ูุฐู.  ูุซุงู ูุฃุฎูุฐ ูู ูุงูุน ุงูุญูุงุฉ ุ ูู ุชุฌุฑุจุฉ ุชุทููุฑ <a href="">ูุณุฎุฉ ุฌุฏูุฏุฉ ูู SObjectizer</a> . </p><br><h1 id="zadacha-kotoruyu-trebuetsya-reshit" style=";text-align:right;direction:rtl">  ุงููููุฉ ุงูุชู ูุชุนูู ุญููุง </h1><br><p style=";text-align:right;direction:rtl">  ูุฌุจ ุฅูุดุงุก ุฅุตุฏุงุฑ ุฐูู ูู "ุงููุคุดุฑ ุงูุฐูู" ูุชุฎุฒูู ูุงุฆูุงุช ุงูุฑุณุงุฆู.  ุจุญูุซ ููููู ูุชุงุจุฉ ุดูุก ูุซู: </p><a name="habracut"></a><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">message_holder_t</span></span>&lt;my_message&gt; msg{ <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> my_message{...} }; send(target, msg); send(another_target, msg);</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุชููู ุญููุฉ ูุฆุฉ <code>message_holder_t</code> ูุฌูุฏ ุซูุงุซุฉ ุนูุงูู ูููุฉ ูุฌุจ ูุฑุงุนุงุชูุง. </p><br><h2 id="ot-chego-otnasledovan-tip-soobscheniya" style=";text-align:right;direction:rtl">  ูุง ูู ููุน ุงูุฑุณุงูุฉ ุงูููุฑูุซุฉ ููุ </h2><br><p style=";text-align:right;direction:rtl">  ุชููุณู ุฃููุงุน ุงูุฑุณุงุฆู ุงูุชู ุชุญุฏุฏ ูุนููุฉ <code>message_holder_t</code> ุฅูู ูุฌููุนุชูู.  ุงููุฌููุนุฉ ุงูุฃููู ูู ุงูุฑุณุงุฆู ุงูุชู ุชุฑุซ ูู ุงูููุน ุงูุฃุณุงุณู ุงูุฎุงุต <code>message_t</code> .  ุนูู ุณุจูู ุงููุซุงู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">so5_message</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">final</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> so_5::<span class="hljs-keyword"><span class="hljs-keyword">message_t</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> a_; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> b_; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::chrono::milliseconds c_; so5_message(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> a, <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> b, <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::chrono::milliseconds c) : a_{a}, b_{<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(b)}, c_{c} {} };</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูู ูุฐู ุงูุญุงูุฉ ุ ูุฌุจ ุฃู ูุญุชูู message_holder_t ุฏุงุฎู ููุณู ููุท ุนูู ูุคุดุฑ ุฅูู ูุงุฆู ูู ูุฐุง ุงูููุน.  ูุฌุจ ุฃู ูุชู ุฅุฑุฌุงุน ููุณ ุงููุคุดุฑ ูู ุฃุณุงููุจ getter.  ุฃู ุจุงููุณุจุฉ ุฅูู ููู ุงูุนูุฏ ูู <code>message_t</code> ูุฌุจ ุฃู ูููู <code>message_t</code> ุดูุก ูุซู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> M&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">message_holder_t</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">intrusive_ptr_t</span></span>&lt;M&gt; m_msg; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> M * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">noexcept</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> m_msg.get(); } };</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงููุฌููุนุฉ ุงูุซุงููุฉ ูู ุฑุณุงุฆู ุฃููุงุน ุงููุณุชุฎุฏููู ุงูุชุนุณููุฉ ุงูุชู ูู ูุชู ุชูุฑูุซูุง ูู <code>message_t</code> .  ุนูู ุณุจูู ุงููุซุงู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">user_message</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">final</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> a_; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> b_; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::chrono::milliseconds c_; user_message(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> a, <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> b, <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::chrono::milliseconds c) : a_{a}, b_{<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(b)}, c_{c} {} };</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุง ูุชู ุฅุฑุณุงู ูุซููุงุช ูุฐู ุงูุฃููุงุน ูู SObjectizer ูู ุชููุงุก ููุณูุง ุ ูููู ูุชู ุชุถููููุง ูู ุจุฑูุงูุฌ ุชุบููู ุฎุงุต ุ <code>user_type_message_t&lt;M&gt;</code> ุ ูุงูุฐู ุชู ุชูุงุฑุซู ุจุงููุนู ูู <code>message_t</code> .  ูุฐูู ุ ุจุงููุณุจุฉ ููุฐู ุงูุฃููุงุน ุ ูุฌุจ ุฃู ุชุญุชูู <code>message_holder_t</code> ุนูู ูุคุดุฑ ุฅูู <code>user_type_message_t&lt;M&gt;</code> ุจุฏุงุฎููุง ุ ููุฌุจ ุฃู ุชูุฑุฌุน ุฃุณุงููุจ getter ูุคุดุฑูุง ุฅูู M: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> M&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">message_holder_t</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">intrusive_ptr_t</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">user_type_message_t</span></span>&lt;M&gt;&gt; m_msg; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> M * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">noexcept</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::addressof(m_msg-&gt;m_payload); } };</code> </pre> <br><h2 id="immutabelnost-ili-mutabelnost-soobscheniy" style=";text-align:right;direction:rtl">  ุญุตุงูุฉ ุฃู ูุงุจููุฉ ุงูุฑุณุงุฆู </h2><br><p style=";text-align:right;direction:rtl">  ุงูุนุงูู ุงูุซุงูู ูู ุชูุณูู ุงูุฑุณุงุฆู ุฅูู ุซุงุจุช ูุบูุฑ ูุงุจู ููุชุบููุฑ.  ุฅุฐุง ูุงูุช ุงูุฑุณุงูุฉ ุบูุฑ ูุงุจูุฉ ููุชุบููุฑ (ููู ุงูุชุฑุงุถููุง ุบูุฑ ูุงุจูุฉ ููุชุบููุฑ) ุ ููุฌุจ ุนูู ุฃุณุงููุจ getter ุฅุฑุฌุงุน ูุคุดุฑ ุซุงุจุช ุฅูู ุงูุฑุณุงูุฉ.  ูุฅุฐุง ูุงู ูุงุจูุงู ููุชุบููุฑ ุ ููุฌุจ ุฃู ุชูุฑุฌุน getters ูุคุดุฑูุง ุบูุฑ ุซุงุจุช.  ุฃู  ูุฌุจ ุฃู ูููู ุดูุก ูุซู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">message_holder_t</span></span>&lt;so5_message&gt; msg1{...}; <span class="hljs-comment"><span class="hljs-comment">//  . const int a = msg1-&gt;a_; // OK. msg1-&gt;a_ = 0; //     ! message_holder_t&lt;mutable_msg&lt;user_message&gt;&gt; msg2{...}; //  . const int a = msg2-&gt;a_; // OK. msg2-&gt;a_ = 0; // OK.</span></span></code> </pre> <br><h2 id="shared_ptr-vs-unique_ptr" style=";text-align:right;direction:rtl">  Shared_ptr vs unique_ptr </h2><br><p style=";text-align:right;direction:rtl">  ุงูุนุงูู ุงูุซุงูุซ ูู ููุทู ุณููู <code>message_holder_t</code> ููุคุดุฑ ุฐูู.  ุจูุฌุฑุฏ ุฃู ูุชุตุฑู ูุซู <code>std::shared_ptr</code> ุ ุฃู  ููููู ูุทุงูุจุฉ ุฃุตุญุงุจ ุฑุณุงุฆู ูุชุนุฏุฏุฉ ุจุงูุฅุดุงุฑุฉ ุฅูู ูุซูู ุงูุฑุณุงูุฉ ููุณู.  ูุจูุฌุฑุฏ ุฃู ูุชุตุฑู ูุซู <code>std::unique_ptr</code> ุ ุฃู  ูููู ููุซูู ูุงุญุฏ ููุท ูู ุฃุตุญุงุจ ุงูุฑุณุงูุฉ ุงูุฑุฌูุน ุฅูู ูุซูู ุงูุฑุณุงูุฉ. </p><br><p style=";text-align:right;direction:rtl">  ุจุดูู ุงูุชุฑุงุถู ุ ูุฌุจ ุฃู ูุนุชูุฏ ุณููู <code>message_holder_t</code> ุนูู ูุงุจููุฉ / ุนุฏู ูุงุจููุฉ ุงูุฑุณุงูุฉ ููุชุบููุฑ.  ุฃู  ูุน ุงูุฑุณุงุฆู ุบูุฑ <code>message_holder_t</code> ููุชุบููุฑ ุ ูุฌุจ ุฃู ูุชุตุฑู <code>message_holder_t</code> ูุซู <code>std::shared_ptr</code> ุ ููุน <code>std::unique_ptr</code> ููุชุบููุฑ ูุซู <code>std::unique_ptr</code> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">message_holder_t</span></span>&lt;so5_message&gt; msg1{...}; <span class="hljs-keyword"><span class="hljs-keyword">message_holder_t</span></span>&lt;so5_message&gt; msg2 = msg; <span class="hljs-comment"><span class="hljs-comment">// OK. message_holder_t&lt;mutable_msg&lt;user_message&gt;&gt; msg3{...}; message_holder_t&lt;mutable_msg&lt;user_message&gt;&gt; msg4 = msg3; // !  ! message_holder_t&lt;mutable_msg&lt;user_message&gt;&gt; msg5 = std::move(msg3); // OK.</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ููู ุงูุญูุงุฉ ุดูุก ูุนูุฏ ุ ูุฐุง ุนููู ุฃูุถูุง ุฃู ุชููู ูุงุฏุฑูุง ุนูู ุถุจุท ุณููู <code>message_holder_t</code> ูุฏูููุง.  ุจุญูุซ ููููู ุฅูุดุงุก message_holder ูุฑุณุงูุฉ ุซุงุจุชุฉ ุชุชุตุฑู ูุซู unique_ptr.  ูุจูุฐุง ููููู ุฅูุดุงุก message_holder ูุฑุณุงูุฉ ูุงุจูุฉ ููุชุบููุฑ ุชุชุตุฑู ูุซู shared_ptr: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> unique_so5_message = so_5::<span class="hljs-keyword"><span class="hljs-keyword">message_holder_t</span></span>&lt; so5_message, so_5::<span class="hljs-keyword"><span class="hljs-keyword">message_ownership_t</span></span>::unique&gt;; unique_so5_message msg1{...}; unique_so5_message msg2 = msg1; <span class="hljs-comment"><span class="hljs-comment">// !  ! unique_so5_message msg3 = std::move(msg); // OK,   msg3. using shared_user_messsage = so_5::message_holder_t&lt; so_5::mutable_msg&lt;user_message&gt;, so_5::message_ownership_t::shared&gt;; shared_user_message msg4{...}; shared_user_message msg5 = msg4; // OK.</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ููููุง ูุฐูู ุ ุนูุฏูุง ุชุนูู <code>message_holder_t</code> ูุซู shared_ptr ุ ููุฌุจ ุฃู ูููู ูุฏููุง ุงููุฌููุนุฉ ุงููุนุชุงุฏุฉ ูู ุงูููุดุฆุงุช ููุดุบูู ุงูุชุนููู: ุงููุณุฎ ูุงูุชููู.  ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ูุฌุจ ุฃู ูููู ููุงู ุทุฑููุฉ ุซุงุจุชุฉ <code>make_reference</code> ุ ูุงูุชู ุชูุฑุฌุน ูุณุฎุฉ ูู ุงููุคุดุฑ ุงููุฎุฒู ุฏุงุฎู <code>message_holder_t</code> . </p><br><p style=";text-align:right;direction:rtl">  ูููู ุนูุฏูุง ุชุนูู <code>message_holder_t</code> ูุซู unique_ptr ุ ุนูุฏุฆุฐู ูุฌุจ ุญุธุฑ ูููุดุฆ ุงููุณุฎุฉ ููุดุบู ุงููุณุฎ ููุง.  ููุฌุจ ุฃู <em>ุชุฃุฎุฐ</em> ุทุฑููุฉ <code>make_reference</code> ุงููุคุดุฑ ูู ูุงุฆู <code>message_holder_t</code> : ุจุนุฏ ุงุณุชุฏุนุงุก <code>make_reference</code> ูุฌุจ ุฃู ูุจูู <code>message_holder_t</code> ุงูุฃุตูู ูุงุฑุบูุง. </p><br><h2 id="chut-bolee-formalno" style=";text-align:right;direction:rtl">  ููููุง ุฃูุซุฑ ุฑุณููุฉ </h2><br><p style=";text-align:right;direction:rtl">  ูุฐูู ุ ุชุญุชุงุฌ ุฅูู ุฅูุดุงุก ูุฆุฉ ูุงูุจ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> M, <span class="hljs-keyword"><span class="hljs-keyword">message_ownership_t</span></span> Ownership = <span class="hljs-keyword"><span class="hljs-keyword">message_ownership_t</span></span>::autodetected&gt; class <span class="hljs-keyword"><span class="hljs-keyword">message_holder_t</span></span> {...};</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูู ูุง ููู: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูุฌุจ ุชุฎุฒูู <code>intrusive_ptr_t&lt;M&gt;</code> ุฃู <code>intrusive_ptr&lt;user_type_message_t&lt;M&gt;&gt;</code> ุงูุฏุงุฎู ุ ุงุนุชูุงุฏูุง ุนูู ูุง ุฅุฐุง ูุงูุช M ููุฑูุซุฉ ูู <code>message_t</code> ุ </li><li style=";text-align:right;direction:rtl">  ูุฌุจ ุฃู ุชูุฑุฌุน ุทุฑู getter ุฅูุง <code>const M*</code> ุฃู <code>M*</code> ุงุนุชูุงุฏูุง ุนูู ูุงุจููุฉ / ุนุฏู ูุงุจููุฉ ุงูุฑุณุงูุฉ ููุชุบููุฑ ุ </li><li style=";text-align:right;direction:rtl">  ูุฌุจ ุฃู ูููู ููุงู ุฅูุง ูุฌููุนุฉ ูุงููุฉ ูู ุงูููุดุฆุงุช ููุดุบูู ุงููุณุฎ / ุงูููู ุ ุฃู ููุท ูููุดุฆ ููุดุบู ููู ุ </li><li style=";text-align:right;direction:rtl">  ูุฌุจ ุฃู ุชููู ุทุฑููุฉ <code>make_reference()</code> ุฅูุง ุจุฅุฑุฌุงุน ูุณุฎุฉ ูู intrusive_ptr ุงููุฎุฒูุฉ ุ ุฃู ูุฌุจ ุฃู ุชุฃุฎุฐ ูููุฉ intrusive_ptr ูุชุชุฑู <code>message_holder_t</code> ุงูุฃุตููุฉ ูุงุฑุบุฉ.  ูู ุงูุญุงูุฉ ุงูุฃููู ุ ูุฌุจ ุฃู ูููู <code>make_reference()</code> ุซุงุจุชูุง ุ ูู ุงูุทุฑููุฉ ุงูุซุงููุฉ - ุบูุฑ ุงูุซุงุจุชุฉ. </li></ul><br><p style=";text-align:right;direction:rtl">  ูุชู ุชุญุฏูุฏ ุขุฎุฑ ุนูุตุฑูู ูู ุงููุงุฆูุฉ ุจูุงุณุทุฉ ูุนููุฉ ุงูููููุฉ (ููุฐูู ูุงุจููุฉ ุชุญููู ุงูุฑุณุงูุฉ ูู ุญุงูุฉ ุงุณุชุฎุฏุงู <code>autodetected</code> ููููููุฉ). </p><br><h1 id="kak-eto-bylo-resheno" style=";text-align:right;direction:rtl">  ููู ุชูุฑุฑ </h1><br><p style=";text-align:right;direction:rtl">  ูู ูุฐุง ุงููุณู ุ ุณููุธุฑ ูู ุฌููุน ุงูููููุงุช ุงูุชู ุชุดูู ุงูุญู ุงูููุงุฆู.  ุญุณูุง ุ ุงูุญู ุงููุงุชุฌ ููุณู.  ุณูุชู ุนุฑุถ ุฃุฌุฒุงุก ุงูููุฏ ุงูุชู ุชู ูุณุญูุง ูู ูู ุชูุงุตูู ุงูุชุดุชูุช.  ุฅุฐุง ูุงู ุดุฎุต ูุง ููุชููุง ุจุงูุฑูุฒ ุงูุญูููู ุ ูููููู ูุดุงูุฏุชู <a href="">ููุง</a> . </p><br><h2 id="disclaimer" style=";text-align:right;direction:rtl">  ุชูุตู </h2><br><p style=";text-align:right;direction:rtl">  ุงูุญู ุงูููุถุญ ุฃุฏูุงู ูุง ูุฏุนู ุฃูู ุฌููู ุฃู ูุซุงูู ุฃู ูููุฐุฌ ูุญุชุฐู ุจู.  ุชู ุงูุนุซูุฑ ุนูููุง ูุชูููุฐูุง ูุงุฎุชุจุงุฑูุง ูุชูุซูููุง ูู ููุช ูุตูุฑ ุ ุชุญุช ุถุบุท ูู ุงูููุงุนูุฏ ุงูููุงุฆูุฉ.  ุฑุจูุง ุฅุฐุง ูุงู ููุงู ูุฒูุฏ ูู ุงูููุช ุ ููุงู ุฃูุซุฑ ููุฎุฑุท ูู ุงูุจุญุซ ุนู ุญู <del>  ุดุงุจ </del>  ุญุณุงุณุฉ ูุฏุฑุงูุฉ ูู ุงููุทูุฑ C ++ ุงูุญุฏูุซ ุ ูุฅูู ุณูุชุญูู ุฅูู ุฃู ูููู ุฃูุซุฑ ุฅุญูุงูุง ูุฃูุซุฑ ุจุณุงุทุฉ ูุฃูุซุฑ ูุงุจููุฉ ููููู.  ูููู ุ ููุง ุงุชุถุญ ุ ุญุฏุซ ุฐูู ... "ูุง ุชุทูููุง ุงููุงุฑ ุนูู ุนุงุฒู ุงูุจูุงูู" ุ ุจุดูู ุนุงู. </p><br><h2 id="posledovatelnost-shagov-i-uzhe-gotovaya-shablonnaya-magiya" style=";text-align:right;direction:rtl">  ุณูุณูุฉ ูู ุงูุฎุทูุงุช ูุงูุณุญุฑ ูุงูุจ ุฌุงูุฒ </h2><br><p style=";text-align:right;direction:rtl">  ูุฐูู ุ ูุญู ุจุญุงุฌุฉ ุฅูู ูุตู ูุน ุนุฏุฉ ูุฌููุนุงุช ูู ุงูุฃุณุงููุจ.  ูุฌุจ ุฃู ุชุฃุชู ูุญุชููุงุช ูุฐู ุงููุฌููุนุงุช ูู ููุงู ูุง.  ูู ุงูู </p><br><p style=";text-align:right;direction:rtl">  ูู D ุ ูููููุง ุงุณุชุฎุฏุงู <code>static if</code> ูุชุนุฑูู ุฃุฌุฒุงุก ูุฎุชููุฉ ูู ุงููุตู ุชุจุนุง ูุธุฑูู ูุฎุชููุฉ.  ูู ุจุนุถ ุฑูุจู ุ ูููููุง <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุฏูุฌ ุงูุฃุณุงููุจ ูู ูุตููุง ุจุงุณุชุฎุฏุงู ุทุฑููุฉ ุงูุชุถููู</a> .  ููููุง ูู C ++ ุ ุญูุซ ุฅููุงููุงุชูุง ูุญุฏูุฏุฉ ููุบุงูุฉ ุญุชู ุงูุขู: ูููููุง ุฅูุง ุชุญุฏูุฏ ุฃุณููุจ / ุณูุฉ ูุจุงุดุฑุฉ ุฏุงุฎู ุงููุตู ุ ุฃู ูููููุง ุฃู ูุฑุซ ุงูุทุฑููุฉ / ุงูุณูุฉ ูู ูุฆุฉ ุฃุณุงุณูุฉ ูุนููุฉ. </p><br><p style=";text-align:right;direction:rtl">  ูุง ูููููุง ุชุญุฏูุฏ ุฃุณุงููุจ / ุณูุงุช ูุฎุชููุฉ ุฏุงุฎู ุงููุตู ุงุนุชูุงุฏูุง ุนูู ุจุนุถ ุงูุดุฑูุท ุ ูุฃู  C ++ <code>if constexpr</code> ููุณ <code>static if</code> .  ูุจุงูุชุงูู ุ ูุจูู ุงูููุฑุงุซ ููุท. </p><br><blockquote style=";text-align:right;direction:rtl">  <strong>ูุญุฏุซ.</strong>  ููุง ูู ููุชุฑุญ ูู ุงูุชุนูููุงุช ุ ูุฌุจ ุฃู ุฃุชุญุฏุซ ุจุนูุงูุฉ ุฃูุจุฑ ููุง.  ูุธุฑูุง ูุฃู C ++ ูุฏูู SFINAE ุ ูููููุง ุชูููู / ุชุนุทูู ุฑุคูุฉ ุงูุทุฑู ุงููุฑุฏูุฉ ูู ุงููุตู ุงูุฏุฑุงุณู ุนุจุฑ SFINAE (ุฃู ุชุญููู ุชุฃุซูุฑ ููุงุซู ููุชุฃุซูุฑ <code>static if</code> ).  ูููู ูุฐุง ุงูููุฌ ูุฏูู ุงุซููู ูู ุฃูุฌู ุงููุตูุฑ ุงูุฎุทูุฑุฉ ุ ูู ุฑุฃูู.  ุฃููุงู ุ ุฅุฐุง ูู ุชูู ูุฐู ุงูุทุฑู ูู 1-2 ุฅูู 3 ุ ูููู ูู 4 ุฅูู 5 ุฃู ุฃูุซุฑ ุ ูุฅู ุชูุณูู ูู ูููุง ุจุงุณุชุฎุฏุงู SFINAE ูููู ุดุงููุง ุ ููุฐุง ูุคุซุฑ ุนูู ูุงุจููุฉ ูุฑุงุกุฉ ุงูููุฏ.  ุซุงููุงู ุ ูุง ูุณุงุนุฏูุง SFINAE ูู ุฅุถุงูุฉ / ุฅุฒุงูุฉ ุณูุงุช ุงูุตู (ุงูุญููู). </blockquote><p style=";text-align:right;direction:rtl">  ูู C ++ ุ ูููููุง ุชุญุฏูุฏ ุงูุนุฏูุฏ ูู ุงููุฆุงุช ุงูุฃุณุงุณูุฉ ุงูุชู ุณูุฑุซ ูู ุฎูุงููุง <code>message_holder_t</code> .  ูุณูุชู ุจุงููุนู ุงุฎุชูุงุฑ ูุฆุฉ ุฃุณุงุณูุฉ ูุงุญุฏุฉ ุฃู ุฃุฎุฑู ููููุง ูููู ูุนููุงุช ุงููุงูุจ ุ ุจุงุณุชุฎุฏุงู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">std :: conditional</a> . </p><br><p style=";text-align:right;direction:rtl">  ููู ุงูุญููุฉ ูู ุฃููุง ูุง ูุญุชุงุฌ ููุท ุฅูู ูุฌููุนุฉ ูู ุงูุทุจูุงุช ุงูุฃุณุงุณูุฉ ุ ูููู ุฅูู ุณูุณูุฉ ุตุบูุฑุฉ ูู ุงูููุฑุงุซ.  ูู ุจุฏุงูุชูุง ุ ุณูููู ููุงู ูุตู ูุญุฏุฏ ุงููุธููุฉ ุงูุนุงูุฉ ุงููุทููุจุฉ ูู ุฃู ุญุงู.  ุงูุชุงูู ุณูููู ุงููุฆุงุช ุงูุฃุณุงุณูุฉ ุงูุชู ุณุชุญุฏุฏ ููุทู ุณููู "ุงููุคุดุฑ ุงูุฐูู".  ูุจุนุฏ ุฐูู ุณูููู ููุงู ูุฆุฉ ุชุญุฏุฏ ุงูุญุฑูู ุงููุงุฒูุฉ.  ุจูุฐุง ุงูุชุฑุชูุจ ุณููุธุฑ ูู ุงูุทุจูุงุช ุงููููุฐุฉ. </p><br><p style=";text-align:right;direction:rtl">  ูุชู ุชุจุณูุท ูููุชูุง ูู ุฎูุงู ุญูููุฉ ุฃู SObjectizer ูุญุชูู ุจุงููุนู ุนูู ูุงูุจ ููุงูุจ ุฌุงูุฒ <a href="">ูุญุฏุฏ ูุง ุฅุฐุง ูุงูุช ุงูุฑุณุงูุฉ ููุฑูุซุฉ ูู message_t</a> ุ ููุฐูู <a href="">ูุณููุฉ ููุชุญูู ูู ูุงุจููุฉ ููู ุงูุฑุณุงุฆู</a> .  ูุฐูู ุ ูู ุงูุชูููุฐ ุ ุณูุณุชุฎุฏู ุจุจุณุงุทุฉ ูุฐุง ุงูุณุญุฑ ุงูุฌุงูุฒุฉ ููู ูุชุนูู ูู ุชูุงุตูู ุนููู. </p><br><h2 id="obschaya-baza-dlya-hraneniya-ukazatelya" style=";text-align:right;direction:rtl">  ูุงุนุฏุฉ ุชุฎุฒูู ูุคุดุฑ ูุดุชุฑูุฉ </h2><br><p style=";text-align:right;direction:rtl">  ููุจุฏุฃ ุจููุน ุฃุณุงุณู ุดุงุฆุน ูุฎุฒู intrusive_ptr ุงููุทุงุจู ุ ููููุฑ ุฃูุถูุง ูุฌููุนุฉ ูุดุชุฑูุฉ ูู ุงูุทุฑู ุงูุชู ูุญุชุงุฌูุง ุฃู ูู ุชุทุจููุงุช <code>message_holder_t</code> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Payload, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Envelope &gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">basic_message_holder_impl_t</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> : <span class="hljs-keyword"><span class="hljs-keyword">intrusive_ptr_t</span></span>&lt; Envelope &gt; m_msg; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> : <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> payload_type = Payload; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> envelope_type = Envelope; <span class="hljs-keyword"><span class="hljs-keyword">basic_message_holder_impl_t</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">noexcept</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">basic_message_holder_impl_t</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">intrusive_ptr_t</span></span>&lt; Envelope &gt; msg ) <span class="hljs-keyword"><span class="hljs-keyword">noexcept</span></span> : m_msg{ <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(msg) } {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">reset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">noexcept</span></span></span><span class="hljs-function"> </span></span>{ m_msg.reset(); } [[nodiscard]] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">empty</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">noexcept</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static_cast</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>&gt;( m_msg ); } [[nodiscard]] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">operator</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bool</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">noexcept</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> !<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>-&gt;empty(); } [[nodiscard]] <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>!() <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">noexcept</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>-&gt;empty(); } };</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุฆุฉ ุงููุงูุจ ูุฐู ููุง ูุนููุชุงู.  ุงูุฃูู ุ Payload ุ ูุญุฏุฏ ุงูููุน ุงูุฐู ูุฌุจ ุฃู ุชุณุชุฎุฏูู ุทุฑู getter.  ุจูููุง ุงูุซุงูู ุ Envelope ุ ูุนูู ููุน intrusive_ptr.  ูู ุญุงูุฉ ุชูุงุฑุซ ููุน ุงูุฑุณุงูุฉ ูู <code>message_t</code> ููู ูู ูุฐู ุงููุนููุงุช ููุณ ุงููููุฉ.  ูููู ุฅุฐุง ูู ูุชู ุชูุฑูุซ ุงูุฑุณุงูุฉ ูู <code>message_t</code> ุ ูุณูุชู ุงุณุชุฎุฏุงู ููุน ุงูุฑุณุงูุฉ ูู Payload ุ ูุณูููู <code>user_type_message_t&lt;Payload&gt;</code> ุจูุซุงุจุฉ Envelope. </p><br><p style=";text-align:right;direction:rtl">  ุฃุนุชูุฏ ุฃู ูุญุชูู ูุฐุง ุงููุตู ูุง ูุซูุฑ ุงูุฃุณุฆูุฉ ุจุดูู ุฃุณุงุณู.  ูููู ููุจุบู ููุงุญุธุฉ ุดูุฆูู ุจุดูู ูููุตู. </p><br><p style=";text-align:right;direction:rtl">  ุฃููุงู ุ ุงููุคุดุฑ ููุณู ุ ุฃู  ูุชู ุชุนุฑูู ุณูุฉ m_msg ูู ุงููุณู ุงููุญูู ุจุญูุซ ูููู ููุฑุงุซุฉ ุงููุฆุงุช ุงููุตูู ุฅูููุง. </p><br><p style=";text-align:right;direction:rtl">  ุซุงููุงู ุ ุจุงููุณุจุฉ ููุฐู ุงููุฆุฉ ุ ูููู ุงููุชุฑุฌู ููุณู ุจุชูููุฏ ุฌููุน ุงูููุดุฆุงุช ุงููุงุฒูุฉ ููุดุบูู ุงููุณุฎ / ุงูููู.  ูุนูู ูุณุชูู ูุฐู ุงููุฆุฉ ุ ูุญู ูุง ูุญุธุฑ ุฃู ุดูุก ุญุชู ุงูุขู. </p><br><h2 id="otdelnye-bazy-dlya-shared_ptr--i-unique_ptr-povedeniya" style=";text-align:right;direction:rtl">  ููุงุนุฏ ูููุตูุฉ ูุณููู Shared_ptr ู unique_ptr </h2><br><p style=";text-align:right;direction:rtl">  ูุฐูู ุ ูุฏููุง ูุฆุฉ ูุฎุฒู ูุคุดุฑ ูุฑุณุงูุฉ.  ุงูุขู ูููููุง ุชุญุฏูุฏ ูุฑุซุชู ุ ุงูุฐูู ุณูุชุตุฑููู ุฅูุง ูู Shared_ptr ุฃู unique_ptr. </p><br><p style=";text-align:right;direction:rtl">  ุฏุนูุง ูุจุฏุฃ ูุน ุญุงูุฉ Shared_ptr ูู ุงูุณููู ุ ูุฃู  ููุง ูู ุฃูู ุฑูุฒ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Payload, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Envelope &gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">shared_message_holder_impl_t</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">basic_message_holder_impl_t</span></span>&lt;Payload, Envelope&gt; { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> direct_base_type = <span class="hljs-keyword"><span class="hljs-keyword">basic_message_holder_impl_t</span></span>&lt;Payload, Envelope&gt;; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> : <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> direct_base_type::direct_base_type; [[nodiscard]] <span class="hljs-keyword"><span class="hljs-keyword">intrusive_ptr_t</span></span>&lt; Envelope &gt; make_reference() <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">noexcept</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>-&gt;m_msg; } };</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุง ููุฌุฏ ุดูุก ูุนูุฏ: ุชุฑุซ ูู <code>basic_message_holder_impl_t</code> ุ ูุฑุซ ูู <code>basic_message_holder_impl_t</code> ุจุณูุทูุง ูุบูุฑ ูุฏูุฑ ูู <code>make_reference()</code> . </p><br><p style=";text-align:right;direction:rtl">  ูู ุญุงูุฉ ุณููู unique_ptr ุ ูููู ุงูุฑูุฒ ุฃูุจุฑ ุ ุนูู ุงูุฑุบู ูู ุนุฏู ูุฌูุฏ ุดูุก ูุนูุฏ ููู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Payload, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Envelope &gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">unique_message_holder_impl_t</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">basic_message_holder_impl_t</span></span>&lt;Payload, Envelope&gt; { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> direct_base_type = <span class="hljs-keyword"><span class="hljs-keyword">basic_message_holder_impl_t</span></span>&lt;Payload, Envelope&gt;; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> : <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> direct_base_type::direct_base_type; <span class="hljs-keyword"><span class="hljs-keyword">unique_message_holder_impl_t</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">unique_message_holder_impl_t</span></span> &amp; ) = <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">unique_message_holder_impl_t</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">unique_message_holder_impl_t</span></span> &amp;&amp; ) = <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">unique_message_holder_impl_t</span></span> &amp; <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>=( <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">unique_message_holder_impl_t</span></span> &amp; ) = <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">unique_message_holder_impl_t</span></span> &amp; <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>=( <span class="hljs-keyword"><span class="hljs-keyword">unique_message_holder_impl_t</span></span> &amp;&amp; ) = <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>; [[nodiscard]] <span class="hljs-keyword"><span class="hljs-keyword">intrusive_ptr_t</span></span>&lt; Envelope &gt; make_reference() <span class="hljs-keyword"><span class="hljs-keyword">noexcept</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>-&gt;m_msg) }; } };</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุฑุฉ ุฃุฎุฑู ุ ูุฑุซ ูู <code>basic_message_holder_impl_t</code> ุงูุชู ูุญุชุงุฌูุง ููู (ูุฐุง ูู ุงูููุดุฆ ุงูุงูุชุฑุงุถู <code>basic_message_holder_impl_t</code> ุงูุชููุฆุฉ).  ูููู ูู ุงูููุช ููุณู ุ ูุญุฏุฏ ุงูููุดุฆุงุช ููุดุบูู ุงููุณุฎ / ุงูููู ููููุง ููููุทู ุงููุฑูุฏ: ูุญู ูุญุธุฑ ุงููุณุฎ ุ ููููุฐ ูุฐู ุงูุฎุทูุฉ. </p><br><p style=";text-align:right;direction:rtl">  ูุฏููุง ุฃูุถูุง ุทุฑููุฉ <code>make_reference()</code> ูุฏูุฑุฉ <code>make_reference()</code> . </p><br><p style=";text-align:right;direction:rtl">  ูุฐุง ูู ุดูุก ุ ูู ุงููุงูุน.  ูุจูู ููุท ูุชุญููู ุงูุงุฎุชูุงุฑ ุจูู ูุงุชูู ุงููุฆุชูู ุงูุฃุณุงุณูุชูู ... </p><br><h3 id="vybor-mezhdu-shared_ptr--i-unique_ptr-povedeniem" style=";text-align:right;direction:rtl">  ุงูุงุฎุชูุงุฑ ุจูู Shared_ptr ูุณููู unique_ptr </h3><br><p style=";text-align:right;direction:rtl">  ููุงุฎุชูุงุฑ ุจูู ุณููู Shared_ptr ู unique_ptr ุ ุชุญุชุงุฌ ุฅูู ููู ุงูุชุนุฑูู ุงูุชุงูู (ููู ุชุนุฑูู ูุฃูู "ูุนูู" ูุน ุฃููุงุน ูู ููุช ุงูุชุฑุฌูุฉ): </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Msg, <span class="hljs-keyword"><span class="hljs-keyword">message_ownership_t</span></span> Ownership &gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">impl_selector</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static_assert</span></span>( !is_signal&lt;Msg&gt;::value, <span class="hljs-string"><span class="hljs-string">"Signals can't be used with message_holder"</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> P = <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> message_payload_type&lt; Msg &gt;::payload_type; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> E = <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> message_payload_type&lt; Msg &gt;::envelope_type; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> type = <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">conditional_t</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">message_ownership_t</span></span>::autodetected == Ownership, <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">conditional_t</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">message_mutability_t</span></span>::immutable_message == message_mutability_traits&lt;Msg&gt;::mutability, <span class="hljs-keyword"><span class="hljs-keyword">shared_message_holder_impl_t</span></span>&lt;P, E&gt;, <span class="hljs-keyword"><span class="hljs-keyword">unique_message_holder_impl_t</span></span>&lt;P, E&gt; &gt;, <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">conditional_t</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">message_ownership_t</span></span>::shared == Ownership, <span class="hljs-keyword"><span class="hljs-keyword">shared_message_holder_impl_t</span></span>&lt;P, E&gt;, <span class="hljs-keyword"><span class="hljs-keyword">unique_message_holder_impl_t</span></span>&lt;P, E&gt; &gt; &gt;; };</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููุจู ููู ุงูุชุนุฑูู ูุฐุง ููุง ุงููุนููุชูู ูู ูุงุฆูุฉ ูุนููุงุช <code>message_holder_t</code> ุ ููุชูุฌุฉ ูุฐูู (ุฃู ุ ุชุนุฑูู <code>type</code> ุงููุชุฏุงุฎู) ุ "ููุฑุฌุน" ุงูููุน ุงูุฐู ูุฌุจ ุฃู ูููุฑุซ ููู.  ุฃู  ุฅูุง <code>shared_message_holder_impl_t</code> ุฃู <code>unique_message_holder_impl_t</code> . </p><br><p style=";text-align:right;direction:rtl">  ุฏุงุฎู ุชุนุฑูู <code>impl_selector</code> ููููู ูุดุงูุฏุฉ ุขุซุงุฑ ุงูุณุญุฑ ุงููุฐููุฑุฉ ุฃุนูุงู ุ ูุงูุชู ูู ูุฐูุจ ุฅูู: <code>message_payload_type&lt;Msg&gt;::payload_type</code> ุ <code>message_payload_type&lt;Msg&gt;::envelope_type</code> ู <code>message_mutability_traits&lt;Msg&gt;::mutability</code> . <code>message_mutability_traits&lt;Msg&gt;::mutability</code> . </p><br><p style=";text-align:right;direction:rtl">  ููู ุฃุฌู ุงุณุชุฎุฏุงู <code>impl_selector</code> ูุงู ุฃุณูู ุ ูุณูู ูุญุฏุฏ ุงุณููุง ุฃูุตุฑ ูู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Msg, <span class="hljs-keyword"><span class="hljs-keyword">message_ownership_t</span></span> Ownership &gt; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">impl_selector_t</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> impl_selector&lt;Msg, Ownership&gt;::type;</code> </pre> <br><h2 id="baza-dlya-getter-ov" style=";text-align:right;direction:rtl">  ูุงุนุฏุฉ ููุงูุนุงุจ </h2><br><p style=";text-align:right;direction:rtl">  ูุฐูู ุ ูุฏููุง ุจุงููุนู ุงููุฑุตุฉ ูุชุญุฏูุฏ ูุงุนุฏุฉ ุชุญุชูู ุนูู ูุคุดุฑ ูุชุนุฑูู ุณููู "ูุคุดุฑ ุฐูู".  ุงูุขู ูุญู ุจุญุงุฌุฉ ุฅูู ุชูููุฑ ูุฐู ุงููุงุนุฏุฉ ูุน ุฃุณุงููุจ getter.  ููุงุฐุง ูุญุชุงุฌ ุฅูู ูุตู ูุงุญุฏ ุจุณูุท: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Base, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Return_Type &gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">msg_accessors_t</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Base { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> : <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Base::Base; [[nodiscard]] <span class="hljs-function"><span class="hljs-function">Return_Type * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">noexcept</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> get_ptr( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>-&gt;m_msg ); } [[nodiscard]] Return_Type &amp; <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span> * () <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">noexcept</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> *get(); } [[nodiscard]] Return_Type * <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>-&gt;() <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">noexcept</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> get(); } };</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุฐู ูุฆุฉ ูุงูุจ ุชุนุชูุฏ ุนูู ูุนููุชูู ุ ููู ูุนูุงูุง ูุฎุชูู ุชูุงููุง.  ุณุชููู ุงููุนููุฉ Base ูุชูุฌุฉ <code>impl_selector</code> impl_selector ุงูููุถุญุฉ ุฃุนูุงู.  ุฃู  ููุนููุฉ Base ุ ูุชู ุชุนููู ุงููุฆุฉ ุงูุฃุณุงุณูุฉ ุงูุชู ุชุฑุซ ูููุง. </p><br><p style=";text-align:right;direction:rtl">  ูู ุงูููู ุงูุฅุดุงุฑุฉ ุฅูู ุฃูู ุฅุฐุง ูุงู ุงูููุฑุงุซ ูุฃุชู ูู <code>unique_message_holder_impl_t</code> ุ ูุงูุฐู ููููุน ุงููููุดุฆ ููุดุบู ุงููุณุฎ ูู ุ ููู ูุชููู ุงููุชุฑุฌู ูู ุฅูุดุงุก ูููุดุฆ ููุณุฎ ุนุงูู ุงูุชุดุบูู <code>msg_accessors_t</code> .  ููู ูุง ูุญุชุงุฌู </p><br><p style=";text-align:right;direction:rtl">  ุณูููู ููุน ุงูุฑุณุงูุฉ ุ ุงููุคุดุฑ / ุงูุงุฑุชุจุงุท ุงูุฐู ุณูุชู ุฅุฑุฌุงุนู ุจูุงุณุทุฉ getters ุ ุจูุซุงุจุฉ ุงููุนููุฉ Return_Type.  ุงูุญููุฉ ูู ุฃูู ุจุงููุณุจุฉ ูุฑุณุงูุฉ ุซุงุจุชุฉ ูู ุงูููุน <code>Msg</code> ุณูุชู ุชุนููู ุงููุนููุฉ Return_Type ุฅูู <code>const Msg</code> .  ุจูููุง ุจุงููุณุจุฉ ูุฑุณุงูุฉ ูุงุจูุฉ ููุชุบููุฑ ูู ุงูููุน <code>Msg</code> ุงููุนููุฉ Return_Type ุณูููู ููุง ุงููููุฉ <code>Msg</code> .  ูุจุงูุชุงูู ุ ูุฅู ุงูุฃุณููุจ <code>get()</code> ุณูุนูุฏ <code>const Msg*</code> ููุฑุณุงุฆู ุบูุฑ ุงููุงุจูุฉ ููุชุบููุฑ ุ ูููุท <code>Msg*</code> ููุฑุณุงุฆู ุงููุงุจูุฉ ููุชุบููุฑ. </p><br><p style=";text-align:right;direction:rtl">  ุจุงุณุชุฎุฏุงู <code>get_ptr()</code> ุงูุฏุงูุฉ ุงูุญุฑุฉ <code>get_ptr()</code> ูุญู ูุดููุฉ ุงูุนูู ูุน ุงูุฑุณุงุฆู ุงูุชู ูู ูุชู ุชูุงุฑุซูุง ูู <code>message_t</code> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> M &gt; <span class="hljs-function"><span class="hljs-function">M * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_ptr</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">intrusive_ptr_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;M&gt; &amp; msg )</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">noexcept</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> msg.get(); } <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> M &gt; <span class="hljs-function"><span class="hljs-function">M * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_ptr</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">intrusive_ptr_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt; </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">user_type_message_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;M&gt; &gt; &amp; msg )</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">noexcept</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::addressof(msg-&gt;m_payload); }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุฃู  ุฅุฐุง ูู ูุชู ุชูุฑูุซ ุงูุฑุณุงูุฉ ูู <code>message_t</code> ูุชุฎุฒูููุง ุนูู ุฃููุง <code>user_type_message_t&lt;Msg&gt;</code> ุ ูุณูุชู ุงุณุชุฏุนุงุก ุงูุชุญููู ุงูุฒุงุฆุฏ ุงูุซุงูู.  ูุฅุฐุง ูุงู ููุฑูุซุง ุ ุซู ุงูุฒุงุฆุฏ ุงูุฃูู. </p><br><h3 id="vybor-konkretnoy-bazy-dlya-getter-ov" style=";text-align:right;direction:rtl">  ุงุฎุชูุงุฑ ูุงุนุฏุฉ ูุญุฏุฏุฉ ููุฃูุนุงุจ </h3><br><p style=";text-align:right;direction:rtl">  ูุฐูู ุ ูุชุทูุจ ุงููุงูุจ <code>msg_accessors_t</code> ูุนููุชูู.  ูุชู ุญุณุงุจ ุงูุฃูู ุนู ุทุฑูู <code>impl_selector</code> metafunction.  ูููู ูู ุฃุฌู ุชูููู ููุน ุฃุณุงุณู ูุญุฏุฏ ูู <code>msg_accessors_t</code> ุ ูุญุชุงุฌ ุฅูู ุชุญุฏูุฏ ูููุฉ ุงููุนููุฉ ุงูุซุงููุฉ.  ููู ุชุนุฑูู ุขุฎุฑ ูุฎุตุต ููุฐุง: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">message_mutability_t</span></span> Mutability, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Base &gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">accessor_selector</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> type = <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">conditional_t</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">message_mutability_t</span></span>::immutable_message == Mutability, <span class="hljs-keyword"><span class="hljs-keyword">msg_accessors_t</span></span>&lt;Base, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Base::payload_type <span class="hljs-keyword"><span class="hljs-keyword">const</span></span>&gt;, <span class="hljs-keyword"><span class="hljs-keyword">msg_accessors_t</span></span>&lt;Base, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Base::payload_type&gt; &gt;; };</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููููู ููุท ุงูุงูุชุจุงู ุฅูู ุญุณุงุจ ุงููุนููุฉ Return_Type.  ูุงุญุฏุฉ ูู ุชูู ุงูุญุงูุงุช ุงูููููุฉ ุญูุซ ุดุฑู const ูููุฏ ุ) </p><br><p style=";text-align:right;direction:rtl">  ุญุณููุง ุ ูุฒูุงุฏุฉ ุฅููุงููุฉ ูุฑุงุกุฉ ุงูุชุนูููุฉ ุงูุจุฑูุฌูุฉ ุงูุชุงููุฉ ุ ุฎูุงุฑ ุฃูุซุฑ ุฅุญูุงูุง ููุชุนุงูู ูุนูุง: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">message_mutability_t</span></span> Mutability, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Base &gt; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">accessor_selector_t</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> accessor_selector&lt;Mutability, Base&gt;::type;</code> </pre> <br><h2 id="itogovyy-naslednik-message_holder_t" style=";text-align:right;direction:rtl">  ุงูุฎูู ุงูููุงุฆู message_holder_t </h2><br><p style=";text-align:right;direction:rtl">  ุงูุขู ููููู ุฅููุงุก ูุธุฑุฉ ุนูู ูุงููุฉ <code>message_holder_t</code> ุ ูุงูุชู ุชุชุทูุจ ุชูููุฐ ูู ูุฐู ุงููุฆุงุช ุงูุฃุณุงุณูุฉ ูุงูุจูุงูุงุช ุงููุตููุฉ (ุชุชู ุฅุฒุงูุฉ ุฌุฒุก ูู ุฃุณุงููุจ ุฅูุดุงุก ูุซูู ููุฑุณุงูุฉ ุงููุฎุฒูุฉ ูู message_holder ูู ุงูุชูููุฐ): </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Msg, <span class="hljs-keyword"><span class="hljs-keyword">message_ownership_t</span></span> Ownership = <span class="hljs-keyword"><span class="hljs-keyword">message_ownership_t</span></span>::autodetected &gt; class <span class="hljs-keyword"><span class="hljs-keyword">message_holder_t</span></span> : <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> details::message_holder_details::<span class="hljs-keyword"><span class="hljs-keyword">accessor_selector_t</span></span>&lt; details::message_mutability_traits&lt;Msg&gt;::mutability, details::message_holder_details::<span class="hljs-keyword"><span class="hljs-keyword">impl_selector_t</span></span>&lt;Msg, Ownership&gt; &gt; { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> base_type = details::message_holder_details::<span class="hljs-keyword"><span class="hljs-keyword">accessor_selector_t</span></span>&lt; details::message_mutability_traits&lt;Msg&gt;::mutability, details::message_holder_details::<span class="hljs-keyword"><span class="hljs-keyword">impl_selector_t</span></span>&lt;Msg, Ownership&gt; &gt;; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> : <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> payload_type = <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> base_type::payload_type; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> envelope_type = <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> base_type::envelope_type; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> base_type::base_type; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">friend</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">swap</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">message_holder_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> &amp; a, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">message_holder_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> &amp; b )</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">noexcept</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::swap; swap( a.message_reference(), b.message_reference() ); } };</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูู ุงููุงูุน ุ ูุงู ูู ูุง ูููุง ุจุชุญูููู ุฃุนูุงู ูุทููุจูุง ูู ุฃุฌู ุชุณุฌูู ูุฐู "ุงูุฏุนูุฉ" ุงูุฎุงุตุฉ ุจุนูููุชู ุชุนุฑูู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs">details::message_holder_details::<span class="hljs-keyword"><span class="hljs-keyword">accessor_selector_t</span></span>&lt; details::message_mutability_traits&lt;Msg&gt;::mutability, details::message_holder_details::<span class="hljs-keyword"><span class="hljs-keyword">impl_selector_t</span></span>&lt;Msg, Ownership&gt; &gt;</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุฃู  ููุณ ูุฐุง ูู ุงูุฎูุงุฑ ุงูุฃูู ุ ูููู ูุชูุฌุฉ ูุชุจุณูุท ูุชูููู ุงูููุฏ ุ ูููููู ุงูููู ุฃู ุงูุฃุดูุงู ุงููุฏูุฌุฉ ููุจูุงูุงุช ุงููุตููุฉ ุชููู ุฅูู ุญุฏ ูุจูุฑ ููุฏุงุฑ ุงูุดูุฑุฉ ูุชุฒูุฏ ูู ูุงุจููุชูุง ููููู (ุฅุฐุง ูุงู ูู ุงูููุงุณุจ ุนููููุง ุงูุชุญุฏุซ ุนู ุงูููู ููุง). </p><br><h1 id="a-chto-bylo-by-esli-by" style=";text-align:right;direction:rtl">  ููุงุฐุง ุณูุญุฏุซ ูู ... </h1><br><p style=";text-align:right;direction:rtl">  ูููู ุฅุฐุง ูุงูุช ูุบุฉ C ++ ูู <code>if constexpr</code> ูููุฉ ููุง <code>static if</code> ูู D ุ ูููููู ูุชุงุจุฉ ุดูุก ูุซู: </p><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ูุณุฎุฉ ุงูุชุฑุงุถูุฉ ูุน ุฃูุซุฑ ุชูุฏูุง ุฅุฐุง constexpr</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Msg, <span class="hljs-keyword"><span class="hljs-keyword">message_ownership_t</span></span> Ownership = <span class="hljs-keyword"><span class="hljs-keyword">message_ownership_t</span></span>::autodetected &gt; class <span class="hljs-keyword"><span class="hljs-keyword">message_holder_t</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">constexpr</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">message_mutability_t</span></span> Mutability = details::message_mutability_traits&lt;Msg&gt;::mutability; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">constexpr</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">message_ownership_t</span></span> Actual_Ownership = (<span class="hljs-keyword"><span class="hljs-keyword">message_ownership_t</span></span>::unique == Ownership || (<span class="hljs-keyword"><span class="hljs-keyword">message_mutability_t</span></span>::mutable_msg == Mutability &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">message_ownership_t</span></span>::autodetected == Ownership)) ? <span class="hljs-keyword"><span class="hljs-keyword">message_ownership_t</span></span>::unique : <span class="hljs-keyword"><span class="hljs-keyword">message_ownership_t</span></span>::shared; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> : <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> payload_type = <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> message_payload_type&lt; Msg &gt;::payload_type; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> envelope_type = <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> message_payload_type&lt; Msg &gt;::envelope_type; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> : <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> getter_return_type = <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">conditional_t</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">message_mutability_t</span></span>::immutable_msg == Mutability, payload_type <span class="hljs-keyword"><span class="hljs-keyword">const</span></span>, payload_type &gt;; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> : <span class="hljs-keyword"><span class="hljs-keyword">message_holder_t</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">noexcept</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">message_holder_t</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">intrusive_ptr_t</span></span>&lt; envelope_type &gt; mf ) <span class="hljs-keyword"><span class="hljs-keyword">noexcept</span></span> : m_msg{ <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(mf) } {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">if</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">constexpr</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">message_ownership_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">::unique == Actual_Ownership )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">message_holder_t</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">message_holder_t</span></span> &amp; ) = <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">message_holder_t</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">message_holder_t</span></span> &amp;&amp; ) <span class="hljs-keyword"><span class="hljs-keyword">noexcept</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">message_holder_t</span></span> &amp; <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>=( <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">message_holder_t</span></span> &amp; ) = <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">message_holder_t</span></span> &amp; <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>=( <span class="hljs-keyword"><span class="hljs-keyword">message_holder_t</span></span> &amp;&amp; ) <span class="hljs-keyword"><span class="hljs-keyword">noexcept</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">friend</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">swap</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">message_holder_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> &amp; a, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">message_holder_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> &amp; b )</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">noexcept</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::swap; swap( a.m_msg, b.m_msg ); } [[nodiscard]] <span class="hljs-function"><span class="hljs-function">getter_return_type * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">noexcept</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> get_const_ptr( m_msg ); } [[nodiscard]] getter_return_type &amp; <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span> * () <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">noexcept</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> *get(); } [[nodiscard]] getter_return_type * <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>-&gt;() <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">noexcept</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> get(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">if</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">constexpr</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">message_ownership_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">::shared == Actual_Ownership)</span></span></span><span class="hljs-function"> </span></span>{ [[nodiscard]] <span class="hljs-keyword"><span class="hljs-keyword">intrusive_ptr_t</span></span>&lt; envelope_type &gt; make_reference() <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">noexcept</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> m_msg; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { [[nodiscard]] <span class="hljs-keyword"><span class="hljs-keyword">intrusive_ptr_t</span></span>&lt; envelope_type &gt; make_reference() <span class="hljs-keyword"><span class="hljs-keyword">noexcept</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(m_msg) }; } } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> : <span class="hljs-keyword"><span class="hljs-keyword">intrusive_ptr_t</span></span>&lt; envelope_type &gt; m_msg; };</code> </pre> </div></div><br><p style=";text-align:right;direction:rtl">   ,     .       C++ :( <br> (  C++      ""   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="></a> ). </p><br><p style=";text-align:right;direction:rtl">  ,       ,             ++.   ,  ,  ,           .   ,        <code>message_holder_t</code> .         ,             ,      <code>if constexpr</code> . </p><br><h1 id="zaklyuchenie" style=";text-align:right;direction:rtl">  ุงุณุชูุชุงุฌ </h1><br><p style=";text-align:right;direction:rtl">   ,         C++. ,     .  ,    ,          . </p><br><p style=";text-align:right;direction:rtl">                ,           . </p><br><p style=";text-align:right;direction:rtl">   ,   ,   ++   ,   .      ,    . , ,            .  ,    .   C++98/03        ,     C++11       . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar449122/">https://habr.com/ru/post/ar449122/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar449110/index.html">ุชู ุฅุตูุงุญ ุงูุฎูู ุงููุชุนูู ุจุนุฏู ุงููุฏุฑุฉ ุนูู ุงุณุชุฎุฏุงู ุงูุฃุจุฌุฏูุฉ ุงูุณูุฑูููุฉ ูู ุฃุณูุงุก ูุฌูุฏุงุช IMAP</a></li>
<li><a href="../ar449112/index.html">ููุฏ ุชูุงุนุฏูุง - ููุงูุด ุงูุฃุฏูุงุช ุงูุตูุชูุฉ ุงูุดุงุฆุนุฉ ุฐุงุช ูุฑุฉ ูุงูุชู ุฃุตุจุญุช "ูุฏููุฉ"</a></li>
<li><a href="../ar449114/index.html">ุฑุฏ ุนูู daambda</a></li>
<li><a href="../ar449118/index.html">ุงููุฑูููู ุดูุทุงู ุญุจูุจ ููุน ุงูุญูู</a></li>
<li><a href="../ar449120/index.html">ูุน ูุญูุฉ ุ ูู ุงููุธุงุฑุงุช ุงูุฏุงููุฉ ููู ุงูููู ุงูุดุฎุตู: ููุงูู ุตุนุจุฉ ูุฑุคูุฉ ุงูููุจููุชุฑ</a></li>
<li><a href="../ar449124/index.html">ูู ุงูุตุนุจ ุงูุนุซูุฑ ุนูููุง ุ ูู ุงูุณูู ุฃู ุชููุช ุ ููู ุงููุณุชุญูู ุฅุตุฏุงุฑูุง</a></li>
<li><a href="../ar449128/index.html">ุฃูุถู ุดุฑูุงุช ุชุทููุฑ ุงูุฃูุนุงุจ ูู ุงูุนุงูู</a></li>
<li><a href="../ar449132/index.html">ุฃุนูู 17 ููุญูุงุช ู Android Studio</a></li>
<li><a href="../ar449134/index.html">ุญุฏููุฉ ุงูุญููุงูุงุช</a></li>
<li><a href="../ar449138/index.html">5 ุฃุณุจุงุจ ููุจุนุฉ ุงูุชุดููุฑ ููุงุฐุง ูุง ูุญุจ ุงููุงุณ ุชูููุฉ ุงูุจูุชูููู</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>