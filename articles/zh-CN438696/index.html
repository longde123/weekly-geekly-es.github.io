<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ§‘ğŸ¼ ğŸ”¯ â˜‘ï¸ Swiftç¼–è¯‘å™¨è®¾å¤‡ã€‚ ç¬¬ä¸‰éƒ¨åˆ† ğŸ‘©â€ğŸ‘©â€ğŸ‘¦ â™Šï¸ â˜ğŸ¾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="æˆ‘ä»¬ç»§ç»­ç ”ç©¶Swiftç¼–è¯‘å™¨ã€‚ æœ¬éƒ¨åˆ†ä¸“é—¨ä»‹ç»Swiftä¸­çº§è¯­è¨€ã€‚ 


 å¦‚æœæ‚¨æ²¡æœ‰çœ‹è¿‡ä»¥å‰çš„æ–‡ç« ï¼Œå»ºè®®æ‚¨ç‚¹å‡»é“¾æ¥é˜…è¯»ï¼š 


- ç»„ä»¶æ¦‚è¿° ã€‚ 
- è§£ææºæ–‡ä»¶ ã€‚ 
 è¥¿å°”æ ¹ 


 ä¸‹ä¸€æ­¥æ˜¯å°†ç±»å‹åŒ–çš„ASTè½¬æ¢ä¸ºåŸå§‹SILã€‚ Swiftä¸­é—´è¯­è¨€ï¼ˆSILï¼‰æ˜¯ä¸“é—¨ä¸ºSwiftåˆ›å»ºçš„ä¸­é—´è¡¨ç¤ºå½¢å¼ã€‚...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Swiftç¼–è¯‘å™¨è®¾å¤‡ã€‚ ç¬¬ä¸‰éƒ¨åˆ†</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/e-Legion/blog/438696/"><img src="https://habrastorage.org/webt/w6/d3/5f/w6d35fpnglkxq8suebz-fhsl2de.png"><br><p> æˆ‘ä»¬ç»§ç»­ç ”ç©¶Swiftç¼–è¯‘å™¨ã€‚ æœ¬éƒ¨åˆ†ä¸“é—¨ä»‹ç»Swiftä¸­çº§è¯­è¨€ã€‚ </p><br><p> å¦‚æœæ‚¨æ²¡æœ‰çœ‹è¿‡ä»¥å‰çš„æ–‡ç« ï¼Œå»ºè®®æ‚¨ç‚¹å‡»é“¾æ¥é˜…è¯»ï¼š </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç»„ä»¶æ¦‚è¿°</a> ã€‚ </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è§£ææºæ–‡ä»¶</a> ã€‚ <a name="habracut"></a></li></ul><br><h1 id="silgen"> è¥¿å°”æ ¹ </h1><br><p> ä¸‹ä¸€æ­¥æ˜¯å°†ç±»å‹åŒ–çš„ASTè½¬æ¢ä¸ºåŸå§‹SILã€‚  Swiftä¸­é—´è¯­è¨€ï¼ˆSILï¼‰æ˜¯ä¸“é—¨ä¸ºSwiftåˆ›å»ºçš„ä¸­é—´è¡¨ç¤ºå½¢å¼ã€‚ åœ¨<a href="">æ–‡æ¡£ä¸­</a>å¯ä»¥æ‰¾åˆ°æ‰€æœ‰è¯´æ˜çš„<a href="">è¯´æ˜</a> ã€‚ </p><br><p>  SILå…·æœ‰SSAè¡¨æ ¼ã€‚ é™æ€å•ä¸€åˆ†é…ï¼ˆSSAï¼‰-ä¸€ç§ä»£ç è¡¨ç¤ºï¼Œå…¶ä¸­æ¯ä¸ªå˜é‡ä»…åˆ†é…ä¸€æ¬¡å€¼ã€‚ å®ƒæ˜¯é€šè¿‡æ·»åŠ å…¶ä»–å˜é‡ä»å¸¸è§„ä»£ç åˆ›å»ºçš„ã€‚ ä¾‹å¦‚ï¼Œä½¿ç”¨æ•°å­—åç¼€è¡¨ç¤ºæ¯æ¬¡åˆ†é…åå˜é‡çš„ç‰ˆæœ¬ã€‚ </p><br><p> ç”±äºè¿™ç§å½¢å¼ï¼Œç¼–è¯‘å™¨æ›´å®¹æ˜“ä¼˜åŒ–ä»£ç ã€‚ ä¸‹é¢æ˜¯æœ‰å…³ä¼ªä»£ç çš„ç¤ºä¾‹ã€‚ æ˜¾ç„¶ï¼Œç¬¬ä¸€è¡Œæ˜¯ä¸å¿…è¦çš„ï¼š </p><br><pre><code class="plaintext hljs">a = 1 a = 2 b = a</code> </pre> <br><p> ä½†è¿™ä»…é€‚ç”¨äºæˆ‘ä»¬ã€‚ ä¸ºäº†æ•™å¯¼ç¼–è¯‘å™¨ç¡®å®šè¿™ä¸€ç‚¹ï¼Œå¿…é¡»ç¼–å†™éå¹³å‡¡çš„ç®—æ³•ã€‚ ä½†æ˜¯ä½¿ç”¨SSAï¼Œè¿™è¦å®¹æ˜“å¾—å¤šã€‚ ç°åœ¨ï¼Œå³ä½¿å¯¹äºç®€å•çš„ç¼–è¯‘å™¨ï¼Œå¾ˆæ˜æ˜¾ï¼Œ <strong>ä¹Ÿ</strong>ä¸ä¼šä½¿ç”¨å˜é‡<strong>a1</strong>çš„å€¼ï¼Œå¹¶ä¸”å¯ä»¥åˆ é™¤æ­¤è¡Œï¼š </p><br><pre> <code class="plaintext hljs">a1 = 1 a2 = 2 b1 = a2</code> </pre> <br><p>  SILå…è®¸æ‚¨å¯¹ASTé˜¶æ®µéš¾ä»¥å®Œæˆæˆ–æ— æ³•å®Œæˆçš„Swiftä»£ç è¿›è¡Œç‰¹å®šçš„ä¼˜åŒ–å’Œæ£€æŸ¥ã€‚ </p><br><h3 id="ispolzovanie-generatora-sil"> ä½¿ç”¨SIL Generator </h3><br><p> è¦ç”ŸæˆSILï¼Œè¯·ä½¿ç”¨<strong>-emit-silgenæ ‡å¿—</strong> ï¼š </p><br><pre> <code class="plaintext hljs">swiftc -emit-silgen main.swift</code> </pre> <br><p> å‘½ä»¤çš„ç»“æœï¼š </p><br><pre> <code class="plaintext hljs">sil_stage raw import Builtin import Swift import SwiftShims let x: Int // x sil_global hidden [let] @$S4main1xSivp : $Int // main sil @main : $@convention(c) (Int32, UnsafeMutablePointer&lt;Optional&lt;UnsafeMutablePointer&lt;Int8&gt;&gt;&gt;) -&gt; Int32 { bb0(%0 : $Int32, %1 : $UnsafeMutablePointer&lt;Optional&lt;UnsafeMutablePointer&lt;Int8&gt;&gt;&gt;): alloc_global @$S4main1xSivp // id: %2 %3 = global_addr @$S4main1xSivp : $*Int // user: %8 %4 = metatype $@thin Int.Type // user: %7 %5 = integer_literal $Builtin.Int2048, 16 // user: %7 // function_ref Int.init(_builtinIntegerLiteral:) %6 = function_ref @$SSi22_builtinIntegerLiteralSiBi2048__tcfC : $@convention(method) (Builtin.Int2048, @thin Int.Type) -&gt; Int // user: %7 %7 = apply %6(%5, %4) : $@convention(method) (Builtin.Int2048, @thin Int.Type) -&gt; Int // user: %8 store %7 to [trivial] %3 : $*Int // id: %8 %9 = integer_literal $Builtin.Int32, 0 // user: %10 %10 = struct $Int32 (%9 : $Builtin.Int32) // user: %11 return %10 : $Int32 // id: %11 } // end sil function 'main' // Int.init(_builtinIntegerLiteral:) sil [transparent] [serialized] @$SSi22_builtinIntegerLiteralSiBi2048__tcfC : $@convention(method) (Builtin.Int2048, @thin Int.Type) -&gt; Int</code> </pre> <br><p> åƒLLVM IRä¸€æ ·ï¼ŒSILå¯ä»¥ä½œä¸ºæºä»£ç è¾“å‡ºã€‚ æ‚¨å¯ä»¥åœ¨å…¶ä¸­æ‰¾åˆ°ï¼Œåœ¨æ­¤é˜¶æ®µæ·»åŠ äº†Swiftæ¨¡å—Builtinï¼ŒSwiftå’ŒSwiftShimsçš„å¯¼å…¥ã€‚ </p><br><p> å°½ç®¡æ‚¨å¯ä»¥åœ¨Swiftçš„å…¨å±€èŒƒå›´å†…ç›´æ¥ç¼–å†™ä»£ç ï¼Œä½†SILGenä»ä¼šç”Ÿæˆä¸»è¦å‡½æ•°ï¼Œå³ç¨‹åºçš„å…¥å£ç‚¹ã€‚ æ‰€æœ‰ä»£ç éƒ½ä½äºå…¶ä¸­ï¼Œé™¤äº†å£°æ˜å¸¸é‡å¤–ï¼Œå› ä¸ºå®ƒæ˜¯å…¨å±€çš„ï¼Œåº”è¯¥å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹è®¿é—®ã€‚ </p><br><p> å¤§å¤šæ•°çº¿å…·æœ‰ç›¸ä¼¼çš„ç»“æ„ã€‚ å·¦ä¾§æ˜¯ä¼ªå¯„å­˜å™¨ï¼Œç”¨äºä¿å­˜æŒ‡ä»¤ç»“æœã€‚ æ¥ä¸‹æ¥-æŒ‡ä»¤æœ¬èº«åŠå…¶å‚æ•°ï¼Œæœ€å-æ³¨é‡Šï¼ŒæŒ‡ç¤ºå°†ä½¿ç”¨è¯¥å¯„å­˜å™¨çš„å¯„å­˜å™¨ã€‚ </p><br><p> ä¾‹å¦‚ï¼Œåœ¨æ­¤è¡Œä¸Šåˆ›å»ºäº†ä¸€ä¸ªInt2048ç±»å‹çš„æ•´æ•°æ–‡å­—ï¼Œå€¼16ã€‚æ­¤æ–‡å­—å­˜å‚¨åœ¨ç¬¬äº”ä¸ªå¯„å­˜å™¨ä¸­ï¼Œå°†ç”¨äºè®¡ç®—ç¬¬ä¸ƒä¸ªçš„å€¼ï¼š </p><br><pre> <code class="plaintext hljs">%5 = integer_literal $Builtin.Int2048, 16 // user: %7</code> </pre> <br><p> å‡½æ•°å£°æ˜ä»¥å…³é”®å­—silå¼€å¤´ã€‚ ä»¥ä¸‹æ˜¯å¸¦æœ‰@å‰ç¼€çš„åç§°ï¼Œè°ƒç”¨çº¦å®šï¼Œå‚æ•°ï¼Œè¿”å›ç±»å‹å’ŒåŠŸèƒ½ä»£ç ã€‚ å¯¹äº<strong>Int.init</strong>åˆå§‹å€¼è®¾å®šé¡¹<strong>ï¼ˆ_builtinIntegerLiteral :)</strong> ï¼Œå½“ç„¶æ²¡æœ‰æŒ‡å®šï¼Œå› ä¸ºæ­¤å‡½æ•°æ¥è‡ªå¦ä¸€ä¸ªæ¨¡å—ï¼Œåªéœ€è¦å£°æ˜å³å¯ï¼Œä½†æ— éœ€å®šä¹‰ã€‚ ç¾å…ƒç¬¦å·è¡¨ç¤ºç±»å‹æŒ‡ç¤ºçš„å¼€å¤´ï¼š </p><br><pre> <code class="plaintext hljs">// Int.init(_builtinIntegerLiteral:) sil [transparent] [serialized] @$SSi22_builtinIntegerLiteralSiBi2048__tcfC : $@convention(method) (Builtin.Int2048, @thin Int.Type) -&gt; Int</code> </pre> <br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è°ƒç”¨çº¦å®š</a>è¡¨ç¤ºå¦‚ä½•æ­£ç¡®è°ƒç”¨å‡½æ•°ã€‚ è¿™æ˜¯ç”Ÿæˆæœºå™¨ä»£ç æ‰€å¿…éœ€çš„ã€‚ è¿™äº›åŸç†çš„è¯¦ç»†æè¿°è¶…å‡ºäº†æœ¬æ–‡çš„èŒƒå›´ã€‚ </p><br><p> åˆå§‹åŒ–ç¨‹åºçš„åç§°ä»¥åŠç»“æ„ï¼Œç±»ï¼Œæ–¹æ³•ï¼Œåè®®çš„åç§°éƒ½ä¼šå¤±çœŸï¼ˆåç§°é‡æ•´ï¼‰ã€‚ è¿™æ ·å¯ä»¥ç«‹å³è§£å†³å‡ ä¸ªé—®é¢˜ã€‚ </p><br><p> é¦–å…ˆï¼Œå®ƒå…è®¸åœ¨ä¸åŒçš„æ¨¡å—å’ŒåµŒå¥—å®ä½“ä¸­ä½¿ç”¨ç›¸åŒçš„åç§°ã€‚ ä¾‹å¦‚ï¼Œå¯¹äºç¬¬ä¸€ç§æ–¹æ³•<strong>fff</strong> ï¼Œä½¿ç”¨åç§°<strong>S4main3AAAV3fffSiyF</strong> ï¼Œå¯¹äºç¬¬äºŒç§æ–¹æ³•ï¼Œä½¿ç”¨<strong>S4main3BBBVVffffSiyF</strong> ï¼š </p><br><pre> <code class="plaintext hljs">struct AAA { func fff() -&gt; Int { return 8 } } struct BBB { func fff() -&gt; Int { return 8 } }</code> </pre> <br><p>  <strong>S</strong>è¡¨ç¤ºSwiftï¼Œ4æ˜¯æ¨¡å—åç§°ä¸­çš„å­—ç¬¦æ•°ï¼Œ3æ˜¯ç±»åç§°ã€‚ åœ¨æ–‡å­—åˆå§‹å€¼è®¾å®šé¡¹ä¸­ï¼Œ <strong>Si</strong>è¡¨ç¤ºæ ‡å‡†ç±»å‹Swift.Intã€‚ </p><br><p> å…¶æ¬¡ï¼Œå°†åç§°å’Œå‡½æ•°å‚æ•°çš„ç±»å‹æ·»åŠ åˆ°åç§°ä¸­ã€‚ è¿™å…è®¸ä½¿ç”¨é‡è½½ã€‚ ä¾‹å¦‚ï¼Œå¯¹äºç¬¬ä¸€ç§æ–¹æ³•ï¼Œ <strong>å°†</strong>ç”Ÿæˆ<strong>S4main3AAAV3fff3iiiS2i_tF</strong> ï¼Œå¯¹äºç¬¬äºŒç§æ–¹æ³•<strong>-S4main3AAAV3fff3dddSiSd_tF</strong> ï¼š </p><br><pre> <code class="plaintext hljs">struct AAA { func fff(iii internalName: Int) -&gt; Int { return 8 } func fff(ddd internalName: Double) -&gt; Int { return 8 } }</code> </pre> <br><p> åœ¨å‚æ•°åç§°ä¹‹åï¼Œå°†æŒ‡ç¤ºè¿”å›å€¼çš„ç±»å‹ï¼Œç„¶åæ˜¯å‚æ•°ç±»å‹ã€‚ ä½†æ˜¯ï¼Œæœªæ˜¾ç¤ºå…¶å†…éƒ¨åç§°ã€‚ ä¸å¹¸çš„æ˜¯ï¼Œåœ¨Swiftä¸­æ²¡æœ‰æœ‰å…³åç§°æ”¹å†™çš„æ–‡æ¡£ï¼Œå…¶å®ç°å¯èƒ½éšæ—¶æ›´æ”¹ã€‚ </p><br><p> å‡½æ•°åç§°åè·Ÿå…¶å®šä¹‰ã€‚ å®ƒç”±ä¸€ä¸ªæˆ–å¤šä¸ªåŸºæœ¬å—ç»„æˆã€‚ åŸºæœ¬å—æ˜¯å…·æœ‰ä¸€ä¸ªå…¥å£ç‚¹å’Œä¸€ä¸ªå‡ºå£ç‚¹çš„æŒ‡ä»¤åºåˆ—ï¼Œå…¶ä¸­ä¸åŒ…å«åˆ†æ”¯æŒ‡ä»¤æˆ–ææ—©é€€å‡ºçš„æ¡ä»¶ã€‚ </p><br><p>  mainå‡½æ•°å…·æœ‰ä¸€ä¸ªåŸºæœ¬å•å…ƒï¼Œè¯¥åŸºæœ¬å•å…ƒå°†ä¼ é€’ç»™è¯¥å‡½æ•°çš„æ‰€æœ‰å‚æ•°ä½œä¸ºè¾“å…¥å¹¶åŒ…å«å…¶æ‰€æœ‰ä»£ç ï¼Œå› ä¸ºå…¶ä¸­æ²¡æœ‰åˆ†æ”¯ï¼š </p><br><pre> <code class="plaintext hljs">bb0(%0 : $Int32, %1 : $UnsafeMutablePointer&lt;Optional&lt;UnsafeMutablePointer&lt;Int8&gt;&gt;&gt;):</code> </pre> <br><p> æˆ‘ä»¬å¯ä»¥å‡å®šï¼Œç”¨æ‹¬å·æ‹¬èµ·æ¥çš„æ¯ä¸ªåˆå¹¶èŒƒå›´éƒ½æ˜¯ä¸€ä¸ªå•ç‹¬çš„åŸºæœ¬å•ä½ã€‚ å‡è®¾ä»£ç åŒ…å«ä¸€ä¸ªåˆ†æ”¯ï¼š </p><br><pre> <code class="plaintext hljs">// before if 2 &gt; 5 { // true } else { // false } // after</code> </pre> <br><p> åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå°†è‡³å°‘ä¸ºä»¥ä¸‹ç”Ÿæˆ4ä¸ªåŸºæœ¬å—ï¼š </p><br><ul><li> åˆ†æ”¯ä¹‹å‰çš„ä»£ç ï¼Œ </li><li> è¡¨è¾¾å¼ä¸ºçœŸçš„æƒ…å†µ </li><li> è¡¨è¾¾å¼ä¸ºå‡çš„æƒ…å†µ </li><li> åˆ†æ”¯åçš„ä»£ç ã€‚ </li></ul><br><p>  <strong>cond_br-</strong>æ¡ä»¶è·³è½¬çš„æŒ‡ä»¤ã€‚ å¦‚æœä¼ªå¯„å­˜å™¨ï¼…14çš„å€¼ä¸ºçœŸï¼Œåˆ™<strong>æ‰§è¡Œ</strong>åˆ°å—<strong>bb1</strong>çš„è½¬æ¢ã€‚ å¦‚æœä¸æ˜¯ï¼Œåˆ™åœ¨<strong>bb2ä¸­</strong> ã€‚  br-æ— æ¡ä»¶è·³è½¬ï¼Œå¼€å§‹æ‰§è¡ŒæŒ‡å®šçš„åŸºæœ¬å—ï¼š </p><br><pre> <code class="plaintext hljs">// before cond_br %14, bb1, bb2 // id: %15 bb1: // true br bb3 // id: %21 bb2: // Preds: bb0 // false br bb3 // id: %27 bb3: // Preds: bb2 bb1 // after</code> </pre> <br><p> æºä»£ç ï¼š </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">SILGenå®æ–½æ–‡ä»¶</a> ï¼Œ </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">SILå¤´æ–‡ä»¶</a> ï¼Œ </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">SILå®æ–½æ–‡ä»¶</a> ï¼Œ </li><li>  <a href="">SILæ–‡æ¡£</a> ã€‚ </li></ul><br><h1 id="sil-guaranteed-transformations">  SILä¿è¯çš„è½¬æ¢ </h1><br><p> åˆ†æåœ¨æœ€åé˜¶æ®µè·å¾—çš„åŸå§‹ä¸­é—´è¡¨ç¤ºå½¢å¼çš„æ­£ç¡®æ€§ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºè§„èŒƒçš„ï¼šæ ‡è®°ä¸ºé€æ˜çš„å‡½æ•°æ˜¯<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å†…è”çš„</a> ï¼ˆå‡½æ•°è°ƒç”¨ç”±å…¶ä¸»ä½“æ›¿æ¢ï¼‰ï¼Œè®¡ç®—å¸¸é‡è¡¨è¾¾å¼çš„å€¼ï¼Œæ£€æŸ¥è¯¥å‡½æ•°ä»¥ç¡®ä¿è¿”å›å€¼çš„å‡½æ•°åœ¨æ‰€æœ‰ä»£ç åˆ†æ”¯ä¸­æ‰§è¡Œæ­¤æ“ä½œï¼Œä¾æ­¤ç±»æ¨ã€‚ </p><br><p> è¿™äº›è½¬æ¢æ˜¯å¼ºåˆ¶æ€§çš„ï¼Œå³ä½¿ç¦ç”¨ä»£ç ä¼˜åŒ–ä¹Ÿå¯ä»¥æ‰§è¡Œã€‚ </p><br><h3 id="generaciya-kanonichnogo-sil"> ä½³èƒ½SILä¸€ä»£ </h3><br><p> è¦ç”Ÿæˆè§„èŒƒçš„SILï¼Œè¯·ä½¿ç”¨<strong>-emit-sil</strong>æ ‡å¿—ï¼š </p><br><pre> <code class="plaintext hljs">swiftc -emit-sil main.swift</code> </pre> <br><p> å‘½ä»¤çš„ç»“æœï¼š </p><br><pre> <code class="plaintext hljs">sil_stage canonical import Builtin import Swift import SwiftShims let x: Int // x sil_global hidden [let] @$S4main1xSivp : $Int // main sil @main : $@convention(c) (Int32, UnsafeMutablePointer&lt;Optional&lt;UnsafeMutablePointer&lt;Int8&gt;&gt;&gt;) -&gt; Int32 { bb0(%0 : $Int32, %1 : $UnsafeMutablePointer&lt;Optional&lt;UnsafeMutablePointer&lt;Int8&gt;&gt;&gt;): alloc_global @$S4main1xSivp // id: %2 %3 = global_addr @$S4main1xSivp : $*Int // user: %6 %4 = integer_literal $Builtin.Int64, 16 // user: %5 %5 = struct $Int (%4 : $Builtin.Int64) // user: %6 store %5 to %3 : $*Int // id: %6 %7 = integer_literal $Builtin.Int32, 0 // user: %8 %8 = struct $Int32 (%7 : $Builtin.Int32) // user: %9 return %8 : $Int32 // id: %9 } // end sil function 'main' // Int.init(_builtinIntegerLiteral:) sil public_external [transparent] [serialized] @$SSi22_builtinIntegerLiteralSiBi2048__tcfC : $@convention(method) (Builtin.Int2048, @thin Int.Type) -&gt; Int { // %0 // user: %2 bb0(%0 : $Builtin.Int2048, %1 : $@thin Int.Type): %2 = builtin "s_to_s_checked_trunc_Int2048_Int64"(%0 : $Builtin.Int2048) : $(Builtin.Int64, Builtin.Int1) // user: %3 %3 = tuple_extract %2 : $(Builtin.Int64, Builtin.Int1), 0 // user: %4 %4 = struct $Int (%3 : $Builtin.Int64) // user: %5 return %4 : $Int // id: %5 } // end sil function '$SSi22_builtinIntegerLiteralSiBi2048__tcfC'</code> </pre> <br><p> åœ¨è¿™ä¸ªç®€å•çš„ç¤ºä¾‹ä¸­å‡ ä¹æ²¡æœ‰å˜åŒ–ã€‚ è¦æŸ¥çœ‹ä¼˜åŒ–å™¨çš„å®é™…å·¥ä½œï¼Œæ‚¨éœ€è¦ä½¿ä»£ç å¤æ‚ä¸€ç‚¹ã€‚ ä¾‹å¦‚ï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š </p><br><pre> <code class="plaintext hljs">let x = 16 + 8</code> </pre> <br><p> åœ¨ä»–çš„åŸå§‹SILä¸­ï¼Œæ‚¨å¯ä»¥æ‰¾åˆ°è¿™äº›æ–‡å­—çš„é™„åŠ å†…å®¹ï¼š </p><br><pre> <code class="plaintext hljs">%13 = function_ref @$SSi1poiyS2i_SitFZ : $@convention(method) (Int, Int, @thin Int.Type) -&gt; Int // user: %14 %14 = apply %13(%8, %12, %4) : $@convention(method) (Int, Int, @thin Int.Type) -&gt; Int // user: %15</code> </pre> <br><p> ä½†æ˜¯åœ¨è§„èŒƒä¸­ä¸å†å­˜åœ¨ã€‚ è€Œæ˜¯ä½¿ç”¨24çš„å¸¸æ•°ï¼š </p><br><pre> <code class="plaintext hljs">%4 = integer_literal $Builtin.Int64, 24 // user: %5</code> </pre> <br><p> æºä»£ç ï¼š </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">SILä¼˜åŒ–å™¨å¼ºåˆ¶æ€§</a> </li></ul><br><h1 id="sil-optimization">  Silä¼˜åŒ– </h1><br><p> å¦‚æœå¯ç”¨äº†ä¼˜åŒ–ï¼Œåˆ™ä¼šåº”ç”¨å…¶ä»–ç‰¹å®šäºSwiftçš„è½¬æ¢ã€‚ å…¶ä¸­åŒ…æ‹¬<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ³›å‹</a>çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä¸“ä¸šåŒ–</a> ï¼ˆé’ˆå¯¹ç‰¹å®šç±»å‹çš„å‚æ•°ä¼˜åŒ–æ³›å‹ä»£ç ï¼‰ï¼Œé<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è™šæ‹ŸåŒ–</a> ï¼ˆå°†åŠ¨æ€è°ƒç”¨æ›¿æ¢ä¸ºé™æ€è°ƒç”¨ï¼‰ï¼Œå†…è”ï¼Œ <a href="">ARCä¼˜åŒ–</a>ç­‰ç­‰ã€‚ å¯¹è¿™äº›æŠ€æœ¯çš„è¯´æ˜ä¸é€‚åˆå·²ç»è¿‡å¤šçš„æ–‡ç« ã€‚ </p><br><p> æºä»£ç ï¼š </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">SIL Optimizeræ ‡å¤´</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">SILä¼˜åŒ–å™¨å®æ–½æ–‡ä»¶</a> </li></ul><br><p> ç”±äºSILæ˜¯ä¸€ç§SwiftåŠŸèƒ½ï¼Œå› æ­¤æˆ‘è¿™æ¬¡æ²¡æœ‰æ˜¾ç¤ºå®ç°ç¤ºä¾‹ã€‚ åœ¨è¿›è¡ŒLLVM IRç”Ÿæˆæ—¶ï¼Œæˆ‘ä»¬å°†åœ¨ä¸‹ä¸€éƒ¨åˆ†è¿”å›åˆ°æ‹¬å·ç¼–è¯‘å™¨ã€‚ </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN438696/">https://habr.com/ru/post/zh-CN438696/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN438682/index.html">ä¼Šæœ—èˆªå¤©èˆªç©ºå‘¨å¹´åº†å…¸</a></li>
<li><a href="../zh-CN438688/index.html">PCIe 5.0æ€»çº¿å‡†å¤‡è°ƒè¯•</a></li>
<li><a href="../zh-CN438690/index.html">å¦‚æœPascalçš„CRTæ¨¡å—åœ¨JavaScriptä¸­</a></li>
<li><a href="../zh-CN438692/index.html">æƒ¯æ€§é£ç¢Ÿã€‚ æ¨å¼€ä¸€åˆ‡</a></li>
<li><a href="../zh-CN438694/index.html">è¿‡å»äºŒåå¹´æ¥ï¼Œç½‘ç«™æ”¯æŒæµç¨‹å‘ç”Ÿäº†æ€æ ·çš„å˜åŒ–</a></li>
<li><a href="../zh-CN438698/index.html">æ‚²å‰§ç³»ç»Ÿ</a></li>
<li><a href="../zh-CN438700/index.html">äº‹æ•…å›¾</a></li>
<li><a href="../zh-CN438708/index.html">ç¬¬350å·æœ€åä¸€å‘¨ï¼ˆ2019å¹´1æœˆ28æ—¥è‡³2æœˆ3æ—¥ï¼‰çš„å‰ç«¯ä¸–ç•Œæ‘˜è¦</a></li>
<li><a href="../zh-CN438710/index.html">å‰ç«¯æ¯å‘¨æ‘˜è¦ï¼ˆ2019å¹´1æœˆ28æ—¥è‡³2æœˆ3æ—¥ï¼‰</a></li>
<li><a href="../zh-CN438714/index.html">Veeamå¤‡ä»½å’Œå¤åˆ¶9.5 Update 4æ¦‚è¿°</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>