<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèª‚Äçüåæ üö¥ üç• Wi-Fi y muchas otras abreviaturas. C√≥mo obtener datos en nodos de Wi-Fi en una aplicaci√≥n de Android y no aumentar üõå üßëüèæ‚Äçü§ù‚Äçüßëüèª üòß</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Una vez que necesitaba escanear aplicaciones de red Wi-Fi de Android y obtener un c√°lculo detallado de datos sobre puntos de acceso. 

 Aqu√≠ tuve que ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Wi-Fi y muchas otras abreviaturas. C√≥mo obtener datos en nodos de Wi-Fi en una aplicaci√≥n de Android y no aumentar</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/467765/"> Una vez que necesitaba escanear aplicaciones de red Wi-Fi de Android y obtener un c√°lculo detallado de datos sobre puntos de acceso. <br><a name="habracut"></a><br>  Aqu√≠ tuve que enfrentar varias dificultades: en la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">falta de documentaci√≥n de Android,</a> muchas de las clases descritas quedaron en desuso (nivel API&gt; 26), lo que no se reflej√≥ en √©l;  la descripci√≥n de algunas cosas en la documentaci√≥n es m√≠nima (por ejemplo, el campo de capacidades de la clase <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ScanResult</a> en el momento de la escritura no se describi√≥ de ninguna manera, aunque contiene muchos datos importantes).  La tercera dificultad puede ser que cuando se acerque por primera vez a Wi-Fi, que es diferente de leer la teor√≠a y configurar el enrutador para localhost, debe lidiar con una serie de abreviaturas que parecen estar claras por separado.  Pero puede no ser obvio c√≥mo relacionarlos y estructurarlos (el juicio es subjetivo y depende de la experiencia previa). <br><br>  Este art√≠culo analiza c√≥mo obtener datos completos sobre entornos de Wi-Fi a partir del c√≥digo de Android sin NDK, hacks, pero solo usando la API de Android y comprende c√≥mo interpretarlos. <br><br>  No tiraremos y comenzaremos a escribir c√≥digo. <br><br><h3>  1. Crear un proyecto </h3><br>  La nota est√° dise√±ada para aquellos que han creado el proyecto de Android m√°s de una vez, por lo tanto, omitimos los detalles de este elemento.  El siguiente c√≥digo se presentar√° en el idioma Kotlin, minSdkVersion = 23. <br><br><h3>  2. Permisos de acceso </h3><br>  Para trabajar con Wi-Fi desde la aplicaci√≥n, deber√° obtener varios permisos del usuario.  De acuerdo con la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">documentaci√≥n</a> , para escanear la red en dispositivos con versiones de SO posteriores a 8.0, adem√°s del acceso para ver el estado del entorno de red, necesita acceso para cambiar el estado del m√≥dulo Wi-Fi del dispositivo o acceso a las coordenadas (aproximadas o exactas).  A partir de la versi√≥n 9.0, debe solicitar al usuario ambos y otros, y solicitar expl√≠citamente al usuario que habilite el servicio de ubicaci√≥n.  No olvides explicar valientemente al usuario que esto es un capricho de Google, y no nuestro deseo de espiarlo :) <br><br>  Total, en AndroidManifest.xml agregar: <br><br><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uses-permission</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.permission.ACCESS_NETWORK_STATE"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uses-permission</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.permission.ACCESS_WIFI_STATE"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uses-permission</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.permission.CHANGE_WIFI_STATE"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uses-permission</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.permission.ACCESS_FINE_LOCATION"</span></span></span><span class="hljs-tag">/&gt;</span></span></code> </pre> <br>  Y en el c√≥digo que tiene un enlace a la Actividad actual: <br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.app.Activity <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.content.Context <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.location.LocationManager <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> androidx.core.app.ActivityCompat .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (android.os.Build.VERSION.SDK_INT &gt;= android.os.Build.VERSION_CODES.O) { ActivityCompat.requestPermissions( activity, arrayOf(Manifest.permission.ACCESS_FINE_LOCATION, Manifest.permission.CHANGE_WIFI_STATE), <span class="hljs-number"><span class="hljs-number">1</span></span> ) makeEnableLocationServices(activity.applicationContext) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { ActivityCompat.requestPermissions( activity, arrayOf(Manifest.permission.CHANGE_WIFI_STATE), <span class="hljs-number"><span class="hljs-number">1</span></span> ) } <span class="hljs-comment"><span class="hljs-comment">/*        */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">makeEnableLocationServices</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(context: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Context</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-comment"><span class="hljs-comment">// </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment">       ,      val lm: LocationManager = context.applicationContext.getSystemService(Context.LOCATION_SERVICE) as LocationManager val gpsEnabled: Boolean = lm.isProviderEnabled(LocationManager.GPS_PROVIDER); val networkEnabled: Boolean = lm.isProviderEnabled(LocationManager.NETWORK_PROVIDER); if (!gpsEnabled &amp;&amp; !networkEnabled) { context.startActivity(Intent(ACTION_LOCATION_SOURCE_SETTINGS)); } }</span></span></code> </pre><br><h3>  3. Cree BroadcastReceiver y suscr√≠base para actualizar eventos al escanear el entorno de red Wi-Fi </h3><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> wifiManager = context.getSystemService(Context.WIFI_SERVICE) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> WifiManager <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> wifiScanReceiver = <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> : BroadcastReceiver() { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onReceive</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(context: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Context</span></span></span></span><span class="hljs-function"><span class="hljs-params">, intent: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Intent</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> success = intent.getBooleanExtra(WifiManager.EXTRA_RESULTS_UPDATED, <span class="hljs-literal"><span class="hljs-literal">false</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (success) { scanSuccess() } } } <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> intentFilter = IntentFilter() <span class="hljs-comment"><span class="hljs-comment">/*         */</span></span> intentFilter.addAction(WifiManager.SCAN_RESULTS_AVAILABLE_ACTION) context.registerReceiver(wifiScanReceiver, intentFilter) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> success = wifiManager.startScan() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!success) { <span class="hljs-comment"><span class="hljs-comment">/* -     ,    */</span></span> } .... <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scanSuccess</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-comment"><span class="hljs-comment">/*  ,   */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> results: List&lt;ScanResult&gt; = wifiManager.scanResults }</code> </pre><br>  El m√©todo WiFiManager.startScan en la documentaci√≥n est√° marcado como depricated de API versi√≥n 28, pero desactivado.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">gu√≠a</a> sugiere usarlo. <br><br>  En total, recibimos una lista de objetos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ScanResult</a> . <br><br><h3>  4. Observamos ScanResult y entendemos los t√©rminos </h3><br>  Veamos algunos campos de esta clase y describamos lo que significan: <br><br>  <b>SSID</b> : el Identificador de conjunto de servicios es el nombre de la red. <br><br>  <b>BSSID</b> - Identificador de conjunto de servicios b√°sicos - Direcci√≥n MAC del adaptador de red (punto Wi-Fi) <br><br>  <b>level</b> - Indicador de intensidad de la se√±al recibida [dBm (dBm ruso) - Decibel, potencia de referencia 1 mW.] - Indicador del nivel de la se√±al recibida.  Toma un valor de 0 a -100, cuanto m√°s lejos de 0, m√°s potencia de se√±al se pierde en el camino desde el punto de Wi-Fi a su dispositivo.  Se pueden encontrar m√°s detalles en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Wikipedia,</a> por ejemplo.  Aqu√≠ te dir√© que usando el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">WifiManager</a> clase Android <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">,</a> puedes calibrar el nivel de se√±al en una escala de excelente a terrible con el paso que seleccionaste: <br><br><pre> <code class="kotlin hljs"> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> wifiManager = context.applicationContext.getSystemService(Context.WIFI_SERVICE) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> WifiManager <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> numberOfLevels = <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> level = WifiManager.calculateSignalLevel(level, numberOfLevels)</code> </pre><br>  <b>frecuencia</b> : la frecuencia del punto de Wi-Fi [Hz].  Adem√°s de la frecuencia en s√≠, puede interesarle el llamado canal.  Cada punto tiene su propia limpieza de trabajo.  Al momento de escribir, el rango m√°s popular de puntos de Wi-Fi es 2.4 GHz.  Pero, para ser m√°s precisos, el punto transfiere informaci√≥n a su tel√©fono con una frecuencia numerada cercana a la mencionada.  El n√∫mero de canales y los valores de las frecuencias correspondientes est√°n <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">estandarizados</a> .  Esto se hace para que los puntos cercanos funcionen a diferentes frecuencias, por lo que no interfieren entre s√≠ y no reducen mutuamente la velocidad y la calidad de la transmisi√≥n.  Al mismo tiempo, los puntos no funcionan en la misma frecuencia, sino en el rango de frecuencia ( <b>par√°metro</b> channelWidth), llamado ancho del canal.  Es decir, los puntos que operan en canales vecinos (y no solo en canales vecinos, sino incluso en 3 de ellos mismos) crean interferencia entre s√≠.  Este c√≥digo simple puede ser √∫til para usted, que le permite calcular el n√∫mero de canal por el valor de frecuencia para puntos con una frecuencia de 2.4 y 5 Ghz: <br><br><pre> <code class="kotlin hljs"><span class="hljs-comment"><span class="hljs-comment">/*      */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> channel: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (frequency <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">2412</span></span>..<span class="hljs-number"><span class="hljs-number">2484</span></span>) { (frequency - <span class="hljs-number"><span class="hljs-number">2412</span></span>) / <span class="hljs-number"><span class="hljs-number">5</span></span> + <span class="hljs-number"><span class="hljs-number">1</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (frequency <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">5170</span></span>..<span class="hljs-number"><span class="hljs-number">5825</span></span>) { (frequency - <span class="hljs-number"><span class="hljs-number">5170</span></span>) / <span class="hljs-number"><span class="hljs-number">5</span></span> + <span class="hljs-number"><span class="hljs-number">34</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { -<span class="hljs-number"><span class="hljs-number">1</span></span> } }</code> </pre><br>  <b>Capacidades</b> es el campo m√°s interesante para el an√°lisis, con el que tom√≥ mucho tiempo trabajar.  Aqu√≠, las "capacidades" del punto se escriben en la l√≠nea.  En este caso, no se pueden buscar detalles de la interpretaci√≥n de la cadena en la documentaci√≥n.  Aqu√≠ hay algunos ejemplos de lo que podr√≠a estar en esta l√≠nea: <br><br><pre> <code class="bash hljs">[WPA-PSK-TKIP+CCMP][WPA2-PSK-TKIP+CCMP][WPS][ESS] [WPA2-PSK-CCMP][ESS] [WPA2-PSK-CCMP+TKIP][ESS] [WPA-PSK-CCMP+TKIP][WPA2-PSK-CCMP+TKIP][ESS] [ESS][WPS]</code> </pre><br><h3>  5. Comprender las abreviaturas y las capacidades de parsim </h3><br>  Vale la pena mencionar que las clases del paquete android.net.wifi. * Utiliza la utilidad de linux <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">wpa_supplicant</a> debajo del cap√≥, y la salida en el campo de capacidades es una copia del campo de banderas durante el escaneo. <br><br>  Actuaremos secuencialmente.  Primero, considere la salida de un formato en el que los elementos dentro de los corchetes est√°n separados por un signo "-": <br><br><pre> <code class="bash hljs">[WPA-PSK-TKIP+CCMP] [WPA2-PSK-CCMP]</code> </pre><br>  El primer valor describe el llamado  <b>m√©todo de autenticaci√≥n</b>  Es decir, qu√© secuencia de acciones debe realizar el dispositivo y el punto de acceso para que el punto de acceso se permita utilizar y c√≥mo cifrar la carga √∫til.  En el momento de escribir esta publicaci√≥n, las opciones m√°s comunes son WPA y WPA2, en las que cada dispositivo conectado directamente o mediante el llamado.  El servidor RADIUS (WPA-Enterprice) proporciona una contrase√±a a trav√©s de un canal encriptado.  Lo m√°s probable es que el punto de acceso en su hogar proporcione una conexi√≥n de acuerdo con este esquema.  La diferencia entre la segunda versi√≥n y la primera en un cifrado m√°s robusto: AES contra TKIP inseguro.  WPA3, que es m√°s complejo y avanzado, tambi√©n se est√° introduciendo gradualmente.  Te√≥ricamente, puede haber una opci√≥n con la soluci√≥n enterprice CCKM (Cisco Centralized Key Managment), pero nunca me he encontrado. <br><br>  El punto de acceso podr√≠a configurarse para la autenticaci√≥n por direcci√≥n MAC.  O, si el punto de acceso proporciona datos utilizando el algoritmo WEP desactualizado, entonces pr√°cticamente no hay autenticaci√≥n (la clave secreta aqu√≠ es la clave de cifrado).  Estas opciones se clasifican como OTRAS. <br>  Tambi√©n hay un m√©todo favorito en wi-fi p√∫blico con detecci√≥n de portal cautivo oculto: una solicitud de autenticaci√≥n a trav√©s de un navegador.  Dichos puntos de acceso parecen estar abiertos al esc√°ner (que son desde el punto de vista de la conexi√≥n f√≠sica).  Por lo tanto, los clasificamos como ABIERTOS. <br><br>  El segundo valor puede designarse como <b>el algoritmo de gesti√≥n de claves</b> .  Es un par√°metro del m√©todo de autenticaci√≥n descrito anteriormente.  Habla sobre c√≥mo ocurre exactamente el intercambio de claves de cifrado.  Consideremos las posibles opciones.  EAP: utilizado en el mencionado WPA-Enterprice, utiliza una base de datos para verificar los datos de autenticaci√≥n ingresados.  SAE: utilizado en WPA3 avanzado, m√°s resistente a la rotura.  PSK es la opci√≥n m√°s com√∫n, implica ingresar la contrase√±a y transmitirla en forma cifrada.  IEEE8021X: de acuerdo con el est√°ndar internacional (que no sea compatible con la familia WPA).  OWE (Cifrado inal√°mbrico oportunista) es una extensi√≥n del est√°ndar IEEE 802.11, para los puntos que clasificamos como ABIERTO.  OWE garantiza la seguridad de los datos transmitidos a trav√©s de una red insegura cifr√°ndolos.  Tambi√©n es posible una variante cuando no hay claves de acceso; llamemos a esta opci√≥n NINGUNO. <br><br>  El tercer par√°metro es el llamado  <b>m√©todo de cifrado (esquemas de cifrado)</b> : c√≥mo se usa exactamente el cifrado para proteger los datos transmitidos.  Enumeramos las opciones.  WEP: utiliza un cifrado de flujo RC4, la clave secreta es una clave de cifrado, que se considera inaceptable en el mundo de la criptograf√≠a moderna.  TKIP: utilizado en WPA, CKIP: en WPA2.  TKIP + CKIP: se puede especificar en puntos compatibles con WPA y WPA2 para compatibilidad con versiones anteriores. <br><br>  En lugar de tres elementos, puede encontrar una marca WEP solitaria: <br><br><pre> <code class="bash hljs">[WEP]</code> </pre><br>  Como discutimos anteriormente, esto es suficiente para no especificar el algoritmo para usar claves, que no est√° all√≠, y el m√©todo de cifrado, que es uno por defecto. <br><br>  Ahora considere este soporte: <br><br><pre> <code class="bash hljs">[ESS]</code> </pre><br>  Este es <b>el modo de operaci√≥n</b> <b>de Wi-Fi</b> o la <b>topolog√≠a de las redes Wi-Fi</b> .  Puede encontrar el modo BSS (Conjunto de servicios b√°sicos), cuando hay un punto de acceso a trav√©s del cual se comunican los dispositivos conectados.  Se puede encontrar en las redes locales.  Por lo general, se necesitan puntos de acceso para conectar dispositivos desde diferentes redes locales, por lo que forman parte de los conjuntos de servicios extendidos (ESS).  El tipo de IBSS (conjuntos de servicios b√°sicos independientes) indica que el dispositivo forma parte de una red punto a punto. <br><br>  La bandera WPS tambi√©n puede caer: <br><br><pre> <code class="bash hljs">[WPS]</code> </pre><br>  WPS (Configuraci√≥n protegida de Wi-Fi): un protocolo para la inicializaci√≥n semiautom√°tica de una red Wi-Fi.  Para inicializar, el usuario ingresa una contrase√±a de 8 caracteres o sujeta un bot√≥n en el enrutador.  Si su punto de acceso es del primer tipo y esta marca est√° resaltada frente al nombre de su punto de acceso, le recomendamos encarecidamente que vaya al panel de administraci√≥n y desactive el acceso a trav√©s de WPS.  El hecho es que, a menudo, la direcci√≥n MAC puede reconocer un PIN de 8 d√≠gitos, o resolverlo en el tiempo previsible, del que alguien inmundo puede aprovechar. <br><br><h3>  6. Crear un modelo y funci√≥n de an√°lisis </h3><br>  En base a lo que descubrimos anteriormente, describimos con clases de datos lo que sucedi√≥: <br><br><pre> <code class="kotlin hljs"><span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AuthMethod</span></span></span><span class="hljs-class"> </span></span>{ WPA3, WPA2, WPA, <span class="hljs-comment"><span class="hljs-comment">// Wi-Fi Protected Access OTHER, //    Shared Key Authentication  .  mac-address-based  WEP CCKM, // Cisco OPEN // Open Authentication.     Captive Portal Detection -     } /*    */ enum class KeyManagementAlgorithm { IEEE8021X, //   EAP, // Extensible Authentication Protocol,    PSK, // Pre-Shared Key ‚Äî         WEP, //  WEP     (No auth key) SAE, // Simultaneous Authentication of Equals -    WPA3 OWE, // Opportunistic Wireless Encryption -    ,    OPEN NONE //      OPEN, OTHER } /*   */ enum class CipherMethod { WEP, // Wired Equivalent Privacy,       TKIP, // Temporal Key Integrity Protocol CCMP, // Counter Mode with Cipher Block Chaining Message Authentication Code Protocol, //              //   AES NONE //      OPEN, OTHER } /*     ,      */ data class Capability( var authScheme: AuthMethod? = null, var keyManagementAlgorithm: KeyManagementAlgorithm? = null, var cipherMethod: CipherMethod? = null ) /*   WiFi (   WiFi) */ enum class TopologyMode { IBSS, //   (Ad-Hoc  IBSS ‚Äì Independent Basic Service Set). BSS, //    Basic Service Set (BSS)  Infrastructure Mode. ESS //    ESS ‚Äì Extended Service Set. }</span></span></code> </pre><br>  Ahora escribiremos una funci√≥n que analizar√° el campo de capacidades: <br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parseCapabilities</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(capabilitiesString: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: List &lt; Capability &gt; { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> capabilities: List &lt; Capability &gt; = capabilitiesString .splitByBrackets() .filter { !it.isTopology() &amp;&amp; !it.isWps() } .flatMap { parseCapability(it) } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!capabilities.isEmpty()) { capabilities } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { listOf(Capability(AuthMethod.OPEN, KeyManagementAlgorithm.NONE, CipherMethod.NONE)) } } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parseCapability</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(part: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: List &lt; Capability &gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (part.contains(<span class="hljs-string"><span class="hljs-string">"WEP"</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> listOf(Capability( AuthMethod.OTHER, KeyManagementAlgorithm.WEP, CipherMethod.WEP )) } <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> authScheme = <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> { part.contains(<span class="hljs-string"><span class="hljs-string">"WPA3"</span></span>) - &gt; AuthMethod.WPA3 part.contains(<span class="hljs-string"><span class="hljs-string">"WPA2"</span></span>) - &gt; AuthMethod.WPA2 part.contains(<span class="hljs-string"><span class="hljs-string">"WPA"</span></span>) - &gt; AuthMethod.WPA <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> - &gt; <span class="hljs-literal"><span class="hljs-literal">null</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> keyManagementAlgorithm = <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> { part.contains(<span class="hljs-string"><span class="hljs-string">"OWE"</span></span>) - &gt; KeyManagementAlgorithm.OWE part.contains(<span class="hljs-string"><span class="hljs-string">"SAE"</span></span>) - &gt; KeyManagementAlgorithm.SAE part.contains(<span class="hljs-string"><span class="hljs-string">"IEEE802.1X"</span></span>) - &gt; KeyManagementAlgorithm.IEEE8021X part.contains(<span class="hljs-string"><span class="hljs-string">"EAP"</span></span>) - &gt; KeyManagementAlgorithm.EAP part.contains(<span class="hljs-string"><span class="hljs-string">"PSK"</span></span>) - &gt; KeyManagementAlgorithm.PSK <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> - &gt; <span class="hljs-literal"><span class="hljs-literal">null</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> capabilities = ArrayList &lt; Capability &gt; () <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (part.contains(<span class="hljs-string"><span class="hljs-string">"TKIP"</span></span>) || part.contains(<span class="hljs-string"><span class="hljs-string">"CCMP"</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (part.contains(<span class="hljs-string"><span class="hljs-string">"TKIP"</span></span>)) { capabilities.add(Capability( authScheme ? : AuthMethod.OPEN, keyManagementAlgorithm ? : KeyManagementAlgorithm.NONE, CipherMethod.TKIP )) } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (part.contains(<span class="hljs-string"><span class="hljs-string">"CCMP"</span></span>)) { capabilities.add(Capability( authScheme ? : AuthMethod.OPEN, keyManagementAlgorithm ? : KeyManagementAlgorithm.NONE, CipherMethod.CCMP )) } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (authScheme != <span class="hljs-literal"><span class="hljs-literal">null</span></span> || keyManagementAlgorithm != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { capabilities.add(Capability( authScheme ? : AuthMethod.OPEN, keyManagementAlgorithm ? : KeyManagementAlgorithm.NONE, CipherMethod.NONE )) } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> capabilities } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parseTopologyMode</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(capabilitiesString: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: TopologyMode ? { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> capabilitiesString .splitByBrackets() .mapNotNull { <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> { it.contains(<span class="hljs-string"><span class="hljs-string">"ESS"</span></span>) - &gt; TopologyMode.ESS it.contains(<span class="hljs-string"><span class="hljs-string">"BSS"</span></span>) - &gt; TopologyMode.BSS it.contains(<span class="hljs-string"><span class="hljs-string">"IBSS"</span></span>) - &gt; TopologyMode.IBSS <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> - &gt; <span class="hljs-literal"><span class="hljs-literal">null</span></span> } } .firstOrNull() } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parseWPSAvailable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(capabilitiesString: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> capabilitiesString .splitByBrackets() .any { it.isWps() } } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> String.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">splitByBrackets</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: List &lt; String &gt; { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> m = Pattern.compile(<span class="hljs-string"><span class="hljs-string">"\\[(.*?)\\]"</span></span>).matcher(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> parts = ArrayList &lt; String &gt; () <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (m.find()) { parts.add(m.group().replace(<span class="hljs-string"><span class="hljs-string">"["</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>).replace(<span class="hljs-string"><span class="hljs-string">"]"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>)) } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> parts } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> String.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isTopology</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> TopologyMode.values().any { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> == it.name } } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> String.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isWps</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> == <span class="hljs-string"><span class="hljs-string">"WPS"</span></span> }</code> </pre><br><h3>  8. Nos fijamos en el resultado </h3><br>  Escanear√© la red y mostrar√© lo que sucedi√≥.  Mostrando los resultados de salida simple a trav√©s de Log.d: <br><br><pre> <code class="plaintext hljs">Capability of Home-Home [WPA2-PSK-CCMP][ESS][WPS] ... capabilities=[Capability(authScheme=WPA2, keyManagementAlgorithm=PSK, cipherMethod=CCMP)], topologyMode=ESS, availableWps=true</code> </pre><br>  La cuesti√≥n de conectarse a la red desde el c√≥digo de la aplicaci√≥n permaneci√≥ sin iluminar.  Solo puedo decir que para leer las contrase√±as guardadas del sistema operativo de un dispositivo m√≥vil, necesita derechos de root y estar dispuesto a hurgar en el sistema de archivos para leer wpa_supplicant.conf.  Si la l√≥gica de la aplicaci√≥n implica ingresar una contrase√±a desde afuera, la conexi√≥n se puede hacer a trav√©s de la clase <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">android.net.wifi.WifiManager</a> . <br><br>  Gracias a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Egor Ponomarev</a> por valiosas adiciones. <br><br>  Si cree que necesita agregar o arreglar algo, escriba los comentarios :) </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/467765/">https://habr.com/ru/post/467765/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../467753/index.html">R√©cord mundial de transmisi√≥n inal√°mbrica de datos: 40 Gb / s por 11 kil√≥metros</a></li>
<li><a href="../467755/index.html">Priones, calcio, microbiota, hormonas alimentarias y Alzheimer.</a></li>
<li><a href="../467759/index.html">Dise√±o de sistema operativo tipo Unix: espacio de direcciones virtuales (6)</a></li>
<li><a href="../467761/index.html">Energ√≠a, calor y agua, tercera parte: ve a la radio</a></li>
<li><a href="../467763/index.html">Toda la verdad sobre RTOS. Art√≠culo # 33. Uso del sistema operativo Nucleus SE en tiempo real</a></li>
<li><a href="../467769/index.html">En un √∫nico recurso de informaci√≥n federal que contiene informaci√≥n de poblaci√≥n</a></li>
<li><a href="../467771/index.html">Al igual que un autocargador junior verde, escribi√≥ su <s> caliente </s>. Parte 2. CSS</a></li>
<li><a href="../467775/index.html">5 mitos sobre los negocios: por qu√© el cliente est√° equivocado y c√≥mo superar a Apple</a></li>
<li><a href="../467779/index.html">Acerca de Godot, GLSL y WebGL, sombreadores utilizados en el minijuego</a></li>
<li><a href="../467781/index.html">Curso C ++ en CS centre, primera parte</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>