<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🙋🏾 🧖🏿 👩🏻‍🤝‍👨🏾 Datenerfassungssystem bei ESP. Teil II LifeOfFlowers 🕐 👐 ▫️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Guten Tag! Es ist also Zeit für den zweiten Artikel zum Thema ESP. Ich erzähle Ihnen von einem Gerät, mit dem Sie Informationen über das Mikroklima um...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Datenerfassungssystem bei ESP. Teil II LifeOfFlowers</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/411537/"><img src="https://habrastorage.org/webt/qo/wp/op/qowpopqxtr-by19k-5rlx5qs7we.jpeg"><br><br>  Guten Tag!  Es ist also Zeit für den zweiten Artikel zum Thema ESP.  Ich erzähle Ihnen von einem Gerät, mit dem Sie Informationen über das Mikroklima um Ihre Blumen erhalten können (wenn Sie diese natürlich haben) und Benachrichtigungen erhalten, dass etwas ihr Leben bedroht. <br><a name="habracut"></a><br>  <b>Wofür?</b> <br><br>  Meine Frau gießt ungefähr einmal pro Woche Blumen.  Er betrachtet den Boden in Töpfen, sieht oder fühlt, dass es Zeit für Blumen ist, sich zu erfrischen und zu wässern.  Die Blumen, die wir haben, sind unterschiedlich, aber wie sich herausstellte, trocknen sie ungefähr zur gleichen Zeit aus.  Ein großer Topf ist eine große Blume, ein kleiner Topf ist eine kleine Blume, die Bedeutung ist klar.  Alles wäre gut, wenn ich für die Sommersaison nicht ein paar Monate allein zu Hause bleiben und nicht vergessen würde, die Blumen zu gießen.  Bei der Ankunft Ende August holt eine Frau mit einem traurigen Gesicht trockene Stecklinge aus mehreren Töpfen. <br><br>  Es war ein leichter Exkurs, jetzt über die Entscheidung.  Für eine Fensterbank benötigen wir 1-2 Geräte, um Messungen in Töpfen unterschiedlicher Größe durchzuführen.  Das erste, was kontrolliert werden muss, ist die Feuchtigkeit des Bodens, was unsere Blumen zerstört (wir werden uns nicht mit PH und dem Rest der unverständlichen Floristik befassen, wir sind nicht dazu in der Lage).  Zusätzlich zur Luftfeuchtigkeit haben wir uns nach einiger Überlegung entschlossen, die Beleuchtung zu messen, um den Einfluss des Tageslichts auf Pflanzen, die Temperatur und die Luftfeuchtigkeit der Umgebung zu verfolgen - danach. <br><br>  Natürlich haben Ingenieure aus dem Reich der Mitte versucht, Geräte herzustellen, die quietschen und twittern können, wenn die Erde in einem Topf trocknet, aber ich möchte trotzdem mein eigenes Gerät mit eigenen Brötchen haben, zumal die Kosten für das Gerät nicht so hoch sind. <br><br>  <b>Hardware-Implementierung und Jobbeschreibung</b> <br><br>  Der wichtigste Punkt ist die Autonomie des Geräts und die Langlebigkeit seiner Arbeit (natürlich nicht auf Kosten der Qualität der Messungen).  Basierend auf demselben ESP-12E mit einem ADC-Kanal an Bord.  Die Steuerung (Modul, wenn Sie möchten) verfügt über mehrere Betriebsarten und dementsprechend über den Verbrauch: <br><br>  Ausschalten - 0,5 uA; <br>  Tiefschlaf - 10uA; <br>  Leichter Schlaf - 0,5 mA; <br>  Modemschlaf - 15mA; <br>  Im Datenübertragungsmodus bis zu 170 mA (Daten variieren in einigen Quellen sogar bis zu 215 mA). <br><br>  Für unsere Anforderungen sind drei Modi erforderlich: Tiefschlaf, Modemschlaf und Übertragungsmodus.  Da alles so gut ist, werden wir zwei AAA-Batterien für die Stromversorgung verwenden. <br><br>  Die Beleuchtung wird mit einem BPW17N-Fototransistor, Feuchtigkeit und Umgebungstemperatur AM2302, Bodenfeuchtigkeit mit einer speziell verdünnten Elektrode auf der Platte unter Lack gemessen.  Da wir Batterien haben, werden wir deren Spannung messen.  Verwenden Sie dazu den Multiplexer CD74HC4051M96, um dies alles mit einem ADC zu tun.  Auf dem ESP-12E ADC können Sie eine Spannung von bis zu 1 V liefern. Wir setzen überall Teiler ein. <br><br>  In der folgenden Abbildung gibt es viele Dinge zum Verspotten (einschließlich eines VT3-Transistors auf der gelöteten Platine, und die letzte Platine ist noch nicht fertig). <br><br><img src="https://habrastorage.org/webt/ve/eg/yv/veegyvyagiw2qld1y9xzkls5uh8.jpeg"><br>  <i>Gerätediagramm</i> <br><br>  Zwei Batterien erzeugen eine Spannung von 3-3,3 V, der Multiplexer arbeitet im Bereich von 2 V bis 6 V.  AM2302 arbeitet im Bereich von 3,3-5,5 V.  ESP-12E benötigt eine Spannung von 2,3 V oder mehr.  All dies wird durch Tests überprüft und mit Datenblättern überprüft.  Es wird klar, dass der AM2302 fast sofort nicht mehr funktioniert oder gar nicht mehr funktioniert. Deshalb machen wir einen „Hack“ und setzen den Kondensator Buck-Boost TPS60240DGKR ein.  Dies löst ein weiteres ernstes Problem, da bei Spannungsabfall die gemessenen Parameter schweben (Beleuchtung und Bodenfeuchtigkeit) und die Werte der ADC-Messungen unter Berücksichtigung der Spannung angepasst werden mussten, was zu Fehlern führte. <br><br>  So stellt sich Folgendes heraus: Der Multiplexer wird von den Füßen des ESP aus angetrieben und gesteuert (er wird direkt von Batterien gespeist), AM2302, die Teiler von Licht und Bodenfeuchtigkeit werden mit Buck-Boost von 3,3 V gespeist, das wiederum vom ESP-Fuß gesteuert wird.  Es schwingt die Spannung von 1,8 V auf 3,3 V. <br><br>  <b>Bodenfeuchtemessung</b> <br><br>  Ich habe beschlossen, diesem Wert einen separaten Unterabschnitt zuzuweisen.  Die erste Version des Geräts hatte blanke Elektroden (nicht mit Lack beschichtet) und dort war alles einfach. Legen Sie Spannung an eine Elektrode an - entfernen Sie sie von der zweiten.  Je höher die Luftfeuchtigkeit, desto höher ist die Spannung am ADC. <br><br><img src="https://habrastorage.org/webt/5n/i6/3d/5ni63dgxpdhfflvjxq6mbn_a1ww.jpeg"><br>  <i>Abb. 1. Die Versionen der Elektroden auf den Platinen.</i> <br><br>  Alles wäre in Ordnung, aber selbst verzinnte Elektroden neigen zu Korrosion und sehen in der Tat nicht ästhetisch ansprechend aus.  Daher wurde die folgende Schaltung geboren (wurde geläppt): PWM mit IO15 wird einer der „Elektroden“ zugeführt, und der Wert „begradigt“ und geglättet wird daraus abgelesen.  Es stellt sich heraus, dass das Signal den ADC umso kleiner erreicht, je höher die Bodenfeuchtigkeit ist, je schwächer das Signal ist. <br><br><img src="https://habrastorage.org/webt/-z/bc/lh/-zbclhcx1gen-s4waxp3igijzrc.png"><br>  <i>Abb. 2. Das Schema zum Ablesen der Bodenfeuchtigkeit.</i> <br><br>  <b>Testen und arbeiten</b> <br><br>  Ich werde sofort klarstellen, dass lange Tests fortgesetzt werden und schnelle Tests Folgendes zeigten: Das Gerät funktionierte vier Tage lang (lassen Sie sich nicht enttäuschen).  Die Messungen wurden 1 Mal pro Minute (!!!) durchgeführt, wobei alle Daten an den Server gesendet wurden (es werden ungefähr 5700 Messungen erhalten).  Tiefschlaf ist 50s von dieser Minute.  Die Betriebszeit im Modem-Ruhemodus beträgt einige Sekunden (Messungen werden von den Sensoren vorgenommen), dann einige Sekunden im Datenübertragungsmodus (Tests ergaben einen Verbrauch von etwa 50 mA).  Zeitintervalle sind weiterhin anpassbar.  Weitere Informationen zur Betriebszeit in verschiedenen Modi finden Sie unter dem Link <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> und dementsprechend finden Sie die Quelle auf dem Git <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> . <br><br>  Während wir planen, alle 2 Stunden mit einer kleinen Anzahl von Messungen nachts Messungen durchzuführen, wird Schätzungen zufolge mehr als ein Jahr Arbeit geleistet.  Die Berechnungen werden aus den Ergebnissen extrapoliert, aber wie Sie wissen, hat die Entladung von Batterien eine nichtlineare Form, sodass lange Tests zeigen, was und wie. <br><br><img src="https://habrastorage.org/webt/nf/_p/9-/nf_p9-97ycd-l7s4jdyvwqgr1le.jpeg"><br>  <i>Abb. 3. Diagramme der gesendeten Parameter.</i> <br><br>  Es gibt vier Parameter in einem Diagramm - es ist nicht sehr bequem anzusehen, aber dafür ist es informativ.  Ein Misserfolg ist das Ersetzen von Batterien und das Gießen einer Blume.  Zwei Spitzen sind Beleuchtung.  Mit Blau füllen ist die Feuchtigkeit des Bodens.  Bisher wurden keine Glättungen und Filter angewendet, da die Tests noch nicht abgeschlossen sind und ich mir die Rohdaten ansehen möchte.  In den erweiterten Diagrammen können Sie sehen, wie der Boden benetzt wird, dann stabilisiert sich die Feuchtigkeit und es findet eine langsame Trocknung statt.  Wir haben noch nicht entschieden, ob es sich lohnt, den Überlauf der Anlage irgendwie zu berücksichtigen oder dem „Bewässerungsgerät“ zu überlassen. <br><br><img src="https://habrastorage.org/webt/sr/kf/a0/srkfa0wjng1k3nrlt7izr7uwvoo.jpeg"><br>  <i>Abb. 4. Foto des Geräts in einem Topf.</i> <br><br><img src="https://habrastorage.org/webt/rl/w6/9v/rlw69vvwutein--y4dk0s_rivxw.jpeg"><br>  <i>Abbildung 5. Foto des Geräts von der Batterieseite</i> <br><br>  Auf dem Layout werden Schrauben verwendet, um das Batteriefach und den Feuchtigkeitssensor zu befestigen. Wenn alles debuggt ist, werden wir Nieten installieren, wie zum Beispiel: <br><br><img src="https://habrastorage.org/webt/cb/h4/c0/cbh4c0pjnp54rhwlgiu9nhfovzi.jpeg"><br>  <i>Abb. 6. Foto von Nieten.</i> <br><br>  <b>Gehäuse</b> <br><br>  Alles ist einfach - es gibt noch keinen Fall und vielleicht im Prinzip auch nicht.  Wir werden mit einem speziellen Lack darauf abdecken und loslegen. <br><br>  <b>Umsatzkosten</b> <br><br>  ESP-12E - 120p; <br>  CD74HC4051M96 - 14p; <br>  TPS60240DGKR - 180r; <br>  BPW17N - 21p; <br>  AM2302 - 130 reiben; <br>  KLS5-818-B - 15p; <br>  BC817 - 3p; <br>  BAT54JFILM - 3p; <br>  Passiv und Knopf - 20r; <br><br>  LED, Hochtöner und Transistor steuern beim Werfen. <br><br>  Ohne Berücksichtigung der Leiterplatte und der Baugruppe werden etwa 500 Rubel erhalten. <br><br>  Sagen wir also akzeptabel.  Wenn Sie solche Geräte zu 10 Stück herstellen, kostet das Drucken und Zusammenbauen natürlich einen erheblichen Teil der Kosten, und das Gerät wird sich als teuer herausstellen. Bisher verfolgen wir jedoch nicht den Preis, sondern stellen keine 100.000 Stück her, sondern genießen einfach den Prozess. <br><br>  <b>Pläne</b> <br><br>  Wie bereits erwähnt, ist im ersten Artikel geplant, eine Sensorfamilie in eine Anwendung zu integrieren.  Derzeit gibt es vier Geräte: <br><br>  1. OpenWindAir.  Kohlendioxidsensor. <br>  2. LifeOfFlowers.  Bodenfeuchtigkeits- und Mikroklimasensor für Pflanzen. <br>  3. WarningWater.  Lecksensor. <br>  4. AirWick_ESP.  Konfigurator für AirWick-Lufterfrischer.  Das ist wahrscheinlich noch mehr zum Spaß, dachte ich zuerst.  Warum nicht? <br><br>  Ich habe noch nichts über dieses Gerät geschrieben.  Ich hatte so ein Gerät zu Hause herumliegen: <br><br><img src="https://habrastorage.org/webt/zn/zq/l7/znzql72zs0uggyfr1yd_o0kdoye.jpeg"><br>  <i>Abbildung 7. Foto von AirWick.</i> <br><br>  Und ich wollte wirklich, dass es nach einem Zeitplan funktioniert, den ich selbst festlegen kann.  Tagsüber zum Beispiel nur beim Besuch der Toilette, nachts, um überhaupt zu schlafen, es sei denn, ich habe am Morgen vor dem Aufwachen „gepustet“.  Ich habe sogar ein Board auf dem STM32F100 erstellt, aber etwas hat nicht funktioniert.  Während alles debuggte, Schwellenwerte und die Häufigkeit des Betriebs änderten, steckte alles noch in den Kinderschuhen.  Und dann kam eine Idee auf, und warum nicht Parameter über das Telefon einstellen, insbesondere wenn diese Schnittstelle bereits getestet wurde: <br><br>  - die Anzahl der Operationen nach dem Ausschalten des Lichts (abhängig von der Besuchszeit); <br>  - die Anzahl der Operationen in der Nacht (Betriebsverbot bei eingeschaltetem Licht); <br>  - Ausschalten des Geräts (z. B. im Urlaub); <br>  - Berechnen Sie natürlich, wie oft wir auf die Toilette gehen und wie viel Zeit wir dort verbringen)))).  Wenn das Licht eingeschaltet ist, schaltet sich das Radio ein und der Besuch kann sich verzögern. <br><br>  Ja - das ist ein Überschuss, sagen Sie, einmal gestimmt und vergessen, aber unsere Hände sind nicht für Langeweile, und deshalb wurde eine Gebühr erhoben, über die ich später sprechen werde. <br><br>  In der Anwendung für verschiedene Geräte können Sie Registerkarten mit der Anzeige von Daten und Grafiken erstellen, die sich auf ein bestimmtes Gerät beziehen. <br><br><img src="https://habrastorage.org/webt/sa/qj/tz/saqjtzfval1qzjdnnnmctjnhqgg.jpeg"><br>  <i>Abbildung 8. Foto der Anwendung mit mehreren Registerkarten.</i> <br><br>  PS: Links zu Artikeln zum gleichen Thema: <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Datenerfassungssystem bei ESP.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Teil I. CO2</a> <br><br>  Vielen Dank für Ihre Aufmerksamkeit! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de411537/">https://habr.com/ru/post/de411537/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de411525/index.html">Wie Musik die Intelligenz beeinflusst: populäre Mythen und wissenschaftliche Hypothesen</a></li>
<li><a href="../de411527/index.html">Fragen Sie Ethan: Ein Überschuss an Positronen - lohnt es sich, dunkle Materie der Lösung aller Geheimnisse der Astrophysik zuzuschreiben?</a></li>
<li><a href="../de411529/index.html">Britischen Humor verstehen: Features und Beispiele</a></li>
<li><a href="../de411531/index.html">China hat Tests von Robomobilen im ganzen Land erlaubt</a></li>
<li><a href="../de411533/index.html">Vom Sturm bis zum Mond. Teil 1. Die ersten Computer</a></li>
<li><a href="../de411539/index.html">Messenger der staatlichen Firma "Crimean Technologies" hackte in drei Minuten</a></li>
<li><a href="../de411541/index.html">Evolution rettet Tiere vor Katastrophen der Kill Winner</a></li>
<li><a href="../de411545/index.html">E-Books und ihre Formate: DjVu - Geschichte, Vor- und Nachteile sowie Funktionen</a></li>
<li><a href="../de411547/index.html">Sony Xperia XZ2 und Xperia XZ2 Compact sind führend in der Benchmark-Akkulaufzeit</a></li>
<li><a href="../de411549/index.html">Heute wird die NASA ein neues Gerät für die Suche nach Exoplaneten auf den Markt bringen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>