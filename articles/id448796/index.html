<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ§ ğŸš· ğŸ‘©ğŸ½â€ğŸ¤â€ğŸ‘©ğŸ¼ Pengujian Python dengan pytest. Konfigurasi, BAB 6 ğŸƒ ğŸ‘©ğŸ¿ ğŸ¤°ğŸ¾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Kembali Selanjutnya 


 Dalam bab ini, kita akan melihat file-file konfigurasi yang memengaruhi pytest, membahas bagaimana pytest mengubah perilakunya...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Pengujian Python dengan pytest. Konfigurasi, BAB 6</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/448796/"><p><img src="https://habrastorage.org/webt/jl/jn/bb/jljnbbjr-ejh473xy_eccsmknpk.png">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Kembali</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Selanjutnya</a> <img src="https://habrastorage.org/webt/rw/dy/-g/rwdy-grsvbpcetjttrmecdkxtlk.png"></p><br><p>  <em>Dalam bab ini, kita akan melihat file-file konfigurasi yang memengaruhi pytest, membahas bagaimana pytest mengubah perilakunya berdasarkan pada mereka, dan membuat beberapa perubahan pada tugas-tugas konfigurasi proyek Tugas.</em> </p><br><p><img src="https://habrastorage.org/webt/hd/--/9w/hd--9w134j0rxhmxftrflbbdopy.png"></p><a name="habracut"></a><br><p>  Contoh-contoh dalam buku ini ditulis menggunakan Python 3.6 dan pytest 3.2.  pytest 3.2 mendukung Python 2.6, 2.7, dan Python 3.3+. </p><br><blockquote> Kode sumber untuk proyek Tugas, serta untuk semua tes yang ditunjukkan dalam buku ini, tersedia di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" title="https://pragprog.com/titles/bopytest/source_code">tautan</a> di halaman web buku di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" title="https://pragprog.com/titles/bopytest">pragprog.com</a> .  Anda tidak perlu mengunduh kode sumber untuk memahami kode uji;  kode uji disajikan dalam bentuk yang mudah dalam contoh.  Tetapi untuk mengikuti tugas-tugas proyek, atau mengadaptasi contoh uji untuk menguji proyek Anda sendiri (tangan Anda tidak terikat!), Anda harus pergi ke halaman web buku dan mengunduh karya.  Di sana, di halaman web buku, ada tautan untuk pesan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" title="https://pragprog.com/titles/bopytest/errata">errata</a> dan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" title="https://forums.pragprog.com/forums/438">forum diskusi</a> . </blockquote><p>  Di bawah spoiler adalah daftar artikel dalam seri ini. </p><br><div class="spoiler">  <b class="spoiler_title">Daftar isi</b> <div class="spoiler_text"><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><strong>Pendahuluan</strong></a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><strong>Bab 1: memulai dengan pytest</strong></a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><strong>Bab 2: Fungsi Tes Penulisan</strong></a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><strong>Bab 3: Jadwal Pytest</strong></a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><strong>Bab 4: Perlengkapan yang Terpasang</strong></a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><strong>Bab 5: Plugin</strong></a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><strong>Bab 6: Konfigurasi</strong></a> (Artikel ini) </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><strong>Bab 7: Menggunakan pytest dengan alat lain</strong></a> </li></ul></div></div><br><h2 id="konfiguraciya">  Konfigurasi </h2><br><p>  Sejauh ini dalam buku ini saya telah berbicara tentang berbagai file non-tes yang mempengaruhi pytest terutama secara sepintas, dengan pengecualian conftest.py, yang saya bahas secara rinci dalam Bab 5, Plugin, di halaman 95. Dalam bab ini kita akan melihat file konfigurasi, yang mempengaruhi pytest, diskusikan bagaimana pytest mengubah perilakunya berdasarkan pada mereka, dan membuat beberapa perubahan pada file konfigurasi proyek Tugas. </p><br><h2 id="ponimanie-faylov-konfiguracii-pytest">  Memahami file konfigurasi pytest </h2><br><p>  Sebelum saya memberi tahu Anda bagaimana Anda dapat mengubah perilaku default di pytest, mari kita membahas semua file non-tes di pytest dan, khususnya, siapa yang harus mengurusnya. </p><br><p>  Anda harus tahu yang berikut: </p><br><ul><li> <em>pytest.ini</em> : Ini adalah file konfigurasi Pytest utama yang memungkinkan Anda untuk mengubah perilaku default.  Karena Anda dapat membuat beberapa perubahan konfigurasi, sebagian besar bab ini dikhususkan untuk pengaturan yang dapat Anda buat di <code>pytest.ini</code> . </li><li>  <em>conftest.py</em> : Ini adalah plugin lokal yang memungkinkan fungsi dan perlengkapan hook terhubung ke direktori di mana file <code>conftest.py</code> dan semua subdirektori.  File <code>conftest.py</code> dijelaskan dalam bab 5 â€œPluginâ€ di halaman 95. </li><li>  <em><code>__init__.py</code></em> : Ketika ditempatkan di setiap subdirektori tes, file ini memungkinkan Anda untuk memiliki nama file tes yang identik di beberapa direktori tes.  Kita akan melihat contoh apa yang akan salah tanpa file <code>__init__.py</code> di direktori pengujian dalam artikel â€œMenghindari Tabrakan Nama Fileâ€ di halaman 120. </li></ul><br><p>  Jika Anda menggunakan racun, Anda akan tertarik pada: </p><br><ul><li>  <em>tox.ini</em> : File ini mirip dengan <code>pytest.ini</code> , tetapi untuk <code>tox</code> .  Namun, Anda dapat meletakkan konfigurasi <code>pytest</code> Anda di <code>pytest</code> alih-alih memiliki file <code>tox.ini</code> dan file <code>pytest.ini</code> , menghemat satu file konfigurasi.  Tox dibahas dalam bab 7, â€œMenggunakan pytest dengan alat lain,â€ di halaman 125. </li></ul><br><p>  Jika Anda ingin mendistribusikan paket Python (mis. Tugas), file ini akan menarik: </p><br><ul><li>  <em>setup.cfg</em> : Ini juga merupakan file INI yang memengaruhi perilaku <code>setup.py</code> .  Anda dapat menambahkan beberapa baris ke <code>setup.py</code> untuk menjalankan <code>python setup.py test</code> dan menjalankan semua tes pytest Anda.  Jika Anda mendistribusikan paket, Anda mungkin sudah memiliki file <code>setup.cfg</code> dan Anda dapat menggunakan file ini untuk menyimpan konfigurasi Pytest.  Anda akan melihat bagaimana hal ini dilakukan dalam Lampiran 4, â€œPengemasan dan Distribusi Proyek Python,â€ di halaman 175. </li></ul><br><p>  Tidak peduli file apa yang Anda masukkan konfigurasi pytest, formatnya pada dasarnya akan sama. </p><br><p>  Untuk <code>pytest.ini</code> : </p><br><blockquote>  <strong>ch6 / format / pytest.ini</strong> </blockquote><br><pre> <code class="plaintext hljs">[pytest] addopts = -rsxX -l --tb=short --strict xfail_strict = true ... more options ...</code> </pre> <br><p>  Untuk <code>tox.ini</code> : </p><br><blockquote>  <strong>ch6 / format / tox.ini</strong> </blockquote><br><pre> <code class="plaintext hljs">... tox specific stuff ... [pytest] addopts = -rsxX -l --tb=short --strict xfail_strict = true ... more options ...</code> </pre> <br><p>  Untuk <code>setup.cfg</code> : </p><br><blockquote>  <strong>ch6 / format / setup.cfg</strong> </blockquote><br><pre> <code class="plaintext hljs">... packaging specific stuff ... [tool:pytest] addopts = -rsxX -l --tb=short --strict xfail_strict = true ... more options ...</code> </pre> <br><p>  Satu-satunya perbedaan adalah bahwa header bagian untuk setup.cfg adalah <code>[tool:pytest]</code> bukan <code>[pytest]</code> . </p><br><h3 id="list-the-valid-ini-file-options-with-pytest-help">  Daftar Opsi file inisial yang valid dengan pytest â€“help </h3><br><p>  Anda bisa mendapatkan daftar semua parameter yang valid untuk <code>pytest.ini</code> dari <code>pytest --help</code> : </p><br><pre> <code class="plaintext hljs">$ pytest --help ... [pytest] ini-options in the first pytest.ini|tox.ini|setup.cfg file found: markers (linelist) markers for test functions empty_parameter_set_mark (string) default marker for empty parametersets norecursedirs (args) directory patterns to avoid for recursion testpaths (args) directories to search for tests when no files or directories are given in the command line. console_output_style (string) console output: classic or with additional progress information (classic|progress). usefixtures (args) list of default fixtures to be used with this project python_files (args) glob-style file patterns for Python test module discovery python_classes (args) prefixes or glob names for Python test class discovery python_functions (args) prefixes or glob names for Python test function and method discovery xfail_strict (bool) default for the strict parameter of xfail markers when not given explicitly (default: False) junit_suite_name (string) Test suite name for JUnit report junit_logging (string) Write captured log messages to JUnit report: one of no|system-out|system-err doctest_optionflags (args) option flags for doctests doctest_encoding (string) encoding used for doctest files cache_dir (string) cache directory path. filterwarnings (linelist) Each line specifies a pattern for warnings.filterwarnings. Processed after -W and --pythonwarnings. log_print (bool) default value for --no-print-logs log_level (string) default value for --log-level log_format (string) default value for --log-format log_date_format (string) default value for --log-date-format log_cli (bool) enable log display during test run (also known as "live logging"). log_cli_level (string) default value for --log-cli-level log_cli_format (string) default value for --log-cli-format log_cli_date_format (string) default value for --log-cli-date-format log_file (string) default value for --log-file log_file_level (string) default value for --log-file-level log_file_format (string) default value for --log-file-format log_file_date_format (string) default value for --log-file-date-format addopts (args) extra command line options minversion (string) minimally required pytest version xvfb_width (string) Width of the Xvfb display xvfb_height (string) Height of the Xvfb display xvfb_colordepth (string) Color depth of the Xvfb display xvfb_args (args) Additional arguments for Xvfb xvfb_xauth (bool) Generate an Xauthority token for Xvfb. Needs xauth. ...</code> </pre> <br><p>  Anda akan melihat semua pengaturan ini dalam bab ini, dengan pengecualian <code>doctest_optionflags</code> , yang dibahas dalam Bab 7, â€œMenggunakan pytest dengan alat lain,â€ di halaman 125. </p><br><h3 id="plaginy-mogut-dobavlyat-opcii-ini-faylov">  Plugin dapat menambahkan opsi file ini </h3><br><p>  Daftar pengaturan sebelumnya tidak konstan.  Untuk plugin (dan file conftest.py) dimungkinkan untuk menambahkan opsi file ini.  Opsi yang ditambahkan juga akan ditambahkan ke output dari perintah pytest --help. <br>  Sekarang mari kita lihat beberapa perubahan konfigurasi yang bisa kita lakukan menggunakan pengaturan bawaan file .ini yang tersedia di core pytest. </p><br><h3 id="izmenenie-parametrov-komandnoy-stroki-po-umolchaniyu">  Ubah opsi baris perintah default </h3><br><p>  Anda telah menggunakan beberapa opsi baris perintah untuk <em>pytest</em> , seperti <code>-v/--verbose</code> untuk verbose output <code>-l/--showlocals</code> untuk melihat variabel lokal dengan jejak stack untuk pengujian yang gagal.  Anda mungkin menemukan bahwa Anda selalu menggunakan beberapa <code>optionsâ€”or</code> ini <code>optionsâ€”or</code> dan lebih suka menggunakannya <code>themâ€”for a project</code> .  Jika Anda menginstal <code>addopts</code> di <code>pytest.ini</code> untuk parameter yang Anda butuhkan, maka Anda tidak perlu lagi memasukkannya.  Ini adalah set yang saya sukai: </p><br><pre> <code class="plaintext hljs">[pytest] addopts = -rsxX -l --tb=short --strict</code> </pre> <br><p>  <code>-rsxX</code> memungkinkan pytest untuk melaporkan alasan semua tes yang <code>skipped</code> , <code>xfailed</code> atau <code>xpassed</code> .  Switch <code>-l</code> memungkinkan pytest untuk menampilkan jejak stack untuk variabel lokal jika terjadi kegagalan.  <code>--tb=short</code> akan menghapus sebagian besar jejak tumpukan.  Namun, itu akan meninggalkan file dan nomor baris.  <code>--strict</code> melarang penggunaan token jika tidak terdaftar dalam file konfigurasi.  Anda akan melihat bagaimana melakukan ini di bagian selanjutnya. </p><br><h3 id="registraciya-markerov-chtoby-izbezhat-opechatok-markera">  Pendaftaran marker untuk menghindari kesalahan ketik marker </h3><br><p>  Marker khusus, seperti yang dijelaskan dalam â€œFungsi Pelabelan Tesâ€ pada halaman 31, sangat bagus untuk memungkinkan Anda menandai subset pengujian untuk dijalankan dengan spidol tertentu.  Namun, terlalu mudah untuk membuat kesalahan pada marker dan akhirnya beberapa tes ditandai <code>@pytest.mark.smoke</code> dan beberapa lainnya ditandai <code>@pytest.mark.somke</code> .  Secara default, ini bukan kesalahan.  pytest hanya berpikir Anda membuat dua spidol.  Namun, ini dapat diperbaiki dengan mendaftarkan token di pytest.ini, misalnya seperti ini: </p><br><pre> <code class="plaintext hljs">[pytest] ... markers = smoke: Run the smoke test test functions get: Run the test functions that test tasks.get() ...</code> </pre> <br><p>  Dengan mendaftarkan penanda ini, Anda sekarang juga dapat melihatnya dengan <code>pytest --markers</code> dengan deskripsi mereka: </p><br><pre> <code class="plaintext hljs">$ cd /path/to/code/ch6/b/tasks_proj/tests $ pytest --markers @pytest.mark.smoke: Run the smoke test test functions @pytest.mark.get: Run the test functions that test tasks.get() @pytest.mark.skip(reason=None): skip the ... ...</code> </pre> <br><p>  Jika penanda tidak terdaftar, mereka tidak akan muncul di daftar - <code>--markers</code> .  Ketika mereka terdaftar, mereka ditampilkan dalam daftar, dan jika Anda menggunakan <code>--strict</code> , token dengan kesalahan atau tidak terdaftar ditampilkan sebagai kesalahan.  Satu-satunya perbedaan antara <code>ch6/a/tasks_proj</code> dan <code>ch6/b/tasks_proj</code> adalah isi dari file pytest.ini.  Di <code>ch6/a</code> kosong.  Mari kita coba menjalankan tes tanpa mendaftarkan penanda apa pun: </p><br><pre> <code class="plaintext hljs">$ cd /path/to/code/ch6/a/tasks_proj/tests $ pytest --strict --tb=line ============================= test session starts ============================= collected 45 items / 2 errors =================================== ERRORS ==================================== ______________________ ERROR collecting func/test_add.py ______________________ 'smoke' not a registered marker ________________ ERROR collecting func/test_api_exceptions.py _________________ 'smoke' not a registered marker !!!!!!!!!!!!!!!!!!! Interrupted: 2 errors during collection !!!!!!!!!!!!!!!!!!! =========================== 2 error in 1.10 seconds ===========================</code> </pre> <br><p>  Jika Anda menggunakan marker di <code>pytest.ini</code> untuk mendaftarkan marker Anda, Anda bisa menambahkan <code>--strict</code> ke <code>addopts</code> Anda saat Anda menggunakannya.  Anda akan berterima kasih kepada saya nanti.  Mari kita lanjutkan dan menambahkan file pytest.ini ke proyek tugas: </p><br><p>  Jika Anda menggunakan marker di <code>pytest.ini</code> untuk mendaftarkan marker Anda, Anda juga dapat menambahkan <code>--strict</code> ke <code>addopts</code> Anda.  Anda akan berterima kasih kepada saya nanti.  Mari kita lanjutkan dan tambahkan file pytest.ini ke proyek tugas: </p><br><p>  Jika Anda menggunakan token di <code>pytest.ini</code> untuk mendaftarkan token, Anda juga bisa menambahkan <code>--strict</code> ke yang sudah ada dengan <code>addopts</code> .  Keren ?!  <code>pytest.ini</code> terima kasih dan tambahkan file <code>pytest.ini</code> ke proyek <code>tasks</code> : </p><br><blockquote>  ch6 / b / task_proj / tes / pytest.ini </blockquote><br><pre> <code class="plaintext hljs">[pytest] addopts = -rsxX -l --tb=short --strict markers = smoke: Run the smoke test test functions get: Run the test functions that test tasks.get()</code> </pre> <br><p>  Berikut adalah kombinasi dari flag yang dipilih secara default: </p><br><ul><li>  <code>-rsxX</code> untuk <code>-rsxX</code> tes mana yang dilewati, xfailed, atau xpassed, </li><li>  <code>--tb = short</code> untuk jejak yang lebih pendek pada kegagalan, </li><li>  <code>--strict</code> untuk mengizinkan token yang dideklarasikan saja. <br>  Dan daftar spidol untuk proyek tersebut. </li></ul><br><p>  Ini harus memungkinkan kami melakukan tes, termasuk tes asap: </p><br><pre> <code class="plaintext hljs">$ cd /path/to/code/ch6/b/tasks_proj/tests $ pytest --strict -m smoke ===================== test session starts ====================== collected 57 items func/test_add.py . func/test_api_exceptions.py .. ===================== 54 tests deselected ====================== =========== 3 passed, 54 deselected in 0.06 seconds ============</code> </pre> <br><h3 id="trebovanie-minimalnoy-versii-pytest">  Persyaratan Pytest Minimum </h3><br><p>  Parameter <code>minversion</code> memungkinkan <code>minversion</code> menentukan versi pytest minimum yang diharapkan untuk pengujian.  Misalnya, saya bermaksud menggunakan <code>approx()</code> ketika menguji angka floating-point untuk menentukan kesetaraan "cukup dekat" dalam pengujian.  Tetapi fungsi ini tidak diperkenalkan di pytest sampai versi 3.0.  Untuk menghindari kebingungan, saya menambahkan yang berikut ke proyek yang menggunakan <code>approx()</code> : </p><br><pre> <code class="plaintext hljs">[pytest] minversion = 3.0</code> </pre> <br><p>  Dengan demikian, jika seseorang mencoba menjalankan tes menggunakan versi pytest yang lebih lama, pesan kesalahan akan muncul. </p><br><h3 id="ostanovka-pytest-ot-poiska-v-nepravilnyh-mestah">  Hentikan pytest dari pencarian di tempat yang salah </h3><br><p>  Tahukah Anda bahwa salah satu definisi "berulang" adalah bersumpah dua kali dalam kode Anda sendiri?  Ya tidak.  Bahkan, ini berarti akuntansi untuk subdirektori.  pytest akan memungkinkan deteksi uji dengan secara rekursif memeriksa banyak direktori.  Tetapi ada beberapa direktori yang ingin Anda kecualikan dari melihat pytest. </p><br><p>  Nilai default untuk <code>norecurse</code> adalah <code>'. * Build dist CVS _darcs {arch} and *.egg. Having '.*'</code> <code>'. * Build dist CVS _darcs {arch} and *.egg. Having '.*'</code>  <code>'. * Build dist CVS _darcs {arch} and *.egg. Having '.*'</code> Adalah alasan yang bagus untuk memberi nama lingkungan virtual Anda '.venv', karena semua direktori yang dimulai dengan titik tidak akan terlihat. </p><br><p>  Dalam kasus proyek Tugas, <code>src</code> tidak ada salahnya untuk menentukan, karena mencari dalam file uji menggunakan pytest akan membuang-buang waktu. </p><br><pre> <code class="plaintext hljs">[pytest] norecursedirs = .* venv src *.egg dist build</code> </pre> <br><p>  Ketika mengganti parameter yang sudah memiliki nilai berguna, seperti parameter ini, akan berguna untuk mengetahui apa nilai defaultnya dan mengembalikan yang Anda butuhkan, seperti yang saya lakukan pada kode sebelumnya dengan <code>*.egg dist build</code> . <br>  <code>norecursedirs</code> adalah semacam konsekuensi untuk jalur uji, jadi mari kita lihat ini nanti. </p><br><h3 id="specifikaciya-dereva-testovogo-kataloga">  spesifikasi pohon direktori pengujian </h3><br><p>  Sementara <code>norecursedirs</code> memberitahu pytest ke mana harus mencari, <code>testpaths</code> memberitahu pytest ke mana harus mencari.  <code>testspaths</code> adalah daftar direktori yang relatif terhadap direktori root untuk menemukan tes.  Ini digunakan hanya jika direktori, file atau <code>nodeid</code> tidak ditentukan sebagai argumen. </p><br><p>  Misalkan untuk proyek <code>Tasks</code> kita meletakkan <code>pytest.ini</code> di direktori <code>tasks_proj</code> alih-alih tes: </p><br><pre> <code class="plaintext hljs">\code\tasks_proj&gt;tree/f . â”‚ pytest.ini â”‚ â”œâ”€â”€â”€src â”‚ â””â”€â”€â”€tasks â”‚ api.py â”‚ ... â”‚ â””â”€â”€â”€tests â”‚ conftest.py â”‚ pytest.ini â”‚ â”œâ”€â”€â”€func â”‚ test_add.py â”‚ ... â”‚ â”œâ”€â”€â”€unit â”‚ test_task.py â”‚ __init__.py â”‚ ...</code> </pre> <br><p>  Maka mungkin masuk akal untuk menempatkan tes di <code>testpaths</code> : </p><br><pre> <code class="plaintext hljs">[pytest] testpaths = tests</code> </pre> <br><p>  Sekarang, jika Anda menjalankan pytest dari direktori task_proj, pytest hanya akan mencari di <code>tasks_proj/tests</code> .  Masalahnya di sini adalah bahwa selama pengembangan dan debugging tes, saya sering melakukan iterate pada direktori tes, jadi saya dapat dengan mudah menguji subdirektori atau file tanpa menentukan keseluruhan path.  Oleh karena itu, opsi ini sedikit membantu saya dalam pengujian interaktif. </p><br><p>  Namun, ini bagus untuk pengujian yang dijalankan dari server integrasi berkelanjutan atau racun.  Dalam kasus ini, Anda tahu bahwa direktori root akan diperbaiki, dan Anda bisa daftar direktori relatif terhadap direktori root tetap.  Ini juga merupakan kasus ketika Anda benar-benar ingin mengurangi waktu pengujian, sehingga menyingkirkan pencarian untuk tes sangat bagus. </p><br><p>  Pada pandangan pertama, mungkin terlihat konyol untuk menggunakan jalur uji dan <code>norecursedirs</code> bersamaan.  Namun, seperti yang telah Anda lihat, jalur uji membantu sedikit dalam pengujian interaktif dari berbagai bagian sistem file.  Dalam kasus ini, <code>norecursedirs</code> dapat membantu.  Selain itu, jika Anda memiliki direktori pengujian yang tidak mengandung tes, Anda dapat menggunakan <code>norecursedirs</code> untuk menghindarinya.  Tetapi sebenarnya, apa gunanya menempatkan direktori tambahan dalam tes yang tidak memiliki tes? </p><br><h2 id="izmenenie-pravil-obnaruzheniya-testov">  Mengubah Aturan Deteksi Tes </h2><br><p>  pytest menemukan tes untuk dijalankan berdasarkan aturan penemuan tes khusus.  Aturan deteksi uji standar: </p><br><p>  â€¢ Mulai dengan satu atau lebih direktori.  Anda dapat menentukan nama file atau direktori pada baris perintah.  Jika Anda tidak menentukan apa pun, direktori saat ini digunakan. <br>  â€¢ Cari katalog dan semua subdirektori untuk modul uji. <br>  â€¢ Modul uji adalah file dengan nama yang mirip dengan <code>test_*.py</code> atau <code>*_test.py</code> . <br>  â€¢ Lihat di modul tes untuk fungsi-fungsi yang dimulai dengan tes <em>.</em> <em><br></em>  <em>â€¢ Cari kelas yang dimulai dengan Tes.</em>  <em>Cari metode di kelas yang dimulai dengan `test</em> <code>,    </code> <strong>init`</strong> . </p><br><p>  Ini adalah aturan deteksi standar;  Namun, Anda dapat mengubahnya. </p><br><h3 id="python_classes">  python_classes </h3><br><p>  Aturan umum untuk menemukan tes untuk pytest dan kelas adalah untuk mempertimbangkan kelas sebagai kelas tes potensial jika dimulai dengan <code>Test*</code> .  Kelas juga tidak dapat memiliki metode <code>__init__()</code> .  Tetapi bagaimana jika kita ingin menamai kelas tes kami sebagai <code>&lt;something&gt;Test</code> atau <code>&lt;something&gt;Suite</code> ?  Di sinilah <code>python_classes</code> masuk: </p><br><pre> <code class="plaintext hljs">[pytest] python_classes = *Test Test* *Suite</code> </pre> <br><p>  Ini memungkinkan kita untuk memberi nama kelas-kelas seperti ini: </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DeleteSuite</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">()</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_delete_1</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_delete_2</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> ... ....</code> </pre> <br><h3 id="python_files">  python_files </h3><br><p>  Seperti <code>pytest_classes</code> , <code>python_files</code> memodifikasi aturan deteksi uji default, yang terdiri dari menemukan file yang dimulai dengan <code>test_*</code> atau memiliki <code>*_test</code> di akhir. <br>  Misalkan Anda memiliki kerangka kerja pengujian khusus di mana Anda memberi nama semua file pengujian Anda <code>check_&lt;something&gt;.py</code> .  Tampaknya masuk akal.  Alih-alih mengganti nama semua file Anda, tambahkan saja baris ke <code>pytest.ini</code> sebagai berikut: </p><br><pre> <code class="plaintext hljs">[pytest] python_files = test_* *_test check_*</code> </pre> <br><p>  Sangat sederhana.  Sekarang Anda dapat secara bertahap mentransfer konvensi penamaan jika Anda mau, atau biarkan saja sebagai <code>check_*</code> . </p><br><h3 id="python_functions">  fungsi python_ </h3><br><p>  <code>python_functions</code> bertindak seperti dua pengaturan sebelumnya, tetapi untuk fungsi uji dan nama metode.  Nilai standarnya adalah <code>test_*</code> .  Dan untuk menambahkan <code>check_*</code> menebaknya - lakukan ini: </p><br><pre> <code class="plaintext hljs">[pytest] python_functions = test_* check_*</code> </pre> <br><p>  <code>pytest</code> penamaan terbaik tampaknya tidak begitu membatasi, bukan?  Jadi, jika Anda tidak menyukai konvensi penamaan default, ubah saja.  Meskipun demikian, saya mendorong Anda untuk memiliki alasan yang lebih kuat untuk keputusan semacam itu.  Bermigrasi ratusan file uji jelas merupakan alasan yang bagus. </p><br><h2 id="zapret-xpass">  Larangan XPASS </h2><br><p>  Pengaturan <code>xfail_strict = true</code> berarti tes yang ditandai dengan <code>@pytest.mark.xfail</code> tidak dikenali sebagai penyebab kesalahan.  Saya pikir pengaturan ini harus selalu demikian.  Untuk informasi lebih lanjut tentang token <code>xfail</code> lihat â€œMenandai tes yang menunggu kegagalanâ€ pada halaman 37. </p><br><h2 id="predotvraschenie-konfliktov-imen-faylov">  Cegah Konflik Nama File </h2><br><p>  Kegunaan memiliki file <code>__init__.py</code> di setiap subdirektori uji proyek membingungkan saya untuk waktu yang lama.  Namun, perbedaan antara memiliki atau tidak memilikinya adalah sederhana.  Jika Anda memiliki file <code>__init__.py</code> di semua subdirektori pengujian, Anda dapat memiliki nama file pengujian yang sama di banyak direktori.  Dan jika tidak, maka ini tidak akan berhasil. </p><br><p>  Berikut ini sebuah contoh.  Direktori <code>a</code> dan <code>b</code> keduanya memiliki file <code>test_foo.py</code> .  Tidak peduli apa isi file-file ini, tetapi untuk contoh ini mereka terlihat seperti ini: </p><br><blockquote>  <strong>ch6 / dups / a / test_foo.py</strong> <br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_a</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span></code> </pre> <br><br>  <strong>ch6 / dups / b / test_foo.py</strong> <br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_b</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span></code> </pre> <br></blockquote><p>  Dengan struktur direktori ini: </p><br><pre> <code class="plaintext hljs">dups â”œâ”€â”€ a â”‚ â””â”€â”€ test_foo.py â””â”€â”€ b â””â”€â”€ test_foo.py</code> </pre> <br><p>  File-file ini bahkan tidak memiliki konten yang sama, tetapi tes rusak.  Anda akan dapat menjalankannya secara terpisah, tetapi tidak ada cara untuk menjalankan <code>pytest</code> dari direktori <code>dups</code> : </p><br><pre> <code class="plaintext hljs">$ cd /path/to/code/ch6/dups $ pytest a ============================= test session starts ============================= collected 1 item a\test_foo.py . ========================== 1 passed in 0.05 seconds =========================== $ pytest b ============================= test session starts ============================= collected 1 item b\test_foo.py . ========================== 1 passed in 0.05 seconds =========================== $ pytest ============================= test session starts ============================= collected 1 item / 1 errors =================================== ERRORS ==================================== _______________________ ERROR collecting b/test_foo.py ________________________ import file mismatch: imported module 'test_foo' has this __file__ attribute: /path/to/code/ch6/dups/a/test_foo.py which is not the same as the test file we want to collect: /path/to/code/ch6/dups/b/test_foo.py HINT: remove __pycache__ / .pyc files and/or use a unique basename for your test file modules !!!!!!!!!!!!!!!!!!! Interrupted: 1 errors during collection !!!!!!!!!!!!!!!!!!! =========================== 1 error in 0.34 seconds ===========================</code> </pre> <br><p>  Tidak ada yang jelas! <br>  Pesan kesalahan ini tidak menunjukkan apa yang salah. </p><br><p>  Untuk memperbaiki tes ini, cukup tambahkan file <code>__init__.py</code> kosong ke subdirektori.  Berikut adalah contoh direktori <code>dups_fixed</code> dengan nama file duplikat yang sama, tetapi dengan file <code>__init__.py</code> ditambahkan: </p><br><pre> <code class="plaintext hljs">dups_fixed/ â”œâ”€â”€ a â”‚ â”œâ”€â”€ __init__.py â”‚ â””â”€â”€ test_foo.py â””â”€â”€ b â”œâ”€â”€ __init__.py â””â”€â”€ test_foo.py</code> </pre> <br><p>  Sekarang mari kita coba lagi dari tingkat atas di <code>dups_fixed</code> : </p><br><pre> <code class="plaintext hljs">$ cd /path/to/code/ch6/ch6/dups_fixed/ $ pytest ============================= test session starts ============================= collected 2 items a\test_foo.py . b\test_foo.py . ========================== 2 passed in 0.15 seconds ===========================</code> </pre> <br><p>  Jadi akan lebih baik. </p><br><p>  Tentu saja, Anda dapat meyakinkan diri sendiri bahwa Anda tidak akan pernah memiliki nama file duplikat, jadi itu tidak masalah.  Semuanya, seperti, normal.  Tetapi proyek terus bertambah dan katalog pengujian terus bertambah, dan Anda pasti ingin menunggu sampai terjadi pada Anda sebelum mengurusnya?  Saya katakan, letakkan saja file-file ini di sana.  Jadikan kebiasaan dan jangan khawatir lagi. </p><br><h2 id="uprazhneniya">  Latihan </h2><br><p>  Di Bab 5, Plugin, di halaman 95, Anda membuat sebuah plugin bernama pytest-nice yang menyertakan opsi baris perintah --nice.  Mari kita bahas untuk menyertakan opsi pytest.ini yang disebut nice. </p><br><p>  Pada Bab 5, â€œPluginâ€ di halaman 95, Anda membuat sebuah plugin bernama <code>pytest-nice</code> yang menyertakan <code>--nice</code> baris perintah <code>--nice</code> .  Mari kita kembangkan ini untuk menyertakan opsi <code>pytest.ini</code> disebut <code>nice</code> . </p><br><ol><li>  Tambahkan baris berikut ke fungsi kait <code>pytest_addoption</code> <code>pytest_nice.py</code> : <code>parser.addini('nice', type='bool', help='Turn failures into opportunities.')</code> </li><li>  Tempat di plugin yang menggunakan <code>getoption()</code> juga harus memanggil <code>getini('nice')</code> .  Buat perubahan ini. </li><li>  Verifikasi ini secara manual dengan menambahkan <code>nice</code> ke file <code>pytest.ini</code> . </li><li>  Jangan lupa tentang tes plugin.  Tambahkan tes untuk memverifikasi bahwa parameter yang <code>nice</code> dari <code>pytest.ini</code> berfungsi dengan benar. </li><li>  Tambahkan tes ke direktori plugin.  Anda perlu menemukan beberapa <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">fitur Pytester tambahan</a> . </li></ol><br><h2 id="chto-dalshe">  Apa selanjutnya </h2><br><p>  Walaupun pytest sangat kuat dengan sendirinya - terutama dengan plugin - pytest juga terintegrasi dengan baik dengan pengembangan perangkat lunak lain dan alat pengujian perangkat lunak.  Pada bab selanjutnya, kita akan memeriksa penggunaan pytest bersama dengan alat pengujian kuat lainnya. </p><br><p><img src="https://habrastorage.org/webt/jl/jn/bb/jljnbbjr-ejh473xy_eccsmknpk.png">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Kembali</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Selanjutnya</a> <img src="https://habrastorage.org/webt/rw/dy/-g/rwdy-grsvbpcetjttrmecdkxtlk.png"></p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id448796/">https://habr.com/ru/post/id448796/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id448780/index.html">Apa yang memberi perangkat lunak untuk merekrut uang</a></li>
<li><a href="../id448784/index.html">Fitur baru untuk penulis ekstensi di Visual Studio 2019 versi 16.1</a></li>
<li><a href="../id448786/index.html">Pengujian Python dengan pytest. BAB 3 Jadwal Terbaik</a></li>
<li><a href="../id448788/index.html">Pengujian Python dengan pytest. Bab 2, Fungsi Tes Penulisan</a></li>
<li><a href="../id448792/index.html">Pengujian Python dengan pytest. Perlengkapan Bawaan, Bab 4</a></li>
<li><a href="../id448798/index.html">Pengujian Python dengan pytest. Menggunakan pytest dengan alat lain, BAB 7</a></li>
<li><a href="../id448800/index.html">Konfigurasikan Visual Studio di seluruh organisasi Anda dengan .vsconfig</a></li>
<li><a href="../id448802/index.html">Berpikir dengan Portal: membuat portal di Unreal Engine 4</a></li>
<li><a href="../id448804/index.html">Bersiap untuk Hunted Runtime dan Notaris</a></li>
<li><a href="../id448808/index.html">Soal hal-hal sederhana, rumit. "Baja tidur." Cara melumasi baut berkarat atau Tidak WD-40 dengan satu ...</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>