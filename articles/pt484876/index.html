<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚õÖÔ∏è üè© üåû Reparar, cortar, cavar. Resolvendo a miss√£o online Droid Mission üë®üèº‚Äçüè≠ ü§ûüèæ üí®</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="No ano passado, realizamos uma busca on-line para desenvolvedores m√≥veis - Miss√£o Droid. Em um m√™s, os participantes tiveram que resolver o maior n√∫me...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Reparar, cortar, cavar. Resolvendo a miss√£o online Droid Mission</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yandex/blog/484876/"><img src="https://habrastorage.org/webt/r_/ys/qs/r_ysqsq8esvuaug1phjeithvpji.png"><br><br>  No ano passado, realizamos uma busca on-line para desenvolvedores m√≥veis - Miss√£o Droid.  Em um m√™s, os participantes tiveram que resolver o maior n√∫mero poss√≠vel de problemas em tr√™s dire√ß√µes: conserte!  (pesquisa de bugs e pesquisa de c√≥digo), corte-o!  (engenharia reversa) e desenterre-o!  (aprendendo os recursos do Android).  No total, a miss√£o teve 23 tarefas - elas s√£o muito parecidas com as encontradas pelos especialistas em Android no trabalho real.  No post, mostraremos todas as condi√ß√µes e as solu√ß√µes certas. <br><a name="habracut"></a><a name="start"></a><br><ul><li>  <a href="https://habr.com/ru/company/yandex/blog/484876/">Pesquise erros e pesquisa de c√≥digo</a> </li><li>  <a href="https://habr.com/ru/company/yandex/blog/484876/">Engenharia reversa</a> </li><li>  <a href="https://habr.com/ru/company/yandex/blog/484876/">Sistema Android</a> </li></ul><br><a name="fix"></a><h1>  Pesquise erros e pesquisa de c√≥digo </h1><br><h3>  conserte!  # 1 </h3>  <sup><i>Autor: Anastasia Laushkina</i></sup> <br><br>  Em uma noite tranquila de sexta-feira, dois agentes ficam acordados at√© tarde e lideram uma disputa insol√∫vel.  Eles foram instru√≠dos a armazenar uma grande quantidade de dados secretos em um banco de dados Sqlite com uma chave de chave inteira. <br><br>  O agente A cria uma tabela com uma consulta no formato: CREATE TABLE t (chave INT PRIMARY KEY, secret_value_1, secret_value_2) e o agente B com uma consulta no formato CREATE TABLE t (chave INTEGER PRIMARY KEY ASC, secret_value_1, secret_value_2). <br><br>  O Agente A tem certeza absoluta de que n√£o h√° erro em sua solicita√ß√£o; no entanto, o Agente B tem um argumento contra isso: ele afirma que a integridade dos dados durante a abordagem do Agente A pode ser violada. <br><br>  Lista com v√≠rgula: a coluna ou colunas respons√°veis ‚Äã‚Äãpela integridade do Agente B, mas n√£o pelo Agente A;  bem como a estrutura de dados, em russo, devido √† qual a solicita√ß√£o do agente B ser√° mais r√°pida. <br><br><div class="spoiler">  <b class="spoiler_title">Anota√ß√µes</b> <div class="spoiler_text">  Formato da resposta: [nome da coluna 1], [nome da coluna N], [nome da estrutura] (sem colchetes, com letras min√∫sculas) <br><br>  Exemplo de resposta: x, y, matriz </div></div><br>  <b>Solu√ß√£o</b> <br><br>  √â sobre rowId e seu relacionamento com a chave prim√°ria. <br><br>  No caso da chave "CREATE TABLE t (chave INTEGER PRIMARY KEY ASC, secret_value_1, secret_value_2)", a chave √© um alias para rowId.  No caso de "CREATE TABLE t (chave INT PRIMARY KEY, secret_value_1, secret_value_2)" - n√£o.  O motivo pode ser encontrado <a href="https://www.sqlite.org/lang_createtable.html">na documenta√ß√£o</a> . <br><br>  Portanto, na aus√™ncia de um relacionamento-chave com o rowId, uma solicita√ß√£o no formato "INSERIR EM VALORES (" alguns "," y "," z ")" ser√° executada com √™xito, potencialmente violando a integridade dos dados.  Se houver uma conex√£o, ocorrer√° um erro de incompatibilidade de tipo de dados. <br><br>  A resposta foi aceita como um par de chave, rowId e key / rowId separadamente (porque, se houver uma conex√£o, eles se referir√£o √† mesma coluna). <br><br>  A velocidade √© alcan√ßada atrav√©s do armazenamento na forma de uma √°rvore de pesquisa. <br><br><h3>  conserte!  # 2 </h3>  <sup><i>Autor: Anastasia Laushkina</i></sup> <br>  <a href="https://yadi.sk/d/CnFymdL9o6ib3A">Arquivo bin√°rio</a> <br><br>  Para detectar rapidamente inimigos, o agente Kew est√° desenvolvendo um aplicativo com uma lista de criminosos conhecidos.  Ele conseguiu exibir facilmente essa lista no aplicativo, mas decide que informa√ß√µes importantes devem estar na tela principal. <br><br>  Para fazer isso, ele precisa de um widget.  Um problema: por algum motivo, o widget n√£o exibe uma lista.  Um instinto diz ao agente que o problema est√° apenas em uma linha. <br><br>  Nomeie-o com uma v√≠rgula, bem como a linha pela qual voc√™ precisa substitu√≠-lo, para obter a melhor solu√ß√£o. <br><br><div class="spoiler">  <b class="spoiler_title">Anota√ß√µes</b> <div class="spoiler_text">  Formato da resposta: [linha 1], [linha 2] (sem colchetes) <br><br>  Exemplo de resposta: FrameLayout, ScrollView </div></div><br>  <b>Solu√ß√£o</b> <br><br>  1. Estamos procurando um arquivo de layout para o widget. Vimos nele um elemento ConstraintLayout inv√°lido (consulte <a href="https://developer.android.com/guide/topics/appwidgets">developer.android.com/guide/topics/appwidgets#CreatingLayout</a> ). <br>  2. Altere para o aceit√°vel e ideal - LinearLayout / FrameLayout. <br><br>  Apesar do fato de que o uso do FrameLayout quebrou o layout dos elementos no widget, ele ainda foi aceito como resposta. <br><br><h3>  conserte!  # 3 </h3>  <sup><i>Autor: Artyom Viter</i></sup> <br>  <a href="https://yadi.sk/d/uzV_9MS2CyCXgg">Arquivo bin√°rio</a> <br><br>  Os testadores notaram um aumento anormal no consumo de RAM.  H√° uma suspeita de que haja um vazamento em algum lugar. <br><br>  Voc√™ precisa investigar e localizar o problema.  Na resposta, indique o nome do m√©todo da classe de aplicativo e o local da chamada, o que leva a um vazamento de mem√≥ria.  Se voc√™ encontrar v√°rios problemas, liste todos. <br><br>  Formato da resposta: [Nome da classe na qual o m√©todo √© chamado]: [n√∫mero da linha neste arquivo]: [nome do m√©todo] (sem colchetes) <br><br>  Indique v√°rias respostas em ordem lexicogr√°fica, separadas por um #. <br><br>  Um exemplo: <br><br>  Se voc√™ acha que h√° um vazamento de mem√≥ria no arquivo ExampleFileName.java, <br><br><pre><code class="plaintext hljs">class ExampleFileName {   public problemMethodName(Sting arg) {}   public test(Sting arg) {     problemMethodName(arg); //  8   ExampleFileName.java   } }</code> </pre> <br>  Exemplo de resposta: ExampleFileName: 8: problemMethodName <br><br>  <b>Solu√ß√£o</b> <br><br>  A primeira maneira √© a an√°lise de c√≥digo. <br><br><ol><li>  Estudamos o c√≥digo do aplicativo. </li><li>  O primeiro vazamento √© √≥bvio.  Este √© um registro BroadCastReceiver na classe SecondActivity.  Uma mensagem sobre esse problema pode ser vista no logcat se voc√™ executar o aplicativo. </li><li>  Se voc√™ prestar aten√ß√£o ao m√©todo startTimer (), notar√° que a classe CountDownTimer adiciona um fechamento ao manipulador de threads principal com um link para textView.  E antes que a atividade seja destru√≠da, a classe de inst√¢ncia (CountDownTimer) n√£o chama o m√©todo cancel ().  Este √© o segundo vazamento de mem√≥ria. </li></ol><br>  A segunda maneira s√£o as ferramentas.  Voc√™ pode implementar a biblioteca de <a href="https://github.com/square/leakcanary">vazamentos</a> no aplicativo, obter heap dump via adb ou android Profiler e analisar os relat√≥rios recebidos.  O Eclipse Memory Analyzer (MAT) pode ajudar com a an√°lise.  Para abrir o heapdump no MAT, voc√™ precisa convert√™-lo para um formato compreens√≠vel para o MAT usando o utilit√°rio hprof-convd. <br><br><h3>  conserte!  # 4 </h3>  <sup><i>Publicado por: Vali Ibragimov</i></sup> <br>  <a href="https://yadi.sk/d/X8HgqWEhCGUAvw">Arquivo bin√°rio</a> <br><br>  Ivan tem seu primeiro dia em uma sala de cinema online.  Como ele √© um desenvolvedor legal, ele foi imediatamente solicitado a corrigir a falha ao assistir a um filme.  Ele decidiu ao mesmo tempo refatorar.  O c√≥digo se tornou mais conciso e mais limpo, o erro deixou de ser reproduzido. <br><br>  No entanto, mais tarde descobriu-se que a posi√ß√£o atual do filme n√£o foi enviada para o back-end.  Ajude Ivan a entender qual classe ele misturou. <br><br>  A resposta √© o nome da classe que ela deve usar. <br><br>  <b>Solu√ß√£o</b> <br><br>  Para enviar uma posi√ß√£o de visualiza√ß√£o a cada cinco segundos e ir para a rede, o ExecutorService √© usado.  Criando um ScheduledThreadPoolExecutor para uma tarefa peri√≥dica, pensou Ivan - por que n√£o us√°-lo para acessar a rede?  Afinal, ScheduledThreadPoolExecutor √© o descendente de ThreadPoolExecutor.  Ivan nem suspeitava que o ScheduledThreadPoolExecutor usa apenas um encadeamento e, ao acessar a rede, ser√° necess√°rio aguardar a conclus√£o da tarefa peri√≥dica. <br><br><pre> <code class="plaintext hljs">scheduleFuture = scheduledExecutorService.scheduleAtFixedRate(() -&gt; {                    try {                        timingsApi.sendTiming(filmId, player.getContentPosition()).get();                    } catch (Exception e) {                        e.printStackTrace();                    }                },                0, PERIOD_SECONDS, TimeUnit.SECONDS);</code> </pre> <br>  A solu√ß√£o para o problema ficou ainda mais complicada pelo fato de n√£o estarmos acessando o ExoPlayer no thread da interface do usu√°rio - e na nova vers√£o 2.9. * O ExoPlayer come√ßou a escrever avisos sobre isso nos logs.  Mas agora isso √© apenas um aviso, e n√£o um erro cometido por Ivan. <br><br><h3>  conserte!  # 5 </h3>  <sup><i>Autor: Alexander Tsybin</i></sup> <br>  <a href="https://yadi.sk/d/GCLtHa4mKTK7YQ">Arquivo bin√°rio</a> <br><br>  Uma empresa estava desenvolvendo um jogo Farmer Simulator. <br><br>  Neste jogo, apenas um jogador pode se mover livremente.  Todos os outros objetos estavam im√≥veis ou tinham uma trajet√≥ria de movimento claramente definida.  Em algum momento, eles decidiram adicionar inimigos ao jogo que se tornariam um obst√°culo para o jogador. <br><br>  O desenvolvedor Vasya foi instru√≠do a perceber os inimigos.  Durante a implementa√ß√£o, Vasya encontrou um problema de desempenho.  Ele decidiu corrigi-lo devido ao multithreading.  Como Vasya n√£o conhecia o multithreading, ele aproveitou as solu√ß√µes do stackoverflow.  Ent√£o ele se livrou dos problemas de desempenho. <br><br>  No entanto, na fase de testes, verificou-se que, √†s vezes, o jogo congela.  Ajude Vasya a encontrar o motivo. <br><br>  Como resposta, insira os n√∫meros das linhas problem√°ticas de c√≥digo - separadas por v√≠rgulas, em ordem crescente e sem espa√ßos.  Assim: 1,17,42 <br><br>  <b>Solu√ß√£o</b> <br><br>  Tipos primitivos de boxe (por exemplo, int em Inteiro) s√£o opera√ß√µes caras.  Para fins de otimiza√ß√£o, as m√°quinas Java √†s vezes reutilizam esses objetos.  Linhas n√£o s√£o excep√ß√£o. <br><br>  As linhas ENEMY_LOCK e DECISIONS_LOCK s√£o usadas no c√≥digo para sincroniza√ß√£o.  Portanto, se houver locais no projeto com sincroniza√ß√£o nas mesmas linhas, poder√° ocorrer um conflito. <br><br>  Em geral, voc√™ n√£o pode usar String / Inteiro, etc., para sincroniza√ß√£o. <br><br>  Resposta: 7.8 <br><br><h3>  conserte!  # 6 </h3>  <sup><i>Autor: Ivan Pukhov</i></sup> <br>  <a href="https://yadi.sk/d/qR6iYnUBvB9n2w">Arquivo bin√°rio</a> <br><br>  A equipe de processamento de imagens lan√ßou uma nova biblioteca nativa. Voc√™ precisa experiment√°-la e apontar os problemas, se houver. <br><br>  <b>Solu√ß√£o</b> <br><br>  Esta √© uma tarefa f√°cil de aquecer.  Nos recursos est√° a pr√≥pria biblioteca e o arquivo de cabe√ßalho para ela.  No cabe√ßalho, a √∫nica fun√ß√£o retornando um jobject. <br><br>  N√£o h√° mais nada a fazer al√©m de criar um projeto de teste (instalando o NDK) e cham√°-lo!  Uma chamada de fun√ß√£o no thread principal lan√ßar√° uma exce√ß√£o pedindo para n√£o cham√°-la dessa maneira.  Transferimos a execu√ß√£o para outro thread de qualquer forma - e tudo funciona. <br><br>  Agora vale a pena verificar o objeto retornado - √© realmente um bitmap?  A maneira mais f√°cil √© exibi-lo imediatamente em um ImageView.  Veremos uma imagem com uma sequ√™ncia de texto, e a tarefa requer uma resposta tamb√©m na forma de uma sequ√™ncia.  Provavelmente n√£o √© apenas uma coincid√™ncia.  :) <br><br><h3>  conserte!  # 7 </h3>  <sup><i>Autor: Dmitry Zaitsev</i></sup> <br>  <a href="https://yadi.sk/d/sqQgkbbjDu1UNw">Arquivo bin√°rio</a> <br><br>  Existe uma aplica√ß√£o com c√≥digos onde o c√≥digo desejado est√° enquadrado.  Infelizmente, o layout foi quebrado e precisa ser restaurado para encontrar o c√≥digo. <br><br><div class="spoiler">  <b class="spoiler_title">Anota√ß√µes</b> <div class="spoiler_text">  Depois de corrigir o c√≥digo, o quadro passar√° exatamente por 22 caracteres que precisam ser listados no sentido anti-hor√°rio, come√ßando no canto superior esquerdo do quadro. <br><br>  Exemplo de resposta: ScQG1jxbazmjbcARefbRMo </div></div><br>  <b>Solu√ß√£o</b> <br><br>  Agora o Dagger se tornou o padr√£o de fato no desenvolvimento do Android.  Quando o DI j√° est√° configurado, √© muito simples escrever Inject na frente do construtor e dar todo o restante do trabalho para Dagger.  √â t√£o f√°cil que voc√™ pode parar de pensar em como as depend√™ncias s√£o fornecidas.  Tamb√©m no Android, voc√™ frequentemente precisa trabalhar com a classe Context e seus descendentes: Aplicativo e Atividade.  O aplicativo est√° vinculado ao ciclo de vida do aplicativo e a Atividade est√° vinculada ao ciclo de vida da tela.  Portanto, ao trabalhar com essas classes, √© importante observar muitos recursos.  A tarefa √© precisamente baseada no uso do contexto errado, e tudo isso √© disfar√ßado usando DI. <br><br>  Os seguintes passos podem ser seguidos para resolver: <br><br><ol><li>  Examine os arquivos do projeto e observe que ItemStyle √© aplicado a todos os TextViews. </li><li>  Veja que o estilo n√£o √© realmente aplicado.  Isso deve levar √† ideia de que o problema est√° relacionado ao t√≥pico e, portanto, ao contexto da Atividade. </li><li>  Entenda o gr√°fico de depend√™ncia e entenda que o contexto do Aplicativo √© fornecido no adaptador. </li><li>  No ContestAdapter, altere o tipo de contexto para Atividade. </li></ol><br><h3>  conserte!  # 8 </h3>  <sup><i>Publicado por: Vali Ibragimov</i></sup> <br>  <a href="https://yadi.sk/d/mgEetgsZNwtvRA">Arquivo bin√°rio</a> <br><br>  Ivan recebeu a tarefa de refatorar o aplicativo para obter uma lista de tarefas por meio do ContentProvider usando DI.  Ele refatorou o aplicativo usando o Dagger e, quando iniciado, o aplicativo come√ßou a falhar. <br><br>  Ajude Ivan a entender o motivo: <br><br><ol><li>  Especifique o n√∫mero da linha com o nome da classe que voc√™ deseja transferir para outra classe. </li><li>  Forne√ßa um link para a documenta√ß√£o com uma √¢ncora em um local que o ajude a entender por que o aplicativo falha. </li></ol><br><div class="spoiler">  <b class="spoiler_title">Anota√ß√µes</b> <div class="spoiler_text">  Formato de resposta: [Nome da classe]: [N√∫mero da linha] -&gt; [Nome da classe]: [N√∫mero da linha], [Link] <br><br>  Exemplo de resposta: <br><br>  FirstCLass: 12-&gt; SecondClass: 45, https: //developer.android.com/reference/android/app/Activity#activity-lifecycle </div></div><br>  <b>Solu√ß√£o</b> <br><br>  A tarefa consistiu em duas partes: <br><br>  1. Entenda e forne√ßa uma solu√ß√£o de falha no ContentProvider ao acessar o componente DI.  A solu√ß√£o correta foi transferir a inicializa√ß√£o do componente DI para o ContentProvider. <br><br><img src="https://habrastorage.org/webt/fu/nr/n_/funrn_gbeansq3bwonjrrsaknoc.png" width="800"><br><br>  O m√©todo onCreate no ContentProvider √© chamado mais cedo que no Application.  √â f√°cil verificar se voc√™ examina o c√≥digo de in√≠cio do aplicativo na classe ActivityThread e no m√©todo handleBindApplication. <br><br><img src="https://habrastorage.org/webt/r9/xk/vr/r9xkvrg0kjjiefi0xtruxlvnhwm.png" width="620"><br><br>  2. Forne√ßa um link descrevendo que onCreate for ContentProvider √© chamado mais cedo que para Application.  O Google n√£o menciona isso na p√°gina de documenta√ß√£o do ContentProvider.  Mas aqui est√° um trecho da descri√ß√£o do m√©todo onCreate Aplication: <br><br><blockquote>  Chamado quando o aplicativo est√° iniciando, antes que qualquer atividade, servi√ßo ou objeto receptor (excluindo provedores de conte√∫do) tenha sido criado. </blockquote><br><h3>  conserte!  # 9 </h3>  <sup><i>Autor: Alexander Tsybin</i></sup> <br>  <a href="https://yadi.sk/d/-V1nSeMxB3K6aw">Arquivo bin√°rio</a> <br><br>  O desenvolvedor recebeu a tarefa de implementar o modo de exibi√ß√£o para obter uma lista de itens.  No TK, havia um requisito importante - rolar a lista para o primeiro e o √∫ltimo elementos para que esses elementos apare√ßam no centro da tela.  O desenvolvedor implementou a funcionalidade, mas ao testar, √†s vezes a centraliza√ß√£o n√£o funciona.  Ajude o desenvolvedor a encontrar as linhas problem√°ticas no c√≥digo. <br><br><div class="spoiler">  <b class="spoiler_title">Anota√ß√µes</b> <div class="spoiler_text">  Formato da resposta: <br><br>  &lt;Nome do arquivo sem extens√£o&gt;: &lt;N√∫meros de linha separados por v√≠rgulas&gt; <br><br>  &lt;Nome do arquivo sem extens√£o&gt;: &lt;N√∫meros de linha separados por v√≠rgulas&gt; <br><br>  As linhas devem ser classificadas em ordem lexicogr√°fica.  Os n√∫meros das linhas devem ser classificados em ordem crescente. <br><br>  Exemplo de resposta: <br><br>  BarFoo: 1 <br><br>  FooBar: 12,13,14,99 </div></div><br>  <b>Solu√ß√£o</b> <br><br>  Existem dois problemas no c√≥digo: <br><br>  1. A julgar pelo c√≥digo, sup√µe-se que a chamada para onViewDetachedFromWindow sempre ocorra ap√≥s onBindViewHolder, mas n√£o √© assim.  O m√©todo duplo para onViewDetachedFromWindow √© onViewAttachedToWindow.  Como resultado, holder.view.reset () √© chamado e a centraliza√ß√£o desaparece se a rolagem for lenta. <br><br>  2. No Android anterior √† vers√£o 7, o addView (rootView, par√¢metros) n√£o funciona da maneira esperada. <br><br>  Quando voc√™ adiciona uma View, um LayoutParam √© gerado, com a seguinte apar√™ncia: <br><br>  Marshmallow - <a href="">github.com/aosp-mirror/platform_frameworks_base/blob/marshmallow-release/core/java/android/widget/FrameLayout.java#L403</a> <br>  Nougat - <a href="">github.com/aosp-mirror/platform_frameworks_base/blob/nougat-release/core/java/android/widget/FrameLayout.java#L384</a> <br><br>  O FrameLayout.LayoutParams possui dois construtores, um dos quais aceita ViewGroup.MarginLayoutParams e copia as margens em si: <a href="">github.com/aosp-mirror/platform_frameworks_base/blob/nougat-release/core/java/android/view/ViewGroup.java#L14</a> <br><br>  O segundo construtor aceita ViewGroup.LayoutParams e ignora as margens: <a href="">github.com/aosp-mirror/platform_frameworks_base/blob/nougat-release/core/java/android/view/ViewGroup.java#L7328</a> <br><br>  Como resultado, a centraliza√ß√£o n√£o funciona no Android at√© a vers√£o 7. <br><br>  A resposta √©: <br>  Visualiza√ß√£o do item: 35 <br>  Atividade principal: 53 <br><br><a name="hack"></a><h1>  Engenharia reversa </h1><br><h3>  hackear!  # 1 </h3>  <sup><i>Autor: Valentin Baryshev</i></sup> <br>  <a href="https://yadi.sk/d/7SXNXpKzadxR9A">Arquivo bin√°rio</a> <br><br>  Um desenvolvedor se apressou e nem testou o .apk final antes de enviar para o concurso. <br><br>  Aconteceu que ele misturou algum grupo de visualiza√ß√µes em activity_main.xml.  Al√©m disso, ele colocou cada letra da chave em uma visualiza√ß√£o de texto separada.  Como resultado, todas as visualiza√ß√µes no layout se separaram e h√° uma indigna√ß√£o completa na tela. <br><br>  Tente determinar qual grupo de visualiza√ß√µes deve estar no lugar dos atuais. <br><br>  A resposta para o problema √© o c√≥digo que aparece na tela ap√≥s a substitui√ß√£o do grupo de exibi√ß√£o correto. <br><br>  <b>Solu√ß√£o</b> <br><br>  √â necess√°rio descompilar .apk de qualquer maneira dispon√≠vel (por exemplo, por descompiladores online) e recriar o projeto por c√≥digo. <br><br>  Se analisarmos main_layout, podemos adivinhar pelos atributos que o grupo de visualiza√ß√µes raiz deve ser ConstraintLayout. <br><br>  Resposta: tniartsnoc <br><br><h3>  hackear!  # 2 </h3>  <sup><i>Autor: Alexander Tsybin</i></sup> <br>  <a href="https://yadi.sk/d/PAuLY9-7Is5iYg">Arquivo bin√°rio</a> <br><br>  Um usu√°rio experiente travou o aplicativo.  Ele n√£o ficou surpreso, abriu os logs, encontrou a linha que causou o erro: N72XbphDx5NnFl6CKMNl8w == e a enviou ao suporte t√©cnico. <br><br>  Verificou-se que ele estava usando uma vers√£o desatualizada do aplicativo, que havia sido desenvolvida antes de usar reposit√≥rios de c√≥digo, portanto o c√≥digo de descriptografia foi perdido.  No entanto, foi poss√≠vel encontrar .apk da vers√£o antiga do aplicativo. <br><br>  Ajude a decifrar a mensagem. <br><br>  <b>Solu√ß√£o</b> <br><br>  √â necess√°rio descompilar .apk de qualquer maneira dispon√≠vel (por exemplo, por descompiladores online) e recriar o projeto por c√≥digo. <br><br>  O c√≥digo em si cont√©m a fun√ß√£o de criptografia e a fun√ß√£o de descriptografia, √† qual voc√™ pode fornecer a cadeia criptografada e obter uma resposta. <br><br>  A resposta √©: <br>  TF: Bom trabalho! <br><br><h3>  hackear!  # 3 </h3>  <sup><i>Autor: Valentin Baryshev</i></sup> <br>  <a href="https://yadi.sk/d/hRZM_Yc8hf5FOg">Arquivo bin√°rio</a> <br><br>  Como voc√™ conhece o ciclo de vida de um aplicativo Android? <br><br>  Voc√™ sabia que, em alguns casos, o sistema pode interromper o processo de inscri√ß√£o? <br><br>  Simule esta situa√ß√£o no aplicativo. <br><br>  Voc√™ ver√° a resposta ap√≥s restaurar o aplicativo - na forma de c√≥digo. <br><br>  <b>Solu√ß√£o</b> <br><br>  Foi o suficiente para instalar .apk no telefone, executar e obter o caso quando o sistema descarrega o aplicativo, mas, ao mesmo tempo, permanece na cortina. <br><br>  Uma op√ß√£o √© instalar o aplicativo, inici√°-lo e minimiz√°-lo (ou apenas alternar para outro aplicativo).  Ent√£o nos conectamos via adb ao computador.  No Android Studio, selecione a guia Logcat, selecione o processo deste aplicativo e clique no √≠cone vermelho de parada.  Em seguida, abra o aplicativo anteriormente minimizado da cortina.  A tela exibir√° a resposta: sss2384gxcxxX. <br><br><h3>  hackear!  # 4 </h3>  <sup><i>Autor: Ivan Pukhov</i></sup> <br>  <a href="https://yadi.sk/d/RwxPtc4Z-EwCLg">Arquivo bin√°rio</a> <br><br>  Um colega de front-end publicou uma demonstra√ß√£o do novo m√≥dulo, mas esqueceu de enviar as especifica√ß√µes.  Agora ele dorme em um fuso hor√°rio diferente, e uma demonstra√ß√£o deve ser feita em alguns minutos.  Em uma conversa com um colega, voc√™ se lembra da frase "Sim, √© f√°cil l√°, basta escrever stubs e ele funcionar√°". <br><br>  Fa√ßa o download do arquivo e tente lidar sem um colega. <br><br>  <b>Solu√ß√£o</b> <br><br>  Essa √© uma tarefa simples, mas requer certa curiosidade e perseveran√ßa. <br><br>  Fa√ßa o download do archive, fa√ßa upload de seu conte√∫do para o servidor de teste local, crie um projeto com o WebView e execute-o.  Ap√≥s um curto tempo, vemos a mensagem "Calibrar orienta√ß√£o".  E √© isso.  Mas a mensagem sugere que talvez voc√™ deva torcer o telefone com as m√£os?  Depois disso, uma mensagem suspeita sobre a exce√ß√£o lan√ßada ser√° exibida - com uma chamada para verificar a sa√≠da do console. <br><br>  Abrimos o console e vemos uma chamada para um m√©todo inexistente no objeto API.  Adicionamos um objeto ao WebView para implementar a API JS e novamente tentamos testar o aplicativo. <br><br>  Aparentemente, vale a pena adicionar um valor de retorno.  N√≥s selecionamos, adicionamos - funciona.  Mas n√£o h√° linha com a resposta em lugar algum.  Ligue o telefone novamente - um novo m√©todo √© chamado.  Adicione-o tamb√©m.  Ap√≥s v√°rias itera√ß√µes, obtemos a chamada finalizeCalibrating e, em seguida, storeResult, na qual nossa linha chegar√°. <br><br>  Ao baixar a fonte, talvez voc√™ n√£o queira resolver nada, mas abra-a e retire a resposta.  Esse m√©todo funciona, mas alguns pequenos ancinhos esperam por voc√™ ao longo do caminho. <br><br><h3>  hackear!  # 5 </h3>  <sup><i>Autor: Ivan Pukhov</i></sup> <br><br>  A montagem do desenvolvedor da nova vers√£o do android vazou para a rede, na qual o novo mecanismo de assinatura do aplicativo foi depurado diretamente no dispositivo.  Nesse assembly, a chave privada para assinatura √© costurada no c√≥digo-fonte do sistema, e os desenvolvedores deixaram partes da interface do usu√°rio para receb√™-lo.  Encontre a chave. <br><br><div class="spoiler">  <b class="spoiler_title">Anota√ß√µes</b> <div class="spoiler_text">  Formato de resposta: cadeia de 32 caracteres <br><br>  <a href="https://yadi.sk/d/vnDrXgDqJd8v7g">Download da Condi√ß√£o da Tarefa (Mac OS X)</a> <br><br>  <a href="https://yadi.sk/d/ZuE2fORiMbbG7A">Download da Condi√ß√£o da Tarefa (Windows)</a> <br><br>  <a href="https://yadi.sk/d/WxiBCxrVeIzIrg">Download da condi√ß√£o da tarefa (Linux)</a> </div></div><br>  <b>Solu√ß√£o</b> <br><br>  1. Ao executar o emulador, voc√™ notar√° o aplicativo SecretActivity.  Se voc√™ abrir, um brinde ser√° exibido, oferecendo a visualiza√ß√£o dos logs.  Como esse √© um assembly de depura√ß√£o, h√° muitos logs - eles precisam ser filtrados pelo nome do aplicativo. <br><br><pre> <code class="bash hljs">adb logcat | grep <span class="hljs-string"><span class="hljs-string">'SecretActivity'</span></span></code> </pre> <br> <code>1898 1898 E SecretActivity: Try broadcast ZggwxXsaQ9SapPKyHpnwnYmALHazVFWX</code> <br> <br>  2. Tentamos lan√ßar a transmiss√£o com a a√ß√£o do log: <br><br><pre> <code class="bash hljs">adb shell am broadcast -a ZggwxXsaQ9SapPKyHpnwnYmALHazVFWX</code> </pre> <br>  3. Um brinde aparecer√° na tela com uma proposta para ver os logs pela tag SecretReceiver. <br><br><pre> <code class="bash hljs">adb logcat | grep <span class="hljs-string"><span class="hljs-string">'SecretReceiver'</span></span></code> </pre> <br> <code>1898 1898 E SecretReceiver: ISecretService.aidl <br> 1898 1898 E SecretReceiver: package android.app; <br> 1898 1898 E SecretReceiver: interface ISecretService { <br> 1898 1898 E SecretReceiver: String getSecret(); <br> 1898 1898 E SecretReceiver: } <br> 1898 1898 E SecretReceiver: See global settings to bind SecretService</code> <br> <br>  4. Examinamos as configura√ß√µes globais para encontrar uma a√ß√£o para conectar-se ao SecretService. <br><br><pre> <code class="bash hljs">adb shell settings list global</code> </pre> <br> <code>... <br> bind_secret_service_action=g8mNyGQZR8aHLTXNWcjdwJJYZ85Ewx83 <br> ...</code> <br> <br>  5. Estamos escrevendo um cliente para o servi√ßo ISecretService usando essa interface de aux√≠lio. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainActivity</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Activity</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Bundle savedInstanceState)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate(savedInstanceState); Intent intent = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Intent(); intent.setAction(<span class="hljs-string"><span class="hljs-string">"g8mNyGQZR8aHLTXNWcjdwJJYZ85Ewx83"</span></span>); PackageManager pm = getPackageManager(); List&lt;ResolveInfo&gt; resolveInfoList = pm.queryIntentServices(intent, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (resolveInfoList == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> || resolveInfoList.size() != <span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } ResolveInfo serviceInfo = resolveInfoList.get(<span class="hljs-number"><span class="hljs-number">0</span></span>); ComponentName component = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ComponentName(serviceInfo.serviceInfo.packageName, serviceInfo.serviceInfo.name); Intent explicitIntent = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Intent(intent); explicitIntent.setComponent(component); bindService(explicitIntent, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ServiceConnection() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onServiceConnected</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ComponentName name, IBinder service)</span></span></span><span class="hljs-function"> </span></span>{ ISecretService secretService = ISecretService.Stub.asInterface(service); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { Log.d(<span class="hljs-string"><span class="hljs-string">"MainActivity"</span></span>, secretService.getSecret()); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception e) { Log.e(<span class="hljs-string"><span class="hljs-string">"MainActivity"</span></span>, <span class="hljs-string"><span class="hljs-string">"RemoteException"</span></span>, e); } } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onServiceDisconnected</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ComponentName name)</span></span></span><span class="hljs-function"> </span></span>{ } }, Context.BIND_AUTO_CREATE); } }</code> </pre> <br>  6. Execute, nos logs, obtemos a resposta: <br><br><pre> <code class="bash hljs">adb logcat | grep <span class="hljs-string"><span class="hljs-string">'MainActivity'</span></span></code> </pre> <br> <code>1898 1898 E MainActivity: VENHz=qWr7y!t3ZhP!8Skw!!kcTkt7V%</code> <br> <br><h3>  hackear!  # 6 </h3>  <sup><i>Autor: Pavel Vorobkalov</i></sup> <br>  <a href="https://yadi.sk/d/V1ipafbw9EJjQA">Arquivo bin√°rio</a> <br><br>  Tupper escreveu um aplicativo para Android que envia mensagens. <br><br>  Decifre a mensagem e siga em frente. <br><br>  Formato da resposta: string como um link. <br><br>  <b>Solu√ß√£o</b> <br><br>  Instale e execute o aplicativo no dispositivo.  Vemos dois bot√µes: Enviar mensagem e Enviar f√≥rmula.  Quando voc√™ clica neles, nada vis√≠vel acontece.  Voc√™ precisa descobrir como e para onde o aplicativo envia algo. <br><br><img src="https://habrastorage.org/webt/d7/1k/ea/d71kea2oipwhydwmurf5hroelpy.png" width="300"><br><br>  Abrimos aplicativos .apk usando alguns meios de engenharia reversa e analisamos a Atividade principal.  L√° voc√™ pode ver os m√©todos onSendMessageClick e onSendFormulaClick.  Eles criam um Intent com a a√ß√£o "com.yandex.tupper.action.NEW_MESSAGE" e um extra com a chave "com.yandex.tupper.message" e o enviam para os aplicativos da lista (usando o m√©todo geral).  Eles obt√™m a lista chamando PackageManager.queryBroadcastReceivers. <br><br>  Voc√™ pode continuar usando as ferramentas de engenharia reversa para estudar a mensagem, extraindo-a do c√≥digo do aplicativo.  Mas esse caminho √© intencionalmente (embora um pouco) complicado pela criptografia RSA adicional. <br><br>  Existe outra maneira que melhor combina com a programa√ß√£o do Android.  Voc√™ precisa escrever um aplicativo que lide com essa transmiss√£o de inten√ß√£o.  Criamos nosso aplicativo, no receptor de registro de manifesto: <br><br><pre> <code class="xml hljs"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">receiver</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">".TupperMessageReceiver"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:enabled</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:exported</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">intent-filter</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">action</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"com.yandex.tupper.action.NEW_MESSAGE"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">intent-filter</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">receiver</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  No manipulador, obtemos a mensagem extra e executamos nossa pr√≥pria atividade, na qual mostraremos o resultado do processamento: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TupperMessageReceiver</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BroadcastReceiver</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onReceive</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context, Intent intent)</span></span></span><span class="hljs-function"> </span></span>{ String message = intent.getStringExtra(MainActivity.EXTRA_MESSAGE); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (message == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } Intent activityIntent = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Intent(context, MainActivity.class); activityIntent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK); activityIntent.putExtra(MainActivity.EXTRA_MESSAGE, message); context.startActivity(activityIntent); } }</code> </pre> <br>  Agora vamos lidar com a descriptografia da pr√≥pria mensagem.  Se voc√™ procurar no Yandex a mensagem de Tupper, poder√° encontrar <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D0%25BE%25D1%2580%25D0%25BC%25D1%2583%25D0%25BB%25D0%25B0_%25D0%25A2%25D0%25B0%25D0%25BF%25D0%25BF%25D0%25B5%25D1%2580%25D0%25B0">um artigo</a> sobre a f√≥rmula de Wupper.  Ele tem um exemplo de uma f√≥rmula codificada na forma de um n√∫mero: <br><br><div class="spoiler">  <b class="spoiler_title">48584 ...</b> <div class="spoiler_text"><pre><code class="plaintext hljs">4858450636189713423582095962494202044581400587983244549483093085061934704708809928450644769865524364849997247024915119110411605739177407856919754326571855442057210445735883681829823754139634338225199452191651284348332905131193199953502413758765239264874613394906870130562295813219481113685339535565290850023875092856892694555974281546386510730049106723058933586052544096664351265349363643957125565695936815184334857605266940161251266951421550539554519153785457525756590740540157929001765967965480064427829131488548259914721248506352686630476300</code></pre></div></div><br>  Esse n√∫mero √© enviado como uma mensagem clicando no bot√£o Enviar f√≥rmula.  O resultado da decodifica√ß√£o do n√∫mero tamb√©m est√° no artigo da Wikipedia.  Ele pode ser usado para depurar sua implementa√ß√£o do algoritmo de decodifica√ß√£o. <br><br>  Implementamos o algoritmo de decodifica√ß√£o em Java e, por uma quest√£o de beleza, convertemos o n√∫mero bin√°rio resultante em um Bitmap monocrom√°tico: <br><br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TupperCodec</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> TUPPER_R = <span class="hljs-number"><span class="hljs-number">17</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TupperCodec</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> BigInteger </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">decodeFromDecString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String decString)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> NumberFormatException </span></span>{ BigInteger data = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BigInteger(decString, <span class="hljs-number"><span class="hljs-number">10</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> data.divide(BigInteger.valueOf(TUPPER_R)); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getNumberAsBinImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(BigInteger number)</span></span></span><span class="hljs-function"> </span></span>{ String binString = number.toString(<span class="hljs-number"><span class="hljs-number">2</span></span>); StringBuffer result = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuffer(binString.length()); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; binString.length(); i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((i % TUPPER_R) == <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; i &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { result.append(<span class="hljs-string"><span class="hljs-string">'\n'</span></span>); } result.append(binString.charAt(binString.length() - <span class="hljs-number"><span class="hljs-number">1</span></span> - i)); } <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> numberOfRows = (binString.length() + TUPPER_R - <span class="hljs-number"><span class="hljs-number">1</span></span>) / TUPPER_R; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (; i &lt; numberOfRows * TUPPER_R; i++) { result.append(~_~quot&amp;#<span class="hljs-number"><span class="hljs-number">0</span></span>;quot~_~); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result.toString(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Bitmap </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getBinImageAsBitmap</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String binImage)</span></span></span><span class="hljs-function"> </span></span>{ String[] lines = binImage.split(<span class="hljs-string"><span class="hljs-string">"\n"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[] colors = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[lines.length * TUPPER_R]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; lines.length; i++) { String line = lines[i]; <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> line.length() == TUPPER_R; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> j = <span class="hljs-number"><span class="hljs-number">0</span></span>; j &lt; line.length(); j++) { colors[i * TUPPER_R + j] = line.charAt(j) == <span class="hljs-string"><span class="hljs-string">'0'</span></span> ? Color.WHITE : Color.BLACK; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Bitmap.createBitmap(colors, TUPPER_R, lines.length, Bitmap.Config.ARGB_8888); } }</code> </pre> <br>  Em Atividade, chame a decodifica√ß√£o e exiba o resultado como um Bitmap no ImageView: <br><br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainActivity</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AppCompatActivity</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String EXTRA_MESSAGE = <span class="hljs-string"><span class="hljs-string">"com.yandex.tupper.message"</span></span>; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Bundle savedInstanceState)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate(savedInstanceState); setContentView(R.layout.activity_main); Intent intent = getIntent(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (intent != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> &amp;&amp; intent.hasExtra(MainActivity.EXTRA_MESSAGE)) { String message = intent.getStringExtra(MainActivity.EXTRA_MESSAGE); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { BigInteger data = TupperCodec.decodeFromDecString(message); String binImage = TupperCodec.getNumberAsBinImage(data); Bitmap bitmap = TupperCodec.getBinImageAsBitmap(binImage); ImageView imageView = findViewById(R.id.message_image); imageView.setImageBitmap(bitmap); CharSequence toastText = TextUtils.ellipsize(message, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TextPaint(), <span class="hljs-number"><span class="hljs-number">400</span></span>, TextUtils.TruncateAt.END); Toast.makeText(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, toastText, Toast.LENGTH_SHORT).show(); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (NumberFormatException ex) { Toast.makeText(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, getString(R.string.invalid_message), Toast.LENGTH_LONG).show(); } } } }</code> </pre> <br><img src="https://habrastorage.org/webt/zf/ji/7b/zfji7bvxc9uz3avkrwqz65hc7lo.png" width="300"><br> <b><sup><sub>  </sub></sup></b> <br><br>  ‚Äî <a href="https://clck.ru/FevR5">clck.ru/FevR5</a> . <br><br><h3> hack it! #7 </h3> <sup><i>:  </i></sup> <br> <a href="https://yadi.sk/d/YlXQWIwlo8VGmw"> </a> <br><br>       . <br><br>     .    ,           ,    . <br><br>  :      -    . <br><br> <b></b> <br><br>  .apk  zip-     classes.dex ‚Äî  Java-  .         , ,  dex2jar  Android Studio. dex2jar  Java-,    Android Studio        class-.     ,   . <br><br>    ,     proguard ( android.support.*  androidx.*,    ), ‚Äî  com.yandex.contest.keygenme.MainActivity, Activity  . ,       : MainActivity.a#doInBackground   bbaab   b     ,   . <br><br><img src="https://habrastorage.org/webt/6d/sa/vb/6dsavb2ct67ou-f8hknj6c7twpy.png"><br><br>   c  d.        N-    œÄ ( --),        .     ,  œÄ <sub>hexed</sub> [c[i] + key[i]] = d[i], i = 0..11.    ,     .            50  hex-  œÄ.  : 537306089144.         key_2056BE33E064. <br><br>            ,    ,       ‚Äî  .     doInBackground: <br><br><img src="https://habrastorage.org/webt/4o/io/62/4oio62zqs03jzqonptpka1tb_rs.png"><br><br> ,       ,       if (var12[0] == var8) {‚Ä¶ }.  var7    ‚Äî  i-   .    ,   var7      0  9           .    .    ,    .apk (      JVM)   . <br><br><h3> hack it! #8 </h3> <sup><i>:  </i></sup> <br> <a href="https://yadi.sk/d/rRQuDjMq7f6Z_A"> </a> <br><br>      N   ,        .    :   Android  4.4,    1200 √ó 600,        FM-.    ,       ,  FM-    .     FM-        ,      . <br><br>          ,        FM-.            . <br><br>       ,     : <br><br> 1.     106.00  <br> 2.  (seek)    <br> 3. ,    <br><br>  ,    . <br><br><div class="spoiler"> <b class="spoiler_title"></b> <div class="spoiler_text">  :            .        . <br><br>  : ,   a(106.00)     106.00 ,  b(true)   ,   c()  ,     a(106.00);b(true);c() </div></div><br> <b></b> <br><br>  :  ,   FM-  .    .apk   dex-.       Java.  ,   ,    ‚Äî jadx. <br><br>   .apk,     .      MainActivity.   : fragment_holder   RadioFullFragment   .    .      RadioFullPresenter,  ChangeRadioFrequencyUsecase,       RadioRepo.   . <br><br>     ¬´implements RadioRepo¬ª.  : RadioRepoImpl.  ,      b. ServiceConnection ‚Äî    . ,   b    lambda$new$0$RadioRepoImpl. ,   $$Lambda$RadioRepoImpl$FYTR9gAgZEGvrLjkbkpAIup7OKw,     serviceConnection  IRadioService radioService.  ,    RadioService. <br><br>  :  onServiceConnected   ¬´b radioManager = Stub.asInterface(service)¬ª.  ,     .    ¬´bindService¬ª.  bindService   ¬´com.some_company.help_service¬ª.      ,      com.some_company.carradio.FmUtils.  , ,     . , : j  ,    : 8880  88.00 .        8800.      a. ,    . <br><br>   .  : k  z.         RadioRepoImpl,    enableRadio()  disableRadio()   k.    z(boolean isForwardDirection),     ¬´ (seek)   ¬ª. <br><br>      : a(10600);z(true);j(). <br><br><h3> hack it! #9 </h3> <sup><i>:  </i></sup> <br> <a href="https://yadi.sk/d/RqpIQYikuNBwcA"> </a> <br><br>    flatbuffers      .      GPX  .    .      ,  . <br><br>  FlatBuffers   : <br><br><pre> <code class="plaintext hljs">namespace ru.yandex.android.task; struct GeoPoint { latitude:double; longitude:double; } table Points { items:[GeoPoint]; } root_type Points;</code> </pre> <br>  : ,     sha256.      . <br><br> <b></b> <br><br>   ,   FlatBuffers. <br><br> 1.   fbs-         . <br> 2.    Java-.   JVM-    ,    Gradle   flatbuffers. <br> 3.        fbs-. <br> 4.      fbs-,     -     ‚Äî    .    ,          FlatBuffers. <br> 5.      ,   .  structs  ,           struct  table.     . <br> 6.            Kotlin.            FlatBuffers. <br><br>      fbs     ,        .     FlatBufferBuilder      input.    input   : <br><br><pre> <code class="plaintext hljs">val pointsList = Points.getRootAsPoints(buffer) val restoredPoints = (0 until pointsList.itemsLength()) .mapNotNull(pointsList::items)</code> </pre> <br>  c    ,          (lat, long).       as-is    GPX-. <br><br>    GPX- (   )   .    GPX   XML.  ,       XML-   .  XML-   GPX-track-.  XML-   MAP-          .     ¬´yandroid¬ª. <br><br> ,      .      CLI-: <br><br><pre> <code class="plaintext hljs">echo "yandroid" | shasum -a 256</code> </pre> <br>      . <br><br><a name="dig"></a><h1>  Android </h1><br><h3> dig it! #1 </h3> <sup><i>:  </i></sup> <br> <a href="https://yadi.sk/d/WNgNI_n2ydszrg"> </a> <br><br> QA-    . <br><br>  : <br><br> ‚Äî   (  'Screen 1') <br> ‚Äî   GO NEXT (  'Screen 2') <br> ‚Äî   GO BACK <br> ‚Äî     GO NEXT,   <br> ‚Äî  5‚Äì10  <br><br>  :   'Screen 2'. <br><br>  :  ,   ¬´  ¬ª. <br><br>     .apk . <br><br><div class="spoiler"> <b class="spoiler_title"></b> <div class="spoiler_text"> <b> </b> <br><br> C   stack trace,     . <br><br>  <b>Exemplo</b> <br><br>  stack trace     ‚Ä¶ <br><br><pre> <code class="plaintext hljs">at android.os.MessageQueue.nativePollOnce(Native method) at android.os.MessageQueue.next(MessageQueue.java:326) at android.os.Looper.loop(Looper.java:160) at com.android.server.SystemServer.run(SystemServer.java:454) at com.android.server.SystemServer.main(SystemServer.java:294) at java.lang.reÔ¨Çect.Method.invoke(Native method) at com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:493) at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:838)</code> </pre> <br> ‚Ä¶   ,     RuntimeInit.java,   493,   : <br><br><pre> <code class="plaintext hljs">com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:493)</code> </pre> </div></div><br> <b></b> <br><br>   , ,     ¬´  ¬ª. <br><br>       /data/anr/traces.txt  /data/anr/anr_* (https://developer.android.com/topic/performance/vitals/anr#pull_a_traces_file).      adb-: <br><br><pre> <code class="plaintext hljs">adb root adb shell ls /data/anr adb pull /data/anr/&lt;filename&gt;</code> </pre> <br> (   adb root  ,     Google API.) <br><br>  stack trace   .  ‚Äî     stack trace,     : <br><br><pre> <code class="plaintext hljs">com.droid.mission.anrapk.MainActivity$2.onClick(MainActivity.java:43)</code> </pre> <br><img src="https://habrastorage.org/webt/ww/ae/yf/wwaeyflqgvj5ahgbw0ldeui2vo0.png"><br><br><h3> dig it! #2 </h3> <sup><i>:  </i></sup> <br><br>     Android Studio,        ,     MultiDex. -,    apk-     .dex-   (65536).   /     apk   Andorid Studio    .dex-. <br><br>  ‚Äî    dex-  ,    dex- ( ,    )      .    dex- . <br><br> : multidex , android gradle plugin  3.0.0 ‚Äì 3.1.4 <br><br>    . <br><br>         ? <br><br> <b></b> <br><br>         ,      dex-.       Gradle ‚Äî  ,     ,   .apk. <br><br>     Java-  dex-    ART/Dalvik: transformClassesWithDexBuilderForDebug.     dex-,   .       Android Gradle plugin (AGP)     Gradle  .  ,  ‚Äî  , Gradle             . ,        .        AGP,   ‚Äî   DSL- Gradle      build.gradle. <br><br>    3.1.*     minimal-main-dex.    ,      . <br><br><h3> dig it! #3 </h3> <sup><i>:  </i></sup> <br>  ‚Äî     -           . <br><br>       ? <br><br>  :  ‚Äî    . <br><br> <b></b> <br><br>    ,        .    Android   WindowManager. <a href="https://developer.android.com/reference/android/view/WindowManager.html"></a>        .  ,  <a href="https://developer.android.com/reference/android/view/WindowManager.LayoutParams.html">WindowManager.LayoutParams</a> .    ,        ,   <a href="https://developer.android.com/reference/android/view/WindowManager.LayoutParams.html">TYPE_APPLICATION</a> . <br><br>    ,  ,      .       ,  ,    - . <br><br> ,   Android SDK,   ,        . ,     <a href="">WindowManager</a>  AOSP.     ,    ,   ,            . <br><br> ,       ,   <a href="http://androidxref.com/9.0.0_r3/search%3Fq%3DTYPE_BOOT_PROGRESS%26defs%3D%26refs%3D%26path%3D%26hist%3D%26project%3Dframeworks">TYPE_BOOT_PROGRESS</a> .       getWindowLayerFromTypeLw  WindowManagerPolicy.  Javadoc : <br><br><blockquote> Returns the layer assignment for the window type. Allows you to control how different kinds of windows are ordered on-screen </blockquote><br> ,   ,  .    switch-case   ,   layer ‚Äî  TYPE_POINTER,  2018.    . <br><br><h3> dig it! #4 </h3> <sup><i>:  </i></sup> <br><br>    ,      -        ,     . <br><br>        .   ,   ,   ,     . <br><br>    Android  ,          ? <br><br> <b></b> <br><br>       ,   ,     Android SDK,  . <br><br>     <a href="">startActivity  Context</a> .     Context  Activity ‚Äî ,      <a href="">startActivity</a> .        startActivityForResult.     ,    Activity  <a href="">mInstrumentation.execStartActivity</a> . <br><br>      <a href=""></a> ?    startActivity  ActivityManagerService,    ServiceManager.getService(Context.ACTIVITY_SERVICE). <br><br>      <a href="">ActivityManagerService</a> .   startActivityAsUser,    startActivity,  ActivityStarter     execute. ,    <a href=""></a> . <br><br> C         <a href="">startActivity</a> .      ,     <a href="">abort</a> ,     true    START_ABORTED     Activity. <br><br>  ,    ,      mService.mIntentFirewall.checkStartActivity. , <a href="">   </a> .   : <br><br><blockquote> This is called from ActivityManager to check if a start activity intent should be allowed. </blockquote><br>   ,  IntentFirewall  .        <a href="">RULES_DIR</a> . : ifw. <br><br><h3> dig it! #5 </h3> <sup><i>:  </i></sup> <br><br>     . ,        (, ) ‚Äî 8800.  ,  ,        (+8800). ,   8800  +8800 ,   /     ,    . <br><br>            .    .   ,   +8800  8800 . <br><br>          ,     (java/c/c++).   ,    . <br><br>      : <a href="https://source.android.com/">source.android.com</a> <br>   ‚Äî : <a href="http://androidxref.com/">androidxref.com</a> <br><br> <b></b> <br><br>     Dialer ,         ,    URI  <code>authorities = "content://com.android.contacts"</code> . <br><br>  ContentProvider.        URI   ContactsPoviider.  : ,    SQL-      .    : <br><br><pre> <code class="plaintext hljs">sb.append("PHONE_NUMBERS_EQUAL(" + Tables.DATA + "." + Phone.NUMBER + ", ");</code> </pre> <br> PHONE_NUMBERS_EQUAL ‚Äî   SQL-.   sqlite    . <br><br>    sqlite,  ,        .   ContactsProvider  ,      config_use_strict_phone_number_comparation,     . : <br><br><pre> <code class="plaintext hljs">&lt;bool name="config_use_strict_phone_number_comparation"&gt;true&lt;/bool&gt;</code> </pre> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt484876/">https://habr.com/ru/post/pt484876/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt484862/index.html">Migrando do AngularJS para o Angular7 por meio de um aplicativo h√≠brido</a></li>
<li><a href="../pt484866/index.html">Usando o Astra Linux em um computador embarcado ARM</a></li>
<li><a href="../pt484868/index.html">Como medir a melhoria da equipe? Parte 2</a></li>
<li><a href="../pt484870/index.html">Como o ingl√™s mudou a Ilona Mask por 20 anos</a></li>
<li><a href="../pt484874/index.html">"O seu especialista em TI est√° quebrado, traga um novo": como construir uma carreira em TI e n√£o enlouquecer</a></li>
<li><a href="../pt484878/index.html">No√ß√µes b√°sicas de design de n√≠vel: efeito de fluxo ou como n√£o deixar o jogador entediado</a></li>
<li><a href="../pt484882/index.html">Lan√ßamento do Windows Terminal Preview v0.8</a></li>
<li><a href="../pt484884/index.html">HIPEC. Anos de vida em vez de meses com tumores malignos da cavidade abdominal</a></li>
<li><a href="../pt484886/index.html">Estilo RTL 101 - Um guia detalhado sobre o estilo CSS RTL</a></li>
<li><a href="../pt484890/index.html">Restringindo o acesso aos atributos de dimens√£o no modelo tabular do SSAS</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>