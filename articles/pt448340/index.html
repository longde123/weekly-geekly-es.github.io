<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üöº ü§òüèΩ üë®‚Äçüé® Cria√ß√£o do jogo de 35MM. P√≥s Apocalipse na R√∫ssia üëµ ‚ö™Ô∏è üîπ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bom dia a todos, meu nome √© Sergey Noskov. Hoje eu gostaria de falar sobre a cria√ß√£o do meu primeiro projeto indie completo chamado 35MM, lan√ßado no S...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Cria√ß√£o do jogo de 35MM. P√≥s Apocalipse na R√∫ssia</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/448340/"><img src="https://habrastorage.org/webt/nd/lc/7g/ndlc7ge6rk_kvh7uq0ysdei1sqi.jpeg"><br><br>  Bom dia a todos, meu nome √© Sergey Noskov.  Hoje eu gostaria de falar sobre a cria√ß√£o do meu primeiro projeto indie completo chamado 35MM, lan√ßado no Steam em 2016.  A hist√≥ria √© obviamente longa e, desde ent√£o, v√°rios artigos e entrevistas sobre o tema do projeto j√° foram publicados, no entanto, n√£o havia descri√ß√£o detalhada do processo de desenvolvimento.  Al√©m disso, os aspectos t√©cnicos da implementa√ß√£o foram pouco tocados.  Na verdade, falaremos sobre isso. <br><br>  Vamos come√ßar com um pouco de fundo.  35MM √© uma aventura com uma vis√£o em primeira pessoa no cen√°rio de um p√≥s-apocalipse na R√∫ssia.  As pessoas - um simulador de caminhada.  O jogo nos conta a hist√≥ria da jornada de dois andarilhos pelas terras desertas deixadas pela civiliza√ß√£o.  A maior parte da popula√ß√£o morreu depois de uma doen√ßa terr√≠vel, e agora a natureza recupera seus pontos da humanidade.  Infelizmente, n√£o me lembro exatamente como nasceu a id√©ia deste projeto, mas definitivamente me lembro que naquela √©poca eu era um fervoroso f√£ do t√≥pico de perseguidores, jogos de metr√¥ e geralmente um ambiente atmosf√©rico.  As paisagens de cidades abandonadas, zonas industriais e aldeias sempre despertaram minha ansiedade e deleite.  N√£o sei que tipo de doen√ßa √© e como explicar esse amor, mas h√° muitos de n√≥s.  Em geral, essa paix√£o por esse t√≥pico foi suficiente para come√ßar a criar seu pr√≥prio mundo de pequenos jogos. <br><a name="habracut"></a><br><br><img src="https://habrastorage.org/webt/ro/01/jj/ro01jjdr6mpcdqso8mzkghc4dv4.jpeg"><br><br>  Como eu j√° tinha dois projetos pequenos (Light e Train), al√©m de experi√™ncia no mecanismo Unity, comecei a desenvolver um novo jogo nele.  Se n√£o me engano, naquela √©poca a quinta vers√£o do mecanismo j√° estava dispon√≠vel, mas at√© certo ponto sou um conservador (n√£o √© meu melhor tra√ßo profissional), ent√£o decidi permanecer na vers√£o 4.7.  Para um entendimento geral, existem muitas diferen√ßas significativas entre as vers√µes 4 e 5 do mecanismo, especialmente em termos de renderiza√ß√£o, ilumina√ß√£o e materiais.  O Unity 5 introduziu shaders fisicamente precisos que podem refletir corretamente a luz e exibir reflexos.  Em palavras simples - o brilho e as reflex√µes em materiais com esses shaders parecem mais naturais e atraentes.  Na vers√£o 4, os shaders b√°sicos eram muito mais simples, no entanto, escrever seus pr√≥prios shaders poderia melhorar significativamente a qualidade da imagem.  Falaremos sobre isso um pouco mais tarde.  √â claro que o desenvolvimento do jogo inclui muitos aspectos, al√©m de trabalhar no pr√≥prio mecanismo.  Para que o mecanismo tenha algo para amolar, √© necess√°rio conte√∫do: modelos, texturas, sons, scripts etc.  Tudo isso no final, vemos no monitor e ouvimos nas colunas.  E, claro, cada tipo de conte√∫do requer seu pr√≥prio software.  Para criar modelos 3D, usei o 3D max, para trabalhar com gr√°ficos 2D e criar texturas - Photoshop, para trabalhar com som - Adobe Audition, escrevi o c√≥digo no programa Monodevelop que acompanha o Unity.  Eu recomendo especialmente que voc√™ feche os olhos ou pule para o pr√≥ximo cap√≠tulo - o jogo est√° escrito em Javascript.  S√≥ shh, n√£o conte a ningu√©m.  S√≥ sei que para alguns isso √© de mau gosto e ningu√©m escreve em Javascript.  Em geral, as principais ferramentas s√£o selecionadas e o fluxo de trabalho est√° se afastando lentamente. <br><br><br><h4>  Como tudo come√ßou </h4><br>  Em algumas entrevistas, eu j√° mencionei que geralmente n√£o tenho um plano de desenvolvimento claro, mas apenas o quadro geral.  Portanto, frequentemente, a cria√ß√£o de locais ocorre espontaneamente e o design √© pensado em movimento.  Isso, √© claro, √© mais um sinal de menos do que um sinal de mais, mas h√° um lado positivo - √© muito divertido e voc√™ nunca sabe exatamente o que acontecer√° a seguir.  Acontece que o jogo at√© certo ponto vive sua pr√≥pria vida j√° nos est√°gios iniciais.  O desenvolvimento de 35MM come√ßou com a cria√ß√£o do primeiro local - uma casa de floresta abandonada e um terreno espa√ßoso com campos e florestas de con√≠feras. <br><br><img src="https://habrastorage.org/webt/kr/sb/cn/krsbcnewlw_cvsut4sthf26gl1a.jpeg"><br><br>  Para construir a superf√≠cie da terra terrane usado com 5-6 texturas de grama e terra.  O shader terrane padr√£o pinta a superf√≠cie com texturas diferentes usando a m√°scara RGBA, que criamos com um pincel no pr√≥prio mecanismo, e o resultado geralmente parece muito desfocado, as transi√ß√µes entre as texturas s√£o muito suaves e n√£o parecem naturais.  Para refinar esse ponto, o sombreador terrane foi alterado e uma m√°scara de deslocamento foi adicionada.  A textura em preto e branco "mudou" a m√°scara desenhada no terrane e criou bordas rasgadas e mais n√≠tidas, o que visualmente complicou ligeiramente a apar√™ncia da superf√≠cie. <br><br><img src="https://habrastorage.org/webt/ya/xj/ec/yaxjecb49aydjyn16wrezqwgtte.jpeg"><br><br><img src="https://habrastorage.org/webt/_q/yq/_b/_qyq_bril__wzoxhezidghk7sdo.jpeg"><br><br>  A superf√≠cie de nossa terra foi complementada por v√°rios tipos de grama na forma de pleins espalhados aleatoriamente.  A unidade tamb√©m possui um modo de outdoor (quando as plan√≠cies de grama sempre olham para o jogador), mas n√£o √© muito adequado para jogar com uma vis√£o em primeira pessoa, porque √© percept√≠vel como a grama "assiste" nossa c√¢mera.  Voc√™ deve sempre ter cuidado com a grama e adicion√°-la dentro de limites razo√°veis, pois esse prazer gera muitas chamadas e isso, por sua vez, afeta o desempenho.  Quanto mais chamadas, maior a carga no sistema do computador.  Mas n√£o esque√ßa que n√£o apenas os desafios aumentam a carga.  Existem v√°rias maneiras de diminuir o desempenho no jogo.  Al√©m da grama no ch√£o, para variar, foram espalhadas malhas com galhos e pedras, al√©m de uma s√©rie de adesivos com sujeira e vest√≠gios de rodas de carros. <br><br><img src="https://habrastorage.org/webt/8i/jp/u9/8ijpu9_rppnirhxukbnyfczgea0.jpeg"><br><br>  Depois de criar a superf√≠cie, v√° para a vegeta√ß√£o, √°rvores e arbustos.  Eu preferi plantar a parte principal da floresta (√°rvores con√≠feras) usando as ferramentas do pr√≥prio terrane - ou seja, com uma escova.  A vantagem desse m√©todo √© que ele √© feito de maneira r√°pida e f√°cil, al√©m disso, a uma grande dist√¢ncia, essa floresta √© transformada de malhas em outdoors, o que afeta muito a otimiza√ß√£o.  No entanto, perto da carga √© muito aumentada, porque, pelo que entendi, essas √°rvores n√£o rolam.  Talvez eu esteja errado e algu√©m me corrija.  Butching √© uma ferramenta muito importante para otimiza√ß√£o.  Grosso modo, essa √© uma combina√ß√£o de malhas com um material em uma malha comum, o que reduz significativamente o n√∫mero de chamadas de tra√ß√£o, respectivamente, reduz a carga.  Outro ponto negativo do assentamento no terreno √© a mesma posi√ß√£o das √°rvores, ou seja, todas elas s√£o criadas no mesmo √¢ngulo e essa uniformidade √© impressionante.  Nesse sentido, instalei manualmente alguns pinheiros, abetos e √°rvores de folha caduca em diferentes √¢ngulos e tamanhos, o que agregou variedade √† paisagem.  Os arbustos foram arranjados da mesma maneira. <br><br><img src="https://habrastorage.org/webt/yy/z-/vg/yyz-vgfhvbn27w1bi6enj3vpfoc.jpeg"><br><br><img src="https://habrastorage.org/webt/e1/rc/ew/e1rcewfivsfb3ob6gmhk7rjv-x4.jpeg"><br><br>  Para ser completo, resta lidar com o c√©u.  Para esta tarefa, foi utilizado um material skybox comum com seis texturas.  Houve tentativas de modificar o sombreador para que o c√©u parecesse din√¢mico, mas o resultado n√£o se justificou e essa ideia teve que ser abandonada.  Uma alternativa foi o uso de um sistema de part√≠culas com textura de nuvens e outdoors horizontais com interpola√ß√µes de movimento.  Tanto quanto me lembro, uma op√ß√£o semelhante foi usada no jogo Stalker, e de fato h√° muito mais em outros lugares. <br><br><img src="https://habrastorage.org/webt/15/zs/co/15zsco7qze7gwo7mtz-qjagsxdm.jpeg"><br><br><h4>  Ilumina√ß√£o </h4><br>  Na quarta vers√£o do mecanismo Unity, havia um modo muito conveniente para criar mapas de luz - mapeamento duplo de luz.  Existe uma op√ß√£o semelhante nas vers√µes atuais, mas ainda n√£o a estudei em detalhes.  O modo duplo nos permitiu desenhar sombra e brilho em tempo real a curta dist√¢ncia, mas √† medida que nos afast√°vamos da c√¢mera, tudo isso se transformou suavemente em mapas de luz cozidos, o que facilitou muito a tarefa do nosso hardware.  Em geral, usei esse m√©todo em todos os locais do jogo.  Como resultado, para cada local do meio, foi cozido um conjunto de 5 a 10 mapas de luz para o plano pr√≥ximo e uma quantidade semelhante para o distante (em segundo plano, mapas de luz tamb√©m foram usados, mas apenas com ambiente de ambiente). <br><br><img src="https://habrastorage.org/webt/rf/x1/mt/rfx1mtclxshah0ofoykqhftdj9a.jpeg"><br><br><img src="https://habrastorage.org/webt/fa/dt/vf/fadtvfm-928kih6ouhi3_axjpz8.jpeg"><br><br>  Em geral, em muitas √°reas, tentei usar a luz completamente cozida, com exce√ß√£o da luz do sol.  Luzes pontuais foram colocadas em locais para enfatizar acentos e mais luz.  Isso foi feito principalmente em salas onde pouca luz externa penetrava.  Em v√°rios lugares, √© claro, tamb√©m foram usadas l√¢mpadas em tempo de rampa com sombras: luz de um inc√™ndio, um candeeiro de mesa, um teto ou lumin√°ria de parede.  A prop√≥sito, ao trabalhar com ilumina√ß√£o, tive que lidar com um grande problema relacionado √†s l√¢mpadas Point e √†s sombras em tempo real.  Em algumas √°reas, o olhar da c√¢mera em uma fonte pontual de luz com sombras deu frisos e freios assustadores.  N√£o est√° totalmente claro por que a carga era t√£o alta, mas o criador de perfil naquele momento mostrou chamadas de escala fora de escala por uma fra√ß√£o de segundo.  Para corrigir a situa√ß√£o, o uso de duas lumin√°rias Spot direcionadas em dire√ß√µes opostas uma da outra ajudou.  Essa op√ß√£o acabou sendo menos pesada. <br><br><img src="https://habrastorage.org/webt/cn/0n/dm/cn0ndmoy7smmzdn1aaib9f3te3s.jpeg"><br><br><h4>  Modelos </h4><br>  A maioria dos modelos 3D do jogo foi criada de forma independente.  Algo foi feito com muito cuidado, com mapas normais e outras sutilezas, e algo foi criado √†s pressas para economizar tempo.  A maioria dos objetos foi criada em grupos e usou uma √∫nica textura de atlas.  Ou seja, em uma textura havia se√ß√µes, por exemplo, para um bloco de concreto, um sinal de tr√¢nsito, detritos de tijolos, uma escotilha de esgoto etc.  Isso permitiu que um material fosse usado para todos esses objetos e, consequentemente, permitiu que os objetos rissem.  Como lembramos, isso √© muito bom.  Alguns modelos foram fielmente baixados por mim da Internet, de bibliotecas gratuitas.  Basicamente, esses s√£o pequenos acess√≥rios para encher as salas, no entanto, tentei modificar um pouco todos esses modelos para que a semelhan√ßa n√£o fosse muito evidente.  Muitas vezes, notei ativos id√™nticos em jogos independentes, o que de certa forma influenciou minha percep√ß√£o, n√£o da melhor maneira.  O mais problem√°tico em termos de cria√ß√£o foi o transporte.  A modelagem de ve√≠culos com rodas do zero consome muito tempo e leva muito tempo.  Portanto, v√°rias c√≥pias dos carros foram compradas por mim na Asset Store. <br><br><img src="https://habrastorage.org/webt/_f/s1/c5/_fs1c5qh9mrgi2u8wiysjevdrdw.jpeg"><br><br><img src="https://habrastorage.org/webt/ey/yk/51/eyyk510atgkm5d0wrzlpdetox9k.jpeg"><br><br><img src="https://habrastorage.org/webt/kc/g9/62/kcg962k7ikvrkueqcmeijk73kzi.jpeg"><br><br>  Uma "m√∫sica" separada foi a cria√ß√£o de personagens.  Ainda √© um experimento.  Para aqueles que n√£o t√™m uma boa id√©ia de quanto trabalho √© necess√°rio para que um personagem apare√ßa capaz de existir de alguma forma no jogo, explicarei.  Um modelo de alto poli √© criado com todos os detalhes, bot√µes nas mangas, rugas no rosto, etc.  Um modelo de baixo poli do mesmo personagem √© criado com uma varredura de textura (no meu jogo, o n√∫mero de pol√≠gonos por personagem era, em m√©dia, de 5 a 8 mil).  Al√©m disso, um mapa normal, um mapa ambiente (sombreamento suave) √© removido do modelo de alto poli para o baixo de poli por manipula√ß√µes astutas ou descomplicadas.  Normalmente, do ambiente, fa√ßo um mapa difuso no Photoshop.  No mapa difuso no canal alfa, crie um mapa especular para criar brilho. <br><br><img src="https://habrastorage.org/webt/xo/en/kn/xoenknestj0mo76ow0xco-yvyu4.jpeg"><br><br><img src="https://habrastorage.org/webt/9s/v1/sr/9sv1sre0wuc7oryy9ug-u8ynqpo.jpeg"><br><br>  Para 2019, √© claro, j√° √© muito primitivo, mas por 16 anos e para o projeto indie foi bastante adequado. <br><br>  Al√©m disso, nosso persa precisa ser paquerado - para colocar ossos nele, devido aos quais ele pode mover seus membros, mover sua mand√≠bula, dobrar e dobrar os dedos, etc.  Bem, no final, tudo precisa ser animado.  Geralmente, um conjunto de anima√ß√µes com estados diferentes √© criado para o personagem: andando, correndo, em p√© ou sentado.  Mas fragmentos √∫nicos tamb√©m s√£o necess√°rios, por exemplo, no meu caso, para o parceiro de nosso her√≥i Petrovich, um grande n√∫mero de varia√ß√µes de a√ß√µes foi necess√°rio: abrir portas, examinar um mapa, uma luta com bandidos, lan√ßar uma bomba leve no n√≠vel Bor, etc.  Tudo isso teve que ser animado √† m√£o, o que, √© claro, √© muito marcante em sua falta de jeito.  Em geral, a anima√ß√£o manual de movimentos humanos √© uma tarefa muito dif√≠cil e extremamente dif√≠cil de alcan√ßar um resultado plaus√≠vel.  Portanto, o motion cap √© a solu√ß√£o mais adequada para esta tarefa.  At√© onde eu sei, agora essa op√ß√£o √© mais barata e mais r√°pida que o trabalho do animador, embora os dados recebidos precisem ser processados ‚Äã‚Äãe "limpos" manualmente. <br><br><img src="https://habrastorage.org/webt/gv/b8/ir/gvb8irricyi1lcirwgwisjcjfkq.jpeg"><br><br><h4>  Shaders </h4><br>  Esclare√ßo imediatamente que entendi a escrita shader naquela √©poca muito superficialmente.  Meu treinamento foi principalmente na an√°lise de exemplos prontos e seu refinamento.  Peguei v√°rias op√ß√µes da rede, alterei par√¢metros, adicionei novas ou removi as antigas e verifiquei como isso afeta o resultado.  Verificou-se que esta √© uma atividade extremamente emocionante.  De particular interesse para mim foi o manuseio de diferentes canais de textura como uma m√°scara.  Em alguns casos, tentei ajustar a quantidade m√°xima de informa√ß√µes em uma textura e us√°-la.  No come√ßo do artigo, mencionei as diferen√ßas entre a quarta e a √∫ltima vers√£o do Unity e, especificamente, a presen√ßa de sombreamento fisicamente correto nas √∫ltimas.  Tentei eliminar essa falha sozinho e o efeito fresnel foi adicionado ao shader padr√£o com um mapa especular, cubmap e normal.  Essa √© uma caracter√≠stica dos materiais refletivos, nos quais superf√≠cies inclinadas em rela√ß√£o √† nossa vis√£o refletem o ambiente (ou cubmap neste caso) com mais for√ßa e geralmente parecem mais leves e contrastantes.  Isso √© muito percept√≠vel em uma bola brilhante, cujas bordas parecem mais brilhantes que o centro.  Consegui repetir esse efeito, al√©m de adicionar a capacidade de pintar o cubmap no material, o que geralmente podemos ver em superf√≠cies reflexivas, mas √°speras.  Esse shader me serviu completamente e foi aplicado √† maioria dos materiais do jogo. <br><br><img src="https://habrastorage.org/webt/kz/ka/kj/kzkakjqxlpr1izaz4ffc3h7kdac.jpeg"><br><br><img src="https://habrastorage.org/webt/qp/go/0m/qpgo0m9kwezqi0nraikd-lbxuro.jpeg"><br><br>  A segunda experi√™ncia interessante foi a cria√ß√£o de um shader para a pele dos personagens.  A base foi um c√≥digo encontrado na Internet que permite usar uma textura gradiente, respons√°vel pela for√ßa e cor da ilumina√ß√£o que afeta o modelo.  Uma textura semelhante com uma tonalidade avermelhada no meio tornou poss√≠vel imitar a pele humana, que, por assim dizer, √© um pouco transl√∫cida, ou seja, possui espessura pr√≥pria, na qual a luz √© espalhada suavemente.  O efeito n√£o √© perfeito, mas parece melhor do que o pl√°stico colidido especular padr√£o. <br><br><img src="https://habrastorage.org/webt/bd/x9/vq/bdx9vqxqwtq9mpfixc38u3bl0bi.jpeg"><br><br>  Al√©m dos shaders acima, muitas op√ß√µes secund√°rias com efeitos individuais foram criadas no processo.  Por exemplo, um shader po√ßa com um cubmap e uma deforma√ß√£o difusa do mapa.  Como √© muito caro usar reflexos reais para po√ßas e eu n√£o queria usar uma renderiza√ß√£o na textura (√© quando o quadro √© salvo na textura e aplicado no material, durante o qual, por exemplo, podem ser feitas distor√ß√µes do ar quente), decidi fazer distor√ß√µes simples da textura da terra, esticado sobre uma po√ßa.  O efeito foi bastante agrad√°vel e n√£o esticou o ferro.  Ali√°s, um shader com uma renderiza√ß√£o de textura foi usado para distorcer o ar de l√¢mpadas de querosene e uma fogueira.  Parece ter distorcido o calor do recurso Detonator.  Al√©m disso, para simular raios de luz volum√©tricos, um shader de v√©rtice foi criado com o efeito Soft Particle e o efeito de luz da borda (quando olhamos pol√≠gonos em √¢ngulo, a malha entra em alfa).  Essa √© uma maneira cl√°ssica e j√° barbada de implementa√ß√£o.  Agora, para a nova Unidade, existe uma op√ß√£o interessante que funciona com base no p√≥s-efeito e permite que voc√™ atraia raios reais de luz, mesmo levando em conta as sombras. <br><br>  Outro ponto a ser destacado √© o conjunto de shaders feitos para simular superf√≠cies molhadas.  O jogo tem um epis√≥dio em que, em algum momento, come√ßa uma forte chuva e alguns materiais adquirem suavemente um brilho caracter√≠stico.  O principal efeito foi aplicado ao terreno, no qual, como no caso das po√ßas, a textura difusa come√ßou a distorcer.  Vazamentos de √°gua tamb√©m apareceram nas janelas das casas.  Bem, o chip mais "molhado" foram as gotas caindo nas lentes.  Ali, na verdade, fiquei atormentado por d√∫vidas, porque o her√≥i n√£o tinha √≥culos nem capacete, e como as gotas t√£o intrusivamente aparecem na tela n√£o eram claras.  No entanto, visualmente gostei tanto do efeito que simplesmente n√£o consegui recus√°-lo. <br><br><img src="https://habrastorage.org/webt/ei/-x/u2/ei-xu2rezxy8cw3icshvbrbqev0.jpeg"><br><br>  Ent√£o, passamos suavemente para os p√≥s-efeitos.  Falando em gotas na tela, tudo √© simples: algumas gotas da textura se multiplicam e se movem para baixo em velocidades diferentes.  Paralelamente, as ondas (texturas gradientes) est√£o se movendo para baixo, que s√£o multiplicadas, cada uma por seu pr√≥prio grupo de gotas.  Ent√£o a coisa toda √© resumida, levemente exibida na ‚Äúdifus√£o‚Äù, por assim dizer, mas √© usada principalmente como uma m√°scara para mudar as coordenadas.  Como resultado, nossa imagem √© distorcida pela refra√ß√£o das gotas de √°gua.  O principal conjunto de p√≥s-efeitos que foram sempre ou opcionais na c√¢mera (se o player os ativou ou desativou) √© anti-aliasing, SSAO, Bloom, Aberration, Vignette, Sun Shafts.  Todos esses s√£o os efeitos padr√£o do Unity, mas o SSAO foi modificado para que a renderiza√ß√£o de sombras √† dist√¢ncia fosse reduzida a zero, porque √† dist√¢ncia no nevoeiro os pontos escuros das sombras pareciam estranhos.  O efeito de aberra√ß√£o tamb√©m foi alterado (esta √© a distor√ß√£o de cor da imagem ao usar lentes, algo como contornos de cores nas bordas dos objetos) .O efeito padr√£o do Unity pintou as bordas verde-bord√¥ dos objetos (uma solu√ß√£o bastante estranha na minha opini√£o).  De fato, na maioria das vezes as cores est√£o mais pr√≥ximas do amarelo-vermelho-azul, o que eu percebi.  Outro efeito permanente foi a corre√ß√£o de cores feita por conta pr√≥pria.  O efeito padr√£o da Unidade me parecia muito intensivo em recursos, de modo que o seu pr√≥prio e simplificado foi realizado.  Basicamente, ele criou o efeito de tonmapping e mudou ligeiramente o esquema de cores para um mais frio.  Escolher uma paleta de cores para uma imagem √© sempre uma tarefa dif√≠cil, dif√≠cil de determinar.  Acontece que voc√™ pode gostar de op√ß√µes completamente opostas e tomar uma decis√£o √© extremamente dif√≠cil.  Neste projeto, decidi por cores opacas e frias.  Para muitos, ela parecia desbotada demais, mas parece-me que ela transmite com muita precis√£o o clima que tentei refletir em meu jogo, o clima de tristeza, des√¢nimo e solid√£o. <br><br><img src="https://habrastorage.org/webt/qv/er/iv/qverivmj5x-rorvqc0vgmmsrtpo.jpeg"><br><br><img src="https://habrastorage.org/webt/4i/uz/2k/4iuz2kxafowra3gr_cckxkngpzq.jpeg"><br><br><h4>  E o c√≥digo? </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mencionei repetidamente em uma entrevista que sempre estava longe do t√≥pico de programa√ß√£o e me concentrei mais no componente visual. Comecei a escrever o primeiro c√≥digo completo enquanto trabalhava no jogo "Train", ent√£o, quando desenvolvi 35MM, j√° tinha algumas habilidades. Em geral, o g√™nero da busca me pareceu muito adequado para entender a programa√ß√£o no meu n√≠vel inicial. A maioria das a√ß√µes no jogo √© baseada em gatilhos. Um objeto entra no gatilho (um cubo com um colisor) e algo come√ßa a acontecer, por exemplo, uma cena cortada √© iniciada. No roteiro, como no roteiro de uma performance teatral, √© descrito linha por linha quando e o que acontece - agora a c√¢mera do jogador desliga, a c√¢mera de cena √© ligada, o personagem aparece no quadro, a anima√ß√£o da conversa come√ßa etc. Acredito que existem ferramentas que facilitam todo esse processo (acreditoporque n√£o foi profundo), mas essa op√ß√£o ainda me parece mais compreens√≠vel, porque voc√™ mesmo controla todos os eventos.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O movimento do nosso parceiro no jogo foi implementado usando gatilhos, que eram pontos de verifica√ß√£o de sua rota. Se voc√™ pressionar o gatilho, alguma nova anima√ß√£o poder√° ser ativada ou o personagem poder√° dizer algo. </font></font><br><br><img src="https://habrastorage.org/webt/ts/r9/rz/tsr9rz9e2jumsgryopdvzs_og4m.jpeg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Este m√©todo foi usado em todos os n√≠veis, exceto o √∫ltimo. No local final da cidade, se a procur√°ssemos com um parceiro, ele n√£o mais nos levaria ao longo do caminho, mas correria atr√°s de n√≥s. L√°, um controlador baseado no NavMesh (um sistema que permite que um objeto procure um caminho para um destino e v√° para ele) j√° foi usado.</font></font><br><br><img src="https://habrastorage.org/webt/cx/my/4i/cxmy4ix45uvqvn4auqkvlk0ykby.jpeg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As coisas ficaram mais dif√≠ceis com o urso no segundo local do jogo. Foi utilizado um controlador que funciona apenas com um corpo r√≠gido (corpo f√≠sico), de modo que a fera era est√∫pida e freq√ºentemente colidia com √°rvores e outros objetos. O material f√≠sico com atrito zero nos permitiu evitar congestionamentos graves, e o urso finalmente escorregou e continuou nos perseguindo. Aqui, e em geral nas √°reas em que voc√™ pode morrer, encontrei o problema mais s√©rio para mim - o lan√ßamento da morte e o rein√≠cio. No momento da morte, era necess√°rio levar em considera√ß√£o todos os estados atuais do personagem: a lanterna est√° acesa, o cart√£o est√° aberto, a faca est√° ativada etc. Tamb√©m era necess√°rio preservar os valores de sa√∫de e todos os recursos e, em seguida, tudo o que era ativado, era necess√°rio desativar e iniciar a anima√ß√£o da c√¢mera caindo. Depois de escurecer a tela, era necess√°rio retornar tudo e ler os valores armazenados.De fato, n√£o h√° grandes dificuldades com a abordagem correta, mas no meu caso muitos insetos apareceram: ou a faca permaneceu em minhas m√£os diante dos meus olhos quando o urso atacou, ent√£o o cart√£o n√£o foi embora - tudo assim. Al√©m disso, voc√™ nunca sabe como um jogador pode liderar-se neste momento, para onde ele corre e em que condi√ß√µes um urso pode liderar, o que pode ficar preso em algum lugar ou, por exemplo, nos atacar pelo muro. Em geral, existem muitas nuances que voc√™ n√£o previr√° imediatamente.nos atacar atrav√©s da parede. Em geral, existem muitas nuances que voc√™ n√£o previr√° imediatamente.nos atacar atrav√©s da parede. Em geral, existem muitas nuances que voc√™ n√£o previr√° imediatamente.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A intera√ß√£o do nosso personagem com os objetos foi realizada usando o raio Raycast. Todos os objetos interativos foram marcados com a tag Subject e, quando o feixe os atinge, ativa a luz de fundo (a malha √© um indicador com arestas real√ßadas) e inclui um script que j√° √© respons√°vel por quais a√ß√µes podemos executar com esse objeto, por exemplo, pegar um objeto, ler uma nota ou abra a porta.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para a intera√ß√£o, inicialmente havia planos de fazer m√£os completas que alcan√ßariam objetos, isso criaria um efeito mais √≥bvio da presen√ßa. Mas essa op√ß√£o representou para mim a grande dificuldade de implementa√ß√£o e a perspectiva de ter todo um "pacote" de bugs no futuro, ent√£o havia apenas m√£os que carregavam itens j√° selecionados. H√° uma casa pr√©-fabricada com pequenas al√ßas na frente da c√¢mera, na qual todos os objetos j√° est√£o presentes (c√¢mera, faca, machado etc.). Quando voc√™ seleciona um objeto durante o jogo, o desejado √© ativado e os desnecess√°rios s√£o desativados.</font></font><br><br><img src="https://habrastorage.org/webt/kp/my/wh/kpmywhdleoxjlpvbey5nxq6iexa.jpeg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um ponto interessante foi relacionado √† anima√ß√£o dos personagens conversando. </font><font style="vertical-align: inherit;">A t√©cnica √© primitiva, mas eu mesma pensei nisso, orgulhosa, sim. </font><font style="vertical-align: inherit;">A princ√≠pio, pensei que, ao comunicar os personagens, teria que iniciar a anima√ß√£o da abertura da mand√≠bula em ordem aleat√≥ria a cada frase. </font><font style="vertical-align: inherit;">Mas me ocorreu que um script podia ler o n√≠vel de volume da trilha sonora no momento da reprodu√ß√£o e transferi-lo para um valor flutuante, que j√° √© respons√°vel pela posi√ß√£o da mand√≠bula do her√≥i. </font><font style="vertical-align: inherit;">Por fim, a mand√≠bula se abriu automaticamente ao pronunciar palavras ao ritmo do arquivo de som. </font><font style="vertical-align: inherit;">Isso simplificou bastante a tarefa, embora parecesse muito "m√°quina".</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Otimiza√ß√£o </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A otimiza√ß√£o √© uma parte muito importante do desenvolvimento, da qual depende qu√£o suavemente o jogo funcionar√° em diferentes hardwares. Vou abordar a otimiza√ß√£o do componente visual do projeto. Existem v√°rios m√©todos √∫teis para isso: grupos de filas, o abate √© oclu√≠do, cortando objetos √† dist√¢ncia. O grupo LOD deve ser usado no caso de objetos high-poly de alta densidade. Para fazer isso, crie v√°rias malhas com um n√∫mero diferente de pol√≠gonos. Quanto mais a c√¢mera estiver do assunto, mais simplificado o modelo ser√° desenhado no quadro. Por exemplo, para 35MM, os lods foram usados ‚Äã‚Äãem modelos de carros, personagens e algumas √°rvores. Geralmente eram feitos 2-3 fil√µes, entre os quais cada malha subsequente tinha quase 2 vezes menos pol√≠gonos. Para maior clareza: o modelo original do carro √© composto por 15 mil pol√≠gonos, o primeiro LOD j√° possui cerca de 9 toneladas.(o n√∫mero de nervuras diminui, pe√ßas pequenas como dobradi√ßas e pe√ßas internas s√£o removidas), o segundo LOD j√° chega a 5 toneladas (ma√ßanetas das portas, espelhos dentro da cabine s√£o removidos, a geometria fica ainda mais f√°cil). Mais na mesma linha. Para os lods, a prop√≥sito, um truque interessante foi usado. Quando assamos mapas de luz para um objeto com filamentos, precisamos assar para os dois objetos. Para reduzir o tempo de cozimento e economizar mem√≥ria do sistema, usei um script que transferia automaticamente o mapa de luz atribu√≠do com todas as coordenadas do objeto pai (zero LOD) para todos os outros lods.um truque interessante foi usado. Quando assamos mapas de luz para um objeto com filamentos, precisamos assar para os dois objetos. Para reduzir o tempo de cozimento e economizar mem√≥ria do sistema, usei um script que transferia automaticamente o mapa de luz atribu√≠do com todas as coordenadas do objeto pai (zero LOD) para todos os outros lods.um truque interessante foi usado. Quando assamos mapas de luz para um objeto com filamentos, precisamos assar para os dois objetos. Para reduzir o tempo de cozimento e economizar mem√≥ria do sistema, usei um script que transferia automaticamente o mapa de luz atribu√≠do com todas as coordenadas do objeto pai (zero LOD) para todos os outros lods.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O segundo m√©todo de otimiza√ß√£o √© o Oclusion Culling. Esse √© um mecanismo no qual tudo o que n√£o est√° no campo de vis√£o da c√¢mera ou √© fechado por outro objeto √© cortado. Por exemplo, quando entramos na sala, atr√°s da parede, n√£o vemos mais muitos objetos na rua e, portanto, n√£o h√° necessidade de gastar recursos em renderiz√°-los.</font></font><br><br><img src="https://habrastorage.org/webt/j1/_y/tk/j1_ytkv-3hkd3m8m-xbewf8thzw.jpeg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Outra maneira √∫til de simplificar a renderiza√ß√£o √© recortar objetos √† dist√¢ncia. </font><font style="vertical-align: inherit;">Esta √© a primeira op√ß√£o que conheci desde a √©poca do projeto ‚ÄúLight‚Äù. </font><font style="vertical-align: inherit;">Um script est√° pendurado na c√¢mera que ajusta sua dist√¢ncia de renderiza√ß√£o para cada camada. </font><font style="vertical-align: inherit;">No meu caso, tr√™s categorias de camadas foram criadas especialmente, com pequenos objetos (utens√≠lios dom√©sticos, martelos, tijolos e pequenos detritos), com tamanhos m√©dios e ligeiramente superiores √† m√©dia (bules, arbustos, vasos de flores, pequenos postes de luz etc.). </font><font style="vertical-align: inherit;">Foram atribu√≠das tr√™s categorias a dist√¢ncias: 40, 80 e 120 metros. </font><font style="vertical-align: inherit;">Uma vez al√©m da dist√¢ncia especificada, a c√¢mera parou de renderizar o objeto correspondente. </font><font style="vertical-align: inherit;">A op√ß√£o √© muito conveniente e eficaz, j√° que pequenos objetos n√£o podem mais ser vistos de longe e, portanto, renderiz√°-los n√£o faz sentido.</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Som </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A maioria dos sons do jogo foi retirada de bibliotecas gratuitas da Internet. Geralmente, eu baixava as op√ß√µes necess√°rias e as combinava e misturava no Adobe Audition. Em geral, n√£o h√° muito o que dizer sobre essa parte do trabalho, porque √© um processo bastante rotineiro e chato e n√£o √© particularmente atraente para mim. A prop√≥sito, o trabalho de introdu√ß√£o de sons, pontua√ß√£o de cenas cortadas, ajuste de arquivos de som para que o som desejado seja reproduzido no momento certo - tudo isso provavelmente levou um quarto do tempo total trabalhando no jogo. O √∫nico momento agrad√°vel foi a introdu√ß√£o da m√∫sica, na qual o compositor legal e extremamente talentoso Dmitry Nikolaev trabalhou. Estou muito satisfeito com o que ele fez, porque, em geral, eu n√£o sabia exatamente o que queria ouvir. Mas Dmitry sentiu o clima muito bem,que foi estabelecido no projeto e implementado na forma de ambiente atmosf√©rico. Aconteceu algo fant√°stico, misterioso e mel√≥dico.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Outro passo interessante foi trabalhar com personagens de dublagem. Apesar das cr√≠ticas de fora, ainda estou satisfeito com o resultado e acho que os atores fizeram seu trabalho muito bem. A prop√≥sito, os personagens principais dublados por Vsevolod Petrykin e Alexander Bragi, pelos quais muitos agradecem a eles.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em geral, n√£o havia problemas s√©rios com o som, embora, ap√≥s o lan√ßamento, um bug raro fosse descoberto que eu ainda n√£o conseguia superar, porque ainda n√£o entendia sua natureza. </font><font style="vertical-align: inherit;">√Äs vezes, parte dos sons deixava de tocar ou soava com algum efeito de eco forte. </font><font style="vertical-align: inherit;">Ao falar com um her√≥i, uma voz pode desaparecer repentinamente e, do mesmo modo, recuperar-se repentinamente. </font><font style="vertical-align: inherit;">Havia conjecturas associadas a uma grande carga e a um grande n√∫mero de sons tocando ao mesmo tempo. </font><font style="vertical-align: inherit;">Tamb√©m havia suposi√ß√µes sobre a conex√£o do bug com as zonas de reverb, mas isso n√£o √© exato. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Provavelmente √© tudo. </font><font style="vertical-align: inherit;">J√° faz muito tempo desde o desenvolvimento, algumas coisas foram esquecidas e outras se tornaram completamente irrelevantes, mas espero que o artigo seja √∫til para algu√©m e possa fornecer respostas para algumas perguntas. </font><font style="vertical-align: inherit;">Obrigado a todos e boa sorte!</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt448340/">https://habr.com/ru/post/pt448340/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt448330/index.html">N√∫meros aleat√≥rios e redes descentralizadas: uma aplica√ß√£o pr√°tica</a></li>
<li><a href="../pt448332/index.html">Iniciando adeptos de TI: mostre sua for√ßa em um recife</a></li>
<li><a href="../pt448334/index.html">Quando a produtividade de algu√©m desperta interesse</a></li>
<li><a href="../pt448336/index.html">Semin√°rio ‚ÄúNuvens h√≠bridas - pr√≥s e contras: o que preparar para os neg√≥cios e a TI‚Äù - 25 de abril de Moscou</a></li>
<li><a href="../pt448338/index.html">Quebrando os fundamentos do C #: alocando mem√≥ria para um tipo de refer√™ncia na pilha</a></li>
<li><a href="../pt448342/index.html">MyDrops - TWS de baixo custo com bom som e Bluetooth confi√°vel</a></li>
<li><a href="../pt448346/index.html">Do GNU ao Doom: anunciado o TechTrain 2019</a></li>
<li><a href="../pt448350/index.html">Implementa√ß√£o de dicion√°rio em Python</a></li>
<li><a href="../pt448352/index.html">Empresa chata cavar√° um t√∫nel em Las Vegas</a></li>
<li><a href="../pt448354/index.html">GraphQL Voyager como uma ferramenta para encontrar vulnerabilidades</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>