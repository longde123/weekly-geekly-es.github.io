<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üé∞ üõê ‚è™ Playrix CI / CD: c√≥mo construimos y probamos nuestros juegos üí¥ üßíüèª üç¨</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="El equipo debe centrarse en crear juegos hermosos y exitosos, para todo lo dem√°s hay CI. 

 ¬øD√≥nde aplicamos CI? ¬øQu√© enfoques y conceptos utilizamos?...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Playrix CI / CD: c√≥mo construimos y probamos nuestros juegos</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/playrix/blog/479966/">  El equipo debe centrarse en crear juegos hermosos y exitosos, para todo lo dem√°s hay CI. <br><br>  ¬øD√≥nde aplicamos CI?  ¬øQu√© enfoques y conceptos utilizamos?  ¬øPor qu√© compilar y probar compilaciones?  La historia detallada sobre CI y c√≥mo est√° organizada en Playrix dibujar√° un curso de conferencias.  Debajo del corte: un breve apret√≥n y algunos acentos. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b4e/54d/ab2/b4e54dab26c1357b27e3e31b88c9378d.png"></div><a name="habracut"></a><br>  Hola <br><br>  Primero, un peque√±o calentamiento: ¬øqu√© es la integraci√≥n continua?  Si el equipo usa el repositorio y recopila compilaciones nocturnas, ¬øya es CI?  ¬øCu√°l es la diferencia entre implementaci√≥n continua y entrega?  Es casi sin importancia.  Detalles: para un c√≠rculo reducido de especialistas.  Si desea involucrar a toda la empresa en alg√∫n proceso, invente un nombre simple y bueno para ello.  En Playrix, llamamos a todos estos enfoques CI.  Esta es una marca tan local y un logotipo genial: <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ebe/d97/d8e/ebed97d8e7a2fff88508b8e73c6b0e97.png" width="500"></div><br><h2>  Idea </h2><br>  CI no es un objetivo, es una herramienta.  Debe haber un objetivo que desee alcanzar con la integraci√≥n continua, un problema que debe resolverse.  Sucede que los procesos de desarrollo y lanzamiento en un equipo se basan en el principio de "rezado y en producci√≥n".  A veces est√° justificado, pero con poca frecuencia. <br><br>  Formulamos nuestro objetivo de la siguiente manera: minimizar la probabilidad de problemas de integraci√≥n, minimizar los recursos necesarios para corregir los errores encontrados, reducir el tiempo de los equipos de desarrollo de proyectos para apoyar y apoyar los procesos de CI. <br>  CI es la automatizaci√≥n de procesos de compilaci√≥n, pruebas de c√≥digo y su entrega a diversos entornos, automatizaci√≥n de procesos de desarrollo rutinarios, integraci√≥n mutua de servicios que todos usamos. <br><br>  La idea est√° en un sistema que recolecta autom√°ticamente todo, lo hace a menudo, prueba y entrega una compilaci√≥n, y tambi√©n apunta a un informe conveniente punto por punto si algo sali√≥ mal. <br><br><h2>  ¬øD√≥nde aplicamos CI? </h2><br><ul><li>  Motor y utilidades, </li><li>  nuestros juegos para todas las plataformas, </li><li>  c√≥digo de servidor </li><li>  an√°lisis, servicios de marketing, diversos automatismos, servicios de CI, </li><li>  La infraestructura. </li></ul><br>  Eso est√° en todas partes o casi en todas partes. <br><br>  Ensamblaje y prueba de contenedores, implementaciones autom√°ticas en pruebas, puesta en escena y producci√≥n, actualizaciones de Rolling y Canary: todo esto lo tenemos y m√°s aplicable para servicios y aplicaciones web.  Hoy nos concentraremos en CI para juegos: crea compilaciones, pru√©balas y entr√©galas. <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e87/bab/b31/e87babb31e40c7d90e3994f45be77792.png" width="500"></div><br><h2>  Paradigmas </h2><br>  Para lograr los objetivos establecidos anteriormente, debe resolver varios problemas.  A continuaci√≥n se muestra un plan que estamos siguiendo cuando automatizamos alg√∫n proceso de desarrollo, por ejemplo, ensamblar un cliente de juegos m√≥viles.  Es muy conveniente tener una lista de preguntas, respondiendo a las cuales, puede resolver cualquier problema que recaiga en el equipo de CI. <br><br><ul><li><h3>  Documentaci√≥n </h3></li></ul><br>  Las instrucciones de montaje de la compilaci√≥n son documentaci√≥n, una descripci√≥n de nuestro proceso automatizado.  A menudo, dicha documentaci√≥n est√° en la cabeza de los programadores.  Si un equipo tiene un s√∫per especialista en compilaciones de edificios y sin √©l, nadie puede construir una compilaci√≥n r√°pida y sin errores: es hora de cambiar algo, no habr√° una presentaci√≥n. <br><br>  Bueno, si dicha documentaci√≥n se enmarca en forma de script: ingres√© una l√≠nea de comando y un conjunto de par√°metros en una m√°quina con un entorno preparado; obtuve una compilaci√≥n. <br><br>  La mejor documentaci√≥n del proceso es el c√≥digo <s>cat</s> .  Incluso si por alguna raz√≥n necesita repetir la operaci√≥n manualmente, siempre puede hacerlo examin√°ndolo. <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bc1/b35/41c/bc1b3541c1eaf585466131dfc966a466.png" width="500"></div><ul><li><h3>  Registro </h3></li></ul><br>  El registro de compilaci√≥n le permite decir siempre con certeza: qui√©n, cu√°ndo, de qu√© compromiso y con qu√© resultado se recopil√≥ esta o aquella compilaci√≥n.  Ayer la construcci√≥n estaba a punto de hacerlo, pero hoy no.  Buscamos en el registro, encontramos la primera compilaci√≥n del disquete, vemos la lista de confirmaciones que llegaron all√≠: ganancias. <br><br>  La revista es a√∫n m√°s √∫til cuando se trata, por ejemplo, del c√≥digo del servidor.  Si no hay informaci√≥n sobre qui√©n actualiz√≥ el producto y cu√°ndo, en el caso general no se sabe qu√© c√≥digo est√° funcionando actualmente all√≠.  Y a veces es muy importante, muy. <br><br>  Puede mantener dicho diario en el libro mayor, preferiblemente en una tabla o wiki.  La lista de compilaciones en el sistema CI no tiene precio. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4dc/a88/26c/4dca8826cad8ae341be5df436c3fcab4.png"></div><br><ul><li><h3>  Seguridad </h3></li></ul><br>  Cuando se trata de construir una compilaci√≥n y desplegarla en alg√∫n tipo de entorno, siempre surge la pregunta: ¬ød√≥nde almacenar las contrase√±as de inicio de sesi√≥n / acceso?  Por lo general, necesitan mucho: al repositorio para descargar los datos de origen, al almacenamiento de archivos para completar los recursos del juego, a HockeyApp para enviar personajes, al servidor para actualizar el c√≥digo, etc. <br><br>  Sucede que todos los accesos necesarios se almacenan en el repositorio.  Existe la hip√≥tesis de que esto no es muy bueno.  A menudo puede ver el campo "ingresar contrase√±a", por ejemplo, en Jenkins, donde el autor de la compilaci√≥n ingresa los caracteres ocultos. <br><br>  Recordar todas las contrase√±as de memoria es una buena habilidad.  Nuestro propio servidor CI recibe los accesos necesarios seg√∫n el ensamblaje.  Por lo general, estos son tokens de corta duraci√≥n que se generan al comienzo de la compilaci√≥n y otorgan derechos m√≠nimos exactamente donde implementamos algo o donde leemos algo. <br><br>  La administraci√≥n centralizada del ensamblaje y la implementaci√≥n le permite resolver el problema de diferenciar los derechos de acceso a la infraestructura.  ¬øPor qu√© dar acceso a alguien al servidor si solo puede dar acceso al ensamblaje de la compilaci√≥n correspondiente que realiza la operaci√≥n necesaria en este servidor?  Y dado que hay una compilaci√≥n, entonces tenemos documentaci√≥n y registro, bueno, ya entiendes. <br><br><ul><li><h3>  Trazabilidad </h3></li></ul><br>  Por lo general, quedan muchos rastros durante el tiempo de construcci√≥n.  No, no as√≠: durante la construcci√≥n, es necesario dejar tantos rastros como sea posible.  En el repositorio, en el rastreador de tareas, en el sistema de distribuci√≥n de compilaci√≥n.  En todas partes, donde sea que se encuentre con una compilaci√≥n, debe haber rastros que lo lleven a completar la informaci√≥n al respecto. <br><br>  Estos rastros no necesitan ser barridos, por el contrario, deben dejarse cuidadosamente y conservarse cuidadosamente.  Adem√°s, le contar√© m√°s sobre esto, pero primero debemos recopilar nuestra compilaci√≥n.  Vamos <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/75c/436/e91/75c436e91724a70d5442af7c6432516d.png" width="500"></div><h2>  Ganchos de precompromiso </h2><br>  Nuevamente, la idea es un sistema que recolecta, prueba e informa todo.  Pero, ¬øpor qu√© construir una compilaci√≥n si no puedes construirla? <br><br>  Todos los desarrolladores de nuestros juegos tienen ganchos de confirmaci√≥n previa instalados, es decir  Un conjunto de comprobaciones que se realizan cuando se intenta confirmar algo.  Las comprobaciones solo se ejecutan para archivos modificados, pero implementamos un sistema de b√∫squeda de dependencia cruzada muy astuto para verificar tambi√©n todo el contenido relacionado.  Es decir  Si el artista agreg√≥ una textura, los ganchos comprobar√°n que no se hayan olvidado de registrarla donde sea necesario y que nunca la hayan sellado. <br><br>  Resulta que los ganchos capturan una parte significativa de peque√±os errores.  Ahorran los recursos del sistema de compilaci√≥n y ayudan al desarrollador a solucionar r√°pidamente el problema: ve un mensaje que dice en detalle qu√© sali√≥ mal.  Y no necesita cambiar entre tareas: literalmente solo hizo cambios y est√° en contexto.  El tiempo de correcci√≥n de errores es m√≠nimo. <br><br>  Nos gust√≥ tanto que incluso creamos un sistema que verifica si se hicieron ganchos para una confirmaci√≥n que ingres√≥ al repositorio.  De lo contrario, el autor de dicha confirmaci√≥n recibir√° autom√°ticamente una tarea pidi√©ndole que los configure e instrucciones detalladas sobre c√≥mo hacerlo. <br><br>  Los ganchos est√°n estandarizados para todos los proyectos.  El n√∫mero de pruebas personalizadas es m√≠nimo.  Hay una personalizaci√≥n conveniente, incluso seg√∫n el usuario que se est√© ejecutando: esto es muy conveniente para probar pruebas. <br><br><h2>  Construir </h2><br>  Para ver el problema en la compilaci√≥n lo antes posible, debe recopilar y probar estas compilaciones con la mayor frecuencia posible.  Los clientes de nuestros juegos se re√∫nen para todas las plataformas, para cada commit, para todos los proyectos.  Probablemente hay algunas excepciones, pero no muchas. <br><br>  Por lo general, un cliente, especialmente uno m√≥vil, tiene varias versiones diferentes: con y sin trampas, con firma diferente, etc.  Para cada confirmaci√≥n, recopilamos compilaciones "regulares", que los desarrolladores y evaluadores usan constantemente. <br><br>  Hay compilaciones que se usan muy raramente, por ejemplo, la compilaci√≥n ios de la tienda, solo una vez en un env√≠o, es decir  aproximadamente una vez al mes.  Sin embargo, creemos que todas las compilaciones deben recopilarse regularmente.  Si se produce un problema con este tipo de ensamblaje, en el lado del desarrollo o la infraestructura, el equipo del proyecto lo sabr√° no el d√≠a de la entrega, sino mucho antes, y podr√° responder y solucionar el problema con anticipaci√≥n. <br><br>  Como resultado, tenemos una regla simple: cualquier compilaci√≥n se inicia al menos una vez al d√≠a.  El equipo de desarrollo del proyecto se entera de la presencia de cualquier problema en cualquier plataforma en el peor de los casos a la ma√±ana siguiente despu√©s de que este problema apareciera en el repositorio. <br><br>  Tal frecuencia de ensambles y pruebas requiere un enfoque especial para optimizar su tiempo de ejecuci√≥n. <br><br><ul><li>  Todas las compilaciones regulares de los clientes son incrementales. </li><li>  Embalar atlas y preparar recursos tambi√©n es incremental. </li><li>  Los ensamblajes son granulares: algunos de los pasos est√°n en configuraciones de compilaci√≥n separadas; esto le permite ejecutarlos en paralelo, as√≠ como reutilizar resultados intermedios. </li></ul><br>  Esta es una captura de pantalla casi completa de la cadena de compilaciones y pruebas para WildScapes.  Completo no se pudo hacer: es aproximadamente el doble de grande. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/672/415/771/67241577111cb4d6b5d1df70a54337e5.png"></div><br><h2>  Pruebas Est√°ticas </h2><br>  Despu√©s del ensamblaje, se realiza una prueba est√°tica: tomamos la carpeta con la compilaci√≥n y realizamos un conjunto de comprobaciones de todo el contenido que est√° all√≠.  El c√≥digo tambi√©n es contenido, por lo que su an√°lisis est√°tico (cppcheck + PVS-Studio) tambi√©n est√° aqu√≠. <br><br>  En un habr hab√≠a <a href="https://habr.com/ru/company/playrix/blog/452926/">un material detallado</a> sobre c√≥mo hemos implementado las pruebas est√°ticas, lo recomiendo.  Solo enfatizo que las pruebas est√°ticas despu√©s de la compilaci√≥n y en los ganchos previos a la confirmaci√≥n se ejecutan con el mismo c√≥digo.  Esto simplifica enormemente el soporte del sistema. <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/69f/195/0dd/69f1950dd3434591d233507574609672.png" width="500"></div><br><h2>  Pruebas de tiempo de ejecuci√≥n </h2><br>  Si la compilaci√≥n de pruebas est√°ticas se realiz√≥ correctamente, puede continuar e intentar ejecutar la compilaci√≥n ensamblada.  Estamos probando compilaciones en todas las plataformas excepto UWP, es decir.  Windows, MacOs, iOS, Android.  UWP - tambi√©n lo ser√°, pero un poco m√°s tarde. <br><br>  ¬øPor qu√© probar las compilaciones de escritorio si parecen ser necesarias solo en desarrollo?  La respuesta a la pregunta es: es malo si un artista o un dise√±ador de niveles obtiene una compilaci√≥n que se bloquea en el inicio por alguna raz√≥n rid√≠cula.  Por lo tanto, Smoke-Test, el conjunto m√≠nimo de comprobaciones de capacidad de ejecuci√≥n y juego b√°sico, se realiza para todas las plataformas. <br><br>  Todo lo que se escribi√≥ anteriormente sobre las compilaciones tambi√©n es cierto para las pruebas en dispositivos, al menos una vez al d√≠a.  Con pocas excepciones: hay pruebas muy largas que no tienen tiempo para completar en un d√≠a. <br><br>  Las pruebas de humo se ejecutan para cada confirmaci√≥n.  La finalizaci√≥n exitosa de las comprobaciones b√°sicas es un requisito previo para que la compilaci√≥n ingrese al sistema de distribuci√≥n.  Por lo general, no tiene sentido dar acceso a alguien a una compilaci√≥n que obviamente no funciona.  Aqu√≠ puede objetar y presentar excepciones.  Los proyectos tienen una soluci√≥n alternativa para dar acceso a una compilaci√≥n que no funciona, pero apenas la usan. <br><br>  ¬øQu√© otras pruebas hay? <br><br><ul><li>  Punto de referencia: verificamos el rendimiento en FPS y memoria en diversas situaciones y en todos los dispositivos. </li><li>  Pruebas de unidades de combinaci√≥n 3: cada elemento y cada mec√°nica se prueban tanto individualmente como en todas las combinaciones de interacci√≥n. </li><li>  El paso de todo el juego de principio a fin. </li><li>  Varias pruebas de regresi√≥n, por ejemplo, pruebas de localizaci√≥n, o que todas las ventanas de IU se abren correctamente, o que las escenas de fishdom en Fishdom se reproducen sin errores. </li><li>  De todos <a href="https://en.wikipedia.org/wiki/AddressSanitizer">modos</a> , pero con <a href="https://en.wikipedia.org/wiki/AddressSanitizer">AddressSanitizer</a> . </li><li>  Pruebas de compatibilidad para versiones de juegos: tome el archivo de guardar del usuario de versiones anteriores, √°bralo en la nueva versi√≥n y aseg√∫rese de que todo est√© bien. </li><li>  Diversas pruebas personalizadas relevantes para la mec√°nica de un proyecto en particular. </li></ul><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c7a/24e/992/c7a24e992e95338aa4e884f367168b9e.png" width="500"></div><br>  Para ejecutar las pruebas, utilizamos nuestro propio banco de pruebas de dispositivos iOS y Android.  Esto nos permite lanzar de manera flexible las compilaciones que necesitamos en los dispositivos, interactuar con el dispositivo desde el c√≥digo.  Tenemos control total, un nivel de confiabilidad comprensible, sabemos qu√© problemas podemos enfrentar y cu√°nto tiempo llevar√° resolverlos.  Ninguno de los servicios en la nube que proporcionan dispositivos de prueba ofrece tanta comodidad. <br><br><h2>  Gatos </h2><br>  Las pruebas enumeradas anteriormente se implementan dentro del c√≥digo del proyecto.  Esto permite en teor√≠a hacer una prueba de cualquier complejidad, pero requiere esfuerzo y recursos del desarrollo del proyecto para implementar y apoyar estas pruebas.  Estos recursos a menudo no est√°n disponibles, y probar la regresi√≥n m√∫ltiple a mano es dif√≠cil y no necesario.  Realmente quer√≠a que los probadores hicieran la automatizaci√≥n de pruebas.  Y se nos ocurri√≥ un marco para ellos: el Sistema de prueba de automatizaci√≥n continua, o CATS. <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9f1/40d/aab/9f140daab4981b2700a9e40358ceb51e.png" width="500"></div><br>  Cu√°l es la idea: permitir que los autores de guiones de prueba interact√∫en con la aplicaci√≥n de juegos, sin preocuparse por c√≥mo funciona todo.  Escribimos scripts en python primitivo, accedemos a la aplicaci√≥n a trav√©s de un conjunto de abstracciones.  Por ejemplo: "Homescapes, √°brame una ventana de compras y compre tal o cual producto".  Comprueba el resultado, bingo. <br><br>  La implementaci√≥n completa de los comandos de script est√° oculta detr√°s de un conjunto de abstracciones.  La API que implementa la interacci√≥n con la aplicaci√≥n le permite realizar cualquier acci√≥n de varias maneras: <br><br><ul><li>  env√≠a una solicitud http al servidor, que est√° integrado en el motor del juego, con alg√∫n tipo de comando.  Este comando es procesado por el c√≥digo del juego.  Por lo general, este es un tipo de trampa, puede ser arbitrariamente simple o complejo.  Por ejemplo, "dame las coordenadas del centro del bot√≥n con el identificador especificado".  O "p√°same el juego de aqu√≠ al nivel con el n√∫mero indicado". </li><li>  Podemos abrir una ventana a trav√©s del truco o averiguar las coordenadas del bot√≥n por el cual se abre esta ventana, podemos emular haciendo clic en este bot√≥n, podemos hacer un clic virtual sobre √©l. </li><li>  Finalmente, podemos hacer un clic "real" en las coordenadas especificadas como si se hiciera con un dedo en la pantalla. </li></ul><br>  El √∫ltimo m√©todo abre el espacio para la imaginaci√≥n de los evaluadores que a menudo quieren probar construcciones de "combate", donde no hay trampas.  Mantener tales escenarios es m√°s dif√≠cil, pero una "construcci√≥n de combate" es una construcci√≥n de "combate". <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e25/0de/9ce/e250de9ce8a6e45d5ecfc8495eec7cb2.png"></div><br>  Result√≥ ser muy conveniente trabajar con las coordenadas del centro del bot√≥n: las coordenadas a veces cambian, pero los identificadores de los botones son raros.  Esto condujo a otra propiedad importante del sistema: la capacidad de escribir un script de prueba para todas las plataformas y todas las resoluciones de pantalla. <br><br><h2>  Entrega, informes y seguimientos </h2><br>  Con la entrega, todo result√≥ ser bastante simple: utilizamos un √∫nico almacenamiento compartido para artefactos de compilaci√≥n y para el almacenamiento en el sistema de distribuci√≥n.  La "carga" de la compilaci√≥n se reduce a invocar un par de solicitudes a la API del servicio de distribuci√≥n de compilaciones, esencialmente registrarse.  De esta manera, ahorramos un poco de tiempo en el bombeo de construcciones y dinero para su almacenamiento. <br><br>  ¬øRecuerdas que hablaste de minimizar los recursos necesarios para corregir los errores encontrados en las compilaciones?  Informes y pistas: casi sobre esto: <br><br><ul><li>  Informar sobre un problema encontrado es una tarea en Asana.  Es f√°cil de controlar, as√≠gnelo al desarrollador correcto, transfi√©ralo al equipo de CI si algo sali√≥ mal en la infraestructura. </li><li>  Recopilamos compilaciones para cada commit.  Conocemos al autor de este commit, por lo que solo √©l ver√° esta tarea.  Por lo tanto, ahorramos tiempo para otros desarrolladores: no es necesario que se distraigan con problemas con los que no tienen nada que ver y que les ayuden a resolver lo que, muy probablemente, no podr√°n. </li><li>  Si compila una compilaci√≥n a partir de la pr√≥xima confirmaci√≥n, lo m√°s probable es que todav√≠a est√© rota.  Habr√° un comentario en la tarea: "La compilaci√≥n todav√≠a est√° rota", el autor de la nueva confirmaci√≥n no ver√° la tarea y no perder√° tiempo en el problema de otra persona. </li><li>  Enviamos informes a Slack.  Necesariamente, personalmente a quien "rompi√≥" la construcci√≥n, y si el proyecto lo quiere, a un canal especial oa cualquier empleado de Playrix.  Todo es lo m√°s flexible posible. </li></ul><br>  Se necesitan rastreos para que en todas partes haya informaci√≥n completa sobre la compilaci√≥n y los cambios de los que se recopil√≥.  Para no buscar nada, para que todo est√© a mano y no haya necesidad de pasar tiempo buscando detalles que a menudo son necesarios al investigar un problema. <br><br><ul><li>  El informe contiene un enlace a la compilaci√≥n, al registro de compilaci√≥n, el texto del error de compilaci√≥n encontrado y los nombres de las pruebas invertidas.  A menudo, un programador, despu√©s de haber recibido una tarea de informe, puede corregir inmediatamente el error: el nombre del archivo, la l√≠nea y el texto del error est√°n en el informe. </li><li>  El mensaje en Slack contiene lo mismo + un enlace a la tarea en Asana. </li><li>  En Teamcity, un enlace a una tarea.  El ingeniero de compilaci√≥n puede entrar inmediatamente en la tarea, con un solo clic, no es necesario buscar nada. </li><li>  En github, estado con un enlace a la compilaci√≥n, en el comentario a la confirmaci√≥n, un enlace a la tarea para la que se realiz√≥ esta compilaci√≥n.  En la tarea: un comentario con un enlace a la confirmaci√≥n. </li><li>  En el servicio de distribuci√≥n de compilaci√≥n: enlace a la compilaci√≥n, enlace a la confirmaci√≥n. </li></ul><br>  No hay nada que recordar, pero entendiste la idea: enlaces a todo, en todas partes.  Esto acelera enormemente el estudio de cualquier situaci√≥n incomprensible. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/94d/4dc/1a0/94d4dc1a015d9f068e9c5dce0461b17a.png"></div><h2>  Granja </h2><br>  Recopilamos y probamos compilaciones para todas las plataformas.  Para esto necesitamos muchos agentes diferentes.  Rastrearlos y mantenerlos manualmente es largo y dif√≠cil.  Todos los agentes se preparan autom√°ticamente.  Utilizamos Packer y Ansible. <br><br>  Todos los registros de todos los agentes, Teamcity, todos los servicios que existen, los guardamos (en nuestro caso, en ELK).  Todos los servicios, al procesar una compilaci√≥n, agregan el n√∫mero de esta compilaci√≥n a cada l√≠nea de registros.  Podemos ver en una sola solicitud el ciclo de vida completo de la compilaci√≥n desde su aparici√≥n en la cola hasta el final del env√≠o de todos los informes. <br><br>  Hemos implementado nuestro propio mecanismo de optimizaci√≥n de colas.  El de Teamcity no funciona muy bien en nuestros n√∫meros.  Hablando de n√∫meros: <br><br><ul><li>  Recopilamos alrededor de 5,000 construcciones todos los d√≠as.  Esto es aproximadamente 500 horas m√°quina de trabajo. </li><li>  La construcci√≥n n√∫mero tres millones fue hace un mes. </li><li>  Tenemos m√°s de 50 servidores de compilaci√≥n en 10 ubicaciones diferentes. </li><li>  M√°s de 40 dispositivos m√≥viles en un banco de pruebas. </li><li>  Exactamente 1 servidor Teamcity. </li></ul><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5e8/4eb/797/5e84eb79776709b09b73921f78cbb41a.png" width="500"></div><br><h2>  CI como servicio </h2><br>  Playrix CI es un servicio.  Hay muchos proyectos, muchas ideas tambi√©n. <br><br>  Optimizamos el tiempo desde que la compilaci√≥n se pone en la cola hasta el final de su ejecuci√≥n, porque eso es exactamente lo que el usuario del servicio, el desarrollador, considera el "tiempo de compilaci√≥n".  Esto nos permite buscar y encontrar un equilibrio entre el tiempo de compilaci√≥n y el tiempo que pas√≥ en la cola.  Parece l√≥gico que con el crecimiento de la empresa y la cantidad de proyectos, la granja de construcci√≥n que recopila estos proyectos tambi√©n crecer√°.  Pero gracias a las optimizaciones, la tasa de crecimiento de la granja est√° muy por detr√°s de la tasa de crecimiento de la compa√±√≠a. <br><br>  Cualquier optimizaci√≥n comienza con el monitoreo, con una recopilaci√≥n met√≥dica de estad√≠sticas.  Recopilamos muchas estad√≠sticas y sabemos absolutamente todo acerca de nuestras compilaciones.  Pero adem√°s del volumen de la granja de compilaci√≥n, tambi√©n hay un equipo que apoya el sistema CI y lo hace para que nadie tenga que pensar de d√≥nde provienen las compilaciones. <br><br>  La optimizaci√≥n de procesos en este equipo tambi√©n es un proceso interesante y entretenido.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por ejemplo, escribimos pruebas para establecer configuraciones de compilaciones, porque hay muchas de estas configuraciones, sin pruebas similares no es f√°cil encontrar todos los lugares que necesitan ser editados. </font><font style="vertical-align: inherit;">Para casi cualquier cambio, primero escribimos una prueba y luego los hacemos, es decir, tenemos TDD. </font><font style="vertical-align: inherit;">Hay muchos procesos relacionados con el deber, la gesti√≥n de incidentes, la programaci√≥n del flujo de tareas entrantes. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Los desarrolladores deben centrarse en crear juegos geniales y exitosos sin preocuparse de d√≥nde provienen las compilaciones. </font><font style="vertical-align: inherit;">Para esto, Playrix tiene un CI. </font><font style="vertical-align: inherit;">Debe haber un objetivo que desee alcanzar con la integraci√≥n continua, un problema que debe resolverse. </font><font style="vertical-align: inherit;">Es importante no encontrar un problema, es decir, encontrarlo. </font><font style="vertical-align: inherit;">Y cuando la encuentres, recuerda nuestra experiencia y hazlo mejor. </font><font style="vertical-align: inherit;">Y recuerda: </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CI nunca duerme </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬°Nos vemos!</font></font><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/796/1f2/f01/7961f2f01ed13cee81c7ea0e604e7ace.png" width="500"></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/479966/">https://habr.com/ru/post/479966/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../479950/index.html">La historia de los procesadores de video, parte 4: el advenimiento de la GPU de uso general</a></li>
<li><a href="../479952/index.html">Qu√© hay dentro de shawarma: microservicios, sistemas distribuidos y Kafka. Compartir materiales de Backend United # 5</a></li>
<li><a href="../479954/index.html">Tutorial de Spring Boot Admin</a></li>
<li><a href="../479958/index.html">Vulnerabilidades de firmware y procesador</a></li>
<li><a href="../479960/index.html">El modelo de efectividad de la publicidad en medios para tiendas en l√≠nea.</a></li>
<li><a href="../479968/index.html">La oficina de Nginx est√° siendo registrada debido a la demanda del Grupo Rambler. El servicio de prensa del demandante confirm√≥ la demanda.</a></li>
<li><a href="../479970/index.html">Mil y un errores de interfaz de usuario, o c√≥mo ayudar a un desarrollador a evitar errores comunes de interfaz de usuario</a></li>
<li><a href="../479972/index.html">Historial de parches de Apple</a></li>
<li><a href="../479974/index.html">Ataques de clic cero: cuando su seguridad no depende de usted</a></li>
<li><a href="../479978/index.html">Como sin dolor, sin captcha y sin cargo para llevar extractos del Fondo de Propiedad del Estado Federal del Registro Estatal Unificado de Derechos Humanos a un humano legible</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>