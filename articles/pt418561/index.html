<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëà üíÉ üë®üèæ‚Äçüåæ M√°quinas de estado ao servi√ßo do MVP. Palestra Yandex üå≥ üö¥üèº üéÇ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="O modelo de m√°quina de estado finito (FSM) √© usado para escrever c√≥digo para uma ampla variedade de plataformas, incluindo o Android. Ele permite que ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>M√°quinas de estado ao servi√ßo do MVP. Palestra Yandex</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yandex/blog/418561/">  O modelo de m√°quina de estado finito (FSM) √© usado para escrever c√≥digo para uma ampla variedade de plataformas, incluindo o Android.  Ele permite que voc√™ torne o c√≥digo menos complicado, se encaixa bem no paradigma Model-View-Presenter (MVP) e se presta a testes simples.  O desenvolvedor Vladislav Kuznetsov disse ao Droid Party como esse modelo ajuda no desenvolvimento do aplicativo Yandex.Disk. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/U3StVUzqmzc" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  - Primeiro, vamos falar sobre teoria.  Acho que cada um de voc√™s j√° ouviu falar sobre o MVP e a m√°quina de estado, mas vamos repetir. <a name="habracut"></a><br><br><img src="https://habrastorage.org/webt/ok/59/iy/ok59iyqnwvzdxm3a6_ozothgyka.jpeg"><br><br>  Vamos falar sobre motiva√ß√£o, sobre por que tudo isso √© necess√°rio e como isso pode nos ajudar.  Vamos seguir o que fizemos, com um exemplo real, mostrarei trechos de c√≥digo.  E, no final, falaremos sobre testes, sobre como essa abordagem ajudou a testar tudo de forma conveniente. <br><br>  A m√°quina de estado e o MVP, ou algo semelhante - provavelmente o MVI - foram usados ‚Äã‚Äãpor todos. <br><br>  Existem muitas m√°quinas de estado.  Aqui est√° a defini√ß√£o mais simples que pode ser dada a eles: esse √© um tipo de abstra√ß√£o matem√°tica, apresentada na forma de um conjunto finito de estados, eventos e transi√ß√µes do estado atual para um novo, dependendo do evento. <br><br><img src="https://habrastorage.org/webt/x_/o0/be/x_o0befettgekq2bf9h8rz4np3u.jpeg"><br><br>  Aqui est√° um diagrama simples de algum programador abstrato que √†s vezes dorme, √†s vezes come, mas escreve principalmente c√≥digo.  Isso √© suficiente para n√≥s.  H√° um grande n√∫mero de variedades de uma m√°quina de estados finitos, mas isso √© suficiente para n√≥s. <br><br><img src="https://habrastorage.org/webt/5q/hw/iu/5qhwiuh6zfcmumsokpxa8xpethq.jpeg"><br><br>  O escopo da m√°quina de estado √© bastante grande.  Para cada item, eles s√£o usados ‚Äã‚Äãe aplicados com sucesso. <br><br><img src="https://habrastorage.org/webt/6k/z6/mx/6kz6mxlq_mdtra5x-duehczdoro.jpeg"><br><br>  Como qualquer abordagem, o MVP divide nosso aplicativo em v√°rias camadas.  Visualiza√ß√£o - geralmente uma Atividade ou Fragmento, cuja tarefa √© encaminhar alguma a√ß√£o ao usu√°rio, para identificar o Apresentador que o usu√°rio fez alguma coisa.  Consideramos o Model como um provedor de dados.  Pode ser como um banco de dados, se estamos falando de arquitetura limpa, ou Interactor, tudo pode ser.  O Presenter √© um intermedi√°rio que conecta a View e o modelo, enquanto, ao mesmo tempo, pode selecionar e atualizar a View do modelo.  Isso √© suficiente para n√≥s. <br><br>  Quem pode dizer em uma frase o que √© um programa?  C√≥digo execut√°vel?  Muito geral, mais detalhado.  Um algoritmo?  Um algoritmo √© uma sequ√™ncia de a√ß√µes. <br><br>  Este √© um conjunto de dados e algum tipo de fluxo de controle.  N√£o importa quem manipula esses dados: o usu√°rio ou n√£o.  Segue-se o pensamento de que a qualquer momento o estado de um aplicativo √© determinado pela totalidade de todos os seus dados.  E quanto mais dados no aplicativo, mais dif√≠cil √© gerenci√°-los, mais imprevis√≠vel pode surgir uma situa√ß√£o quando algo der errado. <br><br><img src="https://habrastorage.org/webt/nw/zj/ck/nwzjck2q097uwbqk89wzm98pe7e.jpeg"><br><br>  Imagine uma classe simples com tr√™s sinalizadores booleanos.  Para garantir que voc√™ cubra todos os cen√°rios para combinar esses sinalizadores, voc√™ precisa de 2¬≥ cen√°rios.  √â necess√°rio cobrir oito cen√°rios com garantia de que estou processando todas as combina√ß√µes de sinalizadores com certeza.  Se voc√™ adicionar outro sinalizador, ele aumentar√° proporcionalmente. <br><br>  Enfrentamos um problema semelhante.  Parecia ser uma tarefa simples, mas, √† medida que desenvolv√≠amos e trabalhamos, come√ßamos a perceber que algo estava dando errado.  Vou falar sobre os recursos que lan√ßamos.  √â chamado de exclus√£o de fotos locais.  O ponto √© que o usu√°rio carrega alguns dados na nuvem no modo autom√°tico.  Provavelmente, s√£o fotos e v√≠deos que ele tirou no telefone.  Acontece que os arquivos parecem estar na nuvem.  Por que ocupar um espa√ßo precioso no seu telefone quando voc√™ pode excluir essas fotos? <br><br><img src="https://habrastorage.org/webt/3n/3p/lh/3n3plhy4_4mu3v2m4p4gkygdkky.jpeg"><br><br>  Os designers desenharam esse conceito.  Parece apenas um di√°logo, tem um cabe√ßalho no qual √© desenhada a quantidade de espa√ßo que podemos liberar, o texto da mensagem e uma marca de verifica√ß√£o de que existem dois modos de limpeza: exclua todas as fotos que o usu√°rio enviou ou apenas aquelas com mais de um m√™s. <br><br><img src="https://habrastorage.org/webt/mx/rh/ww/mxrhwwwyscc58l0l_q0dddos4zk.jpeg"><br><br>  N√≥s olhamos - parece n√£o haver nada complicado.  Caixa de di√°logo, dois TextViews, caixa de sele√ß√£o, bot√µes.  Mas quando come√ßamos a trabalhar com esse problema em detalhes - percebemos que obter dados sobre quantos arquivos podemos excluir √© uma tarefa de longo prazo.  Portanto, devemos mostrar ao usu√°rio algum tipo de esbo√ßo.  Este √© um pseudo-c√≥digo, na vida real parece diferente, mas o significado √© o mesmo. <br><br><img src="https://habrastorage.org/webt/70/if/kj/70ifkjrvmkxonvj7fybqkwuii_4.jpeg"><br><br>  Verificamos algum estado, verificamos que estamos calculando e desenhamos um plug "Wait". <br><br><img src="https://habrastorage.org/webt/v5/zl/-r/v5zl-rzfbiupzf3xas9oatuev6c.jpeg"><br><br>  Quando os c√°lculos terminam, temos v√°rias op√ß√µes para o que exibir ao usu√°rio.  Por exemplo, o n√∫mero de arquivos que podemos excluir √© zero.  Nesse caso, enviamos uma mensagem ao usu√°rio de que n√£o h√° nada a ser exclu√≠do; portanto, venha da pr√≥xima vez.  Em seguida, os designers v√™m at√© n√≥s e dizem que devemos distinguir entre situa√ß√µes em que o usu√°rio j√° limpou os arquivos ou n√£o limpou nada, nada carregado.  Portanto, outra condi√ß√£o parece que estamos aguardando a inicializa√ß√£o e atra√≠mos outra mensagem para ele. <br><br><img src="https://habrastorage.org/webt/o_/_v/qy/o__vqyedqzkarkomv1xtyvpmqr4.jpeg"><br><br>  Existem situa√ß√µes em que algo funcionou e, por exemplo, o usu√°rio tem uma marca de sele√ß√£o para n√£o excluir novos arquivos.  Nesse caso, tamb√©m existem duas op√ß√µes.  Os arquivos podem ser limpos ou os arquivos n√£o podem ser limpos, ou seja, j√° limparam todos os arquivos; portanto, avisamos que voc√™ j√° excluiu todos os arquivos novos. <br><br><img src="https://habrastorage.org/webt/dl/oj/dj/dlojdj0k01zqxtfetujqmgjnwc4.jpeg"><br><img src="https://habrastorage.org/webt/xp/m2/k9/xpm2k931n5l9uj8kkmtl17qjuja.jpeg"><br><br>  H√° mais uma condi√ß√£o em que podemos realmente excluir algo.  Desmarcado, e h√° uma op√ß√£o que voc√™ pode excluir algo.  Voc√™ olha para este c√≥digo e parece que algo est√° errado.  Ainda n√£o listei tudo, temos uma verifica√ß√£o de permiss√£o, porque nada funciona sem eles, n√£o podemos tocar nos arquivos do cart√£o, al√©m de precisarmos verificar se o usu√°rio est√° com o carregamento autom√°tico ativado, porque os recursos s√£o in√∫teis sem o carregamento autom√°tico, o que iremos limpar.  E mais algumas condi√ß√µes.  E, caramba, parece uma coisa t√£o simples, e muitos problemas surgiram por causa disso. <br><br>  E, obviamente, v√°rios problemas surgem imediatamente.  Primeiro de tudo, esse c√≥digo √© ileg√≠vel.  Aqui, um certo pseudoc√≥digo √© representado, mas em um projeto real, ele est√° espalhado por diferentes fun√ß√µes, partes do c√≥digo, n√£o √© t√£o f√°cil de perceber a olho.  O suporte para esse c√≥digo tamb√©m √© bastante complicado.  Especialmente quando voc√™ chega a um novo projeto, √© informado que precisa criar esse recurso, adiciona alguma condi√ß√£o, verifica um cen√°rio positivo, tudo funciona, mas os testadores chegam e dizem que, sob certas condi√ß√µes, tudo quebrou.  Isso acontece porque voc√™ simplesmente n√£o levou em considera√ß√£o nenhum cen√°rio. <br><br>  Al√©m disso, √© redundante no sentido de que, como temos um grande ramo de condi√ß√µes, devemos verificar todas as condi√ß√µes que n√£o nos conv√™m com anteced√™ncia.  Eles s√£o negativos antecipadamente, mas, como s√£o escritos com tais ramifica√ß√µes, devemos verific√°-las.  O fato √© que no exemplo eu tenho algum tipo de sinalizadores booleanos, mas na pr√°tica, voc√™ pode ter chamadas para fun√ß√µes que v√£o para algum lugar mais profundo no banco de dados.  Tudo pode ser devido √† redund√¢ncia, haver√° freios adicionais. <br><br>  E o mais triste √© um comportamento inesperado que foi esquecido durante a fase de teste, nada aconteceu l√°, e em algum lugar da produ√ß√£o o usu√°rio n√£o aconteceu na melhor das hip√≥teses, algum tipo de curva da interface do usu√°rio e, na pior das hip√≥teses, caiu ou os dados foram perdidos .  Apenas o aplicativo n√£o se comportou de forma consistente. <br><br>  Como resolver este problema?  Pelo poder da m√°quina de estado. <br><br><img src="https://habrastorage.org/webt/_7/tj/-0/_7tj-0szm6wntxwaty3doc69isg.jpeg"><br><br>  A principal tarefa que a m√°quina de estado lida √© pegar uma tarefa grande e complexa e dividi-la em pequenos estados discretos, mais f√°ceis de interagir e gerenciar.  Depois de sentar, pensar, j√° que estamos tentando fazer algo MVP, como vincular nosso estado a tudo isso?  Chegamos a aproximadamente esse esquema.  Quem l√™ o livro do GOF √© um padr√£o de estado cl√°ssico, exatamente o que √© chamado de contexto, eu o chamei de state-oner e, de fato, √© um apresentador.  O apresentador tem esse estado, sabe como altern√°-los e ainda pode fornecer alguns dados para os nossos estados se eles quiserem saber algo, por exemplo, tamanho do arquivo ou desejar solicitar uma solicita√ß√£o ass√≠ncrona, selecione. <br><br><img src="https://habrastorage.org/webt/9r/kk/dz/9rkkdzixpvbrbgzcijhav5ap22k.jpeg"><br><br>  N√£o h√° nada super-duper aqui, o pr√≥ximo slide √© mais importante. <br><br><img src="https://habrastorage.org/webt/w0/ct/ae/w0ctaej1zhv5xticgrxlmaasybo.jpeg"><br><br>  Com isso, voc√™ precisa iniciar o desenvolvimento ao come√ßar a criar uma m√°quina de estado.  Voc√™ est√° sentado no seu computador ou em algum lugar ao redor da mesa e, em um peda√ßo de papel ou em ferramentas especiais, desenha um diagrama de estados.  Tamb√©m n√£o h√° nada complicado, mas esse est√°gio tem muitas vantagens.  Primeiro, em um est√°gio inicial, voc√™ pode detectar imediatamente algumas inconsist√™ncias na l√≥gica de neg√≥cios.  Seus produtos podem vir, expressar seu desejo, est√° tudo bem, mas quando voc√™ come√ßa a escrever c√≥digo, entende que algo n√£o se encaixa.  Eu acho que todo mundo teve uma situa√ß√£o dessas.  Mas quando voc√™ faz um diagrama, pode ver desde o in√≠cio que algo n√£o est√° ancorado.  Ele √© desenhado de maneira bem simples, existem ferramentas especiais, como o PlantUML, nas quais voc√™ nem precisa desenhar, precisa escrever pseudoc√≥digo e ele pr√≥prio gera gr√°ficos. <br><br>  Nosso gr√°fico se parece com isso, que descreve o estado desse di√°logo.  Existem v√°rios estados e a l√≥gica da transi√ß√£o entre eles. <br><br><img src="https://habrastorage.org/webt/ec/84/hl/ec84hlidyk6-olcmjrar9s2oiq0.jpeg"><br><br>  Vamos seguir para o c√≥digo.  Afirme que n√£o h√° nada importante, o principal √© que ele possui tr√™s m√©todos: onEnter, que, ao entrar, chama primeiro invalidateView.  Por que isso √© feito?  Para que, assim que entrarmos no estado, a interface do usu√°rio seja atualizada.  Al√©m disso, existe o m√©todo invalidateView, que sobrecarregamos se precisamos fazer algo com a interface do usu√°rio e o m√©todo onExit, no qual podemos fazer algo se sairmos do estado. <br><br><img src="https://habrastorage.org/webt/zo/ld/5s/zold5sqpcjeu_1z3mq48c4jnos4.jpeg"><br><br>  StateOwner.  Uma interface que fornece a capacidade de clicar em estado.  Como descobrimos, ser√° um futuro apresentador.  E esses s√£o m√©todos que fornecem acesso adicional aos dados.  Se algum dado for vasculhado entre estados, podemos mant√™-lo no apresentador e fornec√™-lo por essa interface.  Nesse caso, podemos fornecer o tamanho dos arquivos que podemos limpar e oferecer a oportunidade de fazer algum tipo de solicita√ß√£o.  Estamos em um estado, queremos solicitar algo e, atrav√©s do StateOwner, podemos chamar um m√©todo. <br><br>  Outra utilidade √© que ele tamb√©m pode retornar um link para a visualiza√ß√£o.  Isso √© feito para que, se voc√™ tiver um estado e alguns dados chegarem, n√£o desejar mudar para um novo estado, √© apenas redundante, voc√™ pode atualizar diretamente a exibi√ß√£o, o texto.  Usamos isso para atualizar o n√∫mero de d√≠gitos que o usu√°rio v√™ quando olha para o di√°logo.  Estamos em tempo de download de arquivos, ele olha para o di√°logo e os n√∫meros s√£o atualizados.  N√£o estamos entrando em um novo estado, estamos apenas atualizando a Visualiza√ß√£o atual. <br><br><img src="https://habrastorage.org/webt/og/ug/pq/ogugpqbvlhyh5rfxwyofcz22my8.jpeg"><br><br>  Aqui est√° o MVP padr√£o, tudo deve ser extremamente simples, sem l√≥gica, m√©todos simples que desenham algo.  Eu aderi a esse conceito.  N√£o deve haver l√≥gica, pelo menos algum tipo de a√ß√£o.  N√≥s pegamos algumas Text View de maneira limpa, mudamos, n√£o mais. <br><br><img src="https://habrastorage.org/webt/8h/-f/zf/8h-fzfwagetflmtss66is8shzly.jpeg"><br><br>  Apresentador  H√° coisas mais interessantes.  Primeiro de tudo, podemos encontrar dados atrav√©s deles para alguns estados, temos duas vari√°veis ‚Äã‚Äãmarcadas com a anota√ß√£o State.  Quem usou o Icepick est√° familiarizado com isso.  N√£o escrevemos serializa√ß√£o com as m√£os no Partible, usamos uma biblioteca pronta. <br><br>  O seguinte √© o estado inicial.  √â sempre √∫til definir o estado inicial, mesmo que n√£o fa√ßa nada.  A utilidade √© que voc√™ n√£o precisa fazer verifica√ß√µes nulas, mas se dissermos que isso pode fazer alguma coisa.  Por exemplo, voc√™ precisa fazer algo uma vez para o ciclo de vida do seu aplicativo; quando come√ßamos, voc√™ precisa executar o procedimento uma vez e nunca mais faz√™-lo.  Quando sa√≠mos do estado inicial, sempre podemos fazer algo assim e nunca voltamos a esse estado.  Digite para que o diagrama de estado seja desenhado.  Embora quem sabe quem vai desenhar, talvez voc√™ possa voltar. <br><br>  Sou a favor de minimizar as verifica√ß√µes para Null e assim por diante, por isso aqui mantenho um link para uma implementa√ß√£o de exibi√ß√£o simples.  N√£o precisamos sincronizar nada, apenas em algum momento em que ocorre a desanexa√ß√£o, substitu√≠mos a visualiza√ß√£o por uma vazia e o apresentador pode alternar para algum lugar nos estados, pensar que h√° uma visualiza√ß√£o, ela atualiza, mas na verdade funciona com implementa√ß√£o vazia. <br><br>  Existem v√°rios outros m√©todos para salvar o estado, mas queremos sobreviver ao levante da Activity, neste caso, tudo √© feito atrav√©s do construtor.  Tudo √© um pouco mais complicado, aqui est√° um exemplo exagerado. <br><br><img src="https://habrastorage.org/webt/rk/a2/1m/rka21mszygspy9cjuprcqgv9afi.jpeg"><br><br>  √â necess√°rio encaminhar saveState, se algu√©m trabalhou com bibliotecas semelhantes, tudo √© bastante trivial.  Voc√™ pode escrever com as m√£os.  E dois m√©todos s√£o muito importantes: anexar, chamado onStart e desanexar, chamado onStop. <br><br><img src="https://habrastorage.org/webt/p4/dq/n2/p4dqn2m5adpxmsfybd7fctrjc0a.jpeg"><br><br>  Qual a import√¢ncia deles?  Inicialmente, planejamos anexar e desanexar no onCreateView, onDestroyView, mas isso n√£o foi suficiente.  Se voc√™ tiver uma Visualiza√ß√£o, seu texto pode ser atualizado ou um fragmento de di√°logo pode aparecer.  E se voc√™ n√£o for pego no onStop e tentar mostrar o fragmento, ver√° a exce√ß√£o bem conhecida de que n√£o pode confirmar uma transa√ß√£o quando ainda temos o estado.  Use a perda de estado de confirma√ß√£o ou n√£o.  Portanto, somos detalhados no onStop, enquanto o apresentador continuar√° trabalhando l√°, alternar estados, capturar eventos.  E, no momento em que o in√≠cio ocorrer, acionaremos o evento de visualiza√ß√£o anexada e o apresentador atualizar√° a interface do usu√°rio para corresponder ao estado atual. <br><br><img src="https://habrastorage.org/webt/fk/r6/op/fkr6op8zellkewd81kh7omqaxto.jpeg"><br><img src="https://habrastorage.org/webt/my/sb/t8/mysbt8ecs5ap56d5o_jyndzgp_a.jpeg"><br><br>  Existe um m√©todo de libera√ß√£o, geralmente chamado onDestroy, voc√™ desanexa e libera recursos adicionalmente. <br><br><img src="https://habrastorage.org/webt/f9/lg/-d/f9lg-db1fwe27xwd09pg1yltu44.jpeg"><br><br>  Outro m√©todo setState importante.  Como planejamos alterar a interface do usu√°rio em onEnter e onExit, h√° uma verifica√ß√£o para o thread principal.  Isso cria uma restri√ß√£o para n√≥s de que n√£o estamos fazendo nada pesado aqui, todas as solicita√ß√µes devem ser para a interface do usu√°rio ou devem ser ass√≠ncronas.  A vantagem deste local √© que aqui podemos reservar a entrada e a sa√≠da do estado, √© muito √∫til ao depurar, por exemplo, quando algo d√° errado, voc√™ pode ver como o sistema clicou e entender o que estava errado. <br><br><img src="https://habrastorage.org/webt/sh/bx/nx/shbxnx_e_4myifye8ucidtdpj7e.jpeg"><br><br>  Alguns exemplos de condi√ß√µes.  Existe um estado inicial, apenas aciona o c√°lculo de quanto espa√ßo voc√™ precisa liberar no momento em que a visualiza√ß√£o ficou dispon√≠vel.  Isso acontecer√° ap√≥s o onStart.  Assim que onStart acontece, entramos em um novo estado e o sistema come√ßa a solicitar dados. <br><br><img src="https://habrastorage.org/webt/nt/cy/i3/ntcyi3chfp0yvgyiauig5gegy2c.jpeg"><br><br><img src="https://habrastorage.org/webt/f4/bq/j-/f4bqj-kaebdsnml-dpa-azvgrmm.jpeg"><br><br>  Um exemplo do estado √© C√°lculo, declararemos o tamanho dos arquivos com stateOwner, de alguma forma rastrear√° o banco de dados e, em seguida, ainda haver√° um inValidateView, atualizaremos a interface do usu√°rio do usu√°rio atual.  E viewAttached √© chamado se a visualiza√ß√£o for reconectada.  Se estiv√©ssemos em segundo plano, o c√°lculo era em segundo plano, retornamos novamente √† nossa atividade, esse m√©todo √© chamado e atualiza todos os dados. <br><br><img src="https://habrastorage.org/webt/eu/fg/5f/eufg5fb-rwg6keerfqik_skfo44.jpeg"><br><br>  Um exemplo de evento, perguntamos a stateOwner quantos arquivos podem ser liberados e chama o m√©todo filesSizeUpdated.  Aqui eu estava com pregui√ßa, era poss√≠vel escrever tr√™s m√©todos separados, como atualizados, existem tantos arquivos antigos quanto separar eventos diferentes.  Mas voc√™ precisa entender, uma vez que ser√° dif√≠cil para voc√™, uma vez que ser√° muito mais simples.  N√£o √© necess√°rio cair na superengenharia de que cada evento √© um m√©todo separado.  Voc√™ pode conviver com um simples se, n√£o vejo nada de errado nisso. <br><br><img src="https://habrastorage.org/webt/r0/ge/tx/r0getxszg4i3mwlruqqybl-mffm.jpeg"><br><br>  Eu vejo v√°rias melhorias em potencial.  N√£o gosto que sejamos for√ßados a contornar esses m√©todos, como onStart, on Stop, onCreate, onSave e muito mais.  Voc√™ pode se conectar ao Lifecycle, mas n√£o est√° claro o que fazer com o saveState.  H√° uma ideia, por exemplo, de criar um fragmento de apresentador.  Porque n√£o  Um fragmento sem uma interface do usu√°rio que captura o ciclo de vida e, em geral, n√£o precisaremos de nada, tudo voar√° para n√≥s por si s√≥. <br><br>  Outro ponto interessante: esse apresentador √© recriado todas as vezes e, se voc√™ tem grandes dados armazenados no apresentador, foi ao banco de dados, segura um cursor enorme e √© inaceit√°vel solicitar cada vez que voc√™ gira a tela.  Portanto, voc√™ pode armazenar em cache o apresentador, como faz, por exemplo, o ViewModule da Architecture Components, criar algum fragmento que reter√° o cache dos apresentadores e os retornar√° para cada visualiza√ß√£o. <br><br>  Voc√™ pode usar a maneira tabular para especificar m√°quinas de estado, porque o padr√£o de estado que usamos tem uma desvantagem significativa: assim que voc√™ precisar adicionar um m√©todo a um novo evento, dever√° adicionar implementa√ß√£o a todos os descendentes.  Pelo menos vazio.  Ou fa√ßa-o em condi√ß√µes b√°sicas.  Isso n√£o √© muito conveniente.  Portanto, a maneira tabular de especificar m√°quinas de estado √© usada em todas as bibliotecas - se voc√™ procurar no GitHub a palavra FSM, encontrar√° um grande n√∫mero de bibliotecas que fornecem um tipo de construtor no qual voc√™ define o estado inicial, o evento e o estado final.  Expandir e manter uma m√°quina desse tipo √© muito mais f√°cil. <br><br>  Outro ponto interessante: se voc√™ usar o padr√£o de estado, se sua m√°quina de estados come√ßar a crescer, provavelmente precisar√° lidar com alguns eventos da mesma maneira para que o c√≥digo n√£o seja copiado, voc√™ cria um estado b√°sico.  Quanto mais eventos, mais condi√ß√µes b√°sicas come√ßam a aparecer, a hierarquia cresce e algo d√° errado. <br><br>  Como sabemos, a heran√ßa deve ser substitu√≠da pela delega√ß√£o, e as m√°quinas de estado hier√°rquico ajudam a resolver esse problema.  Voc√™ tem estados que n√£o dependem do n√≠vel de heran√ßa - basta criar uma √°rvore de estados que passam pelo manipulador acima.  Voc√™ tamb√©m pode ler separadamente, uma coisa muito √∫til.  No Android, por exemplo, m√°quinas de estado hier√°rquicas s√£o usadas no WatchDog Wi-Fi, que monitora o status da rede, eles est√£o l√°, diretamente na fonte do Android. <br><br><img src="https://habrastorage.org/webt/kd/qn/cn/kdqncnx-u10ovabuexg_h-kdxiu.jpeg"><br><br>  Por √∫ltimo mas n√£o menos importante.  Como isso pode ser testado?  Primeiro de tudo, estados determin√≠sticos podem ser testados.  H√° um estado separado, criamos uma inst√¢ncia, puxamos o m√©todo onEnter e vemos que os valores correspondentes s√£o chamados na exibi√ß√£o.  Assim, validamos que nosso estado atualize corretamente a visualiza√ß√£o.  Se o seu View n√£o faz nada s√©rio, √© prov√°vel que voc√™ cubra um grande n√∫mero de cen√°rios. <br><br><img src="https://habrastorage.org/webt/bc/mn/o_/bcmno_pvrehzh447tidyzn3nd5w.jpeg"><br><br>  Voc√™ pode bloquear alguns m√©todos com uma fun√ß√£o que retorna o tamanho, chamar outro evento ap√≥s onEnter e ver como um determinado estado responde a eventos espec√≠ficos.  Nesse caso, quando o evento filesSizeUpdated ocorre e quando AllFilesSize √© maior que zero, devemos fazer a transi√ß√£o para o novo estado CleanAllFiles.  Com a ajuda do layout, verificamos tudo isso. <br><br><img src="https://habrastorage.org/webt/1z/pu/lp/1zpulp09kyd3vcr2xhcevmum4rm.jpeg"><br><br>  E o √∫ltimo - podemos testar todo o sistema.  Constru√≠mos o estado, enviamos um evento para ele e verificamos como o sistema se comporta.  Temos tr√™s est√°gios de teste.  ,   UI,  ,    ,   ,       . <br><br>      ,     70%.  80%     .  ,    . <br><br><img src="https://habrastorage.org/webt/tu/pz/qx/tupzqxbhu35qyqjpzhx0_xc6kxu.jpeg"><br><br>   ,   ?    ‚Äî . -        . <br><br> .        .   - ,   ,  -     ,   ‚Äî    ,          . <br><br>     -  ,  ,    ,    .    ,   ,     .    ,        ,     .    -    ,    ,   .    , ,   .     lock   .   - ,     . <br><br>   ‚Äî .   ,       ,           ,     ,   . ,   - , ,  -,    ,   .     ,      .   , . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt418561/">https://habr.com/ru/post/pt418561/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt418549/index.html">Criando um bot para participar do mini cup da AI 2018 com base em uma rede neural recorrente (parte 3)</a></li>
<li><a href="../pt418551/index.html">Quanto um programador deve saber matem√°tica?</a></li>
<li><a href="../pt418553/index.html">Javasript + React vs Kotlin + React</a></li>
<li><a href="../pt418557/index.html">C√°lculo dos processos de onda em uma linha hidr√°ulica usando o m√©todo de caracter√≠sticas</a></li>
<li><a href="../pt418559/index.html">NL2API: Criando interfaces de linguagem natural para a API da Web</a></li>
<li><a href="../pt418563/index.html">O resumo de materiais interessantes para o desenvolvedor de dispositivos m√≥veis # 263 (23 a 29 de julho)</a></li>
<li><a href="../pt418565/index.html">No caminho para 100% de cobertura de c√≥digo com testes no Go usando o sql-dumper como exemplo</a></li>
<li><a href="../pt418567/index.html">A Dell deixar√° de ser uma empresa privada e, pela primeira vez em cinco anos, colocar√° a√ß√µes na bolsa de valores</a></li>
<li><a href="../pt418569/index.html">Novos sat√©lites - novos bugs: o sensor infravermelho de sat√©lite GOES-17 n√£o esfria bem</a></li>
<li><a href="../pt418573/index.html">Waterius: transfira as leituras de √°gua para um telefone via Wi-Fi (4 anos com bateria)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>