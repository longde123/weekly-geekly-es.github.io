<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üò≠ üëÑ ‚òùÔ∏è G√©n√©ration d'un environnement sonore et musical dans Unity3D. Partie 2. Cr√©er une piste 2D √† partir de la musique üë©üèæ‚Äçüíº üßùüèª üëãüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Annotation 


 Bonjour √† tous. Relativement r√©cemment, j'ai √©crit un article G√©n√©rer un environnement bas√© sur le son et la musique dans Unity3D , dan...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>G√©n√©ration d'un environnement sonore et musical dans Unity3D. Partie 2. Cr√©er une piste 2D √† partir de la musique</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/digital-ecosystems/blog/432134/"><h2 id="annotaciya">  Annotation </h2><br><p>  Bonjour √† tous.  Relativement r√©cemment, j'ai √©crit un article <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">G√©n√©rer un environnement bas√© sur le son et la musique dans Unity3D</a> , dans lequel j'ai donn√© plusieurs exemples de jeux qui utilisent la m√©canique de g√©n√©ration de contenu bas√© sur la musique, et j'ai √©galement parl√© des aspects fondamentaux de ces jeux.  Il n'y avait pratiquement pas de code dans l'article et j'ai promis qu'il y aurait une suite.  Et le voici devant vous.  Cette fois, nous allons essayer de cr√©er une piste pour une course 2D, dans le style de Hill Climb, √† partir de votre musique.  Voyons voir ce que nous obtenons .. </p><br><p><img src="https://habrastorage.org/webt/wp/6y/jk/wp6yjkpyoal7a3bzsg0ugeiuyvs.png"></p><a name="habracut"></a><br><h2 id="vvedenie">  Pr√©sentation </h2><br><p>  Je vous rappelle que cette s√©rie d'articles est con√ßue pour les d√©veloppeurs d√©butants et pour ceux qui ont r√©cemment commenc√© √† travailler avec le son.  Si vous faites une transformation de Fourier rapide dans votre esprit, vous vous ennuierez probablement. </p><br><p>  Voici notre feuille de route pour aujourd'hui: </p><br><ol><li>  Consid√©rez ce qu'est la discr√©tisation. </li><li>  D√©couvrez quelles donn√©es nous pouvons obtenir d'Audio Clip Unity </li><li>  Comprenez comment nous pouvons travailler avec ces donn√©es. </li><li>  D√©couvrez ce que nous pouvons g√©n√©rer √† partir de ces donn√©es. </li><li>  Apprenez √† cr√©er un jeu √† partir de tout cela (enfin, ou quelque chose de similaire √† un jeu) </li></ol><br><p>  Alors allons-y! </p><br><h2 id="diskretizaciya-analogovogo-singala">  Discr√©tisation du cinghalais analogique </h2><br><p>  Comme beaucoup de gens le savent, pour utiliser un signal dans des syst√®mes num√©riques, nous devons le convertir.  L'une des √©tapes de conversion est l'√©chantillonnage du signal, dans lequel le signal analogique est divis√© en parties (rapports temporaires), apr√®s quoi chaque rapport se voit attribuer la valeur d'amplitude qui √©tait au moment s√©lectionn√©. <br><img src="https://habrastorage.org/webt/k-/r4/_0/k-r4_0pvvu8sxhcdxaybjnpsn0q.png"></p><br><p>  La lettre T indique la p√©riode d'√©chantillonnage.  Plus la p√©riode est courte, plus la conversion du signal sera pr√©cise.  Mais le plus souvent, ils parlent de l'inverse: Taux d'√©chantillonnage (il est logique que ce soit F = 1 / T).  8 000 Hz est suffisant pour un t√©l√©phone t√©l√©phonique et, par exemple, l'une des options pour le format DVD-Audio n√©cessite une fr√©quence d'√©chantillonnage de 192 000 Hz.  La norme en enregistrement num√©rique (dans les √©diteurs de jeux, les √©diteurs de musique) est de 44 100 Hz - c'est la fr√©quence du CD Audio. </p><br><p>  Les valeurs num√©riques de l'amplitude sont stock√©es dans les soi-disant √©chantillons et c'est avec eux que nous travaillerons.  La valeur de l'√©chantillon est float et elle peut aller de -1 √† 1. Simplifi√©, il ressemble √† ceci. </p><br><p><img src="https://habrastorage.org/webt/sj/rg/r7/sjrgr7njjj7iwmyi6nebdtpfxze.png"></p><br><h2 id="otrisovka-zvukovoy-volny-statichno">  Rendu des ondes sonores (statique) </h2><br><h3 id="bazovaya-informaciya">  Informations basiques </h3><br><p>  La forme d'onde (ou forme audio, et chez les gens ordinaires - ¬´poisson¬ª) est une repr√©sentation visuelle du signal sonore au fil du temps.  La forme d'onde peut nous montrer √† quel point du son se produit la phase active et o√π se produit l'att√©nuation.  Souvent, la forme d'onde est pr√©sent√©e pour chaque canal s√©par√©ment, par exemple, comme ceci: </p><br><p><img src="https://habrastorage.org/webt/hj/xr/vm/hjxrvm-bdrgt-myieappnmqxgb0.png"></p><br><p>  Imaginez que nous avons d√©j√† une AudioSource et un script dans lesquels nous travaillons.  Voyons ce que Unity peut nous apporter. </p><br><pre><code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//  AudioSource    AudioSource myAudio = gameObject.GetComponent&lt;AudioSource&gt;(); //     .     44100. int freq = myAudio.clip.frequency;</span></span></code> </pre> <br><h3 id="vybor-kol-va-otchetov">  S√©lectionnez le nombre de rapports </h3><br><p>  Avant d'aller plus loin, nous devons parler un peu de la profondeur de rendu de notre son.  Avec une fr√©quence d'√©chantillonnage de 44100 Hz par seconde, nous sommes en mesure de traiter 44100 rapports.  Disons que nous devons rendre une piste de 10 secondes.  Nous allons dessiner chaque rapport avec une ligne d'un pixel de large.  Il s'av√®re que notre forme d'onde aura une longueur de 441 000 pixels.  Vous obtenez une onde sonore tr√®s longue, allong√©e et peu comprise.  Mais, vous y voyez chaque rapport sp√©cifique!  Et vous allez terriblement charger le syst√®me, peu importe comment vous le dessinez. </p><br><p><img src="https://habrastorage.org/webt/qr/yf/j6/qryfj6qyv0v5mrbzjfqz6qcws_y.png"></p><br><p>  Si vous ne cr√©ez pas de logiciel audio professionnel, vous n'avez pas besoin d'une telle pr√©cision.  Pour une image audio g√©n√©rale, nous pouvons diviser tous les √©chantillons en p√©riodes plus longues et prendre, par exemple, la moyenne de chaque 100 √©chantillons.  Ensuite, notre vague aura une forme tr√®s distincte: </p><br><p><img src="https://habrastorage.org/webt/2v/yk/kz/2vykkzw2wtewvjzcwsfsz_h1zvq.png"></p><br><p>  Bien s√ªr, ce n'est pas tout √† fait exact, car vous pouvez ignorer les pics de volume dont vous pourriez avoir besoin, vous pouvez donc essayer non pas la valeur moyenne, mais le maximum de ce segment.  Cela donnera une image l√©g√®rement diff√©rente, mais vos pics ne dispara√Ætront pas. </p><br><h3 id="podgotovka-k-polucheniyu-audiodannyh">  Pr√©paration √† la r√©ception audio </h3><br><p>  D√©finissons la pr√©cision de notre √©chantillon en tant que qualit√© et le nombre final de rapports en tant que sampleCount. </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> quality = <span class="hljs-number"><span class="hljs-number">100</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> sampleCount = <span class="hljs-number"><span class="hljs-number">0</span></span>; sampleCount = freq / quality;</code> </pre> <br><p>  Un exemple de calcul de tous les nombres sera ci-dessous. </p><br><p>  Ensuite, nous devons obtenir les √©chantillons nous-m√™mes.  Cela peut √™tre fait √† partir d'un clip audio √† l'aide de la m√©thode <strong>GetData</strong> . </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetData</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] data, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> offsetSamples</span></span></span><span class="hljs-function">)</span></span>;</code> </pre> <br><p>  Cette m√©thode prend un tableau dans lequel elle √©crit des √©chantillons.  offsetSamples - param√®tre responsable du point de d√©part de la lecture du tableau de donn√©es.  Si vous lisez le tableau depuis le d√©but, il devrait y avoir z√©ro. </p><br><p>  Pour enregistrer des √©chantillons, nous devons pr√©parer un tableau pour eux.  Par exemple, comme ceci: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] samples; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] waveFormArray; <span class="hljs-comment"><span class="hljs-comment">//      samples = new float[myAudio.clip.samples * myAudio.clip.channels];</span></span></code> </pre> <br><p>  Pourquoi avons-nous multipli√© la longueur par le nombre de cha√Ænes?  Maintenant, je vais dire ... </p><br><h3 id="informaciya-ob-audiokanalah-v-unity">  Informations sur la cha√Æne audio Unity </h3><br><p>  Beaucoup de gens savent que dans le son, nous utilisons g√©n√©ralement deux canaux: gauche et droit.  Quelqu'un sait qu'il existe des syst√®mes 2.1, ainsi que 5.1, 7.1 dans lesquels les sources sonores entourent de tous les c√¥t√©s.  Le th√®me des cha√Ænes est bien d√©crit <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">sur le wiki</a> .  Comment cela fonctionne-t-il dans Unity? </p><br><p>  Lors du t√©l√©chargement d'un fichier, lors de l'ouverture d'un clip, vous pouvez trouver l'image suivante: </p><br><p><img src="https://habrastorage.org/webt/us/hy/tu/ushytu2q3jhyyl8sbx9tclnaf9i.png"></p><br><p>  Il est juste montr√© ici que nous avons deux canaux, et vous pouvez m√™me remarquer qu'ils sont diff√©rents l'un de l'autre.  Unity enregistre les √©chantillons de ces canaux les uns apr√®s les autres.  Il s'av√®re que cette image: <br><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="63.547ex" height="2.66ex" viewBox="0 -832 27360.5 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhjB56uEHQr8Q-btwdF-QLqNkTYBiw#MJMAIN-5B" x="0" y="0"></use><g transform="translate(278,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhjB56uEHQr8Q-btwdF-QLqNkTYBiw#MJMATHI-4C" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhjB56uEHQr8Q-btwdF-QLqNkTYBiw#MJMAIN-31" x="963" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhjB56uEHQr8Q-btwdF-QLqNkTYBiw#MJMAIN-2C" x="1413" y="0"></use><g transform="translate(1859,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhjB56uEHQr8Q-btwdF-QLqNkTYBiw#MJMATHI-52" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhjB56uEHQr8Q-btwdF-QLqNkTYBiw#MJMAIN-31" x="1074" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhjB56uEHQr8Q-btwdF-QLqNkTYBiw#MJMAIN-2C" x="3072" y="0"></use><g transform="translate(3517,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhjB56uEHQr8Q-btwdF-QLqNkTYBiw#MJMATHI-4C" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhjB56uEHQr8Q-btwdF-QLqNkTYBiw#MJMAIN-32" x="963" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhjB56uEHQr8Q-btwdF-QLqNkTYBiw#MJMAIN-2C" x="4653" y="0"></use><g transform="translate(5098,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhjB56uEHQr8Q-btwdF-QLqNkTYBiw#MJMATHI-52" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhjB56uEHQr8Q-btwdF-QLqNkTYBiw#MJMAIN-32" x="1074" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhjB56uEHQr8Q-btwdF-QLqNkTYBiw#MJMAIN-2C" x="6311" y="0"></use><g transform="translate(6756,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhjB56uEHQr8Q-btwdF-QLqNkTYBiw#MJMATHI-4C" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhjB56uEHQr8Q-btwdF-QLqNkTYBiw#MJMAIN-33" x="963" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhjB56uEHQr8Q-btwdF-QLqNkTYBiw#MJMAIN-2C" x="7892" y="0"></use><g transform="translate(8337,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhjB56uEHQr8Q-btwdF-QLqNkTYBiw#MJMATHI-52" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhjB56uEHQr8Q-btwdF-QLqNkTYBiw#MJMAIN-33" x="1074" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhjB56uEHQr8Q-btwdF-QLqNkTYBiw#MJMAIN-2C" x="9550" y="0"></use><g transform="translate(9995,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhjB56uEHQr8Q-btwdF-QLqNkTYBiw#MJMATHI-4C" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhjB56uEHQr8Q-btwdF-QLqNkTYBiw#MJMAIN-34" x="963" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhjB56uEHQr8Q-btwdF-QLqNkTYBiw#MJMAIN-2C" x="11131" y="0"></use><g transform="translate(11576,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhjB56uEHQr8Q-btwdF-QLqNkTYBiw#MJMATHI-52" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhjB56uEHQr8Q-btwdF-QLqNkTYBiw#MJMAIN-34" x="1074" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhjB56uEHQr8Q-btwdF-QLqNkTYBiw#MJMAIN-2C" x="12789" y="0"></use><g transform="translate(13235,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhjB56uEHQr8Q-btwdF-QLqNkTYBiw#MJMATHI-4C" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhjB56uEHQr8Q-btwdF-QLqNkTYBiw#MJMAIN-35" x="963" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhjB56uEHQr8Q-btwdF-QLqNkTYBiw#MJMAIN-2C" x="14370" y="0"></use><g transform="translate(14815,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhjB56uEHQr8Q-btwdF-QLqNkTYBiw#MJMATHI-52" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhjB56uEHQr8Q-btwdF-QLqNkTYBiw#MJMAIN-35" x="1074" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhjB56uEHQr8Q-btwdF-QLqNkTYBiw#MJMAIN-2C" x="16029" y="0"></use><g transform="translate(16474,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhjB56uEHQr8Q-btwdF-QLqNkTYBiw#MJMATHI-4C" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhjB56uEHQr8Q-btwdF-QLqNkTYBiw#MJMAIN-36" x="963" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhjB56uEHQr8Q-btwdF-QLqNkTYBiw#MJMAIN-2C" x="17609" y="0"></use><g transform="translate(18054,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhjB56uEHQr8Q-btwdF-QLqNkTYBiw#MJMATHI-52" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhjB56uEHQr8Q-btwdF-QLqNkTYBiw#MJMAIN-36" x="1074" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhjB56uEHQr8Q-btwdF-QLqNkTYBiw#MJMAIN-2C" x="19268" y="0"></use><g transform="translate(19713,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhjB56uEHQr8Q-btwdF-QLqNkTYBiw#MJMATHI-4C" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhjB56uEHQr8Q-btwdF-QLqNkTYBiw#MJMAIN-37" x="963" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhjB56uEHQr8Q-btwdF-QLqNkTYBiw#MJMAIN-2C" x="20848" y="0"></use><g transform="translate(21293,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhjB56uEHQr8Q-btwdF-QLqNkTYBiw#MJMATHI-52" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhjB56uEHQr8Q-btwdF-QLqNkTYBiw#MJMAIN-37" x="1074" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhjB56uEHQr8Q-btwdF-QLqNkTYBiw#MJMAIN-2C" x="22507" y="0"></use><g transform="translate(22952,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhjB56uEHQr8Q-btwdF-QLqNkTYBiw#MJMATHI-4C" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhjB56uEHQr8Q-btwdF-QLqNkTYBiw#MJMAIN-38" x="963" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhjB56uEHQr8Q-btwdF-QLqNkTYBiw#MJMAIN-2C" x="24087" y="0"></use><g transform="translate(24533,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhjB56uEHQr8Q-btwdF-QLqNkTYBiw#MJMATHI-52" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhjB56uEHQr8Q-btwdF-QLqNkTYBiw#MJMAIN-38" x="1074" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhjB56uEHQr8Q-btwdF-QLqNkTYBiw#MJMAIN-2E" x="25746" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhjB56uEHQr8Q-btwdF-QLqNkTYBiw#MJMAIN-2E" x="26191" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhjB56uEHQr8Q-btwdF-QLqNkTYBiw#MJMAIN-2E" x="26636" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhjB56uEHQr8Q-btwdF-QLqNkTYBiw#MJMAIN-5D" x="27082" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-1"> [L_1, R_1, L_2, R_2, L_3, R_3, L_4, R_4, L_5, R_5, L_6, R_6, L_7, R_7, L_8, R_8 ...] </script></p><br><p>  C'est pourquoi nous avons besoin de deux fois plus d'espace dans le tableau que juste pour le nombre d'√©chantillons. </p><br><p>  Si vous s√©lectionnez l'option Forcer le clip mono, le canal sera un et tout le son sera au centre.  L'aper√ßu de votre vague changera imm√©diatement. </p><br><p><img src="https://habrastorage.org/webt/fx/pk/-f/fxpk-fvqtdsvhfvfyyvl1mjrjla.png"></p><br><p><img src="https://habrastorage.org/webt/po/62/s8/po62s86xpcbainozvupbpekwdig.png"></p><br><h3 id="poluchenie-audiodannyh">  Recevoir des donn√©es audio </h3><br><p>  Voici ce que nous obtenons: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> quality = <span class="hljs-number"><span class="hljs-number">100</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> sampleCount = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] waveFormArray; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] samples; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> AudioSource myAudio; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { myAudio = gameObject.GetComponent&lt;AudioSource&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> freq = myAudio.clip.frequency; sampleCount = freq / quality; samples = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[myAudio.clip.samples * myAudio.clip.channels]; myAudio.clip.GetData(samples,<span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-comment"><span class="hljs-comment">//  ,    .       waveFormArray = new float[(samples.Length / sampleCount)]; //             for (int i = 0; i &lt; waveFormArray.Length; i++) { waveFormArray[i] = 0; for (int j = 0; j &lt; sampleCount; j++) { //Abs     ""    . .  waveFormArray[i] += Mathf.Abs(samples[(i * sampleCount) + j]); } waveFormArray[i] /= sampleCount; } }</span></span></code> </pre> <br><p>  Au total, si la piste dure 10 secondes et qu'elle est √† deux canaux, alors nous obtenons ce qui suit: </p><br><ul><li>  Le nombre d'√©chantillons dans le clip (myAudio.clip.sample) = 44100 * 10 = 441000 </li><li>  Le r√©seau d'√©chantillons pour deux canaux est long (samples.Length) = 441000 * 2 = 882000 </li><li>  Nombre de rapports (sampleCount) = 44100/100 = 441 </li><li>  La longueur du tableau final = samples.Length / sampleCount = 2000 </li></ul><br><p>  En cons√©quence, nous travaillerons avec 2000 points, ce qui nous suffit pour dessiner la vague.  Vous devez maintenant faire preuve d'imagination et r√©fl√©chir √† la mani√®re dont nous pouvons utiliser ces donn√©es. </p><br><h3 id="otrisovka-audioinformacii">  Rendu des informations audio </h3><br><h4 id="sozdanie-prostoy-audiodorozhki-s-pomoschyu-debug-sredstv">  Cr√©er une piste audio simple √† l'aide des outils de d√©bogage </h4><br><p>  Comme beaucoup de gens le savent, Unity dispose de moyens pratiques pour afficher toutes sortes d'informations de d√©bogage.  Un d√©veloppeur intelligent bas√© sur ces outils peut r√©aliser, par exemple, des extensions tr√®s puissantes pour l'√©diteur.  Notre cas montre une utilisation tr√®s atypique des m√©thodes de d√©bogage. </p><br><p>  Pour dessiner, nous avons besoin d'une ligne.  Nous pouvons le faire √† l'aide d'un vecteur qui sera cr√©√© √† partir des valeurs de notre tableau.  Veuillez noter que pour cr√©er une belle forme audio miroir, nous devons ¬´coller¬ª les deux moiti√©s de notre visualisation. </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; waveFormArray.Length - <span class="hljs-number"><span class="hljs-number">1</span></span>; i++) { <span class="hljs-comment"><span class="hljs-comment">//      Vector3 upLine = new Vector3(i * .01f, waveFormArray[i] * 10, 0); //      Vector3 downLine = new Vector3(i * .01f, -waveFormArray[i] * 10, 0); }</span></span></code> </pre> <br><p>  Ensuite, utilisez simplement Debug.DrawLine pour dessiner nos vecteurs.  N'importe quelle couleur peut choisir.  Toutes ces m√©thodes doivent √™tre appel√©es dans Update, nous mettrons donc √† jour les informations √† chaque image. </p><br><pre> <code class="cs hljs">Debug.DrawLine(upLine, downLine, Color.green);</code> </pre> <br><p>  Si vous le souhaitez, vous pouvez ajouter un ¬´curseur¬ª qui montrera la position actuelle de la piste en cours de lecture.  Ces informations peuvent √™tre obtenues √† partir du champ "AudioSource.timeSamples". </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> debugLineWidth = <span class="hljs-number"><span class="hljs-number">5</span></span>; <span class="hljs-comment"><span class="hljs-comment">// ""  .       int currentPosition = (myAudio.timeSamples / quality) * 2; Vector3 drawVector = new Vector3(currentPosition * 0.01f, 0, 0); Debug.DrawLine(drawVector - Vector3.up * debugLineWidth, drawVector + Vector3.up * debugLineWidth, Color.white);</span></span></code> </pre> <br><p>  Total, voici notre script: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">WaveFormDebug</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> quality = <span class="hljs-number"><span class="hljs-number">100</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> sampleCount = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> freq; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> debugLineWidth = <span class="hljs-number"><span class="hljs-number">5</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] waveFormArray; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] samples; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> AudioSource myAudio; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { myAudio = gameObject.GetComponent&lt;AudioSource&gt;(); <span class="hljs-comment"><span class="hljs-comment">//  freq = myAudio.clip.frequency; sampleCount = freq / quality; //  samples = new float[myAudio.clip.samples * myAudio.clip.channels]; myAudio.clip.GetData(samples, 0); //       waveFormArray = new float[(samples.Length / sampleCount)]; for (int i = 0; i &lt; waveFormArray.Length; i++) { waveFormArray[i] = 0; for (int j = 0; j &lt; sampleCount; j++) { waveFormArray[i] += Mathf.Abs(samples[(i * sampleCount) + j]); } waveFormArray[i] /= sampleCount; } } private void Update() { for (int i = 0; i &lt; waveFormArray.Length - 1; i++) { //      Vector3 upLine = new Vector3(i * 0.01f, waveFormArray[i] * 10, 0); //      Vector3 downLine = new Vector3(i * 0.01f, -waveFormArray[i] * 10, 0); // Debug  Debug.DrawLine(upLine, downLine, Color.green); } // ""  .       int currentPosition = (myAudio.timeSamples / quality) * 2; Vector3 drawVector = new Vector3(currentPosition * 0.01f, 0, 0); Debug.DrawLine(drawVector - Vector3.up * debugLineWidth, drawVector + Vector3.up * debugLineWidth, Color.white); } }</span></span></code> </pre> <br><p>  Et voici le r√©sultat: </p><br><p><img src="https://habrastorage.org/webt/gq/ij/fd/gqijfdc9d3b6t1nemd-wqsxqn70.png"></p><br><h4 id="sozdanie-plavnogo-zvukovogo-landshafta-s-pomoschyu-polygoncollider2d">  Cr√©ez un paysage sonore fluide avec PolygonCollider2D </h4><br><p>  Avant de passer √† cette section, je tiens √† noter ce qui suit: bien s√ªr, conduire le long de la piste g√©n√©r√©e √† partir de la musique est amusant, mais du point de vue du gameplay, il est pratiquement inutile.  Et voici pourquoi: </p><br><ol><li>  Pour que la piste soit passable, nous devons lisser nos donn√©es.  Tous les pics disparaissent et vous arr√™tez pratiquement de "sentir votre musique" </li><li>  Habituellement, les morceaux de musique sont fortement compress√©s et repr√©sentent une brique sonore, ce qui est mal adapt√© √† un jeu 2D. </li><li>  La question non r√©solue de la vitesse de notre transport, qui devrait convenir √† la vitesse de la piste.  Je veux examiner cette question dans le prochain article. </li></ol><br><p>  Par cons√©quent, √† titre exp√©rimental, ce type de g√©n√©ration est assez dr√¥le, mais il est difficile de cr√©er une v√©ritable fonctionnalit√© de gameplay sur cette base.  En tout cas, nous continuons. </p><br><p>  Nous devons donc cr√©er PolygonCollider2D en utilisant nos donn√©es.  C'est facile √† faire.  PolygonCollider2D poss√®de un champ de points publics qui accepte Vector2 [].  Tout d'abord, nous devons transf√©rer nos points aux vecteurs du type souhait√©.  Faisons une fonction pour traduire le tableau de nos √©chantillons en un tableau vectoriel: </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> Vector2[] </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreatePath</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] src</span></span></span><span class="hljs-function">)</span></span> { Vector2[] result = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2[src.Length]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; size; i++) { result[i] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(i * <span class="hljs-number"><span class="hljs-number">0.01f</span></span>, Mathf.Abs(src[i] * lineScale)); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; }</code> </pre> <br><p>  Apr√®s cela, passez simplement notre tableau de vecteurs r√©sultant au collisionneur: </p><br><pre> <code class="cs hljs">path = CreatePath(waveFormArray); poly.points = path;</code> </pre> <br><p>  Nous regardons le r√©sultat.  Voici le d√©but de notre piste ... hmm ... √ßa n'a pas l'air tr√®s passable (ne pensez pas encore √† la visualisation, les commentaires viendront plus tard). </p><br><p><img src="https://habrastorage.org/webt/e-/3e/ry/e-3eryzi385zy3f4r-hvnsi0iwc.png"></p><br><p>  Nous avons une forme audio trop nette, donc la piste sort bizarrement.  Besoin de le lisser.  Ici, nous utilisons l'algorithme de moyenne mobile.  Vous pouvez en savoir plus sur Habr, dans l'article <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">L'algorithme de moyenne mobile (Moyenne mobile simple)</a> . </p><br><p>  Dans Unity, l'algorithme est impl√©ment√© comme suit: </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function">[] </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MovingAverage</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> frameSize, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] data</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> sum = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] avgPoints = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[data.Length - frameSize + <span class="hljs-number"><span class="hljs-number">1</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> counter = <span class="hljs-number"><span class="hljs-number">0</span></span>; counter &lt;= data.Length - frameSize; counter++) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> innerLoopCounter = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> index = counter; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (innerLoopCounter &lt; frameSize) { sum = sum + data[index]; innerLoopCounter += <span class="hljs-number"><span class="hljs-number">1</span></span>; index += <span class="hljs-number"><span class="hljs-number">1</span></span>; } avgPoints[counter] = sum / frameSize; sum = <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> avgPoints; }</code> </pre> <br><p>  Nous modifions notre cr√©ation de chemin: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] avgArray = MovingAverage(frameSize, waveFormArray); path = CreatePath(avgArray); poly.points = path;</code> </pre> <br><p>  V√©rification ... </p><br><p><img src="https://habrastorage.org/webt/m5/rk/sb/m5rksbekvjfd45482gbgprvnmn0.png"></p><br><p>  Maintenant, notre piste semble tout √† fait normale.  J'ai utilis√© une largeur de fen√™tre de 10. Vous pouvez modifier ce param√®tre pour choisir le lissage dont vous avez besoin. </p><br><p>  Voici le script complet de cette section: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">WaveFormTest</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> frameSize = <span class="hljs-number"><span class="hljs-number">10</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> size = <span class="hljs-number"><span class="hljs-number">2048</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> PolygonCollider2D poly; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> lineScale = <span class="hljs-number"><span class="hljs-number">5</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> quality = <span class="hljs-number"><span class="hljs-number">100</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> sampleCount = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] waveFormArray; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] samples; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Vector2[] path; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> AudioSource myAudio; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { myAudio = gameObject.GetComponent&lt;AudioSource&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> freq = myAudio.clip.frequency; sampleCount = freq / quality; samples = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[myAudio.clip.samples * myAudio.clip.channels]; myAudio.clip.GetData(samples, <span class="hljs-number"><span class="hljs-number">0</span></span>); waveFormArray = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[(samples.Length / sampleCount)]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; waveFormArray.Length; i++) { waveFormArray[i] = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> j = <span class="hljs-number"><span class="hljs-number">0</span></span>; j &lt; sampleCount; j++) { waveFormArray[i] += Mathf.Abs(samples[(i * sampleCount) + j]); } waveFormArray[i] /= sampleCount * <span class="hljs-number"><span class="hljs-number">2</span></span>; } <span class="hljs-comment"><span class="hljs-comment">//  ,    frameSize float[] avgArray = MovingAverage(frameSize, waveFormArray); path = CreatePath(avgArray); poly.points = path; } private Vector2[] CreatePath(float[] src) { Vector2[] result = new Vector2[src.Length]; for (int i = 0; i &lt; size; i++) { result[i] = new Vector2(i * 0.01f, Mathf.Abs(src[i] * lineScale)); } return result; } private float[] MovingAverage(int frameSize, float[] data) { float sum = 0; float[] avgPoints = new float[data.Length - frameSize + 1]; for (int counter = 0; counter &lt;= data.Length - frameSize; counter++) { int innerLoopCounter = 0; int index = counter; while (innerLoopCounter &lt; frameSize) { sum = sum + data[index]; innerLoopCounter += 1; index += 1; } avgPoints[counter] = sum / frameSize; sum = 0; } return avgPoints; } }</span></span></code> </pre> <br><p>  Comme je l'ai dit au d√©but de la section, avec ce lissage, on arr√™te de sentir la piste, en plus, la vitesse de la machine n'est pas li√©e √† la vitesse de la musique (BPM).  Nous analyserons ce probl√®me dans la prochaine partie de cette s√©rie d'articles.  De plus, nous aborderons le sujet des sp√©ciaux.  effets sous le rythme.  Au fait, j'ai pris une machine √† √©crire de cet <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">actif gratuit</a> . </p><br><p>  Beaucoup d'entre vous, en regardant les captures d'√©cran, se demandent probablement comment j'ai dessin√© le morceau lui-m√™me?  Apr√®s tout, les collisionneurs ne sont pas visibles. </p><br><p>  J'ai utilis√© la sagesse d'Internet et trouv√© un moyen par lequel vous pouvez transformer un collisionneur de polygones en un maillage auquel vous pouvez affecter n'importe quel mat√©riau, et le rendu de ligne fera un contour √©l√©gant.  Cette m√©thode est d√©crite en d√©tail <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> .  Triangulator vous pouvez prendre sur la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">communaut√© Unity</a> . </p><br><h2 id="zavershenie">  Ach√®vement </h2><br><p>  Ce que nous avons appris dans cet article est un croquis de base pour les jeux musicaux.  Oui, sous cette forme, il est, jusqu'√† pr√©sent, un peu moche, mais vous pouvez dire en toute s√©curit√© "Les gars, j'ai fait rouler la machine le long de la piste audio!".  Pour en faire un vrai jeu, vous devez faire beaucoup d'efforts.  Voici une liste de ce que nous pouvons faire ici: </p><br><ol><li>  Liez la vitesse de la machine √† la piste BPM.  Le joueur ne peut contr√¥ler que l'inclinaison de la voiture, mais pas la vitesse.  Ensuite, la musique se sentira beaucoup plus forte pendant le cours. </li><li>  Faites un d√©tecteur de bits et ajoutez des sp√©ciaux.  effets qui fonctionneront sous le rythme.  De plus, vous pouvez ajouter une animation au corps de la voiture, qui rebondira sur le rythme d'un battement.  Tout d√©pend de votre imagination. </li><li>  Au lieu de d√©placer la moyenne, vous devez traiter la piste de mani√®re plus comp√©tente et obtenir un tableau de donn√©es afin que les pics ne disparaissent pas, mais il √©tait facile de cr√©er une trace. </li><li>  Et bien s√ªr, vous devez rendre le gameplay int√©ressant.  Vous pouvez placer un monnayeur sur chaque coup, ajouter des zones de danger, etc. </li></ol><br><p>  Nous √©tudierons tout cela et bien plus dans les parties restantes de cette s√©rie d'articles.  Merci √† tous d'avoir lu! </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr432134/">https://habr.com/ru/post/fr432134/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr432120/index.html">Lenovo versera aux propri√©taires d'ordinateurs portables une compensation de 8,3 millions de dollars pour l'installation du logiciel malveillant Superfish</a></li>
<li><a href="../fr432122/index.html">Xcode et d√©bogage avanc√© dans LLDB: Partie 2</a></li>
<li><a href="../fr432128/index.html">B√©quilles, Narnia, Procrustes Ninja: trois douleurs timides dans une startup</a></li>
<li><a href="../fr432130/index.html">Mitaps d'automne sur le d√©veloppement mobile dans le bureau Tutu.ru</a></li>
<li><a href="../fr432132/index.html">William Shakespeare: difficult√©s √† traduire les sonnets en russe</a></li>
<li><a href="../fr432136/index.html">Refroidissez le processeur dans le centre de donn√©es - l'impression laser 3D vous aidera</a></li>
<li><a href="../fr432138/index.html">Parlons des m√©triques comme moyen d'√©valuer le travail d'un programmeur</a></li>
<li><a href="../fr432142/index.html">Surveillance des ruches et projet ouvert</a></li>
<li><a href="../fr432144/index.html">Comment nous nous sommes int√©gr√©s pour les magasins SAP en Europe avec des caisses en Russie via 1C</a></li>
<li><a href="../fr432146/index.html">Zimbra Collaboration Suite en remplacement digne de Microsoft Exchange</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>