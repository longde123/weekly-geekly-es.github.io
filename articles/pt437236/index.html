<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèΩ‚Äçüè´ üßîüèΩ ‚úãüèæ ESET: Uma an√°lise de novos componentes de zebr√≥citos üê≠ ‚ìÇÔ∏è üßôüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="O cibergrupo Sednit est√° em opera√ß√£o desde pelo menos 2004 e aparece regularmente no notici√°rio. Acredita-se que Sednit (mais conhecido como Fancy Bea...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ESET: Uma an√°lise de novos componentes de zebr√≥citos</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/eset/blog/437236/">  O cibergrupo Sednit est√° em opera√ß√£o desde pelo menos 2004 e aparece regularmente no notici√°rio.  Acredita-se que Sednit (mais conhecido como Fancy Bear) esteja por tr√°s do crack do Comit√™ Nacional Democrata dos EUA antes das elei√ß√µes de 2016, da Ag√™ncia Mundial Antidopagem (WADA), da rede de televis√£o TV5Monde e de outros ataques.  O arsenal do grupo inclui um conjunto de ferramentas maliciosas, algumas das quais documentamos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">em um relat√≥rio anterior</a> . <br><br>  Lan√ßamos recentemente um relat√≥rio sobre o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">LoJax</a> , um rootkit UEFI tamb√©m relacionado ao Sednit e usado em ataques nos B√°lc√£s, na Europa Central e Oriental. <br><br>  Em agosto de 2018, os operadores da Sednit implantaram dois novos componentes do Zebrocy e, a partir de agora, vimos um aumento no uso dessa ferramenta.  O Zebrocy √© uma cole√ß√£o de gerenciadores de inicializa√ß√£o, conta-gotas e backdoors.  Downloaders e conta-gotas s√£o para intelig√™ncia, enquanto os backdoors fornecem persist√™ncia e spyware.  Esses novos componentes t√™m uma maneira incomum de filtrar dados coletados atrav√©s dos protocolos de servi√ßo de correio SMTP e POP3. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/fh/nc/qk/fhncqkih604tvkrg44vywz9uzum.jpeg"></div><a name="habracut"></a><br>  As v√≠timas das novas ferramentas se assemelham √†s v√≠timas mencionadas em nosso post anterior sobre o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Zebrocy</a> , bem como na <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Kaspersky Lab</a> .  Os alvos dos ataques est√£o na √Åsia Central, Europa Central e Oriental, principalmente embaixadas, minist√©rios das Rela√ß√µes Exteriores e diplomatas. <br><br><h3>  Revis√£o </h3><br><img src="https://habrastorage.org/webt/-y/xq/ob/-yxqobqgv5jqqvti0t4zsnea5se.png"><br>  <i>Figura 1. Esquema dos componentes Zebrocy antigos e novos</i> <br><br>  Por dois anos, o cibergrupo Sednit usou e-mails de phishing como vetor de infec√ß√£o por Zebrocy (op√ß√µes 1 e 2 na tabela acima).  Ap√≥s o comprometimento, os atacantes usaram v√°rios gerenciadores de inicializa√ß√£o do primeiro est√°gio para coletar informa√ß√µes sobre a v√≠tima e, em caso de interesse, ap√≥s algumas horas ou dias, implantaram uma das backdoors do segundo n√≠vel. <br><br>  O esquema cl√°ssico da campanha da Zebrocy √© obter a v√≠tima como arquivo no anexo da carta.  O arquivo cont√©m dois arquivos, um dos quais √© um documento inofensivo e o segundo √© um arquivo execut√°vel.  Os atacantes tentam enganar a v√≠tima chamando o segundo arquivo de um nome t√≠pico do documento ou imagem e usando a ‚Äúextens√£o dupla‚Äù. <br><br>  Na nova campanha (op√ß√£o 3 da tabela), um esquema mais complicado √© usado - vamos analis√°-lo abaixo. <br><br><h3>  Conta-gotas Delphi </h3><br>  O primeiro bin√°rio √© um conta-gotas Delphi, o que √© bastante incomum para a campanha de Zebrocy.  Na maioria dos casos, √© um gerenciador de inicializa√ß√£o instalado no sistema da v√≠tima no primeiro est√°gio do ataque. <br><br>  Com a ajuda de v√°rios m√©todos, o conta-gotas complica a engenharia reversa.  Nas amostras examinadas, ele usa a palavra-chave <i>f√≠gado</i> para indicar o in√≠cio e o fim dos elementos-chave, como mostrado abaixo. <br><br><pre><code class="plaintext hljs">$ yara -s tag_yara.yar SCANPASS_QXWEGRFGCVT_323803488900X_jpeg.exe find_tag SCANPASS_QXWEGRFGCVT_323803488900X_jpeg.exe 0x4c260:$tag: l\x00i\x00v\x00e\x00r\x00 0x6f000:$tag: liver 0x6f020:$tag: liver 0x13ab0c:$tag: liver</code> </pre> <br>  A regra YARA acima pesquisa o <i>f√≠gado de</i> cordas.  A primeira linha do <i>f√≠gado √©</i> usada no c√≥digo, mas n√£o separa nada, enquanto os outros compartilham o descritor de chave, a imagem (seu hexdump √© mostrado abaixo) e o componente criptografado no conta-gotas. <br><br><pre> <code class="plaintext hljs">$ hexdump -Cn 48 -s 0x6f000 SCANPASS_QXWEGRFGCVT_323803488900X_jpeg.exe 0006f000 6c 69 76 65 72 4f 70 65 6e 41 69 72 33 39 30 34 |liverOpenAir3904| 0006f010 35 5f 42 61 79 72 65 6e 5f 4d 75 6e 63 68 65 6e |5_Bayren_Munchen| 0006f020 6c 69 76 65 72 ff d8 ff e0 00 10 4a 46 49 46 00 |liver‚Ä¶‚Ä¶JFIF.|</code> </pre> <br>  Primeiro, os dados s√£o salvos em uma imagem com o nome de arquivo <i>C: \ Users \ public \ Pictures \ scanPassport.jpg</i> , se esse arquivo ainda n√£o existir. <br><br>  Curiosamente, o arquivo dropper √© chamado <i>SCANPASS_QXWEGRFGCVT_323803488900X_jpeg.exe</i> , que tamb√©m sugere um esquema de phishing relacionado a passaportes e informa√ß√µes de viagem.  Isso pode significar que o operador pode saber o objetivo da mensagem de phishing.  O conta-gotas abre a imagem e, se o arquivo j√° existir, interrompe a execu√ß√£o.  Caso contr√°rio, ele abre e recebe o identificador de chave <i>OpenAir39045_Bayren_Munchen</i> .  A imagem est√° ausente, embora o formato esteja correto - veja a figura abaixo. <br><br><img src="https://habrastorage.org/webt/c9/_d/km/c9_dkmprdqv95bluopzc9ylq5ly.png"><br>  <i>Figura 2. ScanPassport.jpg</i> <br><br>  A linha principal do descritor cont√©m <i>Bayren_Munchen</i> - provavelmente uma refer√™ncia ao time de futebol do FC Bayern Munich.  De qualquer forma, o conte√∫do do descritor n√£o √© importante, mas seu comprimento, com o qual voc√™ pode obter a chave XOR para descriptografar o componente. <br><br>  Para obter a chave XOR, o conta-gotas procura a √∫ltima palavra-chave <i>hep√°tica</i> e a indenta pelo comprimento do descritor.  O comprimento da chave XOR √© de 27 (0x1b) bytes (id√™ntico ao comprimento do descritor de chave). <br><br>  Usando a chave XOR e um loop simples, o conta-gotas descriptografa a √∫ltima parte - o componente criptografado localizado imediatamente ap√≥s a √∫ltima tag at√© o final do arquivo.  Observe que o cabe√ßalho MZ do componente execut√°vel come√ßa imediatamente ap√≥s a palavra-chave <i>f√≠gado</i> e a chave XOR √© obtida da parte do cabe√ßalho PE, que geralmente √© uma sequ√™ncia de 0x00 bytes recuperada ap√≥s a descriptografia do componente, como mostra a figura abaixo. <br><br><img src="https://habrastorage.org/webt/lm/lt/ty/lmlttyypf34eysahxyd0kplpuhu.png"><br>  <i>Figura 3. Componente criptografado (esquerda) versus componente descriptografado (direita)</i> <br><br>  O componente √© redefinido para <i>C: \ Users \ Public \ Documents \ AcrobatReader.txt</i> e converte o arquivo em <i>C: \ Users \ Public \ Documents \ AcrobatReader.exe</i> . <br><br>  Talvez seja uma tentativa de ignorar a prote√ß√£o do PC, que gera um aviso quando um arquivo bin√°rio libera um arquivo com a extens√£o .exe em disco. <br><br>  Mais uma vez, o operador tenta enganar a v√≠tima e, se prestar aten√ß√£o no diret√≥rio, ver√° a imagem como na figura a seguir: <br><br><img src="https://habrastorage.org/webt/ql/vj/q3/qlvjq3gqetpqgo5cgyo8-bc9nug.png"><br>  <i>Figura 4. O componente se parece com um arquivo PDF</i> <br><br>  Por padr√£o, o Windows oculta a extens√£o, e isso √© usado por um invasor que despeja o arquivo execut√°vel na pasta Documentos e o disfar√ßa em PDF. <br><br>  Finalmente, o conta-gotas executa o componente hospedado e sai. <br><br><h3>  MSIL Mail Loader </h3><br>  O componente entregue do conta-gotas anterior √© o carregador MSIL embalado com UPX.  Para uma melhor compreens√£o, a l√≥gica do processo √© descrita abaixo, o c√≥digo fonte √© fornecido e o esquema de controle √© considerado. <br><br>  O m√©todo principal chama <i>Executar</i> para iniciar o aplicativo, que cria o <i>Form1</i> . <br><br><pre> <code class="plaintext hljs">{   Application.EnableVisualStyles();   Application.SetCompatibleTextRenderingDefault(false);   Application.Run((Form) new Form1()); }</code> </pre> <br>  <i>Formul√°rio1</i> atribui muitas vari√°veis, incluindo um novo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Timer</a> para sete delas. <br><br><pre> <code class="plaintext hljs">   this.start = new Timer(this.components);  this.inf = new Timer(this.components);   this.txt = new Timer(this.components);   this.subject = new Timer(this.components);   this.run = new Timer(this.components);   this.load = new Timer(this.components);   this.screen = new Timer(this.components);</code> </pre> <br>  O objeto Timer possui tr√™s campos importantes: <br><br><ul><li>  Ativado: indica o status do timer ativado. </li><li>  Intervalo: tempo entre eventos em milissegundos </li><li>  Tick: o retorno de chamada √© executado ap√≥s o t√©rmino do cron√¥metro e se o cron√¥metro estiver ativado </li></ul><br>  Os campos s√£o indicados da seguinte forma: <br><br><pre> <code class="plaintext hljs">  this.start.Enabled = true;   this.start.Interval = 120000;   this.start.Tick += new EventHandler(this.start_Tick);   this.inf.Interval = 10000;   this.inf.Tick += new EventHandler(this.inf_Tick);   this.txt.Interval = 120000;   this.txt.Tick += new EventHandler(this.txt_Tick);   this.subject.Interval = 120000;   this.subject.Tick += new EventHandler(this.subject_Tick);   this.run.Interval = 60000;   this.run.Tick += new EventHandler(this.run_Tick);   this.load.Interval = 120000;   this.load.Tick += new EventHandler(this.load_Tick);   this.screen.Interval = 8000;   this.screen.Tick += new EventHandler(this.screen_Tick);</code> </pre> <br>  Para cada objeto, o <i>intervalo de</i> intervalo √© definido de 8 segundos a 2 minutos.  Um retorno de chamada √© adicionado ao manipulador de eventos.  Observe que apenas <i>start</i> define o valor como true para <i>Enabled</i> , o que significa que ap√≥s 2 minutos (12.000 milissegundos = 120 segundos), <i>start_Tick</i> ser√° chamado pelo manipulador de eventos. <br><br><pre> <code class="plaintext hljs">   private void start_Tick(object sender, EventArgs e)   {       try       {           this.start.Enabled = false;           Lenor lenor = new Lenor();           this.dir = !Directory.Exists(this.label15.Text.ToString()) ? this.label16.Text.ToString() + "\" : this.label15.Text.ToString() + "\";           this.att = this.dir + "audev.txt";           this._id = lenor.id(this.dir);           this.inf.Enabled = true;       }</code> </pre> <br>  Al√©m disso, cada m√©todo demonstra um comportamento id√™ntico - altera o valor <i>Enabled</i> para <i>false</i> no in√≠cio.  O m√©todo √© executado e altera o valor <i>Ativado</i> do pr√≥ximo objeto para <i>true</i> , o que ativa o pr√≥ximo timer.  A vari√°vel <i>Enabled</i> √© usada pelo operador para criar algo como uma m√°quina de estado - se a fun√ß√£o n√£o funcionar, o mecanismo repetir√° sua execu√ß√£o at√© receber um resultado positivo.  O tempo entre as execu√ß√µes de duas fun√ß√µes pode ser usado como uma tentativa de ignorar a prote√ß√£o antiv√≠rus adicionando um atraso. <br><br>  Agora, depois de descrever a estrutura de cada m√©todo, passamos ao algoritmo de controle.  A seguir, √© apresentada uma vis√£o geral das etapas na forma de troca de emails entre caixas de correio. <br><br><img src="https://habrastorage.org/webt/hd/zj/tl/hdzjtlq57qrzyht5k_lsydclpxm.png"><br>  <i>Figura 5. Troca de email</i> <br><br>  Malvar verifica a exist√™ncia de um caminho espec√≠fico usado para despejar cada um dos arquivos durante a execu√ß√£o.  Se poss√≠vel, use <i>C: \ Users \ Public \ Videos \</i> , caso contr√°rio, <i>C: \ Documents and Settings \ All Users \ Documents \</i> como o diret√≥rio padr√£o.  Observe que o segundo caminho √© espec√≠fico para o Windows XP, enquanto o primeiro caminho √© espec√≠fico para o Vista e superior. <br><br>  Um <i>ID de</i> 16 bytes <i>√©</i> gerado concatenando o n√∫mero de s√©rie do volume C: e o nome de usu√°rio;  Ele √© armazenado no arquivo <i>audev.txt</i> . <br><br>  O carregador de inicializa√ß√£o coleta as seguintes informa√ß√µes: <br>  - caminho atual do aplicativo <br>  - vers√£o do sistema operacional <br>  - diret√≥rio do sistema <br>  - dom√≠nio do usu√°rio <br>  - nome do carro <br>  - nome de usu√°rio <br>  - fuso hor√°rio atual <br>  - data atual <br>  - uma lista de unidades l√≥gicas e informa√ß√µes sobre cada uma delas (modelo, n√∫mero de s√©rie etc.) <br>  - listando os diret√≥rios <i>C: \ Arquivos de programas \</i> e <i>C: \ Arquivos de programas (x86) \</i> <br>  - lista de processos <br><br>  Esses dados s√£o armazenados no arquivo <i>C: \ Users \ Public \ Videos \ si.ini</i> e enviados por carta no anexo via SMTPS usando a porta padr√£o 465. O corpo da mensagem cont√©m a linha <i>SI</i> (que pode significar Informa√ß√µes do sistema), o destinat√°rio da mensagem √© <i>sym777. g@post.cz</i> .  Para toda a troca de informa√ß√µes, o assunto das letras √© indicado como <i>id</i> . <br><br>  O operador decidiu criar v√°rios endere√ßos sobressalentes e envia a mesma carta para outros dois destinat√°rios, provavelmente, caso o endere√ßo principal n√£o funcione.  Ap√≥s enviar a carta, o carregador de inicializa√ß√£o exclui o arquivo <i>si.ini</i> . <br><br>  Durante a primeira execu√ß√£o do malware, um arquivo <i>set.txt</i> √© <i>criado</i> com o texto <i>{System_Parametrs = 10}</i> dentro e uma entrada na chave de registro do Windows. <br><br><img src="https://habrastorage.org/webt/hl/eh/ge/hlehgecuzoyjoygnnlt6c1q2l58.png"><br>  <i>Figura 6. Persist√™ncia no registro</i> <br><br>  Uma captura de tela √© <i>obtida</i> com o nome <i>scx.bin</i> no computador da v√≠tima e enviada por anexo de e-mail com o texto <i>SC</i> (que pode significar <i>captura</i> de tela) no corpo da mensagem. <br><br>  Ap√≥s o envio, o malware entra em contato com a caixa de correio <i>kae.mezhnosh@post.cz</i> usando o protocolo POP3 sobre SSL (porta 995) e procura mensagens com um assunto que corresponda ao <i>ID</i> .  Se essa mensagem existir e o corpo n√£o estiver vazio, o malware a descriptografar√° e enviar√° uma mensagem com <i>okey</i> no corpo para <i>sym777.g@post.cz</i> .  O conte√∫do de uma mensagem recebida anteriormente √© limpo e analisado da seguinte maneira: <br><br><pre> <code class="plaintext hljs">string[] strArray = this._adr.Replace("B&amp;", "").Replace("Db", "").Split('%');       string str1 = strArray[0];       string str2 = strArray[1];</code> </pre> <br>  Duas linhas s√£o obtidas: a primeira √© a senha e a segunda √© o nome de usu√°rio para o endere√ßo de email. <br><br>  Novas credenciais s√£o usadas para conectar-se √† caixa de correio recebida, procurar nela uma mensagem com um t√≥pico que corresponda ao <i>ID do</i> malvari e um aplicativo com a string <i>audev</i> no nome do arquivo.  Se as duas condi√ß√µes forem atendidas, o malware armazenar√° o aplicativo e excluir√° a mensagem do servidor. <br><br>  Um log de mensagens √© enviado para <i>sym777.g@post.cz</i> , e as mensagens recebidas pelo POP3 s√£o enviadas pelo destinat√°rio com dados do usu√°rio recebidos recentemente. <br><br>  O esquema de ataque complica a investiga√ß√£o.  Primeiramente, se voc√™ tiver um carregador de inicializa√ß√£o com letras, n√£o poder√° se conectar √† caixa de correio que cont√©m a pr√≥xima etapa. <br><br>  Em segundo lugar, se voc√™ receber credenciais para correio, ainda n√£o poder√° obter a pr√≥xima carga √∫til, pois ela ser√° exclu√≠da ap√≥s o recebimento. <br><br>  Quando o carregador de inicializa√ß√£o grava com √™xito o anexo no disco, ele envia uma mensagem pelo correio com <i>okey2</i> no corpo e o anexo <i>l.txt</i> contendo <i>090</i> .  O mesmo arquivo √© substitu√≠do por zeros e o malware tenta receber outra mensagem.  Se isso funcionar, o arquivo <i>l.txt</i> √© <i>enviado</i> com <i>okey3</i> no corpo.  O conte√∫do do anexo √© o diret√≥rio e o nome do arquivo.  Malvar move o arquivo audev para este endere√ßo.  Por fim, o malware envia um email com <i>okey4</i> no corpo e <i>l.txt</i> no anexo.  Isso inicia o arquivo execut√°vel, <i>audev.exe,</i> e verifica a presen√ßa da linha <i>audev</i> na lista de processos. <br><br><pre> <code class="plaintext hljs">  Process.Start(this.rn);   foreach (Process process in Process.GetProcesses())   {       if (process.ProcessName.Contains("audev")) }</code> </pre> <br>  Se esse nome for encontrado, a √∫ltima letra ser√° enviada, contendo no corpo <i>okey5</i> e <i>l.txt</i> no anexo.  Por fim, <i>l.txt</i> e <i>set.txt</i> s√£o exclu√≠dos, a chave de registro criada do Windows √© exclu√≠da e o programa √© encerrado. <br><br><h3>  Delphi Mail Downloader </h3><br>  A principal fun√ß√£o do gerenciador de inicializa√ß√£o √© avaliar a import√¢ncia de um sistema comprometido e, se parecer interessante, carregar e executar o √∫ltimo gerenciador de inicializa√ß√£o Zebrocy. <br><br>  O arquivo bin√°rio √© escrito em Delphi e empacotado usando UPX.  Uma defini√ß√£o completa do objeto <i>TForm1</i> pode ser encontrada na se√ß√£o com seus recursos, mostrando alguns par√¢metros de configura√ß√£o usados.  As se√ß√µes a seguir descrevem a inicializa√ß√£o, os recursos e o protocolo de rede do carregador de inicializa√ß√£o. <br><br><h3>  Inicializa√ß√£o </h3><br>  Primeiro, descriptografa o conjunto de strings que s√£o endere√ßos de email e senhas.  O operador aplica o algoritmo de criptografia <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">AES ECB</a> .  Cada linha √© descriptografada em local hexadecimal, onde os quatro primeiros bytes correspondem ao tamanho final da linha descriptografada (as linhas descriptografadas no final podem conter algum recuo).  O objeto <i>TForm1</i> cont√©m duas chaves AES: a primeira √© usada para criptografar dados e a segunda √© usada para descriptografar. <br><br>  Os endere√ßos de correio e as senhas s√£o usados ‚Äã‚Äãpelo operador para enviar comandos aos malvari, bem como para obter informa√ß√µes coletadas do computador da v√≠tima.  Os protocolos de comunica√ß√£o SMTP e POP3 s√£o aplicados - ambos via SSL.  Para usar o OpenSSL, o malware reduz e usa duas bibliotecas din√¢micas do OpenSSL: <i>libeay32.dll (98c348cab0f835d6cf17c3a31cd5811f86c0388b)</i> e <i>ssleay32.dll (6d981d71895581dfb103170486b8614f7f203bdc)</i> . <br><br><img src="https://habrastorage.org/webt/fo/vl/_6/fovl_6evpu2kfxhr3b-4kcjeets.png"><br>  <i>Figura 7. Propriedades da DLL do OpenSSL</i> <br><br>  Observe que todos os arquivos s√£o despejados no diret√≥rio ativo do malware <i>: C: \ Users \ Public \</i> . <br><br>  A persist√™ncia √© fornecida durante a primeira execu√ß√£o dos malvari por meio da conhecida <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">t√©cnica de</a> script do script de entrada.  Um arquivo com o script <i>registration.bat</i> √© criado e v√°rias linhas s√£o gravadas a partir do objeto <i>TForm1</i> .  O script final √© o seguinte: <br><br><pre> <code class="plaintext hljs">reg add HKCU\Environment /v "UserInitMprLogonScript" /t REG_EXPAND_SZ /d "C:\Users\Public\Videos\audev.exe" /f del C:\Users\Public\Videos\registr.bat exit</code> </pre> <br>  Por √∫ltimo, mas n√£o menos importante, o malware cria um <i>ID</i> , da mesma maneira que nos bin√°rios Zebrocy descritos anteriormente.  Ele obt√©m o nome de usu√°rio usando a <i>API do</i> Windows <i>GetUserNameW</i> e adiciona o n√∫mero de s√©rie da unidade C: \ ao in√≠cio. <br><br><h3>  As possibilidades </h3><br>  Dado que existem v√°rias condi√ß√µes e procedimentos para coletar informa√ß√µes sobre a v√≠tima, a seguir √© apresentada uma descri√ß√£o de suas v√°rias capacidades.  A configura√ß√£o da verifica√ß√£o √© armazenada no objeto <i>TForm1</i> , onde s√£o agrupadas sete possibilidades diferentes para coletar informa√ß√µes do computador da v√≠tima. <br><br>  Come√ßando com uma verifica√ß√£o simples, as primeiras informa√ß√µes que o malware pode obter est√£o relacionadas a arquivos com as seguintes extens√µes: <i>.docx, .xlsx, .pdf, .pptx, .rar, .zip, .jpg, .bmp, .tiff</i> .  Para cada um dos arquivos encontrados no disco, o malware recebe o caminho completo e a data da √∫ltima modifica√ß√£o.  Essas informa√ß√µes s√£o criptografadas usando a chave AES, sobre a qual falamos anteriormente, e armazenadas no arquivo <i>0.txt</i> .  Outra verifica√ß√£o √© direcionada √†s extens√µes <i>.dat, .json, .db</i> e, como no caso anterior, obt√©m o caminho completo e a √∫ltima data em que o arquivo foi alterado.  Em seguida, os criptografa e os armazena no arquivo <i>57.txt</i> . <br><br>  A listagem de processos em execu√ß√£o √© outro recurso do malvari que permite armazenar informa√ß√µes em um arquivo <i>08.txt</i> .  √â assim: <br><br><pre> <code class="plaintext hljs">======Listing_of_processes======= [System Process] System smss.exe csrss.exe wininit.exe csrss.exe winlogon.exe services.exe lsass.exe [‚Ä¶]</code> </pre> <br>  O arquivo <i>i.txt</i> coleta informa√ß√µes gerais sobre o computador da v√≠tima, bem como algumas informa√ß√µes sobre os malvari (n√∫mero da vers√£o e o caminho no qual √© executado).  Veja o exemplo abaixo: <br><br><pre> <code class="plaintext hljs">v7.00 C:\Users\Public\Videos\audev.txt ============================================ Log_Drivers: C: fixed; size= 102297 Mb, free=83927 Mb S/N: [redacted] ================================================== OSV: Windows 7 WinType: 32 WinDir: C:\Windows Lang: English (United States) TZ: UTC1:0 Romance Standard Time HostN: [redacted]-PC User: [redacted] ===============S_LIST===================== C:\Program Files\Common Files C:\Program Files\desktop.ini C:\Program Files\DVD Maker C:\Program Files\Internet Explorer C:\Program Files\Microsoft.NET C:\Program Files\MSBuild C:\Program Files\Reference Assemblies C:\Program Files\Uninstall Information C:\Program Files\Windows Defender [‚Ä¶]</code> </pre> <br>  O malware pode capturar capturas de tela, salvas no formato <i>2 \ [AAAA-mm-dd HH-MM-SS] -Image_001.jpg</i> , e gera outro arquivo <i>2 \ sa.bin</i> , preenchido com uma lista de caminhos para os arquivos de todas as capturas de tela capturadas.  A √∫ltima op√ß√£o √© listar componentes de rede e dados do sistema, o resultado √© gravado em <i>4.txt</i> . <br><br><h3>  Protocolo de rede </h3><br>  O carregador de correio Delphi √© uma adi√ß√£o relativamente nova ao kit de ferramentas Zebrocy, pois fornece uma nova maneira de filtrar dados e receber comandos do operador.  A exfiltra√ß√£o √© bastante simples, mas faz muito barulho na rede, uma vez que os arquivos criptografados coletados anteriormente s√£o enviados via SMTPS, cada vers√£o do arquivo √© tr√™s vezes maior. <br><br><img src="https://habrastorage.org/webt/tw/xe/if/twxeif5sgovtnxjkuxhrcmcqyze.png"><br><br>  O assunto da mensagem √© o <i>ID</i> da v√≠tima e o arquivo √© enviado como um anexo com uma palavra-chave correspondente ao conte√∫do do arquivo.  Observe que para cada arquivo h√° uma vers√£o criptografada sendo enviada. <br><br><img src="https://habrastorage.org/webt/pn/pv/1m/pnpv1mmbkhhjs3qfrxa2uthwsky.png"><br><br>  Capturas de tela e arquivos para as duas verifica√ß√µes tamb√©m s√£o enviados, mas com palavras-chave diferentes. <br><br><img src="https://habrastorage.org/webt/vu/s8/32/vus8328b9llia3xsyobiyqmnejw.png"><br><br><img src="https://habrastorage.org/webt/x9/ds/0h/x9ds0hckegel5ayp75d4nmkgtuc.png"><br>  <i>Figura 8. Exemplo de uma mensagem com dados transmitidos</i> <br><br>  Enquanto a exfiltra√ß√£o dos dados usa o protocolo SMTP, o arquivo bin√°rio √© associado ao <i>endere√ßo de</i> email <i>tomasso25@ambcomission.com</i> via POP3 e an√°lise de mensagens.  O corpo da carta cont√©m v√°rias palavras-chave interpretadas pelo malware como comandos. <br><br><img src="https://habrastorage.org/webt/wg/de/u7/wgdeu7jmqergcyp8lkyt4tk8ogs.png"><br><br>  Ap√≥s a execu√ß√£o, o log do depurador e o resultado dos comandos (se houver) s√£o enviados de volta ao operador.  Por exemplo, ap√≥s um comando de verifica√ß√£o, o operador recebe um arquivo contendo uma lista de arquivos com extens√µes correspondentes, juntamente com cada um desses arquivos. <br><br>  Enquanto esse carregador de inicializa√ß√£o possui fun√ß√µes de backdoor, ele despeja no sistema um carregador de inicializa√ß√£o no Delphi, j√° associado a esse grupo, que descrevemos em um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">artigo</a> anterior sobre o Zebrocy. <br><br><h3>  Conclus√£o </h3><br>  No passado, j√° vimos a interse√ß√£o entre o Zebrocy e o malware tradicional Sednit.  Pegamos a Zebrocy lan√ßando o backdoor principal da Sednit no sistema XAgent, portanto, com um alto grau de certeza, atribu√≠mos a autoria da Zebrocy a esse cibergrupo. <br><br>  No entanto, a an√°lise dos arquivos bin√°rios revelou erros no n√≠vel da linguagem, bem como o desenvolvimento, indicando um n√≠vel diferente de qualifica√ß√£o dos autores.  Os dois gerenciadores de inicializa√ß√£o usam protocolos de correio para filtrar dados e t√™m mecanismos id√™nticos para coletar as mesmas informa√ß√µes.  No entanto, eles criam muito ru√≠do na rede e no sistema, criando muitos arquivos e enviando-os.  No processo de an√°lise do carregador de correio no Delphi, parecia-nos que algumas fun√ß√µes haviam desaparecido, mas as linhas ainda permaneciam no arquivo bin√°rio.  Este kit de ferramentas √© usado pela equipe da Sednit, mas acreditamos que est√° sendo desenvolvido por outra equipe - menos experiente em compara√ß√£o com os criadores dos componentes tradicionais da Sednit. <br><br>  Os componentes de zebr√≥citos s√£o uma adi√ß√£o ao kit de ferramentas Sednit, e eventos recentes podem explicar o aumento do uso ativo dos bin√°rios de zebr√≥citos, em vez dos malvari tradicionais. <br><br><h3>  Indicadores de compromisso </h3><br><br>  <b>Nomes de arquivo, SHA-1 e detec√ß√£o por produtos da ESET</b> <br><br>  1. SCANPASS_QXWEGRFGCVT_323803488900X_jpeg.exe - 7768fd2812ceff05db8f969a7bed1de5615bfc5a - <b>Win32 / Sednit.ORQ</b> <br>  2. C: \ Usu√°rios \ p√∫blico \ Imagens \ scanPassport.jpg - da70c54a8b9fd236793bb2ab3f8a50e6cd37e2df <br>  3. C: \ Usu√°rios \ P√∫blico \ Documentos \ AcrobatReader. {Exe, txt} - a225d457c3396e647ffc710cd1edd4c74dc57152 - <b>MSIL / Sednit.D</b> <br>  4. C: \ Usu√°rios \ P√∫blico \ V√≠deos \ audev.txt - a659a765536d2099ecbde988d6763028ff92752e - <b>Win32 / Sednit.CH</b> <br>  5.% TMP% \ Indy0037C632.tmp - 20954fe36388ae8b1174424c8e4996ea2689f747 - <b>Win32 / TrojanDownloader.Sednit.CMR</b> <br>  6.% TMP% \ Indy01863A21.tmp - e0d8829d2e76e9bb02e3b375981181ae02462c43 - <b>Win32 / TrojanDownloader.Sednit.CMQ</b> <br><br>  <b>E-mail</b> <br><br>  <i>carl.dolzhek17@post.cz</i> <i><br></i>  <i>shinina.lezh@post.cz</i> <i><br></i>  <i>P0tr4h4s7a@post.cz</i> <i><br></i>  <i>carl.dolzhek17@post.cz</i> <i><br></i>  <i>sym777.g@post.cz</i> <i><br></i>  <i>kae.mezhnosh@post.cz</i> <i><br></i>  <i>tomasso25@ambcomission.com</i> <i><br></i>  <i>kevin30@ambcomission.com</i> <i><br></i>  <i>salah444@ambcomission.com</i> <i><br></i>  <i>karakos3232@seznam.cz</i> <i><br></i>  <i>rishit333@ambcomission.com</i> <i><br></i>  <i>antony.miloshevich128@seznam.cz</i> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt437236/">https://habr.com/ru/post/pt437236/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt437226/index.html">Kelvin Point Shadow</a></li>
<li><a href="../pt437228/index.html">Bitcoin, como moeda, levar√° a uma crise econ√¥mica</a></li>
<li><a href="../pt437230/index.html">Uma publicidade online t√£o diferente. Tr√™s eixos vs. AI, Ad Tech e DOOH</a></li>
<li><a href="../pt437232/index.html">Psto bom</a></li>
<li><a href="../pt437234/index.html">Come√ßamos a estudar microcontroladores usando o exemplo de STM32F030f4p6</a></li>
<li><a href="../pt437238/index.html">Lan√ßamento do Orange Pi 3 - um mini-pc completo de US $ 30 no Linux</a></li>
<li><a href="../pt437240/index.html">Como integrar o Zimbra Collaboration Suite ao Active Directory</a></li>
<li><a href="../pt437242/index.html">Dom√≠nio do gerente de produto. Solicita√ß√µes de recursos</a></li>
<li><a href="../pt437244/index.html">Google ensina usu√°rios a reconhecer e-mails de phishing</a></li>
<li><a href="../pt437248/index.html">FPGA mitap em S√£o Petersburgo</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>