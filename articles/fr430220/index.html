<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🕒 👅 ☝🏼 Comment transformer un hub USB «centenaire» en un smart managed et économiser 300 $ ✉️ 🖐️ 🤱🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="D'une manière ou d'une autre, j'avais besoin d'un concentrateur pendant longtemps, de préférence avec un grand nombre de ports et avec une forme assez...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comment transformer un hub USB «centenaire» en un smart managed et économiser 300 $</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/430220/"><p>  D'une manière ou d'une autre, j'avais besoin d'un concentrateur pendant longtemps, de préférence avec un grand nombre de ports et avec une forme assez pratique, adaptée à l'intégration au lieu d'un lecteur de disquette dans la baie de 3,5 pouces.  Un coup d'œil sur le marché aux puces a jeté le modèle D-link DUB-H7, et même dans la combinaison de «2 pour le prix de 1».  L'inspection externe n'a rien donné de spécial, le hub comme un hub a été fait solidement, la principale "imprimante" USB AM-BM à l'arrière et une alimentation 3A.  Comme toujours, la première chose que j'ai triée, était content d'un petit nombre de places vides au lieu d'éléments, couplé à une soudure de haute qualité et calmé.  C'est vrai, juste au cas où, je suis allé sur Internet pour voir de quel type de hub il s'agissait et s'il y avait des projets intéressants avec sa participation.  Il n'y avait pas de projets, avis d'utilisateurs 50/50, en général, pas de dynamique.  Le hub pendant 5-7 ans a assez bien fonctionné et a rempli sa tâche, puis s'est déplacé en douceur vers la poubelle électronique et aurait probablement disparu en conséquence avec des adaptateurs inconnus, des adaptateurs, etc. Mais un événement s'est produit dans ma vie qui m'a fait fouiller dans des sacs avec de vieilles ordures, trouver celui-ci, comme il s'est avéré, un lien D unique, et secouer la poussière pour l'extraire dans la lumière de Dieu.  Si vous souhaitez savoir pourquoi, n'hésitez pas à couper. </p><br><img src="https://habrastorage.org/getpro/habr/post_images/3a7/fdf/977/3a7fdf977a4d085c2fcb08c4491a000f.gif" alt="cligner des yeux"><a name="habracut"></a><br><h4>  Intro or Crying about the greedy fabricants of usb hubs </h4><br><p>  Avec l'avènement de petits routeurs SoC pratiques (comme le tutoriel <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">sur le «conditionnement» d'un clone du mini-routeur chinois populaire Hame A15, qui est également «A5-V11 sans marque»</a> ) et l'introduction généralisée d'Openwrt pour la gestion des périphériques hôtes (dans la grande majorité) cas, ce sont des appareils connectés via USB), la tâche de contrôler l'alimentation de toutes sortes de modems, lecteurs de cartes, convertisseurs usb-rs232, etc., etc. devient une tâche très urgente. Le besoin le plus courant de gestion des ports lorsque vous travaillez avec GSM  Emami (redémarrer, par exemple).  En principe, le peuple a déjà pris suffisamment de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">décisions</a> .  À ces fins, de l'utilisation de broches GPIO libres dans le routeur aux relais prêts à l'emploi.  Il existe des solutions de fabricants tiers.  Il s'agit, par exemple, d'un concentrateur USB programmable pour 4 ports d' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">Acroname</a> , qui est riche en logiciels et en matériel, mais coûte environ 300 $. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5cb/cdd/540/5cbcdd5404d816d47e2a6917b9639f98.jpg" alt="image"></div><br><p>  Il existe une option moins chère, un concentrateur commutable intelligent avec le joli nom <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">Yupkit YKUSH</a> pour seulement 35 €: </p><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f0d/7f4/44d/f0d7f444dbf40fd96967cd8a4900d783.png" alt="image"></div><br><p>  Les plus économiques peuvent utiliser un tas de hub USB le moins cher, un relais 5V normalement fermé et n'importe quel Arduino-k pour déconnecter l'alimentation du port USB si nécessaire.  Le coût d'une telle solution est &lt;10 $, sans compter le temps passé à souder et à programmer Arduino. </p><br><p>  Cela semblerait une impasse.  Soit cher et beau, ou tout simplement simple et <s>arrogant</s> .  Mais il s'est avéré qu'il existe une troisième option.  De plus, la solution est ancienne, comme la <a href="https://web.archive.org/web/20120207112406/" rel="nofollow">spécification USB 2.0</a> pour les concentrateurs dans laquelle elle est décrite. </p><br><div class="spoiler">  <b class="spoiler_title">Extraits de spécifications concernant la gestion de l'alimentation USB</b> <div class="spoiler_text"><p>  Les concentrateurs autoalimentés peuvent avoir des commutateurs d'alimentation qui contrôlent la fourniture de puissance en aval des ports, mais cela n'est pas nécessaire.  Les concentrateurs alimentés par bus doivent avoir des interrupteurs d'alimentation.  Un concentrateur avec des commutateurs d'alimentation peut commuter l'alimentation vers tous les ports en tant que groupe / gang, vers chaque port individuellement, ou avoir un nombre arbitraire de gangs d'un ou plusieurs ports.  Un concentrateur indique s'il prend en charge ou non la commutation d'alimentation en définissant le champ Mode de commutation d'alimentation logique dans wHubCharacteristics.  Si un concentrateur prend en charge la commutation d'alimentation par port, l'alimentation d'un port est alors activée lorsqu'une demande SetPortFeature (PORT_POWER) est reçue pour le port.  L'alimentation du port est désactivée lorsque le port est dans les états Hors tension ou Non configuré.  Si un concentrateur prend en charge la commutation d'alimentation groupée, l'alimentation de tous les ports d'un groupe est activée lorsqu'un port d'un groupe reçoit une demande SetPortFeature (PORT_POWER).  L'alimentation d'un gang n'est pas coupée sauf si tous les ports d'un gang sont dans les états Hors tension ou Non configuré. <br>  ... <br>  Bien qu'un concentrateur autoalimenté ne soit pas requis pour implémenter la commutation d'alimentation, le concentrateur doit prendre en charge l'état hors tension pour tous les ports.  En outre, le concentrateur doit implémenter le PortPwrCtrlMask (tous les bits définis sur 1B) même si le concentrateur n'a pas de commutateurs d'alimentation pouvant être contrôlés par le logiciel système USB. </p></div></div><br><p>  Traduisant en russe, il s'avère que la norme USB définit déjà la capacité de contrôler l'alimentation du port à l'aide de ce qu'on appelle  <b>Commutation d'alimentation par port (PPPS)</b> , mais rencontrer un appareil qui prend en charge cette fonctionnalité est non seulement difficile, mais très difficile.  Pour mettre en œuvre la fonctionnalité PPPS, des composants supplémentaires sont nécessaires (transistors à effet de champ et câblage), qui ne sont pas installés dans les concentrateurs afin d'économiser de l'argent. </p><br><p>  Réagissant avec sensibilité aux demandes du marché, certains fabricants indiquent la fonction PPPS dans les spécifications des hubs, mais en réalité cela ne va pas au-delà de l'inscription sur la boîte.  Et fondamentalement, il est difficile de trouver la faute, car de nombreuses puces à l'intérieur des concentrateurs prennent en charge cette fonction, mais il est impossible de l'implémenter sans commutateurs supplémentaires (transistors) (le plus souvent, les ports USB sont directement connectés à la ligne + 5V). </p><br><p>  J'ai même spécialement démonté plusieurs petits concentrateurs USB que je prévoyais d'utiliser avec le routeur A5-V11.  À l'intérieur se trouvaient: la puce <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">GL850G</a> et la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">très</a> appréciée des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">FE1.1</a> chinois.  Naturellement, seuls les contrôleurs eux-mêmes avec un minimum de détails ont été trouvés à l'intérieur.  En raison de la taille miniature de la carte, il est difficile de placer un transistor et des pièces qui l'ont rejoint même avec une installation articulée.  J'ai dû me calmer.  Bien que, selon la puce, si dans la fiche technique il est fait mention de <i>détection de surintensité et de contrôle de puissance individuel ou groupé</i> , il est possible d'effectuer un fonctionnement intelligent d'un tel appareil selon la méthode décrite dans l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">article</a> .  Un ami a utilisé une combinaison d'un transistor et d'un tas de résistances pour activer la fonction PPPS dans son concentrateur. </p><br><div class="spoiler">  <b class="spoiler_title">Schéma de modification et apparence de l'appareil</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/0b1/202/831/0b1202831fd6a456a90f8ab01c9ed48e.jpg" alt="image"><br><img src="https://habrastorage.org/getpro/habr/post_images/a5d/e65/b11/a5de65b1118b764b9fda1d32a1fb47f9.jpg" alt="image"></div></div><br><p>  De plus, en lisant la documentation, vous vous rendez compte du fait qu'il n'y a pas, non, et il est mentionné que le mode de contrôle de port peut être implémenté en ajoutant du AIC1526-0 ou MIC2026 (commutateur de distribution d'alimentation à deux canaux) au circuit. </p><br><div class="spoiler">  <b class="spoiler_title">Les schémas des fiches techniques ne laisseront pas mentir</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/vn/vy/ar/vnvyarpe24tec4a6skp0irp8grk.jpeg"><br><img src="https://habrastorage.org/webt/wc/s5/yd/wcs5ydopgtt5n8xwwovr1vbdld8.jpeg"></div></div><br><h4>  Faire partie du principal ou aller droit au but </h4><br><p>  Accablé par des pensées sombres sur l'achat de concentrateurs chinois avec des fonctionnalités inconnues ("un cochon dans un coup") et l'impossibilité de les vérifier au préalable, je suis tombé par inadvertance sur un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">article</a> sur la configuration d'Openwrt pour contrôler la puissance d'un concentrateur USB, d'ailleurs, le même, abandonné et oublié <b>D-Link DUB-H7</b> dans un boîtier gris. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/b9/3o/hv/b93ohvaf-wfvgk0hy2qltlxldlk.jpeg"></div><br><p>  Après avoir étudié le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">matériel,</a> il est devenu clair qu'à bord du concentrateur, en plus du contrôleur Philips ISP1521BE assez avancé, il y a tout un tas de ces mêmes <i>commutateurs de distribution d'alimentation à deux canaux</i> AIC1528-0 pour une commutation à pleine puissance.  Bien qu'à en juger par la fiche technique, une puce avec un kit de corps minimum peut elle-même contrôler la puissance des ports en aval (et il y a aussi beaucoup de choses qui n'y ont pas été implémentées, par exemple, indiquant une activité du port en amont utilisant la technologie GoodLink, ou un hôte USB 1.1 pour supporter correctement un mélange de 2.0 et 1.1 sur ports en aval, etc., etc.). </p><br><p>  Soit dit en passant, pour ceux qui décident de répéter le chemin que j'ai parcouru, je dois dire tout de suite que les versions modernes du D-Link DUB-H7 (dans un boîtier noir brillant) ne sont plus aussi utiles que les anciennes grises. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/o8/ll/uc/o8llucurzvykxpwzgd9d9shxh88.jpeg"></div><br><p>  Selon les informations de wikidevi.com ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">1</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">2</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">3</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">4</a> ), il existe plusieurs révisions de ce concentrateur, avec un ensemble différent de composants à bord, et en conséquence avec des fonctionnalités différentes (A1 / A5 - ISP1521BE 7 ports, B1-2xGL854G 4 ports, C1 - 2xGL850Z 4 ports). </p><br><p>  L'attention portée au D-Link DUB-H7 est également attirée car, en plus de ses bonnes fonctionnalités, c'est également l'option la plus abordable (tant en termes de prix que de prévalence) dans notre région.  Parmi les modèles qui pourraient être mentionnés en cours de route avec la «commutation d'alimentation par port», nous pouvons en outre noter, par exemple, les éléments suivants: </p><br><ul><li>  Concentrateur Linksys USB2HUB4 USB 2.0. </li><li>  Hub combiné DFB-H7 D-Link </li><li>  Elecom U2H-G4S </li><li>  Sanwa Supply USB-HUB14GPH </li><li>  Targus Inc.  PAUH212 </li><li>  Hawking Technology UH214 </li></ul><br><p>  Je n'ai pas eu la chance de rechercher les appareils mentionnés, car j'ai eu une fois de la chance avec la version de la révision A5.  La vérité est maintenant que si je devais acheter un tel hub, j'essaierais de trouver la révision <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">B1</a> , car en plus de contrôler la puissance des ports, la puce sur laquelle il est construit (GL854G) a à l'intérieur une chose telle que <b>Multi Transaction Translator</b> . </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/bn/cc/bu/bnccbuuo1tpqxp7bq7eob8lloq0.jpeg"></div><br><h4>  L'importance d'avoir un traducteur multi-transactions (MTT) dans un concentrateur USB </h4><br><p>  Une petite digression afin d'expliquer <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">ce qu'est</a> ce Traducteur Multi Transaction (MTT) et pourquoi il est si important et nécessaire.  Un émetteur de transaction (TT) est un composant important de tout concentrateur haute vitesse qui assure la communication entre les ports amont et aval d'un concentrateur, en particulier lorsque ces ports fonctionnent à des débits de données différents.  En fait, TT sépare les appareils à basse et moyenne vitesse des appareils à haute vitesse (purement USB 2.0, par exemple) et est chargé de travailler à des vitesses USB 1.1. </p><br><p>  L'émetteur d'opération peut être de deux types - simple (eng. Traducteur de transaction unique, STT) ou multiple (eng. Traducteur de transaction multiple, MTT).  Dans le cas de STT, un émetteur est utilisé pour tous les ports, et dans le cas de MTT, chaque port a son propre émetteur.  Il est clair que la première option est moins chère et plus simple, d'où vient le principal inconvénient de cette option - si plusieurs ports USB 1.1 sont connectés au concentrateur, ils fonctionneront tous via un seul goulot d'étranglement.  Je pense que vous pouvez imaginer ce qui se passera avec la vitesse des échanges. </p><br><img src="https://habrastorage.org/webt/g7/ei/ba/g7eibabozthfur42lw3je15r_tk.jpeg"><br><p>  En termes simples, les concentrateurs STT ont une limite sur le nombre d'appareils pouvant être utilisés simultanément.  Sinon, elle est lourde de pertes de paquets en raison de conflits dans la planification du transfert de données, surchargeant le concentrateur (en particulier dans le cas des appareils qui échangent activement des données, comme les cartes son), etc.  Par conséquent, il est préférable de choisir un concentrateur pour se concentrer immédiatement sur les appareils avec MTT et ne pas rechercher la cause de l'instabilité dans le travail.  Si vous avez déjà un concentrateur, et malheureusement il s'est avéré être avec STT, il vous suffit de vérifier soigneusement les normes des appareils connectés au concentrateur et, si possible, de réduire le nombre d'USB 1.1 connectés à un. </p><br><p>  Malheureusement, la grande majorité des hubs à bas prix construits sur des puces économiques (fe1.1s, GL850G et ISP1521BE de mon hub A5) ont des STT à bord, plus chers et plus avancés (GL852G, GL854G (révision B1 du DU-Link DUB-H7 en cours de discussion), B1 GL3520, VL812, VL813, SMSC USB2514) exécutent MTT. </p><br><p>  Vous pouvez vérifier le type de transmetteur de fonctionnement soit en lisant la fiche technique sur la puce (mais souvent les Chinois ne peuvent pas ou ne veulent pas dire la marque de la puce), ou en connectant le concentrateur à l'ordinateur * nix et en exécutant la commande lsusb -v et en trouvant une information de service relative au concentrateur à l'étude (par nom).  La ligne <b>DeviceProtocol</b> indiquera <i>Single TT</i> ou <i>Multi TT</i> .  Il est clair que l'achat n'est possible qu'avec Multi :) </p><br><div class="spoiler">  <b class="spoiler_title">Description des caractéristiques du hub émises par l'équipe lsusb</b> <div class="spoiler_text"><p>  Bus 001 Périphérique 005: ID 2001: f103 D-Link Corp.  Concentrateur USB 2.0 DUB-H7 à 7 ports <br>  Impossible d'ouvrir l'appareil, certaines informations seront manquantes <br>  Descripteur de périphérique: <br>  bLongueur 18 <br>  bDescriptorType 1 <br>  bcdUSB 2.00 <br>  Hub bDeviceClass 9 <br>  bDeviceSubClass 0 inutilisé <br>  bDeviceProtocol 1 Single TT <br>  bMaxPacketSize0 64 <br>  idVendor 0x2001 D-Link Corp. <br>  idProduct 0xf103 DUB-H7 Hub USB 2.0 à 7 ports <br>  bcdDevice 1.00 <br>  iManufacturer 0 <br>  iProduct 0 <br>  iSerial 0 <br>  bNumConfigurations 1 <br>  Descripteur de configuration: <br>  bLongueur 9 <br>  bDescriptorType 2 <br>  wTotalLength 25 <br>  bNumInterfaces 1 <br>  bConfigurationValue 1 <br>  iConfiguration 0 <br>  bmAttributes 0xe0 <br>  Auto-alimenté <br>  Réveil à distance <br>  MaxPower 0mA <br>  Descripteur d'interface: <br>  bLongueur 9 <br>  bDescriptorType 4 <br>  bInterfaceNumber 0 <br>  bAlternateSetting 0 <br>  bNumEndpoints 1 <br>  bInterfaceClass 9 Hub <br>  bInterfaceSubClass 0 Inutilisé <br>  bInterfaceProtocol 0 Concentrateur pleine vitesse (ou racine) <br>  iInterface 0 <br>  Descripteur de point final: <br>  bLongueur 7 <br>  bDescriptorType 5 <br>  bEndpointAddress 0x81 EP 1 IN <br>  bmAttributes 3 <br>  Interruption du type de transfert <br>  Type de synchronisation aucun <br>  Données de type d'utilisation <br>  wMaxPacketSize 0x0001 1x 1 octets <br>  bIntervalle 12 </p></div></div><br><p>  Lorsque vous exécutez la commande <i>lsusb -v -t</i> , vous pouvez voir une structure assez hiérarchique des périphériques USB connectés. </p><br><img src="https://habrastorage.org/webt/qq/yv/7h/qqyv7hfnj27vnwtux7eebnwadia.jpeg"><br><p>  Au lieu de lsusb, vous pouvez utiliser l'utilitaire <i>hwinfo</i> avec le <i>commutateur --usb</i> (il est conseillé de le préinstaller via <i>sudo apt-get install hwinfo</i> ).  Ensuite, la sortie des informations sur les périphériques USB sera un peu différente: </p><br><div class="spoiler">  <b class="spoiler_title">Informations émises par hwinfo</b> <div class="spoiler_text"><p>  lab @ lab-G: ~ $ hwinfo --usb <br>  23: Hub USB 00.0: 10a00 <br>  [Créé à usb.122] <br>  ID unique: zFuK.sOcBcpBDhs4 <br>  ID parent: k4bc.9T1GDCLyFd9 <br>  ID SysFS: /devices/pci0000:00/0000:00:1d.7/usb1/1-8/1-8:1.0 <br>  ID de bus SysFS: 1-8: 1.0 <br>  Classe de matériel: hub <br>  Modèle: "Hub USB 2.0 D-Link DUB-H7 à 7 ports" <br>  Hotplug: USB <br>  Fournisseur: usb 0x2001 "D-Link" <br>  Périphérique: usb 0xf103 "concentrateur USB 2.0 DUB-H7 à 7 ports" <br>  Révision: "1,00" <br>  Pilote: "hub" <br>  Modules de pilotes: "usbcore" <br>  Vitesse: 480 Mbps <br>  Alias ​​du module: "usb: v2001pF103d0100dc09dsc00dp01ic09isc00ip00in00" <br>  État de la configuration: cfg = new, avail = yes, need = no, active = unknown <br>  Attaché à: # 21 (Hub) </p></div></div><br><p>  En général, nous avons brièvement compris les caractéristiques des appareils à basse vitesse et il est maintenant temps de passer à la partie logicielle. </p><br><h4>  Gérer l'alimentation du port USB </h4><br><p>  Je dirai tout de suite que je n'ai pas pu trouver un moyen d'implémenter la fonctionnalité PPPS dans un environnement Windows (au moins par intérêt).  Le maximum est d'activer / désactiver le périphérique à l'aide de l'utilitaire <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">devcon</a></i> .  Je serai heureux si l'un des lecteurs corrige et complète.  En attendant, toutes les procédures sont effectuées sur l'exemple d'Ubuntu (dans le cas de openwrt - l'algorithme est similaire, bien que dans le dernier tronc il devrait déjà être inclus dans la "distribution"). </p><br><p>  Ainsi, la possibilité de <i>commutation d'alimentation par port (PPPS)</i> ou de «commutation d'alimentation de port» est implémentée sur les concentrateurs <u>avec prise en charge matérielle de</u> cette fonction à l'aide du programme <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">hub-ctrl</a></b> ou de son descendant <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">uhubctrl</a></b> .  Je les considérerai tour à tour. </p><br><h4>  Hub-ctrl </h4><br><p>  Le programme a été écrit par l'ingénieur de <s>combat pour l'indépendance</s> japonaise <b>Niibe Yutaka</b> en 2006.  Mais cela fonctionne sans problème maintenant.  Pour l'installation, nous avons besoin de n'importe quelle bibliothèque * nix et <i>libusb-dev</i> .  Pour Ubuntu 16.04 LTS, l'algorithme est le suivant: </p><br><blockquote><pre>  Installez ajouter.  packages: sudo apt-get update &amp;&amp; sudo apt-get install libusb-dev git gcc
 Source de téléchargement: git clone https://github.com/codazoda/hub-ctrl.c
 Compilé avec gcc: cd hub-ctrl.c &amp;&amp; gcc -o hub-ctrl hub-ctrl.c -lusb </pre></blockquote><p>  Si l'adresse n'est pas disponible, vous pouvez télécharger manuellement les sources <a href="" rel="nofollow">d'ici</a> ou <a href="" rel="nofollow">d'ici</a> et compiler avec la commande décrite ci-dessus. </p><br><p>  Le programme a une syntaxe de ligne de commande assez simple qui correspond à la description suivante: </p><br><p>  ./ <b>hub-ctrl</b> [{-h HUBNUM |  -b BUSNUM -d DEVNUM}] \ [-P PORT] [{-p [VALEUR] |  -l [VALUE]}] <br>  où HUBNUM - numéro de concentrateur, numéro de bus BUSNUM, numéro de périphérique DEVNUM, numéro de port PORT </p><br><p>  Afin de découvrir ces paramètres, exécutez juste la commande <i>lsusb</i> : </p><br><img src="https://habrastorage.org/webt/pp/ob/tz/ppobtz0tg81cjzgnvla8ej1vw5s.jpeg"><br><p>  Soit dit en passant, le programme hub-ctrl peut agir comme une sorte de «sonde» du concentrateur USB pour le fait qu'il a la capacité de gérer l'alimentation du port.  Il suffit de l'exécuter avec le commutateur -v.  Nous obtenons une liste des concentrateurs pris en charge disponibles dans le système (ligne INFO) et l'état du port (dans mon cas, tous les ports sont désactivés). </p><br><blockquote>  lab @ lab-G: ~ / hub $ sudo ./hub-ctrl -v <br>  Hub # 0 à 001: 006 <br>  INFO: commutation de puissance individuelle. <br>  AVERTISSEMENT: les indicateurs de port ne sont PAS pris en charge. <br>  État du port du concentrateur: <br>  Port 1: 0000.0000 <br>  Port 2: 0000.0000 <br>  Port 3: 0000.0000 <br>  Port 4: 0000.0000 <br>  Port 5: 0000.0000 <br>  Port 6: 0000.0000 <br>  Port 7: 0000.0000 </blockquote><p>  Et voici à quoi ressemblera la configuration lorsque tous les ports seront activés: </p><br><blockquote>  lab @ lab-G: ~ / hub $ sudo ./hub-ctrl -v <br>  Hub # 0 à 001: 006 <br>  INFO: commutation de puissance individuelle. <br>  AVERTISSEMENT: les indicateurs de port ne sont PAS pris en charge. <br>  État du port du concentrateur: <br>  Port 1: alimentation 0000.0100 <br>  Port 2: alimentation 0000.0100 <br>  Port 3: alimentation 0000.0100 <br>  Port 4: alimentation 0000.0100 <br>  Port 5: alimentation 0000.0100 <br>  Port 6: alimentation 0000.0100 <br>  Port 7: alimentation 0000.0100 </blockquote><p>  Pour activer l'un des ports, vous devez exécuter la <i>commande sudo ./hub-ctrl -h 0 -P 1 -p 1</i> , où -h indique le concentrateur que nous utilisons (le 0 dans mon cas), -P indique le port (1- e port dans mon cas), et -p indique l'état (0-off, 1-on). </p><br><img src="https://habrastorage.org/webt/ko/4r/wl/ko4rwlpq2_uxinhoukzh-xltvfc.jpeg"><br><p>  Pour obtenir la configuration comme dans l'image ci-dessus, il était nécessaire d'exécuter les commandes suivantes séquentiellement (pour les ports initialement désactivés): </p><br><p>  sudo ./hub-ctrl -h 0 -P 2 -p 1 <br>  sudo ./hub-ctrl -h 0 -P 4 -p 1 <br>  sudo ./hub-ctrl -h 0 -P 6 -p 1 </p><br><p>  En conséquence, il n'est pas difficile d'écrire un script qui fera clignoter les LED pour le plaisir dans la séquence souhaitée.  Des exemples de telles choses existent déjà et fonctionnent avec succès: <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">Code Morse</a> sur un hub USB, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">guirlandes de Noël</a> , etc.  etc.  Pour moi, à partir des capacités de hub-ctrl, la fonction de commutation cyclique n'était pas suffisante pour réaliser mes fantasmes d'éclairage momentanés (afin de ne pas perdre de temps à écrire un script, etc.).  Ce défaut gênant est éliminé dans le successeur - uhubctl. </p><br><h4>  UHUBCTL </h4><br><p>  Le programme uhubctl est un analogue hub-ctrl optimisé et présente quelques différences cosmétiques (et bien sûr, il prend en charge plus d'appareils). </p><br><div class="spoiler">  <b class="spoiler_title">Avec uhubctl work:</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/pn/qg/dw/pnqgdwes-bvg0n35yepl4pjjsp0.jpeg"></div></div><br><p>  Théoriquement, l'utilitaire peut être compilé pour s'exécuter dans un environnement Windows, mais ... Mais pour l'instant, il interagit avec les utilitaires via le pilote winusb.sys, qui ne peut pas accéder directement au concentrateur.  Le programme revendique également la prise en charge de l'USB 3.0 (les concentrateurs USB 3.0 prenant en charge la commutation d'alimentation par port, soit dit en passant, sont bien plus que les concentrateurs USB 2.0 avec des fonctionnalités similaires).  Lorsque vous travaillez avec un concentrateur USB 3.0 connecté à un port en amont USB 3.0, le programme le définit comme deux concentrateurs virtuels indépendants: USB 2.0 et USB 3.0, et les périphériques USB eux-mêmes seront connectés à l'un d'entre eux en fonction de leurs capacités et de la vitesse de connexion .  Par conséquent, pour gérer ces périphériques, le programme active / désactive l'alimentation des concentrateurs virtuels par défaut (vous pouvez basculer l'utilitaire en mode manuel en ajoutant le commutateur -e à la commande de démarrage). </p><br><p>  <u>Important: le</u> système d'adressage pour les ports USB peut provoquer une certaine confusion (il est similaire pour hub-ctrl et uhubctl).  Lorsqu'il fonctionne, il utilise la même méthode d'adressage similaire à celle du noyau Linux: bx.yz, où b est le numéro de bus USB et x, y, z sont les numéros de port de la chaîne hôte, à partir du concentrateur USB racine pour ce bus.  S'il existe plusieurs concentrateurs USB gérés, vous pouvez déterminer les options appropriées en exécutant uhubctl avec l'option -l (emplacement).  Je note que cet adressage est semi-stable - il ne changera pas si vous déconnectez et reconnectez les périphériques USB au même port physique. </p><br><p>  L'algorithme de compilation du programme est similaire à l'algorithme pour hub-ctrl.    ,      libusb-1.0 ( 1.0.12  )   <i>sudo apt-get install libusb-1.0-0-dev</i> ,      <i>make</i> . </p><br><p>     </p><br><p> uhubctl -a off -p 2 </p><br><p>     (-a off,  -a 0)   2 (-p 2).   off/on/cycle ( 0/1/2).  <i>cycle</i>  ,    (  -d)    .  C'est-à-dire        . </p><br><h4>     ,   </h4><br><p>     ,  ""     D-Link - .    (PPPS)        ,    USB.  ,       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"> </a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">-</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">GSM-</a> (   ): </p><br><img src="https://habrastorage.org/getpro/habr/post_images/d29/99a/e9b/d2999ae9b1938357484853650973e9b0.png" alt="image"><br><p> ,       D-link DUB-H7,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"></a> ,       (    hub-ctrl). </p><br><div class="spoiler"> <b class="spoiler_title">   , ...</b> <div class="spoiler_text"><p> "…    Dlink DUB H-7 ,  hub-ctrl -p 0      1.47V.        " "   ,   /dev/ttyUSBx      .     .            ." </p></div></div><br><p>     (lsusb, hwinfo, hub-ctrl)        USB-, ,       .           usb- ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a> ).     ,   ,       .   , ,    (D-link DUB-H7 ver. A5)           .  , ,  :) </p><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/s3/5l/vm/s35lvmfuuc9jd67i9gvfk5s67n0.jpeg"></div><br> <b>PS</b>     -,            D-link DUB-H7   . <p></p><br><img src="https://habrastorage.org/webt/_j/jb/pk/_jjbpk6wn6mj9ftl9m2i8wscjgo.jpeg"><br><p>        (   -   )?    RP1...RP2 (     0- c). </p><br><p> <u></u> :   -     EEPROM 24C02,     : </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/67/_w/zm/67_wzmql8dpwcrzyjeybmwvvxaa.jpeg"></div><br><p> <u>!</u>  Toutes les mises à jour et notes provisoires à partir desquelles les habr-articles sont correctement formés peuvent maintenant être vues dans mon <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">laboratoire de</a></b> télégramme66.  Abonnez-vous pour ne pas vous attendre au prochain article, mais pour être immédiatement au courant de toutes les recherches :) </p><br><div class="spoiler"> <b class="spoiler_title">  </b> <div class="spoiler_text"><ol><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">http://simple-is-beauty.blogspot.com/2017/12/usb-port-control.html</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">https://askubuntu.com/questions/149242/is-it-possible-to-power-up-ports-on-a-usb-hub-from-ubuntu</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">http://www.ibuyopenwrt.com/index.php/15-yun-compatible/hardware-yun/36-usb-hub-per-port-power-switching-2</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">https://www.joeldare.com/wiki/usb_powered_animated_christmas_lights</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">https://michaelbluejay.com/batteries/dc-christmas-lights.html</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">https://forum.archive.openwrt.org/viewtopic.php?id=49012</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">http://atotto.hatenadiary.jp/entry/linux-sugoi-usb-hub-power-ctrl</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">https://hant.helplib.com/GitHub/article_111870</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">https://www.quaxio.com/hub_ctrl/</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">https://forum.ixbt.com/topic.cgi?id=13:40305-4</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">http://www.cypress.com/file/124006/download</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">https://github.com/mvp/uhubctl</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">https://github.com/crazystick/py-hub-ctrl</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">http://atc-ip.ru/info/29/1.html</a> </li></ol></div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr430220/">https://habr.com/ru/post/fr430220/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr430208/index.html">Cours MIT "Sécurité des systèmes informatiques". Conférence 18: «Navigation Internet privée», partie 3</a></li>
<li><a href="../fr430210/index.html">Testez ma patience par la Check Point Security Academy</a></li>
<li><a href="../fr430212/index.html">OpenSceneGraph: principes de base de la géométrie de scène</a></li>
<li><a href="../fr430216/index.html">Si je comprends bien, je mange beaucoup de bonbons, ou le classement des marchandises par chèque dans l'application</a></li>
<li><a href="../fr430218/index.html">Optimisation énergétique STM32: un guide pratique</a></li>
<li><a href="../fr430222/index.html">Ingénieur senior en recherche de travail. Comment j'ai vécu 20 entretiens avec les RH et ce que j'en pense</a></li>
<li><a href="../fr430224/index.html">Trouble schizotypique: un regard intérieur</a></li>
<li><a href="../fr430226/index.html">De la var b à l'interview</a></li>
<li><a href="../fr430228/index.html">Marques en forme de X comme méthode d'identification radar utilisant l'analyse de données ouvertes de deux satellites scientifiques SENTINEL-1</a></li>
<li><a href="../fr430230/index.html">Comment garder sa place dans une startup en pleine croissance</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>