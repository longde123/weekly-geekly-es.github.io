<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèΩ‚Äçüåæ ‚ù§Ô∏è üíÜüèø Verwendung strenger Module in gro√üen Python-Projekten: Instagram-Erfahrung. Teil 1 üè≠ üë®üèΩ‚Äç‚öñÔ∏è üåé</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Wir ver√∂ffentlichen den ersten Teil der √úbersetzung eines anderen Artikels aus der Reihe √ºber die Funktionsweise von Instagram mit Python. Der erste A...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Verwendung strenger Module in gro√üen Python-Projekten: Instagram-Erfahrung. Teil 1</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/475240/">  Wir ver√∂ffentlichen den ersten Teil der √úbersetzung eines anderen Artikels aus der Reihe √ºber die Funktionsweise von Instagram mit Python.  Der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">erste</a> Artikel in dieser Reihe befasste sich mit den Funktionen des Instagram-Servercodes, dass es sich um einen Monolithen handelt, der sich h√§ufig √§ndert, und wie statische Tools zur Typpr√ºfung bei der Verwaltung dieses Monolithen helfen.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Das zweite</a> Material handelt von der Eingabe der HTTP-API.  Hier werden wir √ºber L√∂sungsans√§tze f√ºr einige der Probleme sprechen, auf die Instagram bei der Verwendung von Python in seinem Projekt gesto√üen ist.  Der Autor des Materials hofft, dass die Instagram-Erfahrung f√ºr diejenigen n√ºtzlich sein wird, die m√∂glicherweise auf √§hnliche Probleme sto√üen. <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/webt/0h/_k/s9/0h_ks9h22wcs8uc2ohwld0f6uau.png"></a> <br><a name="habracut"></a><br><h2>  <font color="#3AC1EF">Situations√ºbersicht</font> </h2><br>  Schauen wir uns das folgende Modul an, das auf den ersten Blick v√∂llig unschuldig aussieht: <br><br><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> re <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> mywebframework <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> db, route VALID_NAME_RE = re.compile(<span class="hljs-string"><span class="hljs-string">"^[a-zA-Z0-9]+$"</span></span>) @route(<span class="hljs-string"><span class="hljs-string">'/'</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">home</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span>     <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Hello World!"</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Person</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(db.Model)</span></span></span><span class="hljs-class">:</span></span>     name: str</code> </pre> <br>  Welcher Code wird ausgef√ºhrt, wenn jemand dieses Modul importiert? <br><br><ul><li>  Zun√§chst wird der Code ausgef√ºhrt, der dem regul√§ren Ausdruck zugeordnet ist, der die Zeichenfolge in ein Vorlagenobjekt kompiliert. </li><li>  Dann wird der <code>@route</code> Decorator ausgef√ºhrt.  Wenn wir uns auf das verlassen, was wir sehen, k√∂nnen wir davon ausgehen, dass hier m√∂glicherweise die entsprechende Darstellung im URL-Mapping-System registriert ist.  Dies bedeutet, dass der √ºbliche Import dieses Moduls dazu f√ºhrt, dass sich der globale Status der Anwendung an einer anderen Stelle √§ndert. </li><li>  Jetzt f√ºhren wir den gesamten Body-Code der <code>Person</code> Klasse aus.  Es kann alles enthalten.  Die Basisklasse <code>Model</code> kann eine Metaklasse oder <code>__init_subclass__</code> Methode <code>__init_subclass__</code> , die wiederum einen anderen Code enthalten kann, der beim Importieren unseres Moduls ausgef√ºhrt wird. </li></ul><br><h2>  <font color="#3AC1EF">Problem Nr. 1: langsamer Serverstart und Neustart</font> </h2><br>  Die einzige Codezeile f√ºr dieses Modul, die (m√∂glicherweise) beim Import nicht ausgef√ºhrt wird, ist <code>return "Hello World!"</code>  .  Nat√ºrlich k√∂nnen wir das nicht mit Sicherheit sagen!  Als Ergebnis stellt sich heraus, dass durch den Import dieses einfachen Moduls, das aus acht Zeilen besteht (und noch nicht einmal in unserem Programm verwendet wird), m√∂glicherweise Hunderte oder sogar Tausende von Zeilen Python-Code gestartet werden.  Und dies ist nicht zu erw√§hnen, dass der Import dieses Moduls eine √Ñnderung der globalen URL-Zuordnung verursacht, die sich an einer anderen Stelle im Programm befindet. <br><br>  Was zu tun ist?  Vor uns liegt die Konsequenz, dass Python eine dynamisch interpretierte Sprache ist.  Dies erm√∂glicht es uns, verschiedene Probleme mit Hilfe von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Metaprogrammierungsmethoden</a> erfolgreich zu l√∂sen.  Aber was ist trotzdem falsch an diesem Code? <br><br>  In der Tat ist dieser Code in perfekter Reihenfolge.  Dies ist so lange, wie jemand es in relativ kleinen Codebasen verwendet, an denen kleine Teams von Programmierern arbeiten.  Dieser Code verursacht keine Probleme, solange derjenige, der ihn verwendet, garantiert ein gewisses Ma√ü an Disziplin bei der Verwendung der Python-Funktionen beibeh√§lt.  Einige Aspekte dieser Dynamik k√∂nnen jedoch zu einem Problem werden, wenn das Projekt Millionen von Codezeilen enth√§lt, an denen Hunderte von Programmierern arbeiten, von denen viele keine umfassenden Python-Kenntnisse besitzen. <br><br>  Eine der herausragenden Eigenschaften von Python ist beispielsweise die Geschwindigkeit der Schritte, die bei der schrittweisen Entwicklung erforderlich sind.  Das Ergebnis von Code√§nderungen kann n√§mlich unmittelbar nach dem Vornehmen solcher √Ñnderungen im wahrsten Sinne des Wortes gesehen werden, ohne dass der Code kompiliert werden muss.  Wenn es sich jedoch um ein Projekt mit mehreren Millionen Zeilen handelt (und um ein ziemlich verwirrendes Abh√§ngigkeitsdiagramm dieses Projekts), verwandelt sich dieses Plus von Python in ein Minus. <br><br>  Es dauert mehr als 20 Sekunden, um unseren Server zu starten.  Und manchmal, wenn wir der Optimierung nicht die geb√ºhrende Aufmerksamkeit schenken, erh√∂ht sich diese Zeit auf ungef√§hr eine Minute.  Dies bedeutet, dass der Entwickler 20 bis 60 Sekunden ben√∂tigt, um die Ergebnisse der am Code vorgenommenen √Ñnderungen anzuzeigen.  Dies gilt f√ºr das, was Sie im Browser sehen k√∂nnen, und sogar f√ºr die Geschwindigkeit, mit der Unit-Tests ausgef√ºhrt werden.  Leider reicht diese Zeit aus, um einen Menschen von etwas abzulenken und zu vergessen, was er zuvor getan hat.  Die meiste Zeit wird buchst√§blich f√ºr das Importieren von Modulen und das Erstellen von Funktionen und Klassen aufgewendet. <br><br>  In gewisser Weise entspricht dies dem Warten auf die Ergebnisse der Kompilierung eines Programms, das in einer anderen Sprache geschrieben wurde.  In der Regel kann die Kompilierung jedoch <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">inkrementell erfolgen</a> .  Der Punkt ist, dass Sie nur neu kompilieren k√∂nnen, was sich ge√§ndert hat und was direkt vom ge√§nderten Code abh√§ngt.  Infolgedessen erfolgt die Zusammenstellung von Projekten in der Regel schnell, nachdem kleine √Ñnderungen vorgenommen wurden.  Bei der Arbeit mit Python gibt es jedoch keine zuverl√§ssige und sichere M√∂glichkeit, den Server schrittweise neu zu starten, da Importbefehle alle m√∂glichen Nebenwirkungen haben k√∂nnen.  Gleichzeitig ist der Umfang der √Ñnderungen unwichtig und jedes Mal m√ºssen wir den Server neu starten, alle Module importieren, alle Klassen und Funktionen neu erstellen, alle regul√§ren Ausdr√ºcke neu kompilieren und so weiter.  Normalerweise haben sich seit dem letzten Neustart des Servers 99% des Codes nicht ge√§ndert, aber wir m√ºssen immer wieder dasselbe tun, um die √Ñnderungen einzugeben. <br><br>  Dies verlangsamt nicht nur die Entwicklung, sondern f√ºhrt auch zu einer unproduktiven Verschwendung erheblicher Mengen an Systemressourcen.  Tatsache ist, dass wir in einem Modus der kontinuierlichen Bereitstellung von √Ñnderungen arbeiten, was ein st√§ndiges Neuladen des Produktionsserver-Codes bedeutet. <br><br>  Hier ist unser erstes Problem: Langsamer Start und Neustart des Servers.  Dieses Problem entsteht aufgrund der Tatsache, dass das System w√§hrend des Code-Imports st√§ndig eine gro√üe Anzahl sich wiederholender Aktionen ausf√ºhren muss. <br><br><h2>  <font color="#3AC1EF">Problem 2: Nebenwirkungen unsicherer Importbefehle</font> </h2><br>  Eine weitere Aufgabe, die Entwickler beim Importieren von Modulen h√§ufig l√∂sen.  Dies l√§dt Einstellungen aus dem Netzwerkspeicher von Konfigurationen: <br><br><pre> <code class="python hljs">MY_CONFIG = get_config_from_network_service()</code> </pre> <br>  Es verlangsamt nicht nur den Serverstart, sondern ist auch unsicher.  Wenn der Netzwerkdienst nicht verf√ºgbar ist, wird dies nicht nur dazu f√ºhren, dass wir Fehlermeldungen bez√ºglich der Unf√§higkeit, einige Anforderungen zu erf√ºllen, erhalten.  Dadurch kann der Server nicht gestartet werden. <br><br>  Lassen Sie uns die Farben verdicken und sich vorstellen, dass jemand dem Modul, das f√ºr die Initialisierung eines wichtigen Netzwerkdienstes verantwortlich ist, Code hinzugef√ºgt hat, der w√§hrend des Imports ausgef√ºhrt wird.  Der Entwickler wusste einfach nicht, wo er diesen Code hinzuf√ºgen sollte, und platzierte ihn in einem Modul, das zu Beginn des Startvorgangs des Servers importiert wurde.  Es stellte sich heraus, dass dieses Schema funktioniert, sodass die L√∂sung als erfolgreich angesehen und die Arbeit fortgesetzt wurde. <br><br>  Aber dann hat jemand anderes das Importteam woanders hinzugef√ºgt, was auf den ersten Blick harmlos war.  Dies f√ºhrte durch eine Importkette mit einer Tiefe von zw√∂lf Modulen dazu, dass das Modul, das die Einstellungen aus dem Netzwerk l√§dt, nun in das Modul importiert wird, das den entsprechenden Netzwerkdienst initialisiert. <br><br>  Nun stellt sich heraus, dass wir versuchen, den Dienst zu verwenden, bevor er initialisiert wird.  Das System st√ºrzt nat√ºrlich ab.  Wenn es sich im besten Fall um ein System handelt, in dem die Interaktionen vollst√§ndig deterministisch sind, kann dies dazu f√ºhren, dass der Entwickler ein oder zwei Stunden damit verbringt, herauszufinden, wie eine geringf√ºgige √Ñnderung bei ihm zu einem Fehler gef√ºhrt hat. scheint nicht verbunden.  In komplexeren Situationen kann dies jedoch zu einem ‚ÄûAbsturz‚Äú des Projekts in der Produktion f√ºhren.  Es gibt jedoch keine universellen M√∂glichkeiten, mit <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Linter</a> solche Probleme zu bek√§mpfen oder zu verhindern. <br><br>  Die Wurzel des Problems liegt in zwei Faktoren, deren Wechselwirkung verheerende Folgen hat: <br><br><ol><li>  Mit Python k√∂nnen Module beliebige und unsichere Nebenwirkungen haben, die beim Import auftreten. </li><li>  Die Importreihenfolge des Codes ist nicht explizit festgelegt und wird nicht gesteuert.  Im Projektma√üstab besteht eine Art ‚Äûumfassender Import‚Äú aus den Importbefehlen, die in allen Modulen enthalten sind.  In diesem Fall kann die Importreihenfolge der Module abh√§ngig vom Eingabepunkt des verwendeten Systems variieren. </li></ol><br>  <i><font color="#999999">Fortsetzung folgt‚Ä¶</font></i> <br><br>  <b>Sehr geehrte Leser!</b>  Haben Sie Probleme mit dem langsamen Start von Python-Projekten? <br><br><div style="text-align:center;"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/webt/-o/2e/tu/-o2etuqogwhmdnmysb9_vivc9v4.png"></a> </div><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de475240/">https://habr.com/ru/post/de475240/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de475218/index.html">Kryptografische Protokolle: Definitionen, Datens√§tze, Eigenschaften, Klassifizierung, Angriffe</a></li>
<li><a href="../de475226/index.html">Praktikum bei der Haxe Foundation</a></li>
<li><a href="../de475228/index.html">Payroll Gabel. Du bist ein Programmierer f√ºr Mama</a></li>
<li><a href="../de475236/index.html">Ignoriere niemals wieder das Verst√§rkungstraining.</a></li>
<li><a href="../de475238/index.html">Blade Runner Timeline - November 2019. Hat sich die Prognose erf√ºllt?</a></li>
<li><a href="../de475242/index.html">Verwendung strenger Module in gro√üen Python-Projekten: Instagram-Erfahrung. Teil 2</a></li>
<li><a href="../de475244/index.html">Erwartete neue JavaScript-Funktionen, die Sie kennen sollten</a></li>
<li><a href="../de475246/index.html">Asynchrone Python-Programmierung: Ein kurzer √úberblick</a></li>
<li><a href="../de475248/index.html">Die Verwendung von Polyfills beim Schreiben browser√ºbergreifender Anwendungen</a></li>
<li><a href="../de475250/index.html">Als Redash ein Problem bemerkte und behebte, das zu einer Verschlechterung der Python-Code-Leistung f√ºhrte</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>