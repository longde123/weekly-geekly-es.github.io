<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👍🏼 🐝 🏽 Victoria en PHDays 9. Compartimos hacks de vida en tres partes. Parte 1 🤲🏻 🤷🏾 😣</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola a todos! Me llamo Vitaliy Malkin. Soy el jefe del departamento de análisis de seguridad en Informzashchita y el capitán a tiempo parcial del equi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Victoria en PHDays 9. Compartimos hacks de vida en tres partes. Parte 1</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/453834/">  Hola a todos!  Me llamo Vitaliy Malkin.  Soy el jefe del departamento de análisis de seguridad en Informzashchita y el capitán a tiempo parcial del equipo True0xA3.  Con este artículo, comenzamos un ciclo de 3 materiales dedicados a nuestro desempeño en PHDays IX Standoff.  En este artículo, explicaremos por qué la preparación competente es la mitad del éxito, por qué es tan importante recoger las "frutas" a tiempo y cómo puede organizar la interacción del equipo anterior en un solo proyecto. <br><br>  El artículo de TL; DR contiene una gran cantidad de inglés y términos técnicos complejos, por lo cual me disculpo por separado. <br><a name="habracut"></a><br><h3>  <b>I. Entrada</b> </h3><br>  Tuvimos 16 pentesters seleccionados, 4 aprendices, 6 servidores, nuestra propia estación CUDA y un gran deseo de ganar. <br><br>  Comenzamos la fase de preparación activa 8 días antes del inicio de StandOff.  Este fue nuestro tercer intento como atacante, y muchos de nosotros ya teníamos suficiente experiencia para entender qué buscar este año.  Vimos 5 áreas prioritarias para la elaboración: <br><br><ol><li>  Coordinación efectiva; </li><li>  Colección de frutas bajas colgantes; </li><li>  Explotación de vulnerabilidades de tecnologías atípicas (para nosotros) (ACS TP, IoT, GSM); </li><li>  Preparación de infraestructura y equipos externos; </li><li>  Desarrollo agregar.  persistencia y métodos de endurecimiento. </li></ol><br>  Intentemos analizar estos elementos en orden. <br><br><h3>  1. Coordinación efectiva </h3><br>  Es más fácil para mí hablar sobre este punto, porque la decisión general fue la responsable de su implementación.  Durante StandOff, el problema más común para los principiantes, en mi opinión, es la falta de coordinación.  Los miembros del equipo resuelven las mismas tareas, no hay una comprensión clara de lo que ya se ha visto y lo que no.  La información recibida sobre la tarea no se transmite entre sí, como resultado, la eficiencia del trabajo disminuye considerablemente.  Y cuantos más participantes, más cae la eficiencia.  Además, es muy útil tener una persona que comprenda bien la imagen general de la infraestructura y pueda vincular vulnerabilidades individuales en un vector de ataque completo. <br><br>  Este año, la plataforma Discord fue elegida para la interacción del equipo.  En general, es muy similar al viejo chat IRC con características adicionales como la carga de archivos y la comunicación de voz.  Tomamos una descripción de todos los objetos de las competencias de Agend y creamos un canal para cada uno de ellos, en el que se publicó la información.  Por lo tanto, cualquier persona que se conecte a la tarea podría ver todo lo que se le ocurrió, incluidos los resultados del lanzamiento de varias herramientas y búsquedas manuales.  En todos los canales de información, se estableció un límite de un mensaje por minuto para evitar inundaciones.  Y toda la discusión se realizó en chats separados, que también se crearon para cada objeto. <br><br><img src="https://habrastorage.org/webt/ed/2m/lk/ed2mlkxo5tkfjhbpxucchbb6vv4.png"><br><br>  También se tomaron varias decisiones organizativas para mejorar la coordinación.  En general, no es habitual que nuestro equipo establezca tareas con la frase "NADO".  Tratamos de discutir por qué se establece esta o aquella tarea, a qué conducirá su implementación y también cómo llevarla a cabo de manera más eficiente.  Pero dentro del marco de StandOff, dicho modelo puede conducir a disputas innecesarias, por lo que decidimos confiar al coordinador una autoridad completa sobre el proceso.  A las 28 horas de la competencia, sus decisiones prácticamente no se discutieron, lo que ciertamente nos ahorró mucho tiempo.  Aunque puede haber afectado la calidad de las comunicaciones.  Además de esto, decidimos delinear muy claramente las áreas de responsabilidad: a pesar de que algunos de los miembros del equipo no obtuvieron las tareas más emocionantes. <br><br><h3>  2. Recolección de frutas bajas </h3><br>  En mi opinión, el secreto principal de nuestro éxito fue: una gran experiencia diaria de proyectos y la correcta priorización de tareas.  El año pasado, pudimos capturar una oficina completa y mantenerla durante todo el juego simplemente debido a vulnerabilidades simples pirateadas rápidamente.  Este año, abordamos el problema centralmente y compilamos una lista de tales vulnerabilidades. <br><br>  ms17-010;  ms08-67;  SMBCRY  LibSSH RCE;  HP DATA Protector;  HP iLo;  ipmi  Instalación inteligente de Cisco  Java RMI  JDWP;  JBOSS;  drupalgeddon2;  weblogic  desangrado  concha  ibm websphere  iis-webdav;  servicios;  vnc;  ftp-anon;  NFS  smb-null;  Tomcat <br><br>  A continuación, se escribieron dos servicios de verificación y penetración, que en un modo automatizado, utilizando exploits públicos y metasploit, primero verificaron vulnerabilidades y luego intentaron explotarlas.  La utilidad recibió un informe nmap en la entrada, que finalmente aceleró el proceso. <br><br><h3>  3. Explotación de vulnerabilidades de tecnologías atípicas (para nosotros) (ACS TP, IoT, GSM) </h3><br>  La mayoría de las veces hacemos proyectos para bancos y otras organizaciones financieras.  Los sistemas SCADA, si lo hacen, son más bien al estilo de: "Si pudo obtener acceso de red a la scada, corríjalo y cuéntelo como uno de los criterios de éxito del proyecto".  Por lo tanto, no tenemos una buena experiencia aplicada en el análisis de la seguridad de los sistemas de control de procesos.  Esto a su vez llevó al hecho de que una semana antes de StandOff nos sentamos con urgencia para estudiar las vulnerabilidades típicas.  Con IoT y GSM, la situación es aún peor: si IoT a veces se encuentra en proyectos, entonces vimos GSM solo en StandOffs anteriores. <br><br>  Por lo tanto, durante la preparación, identificamos dos personas separadas en el sistema automatizado de control de procesos y dos más en GSM e IoT.  Durante la semana preparatoria, el primer grupo escribió enfoques típicos para el último sistema SCADA, y estudió en detalle un video sobre la infraestructura ICS del año pasado.  Los chicos también bombearon alrededor de 200 GB de varios HMI, controladores y otro software que está directamente relacionado con los controladores.  En cuanto a GSM e IoT, aquí preparamos varias piezas de hierro, leímos todos los artículos disponibles sobre GSM y esperamos que esto fuera suficiente.  (SPOILER: ¡No realmente!) <br><br><h3>  4. Preparación de infraestructura y equipos externos. </h3><br>  Entendiendo que nuestro equipo será lo suficientemente grande este año, inmediatamente decidimos que necesitábamos equipo adicional.  La siguiente es una lista de sugerencias que hemos recopilado dentro del equipo, el signo "+" indica que finalmente tomamos: <br><br>  - cafetera; <br>  + - servidor CUDA (no se lo llevaron, pero lo usaron); <br>  + laptop de repuesto; <br>  + Enrutador WIFI; <br>  + interruptor gestionado; <br>  + cables de red de varias longitudes (20 piezas); <br>  + piloto (3 piezas); <br>  + Alfa Wi-fi (3 piezas); <br>  + pato de goma (2 piezas); <br>  - proxmark; <br>  - una camara. <br><br>  En cuanto a la infraestructura, esta es una canción separada.  El año pasado, nos dimos cuenta de lo útil que es usar una estación CUDA, rompiendo varios apretones de manos, por lo que no había dudas sobre la necesidad de usarla.  Es importante que este año, así como en el pasado, todos los atacantes estuvieran detrás del NATth, que generalmente rechazó la posibilidad de conexiones inversas desde DMZ.  Pero absolutamente todos los hosts deberían tener acceso a Internet, excepto los nodos ICS.  En este sentido, decidimos crear tres servidores de escucha, accesibles desde Internet.  Además, para simplificar el giro y la consolidación, utilizamos nuestro propio servidor OpenVpn con el modo de cliente a cliente habilitado.  Desafortunadamente, es imposible automatizar el proceso de conexión de una puerta de enlace, por lo que durante aproximadamente 12 horas de 28, uno de los miembros del equipo trabajó con las puertas de enlace. <br><br><h3>  5. Desarrollo de add.  métodos de persistencia y endurecimiento </h3><br>  Nuestra experiencia pasada con StandOff ha demostrado muy claramente que no es suficiente piratear un servidor con éxito: es importante no dejar que otros lo arreglen.  Por lo tanto, se prestó suficiente atención a RAT con nuevas firmas y scripts para fortalecer la protección de Windows.  Utilizamos nuestra RAT estándar, cambiando ligeramente los métodos de ofuscación.  Las reglas eran un poco más complicadas.  En general, determinamos por nosotros mismos el siguiente conjunto de scripts: <br><br><ul><li>  cierre de SMB y RPC; </li><li>  portar RDP a un puerto no estándar; </li><li>  Deshabilitar el cifrado reversible, las cuentas de invitados y otras configuraciones desde la línea de base de seguridad. </li></ul><br>  Para Linux, se desarrolló un script de inicio especial que cerró todos los puertos, abrió SSH en un puerto no estándar y registró las claves públicas del comando para acceder a SSH. <br><br><h3>  <b>II</b>  <b>Briefing</b> </h3><br>  El 17 de mayo, 5 días antes de StandOff, se realizó una sesión informativa para los atacantes.  En el transcurso de la misma, surgió mucha información que influyó en nuestro entrenamiento. <br><br>  En primer lugar, los organizadores publicaron un mapa de la red, y esto se ha convertido en una gran ayuda para nosotros.  Pudimos dividir las áreas de responsabilidad por adelantado, actualizar los segmentos de la red y, lo más importante, comprender qué es la red de todos modos.  En mi opinión, la declaración más importante realizada en la sesión informativa fue la frase de que la red ICS será accesible desde un solo segmento, y este segmento no estará protegido.  Además, se otorgarán la mayor cantidad de puntos para ICS y oficinas seguras, y los organizadores alientan directamente la lucha por las redes entre hackers. <br><br>  Tomamos esta información de esta manera: "El que captura el bigbrogroup es probable que gane el juego".  El caso es que nuestra experiencia nos lo dijo: no importa qué castigos se les ocurran a los organizadores por un servicio simple, los defensores abandonarían los servicios vulnerables si no pudieran parchearlos.  Después de todo, es mucho peor cuando anuncian desde el escenario de la conferencia de seguridad de la información más grande que usted ha malcriado a los piratas informáticos que si le quitan algunos puntos de juego.  Nuestra teoría fue confirmada, pero hablaremos de esto en detalle en el segundo artículo. <br><br>  Como resultado, decidimos dividir a todo el equipo en 4 partes: <br><br>  <b>1. Bigbrogroup.</b>  Esta fue la tarea a la que le asignamos la máxima prioridad.  El equipo involucró a las personas que tienen la mayor experiencia en irrumpir en la infraestructura interna de diferentes clientes.  En total, este mini equipo estaba formado por 5 personas.  Su objetivo era obtener un punto de apoyo en el dominio lo más rápido posible y cortar el acceso de otros equipos al ICS. <br><br>  <b>2. Red inalámbrica.</b>  El equipo responsable de monitorear la conexión Wi-Fi, rastreó nuevos puntos, interceptó los apretones de manos y los maltrató.  GSM también participó en sus tareas, pero antes que nada era necesario capturar Wi-Fi y cortar otros comandos. <br><br>  <b>3. Redes desprotegidas.</b>  El equipo que durante las primeras cuatro horas seleccionó todas las redes desprotegidas para detectar vulnerabilidades.  Entendimos que en estas cuatro horas no sucederá nada súper importante en los segmentos protegidos, y si lo hace, los defensores lo revertirán.  Por lo tanto, se centraron en lo que podría haber cambiado irreversiblemente.  Al final resultó que no en vano.  Cuatro horas después, el mismo grupo comenzó a analizar segmentos protegidos. <br><br>  <b>4. Grupo de escáneres.</b>  Los organizadores declararon directamente que las redes cambiarán, por lo que tuvimos dos personas que exploraron continuamente la red en busca de cambios.  No fue tan fácil automatizar, porque bajo diferentes redes, se necesitaban diferentes configuraciones en diferentes momentos.  Por ejemplo, en la primera hora en la red fe.phd, nmap funcionó bien para nosotros en modo T3, y después de 12 horas apenas funcionó en T1. <br><br>  Otro vector importante para nosotros fue la lista de software y tecnologías publicada por los organizadores.  Para cada tecnología, tratamos de crear nuestro propio centro de competencia, que podría ayudar y ver rápidamente las vulnerabilidades típicas. <br><br>  Para algunos servicios, encontramos vulnerabilidades muy interesantes, pero no hubo exploits públicos.  Así fue, por ejemplo, con Redis Post-explotación RCE.  Estábamos seguros de que esta vulnerabilidad aparecería en la infraestructura del juego, por lo que decidimos escribir nuestro propio exploit de 1 día.  No fue posible escribir 1 día específicamente para esta vulnerabilidad, pero en general teníamos cerca de cinco exploits no públicos disponibles que estábamos listos para usar. <br><br><img src="https://habrastorage.org/webt/kt/sc/ze/ktsczeslu1oszbpflccstfktb0w.png"><br><br>  Desafortunadamente, no logramos compartir todas las tecnologías, pero no fue tan aterrador.  Cubrimos el set principal, y esto fue suficiente.  También había una lista de controladores de procesos, que también resolvimos y tratamos de preparar. <br><br>  En preparación para la batalla, preparamos varias herramientas para conectarse sin problemas a la red física ICS.  Por ejemplo, implementamos un análogo barato de Pineapple-a usando frambuesa.  El módulo se conectó a través de Ethernet a la red industrial y a través de GSM al servicio de gestión.  A continuación, podríamos configurar de forma remota la conexión Ethernet y distribuirla en el acto utilizando el módulo Wi-Fi incorporado.  Desafortunadamente, en la sesión informativa, los organizadores dejaron en claro que no se puede conectar físicamente al ICS, por lo que dejamos este módulo hasta tiempos mejores. <br><br>  Mucha información era sobre el banco, el banco offshore y el trabajo antifraude.  Pero al haber aprendido que no hay mucho dinero en él, decidimos no prepararnos para esto por adelantado, sino idear algo en el camino. <br><br>  En resumen, hemos realizado una gran cantidad de trabajo en preparación.  Es importante tener en cuenta que, además de las ventajas obvias en forma de un desempeño exitoso en StandOff, tampoco hubo otras obvias. <br><br><ul><li>  Tal preparación es una excelente manera de distraerse y hacer algo que siempre he querido probar y explorar, y simplemente no había tiempo en el marco de la actividad del proyecto. </li><li>  No tenemos proyectos que involucren a todo el equipo como parte de una tarea, por lo que obtuvimos un buen trabajo en equipo, persiguiendo objetivos específicos. </li><li>  Gran parte de lo que hemos hecho se puede usar en proyectos reales, por lo que, además de ampliar nuestras competencias, también obtuvimos herramientas listas para usar. </li></ul><br>  Ahora, habiendo descrito todo esto en el texto, entiendo que no logramos nada tan grandioso como parecía antes.  En general, me parece que la etapa de preparación correctamente organizada se convirtió en la razón principal de la victoria de nuestro equipo.  Y lo que sucedió directamente durante StandOff en sí, lo contaré en el segundo artículo del ciclo. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/453834/">https://habr.com/ru/post/453834/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../453822/index.html">Cajas registradoras en línea como una extracción legal de dinero de una empresa</a></li>
<li><a href="../453824/index.html">¿Cómo será la colaboración y visualización de contenido de video con la llegada de 5G?</a></li>
<li><a href="../453828/index.html">Evitar mentir con estadísticas: los fundamentos de la visualización de datos</a></li>
<li><a href="../453830/index.html">Comparación de repetidores celulares. RF-Link 1800 / 2100-75-23 y AliExpress Noname</a></li>
<li><a href="../453832/index.html">19 cabezas de hidra. Gran revisión del programa</a></li>
<li><a href="../453836/index.html">OOP mitos y realidad</a></li>
<li><a href="../453838/index.html">Cómo automatizar el monitoreo de compras públicas de forma gratuita</a></li>
<li><a href="../453840/index.html">Dicen que aprender Python y convertirse en programador es fácil. Derecho?</a></li>
<li><a href="../453842/index.html">Cómo Microsoft corta el ruido para crear un mundo de sonido útil y hermoso</a></li>
<li><a href="../453844/index.html">Boleto para LANIT. Estar en el juego</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>