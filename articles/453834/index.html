<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>游녨游낖 游냏 游낗 Victoria en PHDays 9. Compartimos hacks de vida en tres partes. Parte 1 游쓇릞 游뱡游 游땪</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola a todos! Me llamo Vitaliy Malkin. Soy el jefe del departamento de an치lisis de seguridad en Informzashchita y el capit치n a tiempo parcial del equi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Victoria en PHDays 9. Compartimos hacks de vida en tres partes. Parte 1</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/453834/">  Hola a todos!  Me llamo Vitaliy Malkin.  Soy el jefe del departamento de an치lisis de seguridad en Informzashchita y el capit치n a tiempo parcial del equipo True0xA3.  Con este art칤culo, comenzamos un ciclo de 3 materiales dedicados a nuestro desempe침o en PHDays IX Standoff.  En este art칤culo, explicaremos por qu칠 la preparaci칩n competente es la mitad del 칠xito, por qu칠 es tan importante recoger las "frutas" a tiempo y c칩mo puede organizar la interacci칩n del equipo anterior en un solo proyecto. <br><br>  El art칤culo de TL; DR contiene una gran cantidad de ingl칠s y t칠rminos t칠cnicos complejos, por lo cual me disculpo por separado. <br><a name="habracut"></a><br><h3>  <b>I. Entrada</b> </h3><br>  Tuvimos 16 pentesters seleccionados, 4 aprendices, 6 servidores, nuestra propia estaci칩n CUDA y un gran deseo de ganar. <br><br>  Comenzamos la fase de preparaci칩n activa 8 d칤as antes del inicio de StandOff.  Este fue nuestro tercer intento como atacante, y muchos de nosotros ya ten칤amos suficiente experiencia para entender qu칠 buscar este a침o.  Vimos 5 치reas prioritarias para la elaboraci칩n: <br><br><ol><li>  Coordinaci칩n efectiva; </li><li>  Colecci칩n de frutas bajas colgantes; </li><li>  Explotaci칩n de vulnerabilidades de tecnolog칤as at칤picas (para nosotros) (ACS TP, IoT, GSM); </li><li>  Preparaci칩n de infraestructura y equipos externos; </li><li>  Desarrollo agregar.  persistencia y m칠todos de endurecimiento. </li></ol><br>  Intentemos analizar estos elementos en orden. <br><br><h3>  1. Coordinaci칩n efectiva </h3><br>  Es m치s f치cil para m칤 hablar sobre este punto, porque la decisi칩n general fue la responsable de su implementaci칩n.  Durante StandOff, el problema m치s com칰n para los principiantes, en mi opini칩n, es la falta de coordinaci칩n.  Los miembros del equipo resuelven las mismas tareas, no hay una comprensi칩n clara de lo que ya se ha visto y lo que no.  La informaci칩n recibida sobre la tarea no se transmite entre s칤, como resultado, la eficiencia del trabajo disminuye considerablemente.  Y cuantos m치s participantes, m치s cae la eficiencia.  Adem치s, es muy 칰til tener una persona que comprenda bien la imagen general de la infraestructura y pueda vincular vulnerabilidades individuales en un vector de ataque completo. <br><br>  Este a침o, la plataforma Discord fue elegida para la interacci칩n del equipo.  En general, es muy similar al viejo chat IRC con caracter칤sticas adicionales como la carga de archivos y la comunicaci칩n de voz.  Tomamos una descripci칩n de todos los objetos de las competencias de Agend y creamos un canal para cada uno de ellos, en el que se public칩 la informaci칩n.  Por lo tanto, cualquier persona que se conecte a la tarea podr칤a ver todo lo que se le ocurri칩, incluidos los resultados del lanzamiento de varias herramientas y b칰squedas manuales.  En todos los canales de informaci칩n, se estableci칩 un l칤mite de un mensaje por minuto para evitar inundaciones.  Y toda la discusi칩n se realiz칩 en chats separados, que tambi칠n se crearon para cada objeto. <br><br><img src="https://habrastorage.org/webt/ed/2m/lk/ed2mlkxo5tkfjhbpxucchbb6vv4.png"><br><br>  Tambi칠n se tomaron varias decisiones organizativas para mejorar la coordinaci칩n.  En general, no es habitual que nuestro equipo establezca tareas con la frase "NADO".  Tratamos de discutir por qu칠 se establece esta o aquella tarea, a qu칠 conducir치 su implementaci칩n y tambi칠n c칩mo llevarla a cabo de manera m치s eficiente.  Pero dentro del marco de StandOff, dicho modelo puede conducir a disputas innecesarias, por lo que decidimos confiar al coordinador una autoridad completa sobre el proceso.  A las 28 horas de la competencia, sus decisiones pr치cticamente no se discutieron, lo que ciertamente nos ahorr칩 mucho tiempo.  Aunque puede haber afectado la calidad de las comunicaciones.  Adem치s de esto, decidimos delinear muy claramente las 치reas de responsabilidad: a pesar de que algunos de los miembros del equipo no obtuvieron las tareas m치s emocionantes. <br><br><h3>  2. Recolecci칩n de frutas bajas </h3><br>  En mi opini칩n, el secreto principal de nuestro 칠xito fue: una gran experiencia diaria de proyectos y la correcta priorizaci칩n de tareas.  El a침o pasado, pudimos capturar una oficina completa y mantenerla durante todo el juego simplemente debido a vulnerabilidades simples pirateadas r치pidamente.  Este a침o, abordamos el problema centralmente y compilamos una lista de tales vulnerabilidades. <br><br>  ms17-010;  ms08-67;  SMBCRY  LibSSH RCE;  HP DATA Protector;  HP iLo;  ipmi  Instalaci칩n inteligente de Cisco  Java RMI  JDWP;  JBOSS;  drupalgeddon2;  weblogic  desangrado  concha  ibm websphere  iis-webdav;  servicios;  vnc;  ftp-anon;  NFS  smb-null;  Tomcat <br><br>  A continuaci칩n, se escribieron dos servicios de verificaci칩n y penetraci칩n, que en un modo automatizado, utilizando exploits p칰blicos y metasploit, primero verificaron vulnerabilidades y luego intentaron explotarlas.  La utilidad recibi칩 un informe nmap en la entrada, que finalmente aceler칩 el proceso. <br><br><h3>  3. Explotaci칩n de vulnerabilidades de tecnolog칤as at칤picas (para nosotros) (ACS TP, IoT, GSM) </h3><br>  La mayor칤a de las veces hacemos proyectos para bancos y otras organizaciones financieras.  Los sistemas SCADA, si lo hacen, son m치s bien al estilo de: "Si pudo obtener acceso de red a la scada, corr칤jalo y cu칠ntelo como uno de los criterios de 칠xito del proyecto".  Por lo tanto, no tenemos una buena experiencia aplicada en el an치lisis de la seguridad de los sistemas de control de procesos.  Esto a su vez llev칩 al hecho de que una semana antes de StandOff nos sentamos con urgencia para estudiar las vulnerabilidades t칤picas.  Con IoT y GSM, la situaci칩n es a칰n peor: si IoT a veces se encuentra en proyectos, entonces vimos GSM solo en StandOffs anteriores. <br><br>  Por lo tanto, durante la preparaci칩n, identificamos dos personas separadas en el sistema automatizado de control de procesos y dos m치s en GSM e IoT.  Durante la semana preparatoria, el primer grupo escribi칩 enfoques t칤picos para el 칰ltimo sistema SCADA, y estudi칩 en detalle un video sobre la infraestructura ICS del a침o pasado.  Los chicos tambi칠n bombearon alrededor de 200 GB de varios HMI, controladores y otro software que est치 directamente relacionado con los controladores.  En cuanto a GSM e IoT, aqu칤 preparamos varias piezas de hierro, le칤mos todos los art칤culos disponibles sobre GSM y esperamos que esto fuera suficiente.  (SPOILER: 춰No realmente!) <br><br><h3>  4. Preparaci칩n de infraestructura y equipos externos. </h3><br>  Entendiendo que nuestro equipo ser치 lo suficientemente grande este a침o, inmediatamente decidimos que necesit치bamos equipo adicional.  La siguiente es una lista de sugerencias que hemos recopilado dentro del equipo, el signo "+" indica que finalmente tomamos: <br><br>  - cafetera; <br>  + - servidor CUDA (no se lo llevaron, pero lo usaron); <br>  + laptop de repuesto; <br>  + Enrutador WIFI; <br>  + interruptor gestionado; <br>  + cables de red de varias longitudes (20 piezas); <br>  + piloto (3 piezas); <br>  + Alfa Wi-fi (3 piezas); <br>  + pato de goma (2 piezas); <br>  - proxmark; <br>  - una camara. <br><br>  En cuanto a la infraestructura, esta es una canci칩n separada.  El a침o pasado, nos dimos cuenta de lo 칰til que es usar una estaci칩n CUDA, rompiendo varios apretones de manos, por lo que no hab칤a dudas sobre la necesidad de usarla.  Es importante que este a침o, as칤 como en el pasado, todos los atacantes estuvieran detr치s del NATth, que generalmente rechaz칩 la posibilidad de conexiones inversas desde DMZ.  Pero absolutamente todos los hosts deber칤an tener acceso a Internet, excepto los nodos ICS.  En este sentido, decidimos crear tres servidores de escucha, accesibles desde Internet.  Adem치s, para simplificar el giro y la consolidaci칩n, utilizamos nuestro propio servidor OpenVpn con el modo de cliente a cliente habilitado.  Desafortunadamente, es imposible automatizar el proceso de conexi칩n de una puerta de enlace, por lo que durante aproximadamente 12 horas de 28, uno de los miembros del equipo trabaj칩 con las puertas de enlace. <br><br><h3>  5. Desarrollo de add.  m칠todos de persistencia y endurecimiento </h3><br>  Nuestra experiencia pasada con StandOff ha demostrado muy claramente que no es suficiente piratear un servidor con 칠xito: es importante no dejar que otros lo arreglen.  Por lo tanto, se prest칩 suficiente atenci칩n a RAT con nuevas firmas y scripts para fortalecer la protecci칩n de Windows.  Utilizamos nuestra RAT est치ndar, cambiando ligeramente los m칠todos de ofuscaci칩n.  Las reglas eran un poco m치s complicadas.  En general, determinamos por nosotros mismos el siguiente conjunto de scripts: <br><br><ul><li>  cierre de SMB y RPC; </li><li>  portar RDP a un puerto no est치ndar; </li><li>  Deshabilitar el cifrado reversible, las cuentas de invitados y otras configuraciones desde la l칤nea de base de seguridad. </li></ul><br>  Para Linux, se desarroll칩 un script de inicio especial que cerr칩 todos los puertos, abri칩 SSH en un puerto no est치ndar y registr칩 las claves p칰blicas del comando para acceder a SSH. <br><br><h3>  <b>II</b>  <b>Briefing</b> </h3><br>  El 17 de mayo, 5 d칤as antes de StandOff, se realiz칩 una sesi칩n informativa para los atacantes.  En el transcurso de la misma, surgi칩 mucha informaci칩n que influy칩 en nuestro entrenamiento. <br><br>  En primer lugar, los organizadores publicaron un mapa de la red, y esto se ha convertido en una gran ayuda para nosotros.  Pudimos dividir las 치reas de responsabilidad por adelantado, actualizar los segmentos de la red y, lo m치s importante, comprender qu칠 es la red de todos modos.  En mi opini칩n, la declaraci칩n m치s importante realizada en la sesi칩n informativa fue la frase de que la red ICS ser치 accesible desde un solo segmento, y este segmento no estar치 protegido.  Adem치s, se otorgar치n la mayor cantidad de puntos para ICS y oficinas seguras, y los organizadores alientan directamente la lucha por las redes entre hackers. <br><br>  Tomamos esta informaci칩n de esta manera: "El que captura el bigbrogroup es probable que gane el juego".  El caso es que nuestra experiencia nos lo dijo: no importa qu칠 castigos se les ocurran a los organizadores por un servicio simple, los defensores abandonar칤an los servicios vulnerables si no pudieran parchearlos.  Despu칠s de todo, es mucho peor cuando anuncian desde el escenario de la conferencia de seguridad de la informaci칩n m치s grande que usted ha malcriado a los piratas inform치ticos que si le quitan algunos puntos de juego.  Nuestra teor칤a fue confirmada, pero hablaremos de esto en detalle en el segundo art칤culo. <br><br>  Como resultado, decidimos dividir a todo el equipo en 4 partes: <br><br>  <b>1. Bigbrogroup.</b>  Esta fue la tarea a la que le asignamos la m치xima prioridad.  El equipo involucr칩 a las personas que tienen la mayor experiencia en irrumpir en la infraestructura interna de diferentes clientes.  En total, este mini equipo estaba formado por 5 personas.  Su objetivo era obtener un punto de apoyo en el dominio lo m치s r치pido posible y cortar el acceso de otros equipos al ICS. <br><br>  <b>2. Red inal치mbrica.</b>  El equipo responsable de monitorear la conexi칩n Wi-Fi, rastre칩 nuevos puntos, intercept칩 los apretones de manos y los maltrat칩.  GSM tambi칠n particip칩 en sus tareas, pero antes que nada era necesario capturar Wi-Fi y cortar otros comandos. <br><br>  <b>3. Redes desprotegidas.</b>  El equipo que durante las primeras cuatro horas seleccion칩 todas las redes desprotegidas para detectar vulnerabilidades.  Entendimos que en estas cuatro horas no suceder치 nada s칰per importante en los segmentos protegidos, y si lo hace, los defensores lo revertir치n.  Por lo tanto, se centraron en lo que podr칤a haber cambiado irreversiblemente.  Al final result칩 que no en vano.  Cuatro horas despu칠s, el mismo grupo comenz칩 a analizar segmentos protegidos. <br><br>  <b>4. Grupo de esc치neres.</b>  Los organizadores declararon directamente que las redes cambiar치n, por lo que tuvimos dos personas que exploraron continuamente la red en busca de cambios.  No fue tan f치cil automatizar, porque bajo diferentes redes, se necesitaban diferentes configuraciones en diferentes momentos.  Por ejemplo, en la primera hora en la red fe.phd, nmap funcion칩 bien para nosotros en modo T3, y despu칠s de 12 horas apenas funcion칩 en T1. <br><br>  Otro vector importante para nosotros fue la lista de software y tecnolog칤as publicada por los organizadores.  Para cada tecnolog칤a, tratamos de crear nuestro propio centro de competencia, que podr칤a ayudar y ver r치pidamente las vulnerabilidades t칤picas. <br><br>  Para algunos servicios, encontramos vulnerabilidades muy interesantes, pero no hubo exploits p칰blicos.  As칤 fue, por ejemplo, con Redis Post-explotaci칩n RCE.  Est치bamos seguros de que esta vulnerabilidad aparecer칤a en la infraestructura del juego, por lo que decidimos escribir nuestro propio exploit de 1 d칤a.  No fue posible escribir 1 d칤a espec칤ficamente para esta vulnerabilidad, pero en general ten칤amos cerca de cinco exploits no p칰blicos disponibles que est치bamos listos para usar. <br><br><img src="https://habrastorage.org/webt/kt/sc/ze/ktsczeslu1oszbpflccstfktb0w.png"><br><br>  Desafortunadamente, no logramos compartir todas las tecnolog칤as, pero no fue tan aterrador.  Cubrimos el set principal, y esto fue suficiente.  Tambi칠n hab칤a una lista de controladores de procesos, que tambi칠n resolvimos y tratamos de preparar. <br><br>  En preparaci칩n para la batalla, preparamos varias herramientas para conectarse sin problemas a la red f칤sica ICS.  Por ejemplo, implementamos un an치logo barato de Pineapple-a usando frambuesa.  El m칩dulo se conect칩 a trav칠s de Ethernet a la red industrial y a trav칠s de GSM al servicio de gesti칩n.  A continuaci칩n, podr칤amos configurar de forma remota la conexi칩n Ethernet y distribuirla en el acto utilizando el m칩dulo Wi-Fi incorporado.  Desafortunadamente, en la sesi칩n informativa, los organizadores dejaron en claro que no se puede conectar f칤sicamente al ICS, por lo que dejamos este m칩dulo hasta tiempos mejores. <br><br>  Mucha informaci칩n era sobre el banco, el banco offshore y el trabajo antifraude.  Pero al haber aprendido que no hay mucho dinero en 칠l, decidimos no prepararnos para esto por adelantado, sino idear algo en el camino. <br><br>  En resumen, hemos realizado una gran cantidad de trabajo en preparaci칩n.  Es importante tener en cuenta que, adem치s de las ventajas obvias en forma de un desempe침o exitoso en StandOff, tampoco hubo otras obvias. <br><br><ul><li>  Tal preparaci칩n es una excelente manera de distraerse y hacer algo que siempre he querido probar y explorar, y simplemente no hab칤a tiempo en el marco de la actividad del proyecto. </li><li>  No tenemos proyectos que involucren a todo el equipo como parte de una tarea, por lo que obtuvimos un buen trabajo en equipo, persiguiendo objetivos espec칤ficos. </li><li>  Gran parte de lo que hemos hecho se puede usar en proyectos reales, por lo que, adem치s de ampliar nuestras competencias, tambi칠n obtuvimos herramientas listas para usar. </li></ul><br>  Ahora, habiendo descrito todo esto en el texto, entiendo que no logramos nada tan grandioso como parec칤a antes.  En general, me parece que la etapa de preparaci칩n correctamente organizada se convirti칩 en la raz칩n principal de la victoria de nuestro equipo.  Y lo que sucedi칩 directamente durante StandOff en s칤, lo contar칠 en el segundo art칤culo del ciclo. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/453834/">https://habr.com/ru/post/453834/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../453822/index.html">Cajas registradoras en l칤nea como una extracci칩n legal de dinero de una empresa</a></li>
<li><a href="../453824/index.html">쮺칩mo ser치 la colaboraci칩n y visualizaci칩n de contenido de video con la llegada de 5G?</a></li>
<li><a href="../453828/index.html">Evitar mentir con estad칤sticas: los fundamentos de la visualizaci칩n de datos</a></li>
<li><a href="../453830/index.html">Comparaci칩n de repetidores celulares. RF-Link 1800 / 2100-75-23 y AliExpress Noname</a></li>
<li><a href="../453832/index.html">19 cabezas de hidra. Gran revisi칩n del programa</a></li>
<li><a href="../453836/index.html">OOP mitos y realidad</a></li>
<li><a href="../453838/index.html">C칩mo automatizar el monitoreo de compras p칰blicas de forma gratuita</a></li>
<li><a href="../453840/index.html">Dicen que aprender Python y convertirse en programador es f치cil. Derecho?</a></li>
<li><a href="../453842/index.html">C칩mo Microsoft corta el ruido para crear un mundo de sonido 칰til y hermoso</a></li>
<li><a href="../453844/index.html">Boleto para LANIT. Estar en el juego</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>