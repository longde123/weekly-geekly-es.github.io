<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ¸ ğŸŒ«ï¸ ğŸ“› å¦‚ä½•ä½¿SFINAEå…‰æ»‘å¯é  ğŸ•‰ï¸ ğŸ€ ğŸ›’</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ä½ å¥½ æˆ‘ä»¬æ­£åœ¨ä¸æ‚¨åˆ†äº«ä¸€ç¯‡æœ‰è¶£çš„æ–‡ç« ï¼Œè¯¥æ–‡ç« çš„ç¿»è¯‘æ˜¯ä¸“é—¨ä¸ºâ€œ C ++ Developerâ€è¯¾ç¨‹çš„å­¦ç”Ÿå‡†å¤‡çš„ã€‚ 




 ä»Šå¤©æˆ‘ä»¬æœ‰dÃ¡mBalÃ¡zsçš„æ¥å®¾å¸–å­ã€‚ Adamæ˜¯åŒˆç‰™åˆ©Verizonæ™ºèƒ½ç¤¾åŒºçš„ä¸€åè½¯ä»¶å·¥ç¨‹å¸ˆï¼Œå¹¶ä¸ºåµŒå…¥å¼ç³»ç»Ÿå¼€å‘è§†é¢‘åˆ†æã€‚ ä»–çš„çˆ±å¥½ä¹‹ä¸€æ˜¯ä¼˜åŒ–ç¼–è¯‘æ—¶é—´ï¼Œå› æ­¤ä»–ç«‹å³åŒæ„å°±è¯¥ä¸»...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>å¦‚ä½•ä½¿SFINAEå…‰æ»‘å¯é </h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/466915/">  <i>ä½ å¥½</i>  <i>æˆ‘ä»¬æ­£åœ¨ä¸æ‚¨åˆ†äº«ä¸€ç¯‡æœ‰è¶£çš„æ–‡ç« ï¼Œè¯¥æ–‡ç« çš„ç¿»è¯‘æ˜¯ä¸“é—¨ä¸º<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">â€œ C ++ Developerâ€</a>è¯¾ç¨‹çš„å­¦ç”Ÿå‡†å¤‡çš„ã€‚</i> <br><br><img src="https://habrastorage.org/webt/i1/cn/mm/i1cnmmt1eyhcbyi9exnawbo2vgq.png"><br><br><hr><br> ä»Šå¤©æˆ‘ä»¬æœ‰dÃ¡mBalÃ¡zsçš„æ¥å®¾å¸–å­ã€‚  Adamæ˜¯åŒˆç‰™åˆ©Verizonæ™ºèƒ½ç¤¾åŒºçš„ä¸€åè½¯ä»¶å·¥ç¨‹å¸ˆï¼Œå¹¶ä¸ºåµŒå…¥å¼ç³»ç»Ÿå¼€å‘è§†é¢‘åˆ†æã€‚ ä»–çš„çˆ±å¥½ä¹‹ä¸€æ˜¯ä¼˜åŒ–ç¼–è¯‘æ—¶é—´ï¼Œå› æ­¤ä»–ç«‹å³åŒæ„å°±è¯¥ä¸»é¢˜å†™å®¢åº§æ–‡ç« ã€‚ æ‚¨å¯ä»¥åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">LinkedInä¸Š</a>åœ¨çº¿æ‰¾åˆ°Adamã€‚ <a name="habracut"></a><br><br> åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä¸€ç³»åˆ—æœ‰å…³å¦‚ä½•ä½¿SFINAEå˜å¾—ä¼˜é›…çš„æ–‡ç« ä¸­</a> ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†å¦‚ä½•ä½¿æˆ‘ä»¬çš„SFINAEæ¨¡æ¿<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç®€æ´è€Œå¯Œæœ‰è¡¨ç°åŠ›</a> ã€‚ <br><br> çœ‹çœ‹å®ƒçš„åŸå§‹å½¢å¼ï¼š <br><br><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> T&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyClass</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MyClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(T </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params">&amp; x)</span></span></span></span>{} <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> T_ = T&gt; <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> f(T&amp;&amp; x, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::enable_if&lt;!<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::is_reference&lt;T_&gt;::value, <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">nullptr_t</span></span>&gt;::type = <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>){} };</code> </pre> <br><br> å¹¶å°†å…¶ä¸è¿™ç§æ›´å…·è¡¨ç°åŠ›çš„å½¢å¼è¿›è¡Œæ¯”è¾ƒï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> T&gt; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> IsNotReference = <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">enable_if_t</span></span>&lt;!<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::is_reference_v&lt;T&gt;&gt;; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> T&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyClass</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">f</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(T </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params">&amp; x)</span></span></span></span>{} <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> T_ = T, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> = IsNotReference &lt;T_&gt;&gt; <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> f(T&amp;&amp; x){} };</code> </pre> <br> æˆ‘ä»¬å¯ä»¥åˆç†åœ°ç›¸ä¿¡ï¼Œå·²ç»å¯ä»¥æ”¾å®½å¹¶å¼€å§‹åœ¨ç”Ÿäº§ä¸­ä½¿ç”¨å®ƒã€‚ æˆ‘ä»¬å¯ä»¥åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ä½¿ç”¨å®ƒï¼Œä½†æ˜¯-åœ¨æˆ‘ä»¬è°ˆè®ºæ¥å£æ—¶-æˆ‘ä»¬çš„ä»£ç åº”è¯¥å®‰å…¨å¯é ã€‚ æ˜¯è¿™æ ·å— è®©æˆ‘ä»¬å°è¯•ç ´è§£å®ƒï¼ <br><br><h2> ç¼ºé™·1ï¼šå¯ä»¥ç»•è¿‡SFINAE </h2><br> é€šå¸¸ï¼Œæ ¹æ®æ¡ä»¶ï¼Œä½¿ç”¨SFINAEç¦ç”¨éƒ¨åˆ†ä»£ç ã€‚ å¦‚æœæˆ‘ä»¬å‡ºäºæŸç§åŸå› ï¼ˆä¾‹å¦‚ï¼Œç”¨æˆ·å®šä¹‰çš„ç®—æœ¯ç±»ï¼Œé’ˆå¯¹ç‰¹å®šè®¾å¤‡çš„ä¼˜åŒ–ï¼Œå‡ºäºåŸ¹è®­ç›®çš„ç­‰ï¼‰éœ€è¦å®ç°ç”¨æˆ·å®šä¹‰çš„å‡½æ•°absï¼Œè¿™å°†éå¸¸æœ‰ç”¨ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> T &gt; <span class="hljs-function"><span class="hljs-function">T </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">myAbs</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( T val )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>( ( val &lt;= <span class="hljs-number"><span class="hljs-number">-1</span></span> ) ? -val : val ); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> a{ <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::numeric_limits&lt; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> &gt;::max() }; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">cout</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">"a: "</span></span> &lt;&lt; a &lt;&lt; <span class="hljs-string"><span class="hljs-string">" myAbs( a ): "</span></span> &lt;&lt; myAbs( a ) &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>; }</code> </pre> <br> è¯¥ç¨‹åºæ˜¾ç¤ºä»¥ä¸‹å†…å®¹ï¼Œçœ‹èµ·æ¥å¾ˆæ­£å¸¸ï¼š <br><br><pre> <code class="cpp hljs">a: <span class="hljs-number"><span class="hljs-number">2147483647</span></span> myAbs( a ): <span class="hljs-number"><span class="hljs-number">2147483647</span></span></code> </pre> <br> ä½†æ˜¯æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ— ç¬¦å·å‚æ•°<code>T</code>æ¥è°ƒç”¨<code>abs</code>å‡½æ•°ï¼Œç»“æœå°†æ˜¯ç¾éš¾æ€§çš„ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">nt </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> a{ <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::numeric_limits&lt; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> &gt;::max() }; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">cout</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">"a: "</span></span> &lt;&lt; a &lt;&lt; <span class="hljs-string"><span class="hljs-string">" myAbs( a ): "</span></span> &lt;&lt; myAbs( a ) &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>; }</code> </pre> <br> å®é™…ä¸Šï¼Œç°åœ¨ç¨‹åºæ˜¾ç¤ºï¼š <br><br> <code>a: 4294967295 myAbs( a ): 1</code> <br> <br> æˆ‘ä»¬çš„å‡½æ•°å¹¶éæ—¨åœ¨ä¸æ— ç¬¦å·å‚æ•°ä¸€èµ·ä½¿ç”¨ï¼Œå› æ­¤å¿…é¡»ä½¿ç”¨SFINAEé™åˆ¶å¯èƒ½çš„<code>T</code>é›†ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> T &gt; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> IsSigned = <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">enable_if_t</span></span>&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::is_signed_v&lt; T &gt; &gt;; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> T, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> = IsSigned&lt; T &gt; &gt; T myAbs( T val ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>( ( val &lt;= <span class="hljs-number"><span class="hljs-number">-1</span></span> ) ? -val : val ); }</code> </pre> <br> è¯¥ä»£ç æŒ‰é¢„æœŸå·¥ä½œï¼šä½¿ç”¨æ— ç¬¦å·ç±»å‹çš„myAbsè°ƒç”¨ä¼šå¯¼è‡´ç¼–è¯‘æ—¶é”™è¯¯ï¼š <br><br> <code><code>candidate template ignored: requirement 'std::is_signed_v&lt;</code> unsigned int&gt;' was not satisfied [with T = unsigned int]</code> <br> <br><h3> å…¥ä¾µSFINAEçŠ¶æ€ </h3><br> é‚£ä¹ˆæ­¤åŠŸèƒ½æœ‰ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ è¦å›ç­”è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦æ£€æŸ¥myAbså¦‚ä½•å®ç°SFINAEã€‚ <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> T, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> = IsSigned&lt;T&gt; &gt; T myAbs( T val );</code> </pre> <br>  <code>myAbs</code>æ˜¯å…·æœ‰ä¸¤ç§ç±»å‹çš„è¾“å…¥æ¨¡æ¿å‚æ•°çš„åŠŸèƒ½æ¨¡æ¿ã€‚ ç¬¬ä¸€ä¸ªæ˜¯å‡½æ•°å‚æ•°çš„å®é™…ç±»å‹ï¼Œç¬¬äºŒä¸ªæ˜¯é»˜è®¤çš„<code><code>IsSigned &lt;</code> T <code>&gt;</code></code> ï¼ˆå¦åˆ™<code><code>std::enable_if_t &lt;</code> std::is_signed_v <code>&lt;</code> T <code>&gt;</code> &gt;</code>æˆ–<code><code>std::enable_if &lt;</code> std::is_signed_v <code>&lt;</code> T&gt;, void&gt;::type</code> ï¼Œå³<code>void</code>æˆ–æ›¿æ¢å¤±è´¥ï¼‰ã€‚ <br><br> æˆ‘ä»¬å¦‚ä½•ç§°å‘¼<code>myAbs</code> ï¼Ÿ æœ‰3ç§æ–¹æ³•ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> a{ myAbs( <span class="hljs-number"><span class="hljs-number">-5</span></span> ) }; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> b{ myAbs&lt; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> &gt;( <span class="hljs-number"><span class="hljs-number">-5</span></span> ) }; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> c{ myAbs&lt; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> &gt;( <span class="hljs-number"><span class="hljs-number">-5</span></span> ) };</code> </pre> <br> ç¬¬ä¸€ä¸ªå’Œç¬¬äºŒä¸ªè°ƒç”¨å¾ˆç®€å•ï¼Œä½†ç¬¬ä¸‰ä¸ªè°ƒç”¨å¾ˆæœ‰è¶£ï¼š <code>void</code>æ¨¡æ¿çš„å‚æ•°æ˜¯ä»€ä¹ˆï¼Ÿ <br><br> ç¬¬äºŒä¸ªæ¨¡æ¿å‚æ•°æ˜¯åŒ¿åçš„ï¼Œå…·æœ‰é»˜è®¤ç±»å‹ï¼Œä½†æ˜¯å®ƒä»ç„¶æ˜¯æ¨¡æ¿å‚æ•°ï¼Œå› æ­¤æ‚¨å¯ä»¥æ˜¾å¼æŒ‡å®šå®ƒã€‚ è¿™æœ‰é—®é¢˜å—ï¼Ÿ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¿™ç¡®å®æ˜¯ä¸€ä¸ªå·¨å¤§çš„é—®é¢˜ã€‚ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç¬¬ä¸‰ç§å½¢å¼æ¥è§£å†³SFINAEæ£€æŸ¥ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> d{ myAbs&lt; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> &gt;( <span class="hljs-number"><span class="hljs-number">5u</span></span> ) }; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> e{ myAbs&lt; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> &gt;( <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::numeric_limits&lt; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> &gt;::max() ) };</code> </pre> <br> è¿™æ®µä»£ç å¯ä»¥å¾ˆå¥½åœ°ç¼–è¯‘ï¼Œä½†ä¼šå¯¼è‡´ç¾éš¾æ€§çš„ç»“æœï¼Œè¯·é¿å…ä½¿ç”¨SFINAEï¼š <br><br><pre> <code class="cpp hljs">a: <span class="hljs-number"><span class="hljs-number">4294967295</span></span> myAbs( a ): <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> <br> æˆ‘ä»¬å°†è§£å†³è¿™ä¸ªé—®é¢˜-ä½†é¦–å…ˆï¼šè¿˜æœ‰å…¶ä»–ç¼ºç‚¹å—ï¼Ÿ å¥½å§... <br><br><h2> ç¼ºé™·2ï¼šæˆ‘ä»¬æ— æ³•æ‰§è¡Œç‰¹å®šçš„å®ç° </h2><br>  SFINAEçš„å¦ä¸€ä¸ªå¸¸è§ç”¨é€”æ˜¯ä¸ºç‰¹å®šçš„ç¼–è¯‘æ—¶æ¡ä»¶æä¾›ç‰¹å®šçš„å®ç°ã€‚ å¦‚æœæˆ‘ä»¬ä¸æƒ³å®Œå…¨ç¦æ­¢ä½¿ç”¨<code>myAbs</code>å€¼è°ƒç”¨<code>myAbs</code>å¹¶ä¸ºè¿™äº›æƒ…å†µæä¾›ç®€å•çš„å®ç°è¯¥æ€ä¹ˆåŠï¼Ÿ æˆ‘ä»¬å¯ä»¥åœ¨C ++ 17ä¸­ä½¿ç”¨if constexprï¼ˆæˆ‘ä»¬å°†åœ¨åé¢è®¨è®ºï¼‰ï¼Œæˆ–è€…å¯ä»¥ï¼š <br><br><pre> <code class="cpp hljs"> <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> T &gt; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> IsSigned = <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">enable_if_t</span></span>&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::is_signed_v&lt; T &gt; &gt;; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> T &gt; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> IsUnsigned = <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">enable_if_t</span></span>&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::is_unsigned_v&lt; T &gt; &gt;; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> T, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> = IsSigned&lt; T &gt; &gt; T myAbs( T val ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>( ( val &lt;= <span class="hljs-number"><span class="hljs-number">-1</span></span> ) ? -val : val ); } <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> T, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> = IsUnsigned&lt; T &gt; &gt; T myAbs( T val ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> val; }</code> </pre> <br> é‚£æ˜¯ä»€ä¹ˆ <br><br><pre> <code class="cpp hljs">error: <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> parameter redefines <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> argument <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> T, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> = IsUnsigned&lt; T &gt; &gt; note: previous <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> argument defined here <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> T, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> = IsSigned&lt; T &gt; &gt;</code> </pre> <br>  <i><b>å“¦ï¼ŒC ++æ ‡å‡†ï¼ˆC ++ 17ï¼›Â§17.1.16ï¼‰è§„å®šå¦‚ä¸‹</b> ï¼š</i> <br><br><blockquote>  â€œä¸åº”åœ¨åŒä¸€èŒƒå›´å†…é€šè¿‡ä¸¤ä¸ªä¸åŒçš„å£°æ˜å°†é»˜è®¤å‚æ•°æä¾›ç»™æ¨¡æ¿å‚æ•°ã€‚â€ </blockquote><br> ç³Ÿç³•ï¼Œè¿™æ­£æ˜¯æˆ‘ä»¬æ‰€åšçš„... <br><br><h3> ä¸ºä»€ä¹ˆä¸ä½¿ç”¨å¸¸è§„çš„ï¼Ÿ </h3><br> æˆ‘ä»¬å¯ä»¥åªåœ¨è¿è¡Œæ—¶ä½¿ç”¨ifï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> T &gt; <span class="hljs-function"><span class="hljs-function">T </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">myAbs</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( T val )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::is_signed_v&lt; T &gt; ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( ( val &lt;= <span class="hljs-number"><span class="hljs-number">-1</span></span> ) ? -val : val ); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> val; } }</code> </pre> <br> ç¼–è¯‘å™¨å°†ä¼˜åŒ–æ¡ä»¶ï¼Œå› ä¸ºåˆ›å»ºæ¨¡æ¿å<code><code>if (std::is_signed_v &lt;</code> T&gt;)</code>å˜ä¸º<code>if (true)</code>æˆ–<code>if (false)</code> ã€‚ æ˜¯çš„ï¼Œä½¿ç”¨æˆ‘ä»¬å½“å‰çš„<code>myAbs</code>å®æ–½<code>myAbs</code>è¿™å°†èµ·ä½œç”¨ã€‚ ä½†æ˜¯æ€»çš„æ¥è¯´ï¼Œè¿™æ–½åŠ äº†å¾ˆå¤§çš„é™åˆ¶ï¼š <code>if</code>å’Œ<code>else</code>å¿…é¡»å¯¹æ¯ä¸ª<code>T</code>æœ‰æ•ˆ<code>T</code> å¦‚æœæˆ‘ä»¬ç¨å¾®æ”¹å˜å®ç°æ–¹å¼è¯¥æ€ä¹ˆåŠï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> T &gt; <span class="hljs-function"><span class="hljs-function">T </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">myAbs</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( T val )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::is_signed_v&lt; T &gt; ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">abs</span></span>( val ); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> val; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> a{ myAbs( <span class="hljs-number"><span class="hljs-number">5u</span></span> ) }; }</code> </pre> <br> æˆ‘ä»¬çš„ä»£ç å°†ç«‹å³å´©æºƒï¼š <br><br><pre> <code class="cpp hljs">error: call of overloaded <span class="hljs-string"><span class="hljs-string">'abs(unsigned int&amp;)'</span></span> is ambiguous</code> </pre> <br>  SFINAEæ¶ˆé™¤äº†æ­¤é™åˆ¶ï¼šæˆ‘ä»¬å¯ä»¥ç¼–å†™ä»…å¯¹Tçš„å­é›†æœ‰æ•ˆçš„ä»£ç ï¼ˆåœ¨myAbä¸­ï¼Œå®ƒä»…å¯¹æ— ç¬¦å·ç±»å‹æœ‰æ•ˆæˆ–ä»…å¯¹æœ‰ç¬¦å·ç±»å‹æœ‰æ•ˆï¼‰ã€‚ <br><br><h3> è§£å†³æ–¹æ¡ˆï¼šSFINAEçš„å¦ä¸€ç§å½¢å¼ </h3><br> æˆ‘ä»¬è¯¥å¦‚ä½•å…‹æœè¿™äº›ç¼ºç‚¹ï¼Ÿ å¯¹äºç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œæ— è®ºç”¨æˆ·å¦‚ä½•è°ƒç”¨æˆ‘ä»¬çš„åŠŸèƒ½ï¼Œæˆ‘ä»¬éƒ½å¿…é¡»å¼ºåˆ¶æ‰§è¡ŒSFINAEæ£€æŸ¥ã€‚ å½“å‰ï¼Œå½“ç¼–è¯‘å™¨ä¸éœ€è¦ç¬¬äºŒä¸ªæ¨¡æ¿å‚æ•°çš„é»˜è®¤ç±»å‹æ—¶ï¼Œå¯ä»¥ç»•è¿‡æˆ‘ä»¬çš„æµ‹è¯•ã€‚ <br><br> å¦‚æœæˆ‘ä»¬ä½¿ç”¨SFINAEä»£ç å£°æ˜æ¨¡æ¿å‚æ•°ç±»å‹è€Œä¸æä¾›é»˜è®¤ç±»å‹æ€ä¹ˆåŠï¼Ÿ è®©æˆ‘ä»¬å°è¯•ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> T &gt; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> IsSigned = <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">enable_if_t</span></span>&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::is_signed_v&lt; T &gt;, <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> &gt;; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> T, IsSigned&lt; T &gt; = <span class="hljs-literal"><span class="hljs-literal">true</span></span> &gt; T myAbs( T val ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>( ( val &lt;= <span class="hljs-number"><span class="hljs-number">-1</span></span> ) ? -val : val ); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//int a{ myAbs( 5u ) }; int b{ myAbs&lt; int &gt;( 5u ) }; //int c{ myAbs&lt; unsigned int, true &gt;( 5u ) }; }</span></span></code> </pre> <br> åœ¨æœ‰æ•ˆæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦IsSignedä¸ºvoidä»¥å¤–çš„å…¶ä»–ç±»å‹ï¼Œå› ä¸ºæˆ‘ä»¬æƒ³ä¸ºæ­¤ç±»å‹æä¾›é»˜è®¤å€¼ã€‚  voidç±»å‹æ²¡æœ‰å€¼ï¼Œå› æ­¤æˆ‘ä»¬åº”è¯¥ä½¿ç”¨å…¶ä»–ç±»å‹ï¼šboolï¼Œintï¼Œenumï¼Œnullptr_tç­‰ã€‚é€šå¸¸æˆ‘ä½¿ç”¨bool-åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¡¨è¾¾å¼çœ‹èµ·æ¥å¾ˆæœ‰æ„ä¹‰ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> T, IsSigned&lt; T &gt; = <span class="hljs-literal"><span class="hljs-literal">true</span></span> &gt;</code> </pre> <br> æœ‰æ•ˆï¼ å¯¹äº<code>myAbs (5u)</code>ç¼–è¯‘å™¨ä¼šåƒä»¥å‰ä¸€æ ·å¼•å‘é”™è¯¯ï¼š <br><br><pre> <code class="cpp hljs">candidate <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> ignored: requirement <span class="hljs-string"><span class="hljs-string">'std::is_signed_v&lt;unsigned int&gt;'</span></span> was <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> satisfied [with T = <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span></code> </pre> <br> ç¬¬äºŒä¸ªè°ƒç”¨<code><code>myAbs &lt;</code> int&gt; (5u)</code>ä»ç„¶æœ‰æ•ˆï¼Œæˆ‘ä»¬æ˜ç¡®å‘Šè¯‰ç¼–è¯‘å™¨ç±»å‹<code>T</code> ï¼Œå› æ­¤å°†<code>5u</code>è½¬æ¢ä¸º<code>int</code> ã€‚ <br><br> æœ€åï¼Œæˆ‘ä»¬ä¸å†<code>myAbs</code>åœ¨æ‰‹æŒ‡å‘¨å›´è·Ÿè¸ª<code>myAbs</code> ï¼š <code><code>myAbs &lt;</code> unsigned int, true&gt; (5u)</code>å¼•å‘é”™è¯¯ã€‚ ä¸ç®¡æ˜¯å¦åœ¨è°ƒç”¨ä¸­æä¾›é»˜è®¤å€¼ï¼Œæ— è®ºå¦‚ä½•éƒ½å°†è¯„ä¼°SFINAEè¡¨è¾¾å¼çš„ä¸€éƒ¨åˆ†ï¼Œå› ä¸ºç¼–è¯‘å™¨éœ€è¦åŒ¿åæ¨¡æ¿å€¼çš„å‚æ•°ç±»å‹ã€‚ <br><br> æˆ‘ä»¬å¯ä»¥ç»§ç»­è¿›è¡Œä¸‹ä¸€ä¸ªé—®é¢˜-è¯·ç¨å€™ï¼ æˆ‘è®¤ä¸ºæˆ‘ä»¬ä¸å†è¦†ç›–åŒä¸€æ¨¡æ¿å‚æ•°çš„é»˜è®¤å‚æ•°ï¼ŒåŸå§‹æƒ…å†µæ˜¯ä»€ä¹ˆï¼Ÿ <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> T, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> = IsUnsigned&lt; T &gt; &gt; T myAbs( T val ); <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> T, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> = IsSigned&lt; T &gt; &gt; T myAbs( T val );</code> </pre> <br> ä½†æ˜¯ç°åœ¨æœ‰äº†å½“å‰ä»£ç ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> T, IsUnsigned&lt; T &gt; = <span class="hljs-literal"><span class="hljs-literal">true</span></span> &gt; T myAbs( T val ); <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> T, IsSigned&lt; T &gt; = <span class="hljs-literal"><span class="hljs-literal">true</span></span> &gt; T myAbs( T val );</code> </pre> <br> å®ƒçœ‹èµ·æ¥ä¸å…ˆå‰çš„ä»£ç éå¸¸ç›¸ä¼¼ï¼Œå› æ­¤æˆ‘ä»¬å¯èƒ½ä¼šè®¤ä¸ºè¿™ä¹Ÿä¸èµ·ä½œç”¨ï¼Œä½†å®é™…ä¸Šæ­¤ä»£ç æ²¡æœ‰ç›¸åŒçš„é—®é¢˜ã€‚ ä»€ä¹ˆæ˜¯<code><code>IsUnsigned &lt;</code> T&gt;</code> ï¼Ÿ å¸ƒå°”æˆ–æŸ¥æ‰¾å¤±è´¥ã€‚ ä»€ä¹ˆæ˜¯<code><code>IsSigned &lt;</code> T&gt;</code> ï¼Ÿ åŒæ ·ï¼Œä½†å¦‚æœå…¶ä¸­ä¸€ä¸ªæ˜¯Boolï¼Œåˆ™å¦ä¸€ä¸ªæ˜¯æŸ¥æ‰¾å¤±è´¥ã€‚ <br><br> è¿™æ„å‘³ç€æˆ‘ä»¬ä¸ä¼šè¦†ç›–é»˜è®¤å‚æ•°ï¼Œå› ä¸ºåªæœ‰ä¸€ä¸ªå¸¦æœ‰æ¨¡æ¿å‚æ•°boolçš„å‡½æ•°ï¼Œå¦ä¸€ä¸ªæ˜¯å¤±è´¥çš„æ›¿æ¢ï¼Œæ‰€ä»¥å®ƒä¸å­˜åœ¨ã€‚ <br><br><h3> å¥æ³•ç³– </h3><br>  <i><b>UPD</b></i>  <i>ç”±äºå‘ç°å…¶ä¸­çš„é”™è¯¯ï¼Œè¯¥æ®µè½å·²è¢«ä½œè€…åˆ é™¤ã€‚</i> <br><br><h3> æ—§ç‰ˆæœ¬çš„C ++ </h3><br> ä¸Šé¢æ‰€æœ‰è¿™äº›éƒ½ä¸C ++ 11å…¼å®¹ï¼Œå”¯ä¸€çš„åŒºåˆ«æ˜¯æ ‡å‡†ç‰ˆæœ¬ä¹‹é—´çš„é™åˆ¶å®šä¹‰çš„è¯¦ç»†ç¨‹åº¦ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//C++11 template&lt; typename T &gt; using IsSigned = typename std::enable_if&lt; std::is_signed&lt; T &gt;::value, bool &gt;::type; //C++14 - std::enable_if_t template&lt; typename T &gt; using IsSigned = std::enable_if_t&lt; std::is_signed&lt; T &gt;::value, bool &gt;; //C++17 - std::is_signed_v template&lt; typename T &gt; using IsSigned = std::enable_if_t&lt; std::is_signed_v&lt; T &gt;, bool &gt;;</span></span></code> </pre> <br> ä½†æ˜¯æ¨¡æ¿ä¿æŒä¸å˜ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> T, IsSigned&lt; T &gt; = <span class="hljs-literal"><span class="hljs-literal">true</span></span> &gt;</code> </pre> <br> åœ¨è¾ƒæ—§çš„C ++ 98ä¸­ï¼Œæ²¡æœ‰æ¨¡æ¿åˆ«åï¼Œæ­¤å¤–ï¼ŒåŠŸèƒ½æ¨¡æ¿ä¸èƒ½å…·æœ‰ç±»å‹æˆ–é»˜è®¤å€¼ã€‚ æˆ‘ä»¬å¯ä»¥å°†SFINAEä»£ç æ’å…¥ç»“æœç±»å‹æˆ–ä»…æ’å…¥å‡½æ•°å‚æ•°åˆ—è¡¨ã€‚ å»ºè®®ä½¿ç”¨ç¬¬äºŒä¸ªé€‰é¡¹ï¼Œå› ä¸ºæ„é€ å‡½æ•°æ²¡æœ‰ç»“æœç±»å‹ã€‚ æˆ‘ä»¬èƒ½åšçš„æœ€å¥½çš„äº‹æƒ…æ˜¯è¿™æ ·çš„ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> T &gt; <span class="hljs-function"><span class="hljs-function">T </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">myAbs</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( T val, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">typename</span></span></span></span><span class="hljs-function"><span class="hljs-params"> my_enable_if&lt; my_is_signed&lt; T &gt;::value, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> &gt;::type = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">true</span></span></span></span><span class="hljs-function"><span class="hljs-params"> )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>( ( val &lt;= <span class="hljs-number"><span class="hljs-number">-1</span></span> ) ? -val : val ); }</code> </pre> <br> ä»…ä¾›æ¯”è¾ƒ-C ++çš„ç°ä»£ç‰ˆæœ¬ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> T, IsSigned&lt; T &gt; = <span class="hljs-literal"><span class="hljs-literal">true</span></span> &gt; T myAbs( T val ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>( ( val &lt;= <span class="hljs-number"><span class="hljs-number">-1</span></span> ) ? -val : val ); }</code> </pre> <br>  C ++ 98ç‰ˆæœ¬å¾ˆä¸‘é™‹ï¼Œå¼•å…¥äº†æ— æ„ä¹‰çš„å‚æ•°ï¼Œä½†æ˜¯å®ƒå¯ä»¥å·¥ä½œ-å¦‚æœç»å¯¹å¿…è¦ï¼Œå¯ä»¥ä½¿ç”¨å®ƒã€‚ æ˜¯çš„ï¼šåº”è¯¥å®ç°<code>my_enable_if</code>å’Œ<code>my_is_signed</code> ï¼ˆ <code>std :: enable_if  std :: is_signed</code>åœ¨C ++ 11ä¸­æ˜¯æ–°çš„ï¼‰ã€‚ <br><br><h3> å½“å‰çŠ¶æ€ </h3><br>  C ++ 17å¼•å…¥äº†<code>if constexpr</code> ï¼Œè¿™æ˜¯ä¸€ç§åŸºäºç¼–è¯‘æ—¶çš„æ¡ä»¶ä¸¢å¼ƒä»£ç çš„æ–¹æ³•ã€‚  ifå’Œelseè¯­å¥åœ¨è¯­æ³•ä¸Šéƒ½å¿…é¡»æ­£ç¡®ï¼Œä½†æ˜¯æ¡ä»¶å°†åœ¨ç¼–è¯‘æ—¶è¿›è¡Œè¯„ä¼°ã€‚ <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> T &gt; <span class="hljs-function"><span class="hljs-function">T </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">myAbs</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( T val )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">if</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">constexpr</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::is_signed_v&lt; T &gt; )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>( ( val &lt;= <span class="hljs-number"><span class="hljs-number">-1</span></span> ) ? -val : val ); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">constexpr</span></span>( <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::is_unsigned_v&lt; T &gt; ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> val; } <span class="hljs-comment"><span class="hljs-comment">/*else { static_assert( false, "T must be signed or unsigned arithmetic type." ); }*/</span></span> } }</code> </pre> <br> æ­£å¦‚æˆ‘ä»¬æ‰€çœ‹åˆ°çš„ï¼Œæˆ‘ä»¬çš„absåŠŸèƒ½å˜å¾—æ›´åŠ ç´§å‡‘å’Œæ˜“äºé˜…è¯»ã€‚ ä½†æ˜¯ï¼Œä¸åˆæ ¼ç±»å‹çš„å¤„ç†å¹¶ä¸ç®€å•ã€‚  <code>static_assert</code>æ— æ¡ä»¶<code>static_assert</code>ä½¿å¾—è¯¥è¯­å¥çš„ä¸€è‡´æ€§å¾ˆå·®ï¼Œæ— è®ºè¯¥æ ‡å‡†æ˜¯å¦è¢«ä¸¢å¼ƒï¼Œè¯¥è¯­å¥éƒ½è¢«æ ‡å‡†ç¦æ­¢ã€‚ <br><br> å¹¸è¿çš„æ˜¯ï¼Œå­˜åœ¨æ¼æ´ï¼šåœ¨æ¨¡æ¿å¯¹è±¡ä¸­ï¼Œå¦‚æœæ¡ä»¶ä¸å€¼æ— å…³ï¼Œåˆ™ä¸ä¼šåˆ›å»ºåˆ é™¤çš„è¿ç®—ç¬¦ã€‚ å¤ªå¥½äº†ï¼ <br><br> å› æ­¤ï¼Œæˆ‘ä»¬çš„ä»£ç å”¯ä¸€çš„é—®é¢˜æ˜¯ï¼Œå®ƒåœ¨æ¨¡æ¿å®šä¹‰æœŸé—´å´©æºƒã€‚ å¦‚æœæˆ‘ä»¬å¯ä»¥å°†å¯¹<code>static_assert</code>çš„è¯„ä¼°æ¨è¿Ÿåˆ°åˆ›å»ºæ¨¡æ¿ä¹‹å‰ï¼Œé‚£ä¹ˆé—®é¢˜å°†å¾—åˆ°è§£å†³ï¼šå½“ä¸”ä»…å½“æˆ‘ä»¬æ‰€æœ‰æ¡ä»¶å‡ä¸ºfalseæ—¶ï¼Œæ‰ä¼šåˆ›å»ºè¯¥é—®é¢˜ã€‚ ä½†æ˜¯ï¼Œå¦‚ä½•åœ¨åˆ›å»ºæ¨¡æ¿ä¹‹å‰å°†<code>static_assert</code>æ¨è¿Ÿï¼Ÿ ä½¿å®ƒçš„æ¡ä»¶å–å†³äºç±»å‹ï¼ <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> &gt; <span class="hljs-keyword"><span class="hljs-keyword">inline</span></span> <span class="hljs-keyword"><span class="hljs-keyword">constexpr</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> dependent_false_v{ <span class="hljs-literal"><span class="hljs-literal">false</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> T &gt; <span class="hljs-function"><span class="hljs-function">T </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">myAbs</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( T val )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">if</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">constexpr</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::is_signed_v&lt; T &gt; )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>( ( val &lt;= <span class="hljs-number"><span class="hljs-number">-1</span></span> ) ? -val : val ); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">constexpr</span></span>( <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::is_unsigned_v&lt; T &gt; ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> val; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">static_assert</span></span>( dependent_false_v&lt; T &gt;, <span class="hljs-string"><span class="hljs-string">"Unsupported type"</span></span> ); } } }</code> </pre> <br><h3> å…³äºæœªæ¥ </h3><br> æˆ‘ä»¬å·²ç»å¾ˆæ¥è¿‘äº†ï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦ç­‰å¾…ä¸€ä¼šå„¿ï¼Œç›´åˆ°C ++ 20æå‡ºæœ€ç»ˆè§£å†³æ–¹æ¡ˆï¼šæ¦‚å¿µï¼ è¿™å°†å®Œå…¨æ”¹å˜æ¨¡æ¿ï¼ˆå’ŒSFINAEï¼‰çš„ä½¿ç”¨æ–¹å¼ã€‚ <br><br> ç®€è€Œè¨€ä¹‹ï¼šæ¦‚å¿µå¯ç”¨äºé™åˆ¶æ¨¡æ¿å‚æ•°æ¥å—çš„å‚æ•°é›†ã€‚ å¯¹äºabså‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ¦‚å¿µï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> T &gt; <span class="hljs-function"><span class="hljs-function">concept </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Arithmetic</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::is_arithmetic_v&lt; T &gt;; }</code> </pre> <br> ä»¥åŠæˆ‘ä»¬å¦‚ä½•ä½¿ç”¨æ¦‚å¿µï¼Ÿ æœ‰ä¸‰ç§æ–¹æ³•ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//   template&lt; typename T &gt; requires Arithmetic&lt; T &gt;() T myAbs( T val ); //   template&lt; Arithmetic T &gt; T myAbs( T val ); //  Arithmetic myAbs( Arithmetic val );</span></span></code> </pre> <br> è¯·æ³¨æ„ï¼Œç¬¬ä¸‰ç§å½¢å¼ä»ç„¶å£°æ˜äº†æ¨¡æ¿å‡½æ•°ï¼ è¿™æ˜¯C ++ 20ä¸­myAbçš„å®Œæ•´å®ç°ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> T &gt; <span class="hljs-function"><span class="hljs-function">concept </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Arithmetic</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::is_arithmetic_v&lt; T &gt;; } <span class="hljs-function"><span class="hljs-function">Arithmetic </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">myAbs</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( Arithmetic val )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">if</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">constexpr</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::is_signed_v&lt; </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">decltype</span></span></span></span><span class="hljs-function"><span class="hljs-params">( val ) &gt; )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>( ( val &lt;= <span class="hljs-number"><span class="hljs-number">-1</span></span> ) ? -val : val ); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> val; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> a{ myAbs( <span class="hljs-number"><span class="hljs-number">5u</span></span> ) }; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> b{ myAbs&lt; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> &gt;( <span class="hljs-number"><span class="hljs-number">5u</span></span> ) }; <span class="hljs-comment"><span class="hljs-comment">//std::string c{ myAbs( "d" ) }; }</span></span></code> </pre> <br> æ³¨é‡Šæ‰çš„å‘¼å«äº§ç”Ÿä»¥ä¸‹é”™è¯¯ï¼š <br><br><pre> <code class="cpp hljs">error: cannot call function <span class="hljs-string"><span class="hljs-string">'auto myAbs(auto:1) [with auto:1 = const char*]'</span></span> constraints <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> satisfied within <span class="hljs-string"><span class="hljs-string">'template&lt;class T&gt; concept bool Arithmetic() [with T = const char*]'</span></span> <span class="hljs-function"><span class="hljs-function">concept </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Arithmetic</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ ^~~~~~~~~~ <span class="hljs-string"><span class="hljs-string">'std::is_arithmetic_v'</span></span> evaluated to <span class="hljs-literal"><span class="hljs-literal">false</span></span></code> </pre> <br> æˆ‘æ•¦ä¿ƒæ¯ä¸ªäººåœ¨ç”Ÿäº§ä»£ç ä¸­å¤§èƒ†ä½¿ç”¨è¿™äº›æ–¹æ³•ï¼›ç¼–è¯‘æ—¶é—´æ¯”è¿è¡Œæ—¶ä¾¿å®œã€‚ ç¥æ‚¨ç”Ÿæ—¥å¿«ä¹ï¼ </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN466915/">https://habr.com/ru/post/zh-CN466915/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN466899/index.html">ä¸ºä»€ä¹ˆç°åœ¨æ”¾å¼ƒæ‰€æœ‰å†…å®¹å¹¶å­¦ä¹ Swiftå’ŒKotlin</a></li>
<li><a href="../zh-CN466903/index.html">æ€»æ˜¯å±•ç¤ºä½ çš„ä½œå“</a></li>
<li><a href="../zh-CN466905/index.html">å…³äºU-Bootçš„é—®é¢˜</a></li>
<li><a href="../zh-CN466907/index.html">5Gå’ŒWiFi 6ï¼šä¸¤ç§ç½‘ç»œæŠ€æœ¯æ¯”ä¸€ç§æ›´å¥½</a></li>
<li><a href="../zh-CN466911/index.html">ç¾å›½æ³•é™¢å®Œå…¨åˆæ³•åœ°è¿›è¡Œç½‘ç«™æŠ“å–å¹¶ç¦æ­¢å…¶ä»æŠ€æœ¯ä¸Šé˜»æ­¢</a></li>
<li><a href="../zh-CN466917/index.html">å½“HTTPæ ‡å‡†è¿˜ä¸å¤Ÿçš„æ—¶å€™ã€‚ Micronautæäº¤</a></li>
<li><a href="../zh-CN466921/index.html">ä½¿ç”¨è‡ªåŠ¨åŒ–å¹³å°çš„ä»»ä½•æœåŠ¡å…¬å¸çš„5ä¸ªé—®é¢˜åŠå…¶è§£å†³æ–¹æ¡ˆ</a></li>
<li><a href="../zh-CN466923/index.html">å¦‚ä½•åœ¨å¤–å›½é“¶è¡Œä¸­å‘ITä¸“ä¸šäººå£«è¯æ˜èµ„é‡‘æ¥æº</a></li>
<li><a href="../zh-CN466925/index.html">å¦‚ä½•è¿è¡ŒBitrixçš„Hi-CPU VDSï¼Œåˆ†æ•£é¹¦é¹‰è€Œä¸å</a></li>
<li><a href="../zh-CN466929/index.html">æ·»åŠ åˆ·æ–°ä»¤ç‰Œ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>