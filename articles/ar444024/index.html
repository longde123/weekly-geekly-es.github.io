<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ธ ๐ข ๐ง ููููุฉ ุชุทุจูู ูุบุฉ ุงูุจุฑูุฌุฉ ูู ุฌุงูุง ุณูุฑูุจุช. ุงูุฌุฒุก 3: CPS ูุชุฑุฌู ๐คฌ ๐ฉ๐ปโโ๏ธ ๐คน๐ฝ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ูุฑุญุจุง ุฃูุฏู ุฅูููู ุงูุฌุฒุก ุงูุซุงูุซ ูู ุชุฑุฌููู ููุฏููู ูุชุทุจูู ูุบุฉ ุจุฑูุฌุฉ ุฌุงูุง ุณูุฑูุจุช ุงูุฎุงุตุฉ ุจู - ุงูุจุฑูุงูุฌ ุงูุชุนูููู PL . 
 ูู ุงููุชุฑุฌู 


 ุณูููู ุจุฅูุดุงุก ูุบุฉ ุงูุจุฑู...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ููููุฉ ุชุทุจูู ูุบุฉ ุงูุจุฑูุฌุฉ ูู ุฌุงูุง ุณูุฑูุจุช. ุงูุฌุฒุก 3: CPS ูุชุฑุฌู</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/444024/" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  ูุฑุญุจุง  ุฃูุฏู ุฅูููู ุงูุฌุฒุก ุงูุซุงูุซ ูู ุชุฑุฌููู ููุฏููู ูุชุทุจูู ูุบุฉ ุจุฑูุฌุฉ ุฌุงูุง ุณูุฑูุจุช ุงูุฎุงุตุฉ ุจู - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูุจุฑูุงูุฌ ุงูุชุนูููู PL</a> . </p><br><h1 id="ot-perevodchika" style=";text-align:right;direction:rtl">  ูู ุงููุชุฑุฌู </h1><br><p style=";text-align:right;direction:rtl">  ุณูููู ุจุฅูุดุงุก ูุบุฉ ุงูุจุฑูุฌุฉ ุงูุฎุงุตุฉ ุจูุง - ((ุจุงููุบุฉ ุงูุฃุตููุฉ - ฮปanguage).  ูู ุนูููุฉ ุงูุฅูุดุงุก ุ ุณูุณุชุฎุฏู ุงููุซูุฑ ูู ุงูุชูููุงุช ุงููุซูุฑุฉ ููุงูุชูุงู ุ ูุซู ุงููุณุจ ุงูุนูุฏูุฉ ูููุท ููู ุงูุชุญูู ูุชูููุงุช ุงูุชุญุณูู ุงูุฃุณุงุณูุฉ.  ุณูุชู ุฅูุดุงุก ูุณุฎุชูู ูู ุงููุชุฑุฌู ุงูุดููู - ุงููุชุฑุฌููู ุงูุนุงุฏููู ูุงููุชุฑุฌููู ุงูููุฑููู CPS ุ ุงููุชุฑุฌู ุงูุดููู ูู JavaScript. </p><br><p style=";text-align:right;direction:rtl">  ูุคูู ุงููุณุฎุฉ ุงูุฃุตููุฉ ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Mihai Bazon</a> ุ ูุคูู ููุชุจุฉ UglifyJS ุงูุดููุฑุฉ (ุฃุฏุงุฉ ูุชูููู ูุชูุณูู ุฑูุฒ JS). </p><a name="habracut"></a><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุงููุญุชููุงุช</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููููุฉ ุชุทุจูู ูุบุฉ ุงูุจุฑูุฌุฉ ูู ุฌุงูุง ุณูุฑูุจุช.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูุฌุฒุก 1: ุงููุญูู ุงููุบูู</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููููุฉ ุชุทุจูู ูุบุฉ ุงูุจุฑูุฌุฉ ูู ุฌุงูุง ุณูุฑูุจุช.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูุฌุฒุก 2: ูุชุฑุฌู</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููููุฉ ุชุทุจูู ูุบุฉ ุงูุจุฑูุฌุฉ ูู ุฌุงูุง ุณูุฑูุจุช.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูุฌุฒุก 3: CPS ูุชุฑุฌู</a> </li><li style=";text-align:right;direction:rtl">  ููููุฉ ุชุทุจูู ูุบุฉ ุงูุจุฑูุฌุฉ ูู ุฌุงูุง ุณูุฑูุจุช.  ุงูุฌุฒุก 4: ุชุฑุฌูุฉ ุนุจุฑ ูู JS </li></ol></div></div><br><p style=";text-align:right;direction:rtl"> ููุงุญุธุฉ: ููุฌุฏ ุฎุทุฃ ูู ุงููุชุฑุฌู ูุงููุชุฑุฌู: ูู ุงูุชุนุจูุฑุงุช ูุซู <code>a() &amp;&amp; b()</code> ุฃู <code>a() || b()</code>  <code>a() || b()</code> ูุชู ุชูููุฐ ููุง ุงูุฌุฒุฃูู ุฏุงุฆููุง.  ูุฐุง ุ ุจุงูุทุจุน ุ ุฎุงุทุฆ ูุฃู <code>a()</code> ุฎุทุฃ ูู <code>&amp;&amp;</code> ุนุงูู ุงูุชุดุบูู ุ ุฃู ุบูุฑ ุตุญูุญ ูู <code>||</code>  ุ ุซู ูุง ุชูุนุจ ูููุฉ <code>b()</code> ุฃู ุฏูุฑ.  ูุฐุง ููุณ ูู ุงูุตุนุจ ุฅุตูุงุญู. </p><br><h1 id="cps-interpretator" style=";text-align:right;direction:rtl">  CPS ูุชุฑุฌู </h1><br><p style=";text-align:right;direction:rtl">  ูุบุชูุง has ููุง ุนูุจุงู: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ููุชุตุฑ ุงูุนูุฏูุฉ ุนูู ููุฏุณ JS ุ ูุฐูู ููุณ ูุฏููุง ุทุฑููุฉ ุทุจูุนูุฉ ููููุงู ุจุญููุงุช. </li><li style=";text-align:right;direction:rtl">  ุงููุชุฑุฌู ุจุทูุก ุ ูุฐูู ุงูุนูุฏูุฉ ุจุทูุฆุฉ ููุบุงูุฉ. </li></ul><br><p style=";text-align:right;direction:rtl">  ุงูุขู ุณูููู ุจุชุตุญูุญ ุงูุฎูู ุงูุฃูู ุฏูู ุงูุงูุชุจุงู ุฅูู ุญูููุฉ ุฃู ุงููุชุฑุฌู ุงูููุฑู ุณูู ูุตุจุญ ุฃุจุทุฃ.  ุณูููู ุจุฅุนุงุฏุฉ ูุชุงุจุฉ ุงููุชุฑุฌู ุงูููุฑู ุจุฃุณููุจ "ููุท ุงูุชูุฑูุฑ ุงููุณุชูุฑ" (CPS). </p><br><h2 id="chto-takoe-peredacha-prodolzheniya" style=";text-align:right;direction:rtl">  ูุง ูู "ุงูููู ุงููุณุชูุฑ" </h2><br><p style=";text-align:right;direction:rtl">  ููููู ุงูููุงู ุจุฐูู ูู NodeJS ุทูุงู ุงูููุช: </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs">fs.readFile(<span class="hljs-string"><span class="hljs-string">"file.txt"</span></span>, <span class="hljs-string"><span class="hljs-string">"utf8"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CC</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">error, data</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-comment"><span class="hljs-comment">//   - "" //     'return', // 'readFile'  ,  . });</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ูู ูู ุฎุทูุฉ ููุฌุฏ ุฑุฏ ุงุชุตุงู ูุชู ุงูุงุชุตุงู ุจู ุนูุฏูุง ุชุญุชุงุฌ ุฅูู ุงููุชุงุจุนุฉ.  ูุฌุนู ููุท ุงูููู ุงููุณุชูุฑ ููู ุงูุชุญูู "ุตุฑูุญูุง" - ูุง ุชุณุชุฎุฏู <code>return</code> ุฃู <code>throw</code> ุฃู <code>break</code> ุฃู ุงููุชุงุจุนุฉ.  ูุง ุชูุฌุฏ ุงูููุฒุงุช ุงูุถูููุฉ ูู ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ.  ูุง ููููู ุญุชู ุงุณุชุฎุฏุงู ุฃู <code>while</code> ุญููุงุช ูุน ูุธุงุฆู ุบูุฑ ูุชุฒุงูู.  ูู ูุฐู ุงูุญุงูุฉ ุ ููุงุฐุง ูุญุชุงุฌูุง ูู ูุบุฉ ุงูุจุฑูุฌุฉุ </p><br><p style=";text-align:right;direction:rtl">  ูู ุงูุตุนุจ ูุณูู ุงุฑุชูุงุจ ุฃุฎุทุงุก ูุชุงุจุฉ ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ุจุฃุณููุจ ุฅุฑุณุงู ุงุณุชูุฑุงุฑูุฉ ุ ููููุง ูู ูุนูุฏ ูุชุงุจุฉ ุงููุชุฑุฌู ุงูุดููู ุฅูุง ุจูุฐุง ุงูููุท. </p><br><h2 id="funkciya-evaluate" style=";text-align:right;direction:rtl">  <code>evaluate</code> ุงููุธููุฉ </h2><br><p style=";text-align:right;direction:rtl">  ุณุชุชููู ุฏุงูุฉ <code>evaluate</code> ุซูุงุซ ูุณุงุฆุท: ุชุนุจูุฑ (AST) ุ ุณูุงู (ุจูุฆุฉ) ุ ูุงูุฏุงูุฉ ุงูุชู ุณูุชู ุงุณุชุฏุนุงุคูุง ุนูุฏูุง ุชููู ุงููุชูุฌุฉ.  ููุง ูู ุงูููุฏ ุ ููู ุฌุฒุก ููุงู ุชูุณูุฑ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">evaluate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">exp, env, callback</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (exp.type) {</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุจุงููุณุจุฉ ููุซูุงุจุช ุ ุณูุนูุฏ ููุท ุฅูู ูููุชูุง.  ููู ุชุฐูุฑ ุฃูู ููุณ ูุฏููุง <code>return</code> - ุจู ูุฏุนู ููุท ุฑุฏ ุงูุงุชุตุงู ููููู ุงููููุฉ. </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"num"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"str"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"bool"</span></span>: callback(exp.value); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>;</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงูุนูุฏุฉ <code>var</code> ุจุณูุทุฉ ุฃูุถูุง - ุงุญุตู ุนูู ุงููุชุบูุฑ ูู ุงูุณูุงู ููู ุจุชูุฑูุฑู ุฅูู ุงููุธููุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"var"</span></span>: callback(env.get(exp.value)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>;</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุจุงููุณุจุฉ ุฅูู <code>assign</code> ุงูุนูุฏ ุ ูุญุชุงุฌ ุฅูู ุงูุญุตูู ุนูู ูููุฉ ุงูุชุนุจูุฑ ุงูุฃูุณุฑ ( <code>right</code> ).  ููููุงู ุจุฐูู ุ ูุฏุนู <code>evaluate</code> ุ ูููุฑ ูู ูุธููุฉ ุณูู ุชุญุตู ุนูู ุงููุชูุฌุฉ (ุนูู ุงูุฌุงูุจ ุงูุฃููู ูู ุงูุชุนุจูุฑ).  ุซู ูุฏุนู <code>callback</code> ูุน ุงููููุฉ ุงููุชุบูุฑุฉ ุ ููุถุน ุงููุชุบูุฑ ูู ุงูุณูุงู ุงูุญุงูู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"assign"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (exp.left.type != <span class="hljs-string"><span class="hljs-string">"var"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Error</span></span>(<span class="hljs-string"><span class="hljs-string">"Cannot assign to "</span></span> + <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify(exp.left)); evaluate(exp.right, env, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">right</span></span></span><span class="hljs-function">)</span></span>{ callback(env.set(exp.left.value, right)); }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>;</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุชูุฑูุจูุง ููุณ ุงูุดูุก ุจุงููุณุจุฉ ุฅูู ุงูุนูุฏ ูู ุงูููุน <code>binary</code> ุ ูููู ููุง ูุญุชุงุฌ ุฃููุงู ุฅูู ุงูุญุตูู ุนูู ูููุฉ ุงูุญูู <code>left</code> ุ ูุนูุฏูุง ููุท ูููุฉ ุงูุญูู <code>right</code> .  ุซู ูุฏุนู ููุท ุฑุฏ ุงูุงุชุตุงู ุ ูุชูุฑูุฑ ูุชูุฌุฉ ุงูุนูููุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"binary"</span></span>: evaluate(exp.left, env, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">left</span></span></span><span class="hljs-function">)</span></span>{ evaluate(exp.right, env, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">right</span></span></span><span class="hljs-function">)</span></span>{ callback(apply_op(exp.operator, left, right)); }); }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>;</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุชุจุฏู ุนูุฏุฉ <code>let</code> ุฃูุซุฑ ุชุนููุฏูุง ุ ููููุง ูู ุงูุญูููุฉ ุจุณูุทุฉ.  ูุฏููุง ุจุนุถ ุงููุชุบูุฑุงุช.  ูุฏ ูููู ุญูู <code>def</code> (ุงููููุฉ ุงูุฃูููุฉ) ูุงุฑุบูุง ุ ููู ูุฐู ุงูุญุงูุฉ ุณูููู ุจุชุนูููู ุนูู <code>false</code> .  ูููู ุฅุฐุง ูุงูุช ููุงู ูููุฉ ุ ูุนูููุง ุฃู ูุฏุนู ุฅูู <code>evaluate</code> ุจุดูู ูุชูุฑุฑ ููุญุตูู ุนููู. </p><br><p style=";text-align:right;direction:rtl">  ุฅุฐุง ููุช ูุฏ ุนููุช ูุน NodeJS ูู ูุจู ุ ููุฏ ููุช ุจุฐูู ุนุฏุฉ ูุฑุงุช ูู ูุจู.  ุจุณุจุจ ุนูููุงุช ุงูุงุณุชุฑุฌุงุนุงุช ุ ูุง ูููููุง ุงุณุชุฎุฏุงู ุ ูุฐูู ุ ูุฌุจ ุนูููุง ุชูุณูุฑ ูุฐู ุงูุชุนุจูุฑุงุช ูุงุญุฏูุง ุชูู ุงูุขุฎุฑ (ุชุฎูู ุฃู ูุธููุฉ <code>evaluate</code> ุบูุฑ ูุชุฒุงููุฉ).  ุชุญุตู ุงูุฏุงูุฉ <code>loop</code> ุฃุฏูุงู (ุชุณูู ููุฑูุง) ุนูู ุงูุณูุงู ูุฑูู ุงูุชุนุฑูู ุงูุฐู ูุฌุจ ูุนุงูุฌุชู: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุฅุฐุง ูุงู ูุฐุง ุงูุฑูู ูุณุงูู ุนุฏุฏ ุงููุชุบูุฑุงุช ( <code>vars.length</code> ) ุ ููุฐุง ูุนูู ุฃููุง ูุฏ ุญุฏุฏูุง ุจุงููุนู ูู ุงูุชุนุจูุฑุงุช ุญุชู ูุชููู ูู ุชูููุฐ ูุต ุงูุชุนุจูุฑ.  ูุฑุฌู ููุงุญุธุฉ ุฃููุง ูุฐู ุงููุฑุฉ ูุง ูุฏุนู <code>callback</code> ุ ูููู ูุฌุญ ูู <code>evaluate</code> ุ ูุงูุฐู ุณูู ูุณูููุง ุจุนุฏ ุฐูู. </li><li style=";text-align:right;direction:rtl">  ุฅุฐุง ูุงู ูุฐุง ุงูุฑูู ุฃูู ุ ูุฃูุช ุจุญุงุฌุฉ ุฅูู ุญุณุงุจ ุงูุชุนุฑูู ุงูุญุงูู ูุชูุฑูุฑ ูุธููุฉ ุชุณุชุฏุนู <code>loop(scope, i + 1)</code> ุ ูุจู ูุณุฎ ุงูุณูุงู. <br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"let"</span></span>: (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loop</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">env, i</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (i &lt; exp.vars.length) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> v = exp.vars[i]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (v.def) evaluate(v.def, env, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">value</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> scope = env.extend(); scope.def(v.name, value); loop(scope, i + <span class="hljs-number"><span class="hljs-number">1</span></span>); }); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> scope = env.extend(); scope.def(v.name, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); loop(scope, i + <span class="hljs-number"><span class="hljs-number">1</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { evaluate(exp.body, env, callback); } })(env, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>;</code> </pre> </li></ul><br><p style=";text-align:right;direction:rtl">  ุณุชุชู ูุนุงูุฌุฉ ุนูุฏุฉ <code>lambda</code> ูู ูุธููุฉ ูููุตูุฉ ุ ููุง ูุงู ูู ูุจู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"lambda"</span></span>: callback(make_lambda(env, exp)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>;</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูู ุฃุฌู ุชูุณูุฑ <code>if</code> ุ ูุญู ุฃููุงู ุชูุณูุฑ ุงูุดุฑุท.  ุฅุฐุง ูู ุชูู ุฎุงุทุฆุฉ ุ ูุณููุณุฑ ุชุนุจูุฑ "ูู <code>then</code> ุ ููู ุญุงูุฉ ุฃุฎุฑู ุ ููุณุฑ <code>else</code> ุฅุฐุง ูุงู ููุงู ุชุนุจูุฑ ุ ุฃู ูุฑุฌุน <code>false</code> ุฅู ูู ููู.  ููุง ูุงู ูู ูุจู ุ ูู <code>then</code> ุ <code>else</code> ุ ูุฅููุง ูุนุจุฑ ุนู <code>callback</code> ุฃูู "ุฅุฌุฑุงุก ูุฌุจ ุงูููุงู ุจู ุจุนุฏ ุชูููุฐ" ุงูุชุนุจูุฑ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"if"</span></span>: evaluate(exp.cond, env, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">cond</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cond !== <span class="hljs-literal"><span class="hljs-literal">false</span></span>) evaluate(exp.then, env, callback); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (exp.else) evaluate(exp.else, env, callback); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> callback(<span class="hljs-literal"><span class="hljs-literal">false</span></span>); }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>;</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุชู ุชูุณูุฑ ุนูุฏุฉ <code>prog</code> ุจุดูู ูุดุงุจู ูุนูุฏุฉ <code>let</code> ุ ูููู ูุน ุงุฎุชูุงู ุฃููุง ูุณูุง ุจุญุงุฌุฉ ููุณุฎ ุงูุณูุงู ุฃู ุชุญุฏูุฏ ุงููุชุบูุฑุงุช.  ููุฑุฉ ุฃุฎุฑู ุ ูุฏููุง ูุธููุฉ <code>loop</code> ุชุฃุฎุฐ ุฑูู ุชุนุจูุฑ.  ุนูุฏูุง ุชููู ูุณุงููุฉ ูู <code>prog.length</code> ุ ูุฅููุง ูุฏ ุฃููููุง ุฌููุน ุงูุชุนุจูุฑุงุช <code>prog.length</code> ุจุจุณุงุทุฉ ูุชูุฌุฉ ุงูุชุนุจูุฑ ุงูุฃุฎูุฑ (ุจูููุฉ "return" ุฃุนูู ุฃููุง ูุฏุนู <code>callback</code> ุจู).  ูุฑุฌู ููุงุญุธุฉ ุฃููุง ูุชุฐูุฑ ุงููููุฉ ุงูุฃุฎูุฑุฉ ูู ุฎูุงู ุชูุฑูุฑูุง ููุณูุทุฉ ุฅูู ูุธููุฉ <code>loop</code> (ูู ุงูุจุฏุงูุฉ ุ ุชููู <code>false</code> ููุญุงูุฉ ุนูุฏูุง ูููู ุงูุฌุณู ูุงุฑุบูุง): </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"prog"</span></span>: (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loop</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">last, i</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (i &lt; exp.prog.length) evaluate(exp.prog[i], env, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">val</span></span></span><span class="hljs-function">)</span></span>{ loop(val, i + <span class="hljs-number"><span class="hljs-number">1</span></span>); }); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { callback(last); } })(<span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>;</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููุญุตูู ุนูู ุนูุฏุฉ ูู ุงูููุน <code>call</code> ูุญุชุงุฌ ุฅูู ุชูุณูุฑ <code>func</code> ููู ุซู ูุชู ุชุฑุชูุจ ุฌููุน ุงููุณุงุฆุท.  ููุฑุฉ ุฃุฎุฑู ุ ููุงู ูุธููุฉ <code>loop</code> ุชุนูู ุนูู ููุณ ุงููุจุฏุฃ ูุซู <code>let</code> ุฃู <code>prog</code> ุ ูุน ุงูุงุฎุชูุงู ุงูุฐู ุชููู ุจู ุงูุขู ุจุฅูุดุงุก ุตููู ูุชูุฌุฉ ูุฐูู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"call"</span></span>: evaluate(exp.func, env, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">func</span></span></span><span class="hljs-function">)</span></span>{ (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loop</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">args, i</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (i &lt; exp.args.length) evaluate(exp.args[i], env, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">arg</span></span></span><span class="hljs-function">)</span></span>{ args[i + <span class="hljs-number"><span class="hljs-number">1</span></span>] = arg; loop(args, i + <span class="hljs-number"><span class="hljs-number">1</span></span>); }); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { func.apply(<span class="hljs-literal"><span class="hljs-literal">null</span></span>, args); } })([ callback ], <span class="hljs-number"><span class="hljs-number">0</span></span>); }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>;</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุญุณููุง ุ ุงูููุงูุฉ ุงูููุงุณูุฉ: ุฅุฐุง ููุง ูุง ูุนุฑู ูุง ูุฌุจ ูุนูู ุ ูุนููู ุงุณุชุซูุงุก: </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Error</span></span>(<span class="hljs-string"><span class="hljs-string">"I don't know how to evaluate "</span></span> + exp.type); } }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุฏ ุชูุงุญุธ ุฃู ูู <code>case</code> ุฃุนูุงู ุชูุชูู ุจูููุฉ <code>return</code> .  ูููู ูุง ุชูุฌุฏ ูููุฉ ูุนุงุฏุฉ - ูุชู ุชูุฑูุฑ ุงููุชูุฌุฉ ุฏุงุฆููุง ุฅูู ูุธููุฉ <code>callback</code> . </p><br><h3 id="novaya-funkciya-make_lambda" style=";text-align:right;direction:rtl">  ูุธููุฉ ุฌุฏูุฏุฉ <code>make_lambda</code> </h3><br><p style=";text-align:right;direction:rtl">  ูู ูุฐุง ุงููุชุฑุฌู ุ ุณุชุชููู ุฌููุน ุงููุธุงุฆู "ุงุณุชูุฑุงุฑ" ูุญุฌุฉ ุฃููู - ุงููุธููุฉ ุงูุชู ูุฌุจ ุฃู ูุณูููุง ูุชูุฑูุฑ ุงููุชูุฌุฉ.  ุจุนุฏ ุฐูู ูู ุงูุญุฌุฌ ุงููุนุชุงุฏุฉ ููุฐู ุงููุธููุฉ.  ุฅููู ุงูุฑูุฒ ุงูุฌุฏูุฏ ููุธููุฉ <code>make_lambda</code> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">make_lambda</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">env, exp</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (exp.name) { env = env.extend(); env.def(exp.name, lambda); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">lambda</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">callback</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> names = exp.vars; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> scope = env.extend(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; names.length; ++i) scope.def(names[i], i + <span class="hljs-number"><span class="hljs-number">1</span></span> &lt; <span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>.length ? <span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>[i + <span class="hljs-number"><span class="hljs-number">1</span></span>] : <span class="hljs-literal"><span class="hljs-literal">false</span></span>); evaluate(exp.body, scope, callback); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> lambda; }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงูู ูุง ูุฎุชูู ูุซูุฑุง.  ูุถูู ูุชุบูุฑุงุช ุฌุฏูุฏุฉ ุฅูู ุณูุงู ุฌุฏูุฏ.  ุฃูุถูุง ุ ูุฌุจ ุฃู ูุนุชุจุฑ ุฃู ุงููุณูุทุฉ ุงูุฃููู ูู <code>callback</code> .  ุฃุฎูุฑูุง ุ ูุชู ุงุณุชุฎุฏุงู ุฏุงูุฉ <code>evaluate</code> ูุชูููุฐ ุฑูุฒ ุงููุธููุฉ ูู ุณูุงู ุฌุฏูุฏ ุ ูููู ููุง ุญุฏุซ ูู ูุจู ุ ูููู ุจุชูุฑูุฑ <code>callback</code> . </p><br><p style=";text-align:right;direction:rtl">  ุจุงูููุงุณุจุฉ ุ ูุฐุง ูู ุงูููุงู ุงููุญูุฏ ุงูุฐู ุงุณุชุฎุฏูุช ููู ุงูุญููุฉ.  ูุฐุง ูุฃูู ูุชู ุญุณุงุจ ููู ุงููุณูุทุฉ ุจุงููุนู ุนูุฏ ูุนุงูุฌุฉ ุนูุฏุฉ <code>call</code> . </p><br><h2 id="nativnye-funkcii" style=";text-align:right;direction:rtl">  ูุธุงุฆู ูุญููุฉ </h2><br><p style=";text-align:right;direction:rtl">  ูู ูุฐุง ุงููุชุฑุฌู ุ ุชุชููู ุงูุฏุงูุงุช ุงูุฃุตููุฉ <code>callback</code> ูุงููุณูุทุฉ ุงูุฃููู.  ูุฌุจ ุฃู ูุชุฐูุฑ ูุฐุง ุนูุฏูุง ูุญุฏุฏ ูุธุงุฆู ุงูุฃุตูู.  ูููุง ููู ูููุฐุฌ ุงูุชุนูููุฉ ุงูุจุฑูุฌูุฉ ูููุชุฑุฌู ุงูุฌุฏูุฏ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> code = <span class="hljs-string"><span class="hljs-string">"sum = lambda(x, y) x + y; print(sum(2, 3));"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ast = parse(TokenStream(InputStream(code))); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> globalEnv = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Environment(); <span class="hljs-comment"><span class="hljs-comment">// define the "print" primitive function globalEnv.def("print", function(callback, txt){ console.log(txt); callback(false); // call the continuation with some return value // if we don't call it, the program would stop // abruptly after a print! }); // run the evaluator evaluate(ast, globalEnv, function(result){ // the result of the entire program is now in "result" });</span></span></code> </pre> <br><h2 id="malenkiy-test" style=";text-align:right;direction:rtl">  ุงุฎุชุจุงุฑ ููููุง </h2><br><p style=";text-align:right;direction:rtl">  ุฏุนูุง ูุญุงูู ุญุณุงุจ ุฃุฑูุงู ููุจููุงุชุดู ูุฑุฉ ุฃุฎุฑู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs">fib = ฮป(n) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> n &lt; <span class="hljs-number"><span class="hljs-number">2</span></span> then n <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> fib(n - <span class="hljs-number"><span class="hljs-number">1</span></span>) + fib(n - <span class="hljs-number"><span class="hljs-number">2</span></span>); time( ฮป() println(fib(<span class="hljs-number"><span class="hljs-number">10</span></span>)) );</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูููู ุ ุฅุฐุง ุญุงูููุง ุฅูุฌุงุฏ ุงูุฑูู 27 ุ ูุณูุญุตู ุนูู ุชุฌุงูุฒ ุณุนุฉ ููุฏุณ.  ุจุดูู ุนุงู ุ ุชููู ุงูููุฏุณ ุงูุขู ุจุดูู ุฃุณุฑุน ุจูุซูุฑ ุ ูุฐุง ุงุชุถุญ ุฃูู ูุง ูููููุง ุงูุขู ุญุณุงุจ ุนุฏุฏ Fibonacci ุฅูุง ูู ุงูุซุงูู ุนุดุฑ (ุนูู ุงูุฃูู ูู ูุชุตูุญู).  ูุฐุง ููุณ ุฌูุฏูุง ุฌุฏูุง ุ ูุฐูู ุชุญุชุงุฌ ุฅูู ุฅุตูุงุญู ุจุทุฑููุฉ ุฃู ุจุฃุฎุฑู. </p><br><h1 id="zaschischaem-stek" style=";text-align:right;direction:rtl">  ูุญู ูุญูู ุงูููุฏุณ </h1><br><p style=";text-align:right;direction:rtl">  ูู ูุชุฑุฌู CPS ุ ูููู ุงูููุฏุณ ุจุดูู ุฃุณุฑุน ูุฃู ุงููุชุฑุฌู ุงูุดููู ูุณุชุฏุนู ุฏุงุฆููุง ุงููุธุงุฆู ุจุดูู ูุชูุฑุฑ ุ ููุง ููุฑุฌุน ุงููุชูุฌุฉ ุฃุจุฏูุง.  ุฑุบู ุฃููุง ุนุฏูุง ุฅูู ุงููุชุฑุฌู ุงูููุฑู ุ ุฅูุง ุฃููุง ูุญุชุงุฌ ุฅูููู ุ ููู ูู ุญุงูุฉ ุงูุนูุฏูุฉ ุงูุนูููุฉ ุฌุฏูุง ุ ูู ูุชููู ูู ุงููุตูู ุฅูููู ุฃุจุฏูุง. </p><br><p style=";text-align:right;direction:rtl">  ุฏุนูุง ูุชุฎูู ููู ูุจุญุซ ูุฌููุนุชูุง ุนู ุจุฑูุงูุฌ ุจุณูุท ููุบุงูุฉ.  ุณุฃุนุฑุถ ุงูููุฏ ุงูุฒุงุฆู ููู <code>env</code> ุจุฅุถุงูุฉ <code>env</code> ูุฃูู ูุง ููุนุจ ุฃู ุฏูุฑ ููุง: </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs">print(<span class="hljs-number"><span class="hljs-number">1</span></span> + <span class="hljs-number"><span class="hljs-number">2</span></span> * <span class="hljs-number"><span class="hljs-number">3</span></span>); <span class="hljs-comment"><span class="hljs-comment">## : evaluate( print(1 + 2 * 3), K0 ) evaluate( print, K1 ) K1(print) #  'var',      evaluate( 1 + 2 * 3, K2 ) evaluate( 2 * 3, K3 ) evaluate( 2, K4 ) K4(2) # 2  ,      evaluate( 3, K5 ) #    3,      K5(3) K3(6) #  2*3 evaluate( 1, K6 ) #  ,  K6(1) K2(7) #  1+2*3 print(K0, 7) # ,     'print' K0(false) #  . 'print'  'false'.</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ููุท ุจุนุฏ ุขุฎุฑ ููุงููุฉ ุ ูุฅู ุณูุณูุฉ ุทูููุฉ ูู <code>return</code> ุนุฏููุฉ ุงููุงุฆุฏุฉ ุชููู ูู ุงูุฑุตุฉ.  ุฅุฐุง ุงุณุชุฎุฏููุง ูุณุงุญุฉ ูุจูุฑุฉ ูู ุงูููุฏุณ ูุจุฑูุงูุฌ ุจุณูุท ุ ููู ุงูุตุนุจ ุชุฎูู ูุง ุณูุญุฏุซ ูู <code>fib(13)</code> . </p><br><h2 id="zaschita-steka" style=";text-align:right;direction:rtl">  ุญูุงูุฉ ุงูููุฏุณ </h2><br><p style=";text-align:right;direction:rtl">  ูู ูุชุฑุฌููุง ุงูุฌุฏูุฏ ุ ุจุจุณุงุทุฉ ููุณุช ููุงู ุญุงุฌุฉ ุฅูู ูููุฉ.  ูู ูุง ูุฌุจ ุงูููุงู ุจู ุจุนุฏ ุญุฏูุซ ุจุนุถ ุงูุชุนุจูุฑ ูู <code>callback</code> ุ ูุงูุฐู ูุชู ุชูุฑูุฑู ููุณูุทุฉ.  ุฅุฐู ูุฏููุง ููุง ุณุคุงู: ูุงุฐุง ูู ูููู JavaScript ูู "ุชูุฑูุบ" ุงูููุฏุณ.  ุซู ูููููุง ุฅุณูุงุท ุงูููุฏุณ ุ ูุณูุนูู ุงูุฅุนุงุฏุฉ ุงูุนูููุฉ ุจูุง ุญุฏูุฏ. </p><br><p style=";text-align:right;direction:rtl">  ุฏุนููุง ูุชุฎูู ุฃู ูุฏููุง ูุธููุฉ <code>GUARD</code> ูููููุง ุงูููุงู ุจุฐูู.  ูุญุตู ุนูู ูููุชูู: ุงููุธููุฉ ุงูุชู ูุฌุจ ุงูุงุชุตุงู ุจูุง ุ ูุงูุญุฌุฌ ุงูุชู ูุฌุจ ุฃู ูุชู ุชูุฑูุฑูุง.  ูุชุญูู: ุฅุฐุง ูุงูุช ุงูุญุฒูุฉ ููุฏุณุฉ ููุบุงูุฉ ุ ูุณูู ุชููู ุจูุณุญ ุงูููุฏุณ ูุงุณุชุฏุนุงุก ุงููุธููุฉ ุงูุชู ุชู ุชูุฑูุฑูุง.  ูู ุญุงูุฉ ุฃุฎุฑู ุ ูุง ุชูุนู ุดูุฆูุง. </p><br><p style=";text-align:right;direction:rtl">  ุจุงุณุชุฎุฏุงู ุงููุธููุฉ ุงูุฌุฏูุฏุฉ ุ ูุนูุฏ ูุชุงุจุฉ ุงููุชุฑุฌู ุงูููุฑู ููุง ูู ููุถุญ ุฃุฏูุงู.  ูู ุฃุนูู ุนูู ูู ุญุงูุฉ ุนูู ุญุฏุฉ ุ ูููุงู ุงูููุฏ ุงูุฐู ุชู ูุตูู ูุณุจููุง ุ ูููู ุจุงุณุชุฎุฏุงู ูุธููุฉ <code>GUARD</code> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">evaluate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">exp, env, callback</span></span></span><span class="hljs-function">) </span></span>{ GUARD(evaluate, <span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (exp.type) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"num"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"str"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"bool"</span></span>: callback(exp.value); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"var"</span></span>: callback(env.get(exp.value)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"assign"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (exp.left.type != <span class="hljs-string"><span class="hljs-string">"var"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Error</span></span>(<span class="hljs-string"><span class="hljs-string">"Cannot assign to "</span></span> + <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify(exp.left)); evaluate(exp.right, env, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CC</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">right</span></span></span><span class="hljs-function">)</span></span>{ GUARD(CC, <span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>); callback(env.set(exp.left.value, right)); }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"binary"</span></span>: evaluate(exp.left, env, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CC</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">left</span></span></span><span class="hljs-function">)</span></span>{ GUARD(CC, <span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>); evaluate(exp.right, env, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CC</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">right</span></span></span><span class="hljs-function">)</span></span>{ GUARD(CC, <span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>); callback(apply_op(exp.operator, left, right)); }); }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"let"</span></span>: (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loop</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">env, i</span></span></span><span class="hljs-function">)</span></span>{ GUARD(loop, <span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (i &lt; exp.vars.length) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> v = exp.vars[i]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (v.def) evaluate(v.def, env, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CC</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">value</span></span></span><span class="hljs-function">)</span></span>{ GUARD(CC, <span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> scope = env.extend(); scope.def(v.name, value); loop(scope, i + <span class="hljs-number"><span class="hljs-number">1</span></span>); }); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> scope = env.extend(); scope.def(v.name, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); loop(scope, i + <span class="hljs-number"><span class="hljs-number">1</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { evaluate(exp.body, env, callback); } })(env, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"lambda"</span></span>: callback(make_lambda(env, exp)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"if"</span></span>: evaluate(exp.cond, env, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CC</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">cond</span></span></span><span class="hljs-function">)</span></span>{ GUARD(CC, <span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cond !== <span class="hljs-literal"><span class="hljs-literal">false</span></span>) evaluate(exp.then, env, callback); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (exp.else) evaluate(exp.else, env, callback); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> callback(<span class="hljs-literal"><span class="hljs-literal">false</span></span>); }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"prog"</span></span>: (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loop</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">last, i</span></span></span><span class="hljs-function">)</span></span>{ GUARD(loop, <span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (i &lt; exp.prog.length) evaluate(exp.prog[i], env, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CC</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">val</span></span></span><span class="hljs-function">)</span></span>{ GUARD(CC, <span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>); loop(val, i + <span class="hljs-number"><span class="hljs-number">1</span></span>); }); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { callback(last); } })(<span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"call"</span></span>: evaluate(exp.func, env, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CC</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">func</span></span></span><span class="hljs-function">)</span></span>{ GUARD(CC, <span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>); (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loop</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">args, i</span></span></span><span class="hljs-function">)</span></span>{ GUARD(loop, <span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (i &lt; exp.args.length) evaluate(exp.args[i], env, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CC</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">arg</span></span></span><span class="hljs-function">)</span></span>{ GUARD(CC, <span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>); args[i + <span class="hljs-number"><span class="hljs-number">1</span></span>] = arg; loop(args, i + <span class="hljs-number"><span class="hljs-number">1</span></span>); }); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { func.apply(<span class="hljs-literal"><span class="hljs-literal">null</span></span>, args); } })([ callback ], <span class="hljs-number"><span class="hljs-number">0</span></span>); }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Error</span></span>(<span class="hljs-string"><span class="hljs-string">"I don't know how to evaluate "</span></span> + exp.type); } }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุจุงููุณุจุฉ ูููุธุงุฆู ุงููุฌูููุฉ ุ ูุญุชุงุฌ ุฅูู ุฅุถุงูุฉ ุงุณู ุญุชู ูุชููู ูู ุชูุฑูุฑูุง ุฅูู ูุธููุฉ <code>GUARD</code> .  ููุฏ ุงุณุชุฎุฏูุช ุงุณู <code>CC</code> ( <code>current continuation</code> ).  ููููู ุงุณุชุฎุฏุงู <code>arguments.callee</code> ุ ููู ูุฐุง ูู ูุงุฌูุฉ ุจุฑูุฌุฉ ุชุทุจููุงุช ูุฏููุฉ. </p><br><p style=";text-align:right;direction:rtl">  ุฃูุถุง ุ ููุณ ุงูุชุบููุฑ ูู <code>make_lambda</code> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">make_lambda</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">env, exp</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (exp.name) { env = env.extend(); env.def(exp.name, lambda); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">lambda</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">callback</span></span></span><span class="hljs-function">) </span></span>{ GUARD(lambda, <span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>); <span class="hljs-comment"><span class="hljs-comment">// &lt;--  var names = exp.vars; var scope = env.extend(); for (var i = 0; i &lt; names.length; ++i) scope.def(names[i], i + 1 &lt; arguments.length ? arguments[i + 1] : false); evaluate(exp.body, scope, callback); } return lambda; }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ุชูููุฐ <code>GUARD</code> ุจุณูุท ููุบุงูุฉ.  ููููุฉ ุงูุฎุฑูุฌ ูู ููุงููุฉ ุนูููุฉุ  ุจุงุณุชุฎุฏุงู ุงุณุชุซูุงุกุงุช.  ููููุงู ุจุฐูู ุ ุณูููู ููุงู ูุชุบูุฑ ุนุงููู ูุดูุฑ ุฅูู ููุฏุงุฑ ุงูุนูุฏูุฉ ุงูุชู ูููููุง ุงูููุงู ุจูุง.  ุฅุฐุง ูุตู ุฅูู ุงูุตูุฑ ุ ูุฅููุง ูุฑูู ูุงุฆู <code>Continuation</code> ุ ุญูุซ ุณูููู ููุงู ุงุณุชูุฑุงุฑ - ุฏุงูุฉ ููุณูุทุงุช: </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> STACKLEN; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GUARD</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">f, args</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (--STACKLEN &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Continuation(f, args); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Continuation</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">f, args</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.f = f; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.args = args; }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููู ุงูููุงูุฉ ุ ูุญุชุงุฌ ุฅูู ุญููุฉ ูู ุดุฃููุง ุงูุชูุงุท ุฃุดูุงุก <code>Continuation</code> .  ูุฌุจ ุนูููุง ุงุณุชุฏุนุงุก ุงููุชุฑุฌู ุงูุดููู ูู ุฎูุงู ูุฐู ุงูุญููุฉ ุญุชู ูุนูู ูู ุดูุก: </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Execute</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">f, args</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-literal"><span class="hljs-literal">true</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { STACKLEN = <span class="hljs-number"><span class="hljs-number">200</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> f.apply(<span class="hljs-literal"><span class="hljs-literal">null</span></span>, args); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span>(ex) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ex <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> Continuation) f = ex.f, args = ex.args; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> ex; } }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุชูุจู ุงูุฏุงูุฉ <code>Execute</code> ุงููุธููุฉ ุงููุฑุงุฏ ุงุณุชุฏุนุงุคูุง ูุงููุณูุทุงุช ุงูุฎุงุตุฉ ุจูุง.  ุฅููุง ุชุนูู ูู ุญููุฉ ุ ูููู ุนููู ุงูุงูุชุจุงู ุฅูู <code>return</code> ุฅุฐุง ูุงูุช ุงููุธููุฉ ุชุนูู ุฏูู ุชุฌุงูุฒ ุณุนุฉ ุงูููุฏุณ ุ ููุญู ูุชููู ุนูู ุงูููุฑ.  <code>STACKLEN</code> ุฅุนุงุฏุฉ ุชุนููู <code>STACKLEN</code> ูู ูุฑุฉ ูุจุฏุฃ ุชูุฑุงุฑ ุญููุฉ.  ูููุฉ <code>200</code> - ููุงุณุจ ุจุดูู ุฌูุฏ.  ุนูุฏูุง <code>Continuation</code> ูุงุฆู <code>Continuation</code> ุ ูุฅููุง ูุณุชุจุฏู ูุธููุฉ ูุณูุทุงุช ุฌุฏูุฏุฉ ุ ูููุงุตู ุงูุญููุฉ.  ุฃูุถูุง ุ ุจุณุจุจ ุงุณุชุซูุงุก ุ ูุชู ูุณุญ ุงูููุฏุณ ุ ุจุญูุซ ูููููุง ุงููุชุงุจุนุฉ. </p><br><p style=";text-align:right;direction:rtl">  ูุจุฏุก ุงููุชุฑุฌู ุงูููุฑู ุ ูุณุชุฎุฏู ุงูุขู <code>Execute</code> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs">Execute(evaluate, [ ast, globalEnv, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">result</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">"*** Result:"</span></span>, result); }]);</code> </pre> <br><h2 id="test" style=";text-align:right;direction:rtl">  ุงุฎุชุจุงุฑ </h2><br><p style=";text-align:right;direction:rtl">  ุณุชุนูู ูุธููุฉ <code>fib</code> ุงูุขู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs">fib = ฮป(n) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> n &lt; <span class="hljs-number"><span class="hljs-number">2</span></span> then n <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> fib(n - <span class="hljs-number"><span class="hljs-number">1</span></span>) + fib(n - <span class="hljs-number"><span class="hljs-number">2</span></span>); time( ฮป() println(fib(<span class="hljs-number"><span class="hljs-number">20</span></span>)) ); <span class="hljs-comment"><span class="hljs-comment"># 6765, ~300ms</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ุฅูู ูุฃูุฑ ูุคุณู ุ ูููู ุฅุฐุง ุญุงููุช ุงูุนุซูุฑ ุนูู <code>fib(27)</code> ุ <code>fib(27)</code> ุงูุฃูุฑ ุญูุงูู ุฃุฑุจุนุฉ ุฃุถุนุงู ุทูู ุงููุชุฑุฌู ุงูุนุงุฏู.  ูููู ุจุนุฏ ุฐูู ูุฏููุง ุงูุขู ุงูุนูุฏูุฉ ูุงููุงุฆูุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs">sum = ฮป(n, ret) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> n == <span class="hljs-number"><span class="hljs-number">0</span></span> then ret <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> sum(n - <span class="hljs-number"><span class="hljs-number">1</span></span>, ret + n); # compute <span class="hljs-number"><span class="hljs-number">1</span></span> + <span class="hljs-number"><span class="hljs-number">2</span></span> + ... + <span class="hljs-number"><span class="hljs-number">50000</span></span> time( ฮป() println(sum(<span class="hljs-number"><span class="hljs-number">50000</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)) ); # <span class="hljs-number"><span class="hljs-number">1250025000</span></span>, ~<span class="hljs-number"><span class="hljs-number">700</span></span>ms</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุจุงูุทุจุน ุ ุงููุบุฉ sl ุฃุจุทุฃ ุจูุซูุฑ ูู JavaScript.  ููุท ุชุฎูู ุ ูู ูุตูู ุฅูู ูุชุบูุฑ ููุฑ ุนุจุฑ ูุงุฆู <code>Environment</code> .  ููุณ ูู ุงูููุทูู ูุญุงููุฉ ุชุญุณูู ุงููุชุฑุฌู ุงูุดููู - ููู ูุญูู ููุงุณุจ ูุจูุฑุฉ ูู ุงูุฃุฏุงุก.  ูุชุญุณูู ุงูุฃุฏุงุก ุ ููุงู ุญู ูุงุญุฏ: ุชุฌููุน ุงููุบุฉ ูู JS ุ ููุฐุง ูุง ุณููุนูู.  ูู ุงูุจุฏุงูุฉ ุ ุฏุนููุง ูุฑู ุงูุฃุดูุงุก ุงููุซูุฑุฉ ููุงูุชูุงู ุงูุชู ูููููุง ุงูููุงู ุจูุง ูุน ูุชุฑุฌู CPS. </p><br><h1 id="prodolzheniya" style=";text-align:right;direction:rtl">  ุงุณุชูุฑุงุฑ </h1><br><p style=";text-align:right;direction:rtl">  ุงูุขู ุจุนุฏ ุฃู ุฃุตุจุญ ุงููุชุฑุฌู ูุนูู ุจุฃุณููุจ ุฅุฑุณุงู ุงูุงุณุชูุฑุงุฑูุฉ ุ ุชุชููู ุฌููุน ุงููุธุงุฆู ุ ูู ูู ูุธุงุฆู ฮป language ููุธุงุฆู JS ุงูุฃุตููุฉ ุ ูุธููุฉ ุงูุงุณุชูุฑุงุฑ ูุญุฌุฉ ุฃููู ูุฅุฑุฌุงุน ุงููุชูุฌุฉ (ูุฐู ุงููุณูุทุฉ ูุทููุจุฉ ููุธุงุฆู JavaScript ุ ุนูู ุงูุฑุบู ูู ุฃููุง ุบูุฑ ูุฑุฆูุฉ ููุธุงุฆู ฮป language). </p><br><p style=";text-align:right;direction:rtl">  <code>callback</code> ูุชุบูุฑ ูุนูู ุงุณุชูุฑุงุฑ ุงูุจุฑูุงูุฌ ุจุฃูููู.  <em>ูู ูุง ุณูู ูููู ุจู ุงูุจุฑูุงูุฌ ุจุนุฏ ุฐูู.</em>  ุณูู ูุณูู ูุฐุง ุงููุชุบูุฑ "ุงุณุชูุฑุงุฑ ุงูุญุงูู" ุ ุฃู <code>k</code> ูู ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ. </p><br><p style=";text-align:right;direction:rtl">  ุฃูุถูุง ุ ุฅุฐุง ูู ูุชุณุจุจ ูู ุงุณุชูุฑุงุฑ ุ ูุณูุชููู ุงูุจุฑูุงูุฌ.  ูุง ูููููุง ุงูููุงู ุจุฐูู ูู ุงููุบุฉ <code>make_lambda</code> ูุฃู <code>make_lambda</code> ูุณุชุฏุนู ุงููุชุงุจุนุฉ ุนูู ุฃู ุญุงู.  ูููู ูููููุง ุงูููุงู ุจุฐูู ูู ูุธููุฉ ุฃุตููุฉ.  ููุฏ ููุช ุจุนูู ูุฅุธูุงุฑ ููู ูุนูู ูุฐุง: </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs">globalEnv.def(<span class="hljs-string"><span class="hljs-string">"halt"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">k</span></span></span><span class="hljs-function">)</span></span>{});</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุฐู ูุธููุฉ ูุง ุชูุนู ุดูุฆูุง.  ุชุชููู ุงูุงุณุชูุฑุงุฑูุฉ ( <code>k</code> ) ุ ููููุง ูุง ุชุณูููุง: </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs">println(<span class="hljs-string"><span class="hljs-string">"foo"</span></span>); halt(); println(<span class="hljs-string"><span class="hljs-string">"bar"</span></span>);</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงูุงุณุชูุชุงุฌ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">foo</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุฅุฐุง ููุช ุจุญุฐู ุงุณุชุฏุนุงุก <code>halt()</code> ุ ูุณูููู ุงูุฅุฎุฑุงุฌ: <code>foo / bar / ***Result: false</code> (ูุฃู ุขุฎุฑ <code>println</code> ููุฑุฌุน <code>false</code> ).  ูููู ูุน <code>halt()</code> ููุฐุง ููุท ูุฎุฑุฌุงุช <code>foo</code> .  * ุงูุขู ูุง ุชูุฌุฏ ูุชูุฌุฉ ุญุชู ูุฃู <code>halt()</code> ูุง ูุชุณุจุจ ูู ุงุณุชูุฑุงุฑ ุ ูุจุงูุชุงูู ุ ูุฅู ุฑุฏ ุงูุงุชุตุงู ุงูุฐู ุฃุฌุชุฒูุงู <code>evaluate</code> - ุงูุฐู ูุนุฑุถ ุงูุณูุณูุฉ <code>***Result</code> ุ ูุง ููุทูู ุนููู ูุทูููุง.  ุงููุธููุฉ ุงูุชู ุชุณูู <code>evaluate</code> ูุง ุชูุงุญุธ ุชููู ุงูุจุฑูุงูุฌ.  ูู NodeJS ุ ุณูููู ุฐูู ุชุณุฏูุฏุฉ ูู ุงููุฏู. </p><br><hr><br><p style=";text-align:right;direction:rtl">  ุชุฎูู ุฃููุง ุจุญุงุฌุฉ ุฅูู ูุธููุฉ <code>sleepe</code> ุชููู ุงูุจุฑูุงูุฌ ุฏูู ุฅููุงู ุงููุชุตูุญ (ูุจุงูุชุงูู ุ ุจุฏูู ุญููุงุช ุบุจูุฉ).  ูููููุง ุจุณูููุฉ ุชูููุฐ ุฐูู ุจุงุณุชุฎุฏุงู ูุธููุฉ ุฃุตููุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs">globalEnv.def(<span class="hljs-string"><span class="hljs-string">"sleep"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">k, milliseconds</span></span></span><span class="hljs-function">)</span></span>{ setTimeout(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ Execute(k, [ <span class="hljs-literal"><span class="hljs-literal">false</span></span> ]); <span class="hljs-comment"><span class="hljs-comment">//   ,  'false' }, milliseconds); });</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ููุงู ุฅุฒุนุงุฌ ุจุณูุท ูุชูุซู ูู ุฃูู ูุชุนูู ุนูููุง ุงุณุชุฎุฏุงู <code>Execute</code> ุ ูุฃู <code>setTimeout</code> ุณูู ูุชุณุจุจ ูู ุฑุฏ ุงุชุตุงู ุ ููุง ูุคุฏู ุฅูู <code>Continuation</code> ุ ููู ูููู ุฃุญุฏ ุจุงููุจุถ ุนููู.  ุฅููู ููููุฉ ุงุณุชุฎุฏุงูู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs">let loop (n = <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> n &lt; <span class="hljs-number"><span class="hljs-number">10</span></span> { println(n); sleep(<span class="hljs-number"><span class="hljs-number">250</span></span>); loop(n + <span class="hljs-number"><span class="hljs-number">1</span></span>); } }; println(<span class="hljs-string"><span class="hljs-string">"And we're done"</span></span>);</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงูุงุณุชูุชุงุฌ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">0 1 2 3 4 5 6 7 8 9 And we're done ***Result: false</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููุงุญุธุฉ ุ ููุงู ุชุฃุฎูุฑ ุจุณูุท ุจูู ูู ุณุทุฑ.  ููููู ูุญุงููุฉ ุชุดุบูู ูุฐุง ุงูุฑูุฒ ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูููุงูุฉ ุงูุฃุตููุฉ</a> . </p><br><p style=";text-align:right;direction:rtl">  ูุฐุง ุจุงููุนู ุดูุก ูุง ููููู ุงูููุงู ุจู ูู JavaScript ุงูุนุงุฏู ุ ุจุงุณุชุซูุงุก ุงุณุชุฎุฏุงู ุงูููู ุงููุฏูู ููุงุณุชูุฑุงุฑ (ูุฃูุถูุง ุ ูุง ููููู ุงุณุชุฎุฏุงู ุญููุฉ <code>for</code> ): </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs">(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loop</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">n</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (n &lt; <span class="hljs-number"><span class="hljs-number">10</span></span>) { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(n); setTimeout(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ loop(n + <span class="hljs-number"><span class="hljs-number">1</span></span>); }, <span class="hljs-number"><span class="hljs-number">250</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { println(<span class="hljs-string"><span class="hljs-string">"And we're done"</span></span>); <span class="hljs-comment"><span class="hljs-comment">//    } })(0);</span></span></code> </pre> <br><hr><br><p style=";text-align:right;direction:rtl">  ุชุฎูู ููู ููููู ุงุณุชุฎุฏุงู ูุงุฌูุฉ ุจุฑูุฌุฉ ุชุทุจููุงุช NodeJS ุจูุบุฉ:: </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs">globalEnv.def(<span class="hljs-string"><span class="hljs-string">"readFile"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">k, filename</span></span></span><span class="hljs-function">)</span></span>{ fs.readFile(filename, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">err, data</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-comment"><span class="hljs-comment">// error handling is a bit more complex, ignoring for now Execute(k, [ data ]); // hope it's clear why we need the Execute }); }); globalEnv.def("writeFile", function(k, filename, data){ fs.writeFile(filename, data, function(err){ Execute(k, [ false ]); }); });</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงูุงุณุชุฎุฏุงู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs">copyFile = ฮป(source, dest) { writeFile(dest, readFile(source)); }; copyFile(<span class="hljs-string"><span class="hljs-string">"foo.txt"</span></span>, <span class="hljs-string"><span class="hljs-string">"bar.txt"</span></span>);</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููู ูุฐุง ูุนูู ุจุดูู ุบูุฑ ูุชุฒุงูู.  ูุง ูุฒูุฏ ูู ุงูุฌุญูู ุฑุฏ ุงูุงุชุตุงู. </p><br><hr><br><p style=";text-align:right;direction:rtl">  ููุง ูุซุงู ุฃูุซุฑ ุฅุซุงุฑุฉ ููุงูุชูุงู.  ูุชุจุช ุงููุธููุฉ ุงูุฃุตููุฉ ุงูุชุงููุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs">globalEnv.def(<span class="hljs-string"><span class="hljs-string">"twice"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">k, a, b</span></span></span><span class="hljs-function">)</span></span>{ k(a); k(b); });</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุฃุฎุฐ ุงูุจุฑูุงูุฌ ุงููุณูุทุชูู <code>a</code> ู <code>b</code> ููุฏุนู ุฅูู ุงูุงุณุชูุฑุงุฑ ูุฑุชูู ุ ูุฑุฉ ูุงุญุฏุฉ ููู ูุณูุทุฉ.  ููุญุงูู ุงูุงุชุตุงู ุจูุง: </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs">println(<span class="hljs-number"><span class="hljs-number">2</span></span> + twice(<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>)); println(<span class="hljs-string"><span class="hljs-string">"Done"</span></span>);</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงูุงุณุชูุชุงุฌ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">5 Done ***Result: false 6 Done ***Result: false</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงูุงุณุชูุชุงุฌ ุบุฑูุจ ุฅุฐุง ูู ุชูู ูุฏ ุนููุช ูุทูููุง ูุน ุชุฌุงูุฒุงุช ูุณุชูุฑุฉ ูู ูุจู ุ ููู ุญุงูู ููู ูุฐุง ุงูุฑูุฒ ุจููุณู.  ุจุนุถ ุงูุชูููุญุงุช: ูุจุฏุฃ ุงูุจุฑูุงูุฌ ูุฑุฉ ูุงุญุฏุฉ ุ ูููู ูุนุฑุถ ุงููุชูุฌุฉ ูุฑุชูู. </p><br><h2 id="obobschenie-callcc" style=";text-align:right;direction:rtl">  ุงูุชุนููู: <code>CallCC</code> </h2><br><p style=";text-align:right;direction:rtl">  ููุง ููุนุจ ุจุงููุงุฑ ุนูุฏูุง ูุชุจูุง ูุธุงุฆู ูุญููุฉ.  ูุง ุชูุฌุฏ ุทุฑููุฉ ูู ุงููุบุฉ ูููุงุทุนุฉ ุชูููุฐ ุงูุงุณุชูุฑุงุฑูุฉ ุงูุญุงููุฉ.  ุณูู <code>CallCC</code> ุชุณุงุนุฏ ูู ุญู ูุฐู ุงููุดููุฉ.  ุงูุงุณู ูู ุงุฎุชุตุงุฑ ุงููุธููุฉ ูู ุงููุฎุทุท - <code>call-with-current-continuation</code> (ูุงูุฐู ูุณูู ุนุงุฏุฉู ุงุณุชุฏุนุงุก / ุณู ูู ุงููุฎุทุท). </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs">globalEnv.def(<span class="hljs-string"><span class="hljs-string">"CallCC"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">k, f</span></span></span><span class="hljs-function">)</span></span>{ f(k, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CC</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">discarded, ret</span></span></span><span class="hljs-function">)</span></span>{ k(ret); }); });</code> </pre> <br><p style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูููู ุจุฅุนุงุฏุฉ ุถุจุท</a> ุงูุงุณุชูุฑุงุฑูุฉ ุงูุญุงููุฉ ุฅูู ูุธููุฉ ูููู ุงุณุชุฏุนุงุคูุง ูุจุงุดุฑุฉ ูู ูุบุฉ ฮป.  ุณุชุชุฌุงูู ูุฐู ุงููุธููุฉ ุงุณุชูุฑุงุฑูุง ุงูุฃุตูู <code>discarded</code> <code>CallCC</code> ุจุฏูุงู ูู ุฐูู ุงูุงุณุชูุฑุงุฑ ุงูุฐู ุชู ุชูุฑูุฑู ุฅูู ูุธููุฉ <code>CallCC</code> . </p><br><p style=";text-align:right;direction:rtl">  ุจุงุณุชุฎุฏุงู ูุฐู ุงููุธููุฉ ุ ูููููุง ุชูููุฐ (ุจุงููุนู ูุจุงุดุฑุฉ ูู ุงููุบุฉ ุ ูููุณ ูู ุฎูุงู ูุธุงุฆู ุฃุตููุฉ!) ูุฌููุนุฉ ูุจูุฑุฉ ูู ุนุจุงุฑุงุช ุงูุชุญูู ูุชุฏูู ุงูุชูููุฐ ุงูุชู ูู ูููุฑ ูููุง ูู ูุจู - ุจุฏุกูุง ูู ุงูุงุณุชุซูุงุกุงุช ูููุงูุฉ <code>return</code> .  ููุจุฏุฃ ูู ุงูุฃุฎูุฑ. </p><br><h3 id="realizaciya-return" style=";text-align:right;direction:rtl">  <code>return</code> ุงูุชูููุฐ </h3><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs">foo = ฮป(<span class="hljs-keyword"><span class="hljs-keyword">return</span></span>){ println(<span class="hljs-string"><span class="hljs-string">"foo"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>(<span class="hljs-string"><span class="hljs-string">"DONE"</span></span>); println(<span class="hljs-string"><span class="hljs-string">"bar"</span></span>); }; CallCC(foo);</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงูุงุณุชูุชุงุฌ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">foo ***Result: DONE</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุชุชููู ุงูุฏุงูุฉ <code>foo</code> ูุณูุทุฉ ุชููู ุจููุณ ุทุฑููุฉ <code>return</code> ูู JavaScript (ูููู ุชุณูู ูุธููุฉ ุนุงุฏูุฉ).  ุฅูู ูุชุฎุทู ุงูุงุณุชูุฑุงุฑูุฉ ุงูุญุงููุฉ (ูุงูุชู ูู ุดุฃููุง ุฅุฎุฑุงุฌ 'ุดุฑูุท') ููุฎุฑุฌ ูู ุงููุธููุฉ ุ ููุนูุฏ ุงููููุฉ ุงููุญุฏุฏุฉ ("ุชู").  ุจุงูุทุจุน ุ ูุฐุง ูุนูู ููุท ุฅุฐุง ููุช ุจุงุณุชุฏุนุงุก ุฏุงูุฉ ุจุงุณุชุฎุฏุงู <code>CallCC</code> ูุชูุฑูุฑ ุงูุงุณุชูุฑุงุฑูุฉ <code>CallCC</code> .  ูููููุง ุฅูุดุงุก ุบูุงู ููุฐุง: </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> = ฮป(f) ฮป() CallCC(f); foo = <span class="hljs-keyword"><span class="hljs-keyword">with</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">return</span></span>(ฮป(<span class="hljs-keyword"><span class="hljs-keyword">return</span></span>){ println(<span class="hljs-string"><span class="hljs-string">"foo"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>(<span class="hljs-string"><span class="hljs-string">"DONE"</span></span>); println(<span class="hljs-string"><span class="hljs-string">"bar"</span></span>); }); foo();</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงูุงุณุชูุชุงุฌ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">foo ***Result: DONE</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููุฒุฉ ูุฐู ุงูุทุฑููุฉ ูู ุฃููุง ูู ูุนุฏ ุจุญุงุฌุฉ ุฅูู ุงุณุชุฎุฏุงู <code>CallCC</code> ุนูุฏูุง ูุณูู <code>foo</code> .  ุณูููู ูู ุงูุฑุงุฆุน ุ ุจุงูุทุจุน ุ ุฅุฐุง ูู ููู ุจุญุงุฌุฉ ุฅูู ูุจูู <code>return</code> ููุณูุทุฉ ุฃู ุงุณุชุฎุฏุงู ุงูุฏุงูุฉ <code>with-return</code> ุ ูููู ูู ุงููุบุฉ ูุง ุชูุฌุฏ ุทุฑููุฉ ูุฅุถุงูุฉ ุงูุณูุฑ ุงููุญูู ูุจุงุดุฑุฉู ููู ุ ููุฐุง ูุญู ุจุญุงุฌุฉ ุนูู ุงูุฃูู ุฅูู ุชุนุฏูู ุงููุญูู ุงููุบูู (+1 ูู Lisp). </p><br><h3 id="perehody" style=";text-align:right;direction:rtl">  ุงูุชุญููุงุช </h3><br><p style=";text-align:right;direction:rtl">  ุนูู ุณุจูู ุงููุซุงู ุ ูุญุชุงุฌ ุฅูู ูุชุงุจุฉ ุจุฑูุงูุฌ ูุจุญุซ ุนู ุฌููุน ุฃุฒูุงุฌ ุงูุฃุนุฏุงุฏ ุงูุตุญูุญุฉ ุงูููุฌุจุฉ ุงูุชู ุชุตู ุฅูู 100 ุจุญูุซ ุฅุฐุง ูุงูุช ุงูุถุฑุจ ุชุนุทู 84. ูุฐู ููุณุช ูููุฉ ุตุนุจุฉ ูููููู ุฃู ุชุชุฎูู ุนูู ุงูููุฑ ุญููุชูู ูุชุฏุงุฎูุชูู ูุญููุง ุ ูููู ููุง ูุฐูุจ ุจุทุฑููุฉ ูุฎุชููุฉ.  ุณูููู ุจุฅูุดุงุก ูุธููุชูู: <code>guess</code> <code>fail</code> .  ุงูุฃูู ุณูุฎุชุงุฑ ุงูุฑูู ุ ูุงูุซุงูู ูููู ููุง "ุฌุฑุจ ุฑูููุง ุขุฎุฑ".  ุณูู ูุณุชุฎุฏููุง ูุซู ูุฐุง: </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs">a = guess(<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-comment"><span class="hljs-comment">#  -  &gt;= 1 b = guess(a); #  -  &gt;= a if a * b == 84 { #    : print(a); print(" x "); println(b); }; fail(); #    `guess`    </span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  : </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs">fail = ฮป() false; guess = ฮป(current) { CallCC(ฮป(k){ let (prevFail = fail) { fail = ฮป(){ current = current + <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> current &gt; <span class="hljs-number"><span class="hljs-number">100</span></span> { fail = prevFail; fail(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { k(current); }; }; k(current); }; }); }; a = guess(<span class="hljs-number"><span class="hljs-number">1</span></span>); b = guess(a); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> a * b == <span class="hljs-number"><span class="hljs-number">84</span></span> { print(a); print(<span class="hljs-string"><span class="hljs-string">" x "</span></span>); println(b); }; fail();</code> </pre> <br><p style=";text-align:right;direction:rtl">     ,  ,      <code>a</code> ,    <code>84</code> ,   <code>b</code> ,  <code>84 / a</code> .           <code>guess</code> : <code>start</code>  <code>end</code> โ      .   ,  . </p><br><h3 id="try-i-catch-iz-common-lisp" style=";text-align:right;direction:rtl"> <code>try</code>  <code>catch</code>  Common Lisp </h3><br><p style=";text-align:right;direction:rtl">     โ <code>catch</code>  <code>throw</code> .     : </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs">f1 = ฮป() { throw(<span class="hljs-string"><span class="hljs-string">"foo"</span></span>, <span class="hljs-string"><span class="hljs-string">"EXIT"</span></span>); print(<span class="hljs-string"><span class="hljs-string">"not reached"</span></span>); }; println(catch(<span class="hljs-string"><span class="hljs-string">"foo"</span></span>, ฮป() { f1(); print(<span class="hljs-string"><span class="hljs-string">"not reached"</span></span>); })); <span class="hljs-comment"><span class="hljs-comment">#  EXIT</span></span></code> </pre> <br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <code>catch(TAG, function)</code>  ,    ,  <code>TAG</code> ',   <code>function</code> . </li><li style=";text-align:right;direction:rtl">  <code>throw(TAG, value)</code>  ,     ,  <code>TAG</code> '  ,     <code>value</code> . </li></ul><br><p style=";text-align:right;direction:rtl">  : </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">##  , 'throw'   . ##       `error`, ##     JavaScript.    . throw = ฮป(){ println("ERROR: No more catch handlers!"); halt(); }; catch = ฮป(tag, func){ CallCC(ฮป(k){ let (rethrow = throw, ret) { ##   ,     . throw = ฮป(t, val) { throw = rethrow; #   ,   . if t == tag then k(val) else throw(t, val); }; ##      . ret = func(); ##       (  'throw') ##    .   . throw = rethrow; # XXX ##  . ret; }; }); };</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุซุงู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># ... f1 = ฮป() { throw("foo", "EXIT"); print("not reached"); }; println(catch("foo", ฮป() { f1(); print("not reached"); }));</span></span></code> </pre> <br><h2 id="temnaya-storona-sily" style=";text-align:right;direction:rtl">    </h2><br><p style=";text-align:right;direction:rtl">    <code>catch</code> ,     ,    ,    .   ,    , ,  <code>CallCC</code>     .    ,     .    "   " โ      โ  .    ,  ,     ,  <code>catch</code> / <code>throw</code>    ,  . </p><br><p style=";text-align:right;direction:rtl">    .   ,    <code>catch</code> . ,   <code>throw</code>   , ,  <code>catch</code>   ,     .  ุนูู ุณุจูู ุงููุซุงู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs">exit = false; <span class="hljs-comment"><span class="hljs-comment">#  . x = 0; # :   ,   'exit()'  CallCC( ฮป(k) exit = k ); ## 'exit()'   ... if x == 0 then catch("foo", ฮป(){ println("in catch"); x = 1; #  exit(); }); println("After catch"); throw("foo", "FOO");</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงูุงุณุชูุชุงุฌ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">After catch After catch ERROR: No more catch handlers!</code> </pre> <br><p style=";text-align:right;direction:rtl">    'After catch' ,   'ERROR: No more catch handlers!'. -  ,   'After catch'   ,   . ,  ''  ,  <code>catch</code> . ,    'XXX'   <code>catch</code>   ,         <code>throw</code> ,   <code>catch</code>   . </p><br><p style=";text-align:right;direction:rtl"> (       ,     .) </p><br><p style=";text-align:right;direction:rtl">     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">  CallCC</a> (, <em>   ,   CallCC</em> ).  ,    โ  <code>CallCC</code>           . </p><br><h1 id="yield" style=";text-align:right;direction:rtl"> Yield </h1><br><p style=";text-align:right;direction:rtl"> ,    ,   <code>yield</code> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs">foo = <span class="hljs-keyword"><span class="hljs-keyword">with</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>(ฮป(<span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>){ <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>(<span class="hljs-number"><span class="hljs-number">2</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>(<span class="hljs-number"><span class="hljs-number">3</span></span>); <span class="hljs-string"><span class="hljs-string">"DONE"</span></span>; }); println(foo()); <span class="hljs-comment"><span class="hljs-comment"># 1 println(foo()); # 2 println(foo()); # 3 println(foo()); # DONE</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">    <code>yield</code> ,       .  ,  <code>return</code> .      ,       ,    <code>yield</code> ,       . </p><br><p style=";text-align:right;direction:rtl">  : </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs">fib = <span class="hljs-keyword"><span class="hljs-keyword">with</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>(ฮป(<span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>){ let loop (a = <span class="hljs-number"><span class="hljs-number">1</span></span>, b = <span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>(b); loop(b, a + b); }; }); <span class="hljs-comment"><span class="hljs-comment">##   50   let loop (i = 0) { if i &lt; 50 { println(fib()); loop(i + 1); }; };</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  <code>fib</code>   .    .  <code>yield</code>      .     ,    ,         50  ,      50 . </p><br><p style=";text-align:right;direction:rtl"> ,      ,     , ,            . </p><br><h2 id="neudachnaya-popytka-realizacii" style=";text-align:right;direction:rtl">    </h2><br><p style=";text-align:right;direction:rtl">          ,         . </p><br><p style=";text-align:right;direction:rtl">   <code>yield</code> ,  ,       .   ,        ,      <code>return</code> . ,  ,    <code>yield</code> ,       <code>yield</code> ,         <em></em> .   ,   .      : </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> = ฮป(func) { <span class="hljs-comment"><span class="hljs-comment">## with-yield     ฮป() { CallCC(ฮป(kret){ # kret     let (yield) { ##  yield yield = ฮป(value) { # yield  ,    CallCC(ฮป(kyld){ # kyld    yield... func = kyld; # ...     kret(value); #  . }); }; ## , ,  ,   yield. func(yield); }; }); }; };</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">       <code>yield</code>  ,     . ,         ,     ,      "DONE". </p><br><p style=";text-align:right;direction:rtl"> ,     .   ,     - ,     ,    4   : </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs">println(foo()); foo();</code> </pre> <br><p style=";text-align:right;direction:rtl">    . </p><br><h3 id="problema-1-yield-nikogda-ne-izmenyaetsya" style=";text-align:right;direction:rtl">  โ1: yield    </h3><br><p style=";text-align:right;direction:rtl">  ,   ,  ,   ,     <code>yield</code> ( <code>kyld</code> ,    ,   )    : </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"> <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>(<span class="hljs-number"><span class="hljs-number">2</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>(<span class="hljs-number"><span class="hljs-number">3</span></span>); <span class="hljs-string"><span class="hljs-string">"DONE"</span></span>;</code> </pre> <br><p style=";text-align:right;direction:rtl">    <code>yield</code>   ?     <code>yield</code> ,       ,    <code>yield</code>    . ,    .  ,     <code>yield</code>        <code>return</code> ,      : </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> = ฮป(func) { let (<span class="hljs-keyword"><span class="hljs-keyword">return</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> = ฮป(value) { CallCC(ฮป(kyld){ func = kyld; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>(value); <span class="hljs-comment"><span class="hljs-comment"># 'return'  ,     }); #        . }; # ฮป(val) { # CallCC(ฮป(kret){ # return = kret; # &lt;-  func(val || yield); }); }; }; };</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl"> ,  ,       <code>yield</code>  ,   <code>yield</code>       (  ).      <code>yield</code> . </p><br><p style=";text-align:right;direction:rtl">   ,    ,    <code>println(foo())</code>   : </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> = ฮป(func) { let (<span class="hljs-keyword"><span class="hljs-keyword">return</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> = ฮป(value) { CallCC(ฮป(kyld){ func = kyld; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>(value); }); }; ฮป(val) { CallCC(ฮป(kret){ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> = kret; func(val || <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>); }); }; }; }; foo = <span class="hljs-keyword"><span class="hljs-keyword">with</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>(ฮป(<span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>){ <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>(<span class="hljs-number"><span class="hljs-number">2</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>(<span class="hljs-number"><span class="hljs-number">3</span></span>); <span class="hljs-string"><span class="hljs-string">"DONE"</span></span>; }); println(foo()); println(foo()); println(foo());</code> </pre> <br><p style=";text-align:right;direction:rtl"> ,    .        ,      <code>print(foo()); foo()</code> .   ,     <code>println(foo())</code> ?   ... </p><br><h3 id="problema-2-wtf" style=";text-align:right;direction:rtl">  โ2: WTF? </h3><br><p style=";text-align:right;direction:rtl">     .     :    ,          <code>foo()</code> .  ,     ? โ    . </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs">println(foo()); <span class="hljs-comment"><span class="hljs-comment">## yield 1 &lt;-----------------  ---------------------------+ println(foo()); ## yield 2 | println(foo()); ## yield 3 | println(foo()); ##   "DONE",   foo()  --&gt;--+</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">       <code>with-yield</code> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"> func(val || <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>); <span class="hljs-comment"><span class="hljs-comment">#...</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">     <code>yield</code> ,   ,       <code>#...</code> .   ,   ,     ( <code>"DONE"</code> ),     ,   <code>"DONE"</code>   ,     . <code>foo()</code>     ,    <code>"DONE"</code>   .      : </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs">println(foo()); println(<span class="hljs-string"><span class="hljs-string">"bar"</span></span>); println(foo()); println(foo()); foo();</code> </pre> <br><p style=";text-align:right;direction:rtl">   : <code>1, bar, 2, 3, DONE, bar, DONE, bar, ...</code> . </p><br><p style=";text-align:right;direction:rtl">      <code>func</code>  - ,    .   ,    <code>"no more continuations"</code> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"> val = func(val || <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>); func = ฮป() <span class="hljs-string"><span class="hljs-string">"NO MORE CONTINUATIONS"</span></span>; kret(val);</code> </pre> <br><p style=";text-align:right;direction:rtl">     : </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> = ฮป(func) { let (<span class="hljs-keyword"><span class="hljs-keyword">return</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> = ฮป(value) { CallCC(ฮป(kyld){ func = kyld; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>(value); }); }; ฮป(val) { CallCC(ฮป(kret){ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> = kret; val = func(val || <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>); func = ฮป() <span class="hljs-string"><span class="hljs-string">"NO MORE CONTINUATIONS"</span></span>; kret(val); }); }; }; }; foo = <span class="hljs-keyword"><span class="hljs-keyword">with</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>(ฮป(<span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>){ <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>(<span class="hljs-number"><span class="hljs-number">2</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>(<span class="hljs-number"><span class="hljs-number">3</span></span>); <span class="hljs-string"><span class="hljs-string">"DONE"</span></span>; }); println(foo()); println(foo()); println(foo()); println(foo());</code> </pre> <br><p style=";text-align:right;direction:rtl">      ,     : </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">1 2 3 DONE NO MORE CONTINUATIONS NO MORE CONTINUATIONS NO MORE CONTINUATIONS ***Result: false</code> </pre> <br><p style=";text-align:right;direction:rtl">    <code>1, 2, 3, DONE</code> ,      <code>"NO MORE CONTINUATIONS"</code>  .  ,       : </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs">print(<span class="hljs-string"><span class="hljs-string">"A. "</span></span>); println(foo()); print(<span class="hljs-string"><span class="hljs-string">"B. "</span></span>); println(foo()); print(<span class="hljs-string"><span class="hljs-string">"C. "</span></span>); println(foo()); print(<span class="hljs-string"><span class="hljs-string">"D. "</span></span>); println(foo()); <span class="hljs-comment"><span class="hljs-comment">##   : A. 1 B. 2 C. 3 D. DONE B. NO MORE CONTINUATIONS C. NO MORE CONTINUATIONS D. NO MORE CONTINUATIONS ***Result: false</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ,     :       , , ,      ,  <code>"B."</code>   . </p><br><p style=";text-align:right;direction:rtl">       ,         <code>yield</code> ,     : </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> = ฮป(func) { let (<span class="hljs-keyword"><span class="hljs-keyword">return</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> = ฮป(value) { CallCC(ฮป(kyld){ func = kyld; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>(value); }); }; ฮป(val) { CallCC(ฮป(kret){ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> = kret; val = func(val || <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>); func = ฮป() <span class="hljs-string"><span class="hljs-string">"NO MORE CONTINUATIONS"</span></span>; kret(val); }); }; }; }; fib = <span class="hljs-keyword"><span class="hljs-keyword">with</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>(ฮป(<span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>){ let loop (a = <span class="hljs-number"><span class="hljs-number">1</span></span>, b = <span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>(b); loop(b, a + b); }; }); <span class="hljs-comment"><span class="hljs-comment">##   50   let loop (i = 0) { if i &lt; 50 { println(fib()); loop(i + 1); }; };</span></span></code> </pre> <br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุงุณุชูุชุงุฌ</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">1 2 3 5 8 13 21 34 55 89 144 233 377 610 987 1597 2584 4181 6765 10946 17711 28657 46368 75025 121393 196418 317811 514229 832040 1346269 2178309 3524578 5702887 9227465 14930352 24157817 39088169 63245986 102334155 165580141 267914296 433494437 701408733 1134903170 1836311903 2971215073 4807526976 7778742049 12586269025 20365011074 ***Result: false</code> </pre> </div></div><br><p style=";text-align:right;direction:rtl"> ,      (,       ),       " ". </p><br><h2 id="otdelennye-prodolzheniya-reset-i-shift" style=";text-align:right;direction:rtl">  : <code>reset</code>  <code>shift</code> </h2><br><p style=";text-align:right;direction:rtl">    <code>yield</code>    : <code>reset</code>  <code>shift</code> .   " " โ ,     .  <code>reset</code>  ,   <code>shift</code>     ,   <code>CallCC</code> . </p><br><p style=";text-align:right;direction:rtl">  , <code>reset</code>  <code>shift</code>    โ .     <code>reset</code> ,  <code>shift</code>      ,    <code>reset</code> . </p><br><p style=";text-align:right;direction:rtl">  ,    <code>with-yield</code> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> = ฮป(func) { let (<span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>) { <span class="hljs-comment"><span class="hljs-comment">## 'yield'  'shift'     ##  'reset'.  ,   ,    ##   'func' โ ,   `func()` ##    ,    . yield = ฮป(val) { shift(ฮป(k){ func = k; #    val; #    }); }; ##  `with-yield`      ##   'reset',    ,  ##   'yield' ( )    ##    ฮป(val) { reset( ฮป() func(val || yield) ); }; } };</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ,      <code>reset</code> .  ,  ,       ,     <code>reset</code> .  ,    .     ,           . </p><br><p style=";text-align:right;direction:rtl">     : </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> = ฮป(func) { let (<span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> = ฮป(val) { shift(ฮป(k){ func = k; val; }); }; ฮป(val) { reset( ฮป() func(val || <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>) ); }; } }; foo = <span class="hljs-keyword"><span class="hljs-keyword">with</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>(ฮป(<span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>){ <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>(<span class="hljs-number"><span class="hljs-number">2</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>(<span class="hljs-number"><span class="hljs-number">3</span></span>); <span class="hljs-string"><span class="hljs-string">"DONE"</span></span>; }); println(foo()); <span class="hljs-comment"><span class="hljs-comment">#  1 println(foo()); #  2 println(foo()); #  3 println(foo()); #  DONE</span></span></code> </pre> <br><h2 id="realizaciya-reset-i-shift" style=";text-align:right;direction:rtl">  <code>reset</code>  <code>shift</code> </h2><br><p style=";text-align:right;direction:rtl">       ,      .    .     .     ,     ,        ,   .    <a href="">  Scheme</a> ( โ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Oleg Kiselyov</a> ).   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="> </a>     . </p><br><h3 id="ispolzuya-nativnye-funkcii" style=";text-align:right;direction:rtl">    </h3><br><p style=";text-align:right;direction:rtl">      ,      (    <code>CallCC</code> )         .   : </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pstack = []; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_goto</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">f</span></span></span><span class="hljs-function">) </span></span>{ f(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">KGOTO</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">r</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> h = pstack.pop(); h(r); }); } globalEnv.def(<span class="hljs-string"><span class="hljs-string">"reset"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">KRESET, th</span></span></span><span class="hljs-function">)</span></span>{ pstack.push(KRESET); _goto(th); }); globalEnv.def(<span class="hljs-string"><span class="hljs-string">"shift"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">KSHIFT, f</span></span></span><span class="hljs-function">)</span></span>{ _goto(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">KGOTO</span></span></span><span class="hljs-function">)</span></span>{ f(KGOTO, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SK</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">k1, v</span></span></span><span class="hljs-function">)</span></span>{ pstack.push(k1); KSHIFT(v); }); }); });</code> </pre> <br><p style=";text-align:right;direction:rtl">   ,   <code>reset</code> ,   <code>shift</code>  <code>_goto</code> ,  โ  .     .  <code>_goto</code>         ( <code>KGOTO</code> ).  ,       <code>f</code> (  <code>CallCC</code> )    -      <code>KGOTO</code> ,     .  ,  <code>f</code> ,   ,    <code>KGOTO</code> ,      ,     . </p><br><p style=";text-align:right;direction:rtl">  <code>reset</code>      ( <code>KRESET</code> )     <code>_goto(th)</code> .      ,    , ,      <code>_goto</code> . ,     , <code>KGOTO</code>   <code>KRESET</code> . </p><br><p style=";text-align:right;direction:rtl">   , <code>shift</code>     <code>KGOTO</code>     ,  <code>KGOTO</code>    <code>pstack</code> ,      <code>SK</code> ,     ,   <code>shift</code>   (   <code>shift</code> โ <code>KSHIFT</code> ).  <code>SK</code> โ   โ              ( <code>k1</code> )   .   ,     <code>shift2</code> ,    ,    <code>pstack.push(k1);</code> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs">println(reset(ฮป(){ <span class="hljs-number"><span class="hljs-number">1</span></span> + shift( ฮป(k) k(k(<span class="hljs-number"><span class="hljs-number">2</span></span>)) ); })); println(reset(ฮป(){ <span class="hljs-number"><span class="hljs-number">1</span></span> + shift2( ฮป(k) k(k(<span class="hljs-number"><span class="hljs-number">2</span></span>)) ); }));</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงูุงุณุชูุชุงุฌ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">4 3 ***Result: false</code> </pre> <br><p style=";text-align:right;direction:rtl">  <code>shift</code>    ( <code>k</code> ),       <code>reset</code> .     โ  1   <code>shift</code> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-number"><span class="hljs-number">1</span></span> + [?]</code> </pre> <br><p style=";text-align:right;direction:rtl">    <code>k</code> ,   <code>?</code> .     โ <code>k(k(2))</code> .   2   ,   <code>k(2)</code>  3. ,  <code>k(3)</code>  3     ,     4. </p><br><p style=";text-align:right;direction:rtl"> <code>shift2</code>  :  k(2)    . </p><br><h3 id="ispolzuya-callcc" style=";text-align:right;direction:rtl">  <code>CallCC</code> </h3><br><p style=";text-align:right;direction:rtl">   ,       ,     <code>CallCC</code> ,    .     ,     JS, ,      ,       .    ,    <code>CallCC</code> ,    . </p><br><p style=";text-align:right;direction:rtl">      โ    <code>goto</code> ,       (    ): </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">pstack = NIL; goto = false; reset = ฮป(th) { CallCC(ฮป(k){ pstack = cons(k, pstack); goto(th); }); }; shift = ฮป(f) { CallCC(ฮป(k){ goto(ฮป(){ f(ฮป(v){ CallCC(ฮป(k1){ pstack = cons(k1, pstack); k(v); }); }); }); }); }; let (v = CallCC( ฮป(k){ goto = k; k(false) } )) { if v then let (r = v(), h = car(pstack)) { pstack = cdr(pstack); h(r); } };</code> </pre> <br><p style=";text-align:right;direction:rtl">          โ        ! </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar444024/">https://habr.com/ru/post/ar444024/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar444014/index.html">ูุงููุฑูุณููุช ุชูุชุญ ูููุฉ ุฅุฏุงุฑุฉ ุงูุฃุนูุงู ูุชุนูู ุงุณุชุฑุงุชูุฌูุงุช ุงูุฐูุงุก ุงูุงุตุทูุงุนู ุ ูุงููุณุคูููุฉ</a></li>
<li><a href="../ar444016/index.html">ุญูู ุงููุฒูุฏ ูุน Microsoft Game Stack</a></li>
<li><a href="../ar444018/index.html">ููู ูุงุญุฏ ุชุบููุฑ ุงูุชูููู PostgreSQL ูุญุณู ุฃุฏุงุก ุจุทูุก ุงูุงุณุชุนูุงู 50 ูุฑุฉ</a></li>
<li><a href="../ar444020/index.html">ุงููุงุฑุชููุบ ูู ุงูุงุชุญุงุฏ ุงูุณูููุงุชู: ููู ุฃุตุจุญุช ููุงูุฉ ุงูุทูุงุฑูู ุงูุฃูุฑููููู ููุงูุฉ ูุจูุฑุฉ ูู DIY ุงูุงุชุญุงุฏ ุงูุณูููุชู</a></li>
<li><a href="../ar444022/index.html">Beego ูู ูุนุฏ ุงูุฐูุงุจ</a></li>
<li><a href="../ar444026/index.html">ููุฏูุณ ุฏุงูุฌุณุช ุฑูู 1.1 (25 ูุจุฑุงูุฑ - 11 ูุงุฑุณ 2019)</a></li>
<li><a href="../ar444028/index.html">ุชูุฏูู ูุนุจุฉ Microsoft Stack</a></li>
<li><a href="../ar444030/index.html">ููุฏ ุชุฑูุช ูุชุงุฌุฑ ุงูุชุฌุฒุฆุฉ ุงูุตูููุฉ ุนุจุฑ ุงูุฅูุชุฑูุช Gearbest ูุงุนุฏุฉ ุจูุงูุงุช ููุชูุญุฉ ุจููุงููู ูู ุจูุงูุงุช ุงูุนููุงุก ุงูุดุฎุตูุฉ</a></li>
<li><a href="../ar444032/index.html">ููุงุฐุง ุทุงุจุนุฉ ุซูุงุซูุฉ ุงูุฃุจุนุงุฏ ููุณุช ุทุงุจุนุฉ</a></li>
<li><a href="../ar444034/index.html">7 ุฎุทุงูุง ูููุชุฉ ูููุฏูุฑ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>