<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ö´Ô∏è üë©‚Äçüî¨ üçâ Sobre os recursos da arquitetura Android atrav√©s dos olhos de um desenvolvedor n√£o Android üåí üå´Ô∏è üßë‚Äçü§ù‚Äçüßë</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recentemente, redesenhamos completamente o aplicativo Pyrus para Android. A primeira vers√£o do aplicativo j√° funcionava no Android 2.2. Recusando-se a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Sobre os recursos da arquitetura Android atrav√©s dos olhos de um desenvolvedor n√£o Android</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/416689/"> Recentemente, redesenhamos completamente o aplicativo Pyrus para Android.  A primeira vers√£o do aplicativo j√° funcionava no Android 2.2.  Recusando-se a oferecer suporte ao Android abaixo de 4.1, conseguimos pagar a d√≠vida t√©cnica acumulada e simplificamos significativamente o c√≥digo-fonte.  Sim, perdemos uma parte dos usu√°rios (menos de 1%), mas, por outro lado, economizamos tempo para os desenvolvedores corrigirem erros raros.  Poderemos investir no desenvolvimento de funcionalidades para todos os usu√°rios atuais e novos.  A longo prazo, isso √© muito mais importante. <br><br>  Aqui, compartilhamos experi√™ncias que podem ser √∫teis para aqueles que est√£o pensando em iniciar o desenvolvimento da plataforma Android. <br><a name="habracut"></a><br>  O Android atrai boas ferramentas de desenvolvimento, linguagem testada pelo tempo (Java) com a sintaxe usual, uma enorme audi√™ncia de usu√°rios.  No entanto, √© dif√≠cil criar aplicativos convenientes no Android: apesar da API desenvolvida, muitas vezes acontece que n√£o h√° componentes prontos com comportamento adequado.  Voc√™ precisa abandonar as id√©ias do designer de UX ou concordar em depender de bibliotecas de terceiros ou escrever a si mesmo.  Nem todas as solu√ß√µes arquiteturais do Android foram bem-sucedidas, e isso tamb√©m aumenta a quantidade de c√≥digo sem benef√≠cios √≥bvios. <br><br><h3>  Morrer e ressuscitar das cinzas </h3><br>  A interface no Android √© baseada na atividade.  Este √© um cont√™iner que normalmente ocupa a tela inteira do dispositivo, outros widgets vivem nele e recebe eventos sobre a intera√ß√£o do usu√°rio. <br><br>  Quando o usu√°rio ativa o aplicativo, um evento onResume √© lan√ßado na Atividade.  Pressionou o bot√£o In√≠cio - a atividade desapareceu, mas antes disso ele recebeu o evento onPause.  At√© agora, tudo √© l√≥gico.  O que acontece quando um usu√°rio gira a tela do dispositivo 90 graus?  Voc√™ nunca adivinhar√°: o SO mata Atividade e recria!  Quando voc√™ desinstala uma Atividade, todos os componentes que ela cont√©m s√£o exclu√≠dos.  Isso significa que voc√™ precisa escrever um c√≥digo especial que salve o estado dos widgets dentro da Atividade (posi√ß√£o de rolagem, parte do texto selecionada, estado das caixas de sele√ß√£o) e os restaure depois que o pai for recriado.  O Android faz parte desse trabalho para voc√™, mas n√£o para todos. <br><br>  √â dif√≠cil entender o que levou os arquitetos a tomar essa decis√£o.  Mais tarde, algu√©m decidiu que parecia feio e adicionou o mesmo par√¢metro, que suprime o comportamento padr√£o do sistema.  Agora, em vez de recriar Activity, o sistema operacional pode chamar o m√©todo onConfigurationChanged especial.  Essa "solu√ß√£o" parece um hack sujo e apenas agrava o problema, porque a documenta√ß√£o do Android <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">diz que</a> "essa t√©cnica deve ser considerada uma medida extrema e n√£o √© recomendada para a maioria dos aplicativos". <br><br><h3>  Fragmentos fragmentados </h3><br>  Inicialmente, o sistema operacional Android foi criado para telefones.  Com o advento dos tablets, a equipe do Android decidiu com raz√£o que os elementos da interface que antes eram espa√ßados por diferentes atividades devido ao pequeno tamanho da tela do telefone agora podem coexistir na tela grande do tablet.  (Exemplo: a lista de cartas e o e-mail no telefone estavam em duas atividades diferentes e no tablet eles compartilhavam uma tela juntos.) Sim, o problema √©: v√°rias atividades n√£o podem interagir simultaneamente com o usu√°rio por design.  Portanto, √© necess√°rio outro mecanismo para reutilizar componentes e foi encontrada uma solu√ß√£o: fragmentos apareceram (Fragmento). <br><br>  Por <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">defini√ß√£o</a> , um Fragmento representa um comportamento ou parte de uma interface do usu√°rio em uma Atividade.  Tudo est√° claro.  No entanto, nas instru√ß√µes de uso de fragmentos, encontramos a se√ß√£o ‚ÄúAdicionando um fragmento que n√£o possui uma interface de usu√°rio‚Äù.  O que?  Acontece que um fragmento pode n√£o ter sua pr√≥pria janela para renderiza√ß√£o! <br><br>  Mas o que acontece com os fragmentos ao virar a tela?  Os desenvolvedores do Android pensaram sobre isso: quando voc√™ recria uma atividade, todos os seus fragmentos tamb√©m s√£o recriados automaticamente.  No entanto, ap√≥s uma an√°lise cuidadosa, o fragmento possui o m√©todo "setRetainInstance"; se voc√™ o chamar, esse fragmento n√£o ser√° exclu√≠do e restaurado durante as curvas. <br><br>  Delgado e consistente, esse conceito n√£o pode ser chamado. <br><br><h3>  Opera√ß√£o ass√≠ncrona </h3><br>  O encadeamento de processamento de eventos n√£o pode ser bloqueado por opera√ß√µes longas, portanto, a troca de dados com o disco e a rede deve ser realizada de forma ass√≠ncrona em outros encadeamentos.  O Android fornece at√© quatro mecanismos para opera√ß√£o ass√≠ncrona: AsyncTask, Service, IntentService, Thread.  Os desenvolvedores s√£o incentivados a descobrir qual √© o melhor para eles usarem.  A escolha n√£o √© trivial: por exemplo, se o aplicativo iniciou o AsyncTask e o usu√°rio girou a tela durante sua execu√ß√£o, ap√≥s a conclus√£o do trabalho, o AsyncTask n√£o conseguiu encontrar uma nova atividade (criada ap√≥s a mudan√ßa).  E nenhum dos quatro mecanismos implementa l√≥gica simples: se o usu√°rio iniciou o segundo processo ass√≠ncrono sem aguardar os resultados do primeiro e, em seguida, o primeiro ainda terminou anteriormente, √© apropriado ignorar e n√£o refletir seus resultados na interface do usu√°rio. <br><br>  Torna-se clara a apar√™ncia de v√°rias bibliotecas - barramentos de dados para organizar o trabalho ass√≠ncrono dentro de um aplicativo Android. <br><br><h3>  Reiniciando o aplicativo ap√≥s o OOM </h3><br>  Se o Android ficar sem mem√≥ria RAM, o sistema operacional poder√° concluir qualquer processo.  Quando o usu√°rio ativar o aplicativo no futuro, o sistema tentar√° restaurar seu estado.  Em teoria, isso deve ser invis√≠vel para o desenvolvedor (se ele implementou o m√©todo onSaveInstanceState em todos os componentes): o pr√≥prio sistema recria a pilha de atividades como era durante a parada for√ßada.  No entanto, se a inicializa√ß√£o demorar algum tempo (por exemplo, carregar caches do disco ou da rede), ser√° correto mostrar ao usu√°rio um indicador de espera.  Acontece que, ao criar uma Atividade, voc√™ ainda precisa monitorar o ‚Äúcold start‚Äù e executar a inicializa√ß√£o manualmente.  Sem mencionar que, ao reiniciar, nenhum Thread e AsyncTask s√£o restaurados. <br><br>  Qual a probabilidade de ficar sem mem√≥ria na pr√°tica?  Normalmente, essa situa√ß√£o ocorre ao processar imagens de alta resolu√ß√£o.  Por exemplo, uma imagem de 2048x1536 ocupa 12Mb na mem√≥ria de um objeto Bitmap.  A quantidade de mem√≥ria dispon√≠vel para o aplicativo depende do modelo espec√≠fico do dispositivo e, √†s vezes, √© muito pequena (64 Mb ou 128 Mb).  Como o coletor de lixo em todas as vers√µes do Android anteriores √† 8.0 n√£o era compacto, mesmo se voc√™ tivesse 100Mb de mem√≥ria livre, mas estivesse dividido em blocos de 10Mb, uma tentativa de alocar mem√≥ria para uma imagem desse tipo causou uma falha no aplicativo. <br><br><h3>  Coleta de lixo eterno </h3><br>  Uma vez que nosso usu√°rio percebeu que, ao percorrer as listas longas, o aplicativo ficava atrasado - a cada 2-3 segundos, a anima√ß√£o parava por breves pausas (200-300 ms) e continuava.  A an√°lise mostrou que a coleta de lixo geralmente √© iniciada com desconfian√ßa no aplicativo.  Descobriu-se que a classe HashMap padr√£o (que usamos para obter um objeto Java por seu ID) √© ineficiente no nosso caso: precisamos criar um objeto wrapper para cada chave, que √© um n√∫mero inteiro (int).  Portanto, o n√∫mero de aloca√ß√µes de mem√≥ria aumenta sem nenhum benef√≠cio.  A solu√ß√£o foi mudar para um cont√™iner SparseArray especial (dispon√≠vel apenas no Android, n√£o na plataforma Java padr√£o), o que reduziu imediatamente a press√£o no coletor de lixo. <br><br>  O que o atraso na anima√ß√£o tem a ver com isso, voc√™ pergunta?  O fato √© que o coletor de lixo no Android interrompeu todos os threads durante sua opera√ß√£o, incluindo o principal envolvido na renderiza√ß√£o.  Nas vers√µes do Android a partir do 5.0, outra m√°quina virtual √© usada (ART em vez de Dalvik) e um algoritmo de coleta de lixo diferente, que interrompe a anima√ß√£o cada vez menos.  (Voc√™ pode ler sobre a compara√ß√£o do tempo de coleta de lixo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> .) <br><br><h3>  Exibir documentos </h3><br>  Se voc√™ deseja inserir visualiza√ß√µes de documentos em seu aplicativo, √© for√ßado a decepcionar: no Android, n√£o h√° componente interno que possa exibir arquivos do Word, Excel, Powerpoint.  Sem mencionar arquivos ZIP ou documentos PDF.  Sa√≠da?  Force o usu√°rio a instalar aplicativos de terceiros para exibir cada tipo de arquivo ou usar o componente WebView (na verdade, um navegador).  Nos dois casos, quando o usu√°rio grava o arquivo, um aplicativo externo ser√° iniciado e alguns cen√°rios simplesmente n√£o podem ser implementados, por exemplo, um feed de imagem: n√£o h√° uma maneira f√°cil de integrar o WebView a um ViewPager padr√£o. <br><br><h3>  O que vem a seguir </h3><br>  Alguns estudos afirmam que a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">complexidade do desenvolvimento do Android √© relativamente alta</a> .  Nossa experi√™ncia mostra que √© f√°cil para um desenvolvedor competente se acostumar com os recursos desta plataforma.  E embora hoje o Android seja o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">sistema operacional m√≥vel mais popular do mundo</a> , em 5 a 10 anos a situa√ß√£o pode mudar radicalmente. <br><br>  Nos √∫ltimos anos, o Google desenvolveu secretamente o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">novo OC Fuchsia</a> com um modelo de seguran√ßa fundamentalmente diferente (comparado ao sistema operacional moderno).  Provavelmente, usar√° o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Dart</a> como a principal linguagem de programa√ß√£o e a estrutura <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Flutter</a> como a principal maneira de criar aplicativos.  H√° rumores de que o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Fuchsia pode substituir o Android e o ChromeOS</a> em todos os dispositivos.  Se o Google fizer isso, √© prov√°vel que a empresa forne√ßa suporte nativo para aplicativos criados para Android (como a Microsoft fez ao mudar do DOS para o Windows).  Portanto, at√© agora voc√™ n√£o pode se preocupar e continuar acumulando experi√™ncia no Android.  E para aqueles que querem olhar para o futuro, voc√™ pode baixar o Flutter e brincar com ele <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt416689/">https://habr.com/ru/post/pt416689/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt416679/index.html">Computa√ß√£o perif√©rica: uma combina√ß√£o amig√°vel de "nevoeiro" com "nuvens"</a></li>
<li><a href="../pt416681/index.html">Como do PostgreSQL e ClickHouse em Python muito, r√°pida e imediatamente em numpy</a></li>
<li><a href="../pt416683/index.html">O que vem a seguir? Ou como escolher recursos para desenvolvimento</a></li>
<li><a href="../pt416685/index.html">Acompanhamento do Epson ColorWorks: suas perguntas, nossas respostas</a></li>
<li><a href="../pt416687/index.html">Armazenamento QSAN como concorrente das marcas de N√≠vel 1</a></li>
<li><a href="../pt416691/index.html">Seguran√ßa de aprendizado de m√°quina: t√©cnicas eficazes de defesa ou novas amea√ßas?</a></li>
<li><a href="../pt416693/index.html">Certificados D-Link e Changing Information Technologies usados ‚Äã‚Äãpara assinar malware</a></li>
<li><a href="../pt416695/index.html">Suporte para o vSphere 6.7 e outros recursos da mais recente Veeam Backup & Replication 9.5 Update 3a</a></li>
<li><a href="../pt416697/index.html">Fus√£o de operadoras de telecomunica√ß√µes em 2018</a></li>
<li><a href="../pt416699/index.html">Atirador de elite nerd ou como fazer um "olho afiado"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>