<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ”˜ âœ… ğŸ§” å­—èŠ‚å ¡å ¡ï¼ˆåŠæ›´å¤šï¼‰ç¾å›½åŸä½æ°‘ â° â„¹ï¸ ğŸ¤‘</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="æ˜¯çš„ï¼Œæ˜¯çš„ï¼Œå®ƒæ˜¯â€œå­—èŠ‚â€ï¼Œå¹¶ä¸”æ˜¯å°åº¦æ–‡ï¼ˆä¸æ˜¯å°åº¦æ–‡ï¼‰ã€‚ æˆ‘å°†æŒ‰é¡ºåºå¼€å§‹ã€‚ æœ€è¿‘åœ¨è¿™é‡Œï¼Œåœ¨å“ˆå¸ƒé›·ï¼ˆHabrÃ©ï¼‰ä¸Šï¼Œæœ‰å…³å­—èŠ‚ç çš„æ–‡ç« å¼€å§‹å‡ºç°ã€‚ ä»å‰ï¼Œæˆ‘å¾ˆé«˜å…´ç¼–å†™Fortç³»ç»Ÿã€‚ å½“ç„¶æ˜¯åœ¨æ±‡ç¼–ç¨‹åºä¸­ã€‚ å®ƒä»¬æ˜¯16ä½çš„ã€‚ æˆ‘ä»æœªåœ¨x86-64ä¸Šç¼–ç¨‹ã€‚ è¿32éƒ½æ‰“ä¸äº†ã€‚ è¿™æ ·çš„æƒ³æ³•æ¥äº†-ä¸ºä»€ä¹ˆä¸å‘¢ï¼Ÿ ä¸ºä»€ä¹ˆä¸...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>å­—èŠ‚å ¡å ¡ï¼ˆåŠæ›´å¤šï¼‰ç¾å›½åŸä½æ°‘</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/431932/"><img src="https://habrastorage.org/getpro/habr/post_images/dbb/a59/e93/dbba59e932ecdb4b0c28896a7e6fc3e3.jpg" alt="å›¾ç‰‡"><br><br> æ˜¯çš„ï¼Œæ˜¯çš„ï¼Œå®ƒæ˜¯â€œå­—èŠ‚â€ï¼Œå¹¶ä¸”æ˜¯å°åº¦æ–‡ï¼ˆä¸æ˜¯å°åº¦æ–‡ï¼‰ã€‚ æˆ‘å°†æŒ‰é¡ºåºå¼€å§‹ã€‚ æœ€è¿‘åœ¨è¿™é‡Œï¼Œåœ¨å“ˆå¸ƒé›·ï¼ˆHabrÃ©ï¼‰ä¸Šï¼Œæœ‰å…³å­—èŠ‚ç çš„æ–‡ç« å¼€å§‹å‡ºç°ã€‚ ä»å‰ï¼Œæˆ‘å¾ˆé«˜å…´ç¼–å†™Fortç³»ç»Ÿã€‚ å½“ç„¶æ˜¯åœ¨æ±‡ç¼–ç¨‹åºä¸­ã€‚ å®ƒä»¬æ˜¯16ä½çš„ã€‚ æˆ‘ä»æœªåœ¨x86-64ä¸Šç¼–ç¨‹ã€‚ è¿32éƒ½æ‰“ä¸äº†ã€‚ è¿™æ ·çš„æƒ³æ³•æ¥äº†-ä¸ºä»€ä¹ˆä¸å‘¢ï¼Ÿ ä¸ºä»€ä¹ˆä¸æ…åŠ¨64ä½çš„å ¡å’ï¼Œç”šè‡³ä½¿ç”¨å­—èŠ‚ç ï¼Ÿ æ˜¯çš„ï¼Œåœ¨Linuxä¸Šï¼Œæˆ‘ä¹Ÿæ²¡æœ‰ç¼–å†™ä»»ä½•ç³»ç»Ÿã€‚ <br><br> æˆ‘æœ‰ä¸€å°è£…æœ‰Linuxçš„å®¶åº­æœåŠ¡å™¨ã€‚ é€šå¸¸ï¼Œæˆ‘åœ¨Googleä¸Šæœç´¢äº†ä¸€ä¸‹ï¼Œå‘ç°Linuxä¸Šçš„æ±‡ç¼–ç¨‹åºç§°ä¸ºGASï¼Œè€Œaså‘½ä»¤åˆ™ç§°ä¸ºã€‚ æˆ‘é€šè¿‡SSHè¿æ¥åˆ°æœåŠ¡å™¨ï¼Œé”®å…¥ä¸º-æ˜¯ï¼ æˆ‘å·²ç»å®‰è£…äº†ã€‚ ä»ç„¶éœ€è¦ä¸€ä¸ªé“¾æ¥å™¨ï¼Œè¾“å…¥ld-æ˜¯çš„ï¼ å› æ­¤ï¼Œå°è¯•åœ¨æ±‡ç¼–å™¨ä¸­ç¼–å†™ä¸€äº›æœ‰è¶£çš„ä¸œè¥¿ã€‚ æ²¡æœ‰æ–‡æ˜ï¼Œåªæœ‰ä¸€ç‰‡æ£®æ—ï¼Œå°±åƒçœŸæ­£çš„å°ç¬¬å®‰äººï¼š)æ²¡æœ‰å¼€å‘ç¯å¢ƒï¼Œåªæœ‰ä¸€æ¡å‘½ä»¤è¡Œå’Œåˆå¤œæŒ‡æŒ¥å®˜ã€‚ ç¼–è¾‘å™¨å°†æ˜¯Nanoï¼Œå®ƒæŒ‚åœ¨æˆ‘çš„MC F4ä¸Šã€‚  â€œé›¶â€ä¹é˜Ÿå¦‚ä½•å”±æ­Œï¼Ÿ ä¸€ä¸ªçœŸæ­£çš„å°åº¦äººåªéœ€è¦ä¸€ä»¶äº‹...ä¸€ä¸ªçœŸæ­£çš„å°åº¦äººè¿˜éœ€è¦ä»€ä¹ˆï¼Ÿ å½“ç„¶æ˜¯è°ƒè¯•å™¨ã€‚ æˆ‘ä»¬è¾“å…¥gdb-æ˜¯ï¼ å¥½å§ï¼ŒæŒ‰Shift + F4ï¼Œç„¶åå¼€å§‹ï¼ <br><a name="habracut"></a><br><h2> å»ºç­‘å­¦ </h2><br> é¦–å…ˆï¼Œè®©æˆ‘ä»¬å†³å®šæ¶æ„ã€‚ åœ¨å·²ç»ç¡®å®šä½æ·±åº¦çš„æƒ…å†µä¸‹ï¼Œä¸º64ä½ã€‚ åœ¨ç»å…¸çš„Fortå®ç°ä¸­ï¼Œæ•°æ®æ®µå’Œä»£ç æ®µç›¸åŒã€‚ ä½†æ˜¯ï¼Œæˆ‘ä»¬å°†å°½åŠ›åšåˆ°æ­£ç¡®ã€‚ æˆ‘ä»¬åªæœ‰ä»£ç æ®µä¸­çš„ä»£ç ï¼Œè€Œæ•°æ®æ®µä¸­çš„æ•°æ®ã€‚ ç»“æœï¼Œæˆ‘ä»¬å¾—åˆ°äº†å¹³å°çš„å†…æ ¸å’Œå®Œå…¨ç‹¬ç«‹äºå¹³å°çš„å­—èŠ‚ç ã€‚ <br><br> è®©æˆ‘ä»¬å°è¯•åˆ¶é€ æœ€å¿«çš„å †å å­—èŠ‚æœºå™¨ï¼ˆä½†ä¸ä½¿ç”¨JITï¼‰ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬å°†å¾—åˆ°ä¸€ä¸ªåŒ…å«256ä¸ªåœ°å€çš„è¡¨-æ¯ä¸ªå­—èŠ‚å‘½ä»¤ä¸€ä¸ªã€‚ å°‘äºä¸€åˆ‡-é¢å¤–æ£€æŸ¥ï¼Œè¿™æ˜¯1-2ä¸ªå¤„ç†å™¨æŒ‡ä»¤ã€‚ æˆ‘ä»¬éœ€è¦è¿…é€Ÿè€Œæ— å¦¥åã€‚ <br><br><h4> å †æ ˆ </h4><br> é€šå¸¸ï¼Œåœ¨Fortå®ç°ä¸­ï¼Œå¤„ç†å™¨è¿”å›å †æ ˆï¼ˆ* SPï¼‰ç”¨ä½œæ•°æ®å †æ ˆï¼Œè€ŒFortç³»ç»Ÿè¿”å›å †æ ˆæ˜¯ä½¿ç”¨å…¶ä»–æ–¹å¼å®ç°çš„ã€‚ ç¡®å®ï¼Œæˆ‘ä»¬çš„æœºå™¨å°†è¢«å †å èµ·æ¥ï¼Œå¹¶ä¸”ä¸»è¦å·¥ä½œåœ¨æ•°æ®æ ˆä¸Šã€‚ å› æ­¤ï¼Œè®©æˆ‘ä»¬åšåŒæ ·çš„äº‹æƒ…-RSPå°†æ˜¯ä¸€ä¸ªæ•°æ®å †æ ˆã€‚ å¥½å§ï¼Œè®©è¿”å›å †æ ˆä¸ºRBPï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒä¹Ÿå¯ä»¥ä¸å †æ ˆæ®µä¸€èµ·ä½¿ç”¨ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬å°†å…·æœ‰ä¸‰ä¸ªå†…å­˜æ®µï¼šä¸€ä¸ªä»£ç æ®µï¼Œä¸€ä¸ªæ•°æ®æ®µå’Œä¸€ä¸ªå †æ ˆæ®µï¼ˆå®ƒå°†åŒæ—¶å…·æœ‰æ•°æ®å †æ ˆå’Œè¿”å›å †æ ˆï¼‰ã€‚ <br><br><h4> å¯„å­˜å™¨ </h4><br> æˆ‘è¿›å…¥å¯„å­˜å™¨x86-64çš„æè¿°ï¼Œå“å‘€ï¼ ä¸32æˆ–16ä½æ¨¡å¼ç›¸æ¯”ï¼Œæœ‰å¤šè¾¾8ä¸ªå…¶ä»–é€šç”¨å¯„å­˜å™¨ï¼ˆR8-R16ï¼‰ã€‚ <br><br> å·²ç»å†³å®šä»–ä»¬å°†éœ€è¦RSPå’ŒRBPã€‚ ä»ç„¶éœ€è¦å­—èŠ‚ç å‘½ä»¤çš„æŒ‡é’ˆï¼ˆè®¡æ•°å™¨ï¼‰ã€‚ åœ¨è¯¥å¯„å­˜å™¨ä¸Šçš„æ“ä½œä¸­ï¼Œä»…éœ€è¦è¯»å–å­˜å‚¨å™¨ã€‚ ä¸»å¯„å­˜å™¨ï¼ˆRAXï¼ŒRBXï¼ŒRCXï¼ŒRDXï¼ŒRSIï¼ŒRDIï¼‰æ›´åŠ çµæ´»ï¼Œé€šç”¨ï¼Œå¹¶å…·æœ‰è®¸å¤šç‰¹æ®Šå‘½ä»¤ã€‚ å®ƒä»¬å¯¹äºæˆ‘ä»¬æ‰§è¡Œå„ç§ä»»åŠ¡å°†å¾ˆæœ‰ç”¨ï¼Œå¯¹äºå­—èŠ‚ç æŒ‡ä»¤è®¡æ•°å™¨ï¼Œæˆ‘ä»¬ä¸ºæˆ‘é€‰æ‹©ä¸€ä¸ªæ–°çš„å¯„å­˜å™¨ä½œä¸ºR8ã€‚ <br><br><h2> è®©æˆ‘ä»¬å¼€å§‹å§ </h2><br> æˆ‘æ²¡æœ‰ä½¿ç”¨æ±‡ç¼–è¯­è¨€åœ¨Linuxä¸Šç¼–ç¨‹çš„ç»éªŒã€‚ å› æ­¤ï¼Œå¯¹äºåˆå­¦è€…æ¥è¯´ï¼Œæˆ‘ä»¬å°†æ‰¾åˆ°å®Œæˆçš„â€œä¸–ç•Œæ‚¨å¥½â€ï¼Œä»¥äº†è§£ç¨‹åºå¦‚ä½•å¯åŠ¨å¹¶æ˜¾ç¤ºæ–‡å­—ã€‚ å‡ºä¹æˆ‘æ„æ–™çš„æ˜¯ï¼Œæˆ‘å‘ç°äº†å…·æœ‰å¥‡æ€ªè¯­æ³•çš„é€‰é¡¹ï¼Œå…¶ä¸­ç”šè‡³é‡æ–°å®‰æ’äº†æºå’Œæ¥æ”¶å™¨ã€‚ äº‹å®è¯æ˜ï¼Œè¿™æ˜¯ATï¼†Tè¯­æ³•ï¼Œå®ƒä¸»è¦æ˜¯ç”¨GASç¼–å†™çš„ã€‚ ä½†æ˜¯æ”¯æŒå¦ä¸€ä¸ªè¯­æ³•é€‰é¡¹ï¼Œç§°ä¸ºIntelè¯­æ³•ã€‚ æ€è€ƒä¹‹åï¼Œæˆ‘å†³å®šå…¨éƒ¨ä½¿ç”¨ã€‚ å¥½å§ï¼Œåœ¨.intel_syntax noprefixçš„å¼€å¤´å†™ã€‚ <br><br> ç¼–è¯‘å¹¶æ‰§è¡Œâ€œ Helloï¼Œworldâ€ä»¥ç¡®ä¿ä¸€åˆ‡æ­£å¸¸ã€‚ é€šè¿‡é˜…è¯»å¸®åŠ©å’Œå®éªŒï¼Œæˆ‘å¼€å§‹ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿›è¡Œç¼–è¯‘ï¼š <br> <code>$ as fort.asm -o fort.o -g -ahlsm &gt;list.txt</code> <br> åœ¨æ­¤ï¼Œ-oå¼€å…³æŒ‡ç¤ºç»“æœæ–‡ä»¶ï¼Œ-gå¼€å…³æŒ‡ç¤ºç”Ÿæˆè°ƒè¯•ä¿¡æ¯ï¼Œè€Œ-ahlsmå¼€å…³è®¾ç½®åˆ—è¡¨æ ¼å¼ã€‚ æˆ‘å°†è¾“å‡ºä¿ç•™åœ¨æ¸…å•ä¸­ï¼Œæ‚¨å¯ä»¥åœ¨å…¶ä¸­çœ‹åˆ°å¾ˆå¤šæœ‰ç”¨çš„ä¸œè¥¿ã€‚ æˆ‘æ‰¿è®¤ï¼Œåœ¨å·¥ä½œå¼€å§‹æ—¶æˆ‘æ²¡æœ‰åˆ—å‡ºæ¸…å•ï¼Œç”šè‡³æ²¡æœ‰æŒ‡å®š-gå¼€å…³ã€‚ ç¬¬ä¸€æ¬¡ä½¿ç”¨è°ƒè¯•å™¨åï¼Œæˆ‘å¼€å§‹ä½¿ç”¨-gå¼€å…³ï¼Œå¹¶ä¸”åœ¨ä»£ç ä¸­å‡ºç°å®ä¹‹åå¼€å§‹è¿›è¡Œæ¸…å•:) <br><br> åœ¨é‚£ä¹‹åï¼Œæˆ‘ä»¬ä½¿ç”¨é“¾æ¥å™¨ï¼Œä½†æ˜¯è¿™é‡Œæ²¡æœ‰æ¯”è¿™æ›´ç®€å•çš„äº†ï¼š <br><br> <code>$ ld forth.o -o forth</code> <br> å¥½å§ï¼Œå¿«è·‘ï¼ <br> <code>$ ./forth <br> Hello, world!</code> <br> å¯ä»¥ç”¨ <br><br><div class="spoiler">  <b class="spoiler_title">è¿™æ˜¯ç¬¬ä¸€ä¸ªfirst.asmï¼ˆå®é™…ä¸Šæ˜¯â€œ Hellowï¼Œworldï¼â€ï¼Œå½“ç„¶ï¼‰</b> <div class="spoiler_text"><pre> <code class="cpp hljs">.intel_syntax noprefix .section .data msg: .ascii <span class="hljs-string"><span class="hljs-string">"Hello, world!\n"</span></span> len = . - msg #  len    .section .text .global _start #     _start: mov eax, <span class="hljs-number"><span class="hljs-number">4</span></span> #   â„– <span class="hljs-number"><span class="hljs-number">4</span></span> â€” sys_write mov ebx, <span class="hljs-number"><span class="hljs-number">1</span></span> #  â„– <span class="hljs-number"><span class="hljs-number">1</span></span> â€” <span class="hljs-built_in"><span class="hljs-built_in">stdout</span></span> mov ecx, OFFSET FLAT:msg #     mov edx, len #   <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-number"><span class="hljs-number">0x80</span></span> #   mov eax, <span class="hljs-number"><span class="hljs-number">1</span></span> #   â„– <span class="hljs-number"><span class="hljs-number">1</span></span> â€” sys_exit xor ebx, ebx #    <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-number"><span class="hljs-number">0x80</span></span> #  </code> </pre> <br> é¡ºä¾¿è¯´ä¸€å¥ï¼Œç¨åæˆ‘å‘ç°åœ¨x86-64ä¸­ä½¿ç”¨syscallè¿›è¡Œç³»ç»Ÿè°ƒç”¨æ¯”ä½¿ç”¨int 0x80æ›´æ­£ç¡®ã€‚ å°½ç®¡æ”¯æŒè¯¥æ¶æ„ï¼Œä½†0x80è°ƒç”¨è¢«è®¤ä¸ºå·²è¿‡æ—¶ã€‚ <br></div></div><br> å·²ç»å¼€å§‹ï¼Œç°åœ¨... <br><br><h2> èµ°å§ </h2><br> è‡³å°‘ä¼šæœ‰ä¸€äº›ç»†èŠ‚ï¼Œæˆ‘ä»¬å°†ç¼–å†™ä¸€ä¸ªå­—èŠ‚å‘½ä»¤çš„ä»£ç ã€‚ è®©å®ƒæˆä¸ºFortå•è¯â€œ 0â€ï¼Œå°†0æ”¾åœ¨æ ˆé¡¶ï¼š <br><br><pre> <code class="cpp hljs">bcmd_num0: push <span class="hljs-number"><span class="hljs-number">0</span></span> jmp _next</code> </pre><br> åœ¨æ‰§è¡Œè¯¥å‘½ä»¤æ—¶ï¼ŒR8å·²ç»æŒ‡å‘ä¸‹ä¸€ä¸ªå­—èŠ‚å‘½ä»¤ã€‚ å¿…é¡»è¯»å–å®ƒï¼Œå¢åŠ R8ï¼Œé€šè¿‡å­—èŠ‚å‘½ä»¤çš„ä»£ç ç¡®å®šå¯æ‰§è¡Œåœ°å€ï¼Œå¹¶å°†æ§åˆ¶æƒè½¬ç§»ç»™å®ƒã€‚ <br><br> ä½†æ˜¯...å­—èŠ‚å‘½ä»¤åœ°å€è¡¨å°†æ˜¯å¤šå°‘ä½æ·±åº¦ï¼Ÿ ç„¶åï¼Œæˆ‘ä¸å¾—ä¸ä¸ºæˆ‘æ·±å…¥ç ”ç©¶æ–°çš„x86-64å‘½ä»¤ç³»ç»Ÿã€‚  lasï¼Œæˆ‘æ‰¾ä¸åˆ°å…è®¸æ‚¨è½¬åˆ°å†…å­˜åç§»é‡çš„å‘½ä»¤ã€‚ å› æ­¤ï¼Œè¦ä¹ˆè®¡ç®—åœ°å€ï¼Œè¦ä¹ˆåœ°å€å°†å‡†å¤‡å¥½-64ä½ã€‚ æˆ‘ä»¬æ²¡æœ‰æ—¶é—´è¿›è¡Œè®¡ç®—ï¼Œè¿™æ„å‘³ç€-64ä½ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¡¨å¤§å°å°†ä¸º256 * 8 = 4096å­—èŠ‚ã€‚ å¥½äº†ï¼Œæœ€åï¼Œå¯¹_nextè°ƒç”¨è¿›è¡Œç¼–ç ï¼š <br><br><pre> <code class="cpp hljs">_next: movzx rcx, byte ptr [r8] inc r8 jmp [bcmd + rcx*<span class="hljs-number"><span class="hljs-number">8</span></span>] <span class="hljs-meta"><span class="hljs-meta"># bcmd -   -</span></span></code> </pre><br> ä»æˆ‘çœ‹æ¥ï¼Œè¿˜ä¸é”™ã€‚ä»ä¸€ä¸ªå­—èŠ‚å‘½ä»¤åˆ‡æ¢åˆ°å¦ä¸€ä¸ªå­—èŠ‚å‘½ä»¤æ—¶ï¼Œåªæœ‰ä¸‰ä¸ªå¤„ç†å™¨æŒ‡ä»¤ã€‚ <br><br> å®é™…ä¸Šï¼Œè¿™äº›å‘½ä»¤å¯¹æˆ‘è€Œè¨€å¹¶ä¸é‚£ä¹ˆå®¹æ˜“ã€‚ æˆ‘ä¸å¾—ä¸å†æ¬¡ç ”ç©¶0x86-64å‘½ä»¤ç³»ç»Ÿï¼Œå¹¶ä¸ºæˆ‘æ‰¾åˆ°ä¸€ä¸ªæ–°çš„MOVZXå‘½ä»¤ã€‚ å®é™…ä¸Šï¼Œæ­¤å‘½ä»¤å°†8ã€16æˆ–32ä½çš„å€¼è½¬æ¢ä¸º64ä½å¯„å­˜å™¨ã€‚ æ­¤å‘½ä»¤æœ‰ä¸¤ç§å˜ä½“ï¼šæ— ç¬¦å·ï¼Œå…¶ä¸­è¾ƒé«˜çš„æ•°å­—ç”¨é›¶å¡«å……ï¼Œè€Œæœ‰ç¬¦å·çš„ä¸ºMOVSXã€‚ åœ¨æ­£è´Ÿå·å˜ä½“ä¸­ï¼Œæ­£è´Ÿå·ä¼šå±•å¼€ï¼Œå³å¯¹äºæ­£æ•°ï¼Œé›¶å°†ç§»è‡³è¾ƒé«˜çš„æ•°å­—ï¼Œå¯¹äºè´Ÿæ•°ï¼Œå°†æ‰©è‡³é›¶ã€‚ è¿™ä¸ªé€‰é¡¹å¯¹æˆ‘ä»¬ç‚¹äº®å­—èŠ‚å‘½ä»¤ä¹Ÿå¾ˆæœ‰ç”¨ã€‚ <br><br> é¡ºä¾¿è¯´ä¸€å¥ï¼Œè¿™ä¸ªé€‰é¡¹æœ€å¿«å—ï¼Ÿ ä¹Ÿè®¸æœ‰äººä¼šå»ºè®®æ›´å¿«ï¼Ÿ <br><br> å¥½äº†ï¼Œç°åœ¨æˆ‘ä»¬æœ‰äº†ä¸€ä¸ªå­—èŠ‚æœºï¼Œå®ƒå¯ä»¥è¿è¡Œä¸€ç³»åˆ—å­—èŠ‚å‘½ä»¤å¹¶æ‰§è¡Œå®ƒä»¬ã€‚ æœ‰å¿…è¦åœ¨å®è·µä¸­è¿›è¡Œæµ‹è¯•ï¼Œä»¥å¼ºåˆ¶æ‰§è¡Œè‡³å°‘ä¸€ä¸ªå›¢é˜Ÿã€‚ ä½†æ˜¯å“ªä¸€ä¸ªå‘¢ï¼Ÿ é›¶æ ˆï¼Ÿ ä½†æ˜¯ï¼Œå¦‚æœæ‚¨ä¸çœ‹è°ƒè¯•å™¨ä¸‹çš„å †æ ˆï¼Œè¿™é‡Œç”šè‡³éƒ½ä¸çŸ¥é“ç»“æœã€‚ä½†æ˜¯å¦‚æœç¨‹åºå¯åŠ¨äº†ï¼Œå°±å¯ä»¥å®Œæˆ:) <br><br> æˆ‘ä»¬ç¼–å†™äº†ä¸€ä¸ªå†è§å‘½ä»¤æ¥å®Œæˆç¨‹åºå¹¶ç¼–å†™ç¨‹åºï¼Œç‰¹åˆ«æ˜¯å› ä¸ºæˆ‘ä»¬æ‹¥æœ‰â€œ Hellowï¼Œworldï¼â€ã€‚ <br><br><pre> <code class="cpp hljs">bcmd_bye: mov eax, <span class="hljs-number"><span class="hljs-number">4</span></span> #   â„– <span class="hljs-number"><span class="hljs-number">4</span></span> â€” sys_write mov ebx, <span class="hljs-number"><span class="hljs-number">1</span></span> #  â„– <span class="hljs-number"><span class="hljs-number">1</span></span> â€” <span class="hljs-built_in"><span class="hljs-built_in">stdout</span></span> mov ecx, offset msg_bye #     mov edx, msg_bye_len #   <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-number"><span class="hljs-number">0x80</span></span> #   mov eax, <span class="hljs-number"><span class="hljs-number">1</span></span> #   â„– <span class="hljs-number"><span class="hljs-number">1</span></span> â€” sys_exit mov ebx, <span class="hljs-number"><span class="hljs-number">0</span></span> #    <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-number"><span class="hljs-number">0x80</span></span> #  </code> </pre><br> å‰©ä¸‹çš„å”¯ä¸€äº‹æƒ…å°±æ˜¯åˆ›å»ºä¸€ä¸ªå­—èŠ‚å‘½ä»¤åœ°å€è¡¨ï¼Œåˆå§‹åŒ–å¯„å­˜å™¨ï¼Œç„¶åå¯åŠ¨å­—èŠ‚æœºã€‚ å› æ­¤...è¡¨ä¸­æœ‰256ä¸ªå€¼ï¼Œå¹¶ä¸”æœ‰ä¸¤ä¸ªå‘½ä»¤ã€‚ å…¶ä»–å•å…ƒä¸­æœ‰ä»€ä¹ˆï¼Ÿ <br> å…¶ä½™çš„å°†å…·æœ‰æ— æ•ˆçš„æ“ä½œä»£ç ã€‚ ä½†æ˜¯ï¼Œæ‚¨æ— æ³•å¯¹æ­¤è¿›è¡Œæ£€æŸ¥ï¼Œè¿™æ˜¯é¢å¤–çš„å›¢é˜Ÿï¼Œæˆ‘ä»¬ç°åœ¨æœ‰3ä¸ªå›¢é˜Ÿï¼Œè€Œé€‰ä¸­çš„å›¢é˜Ÿå°†æ˜¯5ä¸ªã€‚ å› æ­¤ï¼Œæˆ‘ä»¬å°†å‘å‡ºè¿™æ ·ä¸€ä¸ªå­˜æ ¹å‘½ä»¤-ä¸€ä¸ªç³Ÿç³•çš„å›¢é˜Ÿã€‚ é¦–å…ˆï¼Œæˆ‘ä»¬ä¸ºå…¶å¡«å……æ•´ä¸ªè¡¨æ ¼ï¼Œç„¶åå¼€å§‹ä½¿ç”¨æœ‰ç”¨çš„å‘½ä»¤æ¥å æ®å•å…ƒæ ¼ã€‚ è®©ä¸€ä¸ªåå›¢é˜Ÿçš„ä»£ç ä¸º0x00ï¼Œå†è§å›¢é˜Ÿçš„ä»£ç ä¸º0x01ï¼Œä¸€æ—¦å†™å®Œï¼Œâ€œ 0â€çš„ä»£ç ä¸º0x02ã€‚ ç°åœ¨ï¼Œç³Ÿç³•çš„å›¢é˜Ÿå°†ä¸å†è§ç›¸åŒï¼Œåªæ˜¯ä½¿ç”¨ä¸åŒçš„å®Œæˆä»£ç å’Œæ–‡å­—ï¼ˆæˆ‘å°†å…¶æ”¾å…¥æ‰°æµæ¿ä¸­ï¼Œä¸å†è§å‡ ä¹ç›¸åŒï¼‰ï¼š <br><br><div class="spoiler">  <b class="spoiler_title">bcmd_bad</b> <div class="spoiler_text"><pre> <code class="cpp hljs">bcmd_bad: mov eax, <span class="hljs-number"><span class="hljs-number">4</span></span> #   â„– <span class="hljs-number"><span class="hljs-number">4</span></span> â€” sys_write mov ebx, <span class="hljs-number"><span class="hljs-number">1</span></span> #  â„– <span class="hljs-number"><span class="hljs-number">1</span></span> â€” <span class="hljs-built_in"><span class="hljs-built_in">stdout</span></span> mov ecx, offset msg_bad_byte #     mov edx, msg_bad_byte_len #   <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-number"><span class="hljs-number">0x80</span></span> #   mov eax, <span class="hljs-number"><span class="hljs-number">1</span></span> #   â„– <span class="hljs-number"><span class="hljs-number">1</span></span> â€” sys_exit mov ebx, <span class="hljs-number"><span class="hljs-number">1</span></span> #    <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-number"><span class="hljs-number">0x80</span></span> #  </code> </pre> </div></div> ç°åœ¨ç»˜åˆ¶ä¸€ä¸ªåœ°å€è¡¨ã€‚ ä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œæˆ‘ä»¬å°†æ¯è¡Œæ”¾ç½®8è¡Œï¼Œæ€»å…±16è¡Œï¼Œè¯¥è¡¨çš„å¤§å°éå¸¸å¤§ï¼š <br><br><div class="spoiler">  <b class="spoiler_title">å­—èŠ‚å‘½ä»¤åœ°å€è¡¨</b> <div class="spoiler_text"><pre> <code class="cpp hljs">bcmd: .quad bcmd_bad, bcmd_bye, bcmd_num0, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad</code> </pre> </div></div> æˆ‘ä»¬ç¼–å†™å­—èŠ‚ç¨‹åºçš„ä¸»ä½“ã€‚ ä¸ºæ­¤ï¼Œå°†å‘½ä»¤ä»£ç åˆ†é…ç»™æ±‡ç¼–ç¨‹åºå˜é‡ã€‚ æˆ‘ä»¬å°†ç­¾è®¢ä»¥ä¸‹åè®®ï¼š <br><br><ul><li> æ‰§è¡Œå­—èŠ‚å‘½ä»¤çš„åœ°å€å°†ä»bcmd_å¼€å§‹ </li><li> å‘½ä»¤ä»£ç æœ¬èº«å°†å­˜å‚¨åœ¨ä»¥b_å¼€å¤´çš„å˜é‡ä¸­ </li></ul><br> å› æ­¤ï¼Œå­—èŠ‚ç¨‹åºçš„ä¸»ä½“å°†å¦‚ä¸‹æ‰€ç¤ºï¼š <br><br><pre> <code class="cpp hljs">start: .byte b_bye</code> </pre><br> å°†æ•°æ®å †æ ˆçš„å¤§å°å£°æ˜ä¸ºstack_sizeã€‚ ä½¿å…¶åˆ°ç›®å‰ä¸ºæ­¢ä¸º1024ã€‚åœ¨åˆå§‹åŒ–æ—¶ï¼Œæˆ‘ä»¬å°†æ‰§è¡ŒRBP = RSP-stack_sizeã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">å®é™…ä¸Šï¼Œæˆ‘ä»¬å¾—åˆ°äº†è¿™æ ·çš„ç¨‹åºä»£ç ï¼ˆforth.asmï¼‰</b> <div class="spoiler_text"><pre> <code class="cpp hljs">.intel_syntax noprefix stack_size = <span class="hljs-number"><span class="hljs-number">1024</span></span> .section .data msg_bad_byte: .ascii <span class="hljs-string"><span class="hljs-string">"Bad byte code!\n"</span></span> msg_bad_byte_len = . - msg_bad_byte #  len    msg_bye: .ascii <span class="hljs-string"><span class="hljs-string">"bye!\n"</span></span> msg_bye_len = . - msg_bye msg_hello: .ascii <span class="hljs-string"><span class="hljs-string">"Hello, world!\n"</span></span> msg_hello_len = . - msg_hello bcmd: .quad bcmd_bad, bcmd_bye, bcmd_num0, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad start: .byte b_bye .section .text .global _start #     _start: mov rbp, rsp sub rbp, stack_size lea r8, start jmp _next _next: movzx rcx, byte ptr [r8] inc r8 jmp [bcmd + rcx*<span class="hljs-number"><span class="hljs-number">8</span></span>] b_bad = <span class="hljs-number"><span class="hljs-number">0x00</span></span> bcmd_bad: mov eax, <span class="hljs-number"><span class="hljs-number">4</span></span> #   â„– <span class="hljs-number"><span class="hljs-number">4</span></span> â€” sys_write mov ebx, <span class="hljs-number"><span class="hljs-number">1</span></span> #  â„– <span class="hljs-number"><span class="hljs-number">1</span></span> â€” <span class="hljs-built_in"><span class="hljs-built_in">stdout</span></span> mov ecx, offset msg_bad_byte #     mov edx, msg_bad_byte_len #   <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-number"><span class="hljs-number">0x80</span></span> #   mov eax, <span class="hljs-number"><span class="hljs-number">1</span></span> #   â„– <span class="hljs-number"><span class="hljs-number">1</span></span> â€” sys_exit mov ebx, <span class="hljs-number"><span class="hljs-number">1</span></span> #    <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-number"><span class="hljs-number">0x80</span></span> #   b_bye = <span class="hljs-number"><span class="hljs-number">0x01</span></span> bcmd_bye: mov eax, <span class="hljs-number"><span class="hljs-number">4</span></span> #   â„– <span class="hljs-number"><span class="hljs-number">4</span></span> â€” sys_write mov ebx, <span class="hljs-number"><span class="hljs-number">1</span></span> #  â„– <span class="hljs-number"><span class="hljs-number">1</span></span> â€” <span class="hljs-built_in"><span class="hljs-built_in">stdout</span></span> mov ecx, offset msg_bye #     mov edx, msg_bye_len #   <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-number"><span class="hljs-number">0x80</span></span> #   mov eax, <span class="hljs-number"><span class="hljs-number">1</span></span> #   â„– <span class="hljs-number"><span class="hljs-number">1</span></span> â€” sys_exit mov ebx, <span class="hljs-number"><span class="hljs-number">0</span></span> #    <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-number"><span class="hljs-number">0x80</span></span> #   b_num0 = <span class="hljs-number"><span class="hljs-number">0x02</span></span> bcmd_num0: push <span class="hljs-number"><span class="hljs-number">0</span></span> jmp _next</code> </pre><br></div></div><br> ç¼–è¯‘ï¼Œè¿è¡Œï¼š <br><br> <code>$ as fort.asm -o fort.o -g -ahlsm &gt;list.txt <br> $ ld forth.o -o forth <br> $ ./forth <br> bye! <br></code> <br> æœ‰æ•ˆï¼ æˆ‘ä»¬ä»ä¸€ä¸ªå­—èŠ‚å¼€å§‹çš„ç¬¬ä¸€ä¸ªå­—èŠ‚ç ç¨‹åºå¯åŠ¨äº†:) <br> å½“ç„¶ï¼Œå¦‚æœä¸€åˆ‡éƒ½æ­£ç¡®å®Œæˆï¼Œæƒ…å†µå°†ä¼šå¦‚æ­¤ã€‚ å¦‚æœæ²¡æœ‰ï¼Œé‚£ä¹ˆç»“æœå¯èƒ½æ˜¯è¿™æ ·çš„ï¼š <br><br> <code>$ ./forth <br>   <br></code> <br> å½“ç„¶ï¼Œå…¶ä»–é€‰æ‹©ä¹Ÿæ˜¯å¯è¡Œçš„ï¼Œä½†æ˜¯æˆ‘ç»å¸¸é‡åˆ°è¿™ç§æƒ…å†µã€‚ æˆ‘ä»¬éœ€è¦ä¸€ä¸ªè°ƒè¯•å™¨ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">è°ƒè¯•å™¨æ­Œè¯</b> <div class="spoiler_text"> å¦‚å‰æ‰€è¿°ï¼Œæˆ‘ä½¿ç”¨äº†GDBã€‚ è¿™æ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„è°ƒè¯•å™¨ï¼Œä½†æ˜¯å…·æœ‰å‘½ä»¤è¡Œç•Œé¢ã€‚ è¿è¡Œå®ƒéå¸¸ç®€å•ï¼š <br><br><pre> <code class="plaintext hljs">$ gdb ./forth GNU gdb (Ubuntu 7.11.1-0ubuntu1~16.5) 7.11.1 Copyright (C) 2016 Free Software Foundation, Inc. License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt; This is free software: you are free to change and redistribute it. There is NO WARRANTY, to the extent permitted by law. Type "show copying" and "show warranty" for details. This GDB was configured as "x86_64-linux-gnu". Type "show configuration" for configuration details. For bug reporting instructions, please see: &lt;http://www.gnu.org/software/gdb/bugs/&gt;. Find the GDB manual and other documentation resources online at: &lt;http://www.gnu.org/software/gdb/documentation/&gt;. For help, type "help". Type "apropos word" to search for commands related to "word"... Reading symbols from ./forth...done. (gdb)</code> </pre> <br> æ¥ä¸‹æ¥ï¼Œé€šè¿‡è¾“å…¥å‘½ä»¤ï¼Œæˆ‘ä»¬è¿›è¡Œè°ƒè¯•ã€‚ æˆ‘æœ‰è¶³å¤Ÿçš„æ—¶é—´æ¥æŸ¥æ‰¾ä¸€äº›å¿…è¦çš„å‘½ä»¤ï¼Œå¹¶å­¦ä¹ å¦‚ä½•ä½¿ç”¨å®ƒä»¬è¿›è¡Œè°ƒè¯•ã€‚ å®ƒä»¬æ˜¯ï¼š <br>  b &lt;label&gt;-è®¾ç½®ä¸€ä¸ªæ–­ç‚¹ <br>  l &lt;label&gt;-æŸ¥çœ‹æºä»£ç  <br>  r-å¯åŠ¨æˆ–é‡æ–°å¯åŠ¨ç¨‹åº <br>  ir-æŸ¥çœ‹å¤„ç†å™¨å¯„å­˜å™¨çŠ¶æ€ <br>  s-æ­¥éª¤ <br><br> é¡ºä¾¿è¯´ä¸€å¥ï¼Œè¿˜è®°å¾—æ‚¨éœ€è¦ä½¿ç”¨-gå¼€å…³ç¼–è¯‘ç¨‹åºå—ï¼Ÿ å¦åˆ™ï¼Œæ ‡ç­¾å’Œæºä»£ç å°†ä¸å¯ç”¨ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä»…é€šè¿‡åæ±‡ç¼–ä»£ç è¿›è¡Œè°ƒè¯•å³å¯ä½¿ç”¨å†…å­˜ä¸­çš„åœ°å€ã€‚ æˆ‘ä»¬å½“ç„¶æ˜¯å°ç¬¬å®‰äººï¼Œä½†ç¨‹åº¦ä¸ä¸€æ ·... </div></div><br> ä½†æ˜¯ä»¥æŸç§æ–¹å¼ï¼Œè¯¥ç¨‹åºå‡ ä¹æ²¡æœ‰ä½œç”¨ã€‚ æˆ‘ä»¬åªå¯¹å¥¹è¯´â€œä½ å¥½â€ï¼Œå¥¹ç«‹å³è¯´â€œå†è§ï¼â€ã€‚ è®©æˆ‘ä»¬æˆä¸ºçœŸæ­£çš„â€œ Hello worldï¼â€ åœ¨å­—èŠ‚ç ä¸Šã€‚ ä¸ºæ­¤ï¼Œå°†åœ°å€å’Œå­—ç¬¦ä¸²é•¿åº¦æ”¾åœ¨å †æ ˆä¸Šï¼Œç„¶åæ‰§è¡Œæ˜¾ç¤ºå­—ç¬¦ä¸²çš„å‘½ä»¤ï¼Œå†æ‰§è¡Œå†è§å‘½ä»¤ã€‚ ä¸ºæ­¤ï¼Œéœ€è¦æ–°çš„å‘½ä»¤ï¼šé”®å…¥ä»¥è¾“å‡ºå­—ç¬¦ä¸²ï¼Œå¹¶ç‚¹äº®ä»¥æ”¾ç½®å­—ç¬¦ä¸²çš„åœ°å€å’Œé•¿åº¦ã€‚ é¦–å…ˆæˆ‘ä»¬å†™ç±»å‹ï¼Œè®©å®ƒçš„ä»£ç ä¸º0x80ã€‚ åŒæ ·ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨sys_writeè°ƒç”¨çš„é‚£æ®µä»£ç ï¼š <br><br><pre> <code class="cpp hljs">b_type = <span class="hljs-number"><span class="hljs-number">0x80</span></span> bcmd_type: mov eax, <span class="hljs-number"><span class="hljs-number">4</span></span> #   â„– <span class="hljs-number"><span class="hljs-number">4</span></span> â€” sys_write mov ebx, <span class="hljs-number"><span class="hljs-number">1</span></span> #  â„– <span class="hljs-number"><span class="hljs-number">1</span></span> â€” <span class="hljs-built_in"><span class="hljs-built_in">stdout</span></span> pop rdx pop rcx push r8 <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-number"><span class="hljs-number">0x80</span></span> #   pop r8 jmp _next</code> </pre><br> åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨POPå‘½ä»¤ä»æ•°æ®å †æ ˆä¸­è·å–åœ°å€å’Œå­—ç¬¦ä¸²é•¿åº¦ã€‚ è°ƒç”¨int 0x80å¯ä»¥æ›´æ”¹R8çš„å¯„å­˜å™¨ï¼Œå› æ­¤æˆ‘ä»¬å°†å…¶ä¿å­˜ã€‚ æˆ‘ä»¬ä¹‹å‰æ²¡æœ‰è¿™æ ·åšï¼Œå› ä¸ºç¨‹åºå³å°†ç»“æŸã€‚ è¿™äº›å¯„å­˜å™¨çš„å†…å®¹æ— å…³ç´§è¦ã€‚ ç°åœ¨è¿™æ˜¯ä¸€ä¸ªå¸¸è§„çš„å­—èŠ‚å‘½ä»¤ï¼Œæ­¤åå­—èŠ‚ä»£ç å°†ç»§ç»­æ‰§è¡Œï¼Œæ‚¨éœ€è¦è¡¨ç°å‡ºè‡ªå·±çš„è¡Œä¸ºã€‚ <br><br> ç°åœ¨è®©æˆ‘ä»¬æ¥å†™ç‚¹ç¯ã€‚ è¿™å°†æ˜¯æˆ‘ä»¬å¸¦å‚æ•°çš„ç¬¬ä¸€æ”¯é˜Ÿä¼ã€‚ åœ¨å¸¦æœ‰è¯¥å‘½ä»¤ä»£ç çš„å­—èŠ‚ä¹‹åï¼Œå°†åŒ…å«åŒ…å«è¦æ”¾å…¥å †æ ˆçš„æ•°å­—çš„å­—èŠ‚ã€‚ é—®é¢˜ç«‹å³å‡ºç°-è¿™é‡Œéœ€è¦ä»€ä¹ˆä½æ·±åº¦ï¼Ÿ è¦è¾“å…¥ä»»ä½•æ•°å­—ï¼Œæ‚¨éœ€è¦64ä½ã€‚ ä½†æ˜¯ï¼Œå‘½ä»¤æ¯æ¬¡å ç”¨9ä¸ªå­—èŠ‚æ—¶ï¼Œå°†æ”¾ç½®ä¸€ä¸ªæ•°å­—æ˜¯ä»€ä¹ˆï¼Ÿ å› æ­¤æˆ‘ä»¬å¤±å»äº†ç´§å‡‘æ€§ï¼Œè¿™æ˜¯å­—èŠ‚ç çš„ä¸»è¦å±æ€§ä¹‹ä¸€ï¼Œè€Œä¸”å ¡çš„ä»£ç ä¹Ÿ... <br><br> è§£å†³æ–¹æ¡ˆå¾ˆç®€å•-æˆ‘ä»¬å°†é’ˆå¯¹ä¸åŒçš„ä½æ·±åº¦å‘å‡ºå¤šä¸ªå‘½ä»¤ã€‚ è¿™äº›å°†æ˜¯lit8ï¼Œlit16ï¼Œlit32å’Œlit64ã€‚ å¯¹äºè¾ƒå°çš„æ•°å­—ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨lit8å’Œlit16ï¼Œå¯¹äºè¾ƒå¤§çš„æ•°å­—-æˆ‘ä»¬å°†ä½¿ç”¨lit32å’Œlit64ã€‚ å°æ•°å­—æ˜¯æœ€å¸¸ç”¨çš„ï¼Œå¯¹äºå®ƒä»¬ï¼Œå°†ä½¿ç”¨æœ€çŸ­çš„å‘½ä»¤ï¼Œè¯¥å‘½ä»¤å ç”¨ä¸¤ä¸ªå­—èŠ‚ã€‚ ä¸é”™ï¼..æˆ‘ä»¬å°†ä½¿è¿™äº›å‘½ä»¤çš„ä»£ç ä¸º0x08-0x0Bã€‚ <br><br><pre> <code class="cpp hljs">b_lit8 = <span class="hljs-number"><span class="hljs-number">0x08</span></span> bcmd_lit8: movsx rax, byte ptr [r8] inc r8 push rax jmp _next b_lit16 = <span class="hljs-number"><span class="hljs-number">0x09</span></span> bcmd_lit16: movsx rax, word ptr [r8] add r8, <span class="hljs-number"><span class="hljs-number">2</span></span> push rax jmp _next b_lit32 = <span class="hljs-number"><span class="hljs-number">0x0A</span></span> bcmd_lit32: movsx rax, dword ptr [r8] add r8, <span class="hljs-number"><span class="hljs-number">4</span></span> push rax jmp _next b_lit64 = <span class="hljs-number"><span class="hljs-number">0x0B</span></span> bcmd_lit64: mov rax, [r8] add r8, <span class="hljs-number"><span class="hljs-number">8</span></span> push rax jmp _next</code> </pre> <br> åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨MOVSXå‘½ä»¤-è¿™æ˜¯æˆ‘ä»¬å·²ç»çŸ¥é“çš„MOVZXå‘½ä»¤çš„æ ‡å¿—æ€§ç‰ˆæœ¬ã€‚  R8æˆ‘ä»¬æœ‰ä¸€ä¸ªå­—èŠ‚å‘½ä»¤è®¡æ•°å™¨ã€‚ æˆ‘ä»¬åœ¨å…¶ä¸ŠåŠ è½½æ‰€éœ€å¤§å°çš„å€¼ï¼Œå°†å…¶ç§»è‡³ä¸‹ä¸€ä¸ªå‘½ä»¤ï¼Œç„¶åå°†è½¬æ¢ä¸º64ä½çš„å€¼æ”¾å…¥å †æ ˆä¸­ã€‚ <br><br>  <b>ä¸è¦å¿˜è®°å°†è¡¨ä¸­æ–°å›¢é˜Ÿçš„åœ°å€æ·»åŠ åˆ°æ‰€éœ€ä½ç½®ã€‚</b> <br><br> å‡†å¤‡ç¼–å†™æ‚¨çš„ç¬¬ä¸€ä¸ªç¨‹åºâ€œ Helloï¼Œworldï¼â€ åœ¨æˆ‘ä»¬çš„å­—èŠ‚ç ä¸Šã€‚ è®©æˆ‘ä»¬ä½¿ç”¨ç¼–è¯‘å™¨ï¼  :) <br><br><pre> <code class="cpp hljs">start: .byte b_lit64 .quad msg_hello .byte b_lit8 .byte msg_hello_len .byte b_type .byte b_bye</code> </pre> <br> æˆ‘ä»¬ä½¿ç”¨äº†ä¸¤ä¸ªä¸åŒçš„litå‘½ä»¤ï¼šlit64ï¼ˆå°†å­—ç¬¦ä¸²çš„åœ°å€æ”¾ç½®åœ¨å †æ ˆä¸­ï¼‰å’Œlit8ï¼ˆå°†å…¶é•¿åº¦æ”¾ç½®åœ¨å †æ ˆä¸­ï¼‰ã€‚ æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†æ‰§è¡Œä¸¤ä¸ªå­—èŠ‚å‘½ä»¤ï¼štypeå’Œbyeã€‚ <br> ç¼–è¯‘ï¼Œè¿è¡Œï¼š <br><br><pre> <code class="plaintext hljs">$ as fort.asm -o fort.o -g -ahlsm &gt;list.txt $ ld forth.o -o forth $ ./forth Hello, world! bye!</code> </pre><br> èµšäº†æˆ‘ä»¬çš„å­—èŠ‚ç ï¼ å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œè¿™åº”è¯¥æ˜¯ç»“æœã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">å…¨æ–‡</b> <div class="spoiler_text"><pre> <code class="cpp hljs">.intel_syntax noprefix stack_size = <span class="hljs-number"><span class="hljs-number">1024</span></span> .section .data msg_bad_byte: .ascii <span class="hljs-string"><span class="hljs-string">"Bad byte code!\n"</span></span> msg_bad_byte_len = . - msg_bad_byte #  len    msg_bye: .ascii <span class="hljs-string"><span class="hljs-string">"bye!\n"</span></span> msg_bye_len = . - msg_bye msg_hello: .ascii <span class="hljs-string"><span class="hljs-string">"Hello, world!\n"</span></span> msg_hello_len = . - msg_hello bcmd: .quad bcmd_bad, bcmd_bye, bcmd_num0, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad # <span class="hljs-number"><span class="hljs-number">0x00</span></span> .quad bcmd_lit8, bcmd_lit16, bcmd_lit32, bcmd_lit64, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad # <span class="hljs-number"><span class="hljs-number">0x10</span></span> .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad # <span class="hljs-number"><span class="hljs-number">0x20</span></span> .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad # <span class="hljs-number"><span class="hljs-number">0x30</span></span> .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad # <span class="hljs-number"><span class="hljs-number">0x40</span></span> .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad # <span class="hljs-number"><span class="hljs-number">0x60</span></span> .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_type, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad # <span class="hljs-number"><span class="hljs-number">0x80</span></span> .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad start: .byte b_lit64 .quad msg_hello .byte b_lit8 .byte msg_hello_len .byte b_type .byte b_bye .section .text .global _start #     _start: mov rbp, rsp sub rbp, stack_size lea r8, start jmp _next _next: movzx rcx, byte ptr [r8] inc r8 jmp [bcmd + rcx*<span class="hljs-number"><span class="hljs-number">8</span></span>] b_bad = <span class="hljs-number"><span class="hljs-number">0x00</span></span> bcmd_bad: mov eax, <span class="hljs-number"><span class="hljs-number">4</span></span> #   â„– <span class="hljs-number"><span class="hljs-number">4</span></span> â€” sys_write mov ebx, <span class="hljs-number"><span class="hljs-number">1</span></span> #  â„– <span class="hljs-number"><span class="hljs-number">1</span></span> â€” <span class="hljs-built_in"><span class="hljs-built_in">stdout</span></span> mov ecx, offset msg_bad_byte #     mov edx, msg_bad_byte_len #   <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-number"><span class="hljs-number">0x80</span></span> #   mov eax, <span class="hljs-number"><span class="hljs-number">1</span></span> #   â„– <span class="hljs-number"><span class="hljs-number">1</span></span> â€” sys_exit mov ebx, <span class="hljs-number"><span class="hljs-number">1</span></span> #    <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-number"><span class="hljs-number">0x80</span></span> #   b_bye = <span class="hljs-number"><span class="hljs-number">0x01</span></span> bcmd_bye: mov eax, <span class="hljs-number"><span class="hljs-number">4</span></span> #   â„– <span class="hljs-number"><span class="hljs-number">4</span></span> â€” sys_write mov ebx, <span class="hljs-number"><span class="hljs-number">1</span></span> #  â„– <span class="hljs-number"><span class="hljs-number">1</span></span> â€” <span class="hljs-built_in"><span class="hljs-built_in">stdout</span></span> mov ecx, offset msg_bye #     mov edx, msg_bye_len #   <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-number"><span class="hljs-number">0x80</span></span> #   mov eax, <span class="hljs-number"><span class="hljs-number">1</span></span> #   â„– <span class="hljs-number"><span class="hljs-number">1</span></span> â€” sys_exit mov ebx, <span class="hljs-number"><span class="hljs-number">0</span></span> #    <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-number"><span class="hljs-number">0x80</span></span> #   b_num0 = <span class="hljs-number"><span class="hljs-number">0x02</span></span> bcmd_num0: push <span class="hljs-number"><span class="hljs-number">0</span></span> jmp _next b_lit8 = <span class="hljs-number"><span class="hljs-number">0x08</span></span> bcmd_lit8: movsx rax, byte ptr [r8] inc r8 push rax jmp _next b_lit16 = <span class="hljs-number"><span class="hljs-number">0x09</span></span> bcmd_lit16: movsx rax, word ptr [r8] add r8, <span class="hljs-number"><span class="hljs-number">2</span></span> push rax jmp _next b_lit32 = <span class="hljs-number"><span class="hljs-number">0x0A</span></span> bcmd_lit32: movsx rax, dword ptr [r8] add r8, <span class="hljs-number"><span class="hljs-number">4</span></span> push rax jmp _next b_lit64 = <span class="hljs-number"><span class="hljs-number">0x0B</span></span> bcmd_lit64: mov rax, [r8] add r8, <span class="hljs-number"><span class="hljs-number">8</span></span> push rax jmp _next b_type = <span class="hljs-number"><span class="hljs-number">0x80</span></span> bcmd_type: mov eax, <span class="hljs-number"><span class="hljs-number">4</span></span> #   â„– <span class="hljs-number"><span class="hljs-number">4</span></span> â€” sys_write mov ebx, <span class="hljs-number"><span class="hljs-number">1</span></span> #  â„– <span class="hljs-number"><span class="hljs-number">1</span></span> â€” <span class="hljs-built_in"><span class="hljs-built_in">stdout</span></span> pop rdx pop rcx push r8 <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-number"><span class="hljs-number">0x80</span></span> #   pop r8 jmp _next</code> </pre> <br></div></div><br> ä½†æ˜¯å¯èƒ½æ€§ä»ç„¶æ˜¯éå¸¸åŸå§‹çš„ï¼Œæ‚¨ä¸èƒ½åˆ›é€ ä¸€ä¸ªæ¡ä»¶ï¼Œä¸€ä¸ªå¾ªç¯ã€‚ <br><br> æ€ä¹ˆå¯èƒ½å‘¢ï¼Ÿ æ‚¨å¯ä»¥ï¼Œä¸€åˆ‡éƒ½åœ¨æˆ‘ä»¬æ‰‹ä¸­ï¼ è®©æˆ‘ä»¬åœ¨å¾ªç¯ä¸­æ‰§è¡Œæ­¤è¡Œ10æ¬¡ã€‚ è¿™å°†éœ€è¦ä¸€ä¸ªæ¡ä»¶åˆ†æ”¯å‘½ä»¤ï¼Œä»¥åŠä¸€äº›å †æ ˆè¿ç®—ï¼šä¸€ä¸ªå‘½ä»¤å°†å †æ ˆä¸Šçš„å€¼å‡1ï¼ˆåœ¨â€œ 1-â€å ¡ä¸Šï¼‰å’Œä¸€ä¸ªé¡¶ç‚¹å¤åˆ¶å‘½ä»¤ï¼ˆâ€œ dupâ€ï¼‰ã€‚ <br><br> ä½¿ç”¨ç®—æœ¯ï¼Œä¸€åˆ‡éƒ½å¾ˆç®€å•ï¼Œæˆ‘ä»€è‡³ä¸äºˆè¯„è®ºï¼š <br><br><pre> <code class="cpp hljs">b_dup = <span class="hljs-number"><span class="hljs-number">0x18</span></span> bcmd_dup: push [rsp] jmp _next b_wm = <span class="hljs-number"><span class="hljs-number">0x20</span></span> bcmd_wm: decq [rsp] jmp _next</code> </pre> <br> ç°åœ¨æ˜¯æœ‰æ¡ä»¶çš„è·³è·ƒã€‚ é¦–å…ˆï¼Œè®©æˆ‘ä»¬ç®€åŒ–ä»»åŠ¡-æ— æ¡ä»¶è¿‡æ¸¡ã€‚ æ˜¾ç„¶ï¼Œæ‚¨åªéœ€è¦æ›´æ”¹å¯„å­˜å™¨R8çš„å€¼å³å¯ã€‚ é¦–å…ˆæƒ³åˆ°çš„æ˜¯å­—èŠ‚å‘½ä»¤ï¼Œåè·Ÿä¸€ä¸ªå‚æ•°-è½¬æ¢åœ°å€ä¸º64ä½ã€‚ è¿˜æ˜¯ä¹ä¸ªå­—èŠ‚ã€‚ æˆ‘ä»¬éœ€è¦è¿™9ä¸ªå­—èŠ‚å—ï¼Ÿ è¿‡æ¸¡é€šå¸¸å‘ç”Ÿåœ¨çŸ­è·ç¦»å†…ï¼Œé€šå¸¸åœ¨å‡ ç™¾ä¸ªå­—èŠ‚ä¹‹å†…ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬å°†ä¸ä½¿ç”¨åœ°å€ï¼Œè€Œæ˜¯ä½¿ç”¨åç§»é‡ï¼ <br><br> ä½æ·±åº¦ï¼Ÿ åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œä»…8ä½ï¼ˆå‘å‰/å‘å127ä½ï¼‰å°±è¶³å¤Ÿäº†ï¼Œä½†æ˜¯æœ‰æ—¶è¿™è¿˜ä¸å¤Ÿã€‚ å› æ­¤ï¼Œæˆ‘ä»¬å°†æ‰§è¡Œä¸litå‘½ä»¤ç›¸åŒçš„æ“ä½œï¼Œæˆ‘ä»¬å°†é€‰æ‹©ä¸¤ä¸ªé€‰é¡¹-8ä½å’Œ16ä½æ•°å­—ï¼Œå‘½ä»¤ä»£ç å°†ä¸º0x10å’Œ0x11ï¼š <br><br><pre> <code class="cpp hljs">b_branch8 = <span class="hljs-number"><span class="hljs-number">0x10</span></span> bcmd_branch8: movsx rax, byte ptr [r8] add r8, rax jmp _next b_branch16 = <span class="hljs-number"><span class="hljs-number">0x11</span></span> bcmd_branch16: movsx rax, word ptr [r8] add r8, rax jmp _next</code> </pre> ç°åœ¨ï¼Œæ¡ä»¶è½¬æ¢å¾ˆå®¹æ˜“å®ç°ã€‚ å¦‚æœå †æ ˆä¸º0ï¼Œè¯·è½¬åˆ°_nextï¼Œå¦åˆ™ï¼Œè¯·è½¬åˆ°branchå‘½ä»¤ï¼ <br><pre> <code class="cpp hljs">b_qbranch8 = <span class="hljs-number"><span class="hljs-number">0x12</span></span> bcmd_qbranch8: pop rax <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> rax, rax jnz bcmd_branch8 inc r8 jmp _next b_qbranch16 = <span class="hljs-number"><span class="hljs-number">0x13</span></span> bcmd_qbranch16: pop rax <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> rax, rax jnz bcmd_branch16 add r8, <span class="hljs-number"><span class="hljs-number">2</span></span> jmp _next</code> </pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥è¿›è¡Œå¾ªç¯ï¼š </font></font><pre> <code class="cpp hljs">start: .byte b_lit8 .byte <span class="hljs-number"><span class="hljs-number">10</span></span> #  #  m0: .byte b_lit64 .quad msg_hello .byte b_lit8 .byte msg_hello_len .byte b_type .byte b_wm .byte b_dup .byte b_qbranch8 .byte m0 - . .byte b_bye</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‰ä¸¤ä¸ªå‘½ä»¤-æˆ‘ä»¬å°†å¾ªç¯è®¡æ•°å™¨æ”¾åœ¨å †æ ˆä¸Šã€‚</font><font style="vertical-align: inherit;">æ¥ä¸‹æ¥ï¼Œæ‰“å°å­—ç¬¦ä¸²Helloã€‚</font><font style="vertical-align: inherit;">ç„¶åï¼Œæˆ‘ä»¬ä»è®¡æ•°å™¨ä¸­å‡å»1ï¼Œå°†å…¶å¤åˆ¶å¹¶æ‰§è¡Œï¼ˆæˆ–ä¸æ‰§è¡Œï¼‰è½¬æ¢ã€‚</font><font style="vertical-align: inherit;">éœ€è¦å¤åˆ¶å‘½ä»¤ï¼Œå› ä¸ºæ¡ä»¶åˆ†æ”¯å‘½ä»¤ä»å †æ ˆé¡¶éƒ¨è·å–å€¼ã€‚</font><font style="vertical-align: inherit;">å› ä¸ºè·ç¦»åªæœ‰å‡ ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥è¿™é‡Œçš„è½¬æ¢æ˜¯å…«ä½çš„ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å°†æ–°å‘½ä»¤çš„åœ°å€æ”¾åœ¨è¡¨ä¸­ï¼Œè¿›è¡Œç¼–è¯‘å’Œæ‰§è¡Œã€‚</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘å°†å…¶æ”¾å…¥æ‰°æµå™¨ä¸­ï¼Œå¦åˆ™æˆ‘ä»¬çš„ç¨‹åºå°†å˜å¾—å†—é•¿ï¼‰</font></font></b> <div class="spoiler_text"><pre> <code class="plaintext hljs">$ as fort.asm -o fort.o -g -ahlsm &gt;list.txt $ ld forth.o -o forth $ ./forth Hello, world! Hello, world! Hello, world! Hello, world! Hello, world! Hello, world! Hello, world! Hello, world! Hello, world! Hello, world! bye!</code> </pre><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å¥½äº†ï¼Œæˆ‘ä»¬å·²ç»å¯ä»¥åšæ¡ä»¶å’Œå¾ªç¯äº†ï¼ </font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å…¨æ–‡</font></font></b> <div class="spoiler_text"><pre> <code class="cpp hljs">.intel_syntax noprefix stack_size = <span class="hljs-number"><span class="hljs-number">1024</span></span> .section .data msg_bad_byte: .ascii <span class="hljs-string"><span class="hljs-string">"Bad byte code!\n"</span></span> msg_bad_byte_len = . - msg_bad_byte #  len    msg_bye: .ascii <span class="hljs-string"><span class="hljs-string">"bye!\n"</span></span> msg_bye_len = . - msg_bye msg_hello: .ascii <span class="hljs-string"><span class="hljs-string">"Hello, world!\n"</span></span> msg_hello_len = . - msg_hello bcmd: .quad bcmd_bad, bcmd_bye, bcmd_num0, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad # <span class="hljs-number"><span class="hljs-number">0x00</span></span> .quad bcmd_lit8, bcmd_lit16, bcmd_lit32, bcmd_lit64, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_branch8, bcmd_branch16, bcmd_qbranch8, bcmd_qbranch16, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad # <span class="hljs-number"><span class="hljs-number">0x10</span></span> .quad bcmd_dup, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_wm, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad # <span class="hljs-number"><span class="hljs-number">0x20</span></span> .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad # <span class="hljs-number"><span class="hljs-number">0x30</span></span> .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad # <span class="hljs-number"><span class="hljs-number">0x40</span></span> .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad # <span class="hljs-number"><span class="hljs-number">0x60</span></span> .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_type, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad # <span class="hljs-number"><span class="hljs-number">0x80</span></span> .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad start: .byte b_lit8 .byte <span class="hljs-number"><span class="hljs-number">10</span></span> #  #  m0: .byte b_lit64 .quad msg_hello .byte b_lit8 .byte msg_hello_len .byte b_type .byte b_wm .byte b_dup .byte b_qbranch8 .byte m0 - . .byte b_bye .section .text .global _start #     _start: mov rbp, rsp sub rbp, stack_size lea r8, start jmp _next _next: movzx rcx, byte ptr [r8] inc r8 jmp [bcmd + rcx*<span class="hljs-number"><span class="hljs-number">8</span></span>] b_bad = <span class="hljs-number"><span class="hljs-number">0x00</span></span> bcmd_bad: mov eax, <span class="hljs-number"><span class="hljs-number">4</span></span> #   â„– <span class="hljs-number"><span class="hljs-number">4</span></span> â€” sys_write mov ebx, <span class="hljs-number"><span class="hljs-number">1</span></span> #  â„– <span class="hljs-number"><span class="hljs-number">1</span></span> â€” <span class="hljs-built_in"><span class="hljs-built_in">stdout</span></span> mov ecx, offset msg_bad_byte #     mov edx, msg_bad_byte_len #   <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-number"><span class="hljs-number">0x80</span></span> #   mov eax, <span class="hljs-number"><span class="hljs-number">1</span></span> #   â„– <span class="hljs-number"><span class="hljs-number">1</span></span> â€” sys_exit mov ebx, <span class="hljs-number"><span class="hljs-number">1</span></span> #    <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-number"><span class="hljs-number">0x80</span></span> #   b_bye = <span class="hljs-number"><span class="hljs-number">0x01</span></span> bcmd_bye: mov eax, <span class="hljs-number"><span class="hljs-number">4</span></span> #   â„– <span class="hljs-number"><span class="hljs-number">4</span></span> â€” sys_write mov ebx, <span class="hljs-number"><span class="hljs-number">1</span></span> #  â„– <span class="hljs-number"><span class="hljs-number">1</span></span> â€” <span class="hljs-built_in"><span class="hljs-built_in">stdout</span></span> mov ecx, offset msg_bye #     mov edx, msg_bye_len #   <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-number"><span class="hljs-number">0x80</span></span> #   mov eax, <span class="hljs-number"><span class="hljs-number">1</span></span> #   â„– <span class="hljs-number"><span class="hljs-number">1</span></span> â€” sys_exit mov ebx, <span class="hljs-number"><span class="hljs-number">0</span></span> #    <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-number"><span class="hljs-number">0x80</span></span> #   b_num0 = <span class="hljs-number"><span class="hljs-number">0x02</span></span> bcmd_num0: push <span class="hljs-number"><span class="hljs-number">0</span></span> jmp _next b_lit8 = <span class="hljs-number"><span class="hljs-number">0x08</span></span> bcmd_lit8: movsx rax, byte ptr [r8] inc r8 push rax jmp _next b_lit16 = <span class="hljs-number"><span class="hljs-number">0x09</span></span> bcmd_lit16: movsx rax, word ptr [r8] add r8, <span class="hljs-number"><span class="hljs-number">2</span></span> push rax jmp _next b_lit32 = <span class="hljs-number"><span class="hljs-number">0x0A</span></span> bcmd_lit32: movsx rax, dword ptr [r8] add r8, <span class="hljs-number"><span class="hljs-number">4</span></span> push rax jmp _next b_lit64 = <span class="hljs-number"><span class="hljs-number">0x0B</span></span> bcmd_lit64: mov rax, [r8] add r8, <span class="hljs-number"><span class="hljs-number">8</span></span> push rax jmp _next b_type = <span class="hljs-number"><span class="hljs-number">0x80</span></span> bcmd_type: mov eax, <span class="hljs-number"><span class="hljs-number">4</span></span> #   â„– <span class="hljs-number"><span class="hljs-number">4</span></span> â€” sys_write mov ebx, <span class="hljs-number"><span class="hljs-number">1</span></span> #  â„– <span class="hljs-number"><span class="hljs-number">1</span></span> â€” <span class="hljs-built_in"><span class="hljs-built_in">stdout</span></span> pop rdx pop rcx push r8 <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-number"><span class="hljs-number">0x80</span></span> #   pop r8 jmp _next b_dup = <span class="hljs-number"><span class="hljs-number">0x18</span></span> bcmd_dup: push [rsp] jmp _next b_wm = <span class="hljs-number"><span class="hljs-number">0x20</span></span> bcmd_wm: decq [rsp] jmp _next b_branch8 = <span class="hljs-number"><span class="hljs-number">0x10</span></span> bcmd_branch8: movsx rax, byte ptr [r8] add r8, rax jmp _next b_branch16 = <span class="hljs-number"><span class="hljs-number">0x11</span></span> bcmd_branch16: movsx rax, word ptr [r8] add r8, rax jmp _next b_qbranch8 = <span class="hljs-number"><span class="hljs-number">0x12</span></span> bcmd_qbranch8: pop rax <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> rax, rax jnz bcmd_branch8 inc r8 jmp _next b_qbranch16 = <span class="hljs-number"><span class="hljs-number">0x13</span></span> bcmd_qbranch16: pop rax <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> rax, rax jnz bcmd_branch16 add r8, <span class="hljs-number"><span class="hljs-number">2</span></span> jmp _next</code> </pre></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½†æ˜¯ç›´åˆ°å®Œæˆçš„å­—èŠ‚æœºç¼ºå°‘å¦ä¸€ä¸ªéå¸¸é‡è¦çš„åŠŸèƒ½ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬ä¸èƒ½ä»å­—èŠ‚ç ä¸­è°ƒç”¨å¦ä¸€ä¸ªã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬æ²¡æœ‰æ‰€è°“çš„ä¾‹ç¨‹ï¼Œè¿‡ç¨‹ç­‰ã€‚</font><font style="vertical-align: inherit;">è€Œä¸”åœ¨è¦å¡ä¸­ï¼Œæ²¡æœ‰è¿™ä¸ªï¼Œæˆ‘ä»¬å°±ä¸èƒ½åœ¨æŸäº›å•è¯ä¸­ä½¿ç”¨å†…æ ¸å•è¯ä»¥å¤–çš„å•è¯ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬æŠŠå·¥ä½œç»“æŸäº†ã€‚</font><font style="vertical-align: inherit;">è¿™æ˜¯æˆ‘ä»¬ç¬¬ä¸€æ¬¡éœ€è¦ä¸€å †æ”¶ç›Šã€‚</font><font style="vertical-align: inherit;">éœ€è¦ä¸¤ä¸ªå‘½ä»¤-è°ƒç”¨å‘½ä»¤å’Œè¿”å›å‘½ä»¤ï¼ˆè°ƒç”¨å’Œé€€å‡ºï¼‰ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è°ƒç”¨å‘½ä»¤åœ¨åŸåˆ™ä¸Šä¸åˆ†æ”¯æ‰§è¡Œç›¸åŒçš„æ“ä½œ-å°†æ§åˆ¶æƒè½¬ç§»åˆ°å¦ä¸€å­—èŠ‚ä»£ç ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯ï¼Œä¸åˆ†æ”¯ä¸åŒï¼Œæ‚¨ä»ç„¶éœ€è¦å°†è¿”å›åœ°å€ä¿å­˜åœ¨è¿”å›å †æ ˆä¸­ï¼Œä»¥ä¾¿æ‚¨å¯ä»¥è¿”å›å¹¶ç»§ç»­æ‰§è¡Œã€‚</font><font style="vertical-align: inherit;">è¿˜æœ‰å¦ä¸€ä¸ªåŒºåˆ«-è¿™æ ·çš„é€šè¯å¯èƒ½ä¼šå‘ç”Ÿæ›´è¿œçš„è·ç¦»ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œæˆ‘ä»¬ä»¥ç±»ä¼¼äºåˆ†æ”¯çš„æ–¹å¼æ‰§è¡Œcallå‘½ä»¤ï¼Œä½†ä½¿ç”¨ä¸‰ç§ç‰ˆæœ¬-8ä½ï¼Œ16ä½å’Œ32ä½ã€‚</font></font><br><br><pre> <code class="cpp hljs">b_call8 = <span class="hljs-number"><span class="hljs-number">0x0C</span></span> bcmd_call8: movsx rax, byte ptr [r8] sub rbp, <span class="hljs-number"><span class="hljs-number">8</span></span> inc r8 mov [rbp], r8 add r8, rax jmp _next b_call16 = <span class="hljs-number"><span class="hljs-number">0x0D</span></span> bcmd_call16: movsx rax, word ptr [r8] sub rbp, <span class="hljs-number"><span class="hljs-number">8</span></span> add r8, <span class="hljs-number"><span class="hljs-number">2</span></span> mov [rbp], r8 add r8, rax jmp _next b_call32 = <span class="hljs-number"><span class="hljs-number">0x0E</span></span> bcmd_call32: movsx rax, dword ptr [r8] sub rbp, <span class="hljs-number"><span class="hljs-number">8</span></span> add r8, <span class="hljs-number"><span class="hljs-number">4</span></span> mov [rbp], r8 add r8, rax jmp _next</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¦‚æ‚¨æ‰€è§ï¼Œè¿™é‡Œä¸è¿‡æ¸¡ä¸åŒï¼Œæ·»åŠ äº†3ä¸ªå›¢é˜Ÿã€‚å…¶ä¸­ä¸€ä¸ªå°†R8é‡æ–°æ’åˆ—ä¸ºä¸‹ä¸€ä¸ªå­—èŠ‚å‘½ä»¤ï¼Œå…¶ä½™ä¸¤ä¸ªå°†æ¥æ”¶åˆ°çš„å€¼å­˜å‚¨åœ¨è¿”å›å †æ ˆä¸­ã€‚é¡ºä¾¿è¯´ä¸€å¥ï¼Œåœ¨è¿™é‡Œï¼Œæˆ‘å°è¯•ä¸ä½¿å¤„ç†å™¨æŒ‡ä»¤ç›¸äº’ä¾å­˜ï¼Œä»¥ä¾¿å¤„ç†å™¨ä¼ é€å™¨å¯ä»¥å¹¶è¡Œæ‰§è¡Œå‘½ä»¤ã€‚ä½†æˆ‘ä¸çŸ¥é“è¿™èƒ½èµ·åˆ°å¤šå¤§çš„ä½œç”¨ã€‚å¦‚æœéœ€è¦ï¼Œåˆ™å¯ä»¥æ£€æŸ¥æµ‹è¯•ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åº”è¯¥ç‰¢è®°çš„æ˜¯ï¼Œè°ƒç”¨å‘½ä»¤çš„è‡ªå˜é‡å½¢å¼ä¸åˆ†æ”¯çš„è‡ªå˜é‡å½¢å¼ç•¥æœ‰ä¸åŒã€‚å¯¹äºåˆ†æ”¯ï¼Œåç§»é‡è®¡ç®—ä¸ºåˆ†æ”¯åœ°å€ä¸å­—èŠ‚å‘½ä»¤åçš„å­—èŠ‚åœ°å€ä¹‹é—´çš„å·®ã€‚å¯¹äºcallå‘½ä»¤ï¼Œè¿™æ˜¯è·³è½¬åœ°å€å’Œä¸‹ä¸€ä¸ªå‘½ä»¤çš„åœ°å€ä¹‹é—´çš„å·®ã€‚</font></font>ä¸ºä»€ä¹ˆéœ€è¦è¿™ä¸ªï¼Ÿ<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿™å¯¼è‡´æ›´å°‘çš„å¤„ç†å™¨æŒ‡ä»¤ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨è¿”å›å‘½ä»¤ã€‚</font><font style="vertical-align: inherit;">å®é™…ä¸Šï¼Œå¥¹çš„å·¥ä½œåªæ˜¯ä»è¿”å›å †æ ˆä¸­è¿˜åŸR8å¹¶å°†æ§åˆ¶æƒè¿›ä¸€æ­¥è½¬ç§»åˆ°å­—èŠ‚æœºï¼š</font></font><br><br><pre> <code class="cpp hljs">b_exit = <span class="hljs-number"><span class="hljs-number">0x1F</span></span> bcmd_exit: mov r8, [rbp] add rbp, <span class="hljs-number"><span class="hljs-number">8</span></span> jmp _next</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿™äº›å‘½ä»¤å°†ç»å¸¸ä½¿ç”¨ï¼Œéœ€è¦å¯¹å…¶è¿›è¡Œæœ€å¤§ç¨‹åº¦çš„ä¼˜åŒ–ã€‚</font><font style="vertical-align: inherit;">é€€å‡ºå­—èŠ‚å‘½ä»¤å ç”¨ä¸‰ä¸ªæœºå™¨æŒ‡ä»¤ã€‚</font><font style="vertical-align: inherit;">å¯ä»¥åœ¨è¿™é‡Œå‡å°‘ä¸€äº›ä¸œè¥¿å—ï¼Ÿ</font><font style="vertical-align: inherit;">äº‹å®è¯æ˜ä½ å¯ä»¥ï¼</font><font style="vertical-align: inherit;">æ‚¨å¯ä»¥ç®€å•åœ°åˆ é™¤è¿‡æ¸¡å‘½ä»¤ï¼š) </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºæ­¤ï¼Œè¯·å°†å…¶æ”¾ç½®åœ¨_nextå­—èŠ‚æœºçš„å…¥å£ç‚¹ä¸Šæ–¹ï¼š</font></font><br><br><pre> <code class="cpp hljs">b_exit = <span class="hljs-number"><span class="hljs-number">0x1F</span></span> bcmd_exit: mov r8, [rbp] add rbp, <span class="hljs-number"><span class="hljs-number">8</span></span> _next: movzx rcx, byte ptr [r8] inc r8 jmp [bcmd + rcx*<span class="hljs-number"><span class="hljs-number">8</span></span>]</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é¡ºä¾¿è¯´ä¸€å¥ï¼Œæœ€é‡è¦å’Œæœ€å¸¸ç”¨çš„å‘½ä»¤ï¼ˆä¾‹å¦‚ï¼Œè°ƒç”¨ï¼‰éœ€è¦æ”¾åœ¨é è¿‘å­—èŠ‚æœºçš„ä½ç½®ï¼Œä»¥ä¾¿ç¼–è¯‘å™¨å¯ä»¥å½¢æˆä¸€ä¸ªçŸ­è·³è½¬å‘½ä»¤ã€‚</font><font style="vertical-align: inherit;">è¿™åœ¨æ¸…å•ä¸­æ¸…æ™°å¯è§ã€‚</font><font style="vertical-align: inherit;">è¿™æ˜¯ä¸€ä¸ªä¾‹å­ã€‚</font></font><br><br><pre> <code class="cpp hljs"> <span class="hljs-number"><span class="hljs-number">262</span></span> <span class="hljs-number"><span class="hljs-number">0084</span></span> <span class="hljs-number"><span class="hljs-number">490F</span></span>BE00 bcmd_lit8: movsx rax, byte ptr [r8] <span class="hljs-number"><span class="hljs-number">263</span></span> <span class="hljs-number"><span class="hljs-number">0088</span></span> <span class="hljs-number"><span class="hljs-number">49F</span></span>FC0 inc r8 <span class="hljs-number"><span class="hljs-number">264</span></span> <span class="hljs-number"><span class="hljs-number">008b</span></span> <span class="hljs-number"><span class="hljs-number">50</span></span> push rax <span class="hljs-number"><span class="hljs-number">265</span></span> <span class="hljs-number"><span class="hljs-number">008</span></span>c EB90 jmp _next <span class="hljs-number"><span class="hljs-number">266</span></span> <span class="hljs-number"><span class="hljs-number">267</span></span> b_lit16 = <span class="hljs-number"><span class="hljs-number">0x09</span></span> <span class="hljs-number"><span class="hljs-number">268</span></span> <span class="hljs-number"><span class="hljs-number">008</span></span>e <span class="hljs-number"><span class="hljs-number">490F</span></span>BF00 bcmd_lit16: movsx rax, word ptr [r8] <span class="hljs-number"><span class="hljs-number">269</span></span> <span class="hljs-number"><span class="hljs-number">0092</span></span> <span class="hljs-number"><span class="hljs-number">4983</span></span>C002 add r8, <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">270</span></span> <span class="hljs-number"><span class="hljs-number">0096</span></span> <span class="hljs-number"><span class="hljs-number">50</span></span> push rax <span class="hljs-number"><span class="hljs-number">271</span></span> <span class="hljs-number"><span class="hljs-number">0097</span></span> EB85 jmp _next <span class="hljs-number"><span class="hljs-number">272</span></span> <span class="hljs-number"><span class="hljs-number">273</span></span> b_lit32 = <span class="hljs-number"><span class="hljs-number">0x0A</span></span> <span class="hljs-number"><span class="hljs-number">274</span></span> <span class="hljs-number"><span class="hljs-number">0099</span></span> <span class="hljs-number"><span class="hljs-number">496300</span></span> bcmd_lit32: movsx rax, dword ptr [r8] <span class="hljs-number"><span class="hljs-number">275</span></span> <span class="hljs-number"><span class="hljs-number">009</span></span>c <span class="hljs-number"><span class="hljs-number">4983</span></span>C004 add r8, <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">276</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span>a0 <span class="hljs-number"><span class="hljs-number">50</span></span> push rax <span class="hljs-number"><span class="hljs-number">277</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span>a1 E978FFFF jmp _next <span class="hljs-number"><span class="hljs-number">277</span></span> FF <span class="hljs-number"><span class="hljs-number">278</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ­¤å¤„ï¼Œåœ¨ç¬¬265å’Œ271è¡Œï¼Œjmpå‘½ä»¤æ¯ä¸ªå ç”¨2ä¸ªå­—èŠ‚ï¼Œè€Œåœ¨ç¬¬277è¡Œï¼Œç”±äºè·³è½¬è·ç¦»è¶…è¿‡äº†shortå‘½ä»¤çš„é•¿åº¦ï¼Œå› æ­¤åŒä¸€å‘½ä»¤å·²è¢«ç¼–è¯‘ä¸º5ä¸ªå­—èŠ‚ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å› æ­¤ï¼Œè¯¸å¦‚åï¼Œå†è§ï¼Œç±»å‹ä¹‹ç±»çš„å­—èŠ‚å‘½ä»¤è¢«è¿›ä¸€æ­¥é‡æ–°å¸ƒç½®ï¼Œè€Œè¯¸å¦‚å‘¼å«ï¼Œåˆ†æ”¯ï¼Œç‚¹äº®ä¹‹ç±»çš„å­—èŠ‚å‘½ä»¤åˆ™æ›´è¿‘ã€‚ä¸å¹¸çš„æ˜¯ï¼Œåœ¨127ä¸ªå­—èŠ‚çš„è¿‡æ¸¡ä¸­æ²¡æœ‰è¶³å¤Ÿçš„ç©ºé—´ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬æ ¹æ®å®ƒä»¬çš„ä»£ç å°†æ–°å‘½ä»¤æ·»åŠ åˆ°å‘½ä»¤åœ°å€è¡¨ä¸­ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å› æ­¤ï¼Œæˆ‘ä»¬ç°åœ¨é¢ä¸´æŒ‘æˆ˜å’Œå›æŠ¥ï¼Œæˆ‘ä»¬å°†å¯¹å…¶è¿›è¡Œæµ‹è¯•ï¼ä¸ºæ­¤ï¼Œè¯·åœ¨å•ç‹¬çš„è¿‡ç¨‹ä¸­é€‰æ‹©è¡Œæ‰“å°ï¼Œæˆ‘ä»¬å°†åœ¨å¾ªç¯ä¸­ä¸¤æ¬¡è°ƒç”¨å®ƒã€‚å¹¶ä¸”å¾ªç¯çš„é‡å¤æ¬¡æ•°å‡å°‘åˆ°ä¸‰ä¸ªã€‚</font></font><br><br><pre> <code class="cpp hljs">start: .byte b_lit8 .byte <span class="hljs-number"><span class="hljs-number">3</span></span> #  #  m0: .byte b_call16 .word sub_hello - . - <span class="hljs-number"><span class="hljs-number">2</span></span> .byte b_call16 .word sub_hello - . - <span class="hljs-number"><span class="hljs-number">2</span></span> .byte b_wm .byte b_dup .byte b_qbranch8 .byte m0 - . .byte b_bye sub_hello: .byte b_lit64 .quad msg_hello .byte b_lit8 .byte msg_hello_len .byte b_type .byte b_exit</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¯ä»¥åœ¨è¿™é‡Œä½¿ç”¨Call8ï¼Œä½†æˆ‘å†³å®šå°†call16ç”¨ä½œæœ€å¯èƒ½ä½¿ç”¨çš„é‚£ä¸ªã€‚</font><font style="vertical-align: inherit;">ç”±äºä¸ºæˆ‘ç¼–å†™çš„è°ƒç”¨å­—èŠ‚å‘½ä»¤è®¡ç®—åœ°å€çš„ç‰¹æ®Šæ€§ï¼Œå› æ­¤å‡å»äº†å€¼2ã€‚</font><font style="vertical-align: inherit;">å¯¹äºcall8ï¼Œå°†åœ¨æ­¤å¤„åˆ†åˆ«å‡å»1ï¼Œå¯¹äºcall32ï¼Œå°†å‡å»4ã€‚æˆ‘ä»¬</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç¼–è¯‘å¹¶è°ƒç”¨ï¼š</font></font><br><br><pre> <code class="plaintext hljs">$ as forth.asm -o forth.o -g -ahlsm&gt;list.txt $ ld forth.o -o forth $ ./forth Hello, world! Bad byte code!</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç³Ÿç³•ï¼Œå¦‚ä»–ä»¬æ‰€è¯´ï¼Œå‡ºäº†ç‚¹é—®é¢˜:)å¥½å§ï¼Œæˆ‘ä»¬å¯åŠ¨äº†GDBï¼Œçœ‹çœ‹é‚£é‡Œå‘ç”Ÿäº†ä»€ä¹ˆã€‚</font><font style="vertical-align: inherit;">æˆ‘ç«‹å³åœ¨bcmd_exitä¸Šè®¾ç½®äº†ä¸€ä¸ªæ–­ç‚¹ï¼Œå› ä¸ºå¾ˆæ˜æ˜¾sub_helloè°ƒç”¨æ­£åœ¨ä¼ é€’ï¼Œå¹¶ä¸”è¿‡ç¨‹ä¸»ä½“æ­£åœ¨æ‰§è¡Œ...å¯åŠ¨...å¹¶ä¸”ç¨‹åºæ²¡æœ‰è¾¾åˆ°æ–­ç‚¹ã€‚</font><font style="vertical-align: inherit;">é©¬ä¸Šæœ‰ä¸€ä¸ªå­—èŠ‚å‘½ä»¤ä»£ç çš„æ€€ç–‘ã€‚</font><font style="vertical-align: inherit;">è€Œä¸”ï¼Œç¡®å®æ˜¯å› ä¸ºä»–ã€‚</font><font style="vertical-align: inherit;">b_exitæˆ‘åˆ†é…äº†å€¼0x1fï¼Œå¹¶ä¸”åœ°å€æœ¬èº«ä½äºè¡¨å•å…ƒå·0x17ä¸­ã€‚</font><font style="vertical-align: inherit;">å¥½å§ï¼Œé‚£ä¹ˆæˆ‘å°†æŠŠb_exitçš„å€¼æ›´æ­£ä¸º0x17å¹¶é‡è¯•ï¼š</font></font><br><br><pre> <code class="plaintext hljs">$ as forth.asm -o forth.o -g -ahlsm&gt;list.txt $ ld forth.o -o forth $ ./forth Hello, world! Hello, world! Hello, world! Hello, world! Hello, world! Hello, world! bye!</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ­£å¥½å…­æ¬¡æ‰“æ‹›å‘¼ï¼Œå†è§ä¸€æ¬¡ã€‚</font><font style="vertical-align: inherit;">åº”è¯¥æ˜¯:)</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å…¨æ–‡</font></font></b> <div class="spoiler_text"><pre> <code class="cpp hljs">.intel_syntax noprefix stack_size = <span class="hljs-number"><span class="hljs-number">1024</span></span> .section .data msg_bad_byte: .ascii <span class="hljs-string"><span class="hljs-string">"Bad byte code!\n"</span></span> msg_bad_byte_len = . - msg_bad_byte #  len    msg_bye: .ascii <span class="hljs-string"><span class="hljs-string">"bye!\n"</span></span> msg_bye_len = . - msg_bye msg_hello: .ascii <span class="hljs-string"><span class="hljs-string">"Hello, world!\n"</span></span> msg_hello_len = . - msg_hello bcmd: .quad bcmd_bad, bcmd_bye, bcmd_num0, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad # <span class="hljs-number"><span class="hljs-number">0x00</span></span> .quad bcmd_lit8, bcmd_lit16, bcmd_lit32, bcmd_lit64, bcmd_call8, bcmd_call16, bcmd_call32, bcmd_bad .quad bcmd_branch8, bcmd_branch16, bcmd_qbranch8, bcmd_qbranch16, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_exit # <span class="hljs-number"><span class="hljs-number">0x10</span></span> .quad bcmd_dup, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_wm, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad # <span class="hljs-number"><span class="hljs-number">0x20</span></span> .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad # <span class="hljs-number"><span class="hljs-number">0x30</span></span> .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad # <span class="hljs-number"><span class="hljs-number">0x40</span></span> .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad # <span class="hljs-number"><span class="hljs-number">0x60</span></span> .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_type, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad # <span class="hljs-number"><span class="hljs-number">0x80</span></span> .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad .quad bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad, bcmd_bad start: .byte b_lit8 .byte <span class="hljs-number"><span class="hljs-number">3</span></span> #  #  m0: .byte b_call16 .word sub_hello - . - <span class="hljs-number"><span class="hljs-number">2</span></span> .byte b_call16 .word sub_hello - . - <span class="hljs-number"><span class="hljs-number">2</span></span> .byte b_wm .byte b_dup .byte b_qbranch8 .byte m0 - . .byte b_bye sub_hello: .byte b_lit64 .quad msg_hello .byte b_lit8 .byte msg_hello_len .byte b_type .byte b_exit .section .text .global _start #     _start: mov rbp, rsp sub rbp, stack_size lea r8, start jmp _next b_exit = <span class="hljs-number"><span class="hljs-number">0x17</span></span> bcmd_exit: mov r8, [rbp] add rbp, <span class="hljs-number"><span class="hljs-number">8</span></span> _next: movzx rcx, byte ptr [r8] inc r8 jmp [bcmd + rcx*<span class="hljs-number"><span class="hljs-number">8</span></span>] b_num0 = <span class="hljs-number"><span class="hljs-number">0x02</span></span> bcmd_num0: push <span class="hljs-number"><span class="hljs-number">0</span></span> jmp _next b_lit8 = <span class="hljs-number"><span class="hljs-number">0x08</span></span> bcmd_lit8: movsx rax, byte ptr [r8] inc r8 push rax jmp _next b_lit16 = <span class="hljs-number"><span class="hljs-number">0x09</span></span> bcmd_lit16: movsx rax, word ptr [r8] add r8, <span class="hljs-number"><span class="hljs-number">2</span></span> push rax jmp _next b_call8 = <span class="hljs-number"><span class="hljs-number">0x0C</span></span> bcmd_call8: movsx rax, byte ptr [r8] sub rbp, <span class="hljs-number"><span class="hljs-number">8</span></span> inc r8 mov [rbp], r8 add r8, rax jmp _next b_call16 = <span class="hljs-number"><span class="hljs-number">0x0D</span></span> bcmd_call16: movsx rax, word ptr [r8] sub rbp, <span class="hljs-number"><span class="hljs-number">8</span></span> add r8, <span class="hljs-number"><span class="hljs-number">2</span></span> mov [rbp], r8 add r8, rax jmp _next b_call32 = <span class="hljs-number"><span class="hljs-number">0x0E</span></span> bcmd_call32: movsx rax, dword ptr [r8] sub rbp, <span class="hljs-number"><span class="hljs-number">8</span></span> add r8, <span class="hljs-number"><span class="hljs-number">4</span></span> mov [rbp], r8 add r8, rax jmp _next b_lit32 = <span class="hljs-number"><span class="hljs-number">0x0A</span></span> bcmd_lit32: movsx rax, dword ptr [r8] add r8, <span class="hljs-number"><span class="hljs-number">4</span></span> push rax jmp _next b_lit64 = <span class="hljs-number"><span class="hljs-number">0x0B</span></span> bcmd_lit64: mov rax, [r8] add r8, <span class="hljs-number"><span class="hljs-number">8</span></span> push rax jmp _next b_dup = <span class="hljs-number"><span class="hljs-number">0x18</span></span> bcmd_dup: push [rsp] jmp _next b_wm = <span class="hljs-number"><span class="hljs-number">0x20</span></span> bcmd_wm: decq [rsp] jmp _next b_branch8 = <span class="hljs-number"><span class="hljs-number">0x10</span></span> bcmd_branch8: movsx rax, byte ptr [r8] add r8, rax jmp _next b_branch16 = <span class="hljs-number"><span class="hljs-number">0x11</span></span> bcmd_branch16: movsx rax, word ptr [r8] add r8, rax jmp _next b_qbranch8 = <span class="hljs-number"><span class="hljs-number">0x12</span></span> bcmd_qbranch8: pop rax <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> rax, rax jnz bcmd_branch8 inc r8 jmp _next b_qbranch16 = <span class="hljs-number"><span class="hljs-number">0x13</span></span> bcmd_qbranch16: pop rax <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> rax, rax jnz bcmd_branch16 add r8, <span class="hljs-number"><span class="hljs-number">2</span></span> jmp _next b_bad = <span class="hljs-number"><span class="hljs-number">0x00</span></span> bcmd_bad: mov eax, <span class="hljs-number"><span class="hljs-number">4</span></span> #   â„– <span class="hljs-number"><span class="hljs-number">4</span></span> â€” sys_write mov ebx, <span class="hljs-number"><span class="hljs-number">1</span></span> #  â„– <span class="hljs-number"><span class="hljs-number">1</span></span> â€” <span class="hljs-built_in"><span class="hljs-built_in">stdout</span></span> mov ecx, offset msg_bad_byte #     mov edx, msg_bad_byte_len #   <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-number"><span class="hljs-number">0x80</span></span> #   mov eax, <span class="hljs-number"><span class="hljs-number">1</span></span> #   â„– <span class="hljs-number"><span class="hljs-number">1</span></span> â€” sys_exit mov ebx, <span class="hljs-number"><span class="hljs-number">1</span></span> #    <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-number"><span class="hljs-number">0x80</span></span> #   b_bye = <span class="hljs-number"><span class="hljs-number">0x01</span></span> bcmd_bye: mov eax, <span class="hljs-number"><span class="hljs-number">4</span></span> #   â„– <span class="hljs-number"><span class="hljs-number">4</span></span> â€” sys_write mov ebx, <span class="hljs-number"><span class="hljs-number">1</span></span> #  â„– <span class="hljs-number"><span class="hljs-number">1</span></span> â€” <span class="hljs-built_in"><span class="hljs-built_in">stdout</span></span> mov ecx, offset msg_bye #     mov edx, msg_bye_len #   <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-number"><span class="hljs-number">0x80</span></span> #   mov eax, <span class="hljs-number"><span class="hljs-number">1</span></span> #   â„– <span class="hljs-number"><span class="hljs-number">1</span></span> â€” sys_exit mov ebx, <span class="hljs-number"><span class="hljs-number">0</span></span> #    <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-number"><span class="hljs-number">0x80</span></span> #   b_type = <span class="hljs-number"><span class="hljs-number">0x80</span></span> bcmd_type: mov eax, <span class="hljs-number"><span class="hljs-number">4</span></span> #   â„– <span class="hljs-number"><span class="hljs-number">4</span></span> â€” sys_write mov ebx, <span class="hljs-number"><span class="hljs-number">1</span></span> #  â„– <span class="hljs-number"><span class="hljs-number">1</span></span> â€” <span class="hljs-built_in"><span class="hljs-built_in">stdout</span></span> pop rdx pop rcx push r8 <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-number"><span class="hljs-number">0x80</span></span> #   pop r8 jmp _next</code> </pre><br></div></div><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ç»“æœå¦‚ä½• </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬åšäº†å¹¶æµ‹è¯•äº†å®Œæ•´ä¸”ç›¸å½“å¿«çš„64ä½å †æ ˆå­—èŠ‚æœºå™¨ã€‚åœ¨é€Ÿåº¦ä¸Šï¼Œä¹Ÿè®¸è¿™ä¸ªå­—èŠ‚æœºå™¨å°†æ˜¯åŒç±»äº§å“ä¸­æœ€å¿«çš„ï¼ˆæ²¡æœ‰JITçš„å †æ ˆå­—èŠ‚æœºå™¨ï¼‰ã€‚å¥¹çŸ¥é“å¦‚ä½•é¡ºåºæ‰§è¡Œå‘½ä»¤ï¼Œè¿›è¡Œæœ‰æ¡ä»¶å’Œæ— æ¡ä»¶çš„è·³è½¬ï¼Œè°ƒç”¨è¿‡ç¨‹ä»¥åŠä»ä¸­è¿”å›ã€‚åŒæ—¶ï¼Œæ‰€ä½¿ç”¨çš„å­—èŠ‚ç ç›¸å½“ç´§å‡‘ã€‚åŸºæœ¬ä¸Šï¼Œå­—èŠ‚å‘½ä»¤å ç”¨1-3ä¸ªå­—èŠ‚ï¼Œå¾ˆå°‘å ç”¨æ›´å¤šå­—èŠ‚ï¼ˆåªæœ‰å¤§æ•°å­—å’Œå¾ˆè¿œçš„è¿‡ç¨‹è°ƒç”¨ï¼‰ã€‚è¿˜ç»˜åˆ¶äº†ä¸€å°ç»„å­—èŠ‚å‘½ä»¤ï¼Œè¿™å¾ˆå®¹æ˜“æ‰©å±•ã€‚å‡è®¾æ‰€æœ‰ç”¨äºå †æ ˆçš„åŸºæœ¬å‘½ä»¤ï¼ˆä¸¢å¼ƒï¼Œäº¤æ¢ï¼Œè¦†ç›–ï¼Œæ ¹ç­‰å‡å¯åœ¨20åˆ†é’Ÿå†…ç¼–å†™ï¼Œç›¸åŒçš„æ•°é‡å°†ç”¨äºç®—æœ¯æ•´æ•°å‘½ä»¤ï¼‰ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¦ä¸€ä¸ªé‡ç‚¹ã€‚è¯¥å­—èŠ‚ç ä¸ç»å…¸çš„ç›´æ¥ç¼åˆ¶å ¡ç ä¸åŒï¼Œå®ƒä¸åŒ…å«æœºå™¨æŒ‡ä»¤ï¼Œå› æ­¤æ— éœ€é‡æ–°ç¼–è¯‘å³å¯å°†å…¶ä¼ è¾“åˆ°å¦ä¸€ä¸ªå¹³å°ã€‚ä¸€æ¬¡å°†å†…æ ¸é‡å†™åˆ°æ–°å¤„ç†å™¨çš„æŒ‡ä»¤ç³»ç»Ÿå°±è¶³å¤Ÿäº†ï¼Œå¹¶ä¸”å¯ä»¥å¾ˆå¿«å®Œæˆã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å­—èŠ‚æœºçš„å½“å‰ç‰ˆæœ¬ä¸ç‰¹å®šäºä»»ä½•ç‰¹å®šè¯­è¨€ã€‚ä½†æ˜¯æˆ‘æƒ³åœ¨å…¶ä¸Šå®ç°Fortè¯­è¨€ï¼Œå› ä¸ºæˆ‘æœ‰ä½¿ç”¨å®ƒçš„ç»éªŒï¼Œå¹¶ä¸”å®ƒçš„ç¼–è¯‘å™¨å¯ä»¥å¾ˆå¿«å®Œæˆã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¦‚æœå¯¹æ­¤æœ‰å…´è¶£ï¼Œåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« çš„åŸºç¡€ä¸Šï¼Œæˆ‘å°†åœ¨æ­¤æœºå™¨ä¸Šè¿›è¡Œå­—ç¬¦ä¸²å’Œæ•°å­—çš„è¾“å…¥è¾“å‡ºï¼Œå ¡å’å­—å…¸å’Œè§£é‡Šå™¨ã€‚æ‚¨å¯ä»¥ç”¨æ‰‹â€œè§¦æ‘¸â€å›¢é˜Ÿã€‚å¥½å§ï¼Œåœ¨ç¬¬ä¸‰ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†åˆ¶ä½œä¸€ä¸ªç¼–è¯‘å™¨ï¼Œå¹¶ä¸”æˆ‘ä»¬å¾—åˆ°äº†ä¸€ä¸ªå‡ ä¹å®Œæ•´çš„å ¡å’ç³»ç»Ÿã€‚è¿™æ ·å°±å¯ä»¥ç¼–å†™å’Œç¼–è¯‘ä¸€äº›æ ‡å‡†ç®—æ³•ï¼Œå¹¶å°†æ€§èƒ½ä¸å…¶ä»–è¯­è¨€å’Œç³»ç»Ÿè¿›è¡Œæ¯”è¾ƒã€‚æ‚¨å¯ä»¥ä½¿ç”¨ä¾‹å¦‚Eratosthenesçš„ç­›å­ç­‰ã€‚</font></font><br><br>      . ,    16- ,  ,     .     _next   ,       -       (       _next).  ,       _next,     _next ( 14 ).  ,     .     ,  . ,           .         . <br><br>     ,     (, A = 5 + (B + C * 4) ). <br><br>  ,    !  :) <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»§ç»­ï¼š</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç¾æ´²å°ç¬¬å®‰äººå ¡å’çš„å­—èŠ‚æœºï¼ˆä¸ä»…æ˜¯ï¼‰ï¼ˆç¬¬2éƒ¨åˆ†ï¼‰</font></font></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN431932/">https://habr.com/ru/post/zh-CN431932/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN431920/index.html">å‰ç«¯æ··åˆ-æœ‰å…³Node.jsï¼Œå¯ä¼¸ç¼©æ€§å’Œæœ¬æœºWebçš„æŠ¥å‘Š</a></li>
<li><a href="../zh-CN431922/index.html">ä»€ä¹ˆæ˜¯Javaä¸­çš„æ–¹æ³•å¥æŸ„</a></li>
<li><a href="../zh-CN431924/index.html">ä½¿ç”¨CQRSå’Œäº‹ä»¶é‡‡è´­çš„ä»“åº“ç®¡ç†ç³»ç»Ÿã€‚ å¼€å‘è¿‡ç¨‹</a></li>
<li><a href="../zh-CN431928/index.html">ä¸€æ¬¡æ€§ç‰©å“çš„ç–²åŠ³ã€‚ æˆ–é¢‚æ­ŒA.S. é©¬å¡è¿ç§‘</a></li>
<li><a href="../zh-CN431930/index.html">DevOpsèšä¼šåœ¨åœ£å½¼å¾—å ¡</a></li>
<li><a href="../zh-CN431934/index.html">äººå·¥æ™ºèƒ½å¦‚ä½•å¸®åŠ©å¤„ç†æ³•å¾‹æ–‡ä»¶ï¼Ÿ æ¥è‡ªABBYYçš„Egor Budnikovçš„æ¼”è®²</a></li>
<li><a href="../zh-CN431936/index.html">TechnoTextç«èµ›çš„ç»“æœ</a></li>
<li><a href="../zh-CN431938/index.html">Verilogä¸­çš„æ•´æ•°ç«‹æ–¹æ ¹</a></li>
<li><a href="../zh-CN431940/index.html">å¦‚æœäººä»¬ä¸è§‰å¾—è‡ªå·±çš„ä»·å€¼ï¼Œå°±ä¼šç­‹ç–²åŠ›å°½ã€‚ æ€ä¹ˆåŠå‘¢ï¼Ÿ</a></li>
<li><a href="../zh-CN431942/index.html">Reactå’ŒMobXçŠ¶æ€æ ‘ä¸­çš„åˆ†å±‚ä¾èµ–æ³¨å…¥ä½œä¸ºåŸŸæ¨¡å‹</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>