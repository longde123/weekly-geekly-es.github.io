<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßëüèø‚Äçü§ù‚ÄçüßëüèΩ üë®‚Äçüë©‚Äçüë¶‚Äçüë¶ üö≥ Agones, crea un servidor de juegos multiusuario. Arquitectura e instalaci√≥n üë≤üèæ üèª üßöüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Agones (de otro griego ag≈çn - "competencia") le permite implementar un cl√∫ster de servidores de juegos usando Kubernetes con Auto-Scaling. Este proyec...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Agones, crea un servidor de juegos multiusuario. Arquitectura e instalaci√≥n</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/469381/"><p>  Agones (de otro griego ag≈çn - "competencia") le permite implementar un cl√∫ster de servidores de juegos usando Kubernetes con Auto-Scaling.  Este proyecto de c√≥digo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">abierto</a> fue creado en 2018, ya obtuvo 2500 estrellas, estaba en Google I / O 2019 y, para la gran sorpresa, no fue mencionado en Habr√©.  El tema describe una breve excursi√≥n a la arquitectura e instrucciones para iniciar un servidor de prueba en una m√°quina local.  Si est√° interesado, bienvenido a Kat, vaya! </p><br><img src="https://habrastorage.org/getpro/habr/post_images/af7/fce/4ea/af7fce4ea1dbb86b3bac94479a1b1f15.png" alt="Logotipo de Agones"><a name="habracut"></a><br><h3>  Descripci√≥n del proyecto </h3><br><p>  Agones es un recurso personalizado ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Kubernetes API Extension</a> ). </p><br><p>  El proyecto en realidad requiere m√°s atenci√≥n, ya que le permite ejecutar un √∫nico servidor de juegos (GameServer) o una "flota" completa de servidores (Flotas) a trav√©s de archivos de configuraci√≥n yaml, a trav√©s de la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">API de Agones</a> .  A su vez, cada servidor emite alertas sobre su ciclo de vida (ciclos de vida de GameServer), describiendo el estado actual (comprobaci√≥n de estado, informaci√≥n de conexi√≥n).  Los servidores en el cl√∫ster tienen la capacidad de escalar autom√°ticamente (Fleet Autoscaling), que est√°n integrados con las capacidades b√°sicas de Kubernetes.  Adem√°s, hay una salida de estad√≠sticas en el tablero usando Prometheus, Grafana o Stackdriver, las m√©tricas se exportan a trav√©s de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">OpenCensus</a> , lo que le permite agregar su propio exportador.  Ejemplo de panel en Stackdriver: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/991/03b/929/99103b9292365163e2b77ae292e4eba2.png" alt="imagen"></p><br><h3>  Arquitectura, elementos b√°sicos. </h3><br><p>  Agones asume la tarea de lanzar, expandir autom√°ticamente y alojar servidores de juegos utilizando Kubernetes como base.  Esto te permite concentrarte en el desarrollo del servidor de juego multijugador, en lugar de desarrollar su infraestructura y soporte adicional.  Puede usar cualquier servidor de juegos que se pueda ejecutar en Linux, y se puede escribir en cualquier lenguaje de programaci√≥n. </p><br><p>  La API de Agones Kubernetes se divide en tres paquetes principales, cada uno de los cuales contiene recursos: agones.dev (GameServer, GameServerSet, Fleet), asignacion.agones.dev (GameServerAllocation), autoscaling.agones.dev (FleetAutoscaler).  Al igual que otros recursos de Kubernetes, los archivos yaml se utilizan para ejecutarlos. </p><br><p>  Una breve descripci√≥n de cada recurso: </p><br><ul><li>  GameServer: crea una determinada plantilla que le permite utilizar los par√°metros habituales de Pod, con algunas adiciones, como hostPort y containerPort para el servidor de juegos.  El SDK de Agones proporciona un contenedor de sidecar opcional con el que GameServer se comunicar√° constantemente </li><li>  GameServerSet: estructura de datos para varios GameServer, muy similar a la relaci√≥n entre Depoyment y ReplicaSet </li><li>  Flota: crea varios GameServer listos para usar, utiliza GameServerAllocation para distribuir recursos </li><li>  GameServerAllocation: solicita el GameServer de Fleet para su uso y marca que est√° listo para ser utilizado por los jugadores, por lo que GameServer no se eliminar√° autom√°ticamente </li><li>  FleetAutoscaler: se expande autom√°ticamente o, por el contrario, reduce el n√∫mero de servidores en Fleet </li></ul><br><p>  El diagrama ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">desde aqu√≠</a> ) muestra el ciclo de vida del recurso GameServer: </p><br><p><img src="https://habrastorage.org/webt/_2/2x/gc/_22xgcnfs_6ercdwmte8hktzynw.png"></p><br><p>  Las flechas moradas indican el SDK de Agones, rojo: la API del usuario, azul: el controlador del servidor del juego, amarillo: el controlador de la aplicaci√≥n. </p><br><h3>  Instalaci√≥n </h3><br><p>  En esta y las secciones posteriores, se utilizan equipos con <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">instrucciones</a> en el sitio web oficial, con algunas adiciones.  Recomendamos usar Kubernetes versi√≥n 1.12 (probado por los desarrolladores).  Para la prueba en la computadora local, puede usar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">minikube</a> , que requerir√° <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">kubectl</a> y un hipervisor ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Hyper-V</a> o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">VirtualBox</a> ) compatible con el sistema operativo. </p><br><p>  Para instalar el cl√∫ster y Agones, debe ejecutar los siguientes comandos: </p><br><pre><code class="bash hljs">minikube profile agones <span class="hljs-comment"><span class="hljs-comment">#    agones minikube start --kubernetes-version v1.12.10 --vm-driver hyperv #virtualbox minikube status #     kubectl create namespace agones-system #    agones kubectl apply -f https://raw.githubusercontent.com/googleforgames/agones/release-1.0.0/install/yaml/install.yaml</span></span></code> </pre> <br><p>  El √∫ltimo comando descarga el archivo de configuraci√≥n de Agones que crea definiciones de recursos personalizados (CRD) a trav√©s de la API de Kubernetes. </p><br><h3>  Lanzamiento de GameServer </h3><br><p>  Ahora puede iniciar el servidor UDP en el cl√∫ster utilizando el servidor de prueba listo de los ejemplos, que simplemente responder√° a la solicitud que se le env√≠e: </p><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># GameServer  kubectl create -f https://raw.githubusercontent.com/googleforgames/agones/release-1.0.0/examples/simple-udp/gameserver.yaml kubectl get gameservers #  GameServer minikube ip #     kubectl describe gameserver #    GameServer kubectl get gs #  ,   GameServer</span></span></code> </pre> <br><p>  Para confirmar que el servidor est√° funcionando, puede usar NetCat, para Linux el programa generalmente viene con el sistema, para Windows necesita descargarlo, por ejemplo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> .  NetCat debe iniciarse con el par√°metro <code>-u</code> (solicitud UDP), especificando la direcci√≥n del minikube (es mejor copiar la direcci√≥n del comando <code>minikube ip</code> ) y el puerto activo de GameServer: </p><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"hello"</span></span> | nc -u $(minikube ip) 7331</code> </pre> <br><p>  Si despu√©s de ejecutar el comando en la consola aparece la respuesta "ACK: hola", entonces el servidor est√° funcionando, puede apagarlo con el siguiente comando, que se inicializa: </p><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"EXIT"</span></span> | nc -u $(minikube ip) 7331</code> </pre> <br><p>  El estado del servidor es verificado por el equipo de <code>kubectl describe gameserver</code> , debe cambiar a Apagar. </p><br><h3>  Realizar cambios en GameServer </h3><br><p>  Usando el ejemplo anterior, cambiaremos la respuesta del servidor.  Primero, copie el repositorio del proyecto: </p><br><pre> <code class="bash hljs">git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> git@github.com:googleforgames/agones.git</code> </pre> <br><p>  En el archivo <a href="">agones / examples / simple-udp / main.go,</a> cambie la l√≠nea 159 a </p><br><pre> <code class="go hljs">respond(conn, sender, <span class="hljs-string"><span class="hljs-string">"ACKNOWLEDGED: "</span></span>+txt+<span class="hljs-string"><span class="hljs-string">"\n"</span></span>)</code> </pre> <br><p>  Desde la carpeta ra√≠z del proyecto, ejecute lo siguiente para crear una imagen acoplable y guardarla en minikube.  Para Windows, primero debe ejecutar <code>minikube docker-env | Invoke-Expression</code>  <code>minikube docker-env | Invoke-Expression</code> , para linux <code>eval $(minikube docker-env)</code> .  Esto le permitir√° crear im√°genes acoplables directamente en minikube. <br>  Crea una imagen acoplable: </p><br><pre> <code class="bash hljs">docker build -t agones-go:modified -f .\examples\simple-udp\Dockerfile .</code> </pre> <br><p>  Este comando puede tomar algo de tiempo, ya que todo el repositorio del proyecto se copiar√° a la imagen.  Esto se puede evitar dejando solo la carpeta sdks, main.go y Dockerfile en el directorio. </p><br><p>  A continuaci√≥n, en los <a href="">ejemplos \ simple-udp \ gameserver.yaml,</a> cambie la l√≠nea 28 a <code>image: agones-go:modified</code> y cree un nuevo GameServer: </p><br><pre> <code class="bash hljs">kubectl create -f .\examples\simple-udp\gameserver.yaml</code> </pre> <br><p>  Verifique los cambios y apague el servidor: </p><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"hello"</span></span> | nc -u 172.17.113.72 7331 <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"EXIT"</span></span> | nc -u 172.17.113.72 7331</code> </pre> <br><p>  Si despu√©s de ejecutar comandos en la consola aparece la respuesta "RECONOCIDO: hola", los cambios fueron exitosos. </p><br><h3>  Iniciamos el servidor localmente </h3><br><p>  Puede repetir los cambios para un desarrollo conveniente sin Kubernetes, utilizando solo el SDK de Agones.  Mientras se ejecuta el servidor de juegos, el SDK se comunica a trav√©s de TCP con un peque√±o servidor gRPC que Agones ejecuta en un contenedor bajo el mismo espacio de nombres.  Tal contenedor en Kubernetes se llama sidecar.  Por lo tanto, para el desarrollo local, debe iniciar el proceso SDK.  Para hacer esto, debe ejecutar su archivo fuente con el par√°metro <code>-local</code> , que activa el modo 'modo local'.  Este modo le dice al proceso que est√© en modo pasivo y que no se conecte a ning√∫n lado, solo muestre los registros en la consola para que pueda ver lo que hace el SDK mientras se ejecuta el servidor del juego. </p><br><p>  Puede descargar el √∫ltimo servidor agonessdk en las <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">versiones del</a> repositorio oficial del proyecto.  De manera predeterminada, despu√©s de iniciar el servidor SDK, se crea un espacio en blanco de configuraci√≥n de GameServer, que se utiliza para las solicitudes de SDK de GameServer () y WatchGameServer ().  En el inicio, puede especificar su propio archivo de configuraci√≥n en formato yaml o json, para esto necesita el par√°metro <code>-file</code> o su versi√≥n abreviada <code>-f</code> junto con el par√°metro <code>-local</code> . </p><br><pre> <code class="plaintext hljs">.\sdk-server --local -f .\examples\simple-udp\gameserver.yaml sdk-server : {"ctlConf":{"Address":"localhost","IsLocal":true,"LocalFile":".\\examples\\simple-udp\\gameserver.yaml","Timeout":0,"Test":""},"grpcPor t":59357,"httpPort":59358,"message":"Starting sdk sidecar","severity":"info","source":"main","time":"2019-09-29T12:45:59.8379817+02:00","version":"1.0.0"} {"filePath":"C:\\agones-release-1.0.0\\examples\\simple-udp\\gameserver.yaml","message":"Reading GameServer configuration","severity":"info","time":"2019-09-29T12:45:59.8479789+02:00"} {"message":"Starting SDKServer grpc service...","severity":"info","source":"main","time":"2019-09-29T12:45:59.8529791+02:00"} {"message":"Starting SDKServer grpc-gateway...","severity":"info","source":"main","time":"2019-09-29T12:46:00.1555756+02:00"}</code> </pre> <br><p>  Continuar√° ... </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/469381/">https://habr.com/ru/post/469381/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../469369/index.html">Eventos digitales en Mosc√∫ del 30 de septiembre al 06 de octubre</a></li>
<li><a href="../469371/index.html">Descripci√≥n del enfoque para organizar y probar c√≥digo usando Redux Thunk</a></li>
<li><a href="../469373/index.html">Los resultados del proyecto para crear una interfaz neuronal para pacientes completamente paralizados han cuestionado</a></li>
<li><a href="../469375/index.html">¬øPor qu√© Mozilla, Coil y Creative Commons asignan $ 100 millones para proyectos de c√≥digo abierto?</a></li>
<li><a href="../469379/index.html">Aplicaci√≥n de m√©todos formales de validaci√≥n de modelos para IU</a></li>
<li><a href="../469383/index.html">Soluci√≥n hiperconvergente AERODISK vAIR. Base: sistema de archivos ARDFS</a></li>
<li><a href="../469387/index.html">La historia de un "desarrollador" o c√≥mo un reci√©n llegado a escribir una aplicaci√≥n para iOS</a></li>
<li><a href="../469389/index.html">Parametrizaci√≥n por una red neuronal de un modelo f√≠sico para resolver un problema de optimizaci√≥n topol√≥gica</a></li>
<li><a href="../469391/index.html">Interfaces de audio: el sonido como fuente de informaci√≥n en la carretera, en la oficina y en el cielo</a></li>
<li><a href="../469393/index.html">Resumen de Flare-On 2019</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>