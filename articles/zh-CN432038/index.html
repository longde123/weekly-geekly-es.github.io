<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤰🏽 📳 🌮 点击成名，或如何激发机器人等... 🥌 👩‍⚕️ 🥇</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="从前，在一个遥远的商店的前面进行了一次窃听的谈话： 


NB: - ?  
 GURU : - «» . .    .   ,  ... 
 


 NB: - , ?  
 GURU : - google yandex , .  . , . 
 


 NB: - ?  
 GURU : - ?...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>点击成名，或如何激发机器人等...</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/432038/"><img src="https://habrastorage.org/webt/px/hq/po/pxhqpot6x9sqphxahh2fzhk4pz8.png"><br><br> 从前，在一个<strike>遥远的商店的前面进行了</strike>一次窃听的谈话： <br><blockquote><pre><code class="plaintext hljs">NB: -         ?</code> </pre> <br> <code><b>GURU</b> : -    «»      . . <b> </b>   <b></b> .  <b> </b> ,         <b></b> ...</code> <br> <br><pre> <code class="plaintext hljs">NB: -      ,     ?</code> </pre> <br> <code><b>GURU</b> : -    <strong>google</strong>   <b>yandex</b>  ,    .    <b></b>       .    ,      .</code> <br> <br><pre> <code class="plaintext hljs">NB: -       ?</code> </pre> <br> <code><b>GURU</b> : - ?…   <strong></strong> ...</code> <br> </blockquote>  <b>NB</b>停止询问，显然是担心惹恼一个显然更有经验的对话者。 <br>  <b>GURU</b>翻了个白眼，仿佛在强调代理主题的用尽，沉默了…… <br><a name="habracut"></a><br> 当然， <strong>GURU</strong>知道搜索查询（例如，用词：proxy）会很快导致<strong>NB</strong>获得所需的地址：端口列表。 但是经过第一个实验后， <strong>NB</strong>很快就会知道： <br><br><ul><li> 并非他列表上的所有地址都可以使用； </li><li> 并非所有代理都同样出色。 </li><li> 手动通过代理“粘贴”站点是一项需要大量意愿的任务； </li><li>  “错误”的代理人会伤害情况，因为 该站点可能会被包装中的巨人脚本所怀疑。 </li></ul><hr><br> 在本文中，我将讨论即兴演奏（最重要的是通用）的含义 <br>  （不使用特定的专有软件，如<strong>ZennoPoster</strong>等） <br> 构建一个自动化工具，以获取“非常合适”的代理列表，并使用它们来组织（自动）访问被推广的代理 <br> 使用<strong>Chrome浏览器的</strong>网站。 <br><br> 按照说明进行操作，您将获得现成的工具，该工具将允许： <br><br><ul><li> 完全自动“单击”（访问）目标站点，而不必担心受到威胁； </li><li> 完全模拟用户行为； </li><li> 根据时间表（场景）组织所有访问； </li><li> 进行必要的多次上述操作。 </li></ul><br> 尽管我的所有工作（以及研究工作）都花了一周的时间，但您无需花两天的时间就可以构建这样的工具，并且具有<strong>命令行</strong> ， <b>PHP</b>和<b>JavaScript的</b>基本知识。 <br><hr><br> 但是，在滚动到<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">下图之前</a> ，我会说几句话，说明为什么准备这份材料以及为谁准备。 <br><br> 如果您想了解结构（或构造器？）的排列方式，那么该材料将使您可以相对快速，轻松，无成本地构建应用程序，以适应负载变化。 如果您对基于服务总线（ <abbr title="企业服务总线">ESB</abbr> ）构建应用程序的可能性感兴趣。 <br><br> 如果您想熟悉<strong>Docker</strong>在<b>即时</b>构建系统中的使用，该文本将非常有用。 或者，如果您只是对<strong>Selenium Server</strong>和接收HTTPx活动的内容/表现的细微差别感兴趣。 <br><blockquote> 对于“立即使用”，若有所思地阅读所有这些都不值得。 该代码是肯定的。 </blockquote><div class="spoiler">  <b class="spoiler_title">直接安装完成的工具。</b>  <b class="spoiler_title">安装程序不到20分钟。</b> <div class="spoiler_text"> 本手册假定您有两台安装了Ubuntu 18.04的计算机供您使用。 <br> 一个用于基础架构（ <b>docker</b> ），另一个用于流程控制（ <b>process</b> ）。 <br><br> 假设以下软件包已安装在<b>docker上</b> ： <br><blockquote>  <i>git，码头工人，码头工人组成</i> </blockquote><br> 假定在<b>进程</b>中已经安装了以下软件包： <br><blockquote>  <i>git，php-common，php-cli，php-curl，php-zip，php-memcached，作曲家</i> </blockquote> 如果您现在有任何疑问，建议您花15分​​钟阅读全部内容。 <br><br>  <strong>码头工人</strong> <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#    root-. # ,     TCP-: # 11300, 11211, 4444, 5930, 8080, 8081, 8082, 8083 #        # " root-"    git clone \ https://oauth2:YRGzV8Ktx2ztoZg_oZZL@git.ituse.ru/deploy/esb-infrastructure.git cd esb-infrastructure docker-compose up --build -d #      3     #   . #       web-.</span></span></code> </pre><br>  <strong>过程</strong> <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#      . #      process-   , #     -  php- git clone \ https://oauth2:YRGzV8Ktx2ztoZg_oZZL@git.ituse.ru/deploy/clicker-noserver.git cd clicker-noserver composer update #  .       "XXXXXXXX" mv app/settings.php.dist app/settings.php #   . gnome-terminal \ --tab -e 'bash -c "php app/src/Process/noserver/singleProcess.php curl"' \ --tab -e 'bash -c "php app/src/Process/noserver/singleProcess.php timezone"' \ --tab -e 'bash -c "php app/src/Process/noserver/singleProcess.php whoer"' #  . ,     , #  : - log/list.proxy php app/src/Utils/givethejob.php ./log/list.proxy</span></span></code> </pre><br> 等待，通过Web面板观察正在发生的事情（http：// ip-address-docker-machines：8080）。 <br> 结果将在找到的队列中可用。 <br></div></div><a name="scheme"></a><br><h2> 破碎与计划 </h2><br><img src="https://habrastorage.org/webt/6e/1w/nc/6e1wnczv0tchzm_sq9pey6avk2o.png"><br><br> 上图描述了处理步骤的顺序，每个步骤的预期结果以及创建每个零件所需的资源（详细信息： <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">任务2</a> ， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">任务3</a> ， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">任务4,5,6</a> ）。 <br><br> 就我而言，一切都发生在两台<strong>Ubuntu 18.04</strong>计算机上。 其中之一控制过程。 另一方面，几个基础架构泊坞窗容器正在运行。 <br><br><blockquote><h4> 借口和失败 </h4><br> 所有程序包代码均由三部分组成。 <br> 其中之一不是我的（我注意到这是一个简洁漂亮的代码）。 该代码的来源是<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" title="packagist.org">packagist.org</a> 。 <br><br> 我自己写了另一本书，我试图使其易于理解，并花了大约一周的时间来编写这部分代码。 <br><br> 其余的是“艰难的历史遗产”。 这部分代码是在相当长的时间内创建的。 包括在我没有太多编程技能的时候。 <br><br> 这正是在我的<strong>GitLab</strong>和<strong>Satis</strong>上的软件包位置放置存储库的原因。 要在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" title="Github.com">GitHub.com</a>和<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" title="packagist.org">packagist.org</a>上发布<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" title="packagist.org">，</a>此代码将需要处理和更详尽的文档。 <br><br> 该代码的所有部分均开放供无限使用。 存储库和软件包将永远可用。 <br><br> 但是，当重新发布代码时，感谢您发布指向我或本文的链接。 <br></blockquote><br><h2> 关于架构的一点点 </h2><br> 用于创建工具的方法是编写（或使用现成的）实用程序来解决每个特定任务。 而且，每个实用程序，无论要解决的任务如何，都具有两个共有的属性： <br><br><ul><li> 可以从命令行使用包含任务的参数独立启动该实用程序； </li><li> 该实用程序可以将执行结果返回到stdout（以某种方式进行配置之后）。 </li></ul><br> 通过此原理制定的解决方案使您可以更改每个流程步骤的正在运行的任务处理程序（工作人员）的数量。 由于先前步骤的处理任务很长，因此每个步骤使用的工人数量不同，将导致后续步骤的“ 0”停机时间。 <br><br> 获取过程结果的单位（在我们的情况下是经过验证的代理）所花费的时间取决于外部因素（不合适的代理数量，外部资源的响应时间等）。 <br><br> 通过更改每个流程步骤的工作人员数量，我们将这种依赖性转换为对正在运行的工作人员数量的依赖性（即，取决于所涉及的计算和通道容量）。 <br><br> 为了同步各个独立部分的操作，将消息传递队列服务器用作单个数据总线很方便。 它将允许您在队列中累积已完成步骤的结果，并在适当的时候将其提供给“下一步”实用程序作为输入。 <br><br><h3> 消息队列。  MQ和ESB </h3><br> 作为较低级别（ <abbr title="消息队列">MQ</abbr> ），我们将使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" title="很棒的评论文章">beantalkd</a> 。 小型，轻巧，无需配置，可在deb包和Docker容器中使用，这是一个不起眼的艰苦工作。 逻辑级别（ <abbr title="企业服务总线">ESB</abbr> ）将用<strong>PHP</strong>实现代码。 <br><br> 两个类将用于实现。  <b>esbTask</b>和<b>nextStepWorker</b> 。 <br><br>  <b>esbTask</b> <br><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">esbTask</span></span></span><span class="hljs-class"> //   ,     </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// immutable-; // "" (   ESB-),  payload //    //     "" .... }</span></span></code> </pre><br> 此类的一个实例用于通过流程的各个步骤“解决” <abbr title="有效载荷">付款问题</abbr> 。  <abbr title="企业服务总线">ESB</abbr>概念采用了几种原理/模式。 其中两个值得分别注意： <br><br><ul><li> 关于流程的路径（步骤顺序），在流程的每个时间点， <br> 除了要发送的信封，没人知道。 <br></li><li> 每个信封都有三个可能的结果方向： <br><ul><li> 流程的下一步（正常继续）； </li><li> 停止步骤（停止目标-如果没有必要继续进行该过程/停止情况，则由下一步选择）； <br></li><li> 错误步骤（紧急终止目标-如果出现工作人员错误，则由下一步选择）。 <br></li></ul><br></li></ul><div class="spoiler">  <b class="spoiler_title">排队的对象以json表示，隐藏在这里...</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// json- esbTask { //    (   esbTask) "_type":"App\\\\rebean\\\\payloads\\\\ESBtaskQueue", //  "task":"task:queue@XXX.XXX.XXX.</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">11300", //    () "replyto":[ "othertask1:nextqueue1@yyy.XXX.XXX.</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">11300", "othertask2:nextqueue2", "othertask3:nextqueue3", ], //    () "onerror":[ "error:errorsstep@zzz.XXX.XXX.</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">11300", "error:errorsstep1", "error:errorsstep2", "error:errorsstep3" ], //     () "onstop":[ "stop:stopstep@kkk.XXX.XXX.</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">XXX:</span></span></span><span class="hljs-comment">11300", "stop:stopstep1", "stop:stopstep2", "stop:stopstep3" ], //   "payload":{ .... }, //   ... () "till":[ .... ], //     ... () //        // -  (LINUX-TimeStamp) "since":[ 1540073089.8833, ], // -     "points":1, //  .     "groupid":"" }</span></span></code> </pre><br></div></div><br>  <b>nextStepWorker</b> <br><br> 队列中显示的每条消息均由负责它的工作人员处理。 为此，实现了以下功能集： <br><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nextStepWorker</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">workerConstructor</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//       //     esbTask //    () //    MQ- (beanstalkd) //     (Memcached) //     (MySQL) // : -  (  - ); -    stop-; -      (log, event, mq) .... }</span></span></code> </pre><br> 每个过程步骤的工作人员都是基于此类来实现的。 处理，寻址和发送路径中下一步的整个例程，由类负责。 <br><br> 解决每个问题的方法是： <br><br><ol><li> 获取esbTask并运行worker； </li><li> 通过将结果存储在有效载荷中来实现逻辑； </li><li> 完成工人的处决（紧急还是正常-没关系）。 </li></ol><br> 如果步骤完成，结果将以适当的名称排队，下一个工作程序将开始处理。 <br><a name="subj2"></a><br><h2> 做一次。 查看空房 </h2><br> 实际上，创建工人解决任何问题是一种方法的实现。 解决<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">问题2</a>的工人的实现示例（简化）如下： <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// app/src/Process/worker/curlChecker.php .... class curlChecker extends nextStepWorker { const PROXY_INFO = 'https://api.ipfy.me?format=json&amp;geo=true'; const PROXY_TIMEOUT = '40'; const COMMAND = "curl -m %s -Lx http://%s:%s '%s'"; public function logic() { //    .  ..   payload extract($this-&gt;context()); //  defaults    payload  $curltimeout = $curltimeout ?? self::PROXY_TIMEOUT; $curlchecker = $curlchecker ?? self::PROXY_INFO; //     $line = sprintf( static::COMMAND, $curltimeout, $host, $port, $curlchecker ); exec($line, $info); //      // ( ,  stop-) $info = arrays::valid_json(implode('', info)); if (empty($info)) throw new \Exception("Bad proxy: $host:$port!", static::STATUS_STOP); //    payload $this-&gt;enrich(['info']) -&gt;sets(compact('info')); } }</span></span></code> </pre><br> 几行代码即可完成所有工作，并将其“分流”到下一个阶段。 <br><a name="subj3"></a><br><h2> 定义时区。  TimeZoneDB及其用途... </h2><br> 对传入请求的深入测试涉及将浏览器窗口时间与请求源IP地址存在的时间进行匹配。 <br><br> 为了避免被柜台怀疑，我们需要知道本地代理时间。 <br><br> 为了找出时间，我们从过程上一步的结果中获取经度和纬度，并获取有关将来的浏览器窗口实例将在其中工作的时区的数据。 这些数据将由时间<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" title="timezonedb.com">领域的专业人员</a>提供给我们。 <br><br> 解决此问题的简化工人（ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">任务3</a> ）与<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">上一个</a>工人完全类似。 唯一的区别是请求URL。 您可以在文件中找到完整版本： <br><blockquote>  // app / src / Process / worker / timeZone.php </blockquote><br><h2> 关于基础架构的一些知识 </h2><br> 除了所描述的<strong>beantalkd之外</strong> ，我们的工具还需要： <br><br><ul><li>  <strong>Memcached-</strong>用于缓存任务； </li><li>  <strong>Selenium</strong> <strong>Server-</strong>在一个单独的容器中运行<strong>Selenium Web Driver</strong>很方便，您可以通过<strong>VNC</strong>监视该过程； </li><li> 用于监视<strong>beantald</strong> ， <strong>memcached</strong>和<strong>VNC的</strong>仪表板。 </li></ul><br> 为了快速部署所有这些，Docker（ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" title="Docker白皮书">如何在Ubuntu上安装</a> ）非常方便。 <br><br><div class="spoiler">  <b class="spoiler_title">而他的“协调者”是docker-compose（安装命令）...</b> <div class="spoiler_text"><pre> <code class="bash hljs">sudo apt-get -y update sudo apt-get -y install docker-compose</code> </pre><br></div></div><br> 这些工具使您可以在父操作系统的单独“容器”中运行已配置和配置（由较早的人员配置）的服务器/进程。 有关详细信息，建议参考<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" title="好的Docker文章">本文</a>或本文。 <br><br> 所以... <br><br> 要启动基础结构，您需要在控制台中输入以下命令： <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#   ,    docker- #     (   ) #    sudo -s git clone \ https://oauth2:YRGzV8Ktx2ztoZg_oZZL@git.ituse.ru/deploy/esb-infrastructure.git \ panels cd panels docker-compose up --build -d #   .</span></span></code> </pre><br> 在地址为XXX.XXX.XXX.XXX的计算机上成功执行命令后， <br> 您将收到以下服务集： <br><blockquote>  <strong>-XXX.XXX.XXX.XXX:11300-缠豆</strong> <br>  -XXX.XXX.XXX.XXX:11211-Memcached <br>  -XXX.XXX.XXX.XXX-00-00444- <strong>Selenium服务器</strong> <br>  -XXX.XXX.XXX.XXX:5930-VNC服务器来控制<b>Chrome中</b>发生的情况 <br>  -XXX.XXX.XXX.XXX:8081-用于与<strong>Memcached</strong>通信的Web面板（管理员：通过） <br>  <strong>-XXX.XXX.XXX.XXX:8082-</strong>用于与<strong>beantalkd</strong>通信的Web面板 <br>  -XXX.XXX.XXX.XXX:8083-用于与<strong>VNC</strong>通信的Web面板（密码：秘密） <br>  -XXX.XXX.XXX.XXX:8080-常规网络面板 <br></blockquote><br><div class="spoiler">  <b class="spoiler_title">“扰流板”中的命令是“查看是否一切就绪”，“进入控制台进入容器”，“停止基础结构”。</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#   ,    docker-, #    ..../panels/ #    docker-compose ps # Name Command State Ports # ------------------------------------------------------------------------------------------------------------------------ # beanstalkd /usr/bin/beanstalkd Up 0.0.0.0:11300-&gt;11300/tcp # chrome start-cron Up 0.0.0.0:4444-&gt;4444/tcp, 0.0.0.0:5930-&gt;5900/tcp # memcached docker-entrypoint.sh memcached Up 0.0.0.0:11211-&gt;11211/tcp # nginx docker-php-entrypoint /sta ... Up 0.0.0.0:8443-&gt;443/tcp, 0.0.0.0:8080-&gt;80/tcp, # 0.0.0.0:8082-&gt;8082/tcp, 0.0.0.0:8083-&gt;8083/tcp, 9000/tcp # vnc /usr/bin/supervisord -c /e ... Up 0.0.0.0:8081-&gt;8081/tcp #       chrome docker exec -ti chrome /bin/bash #       docker-compose stop &amp;&amp; docker rm $(docker ps -a -q)</span></span></code> </pre></div></div><a name="subjs"></a><br><h2> 任务4,5,6-合并为一个实用程序 </h2><br> 详细研究了任务（上<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">图</a> ）后，很容易确保其余任务（ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">任务6</a> ）中只有一个依赖于外部资源。 在“有条件保证”的运行时（不受不受控制的因素影响）的情况下执行任务，我们不会在整个过程的速度上获得更多优势。 在这方面，这些任务（ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">4,5,6</a> ）被合并为一名工人。 工作文件称为： <br><blockquote>  // app / src / Process / worker / whoerChecker.php </blockquote><br><h3> 为Chrome进行设置。 外挂程式 </h3><br>  <strong>Chrome</strong>通过插件灵活配置。 <br><br>  <strong>Chrome</strong>的插件是一个包含<i>manifest.json</i>文件的存档。 他描述了插件。 该归档文件还包含该插件所需的一组<b>JavaScript，html，css和其他</b>文件（ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" title="Chrome官方文档">详细信息</a> ）。 <br><br> 在我们的情况下，其中一个<b>JavaScript</b>文件将在<strong>Chrome</strong>工作窗口的上下文中执行，所有必要的设置都会生效。 <br><br> 我们只需要获取插件模板，然后在正确的位置替换必要的数据（交互协议，地址和端口或时区）以代替被测试的代理服务器即可。 <br><br> 组成档案的一段代码： <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// app/src/Chrome/proxyHelper.php .... class proxyHelper extends sshDocker{ .... // $name -  - // $files - [ ... '   -' =&gt; '', ...] protected function buildPlugin(string $name, array $files) { $this-&gt;last = "$this-&gt;cache/$name"; if (!file_exists("$this-&gt;last")) { $zip = new \ZipArchive(); $zip-&gt;open("$this-&gt;last", \ZipArchive::CREATE | \ZipArchive::OVERWRITE); foreach ($files as $n =&gt; $data) { $zip-&gt;addFromString(basename($n), $data); } $zip-&gt;close(); } $this-&gt;all[] = $this-&gt;last; $this-&gt;all = array_unique($this-&gt;all); return $this; } .... }</span></span></code> </pre><br> 代理调整插件的模板是<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" title="用于在Chrome中安装代理的插件的存储库">在热爱专业人士的工作成果的存钱罐</a>中找到<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" title="用于在Chrome中安装代理的插件的存储库">的</a> ，在协议部分进行了更改，然后添加到了存储库中。 <br><br><h3> 窗口时间改变 </h3><br> 要更改正在运行的Chrome实例的全球时间，我们需要使用功能相似但在正确时区有效的类替换<i>window.Date</i> 。 <br><br> 我非常感谢<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" title="用于在Chrome中更改窗口时间的插件存储库">Sampo Juustila的工作</a> 。 该脚本是为<abbr title="使用者介面">UI的</abbr>自动化测试而制作的，但是经过了一些改进。 <br><br> 我想在此引起您的注意。 它与<i>manifest.json中</i>描述的脚本的上下文相关联。 <br><br> 整个秘密在于，全局上下文（在该上下文中启动了插件的主脚本并设置了设置，例如，连接到网络）与页面加载到的选项卡的上下文隔离。 <br><br> 根据经验，发现在全局上下文中对类的原型的影响并未导致其在选项卡中的更改。 但是，在已加载的页面中注册了脚本并在其他页面之前执行了脚本之后，问题得以解决。 <br><br> 解决方案由以下代码片段表示： <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// app/chromePlugins/timeShift/content.js //     var s = document.createElement('script'); //        s.src = chrome.extension.getURL('timeshift.js'); //      (document.head || document.documentElement).appendChild(s);</span></span></code> </pre><br><h3> 代理设定 </h3><br><div class="spoiler">  <b class="spoiler_title">在Chrome中设置代理非常简单，以至于我会将js代码隐藏在扰流器中</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// app/chromePlugins/proxy/background.js var config = { mode: "fixed_servers", rules: { singleProxy: { scheme: "%scheme", host: "%proxy_host", port: parseInt(%proxy_port) }, bypassList: ["foobar.com"] } }; chrome.proxy.settings.set({value: config, scope: "regular"}, function () { }); function callbackFn(details) { return { authCredentials: { username: "%username", password: "%password" } }; } chrome.webRequest.onAuthRequired.addListener( callbackFn, {urls: ["&amp;gtall_urls&amp;lt"]}, ['blocking'] );</span></span></code> </pre><br></div></div><br><h3>  Chrome插件路径 </h3><br><div class="spoiler">  <b class="spoiler_title">所有插件均根据方案命名，并被添加到控制该过程的计算机的临时文件夹中。</b> <div class="spoiler_text"><blockquote>  //代理插件的命名方案： <br> 代理服务器-[地址]-[端口]-[协议]&gt;。zip <br>  timeshift-[“-” |“”]-[shift_in_minutes_from_GMT] .zip </blockquote></div></div><br> 接下来，我们需要将这些插件安装在负责基础结构的机器上运行的docker容器中。 <br><br> 我们将使用ssh进行此操作。<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为此，我遇到了</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" title="Packagist.org上的phpseclib软件包"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">phpseclib</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（甚至后来对此感到遗憾）。</font><font style="vertical-align: inherit;">被图书馆的异常行为所吸引，我花了一天的时间研究它。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ssh控制台客户端将在此处更好地工作，并且将更快地工作，但是该工作已经完成。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于低级别（使用SFTP和SSH），基类负责（以下）。</font><font style="vertical-align: inherit;">替换此类将用</font><font style="vertical-align: inherit;">控制台客户端</font><font style="vertical-align: inherit;">替换</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" title="phpseclib存储库"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">phpseclib</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// app/src/Chrome/sshDocker.php //    (DOCKER_HOST, DOCKER_USER, DOCKER_PASS) //   : app/settings.php //      .... class sshDocker { .... //  .     docker //    .         // : app/techs.php const EXEC_DOCKER = DOCKER_BIN_PATH . "/docker exec -i %s %s"; .... //     sudo    (  ),  DOCKER_USER -  protected function sudo(string $command, string $expect = '.*'){...} //     Docker-,      //       -    self::EXEC_DOCKER protected function execDocker(string $command, string $expect){...} .... }</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 从基础sshDocker和已知的proxyHelper类派生而来，它不仅产生插件，而且将它们放在基础结构容器的临时文件夹中。 </font></font><br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// app/src/Chrome/proxyHelper.php .... class proxyHelper extends sshDocker { .... public static function new(string $docker, $plugins) { return (new self($docker, $plugins)) -&gt;setupPlugins(); } .... }</span></span></code> </pre><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 使用设置启动Chome </font></font></h3><br><font style="vertical-align: inherit;"><b><font style="vertical-align: inherit;">Selenium Server</font></b><font style="vertical-align: inherit;">将帮助我们</font><font style="vertical-align: inherit;">启动定制的</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chrome</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">Selenium Server是</font><strong><font style="vertical-align: inherit;">FaceBook</font></strong><font style="vertical-align: inherit;">团队创建的</font><font style="vertical-align: inherit;">专门用于测试WEB界面</font><font style="vertical-align: inherit;">的框架</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">框架使开发人员能够以编程方式模拟浏览器窗口中的任何用户操作（使用</font><b><font style="vertical-align: inherit;">Chrome</font></b><font style="vertical-align: inherit;">或</font><b><font style="vertical-align: inherit;">Firefox</font></b><font style="vertical-align: inherit;">）。</font><b><font style="vertical-align: inherit;">Selenium Server</font></b><font style="vertical-align: inherit;">适用于多种语言，实际上是编写测试脚本的标准工具。</font><font style="vertical-align: inherit;">获得要在项目中使用的新发行版的最佳方法：</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><strong><font style="vertical-align: inherit;"></font></strong><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br><br> <b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><br><br><pre> <code class="bash hljs">composer require facebook/webdriver</code> </pre><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Selenium Server对象的主要实例（RemoteWebDriver）的传统配置对我来说很冗长。</font></font></b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// URL- $url = "https://example.com/books/196/empire-v-povest-o-nastoyashem-sverhcheloveke"; // URL,     (Selenium Server) $server = 'http://' . DOCKER_HOST . '/wd/hub'; //   ,      $options = new ChromeOptions(); $options-&gt;addArguments(array( '--disable-notifications' )); //    - $capabilities = DesiredCapabilities::chrome(); $capabilities-&gt;setCapability(ChromeOptions::CAPABILITY, $options); //        5000     URL $driver = RemoteWebDriver::create($server, $capabilities, 5000); $page = $driver-&gt;get($url);</span></span></code> </pre><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 因此，我稍微减少了所有这些，针对我的需求优化了配置： </font></font><br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// app/src/Process/worker/whoerChecker.php .... class whoerChecker extends nextStepWorker { //    : app/settings.php // URL Selenium Server const SELENIUM_SERVER = CHVM; //  - const DOCKER_NAME = DOCKER_NAME; .... public function config() .... //        : // $driver = RemoteWebDriver::create($server, $capabilities, 5000); $chrome = Chrome::driver( static::SELENIUM_SERVER, Chrome::capabilities(static::DOCKER_NAME, $plugins), 5000 ); .... } ....</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">眼睛立即紧紧抓住$插件。</font><font style="vertical-align: inherit;">$ plugins是负责配置插件的数据结构。</font><font style="vertical-align: inherit;">对于每个目录以及替换</font><font style="vertical-align: inherit;">插件</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JavaScript</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件</font><font style="vertical-align: inherit;">中</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">占位符</font><font style="vertical-align: inherit;">。</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该结构在app / plugs.php文件中进行了描述，并且是全局选项app / settings.php的一部分。</font></font></b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// app/plugs.php const PLUGS = [ 'timeshift' =&gt; [ 'path' =&gt; PROJECTPATH . '/app/chromePlugins/timeShift', 'files' =&gt; ['manifest.json', 'timeshift.js', 'content.js'], 'fields' =&gt; ['%addsminutes' =&gt; 'timeshift'] ], 'proxy' =&gt; [ 'path' =&gt; PROJECTPATH . '/app/chromePlugins/proxy', 'files' =&gt; ['manifest.json', 'background.js'], 'fields' =&gt; [ '%proxy_host' =&gt; 'host', '%proxy_port' =&gt; 'port', '%scheme' =&gt; 'scheme', '%username' =&gt; 'user', '%password' =&gt; 'pass' ] ] ];</span></span></code> </pre><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Selenium WebDriver</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">解析页面</font><font style="vertical-align: inherit;">非常简单。</font></font><br><br><pre> <code class="php hljs">.... $url = <span class="hljs-string"><span class="hljs-string">'https://__/_-_'</span></span>; $page = $chrome-&gt;get($url); .... <span class="hljs-comment"><span class="hljs-comment">//   xPath-   $xpath = '/html[1]/body[1]/div[1]/div[1]/div[1]/div[2]/div[1]/div[1]/div[1]/div[1]/strong[1]'; $element = page-&gt;findElement(WebDriverBy::xpath($xpath)); .... //   $text = $element-&gt;getText(); // HTML- $html = $element-&gt;&gt;getAttribute('innerHTML'); ....</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正如我已经写过的，所有这些操作都是通过第三步的实用程序（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">任务4,5,6</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）实现的：</font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> // app / src / Process / worker / whoerChecker.php </font></font><br></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结束语关于</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Selenium Server的</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用的说明</font><font style="vertical-align: inherit;">，我想提请您注意以下事实：在工业规模上使用该技术（页面打开数为1000-3000），与</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Selenium Server</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的会话</font><font style="vertical-align: inherit;">错误结束的</font><font style="vertical-align: inherit;">情况并不少见</font><font style="vertical-align: inherit;">。窗口是无主的。这样的窗户会积累很多。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">考虑了几种对抗“胸针”的方法。工作“吃” 2天。最有效的是</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cron</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。正确安装和设置在多克尔容器变成一个独立的任务，并仔细描述很详细</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">renskiy</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" title="有关如何在Docker容器中使用cron的文章"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">致力于只有这个主题的文章中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（我很惊讶）。</font></font><br><br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" title="从存储库安装Clicker和Docker基础结构的详细说明"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基础结构存储库</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> docker-compose.yml中介绍了自动重建原始Docker映像以及安装多个脚本以关闭胸针并清理未使用的插件的过程</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">清理频率在同一存储库的killcron文件中设置。</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> WebRTC </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尽管我们已经设置了正确的时间，并且浏览器的流量通过了代理，但仍然可以检测到我们。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">除了时差（浏览器和IP地址）外，还有两个其他的去匿名化来源：“坐在代理后面”。</font><font style="vertical-align: inherit;">这些是</font><font style="vertical-align: inherit;">嵌入在浏览器</font><font style="vertical-align: inherit;">中的Flash和</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WebRTC</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">技术。</font><font style="vertical-align: inherit;">在我们的浏览器中</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Flash已</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">禁用，而</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WebRTC</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">则未</font><font style="vertical-align: inherit;">禁用</font><font style="vertical-align: inherit;">。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">两种失败可能性的原因是相同的-普遍存在的灵活</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UDP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据包。</font><font style="vertical-align: inherit;">对于</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WebRTC，</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这是两个端口：</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3478</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">19302</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了阻止侦察兵从chrome容器中外逃，iptables规则应用于具有基础结构容器的主机：</font></font><br><br><pre> <code class="bash hljs">iptables -t raw -I PREROUTING -p udp -m multiport --dports 3478,19302 -j DROP</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 相同的proxyHelper实现此任务。 </font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 其余的工人 </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了成功实现目标-通过匿名代理在目标站点上实现“点击”，我们还需要一名工作人员。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这将是</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">whoerChecker</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的截断版本</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">我认为，使用所写的所有内容自行完成，这并不困难。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整个过程的结果将落入已</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">定位的</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">队列中</font><font style="vertical-align: inherit;">，其中包含有关已验证的每个代理服务器地址的匿名程度的数据。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在柜台上“比赛”时，要记住的主要是匿名性，不会被机器人的访问所迷惑。</font><font style="vertical-align: inherit;">坚持的原则是“不要得意忘形点击”提供机会的活动如期组织，这是在合并</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esbTask</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（场</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，因为</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们的</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ESB</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">信封）。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果您尝试仔细地做所有事情，那么</font><font style="vertical-align: inherit;">目标站点</font><font style="vertical-align: inherit;">的</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">yandex度量</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将类似于下图。</font></font><br><br><img src="https://habrastorage.org/webt/es/wn/kk/eswnkk5esmtcunc6xvpn90ndefw.png"><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 如何将所有东西放在一起 </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 因此，鉴于： </font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">能够接受</font><font style="vertical-align: inherit;">json-string形式的</font><font style="vertical-align: inherit;">“作为输入”（作为命令行参数）</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esbTask的</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实用程序，</font><font style="vertical-align: inherit;">并执行一些逻辑，然后将结果发送给</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">beanstalkd</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">；</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于</font><b><font style="vertical-align: inherit;">beantalkd的</font></b><font style="vertical-align: inherit;">消息</font><b><font style="vertical-align: inherit;">队列</font></b><font style="vertical-align: inherit;">（</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MQ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">；</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Linux机器（Process machine）； </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有了这个“给定”，通常我使用</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">libevent</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">React PHP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">所有这些，再加上几种工具，可让您自动控制过程每个阶段的处理程序实例的数量（在指定的限制内）。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">但是，考虑到文章的大小和主题的细节，我很乐意在单独的文章中描述所有这些内容。</font><font style="vertical-align: inherit;">本文是</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">noserver</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">技术</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">未来的东西是“ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”。</font></font><blockquote><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">亲爱的读者，它的出版日期与您的兴趣有关。</font></font></b> <div class="spoiler_text"><blockquote>      .      , ,… . ,  ,    ,   ,     ,         . <br><br>   <b>habr</b>   ,     . , ,          . <br><br>        .     ,        " <b>server</b> ",       <b>README.md</b>         <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" title="   clicker  docker-  "> </a> . </blockquote></div></div></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在“ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">noserver</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”中，一个实例将处理一个队列（一个处理步骤）。</font><font style="vertical-align: inherit;">这种方法</font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">只会激怒</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我在调试工人时使用</font><s><font style="vertical-align: inherit;">的精神</font></s><font style="vertical-align: inherit;">。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根据所需的处理速度，您可以“手动”开始任意数量的副本。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它可能看起来像这样：</font></font><br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// app/src/Process/noserver/singleProcess.php //   ,    //   include __DIR__ . '/../../../settings.php'; use App\ESB\pipeNcacheService; use App\arrayNstring\queueDSN; use App\arrayNstring\timeSpent; use App\arrayNstring\progressString; //    $path = __DIR__ . '/../worker'; //   $queues = array_keys(WORKERS); $queue = $argv[1] ?? end($queues); $queue = strtolower($queue); if (!in_array($queue, $queues)) die("php $argv[0] &lt;queue_name&gt;" . PHP_EOL); //  - $progress = new progressString("Listenning... Idle: ", 40, 20); // ,      $stopwatch = timeSpent::start(); //    beanstalkd- list($worker, $task) = WORKERS[$queue]; $procid = ['procid' =&gt; posix_getpid()]; //   beanstalkd  Memcached, //     ( ) $dsn = new queueDSN($task, $queue, ...QUEUE_SERVER); //     ESB- $pnc = new pipeNcacheService($dsn); $pipe = $pnc-&gt;getPipe(); echo "Start listener for queue: $queue." . PHP_EOL; echo "Press Ctrl-C to stop listener." . PHP_EOL; //      //       while (true) { try { $job = $pipe-&gt;watch($queue) -&gt;reserve(1); $now = new DateTime(); $opts = json_encode($pipe-&gt;getPayload($job) + $procid); $pipe-&gt;delete($job); echo PHP_EOL . "Task recived at: " . $now-&gt;format('H:i:s') . " Starting worker: $worker. "; $stopwatch = timeSpent::start(); exec("php $path/$worker $opts", $out); echo "Finished. Time spent: $stopwatch" . PHP_EOL; $stopwatch = timeSpent::start(); } catch (Throwable $exception) { echo $progress($stopwatch('%I:%S', null, $now)); } }</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">工人的奇怪起点令人震惊……尽管每个工人都是一个PHP对象，但我还是使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exec（...）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这样做是为了节省时间，以便不要为“ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">noserver</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ” </font><font style="vertical-align: inherit;">创建单独的工作程序，</font><font style="vertical-align: inherit;">或者不为了以“ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">server</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ” </font><font style="vertical-align: inherit;">模式启动而更改工作程序</font><font style="vertical-align: inherit;">。</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 关于配置和部署的几句话 </font></font></h2><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 配置常量 </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您的实例的配置文件是</font></font><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">app / settings.php</font></font></i></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">您应该在克隆存储库后立即创建它。</font><font style="vertical-align: inherit;">为此，请重命名文件</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">app / settings.php.dist</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">所有常量均在内部进行描述。</font></font><br><br> <b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">app / settings.php</font></font></i></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以及其他内容包括具有其他常量的文件。</font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- </font></font><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应用程序/ queues.php</font></font></i></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含队列和作业的名称</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- </font></font><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应用程序/ plugs.php</font></font></i></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">铬</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -plaginov </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- </font></font><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应用程序/ techs.php</font></font></i></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含常数计算</font></font><br></blockquote><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 实用工具 </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了方便处理过程的结果和放置任务，有几个实用程序。</font><font style="vertical-align: inherit;">实用程序从命令行启动。</font><font style="vertical-align: inherit;">提供参数说明。</font><font style="vertical-align: inherit;">位于：</font></font><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">app / src / Utils</font></font></i></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br><blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> backup.php-将队列保存到文件</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    clear.php-清理队列</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    exporter.php-从具有已保存队列的文件中导出 </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                     配对地址：端口</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    Givethejob.php-将任务发布到流程 </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                     （源-地址：端口组合框）。</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                     可以从列表中排除一些地址</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    restore.php-恢复保存的队列 </font></font></pre></blockquote><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 对工人进行微调 </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 使用书面工作者时，使用以下配置选项可能会很方便： </font></font><br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// app/src/Process/worker/curlChecker.php .... $worker = new curlChecker( [ //    curlChecker::WORKER =&gt; 'curlchecker', //  beanstalkd curlChecker::PIPE_HOSTPORT =&gt; implode(':', QUEUE_SERVER), //  Memcached curlChecker::CACHE_HOSTPORT =&gt; implode(':', MEMCACHED), // ,    . //    -   curlChecker::DB_SCRIPT =&gt; __DIR__ . '/../../../confdb.php', // ,       // (        -) curlChecker::INFO_START =&gt; CURL_START, // ,        // (        -) curlChecker::INFO_END =&gt; CURL_END, //  ,     //    //        curlChecker::INFO_ADDS_END =&gt; ['host', 'port'] ], ['setupworker', 'config', 'logic'] ); ....</span></span></code> </pre><br><a name="deploy"></a><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 部署方式 </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本手册假定您有两台安装了</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ubuntu 18.04的</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">计算机供您使用</font><font style="vertical-align: inherit;">。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个用于基础架构（</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">docker</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），另一个用于流程控制（</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">process</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">码头工人</font></font></b> <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#    root-. # ,     TCP-: # 11300, 11211, 4444, 5930, 8080, 8081, 8082, 8083 #   . sudo -s apt -y update apt -y install git snap snap install docker apt -y install docker-compose # C       # " root-"    cd ~ git clone \ https://oauth2:YRGzV8Ktx2ztoZg_oZZL@git.ituse.ru/deploy/esb-infrastructure.git cd esb-infrastructure docker-compose up --build -d #      3     #   . #       web-.</span></span></code> </pre><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">过程</font></font></b> <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#      . #   . sudo apt -y update sudo apt -y install git php-common php-cli php-curl php-zip php-memcached composer # C     process-   , #     -  php- cd /var/www git clone \ https://oauth2:YRGzV8Ktx2ztoZg_oZZL@git.ituse.ru/deploy/clicker-noserver.git cd clicker-noserver composer update #  .       "XXXXXXXX" mv app/settings.php.dist app/settings.php #   . gnome-terminal \ --tab -e 'bash -c "php app/src/Process/noserver/singleProcess.php curl"' \ --tab -e 'bash -c "php app/src/Process/noserver/singleProcess.php timezone"' \ --tab -e 'bash -c "php app/src/Process/noserver/singleProcess.php whoer"' #  . ,     , #  : - log/list.proxy php app/src/Utils/givethejob.php ./log/list.proxy</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">等待，通过Web面板观察正在发生的事情（http：// ip-address-docker-machines：8080）。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结果将在队列中可</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">位于</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 最后 </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">令人惊讶的是，编写和编辑本文所花的时间比编写代码本身要花费更长的时间。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在我看来，如果没有两种意识形态：</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">消息队列</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">企业服务总线</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，一切都可能相反（并且时差可能会大几倍）</font><font style="vertical-align: inherit;">。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果您发现提出的编写应用程序的方法很有用，在设计阶段尚不清楚其不同部分的负担，我将非常高兴。</font></font><br><br> 谢谢啦 </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN432038/">https://habr.com/ru/post/zh-CN432038/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN432024/index.html">Gradle 5.0-新增功能</a></li>
<li><a href="../zh-CN432030/index.html">非接触式测谎仪的路径，或如何以最大速度安排黑客马拉松</a></li>
<li><a href="../zh-CN432032/index.html">我们完成了固定的Google搜索字段</a></li>
<li><a href="../zh-CN432034/index.html">鲁道夫·斯沃伦（Rudolf Svoren）的《循序渐进的电力》一书</a></li>
<li><a href="../zh-CN432036/index.html">实时：前端基础架构</a></li>
<li><a href="../zh-CN432040/index.html">验证者+方面：自定义验证</a></li>
<li><a href="../zh-CN432042/index.html">Yandex打开云。 新平台的架构</a></li>
<li><a href="../zh-CN432046/index.html">圣杯电信数据杯比赛。 最热的来</a></li>
<li><a href="../zh-CN432048/index.html">为什么有人会费心学习过时的语言。 F＃社区的案例研究</a></li>
<li><a href="../zh-CN432050/index.html">欢迎来到Waves区块链黑客马拉松</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>