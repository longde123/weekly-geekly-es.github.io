<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸŒ’ â° âœ¨ å¯ŒInternetåº”ç”¨ç¨‹åºä¸­çš„å¼‚æ­¥æ‰“å­—ç¨¿åŠå…¶è£…é¥°ç¨‹åº ğŸ‘©ğŸ¼â€ğŸ« ğŸ“½ï¸ ğŸ›³ï¸</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="è‡ªä»async / awaité—®ä¸–ä»¥æ¥ï¼ŒTypescriptå‘è¡¨äº†è®¸å¤šèµç¾è¿™ç§å¼€å‘æ–¹æ³•çš„æ–‡ç« ï¼ˆ hackernoon ï¼Œ blog.bitsrc.ioå’Œhabr.com ï¼‰ã€‚ æˆ‘ä»¬ä»å®¢æˆ·ç«¯çš„ä¸€å¼€å§‹å°±ä½¿ç”¨å®ƒä»¬ï¼ˆå½“ES6 Generatorsæ”¯æŒä¸åˆ°50ï¼…çš„æµè§ˆå™¨æ—¶ï¼‰ã€‚ ç°åœ¨ï¼Œæˆ‘æƒ³åˆ†äº«ä¸€ä¸‹æˆ‘çš„ç»éªŒï¼Œå› ä¸º...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>å¯ŒInternetåº”ç”¨ç¨‹åºä¸­çš„å¼‚æ­¥æ‰“å­—ç¨¿åŠå…¶è£…é¥°ç¨‹åº</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/464773/"><p>è‡ªä»<code>async</code> / <code>await</code>é—®ä¸–ä»¥æ¥ï¼ŒTypescriptå‘è¡¨äº†è®¸å¤šèµç¾è¿™ç§å¼€å‘æ–¹æ³•çš„æ–‡ç« ï¼ˆ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">hackernoon</a> ï¼Œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">blog.bitsrc.io</a>å’Œ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">habr.com</a> ï¼‰ã€‚ æˆ‘ä»¬ä»å®¢æˆ·ç«¯çš„ä¸€å¼€å§‹å°±ä½¿ç”¨å®ƒä»¬ï¼ˆå½“ES6 Generatorsæ”¯æŒä¸åˆ°50ï¼…çš„æµè§ˆå™¨æ—¶ï¼‰ã€‚ ç°åœ¨ï¼Œæˆ‘æƒ³åˆ†äº«ä¸€ä¸‹æˆ‘çš„ç»éªŒï¼Œå› ä¸º<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å¹¶è¡Œæ‰§è¡Œ</a>å¹¶ä¸æ˜¯æ²¿è¿™æ¡è·¯å¾„äº†è§£çš„å…¨éƒ¨å†…å®¹ã€‚ </p><a name="habracut"></a><br><p> æˆ‘ä¸å¤ªå–œæ¬¢æœ€åä¸€ç¯‡æ–‡ç« ï¼šæŸäº›ä¸œè¥¿å¯èƒ½ä»¤äººéš¾ä»¥ç†è§£ã€‚ éƒ¨åˆ†åŸå› æ˜¯æˆ‘æ— æ³•æä¾›ä¸“æœ‰ä»£ç -ä»…æ¦‚è¿°ä¸€èˆ¬æ–¹æ³•ã€‚ å› æ­¤ï¼š </p><br><ul><li> ä¸è¦çŠ¹è±«ï¼Œä¸é˜…è¯»å°±å…³é—­æ ‡ç­¾é¡µ </li><li> å¦‚æœæ‚¨è¿›è¡Œç®¡ç†ï¼Œè¯·è¯¢é—®ä¸æ¸…æ¥šçš„ç»†èŠ‚ </li><li> æˆ‘å°†å¾ˆé«˜å…´æ¥å—ä»æœ€æŒä¹…ï¼Œæœ€å½»åº•çš„å‘ç°åˆ°ç°åœ¨ä¸ºæ­¢çš„å»ºè®®å’Œæ‰¹è¯„ã€‚ </li></ul><br><p>  <strong>æ ¸å¿ƒæŠ€æœ¯åˆ—è¡¨ï¼š</strong> </p><br><ul><li> è¯¥é¡¹ç›®ä¸»è¦ä½¿ç”¨å‡ ä¸ªJavascriptåº“ä»¥Typescriptç¼–å†™ã€‚ ä¸»åº“æ˜¯ExtJSã€‚ å®ƒåœ¨æ—¶å°šæ€§ä¸Šä¸å¦‚Reactï¼Œä½†æœ€é€‚åˆå…·æœ‰ä¸°å¯Œæ¥å£çš„ä¼ä¸šäº§å“ï¼šè®¸å¤šç°æˆçš„ç»„ä»¶ï¼Œç²¾å¿ƒè®¾è®¡çš„è¡¨æ ¼ï¼Œä¸°å¯Œçš„ç›¸å…³äº§å“ç”Ÿæ€ç³»ç»Ÿå¯ç®€åŒ–å¼€å‘ã€‚ </li><li> å¼‚æ­¥å¤šçº¿ç¨‹æœåŠ¡å™¨ã€‚ </li><li> é€šè¿‡Websocketè¿›è¡Œçš„RPCç”¨ä½œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„ä¼ è¾“ã€‚ è¯¥å®ç°ç±»ä¼¼äº.NET WCFã€‚ <br><ul><li> ä»»ä½•å¯¹è±¡éƒ½æ˜¯æœåŠ¡ã€‚ </li><li> ä»»ä½•å¯¹è±¡éƒ½å¯ä»¥é€šè¿‡å€¼å’Œå¼•ç”¨æ¥ä¼ è¾“ã€‚ </li></ul></li><li> æ•°æ®è¯·æ±‚ç•Œé¢ç±»ä¼¼äºFacebookä¸Šçš„GraphQLï¼Œä»…åœ¨Typescriptä¸Šã€‚ </li><li> åŒå‘é€šä¿¡ï¼šå¯ä»¥ä»å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å¯åŠ¨æ•°æ®æ›´æ–°çš„åˆå§‹åŒ–ã€‚ </li><li> å¼‚æ­¥ä»£ç æ˜¯é€šè¿‡ä½¿ç”¨Typesrciptçš„<code>async</code> / <code>await</code>å‡½æ•°é¡ºåºç¼–å†™çš„ã€‚ </li><li> æœåŠ¡å™¨APIæ˜¯åœ¨Typescriptä¸­ç”Ÿæˆçš„ï¼šå¦‚æœæ›´æ”¹ï¼Œåˆ™åœ¨å‘ç”Ÿé”™è¯¯æ—¶ï¼Œæ„å»ºå°†ç«‹å³æ˜¾ç¤ºå®ƒã€‚ </li></ul><br><p>  <strong>è¾“å‡ºæ˜¯ä»€ä¹ˆ</strong> </p><br><p> æˆ‘å°†å‘Šè¯‰æ‚¨æˆ‘ä»¬å¦‚ä½•ä½¿ç”¨å®ƒä»¥åŠä¸ºå®‰å…¨ï¼Œéç«äº‰æ€§åœ°æ‰§è¡Œå¼‚æ­¥ä»£ç æ‰€åšçš„å·¥ä½œï¼šæˆ‘ä»¬çš„Typesrciptè£…é¥°å™¨å®ç°äº†é˜Ÿåˆ—çš„åŠŸèƒ½ã€‚ ä»åŸºç¡€åˆ°è§£å†³ç§æ—çŠ¶å†µä»¥åŠåœ¨å¼€å‘è¿‡ç¨‹ä¸­å‡ºç°çš„å…¶ä»–å›°éš¾ã€‚ </p><br><h2 id="kak-strukturirovany-dannye-poluchaemye-s-servera"> ä»æœåŠ¡å™¨æ¥æ”¶çš„æ•°æ®çš„ç»“æ„å¦‚ä½• </h2><br><p> æœåŠ¡å™¨ä»¥å›¾å½¢çš„å½¢å¼è¿”å›å…¶å±æ€§ä¸­åŒ…å«æ•°æ®ï¼ˆå…¶ä»–å¯¹è±¡ï¼Œå¯¹è±¡é›†åˆï¼Œè¡Œç­‰ï¼‰çš„çˆ¶å¯¹è±¡ã€‚ è¿™ä¸»è¦å½’å› äºåº”ç”¨ç¨‹åºæœ¬èº«ï¼š </p><br><ul><li> å®ƒä½¿æ•°æ®åˆ†æ/ MLæˆä¸ºå¤„ç†ç¨‹åºèŠ‚ç‚¹çš„æœ‰å‘å›¾ã€‚ </li><li> æ¯ä¸ªèŠ‚ç‚¹åˆå¯ä»¥åŒ…å«è‡ªå·±çš„åµŒå…¥å¼å›¾ </li><li> å›¾å…·æœ‰ä¾èµ–æ€§ï¼šå¯ä»¥â€œç»§æ‰¿â€èŠ‚ç‚¹ï¼Œå¹¶é€šè¿‡å…¶â€œç±»â€åˆ›å»ºæ–°èŠ‚ç‚¹ã€‚ </li></ul><br><p> ä½†æ˜¯å›¾å½¢å½¢å¼çš„æŸ¥è¯¢ç»“æ„å‡ ä¹å¯ä»¥åœ¨ä»»ä½•åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ï¼Œæ®æˆ‘æ‰€çŸ¥ï¼ŒGraphQLåœ¨å…¶è§„èŒƒä¸­ä¹Ÿæåˆ°äº†è¿™ä¸€ç‚¹ã€‚ </p><br><p> æ•°æ®ç»“æ„ç¤ºä¾‹ï¼š </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//   interface IParent { ServerId: string; Nodes: INodes; // INodes -     INode } //     interface INodes&lt;TNode extends INode&gt; extends ICollection { IndexOf(item: TNode): number; Item(index: number): TNode; // ...     } //    interface INode extends IItem { Guid: string; Name: string; DisplayName: string; Links: ILinks; // ILinks -    Info: INodeInfo; //    -  } //      interface ILink { Guid: string; DisplayName: string; SourceNode: INode; //   -  TargetNode: INode; //   ,   } interface INodeInfo { Component: IComponent; ConfigData: IData; }</span></span></code> </pre><br><h2 id="kak-klient-poluchaet-dannye"> å®¢æˆ·ç«¯å¦‚ä½•æ¥æ”¶æ•°æ® </h2><br><p> å¾ˆç®€å•ï¼šå½“æ‚¨è¯·æ±‚éæ ‡é‡ç±»å‹çš„å¯¹è±¡çš„å±æ€§æ—¶ï¼ŒRPCè¿”å›<code>Promise</code> ï¼š </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> Nodes = Parent.Nodes; <span class="hljs-comment"><span class="hljs-comment">// Nodes -&gt; Promise&lt;INodes&gt;</span></span></code> </pre><br><h3 id="asinhronnost-bez-callback-hell"> æ²¡æœ‰â€œå›è°ƒåœ°ç‹±â€çš„å¼‚æ­¥ã€‚ </h3><br><p> ä¸ºäº†ç»„ç»‡â€œé¡ºåºâ€å¼‚æ­¥ä»£ç ï¼Œä½¿ç”¨Typescript <code>async</code> / <code>await</code>åŠŸèƒ½ï¼š </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ShowNodes</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">parent: IParent</span></span></span><span class="hljs-function">): </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Promise</span></span></span><span class="hljs-function">&lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">void</span></span></span><span class="hljs-function">&gt; </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//    let Nodes = await parent.Nodes; //       await Nodes.forEachParallel(async function(node): Promise&lt;void&gt; { await RenderNode(node); //          }); }</span></span></code> </pre><br><p> å¯¹å…¶è¿›è¡Œè¯¦ç»†è®¨è®ºæ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œå› ä¸ºè½®æ¯‚ä¸Šå·²ç»æœ‰è¶³å¤Ÿçš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è¯¦ç»†ææ–™</a> ã€‚ ä»–ä»¬æ—©åœ¨2016å¹´å°±å‡ºç°åœ¨Typescriptä¸­ã€‚ è‡ªä»å®ƒå‡ºç°åœ¨Typescriptå­˜å‚¨åº“çš„åŠŸèƒ½åˆ†æ”¯ä¸­ä»¥æ¥ï¼Œæˆ‘ä»¬ä¸€ç›´åœ¨ä½¿ç”¨è¿™ç§æ–¹æ³•ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬å·²ç»é‡åˆ°éº»çƒ¦å¹¶ç°åœ¨å¾ˆæ„‰å¿«åœ°å·¥ä½œçš„åŸå› ã€‚ å·²æœ‰ä¸€æ®µæ—¶é—´ï¼Œå¹¶ä¸”å·²ç»æŠ•å…¥ç”Ÿäº§ã€‚ </p><br><p> ç®€è¦åœ°è¯´ï¼Œå¯¹äºé‚£äº›ä¸ç†Ÿæ‚‰è¯¥ä¸»é¢˜çš„äººæ¥è¯´ï¼Œå…¶æœ¬è´¨æ˜¯ï¼š </p><br><p> å°†<code>async</code>å…³é”®å­—æ·»åŠ åˆ°å‡½æ•°åï¼Œå®ƒå°†è‡ªåŠ¨è¿”å›<code>Promise&lt;_&gt;</code> ã€‚ æ­¤ç±»åŠŸèƒ½çš„ç‰¹ç‚¹ï¼š </p><br><ul><li> å¸¦æœ‰<code>await</code> <code>async</code>å‡½æ•°å†…éƒ¨çš„è¡¨è¾¾å¼ï¼ˆè¿”å›<code>Promise</code> ï¼‰å°†åœæ­¢å‡½æ•°çš„æ‰§è¡Œï¼Œå¹¶åœ¨è§£å†³äº†é¢„æœŸçš„<code>Promise</code>ä¹‹åç»§ç»­æ‰§è¡Œã€‚ </li><li> å¦‚æœ<code>async</code>å‡½æ•°ä¸­å‘ç”Ÿå¼‚å¸¸ï¼Œåˆ™æ­¤å¼‚å¸¸å°†æ‹’ç»è¿”å›çš„<code>Promise</code> ã€‚ </li><li> ä½¿ç”¨Javascriptä»£ç è¿›è¡Œç¼–è¯‘æ—¶ï¼Œå°†ä½¿ç”¨ES6æ ‡å‡†çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç”Ÿæˆå™¨</a> ï¼ˆç”¨<code>function*</code>ä»£æ›¿<code>async function</code>å¹¶ä½¿ç”¨<code>yield</code>ä»£æ›¿<code>await</code> ï¼‰æˆ–å¸¦æœ‰ES5 <code>switch</code>å¯æ€•ä»£ç ï¼ˆçŠ¶æ€æœºï¼‰ã€‚  <code>await</code>æ˜¯ç­‰å¾…promiseç»“æœçš„å…³é”®å­—ã€‚ åœ¨ä¼šè®®æ—¶ï¼Œåœ¨æ‰§è¡Œä»£ç æœŸé—´ï¼Œ <code>ShowNodes</code>å‡½æ•°åœæ­¢ï¼Œå¹¶ä¸”åœ¨ç­‰å¾…æ•°æ®æ—¶ï¼ŒJavascriptå¯èƒ½æ‰§è¡Œå…¶ä»–ä»£ç ã€‚ </li></ul><br><p> åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œé›†åˆå…·æœ‰<code>forEachParallel</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¸ºæ¯ä¸ªèŠ‚ç‚¹å¹¶è¡Œè°ƒç”¨å¼‚æ­¥å›è°ƒã€‚ åŒæ—¶ï¼Œåœ¨<code>Nodes.forEachParallel</code>å°†ç­‰å¾…æ‰€æœ‰å›è°ƒä¹‹å‰ç­‰å¾…ã€‚ åœ¨å®ç°å†…éƒ¨<code>Promise.all</code> ï¼š </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/** *            * @param items  * @param callbackfn  * @param [thisArg]   ,      this  callbackfn */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">forEachParallel</span></span></span><span class="hljs-function">&lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">T</span></span></span><span class="hljs-function">&gt;(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">items: IItemArray&lt;T&gt;, callbackfn: (value: T, index: int, items: IItemArray&lt;T&gt;</span></span></span><span class="hljs-function">) =&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Promise</span></span></span><span class="hljs-function">&lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">void</span></span></span><span class="hljs-function"> | </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">any</span></span></span><span class="hljs-function">&gt;, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">thisArg</span></span></span><span class="hljs-function">?: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">any</span></span></span><span class="hljs-function">): </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Promise</span></span></span><span class="hljs-function">&lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">void</span></span></span><span class="hljs-function">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> xCount = items ? <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> items.Count : <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!xCount) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> xActions = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Array</span></span>&lt;<span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">void</span></span> | any&gt;&gt;<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">xCount</span></span></span><span class="hljs-function">); </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">for</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">let</span></span></span></span><span class="hljs-function"><span class="hljs-params"> i = </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">; i &lt; xCount; i++</span></span></span><span class="hljs-function">) { </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">let</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">xItem</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">items</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Item</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">i</span></span></span><span class="hljs-function">); </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">xActions</span></span></span><span class="hljs-function">[</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">i</span></span></span><span class="hljs-function">] = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ExecuteCallback</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">xItem, callbackfn, i, items, thisArg</span></span></span><span class="hljs-function">); } </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">await</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Promise</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">all</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">xActions</span></span></span><span class="hljs-function">); } /**   </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">item</span></span></span><span class="hljs-function">   </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">callbackfn</span></span></span><span class="hljs-function"> */ </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">async</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ExecuteCallback</span></span></span><span class="hljs-function">&lt;</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">T</span></span></span><span class="hljs-function">&gt;(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">item: </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">Promise</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;T&gt; | T, callbackfn: (value: T, index: int, items: IItemArray&lt;T&gt;</span></span></span><span class="hljs-function">) =&gt;</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">void</span></span> | any&gt;, <span class="hljs-attr"><span class="hljs-attr">index</span></span>: int, <span class="hljs-attr"><span class="hljs-attr">items</span></span>: IItemArray&lt;T&gt;, thisArg?: any): <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>&gt; { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> xItem = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> item; <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> callbackfn.call(thisArg, xItem, index, items); }</code> </pre><br><p> è¿™æ˜¯è¯­æ³•ç³–ï¼šæ­¤ç±»æ–¹æ³•ä¸ä»…åº”ç”¨äºå…¶é›†åˆï¼Œè¿˜åº”ç”¨äºæ ‡å‡†Javascriptæ•°ç»„ã€‚ </p><br><p>  <code>ShowNodes</code>å‡½æ•°çœ‹èµ·æ¥æå…¶ä¸ç†æƒ³ï¼šå½“æˆ‘ä»¬è¯·æ±‚å¦ä¸€ä¸ªå®ä½“æ—¶ï¼Œæˆ‘ä»¬æ¯æ¬¡éƒ½ç­‰å¾…å®ƒã€‚ æ–¹ä¾¿ä¹‹å¤„åœ¨äºå¯ä»¥å¿«é€Ÿç¼–å†™æ­¤ç±»ä»£ç ï¼Œå› æ­¤æ­¤æ–¹æ³•é€‚åˆå¿«é€ŸåŸå‹åˆ¶ä½œã€‚ åœ¨æœ€ç»ˆç‰ˆæœ¬ä¸­ï¼Œæ‚¨éœ€è¦ä½¿ç”¨æŸ¥è¯¢è¯­è¨€æ¥å‡å°‘å¯¹æœåŠ¡å™¨çš„è°ƒç”¨æ¬¡æ•°ã€‚ </p><br><h2 id="yazyk-zaprosov"> æŸ¥è¯¢è¯­è¨€ </h2><br><p> æœ‰å‡ ç§åŠŸèƒ½å¯ç”¨äºâ€œæ„å»ºâ€æœåŠ¡å™¨çš„æ•°æ®è¯·æ±‚ã€‚ ä»–ä»¬â€œå‘Šè¯‰â€æœåŠ¡å™¨å“åº”ä¸­è¦è¿”å›çš„æ•°æ®å›¾èŠ‚ç‚¹ï¼š </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/** *       item    Promise  , *      properties */</span></span> selectAsync&lt;T extends IItem&gt;<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">item: T, properties: (</span></span></span><span class="hljs-function">) =&gt;</span></span> any[]): <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>&lt;T&gt;; <span class="hljs-comment"><span class="hljs-comment">/** *   items,       properties */</span></span> selectAsyncAll&lt;T extends ICollection&gt;<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">items: T[], properties: (</span></span></span><span class="hljs-function">) =&gt;</span></span> any[]): <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>&lt;T[]&gt;; <span class="hljs-comment"><span class="hljs-comment">/**    selectAsync     */</span></span> select&lt;T&gt;<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">item: T, properties: (</span></span></span><span class="hljs-function">) =&gt;</span></span> any[]): T; <span class="hljs-comment"><span class="hljs-comment">/**    selectAsync     */</span></span> selectAll&lt;T&gt;<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">items: T[], properties: (</span></span></span><span class="hljs-function">) =&gt;</span></span> any[]): T[];</code> </pre><br><p> ç°åœ¨ï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹è¿™äº›å‡½æ•°çš„åº”ç”¨ç¨‹åºï¼Œå®ƒä»¬é€šè¿‡è°ƒç”¨æœåŠ¡å™¨æ¥è¯·æ±‚å¿…è¦çš„åµŒå…¥å¼æ•°æ®ï¼š </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ShowNodes</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">parentPoint: IParent</span></span></span><span class="hljs-function">): </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Promise</span></span></span><span class="hljs-function">&lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">void</span></span></span><span class="hljs-function">&gt; </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//       IParent -    selectAsync ( // Promise,  ). let Parent = await selectAsync(parentPoint, parent =&gt; [ //           selectAll(parent.Nodes, nodes =&gt; [node.Name, node.DisplayName]) // [node.Name, node.DisplayName] -        ]); //      Parent.Nodes ... }</span></span></code> </pre><br><p> ä¸€ä¸ªå¸¦æœ‰æ·±å±‚åµŒå…¥ä¿¡æ¯çš„ç¨å¾®å¤æ‚çš„æŸ¥è¯¢çš„ç¤ºä¾‹ï¼š </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//     parent.Nodes  selectAsyncAll,    let Parent = await selectAsyncAll(parent.Nodes, nodes =&gt; [ //    : select(node, node =&gt; [ node.Name, node.DisplayName, selectAll(node.Links, link =&gt; [ link.Guid, link.DisplayName, select(link.TargetNode, targetNode =&gt; [targetNode.Guid]) ]), select(node.Info, info =&gt; [info.Component]) //    IInfo    IComponent,   ,   ,        ]) ]);</span></span></code> </pre><br><p> æŸ¥è¯¢è¯­è¨€æœ‰åŠ©äºé¿å…å¯¹æœåŠ¡å™¨çš„ä¸å¿…è¦è¯·æ±‚ã€‚ ä½†æ˜¯ä»£ç ä»æ¥éƒ½ä¸æ˜¯å®Œç¾çš„ï¼Œå®ƒè‚¯å®šä¼šåŒ…å«ä¸€äº›ç«äº‰æ€§è¦æ±‚ï¼Œå¹¶å› æ­¤å¯¼è‡´ç«äº‰çŠ¶å†µã€‚ </p><br><h2 id="race-condition-i-puti-resheniya"> æ¯”èµ›æ¡ä»¶å’Œè§£å†³æ–¹æ¡ˆ </h2><br><p> ç”±äºæˆ‘ä»¬è®¢é˜…æœåŠ¡å™¨äº‹ä»¶å¹¶ä½¿ç”¨å¤§é‡å¼‚æ­¥è¯·æ±‚ç¼–å†™ä»£ç ï¼Œå› æ­¤å½“<code>async</code> <code>FuncOne</code>å‡½æ•°<code>FuncOne</code>ä¸­æ–­å¹¶ç­‰å¾…<code>Promise</code>æ—¶ï¼Œå¯èƒ½ä¼šå‡ºç°ç«äº‰æ¡ä»¶ã€‚ è¿™æ—¶ï¼Œå¯èƒ½ä¼šå‘ç”ŸæœåŠ¡å™¨äº‹ä»¶ï¼ˆæˆ–æ¥è‡ªä¸‹ä¸€ä¸ªç”¨æˆ·æ“ä½œï¼‰ï¼Œå¹¶ä¸”å·²ç»ç«äº‰æ‰§è¡Œäº†è¯¥è¯·æ±‚ï¼Œæ›´æ”¹äº†å®¢æˆ·ç«¯ä¸Šçš„æ¨¡å‹ã€‚ ç„¶åï¼Œ <code>FuncOne</code>åœ¨å…‘ç°æ‰¿è¯ºåï¼Œå¯ä»¥è½¬å‘ä¾‹å¦‚å·²åˆ é™¤çš„èµ„æºã€‚ </p><br><p> æƒ³è±¡ä¸€ä¸‹è¿™æ ·çš„ç®€åŒ–æƒ…å†µï¼š <code>IParent</code>å¯¹è±¡å…·æœ‰<code>IParent</code>æœåŠ¡å™¨å§”æ‰˜ã€‚ </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/**   */</span></span> Parent.OnSynchronize.AddListener(<span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>): </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Promise</span></span></span><span class="hljs-function">&lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">void</span></span></span><span class="hljs-function">&gt; </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//  .   ,  . });</span></span></code> </pre><br><p> åœ¨æœåŠ¡å™¨ä¸Šçš„<code>INodes</code>èŠ‚ç‚¹åˆ—è¡¨æ›´æ–°æ—¶è°ƒç”¨ã€‚ ç„¶åï¼Œåœ¨ä»¥ä¸‹æƒ…å†µä¸‹ï¼Œå¯èƒ½ä¼šå‡ºç°ç«äº‰çŠ¶å†µï¼š </p><br><ol><li> æˆ‘ä»¬å¯¼è‡´ä»å®¢æˆ·ç«¯å¼‚æ­¥ç§»é™¤èŠ‚ç‚¹ï¼Œç­‰å¾…åˆ é™¤å®¢æˆ·ç«¯å¯¹è±¡çš„å®Œæˆ <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnClickRemoveNode</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">node: INode</span></span></span><span class="hljs-function">): </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Promise</span></span></span><span class="hljs-function">&lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">void</span></span></span><span class="hljs-function">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> removedOnServer: boolean = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> Parent.RemoveNode(node); <span class="hljs-comment"><span class="hljs-comment">//     if (removedOnServer) .... }</span></span></code> </pre> </li><li> é€šè¿‡<code>Parent.OnSynchronize</code> ï¼Œå°†å‘ç”ŸèŠ‚ç‚¹åˆ—è¡¨äº‹ä»¶çš„æ›´æ–°ã€‚ </li><li>  <code>Parent.OnSynchronize</code>å¤„ç†å¹¶åˆ é™¤å®¢æˆ·ç«¯å¯¹è±¡ã€‚ </li><li> ç¬¬ä¸€æ¬¡<code>await</code>åï¼Œ <code>async OnClickRemoveNode()</code>ç»§ç»­æ‰§è¡Œï¼Œå¹¶å°è¯•åˆ é™¤å·²ç»åˆ é™¤çš„å®¢æˆ·ç«¯å¯¹è±¡ã€‚ </li></ol><br><p> æ‚¨å¯ä»¥åœ¨<code>OnClickRemoveNode</code>æ£€æŸ¥å®¢æˆ·ç«¯å¯¹è±¡æ˜¯å¦å­˜åœ¨ã€‚ è¿™æ˜¯ä¸€ä¸ªç®€åŒ–çš„ç¤ºä¾‹ï¼Œå…¶ä¸­ç±»ä¼¼çš„æ£€æŸ¥æ˜¯æ­£å¸¸çš„ã€‚ ä½†æ˜¯ï¼Œå¦‚æœå‘¼å«é“¾æ›´åŠ å¤æ‚æ€ä¹ˆåŠï¼Ÿ å› æ­¤ï¼Œåœ¨æ¯æ¬¡<code>await</code>ä¹‹åä½¿ç”¨ç±»ä¼¼çš„æ–¹æ³•æ˜¯ä¸å¥½çš„åšæ³•ï¼š </p><br><ul><li> å¦‚æ­¤è‚¿çš„ä»£ç å¾ˆéš¾æ”¯æŒå’Œæ‰©å±•ã€‚ </li><li> è¯¥ä»£ç æ— æ³•æ­£å¸¸å·¥ä½œï¼š <code>OnClickRemoveNode</code>çš„åˆ é™¤<code>OnClickRemoveNode</code> ï¼Œè€Œå®¢æˆ·ç«¯å¯¹è±¡çš„å®é™…åˆ é™¤æ“ä½œå‘ç”Ÿåœ¨å…¶ä»–ä½ç½®ã€‚ ä¸åº”è¿åå¼€å‘äººå‘˜å®šä¹‰çš„é¡ºåºï¼Œå¦åˆ™ä¼šå‡ºç°å›å½’é”™è¯¯ã€‚ </li><li> è¿™è¿˜ä¸å¤Ÿå¯é ï¼šå¦‚æœæ‚¨å¿˜è®°åœ¨æŸå¤„è¿›è¡Œæ£€æŸ¥ï¼Œåˆ™å°†å‡ºç°é”™è¯¯ã€‚ å±é™©æ˜¯ï¼Œé¦–å…ˆï¼Œé—å¿˜çš„æ£€æŸ¥å¯èƒ½ä¸ä¼šåœ¨æœ¬åœ°å’Œæµ‹è¯•ç¯å¢ƒä¸­å¯¼è‡´é”™è¯¯ï¼Œå¹¶ä¸”å¯¹äºå…·æœ‰è¾ƒé•¿ç½‘ç»œå»¶è¿Ÿçš„ç”¨æˆ·ï¼Œå®ƒä¼šå‘ç”Ÿã€‚ </li><li> å¹¶ä¸”è¿™äº›å¤„ç†ç¨‹åºæ‰€å±çš„æ§åˆ¶å™¨æ˜¯å¦å¯ä»¥é”€æ¯ï¼Ÿ æ¯æ¬¡<code>await</code>æ£€æŸ¥å…¶ç ´åä¹‹åï¼Ÿ </li></ul><br><p> å¦ä¸€ä¸ªé—®é¢˜å‡ºç°äº†ï¼šå¦‚æœæœ‰å¾ˆå¤šç±»ä¼¼çš„ç«äº‰æ–¹æ³•æ€ä¹ˆåŠï¼Ÿ æƒ³è±¡è¿˜æœ‰æ›´å¤šï¼š </p><br><ul><li> æ·»åŠ èŠ‚ç‚¹ </li><li> èŠ‚ç‚¹æ›´æ–° </li><li> æ·»åŠ /åˆ é™¤é“¾æ¥ </li><li> å¤šèŠ‚ç‚¹è½¬æ¢æ–¹æ³• </li><li> åº”ç”¨ç¨‹åºçš„å¤æ‚è¡Œä¸ºï¼šæˆ‘ä»¬æ›´æ”¹ä¸€ä¸ªèŠ‚ç‚¹çš„çŠ¶æ€ï¼ŒæœåŠ¡å™¨å¼€å§‹æ›´æ–°ä¾èµ–äºè¯¥èŠ‚ç‚¹çš„èŠ‚ç‚¹ã€‚ </li></ul><br><p> éœ€è¦ä¸€ç§æ¶æ„å®ç°ï¼ŒåŸåˆ™ä¸Šæ¶ˆé™¤äº†ç”±äºç«äº‰æ¡ä»¶ï¼Œå¹¶è¡Œç”¨æˆ·æ“ä½œç­‰å¯¼è‡´é”™è¯¯çš„å¯èƒ½æ€§ã€‚ æ¶ˆé™¤ä»å®¢æˆ·ç«¯æˆ–æœåŠ¡å™¨ä¸ŠåŒæ—¶æ›´æ”¹æ¨¡å‹çš„æ­£ç¡®è§£å†³æ–¹æ¡ˆæ˜¯å®ç°å¸¦æœ‰å‘¼å«é˜Ÿåˆ—çš„å…³é”®éƒ¨åˆ†ã€‚  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åœ¨è¿™é‡Œ</a> ï¼Œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Typescriptè£…é¥°å™¨</a>å¯¹äºå£°æ˜æ€§æ ‡è®°æ­¤ç±»ç«äº‰æ€§å¼‚æ­¥æ§åˆ¶å™¨åŠŸèƒ½å¾ˆæœ‰ç”¨ã€‚ </p><br><p>  <strong>æˆ‘ä»¬æ¦‚è¿°äº†æ­¤ç±»è£…é¥°å™¨çš„è¦æ±‚å’Œä¸»è¦åŠŸèƒ½ï¼š</strong> </p><br><ol><li> åœ¨å†…éƒ¨ï¼Œåº”è¯¥å®ç°å¯¹å¼‚æ­¥å‡½æ•°çš„è°ƒç”¨é˜Ÿåˆ—ã€‚ æ ¹æ®è£…é¥°å™¨çš„ç±»å‹ï¼Œå¦‚æœå‡½æ•°è°ƒç”¨ä¸­æœ‰å…¶ä»–è°ƒç”¨ï¼Œåˆ™è¯¥å‡½æ•°è°ƒç”¨å¯èƒ½æ’é˜Ÿæˆ–è¢«æ‹’ç»ã€‚ </li><li> æ ‡è®°çš„å‡½æ•°å°†éœ€è¦æ‰§è¡Œä¸Šä¸‹æ–‡æ¥ç»‘å®šåˆ°é˜Ÿåˆ—ã€‚ æ‚¨å¿…é¡»æ˜¾å¼åˆ›å»ºä¸€ä¸ªé˜Ÿåˆ—ï¼Œæˆ–è€…æ ¹æ®æ§åˆ¶å™¨æ‰€å±çš„è§†å›¾è‡ªåŠ¨æ‰§è¡Œè¯¥é˜Ÿåˆ—ã€‚ </li><li> éœ€è¦æœ‰å…³é”€æ¯æ§åˆ¶å™¨å®ä¾‹çš„ä¿¡æ¯ï¼ˆä¾‹å¦‚ï¼Œ <code>IsDestroyed</code>å±æ€§ï¼‰ã€‚ ä¸ºäº†é˜²æ­¢è£…é¥°å™¨åœ¨æ§åˆ¶å™¨é”€æ¯åè¿›è¡Œæ’é˜Ÿè°ƒç”¨ã€‚ </li><li> å¯¹äºViewæ§åˆ¶å™¨ï¼Œæˆ‘ä»¬æ·»åŠ äº†åº”ç”¨åŠé€æ˜è’™ç‰ˆçš„åŠŸèƒ½ï¼Œä»¥æ’é™¤æ‰§è¡Œé˜Ÿåˆ—æ—¶çš„æ“ä½œï¼Œå¹¶ç›´è§‚åœ°æŒ‡ç¤ºæ­£åœ¨è¿›è¡Œçš„å¤„ç†ã€‚ </li><li> æ‰€æœ‰è£…é¥°å™¨å¿…é¡»ä»¥å¯¹<code>Promise.done()</code>çš„è°ƒç”¨<code>Promise.done()</code> ã€‚ åœ¨æ­¤æ–¹æ³•ä¸­ï¼Œæ‚¨éœ€è¦å®ç°æœªå¤„ç†å¼‚å¸¸çš„<code>handler</code> ã€‚ ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„ä¸œè¥¿ï¼š <br><ul><li>  <code>Promise</code>ä¸­å‘ç”Ÿçš„å¼‚å¸¸ä¸ä¼šè¢«æ ‡å‡†é”™è¯¯å¤„ç†ç¨‹åºæ•è·ï¼ˆä¾‹å¦‚ï¼Œè¯¥å¼‚å¸¸å¤„ç†ç¨‹åºæ˜¾ç¤ºå¸¦æœ‰æ–‡æœ¬å’Œé”™è¯¯è·Ÿè¸ªçš„çª—å£ï¼‰ï¼Œå› æ­¤æ‚¨å¯èƒ½ä¸ä¼šæ³¨æ„åˆ°å®ƒä»¬ï¼ˆå¦‚æœæ‚¨åœ¨å¼€å‘è¿‡ç¨‹ä¸­å§‹ç»ˆä¸ç›‘è§†æ§åˆ¶å°ï¼‰ã€‚ ç”¨æˆ·æ ¹æœ¬çœ‹ä¸åˆ°å®ƒä»¬-è¿™å°†ä½¿æ”¯æŒå˜å¾—å›°éš¾ã€‚ æ³¨æ„ï¼šå¯ä»¥è®¢é˜…å¤„ç†<code>unhandledrejection</code>äº‹ä»¶ï¼Œä½†æ˜¯ä»ç„¶åªæœ‰Chromeå’ŒEdgeæ”¯æŒå®ƒï¼š <br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.addEventListener(<span class="hljs-string"><span class="hljs-string">'unhandledrejection'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">event</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// handling... });</span></span></code> </pre> </li><li> ç”±äºæˆ‘ä»¬å°†æœ€é«˜<code>async</code>äº‹ä»¶å¤„ç†å‡½æ•°æ ‡è®°ä¸ºè£…é¥°å™¨ï¼Œå› æ­¤æˆ‘ä»¬å¾—åˆ°äº†æ•´ä¸ªå †æ ˆè·Ÿè¸ªé”™è¯¯ã€‚ </li></ul></li></ol><br><p> ç°åœ¨ï¼Œæˆ‘ä»¬æä¾›æ­¤ç±»è£…é¥°å™¨çš„å¤§è‡´åˆ—è¡¨ä»¥åŠè¯´æ˜ï¼Œç„¶åè¯´æ˜å¦‚ä½•åº”ç”¨å®ƒä»¬ã€‚ </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/** * : * 1.      * 2.      ,   . * *  ,  :   ,         */</span></span> @Lock <span class="hljs-comment"><span class="hljs-comment">/** * : *     ,     . * *  ,     :   ,   . */</span></span> @LockQueue <span class="hljs-comment"><span class="hljs-comment">/** *  LockQueue .  -         * *   ,       . ,   . */</span></span> @LockBetween <span class="hljs-comment"><span class="hljs-comment">/** * : *       ,   . *     . :     ,     300 .       . */</span></span> @LockDeferred(<span class="hljs-number"><span class="hljs-number">300</span></span>) <span class="hljs-comment"><span class="hljs-comment">// ,    ,     : interface ILockTarget { /** * ,   View,   .   ,        ,     ,        */ GetControllerView?(): IView; /**  true     */ IsDestroyed: boolean; }</span></span></code> </pre><br><p> è¿™äº›æè¿°éå¸¸æŠ½è±¡ï¼Œä½†æ˜¯ä¸€æ—¦æ‚¨çœ‹åˆ°å¸¦æœ‰è§£é‡Šçš„ç”¨æ³•ç¤ºä¾‹ï¼Œä¸€åˆ‡å°±ä¼šå˜å¾—æ›´åŠ æ¸…æ™°ï¼š </p><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GraphController</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ILockTarget</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** ,      .      */</span></span> private View: IView; public GetControllerView(): IView { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.View; } <span class="hljs-comment"><span class="hljs-comment">/**      . */</span></span> @Lock private <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> OnClickRemoveNode(): <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>&gt; { ... } <span class="hljs-comment"><span class="hljs-comment">/**     . */</span></span> @Lock private <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> OnClickRemoveLink(): <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>&gt; { ... } <span class="hljs-comment"><span class="hljs-comment">/**     */</span></span> @Lock private <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> OnClickAddNewNode(): <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>&gt; { ... } <span class="hljs-comment"><span class="hljs-comment">/**    " " */</span></span> @LockQueue private <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> OnServerUpdateNode(): <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>&gt; { ... } <span class="hljs-comment"><span class="hljs-comment">/**    " " */</span></span> @LockQueue private <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> OnServerAddLink(): <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>&gt; { ... } <span class="hljs-comment"><span class="hljs-comment">/**    " " */</span></span> @LockQueue private <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> OnServerAddNode(): <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>&gt; { ... } <span class="hljs-comment"><span class="hljs-comment">/**    -   */</span></span> @LockQueue private <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> OnServerRemoveNode(): <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>&gt; { ... } <span class="hljs-comment"><span class="hljs-comment">/**    -       */</span></span> @LockBetween private <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> OnServerSynchronize(): <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>&gt; { ... } <span class="hljs-comment"><span class="hljs-comment">/**    -    (/warning/error/...) */</span></span> @LockQueue private <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> OnServerUpdateNodeStatus(): <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>&gt; { ... } <span class="hljs-comment"><span class="hljs-comment">/**       */</span></span> @LockDeferred(<span class="hljs-number"><span class="hljs-number">300</span></span>) private <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> OnSearchFieldChange(): <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>&gt; { ... } }</code> </pre><br><p> ç°åœ¨ï¼Œæˆ‘ä»¬å°†åˆ†æå‡ ç§å¯èƒ½çš„é”™è¯¯å¹¶ç”±è£…é¥°å™¨æ¶ˆé™¤çš„å…¸å‹æƒ…å†µï¼š </p><br><ol><li> ç”¨æˆ·å¯åŠ¨ä¸€ä¸ªæ“ä½œï¼š <code>OnClickRemoveNode</code> ï¼Œ <code>OnClickRemoveLink</code> ã€‚ ä¸ºäº†è¿›è¡Œé€‚å½“çš„å¤„â€‹â€‹ç†ï¼Œé˜Ÿåˆ—ä¸­å¿…é¡»æ²¡æœ‰å…¶ä»–æ‰§è¡Œå¤„ç†ç¨‹åºï¼ˆå®¢æˆ·ç«¯æˆ–æœåŠ¡å™¨ï¼‰ã€‚ å¦åˆ™ï¼Œä¾‹å¦‚ï¼Œå¯èƒ½ä¼šå‘ç”Ÿè¿™æ ·çš„é”™è¯¯ï¼š <br><ul><li> å®¢æˆ·ç«¯ä¸Šçš„æ¨¡å‹ä»æ›´æ–°ä¸ºå½“å‰æœåŠ¡å™¨çŠ¶æ€ </li><li> æˆ‘ä»¬åœ¨æ›´æ–°å®Œæˆä¹‹å‰å¯åŠ¨å¯¹è±¡çš„åˆ é™¤ï¼ˆ <code>OnServerSynchronize</code>è¿è¡Œäº†<code>OnServerSynchronize</code>å¤„ç†ç¨‹åºï¼‰ã€‚ ä½†æ˜¯å®é™…ä¸Šè¯¥å¯¹è±¡ä¸å†å­˜åœ¨-åªæ˜¯å®Œå…¨åŒæ­¥å°šæœªå®Œæˆï¼Œå®ƒä»æ˜¾ç¤ºåœ¨å®¢æˆ·ç«¯ä¸Šã€‚ <br> å› æ­¤ï¼Œå¦‚æœç”¨æˆ·åœ¨é˜Ÿåˆ—ä¸­å…·æœ‰ç›¸åŒé˜Ÿåˆ—ä¸Šä¸‹æ–‡çš„å…¶ä»–å¤„ç†ç¨‹åºï¼Œåˆ™ç”±ç”¨æˆ·å¯åŠ¨çš„æ‰€æœ‰æ“ä½œéƒ½åº”æ‹’ç»<code>Lock</code>è£…é¥°å™¨ã€‚ é‰´äºæœåŠ¡å™¨æ˜¯å¼‚æ­¥çš„ï¼Œè¿™ä¸€ç‚¹å°¤å…¶é‡è¦ã€‚ æ˜¯çš„ï¼ŒWebsocketä¼šæŒ‰é¡ºåºå‘é€è¯·æ±‚ï¼Œä½†æ˜¯å¦‚æœå®¢æˆ·ç«¯ä¸­æ–­äº†é¡ºåºï¼Œæˆ‘ä»¬ä¼šåœ¨æœåŠ¡å™¨ä¸Šæ”¶åˆ°é”™è¯¯æ¶ˆæ¯ã€‚ </li></ul></li><li> æˆ‘ä»¬å¼€å§‹æ·»åŠ ä¸€ä¸ªèŠ‚ç‚¹ï¼š <code>OnClickAddNewNode</code> ã€‚  <code>OnServerSynchronize</code> ï¼Œ <code>OnServerAddNode</code>äº‹ä»¶æ¥è‡ªæœåŠ¡å™¨ã€‚ <br><ul><li>  <code>OnClickAddNewNode</code>æ¥å—äº†é˜Ÿåˆ—ï¼ˆå¦‚æœé˜Ÿåˆ—ä¸­æœ‰ä¸œè¥¿ï¼Œåˆ™æ­¤æ–¹æ³•çš„<code>Lock</code>è£…é¥°å™¨å°†æ‹’ç»è¯¥è°ƒç”¨ï¼‰ </li><li>  <code>OnServerSynchronize</code> ï¼Œ <code>OnServerAddNode</code> ï¼Œåœ¨<code>OnClickAddNewNode</code>ä¹‹åé¡ºåºæ‰§è¡Œï¼Œè€Œä¸ä¸ä¹‹ç«äº‰ã€‚ </li></ul></li><li> è¯¥é˜Ÿåˆ—å…·æœ‰<code>OnServerSynchronize</code>å’Œ<code>OnServerUpdateNode</code> ã€‚ å‡è®¾åœ¨æ‰§è¡Œç¬¬ä¸€ä¸ªè¿‡ç¨‹ä¸­ï¼Œç”¨æˆ·å…³é—­äº†<code>GraphController</code> ã€‚ ç„¶åï¼Œä¸åº”è‡ªåŠ¨æ‰§è¡Œå¯¹<code>OnServerUpdateNode</code>çš„ç¬¬äºŒæ¬¡è°ƒç”¨ï¼Œä»¥å…å¯¹è¢«ç ´åçš„æ§åˆ¶å™¨æ‰§è¡Œæ“ä½œï¼Œè¿™è‚¯å®šä¼šå¯¼è‡´é”™è¯¯ã€‚ ä¸ºæ­¤ï¼Œ <code>ILockTarget</code>æ¥å£å…·æœ‰<code>IsDestroyed</code>è£…é¥°å™¨æ£€æŸ¥æ ‡å¿—ï¼Œè€Œä¸æ‰§è¡Œé˜Ÿåˆ—ä¸­çš„ä¸‹ä¸€ä¸ªå¤„ç†ç¨‹åºã€‚ <br> åˆ©æ¶¦ï¼šæ¯æ¬¡<code>await</code>åéƒ½ä¸éœ€è¦å†™<code>if (!this.IsDestroyed())</code> ã€‚ </li><li> å¼€å§‹å¯¹å¤šä¸ªèŠ‚ç‚¹çš„æ›´æ”¹ã€‚  <code>OnServerSynchronize</code> ï¼Œ <code>OnServerUpdateNode</code>äº‹ä»¶æ¥è‡ªæœåŠ¡å™¨ã€‚ ä»–ä»¬çš„ç«äº‰æ‰§è¡Œå°†å¯¼è‡´ä¸å¯å¤åˆ¶çš„é”™è¯¯ã€‚ ä½†æ˜¯å› ä¸º  <code>LockQueue</code>å®ƒä»¬ç”±<code>LockQueue</code>å’Œ<code>LockBetween</code>æ ‡è®°ï¼Œ <code>LockQueue</code>æŒ‰é¡ºåºæ‰§è¡Œå®ƒä»¬ã€‚ </li><li> æƒ³è±¡ä¸€ä¸‹ï¼ŒèŠ‚ç‚¹å†…éƒ¨å¯ä»¥æœ‰åµŒå¥—çš„èŠ‚ç‚¹å›¾ã€‚  <code>GraphController #1</code> ,       â€”   <code>GraphController #2</code> . , <code>GraphController</code> -    ,   (  â€”         ), ..     .  : <br><ul><li>  </li><li>    </li><li>    <code>GraphController #2</code> ,     ,    . </li></ul></li><li> <code>OnSearchFieldChange</code>   ,       .         -  .  <code>@LockDeferred(300)</code>     300 :         ,     ,    300 .  ,       .  : <br><ul><li>   ,   500 ,         .     â€”        <code>OnSearchFieldChange</code> ,     . </li><li>      <code>OnSearchFieldChange</code>    â€”        ,   . </li></ul></li></ol><br><h2 id="chto-nuzhno-znat-pri-ispolzovanii-dekoratorov">       </h2><br><ol><li>  Deadlock:     <code>Handler1</code> ,    ,   <code>await</code>   <code>Handler2</code> ,  <code>LockQueue</code> ,    <code>Handler2</code> â€” <code>Handler1</code>    . </li><li>  ,     View      . :            ,      â€”                . </li></ol><br><h2 id="profilirovanie-zaprosov-k-serveru">     </h2><br><p>    ,     ,        .  : </p><br><ul><li>       - <code>&lt;Class&gt;</code> . <code>&lt;Method&gt;</code> =&gt; <code>&lt;Time&gt;</code> (  ). </li><li>       . </li><li>        . </li></ul><br><h2 id="desert">  </h2><br><p> ,    ,           ,    .        ?         ?  : </p><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GraphController</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ILockTarget</span></span></span><span class="hljs-class"> </span></span>{ private View: IView; public GetControllerView(): IView { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.View; } <span class="hljs-comment"><span class="hljs-comment">/**     . */</span></span> @Lock private <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> RunBigDataCalculations(): <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>&gt; { <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> Start(); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> UpdateSmth(); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> End(); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> CleanUp(); } <span class="hljs-comment"><span class="hljs-comment">/**   . */</span></span> @LockQueue private <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> OnChangeNodeState(node: INode): <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>&gt; { <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> GetNodeData(node); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> UpdateNode(node); } }</code> </pre><br><p>   : </p><br><ol><li>  <code>RunBigDataCalculations</code> . </li><li>  <code>await Start();</code> </li><li>   /  (  ) </li><li>   <code>await Start();</code> ,   <code>await UpdateSmth();</code>      . </li></ol><br><p> : </p><br><ol><li>  <code>RunBigDataCalculations</code> . </li><li>    <code>OnChangeNodeState</code> ,          (..  ). </li><li>   <code>await GetNodeData(node);</code> </li><li>   /  (  ) </li><li>   <code>await GetNodeData(node);</code> ,   <code>await UpdateNode(node);</code>      . </li></ol><br><p>      - .  : </p><br><ul><li>   : </li></ul><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/** *       ,      */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> interface IQueuedDisposableLockTarget extends ILockTarget { <span class="hljs-comment"><span class="hljs-comment">/**     . Lock          IsDisposing() === true */</span></span> IsDisposing(): boolean; SetDisposing(): <span class="hljs-keyword"><span class="hljs-keyword">void</span></span>; }</code> </pre> <br><ul><li>        : </li></ul><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">QueuedDispose</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">controller: IQueuedDisposableLockTarget</span></span></span><span class="hljs-function">): </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">void</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//      let xQueue = GetQueue(controller); // 1. ,     -,   -   if (xQueue.Empty) { controller.Dispose(); return; } // 2.  ,     " ",     ,   . controller.SetDisposing(); // 3.   finally   xQueue.finally(() =&gt; { debug.assert(!IsDisposed(controller), "-      ,  "); controller.Dispose(); }); }</span></span></code> </pre><br><p>  ,          .    <code>QueuedDispose</code>     : </p><br><ul><li>         .       . </li><li>   <code>QueuedDispose</code>     <code>controller</code> .         â€”  ExtJS     . </li></ul><br><p> <strong></strong> </p><br><p>  ,          , ..         . ,      ?    ,  . </p><br><p>    ,      : </p><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">    vk.com</a> <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">    Telegram</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN464773/">https://habr.com/ru/post/zh-CN464773/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN464759/index.html">2020å¹´é¡¹ç›®ç»ç†å°†éœ€è¦çš„æ•°åæœ¬æ•æ·ä¹¦ç±</a></li>
<li><a href="../zh-CN464761/index.html">ä¸€ä¸ªå°å‹Modå°†ç‰¹æ–¯æ‹‰å˜æˆè§†é¢‘ç›‘æ§ç«™</a></li>
<li><a href="../zh-CN464763/index.html">Linuxä¸ŠæœåŠ¡å™¨åŸºå‡†ï¼šä¸€ç³»åˆ—å¼€æ”¾å·¥å…·</a></li>
<li><a href="../zh-CN464765/index.html">é…ç½®FreePBX + GoIP</a></li>
<li><a href="../zh-CN464769/index.html">Badooå¦‚ä½•ä½¿æ¯ç§’å‘å‡º20ä¸‡å¼ ç…§ç‰‡æˆä¸ºå¯èƒ½</a></li>
<li><a href="../zh-CN464775/index.html">9æœˆ21æ—¥Badoo PHPèšä¼šï¼ƒ3ï¼šæ€§èƒ½</a></li>
<li><a href="../zh-CN464777/index.html">ä¸ºä»€ä¹ˆconstä¸åŠ é€ŸC / C ++ä»£ç ï¼Ÿ</a></li>
<li><a href="../zh-CN464779/index.html">å…³äºäº«ä¹ä¸»ä¹‰èœœèœ‚ï¼Œäººä»¬ä½¿å®ƒä»¬å·¥ä½œå’Œé£è¡Œçš„æ–¹å¼</a></li>
<li><a href="../zh-CN464781/index.html">æ™ºèƒ½ç”µè§†ï¼šä»CRTåˆ°HDR</a></li>
<li><a href="../zh-CN464785/index.html">éç«äº‰æ€§ç›´çº¿ä¼˜åŠ¿</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>