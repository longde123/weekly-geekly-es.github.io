<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👋🏿 🌃 🤛🏼 Cara aman untuk bertukar JWT di ASP.NET Core + SPA 🤐 🛀🏼 👩‍❤️‍💋‍👩</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A.  Entri 
 Otentikasi JWT (JSON Web Token) adalah mekanisme otentikasi dan otentikasi yang cukup seragam, konsisten antara server dan klien. Keuntung...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Cara aman untuk bertukar JWT di ASP.NET Core + SPA</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/468401/">  A. <h2>  Entri </h2><br>  Otentikasi JWT (JSON Web Token) adalah mekanisme otentikasi dan otentikasi yang cukup seragam, konsisten antara server dan klien.  Keuntungan dari JWT adalah memungkinkan kita untuk mengelola keadaan kurang dan skala dengan baik.  Tidak mengherankan bahwa otorisasi dan otentikasi dengan bantuannya semakin banyak digunakan dalam aplikasi web modern. <br><a name="habracut"></a><br>  Saat mengembangkan aplikasi dengan JWT, pertanyaan sering muncul: di mana dan bagaimana direkomendasikan untuk menyimpan token?  Jika kami mengembangkan aplikasi web, kami memiliki dua opsi paling umum: <br><br><ul><li>  Penyimpanan Web HTML5 (Penyimpanan lokal atau sessionStorage) <br></li><li>  Kue kering <br></li></ul><br>  Membandingkan metode ini, kita dapat mengatakan bahwa keduanya menyimpan nilai di browser klien, keduanya cukup mudah digunakan dan mewakili penyimpanan umum dari pasangan nilai kunci.  Perbedaannya terletak pada lingkungan penyimpanan. <br><br>  Penyimpanan Web (localStorage / sessionStorage) dapat diakses melalui JavaScript di domain yang sama.  Ini berarti bahwa setiap kode JavaScript dalam aplikasi Anda memiliki akses ke Penyimpanan Web, dan ini menciptakan kerentanan terhadap serangan skrip lintas situs (XSS).  Sebagai mesin penyimpanan, Penyimpanan Web tidak memberikan cara untuk mengamankan data Anda selama penyimpanan dan berbagi.  Kita dapat menggunakannya hanya untuk data tambahan yang ingin kita simpan saat memperbarui (F5) atau menutup tab: status dan nomor halaman, filter, dll. <br><br>  Token juga dapat dikirim melalui cookie browser.  Cookie yang digunakan dengan bendera <b>httpOnly</b> tidak terpengaruh XSS.  httpOnly adalah bendera untuk akses ke membaca, menulis, dan menghapus cookie hanya di server.  Mereka tidak akan dapat diakses melalui JavaScript pada klien, sehingga klien tidak akan tahu tentang token, dan otorisasi akan sepenuhnya diproses di sisi server. <br><br>  Kami juga dapat menetapkan bendera <b>aman</b> untuk memastikan bahwa cookie hanya dikirimkan melalui HTTPS.  Dengan kelebihan ini, pilihan saya jatuh pada cookie. <br><br>  Artikel ini menjelaskan pendekatan untuk menerapkan otentikasi dan otentikasi menggunakan cookie aman hanya JSON + JSON Web Token di ASP.NET Core Web Api bersama dengan SPA.  Opsi dipertimbangkan di mana server dan klien berbeda asal. <br><br><h2>  Menyiapkan Lingkungan Pengembangan Lokal Anda </h2><br>  Untuk mengkonfigurasi dan men-debug hubungan klien-server dengan benar melalui HTTPS, saya sangat menyarankan Anda segera mengkonfigurasi lingkungan pengembangan lokal sehingga klien dan server memiliki koneksi HTTPS. <br><br>  Jika Anda tidak segera melakukan ini dan mencoba membangun hubungan tanpa koneksi HTTPS, maka banyak detail akan muncul tanpa cookie aman dan kebijakan keamanan tambahan dalam produksi dengan HTTPS tidak akan berfungsi dengan benar. <br><br>  Saya akan menunjukkan contoh mengkonfigurasi HTTPS pada OS Windows 10, server - ASP.NET Core, SPA - React. <br><br>  Anda bisa mengonfigurasi HTTPS di ASP.NET Core menggunakan flag <u>Configure for HTTPS</u> saat membuat proyek atau, jika kami tidak melakukan ini saat membuat, aktifkan opsi yang sesuai di Properties. <br><br>  Untuk mengkonfigurasi SPA, Anda perlu memodifikasi skrip untuk <i>"mulai"</i> , mengaturnya untuk <i>"mengatur HTTPS = true"</i> .  Setup saya adalah sebagai berikut: <br><br><pre><code class="bash hljs"><span class="hljs-string"><span class="hljs-string">'start'</span></span>: <span class="hljs-string"><span class="hljs-string">'set HTTPS=true&amp;&amp;rimraf ./build&amp;&amp;react-scripts start'</span></span></code> </pre> <br>  Saya menyarankan Anda untuk melihat pengaturan HTTPS untuk lingkungan pengembangan di lingkungan lain di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://create-react-app.dev/docs/using-">create-react-app.dev/docs/using-https-in-development</a> <br><br><h2>  Mengkonfigurasi ASP.NET Core Server </h2><br><h3>  Pengaturan JWT </h3><br>  Dalam hal ini, penerapan JWT paling umum dari dokumentasi atau dari artikel apa pun, dengan opsi pengaturan tambahan <code>options.RequireHttpsMetadata = true;</code>  karena lingkungan pengembangan kami menggunakan HTTPS: <br><br>  <i>Konfigurasikan Layanan</i> <br><br><pre> <code class="java hljs">services.AddAuthentication(options =&gt; { options.DefaultAuthenticateScheme = JwtBearerDefaults.AuthenticationScheme; options.DefaultSignInScheme = JwtBearerDefaults.AuthenticationScheme; options.DefaultChallengeScheme = JwtBearerDefaults.AuthenticationScheme; }) .AddJwtBearer(JwtBearerDefaults.AuthenticationScheme, options =&gt; { options.RequireHttpsMetadata = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; options.SaveToken = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; options.TokenValidationParameters = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TokenValidationParameters { <span class="hljs-comment"><span class="hljs-comment">//  .  }; });</span></span></code> </pre> <br><h3>  Mengkonfigurasi kebijakan CORS </h3><br>  <b>Penting</b> : Kebijakan CORS harus mengandung <code>AllowCredentials()</code> .  Ini diperlukan untuk menerima permintaan dari <i>XMLHttpRequest.withCredentials</i> dan mengirim cookie kembali ke klien.  Lebih lanjut tentang ini akan ditulis nanti.  Pilihan lain dikonfigurasi tergantung pada kebutuhan proyek. <br><br>  Jika server dan klien memiliki asal yang sama, maka seluruh konfigurasi di bawah ini tidak diperlukan. <br><br>  <i>Konfigurasikan Layanan</i> <br><br><pre> <code class="java hljs">services.AddCors();</code> </pre> <br>  <i>Konfigurasikan</i> <br><br><pre> <code class="java hljs">app.UseCors(x =&gt; x .WithOrigins(<span class="hljs-string"><span class="hljs-string">"https://localhost:3000"</span></span>) <span class="hljs-comment"><span class="hljs-comment">//    SPA  .AllowCredentials() .AllowAnyMethod() .AllowAnyHeader());</span></span></code> </pre> <br><h3>  Menetapkan kebijakan cookie </h3><br>  Paksa kebijakan cookie ke httpOnly dan aman. <br><br>  Jika memungkinkan, atur <code>MinimumSameSitePolicy = SameSiteMode.Strict;</code>  - Ini meningkatkan keamanan cookie untuk jenis aplikasi yang tidak bergantung pada pemrosesan permintaan lintas-asal. <br><br>  <i>Konfigurasikan</i> <br><br><pre> <code class="java hljs">app.UseCookiePolicy(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CookiePolicyOptions { MinimumSameSitePolicy = SameSiteMode.Strict, HttpOnly = HttpOnlyPolicy.Always, Secure = CookieSecurePolicy.Always });</code> </pre> <br><h3>  Gagasan pertukaran token yang aman </h3><br>  Bagian ini adalah sebuah konsep.  Kami akan melakukan dua hal: <br><br><ol><li>  Masukkan token ke permintaan HTTP menggunakan httpOnly dan tanda aman. </li><li>  Menerima dan memvalidasi token aplikasi klien dari permintaan HTTP. </li></ol><br>  Untuk melakukan ini, kita perlu: <br><br><ul><li>  Tulis token di cookie httpOnly saat masuk dan hapus dari sana saat masuk. </li><li>  Jika ada token di cookie, gantikan token di header HTTP setiap permintaan berikutnya. </li><li>  Jika tidak ada token di cookie, maka tajuk akan kosong, dan permintaan tidak akan diotorisasi. </li></ul><br><h3>  Middleware </h3><br>  Gagasan utamanya adalah mengimplementasikan Custom Middleware untuk memasukkan token ke dalam permintaan HTTP yang masuk.  Setelah otorisasi pengguna, kami menyimpan cookie di bawah kunci tertentu, misalnya: <i>".AspNetCore.Application.Id"</i> .  Saya merekomendasikan pengaturan nama yang tidak ada hubungannya dengan otorisasi atau token - dalam hal ini, cookie dengan token akan terlihat seperti semacam konstanta sistem yang <u>biasa</u> - <u>biasa saja</u> untuk aplikasi AspNetCore.  Jadi ada kemungkinan lebih tinggi bahwa penyerang akan melihat banyak variabel sistem dan, tanpa memahami mekanisme otorisasi yang digunakan, akan melangkah lebih jauh.  Tentu saja, jika dia tidak membaca artikel ini dan tidak secara khusus mencari konstan seperti itu. <br><br>  Selanjutnya, kita perlu memasukkan token ini ke semua permintaan HTTP masuk berikutnya.  Untuk melakukan ini, kita akan menulis beberapa baris kode Middleware.  Ini tidak lain hanyalah pipa HTTP. <br><br><img src="https://habrastorage.org/webt/7e/u-/7k/7eu-7k-3ekk6f0ite96eyh_ti7m.png"><br><br>  <i>Konfigurasikan</i> <br><br><pre> <code class="java hljs">app.Use(async (context, next) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> token = context.Request.Cookies[<span class="hljs-string"><span class="hljs-string">".AspNetCore.Application.Id"</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!string.IsNullOrEmpty(token)) context.Request.Headers.Add(<span class="hljs-string"><span class="hljs-string">"Authorization"</span></span>, <span class="hljs-string"><span class="hljs-string">"Bearer "</span></span> + token); <span class="hljs-function"><span class="hljs-function">await </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">next</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; }); app.UseAuthentication();</code> </pre> <br>  Kita bisa membawa logika ini ke layanan Middleware terpisah agar tidak menyumbat Startup.cs, idenya tidak akan berubah. <br><br>  Untuk menulis nilai dalam cookie, kita hanya perlu menambahkan baris berikut ke logika otorisasi: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (result.Succeeded) HttpContext.Response.Cookies.Append(<span class="hljs-string"><span class="hljs-string">".AspNetCore.Application.Id"</span></span>, token, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CookieOptions { MaxAge = TimeSpan.FromMinutes(<span class="hljs-number"><span class="hljs-number">60</span></span>) });</code> </pre><br>  Dengan menggunakan kebijakan cookie kami, cookie ini akan secara otomatis dikirim sebagai httpHanya dan aman.  Tidak perlu mendefinisikan kembali kebijakan mereka dalam opsi cookie. <br><br>  Di CookieOptions, Anda dapat mengatur MaxAge untuk menentukan masa pakai.  Sangat berguna untuk menentukan bersama dengan JWT Lifetime ketika mengeluarkan token sehingga cookie menghilang setelah beberapa saat.  Properti CookieOptions lain dikonfigurasikan tergantung pada persyaratan proyek. <br><br>  Untuk keamanan yang lebih besar, saya sarankan menambahkan header berikut ke Middleware: <br><br><pre> <code class="java hljs">context.Response.Headers.Add(<span class="hljs-string"><span class="hljs-string">"X-Content-Type-Options"</span></span>, <span class="hljs-string"><span class="hljs-string">"nosniff"</span></span>); context.Response.Headers.Add(<span class="hljs-string"><span class="hljs-string">"X-Xss-Protection"</span></span>, <span class="hljs-string"><span class="hljs-string">"1"</span></span>); context.Response.Headers.Add(<span class="hljs-string"><span class="hljs-string">"X-Frame-Options"</span></span>, <span class="hljs-string"><span class="hljs-string">"DENY"</span></span>);</code> </pre><br><ul><li>  Header <b>X-Content-Type-Options</b> digunakan untuk melindungi terhadap kerentanan sniffing MIME.  Kerentanan ini dapat terjadi ketika situs mengizinkan pengguna untuk mengunduh konten, tetapi pengguna menyamarkan jenis file tertentu sebagai sesuatu yang lain.  Ini dapat memberi penyerang kemampuan untuk mengeksekusi skrip skrip lintas situs atau kompromi situs web. </li><li>  Semua browser modern memiliki kemampuan filter XSS built-in yang mencoba menangkap kerentanan XSS sebelum halaman ditampilkan sepenuhnya kepada kami.  Secara default, mereka diaktifkan di browser, tetapi pengguna mungkin lebih rumit dan menonaktifkannya.  Menggunakan header <b>X-XSS-Protection</b> , kita sebenarnya dapat memberitahu browser untuk mengabaikan apa yang telah dilakukan pengguna dan menerapkan filter bawaan. </li><li>  <b>X-Frame-Options</b> memberi tahu browser bahwa jika situs Anda ditempatkan di dalam bingkai HTML, maka jangan tampilkan apa pun.  Ini sangat penting ketika mencoba melindungi diri Anda dari upaya clickjacking. </li></ul><br>  Saya telah menggambarkan jauh dari semua berita utama.  Ada banyak lagi cara untuk mencapai keamanan aplikasi web yang lebih besar.  Saya menyarankan Anda untuk fokus pada daftar periksa keamanan dari sumber daya securityheaders.com. <br><br><h2>  Penyiapan klien SPA </h2><br>  Ketika klien dan server terletak pada asal yang berbeda, konfigurasi tambahan juga diperlukan pada klien.  Anda harus membungkus setiap permintaan menggunakan <i>XMLHttpRequest.withCredentials</i> . <br><br>  Saya membungkus metode saya sebagai berikut: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> axios <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"axios"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> api = axios.create({ <span class="hljs-attr"><span class="hljs-attr">baseURL</span></span>: process.env.REACT_APP_API_URL }); api.interceptors.request.use(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">request</span></span></span><span class="hljs-function"> =&gt;</span></span> requestInterceptor(request)) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> requestInterceptor = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">request</span></span></span><span class="hljs-function">) =&gt;</span></span> { request.withCredentials = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> request; } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> api;</code> </pre> <br>  Kita dapat membungkus konfigurasi permintaan dengan cara apa pun, yang utama adalah bahwa <b>withCredentials = true ada di sana</b> . <br><br>  Properti <i>XMLHttpRequest.withCredentials</i> menentukan apakah permintaan lintas domain harus dibuat menggunakan kredensial seperti cookie, header otorisasi, atau sertifikat TLS. <br><br>  Bendera ini juga digunakan untuk menentukan apakah cookie yang dikirim dalam respons akan diabaikan.  XMLHttpRequest dari domain lain tidak dapat menetapkan cookie pada domainnya sendiri jika flag withCredentials tidak disetel ke true sebelum membuat permintaan ini. <br><br>  Dengan kata lain, jika Anda tidak menentukan atribut ini, maka cookie kami tidak akan disimpan oleh browser, mis.  kami tidak akan dapat mengirim cookie kembali ke server, dan server tidak akan menemukan cookie yang diinginkan dengan JWT dan tidak akan menandatangani Bearer Token dalam pipa HTTP kami. <br><br><h2>  Untuk apa semua ini? </h2><br>  Di atas, saya menjelaskan cara pertukaran token yang tahan XSS.  Mari kita pergi dan melihat hasil dari fungsionalitas yang diimplementasikan. <br><br>  Jika Anda masuk ke Alat Pengembang, kami melihat bendera yang <b>didambakan httpHanya</b> dan <b>aman</b> : <br><br><img src="https://habrastorage.org/webt/kd/qh/ek/kdqheko2bzbn4esbtkjthcuo7a8.png"><br><br>  Mari kita lakukan uji coba, coba keluarkan cookie dari klien: <br><br><img src="https://habrastorage.org/webt/fh/vp/sq/fhvpsqvupevuf1p5lubho6jt-hy.png"><br><br>  Kami mengamati '', yaitu  cookie tidak dapat diakses dari ruang dokumen, yang membuatnya tidak mungkin untuk membacanya dengan skrip. <br><br>  Kita dapat mencoba untuk mendapatkan cookie ini dengan bantuan alat atau ekstensi tambahan, tetapi semua alat yang saya coba sebut implementasi asli dari ruang dokumen. <br><br><h2>  Proyek demo </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Instruksi permulaan ada di README.MD</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><br></a> <br><br><h2>  UPD: Perlindungan terhadap CSRF </h2><br><h3>  Mengkonfigurasi ASP.NET Core Server </h3><br>  <i>Layanan Middleware</i> <br><br><div class="spoiler">  <b class="spoiler_title">XsrfProtectionMiddleware.cs</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">XsrfProtectionMiddleware</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> readonly IAntiforgery _antiforgery; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> readonly RequestDelegate _next; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">XsrfProtectionMiddleware</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(RequestDelegate next, IAntiforgery antiforgery)</span></span></span><span class="hljs-function"> </span></span>{ _next = next; _antiforgery = antiforgery; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> async Task </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">InvokeAsync</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(HttpContext context)</span></span></span><span class="hljs-function"> </span></span>{ context.Response.Cookies.Append( <span class="hljs-string"><span class="hljs-string">".AspNetCore.Xsrf"</span></span>, _antiforgery.GetAndStoreTokens(context).RequestToken, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CookieOptions {HttpOnly = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, Secure = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, MaxAge = TimeSpan.FromMinutes(<span class="hljs-number"><span class="hljs-number">60</span></span>)}); <span class="hljs-function"><span class="hljs-function">await </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_next</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(context)</span></span></span></span>; } }</code> </pre> <br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">MiddlewareExtensions.cs</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MiddlewareExtensions</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> IApplicationBuilder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UseXsrfProtection</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params"> IApplicationBuilder builder, IAntiforgery antiforgery)</span></span></span><span class="hljs-function"> </span></span>=&gt; builder.UseMiddleware&lt;XsrfProtectionMiddleware&gt;(antiforgery); }</code> </pre> <br></div></div><br><br>  <i>Konfigurasikan Layanan</i> <br><br><pre> <code class="java hljs">services.AddAntiforgery(options =&gt; { options.HeaderName = <span class="hljs-string"><span class="hljs-string">"x-xsrf-token"</span></span>; }); services.AddMvc();</code> </pre> <br><br>  <i>Konfigurasikan</i> <br><br><pre> <code class="java hljs">app.UseAuthentication(); app.UseXsrfProtection(antiforgery);</code> </pre> <br><h3>  Pengaturan SPA </h3><br><div class="spoiler">  <b class="spoiler_title">api.axios.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> axios <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"axios"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> cookie <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-cookies'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> api = axios.create({ <span class="hljs-attr"><span class="hljs-attr">baseURL</span></span>: process.env.REACT_APP_API_URL }); api.interceptors.request.use(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">request</span></span></span><span class="hljs-function"> =&gt;</span></span> requestInterceptor(request)) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> requestInterceptor = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">request</span></span></span><span class="hljs-function">) =&gt;</span></span> { request.headers[<span class="hljs-string"><span class="hljs-string">'x-xsrf-token'</span></span>] = cookie.load(<span class="hljs-string"><span class="hljs-string">'.AspNetCore.Xsrf'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> request; } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> api;</code> </pre> <br></div></div><br><h3>  Gunakan </h3><br>  Untuk melindungi metode API kami, Anda harus menambahkan atribut <code>[AutoValidateAntiforgeryToken]</code> untuk controller atau <code>[ValidateAntiForgeryToken]</code> untuk metode ini. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id468401/">https://habr.com/ru/post/id468401/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id468389/index.html">Artyom Galonsky, STO Biro Biro: "Saya menentang hal seperti insinyur DevOps"</a></li>
<li><a href="../id468393/index.html">Dengan mikrokontroler yang baik dan waktu berlalu dengan cepat atau osiloskop akhir pekan</a></li>
<li><a href="../id468395/index.html">Pemantauan Keamanan Cloud. Bagian 2</a></li>
<li><a href="../id468397/index.html">Berita dari dunia OpenStreetMap No. 477 (09/03/2019 - 09.09.2019)</a></li>
<li><a href="../id468399/index.html">C / C ++. Cara menggunakan sumber daya aplikasi tertanam saat bekerja di GCC di Linux</a></li>
<li><a href="../id468403/index.html">Kontrol runtime aplikasi perangkat lunak internal</a></li>
<li><a href="../id468405/index.html">Dua browser masuk entah ke mana scrollbar ...</a></li>
<li><a href="../id468407/index.html">5G - teknologi yang cenderung memperlambat web</a></li>
<li><a href="../id468409/index.html">Pekerja Layanan dalam Klien Slack: Pada Percepatan Unduhan dan Mode Offline</a></li>
<li><a href="../id468411/index.html">Sebuah Cerita Tentang Memecahkan Masalah Kinerja Moment.js</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>