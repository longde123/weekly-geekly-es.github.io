<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèº‚Äçüç≥ üë®üèº‚Äçüé§ üÜî Einf√ºhrung in deterministische Assemblys in C / C ++. Teil 2 ü§ûüèº üçµ üèåÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Die √úbersetzung des Artikels wurde speziell f√ºr Studenten des Kurses "C ++ Developer" vorbereitet. 



 ‚Üí Lesen Sie den ersten Teil 


 Informationen ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Einf√ºhrung in deterministische Assemblys in C / C ++. Teil 2</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/468555/">  <i>Die √úbersetzung des Artikels wurde speziell f√ºr Studenten des Kurses <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">"C ++ Developer"</a> vorbereitet.</i> <br><br><img src="https://habrastorage.org/webt/it/uw/84/ituw84r955lsxlndkmfl5ggbahi.png"><br><br>  ‚Üí <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Lesen Sie den ersten Teil</a> <br><br><hr><a name="habracut"></a><br><h3>  Informationen zum Baugruppenordner werden in Bin√§rdateien verteilt </h3><br>  Wenn dieselben Quelldateien in verschiedenen Ordnern kompiliert werden, werden die Ordnerinformationen manchmal in Bin√§rdateien √ºbertragen.  Dies kann haupts√§chlich aus zwei Gr√ºnden geschehen: <br><br><ul><li> Verwenden von Makros, die Informationen zur aktuellen Datei enthalten, z. B. das Makro <code>__FILE__</code> . </li><li>  Erstellen Sie Debug-Bin√§rdateien, in denen Informationen zum Speicherort der Quellen gespeichert sind. </li></ul><br>  Setzen wir unser Hallo-Welt-Beispiel unter MacOS fort und teilen wir die Quelle auf, damit wir die Auswirkung der Position auf die endg√ºltigen Bin√§rdateien zeigen k√∂nnen.  Die Struktur des Projekts wird der folgenden √§hnlich sein. <br><br><pre> <code class="cpp hljs">. ‚îú‚îÄ‚îÄ run_build.sh ‚îú‚îÄ‚îÄ srcA ‚îÇ ‚îú‚îÄ‚îÄ CMakeLists.txt ‚îÇ ‚îú‚îÄ‚îÄ hello_world.cpp ‚îÇ ‚îú‚îÄ‚îÄ hello_world.hpp ‚îÇ ‚îî‚îÄ‚îÄ main.cpp ‚îî‚îÄ‚îÄ srcB ‚îú‚îÄ‚îÄ CMakeLists.txt ‚îú‚îÄ‚îÄ hello_world.cpp ‚îú‚îÄ‚îÄ hello_world.hpp ‚îî‚îÄ‚îÄ main.cpp</code> </pre> <br>  Sammeln wir unsere Bin√§rdateien im Debug-Modus. <br><br><pre> <code class="cpp hljs">cd srcA/build cmake -DCMAKE_BUILD_TYPE=Debug .. make cd .. &amp;&amp; cd .. cd srcB/build cmake -DCMAKE_BUILD_TYPE=Debug .. make cd .. &amp;&amp; cd .. md5sum srcA/build/hello md5sum srcB/build/hello md5sum srcA/build/CMakeFiles/HelloLib.dir/hello_world.cpp.o md5sum srcB/build/CMakeFiles/HelloLib.dir/hello_world.cpp.o md5sum srcA/build/libHelloLib.a md5sum srcB/build/libHelloLib.a     : <span class="hljs-number"><span class="hljs-number">3572</span></span>a95a8699f71803f3e967f92a5040 srcA/build/hello <span class="hljs-number"><span class="hljs-number">7</span></span>ca693295e62de03a1bba14853efa28c srcB/build/hello <span class="hljs-number"><span class="hljs-number">76e0</span></span>ae7c4ef79ec3be821ccf5752730f srcA/build/CMakeFiles/HelloLib.dir/hello_world.cpp.o <span class="hljs-number"><span class="hljs-number">5</span></span>ef044e6dcb73359f46d48f29f566ae5 srcB/build/CMakeFiles/HelloLib.dir/hello_world.cpp.o dc941156608b578c91e38f8ecebfef6d srcA/build/libHelloLib.a <span class="hljs-number"><span class="hljs-number">1f</span></span>9697ef23bf70b41b39ef3469845f76 srcB/build/libHelloLib.a</code> </pre> <br>  Informationen √ºber den Ordner werden von den Objektdateien in die endg√ºltigen ausf√ºhrbaren Dateien √ºbertragen, wodurch unsere Assemblys nicht mehr reproduzierbar sind.  Wir k√∂nnen die Unterschiede zwischen den Bin√§rdateien mithilfe eines Diffoskops erkennen, um festzustellen, wo die Ordnerinformationen eingebettet sind. <br><br><pre> <code class="cpp hljs">&gt; diffoscope helloA helloB --- srcA/build/hello +++ srcB/build/hello @@ <span class="hljs-number"><span class="hljs-number">-1282</span></span>,<span class="hljs-number"><span class="hljs-number">20</span></span> +<span class="hljs-number"><span class="hljs-number">1282</span></span>,<span class="hljs-number"><span class="hljs-number">20</span></span> @@ ... <span class="hljs-number"><span class="hljs-number">00005070</span></span>: <span class="hljs-number"><span class="hljs-number">5f</span></span>77 <span class="hljs-number"><span class="hljs-number">6f</span></span>72 <span class="hljs-number"><span class="hljs-number">6</span></span>c64 <span class="hljs-number"><span class="hljs-number">5f</span></span>64 <span class="hljs-number"><span class="hljs-number">6562</span></span> <span class="hljs-number"><span class="hljs-number">7567</span></span> <span class="hljs-number"><span class="hljs-number">2f</span></span>73 <span class="hljs-number"><span class="hljs-number">7263</span></span> _world_debug/src <span class="hljs-number"><span class="hljs-number">-00005080</span></span>: <span class="hljs-number"><span class="hljs-number">412f</span></span> <span class="hljs-number"><span class="hljs-number">006</span></span>d <span class="hljs-number"><span class="hljs-number">6169</span></span> <span class="hljs-number"><span class="hljs-number">6e2</span></span>e <span class="hljs-number"><span class="hljs-number">6370</span></span> <span class="hljs-number"><span class="hljs-number">7000</span></span> <span class="hljs-number"><span class="hljs-number">2f</span></span>55 <span class="hljs-number"><span class="hljs-number">7365</span></span> A/.main.cpp./Use +<span class="hljs-number"><span class="hljs-number">00005080</span></span>: <span class="hljs-number"><span class="hljs-number">422f</span></span> <span class="hljs-number"><span class="hljs-number">006</span></span>d <span class="hljs-number"><span class="hljs-number">6169</span></span> <span class="hljs-number"><span class="hljs-number">6e2</span></span>e <span class="hljs-number"><span class="hljs-number">6370</span></span> <span class="hljs-number"><span class="hljs-number">7000</span></span> <span class="hljs-number"><span class="hljs-number">2f</span></span>55 <span class="hljs-number"><span class="hljs-number">7365</span></span> B/.main.cpp./Use <span class="hljs-number"><span class="hljs-number">00005090</span></span>: <span class="hljs-number"><span class="hljs-number">7273</span></span> <span class="hljs-number"><span class="hljs-number">2f</span></span>63 <span class="hljs-number"><span class="hljs-number">6172</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span>c6f <span class="hljs-number"><span class="hljs-number">732f</span></span> <span class="hljs-number"><span class="hljs-number">446f</span></span> <span class="hljs-number"><span class="hljs-number">6375</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span>d65 rs/carlos/Docume <span class="hljs-number"><span class="hljs-number">000050</span></span>a0: <span class="hljs-number"><span class="hljs-number">6e74</span></span> <span class="hljs-number"><span class="hljs-number">732f</span></span> <span class="hljs-number"><span class="hljs-number">6465</span></span> <span class="hljs-number"><span class="hljs-number">7665</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span>c6f <span class="hljs-number"><span class="hljs-number">7065</span></span> <span class="hljs-number"><span class="hljs-number">722f</span></span> <span class="hljs-number"><span class="hljs-number">7265</span></span> nts/developer/re <span class="hljs-number"><span class="hljs-number">000050b</span></span>0: <span class="hljs-number"><span class="hljs-number">7072</span></span> <span class="hljs-number"><span class="hljs-number">6f</span></span>64 <span class="hljs-number"><span class="hljs-number">7563</span></span> <span class="hljs-number"><span class="hljs-number">6962</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span>c65 <span class="hljs-number"><span class="hljs-number">2</span></span>d62 <span class="hljs-number"><span class="hljs-number">7569</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span>c64 producible-build <span class="hljs-number"><span class="hljs-number">000050</span></span>c0: <span class="hljs-number"><span class="hljs-number">732f</span></span> <span class="hljs-number"><span class="hljs-number">7361</span></span> <span class="hljs-number"><span class="hljs-number">6e64</span></span> <span class="hljs-number"><span class="hljs-number">626f</span></span> <span class="hljs-number"><span class="hljs-number">782f</span></span> <span class="hljs-number"><span class="hljs-number">6865</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span>c6c <span class="hljs-number"><span class="hljs-number">6f</span></span>5f s/sandbox/hello_ <span class="hljs-number"><span class="hljs-number">-000050</span></span>d0: <span class="hljs-number"><span class="hljs-number">776f</span></span> <span class="hljs-number"><span class="hljs-number">726</span></span>c <span class="hljs-number"><span class="hljs-number">645f</span></span> <span class="hljs-number"><span class="hljs-number">6465</span></span> <span class="hljs-number"><span class="hljs-number">6275</span></span> <span class="hljs-number"><span class="hljs-number">672f</span></span> <span class="hljs-number"><span class="hljs-number">7372</span></span> <span class="hljs-number"><span class="hljs-number">6341</span></span> world_debug/srcA +<span class="hljs-number"><span class="hljs-number">000050</span></span>d0: <span class="hljs-number"><span class="hljs-number">776f</span></span> <span class="hljs-number"><span class="hljs-number">726</span></span>c <span class="hljs-number"><span class="hljs-number">645f</span></span> <span class="hljs-number"><span class="hljs-number">6465</span></span> <span class="hljs-number"><span class="hljs-number">6275</span></span> <span class="hljs-number"><span class="hljs-number">672f</span></span> <span class="hljs-number"><span class="hljs-number">7372</span></span> <span class="hljs-number"><span class="hljs-number">6342</span></span> world_debug/srcB <span class="hljs-number"><span class="hljs-number">000050e0</span></span>: <span class="hljs-number"><span class="hljs-number">2f</span></span>62 <span class="hljs-number"><span class="hljs-number">7569</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span>c64 <span class="hljs-number"><span class="hljs-number">2f</span></span>43 <span class="hljs-number"><span class="hljs-number">4</span></span>d61 <span class="hljs-number"><span class="hljs-number">6b</span></span>65 <span class="hljs-number"><span class="hljs-number">4669</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span>c65 /build/CMakeFile <span class="hljs-number"><span class="hljs-number">000050f</span></span>0: <span class="hljs-number"><span class="hljs-number">732f</span></span> <span class="hljs-number"><span class="hljs-number">6865</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span>c6c <span class="hljs-number"><span class="hljs-number">6f</span></span>2e <span class="hljs-number"><span class="hljs-number">6469</span></span> <span class="hljs-number"><span class="hljs-number">722f</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span>d61 <span class="hljs-number"><span class="hljs-number">696</span></span>e s/hello.dir/main <span class="hljs-number"><span class="hljs-number">00005100</span></span>: <span class="hljs-number"><span class="hljs-number">2e63</span></span> <span class="hljs-number"><span class="hljs-number">7070</span></span> <span class="hljs-number"><span class="hljs-number">2e6</span></span>f <span class="hljs-number"><span class="hljs-number">005f</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span>d61 <span class="hljs-number"><span class="hljs-number">696</span></span>e <span class="hljs-number"><span class="hljs-number">005f</span></span> <span class="hljs-number"><span class="hljs-number">5f</span></span>5a .cpp.o._main.__Z ... @@ <span class="hljs-number"><span class="hljs-number">-1336</span></span>,<span class="hljs-number"><span class="hljs-number">15</span></span> +<span class="hljs-number"><span class="hljs-number">1336</span></span>,<span class="hljs-number"><span class="hljs-number">15</span></span> @@ ... <span class="hljs-number"><span class="hljs-number">000053</span></span>c0: <span class="hljs-number"><span class="hljs-number">6962</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span>c65 <span class="hljs-number"><span class="hljs-number">2</span></span>d62 <span class="hljs-number"><span class="hljs-number">7569</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span>c64 <span class="hljs-number"><span class="hljs-number">732f</span></span> <span class="hljs-number"><span class="hljs-number">7361</span></span> <span class="hljs-number"><span class="hljs-number">6e64</span></span> ible-builds/sand <span class="hljs-number"><span class="hljs-number">000053</span></span>d0: <span class="hljs-number"><span class="hljs-number">626f</span></span> <span class="hljs-number"><span class="hljs-number">782f</span></span> <span class="hljs-number"><span class="hljs-number">6865</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span>c6c <span class="hljs-number"><span class="hljs-number">6f</span></span>5f <span class="hljs-number"><span class="hljs-number">776f</span></span> <span class="hljs-number"><span class="hljs-number">726</span></span>c <span class="hljs-number"><span class="hljs-number">645f</span></span> box/hello_world_ <span class="hljs-number"><span class="hljs-number">-000053e0</span></span>: <span class="hljs-number"><span class="hljs-number">6465</span></span> <span class="hljs-number"><span class="hljs-number">6275</span></span> <span class="hljs-number"><span class="hljs-number">672f</span></span> <span class="hljs-number"><span class="hljs-number">7372</span></span> <span class="hljs-number"><span class="hljs-number">6341</span></span> <span class="hljs-number"><span class="hljs-number">2f</span></span>62 <span class="hljs-number"><span class="hljs-number">7569</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span>c64 debug/srcA/build +<span class="hljs-number"><span class="hljs-number">000053e0</span></span>: <span class="hljs-number"><span class="hljs-number">6465</span></span> <span class="hljs-number"><span class="hljs-number">6275</span></span> <span class="hljs-number"><span class="hljs-number">672f</span></span> <span class="hljs-number"><span class="hljs-number">7372</span></span> <span class="hljs-number"><span class="hljs-number">6342</span></span> <span class="hljs-number"><span class="hljs-number">2f</span></span>62 <span class="hljs-number"><span class="hljs-number">7569</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span>c64 debug/srcB/build <span class="hljs-number"><span class="hljs-number">000053f</span></span>0: <span class="hljs-number"><span class="hljs-number">2f</span></span>6c <span class="hljs-number"><span class="hljs-number">6962</span></span> <span class="hljs-number"><span class="hljs-number">4865</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span>c6c <span class="hljs-number"><span class="hljs-number">6f</span></span>4c <span class="hljs-number"><span class="hljs-number">6962</span></span> <span class="hljs-number"><span class="hljs-number">2e61</span></span> <span class="hljs-number"><span class="hljs-number">2868</span></span> /libHelloLib.a(h <span class="hljs-number"><span class="hljs-number">00005400</span></span>: <span class="hljs-number"><span class="hljs-number">656</span></span>c <span class="hljs-number"><span class="hljs-number">6</span></span>c6f <span class="hljs-number"><span class="hljs-number">5f</span></span>77 <span class="hljs-number"><span class="hljs-number">6f</span></span>72 <span class="hljs-number"><span class="hljs-number">6</span></span>c64 <span class="hljs-number"><span class="hljs-number">2e63</span></span> <span class="hljs-number"><span class="hljs-number">7070</span></span> <span class="hljs-number"><span class="hljs-number">2e6</span></span>f ello_world.cpp.o <span class="hljs-number"><span class="hljs-number">00005410</span></span>: <span class="hljs-number"><span class="hljs-number">2900</span></span> <span class="hljs-number"><span class="hljs-number">5f</span></span>5f <span class="hljs-number"><span class="hljs-number">5</span></span>a4e <span class="hljs-number"><span class="hljs-number">3130</span></span> <span class="hljs-number"><span class="hljs-number">4865</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span>c6c <span class="hljs-number"><span class="hljs-number">6f</span></span>57 <span class="hljs-number"><span class="hljs-number">6f</span></span>72 ).__ZN10HelloWor ...</code> </pre> <br><h3>  M√∂gliche L√∂sungen </h3><br>  Auch hier h√§ngt die Entscheidung vom verwendeten Compiler ab: <br><br><ul><li>  msvc kann keine Parameter festlegen, um das Hinzuf√ºgen dieser Informationen zu Bin√§rdateien zu vermeiden.  Die einzige M√∂glichkeit, reproduzierbare Bin√§rdateien zu erhalten, besteht darin, das Reparaturwerkzeug erneut zu verwenden, um diese Informationen w√§hrend der Erstellungsphase zu entfernen.  Bitte beachten Sie, dass die Ordner, die f√ºr verschiedene Assemblys verwendet werden, die gleiche L√§nge in Zeichen haben sollten, da wir Bin√§rdateien reparieren, um reproduzierbare Bin√§rdateien zu erstellen. </li><li>  <code>gcc</code> verf√ºgt √ºber drei Compiler-Flags, um dieses Problem zu <code>gcc</code> : <br><ul><li>  <code>-fdebug-prefix-map=OLD=NEW</code> kann Verzeichnispr√§fixe aus Debug-Informationen entfernen. </li><li>  <code>-fmacro-prefix-map=OLD=NEW</code> seit gcc 8 verf√ºgbar und l√∂st das Irreproduzierbarkeitsproblem mithilfe des Makros __FILE__. </li><li>  <code>-ffile-prefix-map=OLD=NEW</code> ist seit gcc 8 verf√ºgbar und ist eine Vereinigung von -fdebug-prefix-map und -fmacro-prefix-map </li></ul></li><li>  <code>clang</code> unterst√ºtzt <code>-fdebug-prefix-map=OLD=NEW</code> seit Version 3.8 und arbeitet daran, zwei weitere Flags f√ºr zuk√ºnftige Versionen zu unterst√ºtzen. </li></ul><br>  Der beste Weg, um dieses Problem zu l√∂sen, besteht darin, den Compileroptionen Flags hinzuzuf√ºgen.  Bei Verwendung von CMake: <br><br><pre> <code class="cpp hljs">target_compile_options(target PUBLIC <span class="hljs-string"><span class="hljs-string">"-ffile-prefix-map=${CMAKE_SOURCE_DIR}=."</span></span>)</code> </pre><br><h3>  Die Reihenfolge der Dateien im Build-System </h3><br>  Die Reihenfolge der Dateien kann problematisch sein, wenn Verzeichnisse gelesen werden, um eine Liste ihrer Dateien zu erstellen.  Beispielsweise hat Unix keine deterministische Reihenfolge, in der readdir () und listdir () den Inhalt eines Verzeichnisses zur√ºckgeben m√ºssen. Wenn Sie also darauf vertrauen, dass diese Funktionen das Assembly-System versorgen, kann dies zu nicht deterministischen Assemblys f√ºhren. <br><br>  Das gleiche Problem tritt beispielsweise auf, wenn Ihr Build-System Dateien f√ºr den Linker in einem Container speichert (z. B. in einem regul√§ren Python-W√∂rterbuch), der Elemente in einer nicht deterministischen Reihenfolge zur√ºckgeben kann.  Dadurch werden die Dateien jedes Mal in einer anderen Reihenfolge verkn√ºpft und es werden unterschiedliche Bin√§rdateien erstellt. <br><br>  Wir k√∂nnen dieses Problem simulieren, indem wir die Dateien in CMake neu anordnen.  Wenn wir das vorherige Beispiel so √§ndern, dass es mehr als eine Quelldatei f√ºr die Bibliothek enth√§lt: <br><br><pre> <code class="cpp hljs">. ‚îú‚îÄ‚îÄ CMakeLists.txt ‚îú‚îÄ‚îÄ CMakeListsA.txt ‚îú‚îÄ‚îÄ CMakeListsB.txt ‚îú‚îÄ‚îÄ hello_world.cpp ‚îú‚îÄ‚îÄ hello_world.hpp ‚îú‚îÄ‚îÄ main.cpp ‚îú‚îÄ‚îÄ sources0.cpp ‚îú‚îÄ‚îÄ sources0.hpp ‚îú‚îÄ‚îÄ sources1.cpp ‚îú‚îÄ‚îÄ sources1.hpp ‚îú‚îÄ‚îÄ sources2.cpp ‚îî‚îÄ‚îÄ sources2.hpp</code> </pre> <br>  Wir k√∂nnen sehen, dass die Kompilierungsergebnisse unterschiedlich sind, wenn wir die Reihenfolge der Dateien in <code>CMakeLists.txt</code> : <br><br><pre> <code class="cpp hljs">cmake_minimum_required(VERSION <span class="hljs-number"><span class="hljs-number">3.0</span></span>) project(HelloWorld) <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>(CMAKE_CXX_STANDARD <span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>(CMAKE_CXX_STANDARD_REQUIRED ON) add_library(HelloLib hello_world.cpp sources0.cpp sources1.cpp sources2.cpp) add_executable(hello main.cpp) target_link_libraries(hello HelloLib)</code> </pre> <br>  Wenn wir zwei aufeinanderfolgende Assemblys mit den Namen A und B <code>sources0.cpp</code> und die <code>sources1.cpp</code> <code>sources0.cpp</code> und <code>sources1.cpp</code> in der Liste der Dateien austauschen, erhalten wir die folgenden Pr√ºfsummen: <br><br><pre> <code class="cpp hljs"><span class="hljs-number"><span class="hljs-number">30</span></span>ab264d6f8e1784282cd1a415c067f2 helloA cdf3c9dd968f7363dc9e8b40918d83af helloB <span class="hljs-number"><span class="hljs-number">707</span></span>c71bc2a8def6885b96fb67b84d79c hello_worldA.cpp.o <span class="hljs-number"><span class="hljs-number">707</span></span>c71bc2a8def6885b96fb67b84d79c hello_worldB.cpp.o <span class="hljs-number"><span class="hljs-number">694f</span></span>f3765b688e6faeebf283052629a3 sources0A.cpp.o <span class="hljs-number"><span class="hljs-number">694f</span></span>f3765b688e6faeebf283052629a3 sources0B.cpp.o <span class="hljs-number"><span class="hljs-number">0</span></span>db24dc6a94da1d167c68b96ff319e56 sources1A.cpp.o <span class="hljs-number"><span class="hljs-number">0</span></span>db24dc6a94da1d167c68b96ff319e56 sources1B.cpp.o fd0754d9a4a44b0fcc4e4f3c66ad187c sources2A.cpp.o fd0754d9a4a44b0fcc4e4f3c66ad187c sources2B.cpp.o baba9709d69c9e5fd51ad985ee328172 libHelloLibA.a <span class="hljs-number"><span class="hljs-number">72641</span></span>dc6fc4f4db04166255f62803353 libHelloLibB.a</code> </pre> <br>  Objekt- <code>.o</code> Dateien sind identisch, .a-Bibliotheken und ausf√ºhrbare Dateien jedoch nicht.  Dies liegt daran, dass die Reihenfolge des Einf√ºgens in die Bibliothek von der Reihenfolge abh√§ngt, in der die Dateien aufgelistet sind. <br><br><h3>  Der Compiler hat Zuf√§lligkeit erzeugt </h3><br>  Dieses Problem tritt beispielsweise in gcc auf, wenn <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Link-Time Optimizations</a> ( <code>-flto</code> Flag) <code>-flto</code> .  Diese Option f√ºhrt zuf√§llig generierte Namen in Bin√§rdateien ein.  Die einzige M√∂glichkeit, dieses Problem zu vermeiden, ist die Verwendung des Flags - <code>frandom-seed</code> .  Diese Option bietet einen Startwert, den gcc anstelle von Zufallszahlen verwendet.  Es wird verwendet, um bestimmte Symbolnamen zu generieren, die in jeder kompilierten Datei unterschiedlich sein m√ºssen.  Es wird auch verwendet, um eindeutige Stempel in Datenabdeckungsdateien und Objektdateien zu platzieren, die diese erzeugen.  Dieser Parameter sollte f√ºr jede Quelldatei unterschiedlich sein.  Eine M√∂glichkeit besteht darin, die Pr√ºfsumme der Datei so einzustellen, dass die Wahrscheinlichkeit einer Kollision sehr gering ist.  In CMake kann dies beispielsweise mit einer Funktion wie der folgenden erfolgen: <br><br><pre> <code class="cpp hljs"><span class="hljs-built_in"><span class="hljs-built_in">set</span></span>(LIB_SOURCES ./src/source1.cpp ./src/source2.cpp ./src/source3.cpp) foreach(_file ${LIB_SOURCES}) file(SHA1 ${_file} checksum) <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>(SUBSTRING ${checksum} <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span> checksum) set_property(SOURCE ${_file} APPEND_STRING PROPERTY COMPILE_FLAGS <span class="hljs-string"><span class="hljs-string">"-frandom-seed=0x${checksum}"</span></span>) endforeach()</code> </pre> <br><h3>  Einige Tipps zur Verwendung von Conan </h3><br>  Conan- <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Haken</a> k√∂nnen uns helfen, unsere Builds reproduzierbar zu machen.  Mit dieser Funktion k√∂nnen Sie das Verhalten des Clients an bestimmten Punkten konfigurieren. <br><br>  Eine M√∂glichkeit, Hooks zu verwenden, besteht darin, Umgebungsvariablen in der Phase <code>pre_build</code> .  Im folgenden Beispiel wird die Funktion <code>set_environment</code> , und anschlie√üend wird die Umgebung im Schritt <code>reset_environment</code> mithilfe von <code>reset_environment</code> . <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">def </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">set_environment</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">: </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">if</span></span></span><span class="hljs-function"> self._os </span></span>== <span class="hljs-string"><span class="hljs-string">"Linux"</span></span>: self._old_source_date_epoch = os.environ.get(<span class="hljs-string"><span class="hljs-string">"SOURCE_DATE_EPOCH"</span></span>) timestamp = <span class="hljs-string"><span class="hljs-string">"1564483496"</span></span> os.environ[<span class="hljs-string"><span class="hljs-string">"SOURCE_DATE_EPOCH"</span></span>] = timestamp self._output.info( <span class="hljs-string"><span class="hljs-string">"set SOURCE_DATE_EPOCH: {}"</span></span>.format(timestamp)) elif self._os == <span class="hljs-string"><span class="hljs-string">"Macos"</span></span>: os.environ[<span class="hljs-string"><span class="hljs-string">"ZERO_AR_DATE"</span></span>] = <span class="hljs-string"><span class="hljs-string">"1"</span></span> self._output.info( <span class="hljs-string"><span class="hljs-string">"set ZERO_AR_DATE: {}"</span></span>.format(timestamp)) def reset_environment(self): <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self._os == <span class="hljs-string"><span class="hljs-string">"Linux"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self._old_source_date_epoch is None: del os.environ[<span class="hljs-string"><span class="hljs-string">"SOURCE_DATE_EPOCH"</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: os.environ[<span class="hljs-string"><span class="hljs-string">"SOURCE_DATE_EPOCH"</span></span>] = self._old_source_date_epoch elif self._os == <span class="hljs-string"><span class="hljs-string">"Macos"</span></span>: del os.environ[<span class="hljs-string"><span class="hljs-string">"ZERO_AR_DATE"</span></span>]</code> </pre> <br>  Hooks k√∂nnen auch n√ºtzlich sein, um Bin√§rdateien in der Phase <code>post_build</code> zu <code>post_build</code> .  Es gibt verschiedene Tools zum Analysieren und Korrigieren von Bin√§rdateien, z. B. <code>ducible</code> , <code>pefile</code> , <code>pe-parse</code> oder <code>strip-nondeterminism</code> .  Ein Beispielhaken zum Fixieren einer PE-Bin√§rdatei mit <code>ducible</code> k√∂nnte sein: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">class </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Patcher</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(object)</span></span></span><span class="hljs-function">: ... def </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">patch</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">: </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">if</span></span></span><span class="hljs-function"> self._os </span></span>== <span class="hljs-string"><span class="hljs-string">"Windows"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> self._compiler == <span class="hljs-string"><span class="hljs-string">"Visual Studio"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> root, _, filenames in os.walk(self._conanfile.build_folder): <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> filename in filenames: filename = os.path.join(root, filename) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-string"><span class="hljs-string">".exe"</span></span> in filename <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-string"><span class="hljs-string">".dll"</span></span> in filename: self._patch_pe(filename) def _patch_pe(self, filename): patch_tool_location = <span class="hljs-string"><span class="hljs-string">"C:/ducible/ducible.exe"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> os.path.isfile(patch_tool_location): self._output.info(<span class="hljs-string"><span class="hljs-string">"Patching {} with md5sum: {}"</span></span>.format(filename,md5sum(filename))) self._conanfile.run(<span class="hljs-string"><span class="hljs-string">"{} {}"</span></span>.format(patch_tool_location, filename)) self._output.info(<span class="hljs-string"><span class="hljs-string">"Patched file: {} with md5sum: {}"</span></span>.format(filename,md5sum(filename))) ... def pre_build(output, conanfile, **kwargs): lib_patcher.init(output, conanfile) lib_patcher.set_environment() def post_build(output, conanfile, **kwargs): lib_patcher.patch() lib_patcher.reset_environment()</code> </pre> <br><h3>  Schlussfolgerungen </h3><br>  Deterministische Assemblys sind eine komplexe Aufgabe, die eng mit dem verwendeten Betriebssystem und Toolkit zusammenh√§ngt.  Diese Einf√ºhrung sollte helfen, die h√§ufigsten Ursachen f√ºr mangelnden Determinismus zu verstehen und wie man sie angeht. <br><br><h3>  Referenzen </h3><br><h4>  allgemeine Informationen </h4><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">www.chromium.org/developers/testing/isolated-testing/deterministic-builds</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">reproducible-builds.org</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">wiki.yoctoproject.org/wiki/Reproducible_Builds</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">stackoverflow.com/questions/1180852/deterministic-builds-under-windows</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">docs.microsoft.com/en-us/windows/win32/debug/pe-format#archive-library-file-format</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">devblogs.microsoft.com/oldnewthing/20180103-00/?p=97705</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">www.geoffchappell.com/studies/msvc/link/link/options/brepro.htm?tx=37&amp;ts=0</a> , 267 </li></ul><br><h4>  Die Werkzeuge </h4><br>  <b>Bin√§re Vergleichstools</b> <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">diffoscope.org</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">docs.microsoft.com/en-us/windows-server/administration/windows-commands/fc</a> </li></ul><br>  <b>Dateireparatur-Tools</b> <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">salsa.debian.org/reproducible-builds/strip-nondeterminism</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">github.com/erocarrera/pefile</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">github.com/trailofbits/pe-parse</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">github.com/smarttechnologies/peparser</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">github.com/google/syzygy</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">github.com/nh2/ar-timestamp-wiper</a> </li></ul><br>  <b>Tools zur Dateianalyse</b> <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">docs.microsoft.com/en-us/cpp/build/reference/dumpbin-reference?view=vs-2019</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">sourceware.org/binutils/docs/binutils/readelf.html</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">github.com/llvm-mirror/llvm/tree/master/tools</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">github.com/lief-project/LIEF</a> </li></ul><br>  ‚Üí <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Lesen Sie den ersten Teil</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de468555/">https://habr.com/ru/post/de468555/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de468543/index.html">Wochentags Programmkomitee FrontendConf. Interview mit Sergey Popov</a></li>
<li><a href="../de468545/index.html">"Alice, lass uns zum Frontend gehen!"</a></li>
<li><a href="../de468547/index.html">Englisch sprechend, CSS, Grid und Barrierefreiheit bei FrontendConf</a></li>
<li><a href="../de468549/index.html">GPU gebunden. So √ºbertragen Sie alles auf die Grafikkarte und ein bisschen mehr. Animationen</a></li>
<li><a href="../de468553/index.html">Parameterverwaltung in Gesch√§ftsanwendungen √§hnlich einem Versionskontrollsystem</a></li>
<li><a href="../de468557/index.html">WEB 3.0 - der zweite Ansatz f√ºr das Projektil</a></li>
<li><a href="../de468559/index.html">Sichern Sie die Cloud, Freunde</a></li>
<li><a href="../de468561/index.html">Sicherheitswoche 39: Sicherheit und allt√§gliche Fehler</a></li>
<li><a href="../de468563/index.html">Watchmen Watch: Der aktuelle Stand der Weltraum-Tracking-Einrichtungen</a></li>
<li><a href="../de468565/index.html">Selbstgemachter Geigerz√§hler auf ESP8266 mit Touchscreen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>