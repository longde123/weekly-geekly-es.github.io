<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>😁 👨🏾‍🤝‍👨🏻 👩🏽‍🤝‍👩🏼 Comment gérer correctement les erreurs: le silence n'est pas toujours bon 🐹 🌾 🍟</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Je n'ai jamais eu d'opinion particulière concernant la gestion des erreurs. Si j'ai commencé à travailler avec du code existant, j'ai continué à effec...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comment gérer correctement les erreurs: le silence n'est pas toujours bon</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/skillbox/blog/441148/"><img src="https://habrastorage.org/getpro/habr/post_images/f67/c0b/7cc/f67c0b7cc12a761d7e4e6561cc9dad1f.png"><br><br>  Je n'ai jamais eu d'opinion particulière concernant la gestion des erreurs.  Si j'ai commencé à travailler avec du code existant, j'ai continué à effectuer la tâche sur laquelle l'auteur de la source a travaillé;  si j'ai écrit le code à partir de zéro, j'ai fait ce qui me semblait le mieux. <br><br>  Mais récemment, j'ai rencontré un problème, un bogue qui s'est manifesté en raison d'une erreur «silencieuse» dans le code.  J'ai réalisé qu'il y avait quelque chose à réfléchir.  Peut-être que je ne peux pas changer la façon dont je gère les erreurs dans toute la base de code sur laquelle je travaille, mais quelque chose peut certainement être optimisé. <br><a name="habracut"></a><br><blockquote>  <b>Nous vous rappelons:</b> <i>pour tous les lecteurs de «Habr» - une remise de 10 000 roubles lors de l'inscription à un cours Skillbox en utilisant le code promo «Habr».</i> <br><br>  <b>Skillbox recommande:</b> Le cours éducatif en ligne <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">"Profession Java-developer"</a> . <br><br></blockquote><br><h3>  Ça ne vaut pas toujours la peine de couper l'épaule </h3><br>  La première étape de la gestion des erreurs doit être de comprendre quand «erreur» n'est pas «erreur!»  Bien sûr, tout cela dépend de la logique métier de votre application, mais en général, certains bugs sont explicites et peuvent être corrigés sans problème. <br><br><ul><li>  Avez-vous une plage de dates où le «avant» est avant le «de»?  Réorganiser. </li><li>  Avez-vous un numéro de téléphone commençant par + ou contenant un tiret où vous ne vous attendez pas à ce que des caractères spéciaux apparaissent?  Retirez-les. </li><li>  Problème de collecte nul?  Assurez-vous de l'initialiser avant l'accès (en utilisant l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">initialisation paresseuse</a> ou le constructeur). </li></ul><br>  N'interrompez pas l'exécution de code en raison d'erreurs que vous pouvez corriger et, bien sûr, n'interférez pas avec vos actions auprès des utilisateurs de votre service ou application.  Si vous êtes en mesure de comprendre le problème et de le résoudre à la volée, faites-le. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/edd/c78/1b1/eddc781b1768c27d6e643cf555b65731.jpg"><br><br><h3>  Renvoyer Null ou d'autres nombres magiques </h3><br>  Valeurs nulles, -1 où un nombre positif est attendu et autres valeurs de retour magiques - tout cela est le produit du diable, qui transfère la responsabilité de la vérification des erreurs à la fonction appelante. <br><br>  Avec eux, votre code sera plein de tels blocs qui rendront la logique d'application peu claire: <br><br><pre><code class="python hljs">return_value = possibly_return_a_magic_value() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> return_value &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>: handle_error() <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: do_something() other_return_value = possibly_nullable_value() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> other_return_value <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: handle_null_value() <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: do_some_other_thing()</code> </pre> <br>  Eh bien, ou plus simple, mais aussi mauvais: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> item = returnSomethingWhichCouldBeNull(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> result = item?.Property?.MaybeExists; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (result.HasValue) { DoSomething(); }</code> </pre> <br>  Passer le null aux méthodes est également un problème, bien que dans le code de certains développeurs, vous puissiez trouver des endroits où les méthodes commencent par plusieurs lignes de validation d'entrée.  Mais en fait, tout cela n'est pas nécessaire.  La plupart des langues modernes ne fournissent pas un, mais plusieurs outils à la fois, ce qui vous permet d'indiquer clairement ce que vous attendez.  Ils sautent également les vérifications inutiles, par exemple, en définissant des paramètres non différents de zéro ou avec le décorateur correspondant. <br><br><h3>  Codes d'erreur </h3><br>  C'est le même problème qu'avec null et d'autres valeurs similaires lorsque des complications de code inutiles sont ajoutées. <br><br>  Par exemple, vous pouvez utiliser cette construction pour renvoyer un code d'erreur: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> errorCode; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> result = getSomething(<span class="hljs-keyword"><span class="hljs-keyword">out</span></span> errorCode); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (errorCode != <span class="hljs-number"><span class="hljs-number">0</span></span>) { doSomethingWithResult(result); }</code> </pre> <br>  Le résultat peut être affiché comme suit: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Result</span></span>&lt;<span class="hljs-title"><span class="hljs-title">T</span></span>&gt; { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> T Item { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-comment"><span class="hljs-comment">// At least "ErrorCode" is an enum public ErrorCode ErrorCode { get; set; } = ErrorCode.None; public IsError { get { return ErrorCode != ErrorCode.None; } } } public class UsingResultConstruct { ... var result = GetResult(); if (result.IsError) { switch (result.ErrorCode) { case ErrorCode.NetworkError: HandleNetworkError(); break; case ErrorCode.UserError: HandleUserError(); break; default: HandleUnknownError(); break; } } ActuallyDoSomethingWithResult(result); ... }</span></span></code> </pre> <br>  Ce n'est vraiment pas le meilleur code.  Il s'avère que l'article peut toujours être vide.  En fait, il n'y a aucune garantie (autre qu'un accord) que lorsque le résultat ne contient pas d'erreur, vous pouvez accéder en toute sécurité à l'article. <br><br>  Après avoir terminé tout ce traitement, vous devez toujours convertir le code de bogue en un message d'erreur et faire quelque chose avec.  Il arrive parfois qu'en raison de la complexité excessive du code, ce message lui-même ne s'affiche pas comme il se doit. <br><br>  Il y a un problème encore plus grave: si vous ou quelqu'un d'autre modifiez l'implémentation interne pour gérer un nouvel état non valide avec un nouveau code d'erreur, alors toute la structure cessera de fonctionner. <br><br><h3>  Si cela n'a pas fonctionné la première fois, réessayez </h3><br>  Avant de continuer, il convient de souligner qu'une défaillance de programme «silencieuse» est mauvaise.  Un problème inattendu peut survenir au moment le plus inopportun - par exemple, le week-end, lorsque vous ne pouvez pas tout réparer rapidement. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/40c/c92/810/40cc9281004ffdb45ace66b498749d6b.jpg"><br><br>  Si vous lisez <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Clean Code</a> , vous vous demandez probablement pourquoi ne pas simplement lever une exception?  Sinon, vous pensez probablement que les exceptions sont la racine du mal.  Je le pensais aussi, mais maintenant je pense un peu différemment. <br><blockquote>  Un point intéressant, au moins pour moi, est que l'implémentation par défaut de la nouvelle méthode en C # est de déclencher une exception NotImplementedException, tandis que la valeur par défaut pour la nouvelle méthode en Python est «pass». <br><br>  Par conséquent, nous entrons le plus souvent le paramètre «erreur silencieuse» pour Python.  Je me demande combien de développeurs ont passé beaucoup de temps pour comprendre ce qui se passe et pourquoi le programme ne fonctionne pas.  Mais à la fin, après de nombreuses heures, ils ont découvert qu'ils avaient oublié d'implémenter la méthode de l'espace réservé. </blockquote>  Mais regardez ceci: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> MyDataObject </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UpdateSomething</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">MyDataObject toUpdate</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_dbConnection == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DbConnectionError(); } <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> newVersion = _dbConnection.Update(toUpdate); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (newVersion == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } MyDataObject result = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MyDataObject(newVersion); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (DbConnectionClosedException dbcc) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DbConnectionError(); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (MyDataObjectUnhappyException dou) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MalformedDataException(); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception ex) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UnknownErrorException(); } }</code> </pre> <br>  Bien sûr, les exceptions seules ne vous protégeront pas de la création de code illisible et non géré.  Vous devez appliquer les exceptions comme une stratégie bien pensée et bien équilibrée.  Sinon, si le projet est trop volumineux, votre application peut être dans un état incohérent.  À l'inverse, si le projet est trop petit, vous obtiendrez le chaos. <br><br>  Pour éviter que cela ne se produise, je vous conseille de garder cela à l'esprit: <br><br>  La cohérence avant tout.  Vous devez toujours vous assurer que l'application est cohérente.  Si cela signifie que vous devez encapsuler chaque couple de lignes avec un bloc try / catch, cachez tout simplement dans une autre fonction. <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">my_function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: do_this() do_that() <span class="hljs-keyword"><span class="hljs-keyword">except</span></span>: something_bad_happened() <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span>: cleanup_resource()</code> </pre> <br>  La consolidation des erreurs est nécessaire.  C'est bien si vous fournissez différents types de gestion de différents types d'erreurs.  Cependant, c'est pour vous, pas pour les utilisateurs.  Pour eux, jetez la seule exception afin que les utilisateurs sachent simplement que quelque chose s'est mal passé.  Les détails sont votre domaine de responsabilité. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> MyDataObject </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UpdateSomething</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">MyDataObject toUpdate</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> newVersion = _dbConnection.Update(toUpdate); MyDataObject result = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MyDataObject(newVersion); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (DbConnectionClosedException dbcc) { HandleDbConnectionClosed(); <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UpdateMyDataObjectException(); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (MyDataObjectUnhappyException dou) { RollbackVersion(); <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UpdateMyDataObjectException(); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception ex) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UpdateMyDataObjectException(); } }</code> </pre> <br>  Il vaut la peine d'attraper des exceptions tout de suite.  Ils sont mieux interceptés au niveau le plus bas.  Rester cohérent et masquer les détails en vaut la peine, comme décrit ci-dessus.  La gestion des erreurs doit être laissée au niveau supérieur de l'application.  Si tout est fait correctement, vous pouvez séparer le flux logique de l'application elle-même du flux de traitement des erreurs.  Cela vous permettra d'écrire du code clair et lisible. <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">my_api</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: item = get_something_from_the_db() new_version = do_something_to_item(item) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> new_version <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> Exception <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> ex: handle_high_level_exception(ex)</code> </pre> <br>  C'est tout pour le moment, et si vous voulez discuter du sujet des erreurs et de leur traitement - Bienvenue. <br><br><blockquote>  <b>Skillbox recommande:</b> <br><br><ul><li>  Cours pratique <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">"Mobile Developer PRO"</a> . </li><li>  Cours en ligne <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">"Développeur C # à partir de zéro</a> . <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">"</a> </li><li>  Cours pratique de deux ans <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">"Je suis un développeur web PRO</a> . <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">"</a> </li></ul></blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr441148/">https://habr.com/ru/post/fr441148/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr441136/index.html">Stockage à long terme des métriques Prometheus (Alexey Palazhchenko, Percona)</a></li>
<li><a href="../fr441138/index.html">Solutions de chat en temps réel vs plates-formes de chat - Faites votre choix</a></li>
<li><a href="../fr441140/index.html">Développement WebAssembly: véritable râteau et exemples</a></li>
<li><a href="../fr441142/index.html">12 points de croissance de conversion, ou du contenu qui se vend vraiment</a></li>
<li><a href="../fr441146/index.html">Réseaux sans fil industriels: lequel choisir?</a></li>
<li><a href="../fr441150/index.html">Première introduction au protocole HTTP en écrivant le serveur Web Java le plus simple</a></li>
<li><a href="../fr441152/index.html">Comment minimiser les erreurs lors de l'intégration avec des services externes: l'expérience d'un courtier en ligne</a></li>
<li><a href="../fr441154/index.html">Onze perles cachées de Java 11</a></li>
<li><a href="../fr441158/index.html">Comment l'éthique est devenue le problème le plus cher de la Silicon Valley et la philosophie est devenue sa solution la plus pratique</a></li>
<li><a href="../fr441160/index.html">Comment apprendre à savoir quand dire non</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>