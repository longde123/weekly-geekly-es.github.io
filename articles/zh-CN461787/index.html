<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘©ğŸ¿â€ğŸ¤â€ğŸ‘©ğŸ» âœ³ï¸ âœ‹ğŸ½ Androidæ–‡å­—æ˜¾ç¤º ğŸŒ â™¾ ğŸ™ğŸ¼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="æ˜¾ç¤ºæ–‡æœ¬ä¿¡æ¯å¯èƒ½æ˜¯è®¸å¤šAndroidåº”ç”¨ç¨‹åºä¸­æœ€åŸºæœ¬ï¼Œæœ€é‡è¦çš„éƒ¨åˆ†ã€‚ æœ¬æ–‡å°†è®¨è®ºTextViewã€‚ ä»â€œ Hello Worldâ€å¼€å§‹çš„æ¯ä¸ªå¼€å‘äººå‘˜éƒ½ç»å¸¸é‡åˆ°æ­¤ç”¨æˆ·ç•Œé¢å…ƒç´ ã€‚ æœ‰æ—¶ï¼Œåœ¨å¤„ç†æ–‡æœ¬æ—¶ï¼Œæ‚¨å¿…é¡»è€ƒè™‘å®ç°å„ç§è®¾è®¡è§£å†³æ–¹æ¡ˆæˆ–åœ¨æ¸²æŸ“å±å¹•æ—¶æé«˜æ€§èƒ½ã€‚ 


 æˆ‘å°†è®¨è®ºTextViewè®¾å¤‡ä»¥åŠä½¿ç”¨å®ƒçš„...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Androidæ–‡å­—æ˜¾ç¤º</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/redmadrobot/blog/461787/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/mc/2_/_o/mc2__o7rq1m6ex9alol6ivz5vey.png"></div><br><p> æ˜¾ç¤ºæ–‡æœ¬ä¿¡æ¯å¯èƒ½æ˜¯è®¸å¤šAndroidåº”ç”¨ç¨‹åºä¸­æœ€åŸºæœ¬ï¼Œæœ€é‡è¦çš„éƒ¨åˆ†ã€‚ æœ¬æ–‡å°†è®¨è®ºTextViewã€‚ ä»â€œ Hello Worldâ€å¼€å§‹çš„æ¯ä¸ªå¼€å‘äººå‘˜éƒ½ç»å¸¸é‡åˆ°æ­¤ç”¨æˆ·ç•Œé¢å…ƒç´ ã€‚ æœ‰æ—¶ï¼Œåœ¨å¤„ç†æ–‡æœ¬æ—¶ï¼Œæ‚¨å¿…é¡»è€ƒè™‘å®ç°å„ç§è®¾è®¡è§£å†³æ–¹æ¡ˆæˆ–åœ¨æ¸²æŸ“å±å¹•æ—¶æé«˜æ€§èƒ½ã€‚ </p><br><p> æˆ‘å°†è®¨è®ºTextViewè®¾å¤‡ä»¥åŠä½¿ç”¨å®ƒçš„ä¸€äº›æŠ€å·§ã€‚ å…³é”®æç¤ºæ¥è‡ªè¿‡å»çš„Google I / OæŠ¥å‘Šã€‚ </p><a name="habracut"></a><br><h1 id="textview-pod-kapotom"> å¼•æ“ç›–ä¸‹çš„TextView </h1><br><p> ä¸ºäº†åœ¨Androidä¸­æ¸²æŸ“æ–‡æœ¬ï¼Œå¼•æ“ç›–ä¸‹ä½¿ç”¨äº†ä¸€å¤§å †ä¸åŒçš„åº“ã€‚ å®ƒä»¬å¯ä»¥åˆ†ä¸ºä¸¤ä¸ªä¸»è¦éƒ¨åˆ†-Javaä»£ç å’Œæœ¬æœºä»£ç ï¼š </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/hb/p0/gg/hbp0ggycnpeisn8v8hwyqkkmvfq.png" width="800"></div><br><p>  Javaä»£ç æœ¬è´¨ä¸Šæ˜¯åº”ç”¨ç¨‹åºå¼€å‘äººå‘˜å¯ä»¥ä½¿ç”¨çš„Android SDKçš„ä¸€éƒ¨åˆ†ï¼Œå¹¶ä¸”å¯ä»¥å°†å…¶ä¸­çš„æ–°åŠŸèƒ½ç§»æ¤åˆ°æ”¯æŒåº“ä¸­ã€‚ </p><br><p>  TextViewæ ¸å¿ƒæœ¬èº«æ˜¯ç”¨C ++ç¼–å†™çš„ï¼Œè¿™é™åˆ¶äº†ä»æ–°ç‰ˆæœ¬çš„æ“ä½œç³»ç»Ÿå‘å®ç°è¯¥åŠŸèƒ½çš„æ”¯æŒåº“çš„ç§»æ¤ã€‚ æ ¸å¿ƒæ˜¯ä»¥ä¸‹åº“ï¼š </p><br><ul><li>  Minikinç”¨äºæŒ‰éŸ³èŠ‚æµ‹é‡æ–‡æœ¬ï¼Œæ¢è¡Œç¬¦å’Œå•è¯çš„é•¿åº¦ã€‚ </li><li>  ICUæä¾›Unicodeæ”¯æŒã€‚ </li><li>  HarfBuzzä¸ºUnicodeå­—ç¬¦æ‰¾åˆ°å­—ä½“ä¸­çš„ç›¸åº”å›¾å½¢å…ƒç´ ï¼ˆå­—å½¢ï¼‰ã€‚ </li><li>  FreeTypeç”Ÿæˆå­—å½¢çš„ä½å›¾ã€‚ </li><li>  Skiaæ˜¯ç»˜åˆ¶2Då›¾å½¢çš„å¼•æ“ã€‚ </li></ul><br><h2 id="izmerenie-dliny-teksta-i-perenos-strok"> æµ‹é‡æ–‡æœ¬é•¿åº¦å’Œæ¢è¡Œç¬¦ </h2><br><p> å¦‚æœå°†è¡Œä¼ é€’åˆ°åœ¨TextViewå†…éƒ¨ä½¿ç”¨çš„Minikinåº“ï¼Œåˆ™å®ƒç¡®å®šçš„ç¬¬ä¸€ä»¶äº‹æ˜¯è¯¥è¡ŒåŒ…å«å“ªäº›å­—å½¢ï¼š </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/qt/1o/uk/qt1ouktu4gn9x0wncbgiy2a7qkg.png" width="800"></div><br>
<p>ä»æœ¬ç¤ºä¾‹ä¸­å¯ä»¥çœ‹åˆ°ï¼Œå°†å¸¦æœ‰å­—å½¢çš„Unicodeå­—ç¬¦åŒ¹é…å¹¶ä¸æ€»æ˜¯ä¸€å¯¹ä¸€çš„ï¼šè¿™é‡Œï¼Œä¸€æ¬¡3ä¸ªå­—ç¬¦å°†å¯¹åº”ä¸€ä¸ªffiå­—å½¢ã€‚ å¦å¤–ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå¯ä»¥åœ¨å„ç§ç³»ç»Ÿå­—ä½“ä¸­æ‰¾åˆ°å¿…è¦çš„å­—å½¢ã€‚ </p><br><p> ä»…åœ¨ç³»ç»Ÿå­—ä½“ä¸­æ‰¾åˆ°å­—å½¢å¯èƒ½ä¼šå¯¼è‡´å›°éš¾ï¼Œå°¤å…¶æ˜¯å¦‚æœå›¾æ ‡æˆ–è¡¨æƒ…ç¬¦å·æ˜¯é€šè¿‡å­—ç¬¦æ˜¾ç¤ºçš„ï¼Œå¹¶ä¸”åº”è¯¥å°†æ¥è‡ªä¸åŒå­—ä½“çš„å­—ç¬¦åˆå¹¶åœ¨ä¸€è¡Œä¸­ã€‚ å› æ­¤ï¼Œä»<strong>Android Qï¼ˆ29ï¼‰å¼€å§‹</strong> ï¼Œå¯ä»¥åˆ›å»ºåº”ç”¨ç¨‹åºéšé™„çš„è‡ªå·±çš„å­—ä½“åˆ—è¡¨ã€‚ æ­¤åˆ—è¡¨å°†ç”¨äºæœç´¢å­—å½¢ï¼š </p><br><pre> <code class="kotlin hljs">textView.typeface = TypeFace.CustomFallbackBuilder( FontFamily.Builder( Font.Builder(assets, â€œlato.ttfâ€).build() ).build() ).addCustomFallback( FontFamily.Builder( Font.Builder(assets, â€œkosugi.ttfâ€).build() ).build() ).build()</code> </pre> <br><p> ç°åœ¨ï¼Œä½¿ç”¨<code>CustomFallbackBuilder</code>å½“å°†å­—ç¬¦ä¸å­—å½¢åŒ¹é…æ—¶ï¼ŒSDKå°†æŒ‰é¡ºåº<code>CustomFallbackBuilder</code>æŒ‡å®šçš„å­—ä½“ç³»åˆ—ï¼Œå¦‚æœæ‰¾ä¸åˆ°ï¼Œåˆ™æœç´¢å°†ç»§ç»­ä½¿ç”¨ç³»ç»Ÿå­—ä½“ï¼ˆå¹¶é€šè¿‡<code>setSystemFallback()</code>æ–¹æ³•å¯ä»¥æŒ‡å®šé¦–é€‰çš„ç³»ç»Ÿå­—ä½“ç³»åˆ—ï¼‰ã€‚  <code>CustomFallbackBuilder</code>å¯¹å­—ä½“ç³»åˆ—çš„æ•°é‡æœ‰é™åˆ¶-æ‚¨æœ€å¤šå¯ä»¥æ·»åŠ 64ç§å­—ä½“ã€‚ </p><br><p>  Minikinåº“å°†å­—ç¬¦ä¸²æ‹†åˆ†ä¸ºå•è¯å¹¶æµ‹é‡å•ä¸ªå•è¯ã€‚ ä¸ºäº†åŠ å¿«å·¥ä½œé€Ÿåº¦ï¼Œä»<strong>Lollipopï¼ˆ21ï¼‰å¼€å§‹</strong> ï¼Œä½¿ç”¨ç³»ç»Ÿ<abbr title="æœ€è¿‘æœ€å°‘ä½¿ç”¨">LRU</abbr>å•è¯ç¼“å­˜ã€‚ è¿™æ ·çš„ç¼“å­˜å¯å¸¦æ¥å·¨å¤§çš„æ€§èƒ½æå‡ï¼šå¯¹ä¸€ä¸ªç¼“å­˜çš„å•è¯çš„<code>Paint.measureText()</code>è°ƒç”¨å°†å¹³å‡èŠ±è´¹å…¶é¦–æ¬¡è®¡ç®—å…¶å¤§å°çš„æ—¶é—´çš„3ï¼…ã€‚ </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/d2/f1/om/d2f1omfjlqmmfqalip3whmes-1o.png" width="800"></div><br><p> å¦‚æœæ–‡æœ¬ä¸é€‚åˆæŒ‡å®šçš„å®½åº¦ï¼Œåˆ™Minikinä¼šåœ¨æ–‡æœ¬ä¸­æ’åˆ—æ¢è¡Œç¬¦å’Œå•è¯ã€‚ ä»<strong>æ£‰èŠ±ç³–ï¼ˆ23ï¼‰å¼€å§‹ï¼Œ</strong>æ‚¨å¯ä»¥é€šè¿‡ä¸ºTextViewæŒ‡å®š<code>breakStrategy</code>å’Œ<code>breakStrategy</code>ç‰¹æ®Šå±æ€§æ¥æ§åˆ¶å…¶è¡Œä¸ºã€‚ </p><br><p> ä½¿ç”¨<code>breakStrategy=simple</code>å€¼æ—¶<code>breakStrategy=simple</code>åº“å°†ç®€å•åœ°æŒ‰é¡ºåºæ’åˆ—è¿å­—ç¬¦ï¼Œå¹¶éå†æ–‡æœ¬ï¼šä¸€æ—¦è¡Œä¸å†é€‚åˆï¼Œåˆ™å°†è¿å­—ç¬¦æ”¾åœ¨æœ€åä¸€ä¸ªå•è¯çš„å‰é¢ã€‚ </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/im/lc/cr/imlccruuhjr59qzrtpwjmrf6hhk.png" width="600"></div><br><p> åœ¨<code>balanced</code>å€¼æ—¶<code>balanced</code>åº“å°†å°è¯•è¿›è¡Œæ¢è¡Œï¼Œä»¥ä½¿è¡Œçš„å®½åº¦å¯¹é½ã€‚ </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/v5/ys/kc/v5yskcuiwypdyponmrdqep7zaq8.png" width="600"></div><br><p>  <code>high_quality</code>çš„è¡Œä¸ºå‡ ä¹ä¸<code>balanced</code>ç›¸åŒï¼Œä½†æœ‰ä¸€äº›åŒºåˆ«ï¼ˆå…¶ä¸­ä¹‹ä¸€ï¼šå€’æ•°ç¬¬äºŒè¡Œï¼Œè¿å­—ç¬¦ä¸ä»…å¯ä»¥æ˜¯å•ç‹¬çš„å•è¯ï¼Œè€Œä¸”å¯ä»¥æ˜¯éŸ³èŠ‚çš„å•è¯ï¼‰ã€‚ </p><br><p>  <code>hyphenationFrequency</code>å±æ€§ä½¿<code>hyphenationFrequency</code>å¯ä»¥æ§åˆ¶éŸ³èŠ‚è‡ªåŠ¨æ¢è¡Œçš„ç­–ç•¥ã€‚ å€¼<code>none</code>ä¸ä¼šè‡ªåŠ¨æ–­å­—ï¼Œ <code>normal</code>ä¼šä½¿æ–­å­—çš„é¢‘ç‡é™ä½ï¼Œè€Œ<code>full</code>ä¼šä½¿ç”¨æœ€å¤§çš„å•è¯æ•°ã€‚ </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ng/cr/hs/ngcrhsphklaxxe842klpnx8mhnw.png" width="600"></div><br><p> æ–‡æœ¬å‘ˆç°æ€§èƒ½å–å†³äºæ‰€é€‰æ ‡å¿—ï¼ˆåœ¨<strong>Android Pï¼ˆ28ï¼‰</strong>ä¸Šæµ‹å¾—ï¼‰ï¼š </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/tx/5r/33/tx5r339s93s1nq6go8hieqhv6fq.png" width="600"></div><br><p> é‰´äºæ€§èƒ½å—åˆ°å¾ˆå¤§å½±å“ï¼Œä»ç‰ˆæœ¬<strong>Qï¼ˆ29ï¼‰</strong>å’Œ<strong>AppCompat 1.1.0</strong>å¼€å§‹ï¼ŒGoogleå¼€å‘äººå‘˜å†³å®šé»˜è®¤å…³é—­è¿å­—ç¬¦ã€‚ å¦‚æœè‡ªåŠ¨æ¢è¡Œåœ¨åº”ç”¨ç¨‹åºä¸­å¾ˆé‡è¦ï¼Œåˆ™ç°åœ¨éœ€è¦æ˜¾å¼å¯ç”¨å®ƒã€‚ </p><br><p> ä½¿ç”¨è‡ªåŠ¨æ¢è¡Œæ—¶ï¼Œå¿…é¡»è€ƒè™‘åˆ°æ“ä½œç³»ç»Ÿä¸­å½“å‰é€‰æ‹©çš„è¯­è¨€ä¼šå½±å“åº“çš„æ“ä½œã€‚ æ ¹æ®è¯­è¨€ï¼Œç³»ç»Ÿå°†é€‰æ‹©å¸¦æœ‰ä¼ è¾“è§„åˆ™çš„ç‰¹æ®Šè¯å…¸ã€‚ </p><br><h1 id="stili-teksta"> æ–‡å­—æ ·å¼ </h1><br><p> æœ‰å‡ ç§åœ¨Androidä¸­è®¾ç½®æ–‡å­—æ ·å¼çš„æ–¹æ³•ï¼š </p><br><ul><li> é€‚ç”¨äºæ•´ä¸ªTextViewå…ƒç´ çš„<strong>å•ä¸€æ ·å¼</strong> ã€‚ </li><li>  <strong>å¤šç§æ ·å¼ï¼ˆå¤šç§æ ·å¼ï¼‰</strong> -å¯ä»¥åŒæ—¶åœ¨æ®µè½æˆ–å•ä¸ªå­—ç¬¦çº§åˆ«å°†å¤šç§æ ·å¼åº”ç”¨äºæ–‡æœ¬ã€‚ æœ‰å‡ ç§æ–¹æ³•å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ï¼š <br><ul><li> åœ¨ç”»å¸ƒä¸Šç»˜åˆ¶æ–‡å­— </li><li>  htmlæ ‡ç­¾ </li><li> ç‰¹æ®Šæ ‡è®°å…ƒç´ -è·¨åº¦ </li></ul></li></ul><br><p> å•ä¸€æ ·å¼æ„å‘³ç€åœ¨TextViewæ ‡è®°ä¸­ä½¿ç”¨XMLæ ·å¼æˆ–XMLå±æ€§ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç³»ç»Ÿå°†æŒ‰ä»¥ä¸‹é¡ºåºåº”ç”¨èµ„æºä¸­çš„å€¼ï¼šTextAppearanceï¼Œä¸»é¢˜ï¼ˆä¸»é¢˜ï¼‰ï¼Œé»˜è®¤æ ·å¼ï¼ˆDefaultæ ·å¼ï¼‰ï¼Œåº”ç”¨ç¨‹åºä¸­çš„æ ·å¼ï¼Œå¹¶ä¸”æœ€é«˜ä¼˜å…ˆçº§æ˜¯Viewå±æ€§çš„å€¼ã€‚ </p><br><p> ä½¿ç”¨èµ„æºæ˜¯ä¸€ä¸ªç›¸å½“ç®€å•çš„è§£å†³æ–¹æ¡ˆï¼Œä½†æ˜¯ä¸å¹¸çš„æ˜¯ï¼Œå®ƒä¸å…è®¸æ‚¨å°†æ ·å¼åº”ç”¨äºæ–‡æœ¬çš„æŸäº›éƒ¨åˆ†ã€‚ </p><br><p>  HTMLæ ‡ç­¾æ˜¯å¦ä¸€ç§ç®€å•çš„è§£å†³æ–¹æ¡ˆï¼Œå®ƒæä¾›çš„åŠŸèƒ½åŒ…æ‹¬ä½¿å•ä¸ªå•è¯åŠ ç²—ï¼Œæ–œä½“ï¼Œç”šè‡³çªå‡ºæ˜¾ç¤ºåˆ—è¡¨ä¸­å¸¦æœ‰æ–‡æœ¬ç‚¹çš„åˆ—è¡¨ã€‚ å¼€å‘äººå‘˜æ‰€éœ€è¦åšçš„åªæ˜¯è°ƒç”¨<code>Html.fromHtml()</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šå°†æ ‡è®°çš„æ–‡æœ¬è½¬æ¢<code>Html.fromHtml()</code>æ ‡è®°çš„æ–‡æœ¬ã€‚ ä½†æ˜¯æ­¤è§£å†³æ–¹æ¡ˆåŠŸèƒ½æœ‰é™ï¼Œå› ä¸ºå®ƒåªèƒ½è¯†åˆ«htmlæ ‡è®°çš„ä¸€éƒ¨åˆ†ï¼Œå¹¶ä¸”ä¸æ”¯æŒCSSæ ·å¼ã€‚ </p><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> text = <span class="hljs-string"><span class="hljs-string">"My text &lt;ul&gt;&lt;li&gt;bullet one&lt;/li&gt;&lt;li&gt;bullet two&lt;/li&gt;&lt;/ul&gt;"</span></span> myTextView.text = Html.fromHtml(text)</code> </pre> <br><p> å¯ä»¥å°†å„ç§æ ·å¼åŒ–TextViewçš„æ–¹æ³•ç»„åˆåœ¨ä¸€èµ·ï¼Œä½†å€¼å¾—è®°ä½çš„æ˜¯ç‰¹å®šæ–¹æ³•çš„ä¼˜å…ˆçº§ï¼Œè¿™ä¼šå½±å“æœ€ç»ˆç»“æœï¼š </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/zm/hr/hl/zmhrhluqvvcv77s1b85gkxbtcww.png" width="400"></div><br><p> å¦ä¸€ç§æ–¹æ³•-åœ¨ç”»å¸ƒä¸Šç»˜åˆ¶æ–‡æœ¬-ä½¿å¼€å‘äººå‘˜å¯ä»¥å®Œå…¨æ§åˆ¶æ–‡æœ¬è¾“å‡ºï¼šä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥æ²¿æ›²çº¿ç»˜åˆ¶æ–‡æœ¬ã€‚ ä½†æ˜¯ï¼Œæ ¹æ®è¦æ±‚ï¼Œè¿™ç§è§£å†³æ–¹æ¡ˆå¯èƒ½å¾ˆéš¾å®æ–½ï¼Œè¶…å‡ºäº†æœ¬æ–‡çš„èŒƒå›´ã€‚ </p><br><h1 id="spans"> è·¨åº¦ </h1><br><p>  TextViewä½¿ç”¨è·¨åº¦æ¥å¾®è°ƒæ ·å¼ã€‚ ä½¿ç”¨è·¨åº¦ï¼Œæ‚¨å¯ä»¥æ›´æ”¹å­—ç¬¦èŒƒå›´çš„é¢œè‰²ï¼Œä½¿æ–‡æœ¬æˆä¸ºé“¾æ¥çš„ä¸€éƒ¨åˆ†ï¼Œæ›´æ”¹æ–‡æœ¬çš„å¤§å°ï¼Œåœ¨æ®µè½å‰é¢ç»˜åˆ¶ç‚¹ç­‰ã€‚ </p><br><p> å¯ä»¥åŒºåˆ†ä»¥ä¸‹å‡ ç±»è·¨åº¦ï¼š </p><br><ul><li>  <strong>å­—ç¬¦è·¨åº¦</strong> -åœ¨å­—ç¬¦ä¸²çš„å­—ç¬¦çº§åˆ«åº”ç”¨ã€‚ <br><ul><li>  <strong>å¤–è§‚å½±å“</strong> -è¯·å‹¿æ›´æ”¹æ–‡å­—å¤§å°ã€‚ </li><li>  <strong>åº¦é‡æ ‡å‡†å½±å“</strong> -è°ƒæ•´æ–‡æœ¬å¤§å°ã€‚ </li></ul></li><li>  <strong>æ®µè½è·¨åº¦</strong> -åœ¨æ®µè½çº§åˆ«åº”ç”¨ã€‚ </li></ul><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/zy/os/x2/zyosx2ovroe15y3bd94qridaaou.png"></div><br><p>  Androidæ¡†æ¶å…·æœ‰æ¥å£å’ŒæŠ½è±¡ç±»ï¼Œè¿™äº›æ¥å£å’ŒæŠ½è±¡ç±»å…·æœ‰åœ¨<code>onMeasure()</code>å’Œå‘ˆç°TextViewæœŸé—´è°ƒç”¨çš„æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•å¯è·¨åº¦è®¿é—®<code>TextPaint</code>å’Œ<code>Canvas</code>ç­‰è¾ƒä½çº§åˆ«çš„å¯¹è±¡ã€‚ ä½¿ç”¨è·¨åº¦ï¼ŒAndroidæ¡†æ¶æ£€æŸ¥æ­¤å¯¹è±¡å®ç°çš„æ¥å£ä»¥è°ƒç”¨å¿…è¦çš„æ–¹æ³•ã€‚ </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/fv/do/er/fvdoerpx8zxykjxvt9ru4kigica.png" width="600"></div><br><p>  androidæ¡†æ¶å®šä¹‰äº†å¤§çº¦20ä¸ªè·¨åº¦ï¼Œå› æ­¤åœ¨åˆ¶ä½œè‡ªå·±çš„è·¨åº¦ä¹‹å‰ï¼Œæœ€å¥½æ£€æŸ¥ä¸€ä¸‹SDKæ˜¯å¦åˆé€‚ã€‚ </p><br><h3 id="appearance-vs-metric-affecting-spans"> å¤–è§‚ä¸æŒ‡æ ‡å½±å“èŒƒå›´ </h3><br><p> è·¨åº¦çš„ç¬¬ä¸€ç±»å½±å“å­—ç¬¦ä¸²ä¸­å­—ç¬¦çš„å¤–è§‚ï¼šå­—ç¬¦é¢œè‰²ï¼ŒèƒŒæ™¯é¢œè‰²ï¼Œå¸¦ä¸‹åˆ’çº¿æˆ–åˆ’çº¿çš„å­—ç¬¦ç­‰ã€‚ è¿™äº›èŒƒå›´å®ç°<code>UpdateAppearance</code>æ¥å£å¹¶ç»§æ‰¿è‡ª<code>CharacterStyle</code>ç±»ï¼Œè¯¥ç±»æä¾›å¯¹<code>TextPaint</code>å¯¹è±¡çš„è®¿é—®ã€‚ </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/or/8f/zl/or8fzltp5mvoyhvdey8tz1uoqhg.png"></div><br><p> å½±å“è·¨åº¦çš„åº¦é‡æ ‡å‡†ä¼šå½±å“æ–‡æœ¬å’Œå¸ƒå±€çš„å¤§å°ï¼Œå› æ­¤ï¼Œä½¿ç”¨è¿™ç§è·¨åº¦ä¸ä»…éœ€è¦é‡ç»˜TextViewï¼Œè¿˜éœ€è¦è°ƒç”¨<code>onMeasure()</code> / <code>onLayout()</code> ã€‚ è¿™äº›èŒƒå›´é€šå¸¸æ˜¯ä»<code>MetricAffectingSpan</code>ç±»ç»§æ‰¿çš„ï¼Œè€Œè¯¥ç±»æ˜¯ä»ä¸Šè¿°<code>CharacterStyle</code>ç»§æ‰¿çš„ã€‚ </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/_h/hs/hd/_hhshd0pcadvdievngojmtsqzlu.png"></div><br><h2 id="character-vs-paragraph-affecting-spans"> å­—ç¬¦ä¸æ®µè½å½±å“è·¨åº¦ </h2><br><p> æ®µè½è·¨åº¦ä¼šå½±å“æ•´ä¸ªæ–‡æœ¬å—ï¼šå®ƒå¯ä»¥æ›´æ”¹å¯¹é½æ–¹å¼ï¼Œç¼©è¿›ç”šè‡³åœ¨æ®µè½çš„å¼€å¤´æ’å…¥ä¸€ä¸ªç‚¹ã€‚ æ­¤ç±»è·¨åº¦åº”ä»<code>ParagraphStyle</code>ç±»ç»§æ‰¿ï¼Œå¹¶ä»<code>ParagraphStyle</code>çš„å¼€å¤´åˆ°ç»“å°¾å®Œå…¨æ’å…¥åˆ°æ–‡æœ¬ä¸­ã€‚ å¦‚æœèŒƒå›´ä¸æ­£ç¡®ï¼Œåˆ™è·¨åº¦å°†ä¸èµ·ä½œç”¨ã€‚ </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/76/_n/uj/76_nujhr8rrwz-mne8bgq8p2pfu.png"></div><br><p> åœ¨Androidä¸Šï¼Œæ®µè½è¢«è®¤ä¸ºæ˜¯ç”¨æ¢è¡Œç¬¦ï¼ˆ <code>\n</code> ï¼‰åˆ†éš”çš„æ–‡æœ¬çš„ä¸€éƒ¨åˆ†ã€‚ </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/s1/p1/kq/s1p1kq9esdaakdpwh_rkxdvdygw.png"></div><br><h2 id="napisanie-svoih-spanov"> ç¼–å†™è·¨åº¦ </h2><br><p> åœ¨ç¼–å†™è‡ªå·±çš„è·¨åº¦æ—¶ï¼Œæ‚¨éœ€è¦ç¡®å®šè·¨åº¦å°†å½±å“ä»€ä¹ˆï¼Œä»¥ä¾¿é€‰æ‹©è¦ä»å“ªä¸ªç±»ç»§æ‰¿ï¼š </p><br><ul><li> åœ¨å­—ç¬¦çº§åˆ«ä¸Šå½±å“æ–‡æœ¬-&gt; <code>CharacterStyle</code> </li><li> åœ¨æ®µè½çº§åˆ«å½±å“æ–‡æœ¬-&gt; <code>ParagraphStyle</code> </li><li> å½±å“æ–‡æœ¬è§†å›¾â†’ <code>UpdateAppearance</code> </li><li> å½±å“æ–‡å­—å¤§å°- <code>UpdateLayout</code> </li></ul><br><p> è¿™æ˜¯æ›´æ”¹å­—ä½“çš„è·¨åº¦ç¤ºä¾‹ï¼š </p><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CustomTypefaceSpan</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> font: Typeface?) : MetricAffectingSpan() { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">updateMeasureState</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(textPaint: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">TextPaint</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = update(textPaint) <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">updateDrawState</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(textPaint: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">TextPaint</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = update(textPaint) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(textPaint: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">TextPaint</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { textPaint.apply { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> old = typeface <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> oldStyle = old?.style ?: <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> font = Typeface.create(font, oldStyle) typeface = font <span class="hljs-comment"><span class="hljs-comment">//    } } }</span></span></code> </pre> <br><p> æƒ³è±¡ä¸€ä¸‹ï¼Œæˆ‘ä»¬æƒ³åˆ›å»ºè‡ªå·±çš„è·¨åº¦ä»¥çªå‡ºæ˜¾ç¤ºä»£ç å—ï¼Œä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†ç¼–è¾‘å…ˆå‰çš„è·¨åº¦-æ·»åŠ å­—ä½“åï¼Œæˆ‘ä»¬è¿˜å°†æ·»åŠ æ–‡æœ¬èƒŒæ™¯è‰²çš„æ›´æ”¹ï¼š </p><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CodeBlockSpan</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> font: Typeface?) : MetricAffectingSpan() { â€¦ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(textPaint: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">TextPaint</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { textPaint.apply { <span class="hljs-comment"><span class="hljs-comment">//    â€¦ bgColor = lightGray //    } } }</span></span></code> </pre> <br><p> å°†è·¨åº¦åº”ç”¨äºæ–‡æœ¬ï¼š </p><br><pre> <code class="kotlin hljs"><span class="hljs-comment"><span class="hljs-comment">//    span spannable.setSpan(CodeBlockSpan(typeface), ...)</span></span></code> </pre> <br><p> ä½†æ˜¯ï¼Œæ‚¨å¯ä»¥é€šè¿‡ç»„åˆä¸¤ä¸ªè·¨åº¦æ¥è·å¾—å®Œå…¨ç›¸åŒçš„ç»“æœï¼šä»Androidæ¡†æ¶ä¸­è·å–æˆ‘ä»¬ä¹‹å‰çš„<code>CustomTypefaceSpan</code>å’Œ<code>BackgroundColorSpan</code> ï¼š </p><br><pre> <code class="kotlin hljs"><span class="hljs-comment"><span class="hljs-comment">//    spannable.setSpan(BackgroundColorSpan(lightGray), ...) //   spannable.setSpan(CustomTypefaceSpan(typeface), ...)</span></span></code> </pre> <br><p> è¿™ä¸¤ç§è§£å†³æ–¹æ¡ˆå°†æœ‰æ‰€ä¸åŒã€‚ äº‹å®æ˜¯ï¼Œè‡ªå†™è·¨åº¦æ— æ³•å®ç°<code>Parcelable</code>æ¥å£ï¼Œè¿™ä¸ç³»ç»Ÿæ¥å£ä¸åŒã€‚ </p><br><p> å½“é€šè¿‡Intentæˆ–å‰ªè´´æ¿ä¼ è¾“é£æ ¼åŒ–çš„è¡Œæ—¶ï¼Œå¦‚æœè·¨åº¦ä¸ºè‡ªå†™æ ‡è®°ï¼Œåˆ™ä¸ä¼šä¿å­˜ã€‚ å½“ä½¿ç”¨æ¡†æ¶çš„è·¨åº¦æ—¶ï¼Œæ ‡è®°å°†ä¿ç•™ã€‚ </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/is/nw/uu/isnwuux9cosllp6h0kgawifcepo.png" width="600"></div><br><h2 id="ispolzovanie-spanov-v-tekste"> åœ¨æ–‡æœ¬ä¸­ä½¿ç”¨è·¨åº¦ </h2><br><p> æ¡†æ¶ä¸­æœ‰ä¸¤ä¸ªç”¨äºæ ·å¼åŒ–æ–‡æœ¬çš„æ¥å£ï¼š <code>Spannable</code>å’Œ<code>Spannable</code> ï¼ˆåˆ†åˆ«å…·æœ‰ä¸å˜çš„æ ‡è®°å’Œå¯å˜çš„æ ‡è®°ï¼‰å’Œä¸‰ä¸ªå®ç°ï¼š <code>SpannedString</code> ï¼ˆä¸å˜çš„æ–‡æœ¬ï¼‰ï¼Œ <code>SpannableString</code> ï¼ˆä¸å˜çš„æ–‡æœ¬ï¼‰å’Œ<code>SpannableStringBuilder</code> ï¼ˆå¯å˜æ–‡æœ¬ï¼‰ã€‚ </p><br><div class="scrollable-table"><table><thead><tr><th></th><th> å¯å˜æ–‡å­— </th><th> å¯å˜æ ‡è®° </th></tr></thead><tbody><tr><td>  <strong>è·¨åº¦</strong>å­—ç¬¦ä¸² </td><td> æ²¡æœ‰å•¦ </td><td> æ²¡æœ‰å•¦ </td></tr><tr><td>  <strong>å¯æ‰©å±•</strong>å­—ç¬¦ä¸² </td><td> æ²¡æœ‰å•¦ </td><td> æ˜¯çš„ </td></tr><tr><td>  <strong>Spannablestring</strong>æ„å»ºå™¨ </td><td> æ˜¯çš„ </td><td> æ˜¯çš„ </td></tr></tbody></table></div><br><p> ä¾‹å¦‚ï¼Œ <code>SpannableStringBuilder</code>ç”¨äºéœ€è¦æ›´æ”¹æ–‡æœ¬çš„<code>EditText</code>ä¸­ã€‚ </p><br><p> æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•å‘è¡Œæ·»åŠ æ–°çš„è·¨åº¦ï¼š </p><br><p> <code>setSpan(Object what, int start, int end, int flags)</code> </p> <br><p> è·¨åº¦é€šè¿‡ç¬¬ä¸€ä¸ªå‚æ•°ä¼ é€’ï¼Œç„¶åæŒ‡ç¤ºæ–‡æœ¬ä¸­çš„ç´¢å¼•èŒƒå›´ã€‚ æœ€åä¸€ä¸ªå‚æ•°æ˜¯å¯ä»¥æ§åˆ¶çš„ï¼Œæ’å…¥æ–°æ–‡æœ¬æ—¶è·¨åº¦çš„è¡Œä¸ºæ˜¯ä»€ä¹ˆï¼šè·¨åº¦æ˜¯å¦ä¼šæ‰©å±•åˆ°åœ¨èµ·ç‚¹æˆ–ç»ˆç‚¹æ’å…¥çš„æ–‡æœ¬ï¼ˆå¦‚æœåœ¨ä¸­é—´æ’å…¥æ–°æ–‡æœ¬ï¼Œåˆ™æ— è®ºæ ‡å¿—å€¼å¦‚ä½•ï¼Œè¯¥è·¨åº¦éƒ½ä¼šè‡ªåŠ¨åº”ç”¨äºè¯¥æ–‡æœ¬ï¼‰ ã€‚ </p><br><p> ä¸Šé¢åˆ—å‡ºçš„ç±»ä¸ä»…åœ¨è¯­ä¹‰ä¸Šæœ‰æ‰€ä¸åŒï¼Œè€Œä¸”åœ¨å†…éƒ¨æ’åˆ—æ–¹é¢ä¹Ÿæœ‰æ‰€ä¸åŒï¼š <code>SpannedString</code>å’Œ<code>SpannableString</code>ä½¿ç”¨æ•°ç»„å­˜å‚¨è·¨åº¦ï¼Œè€Œ<code>SpannableStringBuilder</code>ä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">é—´éš”æ ‘</a> ã€‚ </p><br><p> å¦‚æœæ ¹æ®è·¨åº¦çš„æ•°é‡æµ‹è¯•æ¸²æŸ“æ–‡æœ¬çš„é€Ÿåº¦ï¼Œæ‚¨å°†å¾—åˆ°ä»¥ä¸‹ç»“æœï¼šå½“è¿ç»­ä½¿ç”¨å¤šè¾¾250ä¸ªè·¨åº¦æ—¶ï¼Œ <code>SpannableString</code>å’Œ<code>SpannableStringBuilder</code>å·¥ä½œé€Ÿåº¦å¤§è‡´ç›¸åŒï¼Œä½†æ˜¯å¦‚æœæ ‡è®°å…ƒç´ è¶…è¿‡250ï¼Œåˆ™<code>SpannableString</code>å¯åŠ¨è¾“ã€‚ å› æ­¤ï¼Œå¦‚æœä»»åŠ¡æ˜¯å°†æ ·å¼åº”ç”¨äºæŸäº›æ–‡æœ¬ï¼Œåˆ™åœ¨é€‰æ‹©ç±»æ—¶ï¼Œåº”éµå¾ªè¯­ä¹‰è¦æ±‚ï¼šçº¿æ¡å’Œæ ·å¼æ˜¯å¦å¯å˜ã€‚ ä½†æ˜¯ï¼Œå¦‚æœæ ‡è®°éœ€è¦è¶…è¿‡250ä¸ªè·¨åº¦ï¼Œåˆ™åº”å§‹ç»ˆå°†<code>SpannableStringBuilder</code>ä¸º<code>SpannableStringBuilder</code> ã€‚ </p><br><h2 id="proverka-na-nalichie-spana-v-tekste"> æ£€æŸ¥æ–‡æœ¬ä¸­çš„è·¨åº¦ </h2><br><p> è¯¥ä»»åŠ¡ä¼šå®šæœŸå‡ºç°ï¼Œä»¥æ£€æŸ¥è·¨åº¦çº¿æ˜¯å¦å…·æœ‰ç‰¹å®šè·¨åº¦ã€‚ åœ¨Stackoverflowä¸Šï¼Œæ‚¨å¯ä»¥æ‰¾åˆ°ä»¥ä¸‹ä»£ç ï¼š </p><br><pre> <code class="kotlin hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-type"><span class="hljs-function"><span class="hljs-type">&lt;T&gt;</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasSpan</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(spanned: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Spanned</span></span></span></span><span class="hljs-function"><span class="hljs-params">, clazz: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Class</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">T</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt;)</span></span></span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> spans: Array&lt;<span class="hljs-keyword"><span class="hljs-keyword">out</span></span> T&gt; = spanned.getSpans(<span class="hljs-number"><span class="hljs-number">0</span></span>, spanned.length, clazz) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> spans.isNotEmpty() }</code> </pre> <br><p> è¿™æ ·çš„è§£å†³æ–¹æ¡ˆå¯ä»¥å·¥ä½œï¼Œä½†æ˜¯æ•ˆç‡å¾ˆä½ï¼šæ‚¨å¿…é¡»éå†æ‰€æœ‰èŒƒå›´ï¼Œæ£€æŸ¥æ¯ä¸ªèŒƒå›´æ˜¯å¦å±äºä¼ é€’çš„ç±»å‹ï¼Œå°†ç»“æœæ”¶é›†åˆ°æ•°ç»„ä¸­ï¼Œæœ€ååªæ£€æŸ¥æ•°ç»„æ˜¯å¦ä¸ºç©ºã€‚ </p><br><p> ä¸€ä¸ªæ›´æœ‰æ•ˆçš„è§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨<code>nextSpanTransition()</code>æ–¹æ³•ï¼š </p><br><pre> <code class="kotlin hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-type"><span class="hljs-function"><span class="hljs-type">&lt;T&gt;</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasSpan</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(spanned: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Spanned</span></span></span></span><span class="hljs-function"><span class="hljs-params">, clazz: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Class</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">T</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt;)</span></span></span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> limit = spanned.length <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> spanned.nextSpanTransition(<span class="hljs-number"><span class="hljs-number">0</span></span>, limit, clazz) &lt; limit }</code> </pre> <br><h2 id="razmetka-teksta-v-razlichnyh-yazykovyh-resursah"> å„ç§è¯­è¨€èµ„æºä¸­çš„æ–‡æœ¬æ ‡è®° </h2><br><p> å½“æ‚¨æƒ³å€ŸåŠ©å„ç§å­—ç¬¦ä¸²èµ„æºä¸­çš„æ ‡è®°æ¥çªå‡ºæ˜¾ç¤ºç‰¹å®šå•è¯æ—¶ï¼Œå¯èƒ½ä¼šå‡ºç°è¿™æ ·çš„ä»»åŠ¡ã€‚ ä¾‹å¦‚ï¼Œæˆ‘ä»¬éœ€è¦åœ¨è‹±è¯­ç‰ˆæœ¬ä¸­çªå‡ºæ˜¾ç¤º<em>â€œæ–‡æœ¬â€</em>ä¸€è¯ï¼Œåœ¨è¥¿ç­ç‰™è¯­ä¸­çªå‡ºæ˜¾ç¤º<em>â€œ textoâ€ä¸€è¯</em> ï¼š </p><br><pre> <code class="xml hljs"><span class="hljs-comment"><span class="hljs-comment">&lt;!-- values-en/strings.xml --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"title"</span></span></span><span class="hljs-tag">&gt;</span></span>Best practices for text in Android<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- values-es/strings.xml --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">â€titleâ€</span></span></span><span class="hljs-tag">&gt;</span></span>Texto en Android: mejores prÃ¡cticas<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p> ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨éœ€è¦ç®€å•çš„å†…å®¹ä»¥ç²—ä½“çªå‡ºæ˜¾ç¤ºè¯¥å•è¯ï¼Œåˆ™å¯ä»¥ä½¿ç”¨å¸¸ç”¨çš„htmlæ ‡ç­¾ï¼ˆ <code>&lt;b&gt;</code> ï¼‰ã€‚ åœ¨ç”¨æˆ·ç•Œé¢ä¸­ï¼Œæ‚¨åªéœ€è¦åœ¨TextViewä¸­è®¾ç½®å­—ç¬¦ä¸²èµ„æºï¼š </p><br><pre> <code class="kotlin hljs">textView.setText(R.string.title)</code> </pre> <br><p> ä½†æ˜¯ï¼Œå¦‚æœæ‚¨éœ€è¦æ›´å¤æ‚çš„å†…å®¹ï¼ˆä¾‹å¦‚æ›´æ”¹å­—ä½“ï¼‰ï¼Œåˆ™æ— æ³•å†ä½¿ç”¨htmlã€‚ è§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨ç‰¹æ®Šçš„<code>&lt;annotation&gt;</code> ã€‚ è¯¥æ ‡è®°å…è®¸æ‚¨åœ¨xmlæ–‡ä»¶ä¸­å®šä¹‰ä»»ä½•é”®å€¼å¯¹ã€‚ å½“æˆ‘ä»¬ä»èµ„æºä¸­æå–å­—ç¬¦ä¸²æ—¶ï¼Œè¿™äº›æ ‡ç­¾ä¼šè‡ªåŠ¨è½¬æ¢ä¸º<code>Annotation</code>èŒƒå›´ï¼Œå¹¶åœ¨æ–‡æœ¬ä¸­å¸¦æœ‰ç›¸åº”çš„é”®å’Œå€¼ã€‚ ä¹‹åï¼Œæ‚¨å¯ä»¥è§£ææ–‡æœ¬ä¸­çš„æ³¨é‡Šåˆ—è¡¨å¹¶åº”ç”¨å¿…è¦çš„è·¨åº¦ã€‚ </p><br><p> å‡è®¾æˆ‘ä»¬éœ€è¦ä½¿ç”¨<code>CustomTypefaceSpan</code>æ›´æ”¹å­—ä½“ã€‚ </p><br><p> æ·»åŠ ä¸€ä¸ªæ ‡ç­¾ï¼Œå¹¶ä¸ºå…¶å®šä¹‰ä¸€ä¸ª<em>â€œå­—ä½“â€</em>é”®å’Œä¸€ä¸ªå€¼-æˆ‘ä»¬è¦ä½¿ç”¨çš„å­—ä½“ç±»å‹ä¸º<em>â€œ title_emphasisâ€</em> ï¼š <br></p><pre> <code class="xml hljs"><span class="hljs-comment"><span class="hljs-comment">&lt;!-- values-en/strings.xml --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"title"</span></span></span><span class="hljs-tag">&gt;</span></span>Best practices for <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">annotation</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">font</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">â€title_emphasisâ€</span></span></span><span class="hljs-tag">&gt;</span></span>text<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">annotation</span></span></span><span class="hljs-tag">&gt;</span></span> in Android<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- values-es/strings.xml --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">â€titleâ€</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">annotation</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">font</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">â€title_emphasisâ€</span></span></span><span class="hljs-tag">&gt;</span></span>Texto<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">annotation</span></span></span><span class="hljs-tag">&gt;</span></span> en Android: mejores prÃ¡cticas<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p> ä»èµ„æºä¸­æ‹‰å‡ºå­—ç¬¦ä¸²ï¼Œä½¿ç”¨<em>â€œ fontâ€</em>é”®æ‰¾åˆ°æ³¨é‡Šå¹¶æ’åˆ—è·¨åº¦ï¼š </p><br><pre> <code class="kotlin hljs"><span class="hljs-comment"><span class="hljs-comment">//      SpannedString,     span' val titleText = getText(R.string.title) as SpannedString //    val annotations = titleText.getSpans(0, titleText.length, Annotation::class.java) //     SpannableString //      val spannableString = SpannableString(titleText) //     for (annotation in annotations) { //     "font" if (annotation.key == "font") { val fontName = annotation.value //   ,     if (fontName == "title_emphasis") { val typeface = getFontCompat(R.font.permanent_marker) //  span    ,    spannableString.setSpan( CustomTypefaceSpan(typeface), titleText.getSpanStart(annotation), titleText.getSpanEnd(annotation), Spannable.SPAN_EXCLUSIVE_EXCLUSIVE ) } } } styledText.text = spannableString</span></span></code> </pre><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/yq/62/mm/yq62mmgvajffkxkzk3qntsnxhw4.png" width="600"></div><br><p> ä¸Šé¢å·²ç»æåˆ°ï¼ŒAndroidæ¡†æ¶ä¹‹å¤–çš„è·¨åº¦æ— æ³•å®ç°<code>Parcelable</code> ï¼Œè€Œæ˜¯é€šè¿‡Intentè¿›è¡Œä¼ è¾“ã€‚ ä½†è¿™ä¸é€‚ç”¨äºå®ç°<code>Parcelable</code>æ³¨é‡Šã€‚ å› æ­¤ï¼Œæ‚¨å¯ä»¥é€šè¿‡Intentä¼ é€’å¸¦æ³¨é‡Šçš„å­—ç¬¦ä¸²ï¼Œå¹¶é€šè¿‡å®‰æ’è·¨åº¦ä»¥å®Œå…¨ç›¸åŒçš„æ–¹å¼è¿›è¡Œè§£æã€‚ </p><br><h1 id="kak-tekst-raspolagaetsya-v-textview"> æ–‡æœ¬å¦‚ä½•æ”¾ç½®åœ¨TextViewä¸­ </h1><br><p>  TextViewä¸ä»…å¯ä»¥æ˜¾ç¤ºæ–‡æœ¬ï¼Œè¿˜å¯ä»¥æ˜¾ç¤ºå›¾ç‰‡ã€‚ æ‚¨è¿˜å¯ä»¥åœ¨æ–‡æœ¬å‰é¢è®¾ç½®å„ç§ç¼©è¿›ã€‚ åœ¨å¹•åï¼Œè¿™æ ·åšå¯ä»¥ä½¿TextViewåˆ›å»ºä¸€ä¸ªå­ç±»Layoutï¼Œå®ƒç›´æ¥è´Ÿè´£æ˜¾ç¤ºæ–‡æœ¬ã€‚ è¿™æ˜¯ä¸€ä¸ªå…·æœ‰ä¸‰ä¸ªå®ç°çš„æŠ½è±¡ç±»ï¼›é€šå¸¸ï¼Œé™¤éæ‚¨ç¼–å†™è‡ªå·±çš„æ§ä»¶ï¼Œå¦åˆ™ä¸å¿…ç›´æ¥ä½¿ç”¨å®ƒä»¬ï¼š </p><br><ul><li>  <strong>BoringLayout</strong>ç”¨äºç®€å•çš„æ–‡æœ¬ï¼Œä¸æ”¯æŒ<strong>æ¢è¡Œç¬¦</strong> ï¼ŒRTLç­‰ï¼Œä½†æ˜¯å®ƒæ˜¯æœ€è½»é‡çš„ã€‚ å¦‚æœæ–‡æœ¬ç¬¦åˆæ‰€æœ‰é™åˆ¶ï¼Œåˆ™TextViewå°†ä½¿ç”¨å®ƒã€‚ </li><li> åœ¨å…¶ä»–æƒ…å†µä¸‹ï¼Œåœ¨TextViewä¸­ä½¿ç”¨<strong>StaticLayout</strong> ã€‚ </li><li>  <strong>DynamicLayout</strong>ç”¨äºEditTextä¸­çš„å¯å˜æ–‡æœ¬ã€‚ </li></ul><br><p> å¸ƒå±€æœ‰è®¸å¤šæ–¹æ³•å¯ä»¥è®©æ‚¨çŸ¥é“æ‰€æ˜¾ç¤ºæ–‡æœ¬çš„å„ç§å‚æ•°ï¼šè¡Œçš„åæ ‡ï¼ŒåŸºçº¿ï¼Œè¡Œä¸­æ–‡æœ¬çš„å¼€å¤´å’Œç»“å°¾çš„åæ ‡ç­‰ã€‚  ï¼ˆæ›´å¤šè¯¦ç»†ä¿¡æ¯å¯ä»¥åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ–‡æ¡£ä¸­</a>æ‰¾åˆ°ï¼‰ </p><br><p> è¿™æ ·çš„æ–¹æ³•å¯èƒ½éå¸¸æœ‰ç”¨ã€‚ ä¾‹å¦‚ï¼Œä¸€äº›å¼€å‘äººå‘˜é¢ä¸´ç€å°†éƒ¨åˆ†æ–‡æœ¬æå–ä¸ºåœ†è§’çŸ©å½¢ï¼Œå¹¶è¯•å›¾é€šè¿‡ä¸é€‚ç”¨äºè§£å†³æ­¤é—®é¢˜çš„è·¨åº¦æ‰¾åˆ°å…¶è§£å†³æ–¹æ¡ˆçš„ä»»åŠ¡ã€‚ </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/8b/-2/df/8b-2df4-wo4ghk8tkwss6l48bfy.png" width="300"></div><br><p> ä½†æ˜¯Layoutç±»çš„æ–¹æ³•å¯ä»¥è§£å†³ã€‚ è¿™æ˜¯ä¸€ä¸ªç¤ºä¾‹è§£å†³æ–¹æ¡ˆï¼š </p><br><p> ä½¿ç”¨æ³¨é‡Šï¼Œæˆ‘ä»¬é€‰æ‹©åº”åœ¨çŸ©å½¢ä¸­åœˆå‡ºçš„å•è¯ã€‚ </p><br><p> ç„¶åä¸ºæ‰€æœ‰æ–‡æœ¬ç¯ç»•æƒ…å†µåˆ›å»º4ä¸ªå¯ç»˜åˆ¶èµ„æºï¼Œè¿™äº›èµ„æºåº”æ”¾åœ¨çŸ©å½¢ä¸­ï¼š </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/q4/ry/oj/q4ryojq_lsj3sdyyehvprallpl8.png" width="600"></div><br><p> æ¥ä¸‹æ¥ï¼Œå¦‚ä¸Šæ‰€è¿°ï¼Œæˆ‘ä»¬åœ¨æ–‡æœ¬ä¸­æ‰¾åˆ°äº†æ‰€éœ€çš„æ³¨é‡Šã€‚ ç°åœ¨ï¼Œæˆ‘ä»¬æœ‰äº†æ­¤ç±»æ³¨é‡Šçš„å¼€å§‹å’Œç»“æŸçš„ç´¢å¼•ã€‚ é€šè¿‡Layoutæ–¹æ³•ï¼Œæ‚¨å¯ä»¥æ‰¾åˆ°å¸¦æ³¨é‡Šçš„æ–‡æœ¬å¼€å§‹å’Œç»“æŸçš„è¡Œå·ï¼š </p><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> startLine = layout.getLineForOffset(spanStartIndex) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> endLine = layout.getLineForOffset(spanEndIndex)</code> </pre> <br><p> æ¥ä¸‹æ¥ï¼Œæ‚¨å¿…é¡»ç»˜åˆ¶ä¸€ä¸ªæˆ–å¤šä¸ªçŸ©å½¢ã€‚ è€ƒè™‘ä¸€ä¸ªç®€å•çš„æƒ…å†µï¼Œå³æ–‡æœ¬çš„å¸¦æ³¨é‡Šçš„éƒ¨åˆ†æ˜¾ç¤ºåœ¨ä¸€è¡Œä¸Šï¼Œé‚£ä¹ˆæˆ‘ä»¬åªéœ€è¦ä¸€ä¸ªå¸¦æœ‰å››ä¸ªåœ†è§’çš„çŸ©å½¢ã€‚ å®šä¹‰å…¶åæ ‡å¹¶ç»˜åˆ¶ï¼š </p><br><pre> <code class="kotlin hljs">... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (startLine == endLine) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> lineTop = layout.getLineTop(startLine) <span class="hljs-comment"><span class="hljs-comment">//    val lineBottom = layout.getLineBottom(startLine) //    val startCoor = layout.getPrimaryHorizontal(spanStartIndex).toInt() //    val endCoor = layout.getPrimaryHorizontal(spanEndIndex).toInt() //    //   drawable.setBounds(startCoor, lineTop, endCoor, lineBottom) drawable.draw(canvas) ...</span></span></code> </pre><br><p> ä»è¯¥ç¤ºä¾‹ä¸­å¯ä»¥çœ‹åˆ°ï¼Œå¸ƒå±€åœ¨æ˜¾ç¤ºçš„æ–‡æœ¬ä¸Šå­˜å‚¨äº†è®¸å¤šæœ‰ç”¨çš„ä¿¡æ¯ï¼Œè¿™å¯ä»¥å¸®åŠ©å®ç°å„ç§éæ ‡å‡†ä»»åŠ¡ã€‚ </p><br><h1 id="proizvoditelnost-textview">  TextViewæ€§èƒ½ </h1><br><p> ä¸ä»»ä½•Viewä¸€æ ·ï¼ŒTextViewåœ¨æ˜¾ç¤ºæ—¶ç»å†ä¸‰ä¸ªé˜¶æ®µï¼š <code>onMeasure()</code> ï¼Œ <code>onLayout()</code>å’Œ<code>onDraw()</code> ã€‚ åŒæ—¶ï¼Œä¸å…¶ä»–ä¸¤ç§æ–¹æ³•ä¸åŒï¼Œ <code>onMeasure()</code>èŠ±è´¹çš„æ—¶é—´æœ€å¤šï¼šæ­¤æ—¶ï¼Œé‡æ–°åˆ›å»ºLayoutç±»å¹¶è®¡ç®—æ–‡æœ¬å¤§å°ã€‚ å› æ­¤ï¼Œæ›´æ”¹æ–‡æœ¬å¤§å°ï¼ˆä¾‹å¦‚ï¼Œæ›´æ”¹å­—ä½“ï¼‰éœ€è¦è¿›è¡Œå¤§é‡å·¥ä½œã€‚ æ›´æ”¹æ–‡æœ¬çš„é¢œè‰²å°†æ›´åŠ è½»å·§ï¼Œå› ä¸ºå®ƒåªéœ€è¦è°ƒç”¨<code>onDraw()</code> ã€‚ å¦‚ä¸Šæ‰€è¿°ï¼Œç³»ç»Ÿå…·æœ‰è®¡ç®—å‡ºçš„å¤§å°çš„å…¨å±€å­—ç¼“å­˜ã€‚ å¦‚æœå•è¯å·²ç»åœ¨é«˜é€Ÿç¼“å­˜ä¸­ï¼Œåˆ™<code>onMeasure()</code>è°ƒç”¨<code>onMeasure()</code>å°†ä¼šèŠ±è´¹å®Œæ•´è®¡ç®—æ‰€éœ€æ—¶é—´çš„11-16ï¼…ã€‚ </p><br><h2 id="uskorenie-pokaza-teksta"> æ–‡å­—åŠ é€Ÿ </h2><br><p>  2015å¹´ï¼ŒInstagramå¼€å‘äººå‘˜ä½¿ç”¨å…¨å±€ç¼“å­˜åŠ å¿«äº†ç…§ç‰‡è¯„è®ºçš„æ˜¾ç¤ºé€Ÿåº¦ã€‚ æƒ³æ³•æ˜¯åœ¨å°†æ–‡æœ¬æ˜¾ç¤ºåœ¨å±å¹•ä¸Šä¹‹å‰å…ˆå¯¹å…¶è¿›è¡Œè™šæ‹Ÿç»˜åˆ¶ï¼Œä»è€Œâ€œé¢„çƒ­â€ç³»ç»Ÿç¼“å­˜ã€‚ å½“éœ€è¦æ˜¾ç¤ºæ–‡æœ¬æ—¶ï¼Œç”±äºæ–‡æœ¬å·²ç»è¿‡æµ‹é‡å¹¶ä¸”ä½äºç¼“å­˜ä¸­ï¼Œå› æ­¤ç”¨æˆ·å¯ä»¥æ›´å¿«åœ°çœ‹åˆ°å®ƒã€‚ </p><br><p> ä»<strong>Android Pï¼ˆ28ï¼‰å¼€å§‹</strong> ï¼ŒGoogleå¼€å‘äººå‘˜å·²åœ¨APIä¸­æ·»åŠ äº†é¢„å…ˆåœ¨åå°çº¿ç¨‹ä¸­æ‰§è¡Œæ–‡æœ¬å¤§å°æµ‹é‡é˜¶æ®µçš„åŠŸèƒ½<code>PrecomputedText</code> ï¼ˆä»¥åŠä»<strong>Android Iï¼ˆ14ï¼‰</strong>å¼€å§‹çš„APIçš„<code>PrecomputedTextCompat</code> ï¼‰ã€‚ ä½¿ç”¨æ–°çš„APIï¼Œ90ï¼…çš„å·¥ä½œå°†åœ¨åå°çº¿ç¨‹ä¸­å®Œæˆã€‚ </p><br><p> ä¸€ä¸ªä¾‹å­ï¼š </p><br><pre> <code class="kotlin hljs"><span class="hljs-comment"><span class="hljs-comment">// UI thread val params: PrecomputedText.Params = textView.getTextMetricsParams() val ref = WeakReference(textView) executor.execute { // background thread val text = PrecomputedText.create("Hello", params) val textView = ref.get() textView?.post { // UI thread val textView = ref.get() textView?.text = text } }</span></span></code> </pre> <br><h2 id="pokaz-bolshogo-teksta"> æ˜¾ç¤ºå¤§æ–‡å­— </h2><br><p> å¦‚æœæ‚¨éœ€è¦æ˜¾ç¤ºå¤§æ–‡æœ¬ï¼Œåˆ™ä¸è¦ç«‹å³å°†å…¶ä¼ è¾“åˆ°TextViewã€‚ å¦åˆ™ï¼Œè¯¥åº”ç”¨ç¨‹åºå¯èƒ½ä¼šåœæ­¢å¹³ç¨³è¿è¡Œæˆ–å®Œå…¨å†»ç»“ï¼Œå› ä¸ºå®ƒå°†åœ¨ä¸»çº¿ç¨‹ä¸Šè¿›è¡Œå¤§é‡å·¥ä½œä»¥æ˜¾ç¤ºå·¨å¤§çš„æ–‡æœ¬ï¼Œç”¨æˆ·ç”šè‡³å¯èƒ½æ— æ³•æ»šåŠ¨åˆ°æœ«å°¾ã€‚ è§£å†³æ–¹æ¡ˆæ˜¯å°†æ–‡æœ¬æ‹†åˆ†ä¸ºå¤šä¸ªéƒ¨åˆ†ï¼ˆä¾‹å¦‚æ®µè½ï¼‰ï¼Œç„¶ååœ¨RecyclerViewä¸­æ˜¾ç¤ºå„ä¸ªéƒ¨åˆ†ã€‚ ä¸ºäº†è¿›ä¸€æ­¥æé«˜é€Ÿåº¦ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨PrecomputedTexté¢„è®¡ç®—æ–‡æœ¬å—çš„å¤§å°ã€‚ </p><br><p> ä¸ºäº†ä¿ƒè¿›PrecomputedTextåœ¨RecyclerViewä¸­çš„åµŒå…¥ï¼ŒGoogleå¼€å‘äººå‘˜ä¸º<code>PrecomputedTextCompat.getTextFuture()</code>å’Œ<code>AppCompatTextView.setTextFuture()</code>åˆ¶ä½œäº†ç‰¹æ®Šçš„æ–¹æ³•ï¼š </p><br><pre> <code class="kotlin hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onBindViewHolder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(vh: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ViewHolder</span></span></span></span><span class="hljs-function"><span class="hljs-params">, position: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> <span class="hljs-keyword"><span class="hljs-keyword">data</span></span> = getData(position) vh.textView.setTextSize(...) vh.textView.setFontVariationSettings(...) <span class="hljs-comment"><span class="hljs-comment">//    val future = PrecomputedTextCompat.getTextFuture( data.text, vh.textView.getTextMetricsParamsCompat(), myExecutor ) //  future  TextView,      onMeasure() vh.textView.setTextFuture(future) }</span></span></code> </pre> <br><p>   RecyclerView      ,     ,              ,     . </p><br><p>  ,     <code>getTextFuture()</code>     (,   ),     ,   ,    <code>getTextFuture()</code> ,     ,    TextView. </p><br><h2 id="chto-nuzhno-znat-kogda-ustanavlivaesh-tekst-v-textview">   ,     TextView </h2><br><p>    <code>TextView.setText()</code>       : </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (type == SPANNABLE || movementMethod != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { text = spannableFactory.newSpannable(spannable) <span class="hljs-comment"><span class="hljs-comment">//  } else { text = new SpannedString(spannable) //  }</span></span></code> </pre> <br><p>       span'  TextView,       <code>setText()</code> ,      . </p><br><p>    ,      .  TextView    ,  -,   .    ,      .    ,    ,     TextView   <code>spannableFactory</code> : </p><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MySpannableFactory</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Spannable.Factory</span></span></span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">newSpannable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(source: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">CharSequence</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: Spannable { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> source <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>? Spannable ?: <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.newSpannable(source) } } textView.spannableFactory = MySpannableFactory()</code> </pre> <br><p>         <code>textView.setText(spannable, BufferType.SPANNABLE)</code> ,      . </p><br><p>  Google         span'  RecyclerView,      . </p><br><p>      TextView,     span,        <code>setText()</code> .      TextView      span. TextView   spannable-    span',  : </p><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> spannable = textView.getText() <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> Spannable <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> span = CustomTypefaceSpan(span) spannable.setSpan(span, ...)</code> </pre> <br><p>      span,      TextView,         TextView .       ,   <code>invalidate()</code> ,    â€“ <code>requestLayout()</code> : </p><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> spannable = textView.getText() <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> Spannable <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> span = CustomTypefaceSpan(span) spannable.setSpan(span, ...) span.setTypeface(anotherTypeface) textView.requestLayout() <span class="hljs-comment"><span class="hljs-comment">// re-measure and re-draw // or textView.invalidate() // re-draw</span></span></code> </pre> <br><h2 id="ispolzovanie-autolink">  autoLink </h2><br><p>  TextView     .         <code>autoLink</code> .   <code>autoLink=â€webâ€</code> TextView          URL          <code>URLSpan</code> .   ,     SDK   <code>setText()</code> : </p><br><pre> <code class="java hljs">spannable = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SpannableString(string); Matcher m = pattern.matcher(text); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (...) { <span class="hljs-comment"><span class="hljs-comment">//      String utl = â€¦ URLSpan span = new URLSpan(url); spannable.setSpan(span, ...); }</span></span></code> </pre> <br><p>      UI ,     <code>autoLink=â€webâ€</code>   RecyclerView.          .        <code>LinkifyCompat</code> : </p><br><pre> <code class="kotlin hljs"><span class="hljs-comment"><span class="hljs-comment">//  ,       background thread val spannable = SpannableString(string) LinkifyCompat.addLinks(spannable, Linkify.WEB_URLS) //   RecyclerView override fun onBindViewHolder(holder: ViewHolder, position: Int) { holder.textView.setText(spannable, BufferType.SPANNABLE) // ... }</span></span></code> </pre> <br><p>  <code>autoLink</code>      <code>map</code> â€“    (      <code>all</code> ).       .   ,        WebView,      !    SDK   <code>Linkify.gatherMapLinks()</code>    ,      : </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ((address = WebView.findAddress(string)) != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { ... }</code> </pre> <br><p>   WebView  TODO   SDK: </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findAddress</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String addr)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> Rewrite this in Java so it is not needed to start up chromium // Could also be deprecated return getFactory().getStatics().findAddress(addr); }</span></span></code> </pre> <br><p>     ?     Smart Linkify,       <strong>Android P (28)</strong> ,          ,      .    : </p><br><pre> <code class="kotlin hljs"><span class="hljs-comment"><span class="hljs-comment">// UI thread val text: Spannable = â€¦ val request = TextLinks.Request.Builder(text) val ref = WeakReference(textView) executor.execute { // background thread TextClassifier.generateLinks(request).apply(text) val textView = ref.get() textView?.post { // UI thread val textView = ref.get() textView?.text = text } }</span></span></code> </pre> <br><p>    Linkify,      .        toolbar   ,     Google . </p><br><p>  Smart Linkify    :  ,    . </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/9t/nc/qb/9tncqbkanp8avsnmisd-ax0z7ae.gif" width="300"></div><br><h1 id="magnifier"> Magnifier </h1><br><p>   <strong>Android P (28)</strong> ,     â€“ Magnifier,       .           . </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/fi/nn/or/finnor2svtuttfn1v-lxwkblgwm.gif" width="400"></div><br><p>      TextView, EditText  WebView,            :  API <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="> </a> . </p><br><h1 id="zaklyuchenie"> ç»“è®º </h1><br><p>          Android   ,   , : </p><br><ul><li>         </li><li>    </li><li>   ,   TextView (, EditText) </li></ul><br><p>  -     ,      Google I/O'19 <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">â€œBest Practices for Using Text in Androidâ€</a> . </p><br><a name="links"></a><br><h1 id="poleznye-ssylki"> æœ‰ç”¨çš„é“¾æ¥ </h1><br><h2 id="stati">  </h2><br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Florina Muntenescu. "Spantastic text styling with Spans"</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Florina Muntenescu. "Underspanding spans"</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Florina Muntenescu. "Styling internationalized text in Android"</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Instagram Engineering. "Improving Comment Rendering on Android"</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Daniel Lee. "Text rendering on Android"</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Mariusz DÄ…browski. "What is new in Android P â€” PrecomputedText"</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Chet Haase. "RecyclerView Prefetch"</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Chris Craik. "Prefetch Text Layout in RecyclerView"</a> </li></ul><br><h2 id="doklady"> æŠ¥å‘Šä¹¦ </h2><br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Best practices for text on Android (Google I/O '18)</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Use Android Text Like a Pro (Android Dev Summit '18)</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Best Practices for Using Text in Android (Google I/O'19)</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN461787/">https://habr.com/ru/post/zh-CN461787/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN461773/index.html">Airtest IDE-æµ‹è¯•æ‰‹æœºæ¸¸æˆè‡ªåŠ¨åŒ–çš„æ–°æ–¹æ³•ï¼Ÿ</a></li>
<li><a href="../zh-CN461775/index.html">åœ¨Djangoåº”ç”¨ç¨‹åºä¸­ä½¿ç”¨Celeryçš„3ç§æƒ…å†µ</a></li>
<li><a href="../zh-CN461779/index.html">æ‚¨æ— æ³•ä½¿ç”¨å…¬å¸80ï¼…çš„æ•°æ®ã€‚ æ€ä¹ˆåŠå‘¢ï¼Ÿ</a></li>
<li><a href="../zh-CN461781/index.html">â€œ Ycombinatoråˆ›ä¸šå­¦æ ¡2019ã€‚â€ å‰ä¸‰å‘¨çš„è§†é¢‘</a></li>
<li><a href="../zh-CN461785/index.html">RISC-Vçš„ç¼ºç‚¹</a></li>
<li><a href="../zh-CN461793/index.html">Ivan Ponomarevåœ¨jug.msk.ruä¼šè®®ä¸Šæœ‰å…³Kafka Streams APIçš„ä¿¡æ¯</a></li>
<li><a href="../zh-CN461797/index.html">æœåŠ¡çš„æ•…äº‹ã€‚ å…³äºè®¤çœŸå·¥ä½œçš„è½»ææ·¡å†™çš„å¸–å­</a></li>
<li><a href="../zh-CN461801/index.html">æ˜¾ç¤ºç«¯å£-LVDS</a></li>
<li><a href="../zh-CN461803/index.html">æ•°æ®ç‰ˆæœ¬æ§åˆ¶ï¼ˆDVCï¼‰ï¼šæ•°æ®ç‰ˆæœ¬æ§åˆ¶å’Œå®éªŒå¯é‡å¤æ€§</a></li>
<li><a href="../zh-CN461805/index.html">è’™ç‰¹å¡æ´›ç§¯åˆ†åœ¨æ¸²æŸ“ä¸­çš„åº”ç”¨</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>