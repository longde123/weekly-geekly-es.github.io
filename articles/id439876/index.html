<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>💀 👨🏾‍🎤 🎼 Bagaimana kami mengatasi ketidakcocokan saat melakukan migrasi data dari Greenplum 4 ke Greenplum 5 🌾 🛳️ 👨🏽‍🍳</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ketika kami memilih alat untuk memproses data besar, kami mempertimbangkan opsi yang berbeda - baik milik maupun sumber terbuka. Kami mengevaluasi kem...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Bagaimana kami mengatasi ketidakcocokan saat melakukan migrasi data dari Greenplum 4 ke Greenplum 5</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/rostelecom/blog/439876/">  Ketika kami memilih alat untuk memproses data besar, kami mempertimbangkan opsi yang berbeda - baik milik maupun sumber terbuka.  Kami mengevaluasi kemungkinan adaptasi yang cepat, aksesibilitas dan fleksibilitas teknologi.  Termasuk migrasi antar versi.  Akibatnya, kami memilih solusi open source Greenplum, yang terbaik dari semua memenuhi persyaratan kami, tetapi membutuhkan solusi dari satu masalah penting. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9ff/69c/0d9/9ff69c0d9031f0afb897244dd0778e9e.png"><br><br>  Faktanya adalah bahwa file database Greenplum versi 4 dan 5 tidak kompatibel satu sama lain, dan oleh karena itu upgrade sederhana dari satu versi ke versi lain tidak mungkin.  Migrasi data hanya dapat dilakukan melalui mengunggah dan mengunduh data.  Dalam posting ini saya akan berbicara tentang opsi yang memungkinkan untuk migrasi ini. <br><a name="habracut"></a><br><h2>  Mengevaluasi opsi migrasi </h2><br><h3>  pg_dump &amp; psql (atau pg_restore) </h3><br>  Ini terlalu lambat untuk puluhan terabyte, karena semua data diunggah dan diunduh melalui master node.  Tetapi cukup cepat untuk memigrasi DDL dan tabel kecil.  Anda dapat mengunggah keduanya ke file dan menjalankan pg_dump dan psql secara bersamaan melalui pipa pada kluster sumber dan kluster tujuan.  pg_dump cukup mengunggah ke satu file yang berisi perintah DDL dan perintah data COPY.  Data yang diperoleh dapat dengan mudah diproses, yang akan ditampilkan di bawah ini. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/482/f47/cd8/482f47cd86df49125689c5360b6d060e.png"><br><br><h3>  gptransfer </h3><br>  Membutuhkan versi Greenplum 4.2 atau yang lebih baru.  Adalah penting bahwa kedua cluster sumber dan cluster tujuan bekerja secara bersamaan.  Cara tercepat untuk memigrasi tabel data besar untuk versi open source.  Tetapi metode ini sangat lambat untuk mentransfer tabel kosong dan kecil karena overhead yang tinggi. <br><br>  gptransfer menggunakan pg_dump untuk mentransfer DDL dan gpfdist untuk mentransfer data.  Jumlah segmen utama pada gugus tujuan harus tidak kurang dari segmen host pada gugus sumber.  Ini penting untuk dipertimbangkan ketika membuat kluster "kotak pasir", jika data dari kluster utama akan ditransfer ke mereka, dan penggunaan utilitas gptransfer direncanakan.  Sekalipun host segmen sedikit, Anda dapat menggunakan jumlah segmen yang diperlukan pada masing-masing segmen.  Jumlah segmen pada gugus tujuan mungkin kurang dari pada gugus sumber, namun, ini <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">akan mempengaruhi</a> kecepatan transfer data.  Di antara kluster, otentikasi ssh pada sertifikat harus dikonfigurasi. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/84b/a0a/f53/84ba0af53e82d2a4e861fe19c6f9be9a.png"><br><br>  Ini adalah skema untuk mode cepat ketika jumlah segmen pada gugus tujuan lebih besar atau sama dengan jumlah pada gugus sumber.  Peluncuran utilitas itu sendiri ditunjukkan pada diagram di node master cluster penerima.  Dalam mode ini, tabel tulis eksternal dibuat pada cluster sumber, yang menulis data pada setiap segmen ke pipa bernama.  Perintah INSERT INTO writable_external_table SELECT * FROM source_table dieksekusi.  Data dari pipa bernama dibaca oleh gpfdist.  Tabel eksternal juga dibuat pada gugus tujuan, hanya untuk membaca.  Tabel menunjukkan data yang disediakan gpfdist melalui <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">protokol dengan nama yang sama</a> .  INSERT INTO target_table SELECT * FROM external_gpfdist_table perintah dieksekusi.  Data secara otomatis didistribusikan kembali di antara segmen-segmen dari cluster tujuan. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/13f/b61/cfb/13fb61cfba946fbea0649c1df1cbf28c.png"><br><br>  Dan ini adalah skema untuk mode lambat, atau, sebagaimana gptransfer sendiri berikan, mode standar.  Perbedaan utama adalah bahwa pada setiap host segmen dari cluster sumber, pasangan gpfdist diluncurkan untuk semua segmen host segmen ini.  Tabel catatan eksternal mengacu pada gpfdist yang bertindak sebagai penerima data.  Selain itu, jika beberapa nilai diindikasikan untuk ditulis dalam parameter LOCATION pada tabel eksternal, maka segmen didistribusikan secara merata oleh gpfdist saat menulis data.  Data antara gpfdist pada segmen host dilewatkan melalui pipa bernama.  Karena itu, kecepatan transfer data lebih rendah, tetapi masih ternyata lebih cepat daripada saat mentransfer data hanya melalui master node. <br><br>  Saat memigrasikan data dari Greenplum 4 ke Greenplum 5, gptransfer harus dijalankan pada master node dari cluster tujuan.  Jika kami menjalankan gptransfer pada cluster sumber, kami mendapatkan kesalahan tentang tidak adanya bidang <code>san_mounts</code> di tabel <code>pg_catalog.gp_segment_configuration</code> : <br><br><pre> <code class="plaintext hljs">gptransfer -t big_db.public.test_table --dest-host=gpdb-target-master.local --dest-database=big_db --source-map-file=/data/master/gpseg-1/host_and_IP_segments --batch-size=10 --sub-batch-size=50 --truncate 20190109:12:46:13:010893 gptransfer:gpdb-source-master.local:gpadmin-[INFO]:-Starting gptransfer with args: -t big_db.public.test_table --dest-host=gpdb-target-master.local --dest-database=big_db --source-map-file=/data/master/gpseg-1/host_and_IP_segments --batch-size=10 --sub-batch-size=50 --truncate 20190109:12:46:13:010893 gptransfer:gpdb-source-master.local:gpadmin-[INFO]:-Validating options... 20190109:12:46:13:010893 gptransfer:gpdb-source-master.local:gpadmin-[INFO]:-Retrieving configuration of source Greenplum Database... 20190109:12:46:13:010893 gptransfer:gpdb-source-master.local:gpadmin-[INFO]:-Retrieving configuration of destination Greenplum Database... 20190109:12:46:14:010893 gptransfer:gpdb-source-master.local:gpadmin-[CRITICAL]:-gptransfer failed. (Reason='error 'ERROR: column "san_mounts" does not exist LINE 2: ... SELECT dbid, content, status, unnest(san_mounts... ^ ' in ' SELECT dbid, content, status, unnest(san_mounts) FROM pg_catalog.gp_segment_configuration WHERE content &gt;= 0 ORDER BY content, dbid '') exiting...</code> </pre> <br>  Anda juga perlu memeriksa variabel GPHOME sehingga mereka cocok antara kluster sumber dan kluster tujuan.  Kalau tidak, kami mendapatkan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">kesalahan yang</a> agak aneh (utilitas gptransfer gagal ketika sumber dan target memiliki jalur GPHOME yang berbeda). <br><br><pre> <code class="plaintext hljs">gptransfer -t big_db.public.test_table --source-host=gpdb-source-master.local --dest-database=big_db --source-map-file=/data1/master/gpseg-1/source_host_and_IP_segments --b atch-size=10 --sub-batch-size=50 --truncate 20190109:14:12:07:031438 gptransfer:mdw:gpadmin-[INFO]:-Starting gptransfer with args: -t big_db.public.test_table --source-host=gpdb-spurce-master.local --dest-database=big_db --source-map-file=/data1/master/gpseg-1/source_host_and_IP_segments --b atch-size=10 --sub-batch-size=50 --truncate 20190109:14:12:07:031438 gptransfer:mdw:gpadmin-[INFO]:-Validating options... 20190109:14:12:07:031438 gptransfer:mdw:gpadmin-[ERROR]:-gptransfer: error: GPHOME directory does not exist on gpdb-source-master.local</code> </pre> <br>  Anda cukup membuat symlink yang sesuai dan mengganti variabel GPHOME di sesi di mana gptransfer dimulai. <br><br>  Ketika gptransfer dimulai pada kluster tujuan, opsi "--source-map-file" harus mengarah ke file yang berisi daftar host dan alamat IP mereka dengan segmen utama dari kluster sumber.  Sebagai contoh: <br><br><pre> <code class="plaintext hljs">sdw1,192.0.2.1 sdw2,192.0.2.2 sdw3,192.0.2.3 sdw4,192.0.2.4</code> </pre> <br>  Dengan opsi "--full" dimungkinkan untuk mentransfer tidak hanya tabel, tetapi seluruh basis data, namun, basis data pengguna tidak boleh dibuat pada gugus tujuan.  Anda juga harus ingat bahwa ada masalah karena perubahan sintaks saat memindahkan tabel eksternal. <br><br>  Mari kita evaluasi overhead tambahan, misalnya, dengan menyalin 10 tabel kosong (tabel dari big_db.public.test_table_2 ke big_db.public.test_table_11) menggunakan gptarnsfer: <br><br><pre> <code class="plaintext hljs">gptransfer -f temp_filelist.txt --source-host=gpdb-source-master.local --dest-database=big_db --source-map-file=/data1/master/gpseg-1/source_host_and_IP_segments_dev --batch-size=10 --sub-ba tch-size=50 --truncate 20190118:06:14:08:031521 gptransfer:mdw:gpadmin-[INFO]:-Starting gptransfer with args: -f temp_filelist.txt --source-host=gpdb-source-master.local --dest-database=big_db --source-map-file=/data1/master/gpseg-1/source_host_and_IP_segments_dev --batch-size=10 --sub-batch-size=50 --truncate 20190118:06:14:08:031521 gptransfer:mdw:gpadmin-[INFO]:-Validating options... 20190118:06:14:08:031521 gptransfer:mdw:gpadmin-[INFO]:-Retrieving configuration of source Greenplum Database... 20190118:06:14:08:031521 gptransfer:mdw:gpadmin-[INFO]:-Retrieving configuration of destination Greenplum Database... 20190118:06:14:09:031521 gptransfer:mdw:gpadmin-[INFO]:-Retrieving source tables... 20190118:06:14:12:031521 gptransfer:mdw:gpadmin-[INFO]:-Checking for gptransfer schemas... 20190118:06:14:22:031521 gptransfer:mdw:gpadmin-[INFO]:-Retrieving list of destination tables... 20190118:06:14:25:031521 gptransfer:mdw:gpadmin-[INFO]:-Reading source host map file... 20190118:06:14:25:031521 gptransfer:mdw:gpadmin-[INFO]:-Building list of source tables to transfer... 20190118:06:14:25:031521 gptransfer:mdw:gpadmin-[INFO]:-Number of tables to transfer: 10 20190118:06:14:25:031521 gptransfer:mdw:gpadmin-[INFO]:-gptransfer will use "standard" mode for transfer. 20190118:06:14:25:031521 gptransfer:mdw:gpadmin-[INFO]:-Validating source host map... 20190118:06:14:25:031521 gptransfer:mdw:gpadmin-[INFO]:-Validating transfer table set... 20190118:06:14:25:031521 gptransfer:mdw:gpadmin-[INFO]:-The following tables on the destination system will be truncated: 20190118:06:14:25:031521 gptransfer:mdw:gpadmin-[INFO]:-   big_db.public.test_table_2 20190118:06:14:25:031521 gptransfer:mdw:gpadmin-[INFO]:-   big_db.public.test_table_3 20190118:06:14:25:031521 gptransfer:mdw:gpadmin-[INFO]:-   big_db.public.test_table_4 20190118:06:14:25:031521 gptransfer:mdw:gpadmin-[INFO]:-   big_db.public.test_table_5 20190118:06:14:25:031521 gptransfer:mdw:gpadmin-[INFO]:-   big_db.public.test_table_6 20190118:06:14:25:031521 gptransfer:mdw:gpadmin-[INFO]:-   big_db.public.test_table_7 20190118:06:14:25:031521 gptransfer:mdw:gpadmin-[INFO]:-   big_db.public.test_table_8 20190118:06:14:25:031521 gptransfer:mdw:gpadmin-[INFO]:-   big_db.public.test_table_9 20190118:06:14:25:031521 gptransfer:mdw:gpadmin-[INFO]:-   big_db.public.test_table_10 20190118:06:14:25:031521 gptransfer:mdw:gpadmin-[INFO]:-   big_db.public.test_table_11 … 20190118:06:14:34:031521 gptransfer:mdw:gpadmin-[INFO]:-Using batch size of 10 20190118:06:14:34:031521 gptransfer:mdw:gpadmin-[INFO]:-Using sub-batch size of 16 20190118:06:14:34:031521 gptransfer:mdw:gpadmin-[INFO]:-Creating work directory '/home/gpadmin/gptransfer_31521' 20190118:06:14:34:031521 gptransfer:mdw:gpadmin-[INFO]:-Creating schema public in database edw_prod... 20190118:06:14:40:031521 gptransfer:mdw:gpadmin-[INFO]:-Starting transfer of big_db.public.test_table_5 to big_db.public.test_table_5... … 20190118:06:15:02:031521 gptransfer:mdw:gpadmin-[INFO]:-Validation of big_db.public.test_table_4 successful 20190118:06:15:02:031521 gptransfer:mdw:gpadmin-[INFO]:-Removing work directories... 20190118:06:15:02:031521 gptransfer:mdw:gpadmin-[INFO]:-Finished.</code> </pre> <br>  Akibatnya, transfer 10 tabel kosong membutuhkan waktu sekitar 16 detik (14: 40-15: 02), yaitu, satu meja - 1,6 detik.  Selama ini, dalam kasus kami, sekitar 100 MB data dapat diunduh menggunakan pg_dump &amp; psql. <br><br><h3>  gp_dump &amp; gp_restore </h3><br>  Sebagai opsi: gunakan add-on di atasnya, gpcrondump &amp; gpdbrestore, karena gp_dump &amp; gp_restore dinyatakan usang.  Meskipun gpcrondump &amp; gpdbrestore sendiri menggunakan gp_dump &amp; gp_restore dalam prosesnya.  Ini adalah cara yang paling universal, tetapi bukan yang tercepat.  File cadangan yang dibuat dengan gp_dump mewakili seperangkat perintah DDL pada master node, dan pada segmen primer, terutama set perintah dan data COPY.  Cocok untuk kasus-kasus ketika tidak mungkin untuk memberikan operasi simultan dari cluster tujuan dan cluster sumber.  Ada keduanya di Greenplum versi lama, dan di yang baru: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">gp_dump</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">gp_restore</a> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/141/1b7/8e8/1411b78e893176ef21de383e78c0b87f.png"><br><br><h3>  Utilitas Gpbackup &amp; gprestore </h3><br>  Dibuat sebagai pengganti gp_dump &amp; gp_restore.  Untuk pekerjaan mereka, versi Greenplum minimum 4.3.17 diperlukan ( <a href="">const MINIMUM_GPDB4_VERSION = "4.3.17"</a> ).  Skema kerjanya mirip dengan gpbackup &amp; gprestore, sementara kecepatan kerjanya jauh lebih cepat.  Cara tercepat untuk mendapatkan perintah DDL untuk basis data besar.  Secara default, ini mentransfer objek global, untuk pemulihan Anda perlu menentukan "gprestore --with-global".  Parameter opsional “--jobs” dapat mengatur jumlah pekerjaan (dan sesi ke basis data) saat membuat cadangan.  Karena beberapa sesi dibuat, penting untuk memastikan konsistensi data sampai semua kunci diterima.  Ada juga opsi yang berguna "--with-stats", yang memungkinkan Anda untuk mentransfer statistik pada objek yang digunakan untuk membangun rencana eksekusi.  Informasi lebih lanjut di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> . <br><br><h3>  Utilitas gpcopy </h3><br>  Untuk menyalin basis data ada gpcopy utilitas - pengganti gptansfer.  Tetapi itu hanya termasuk dalam versi eksklusif Greenplum dari Pivotal, mulai dari 4.3.26 - dalam versi open source <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">, utilitas ini tidak</a> .  Dalam operasi, gugus sumber mengeksekusi perintah COPY source_table TO PROGRAM 'gpcopy_helper ...' ON SEGMENT CSV MENGGABUNGKAN PARTISI EKSTERNAL.  Di sisi gugus penerima, tabel eksternal sementara MENCIPTAKAN TEMPAT TEMPAT WEB EKSTERNAL external_temp_table (LIKE target_table) EXECUTE '... gpcopy_helper –listen ...' dibuat dan INSERT INTO target_table SELECT * DARI perintah external_temp_table dieksekusi.  Akibatnya, gpcopy_helper dengan parameter –listen diluncurkan pada setiap segmen dari cluster tujuan, yang menerima data dari gpcopy_helper dari segmen-segmen dari cluster sumber.  Karena skema transmisi data, serta kompresi, kecepatan transmisi jauh lebih tinggi.  Antar cluster, otentikasi ssh pada sertifikat juga harus dikonfigurasi.  Saya juga ingin mencatat bahwa gpcopy memiliki opsi yang nyaman "--truncate-source-after" (dan "--validate") untuk kasus-kasus di mana cluster sumber dan tujuan berada di server yang sama. <br><br><h2>  Strategi Transfer Data </h2><br>  Untuk menentukan strategi transfer, kita perlu menentukan apa yang lebih penting bagi kita: mentransfer data dengan cepat, tetapi dengan lebih banyak tenaga kerja dan mungkin kurang andal (gpbackup, gptransfer atau kombinasinya) atau dengan sedikit tenaga kerja, tetapi lebih lambat (gpbackup atau gptransfer tanpa menggabungkan). <br><br>  Cara tercepat untuk mentransfer data - ketika ada klaster sumber dan kluster tujuan - berikut ini: <br><br><ul><li>  Dapatkan DDL menggunakan gpbackup --metadata-only, konversi dan muat melalui pipa menggunakan psql <br></li><li>  Hapus indeks <br></li><li>  Transfer tabel dengan ukuran 100 MB atau lebih menggunakan gptransfer <br></li><li>  Transfer tabel dengan ukuran kurang dari 100 MB menggunakan pg_dump |  psql seperti pada paragraf pertama <br></li><li>  Buat kembali indeks yang dihapus <br></li></ul><br>  Metode ini ternyata berada di pengukuran kami setidaknya 2 kali lebih cepat daripada gp_dump &amp; gp_restore.  Metode alternatif: mentransfer semua basis data menggunakan gptransfer –full, gpbackup &amp; gprestore, atau gp_dump &amp; gp_restore. <br><br>  Ukuran tabel dapat diperoleh dengan kueri berikut: <br><br><pre> <code class="plaintext hljs">SELECT nspname AS "schema", coalesce(tablename, relname) AS "name", SUM(pg_total_relation_size(class.oid)) AS "size" FROM pg_class class JOIN pg_namespace namespace ON namespace.oid = class.relnamespace LEFT JOIN pg_partitions parts ON class.relname = parts.partitiontablename AND namespace.nspname = parts.schemaname WHERE nspname NOT IN ('pg_catalog', 'information_schema', 'pg_toast', 'pg_bitmapindex', 'pg_aoseg', 'gp_toolkit') GROUP BY nspname, relkind, coalesce(tablename, relname), pg_get_userbyid(class.relowner) ORDER BY 1,2;</code> </pre><br><br><h3>  Konversi yang diperlukan </h3><br>  File cadangan dalam versi Greenplum 4 dan 5 juga tidak sepenuhnya kompatibel.  Jadi, di Greenplum 5, karena perubahan sintaksis, perintah CREATE EXTERNAL TABLE dan COPY tidak memiliki parameter INTO ERROR TABLE, dan Anda perlu mengatur parameter SET gp_ignore_error_table menjadi true sehingga pemulihan cadangan tidak gagal karena kesalahan.  Dengan set parameter, kita hanya mendapat peringatan. <br><br>  Selain itu, versi kelima memperkenalkan protokol berbeda untuk berinteraksi dengan tabel pxf eksternal, dan untuk menggunakannya, Anda perlu mengubah parameter LOCATION dan mengkonfigurasi layanan pxf. <br>  Perlu dicatat juga bahwa dalam file cadangan gp_dump &amp; gp_restore baik pada master node dan pada setiap segmen primer, parameter SET gp_strict_xml_parse disetel ke false.  Tidak ada parameter seperti itu di Greenplum 5, dan sebagai hasilnya, kami mendapatkan pesan kesalahan. <br><br>  Jika protokol gphdfs digunakan untuk tabel eksternal, Anda perlu memeriksa dalam file cadangan daftar sumber dalam parameter LOCATION untuk tabel eksternal pada baris 'gphdfs: //'.  Sebagai contoh, seharusnya hanya ada 'gphdfs: //hadoop.local: 8020'.  Jika ada baris lain, mereka perlu ditambahkan ke skrip pengganti pada master node dengan analogi. <br><br><pre> <code class="plaintext hljs">grep -o gphdfs\:\/\/.*\/ /data1/master/gpseg-1/db_dumps/20181206/gp_dump_-1_1_20181206122002.gz | cut -d/ -f1-3 | sort | uniq gphdfs://hadoop.local:8020</code> </pre> <br>  Kami membuat penggantian pada node master (menggunakan file data gp_dump sebagai contoh): <br><br><pre> <code class="plaintext hljs">mv /data1/master/gpseg-1/db_dumps/20181206/big_db_gp_dump_1_1_20181206080001.gz /data1/master/gpseg-1/db_dumps/20181206/big_db_gp_dump_1_1_20181206080001.old.gz gunzip -c /data1/master/gpseg-1/db_dumps/20181206/big_db_gp_dump_1_1_20181206080001.old.gz | sed "s#'gphdfs://hadoop.local:8020#'pxf:/#g" | sed "s/\(^.*pxf\:\/\/.*'\)/\1\\&amp;\&amp;\?PROFILE=HdfsTextSimple'/" |sed "s#'&amp;#g" | sed 's/SET gp_strict_xml_parse = false;/SET gp_ignore_error_table = true;/g' | gzip -1 &gt; /data1/master/gpseg-1/db_dumps/20181206/big_db_gp_dump_1_1_20181206080001.gz nets</code> </pre> <br>  Dalam versi terbaru, nama profil HdfsTextSimple <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">dinyatakan usang</a> , nama baru adalah hdfs: teks. <br><br><h2>  Ringkasan </h2><br>  Di luar artikel, kebutuhan tetap untuk konversi eksplisit ke teks ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Pengecoran Teks Implisit</a> ), mekanisme manajemen sumber daya klaster <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Kelompok Sumber Daya</a> baru yang menggantikan Antrian Sumber Daya, pengoptimal <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">GPORCA</a> , yang disertakan secara default di Greenplum 5, masalah kecil dengan klien. <br><br>  Saya menantikan rilis versi keenam dari Greenplum, yang dijadwalkan untuk musim semi 2019: tingkat kompatibilitas dengan PostgreSQL 9.4, Pencarian Teks Lengkap, Dukungan Indeks GIN, Jenis Rentang, JSONB, Kompresi zStd.  Juga, rencana awal untuk Greenplum 7 menjadi dikenal: tingkat kompatibilitas dengan PostgreSQL minimum 9,6, Keamanan Tingkat Baris, Failover Master Otomatis.  Pengembang juga menjanjikan ketersediaan utilitas pemutakhiran basis data untuk memperbarui antara versi utama, sehingga akan lebih mudah untuk digunakan. <br><br>  <i>Artikel ini disiapkan oleh tim manajemen data Rostelecom</i> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id439876/">https://habr.com/ru/post/id439876/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id439864/index.html">Manajemen pengetahuan, mengapa dan bagaimana kami melakukannya</a></li>
<li><a href="../id439866/index.html">Prinsip-prinsip merancang direktori tata nama dalam 1C Enterprise Management 2 (ERP 2.4.6)</a></li>
<li><a href="../id439868/index.html">Hidup tanpa Facebook: pandangan yang kurang radikal, suasana hati yang baik, lebih banyak waktu untuk orang yang dicintai. Sekarang dibuktikan oleh sains</a></li>
<li><a href="../id439870/index.html">Video sebagai mesin kemajuan: evolusi sistem pengawasan</a></li>
<li><a href="../id439874/index.html">Efek penyaringan SVG. Bagian 3. Efek posterisasi gambar menggunakan feComponentTransfer</a></li>
<li><a href="../id439878/index.html">Menciptakan arsitektur untuk startup baru yang sarat muatan pada tahun 2019</a></li>
<li><a href="../id439880/index.html">Minggu Keamanan 07: kerentanan lokal perangkat IoT</a></li>
<li><a href="../id439882/index.html">Petualangan dengan ptrace (2)</a></li>
<li><a href="../id439884/index.html">Bagaimana menolak buletin yang tidak perlu dengan satu tombol. Pengalaman Tim Yandex.Mail</a></li>
<li><a href="../id439886/index.html">Bagaimana saya mengajar jaringan saraf untuk mengimplementasikan fungsi penilaian posisi di Russian AI Cup CodeBall 2018</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>