<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>âœğŸ¾ ğŸ’¥ ğŸ‘„ åœ¨å¾®æ§åˆ¶å™¨çš„C ++ä¸­ä½¿ç”¨å¼•è„šåˆ—è¡¨ï¼ˆä»¥CortexMä¸ºä¾‹ï¼‰ âœ”ï¸ ğŸ‘¥ ğŸ¤¦ğŸ½</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="å¤§å®¶èº«ä½“å¥åº·ï¼ 


 åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ç­”åº”è¿‡å†™æœ‰å…³å¦‚ä½•ä½¿ç”¨ç«¯å£åˆ—è¡¨çš„æ–‡ç« ã€‚ 
 æˆ‘å¿…é¡»é©¬ä¸Šè¯´ï¼Œä¸€åˆ‡éƒ½å·²ç»åœ¨2010å¹´å†³å®šäº†ï¼Œè¿™æ˜¯æ–‡ç« ï¼š ä½¿ç”¨C ++ä¸­çš„å¾®æ§åˆ¶å™¨çš„è¾“å…¥/è¾“å‡ºç«¯å£ ã€‚ 2010å¹´å†™è¿™ç¯‡æ–‡ç« çš„äººç®€ç›´æ˜¯å¸…æ°”ã€‚ 


 æˆ‘ä¼šå°´å°¬çš„æ˜¯æˆ‘ä¼šåš10å¹´å‰å·²ç»åšè¿‡çš„äº‹æƒ…ï¼Œæ‰€ä»¥æˆ‘å†³å®šä¸ç­‰2020å¹´ï¼Œ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>åœ¨å¾®æ§åˆ¶å™¨çš„C ++ä¸­ä½¿ç”¨å¼•è„šåˆ—è¡¨ï¼ˆä»¥CortexMä¸ºä¾‹ï¼‰</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/474732/"><p><img src="https://habrastorage.org/webt/al/fo/qs/alfoqsca21zydklcnzomwtqdgwe.png"></p><br><p> å¤§å®¶èº«ä½“å¥åº·ï¼ </p><br><p> åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ç­”åº”è¿‡å†™æœ‰å…³å¦‚ä½•ä½¿ç”¨ç«¯å£åˆ—è¡¨çš„æ–‡ç« ã€‚ <br> æˆ‘å¿…é¡»é©¬ä¸Šè¯´ï¼Œä¸€åˆ‡éƒ½å·²ç»åœ¨2010å¹´å†³å®šäº†ï¼Œè¿™æ˜¯æ–‡ç« ï¼š <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">ä½¿ç”¨C ++ä¸­çš„å¾®æ§åˆ¶å™¨çš„è¾“å…¥/è¾“å‡ºç«¯å£</a> ã€‚  2010å¹´å†™è¿™ç¯‡æ–‡ç« çš„äººç®€ç›´æ˜¯å¸…æ°”ã€‚ </p><br><p> æˆ‘ä¼šå°´å°¬çš„æ˜¯æˆ‘ä¼šåš10å¹´å‰å·²ç»åšè¿‡çš„äº‹æƒ…ï¼Œæ‰€ä»¥æˆ‘å†³å®šä¸ç­‰2020å¹´ï¼Œè€Œè¦åœ¨2019å¹´åšè¿™ä»¶äº‹ä»¥ä¾¿é‡å¤9å¹´å‰çš„å†³å®šï¼Œè¿™ä¸ä¼šé‚£ä¹ˆæ„šè ¢ã€‚ </p><br><p>åœ¨ä¸Šé¢çš„æ–‡ç« ä¸­ï¼Œä½¿ç”¨æ›´å¤šç±»å‹çš„æ¨¡æ¿å…·æœ‰å›ºå®šæ•°é‡çš„å‚æ•°ï¼Œè€Œå‡½æ•°ä¸èƒ½æ˜¯constexprè¡¨è¾¾å¼æ—¶ï¼Œä½¿ç”¨C ++ 03å®Œæˆäº†ç±»å‹åˆ—è¡¨çš„å·¥ä½œã€‚ ä»é‚£ä»¥åï¼ŒC ++å‘ç”Ÿäº†ä¸€äº›å˜åŒ–ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬å°è¯•åšåŒæ ·çš„äº‹æƒ…ï¼Œä½†æ˜¯åœ¨C ++ 17ä¸­ã€‚ æ¬¢è¿æ¥åˆ°çŒ«ï¼š </p><a name="habracut"></a><br><h2 id="zadacha"> æŒ‘æˆ˜èµ› </h2><br><p> å› æ­¤ï¼Œä»»åŠ¡æ˜¯ä¸€æ¬¡å®‰è£…æˆ–ä¸¢å¼ƒå¤šä¸ªå¤„ç†å™¨å¼•è„šï¼Œè¿™äº›å¼•è„šç»„åˆåœ¨ä¸€èµ·ã€‚ å°½ç®¡å¦‚æ­¤ï¼Œå¼•è„šä»å¯ä»¥ä½äºä¸åŒçš„ç«¯å£ä¸Šï¼Œè¿™ç§æ“ä½œåº”å°½å¯èƒ½é«˜æ•ˆåœ°å®Œæˆã€‚ </p><br><p> å®é™…ä¸Šï¼Œæˆ‘ä»¬è¦æ‰§è¡Œçš„æ“ä½œå¯ä»¥é€šè¿‡ä»¥ä¸‹ä»£ç æ˜¾ç¤ºï¼š </p><br><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Pin1 = Pin&lt;GPIO, <span class="hljs-number"><span class="hljs-number">1</span></span>&gt;; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Pin2 = Pin&lt;GPIOB, <span class="hljs-number"><span class="hljs-number">1</span></span>&gt;; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Pin3 = Pin&lt;GPIOA, <span class="hljs-number"><span class="hljs-number">1</span></span>&gt;; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Pin4 = Pin&lt;GPIOC, <span class="hljs-number"><span class="hljs-number">2</span></span>&gt;; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Pin5 = Pin&lt;GPIOA, <span class="hljs-number"><span class="hljs-number">3</span></span>&gt;; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//    Pin    : //   GPIOA  10 GPIOA-&gt;BSRR = 10 ; // (1&lt;&lt;1) | (1 &lt;&lt; 3) ; //   GPIOB  2 GPIOB-&gt;BSRR = 2 ; // (1 &lt;&lt; 1) //   GPIOC  6 GPIOB-&gt;BSRR = 6 ; // (1 &lt;&lt; 1) | (1 &lt;&lt; 2); PinsPack&lt;Pin1, Pin2, Pin3, Pin4, Pin5&gt;::Set() ; return 0; }</span></span></code> </pre> <br><div class="spoiler">  <b class="spoiler_title">å…³äºBSRRå¯„å­˜å™¨</b> <div class="spoiler_text"><p> å¯¹äºé‚£äº›ä¸äº†è§£å¾®æ§åˆ¶å™¨äº‹åŠ¡çš„äººï¼Œ <code>GPIOA-&gt;BSRR</code>å¯„å­˜å™¨è´Ÿè´£å¾®æ§åˆ¶å™¨<code>GPIOA-&gt;BSRR</code>çš„åŸå­å®‰è£…æˆ–å€¼é‡ç½®ã€‚ è¯¥å¯„å­˜å™¨ä¸º32ä½ã€‚ å‰16ä½è´Ÿè´£å°†è…¿è®¾ç½®ä¸º1ï¼Œå16ä½è´Ÿè´£å°†è…¿è®¾ç½®ä¸º0ã€‚ </p><br><p> ä¾‹å¦‚ï¼Œè¦å°†æ•°å­—3è„šè®¾ç½®ä¸º1ï¼Œéœ€è¦å°†<code>BSRR</code>å¯„å­˜å™¨ä¸­çš„ç¬¬ä¸‰ä¸ªä½è®¾ç½®ä¸º1ï¼›è¦å°†æ•°å­—3è„šå¤ä½ä¸º0ï¼Œéœ€è¦å°†åŒä¸€<code>BSRR</code>å¯„å­˜å™¨ä¸­çš„19ä½è®¾ç½®ä¸º1ã€‚ </p></div></div><br><p> è§£å†³æ­¤é—®é¢˜çš„é€šç”¨æ­¥éª¤æ–¹æ¡ˆå¯ä»¥è¡¨ç¤ºå¦‚ä¸‹ï¼š </p><br><p><img src="https://habrastorage.org/webt/xl/zu/wm/xlzuwmbfoudvd9tf6jwlh-ih-vs.png"></p><br><p> å¥½å§ï¼Œæ¢å¥è¯è¯´ï¼š </p><br><p>  <em>ä¸ºäº†è®©ç¼–è¯‘å™¨ä¸ºæˆ‘ä»¬åšï¼š</em> </p><br><ul><li> éªŒè¯åˆ—è¡¨ä»…åŒ…å«å”¯ä¸€çš„å¼•è„š </li><li> é€šè¿‡ç¡®å®šå¼•è„šæ‰€åœ¨çš„ç«¯å£æ¥åˆ›å»ºç«¯å£åˆ—è¡¨ï¼Œ </li><li> è®¡ç®—è¦æ”¾å…¥æ¯ä¸ªç«¯å£çš„å€¼ </li></ul><br><p>  <em>ç„¶åç¨‹åº</em> </p><br><ul><li> è®¾å®šè¿™ä¸ªå€¼ </li></ul><br><p> æ‚¨éœ€è¦å°½å¯èƒ½é«˜æ•ˆåœ°æ‰§è¡Œæ­¤æ“ä½œï¼Œä»¥ä¾¿å³ä½¿ä¸è¿›è¡Œä¼˜åŒ–ï¼Œä»£ç ä¹Ÿæœ€å°‘ã€‚ å®é™…ä¸Šï¼Œè¿™æ˜¯æ•´ä¸ªä»»åŠ¡ã€‚ </p><br><p> è®©æˆ‘ä»¬ä»ç¬¬ä¸€ç§æ—¶å°šå¼€å§‹ï¼šéªŒè¯åˆ—è¡¨åŒ…å«å”¯ä¸€çš„Pinã€‚ </p><br><h2 id="proverka-spiska-na-unikalnost"> æ£€æŸ¥åˆ—è¡¨çš„å”¯ä¸€æ€§ </h2><br><p> è®©æˆ‘æé†’æ‚¨ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªå¼•è„šåˆ—è¡¨ï¼š </p><br><pre> <code class="cpp hljs">PinsPack&lt;Pin1, Pin2, Pin3, Pin4, Pin5&gt; ;</code> </pre> <br><p><del> æ— æ„é—´ </del> å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ï¼š </p><br><pre> <code class="cpp hljs">PinsPack&lt;Pin1, Pin2, Pin3, Pin4, Pin1&gt; ; <span class="hljs-comment"><span class="hljs-comment">//     Pin1</span></span></code> </pre> <br><p> æˆ‘å¸Œæœ›ç¼–è¯‘å™¨å‘ç°è¿™æ ·çš„é”™è¯¯å¹¶é€šçŸ¥é’¢ç´å®¶ã€‚ </p><br><p> æˆ‘ä»¬å°†æ£€æŸ¥åˆ—è¡¨çš„å”¯ä¸€æ€§ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š </p><br><ul><li> åœ¨æºåˆ—è¡¨ä¸­ï¼Œåˆ›å»ºä¸€ä¸ªæ²¡æœ‰é‡å¤çš„æ–°åˆ—è¡¨ï¼Œ </li><li> å¦‚æœæºåˆ—è¡¨çš„ç±»å‹å’Œæ²¡æœ‰é‡å¤çš„åˆ—è¡¨çš„ç±»å‹ä¸åŒ¹é…ï¼Œåˆ™è¯´æ˜æºåˆ—è¡¨ä¸­çš„Pinç›¸åŒï¼Œå› æ­¤ç¨‹åºå‘˜çŠ¯äº†ä¸€ä¸ªé”™è¯¯ã€‚ </li><li> å¦‚æœå®ƒä»¬åŒ¹é…ï¼Œé‚£ä¹ˆä¸€åˆ‡éƒ½å¾ˆå¥½ï¼Œæ²¡æœ‰é‡å¤é¡¹ã€‚ </li></ul><br><p> ä¸ºäº†åˆ›å»ºä¸€ä¸ªæ²¡æœ‰é‡å¤é¡¹çš„æ–°åˆ—è¡¨ï¼Œä¸€ä½åŒäº‹å»ºè®®ä¸è¦é‡æ–°å‘æ˜è½®å­ï¼Œè€Œæ˜¯ä»Lokiåº“ä¸­é‡‡ç”¨è¿™ç§æ–¹æ³•ã€‚ æˆ‘æœ‰è¿™ç§æ–¹æ³•å¹¶å·äº†ã€‚ ä¸2010å¹´å‡ ä¹ç›¸åŒï¼Œä½†å‚æ•°æ•°é‡å¯å˜ã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">ä»åŒäº‹é‚£é‡Œå€Ÿæ¥çš„ä»£ç ï¼Œè¯¥åŒäº‹ä»Lokié‚£é‡Œå€Ÿäº†è¿™ä¸ªæƒ³æ³•</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> PinHelper { <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> ... Types&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Collection</span></span></span><span class="hljs-class"> {</span></span> }; <span class="hljs-comment"><span class="hljs-comment">/////////////////   NoDuplicates   LOKI //////////////// template&lt;class X, class Y&gt; struct Glue; template&lt;class T, class... Ts&gt; struct Glue&lt;T, Collection&lt;Ts...&gt;&gt; { using Result = Collection&lt;T, Ts...&gt;; }; template&lt;class Q, class X&gt; struct Erase; template&lt;class Q&gt; struct Erase&lt;Q, Collection&lt;&gt;&gt; { using Result = Collection&lt;&gt;;}; template&lt;class Q, class... Tail&gt; struct Erase&lt;Q, Collection&lt;Q, Tail...&gt;&gt; { using Result = Collection&lt;Tail...&gt;;}; template&lt;class Q, class T, class... Tail&gt; struct Erase&lt;Q, Collection&lt;T, Tail...&gt;&gt; { using Result = typename Glue&lt;T, typename Erase&lt;Q, Collection&lt;Tail...&gt;&gt;::Result&gt;::Result;}; template &lt;class X&gt; struct NoDuplicates; template &lt;&gt; struct NoDuplicates&lt;Collection&lt;&gt;&gt; { using Result = Collection&lt;&gt;; }; template &lt;class T, class... Tail&gt; struct NoDuplicates&lt; Collection&lt;T, Tail...&gt; &gt; { private: using L1 = typename NoDuplicates&lt;Collection&lt;Tail...&gt;&gt;::Result; using L2 = typename Erase&lt;T,L1&gt;::Result; public: using Result = typename Glue&lt;T, L2&gt;::Result; }; ///////////////// LOKI //////////////// }</span></span></code> </pre> </div></div><br><p> ç°åœ¨å¦‚ä½•ä½¿ç”¨ï¼Ÿ æ˜¯çš„ï¼Œè¿™å¾ˆç®€å•ï¼š </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Pin1 = Pin&lt;GPIOC, <span class="hljs-number"><span class="hljs-number">1</span></span>&gt;; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Pin2 = Pin&lt;GPIOB, <span class="hljs-number"><span class="hljs-number">1</span></span>&gt;; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Pin3 = Pin&lt;GPIOA, <span class="hljs-number"><span class="hljs-number">1</span></span>&gt;; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Pin4 = Pin&lt;GPIOC, <span class="hljs-number"><span class="hljs-number">2</span></span>&gt;; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Pin5 = Pin&lt;GPIOA, <span class="hljs-number"><span class="hljs-number">3</span></span>&gt;; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Pin6 = Pin&lt;GPIOC, <span class="hljs-number"><span class="hljs-number">1</span></span>&gt;; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//  Pin1  ,    Pin6      using PinList = Collection&lt;Pin1, Pin2, Pin3, Pin4, Pin1, Pin6&gt; ; using TPins = typename NoDuplicates&lt;PinList&gt;::Result; //  static_assert.        // : Collection&lt;Pin1, Pin2, Pin3, Pin4, Pin1, Pin6&gt; //   : Collection&lt;Pin1, Pin2, Pin3, Pin4&gt; // ,    static_assert(std::is_same&lt;TPins, PinList&gt;::value, ":    ") ; return 0; }</span></span></code> </pre> <br><p> å¥½å§ å¦‚æœæ‚¨ä¸æ­£ç¡®åœ°è®¾ç½®äº†å¼•è„šåˆ—è¡¨ï¼Œå¹¶ä¸”å¶ç„¶åœ¨åˆ—è¡¨ä¸­æŒ‡ç¤ºäº†ä¸¤ä¸ªç›¸åŒçš„å¼•è„šï¼Œåˆ™ç¨‹åºå°†æ— æ³•ç¼–è¯‘ï¼Œå¹¶ä¸”ç¼–è¯‘å™¨å°†ç»™å‡ºé”™è¯¯ï¼šâ€œæ•…éšœï¼šåˆ—è¡¨ä¸­çš„ç›¸åŒå¼•è„šâ€ã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">é¡ºä¾¿è¯´ä¸€å¥ï¼Œè¦ç¡®ä¿ç«¯å£çš„å¼•è„šåˆ—è¡¨æ­£ç¡®ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•ï¼š</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//        // PinsPack&lt;Port&lt;GPIOB, 0&gt;, Port&lt;GPIOB, 1&gt; ... Port&lt;GPIOB, 15&gt;&gt; using GpiobPort = typename GeneratePins&lt;15, GPIOB&gt;::type //      using GpioaPort = typename GeneratePins&lt;15, GPIOA&gt;::type int main() { //    :  GPIOA.0  1 Gpioa&lt;0&gt;::Set() ; // GPIOB.1  0 Gpiob&lt;1&gt;::Clear() ; using LcdData = Collection&lt;Gpioa&lt;0&gt;, Gpiob&lt;6&gt;, Gpiob&lt;2&gt;, Gpioa&lt;3&gt;, Gpioc&lt;7&gt;, Gpioa&lt;4&gt;, Gpioc&lt;3&gt;, Gpioc&lt;10&gt;&gt; ; using TPinsLcd = typename NoDuplicates&lt;LcdData&gt;::Result; static_assert(std::is_same&lt;TPinsB, LcdData&gt;::value, ":        LCD") ; // A      LcdData::Write('A'); }</span></span></code> </pre> </div></div><br><p> æˆ‘ä»¬å·²ç»åœ¨è¿™é‡Œå†™äº†å¾ˆå¤šï¼Œä½†æ˜¯åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæ²¡æœ‰ä¸€è¡ŒçœŸæ­£çš„ä»£ç è¿›å…¥å¾®æ§åˆ¶å™¨ã€‚ å¦‚æœæ‰€æœ‰å¼•è„šéƒ½æ­£ç¡®è®¾ç½®ï¼Œåˆ™å›ºä»¶ç¨‹åºå¦‚ä¸‹æ‰€ç¤ºï¼š </p><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> ; }</code> </pre> <br><p> è®©æˆ‘ä»¬æ·»åŠ ä¸€äº›ä»£ç ï¼Œå¹¶å°è¯•ä½¿ç”¨<code>Set()</code>æ–¹æ³•æ¥è®¾ç½®åˆ—è¡¨ä¸­çš„å¼•è„šã€‚ </p><br><h2 id="metod-ustanovki-pinov-v-porte"> ç«¯å£å¼•è„šå®‰è£…æ–¹æ³• </h2><br><p> è®©æˆ‘ä»¬ç»§ç»­è¿›è¡Œåˆ°ä»»åŠ¡çš„æœ€åã€‚ æœ€ç»ˆï¼Œæœ‰å¿…è¦å®ç°<code>Set()</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å°†æ ¹æ®åˆ—è¡¨ä¸­çš„Pinè‡ªåŠ¨ç¡®å®šåº”å°†å“ªä¸ªå€¼å®‰è£…åˆ°å“ªä¸ªç«¯å£ã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">æˆ‘ä»¬æƒ³è¦çš„ä»£ç </b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Pin1 = Pin&lt;GPIOA, <span class="hljs-number"><span class="hljs-number">1</span></span>&gt;; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Pin2 = Pin&lt;GPIOB, <span class="hljs-number"><span class="hljs-number">2</span></span>&gt;; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Pin3 = Pin&lt;GPIOA, <span class="hljs-number"><span class="hljs-number">2</span></span>&gt;; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Pin4 = Pin&lt;GPIOC, <span class="hljs-number"><span class="hljs-number">1</span></span>&gt;; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Pin5 = Pin&lt;GPIOA, <span class="hljs-number"><span class="hljs-number">3</span></span>&gt;; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ PinsPack&lt;Pin1, Pin2, Pin3, Pin4, Pin5&gt;::Set() ; <span class="hljs-comment"><span class="hljs-comment">//      3   // GPIOA-&gt;BSRR = 14 ; // (1&lt;&lt;1) | (1 &lt;&lt; 2) | (1 &lt;&lt; 3) ; // GPIOB-&gt;BSRR = 4 ; // (1 &lt;&lt; 2) // GPIOB-&gt;BSRR = 2 ; // (1 &lt;&lt; 1); }</span></span></code> </pre> </div></div><br><p> å› æ­¤ï¼Œæˆ‘ä»¬å£°æ˜ä¸€ä¸ªåŒ…å«Pinsåˆ—è¡¨çš„ç±»ï¼Œå¹¶åœ¨å…¶ä¸­å®šä¹‰å…¬å…±é™æ€æ–¹æ³•<code>Set()</code> ã€‚ </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> ...Ts&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PinsPack</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Pins = PinsPack&lt;Ts...&gt; ; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: __<span class="hljs-function"><span class="hljs-function">forceinline </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Set</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">size_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> mask)</span></span></span><span class="hljs-function"> </span></span>{ } } ;</code> </pre> <br><p> å¦‚æ‚¨æ‰€è§ï¼Œ <code>Set(size_t mask)</code>æ–¹æ³•é‡‡ç”¨æŸç§å€¼ï¼ˆæ©ç ï¼‰ã€‚ æ­¤æ©ç æ˜¯æ‚¨éœ€è¦åœ¨ç«¯å£ä¸­æ”¾å…¥çš„å·ç ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒæ˜¯0xffffffffï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å¸Œæœ›å°†æ‰€æœ‰å¼•è„šæ”¾ç½®åœ¨åˆ—è¡¨ä¸­ï¼ˆæœ€å¤š32ä¸ªï¼‰ã€‚ å¦‚æœåœ¨é‚£é‡Œä¼ é€’å¦ä¸€ä¸ªå€¼ï¼Œä¾‹å¦‚7 == 0b111ï¼Œåˆ™ä»…åº”å®‰è£…åˆ—è¡¨ä¸­çš„å‰3ä¸ªå¼•è„šï¼Œä¾æ­¤ç±»æ¨ã€‚ å³ è’™ç‰ˆè¦†ç›–åœ¨â€œå¼•è„šâ€åˆ—è¡¨ä¸Šã€‚ </p><br><h2 id="formirovanie-spiska-portov"> æ¸¯å£æ¸…å• </h2><br><p> ä¸ºäº†èƒ½å¤Ÿåœ¨å¼•è„šä¸Šå®‰è£…ä»»ä½•ä¸œè¥¿ï¼Œæ‚¨éœ€è¦çŸ¥é“è¿™äº›å¼•è„šä½äºå“ªä¸ªç«¯å£ä¸Šã€‚ æ¯ä¸ªPinéƒ½ç»‘å®šåˆ°ä¸€ä¸ªç‰¹å®šçš„ç«¯å£ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿™äº›ç«¯å£ä»Pinç±»ä¸­æ‹‰å‡ºå¹¶åˆ›å»ºè¿™äº›ç«¯å£çš„åˆ—è¡¨ã€‚ </p><br><p> æˆ‘ä»¬çš„å¼•è„šåˆ†é…ç»™ä¸åŒçš„ç«¯å£ï¼š </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Pin1 = Pin&lt;Port&lt;GPIOA&gt;, <span class="hljs-number"><span class="hljs-number">1</span></span>&gt;; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Pin2 = Pin&lt;Port&lt;GPIOB&gt;, <span class="hljs-number"><span class="hljs-number">2</span></span>&gt;; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Pin3 = Pin&lt;Port&lt;GPIOA&gt;, <span class="hljs-number"><span class="hljs-number">2</span></span>&gt;; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Pin4 = Pin&lt;Port&lt;GPIOC&gt;, <span class="hljs-number"><span class="hljs-number">1</span></span>&gt;; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Pin5 = Pin&lt;Port&lt;GPIOA&gt;, <span class="hljs-number"><span class="hljs-number">3</span></span>&gt;;</code> </pre> <br><p> è¿™5ä¸ªå¼•è„šåªæœ‰3ä¸ªå”¯ä¸€çš„ç«¯å£ï¼ˆGPIOAï¼ŒGPIOBï¼ŒGPIOCï¼‰ã€‚ å¦‚æœæˆ‘ä»¬å£°æ˜<code>PinsPack&lt;Pin1, Pin2, Pin3, Pin4, Pin5&gt;</code> ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦ä»ä¸­è·å–ä¸‰ä¸ªç«¯å£çš„åˆ—è¡¨ï¼š <code>Collection&lt;Port&lt;GPIOA&gt;, Port&lt;GPIOB&gt;, Port&lt;GPIOC&gt;&gt;</code> </p><br><p>  Pinç±»åŒ…å«ç«¯å£çš„ç±»å‹ï¼Œå…¶ç®€åŒ–å½¢å¼å¦‚ä¸‹æ‰€ç¤ºï¼š </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Port, <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> pinNum&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Pin</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> PortType = Port ; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">constexpr</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> pin = pinNum ; ... }</code> </pre> <br><p> æ­¤å¤–ï¼Œæ‚¨ä»ç„¶éœ€è¦ä¸ºæ­¤åˆ—è¡¨å®šä¹‰ä¸€ä¸ªç»“æ„ï¼Œå®ƒåªæ˜¯ä¸€ä¸ªæ¨¡æ¿ç»“æ„ï¼Œéœ€è¦ä½¿ç”¨å¯å˜æ•°é‡çš„æ¨¡æ¿å‚æ•° </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span>... Types&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Collection</span></span></span><span class="hljs-class">{</span></span>} ;</code> </pre> <br><p> ç°åœ¨ï¼Œæˆ‘ä»¬å®šä¹‰å”¯ä¸€ç«¯å£åˆ—è¡¨ï¼ŒåŒæ—¶æ£€æŸ¥å¼•è„šåˆ—è¡¨ä¸­æ˜¯å¦ä¸åŒ…å«ç›¸åŒçš„å¼•è„šã€‚ è¿™å¾ˆå®¹æ˜“åšåˆ°ï¼š </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> ...Ts&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PinsPack</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Pins = PinsPack&lt;Ts...&gt; ; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-comment"><span class="hljs-comment">//      using TPins = typename NoDuplicates&lt;Collection&lt;Ts...&gt;&gt;::Result; //           static_assert(std::is_same&lt;TPins, Collection&lt;Ts...&gt;&gt;::value, ":    ") ; //     using Ports = typename NoDuplicates&lt;Collection&lt;typename Ts::PortType...&gt;&gt;::Result; ... } ;</span></span></code> </pre> <br><p> ç»§ç»­... </p><br><h2 id="obhod-spiska-portov"> ç«¯å£åˆ—è¡¨ç»•è¿‡ </h2><br><p> æ”¶åˆ°ç«¯å£åˆ—è¡¨åï¼Œç°åœ¨æ‚¨éœ€è¦ç»•è¿‡å®ƒï¼Œå¹¶å¯¹æ¯ä¸ªç«¯å£è¿›è¡Œæ“ä½œã€‚ ç”¨ç®€åŒ–çš„å½¢å¼ï¼Œå¯ä»¥è¯´æˆ‘ä»¬å¿…é¡»å£°æ˜ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°å°†åœ¨è¾“å…¥ç«¯æ¥æ”¶ç«¯å£åˆ—è¡¨å’Œå¼•è„šåˆ—è¡¨çš„æ©ç ã€‚ </p><br><p> ç”±äºæˆ‘ä»¬å¿…é¡»ç»•è¿‡ä¸€ä¸ªå¤§å°ä¸ç¡®å®šçš„åˆ—è¡¨ï¼Œå› æ­¤è¯¥å‡½æ•°å°†æ˜¯å¸¦æœ‰å¯å˜æ•°é‡å‚æ•°çš„æ¨¡æ¿ã€‚ </p><br><p> å½“æ¨¡æ¿ä¸­ä»ç„¶æœ‰å‚æ•°æ—¶ï¼Œæˆ‘ä»¬å°†â€œé€’å½’â€å¤„ç†ï¼Œæˆ‘ä»¬å°†è°ƒç”¨å…·æœ‰ç›¸åŒåç§°çš„å‡½æ•°ã€‚ </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> ...Ts&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PinsPack</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Pins = PinsPack&lt;Ts...&gt; ; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: __forceinline <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Port, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> ...Ports&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">constexpr</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetPorts</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Collection&lt;Port, Ports...&gt;, </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">size_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> mask)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// ,       if constexpr (sizeof ...(Ports) != 0U) { Pins::template WritePorts&lt;Ports...&gt;(Collection&lt;Ports...&gt;(), mask) ; } } }</span></span></code> </pre> <br><p> å› æ­¤ï¼Œæˆ‘ä»¬å­¦ä¹ äº†å¦‚ä½•ç»•è¿‡ç«¯å£åˆ—è¡¨ï¼Œä½†æ˜¯é™¤äº†ç»•è¿‡ç«¯å£ä¹‹å¤–ï¼Œè¿˜éœ€è¦åšä¸€äº›æœ‰ç”¨çš„å·¥ä½œï¼Œå³åœ¨ç«¯å£ä¸­å®‰è£…ä¸€äº›ä¸œè¥¿ã€‚ </p><br><pre> <code class="cpp hljs">__forceinline <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Port, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> ...Ports&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">constexpr</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetPorts</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Collection&lt;Port, Ports...&gt;, </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">size_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> mask)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//      auto result = GetPortValue&lt;Port&gt;(mask) ; //      Port::Set(result) ; if constexpr (sizeof ...(Ports) != 0U) { Pins::template WritePorts&lt;Ports...&gt;(Collection&lt;Ports...&gt;(), mask) ; } }</span></span></code> </pre> <br><p> ç”±äº<code>mask</code>å‚æ•°æ˜¯ä»å¤–éƒ¨ä¼ é€’ç»™å‡½æ•°çš„ï¼Œå› æ­¤è¯¥æ–¹æ³•å°†åœ¨è¿è¡Œæ—¶æ‰§è¡Œã€‚ ç”±äºä¸èƒ½ä¿è¯å°†å¸¸é‡ä¼ é€’ç»™<code>SetPorts()</code>æ–¹æ³•ï¼Œå› æ­¤<code>GetValue()</code>æ–¹æ³•ä¹Ÿå°†åœ¨è¿è¡Œæ—¶å¼€å§‹æ‰§è¡Œã€‚ </p><br><p> è€Œä¸”ï¼Œå°½ç®¡<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">åœ¨ä½¿ç”¨C ++ä¸­çš„å¾®æ§åˆ¶å™¨çš„è¾“å…¥/è¾“å‡ºç«¯å£</a>çš„æ–‡ç« ä¸­å†™é“ï¼Œä»¥ç±»ä¼¼çš„æ–¹æ³•ï¼Œç¼–è¯‘å™¨ç¡®å®šä¼ é€’äº†ä¸€ä¸ªå¸¸é‡å¹¶åœ¨ç¼–è¯‘é˜¶æ®µè®¡ç®—äº†å†™å…¥ç«¯å£çš„å€¼ï¼Œä½†æˆ‘çš„ç¼–è¯‘å™¨ä»…åœ¨æœ€å¤§ä¼˜åŒ–çš„æƒ…å†µä¸‹æ‰åšäº†è¿™æ ·çš„æŠ€å·§ã€‚ <br> æˆ‘å¸Œæœ›åœ¨ç¼–è¯‘æ—¶ä½¿ç”¨ä»»ä½•ç¼–è¯‘å™¨è®¾ç½®<code>GetValue()</code>æ‰§è¡Œ<code>GetValue()</code> ã€‚ </p><br><p> åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘æ²¡æœ‰åœ¨æ ‡å‡†ä¸­æ‰¾åˆ°ç¼–è¯‘å™¨åº”å¦‚ä½•é¢†å¯¼ç¼–è¯‘å™¨ï¼Œä½†ä»IARç¼–è¯‘å™¨ä»…åœ¨æœ€å¤§ä¼˜åŒ–çº§åˆ«ä¸Šæ‰§è¡Œæ­¤æ“ä½œçš„äº‹å®åˆ¤æ–­ï¼Œå®ƒå¾ˆå¯èƒ½ä¸å—æ ‡å‡†çº¦æŸæˆ–ä¸åº”è¢«è§†ä¸ºconstexprè¡¨è¾¾å¼ã€‚ <br> å¦‚æœæœ‰äººçŸ¥é“ï¼Œè¯·åœ¨è¯„è®ºä¸­å†™ã€‚ </p><br><p> ä¸ºäº†ç¡®ä¿æ˜¾å¼ä¼ é€’å¸¸æ•°ï¼Œæˆ‘ä»¬å°†é€šè¿‡åœ¨æ¨¡æ¿ä¸­ä¼ é€’<code>mask</code>æ¥åˆ›å»ºå…¶ä»–æ–¹æ³•ï¼š </p><br><pre> <code class="cpp hljs">__forceinline <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> mask, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Port, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> ...Ports&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">constexpr</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetPorts</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Collection&lt;Port, Ports...&gt;)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> MyPins = PinsPack&lt;Ts...&gt; ; <span class="hljs-comment"><span class="hljs-comment">//    compile time,    value    constexpr auto result = GetPortValue&lt;Port&gt;(mask) ; Port::Set(result) ; if constexpr (sizeof ...(Ports) != 0U) { MyPins::template SetPorts&lt;mask,Ports...&gt;(Collection&lt;Ports...&gt;()) ; } }</span></span></code> </pre> <br><p> å› æ­¤ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥éå†Pinåˆ—è¡¨ï¼Œä»ä¸­æ‹”å‡ºç«¯å£ï¼Œå¹¶åˆ›å»ºä¸å®ƒä»¬ç»‘å®šçš„å”¯ä¸€ç«¯å£åˆ—è¡¨ï¼Œç„¶åéå†å·²åˆ›å»ºçš„ç«¯å£åˆ—è¡¨å¹¶åœ¨æ¯ä¸ªç«¯å£ä¸­è®¾ç½®æ‰€éœ€çš„<u>å€¼</u> ã€‚ <br> ä»ç„¶<u>éœ€è¦</u>è®¡ç®—è¯¥<u>å€¼</u> ã€‚ </p><br><h2 id="raschet-znacheniya-kotoroe-neobhodimo-ustanovit-v-port"> è®¡ç®—å¿…é¡»åœ¨ç«¯å£ä¸­è®¾ç½®çš„å€¼ </h2><br><p> æˆ‘ä»¬æœ‰ä¸€ä¸ªä»Pinåˆ—è¡¨ä¸­è·å¾—çš„ç«¯å£åˆ—è¡¨ï¼Œåœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼Œè¿™æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼š <code>Collection&lt;Port&lt;GPIOA&gt;, Port&lt;GPIOB&gt;, Port&lt;GPIOC&gt;&gt;</code> ã€‚ <br> æ‚¨éœ€è¦ä½¿ç”¨æ­¤åˆ—è¡¨ä¸­çš„æŸä¸ªå…ƒç´ ï¼Œä¾‹å¦‚GPIOAç«¯å£ï¼Œç„¶ååœ¨â€œå¼•è„šâ€åˆ—è¡¨ä¸­æ‰¾åˆ°è¿æ¥åˆ°è¯¥ç«¯å£çš„æ‰€æœ‰å¼•è„šï¼Œå¹¶è®¡ç®—è¦åœ¨è¯¥ç«¯å£ä¸­å®‰è£…çš„å€¼ã€‚ ç„¶åå¯¹ä¸‹ä¸€ä¸ªç«¯å£æ‰§è¡Œç›¸åŒæ“ä½œã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">å†ä¸€æ¬¡ï¼šåœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæ‚¨éœ€è¦ä»ä¸­è·å¾—å”¯ä¸€ç«¯å£åˆ—è¡¨çš„å¼•è„šåˆ—è¡¨å¦‚ä¸‹ï¼š</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Pin1 = Pin&lt;Port&lt;GPIOC&gt;, <span class="hljs-number"><span class="hljs-number">1</span></span>&gt;; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Pin2 = Pin&lt;Port&lt;GPIOB&gt;, <span class="hljs-number"><span class="hljs-number">1</span></span>&gt;; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Pin3 = Pin&lt;Port&lt;GPIOA&gt;, <span class="hljs-number"><span class="hljs-number">1</span></span>&gt;; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Pin4 = Pin&lt;Port&lt;GPIOC&gt;, <span class="hljs-number"><span class="hljs-number">2</span></span>&gt;; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Pin5 = Pin&lt;Port&lt;GPIOA&gt;, <span class="hljs-number"><span class="hljs-number">3</span></span>&gt;; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Pins = PinsPack&lt;Pin1, Pin2, Pin3, Pin4, Pin5&gt; ;</code> </pre> </div></div><br><p> å› æ­¤ï¼Œå¯¹äºGPIOAç«¯å£ï¼Œè¯¥å€¼åº”ä¸º<code>(1 &lt;&lt; 1 ) | (1 &lt;&lt; 3) = 10</code>  <code>(1 &lt;&lt; 1 ) | (1 &lt;&lt; 3) = 10</code> ï¼Œå¯¹äºGPIOCç«¯å£- <code>(1 &lt;&lt; 1) | (1 &lt;&lt; 2) = 6</code>  <code>(1 &lt;&lt; 1) | (1 &lt;&lt; 2) = 6</code> ï¼Œå¯¹äºGPIOB <code>(1 &lt;&lt; 1 ) = 2</code> </p><br><p> è®¡ç®—åŠŸèƒ½æ¥å—è¯·æ±‚çš„ç«¯å£ï¼Œå¹¶ä¸”å¦‚æœå¼•è„šä¸è¯·æ±‚çš„ç«¯å£ä½äºåŒä¸€ç«¯å£ï¼Œåˆ™å¿…é¡»åœ¨æ©ç ä¸­å°†æ©ç è®¾ç½®ä¸ºä¸åˆ—è¡¨ä¸­å•å…ƒï¼ˆ1ï¼‰ä¸­æ­¤å¼•è„šçš„ä½ç½®ç›¸å¯¹åº”ã€‚ <br> ç”¨è¯­è¨€æ¥è§£é‡Šä¸æ˜¯ä¸€ä»¶å®¹æ˜“çš„äº‹ï¼Œæœ€å¥½æ˜¯ç›´æ¥çœ‹ä¸€ä¸‹ä»£ç ï¼š </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> ...Ts&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PinsPack</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Pins = PinsPack&lt;Ts...&gt; ; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: __forceinline <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">QueryPort</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">constexpr</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">static</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">auto</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GetPortValue</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">std</span></span></span><span class="hljs-class">:</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> mask) { <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> result = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-comment"><span class="hljs-comment">//  ,       // 1. ,        // 2.            // e (.     ), ,  Pin   0  //        10,      //    ( )  (1 &lt;&lt; 10)    // 3.    1   // 4.   1-3      pass{(result |= ((std::is_same&lt;QueryPort, typename Ts::PortType&gt;::value ? 1 : 0) &amp; mask) * (1 &lt;&lt; Ts::pin), mask &gt;&gt;= 1)...} ; return result; } } ;</span></span></code> </pre> <br><h2 id="ustanovka-rasschitannogo-dlya-kazhdogo-porta-znacheniya-v-porty"> å°†æ¯ä¸ªç«¯å£çš„è®¡ç®—å€¼è®¾ç½®ä¸ºç«¯å£ </h2><br><p> ç°åœ¨æˆ‘ä»¬çŸ¥é“äº†éœ€è¦åœ¨æ¯ä¸ªç«¯å£ä¸­è®¾ç½®çš„å€¼ã€‚ ä»ç„¶éœ€è¦å®Œæˆpublic <code>Set()</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å¯¹äºç”¨æˆ·æ˜¯å¯è§çš„ï¼Œå› æ­¤å¯ä»¥å°†æ‰€æœ‰è¿™ç§ç»æµæ€§ç§°ä¸ºï¼š </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> ...Ts&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PinsPack</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Pins = PinsPack&lt;Ts...&gt; ; __<span class="hljs-function"><span class="hljs-function">forceinline </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Set</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">size_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> mask)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//        SetPorts(Ports(), mask) ; } }</span></span></code> </pre> <br><p> ä¸<code>SetPorts()</code>å°†ä½¿ç”¨å…¶ä»–æ¨¡æ¿æ–¹æ³•æ¥ä¿è¯å°†<code>mask</code>ä¼ è¾“ä¸ºå¸¸é‡ï¼Œå¹¶å°†å…¶ä¼ é€’ç»™templateå±æ€§ã€‚ </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> ...Ts&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PinsPack</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Pins = PinsPack&lt;Ts...&gt; ; <span class="hljs-comment"><span class="hljs-comment">//    0xffffffff,      32  __forceinline template&lt;std::size_t mask = 0xffffffffU&gt; static void Set() { SetPorts&lt;mask&gt;(Ports()) ; } }</span></span></code> </pre><br><div class="spoiler">  <b class="spoiler_title">æœ€ç»ˆï¼Œæˆ‘ä»¬çš„Pinåˆ—è¡¨ç±»å¦‚ä¸‹æ‰€ç¤ºï¼š</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> PinHelper ; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> ...Ts&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PinsPack</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Pins = PinsPack&lt;Ts...&gt; ; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> TPins = <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> NoDuplicates&lt;Collection&lt;Ts...&gt;&gt;::Result; <span class="hljs-keyword"><span class="hljs-keyword">static_assert</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::is_same&lt;TPins, Collection&lt;Ts...&gt;&gt;::value, <span class="hljs-string"><span class="hljs-string">":    "</span></span>) ; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Ports = <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> NoDuplicates&lt;Collection&lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Ts::PortType...&gt;&gt;::Result; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Q</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">constexpr</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">static</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">auto</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GetPortValue</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">std</span></span></span><span class="hljs-class">:</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> mask) { <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> result = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> rmask = mask ; pass{(result |= ((<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::is_same&lt;Q, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Ts::PortType&gt;::value ? <span class="hljs-number"><span class="hljs-number">1</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span>) &amp; mask) * (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; Ts::pin), mask&gt;&gt;=<span class="hljs-number"><span class="hljs-number">1</span></span>)...}; pass{(result |= ((<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::is_same&lt;Q, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Ts::PortType&gt;::value ? <span class="hljs-number"><span class="hljs-number">1</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span>) &amp; ~rmask) * ((<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; Ts::pin) &lt;&lt; <span class="hljs-number"><span class="hljs-number">16</span></span>), rmask&gt;&gt;=<span class="hljs-number"><span class="hljs-number">1</span></span>)...}; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } __forceinline <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Port, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> ...Ports&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">constexpr</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetPorts</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Collection&lt;Port, Ports...&gt;, </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">size_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> mask)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> result = GetPortValue&lt;Port&gt;(mask) ; Port::Set(result &amp; <span class="hljs-number"><span class="hljs-number">0xff</span></span>) ; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">if</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">constexpr</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">sizeof</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ...(Ports) != </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0U</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ Pins::<span class="hljs-keyword"><span class="hljs-keyword">template</span></span> SetPorts&lt;Ports...&gt;(Collection&lt;Ports...&gt;(), mask) ; } } __forceinline <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> mask, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Port, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> ...Ports&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">constexpr</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetPorts</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Collection&lt;Port, Ports...&gt;)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constexpr</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> result = GetPortValue&lt;Port&gt;(mask) ; Port::Set(result &amp; <span class="hljs-number"><span class="hljs-number">0xff</span></span>) ; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">if</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">constexpr</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">sizeof</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ...(Ports) != </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0U</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ Pins::<span class="hljs-keyword"><span class="hljs-keyword">template</span></span> SetPorts&lt;mask, Ports...&gt;(Collection&lt;Ports...&gt;()) ; } } __forceinline <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Port, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> ...Ports&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">constexpr</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WritePorts</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Collection&lt;Port, Ports...&gt;, </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">size_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> mask)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> result = GetPortValue&lt;Port&gt;(mask) ; Port::Set(result) ; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">if</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">constexpr</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">sizeof</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ...(Ports) != </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0U</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ Pins::<span class="hljs-keyword"><span class="hljs-keyword">template</span></span> WritePorts&lt;Ports...&gt;(Collection&lt;Ports...&gt;(), mask) ; } } __forceinline <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> mask, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Port, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> ...Ports&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">constexpr</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WritePorts</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Collection&lt;Port, Ports...&gt;)</span></span></span><span class="hljs-function"> </span></span>{ Port::Set(GetPortValue&lt;Port&gt;(mask)) ; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">if</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">constexpr</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">sizeof</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ...(Ports) != </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0U</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ Pins::<span class="hljs-keyword"><span class="hljs-keyword">template</span></span> WritePorts&lt;mask, Ports...&gt;(Collection&lt;Ports...&gt;()) ; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">constexpr</span></span> <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> size = <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span> ...(Ts) + <span class="hljs-number"><span class="hljs-number">1U</span></span> ; __<span class="hljs-function"><span class="hljs-function">forceinline </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Set</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">size_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> mask )</span></span></span><span class="hljs-function"> </span></span>{ SetPorts(Ports(), mask) ; } __forceinline <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> mask = <span class="hljs-number"><span class="hljs-number">0xffffffff</span></span>U&gt; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Set() { SetPorts&lt;mask&gt;(Ports()) ; } __<span class="hljs-function"><span class="hljs-function">forceinline </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Write</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">size_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> mask)</span></span></span><span class="hljs-function"> </span></span>{ WritePorts(Ports(), mask) ; } __forceinline <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> mask = <span class="hljs-number"><span class="hljs-number">0xffffffff</span></span>U&gt; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Write() { WritePorts&lt;mask&gt;(Ports()) ; } } ;</code> </pre></div></div><br><p> ç»“æœï¼Œæ•´ä¸ªäº‹æƒ…å¯ä»¥å¦‚ä¸‹ä½¿ç”¨ï¼š </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Pin1 = Pin&lt;GPIOC, <span class="hljs-number"><span class="hljs-number">1</span></span>&gt;; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Pin2 = Pin&lt;GPIOB, <span class="hljs-number"><span class="hljs-number">1</span></span>&gt;; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Pin3 = Pin&lt;GPIOA, <span class="hljs-number"><span class="hljs-number">1</span></span>&gt;; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Pin4 = Pin&lt;GPIOC, <span class="hljs-number"><span class="hljs-number">2</span></span>&gt;; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Pin5 = Pin&lt;GPIOA, <span class="hljs-number"><span class="hljs-number">3</span></span>&gt;; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Pin6 = Pin&lt;GPIOA, <span class="hljs-number"><span class="hljs-number">5</span></span>&gt;; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Pin7 = Pin&lt;GPIOC, <span class="hljs-number"><span class="hljs-number">7</span></span>&gt;; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Pin8 = Pin&lt;GPIOA, <span class="hljs-number"><span class="hljs-number">3</span></span>&gt;; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//1.   ,     3 ,  : // GPIOA-&gt;BSRR = (1 &lt;&lt; 1) | (1 &lt;&lt; 3) // GPIOB-&gt;BSRR = (1 &lt;&lt; 1) // GPIOC-&gt;BSRR = (1 &lt;&lt; 1) | (1 &lt;&lt; 2) PinsPack&lt;Pin1, Pin2, Pin3, Pin4, Pin5&gt;::Set() ; //   Set&lt;0xffffffffU&gt;() //2.   ,  3 ,  : // GPIOA-&gt;BSRR = (1 &lt;&lt; 1) // GPIOB-&gt;BSRR = (1 &lt;&lt; 1) // GPIOC-&gt;BSRR = (1 &lt;&lt; 1) | (1 &lt;&lt; 2) PinsPack&lt;Pin1, Pin2, Pin3, Pin4, Pin5, Pin6&gt;::Set&lt;7&gt;() ; //3.          , //   someRunTimeValue     ,  //  SetPorts   constexpr    PinsPack&lt;Pin1, Pin2, Pin3, Pin4, Pin5&gt;::Set(someRunTimeValue) ; using LcdData = PinsPack&lt;Pin1, Pin2, Pin3, Pin4, Pin5, Pin6, Pin7, Pin8&gt; ; LcdData::Write('A') ; }</span></span></code> </pre> <br><p> å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°æ›´å®Œæ•´çš„ç¤ºä¾‹ï¼š <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">https://onlinegdb.com/r1eoXQBRH</a> </p><br><h2 id="bystrodeystvie"> æ€§èƒ½è¡¨ç° </h2><br><p> æ‚¨è¿˜è®°å¾—å—ï¼Œæˆ‘ä»¬å¸Œæœ›å°†å‘¼å«è½¬æ¢ä¸º3æ¡çº¿è·¯ï¼Œåˆ†åˆ«è®¾ç½®ä¸ºç«¯å£A 10ï¼Œç«¯å£B-2å’Œç«¯å£C-6 </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Pin1 = Pin&lt;GPIO, <span class="hljs-number"><span class="hljs-number">1</span></span>&gt;; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Pin2 = Pin&lt;GPIOB, <span class="hljs-number"><span class="hljs-number">1</span></span>&gt;; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Pin3 = Pin&lt;GPIOA, <span class="hljs-number"><span class="hljs-number">1</span></span>&gt;; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Pin4 = Pin&lt;GPIOC, <span class="hljs-number"><span class="hljs-number">2</span></span>&gt;; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Pin5 = Pin&lt;GPIOA, <span class="hljs-number"><span class="hljs-number">3</span></span>&gt;; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//    Pin    : //   GPIOA  10 GPIOA-&gt;BSRR = 10 ; // (1&lt;&lt;1) | (1 &lt;&lt; 3) ; //   GPIOB  2 GPIOB-&gt;BSRR = 2 ; // (1 &lt;&lt; 1) //   GPIOC  6 GPIOB-&gt;BSRR = 6 ; // (1 &lt;&lt; 1) | (1 &lt;&lt; 2); PinsPack&lt;Pin1, Pin2, Pin3, Pin4, Pin5&gt;::Set() ; return 0; }</span></span></code> </pre> <br><p> è®©æˆ‘ä»¬çœ‹çœ‹ä¼˜åŒ–å®Œå…¨å…³é—­åå‘ç”Ÿäº†ä»€ä¹ˆã€‚ </p><br><p><img src="https://habrastorage.org/webt/d4/9l/7b/d49l7b_9vzrt8zddhn2u2exuzdy.png"></p><br><p> æˆ‘ä¸ºç«¯å£å€¼ç€è‰²ï¼Œå¹¶è°ƒç”¨ä»¥ç»¿è‰²å°†è¿™äº›å€¼è®¾ç½®ä¸ºç«¯å£ã€‚ å¯ä»¥çœ‹å‡ºï¼Œä¸€åˆ‡éƒ½æŒ‰ç…§æˆ‘ä»¬çš„é¢„æœŸå®Œæˆäº†ï¼Œç¼–è¯‘å™¨ä¸ºæ¯ä¸ªç«¯å£è®¡ç®—äº†è¯¥å€¼ï¼Œå¹¶ç®€å•åœ°è°ƒç”¨äº†å°†è¿™äº›å€¼è®¾ç½®ä¸ºæ‰€éœ€ç«¯å£çš„å‡½æ•°ã€‚ <br> å¦‚æœå®‰è£…å‡½æ•°ä¹Ÿè¢«å†…è”ï¼Œé‚£ä¹ˆæœ€åæˆ‘ä»¬å¾—åˆ°ä¸€ä¸ªè°ƒç”¨ï¼Œå°†å€¼å†™å…¥æ¯ä¸ªç«¯å£çš„BSRRå¯„å­˜å™¨ã€‚ </p><br><p> å…¶å®ä»…æ­¤è€Œå·²ã€‚ è°åœ¨ä¹ï¼Œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">ä»£ç åœ¨è¿™é‡Œ</a> ã€‚ </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">è¿™é‡Œæœ‰ä¸€ä¸ªä¾‹å­</a> ã€‚ </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">https://onlinegdb.com/ByeA50wTS</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN474732/">https://habr.com/ru/post/zh-CN474732/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN474718/index.html">æ±½è½¦ç”µå­å®‰å…¨-ä»ªè¡¨ç›˜æ§åˆ¶å™¨ä¸Šçš„Hello World</a></li>
<li><a href="../zh-CN474720/index.html">ä¸‹è¯ºå¤«å“¥ç½—å¾·æ— çº¿ç”µå®éªŒå®¤å’Œæ´›èˆå¤«çš„â€œ cristadinsâ€</a></li>
<li><a href="../zh-CN474722/index.html">â€œæ²¡æœ‰äººå‘Šè¯‰åˆ«äººä»–ä»¬éœ€è¦åšä»€ä¹ˆâ€ï¼šNicolÃ²Ribaudoå…³äºBabelå¼€å‘ç­‰ç­‰</a></li>
<li><a href="../zh-CN474724/index.html">äº”å¹´åPHPå°†ä¼šå‘ç”Ÿä»€ä¹ˆï¼šæˆ‘ä»¬é—®æœ€è¿‘çš„è«æ–¯ç§‘mitapçš„å‘è¨€äºº</a></li>
<li><a href="../zh-CN474726/index.html">ç”šè‡³å­©å­ä¹Ÿèƒ½ç†è§£ï¼šJavaScriptä¸­å¼‚æ­¥/ç­‰å¾…å’Œæ‰¿è¯ºçš„ç®€å•è¯´æ˜</a></li>
<li><a href="../zh-CN474738/index.html">åœ†è§’æ›²é¢çš„å‡ ä½•å»ºæ¨¡</a></li>
<li><a href="../zh-CN474740/index.html">å±±æ™¯åŸæœ€ä½³è®¡ç®—æœºå†å²åšç‰©é¦†</a></li>
<li><a href="../zh-CN474744/index.html">Uberè¿›å…¥é‡‘èæœåŠ¡å¸‚åœºï¼Œå¹¶å¼€è®¾Uber Moneyéƒ¨é—¨</a></li>
<li><a href="../zh-CN474746/index.html">åå°çš„å¯¹è±¡å­˜å‚¨ï¼Œæˆ–å¦‚ä½•æˆä¸ºè‡ªå·±çš„æœåŠ¡æä¾›å•†</a></li>
<li><a href="../zh-CN474748/index.html">æœåŠ¡å°ç³»ç»ŸåŠå…¶é›†æˆã€‚ å¦‚ä½•è‡ªåŠ¨åŒ–ä¸æ‰¿åŒ…å•†å’Œåˆ¶é€ å•†çš„åˆä½œè¿‡ç¨‹ï¼Ÿ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>