<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ¤³ ğŸ‘¨ğŸ½ ğŸ‡ ReactiveX Redux ğŸ‘Œ âœ‚ï¸ ğŸ‘¦ğŸ½</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ä¸Reduxåˆä½œçš„æ¯ä¸ªäººè¿Ÿæ—©éƒ½ä¼šé‡åˆ°å¼‚æ­¥æ“ä½œçš„é—®é¢˜ã€‚ ä½†æ˜¯æ²¡æœ‰å®ƒä»¬ï¼Œå°±æ— æ³•å¼€å‘ç°ä»£çš„åº”ç”¨ç¨‹åºã€‚ è¿™äº›æ˜¯å¯¹åç«¯çš„httpè¯·æ±‚ï¼Œä»¥åŠå„ç§è®¡æ—¶å™¨/å»¶è¿Ÿã€‚ Reduxçš„åˆ›å»ºè€…æœ¬èº«å°±æ˜ç¡®åœ°è¯´è¿‡-é»˜è®¤æƒ…å†µä¸‹ï¼Œä»…æ”¯æŒåŒæ­¥æ•°æ®æµï¼Œæ‰€æœ‰å¼‚æ­¥æ“ä½œéƒ½å¿…é¡»æ”¾åœ¨ä¸­é—´ä»¶ä¸­ã€‚ 

 å½“ç„¶ï¼Œè¿™å¤ªå†—é•¿å’Œä¸ä¾¿ï¼Œå› æ­¤å¾ˆéš¾æ‰¾åˆ°åªä½¿ç”¨â€œæœ¬æœº...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ReactiveX Redux</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/alfa/blog/460155/"> ä¸Reduxåˆä½œçš„æ¯ä¸ªäººè¿Ÿæ—©éƒ½ä¼šé‡åˆ°å¼‚æ­¥æ“ä½œçš„é—®é¢˜ã€‚ ä½†æ˜¯æ²¡æœ‰å®ƒä»¬ï¼Œå°±æ— æ³•å¼€å‘ç°ä»£çš„åº”ç”¨ç¨‹åºã€‚ è¿™äº›æ˜¯å¯¹åç«¯çš„httpè¯·æ±‚ï¼Œä»¥åŠå„ç§è®¡æ—¶å™¨/å»¶è¿Ÿã€‚  Reduxçš„åˆ›å»ºè€…æœ¬èº«å°±æ˜ç¡®åœ°è¯´è¿‡-é»˜è®¤æƒ…å†µä¸‹ï¼Œä»…æ”¯æŒåŒæ­¥æ•°æ®æµï¼Œæ‰€æœ‰å¼‚æ­¥æ“ä½œéƒ½å¿…é¡»æ”¾åœ¨ä¸­é—´ä»¶ä¸­ã€‚ <br><br> å½“ç„¶ï¼Œè¿™å¤ªå†—é•¿å’Œä¸ä¾¿ï¼Œå› æ­¤å¾ˆéš¾æ‰¾åˆ°åªä½¿ç”¨â€œæœ¬æœºâ€ä¸­é—´ä»¶çš„å¼€å‘äººå‘˜ã€‚ è¯¸å¦‚Thunkï¼ŒSagaç­‰ä¹‹ç±»çš„åº“å’Œæ¡†æ¶æ€»æ˜¯å¯ä»¥å¸®åŠ©æ‚¨ã€‚ <br><br> å¯¹äºå¤§å¤šæ•°ä»»åŠ¡ï¼Œå®ƒä»¬å°±è¶³å¤Ÿäº†ã€‚ ä½†æ˜¯ï¼Œå¦‚æœéœ€è¦æ¯”å‘é€ä¸€ä¸ªè¯·æ±‚æˆ–å‘å‡ºä¸€ä¸ªè®¡æ—¶å™¨æ›´å¤æ‚çš„é€»è¾‘æ€ä¹ˆåŠï¼Ÿ è¿™æ˜¯ä¸€ä¸ªå°ä¾‹å­ï¼š <br><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">async</span></span> dispatch =&gt; { setTimeout(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span> .all([fetchOne, fetchTwo]) .then(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[respOne, respTwo]</span></span></span><span class="hljs-function">) =&gt;</span></span> { dispatch({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'SUCCESS'</span></span>, respOne, respTwo }); }); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (error) { dispatch({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'FAILED'</span></span>, error }); } }, <span class="hljs-number"><span class="hljs-number">2000</span></span>); }</code> </pre> <br> å³ä½¿çœ‹è¿™æ ·çš„ä»£ç ä¹Ÿå¾ˆç—›è‹¦ï¼Œä½†æ˜¯æ ¹æœ¬æ— æ³•ç»´æŠ¤å’Œæ‰©å±•ã€‚ å½“éœ€è¦æ›´å¤æ‚çš„é”™è¯¯å¤„ç†æ—¶è¯¥æ€ä¹ˆåŠï¼Ÿ å¦‚æœæ‚¨éœ€è¦é‡å¤è¯·æ±‚æ€ä¹ˆåŠï¼Ÿ å¦‚æœæˆ‘æƒ³é‡ç”¨æ­¤åŠŸèƒ½ï¼Ÿ <br><br> æˆ‘çš„åå­—å«Dmitry Samokhvalovï¼Œåœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†å‘Šè¯‰æ‚¨Observableæ˜¯ä»€ä¹ˆæ¦‚å¿µï¼Œä»¥åŠå¦‚ä½•ä¸Reduxç»“åˆä½¿ç”¨ï¼Œå¹¶å°†æ‰€æœ‰è¿™äº›ä¸Redux-Sagaçš„åŠŸèƒ½è¿›è¡Œæ¯”è¾ƒã€‚ <br><a name="habracut"></a><br> é€šå¸¸ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¯·ä½¿ç”¨redux-sagaã€‚ å¥½çš„ï¼Œæˆ‘ä»¬é‡å†™sagasï¼š <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> call(delay, <span class="hljs-number"><span class="hljs-number">2000</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [respOne, respTwo] = <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> [ call(fetchOne), call(fetchTwo) ]; <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> put({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'SUCCESS'</span></span>, respOne, respTwo }); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (error) { <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> put({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'FAILED'</span></span>, error }); }</code> </pre><br> å®ƒå·²ç»å˜å¾—æ˜æ˜¾æ›´å¥½-ä»£ç å‡ ä¹æ˜¯çº¿æ€§çš„ï¼Œå¤–è§‚å’Œè¯»å–æ•ˆæœæ›´å¥½ã€‚ ä½†æ˜¯ï¼Œæ‰©å±•å’Œé‡ç”¨ä»ç„¶æ˜¯å›°éš¾çš„ï¼Œå› ä¸ºä¼ å¥‡å’Œé‡å‡»ä¸€æ ·åŠ¿åœ¨å¿…è¡Œã€‚ <br><br> è¿˜æœ‰å¦ä¸€ç§æ–¹æ³•ã€‚ è¿™å°±æ˜¯æ–¹æ³•ï¼Œè€Œä¸ä»…ä»…æ˜¯å¦ä¸€ä¸ªç”¨äºç¼–å†™å¼‚æ­¥ä»£ç çš„åº“ã€‚ å®ƒç§°ä¸ºRxï¼ˆå®ƒä»¬ä¹Ÿæ˜¯Observableï¼ŒReactive Streamsç­‰ï¼‰ã€‚ æˆ‘ä»¬å°†ä½¿ç”¨å®ƒå¹¶åœ¨Observableä¸Šé‡å†™ç¤ºä¾‹ï¼š <br><br><pre> <code class="javascript hljs">action$ .delay(<span class="hljs-number"><span class="hljs-number">2000</span></span>) .switchMap(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> Observable.merge(fetchOne, fetchTwo) .map(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[respOne, respTwo]</span></span></span><span class="hljs-function">) =&gt;</span></span> ({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'SUCCESS'</span></span>, respOne, respTwo })) .catch(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">error</span></span></span><span class="hljs-function"> =&gt;</span></span> ({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'FAILED'</span></span>, error }))</code> </pre> <br> è¯¥ä»£ç ä¸ä»…å˜å¾—å¹³å¦è€Œä¸”æ•°é‡å‡å°‘ï¼Œæè¿°å¼‚æ­¥æ“ä½œçš„åŸç†ä¹Ÿå‘ç”Ÿäº†å˜åŒ–ã€‚ ç°åœ¨ï¼Œæˆ‘ä»¬ä¸ç›´æ¥å¤„ç†æŸ¥è¯¢ï¼Œè€Œæ˜¯å¯¹ç§°ä¸ºObservableçš„ç‰¹æ®Šå¯¹è±¡æ‰§è¡Œæ“ä½œã€‚ <br><br> å°†Observableè¡¨ç¤ºä¸ºç»™å‡ºå€¼æµï¼ˆåºåˆ—ï¼‰çš„å‡½æ•°å¾ˆæ–¹ä¾¿ã€‚ å¯è§‚å¯Ÿå…·æœ‰ä¸‰ä¸ªä¸»è¦çŠ¶æ€-ä¸‹ä¸€ä¸ªï¼ˆâ€œç»™å‡ºä¸‹ä¸€ä¸ªå€¼â€ï¼‰ï¼Œé”™è¯¯ï¼ˆâ€œå‘ç”Ÿé”™è¯¯â€ï¼‰å’Œå®Œæˆï¼ˆâ€œå€¼ç»“æŸï¼Œæ²¡æœ‰å…¶ä»–å¯æä¾›çš„â€ï¼‰ã€‚ åœ¨è¿™æ–¹é¢ï¼Œå®ƒæœ‰ç‚¹åƒPromiseï¼Œä½†æ˜¯ä¸åŒä¹‹å¤„åœ¨äºå¯ä»¥è¿­ä»£è¿™äº›å€¼ï¼ˆè¿™æ˜¯Observableè¶…çº§å¤§å›½ä¹‹ä¸€ï¼‰ã€‚ æ‚¨å¯ä»¥å°†ä»»ä½•å†…å®¹åŒ…è£…åœ¨Observableä¸­-è¶…æ—¶ï¼Œhttpè¯·æ±‚ï¼ŒDOMäº‹ä»¶ï¼Œä»…æ˜¯jså¯¹è±¡ã€‚ <br><br><img src="https://habrastorage.org/webt/be/qu/yr/bequyrg-gjvichysgtzom-c0mju.png" width="540"><br><br> å¯è§‚å¯Ÿåˆ°çš„ç¬¬äºŒä¸ªè¶…çº§å¤§å›½æ˜¯ç®—å­ã€‚ è¿ç®—ç¬¦æ˜¯ä¸€ä¸ªæ¥å—å¹¶è¿”å›Observableçš„å‡½æ•°ï¼Œä½†å¯¹å€¼æµæ‰§è¡ŒæŸäº›æ“ä½œã€‚ æœ€æ¥è¿‘çš„ç±»æ¯”æ˜¯æ¥è‡ªjavascriptçš„åœ°å›¾å’Œè¿‡æ»¤å™¨ï¼ˆé¡ºä¾¿è¯´ä¸€ä¸‹ï¼Œæ­¤ç±»è¿ç®—ç¬¦åœ¨Rxä¸­ï¼‰ã€‚ <br><br><img src="https://habrastorage.org/webt/bu/hi/mc/buhimcdgpjmngscttymdt1rzsqk.png" width="540"><br><br> å°±æˆ‘ä¸ªäººè€Œè¨€ï¼Œæœ€æœ‰ç”¨çš„æ˜¯zipï¼ŒforkJoinå’ŒflatMapè¿ç®—ç¬¦ã€‚ ä½¿ç”¨ä»–ä»¬çš„ç¤ºä¾‹ï¼Œæœ€å®¹æ˜“è§£é‡Šæ“ä½œå‘˜çš„å·¥ä½œã€‚ <br><br>  zipè¿ç®—ç¬¦çš„å·¥ä½œéå¸¸ç®€å•-å®ƒéœ€è¦å‡ ä¸ªObservableï¼ˆä¸è¶…è¿‡9ä¸ªï¼‰ï¼Œå¹¶åœ¨æ•°ç»„ä¸­è¿”å›å®ƒä»¬å‘å‡ºçš„å€¼ã€‚ <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> first = fromEvent(<span class="hljs-string"><span class="hljs-string">"mousedown"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> second = fromEvent(<span class="hljs-string"><span class="hljs-string">"mouseup"</span></span>); zip(first, second) .subscribe(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${e[</span></span><span class="hljs-number"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-number">0</span></span></span></span><span class="hljs-string"><span class="hljs-subst">].x}</span></span></span><span class="hljs-string"> </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${e[</span></span><span class="hljs-number"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-number">1</span></span></span></span><span class="hljs-string"><span class="hljs-subst">].x}</span></span></span><span class="hljs-string">`</span></span>)); <span class="hljs-comment"><span class="hljs-comment">//output [119,120] [120,233] â€¦</span></span></code> </pre><br> é€šå¸¸ï¼Œzipçš„å·¥ä½œå¯ä»¥ç”±ä»¥ä¸‹æ–¹æ¡ˆè¡¨ç¤ºï¼š <br><br><img src="https://habrastorage.org/webt/zu/4j/in/zu4jinxmtwpt4vs3azoy81a6xpc.png" width="540"><br><br> å¦‚æœæ‚¨æœ‰å¤šä¸ªObservableï¼Œå¹¶ä¸”éœ€è¦å§‹ç»ˆå¦‚ä¸€åœ°ä»ä¸­æ¥æ”¶å€¼ï¼Œåˆ™ä½¿ç”¨Zipï¼ˆå°½ç®¡å®ƒä»¬å¯ä»¥ä»¥ä¸åŒçš„é—´éš”ï¼ˆæ— è®ºæ˜¯å¦åŒæ­¥ï¼‰å‘å‡ºï¼‰ã€‚ åœ¨å¤„ç†DOMäº‹ä»¶æ—¶ï¼Œå®ƒéå¸¸æœ‰ç”¨ã€‚ <br><br>  forkJoinè¯­å¥ä¸zipç±»ä¼¼ï¼Œä½†æœ‰ä¸€ä¸ªä¾‹å¤–-å®ƒä»…è¿”å›æ¯ä¸ªObservableä¸­çš„æœ€æ–°å€¼ã€‚ <br><br><img src="https://habrastorage.org/webt/3p/mb/s6/3pmbs6uzqz4w9c3fklfhslw6j6k.png" width="540"><br><br> å› æ­¤ï¼Œå½“ä»…éœ€è¦æµä¸­çš„æœ‰é™å€¼æ—¶ä½¿ç”¨å®ƒæ˜¯åˆç†çš„ã€‚ <br>  flatMapè¿ç®—ç¬¦ç¨å¾®å¤æ‚ä¸€ç‚¹ã€‚ å®ƒä»¥ä¸€ä¸ªObservableä½œä¸ºè¾“å…¥ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°çš„Observableï¼Œå¹¶ä½¿ç”¨é€‰æ‹©å™¨å‡½æ•°æˆ–å¦ä¸€ä¸ªObservableå°†å…¶å€¼æ˜ å°„åˆ°æ–°çš„Observableã€‚ å¬èµ·æ¥ä»¤äººå›°æƒ‘ï¼Œä½†æ˜¯è¯¥å›¾éå¸¸ç®€å•ï¼š <br><br><img src="https://habrastorage.org/webt/kz/7t/fn/kz7tfnjuhklblx5czaxhbs06_mi.png" width="540"><br><br> ä»£ç æ›´æ¸…æ™°ï¼š <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> observable = <span class="hljs-keyword"><span class="hljs-keyword">of</span></span>(<span class="hljs-string"><span class="hljs-string">"Hello"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> promise = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">value</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">resolve</span></span></span><span class="hljs-function"> =&gt;</span></span> resolve(<span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${value}</span></span></span><span class="hljs-string"> World`</span></span>); observable .flatMap(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">value</span></span></span><span class="hljs-function"> =&gt;</span></span> promise(value)) .subscribe(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">result</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(result)); <span class="hljs-comment"><span class="hljs-comment">//output "Hello World"</span></span></code> </pre> <br> é€šå¸¸ï¼ŒflatMapä¸switchMapå’ŒconcatMapä¸€èµ·ç”¨äºåç«¯è¯·æ±‚ä¸­ã€‚ <br> å¦‚ä½•åœ¨Reduxä¸­ä½¿ç”¨Rxï¼Ÿ æœ‰ä¸€ä¸ªå¾ˆæ£’çš„redux-observableåº“ã€‚ å…¶æ¶æ„å¦‚ä¸‹æ‰€ç¤ºï¼š <br><br><img src="https://habrastorage.org/webt/9p/y1/kv/9py1kvsgrpqjaovs3zrukrghbwc.png" width="540"><br><br> æ‰€æœ‰å¯è§‚å¯Ÿçš„è¿ç®—ç¬¦åŠå…¶ä¸Šçš„åŠ¨ä½œå‡ä»¥ç§°ä¸ºepicçš„ç‰¹æ®Šä¸­é—´ä»¶çš„å½¢å¼å®ç°ã€‚ æ¯ä¸ªå²è¯—å°†åŠ¨ä½œä½œä¸ºè¾“å…¥ï¼Œå°†å…¶åŒ…è£…åœ¨Observableä¸­ï¼Œå¹¶åº”å°†åŠ¨ä½œä¹Ÿä½œä¸ºObservableè¿”å›ã€‚ æ‚¨æ— æ³•è¿”å›å¸¸è§„åŠ¨ä½œï¼Œè¿™å°†å¯¼è‡´æ— é™å¾ªç¯ã€‚ è®©æˆ‘ä»¬å†™ä¸€ä¸ªå°å²è¯—ï¼Œå‘apiå‘å‡ºè¯·æ±‚ã€‚ <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> fetchEpic = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">action$</span></span></span><span class="hljs-function"> =&gt;</span></span> action$ .ofType(<span class="hljs-string"><span class="hljs-string">'FETCH_INFO'</span></span>) .map(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> ({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'FETCH_START'</span></span> })) .flatMap(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> Observable .from(apiRequest) .map(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function"> =&gt;</span></span> ({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'FETCH_SUCCESS'</span></span>, data })) .catch(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">error</span></span></span><span class="hljs-function"> =&gt;</span></span> ({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'FETCH_ERROR'</span></span>, error })) )</code> </pre><br> ä¸æ¯”è¾ƒredux-observableå’Œredux-sagaæ˜¯ä¸å¯èƒ½çš„ã€‚ åœ¨è®¸å¤šäººçœ‹æ¥ï¼Œå®ƒä»¬åœ¨åŠŸèƒ½å’ŒåŠŸèƒ½ä¸Šéƒ½å¾ˆæ¥è¿‘ï¼Œä½†äº‹å®å¹¶éå¦‚æ­¤ã€‚  Sagasæ˜¯ä¸€ä¸ªç»å¯¹å¿…è¦çš„å·¥å…·ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€ç»„ç”¨äºå¤„ç†å‰¯ä½œç”¨çš„æ–¹æ³•ã€‚ å¯è§‚å¯Ÿçš„æ˜¯ï¼Œç¼–å†™å¼‚æ­¥ä»£ç çš„æ ¹æœ¬ä¸åŒçš„é£æ ¼ï¼ˆå¦‚æœéœ€è¦çš„è¯ï¼‰æ˜¯ä¸åŒçš„å“²å­¦ã€‚ <br><br> æˆ‘å†™äº†å‡ ä¸ªä¾‹å­æ¥è¯´æ˜è§£å†³é—®é¢˜çš„å¯èƒ½æ€§å’Œæ–¹æ³•ã€‚ <br><br> å‡è®¾æˆ‘ä»¬éœ€è¦å®ç°ä¸€ä¸ªè®¡æ—¶å™¨ï¼Œè¯¥è®¡æ—¶å™¨å°†é€šè¿‡æ“ä½œåœæ­¢ã€‚ è¿™æ˜¯è¨åŠ æ–¯äººçš„æ ·å­ï¼š <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(<span class="hljs-literal"><span class="hljs-literal">true</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> timer = <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> race({ <span class="hljs-attr"><span class="hljs-attr">stopped</span></span>: take(<span class="hljs-string"><span class="hljs-string">'STOP'</span></span>), <span class="hljs-attr"><span class="hljs-attr">tick</span></span>: call(wait, <span class="hljs-number"><span class="hljs-number">1000</span></span>) }) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!timer.stopped) { <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> put(actions.tick()) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">break</span></span> } }</code> </pre> <br> ç°åœ¨ä½¿ç”¨Rxï¼š <br><br><pre> <code class="javascript hljs">interval(<span class="hljs-number"><span class="hljs-number">1000</span></span>) .takeUntil(action$.ofType(<span class="hljs-string"><span class="hljs-string">'STOP'</span></span>))</code> </pre> <br><br> å‡è®¾å­˜åœ¨ä¸€ä¸ªä»»åŠ¡ï¼Œä»¥åœ¨sagasä¸­å®ç°å¸¦å–æ¶ˆçš„è¯·æ±‚ï¼š <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">* </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fetchSaga</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> call(fetchUser); } <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> take(<span class="hljs-string"><span class="hljs-string">'FETCH'</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> fetchSaga = <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> fork(fetchSaga); <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> take(<span class="hljs-string"><span class="hljs-string">'FETCH_CANCEL'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> cancel(fetchSaga); }</code> </pre> <br> åœ¨Rxä¸Šï¼Œä¸€åˆ‡éƒ½æ›´åŠ ç®€å•ï¼š <br><br><pre> <code class="javascript hljs">switchMap(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> fetchUser()) .takeUntil(action$.ofType(<span class="hljs-string"><span class="hljs-string">'FETCH_CANCEL'</span></span>))</code> </pre> <br> æœ€åï¼Œæˆ‘çš„æœ€çˆ±ã€‚ å®æ–½apiè¯·æ±‚ï¼Œä»¥é˜²ä¸‡ä¸€å¤±è´¥ï¼Œé‡å¤è¯·æ±‚ä¸è¶…è¿‡5ä¸ªï¼Œå»¶è¿Ÿ2ç§’ã€‚ è¿™å°±æ˜¯æˆ‘ä»¬çš„ä¼ å¥‡æ•…äº‹ï¼š <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">5</span></span>; i++) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> apiResponse = <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> call(apiRequest); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> apiResponse; } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (err) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(i &lt; <span class="hljs-number"><span class="hljs-number">4</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> delay(<span class="hljs-number"><span class="hljs-number">2000</span></span>); } } } <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Error</span></span>(); }</code> </pre> <br>  Rxä¼šå‘ç”Ÿä»€ä¹ˆï¼š <br><br><pre> <code class="javascript hljs">.retryWhen(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">errors</span></span></span><span class="hljs-function"> =&gt;</span></span> errors .delay(<span class="hljs-number"><span class="hljs-number">1000</span></span>) .take(<span class="hljs-number"><span class="hljs-number">5</span></span>))</code> </pre><br> å¦‚æœæ‚¨æ€»ç»“æ­¤ä¼ å¥‡çš„åˆ©å¼Šï¼Œåˆ™ä¼šå¾—åˆ°ä»¥ä¸‹å›¾ç‰‡ï¼š <br><br><img src="https://habrastorage.org/webt/y6/bs/un/y6bsun3cbbwp4tayqhuuhwpudyc.png" width="540"><br><br>  Sagasæ˜“äºå­¦ä¹ ä¸”éå¸¸å—æ¬¢è¿ï¼Œå› æ­¤åœ¨ç¤¾åŒºä¸­ï¼Œæ‚¨å‡ ä¹å¯ä»¥åœ¨æ‰€æœ‰åœºåˆæ‰¾åˆ°é£Ÿè°±ã€‚ ä¸å¹¸çš„æ˜¯ï¼Œå‘½ä»¤å¼æ ·å¼ç¡®å®æ— æ³•çµæ´»ä½¿ç”¨sagasã€‚ <br><br>  Rxçš„æƒ…å†µå®Œå…¨ä¸åŒï¼š <br><br><img src="https://habrastorage.org/webt/mc/5a/wx/mc5awxjs7lszbo9jcq-qzrzg2qa.png" width="540"><br><br>  Rxä¼¼ä¹æ˜¯ä¸€æŠŠé­”æœ¯é”¤å’Œé“¶å¼¹ã€‚ ä¸å¹¸çš„æ˜¯ï¼Œäº‹å®å¹¶éå¦‚æ­¤ã€‚ è¾“å…¥Rxçš„é—¨æ§›è¦é«˜å¾—å¤šï¼Œå› æ­¤å¾ˆéš¾å°†ä¸€ä¸ªæ–°äººä»‹ç»ç»™ç§¯æä½¿ç”¨Rxçš„é¡¹ç›®ã€‚ <br><br> æ­¤å¤–ï¼Œåœ¨ä½¿ç”¨Observableæ—¶ï¼Œç‰¹åˆ«è¦å°å¿ƒå¹¶å§‹ç»ˆå¾ˆå¥½åœ°äº†è§£æ­£åœ¨å‘ç”Ÿçš„äº‹æƒ…ï¼Œè¿™ä¸€ç‚¹å°¤å…¶é‡è¦ã€‚ å¦åˆ™ï¼Œæ‚¨å¯èƒ½ä¼šå‘ç°æ˜æ˜¾çš„é”™è¯¯æˆ–æœªå®šä¹‰çš„è¡Œä¸ºã€‚ <br><br><pre> <code class="javascript hljs">action$ .ofType(<span class="hljs-string"><span class="hljs-string">'DELETE'</span></span>) .switchMap(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> Observable .fromPromise(deleteRequest) .map(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> ({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'DELETE_SUCCESS'</span></span>})))</code> </pre> <br> ä¸€æ—¦æˆ‘å†™äº†ä¸€éƒ¨å®Œæˆäº†ç›¸å½“ç®€å•çš„å²è¯—-æ¯ç§ç±»å‹ä¸º'DELETE'çš„åŠ¨ä½œï¼Œå°±ä¼šè°ƒç”¨ä¸€ä¸ªAPIæ–¹æ³•æ¥åˆ é™¤è¯¥é¡¹ç›®ã€‚ ä½†æ˜¯ï¼Œæµ‹è¯•æœŸé—´å­˜åœ¨é—®é¢˜ã€‚ æµ‹è¯•äººå‘˜æŠ±æ€¨è¡Œä¸ºå¼‚å¸¸-æœ‰æ—¶ï¼Œå½“æ‚¨å•å‡»åˆ é™¤æŒ‰é’®æ—¶ï¼Œä»€ä¹ˆä¹Ÿæ²¡æœ‰å‘ç”Ÿã€‚ äº‹å®è¯æ˜ï¼ŒswitchMapè¿ç®—ç¬¦ä¸€æ¬¡ä»…æ”¯æŒä¸€ä¸ªObservableçš„æ‰§è¡Œï¼Œè¿™æ˜¯ä¸€ç§é˜²æ­¢ç«äº‰æ¡ä»¶çš„ä¿æŠ¤æªæ–½ã€‚ <br><br> å› æ­¤ï¼Œæˆ‘å°†æä¾›ä¸€äº›å»ºè®®ï¼Œæˆ‘ä¼šéµå¾ªè¿™äº›å»ºè®®ï¼Œå¹¶æ•¦ä¿ƒå¼€å§‹ä½¿ç”¨Rxçš„æ¯ä¸ªäººéƒ½åº”éµå¾ªï¼š <br><br><ul><li> å°å¿ƒç‚¹ </li><li> æ£€æŸ¥æ–‡æ¡£ã€‚ </li><li> ç­¾å…¥æ²™ç®±ã€‚ </li><li> ç¼–å†™æµ‹è¯•ã€‚ </li><li> ä¸è¦ä»åŠ å†œç‚®å°„éº»é›€ã€‚ </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN460155/">https://habr.com/ru/post/zh-CN460155/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN460143/index.html">Pythonçš„disæ¨¡å—å’Œå¸¸æ•°çš„å·ç§¯</a></li>
<li><a href="../zh-CN460147/index.html">PHPå¾®æœåŠ¡æ¡†æ¶-Swoft 2.0.3å‘å¸ƒ</a></li>
<li><a href="../zh-CN460149/index.html">æ­£ç¡®é”®å…¥ï¼šå¹²å‡€ä»£ç çš„è¢«ä½ä¼°çš„æ–¹é¢</a></li>
<li><a href="../zh-CN460151/index.html">é¢å‘æ¨¡å‹çš„è®¾è®¡ã€‚ æ— åˆ·ç›´æµç”µåŠ¨æœº</a></li>
<li><a href="../zh-CN460153/index.html">ä¿„ç½—æ–¯ç”µå­ç­¾åå†é™©è®°</a></li>
<li><a href="../zh-CN460157/index.html">å—è®¿è€…çš„â€œæ­£ç¡®â€ç­”æ¡ˆå¦‚ä½•ä½¿è°ƒæŸ¥ç»“æœå¤±çœŸè€Œæ— æ³•è¯†åˆ«</a></li>
<li><a href="../zh-CN460159/index.html">ç”¨æˆ·æ™ºèƒ½æ‰‹æœºç›‘æ§ä¿„ç½—æ–¯é“è·¯ç°çŠ¶çš„æ–¹æ³•</a></li>
<li><a href="../zh-CN460161/index.html">FusionPBXå’ŒACL</a></li>
<li><a href="../zh-CN460163/index.html">å¥½åƒ</a></li>
<li><a href="../zh-CN460165/index.html">èƒŒæ™¯ï¼šé‡å­æ‰‹æŒ‡å¯†ç å­¦</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>