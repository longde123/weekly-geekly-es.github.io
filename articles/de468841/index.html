<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëçüèΩ üöé üíâ Kontinuierliche Lieferung f√ºr Ihre Kotlin Multiplatform-Bibliothek üö¥üèª üç° üìª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo! Mein Name ist Yuri Vlad, ich bin ein Android-Entwickler bei Badoo und beteilige mich an der Erstellung der Reaktive Bibliothek - Reactive Exten...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Kontinuierliche Lieferung f√ºr Ihre Kotlin Multiplatform-Bibliothek</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/badoo/blog/468841/"><p><img src="https://habrastorage.org/webt/eo/oi/r6/eooir6an-e6waiaephqkshtswjm.jpeg" alt="Logo"></p><br><p>  Hallo!  Mein Name ist Yuri Vlad, ich bin ein Android-Entwickler bei Badoo und beteilige <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">mich</a> an der Erstellung der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Reaktive</a> Bibliothek - Reactive Extensions auf reinem Kotlin. </p><br><p>  Dabei sehen wir uns mit der Tatsache konfrontiert, dass im Fall von Kotlin Multiplatform eine kontinuierliche Integration und kontinuierliche Lieferung eine zus√§tzliche Konfiguration erfordern.  Es ist erforderlich, mehrere virtuelle Maschinen auf verschiedenen Betriebssystemen zu haben, um die Bibliothek vollst√§ndig zusammenzustellen.  In diesem Artikel werde ich zeigen, wie Sie die kontinuierliche Bereitstellung f√ºr Ihre Kotlin Multiplatform-Bibliothek konfigurieren. </p><a name="habracut"></a><br><h2 id="continuous-integration-i-continuous-delivery-dlya-open-source-bibliotek">  Kontinuierliche Integration und kontinuierliche Bereitstellung f√ºr Open-Source-Bibliotheken </h2><br><p>  Kontinuierliche Integration und kontinuierliche Bereitstellung sind dank verschiedener Dienste seit langem Teil der Open-Source-Community.  Viele von ihnen bieten ihre Dienste kostenlos f√ºr Open-Source-Projekte an: Travis CI, JitPack, CircleCI, Microsoft Azure Pipelines und die k√ºrzlich gestarteten GitHub-Aktionen. </p><br><p>  In Badoos Open-Source-Projekten f√ºr Android verwenden wir Travis CI f√ºr die kontinuierliche Integration und JitPack f√ºr die kontinuierliche Bereitstellung. </p><br><p>  Nach der Implementierung der iOS-Unterst√ºtzung in unserer plattform√ºbergreifenden Bibliothek stellte ich fest, dass wir die Bibliothek nicht mit JitPack erstellen k√∂nnen, da unter macOS <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">keine</a> virtuellen Maschinen bereitgestellt werden (iOS kann nur unter macOS erstellt werden). </p><br><p> Daher wurde f√ºr die weitere Ver√∂ffentlichung der Bibliothek <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Bintray ausgew√§hlt</a> , der allen besser bekannt ist.  Im Gegensatz zu JitPack, bei dem lediglich alle Ergebnisse des <code>publishToMavenLocal</code> Aufrufs erfasst wurden, wird die Feinabstimmung ver√∂ffentlichter Artefakte unterst√ºtzt. </p><br><p>  F√ºr die Ver√∂ffentlichung wird empfohlen, das Gradle Bintray Plugin zu verwenden, das ich sp√§ter an unsere Bed√ºrfnisse angepasst habe.  Und um das Projekt zu erstellen, habe ich Travis CI aus mehreren Gr√ºnden weiter verwendet: Erstens war ich bereits damit vertraut und habe es in fast allen meiner Lieblingsprojekte verwendet.  Zweitens werden die virtuellen macOS-Maschinen bereitgestellt, die zum Erstellen auf iOS erforderlich sind. </p><br><h2 id="parallelnaya-sborka-multiplatformennoy-biblioteki">  Paralleler Aufbau einer plattform√ºbergreifenden Bibliothek </h2><br><p>  Wenn Sie sich mit den Grundlagen der Kotlin-Dokumentation befassen, finden Sie einen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Abschnitt</a> zum Ver√∂ffentlichen von Bibliotheken mit mehreren Plattformen. </p><br><p>  Entwickler von Kotlin Multiplatform sind sich der Probleme der Montage auf mehreren Plattformen bewusst (nicht alles kann auf jedem Betriebssystem zusammengestellt werden) und bieten an, die Bibliothek auf verschiedenen Betriebssystemen separat zusammenzustellen. </p><br><pre> <code class="plaintext hljs">kotlin { jvm() js() mingwX64() linuxX64() // Note that the Kotlin metadata is here, too. // The mingwx64() target is automatically skipped as incompatible in Linux builds. configure([targets["metadata"], jvm(), js()]) { mavenPublication { targetPublication -&gt; tasks.withType(AbstractPublishToMaven) .matching { it.publication == targetPublication } .all { onlyIf { findProperty("isLinux") == "true" } } } } }</code> </pre> <br><p>  Wie Sie dem obigen Code <code>isLinux</code> , <code>isLinux</code> wir abh√§ngig von der an Gradle √ºbergebenen <code>isLinux</code> Eigenschaft <code>isLinux</code> Ver√∂ffentlichung bestimmter Ziele.  Unter den Zielen in der Zukunft meine ich die Montage f√ºr eine bestimmte Plattform.  Unter Windows wird nur das Windows-Ziel erfasst, w√§hrend unter anderen Betriebssystemen Metadaten und andere Ziele erfasst werden. </p><br><p>  Eine sehr sch√∂ne und pr√§gnante L√∂sung, die nur f√ºr <code>publishToMavenLocal</code> oder f√ºr die <code>publish</code> √ºber das <code>maven-publish</code> Plugin funktioniert, das aufgrund der Verwendung des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Gradle Bintray</a> <code>maven-publish</code> Plugins f√ºr uns nicht geeignet ist. </p><br><p>  Ich habe mich entschieden, die Umgebungsvariable zur Auswahl des Ziels zu verwenden, da dieser Code zuvor in Groovy geschrieben wurde, in einem separaten Groovy Gradle-Skript lag und der Zugriff auf die Umgebungsvariablen √ºber einen statischen Kontext erfolgt. </p><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Target</span></span></span><span class="hljs-class"> </span></span>{ ALL, COMMON, IOS, META; <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> common: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> <span class="hljs-meta"><span class="hljs-meta">@JvmName(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"isCommon"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>() = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> == ALL || <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> == COMMON <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> ios: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> <span class="hljs-meta"><span class="hljs-meta">@JvmName(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"isIos"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>() = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> == ALL || <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> == IOS <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> meta: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> <span class="hljs-meta"><span class="hljs-meta">@JvmName(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"isMeta"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>() = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> == ALL || <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> == META <span class="hljs-keyword"><span class="hljs-keyword">companion</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> { <span class="hljs-meta"><span class="hljs-meta">@JvmStatic</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">currentTarget</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: Target { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> value = System.getProperty(<span class="hljs-string"><span class="hljs-string">"MP_TARGET"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> values().find { it.name.equals(value, ignoreCase = <span class="hljs-literal"><span class="hljs-literal">true</span></span>) } ?: ALL } } }</code> </pre> <br><p>  Im Rahmen unseres Projekts habe ich vier Zielgruppen identifiziert: </p><br><ol><li>  ALL - Alle Ziele werden verbunden und gesammelt, f√ºr die Entwicklung und als Standardwert verwendet. </li><li>  GEMEINSAM - nur Linux-kompatible Ziele werden verbunden und gesammelt.  In unserem Fall sind dies JavaScript, JVM, Android JVM, Linux x64 und Linux ARM x32. </li><li>  IOS - Nur iOS-Ziele werden verbunden und gesammelt. Sie werden f√ºr die Montage unter macOS verwendet. </li><li>  META - Alle Ziele sind verbunden, aber nur das Modul mit Metainformationen f√ºr Gradle-Metadaten wird zusammengestellt. </li></ol><br><p>  Mit diesen Zielgruppen k√∂nnen wir die Zusammenstellung des Projekts in drei verschiedene virtuelle Maschinen (COMMON - Linux, IOS - macOS, META - Linux) parallelisieren. </p><br><p>  Im Moment k√∂nnen Sie alles auf macOS bauen, aber meine L√∂sung hat zwei Vorteile.  Wenn wir die Unterst√ºtzung f√ºr Windows implementieren m√∂chten, m√ºssen wir zun√§chst nur eine neue Zielgruppe und eine neue virtuelle Maschine unter Windows hinzuf√ºgen, um sie zu erstellen.  Zweitens m√ºssen Sie keine Ressourcen f√ºr virtuelle Maschinen unter macOS f√ºr das ausgeben, was Sie unter Linux erstellen k√∂nnen.  Die CPU-Zeit auf solchen virtuellen Maschinen ist normalerweise doppelt so teuer. </p><br><h2 id="gradle-metadata">  Gradle-Metadaten </h2><br><p>  Was sind Gradle-Metadaten und wof√ºr? </p><br><p>  Maven verwendet derzeit POM (Project Object Model), um Abh√§ngigkeiten aufzul√∂sen. </p><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">project</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xsi:schemaLocation</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://maven.apache.org/POM/4.0.0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:xsi</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">modelVersion</span></span></span><span class="hljs-tag">&gt;</span></span>4.0.0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">modelVersion</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>com.jakewharton.rxbinding2<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>rxbinding-leanback-v17-kotlin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>2.2.0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">packaging</span></span></span><span class="hljs-tag">&gt;</span></span>aar<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">packaging</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span>RxBinding Kotlin (leanback-v17)<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">description</span></span></span><span class="hljs-tag">&gt;</span></span>RxJava binding APIs for Android's UI widgets.<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">description</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url</span></span></span><span class="hljs-tag">&gt;</span></span>https://github.com/JakeWharton/RxBinding/<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">licenses</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">license</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span>The Apache Software License, Version 2.0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url</span></span></span><span class="hljs-tag">&gt;</span></span>http://www.apache.org/licenses/LICENSE-2.0.txt<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">distribution</span></span></span><span class="hljs-tag">&gt;</span></span>repo<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">distribution</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">license</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">licenses</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">developers</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">developer</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span>jakewharton<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span>Jake Wharton<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">developer</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">developers</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">scm</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">connection</span></span></span><span class="hljs-tag">&gt;</span></span>scm:git:git://github.com/JakeWharton/RxBinding.git<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">connection</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">developerConnection</span></span></span><span class="hljs-tag">&gt;</span></span>scm:git:ssh://git@github.com/JakeWharton/RxBinding.git<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">developerConnection</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url</span></span></span><span class="hljs-tag">&gt;</span></span>https://github.com/JakeWharton/RxBinding/<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">scm</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependencies</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>com.android.support<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>support-annotations<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>28.0.0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">scope</span></span></span><span class="hljs-tag">&gt;</span></span>compile<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">scope</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependencies</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">project</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><p>  Die POM-Datei enth√§lt Informationen zur Bibliotheksversion, ihrem Ersteller und den erforderlichen Abh√§ngigkeiten. </p><br><p>  Aber was ist, wenn wir zwei Versionen der Bibliothek f√ºr verschiedene JDKs haben m√∂chten?  Zum Beispiel hat <code>kotlin-stdlib</code> zwei Versionen: <code>kotlin-stdlib-jdk8</code> und <code>kotlin-stdlib-jdk7</code> .  Benutzer m√ºssen die gew√ºnschte Version verbinden. </p><br><p>  Beim Upgrade der JDK-Version k√∂nnen externe Abh√§ngigkeiten leicht vergessen werden.  Um dieses Problem zu l√∂sen, wurden Gradle-Metadaten erstellt, mit denen Sie zus√§tzliche Bedingungen f√ºr die Verbindung einer bestimmten Bibliothek hinzuf√ºgen k√∂nnen. </p><br><p>  Eines der unterst√ºtzten Gradle-Metadatenattribute ist <code>org.gradle.jvm.version</code> , das die Version des JDK angibt.  Daher k√∂nnte f√ºr <code>kotlin-stdlib</code> eine vereinfachte Form einer Metadatendatei folgenderma√üen aussehen: </p><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"formatVersion"</span></span>: <span class="hljs-string"><span class="hljs-string">"1.0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"component"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"group"</span></span>: <span class="hljs-string"><span class="hljs-string">"org.jetbrains.kotlin"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"module"</span></span>: <span class="hljs-string"><span class="hljs-string">"kotlin-stdlib"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"version"</span></span>: <span class="hljs-string"><span class="hljs-string">"1.3.0"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"variants"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"apiElements"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"attributes"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"org.gradle.jvm.version"</span></span>: <span class="hljs-number"><span class="hljs-number">8</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"available-at"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"url"</span></span>: <span class="hljs-string"><span class="hljs-string">"../../kotlin-stdlib-jdk8/1.3.0/kotlin-stdlib-jdk8.module"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"group"</span></span>: <span class="hljs-string"><span class="hljs-string">"org.jetbrains.kotlin"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"module"</span></span>: <span class="hljs-string"><span class="hljs-string">"kotlin-stdlib-jdk8"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"version"</span></span>: <span class="hljs-string"><span class="hljs-string">"1.3.0"</span></span> } }, { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"apiElements"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"attributes"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"org.gradle.jvm.version"</span></span>: <span class="hljs-number"><span class="hljs-number">7</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"available-at"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"url"</span></span>: <span class="hljs-string"><span class="hljs-string">"../../kotlin-stdlib-jdk7/1.3.0/kotlin-stdlib-jdk7.module"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"group"</span></span>: <span class="hljs-string"><span class="hljs-string">"org.jetbrains.kotlin"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"module"</span></span>: <span class="hljs-string"><span class="hljs-string">"kotlin-stdlib-jdk7"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"version"</span></span>: <span class="hljs-string"><span class="hljs-string">"1.3.0"</span></span> } } ] }</code> </pre> <br><p>  In unserem Fall <code>reaktive-1.0.0-rc1.module</code> in vereinfachter Form folgenderma√üen aus: </p><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"formatVersion"</span></span>: <span class="hljs-string"><span class="hljs-string">"1.0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"component"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"group"</span></span>: <span class="hljs-string"><span class="hljs-string">"com.badoo.reaktive"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"module"</span></span>: <span class="hljs-string"><span class="hljs-string">"reaktive"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"version"</span></span>: <span class="hljs-string"><span class="hljs-string">"1.0.0-rc1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"attributes"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"org.gradle.status"</span></span>: <span class="hljs-string"><span class="hljs-string">"release"</span></span> } }, <span class="hljs-attr"><span class="hljs-attr">"createdBy"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"gradle"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"version"</span></span>: <span class="hljs-string"><span class="hljs-string">"5.4.1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"buildId"</span></span>: <span class="hljs-string"><span class="hljs-string">"tv44qntk2zhitm23bbnqdngjam"</span></span> } }, <span class="hljs-attr"><span class="hljs-attr">"variants"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"android-releaseRuntimeElements"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"attributes"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"com.android.build.api.attributes.BuildTypeAttr"</span></span>: <span class="hljs-string"><span class="hljs-string">"release"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"com.android.build.api.attributes.VariantAttr"</span></span>: <span class="hljs-string"><span class="hljs-string">"release"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"com.android.build.gradle.internal.dependency.AndroidTypeAttr"</span></span>: <span class="hljs-string"><span class="hljs-string">"Aar"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"org.gradle.usage"</span></span>: <span class="hljs-string"><span class="hljs-string">"java-runtime"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"org.jetbrains.kotlin.platform.type"</span></span>: <span class="hljs-string"><span class="hljs-string">"androidJvm"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"available-at"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"url"</span></span>: <span class="hljs-string"><span class="hljs-string">"../../reaktive-android/1.0.0-rc1/reaktive-android-1.0.0-rc1.module"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"group"</span></span>: <span class="hljs-string"><span class="hljs-string">"com.badoo.reaktive"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"module"</span></span>: <span class="hljs-string"><span class="hljs-string">"reaktive-android"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"version"</span></span>: <span class="hljs-string"><span class="hljs-string">"1.0.0-rc1"</span></span> } }, { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"ios64-api"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"attributes"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"org.gradle.usage"</span></span>: <span class="hljs-string"><span class="hljs-string">"kotlin-api"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"org.jetbrains.kotlin.native.target"</span></span>: <span class="hljs-string"><span class="hljs-string">"ios_arm64"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"org.jetbrains.kotlin.platform.type"</span></span>: <span class="hljs-string"><span class="hljs-string">"native"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"available-at"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"url"</span></span>: <span class="hljs-string"><span class="hljs-string">"../../reaktive-ios64/1.0.0-rc1/reaktive-ios64-1.0.0-rc1.module"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"group"</span></span>: <span class="hljs-string"><span class="hljs-string">"com.badoo.reaktive"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"module"</span></span>: <span class="hljs-string"><span class="hljs-string">"reaktive-ios64"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"version"</span></span>: <span class="hljs-string"><span class="hljs-string">"1.0.0-rc1"</span></span> } }, { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"linuxX64-api"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"attributes"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"org.gradle.usage"</span></span>: <span class="hljs-string"><span class="hljs-string">"kotlin-api"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"org.jetbrains.kotlin.native.target"</span></span>: <span class="hljs-string"><span class="hljs-string">"linux_x64"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"org.jetbrains.kotlin.platform.type"</span></span>: <span class="hljs-string"><span class="hljs-string">"native"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"available-at"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"url"</span></span>: <span class="hljs-string"><span class="hljs-string">"../../reaktive-linuxx64/1.0.0-rc1/reaktive-linuxx64-1.0.0-rc1.module"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"group"</span></span>: <span class="hljs-string"><span class="hljs-string">"com.badoo.reaktive"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"module"</span></span>: <span class="hljs-string"><span class="hljs-string">"reaktive-linuxx64"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"version"</span></span>: <span class="hljs-string"><span class="hljs-string">"1.0.0-rc1"</span></span> } }, ] }</code> </pre> <br><p>  Dank der Attribute <code>org.jetbrains.kotlin</code> Gradle, in welchem ‚Äã‚ÄãFall welche Abh√§ngigkeit in den gew√ºnschten Quellensatz zu ziehen ist. </p><br><p>  Sie k√∂nnen Metadaten aktivieren, indem Sie: </p><br><pre> <code class="kotlin hljs">enableFeaturePreview(<span class="hljs-string"><span class="hljs-string">"GRADLE_METADATA"</span></span>)</code> </pre> <br><p>  Detaillierte Informationen finden Sie in der <a href="">Dokumentation</a> . </p><br><h2 id="nastroyka-publikacii">  Einstellung ver√∂ffentlichen </h2><br><p>  Nachdem wir die Ziele und die Parallelisierung der Assembly herausgefunden haben, m√ºssen wir konfigurieren, was genau und wie wir ver√∂ffentlichen werden. </p><br><p>  F√ºr die Ver√∂ffentlichung verwenden wir das Gradle Bintray-Plugin. Schauen Sie sich zun√§chst die <a href="">README-</a> Datei an und richten Sie Informationen zu unserem Repository und den Anmeldeinformationen f√ºr die Ver√∂ffentlichung ein. </p><br><p>  Wir werden die gesamte Konfiguration in unserem eigenen Plugin im Ordner <code>buildSrc</code> . <br>  Die Verwendung von <code>buildSrc</code> bietet mehrere Vorteile, darunter eine stets funktionierende automatische Vervollst√§ndigung (bei Kotlin-Skripten funktioniert sie immer noch nicht immer und erfordert h√§ufig einen Aufruf zum Anwenden von Abh√§ngigkeiten) sowie die M√∂glichkeit, darin deklarierte Klassen wiederzuverwenden und √ºber Groovy- und Kotlin-Skripte darauf zuzugreifen.  Sie k√∂nnen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ein Beispiel f√ºr die Verwendung von</a> <code>buildSrc</code> aus der neuesten Google-E / A (Abschnitt Gradle) sehen. </p><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setupBintrayPublishingInformation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(target: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Project</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-comment"><span class="hljs-comment">//  Bintray Plugin   target.plugins.apply(BintrayPlugin::class) //    target.extensions.getByType(BintrayExtension::class).apply { user = target.findProperty("bintray_user")?.toString() key = target.findProperty("bintray_key")?.toString() pkg.apply { repo = "maven" name = "reaktive" userOrg = "badoo" vcsUrl = "https://github.com/badoo/Reaktive.git" setLicenses("Apache-2.0") version.name = target.property("reaktive_version")?.toString() } } }</span></span></code> </pre> <br><p>  Ich verwende drei dynamische Eigenschaften des Projekts: <code>bintray_user</code> und <code>bintray_key</code> , die aus den pers√∂nlichen Profileinstellungen in <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Bintray abgerufen werden k√∂nnen</a> , und <code>reaktive_version</code> , die in der Root-Datei <code>build.gradle</code> ist. </p><br><p>  F√ºr jedes Ziel erstellt das Kotlin Multiplatform Plugin eine <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">MavenPublication</a> , die in <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">PublishingExtension</a> verf√ºgbar ist. </p><br><p>  Mit dem Beispielcode aus der Kotlin-Dokumentation, die ich oben bereitgestellt habe, k√∂nnen wir diese Konfiguration erstellen: </p><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createConfigurationMap</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: Map&lt;String, <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span>&gt; { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> mppTarget = Target.currentTarget() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> mapOf( <span class="hljs-string"><span class="hljs-string">"kotlinMultiplatform"</span></span> to mppTarget.meta, KotlinMultiplatformPlugin.METADATA_TARGET_NAME to mppTarget.meta, <span class="hljs-string"><span class="hljs-string">"jvm"</span></span> to mppTarget.common, <span class="hljs-string"><span class="hljs-string">"js"</span></span> to mppTarget.common, <span class="hljs-string"><span class="hljs-string">"androidDebug"</span></span> to mppTarget.common, <span class="hljs-string"><span class="hljs-string">"androidRelease"</span></span> to mppTarget.common, <span class="hljs-string"><span class="hljs-string">"linuxX64"</span></span> to mppTarget.common, <span class="hljs-string"><span class="hljs-string">"linuxArm32Hfp"</span></span> to mppTarget.common, <span class="hljs-string"><span class="hljs-string">"iosArm32"</span></span> to mppTarget.ios, <span class="hljs-string"><span class="hljs-string">"iosArm64"</span></span> to mppTarget.ios, <span class="hljs-string"><span class="hljs-string">"iosX64"</span></span> to mppTarget.ios ) }</code> </pre> <br><p>  In dieser einfachen Karte beschreiben wir, welche Ver√∂ffentlichungen auf einer bestimmten virtuellen Maschine ver√∂ffentlicht werden sollen.  Der Ver√∂ffentlichungsname ist der Name des Ziels.  Diese Konfiguration stimmt voll und ganz mit der oben zitierten Beschreibung der Zielgruppen √ºberein. </p><br><p>  Lassen Sie uns die Ver√∂ffentlichung in Bintray einrichten.  Das Bintray-Plugin erstellt eine <code>BintrayUploadTask</code> , die wir an unsere Bed√ºrfnisse anpassen. </p><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setupBintrayPublishing</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( target: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Project</span></span></span></span><span class="hljs-function"><span class="hljs-params">, taskConfigurationMap: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Map</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">Boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; )</span></span></span></span> { target.tasks.named(BintrayUploadTask.getTASK_NAME(), BintrayUploadTask::<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">) </span></span>{ doFirst { <span class="hljs-comment"><span class="hljs-comment">//   } } }</span></span></code> </pre> <br><p>  Jeder, der mit dem Bintray-Plugin arbeitet, stellt schnell fest, dass sein Repository schon lange mit Moos bedeckt ist (das letzte Update war vor etwa sechs Monaten) und dass alle Probleme durch alle Arten von Hacks und Kr√ºcken auf der Registerkarte Probleme gel√∂st werden.  Die Unterst√ºtzung f√ºr eine so neue Technologie wie Gradle Metadata wurde nicht implementiert, aber in der entsprechenden <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Ausgabe</a> finden Sie eine L√∂sung, die wir verwenden. </p><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> publishing = project.extensions.getByType(PublishingExtension::<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">publishing</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">publications</span></span></span><span class="hljs-class"> .</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">filterIsInstance</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MavenPublication</span></span></span><span class="hljs-class">&gt;</span></span>() .forEach { publication -&gt; <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> moduleFile = project.buildDir.resolve(<span class="hljs-string"><span class="hljs-string">"publications/</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${publication.name}</span></span></span><span class="hljs-string">/module.json"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (moduleFile.exists()) { publication.artifact(<span class="hljs-keyword"><span class="hljs-keyword">object</span></span> : FileBasedMavenArtifact(moduleFile) { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDefaultExtension</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> = <span class="hljs-string"><span class="hljs-string">"module"</span></span> }) } }</code> </pre> <br><p>  Mit diesem Code f√ºgen wir die Datei <code>module.json</code> zur Liste der zu ver√∂ffentlichenden Artefakte hinzu, aufgrund derer Gradle-Metadaten funktionieren. </p><br><p>  Aber unsere Probleme enden nicht dort.  Wenn Sie versuchen, <code>bintrayPublish</code> geschieht nichts. </p><br><p>  Bei regul√§ren Java- und Kotlin-Bibliotheken ruft Bintray verf√ºgbare Ver√∂ffentlichungen automatisch auf und ver√∂ffentlicht sie.  Im Fall von Kotlin Multiplatform st√ºrzt das Plugin beim automatischen Abrufen von Ver√∂ffentlichungen einfach mit einem Fehler ab.  Und ja, daf√ºr gibt es auch ein <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Problem bei GitHub</a> .  Und wir werden die L√∂sung von dort wieder verwenden, nur indem wir die Ver√∂ffentlichungen filtern, die wir ben√∂tigen. </p><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> publications = publishing.publications .filterIsInstance&lt;MavenPublication&gt;() .filter { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> res = taskConfigurationMap[it.name] == <span class="hljs-literal"><span class="hljs-literal">true</span></span> logger.warn(<span class="hljs-string"><span class="hljs-string">"Artifact '</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${it.groupId}</span></span></span><span class="hljs-string">:</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${it.artifactId}</span></span></span><span class="hljs-string">:</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${it.version}</span></span></span><span class="hljs-string">' from publication '</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${it.name}</span></span></span><span class="hljs-string">' should be published: </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$res</span></span></span><span class="hljs-string">"</span></span>) res } .map { logger.warn(<span class="hljs-string"><span class="hljs-string">"Uploading artifact '</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${it.groupId}</span></span></span><span class="hljs-string">:</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${it.artifactId}</span></span></span><span class="hljs-string">:</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${it.version}</span></span></span><span class="hljs-string">' from publication '</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${it.name}</span></span></span><span class="hljs-string">'"</span></span>) it.name } .toTypedArray() setPublications(*publications)</code> </pre> <br><p>  Aber dieser Code funktioniert auch nicht! </p><br><p>  Dies liegt daran, dass <code>bintrayUpload</code> in den Abh√§ngigkeiten, die das Projekt zusammenstellen und die f√ºr die Ver√∂ffentlichung erforderlichen Dateien erstellen w√ºrden, keine Aufgabe hat.  Die naheliegendste L√∂sung besteht darin, <code>publishToMavenLocal</code> als <code>publishToMavenLocal</code> Abh√§ngigkeit <code>publishToMavenLocal</code> , jedoch nicht so einfach. </p><br><p>  Beim Sammeln von Metadaten verbinden wir alle Ziele mit dem Projekt. <code>publishToMavenLocal</code> bedeutet, dass <code>publishToMavenLocal</code> alle Ziele kompiliert, da die Abh√§ngigkeiten f√ºr diese Aufgabe <code>publishToMavenLocalAndroidDebug</code> , <code>publishToMavenLocalAndroiRelase</code> , <code>publishToMavenLocalJvm</code> usw. umfassen. </p><br><p>  Daher werden wir eine separate Proxy-Aufgabe erstellen, je nachdem, welche nur wir ver√∂ffentlichenToMavenLocalX, die wir ben√∂tigen, und wir werden diese Aufgabe selbst in <code>bintrayPublish</code> Abh√§ngigkeiten setzen. </p><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setupLocalPublishing</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( target: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Project</span></span></span></span><span class="hljs-function"><span class="hljs-params">, taskConfigurationMap: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Map</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">Boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; )</span></span></span></span> { target.project.tasks.withType(AbstractPublishToMaven::<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">).</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">configureEach</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> configuration = publication?.name ?: run { <span class="hljs-comment"><span class="hljs-comment">// Android-       PublishToMaven,        val configuration = taskConfigurationMap.keys.find { name.contains(it, ignoreCase = true) } logger.warn("Found $configuration for $name") configuration } //          enabled = taskConfigurationMap[configuration] == true } } private fun createFilteredPublishToMavenLocalTask(target: Project) { //  -         publishToMavenLocal target.tasks.register(TASK_FILTERED_PUBLISH_TO_MAVEN_LOCAL) { dependsOn(project.tasks.matching { it is AbstractPublishToMaven &amp;&amp; it.enabled }) } }</span></span></code> </pre> <br><p>  Es bleibt nur, den gesamten Code zusammen zu sammeln und das resultierende Plug-In auf ein Projekt anzuwenden, in dem eine Ver√∂ffentlichung erforderlich ist. </p><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PublishPlugin</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Plugin</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Project</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">apply</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(target: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Project</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> taskConfigurationMap = createConfigurationMap() createFilteredPublishToMavenLocalTask(target) setupLocalPublishing(target, taskConfigurationMap) setupBintrayPublishingInformation(target) setupBintrayPublishing(target, taskConfigurationMap) }</code> </pre> <br><pre> <code class="plaintext hljs">apply plugin: PublishPlugin</code> </pre> <br><p>  Den vollst√§ndigen <code>PublishPlugin</code> Code finden Sie in unserem Repository <a href="">hier</a> . </p><br><h2 id="nastroyka-travis-ci">  Konfigurieren Sie Travis CI </h2><br><p>  Der schwierigste Teil ist vorbei.  Travis CI muss weiterhin so konfiguriert werden, dass es die Assembly parallelisiert und Artefakte in Bintray ver√∂ffentlicht, wenn eine neue Version ver√∂ffentlicht wird. </p><br><p>  Wir werden die Ver√∂ffentlichung der neuen Version festlegen, indem wir ein Tag f√ºr das Commit erstellen. </p><br><pre> <code class="plaintext hljs">#    ( ) matrix: include: #  Linux  Android  Chrome    JS, JVM, Android JVM  Linux - os: linux dist: trusty addons: chrome: stable language: android android: components: - build-tools-28.0.3 - android-28 #  MP_TARGET,        env: MP_TARGET=COMMON #     install ‚Äî Gradle     install: true #    JVM       RxJava2 script: ./gradlew reaktive:check reaktive-test:check rxjava2-interop:check -DMP_TARGET=$MP_TARGET #  macOS   iOS- - os: osx osx_image: xcode10.2 language: java env: MP_TARGET=IOS install: true script: ./gradlew reaktive:check reaktive-test:check -DMP_TARGET=$MP_TARGET #  Linux    - os: linux language: android android: components: - build-tools-28.0.3 - android-28 env: MP_TARGET=META #     -  install: true script: true #    Gradle (           ) before_cache: - rm -f $HOME/.gradle/caches/modules-2/modules-2.lock - rm -fr $HOME/.gradle/caches/*/plugin-resolution/ cache: directories: - $HOME/.gradle/caches/ - $HOME/.gradle/wrapper/ #  ,   Kotlin/Native    - $HOME/.konan/ #     Bintray    ,           deploy: skip_cleanup: true provider: script script: ./gradlew bintrayUpload -DMP_TARGET=$MP_TARGET -Pbintray_user=$BINTRAY_USER -Pbintray_key=$BINTRAY_KEY on: tags: true</code> </pre> <br><p>  Wenn die Assembly auf einer der virtuellen Maschinen aus irgendeinem Grund fehlgeschlagen ist, werden die Metadaten und andere Ziele weiterhin auf den Bintray-Server hochgeladen.  Aus diesem Grund f√ºgen wir keinen Block mit automatischer Freigabe der Bibliothek auf Bintray √ºber deren API hinzu. </p><br><p>  Wenn Sie die Version ver√∂ffentlichen, m√ºssen Sie sicherstellen, dass alles in Ordnung ist, und einfach auf die Schaltfl√§che "Ver√∂ffentlichen" f√ºr die neue Version auf der Site klicken, da alle Artefakte bereits hochgeladen wurden. </p><br><h2 id="zaklyuchenie">  Fazit </h2><br><p>  Deshalb haben wir in unserem Kotlin Multiplatform-Projekt eine kontinuierliche Integration und Bereitstellung eingerichtet. </p><br><p>  Nachdem wir die Aufgaben zum Zusammenstellen, Ausf√ºhren von Tests und Ver√∂ffentlichen von Artefakten parallelisiert haben, nutzen wir die uns zur Verf√ºgung gestellten Ressourcen effektiv und kostenlos. </p><br><p>  Und wenn Sie Linux verwenden (wie Arkady Ivanov <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">arkivanov</a> , Autor der Reaktive Bibliothek), m√ºssen Sie die Person, die macOS (mich) verwendet, nicht mehr jedes Mal, wenn eine neue Version ver√∂ffentlicht wird, bitten, die Bibliothek zu ver√∂ffentlichen. </p><br><p>  Ich hoffe, dass nach der Ver√∂ffentlichung dieses Artikels weitere Projekte diesen Ansatz verwenden werden, um Routinet√§tigkeiten zu automatisieren. </p><br><p>  Vielen Dank f√ºr Ihre Aufmerksamkeit! </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de468841/">https://habr.com/ru/post/de468841/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de468825/index.html">H√∂r auf zu denken, dass die SLA dich retten wird. Es ist notwendig, ein falsches Sicherheitsgef√ºhl zu beruhigen und zu schaffen.</a></li>
<li><a href="../de468827/index.html">Ger√§te zum Schlafen</a></li>
<li><a href="../de468833/index.html">Algorithmen zur Suche nach Primzahlen</a></li>
<li><a href="../de468835/index.html">"Verlorene" Zeit: Was besticht heute eine mechanische Uhr?</a></li>
<li><a href="../de468837/index.html">So f√ºhren Sie ein technisches Interview durch: einen Aktionsplan f√ºr Anf√§nger</a></li>
<li><a href="../de468843/index.html">Haben Sie Angst, ein CRM-System zu implementieren? Ihr Gesch√§ft kann krank sein</a></li>
<li><a href="../de468845/index.html">Ein kurzer Kurs in der Physiologie der Stadt oder K√∂rperteile</a></li>
<li><a href="../de468847/index.html">√ñffentliches Beschaffungswesen in anderen L√§ndern: Warum Gesetze Rahmenbedingungen ben√∂tigen</a></li>
<li><a href="../de468849/index.html">Unbekanntes Prozessor-Reverse Engineering in einem einzigen Programm</a></li>
<li><a href="../de468851/index.html">Implementierung der Animation in React Native</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>