<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ค๐ป ๐ณ ๐๏ธ JVM TI: ููููุฉ ุฌุนู ุงูุจุฑูุงูุฌ ุงููุณุงุนุฏ ูุฌูุงุฒ ุงูุธุงูุฑู ๐ป ๐ฉโ๐ญ ๐๐ฟ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ูู ุชุฑุบุจ ูู ุฅุถุงูุฉ ุจุนุถ ุงูููุฒุงุช ุงููููุฏุฉ ุฅูู JVMุ ูู ุงููุงุญูุฉ ุงููุธุฑูุฉ ุ ูููู ููู ูุทูุฑ ุงููุณุงููุฉ ูู OpenJDK ุ ููุน ุฐูู ุ ูู ุงูููุงุฑุณุฉ ุงูุนูููุฉ ุ ูุฅู ุฃู ุชุบููุฑุงุช ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>JVM TI: ููููุฉ ุฌุนู ุงูุจุฑูุงูุฌ ุงููุณุงุนุฏ ูุฌูุงุฒ ุงูุธุงูุฑู</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/odnoklassniki/blog/458812/" style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/dk/iw/hm/dkiwhmwayxse8--tbyxqszp0xeg.jpeg"><br><br>  ูู ุชุฑุบุจ ูู ุฅุถุงูุฉ ุจุนุถ ุงูููุฒุงุช ุงููููุฏุฉ ุฅูู JVMุ  ูู ุงููุงุญูุฉ ุงููุธุฑูุฉ ุ ูููู ููู ูุทูุฑ ุงููุณุงููุฉ ูู OpenJDK ุ ููุน ุฐูู ุ ูู ุงูููุงุฑุณุฉ ุงูุนูููุฉ ุ ูุฅู ุฃู ุชุบููุฑุงุช ุบูุฑ ุชุงููุฉ ุนูู HotSpot ููุณุช ููุถุน ุชุฑุญูุจ ูุจูุฑ ูู ุงูุฌุงูุจ ุ ูุญุชู ูุน ุฏูุฑุฉ ุงูุฅุตุฏุงุฑ ุงููุฎุชุตุฑุฉ ุงูุญุงููุฉ ุ ููุฏ ูุณุชุบุฑู ุงูุฃูุฑ ุณููุงุช ุญุชู ูุฑู ูุณุชุฎุฏูู JDK ุงูููุฒุฉ ุงูุฎุงุตุฉ ุจู. <br><br>  ููุน ุฐูู ุ ูู ุจุนุถ ุงูุญุงูุงุช ุ ูููู ุชูุณูุน ูุธููุฉ ุงูุฌูุงุฒ ุงูุธุงูุฑู ุฏูู ุญุชู ููุณ ุงูุฑูุฒ ุงูุฎุงุต ุจู.  ูุงุฌูุฉ ุฃุฏุงุฉ JVM ุ ูุงุฌูุฉ ุจุฑูุฌุฉ ุงูุชุทุจููุงุช ุงูููุงุณูุฉ ููุชูุงุนู ูุน JVM ุ ุชุณุงุนุฏ. <br><br>  ูู ูุฐุง ุงูููุงู ุ ุณุฃุนุฑุถ ุจุฃูุซูุฉ ููููุณุฉ ูุง ูููู ุงูููุงู ุจู ุ ูุฃููู ูุง ุงูุฐู ุชุบูุฑ ูู ุฌุงูุฉ 9 ู 11 ุ ูุฃุญุฐุฑ ุจุตุฏู ูู ุงูุตุนูุจุงุช (ุงูููุณุฏ: ูุฌุจ ุฃู ุฃุชุนุงูู ูุน C ++). <br><br>  ุชุญุฏุซุช ุฃูุถุง ุนู ูุฐู ุงูููุงุฏ ุนูู JPoint.  ุฅุฐุง ููุช ุชูุถู ุงูููุฏูู ุ ููููู ูุดุงูุฏุฉ ุชูุฑูุฑ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูููุฏูู</a> . <br><a name="habracut"></a><br><h2 style=";text-align:right;direction:rtl">  ุฏุฎูู </h2><br>  ุงูุดุจูุฉ ุงูุงุฌุชูุงุนูุฉ Odnoklassniki ุ ุญูุซ ุฃุนูู ูููุฏุณูุง ุฑุฆูุณููุง ุ ููุชูุจุฉ ุจุงููุงูู ุชูุฑูุจูุง ุจูุบุฉ Java.  ููู ุงูููู ุณูู ุฃุฎุจุฑูู ููุท ุนู ุฌุฒุก ุขุฎุฑ ุ ููู ููุณ ูู Java ุชูุงููุง. <br><br>  ููุง ุชุนูููู ุ ูุฅู ุงููุดููุฉ ุงูุฃูุซุฑ ุดููุนูุง ูู ูุทูุฑู Java ูู NullPointerException.  ูุฑุฉ ูุงุญุฏุฉ ุ ุฃุซูุงุก ุงูุฎุฏูุฉ ุนูู ุงูุจูุงุจุฉ ุ ุตุงุฏูุช ุฃูุถูุง NPE ูู ุงูุฅูุชุงุฌ.  ูุงู ุงูุฎุทุฃ ูุตุญูุจูุง ุจูุซู ูุฐุง ุงูุชุชุจุน ุงูููุฏุณ: <br><br><img src="https://habrastorage.org/webt/j6/lb/4t/j6lb4tmh3wmmti8tebobo7znwsu.jpeg"><br><br>  ุจุงูุทุจุน ุ ุนูู ุชุชุจุน ุงูููุฏุณ ุ ููููู ุชุชุจุน ุงูููุงู ุงูุฐู ุญุฏุซ ููู ุงูุงุณุชุซูุงุก ุญุชู ุณุทุฑ ูุนูู ูู ุงูููุฏ.  ูู ูุฐู ุงูุญุงูุฉ ููุท ุ ูู ูุฌุนููู ุฃุดุนุฑ ุจุงูุชุญุณู ุ ูุฃู NPE ููุง ูููู ุฃู ูุฌุชูุน ูุซูุฑูุง ุญูุซ: <br><br><img src="https://habrastorage.org/webt/xt/kt/pq/xtktpq4cozo4xvjvllvgtk9cibe.jpeg"><br><br>  ุณูููู ูู ุงูุฑุงุฆุน ูู ุฃู JVM ุงูุชุฑุญุช ุจุงูุถุจุท ุฃูู ูุงู ูุฐุง ุงูุฎุทุฃ ุ ุนูู ุณุจูู ุงููุซุงู ุ ูุซู ูุฐุง: <br> <code>java.lang.NullPointerException: Called 'getUsers()' method on null object</code> <br> <br>  ููู ูุณูุก ุงูุญุธ ุ ูุง ูุญุชูู NPE ุงูุขู ุนูู ุฃู ุดูุก ูู ูุฐุง ุงููุจูู.  ุนูู ุงูุฑุบู ูู ุฃููู ูุงููุง ูุทูุจูู ุฐูู ููุชุฑุฉ ุทูููุฉ ุ ุนูู ุงูุฃูู ูุน Java 1.4: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุฐุง ุงูุฎุทุฃ</a> ูุงู ุนูุฑู 16 ุนุงููุง.  ุจุดูู ุฏูุฑู ุ ุชู ูุชุญ ุงููุฒูุฏ ูู ุงูุฃุฎุทุงุก ูู ูุฐุง ุงูููุถูุน ุ ููู ุชู ุฅุบูุงููุง ุฏุงุฆููุง ุจุงุณู "ูู ุฅุตูุงุญ": <br><br><img src="https://habrastorage.org/webt/5l/tc/xg/5ltcxgloqnkiiudcadczatl6_ne.jpeg"><br><br>  ูุฐุง ูุง ูุญุฏุซ ูู ูู ููุงู.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุฃุฎุจุฑ</a> Volker Simonis ูู SAP ููู ูุงููุง ุจุชุทุจูู ูุฐู ุงูููุฒุฉ ูู SAP JVM ููุชุฑุฉ ุทูููุฉ ูุณุงุนุฏููุง ุฃูุซุฑ ูู ูุฑุฉ.  ูุงู ููุธู SAP ุขุฎุฑ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุจุชูุฏูู</a> ุฎุทุฃ ูู OpenJDK ูุชุทูุน ูุชูููุฐ ุขููุฉ ููุงุซูุฉ ููุง ูู ููุฌูุฏ ูู SAP JVM.  ููุง ุ ูุฐู ุงููุฑุฉ ูู ูุชู ุฅุบูุงู ุงูุฎูู - ููุงู ุงุญุชูุงู ุฃู ุชุฏุฎู ูุฐู ุงูููุฒุฉ ุฅูู JDK 14. <br><br>  ูููู ูุชู ุณูุชู ุฅุตุฏุงุฑ JDK 14 ุ ููุชู ุณููุชูู ุฅูููุ  ูุงุฐุง ุชูุนู ุฅุฐุง ููุช ุชุฑูุฏ ุงูุชุญููู ูู ุงููุดููุฉ ููุง ูุงูุขูุ <br><br>  ููููู ุ ุจุงูุทุจุน ุ ุงูุญูุงุธ ุนูู ุดููุฉ OpenJDK ุงูุฎุงุต ุจู.  ููุฒุฉ ุงูุฅุจูุงุบ ุนู NPE ููุณูุง ููุณุช ูุนูุฏุฉ ููุบุงูุฉ ุ ููุฏ ูุงู ูู ุงููููู ุฃู ูููุฐูุง.  ูููู ูู ุงูููุช ููุณู ุ ุณุชููู ููุงู ูู ูุดุงูู ุฏุนู ุงูุชุฌููุน ุงูุฎุงุต ุจู.  ุณูููู ูู ุงูุฑุงุฆุน ุชูููุฐ ูุฐู ุงูููุฒุฉ ูุฑุฉ ูุงุญุฏุฉ ุ ุซู ุชูุตูููุง ุจุจุณุงุทุฉ ุจุฃู ุฅุตุฏุงุฑ ูู JVM ููููู ุฅุถุงูู.  ููุฐุง ูููู ุญูุง!  ูุฏู JVM ูุงุฌูุฉ ุจุฑูุฌุฉ ุชุทุจููุงุช ุฎุงุตุฉ (ุชู ุชุทููุฑูุง ูู ุงูุฃุตู ูุฌููุน ุฃููุงุน ุจุฑุงูุฌ ุชุตุญูุญ ุงูุฃุฎุทุงุก ูุงูููุงุทุนูู): ูุงุฌูุฉ ุฃุฏุงุฉ JVM. <br><br>  ุงูุฃูู ูู ุฐูู ุ ูุฐุง API ูู ุงููุนูุงุฑ.  ูุฏูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุงุตูุงุช</a> ุตุงุฑูุฉ ุ ูุนูุฏ ุชุทุจูู ููุฒุฉ ุชุชูุงูู ูุนูุง ุ ููููู ุงูุชุฃูุฏ ูู ุฃููุง ุณุชุนูู ูู ุฅุตุฏุงุฑุงุช ุฌุฏูุฏุฉ ูู JVM. <br><br>  ูุงุณุชุฎุฏุงู ูุฐู ุงููุงุฌูุฉ ุ ุชุญุชุงุฌ ุฅูู ูุชุงุจุฉ ุจุฑูุงูุฌ ุตุบูุฑ (ุฃู ูุจูุฑ ุ ุญุณุจ ููุงูู).  ุฃุตูู: ุนุงุฏุฉ ูุง ูุชู ูุชุงุจุชู ูู C ุฃู C ++.  ูุญุชูู <code>jdk/include/jvmti.h</code> JDK ุงูููุงุณู <code>jdk/include/jvmti.h</code> ููู ุฑุฃุณ <code>jdk/include/jvmti.h</code> ุงูุฐู ุชุฑูุฏ ุชุถูููู. <br><br>  ูุชู ุชุตููู ุงูุจุฑูุงูุฌ ูู ููุชุจุฉ ุฏููุงููููุฉ ุ ููุชุตูุฉ ุจูุงุณุทุฉ ุงููุนููุฉ <code>-agentpath</code> ุฃุซูุงุก ุจุฏุก JVM.  ูู ุงูููู ุนุฏู ุงูุฎูุท ุจููู ูุจูู ูุนููุฉ ุฃุฎุฑู ููุงุซูุฉ: - <code>-javaagent</code> .  ูู ุงููุงูุน ุ ูุนุชุจุฑ ุนููุงุก Java ุญุงูุฉ ุฎุงุตุฉ ููููุงุก JVM TI.  ูุฐูู ูู ุงููุต ุชุญุช ูููุฉ "ูููู" ุงูููุตูุฏ ุจุงูุถุจุท ุงููููู ุงูุฃุตูู. <br><br><h2 style=";text-align:right;direction:rtl">  ูู ุฃูู ุชุจุฏุฃ </h2><br>  ุฏุนููุง ูุฑู ูู ุงูููุงุฑุณุฉ ุงูุนูููุฉ ููููุฉ ูุชุงุจุฉ ุฃุจุณุท ูููู JVM TI ุ ููู ููุน ูู "ุนุงูู ุงูุชุฑุญูุจ". <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;jvmti.h&gt; #include &lt;stdio.h&gt; JNIEXPORT jint JNICALL Agent_OnLoad(JavaVM* vm, char* options, void* reserved) { jvmtiEnv* jvmti; vm-&gt;GetEnv((void**) &amp;jvmti, JVMTI_VERSION_1_0); char* vm_name = NULL; jvmti-&gt;GetSystemProperty("java.vm.name", &amp;vm_name); printf("Agent loaded. JVM name = %s\n", vm_name); fflush(stdout); return 0; }</span></span></span></span></code> </pre><br>  ุงูุณุทุฑ ุงูุฃูู ุฃุถููู ููู ุงูุฑุฃุณ ููุณู.  ุจุนุฏ ุฐูู ุชุฃุชู ุงููุธููุฉ ุงูุฑุฆูุณูุฉ ุงูุชู ูุฌุจ ุชูููุฐูุง ูู ุงููููู: <code>Agent_OnLoad()</code> .  ูุณุชุฏุนู ุงูุฌูุงุฒ ุงูุธุงูุฑู ููุณู ุนูุฏูุง ูููู ุงูุนุงูู ุจุงูุชูููุฏ ุ ูููุฑุฑ ุงููุคุดุฑ ุฅูู ูุงุฆู <code>JavaVM*</code> . <br><br>  ุจุงุณุชุฎุฏุงูู ุ ููููู ุงูุญุตูู ุนูู ูุคุดุฑ ุฅูู ุจูุฆุฉ JVM TI: <code>jvmtiEnv*</code> .  ููู ุฎูุงููุง ุ ุจุฏูุฑู ุ ูุฏุนู ุจุงููุนู JVM TI- ุงููุธุงุฆู.  ุนูู ุณุจูู ุงููุซุงู ุ ุจุงุณุชุฎุฏุงู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">GetSystemProperty ุ</a> ุงูุฑุฃ ูููุฉ ุฎุงุตูุฉ ุงููุธุงู. <br><br>  ุฅุฐุง ููุช ุงูุขู ุจุชุดุบูู "hello world" ุ ุจุชูุฑูุฑ ููู dll <code>-agentpath</code> ุฅูู <code>-agentpath</code> ุ <code>-agentpath</code> ุงูุฎุท ุงูุฐู ุทุจุนู ูููููุง ูู ูุญุฏุฉ ุงูุชุญูู ูุจู ุจุฏุก ุชุดุบูู ุจุฑูุงูุฌ Java: <br><br><img src="https://habrastorage.org/webt/rl/cq/eu/rlcqeul7gpb8mahabl0ehgckro8.png"><br><br><h2 style=";text-align:right;direction:rtl">  ุฅุซุฑุงุก NPE </h2><br>  ุจูุง ุฃู hello world ููุณ ุงููุซุงู ุงูุฃูุซุฑ ุฅุซุงุฑุฉ ููุงูุชูุงู ุ ูููุฑุฌุน ุฅูู ุงุณุชุซูุงุกุงุชูุง.  ุฑูุฒ ุงููููู ุงููุงูู ุงูุฐู ูููู ุชูุงุฑูุฑ NPE ููุฌูุฏ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุนูู GitHub</a> . <br><br>  ูุฐุง ูุง <code>Agent_OnLoad()</code> ุนููู <code>Agent_OnLoad()</code> ุฅุฐุง ููุช ุฃุฑูุฏ ุฃู ุฃุทูุจ ูู ุงูุฌูุงุฒ ุงูุธุงูุฑู ุฅุฎุทุงุฑูุง ุจุฌููุน ุงูุงุณุชุซูุงุกุงุช: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">JNIEXPORT jint JNICALL </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Agent_OnLoad</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(JavaVM* vm, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params">* options, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">* reserved)</span></span></span><span class="hljs-function"> </span></span>{ jvmtiEnv* jvmti; vm-&gt;GetEnv((<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>**) &amp;jvmti, JVMTI_VERSION_1_0); jvmtiCapabilities capabilities = {<span class="hljs-number"><span class="hljs-number">0</span></span>}; capabilities.can_generate_exception_events = <span class="hljs-number"><span class="hljs-number">1</span></span>; jvmti-&gt;AddCapabilities(&amp;capabilities); jvmtiEventCallbacks callbacks = {<span class="hljs-number"><span class="hljs-number">0</span></span>}; callbacks.Exception = ExceptionCallback; jvmti-&gt;SetEventCallbacks(&amp;callbacks, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(callbacks)); jvmti-&gt;SetEventNotificationMode(JVMTI_ENABLE, JVMTI_EVENT_EXCEPTION, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre><br>  ุฃููุงู ุ ุฃุทูุจ ูู JVM TI ุงููุฏุฑุฉ ุงูููุงุจูุฉ (can_generate_exception_events).  ุณูุชุญุฏุซ ุนู ุงููุฏุฑุฉ ุจุดูู ูููุตู. <br><br>  ุงูุฎุทูุฉ ุงูุชุงููุฉ ูู ุงูุงุดุชุฑุงู ูู ุฃุญุฏุงุซ ุงูุงุณุชุซูุงุก.  ูููุง ุฃููุช JVM ุงุณุชุซูุงุกุงุช (ุจุบุถ ุงููุธุฑ ุนูุง ุฅุฐุง ูุงูุช ูุฏ ุชู ุงูุชุดุงููุง ุฃู ูุง) ุ ูุณูุชู ุงุณุชุฏุนุงุก ุฏุงูุฉ <code>ExceptionCallback()</code> . <br><br>  ุงูุฎุทูุฉ ุงูุฃุฎูุฑุฉ ูู ุงุณุชุฏุนุงุก <code>SetEventNotificationMode()</code> ูุชูููู ุชุณููู ุงูุฅุฎุทุงุฑุงุช. <br><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ูู ExceptionCallback ุ ููุฑุฑ JVM ูู ูุง ูุญุชุงุฌู ููุชุนุงูู ูุน ุงูุงุณุชุซูุงุกุงุช.</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> JNICALL </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ExceptionCallback</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(jvmtiEnv* jvmti, JNIEnv* env, jthread thread, jmethodID method, jlocation location, jobject exception, jmethodID catch_method, jlocation catch_location)</span></span></span><span class="hljs-function"> </span></span>{ jclass NullPointerException = env-&gt;FindClass(<span class="hljs-string"><span class="hljs-string">"java/lang/NullPointerException"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!env-&gt;IsInstanceOf(exception, NullPointerException)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } jclass Throwable = env-&gt;FindClass(<span class="hljs-string"><span class="hljs-string">"java/lang/Throwable"</span></span>); jfieldID detailMessage = env-&gt;GetFieldID(Throwable, <span class="hljs-string"><span class="hljs-string">"detailMessage"</span></span>, <span class="hljs-string"><span class="hljs-string">"Ljava/lang/String;"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (env-&gt;GetObjectField(exception, detailMessage) != <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> buf[<span class="hljs-number"><span class="hljs-number">32</span></span>]; <span class="hljs-built_in"><span class="hljs-built_in">sprintf</span></span>(buf, <span class="hljs-string"><span class="hljs-string">"at location %id"</span></span>, (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>) location); env-&gt;SetObjectField(exception, detailMessage, env-&gt;NewStringUTF(buf)); }</code> </pre><br></div></div><br>  ููุฌุฏ ููุง ูู ูู ูุงุฆู ุณูุณูุฉ ุงูุฑุณุงุฆู ุงูุฐู ุฃููู ุงูุงุณุชุซูุงุก (ูุคุดุฑ ุงูุชุฑุงุจุท) ูุงูููุงู ุงูุฐู ุญุฏุซ ููู ูุฐุง (ุงูุฃุณููุจ ุ ูุงููููุน) ุ ููุงุฆู ุงูุงุณุชุซูุงุก (ุงูุงุณุชุซูุงุก) ุ ุจู ูุงูููุงู ูู ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ุงูุชู ุชูุชุดู ูุฐุง ุงูุงุณุชุซูุงุก (catch_method ุ catch_location). <br><br>  ูุง ูู ููู: ูู ูุฐุง ุฑุฏ ุงูุงุชุตุงู ุ ุจุงูุฅุถุงูุฉ ุฅูู ุงููุคุดุฑ ุฅูู ุจูุฆุฉ JVM TI ุ ูุชู ุชูุฑูุฑ ุจูุฆุฉ JNI (env) ุฃูุถูุง.  ูุฐุง ูุนูู ุฃูู ูููููุง ุงุณุชุฎุฏุงู ุฌููุน ูุธุงุฆู JNI ููู.  ุฃู ุฃู JVM TI ู JNI ูุชุนุงูุดุงู ุชูุงููุง ุ ููููู ูู ููููุง ุงูุขุฎุฑ. <br><br>  ูู ุจูุฏู ูููู ุฃุณุชุฎุฏูู ุนูู ุญุฏ ุณูุงุก.  ุนูู ูุฌู ุงูุฎุตูุต ุ ูู ุฎูุงู JNI ุ ุฃุชุญูู ูู ุฃู ุงูุงุณุชุซูุงุก ุงูุฎุงุต ุจู ูู ูู ุงูููุน <code>NullPointerException</code> ุ ุซู ุฃููู ุจุงุณุชุจุฏุงู ุญูู <code>detailMessage</code> ุจุฑุณุงูุฉ ุฎุทุฃ. <br><br>  ูุธุฑูุง ูุฃู JVM ููุณูุง ุชูุฑุฑูุง ุฅูู ุงููููุน - ููุฑุณ ุงูุฑูุฒ ุงูุจุฑูุฏู ุงูุฐู ุญุฏุซ ุงูุงุณุชุซูุงุก ุ ุนูุฏุฆุฐู ุฃุถุน ูุฐุง ุงููููุน ููุง ูู ุงูุฑุณุงูุฉ: <br><br><img src="https://habrastorage.org/webt/ix/h8/pc/ixh8pcrtxcg4rcdwwlg83_gfuam.png"><br><br>  ูุดูุฑ ุงูุฑูู 66 ุฅูู ุงูููุฑุณ ูู bytecode ุญูุซ ุญุฏุซ ูุฐุง ุงูุงุณุชุซูุงุก.  ููู ุชุญููู ุงูุฑูุฒ ุงูุซุงููู ูุฏูููุง ูุฆูุจูุง: ุชุญุชุงุฌ ุฅูู ูู ุชุดููุฑ ููู ุงููุตู ูุงูุจุญุซ ุนู ุงูุชุนูููุฉ ุงูุณุงุฏุณุฉ ูุงูุณุชูู ููุญุงููุฉ ููู ูุง ูุงูุช ุชููู ุจู ... ุณูููู ูู ุงูุฑุงุฆุน ูู ุงุณุชุทุงุน ูููููุง ููุณู ุฅุธูุงุฑ ุดูุก ุฃูุซุฑ ูุงุจููุฉ ูููุฑุงุกุฉ ุงูุจุดุฑูุฉ. <br><br>  ููุน ุฐูู ุ ูู ูุฐู ุงูุญุงูุฉ ุ ูุฅู JVM TI ูุฏูู ูู ูุง ุชุญุชุงุฌู.  ุตุญูุญ ุ ุนููู ุฃู ุชุทูุจ ููุฒุงุช ุฅุถุงููุฉ ูู JVM TI: ุงุญุตู ุนูู ููุฏ ุงูุจุงูุช ูุทุฑููุฉ ุงูุจููุงุฑุฏู ุงูุซุงุจุชุฉ. <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs">jvmtiCapabilities capabilities = {<span class="hljs-number"><span class="hljs-number">0</span></span>}; capabilities.can_generate_exception_events = <span class="hljs-number"><span class="hljs-number">1</span></span>; capabilities.can_get_bytecodes = <span class="hljs-number"><span class="hljs-number">1</span></span>; capabilities.can_get_constant_pool = <span class="hljs-number"><span class="hljs-number">1</span></span>; jvmti-&gt;AddCapabilities(&amp;capabilities);</code> </pre><br>  ุณุฃููู ุงูุขู ุจุชูุฏูุฏ ExceptionCallback: ูู ุฎูุงู ูุธููุฉ JVM TI ุ <code>GetBytecodes()</code> ุณุฃุญุตู ุนูู ุงููุต ุงูุฃุณุงุณู ููุชุญูู ูู <code>GetBytecodes()</code> ูู ุฎูุงู ููุฑุณ ุงููููุน.  ูููุง ููู ุฅุฑุดุงุฏุงุช ุฑูุฒ ุงูุชุจุฏูู ุงููุจูุฑุฉ: ุฅุฐุง ูุงู ูุฐุง ูุตูููุง ุฅูู ุงูุตููู ุ ูุณุชููู ููุงู ุฑุณุงูุฉ ุฎุทุฃ ูุงุญุฏุฉ ุ ุฅุฐุง ูุงู ุงููุตูู ุฅูู ุงูุญูู ูู ุฑุณุงูุฉ ุฃุฎุฑู ุ ูุฅุฐุง ูุงูุช ุงุณุชุฏุนุงุก ุงูุฃุณููุจ ูู ุงูุซุงูุซุฉ ุ ูููุฐุง. <br><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ููุฏ ุงูุงุณุชุซูุงุก</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs">jint bytecode_count; u1* bytecodes; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (jvmti-&gt;GetBytecodes(method, &amp;bytecode_count, &amp;bytecodes) != <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (location &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; location &lt; bytecode_count) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>* message = get_exception_message(bytecodes[location]); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (message != <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) { ... env-&gt;SetObjectField(exception, detailMessage, env-&gt;NewStringUTF(buf)); } } jvmti-&gt;Deallocate(bytecodes);</code> </pre><br></div></div><br>  ูุจูู ููุท ุงุณุชุจุฏุงู ุงุณู ุงูุญูู ุฃู ุงูุทุฑููุฉ.  ููููู ุงูุญุตูู ุนูููุง ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูุชุฌูุน ุงูุซุงุจุช</a> ุ ูุงูุฐู ูุชููุฑ ูุฑุฉ ุฃุฎุฑู ุจูุถู JVM TI. <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (jvmti-&gt;GetConstantPool(holder, &amp;cpool_count, &amp;cpool_bytes, &amp;cpool) != <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> strdup(<span class="hljs-string"><span class="hljs-string">"&lt;unknown&gt;"</span></span>); }</code> </pre><br>  ุงูุชุงูู ูุฃุชู ุจุนุถ ุงูุดูุก ูู ุงูุณุญุฑ ุ ูููู ูู ุงููุงูุน ูุง ููุฌุฏ ุดูุก ุตุนุจ ุ ููุท ููููุง <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูููุงุตูุงุช</a> ุชูุณูู ููู ุงููุตู ุ ูููู ุจุชุญููู ุงููุฌููุนุฉ ุงูุฏุงุฆูุฉ ููู ููุงู ูุนุฒู ุงูุณุทุฑ - ุงุณู ุงูุทุฑููุฉ. <br><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุชุญููู ุชุฌูุน ุซุงุจุช</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs">u1* ref = get_cpool_at(cpool, get_u2(bytecodes + <span class="hljs-number"><span class="hljs-number">1</span></span>)); <span class="hljs-comment"><span class="hljs-comment">// CONSTANT_Fieldref u1* name_and_type = get_cpool_at(cpool, get_u2(ref + 3)); // CONSTANT_NameAndType u1* name = get_cpool_at(cpool, get_u2(name_and_type + 1)); // CONSTANT_Utf8 size_t name_length = get_u2(name + 1); char* result = (char*) malloc(name_length + 1); memcpy(result, name + 3, name_length); result[name_length] = 0;</span></span></code> </pre><br></div></div><br>  ููุทุฉ ูููุฉ ุฃุฎุฑู: ุจุนุถ ูุธุงุฆู JVM TI ุ ุนูู ุณุจูู ุงููุซุงู <code>GetConstantPool()</code> ุฃู <code>GetBytecodes()</code> ุ ุชุฎุตุต ุจููุฉ ูุนููุฉ ูู ุงูุฐุงูุฑุฉ ุงูุฃุตููุฉ ุ ูุงูุชู ูุฌุจ ุชุญุฑูุฑูุง ุนูุฏ ุงูุงูุชูุงุก ูู ุงูุนูู ูุนูุง. <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs">jvmti-&gt;Deallocate(cpool);</code> </pre><br>  ูู ุจุชุดุบูู ุงูุจุฑูุงูุฌ ุงููุตุฏุฑ ุจุงุณุชุฎุฏุงู ุงูุนุงูู ุงูููุณุน ุงูุฎุงุต ุจูุง ุ ููููุง ููู ูุตู ูุฎุชูู ุชูุงููุง ุนู ุงูุงุณุชุซูุงุก: ูุดูุฑ ุฅูู ุฃููุง ุฃุทูููุง ุนูู ุงูุฃุณููุจ longValue () ุนูู ุงููุงุฆู ุงููุงุฑุบ. <br><br><img src="https://habrastorage.org/webt/8d/ge/-d/8dge-d_mtmqpdesbk6vm4nwolna.png"><br><br><h2 style=";text-align:right;direction:rtl">  ุชุทุจููุงุช ุฃุฎุฑู </h2><br>  ุจุดูู ุนุงู ุ ุบุงูุจูุง ูุง ูุฑูุฏ ุงููุทูุฑูู ุงูุชุนุงูู ูุน ุงูุงุณุชุซูุงุกุงุช ุจุทุฑููุชูู ุงูุฎุงุตุฉ.  ุนูู ุณุจูู ุงููุซุงู ุ ูู ุจุฅุนุงุฏุฉ ุชุดุบูู JVM ุชููุงุฆููุง ูู ุญุงูุฉ <code>StackOverflowError</code> . <br><br>  ูููู ููู ูุฐู ุงูุฑุบุจุฉ ุ ูุธุฑูุง ูุฃู <code>StackOverflowError</code> ูู ููุณ ุงูุฎุทุฃ ุงููุงุชู ุงูุฐู <code>OutOfMemoryError</code> ุ ุจุนุฏ ุญุฏูุซู ุ ูู ูุนุฏ ูู ุงููููู ุถูุงู ุงูุชุดุบูู ุงูุตุญูุญ ููุจุฑูุงูุฌ.  ุฃู ุ ุนูู ุณุจูู ุงููุซุงู ุ ุฃุญูุงููุง ูุชุญููู ุงููุดููุฉ ุ ุฃุฑูุฏ ุชููู ุชูุฑูุบ ูุคุดุฑ ุชุฑุงุจุท ุฃู ุชูุฑูุบ ูููุฉ ุงูุฐุงูุฑุฉ ุงููุคูุชุฉ ุนูุฏ ุญุฏูุซ ุงุณุชุซูุงุก. <br><br><img src="https://habrastorage.org/webt/hh/8b/zy/hh8bzys2bji12vte4g_fsmlfaky.jpeg"><br><br>  ูู ุงูุฅูุตุงู ุ ูุฏู IBM JDK ูุฐู ุงููุฑุตุฉ ุฎุงุฑุฌ ุงูุตูุฏูู.  ููููุง ูุนุฑู ุงูุขู ุฃูู ุจุงุณุชุฎุฏุงู ูููู JVM TI ุ ููููู ุชุทุจูู ููุณ ุงูุดูุก ูู HotSpot.  ูููู ุงูุงุดุชุฑุงู ูู ุฑุฏ ุงูุงุชุตุงู ุงูุงุณุชุซูุงุฆู ูุชุญููู ุงูุงุณุชุซูุงุก.  ูููู ููููุฉ ุฅุฒุงูุฉ ุชูุฑูุบ ุงูุตูุญุงุช ุฃู ุชูุฑูุบ ูููุฉ ุงูุฐุงูุฑุฉ ุงููุคูุชุฉ ูู ูููููุงุ  ูุญุชูู JVM TI ุนูู ูู ูุง ุชุญุชุงุฌู ููุฐู ุงูุญุงูุฉ: <br><br><img src="https://habrastorage.org/webt/yp/jj/5o/ypjj5o9xn9m7tmhdzmh-z8bo2tk.jpeg"><br><br>  ููุณ ูู ุงููุฑูุญ ุฌุฏูุง ุชูููุฐ ุงูุขููุฉ ุงููุงููุฉ ูุชุฌุงูุฒ ุงููููุฉ ูุฅูุดุงุก ุชูุฑูุบ.  ููููู ุณูู ุฃุดุงุฑู ุณุฑ ููููุฉ ุฌุนููุง ุฃุณูู ูุฃุณุฑุน.  ุตุญูุญ ุ ูู ูุนุฏ ูุฐุง ูุฏุฑุฌูุง ูู JVM TI ุงูููุงุณู ุ ููููู ุงูุชุฏุงุฏ ุฎุงุต ูู Hotspot. <br><br>  ุชุญุชุงุฌ ุฅูู ุชูุตูู ููู ุงูุฑุฃุณ <a href="">jmm.h</a> ูู ูุตุงุฏุฑ HotSpot ูุงุณุชุฏุนุงุก ูุธููุฉ <code>JVM_GetManagement()</code> : <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"jmm.h"</span></span></span><span class="hljs-meta"> JNIEXPORT void* JNICALL JVM_GetManagement(jint version); void JNICALL ExceptionCallback(jvmtiEnv* jvmti, JNIEnv* env, ...) { JmmInterface* jmm = (JmmInterface*) JVM_GetManagement(JMM_VERSION_1_0); jmm-&gt;DumpHeap0(env, env-&gt;NewStringUTF(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"dump.hprof"</span></span></span><span class="hljs-meta">), JNI_FALSE); }</span></span></code> </pre><br>  ุณูููู ุจุฅุฑุฌุงุน ูุคุดุฑ ุฅูู ูุงุฌูุฉ ุฅุฏุงุฑุฉ HotSpot ุ ูุงูุชู ุณุชููู ูู ููุงููุฉ ูุงุญุฏุฉ ุจุฅูุดุงุก ุชูุฑูุบ ูููุฉ ุฃู ุชูุฑูุบ ูุคุดุฑ ุชุฑุงุจุท.  ูููู ุงูุนุซูุฑ ุนูู ุงูุฑูุฒ ุงููุงูู ูููุซุงู ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุฅุฌุงุจุชู</a> ุนูู Stack Overflow. <br><br>  ุจุทุจูุนุฉ ุงูุญุงู ุ ูุง ููููู ุงูุชุนุงูู ูุน ุงูุงุณุชุซูุงุกุงุช ููุท ุ ูููู ุฃูุถูุง ูุฌููุนุฉ ูู ุงูุฃุญุฏุงุซ ุงููุชููุนุฉ ุงูุฃุฎุฑู ุงููุฑุชุจุทุฉ ุจุนูููุฉ JVM: ุจุฏุก / ุฅููุงู ูุคุดุฑุงุช ุงูุชุฑุงุจุท ุ ูุฆุงุช ุงูุชุญููู ุ ุชุฌููุน ุงูููุงูุฉ ุ ุฃุณุงููุจ ุงูุชุฌููุน ุ ุทุฑู ุงูุฏุฎูู / ุงูุฎุฑูุฌ ุ ุญุชู ุงููุตูู ุฅูู ุฃู ุชุนุฏูู ูุฌุงูุงุช ูุญุฏุฏุฉ ูู ูุงุฆูุงุช Java. <br><br>  ูุฏู ูุซุงู ุนูู ูููู <a href="">vmtrace</a> ุขุฎุฑ ูุดุชุฑู ูู ุงูุนุฏูุฏ ูู ุฃุญุฏุงุซ JVM TI ุงูููุงุณูุฉ <a href="">ููุณุฌููุง</a> .  ุฅุฐุง ููุช ุจุชุดุบูู ุจุฑูุงูุฌ ุจุณูุท ูุน ูุฐุง ุงููููู ุ ูุณูู ุฃุญุตู ุนูู ุณุฌู ููุตู ุ ูุงูุฐู ุนูุฏ ุงูุงูุชูุงุก ูู ุฐูู ุ ูุน ุงูุทูุงุจุน ุงูุฒูููุฉ: <br><br><img src="https://habrastorage.org/webt/wu/he/ci/wuhecifrgrrkleshnnkqx6hd9ew.jpeg"><br><br>  ููุง ุชุฑูู ุ ูุทุจุงุนุฉ ุนุงูู ุงูุชุฑุญูุจ ุจุจุณุงุทุฉ ุ ูุชู ุชุญููู ูุฆุงุช ุงููุฆุงุช ุ ููุชู ุฅูุดุงุก ุงูุนุดุฑุงุช ููุฆุงุช ุงูุทุฑู.  ูุตุจุญ ูู ุงููุงุถุญ ููุงุฐุง ุฌุงูุง ุชุณุชุบุฑู ููุชุง ุทูููุง ูุชุดุบูู.  ุงุณุชุบุฑู ูู ุดูุก ุนู ูู ุดูุก ุฃูุซุฑ ูู ูุงุฆุชู ูููู ุซุงููุฉ. <br><br><h2 style=";text-align:right;direction:rtl">  ูุง ูููู ุฃู ุชูุนูู JVM TI </h2><br>  ุจุงูุฅุถุงูุฉ ุฅูู ุงูุชุนุงูู ูุน ุงูุฃุญุฏุงุซ ุ ูุญุชูู JVM TI ุนูู ูุฌููุนุฉ ูู ุงูููุฒุงุช ุงูุฃุฎุฑู.  ูููู ุชูุณูููุง ุฅูู ูุฌููุนุชูู. <br><br>  ุฃุญุฏููุง ุฅูุฒุงูู ุ ูุฌุจ ุนูู ุฃู JVM ูุฏุนู JVM TI ุชูููุฐู.  ูุชุถูู ุฐูู ุนูููุงุช ุชุญููู ุงูุฃุณุงููุจ ูุงูุญููู ูุงูุชุฏููุงุช ูุงููุฏุฑุฉ ุนูู ุฅุถุงูุฉ ูุฆุงุช ุฌุฏูุฏุฉ ุฅูู classpath ููุง ุฅูู ุฐูู. <br><br>  ููุงู ููุฒุงุช ุงุฎุชูุงุฑูุฉ ุชุชุทูุจ ุทูุจ ูุฏุฑุงุช ุฃูููุฉ.  JVM ููุณ ูุทููุจูุง ูุฏุนููู ุฌููุนูุง ุ ููุน ุฐูู ุ ูููู HotSpot ุจุชูููุฐ ุงูููุงุตูุงุช ุจุงููุงูู.  ุชููุณู ุงูููุฒุงุช ุงูุงุฎุชูุงุฑูุฉ ุฅูู ูุฌููุนุชูู ูุฑุนูุชูู: ุชูู ุงูุชู ูุง ูููู ุชูุตูููุง ุฅูุง ูู ุจุฏุงูุฉ JVM (ุนูู ุณุจูู ุงููุซุงู ุ ุงููุฏุฑุฉ ุนูู ุชุนููู ููุทุฉ ุชููู ุฃู ุชุญููู ุงููุชุบูุฑุงุช ุงููุญููุฉ) ุ ูุชูู ุงูุชู ูููู ุชูุตูููุง ูู ุฃู ููุช (ุนูู ูุฌู ุงูุฎุตูุต ุ ุงูุฑูุฒ ุงููุฑุนู ุฃู ุงูุชุฌูุน ุงูุซุงุจุช ุ ูุงูุฐู ูููููู ุงููุณุชุฎุฏูุฉ ุฃุนูุงู). <br><br><img src="https://habrastorage.org/webt/ee/9e/oo/ee9eooqcrrdowlrc1rvqmfuhjs0.jpeg"><br><br>  ูุฏ ุชูุงุญุธ ุฃู ูุงุฆูุฉ ุงูููุฒุงุช ูุดุงุจูุฉ ุฌุฏูุง ููุฏุฑุงุช ูุตุญุญ ุงูุฃุฎุทุงุก.  ูู ุงููุงูุน ุ ูุฅู ูุตุญุญ ุฃุฎุทุงุก Java ููุณ ุฃูุซุฑ ูู ุญุงูุฉ ุฎุงุตุฉ ูู ูููู JVM TI ุ ุงูุฐู ูุณุชููุฏ ูู ูู ูุฐู ุงููุฏุฑุงุช ููุทูุจ ุฌููุน ุงููุฏุฑุงุช. <br><br>  ูุชู ูุตู ุงูุฅููุงูุงุช ุนู ุชูู ุงูุชู ูููู ุชูููููุง ูู ุฃู ููุช ุ ูุชูู ุงูุชู ุชููู ููุท ูู ููุช ุงูุชูููุฏ ุ ุนู ูุตุฏ.  ููุณุช ูู ุงูููุฒุงุช ูุฌุงููุฉ ุ ูุจุนุถูุง ูุญูู ุงููููุงุช ุงูุนุงูุฉ. <br><br>  ุฅุฐุง ูุงู ูู ุดูุก ูุงุถุญูุง ูุน ุงููููุงุช ุงูุนุงูุฉ ุงููุจุงุดุฑุฉ ุงููุตุงุญุจุฉ ูุงุณุชุฎุฏุงู ุงูููุฒุฉ ุ ูููุงู ุญุชู ุฃูู ูุถูุญูุง ุบูุฑ ูุจุงุดุฑ ูุธูุฑ ุญุชู ุฅุฐุง ููุช ูุง ุชุณุชุฎุฏู ูุฐู ุงูููุฒุฉ ุ ูููู ุจุจุณุงุทุฉ ูู ุฎูุงู ุงููุฏุฑุงุช ุงูุชู ุชุนูู ุฃููุง ุณุชููู ูุทููุจุฉ ูู ููุช ูุง ูู ุงููุณุชูุจู.  ููุฑุฌุน ุฐูู ุฅูู ุญูููุฉ ุฃู ุงูุฌูุงุฒ ุงูุธุงูุฑู ููููู ุชุฌููุน ุงูุดูุฑุฉ ุจุดูู ูุฎุชูู ุฃู ุฅุถุงูุฉ ุงุฎุชุจุงุฑุงุช ุฅุถุงููุฉ ุฅูู ููุช ุงูุชุดุบูู. <br><br>  ุนูู ุณุจูู ุงููุซุงู ุ ุชุคุฏู ุงููุฏุฑุฉ ุงููุฏุฑูุณุฉ ุจุงููุนู ููุงุดุชุฑุงู ูู ุงูุงุณุชุซูุงุกุงุช (can_generate_exception_events) ุฅูู ุญูููุฉ ุฃู ุฌููุน ุงูุงุณุชุซูุงุกุงุช ุงูุชู ูุชู ุทุฑุญูุง ุณูุชู ุจุทูุฆูุง.  ูู ุญูุซ ุงููุจุฏุฃ ุ ูุฐุง ููุณ ูุฎูููุง ุฌุฏูุง ุ ูุฃู ุงูุงุณุชุซูุงุกุงุช ุดูุก ูุงุฏุฑ ูู ุจุฑูุงูุฌ Java ุฌูุฏ. <br><br>  ุงููุถุน ูุน ุงููุชุบูุฑุงุช ุงููุญููุฉ ูู ุฃุณูุฃ ููููุง.  ุจุงููุณุจุฉ ุฅูู can_access_local_variables ุ ุงูุชู ุชุณูุญ ูู ุจุงูุญุตูู ุนูู ููู ุงููุชุบูุฑุงุช ุงููุญููุฉ ูู ุฃู ููุช ุ ุชุญุชุงุฌ ุฅูู ุชุนุทูู ุจุนุถ ุงูุชุญุณููุงุช ุงููููุฉ.  ุนูู ูุฌู ุงูุฎุตูุต ุ ุชุชููู Escape Analysis ุชูุงููุง ุนู ุงูุนูู ุ ููุง ูููู ุฃู ูุคุฏู ุฅูู ุฒูุงุฏุฉ ููุญูุธุฉ: ุงุนุชูุงุฏูุง ุนูู ุงูุชุทุจูู ุ 5-10ูช. <br><br>  ููู ููุง ุงูุงุณุชูุชุงุฌ: ุฅุฐุง ููุช ุจุชุดุบูู Java ูุน ุชุดุบูู ุนุงูู ุงูุชุตุญูุญ ุ ุญุชู ุฏูู ุงุณุชุฎุฏุงูู ุ ุณูุชู ุชุดุบูู ุงูุชุทุจููุงุช ุจุดูู ุฃุจุทุฃ.  ุนูู ุฃู ุญุงู ุ ุฅู ุชุถููู ุนุงูู ุชุตุญูุญ ูู ุงูุฅูุชุงุฌ ููุณ ููุฑุฉ ุฌูุฏุฉ. <br><br>  ููุงู ุนุฏุฏ ูู ุงูููุฒุงุช ุ ุนูู ุณุจูู ุงููุซุงู ุ ุชุนููู ููุทุฉ ุชููู ุฃู ุชุชุจุน ุฌููุน ุงููุฏุฎูุงุช / ุงููุฎุฑุฌุงุช ูู ุฅุญุฏู ุงูุทุฑู ุ ุชุญูู ุชูุงููู ุฃูุซุฑ ุฎุทูุฑุฉ ุจูุซูุฑ.  ุนูู ูุฌู ุงูุฎุตูุต ุ ุชุนูู ุจุนุถ ุฃุญุฏุงุซ JVM TI (FieldAccess ู MethodEntry / Exit) ููุท ูู ุงููุชุฑุฌู ุงูููุฑู. <br><br><h2 style=";text-align:right;direction:rtl">  ูููู ูุงุญุฏ ูู ุฌูุฏ ุ ูุงุซููู ูู ุฃูุถู </h2><br>  ููููู ุชูุตูู ุนุฏุฉ ุนูุงูู ุจุนูููุฉ ูุงุญุฏุฉ ุนู ุทุฑูู ุชุญุฏูุฏ ุงูุนุฏูุฏ ูู ูุนููุงุช <code>-agentpath</code> .  ุณูููู ููู ุดุฎุต ุจูุฆุฉ JVM TI ุงูุฎุงุตุฉ ุจู.  ูุฐุง ูุนูู ุฃูู ูููู ููุฌููุน ุงูุงุดุชุฑุงู ูู ูุฏุฑุงุชูู ูุงุนุชุฑุงุถ ุฃุญุฏุงุซูู ุจุดูู ูุณุชูู. <br><br>  ูุฅุฐุง ุงุดุชุฑู ููููุงู ูู ุญุฏุซ Breakpoint ุ ููู ุฃุญุฏููุง ุชู ุชุนููู ููุทุฉ ุชููู ูู ุจุนุถ ุงูุทุฑู ุ ูุนูุฏ ุชูููุฐ ูุฐู ุงูุทุฑููุฉ ุ ูู ุณูุชููู ุงููููู ุงูุซุงูู ุงูุญุฏุซุ <br><br>  ูู ุงููุงูุน ุ ูุง ูููู ุฃู ูุญุฏุซ ูุซู ูุฐุง ุงููููู (ุนูู ุงูุฃูู ูู HotSpot JVM).  ูุฃู ููุงู ุจุนุถ ุงููุฏุฑุงุช ุงูุชู ูููู ุฃู ููุชูููุง ุฃุญุฏ ุงููููุงุก ููุท ูู ุฃู ููุช ูุญุฏุฏ.  ูุชุดูู ูุฐู breakpoint_events ุนูู ูุฌู ุงูุฎุตูุต.  ูุฐูู ุ ุฅุฐุง ุทูุจ ุงูุนููู ุงูุซุงูู ููุณ ุงูุฅููุงููุฉ ุ ูุณูุชููู ุฎุทุฃู ูู ุงูุงุณุชุฌุงุจุฉ. <br><br>  ูุฐุง ุงุณุชูุชุงุฌ ููู: ูุฌุจ ุนูู ุงููููู ุงูุชุญูู ุฏุงุฆููุง ูู ูุชูุฌุฉ ุทูุจ ุงูุฅููุงููุงุช ุ ุญุชู ุฅุฐุง ููุช ุชุนูู ุนูู HotSpot ูุชุนูู ุฃู ุฌููุนูุง ูุชููุฑุฉ.  ูุง ุชุฐูุฑ ููุงุตูุงุช JVM TI ุดูุฆูุง ุนู ุงููุฏุฑุงุช ุงูุญุตุฑูุฉ ุ ูููู HotSpot ูุฏูู ููุฒุฉ ุชูููุฐ ูู ูุฐุง ุงููุจูู. <br><br>  ุตุญูุญ ุ ุงูุนุฒูุฉ ูููู ูุง ูุนูู ุฏุงุฆูุง ุชูุงูุง.  ุฎูุงู ุชุทููุฑ ุจุฑูุงูุฌ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">async-profiler ุ</a> ุตุงุฏูุช ูุฐู ุงููุดููุฉ: ุนูุฏูุง ูููู ูุฏููุง ููููุงู ููุทูุจ ุฃุญุฏููุง ุฅูุดุงุก ุฃุญุฏุงุซ ุชุฌููุน ุงูุทุฑููุฉ ุ ูุชููู ุฌููุน ุงููููุงุก ูุฐู ุงูุฃุญุฏุงุซ.  ุจุงูุทุจุน ุ ููุช ุจุชูุฏูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุฎุทุฃ</a> ุ ููู ูุฌุจ ุฃู ุชุถุน ูู ุงุนุชุจุงุฑู ุฃู ุงูุฃุญุฏุงุซ ุงูุชู ูุง ุชุชููุนูุง ูุฏ ุชุญุฏุซ ูู ููููู. <br><br><h2 style=";text-align:right;direction:rtl">  ุงูุงุณุชุฎุฏุงู ูู ุงูุจุฑูุงูุฌ ุงูุนุงุฏู </h2><br>  ูุฏ ูุจุฏู JVM TI ุดูุฆูุง ูุญุฏุฏูุง ุฌุฏูุง ููุตุญุญุงุช ุงูุฃุฎุทุงุก ูุงูููุงุทุนูู ุ ููู ูููู ุงุณุชุฎุฏุงูู ุฃูุถูุง ูู ุจุฑูุงูุฌ Java ุนุงุฏู.  ุงููุธุฑ ูู ูุซุงู. <br><br>  ูููุฐุฌ ุงูุจุฑูุฌุฉ ุงูุชูุงุนููุฉ ูุงุณุน ุงูุงูุชุดุงุฑ ุงูุขู ุนูุฏูุง ูููู ูู ุดูุก ุบูุฑ ูุชุฒุงูู ุ ูููู ููุงู ูุดููุฉ ูู ูุฐุง ุงููููุฐุฌ. <br><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TaskRunner</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">good</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ CompletableFuture.runAsync(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AsyncTask(GOOD)); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bad</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ CompletableFuture.runAsync(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AsyncTask(BAD)); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{ good(); bad(); Thread.sleep(<span class="hljs-number"><span class="hljs-number">200</span></span>); } }</code> </pre><br>  ุฃุฑูุถ ูููุชูู ุบูุฑ ูุชุฒุงููุชูู ุชุฎุชููุงู ููุท ูู ุงููุนููุงุช.  ูุฅุฐุง ุญุฏุซ ุฎุทุฃ ูุง ุ ูุชู ุฑูุน ุงุณุชุซูุงุก: <br><br><img src="https://habrastorage.org/webt/ds/me/wx/dsmewxe5rd4lzgq8fgjxn42zh0e.png"><br><br>  ูู ุชุชุจุน ุงูููุฏุณ ุ ูู ุบูุฑ ุงููุงุถุญ ุชูุงููุง ุฃู ูู ูุฐู ุงูููุงู ุชุณุจุจุช ูู ุงููุดููุฉ.  ูุฃู ุงูุงุณุชุซูุงุก ูุญุฏุซ ูู ุณูุณูุฉ ุฑุณุงุฆู ูุฎุชููุฉ ุชูุงููุง ุ ุญูุซ ูุง ููุฌุฏ ูุฏููุง ุณูุงู.  ููู ูููู ูู ุฃู ูููุฉุ <br><br>  ูุฃุญุฏ ุงูุญููู ุ ููููู ุฅุถุงูุฉ ูุนูููุงุช ุญูู ุงูููุงู ุงูุฐู ุฃูุดุฃูุงู ููู ุฅูู ูููุดุฆ ูููุชูุง ุบูุฑ ุงููุชุฒุงููุฉ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AsyncTask</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String arg)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.arg = arg; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.location = getLocation(); }</code> </pre><br>  ููุฐุง ูู ุ ุชุฐูุฑ ุงููููุน - ููุงู ูุญุฏุฏ ูู ุงูููุฏ ุ ูุตููุงู ุฅูู ุงูุณุทุฑ ูู ุญูุซ ุชู ุงุณุชุฏุนุงุก ุงูููุดุฆ.  ููู ุญุงูุฉ ุงุณุชุซูุงุก ุงูุชุนูุฏ ุจุฐูู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> n = Integer.parseInt(arg); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Throwable e) { System.err.println(<span class="hljs-string"><span class="hljs-string">"ParseTask failed at "</span></span> + location); e.printStackTrace(); }</code> </pre><br>  ุงูุขู ุ ุนูุฏ ุญุฏูุซ ุงุณุชุซูุงุก ุ ุณูุฑู ุฃู ูุฐุง ุญุฏุซ ุนูู ุงูุณุทุฑ 14 ูู TaskRunner (ุญูุซ ูุชู ุฅูุดุงุก ุงููููุฉ ุจุงุณุชุฎุฏุงู ูุนููุฉ BAD): <br><br><img src="https://habrastorage.org/webt/v-/tq/0q/v-tq0qa-bnlkakz8dnzxhrjfqvo.png"><br><br>  ูููู ููู ุชุญุตู ุนูู ุงูููุงู ูู ุงูููุฏ ุงูุฐู ูุชู ุงุณุชุฏุนุงุก ุงูููุดุฆ ูููุ  ูุจู ุงูุฅุตุฏุงุฑ 9 ูู Java ุ ูุงูุช ููุงู ุงูุทุฑููุฉ ุงููุงููููุฉ ุงููุญูุฏุฉ ููููุงู ุจุฐูู: ุงูุญุตูู ุนูู ุชุชุจุน ููุฏุณ ุ ูุชุฎุทู ุจุนุถ ุงูุฅุทุงุฑุงุช ุบูุฑ ุงูููุงุฆูุฉ ุ ูุณูููู ุงูููุงู ุงูุฐู ูุทูู ุนููู ุงูููุฏ ูุฏููุง ุฃูู ููููุงู ูู ุงูููุฏุณ. <br><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-function"><span class="hljs-function">String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getLocation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ StackTraceElement caller = Thread.currentThread().getStackTrace()[<span class="hljs-number"><span class="hljs-number">3</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> caller.getFileName() + <span class="hljs-string"><span class="hljs-string">':'</span></span> + caller.getLineNumber(); }</code> </pre><br>  ูููู ููุงู ูุดููุฉ.  ุงูุญุตูู ุนูู StackTrace ุงููุงูู ุจุทูุก ุฌุฏูุง.  ูุฏู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุชูุฑูุฑ</a> ูุงูู ููุฑุณ ููุฐุง. <br><br>  ูู ุชููู ูุฐู ูุดููุฉ ูุจูุฑุฉ ุฅุฐุง ุญุฏุซ ุฐูู ูุงุฏุฑูุง.  ูููู ุ ุนูู ุณุจูู ุงููุซุงู ุ ูุฏููุง ุฎุฏูุฉ ููุจ - ุงููุงุฌูุฉ ุงูุฃูุงููุฉ ุงูุชู ุชูุจู ุทูุจุงุช HTTP.  ูุฐุง ุชุทุจูู ุฑุงุฆุน ุ ููุงููู ุงูุฃุณุทุฑ ูู ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ.  ูููุงุทูุงุน ุนูู ุฃุฎุทุงุก ุงูุนุฑุถ ุ ูุณุชุฎุฏู ุขููุฉ ููุงุซูุฉ: ูู ููููุงุช ุงูุนุฑุถ ุ ูุชุฐูุฑ ุงูููุงู ุงูุฐู ุชู ุฅูุดุงุคู ููู.  ูุฏููุง ุงูููุงููู ูู ูุฐู ุงูููููุงุช ุ ูุฐูู ูุฅู ุงูุญุตูู ุนูู ุฌููุน ุขุซุงุฑ ุงูููุฏุณ ูุณุชุบุฑู ููุชูุง ููููุณูุง ูุจุฏุก ุงูุชุทุจูู ุ ูููุณ ุฏูููุฉ ูุงุญุฏุฉ ููุท.  ูุฐูู ุ ุชู ุชุนุทูู ูุฐู ุงูููุฒุฉ ูุณุจููุง ูู ุงูุฅูุชุงุฌ ุ ุนูู ุงูุฑุบู ูู ุฃู ุชุญููู ุงููุดููุงุช ุถุฑูุฑู ูู ุงูุฅูุชุงุฌ. <br><br>  ูุฏู Java 9 ุทุฑููุฉ ุฌุฏูุฏุฉ ูุชุฌุงูุฒ ูุฌููุนุงุช ุงูุจูุงูุงุช: StackWalker ุ ูุงูุชู ูู ุฎูุงู ูุงุฌูุฉ ุจุฑูุฌุฉ ุชุทุจููุงุช Stream ูููู ุฃู ุชูุนู ูู ูุฐุง ุจุงููุณู ุ ุนูุฏ ุงูุทูุจ.  ููุฐุง ูุนูู ุฃูู ูููููุง ุชุฎุทู ุงูุนุฏุฏ ุงูุตุญูุญ ูู ุงูุฅุทุงุฑุงุช ูุงูุญุตูู ุนูู ุฅุทุงุฑ ูุงุญุฏ ููุท ููููุง. <br><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-function"><span class="hljs-function">String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getLocation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> StackWalker.getInstance().walk(s -&gt; { StackWalker.StackFrame frame = s.skip(<span class="hljs-number"><span class="hljs-number">3</span></span>).findFirst().get(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> frame.getFileName() + <span class="hljs-string"><span class="hljs-string">':'</span></span> + frame.getLineNumber(); }); }</code> </pre><br>  ุฅูู ูุนูู ุจุดูู ุฃูุถู ููููุงู ูู ุงูุญุตูู ุนูู ุชุชุจุน ููุฏุณ ูุงูู ุ ูููู ููุณ ุจุชุฑุชูุจ ูู ุงูุญุฌู ุฃู ุญุชู ุนุฏุฉ ูุฑุงุช.  ูู ุญุงูุชูุง ุ ุงุชุถุญ ุฃูู ุฃุณุฑุน ุจูุญู ูุฑุฉ ููุตู: <br><br><img src="https://habrastorage.org/webt/v8/bz/rk/v8bzrkf8szriwvghilzvhrddtzo.jpeg"><br><br>  ููุงู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุดููุฉ ูุนุฑููุฉ</a> ูู ุงูุชูููุฐ ุงูุฃูุซู ูู StackWalker ุ ูุนูู ุงูุฃุฑุฌุญ ุฃูู ุณูุชู ุฅุตูุงุญู ูู JDK 13. ููู ูุฑุฉ ุฃุฎุฑู ุ ูุง ุงูุฐู ูุฌุจ ุฃู ููุนูู ุงูุขู ูู Java 8 ุ ุญูุซ StackWalker ููุณ ุจุทูุฆูุง ุญุชูุ <br><br>  ูุชุฃุชู JVM TI ููุฅููุงุฐ ูุฑุฉ ุฃุฎุฑู.  ููุงู ูุธููุฉ <code>GetStackTrace()</code> ูููููุง ุงูููุงู ุจูู ูุง ุชุญุชุงุฌู: ุงูุญุตูู ุนูู ุฌุฒุก ูู ุชุชุจุน ููุฏุณ ุจุทูู ูุนูู ุ ุจุฏุกูุง ูู ุงูุฅุทุงุฑ ุงููุญุฏุฏ ุ ููุง ุชูุนู ุดูุฆูุง ุฃูุซุฑ. <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs">GetStackTrace(jthread thread, jint start_depth, jint max_frame_count, jvmtiFrameInfo* frame_buffer, jint* count_ptr)</code> </pre><br>  ูุจูู ุณุคุงู ูุงุญุฏ ููุท: ููููุฉ ุงุณุชุฏุนุงุก ูุธููุฉ JVM TI ูู ุจุฑูุงูุฌ Java ุงูุฎุงุต ุจูุงุ  ุชูุงููุง ูุซู ุฃู ุทุฑููุฉ ุฃุตููุฉ ุฃุฎุฑู: ูู ุจุชุญููู ุงูููุชุจุฉ ุงูุฃุตููุฉ ุจุงุณุชุฎุฏุงู <code>System.loadLibrary()</code> ุ ุญูุซ ุณูููู ุชุทุจูู JNI ูุฃุณููุจูุง. <br><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StackFrame</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">native</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getLocation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> depth)</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> { System.loadLibrary(<span class="hljs-string"><span class="hljs-string">"stackframe"</span></span>); } }</code> </pre><br>  ูููู ุงูุญุตูู ุนูู ูุคุดุฑ ุฅูู ุจูุฆุฉ JVM TI ููุณ ููุท ูู Agent_OnLoad () ุ ูููู ุฃูุถูุง ุฃุซูุงุก ุชุดุบูู ุงูุจุฑูุงูุฌ ุ ูููุชุงุจุนุฉ ุงุณุชุฎุฏุงูู ูู ุฎูุงู ุทุฑู JNI ุงูุฃุตููุฉ ุงูุนุงุฏูุฉ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">JNIEXPORT jstring JNICALL </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Java_StackFrame_getLocation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(JNIEnv* env, jclass unused, jint depth)</span></span></span><span class="hljs-function"> </span></span>{ jvmtiFrameInfo frame; jint count; jvmti-&gt;GetStackTrace(<span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, depth, <span class="hljs-number"><span class="hljs-number">1</span></span>, &amp;frame, &amp;count);</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฐุง ุงูููุฌ ุฃุณุฑุน ุจุงููุนู ุนุฏุฉ ูุฑุงุช ูุณูุญ ููุง ุจุญูุธ ุนุฏุฉ ุฏูุงุฆู ูู ุจุฏุก ุงูุชุทุจูู: </font></font><br><br><img src="https://habrastorage.org/webt/ia/-u/au/ia-uauyvrmwlvh84rh84rqqwu1s.jpeg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุตุญูุญ ุ ูุน ุชุญุฏูุซ JDK ุงูุชุงูู ุ ููุฏ ููุฌุฆูุง ุจุญูููุฉ ุฃู ุงูุชุทุจูู ุจุฏุฃ ูุฌุฃุฉ ูู ุงูุจุฏุก ุจุจุทุก ุดุฏูุฏ. ุฃุฏู ุงูุชุญููู ุฅูู ููุชุจุฉ ุฃุตููุฉ ูุชููู ุขุซุงุฑ ุงูููุฏุณ. ููู ุ ููุฏ ุชูุตููุง ุฅูู ุงุณุชูุชุงุฌ ููุงุฏู ุฃู ุงูุฎุทุฃ ูู ูุธูุฑ ูู ููุงููุง ุ ูููู ูู JDK. ุจุฏุกูุง ูู JDK 8u112 ุ ุฃุตุจุญุช ุฌููุน ูุธุงุฆู JVM TI ุงูุชู ุชุนูู ูุน ุงูุฃุณุงููุจ (GetMethodName ู GetMethodDeclaringClass ููุง ุฅูู ุฐูู) ุจุทูุฆุฉ ููุบุงูุฉ. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุฏ ุจุฏุฃุช ุจุนุถ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุฃุฎุทุงุก</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุ ูููุช ุจุฅุฌุฑุงุก ุงููููู ูู ุงูุจุญุซ ุ ูุงูุชุดูุช ูุตุฉ ูุถุญูุฉ: ุฃุถุงูุช ุจุนุถ ูุธุงุฆู JVM TI ุงุฎุชุจุงุฑุงุช ุชุตุญูุญ ุงูุฃุฎุทุงุก ุ ููููู ูู ุฃูุงุญุธ ุฃููุง ุงุณุชูุฏุนูุช ูู ุฑูุฒ ุงูุฅูุชุงุฌ ุฃูุถูุง. ูู ูุชู ุงูุนุซูุฑ ุนูู ุณููุงุฑูู ุงูุงุณุชุฎุฏุงู ูุฐุง ุ ูุฃูู ูู ููู ููุฌูุฏูุง ูู ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ุงููุตุฏุฑ ูู C ++ ุ ูููู ูู ุงูููู</font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jvmtiEnter.xsl</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุฎูู: ุฃุซูุงุก ุชุฌููุน HotSpot ุ ูุชู ุฅูุดุงุก ุฌุฒุก ูู ุงูููุฏ ุงููุตุฏุฑู ุณุฑูุนูุง ูู ุฎูุงู ุชุญููู XSLT. </font><font style="vertical-align: inherit;">ูุฐู ูู ุงูุทุฑููุฉ ุงูุชู ุนุงุฏุช ุจูุง ุงููุคุณุณุฉ ุฅูู HotSpot. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุงุฐุง ูููู ุฃู ูููู ุงูุญูุ </font><font style="vertical-align: inherit;">ููุท ูุง ุชุณุชุฏุนู ูุฐู ุงููุธุงุฆู ูุซูุฑูุง ุ ุญุงูู ุชุฎุฒูู ุงููุชุงุฆุฌ ูุคูุชูุง. </font><font style="vertical-align: inherit;">ููุฐุง ูู ุ ุฅุฐุง ุชู ุชููู ุจุนุถ ุงููุนูููุงุช jmethodID ุ ุชุฐูุฑูุง ูุญููุง ูู ููููู. </font><font style="vertical-align: inherit;">ุจุชุทุจูู ูุฐุง ุงูุชุฎุฒูู ุงููุคูุช ุนูู ูุณุชูู ุงููููุงุก ุ ุนุฏูุง ุงูุฃุฏุงุก ุฅูู ุงููุณุชูู ุงูุณุงุจู.</font></font><br><br><h2 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุงุชุตุงู ุฏููุงูููู </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุซุงู ุณุงุจู ุ ููุฏ ุฃูุถุญุช ุฃูู ูููู ุงุณุชุฎุฏุงู JVM TI ูุจุงุดุฑุฉ ูู ููุฏ ุฌุงูุง ุจุงุณุชุฎุฏุงู ุทุฑู ุฃุตููุฉ ุนุงุฏูุฉ ุชุณุชุฎุฏู </font></font><code>System.loadLibrary</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ููุฏ ุฑุฃููุง ุจุงููุนู ููููุฉ ุชูุตูู ูููุงุก JVM TI ูู ุฎูุงู </font></font><code>-agentpath</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุฏุก ุชุดุบูู JVM. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูููุงู ุทุฑููุฉ ุซุงูุซุฉ ุฃุฎุฑู: ุฅุฑูุงู ุฏููุงูููู. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุง ูู ุงูููุฑุฉุ ุฅุฐุง ููุช ุจุชุดุบูู ุงูุชุทุจูู ููู ุชุนุชูุฏ ุฃูู ูู ุงููุณุชูุจู ุณุชุญุชุงุฌ ุฅูู ููุน ูู ุงูููุฒุงุช ุ ุฃู ุฅุฐุง ููุช ุจุญุงุฌุฉ ูุฌุฃุฉ ููุชุญููู ูู ุฎูู ูู ุงูุฅูุชุงุฌ ุ ูููููู ุชูุฒูู ูููู JVM TI ูู ููุช ุงูุชุดุบูู ูุจุงุดุฑุฉู. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุฏุกูุง ูู JDK 9 ุ ุฃุตุจุญ ูุฐุง ูููููุง ูุจุงุดุฑุฉู ูู ุณุทุฑ ุงูุฃูุงูุฑ ุจุงุณุชุฎุฏุงู ุงูุฃุฏุงุฉ ุงููุณุงุนุฏุฉ jcmd:</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">jcmd &lt;pid&gt; JVMTI.agent_load /path/to/agent.so [arguments]</code> </pre><br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูููุฅุตุฏุงุฑุงุช</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุงูุฃูุฏู ูู JDK ุ ููููู ุงุณุชุฎุฏุงู ุฃุฏุงุฉ </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;">jattach ุงูุฎุงุตุฉ</font></a><font style="vertical-align: inherit;"> ุจู </font><font style="vertical-align: inherit;">. ุนูู ุณุจูู ุงููุซุงู ุ ูููู ูู </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">async-profiler</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุงูุงุชุตุงู ุฃุซูุงุก ุงูุชุดุบูู ุจุงูุชุทุจููุงุช ุงูุชู ุชุนูู ุจุฏูู ุฃู ูุณูุทุงุช JVM ุฅุถุงููุฉ ุ ููุฑุฌุน ุงููุถู ูู ุฐูู ุฌุฒุฆููุง ุฅูู jattach. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ุฃุฌู ุงุณุชุฎุฏุงู ุฅููุงููุฉ ุงูุงุชุตุงู ุงูุฏููุงูููู ูู ูููู JVM TI ุ ุชุญุชุงุฌ ุ ุจุงูุฅุถุงูุฉ </font></font><code>Agent_OnLoad()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฅูู </font><font style="vertical-align: inherit;">ุฐูู </font><font style="vertical-align: inherit;">ุ ุฅูู ุชูููุฐ ูุธููุฉ ููุงุซูุฉ </font></font><code>Agent_OnAttach()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. ุงููุฑู ุงููุญูุฏ: </font></font><code>Agent_OnAttach()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุง ููููู ุงุณุชุฎุฏุงู ุชูู ุงููุฏุฑุงุช ุงููุชููุฑุฉ ููุท ูู ููุช ุงูุชูููุฏ ูู ุงููููู. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ุงูููู ุฃู ุชุชุฐูุฑ ุฃูู ููููู ุชูุตูู ุงูููุชุจุฉ ููุณูุง ุจุดูู ุฏููุงูููู ุนุฏุฉ ูุฑุงุช ุ ูุฐูู </font></font><code>Agent_OnAttach()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูููู ุงุณุชุฏุนุงุกูุง ูุฑุงุฑูุง ูุชูุฑุงุฑูุง.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุณุฃุธูุฑ ุจุงููุฏูุฉ. </font><font style="vertical-align: inherit;">ุณูููู IntelliJ IDEA ูู ุฏูุฑ ุงูุฅูุชุงุฌ: ูุฐุง ูู ุฃูุถูุง ุชุทุจูู Java ุ ููุง ูุนูู ุฃูู ูููููุง ุฃูุถูุง ุงูุงุชุตุงู ุจู ุฃุซูุงุก ุงูุชููู ูุงูููุงู ุจุดูุก ูุง. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุณูู ูุนุซุฑ ุนูู ูุนุฑู ุนูููุฉ IDEA ุงูุฎุงุต ุจูุง ุ ุซู ูุน ุฃุฏุงุฉ jattach ุณูู ูููู ุจุชูุตูู ููุชุจุฉ patcher.dll TI JVM ุจูุฐู ุงูุนูููุฉ: </font></font><br> <code>jattach 8648 load patcher.dll true</code> <br> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููู ุงูุญุงู ุ ุบููุฑ ููู ุงููุงุฆูุฉ ุฅูู ุงูููู ุงูุฃุญูุฑ: </font></font><br><br><img src="https://habrastorage.org/webt/rv/j7/wm/rvj7wmnfdbo26tjkcsqaix96k74.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุงุฐุง ููุนู ูุฐุง ุงูุนุงููุ </font><font style="vertical-align: inherit;">ูุจุญุซ ุนู ูู ูุงุฆูุงุช Java ูููุฆุฉ ุงููุนููุฉ ( </font></font><code>javax.swing.AbstractButton</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) ูุงูููุงููุงุช ูู ุฎูุงู ุทุฑููุฉ JNI </font></font><code>setBackground()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">ูููู ุฑุคูุฉ ุงูุฑูุฒ ุงููุงูู </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุง</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><h2 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุง ุงูุฌุฏูุฏ ูู Java 9 </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุฌุฏ JVM TI ููุชุฑุฉ ุทูููุฉ ุ ูุนูู ุงูุฑุบู ูู ุงูุฃุฎุทุงุก ุงูููุฌูุฏุฉ ุ ููุฌุฏ ุจุงููุนู ูุงุฌูุฉ ุจุฑูุฌุฉ ุชุทุจููุงุช ูุตุญุญุฉ ุฑุงุณุฎุฉ ูู ุชุชุบูุฑ ููุฐ ููุช ุทููู. ุธูุฑุช ุงูุงุจุชูุงุฑุงุช ุงููููุฉ ุงูุฃููู ูู Java 9. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุง ุชุนูููู ุ ุฌูุจ Java 9 ูููุทูุฑูู ุงูุฃูู ูุงููุนุงูุงุฉ ุงููุฑุชุจุทุฉ ุจุงููุญุฏุงุช ุงูููุทูุฉ. ุจุงุฏุฆ ุฐู ุจุฏุก ุ ุฃุตุจุญ ูู ุงูุตุนุจ ุงุณุชุฎุฏุงู "ุฃุณุฑุงุฑ" JDK ุ ูุงูุชู ุจุฏูููุง ุ ูู ุญูุซ ุงููุจุฏุฃ ุ ูุง ูููู ุฃู ุชูุนู. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุนูู ุณุจูู ุงููุซุงู ุ ูู JDK ูุง ุชูุฌุฏ ุทุฑููุฉ ูุงููููุฉ ููุณุญ Direct ByteBuffer. ููุท ูู ุฎูุงู ูุงุฌูุฉ ุจุฑูุฌุฉ ุชุทุจููุงุช ุฎุงุตุฉ: </font></font><br><br><img src="https://habrastorage.org/webt/wj/qb/ue/wjqbuel-1g3j1qis_bihg0lpn_8.jpeg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ุ ูู Cassandra ุ ูุง ููุฌุฏ ููุงู ุจุฏูู ูุฐู ุงูููุฒุฉ ุ ูุฃู ุฌููุน ุฃุนูุงู DBMS ูุจููุฉ ุนูู ุงูุนูู ูุน MappedByteBuffer ุ ูุฅุฐุง ูู ุชูู ุจูุณุญูุง ูุฏูููุง ุ ูุณูู ูุชุนุทู JVM ุจุณุฑุนุฉ. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฅุฐุง ุญุงููุช ุชุดุบูู ููุณ ุงูููุฏ ุนูู JDK 9 ุ ูุณุชุญุตู ุนูู IllegalAccessError:</font></font><br><br><img src="https://habrastorage.org/webt/co/z-/49/coz-496tvv3ogo7kw44viuqtpwq.jpeg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงููููู ูุน Reflection ูู ููุณู: ุฃุตุจุญ ูู ุงูุตุนุจ ุงููุตูู ุฅูู ุงูุญููู ุงูุฎุงุตุฉ. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุนูู ุณุจูู ุงููุซุงู ุ ูุง ุชุชููุฑ ุฌููุน ุนูููุงุช ุงููููุงุช ูู Linux ูู Java. </font><font style="vertical-align: inherit;">ูุฐูู ุ ุจุงููุณุจุฉ ููููุฒุงุช ุงูุฎุงุตุฉ ุจูุธุงู Linux ุ ูุงู ุงููุจุฑูุฌูู ุจุงุณุชุฑุฏุงุฏ </font></font><code>java.io.FileDescriptor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุงุตู ููู ุงููุธุงู </font><font style="vertical-align: inherit;">ูู ูุงุฆู ูู ุงููุงุฆู ูู ุฎูุงู ุงูุงูุนูุงุณ </font><font style="vertical-align: inherit;">ูุงุณุชุฎุฏุงู JNI ุงูุฐู ูุทูู ุนููู ุจุนุถ ูุธุงุฆู ุงููุธุงู ุนููู. </font><font style="vertical-align: inherit;">ูุงูุขู ุ ุฅุฐุง ููุช ุจุชุดุบููู ุนูู JDK 9 ุ ูุณุชุฑู ุงููุนูุงุช ูู ุงูุณุฌูุงุช: </font></font><br><br><img src="https://habrastorage.org/webt/he/xc/6p/hexc6pnrkv0ehoablvlfy11imt0.jpeg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุงูุทุจุน ุ ููุงู ุนูุงูุงุช JVM ุงูุชู ุชูุชุญ ุงููุญุฏุงุช ุงูุฎุงุตุฉ ุงููุงุฒูุฉ ูุชุชูุญ ูู ุงุณุชุฎุฏุงู ุงููุตูู ุงูุฎุงุตุฉ ูุงูุชุฃูู. </font><font style="vertical-align: inherit;">ูููู ุนููู ุชุณุฌูู ุฌููุน ุงูุญุฒู ุงูุชู ุชููู ุงุณุชุฎุฏุงููุง ูุฏูููุง. </font><font style="vertical-align: inherit;">ุนูู ุณุจูู ุงููุซุงูุ ููุท ูุชุดุบูู ูุงุณุงูุฏุฑุง ูู ุฌุงูุฉ 11 ูู ุงูุถุฑูุฑู ุฃู ูุตู </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุซู ูุฐุง</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุงูุดุนุงุฑ:</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">--add-exports java.base/jdk.internal.misc=ALL-UNNAMED --add-exports java.base/jdk.internal.ref=ALL-UNNAMED --add-exports java.base/sun.nio.ch=ALL-UNNAMED --add-exports java.management.rmi/com.sun.jmx.remote.internal.rmi=ALL-UNNAMED --add-exports java.rmi/sun.rmi.registry=ALL-UNNAMED --add-exports java.rmi/sun.rmi.server=ALL-UNNAMED --add-exports java.sql/java.sql=ALL-UNNAMED --add-opens java.base/java.lang.module=ALL-UNNAMED --add-opens java.base/jdk.internal.loader=ALL-UNNAMED --add-opens java.base/jdk.internal.ref=ALL-UNNAMED --add-opens java.base/jdk.internal.reflect=ALL-UNNAMED --add-opens java.base/jdk.internal.math=ALL-UNNAMED --add-opens java.base/jdk.internal.module=ALL-UNNAMED --add-opens java.base/jdk.internal.util.jar=ALL-UNNAMED --add-opens jdk.management/com.sun.management.internal=ALL-UNNAMED</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุน ุฐูู ุ ุฌูุจุง ุฅูู ุฌูุจ ูุน ูุญุฏุงุช ุ </font><font style="vertical-align: inherit;">ุธูุฑุช </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุธุงุฆู</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> JVM TI ููุนูู ูุนูู:</font></font><br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> GetAllModules </font></font></li><li style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> AddModuleExports </font></font></li><li style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> AddModuleOpens </font></font></li><li style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุฑ. ุฏ. </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุนูุฏ ุงููุธุฑ ุฅูู ูุฐู ุงููุงุฆูุฉ ุ ููุชุฑุญ ุงูุญู ููุณู: ููููู ุงูุงูุชุธุงุฑ ุญุชู ูุชู ุชุญููู JVM ุ ูุงูุญุตูู ุนูู ูุงุฆูุฉ ุจุฌููุน ุงููุญุฏุงุช ุ ูุชุฌุงูุฒ ุฌููุน ุงูุญุฒู ุ ููุชุญ ูู ุดูุก ููุฌููุน ูุงูุงุณุชูุชุงุน ุจู. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุง ูู ููุณ ุงููุซุงู ูุน Direct ByteBuffer:</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ ByteBuffer buf = ByteBuffer.allocateDirect(<span class="hljs-number"><span class="hljs-number">1024</span></span>); ((sun.nio.ch.DirectBuffer) buf).cleaner().clean(); System.out.println(<span class="hljs-string"><span class="hljs-string">"Buffer cleaned"</span></span>); }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฅุฐุง ูููุง ุจุชุดุบููู ุจุฏูู ุนููุงุก ุ ููุญู ูุชููุน ุงูุญุตูู ุนูู IllegalAccessError. </font><font style="vertical-align: inherit;">ูุฅุฐุง ููุช ุจุฅุถุงูุฉ ุนุงูู </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุถุงุฏ ูููุชู</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุชุจู ูู ุฅูู </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;">agentpath</font></a><font style="vertical-align: inherit;"> ุ ูุฅู ุงููุซุงู ุณูุนูู ุฏูู ุฃุฎุทุงุก. </font><font style="vertical-align: inherit;">ููุณ ุงูุดูุก ูุน ุงูุชูููุฑ.</font></font><br><br><h2 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุง ุงูุฌุฏูุฏ ูู Java 11 </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุธูุฑ ุงุจุชูุงุฑ ุขุฎุฑ ูู Java 11. ุฅูู ูุงุญุฏ ููุท ุ ููู ูุง! ููุฏ ุธูุฑุช ุฅููุงููุฉ ุฅูุดุงุก ุชุดูููุงุช ุฎูููุฉ ูููุฎุตุตุงุช: ุชูุช ุฅุถุงูุฉ ุญุฏุซ ุฌุฏูุฏ </font></font><code>SampledObjectAlloc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุ ููููู ุงูุงุดุชุฑุงู ููู ุ ุจุญูุซ ุชุฃุชู ุฅุนูุงูุงุช ุงูุชูุงุฆูุฉ ุญูู ุงูุชุฎุตูุตุงุช. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุณูุชู ููู ูู ูุง ูู ูุทููุจ ููุฒูุฏ ูู ุงูุชุญููู ุฅูู ุฑุฏ ุงูุงุชุตุงู: ูุคุดุฑ ุงูุชุฑุงุจุท ุงูุฐู ูุฎุตุต ุ ุงููุงุฆู ุงููุญุฏุฏ ููุณู ุ ูุฆุชู ุ ุญุฌูู. ููุงู ุทุฑููุฉ ุฃุฎุฑู </font></font><code>SetHeapSampingInterval</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุชูุซู ูู ุชุบููุฑ ูุนุฏู ุชูุฑุงุฑ ูุฐู ุงูุฅุฎุทุงุฑุงุช. </font></font><br><br><img src="https://habrastorage.org/webt/5f/e1/8_/5fe18_nwt5i-zbm4e-vyn4roavm.jpeg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุงุฐุง ูุฐุง ูุทููุจุ ูุงู ุงูุชุฎุตูุต ุงูุฌุงูุจู ูู ููุช ุณุงุจู ูู ุฌููุน ุงููููุงุช ุงูุชุนุฑูููุฉ ุงูุดุงุฆุนุฉ ุ ููููู ูุงู ูุนูู ูู ุฎูุงู ุงูุฃุฌูุฒุฉ ุ ููู ูุญููู ุจูููุงุช ุนูููุฉ ุนุงููุฉ. ูุงูุช ุฃุฏุงุฉ ุงูุชูููุท ุงูููุฎูุถุฉ ููุท ูู Java Flight Recorder.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฅู ููุฑุฉ ุงูุทุฑููุฉ ุงูุฌุฏูุฏุฉ ูู ุนุฏู ุชุฎุตูุต ุฌููุน ุงูุชุฎุตูุตุงุช ุ ูููู ููุท ุจุนุถูุง ุ ุจุนุจุงุฑุฉ ุฃุฎุฑู ุ ูุฃุฎุฐ ุงูุนููุงุช. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ุงูุญุงูุฉ ุงูุฃุณุฑุน ูุงูุฃูุซุฑ ุชูุฑุงุฑูุง ุ ูุญุฏุซ ุงูุชุฎุตูุต ุฏุงุฎู ูุคุดุฑ ุชุฑุงุจุท ุชุฎุตูุต ูุคุดุฑ ุงูุชุฑุงุจุท ุงููุญูู ุจุจุณุงุทุฉ ุนู ุทุฑูู ุฒูุงุฏุฉ ุงููุคุดุฑ. ููุน ุชุถููู ุฃุฎุฐ ุงูุนููุงุช ุ ุชุชู ุฅุถุงูุฉ ุญุฏูุฏ ุงูุชุฑุงุถูุฉ ุฅูู TLAB ุงูููุงุจูุฉ ูุชุฑุฏุฏ ุฃุฎุฐ ุงูุนููุงุช. ุจูุฌุฑุฏ ุฃู ูุชุฌุงูุฒ ุงูุชุฎุตูุต ุงูุชุงูู ูุฐุง ุงูุญุฏ ุ ูุชู ุฅุฑุณุงู ุญุฏุซ ุญูู ุชุฎุตูุต ุงููุงุฆู. </font></font><br><br><img src="https://habrastorage.org/webt/v0/lm/di/v0lmdimdyk8uvasl3z9gkjlrfqe.jpeg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ุจุนุถ ุงูุญุงูุงุช ุ ูุชู ุชุฎุตูุต ุงููุงุฆูุงุช ุงููุจูุฑุฉ ุงูุชู ูุง ุชูุณุฌู ูุน TLAB ูุจุงุดุฑุฉ ูู ุงููููุฉ. ุชุณูุฑ ูุฐู ุงููุงุฆูุงุช ุฃูุถูุง ุนูู ูุณุงุฑ ุงูุชุฎุตูุต ุงูุจุทูุก ุฎูุงู ููุช ุชุดุบูู JVM ููุชู ุฃูุถูุง ุฃุฎุฐ ุนููุงุช ูููุง.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุธุฑูุง ูุญูููุฉ ุฃู ุฃุฎุฐ ุงูุนููุงุช ูุชู ุงูุขู ููุท ูุจุนุถ ุงููุงุฆูุงุช ุ ูุฅู ุงูุญูู ูููู ููุจูููุง ุจุงููุนู ููุฅูุชุงุฌ - ูู ูุนุธู ุงูุญุงูุงุช ูููู ุฃูู ูู 5ูช. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููู ุงููุซูุฑ ููุงูุชูุงู ุ ุฃู ูุฐู ุงูููุฒุฉ ูุงูุช ููุฐ ุฒูู ุทููู ุ ููุฐ ููุช JDK 7 ุ ุงููุตููุฉ ุฎุตูุตูุง ููุณุฌูุงุช ุงูุทูุฑุงู. ูููู ูู ุฎูุงู ูุงุฌูุฉ ุจุฑูุฌุฉ ุชุทุจููุงุช Hotspot API ุงูุฎุงุตุฉ ุ ุงุณุชุฎุฏู ูุฐุง ุงูุชุทุจูู async-profiler ุฃูุถูุง. ูุงูุขู ุ ุจุฏุกูุง ูู JDK 11 ุ ุฃุตุจุญุช ูุงุฌูุฉ ุจุฑูุฌุฉ ุงูุชุทุจููุงุช ูุฐู ูุชุงุญุฉ ููุนุงูุฉ ุ ูุฏุฎูุช ูู JVM TI ุ ููููู ูููุนูููู ุงูุขุฎุฑูู ุงุณุชุฎุฏุงููุง. ุนูู ูุฌู ุงูุฎุตูุต ุ YourKit ูุนุฑู ุจุงููุนู ููู. ูููููุฉ ุงุณุชุฎุฏุงู ูุงุฌูุฉ ุจุฑูุฌุฉ ุงูุชุทุจููุงุช ูุฐู ุ ููููู ุฃู ุชุฑู ูู </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงููุซุงู</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุงูููุดูุฑ ูู ูุณุชูุฏุนูุง. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุงุณุชุฎุฏุงู ููู ุงูุชุนุฑูู ูุฐุง ุ ููููู ุฅูุดุงุก ูุฎุทุทุงุช ุชุฎุตูุต ุฌูููุฉ. ุดุงูุฏ ุงูุฃุดูุงุก ุงูุชู ุชุจุฑุฒ ุ ูุนุฏุฏูุง ูุจุฑุฒ ุ ูุงูุฃูู ูู ุฐูู ุ ุฃูู.</font></font><br><br><img src="https://habrastorage.org/webt/qi/t1/lw/qit1lwwqv3p7vxhhl-fbcfh5bos.jpeg"><br><br><h2 style=";text-align:right;direction:rtl">  ุงุณุชูุชุงุฌ </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JVM TI ูู ุทุฑููุฉ ุฑุงุฆุนุฉ ููุชูุงุนู ูุน ุฌูุงุฒ ุงูุชุฑุงุถู. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูููู ุชุดุบูู ุงูููููุงุช ุงูุฅุถุงููุฉ ุงูููุชูุจุฉ ุจูุบุฉ C ุฃู C ++ ูู ุจุฏุงูุฉ JVM ุฃู ูููู ุชูุตูููุง ุฏููุงูููููุง ุจุดูู ูุจุงุดุฑ ุฃุซูุงุก ุชุดุบูู ุงูุชุทุจูู. </font><font style="vertical-align: inherit;">ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ูููู ููุชุทุจูู ููุณู ุงุณุชุฎุฏุงู ูุธุงุฆู JVM TI ูู ุฎูุงู ุงูุฃุณุงููุจ ุงูุฃุตููุฉ. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุชู ูุดุฑ ุฌููุน ุงูุฃูุซูุฉ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูููุถุญุฉ ูู ูุณุชูุฏุนูุง ุนูู ุฌูุซุจ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">ุงุณุชุฎุฏุงู ูุฏุฑุงุณุฉ ูุทุฑุญ ุงูุฃุณุฆูุฉ.</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar458812/">https://habr.com/ru/post/ar458812/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar458798/index.html">ุงููุบุฐูุงุช ุจูุช ุฃู ููู ุฃุฑูุฏ ุฃู ุขุฎุฐ ุงูุฎุจุฒ ูู ูุฏุฑุจู ุงูููุงูุฉ ุงูุจุฏููุฉ</a></li>
<li><a href="../ar458800/index.html">ุงูุชุนูู ุงูุนููู. ุงูุชุนููู ุงูููุญุฏ</a></li>
<li><a href="../ar458804/index.html">ููุฎุต ุงูุชุนูู ุงูุขูู ูุงูุฐูุงุก ุงูุงุตุทูุงุนู</a></li>
<li><a href="../ar458808/index.html">ุชูุฑูุฑ ูุงุจ ุจุนุฏ ุงูููุงุฉ: ุณูุทุช ุงูุตุญููุฉ</a></li>
<li><a href="../ar458810/index.html">ุจูุน Corel ู Parallels ุฅูู ูุฌููุนุฉ KKR ุงูุงุณุชุซูุงุฑูุฉ ูู ุงูููุงูุงุช ุงููุชุญุฏุฉ ุงูุฃูุฑูููุฉ</a></li>
<li><a href="../ar458814/index.html">ุฅุทูุงู ูููุน ูููุชุฌ ุฐู ุทูุจ ุบูุฑ ูุดูุจ</a></li>
<li><a href="../ar458818/index.html">ุฃุจุฑุฒ ุงููุนุงุตุฑูู</a></li>
<li><a href="../ar458820/index.html">ุญูู ุชูููุฐ ูุฐุง ุงูููุน ุงูุดููุฑ ุนูู ููุตุฉ Minecraft</a></li>
<li><a href="../ar458826/index.html">ููููุฉ ุงูุชุฎูุต ูู ุงูููุงุฏ ุงููุฏููุฉ ุจุญูุซ ุชููู ุจุดูู ุญุงุฏ ูู ุงูุนุถููุฉ: + 104 ูช ูู ุญุฑูุฉ ุงููุฑูุฑ ููุฏุฉ ุณุชุฉ ุฃุดูุฑ</a></li>
<li><a href="../ar458828/index.html">ููุงุฐุง ุ ููุงุฐุง ุ ููุชู ุชุณุชุฎุฏู ValueTask</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>