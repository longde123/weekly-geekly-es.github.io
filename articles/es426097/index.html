<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üïë üë©üèº‚Äçüè´ üõåüèΩ Arduino Proyecto "RoboCar4W Robot Machine" üïù üîß üö¥üèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Usted entiende ", explic√≥ el editor," debe ser entretenido, fresco, lleno de aventuras interesantes ... para que el lector no pueda salir. 
 I. Ilf, E...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Arduino Proyecto "RoboCar4W Robot Machine"</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/426097/"><p>  <em>Usted entiende ", explic√≥ el editor," debe ser entretenido, fresco, lleno de aventuras interesantes ... para que el lector no pueda salir.</em> <br>  I. Ilf, E. Petrov <em>"C√≥mo se cre√≥ Robinson"</em> . </p><br><p>  Comenzar con Arduino, como con cualquier otra plataforma de software o hardware, siempre es m√°s interesante desde un proyecto real.  Al mismo tiempo, los programadores escriben un c√≥digo que muestra "Hola, mundo", los arduinistas parpadean un LED.  Y todos son felices como ni√±os. </p><br><p>  Decid√≠ comenzar con un proyecto avanzado, incluso con la esperanza secreta de separar a la generaci√≥n joven de Counter-Strike (fallido). </p><br><p>  Como se puede adivinar por el nombre RoboCar4W, el primer proyecto fue un autom√≥vil robot de cuatro ruedas.  Al comenzar a trabajar, ya ten√≠a experiencia en programaci√≥n, una vez supe c√≥mo soldar durante mucho tiempo, pero ni siquiera conoc√≠a los pinouts de Arduino y no le√≠ la documentaci√≥n en absoluto.  Estudi√© toda la sabidur√≠a en el curso de la obra y Google para ayudar. </p><a name="habracut"></a><br><p>  Dado que el proyecto en s√≠ mismo no es fundamentalmente nuevo, tales descripciones en la red son suficientes, todos los componentes son conocidos, no se esperaban sorpresas.  Por lo tanto, la idea se formul√≥ en los t√©rminos m√°s generales y el objetivo principal era sumergirse en el "mundo de las cosas" utilizando Arduino, como plataforma para la creaci√≥n r√°pida de prototipos.  En esta obra, tal vez alguien se reconoce al comienzo del viaje. </p><br><p>  Todo el hardware se compr√≥ en eBay, y desde mi propia experiencia quiero decir que es m√°s f√°cil comprar un kit de inicio de inmediato (b√∫scalo en las palabras del Kit de inicio de Arduino), en lugar de ensamblarlo en detalle.  S√≠, y todos vienen a la vez juntos.  Se decidi√≥ no jugar, comprar un chasis normal, ruedas normales, motores normales, por lo que era "caro". </p><br><p>  El secreto principal para las compras exitosas en eBay es comprar a los vendedores mejor calificados y leer cuidadosamente la descripci√≥n del producto.  Hay muchos art√≠culos sobre esto en Internet. </p><br><p>  ¬øQu√© placa Arduino elegir? </p><br><p>  Tom√© Arduino UNO, muchos proyectos con descripciones para ello.  Pero ahora tomar√≠a el Arduino Mega 2560, tiene m√°s salidas digitales y anal√≥gicas y compatibilidad total en proyectos con UNO. </p><br><h1 id="obschee-opisanie-proekta">  Descripci√≥n general del proyecto. </h1><br><p>  En el mundo del desarrollo de software, esto tambi√©n se llama "requisitos del sistema". </p><br><p>  La idea del proyecto fue la siguiente.  La primera versi√≥n de la m√°quina robot llamada RoboCar4W debe realizar acciones simples: </p><br><ul><li>  avanzar, retroceder, realizar giros </li><li>  medir la distancia a los obst√°culos </li><li>  ser capaz de sortear autom√°ticamente los obst√°culos al frente. </li></ul><br><p>  La segunda versi√≥n de la m√°quina debe controlarse manualmente a trav√©s de Bluetooth desde un tel√©fono Android. </p><br><p>  Para que haya trabajado mejor aqu√≠ est√° todo el proyecto final RoboCar4W ensamblado (aqu√≠ sin bluetooth). </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/457/929/cc8/457929cc8554ef727654f53704ece195.jpg" alt="Arduino RoboCar4W"></p><br><p>  Aqu√≠ hay un video de pruebas en el mar. </p><br><p>  En el primer video, RoboCar4W conduce en modo autom√°tico con evitaci√≥n de obst√°culos en dos versiones diferentes del "firmware", es decir  Esbozar, por lo tanto, si alguien es el m√°s entusiasta y se da cuenta de que el comportamiento del robot en diferentes episodios es ligeramente diferente. </p><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/a05/27c/f11/a0527cf11325d83a2b91826412b151b9.jpg" alt="Coche robot RoboCar4W"></a> </p><br><p>  En el segundo video, RoboCar4W se mueve con la ayuda de comandos transmitidos por el "controlador" a trav√©s de Bluetooth desde un tel√©fono m√≥vil con Android.  "Bluetooth RC Car" est√° instalado en el tel√©fono.  Adem√°s, si hay un obst√°culo cerca al frente, el robot se detiene, es decir.  embestir algo no funcionar√° (sin embargo, hay un bot√≥n "secreto" que desactiva el modo seguro). </p><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/173/997/d9c/173997d9c4f497310ab582b11007d468.jpg" alt="Coche robot RoboCar4W"></a> </p><br><p>  En el tercer video, RoboCar4W muestra un programa de movimiento de demostraci√≥n preprogramado con turnos.  El programa de demostraci√≥n se activa por comando desde el mismo tel√©fono m√≥vil con Android.  El robot solo monta un rato y hace giros. </p><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/820/a73/9f5/820a739f5e40ca959f0c441e53552e4d.jpg" alt="Coche robot RoboCar4W"></a> </p><br><h1 id="algoritm-upravleniya-dvizheniem">  Algoritmo de control de movimiento </h1><br><p>  Es un error llamar a nuestro m√©todo "algoritmo para evitar obst√°culos" o "b√∫squeda de ruta".  Estas son disciplinas matem√°ticas separadas, matem√°ticas puras.  Si realmente te gustan las matem√°ticas, entonces busca estas frases en google, se te proporcionar√° lectura durante seis meses. </p><br><p>  Mientras tanto, nos interesan las cosas mucho m√°s f√°cilmente.  Por lo tanto, lo llamaremos simplemente: el algoritmo de control de movimiento de un robot de 4 ruedas.  Por supuesto, estamos hablando de control autom√°tico sin intervenci√≥n humana. </p><br><p>  Aqu√≠ est√° este algoritmo simple escrito en palabras, para algoritmos m√°s complejos es necesario (lo quiera o no) componer diagramas de bloques. </p><br><p>  Ahora, al mismo tiempo, mire el c√≥digo fuente del boceto <a href="">RoboCar4W-1.ino</a> . </p><br><ol><li>  Medimos la distancia al obst√°culo al frente. </li><li> Si esta distancia medida es menor que el valor <code>DST_TRH_BACK</code> (corto para el umbral de distancia), entonces nos detenemos y retrocedemos mientras giramos.  La direcci√≥n de rotaci√≥n se elige de la siguiente manera: si previamente gir√≥ a la izquierda, gire a la derecha y viceversa. </li><li>  Si la distancia medida es mayor que <code>DST_TRH_BACK</code> , pero menor que <code>DST_TRH_TURN</code> , simplemente gire.  La direcci√≥n de rotaci√≥n se elige al azar. </li><li>  Si est√° lejos del obst√°culo, simplemente contin√∫e. </li><li>  Repetimos de nuevo. </li></ol><br><p>  ¬øQu√© tiene de bueno que tengamos 4 ruedas y tracci√≥n total?  Podemos realizar (programar) varios tipos de turnos: </p><br><ul><li>  Rotaci√≥n suave  Todas las ruedas giran, pero las ruedas de un lado giran m√°s r√°pido. </li><li>  Un giro brusco.  Las ruedas giran solo por un lado. </li><li>  Giro en U en su lugar.  Como un tractor, las ruedas de un lado giran hacia atr√°s y el otro hacia adelante. </li></ul><br><p>  En la segunda versi√≥n del programa, cuando se controla desde un tel√©fono Android, el modo seguro, cuando el robot intenta evitar colisiones frontales, se puede desactivar si se presiona el programa dos veces <br><img src="https://habrastorage.org/getpro/habr/post_images/2d3/256/454/2d3256454e390ed508f62d212ffb1d15.jpg" alt="Bot√≥n"></p><br><p>  y se volvi√≥ a encender presion√°ndolo una vez. </p><br><p>  <em>Nota importante</em>  Toda la l√≥gica est√° bajo el control de Arduino.  Android aqu√≠ act√∫a como una consola de juegos (sin cerebro) desde la consola, su tarea es transmitir est√∫pidamente presionar botones (es decir, comandos) a trav√©s de Bluetooth al Arduino RoboCar4W. </p><br><h1 id="komponenty">  Componentes </h1><br><p>  Inicialmente, la m√°quina inclu√≠a un servoaccionamiento que giraba el medidor de distancia ultras√≥nico un cierto √°ngulo para mediciones en tres direcciones.  Pero durante las pruebas, debido a un manejo descuidado, el servo se quem√≥, por lo que ahora el sensor de distancia simplemente se fija r√≠gidamente frente a la caja. </p><br><p>  No hay un lado positivo, pero el boceto se ha vuelto un poco m√°s f√°cil. </p><br><p>  Para el futuro, compre el servo m√°s simple y econ√≥mico, no se necesita potencia especial, velocidad y precisi√≥n de rotaci√≥n en un √°ngulo dado, y resulta que es bastante f√°cil deshabilitar un servo, como result√≥.  SG90 por valor de $ 2 es un buen ajuste. </p><br><p>  Por lo tanto, los componentes del proyecto RoboCar4W incluyen una descripci√≥n en ingl√©s para facilitar la b√∫squeda en eBay y similares: </p><br><ul><li>  Arduino UNO R3 </li><li>  Chasis listo para usar 4 ruedas motrices Plataforma de robot m√≥vil Chasis de autom√≥vil inteligente Compatible con Arduino </li><li>  Motores de corriente continua con rotaci√≥n en ambas direcciones - 4 piezas </li><li>  Ruedas - 4 piezas </li><li>  Placa para controlar 4 motores de CC Motor Drive Shield L293D </li><li>  Medidor de distancia por ultrasonidos HC-SR04 M√≥dulo de ultrasonidos Sensor de medici√≥n de distancia </li><li>  Bater√≠as Ni-MH 1.2 V - 8 piezas </li><li>  Soporte de caja de pl√°stico para bater√≠as, Soporte de caja de bater√≠a 4 bater√≠as AA - 2 piezas. </li><li>  Tipo de bater√≠a "Krona" 8.4 V - 1 pc. </li><li>  Interruptor de palanca opcional - interruptor de encendido </li></ul><br><p>  El chasis, los motores de CC y las ruedas se compraron inmediatamente en el kit e incluso con instrucciones de montaje. </p><br><h1 id="raspinovka">  Pinout </h1><br><p>  Las entradas anal√≥gicas se pueden usar como pines digitales de puertos de E / S.  Los pines Arduino correspondientes a las entradas anal√≥gicas est√°n numerados del 14 al 19. Esto se aplica solo a los pines Arduino, no a los n√∫meros de pin f√≠sicos del microcontrolador Atmega. </p><br><p>  No tiene que dibujar, simplemente puede poner todo en una mesa.  Lo hice de esta manera. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/504/d24/fff/504d24fff6bdc78120e1a28a39848967.png" alt="Pinout"></p><br><p>  Los pines D4, D7, D8, D12 estar√°n ocupados si se utilizan motores de CC o motores paso a paso. </p><br><p>  Los pines D9 (control del servo n. ¬∞ 1), D10 (control del servo n. ¬∞ 2) se utilizar√°n solo si se utilizan servomotores. </p><br><p>  El pin Arduino no ocupa los pines Arduino para controlar el Motor Drive Shield L293D. </p><br><p>  Los pines de alimentaci√≥n de 3.3 V, 5 V y tierra est√°n duplicados en el blindaje del motor en cantidades suficientes.  Por lo tanto, no hay necesidad de preocuparse por su escasez. </p><br><p>  Si a√∫n quieres dibujar maravillosamente, entonces el programa gratuito Fritzing te ayudar√°. </p><br><h1 id="pitanie">  Nutrici√≥n </h1><br><p>  Este es el segundo punto muy importante.  Mucho depende de la nutrici√≥n.  Por ejemplo, un servomotor al girar el eje en un √°ngulo dado comienza a consumir mucha corriente.  Al mismo tiempo, si el servo est√° alimentado por un Arduino de 5 V, entonces hay una "reducci√≥n" en el voltaje y el resto del circuito comienza a fallar, y el Arduino puede incluso reiniciarse al mismo tiempo. </p><br><p>  En cualquier caso, si utiliza motores en la embarcaci√≥n, se necesita un Motor Drive Shield (o un circuito similar). </p><br><p>  Por lo tanto, tenemos 4 motores de CC, un servoaccionamiento, la placa Arduino y varios sensores.  Los motores son los m√°s glotones, pero los sensores pueden alimentarse con √©xito desde los conectores de la placa Arduino, por lo que todo es simple con ellos.  Por conveniencia, he reducido toda la econom√≠a en una sola tabla. </p><br><table><thead><tr><th></th><th>  Tensi√≥n recomendada o t√≠pica.  Consumo actual </th><th>  Tensi√≥n m√°xima </th><th>  Lo que se planea alimentar </th><th>  Notas </th></tr></thead><tbody><tr><td>  Arduino UNO R3 Board </td><td>  7 - 12V, 200mA (promedio) </td><td>  6 - 20 </td><td>  "Krone 9V" Li-ion 650mAh, 8.4V </td><td>  Conector central </td></tr><tr><td>  Servomotor MG-995 </td><td>  5-6 V, 0.1 - 0.3A (pico) </td><td>  4.8 - 7.2 </td><td>  Bater√≠as (5) piezas  Ni-Mh 1.2V = 6V </td><td>  Alimentos solo de una fuente separada.  Si enciende junto con Arduino, entonces todo fallar√°.  4 voltios de bater√≠a Ni-Mh  * 1.2V = 4.8V no es suficiente.  Algunos sostienen que este servo no debe usarse a 6 voltios solo 4.8 </td></tr><tr><td>  Motores DC (4 piezas) </td><td>  6 - 8V, corriente de 70mA a 250mA </td><td>  3 - 12 </td><td>  bater√≠as (5 + 3) piezas  Ni-Mh 1.2V = 9.6V </td><td>  No podr√° arrancar los motores normalmente con una bater√≠a de 9 V, ¬°as√≠ que ni siquiera pierda tiempo (y bater√≠as)! </td></tr><tr><td>  Motor Drive Shield L293D </td><td>  no requerido </td><td>  4,5 - 36 </td><td>  no requerido </td><td></td></tr><tr><td>  M√≥dulo Bluetooth HC-0506 </td><td>  3,3 V, 50 mA </td><td>  1.8-3.6 </td><td>  Con pin placa Arduino 3.3V </td><td></td></tr><tr><td>  Medidor de distancia por ultrasonidos HC-SR04 </td><td>  5 V, 2 mA </td><td>  5 5 </td><td>  Con pin placa Arduino de 5V </td><td></td></tr></tbody></table><br><p>  No ten√≠a un convertidor de voltaje CC / CC.  Krona 9V no era una muy buena fuente de energ√≠a, ya la ten√≠a. </p><br><p>  Pero me negu√© a usar bater√≠as de iones de litio de alta capacidad.  En primer lugar, debido al alto costo, y en segundo lugar, en las compras en l√≠nea chinas es f√°cil encontrarse con una falsificaci√≥n.  M√°s precisamente, no "f√°cil", sino "siempre".  Adem√°s, el ion de litio requiere un manejo especial, y no es seguro. </p><br><p>  Entonces, como vemos en la tabla, necesitamos 3 fuentes de energ√≠a independientes: </p><br><ul><li>  Para placa Arduino y sensores. </li><li>  Para servomotor. </li><li>  Para 4 motores DC. </li></ul><br><p>  ¬øD√≥nde puedo obtener tanto?  En cualquier caso, la placa Arduino debe alimentarse desde una fuente separada, como  cuando el voltaje "baja", por ejemplo, al encender los motores, la placa puede reiniciarse o simplemente fallar.  Aqu√≠ usamos la bater√≠a del factor de forma Krona 9V, y el conector que se conectar√° al Arduino debe estar con un "m√°s en el centro". </p><br><p>  Para un servomotor y 4 motores de CC, puede hacerlo con una fuente de alimentaci√≥n.  El √∫nico problema es que el servomotor est√° dise√±ado para un voltaje de 5-6V (m√°ximo 7.2V) y una corriente de 100-300mA (pico), y los motores de CC necesitan 6-8V (m√°ximo 12V) y una corriente de 250mA. </p><br><p>  Para resolver el problema, hay convertidores DC-DC, pero no los ten√≠a.  Como resultado, apliqu√© mi diagrama de cableado "patentado" (sin circuitos electr√≥nicos reductores, ¬°solo voltaje y corriente ecol√≥gicos!): Conect√© 8 piezas.  Bater√≠as de 1.2V en serie y tomas en los lugares correctos, como se muestra en el diagrama. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/f13/3f4/b82/f133f4b82dc88cf2de958804735c73b3.png" alt="Nutrici√≥n"></p><br><p>  6V fueron al servomotor, y 9.6 fueron a los motores DC.  Est√° claro que las bater√≠as 1-5 experimentar√°n una mayor carga. </p><br><p>  Para controlar motores servo y de corriente continua, utilic√© un motor Drive Shield de 4 canales basado en el chip L293D. </p><br><h1 id="sborka">  Asamblea </h1><br><p>  Ensamblar el chasis terminado es un peque√±o problema.  Pero no piense que sin dopaje obtendr√° todo de inmediato.  Por lo tanto, prepare los archivos. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/058/f4a/d8b/058f4ad8b7a7b76295d5295dcd63afba.jpg" alt="Asamblea"></p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/5bb/d2d/32c/5bbd2d32c5caa7a97d8201bddabae96c.jpg" alt="Asamblea"></p><br><p>  No es posible conectar varios motores normalmente, un servomotor o un motor paso a paso directamente al Arduino.  Dado que los pines (conclusiones) del Arduino son de baja corriente.  Para resolver el problema, hay un m√≥dulo de control de unidad adicional: Motor Drive Shield basado en el chip L293D, que es uno de los chips m√°s comunes dise√±ados para este prop√≥sito.  El chip L293D tambi√©n se conoce como H-Bridge. </p><br><p>  Utilic√© una placa que proporciona 4 canales para conectar dos chips L293D y un registro de desplazamiento.  Comprado en eBay por $ 5. </p><br><p>  Esta placa del m√≥dulo de control del variador tiene las siguientes especificaciones. </p><br><ul><li>  L293D Motor Drive Shield compatible con Arduino Mega 1280 y 2560, UNO, Duemilanove, Diecimila </li><li>  Control de 4 canales </li><li>  motores alimentados de 4.5V a 36V </li><li>  corriente de carga permitida 600mA por canal, corriente de pico - 1.2A </li><li>  protecci√≥n contra sobrecalentamiento </li><li>  2 interfaces con un temporizador Arduino exacto (no habr√° "jitter") para conectar los servomotores a 5V, si la tensi√≥n de alimentaci√≥n debe ser mayor, entonces la conexi√≥n de alimentaci√≥n debe rehacerse como se describe a continuaci√≥n </li><li>  Se pueden controlar simult√°neamente 4 motores de colector de CC bidireccionales o 2 motores paso a paso y 2 servomotores </li><li>  4 motores DC bidireccionales est√°n conectados a un bus de 8 bits para la selecci√≥n de velocidad individual </li><li>  Conexi√≥n de unidades de hasta 2 pasos (unipolar o bipolar), con una bobina, doble bobina o pasos alternos </li><li>  conector para conectar una fuente externa para una fuente de alimentaci√≥n separada de l√≥gica de control y motores </li><li>  Bot√≥n RESTAURAR Arduino </li><li>  La biblioteca Adafruit AFMotor se utiliza para la gesti√≥n. </li></ul><br><p>  Motor Drive Shield necesita un poco de refinamiento para que pueda conectar cualquier cosa despu√©s de √©l.  Solde los conectores necesarios en la parte superior, esto es lo que sucedi√≥. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/470/943/060/47094306049d3d9ff9dbe393bd203b1a.jpg" alt="Escudo de accionamiento del motor"></p><br><p>  Los motores se pueden conectar a una fuente de alimentaci√≥n adicional en relaci√≥n con la placa Arduino.  Recomiendo solo este m√©todo de conexi√≥n.  Para hacer esto, quite, abra el puente, como se muestra en la imagen. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/a18/6c0/d8b/a186c0d8b3c77c02a7e260411eb1cbd9.jpg" alt="Blindaje de accionamiento de motor L293D de 4 canales. Puente para alimentaci√≥n externa."></p><br><p>  En este caso, el Arduino se alimenta y los motores se alimentan independientemente uno del otro. </p><br><p>  El LED en el escudo del motor se enciende cuando hay energ√≠a para los motores, si no est√° encendido, los motores no funcionar√°n. </p><br><p>  Nuevo problema </p><br><p>  La posici√≥n del puente de alimentaci√≥n no se aplica a los servos, todav√≠a estar√°n alimentados por 5V Arduino.  Dado que los servomotores generalmente consumen mucha corriente y si la potencia es insuficiente, entonces todo el dispositivo comienza a fallar, en el "mejor" caso, solo fallar√° el servoaccionamiento: no rotar√° en el √°ngulo establecido, o todo el tiempo antes de cada turno gire primero a 0 grados, y solo entonces en un √°ngulo dado (y si puedes seguir el ritmo).  Por lo tanto, recomiendo alimentar el servo tambi√©n desde una fuente de alimentaci√≥n adicional.  Para hacer esto, tendr√° que rehacer ligeramente el diagrama de conexi√≥n: muerda el cable positivo (generalmente rojo) del conector est√°ndar y con√©ctelo directamente al positivo de la fuente de alimentaci√≥n. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/d2f/6ea/fa1/d2f6eafa1d5721a6e36a38429aa4ad9e.jpg" alt="Finalizaci√≥n para conectar la potencia del servomotor"></p><br><p>  Al conectar un Motor Drive Shield, no se utilizan pines anal√≥gicos.  Los pines digitales 2, 13 no se utilizan. </p><br><p>  Los siguientes pines se usan solo si se conectan y usan los motores de CC o motores paso a paso correspondientes: </p><br><ul><li>  D11: Motor DC # 1 / Stepper # 1 (activaci√≥n y control de velocidad) </li><li>  D3: Motor DC # 2 / Stepper # 1 (activaci√≥n y control de velocidad) </li><li>  D5: Motor DC # 3 / Paso a paso # 2 (activaci√≥n y control de velocidad) </li><li>  D6: Motor DC # 4 / Stepper # 2 (activaci√≥n y control de velocidad) </li></ul><br><p>  Estos pines estar√°n ocupados si se utilizan DC / steppers: D4, D7, D8, D12. </p><br><p>  Los siguientes pines se ocupar√°n solo si se utilizan los servomotores adecuados: </p><br><ul><li>  D9: control Servo # 1 </li><li>  D10: control servo # 2 </li></ul><br><p><img src="https://habrastorage.org/getpro/habr/post_images/27f/dd4/746/27fdd474619f83391b6c486a576a31fa.png" alt="Tabla de conexi√≥n"></p><br><p>  Para comenzar con Motor Drive Shield, debe descargar e instalar la biblioteca <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Adafruit AFMotor</a> . </p><br><p>  C√≥digo de ejemplo para controlar motores: </p><br><pre> <code class="hljs objectivec"><span class="hljs-meta"><span class="hljs-meta">#include </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;AFMotor.h&gt;</span></span></span><span class="hljs-meta"> //   Adafruit #include </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;Servo.h&gt;</span></span></span><span class="hljs-meta"> //     AF_DCMotor motor(1); //   ,    DC    Motor Shiled , ,  frequency Servo servo; //    servo.attach(10); //     9  10 (    Motor Shiled) motor.setSpeed(speed); //   DC   0 ()  255 ( ) motor.run(RELEASE); // DC   motor.run(FORWARD); // DC   motor.run(BACKWARD); // DC   servo.write(90); //    90 .</span></span></code> </pre> <br><p>  El motor de CC comenz√≥ a girar solo cuando indica una velocidad superior a 100, si es menor, solo zumba.  Tendr√° que determinar la velocidad m√≠nima de su motor experimentalmente. </p><br><p>  Para los motores conectados a M1 y M2, puede configurar la frecuencia: MOTOR12_64KHZ, MOTOR12_8KHZ, MOTOR12_2KHZ, MOTOR12_1KHZ.  La velocidad de rotaci√≥n m√°s alta se alcanza a 64KHz, esta frecuencia se escuchar√°, la frecuencia m√°s baja y la velocidad a 1KHz, pero tambi√©n usa menos energ√≠a.  Los motores 3 y 4 siempre funcionan a 1KHz; se ignoran otros valores.  El valor predeterminado es 1 kHz en todas partes. </p><br><p>  Despu√©s de eso, es necesario ejecutar una prueba de motores.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Boceto para la prueba se puede tomar aqu√≠</a> .  Al comienzo del boceto, cambie el n√∫mero del motor en una l√≠nea (o en l√≠neas) del tipo: </p><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-function">AF_DCMotor </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">motor</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">‚Ä¶</span></span></span><span class="hljs-function">)</span></span>;</code> </pre> <br><p>  Un boceto durante alg√∫n tiempo gira los motores hacia adelante a lo largo del movimiento del robot y luego hacia atr√°s.  Mire cuidadosamente para ver si el motor gira en esa direcci√≥n, y cambie la polaridad de la conexi√≥n si es necesario. </p><br><p>  Conectamos el medidor de distancia ultras√≥nico M√≥dulo ultras√≥nico HC-SR04.  Pinout: </p><br><ul><li>  Vcc </li><li>  Trig (T) </li><li>  Eco (r) </li><li>  GND </li></ul><br><p>  El tiempo empleado por el buscador de rango ultras√≥nico en mediciones (determinado emp√≠ricamente): </p><br><ul><li>  m√°ximo 240 ms si la distancia es demasiado larga (fuera de rango) </li><li>  al menos 1 ms si la distancia es demasiado corta </li><li>  se determina una distancia de 1,5 m en aproximadamente 10 ms </li></ul><br><p><img src="https://habrastorage.org/getpro/habr/post_images/de0/071/18e/de007118e81cee628722e426d8e83800.jpg" alt="Medidor de distancia por ultrasonidos M√≥dulo ultras√≥nico HC-SR04"></p><br><p>  Un sensor de rango ultras√≥nico, debido a su naturaleza f√≠sica, y no porque China, en algunos casos, determina mal la distancia a un obst√°culo: </p><br><ul><li>  Si el obst√°culo tiene una forma compleja, el ultrasonido se refleja en diferentes √°ngulos y el sensor est√° equivocado. </li><li>  El ultrasonido es perfectamente absorbido (es decir, no reflejado) por muebles tapizados o juguetes, y el sensor cree que no hay nada frente a √©l. </li></ul><br><p>  En otras palabras, para un tel√©metro ultras√≥nico, idealmente ser√≠a excelente si todos los obst√°culos estuvieran en forma de un plano s√≥lido perpendicular a la direcci√≥n de la radiaci√≥n de ultrasonido. </p><br><p>  Algunos problemas se pueden resolver con un sensor de distancia infrarrojo.  Pero tampoco es perfecto: </p><br><ul><li>  rango m√°ximo peque√±o en comparaci√≥n con el ultrasonido: 0.3-0.8 m versus 4 m </li><li>  gran distancia m√≠nima en comparaci√≥n con la ecograf√≠a: 10 cm frente a 2 cm </li><li>  Dependencia de la sensibilidad del sensor de la iluminaci√≥n general. </li></ul><br><p>  Aunque si instala estos tel√©metros en un par, la eficiencia de su trabajo aumentar√≠a significativamente. </p><br><h1 id="podklyuchaem-bluetooth-hc-05">  Conecte Bluetooth HC-05 </h1><br><p>  Como puede ver en la hoja de datos, los pines principales del HC-05 "desnudo": </p><br><ul><li>  Transmisi√≥n TX (pin 1) </li><li>  Recepci√≥n RX (pin 2) </li><li>  3.3V (pin 12) fuente de alimentaci√≥n 3.3V </li><li>  GND (pin 13) tierra </li><li>  Indicador de modo PIO8 (pin 31) </li><li>  Estado de conexi√≥n PIO9 (pin 32), si se establece la conexi√≥n, la salida ser√° alta </li><li>  PIO11 (pin 34) para habilitar el modo de comando AT </li></ul><br><p>  Nuestro m√≥dulo est√° soldado a la placa base / breakout, donde ya hay un divisor de voltaje, por lo que tiene un rango de voltaje de trabajo de 3.3V a 6V. </p><br><p>  Conectamos nuestro conjunto de m√≥dulo Bluetooth: </p><br><ul><li>  Arduino (TX) - (RX) HC-05 </li><li>  Arduino (RX) - (TX) HC-05 </li><li>  Arduino (+ 5V) - (VCC) Bluetooth </li><li>  Arduino (GND) - (GND) Bluetooth </li><li>  LED, los pines KEY no se utilizan </li></ul><br><p>  Una vez que se suministra energ√≠a al m√≥dulo Bluetooth HC-05, el LED debe parpadear, lo que significa que el bluetooth est√° funcionando. </p><br><p>  Encienda bluetooth en el m√≥vil, busque el dispositivo con el nombre HC-05 y con√©ctese, contrase√±a 1234. </p><br><p>  Para probar, complete un boceto simple en Arduino: </p><br><pre> <code class="hljs pgsql"><span class="hljs-type"><span class="hljs-type">int</span></span> count = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-type"><span class="hljs-type">void</span></span> setup() { <span class="hljs-type"><span class="hljs-type">Serial</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">begin</span></span>(<span class="hljs-number"><span class="hljs-number">9600</span></span>); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("Test Arduino + Bluetooth. http://localhost"); } <span class="hljs-type"><span class="hljs-type">void</span></span> <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span>() { count++; <span class="hljs-type"><span class="hljs-type">Serial</span></span>.print("Count = "); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println(count); delay(<span class="hljs-number"><span class="hljs-number">1000</span></span>); }</code> </pre> <br><p>  En el tel√©fono Android, instale el terminal Bluetooth.  Estamos conectados al dispositivo HC-05 y observamos en la pantalla del tel√©fono l√≠neas que se arrastran con un contador creciente. </p><br><p>  Para que el m√≥dulo pueda recibir los comandos AT, debe ponerlo en el modo apropiado; para esto, debe configurar la salida KEY (PIO11) en 1 l√≥gico. En algunos paneles Breakout / Base, en lugar de la salida KEY, hay una salida EN (ENABLE), que puede o no ser soldado al pin en el chip en s√≠.  Esto se aplica solo a los chips HC05.  Esa es solo mi salida de terminal EN no est√° soldada en ninguna parte.  Por lo tanto, se puede soldar con un cable separado al terminal KEY (PIO11) del chip.  O, durante la operaci√≥n, para poner el HC05 en modo de comando AT, cortocircuite la salida del chip KEY (PIO11) a la salida de potencia Vcc durante un par de segundos.  Para HC06, el pin KEY no es necesario. </p><br><h1 id="programmnoe-obespechenie">  Software </h1><br><p>  Nota  Cada vez que descargue el programa en Arduino, aseg√∫rese de que el m√≥dulo Bluetooth no est√© conectado al Arduino.  Esto causar√° problemas de relleno de bocetos.  Simplemente desconecte la alimentaci√≥n del m√≥dulo Bluetooth o los cables que conectan los pines del m√≥dulo Arduino y RX, TX. </p><br><p>  Al comienzo del boceto, cambie los n√∫meros de motor en las l√≠neas del tipo: </p><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-function">AF_DCMotor </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">motor</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">‚Ä¶</span></span></span><span class="hljs-function">)</span></span>;</code> </pre> <br><p>  <a href="">Boceto para el modo autom√°tico con evitaci√≥n de obst√°culos descarga aqu√≠</a> . </p><br><p>  Si reemplazas la cuerda </p><br><pre> <code class="hljs lua"><span class="hljs-built_in"><span class="hljs-built_in">byte</span></span> <span class="hljs-built_in"><span class="hljs-built_in">debug</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span>;</code> </pre> <br><p>  en </p><br><pre> <code class="hljs lua"><span class="hljs-built_in"><span class="hljs-built_in">byte</span></span> <span class="hljs-built_in"><span class="hljs-built_in">debug</span></span> = <span class="hljs-number"><span class="hljs-number">10</span></span>;</code> </pre> <br><p>  Esto habilitar√° el modo de depuraci√≥n. </p><br><p>  En el modo de depuraci√≥n, el RoboCar4W realmente no conducir√° ni rodar√°.  En su lugar, active el monitor de puerto serie y all√≠ ver√° c√≥mo se "maneja" virtualmente.  En lugar de una unidad real hacia adelante, la cadena "Forward" se escribir√° en el monitor del puerto serie, en lugar de retroceder con un giro a la izquierda, "Turn Back L (eft)", etc.  El sensor de distancia ultras√≥nico tampoco hace nada, en cambio, las distancias a los obst√°culos se generan mediante programaci√≥n y al azar. </p><br><p>  Este modo de depuraci√≥n es conveniente si cambia el algoritmo de movimiento y, en lugar de atrapar una m√°quina de escribir en la sala, simplemente verifique todo en inactivo. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Boceto de Bluetooth para descarga de control manual aqu√≠</a> .  El boceto no tiene modo de depuraci√≥n, ya que todo es transparente all√≠.  Presionas el bot√≥n: el robot se va. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Programa para Adnroid Bluetooth RC Car</a> . </p><br><p>  Bueno, eso es todo!  Que tengas un buen viaje! </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/32b/8dc/98f/32b8dc98ff44592014df2bf2f736f9d5.jpg" alt="Que tengas un buen viaje!"></p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es426097/">https://habr.com/ru/post/es426097/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es426087/index.html">Firmando un PDF en JS y pegando una firma en C # usando Crypto PRO</a></li>
<li><a href="../es426089/index.html">Startup estadounidense desarroll√≥ gafas-AdBlock</a></li>
<li><a href="../es426091/index.html">8 analizadores de registro en la nube para evaluar el entorno de trabajo</a></li>
<li><a href="../es426093/index.html">Monetizaci√≥n de los datos del usuario frente a la publicidad en la aplicaci√≥n: pros y contras</a></li>
<li><a href="../es426095/index.html">Abrir webinar "C√≥mo no escribir en Python"</a></li>
<li><a href="../es426099/index.html">Noticias de Typegram</a></li>
<li><a href="../es426101/index.html">Integridad de los datos en la arquitectura de microservicios: c√≥mo garantizarlo sin transacciones distribuidas y conectividad estrecha</a></li>
<li><a href="../es426103/index.html">Webinar "¬øNecesita Kubernetes" 15 de octubre a las 19:00</a></li>
<li><a href="../es426105/index.html">Mi captura en una semana</a></li>
<li><a href="../es426111/index.html">Google todav√≠a va a lanzar un servicio de b√∫squeda censurado en China</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>