<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘¨ğŸ¾â€ğŸ”¬ ğŸ‘¨ğŸ¼â€ğŸ”§ ğŸŸ PHPè§„èŒƒ ğŸ‘¼ğŸ¾ ğŸ‘¨ğŸ¿â€ğŸ­ ğŸ˜¢</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ç®€è¦ä»‹ç»ä¸€ä¸‹è§„æ ¼ï¼š 
 è§„èŒƒæ˜¯ä¸€ç§è®¾è®¡æ¨¡å¼ï¼Œæ‚¨å¯ä»¥ç”¨å®ƒä»¥å¸ƒå°”é€»è¾‘æ“ä½œè¿æ¥çš„å¯¹è±¡é“¾çš„å½¢å¼åæ˜ ä¸šåŠ¡é€»è¾‘è§„åˆ™ã€‚ è§„èŒƒå…è®¸æ‚¨æ‘†è„±å­˜å‚¨åº“ä¸­çš„é‡å¤ï¼Œç›¸ä¼¼æ–¹æ³•ä»¥åŠä¸šåŠ¡é€»è¾‘é‡å¤ã€‚ 

 ä»Šå¤©ï¼Œæœ‰ä¸¤ä¸ªï¼ˆå¦‚æœæ‚¨äº†è§£å…¶ä»–é¡¹ç›®ï¼Œè¯·åœ¨è¯„è®ºä¸­å†™ä¸‹ï¼‰æˆåŠŸä¸”æµè¡Œçš„PHPé¡¹ç›®ï¼Œè¿™äº›é¡¹ç›®ä½¿æ‚¨å¯ä»¥åœ¨è§„èŒƒå’Œè¿‡æ»¤æ•°æ®é›†ä¸­æè¿°ä¸šåŠ¡è§„åˆ™ã€‚ è¿™äº›...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>PHPè§„èŒƒ</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/455030/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/4f/oc/jy/4focjyd0nzj8tpdc_evzhlt4zx4.png" alt="å¿«ä¹ä¸»ä¹‰è§„èŒƒ"></div><br><p> ç®€è¦ä»‹ç»ä¸€ä¸‹è§„æ ¼ï¼š </p><br><blockquote> è§„èŒƒæ˜¯ä¸€ç§è®¾è®¡æ¨¡å¼ï¼Œæ‚¨å¯ä»¥ç”¨å®ƒä»¥å¸ƒå°”é€»è¾‘æ“ä½œè¿æ¥çš„å¯¹è±¡é“¾çš„å½¢å¼åæ˜ ä¸šåŠ¡é€»è¾‘è§„åˆ™ã€‚ è§„èŒƒå…è®¸æ‚¨æ‘†è„±å­˜å‚¨åº“ä¸­çš„é‡å¤ï¼Œç›¸ä¼¼æ–¹æ³•ä»¥åŠä¸šåŠ¡é€»è¾‘é‡å¤ã€‚ </blockquote><p> ä»Šå¤©ï¼Œæœ‰ä¸¤ä¸ª<em>ï¼ˆå¦‚æœæ‚¨äº†è§£å…¶ä»–é¡¹ç›®ï¼Œè¯·åœ¨è¯„è®ºä¸­å†™ä¸‹ï¼‰</em>æˆåŠŸä¸”æµè¡Œçš„PHPé¡¹ç›®ï¼Œè¿™äº›é¡¹ç›®ä½¿æ‚¨å¯ä»¥åœ¨è§„èŒƒå’Œè¿‡æ»¤æ•°æ®é›†ä¸­æè¿°ä¸šåŠ¡è§„åˆ™ã€‚ è¿™äº›æ˜¯<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">RulerZ</a>å’Œ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Happyrå­¦è¯´è§„èŒƒ</a> ã€‚ è¿™ä¸¤ä¸ªé¡¹ç›®éƒ½æ˜¯æœ‰ä¼˜åŠ¿å’ŒåŠ£åŠ¿çš„å¼ºå¤§å·¥å…·ã€‚ æ¯”è¾ƒè¿™äº›é¡¹ç›®å°†å¾—å‡ºæ•´ç¯‡æ–‡ç« ã€‚ åœ¨è¿™é‡Œï¼Œæˆ‘æƒ³å‘Šè¯‰æ‚¨â€œ Doctrineè§„èŒƒâ€ä¸­çš„æ–°ç‰ˆæœ¬ç»™æˆ‘ä»¬å¸¦æ¥äº†ä»€ä¹ˆã€‚ </p><a name="habracut"></a><br><h1 id="kratko-o-doctrine-specification"> ç®€è¦ä»‹ç»æ•™ä¹‰è§„èŒƒ </h1><br><p> <em>é‚£äº›æˆ–å¤šæˆ–å°‘ç†Ÿæ‚‰è¯¥é¡¹ç›®çš„äººå¯ä»¥å®‰å…¨åœ°<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è·³è¿‡</a>æ­¤éƒ¨åˆ†ã€‚</em> </p><br><p> åœ¨è¯¥é¡¹ç›®çš„å¸®åŠ©ä¸‹ï¼Œæ‚¨å¯ä»¥ä»¥å¯¹è±¡çš„å½¢å¼æè¿°è§„èŒƒï¼Œä»ç»„æˆä¸Šå°†å…¶ç»„æˆï¼Œä»è€Œåˆ¶å®šå¤æ‚çš„ä¸šåŠ¡è§„åˆ™ã€‚ æ‰€å¾—çš„ç»„åˆç‰©å¯ä»¥è‡ªç”±åœ°é‡å¤ä½¿ç”¨ï¼Œå¹¶ä¸”å¯ä»¥ç»„åˆæˆç”šè‡³æ›´å®¹æ˜“æµ‹è¯•çš„å¤æ‚ç»„åˆç‰©ã€‚ åŸåˆ™è§„èŒƒç”¨äºæ„å»ºåŸåˆ™æŸ¥è¯¢ã€‚ ä»æœ¬è´¨ä¸Šè®²ï¼ŒDoctrineè§„èŒƒæ˜¯å¯¹Doctrine ORM QueryBuilderå’ŒDoctrine ORM Queryçš„æŠ½è±¡çº§åˆ«ã€‚ </p><br><p> è§„èŒƒé€‚ç”¨äºâ€œæ•™ä¹‰å­˜å‚¨åº“â€ï¼š </p><br><pre><code class="php hljs">$result = $em-&gt;getRepository(MyEntity::class)-&gt;match($spec);</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">è¯¥è§„èŒƒå¯ä»¥æ‰‹åŠ¨åº”ç”¨ï¼Œä½†å¹¶ä¸æ˜¯ç‰¹åˆ«æ–¹ä¾¿ï¼Œå¹¶ä¸”ä»é•¿è¿œæ¥çœ‹æ¯«æ— æ„ä¹‰ã€‚</b> <div class="spoiler_text"><pre> <code class="php hljs">$spec = ... $alias = <span class="hljs-string"><span class="hljs-string">'e'</span></span>; $qb = $em-&gt;getRepository(MyEntity::class)-&gt;createQueryBuilder($alias); $spec-&gt;modify($qb, $alias); $filter = (string) $spec-&gt;getFilter($qb, $alias); $qb-&gt;andWhere($filter); $result = $qb-&gt;getQuery()-&gt;execute();</code> </pre> </div></div><br><p> å­˜å‚¨åº“ä¸­æœ‰å‡ ç§æ–¹æ³•ï¼š </p><br><ul><li>  <code>match</code> -è·å–ä¸è§„èŒƒç›¸å¯¹åº”çš„æ‰€æœ‰ç»“æœï¼› </li><li>  <code>matchSingleResult</code>ç­‰æ•ˆäº<code>Query::getSingleResult()</code> ; </li><li>  <code>matchOneOrNullResult</code>ç­‰åŒäº<code>matchSingleResult</code> ï¼Œä½†å…è®¸ä¸º<code>null</code> ï¼› </li><li>  <code>getQuery</code>é€šè¿‡å¯¹å…¶åº”ç”¨è§„èŒƒæ¥åˆ›å»ºQueryBuilderå¹¶ä»ä¸­è¿”å›Queryå¯¹è±¡ã€‚ </li></ul><br><p> æœ€è¿‘ï¼Œå·²ç»å‘å…¶ä¸­æ·»åŠ äº†<code>getQueryBuilder</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•åˆ›å»ºäº†ä¸€ä¸ªQueryBuilderå¹¶å°†å…¶åº”ç”¨è§„èŒƒè¿”å›ã€‚ </p><br><p> è¯¥é¡¹ç›®ç¡®å®šäº†å‡ ç§ç±»å‹çš„è§„èŒƒï¼š </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">é€»è¾‘è§„æ ¼</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è¿‡æ»¤å™¨è§„æ ¼</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æŸ¥è¯¢ä¿®é¥°ç¬¦</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç»“æœä¿®é¥°ç¬¦</a> </li></ul><br><h2 id="logicheskie-specifikacii"> é€»è¾‘è§„æ ¼ </h2><br><p>  <code>andX</code>å’Œ<code>orX</code>ä¹Ÿç”¨ä½œ<code>orX</code>çš„é›†åˆã€‚ </p><br><ul><li> <code>Spec::andX()</code> </li> <li> <code>Spec::orX()</code> </li> <li> <code>Spec::not()</code> </li> </ul><br><p> é€šå¸¸é€šè¿‡<code>Spec</code>å¤–è§‚å®‰è£…åº“è§„èŒƒçš„å¯¹è±¡ï¼Œä½†è¿™ä¸æ˜¯å¿…éœ€çš„ã€‚ æ‚¨å¯ä»¥æ˜¾å¼å®ä¾‹åŒ–è§„èŒƒå¯¹è±¡ï¼š </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AndX(); <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OrX(): <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Not();</code> </pre> <br><h2 id="filtruyuschie-specifikacii"> è¿‡æ»¤å™¨è§„æ ¼ </h2><br><p> å®é™…ä¸Šï¼Œè¿‡æ»¤è§„èŒƒæ„æˆäº†ä¸šåŠ¡é€»è¾‘è§„åˆ™ï¼Œå¹¶åœ¨<code>WHERE</code>è¯·æ±‚ä¸­ä½¿ç”¨ã€‚ å…¶ä¸­åŒ…æ‹¬æ¯”è¾ƒæ“ä½œï¼š </p><br><ul><li>  <code>isNull</code> -SQL <code>IS NULL</code>ç­‰æ•ˆ </li><li>  <code>isNotNull</code>ç­‰æ•ˆçš„SQL <code>IS NOT NULL</code> </li><li>  in-ç›¸å½“äº<code>IN ()</code> </li><li>  <code>notIn</code>ç›¸å½“äº<code>NOT IN ()</code> </li><li>  <code>eq</code>ç›¸ç­‰æµ‹è¯•<code>=</code> </li><li>  <code>neq</code>æ£€æŸ¥ä¸å¹³ç­‰<code>!=</code> </li><li>  <code>lt</code>å°äº<code>&lt;</code> </li><li>  <code>lte</code>å°äºæˆ–ç­‰äº<code>&lt;=</code> </li><li>  <code>gt</code>å¤§äº<code>&gt;</code> </li><li>  <code>gte</code>å¤§äºæˆ–ç­‰äº<code>&gt;=</code> </li><li>  <code>like</code> -SQL <code>LIKE</code>ç­‰æ•ˆ </li><li>  <code>instanceOfX</code>ç­‰æ•ˆäºDQL <code>INSTANCE OF</code> </li></ul><br><p> ä½¿ç”¨è¿‡æ»¤è§„èŒƒçš„ç¤ºä¾‹ï¼š </p><br><pre> <code class="php hljs">$spec = Spec::andX( Spec::eq(<span class="hljs-string"><span class="hljs-string">'ended'</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>), Spec::orX( Spec::lt(<span class="hljs-string"><span class="hljs-string">'endDate'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \DateTime()), Spec::andX( Spec::isNull(<span class="hljs-string"><span class="hljs-string">'endDate'</span></span>), Spec::lt(<span class="hljs-string"><span class="hljs-string">'startDate'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \DateTime(<span class="hljs-string"><span class="hljs-string">'-4 weeks'</span></span>)) ) ) );</code> </pre> <br><h2 id="modifikatory-zaprosa"> æŸ¥è¯¢ä¿®é¥°ç¬¦ </h2><br><p> æŸ¥è¯¢ä¿®é¥°ç¬¦ä¸ä¸šåŠ¡é€»è¾‘å’Œä¸šåŠ¡è§„åˆ™æ— å…³ã€‚ é¡¾åæ€ä¹‰ï¼Œå®ƒä»¬ä»…ä¿®æ”¹QueryBuilderã€‚ é¢„å®šä¹‰ä¿®é¥°ç¬¦çš„åç§°å’Œç›®çš„ä¸QueryBuilderä¸­çš„ç±»ä¼¼æ–¹æ³•ç›¸å¯¹åº”ã€‚ </p><br><ul><li> <code>join</code> </li> <li> <code>leftJoin</code> </li> <li> <code>innerJoin</code> </li> <li> <code>limit</code> </li> <li> <code>offset</code> </li> <li> <code>orderBy</code> </li> <li> <code>groupBy</code> </li> <li> <code>having</code> </li> </ul><br><p> æˆ‘è¦å•ç‹¬æ³¨æ„<code>slice</code>ä¿®æ”¹å™¨ã€‚ å®ƒç»“åˆäº†<code>limit</code>å’Œ<code>offset</code>åŠŸèƒ½ï¼Œå¹¶æ ¹æ®åˆ‡ç‰‡çš„å¤§å°åŠå…¶åºåˆ—å·è®¡ç®—åç§»é‡ã€‚ åœ¨å®ç°æ­¤ä¿®é¥°ç¬¦æ—¶ï¼Œæˆ‘ä»¬ä¸åŒæ„è¯¥é¡¹ç›®çš„ä½œè€…ã€‚ åˆ›å»ºä¿®é¥°ç¬¦åï¼Œæˆ‘è¿½æ±‚çš„ç›®æ ‡æ˜¯ç®€åŒ–åˆ†é¡µæœŸé—´çš„è§„æ ¼é…ç½®ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåºåˆ—å·ä¸º1çš„ç¬¬ä¸€é¡µåº”è¯¥ä¸åºåˆ—å·ä¸º1çš„ç¬¬ä¸€ä¸ªåˆ‡ç‰‡ç­‰æ•ˆã€‚ä½†æ˜¯é¡¹ç›®ä½œè€…è®¤ä¸ºä»¥ç¼–ç¨‹æ ·å¼å³0å¼€å§‹å€’è®¡æ—¶æ˜¯æ­£ç¡®çš„ã€‚å› æ­¤ï¼Œå€¼å¾—è®°ä½çš„æ˜¯ï¼Œå¦‚æœéœ€è¦ç¬¬ä¸€ä¸ªåˆ‡ç‰‡ï¼Œåˆ™éœ€è¦æŒ‡å®š0ä½œä¸ºåºåˆ—å·ã€‚ </p><br><h2 id="modifikatory-rezultata"> ç»“æœä¿®é¥°ç¬¦ </h2><br><p> ç»“æœä¿®é¥°ç¬¦ä¸è§„èŒƒç•¥æœ‰ä¸åŒã€‚ å®ƒä»¬é€‚ç”¨äºå­¦è¯´æŸ¥è¯¢ã€‚ ä»¥ä¸‹ä¿®é¥°ç¬¦æ§åˆ¶æ•°æ®æ°´åˆï¼ˆ <code>Query::setHydrationMode()</code> ï¼‰ï¼š </p><br><ul><li> <code>asArray</code> </li> <li> <code>asSingleScalar</code> </li> <li> <code>asScalar</code> </li> </ul><br><p>  <code>cache</code>ä¿®æ”¹å™¨æ§åˆ¶æŸ¥è¯¢ç»“æœçš„ç¼“å­˜ã€‚ </p><br><p> æˆ‘ä»¬è¿˜åº”è¯¥æåˆ°ä¿®é¥°ç¬¦<code>roundDateTimeParams</code> ã€‚ å½“æ‚¨éœ€è¦ä½¿ç”¨éœ€è¦å°†ä¸€äº›å€¼ä¸å½“å‰æ—¶é—´è¿›è¡Œæ¯”è¾ƒçš„ä¸šåŠ¡è§„åˆ™æ—¶ï¼Œå®ƒæœ‰åŠ©äºè§£å†³ç¼“å­˜é—®é¢˜ã€‚ è¿™äº›æ˜¯æ­£å¸¸çš„ä¸šåŠ¡è§„åˆ™ï¼Œä½†æ˜¯ç”±äºæ—¶é—´ä¸æ˜¯æ’å®šçš„ï¼Œå› æ­¤ç¼“å­˜ä¸€ç§’é’Ÿä»¥ä¸Šå¯¹æ‚¨ä¸èµ·ä½œç”¨ã€‚  <code>roundDateTimeParams</code>ä¿®é¥°ç¬¦æ—¨åœ¨è§£å†³æ­¤é—®é¢˜ã€‚ å®ƒéå†è¯·æ±‚çš„æ‰€æœ‰å‚æ•°ï¼Œåœ¨å…¶ä¸­æœç´¢æ—¥æœŸï¼Œå¹¶å°†å…¶å››èˆäº”å…¥ä¸ºæŒ‡å®šçš„å€¼ï¼Œè¿™å°†ä½¿æˆ‘ä»¬è·å¾—çš„æ—¥æœŸå€¼å§‹ç»ˆæ˜¯ä¸€ä¸ªå€¼çš„å€æ•°ï¼Œè€Œå°†æ¥æˆ‘ä»¬å°†æ— æ³•è·å¾—æ—¥æœŸã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæˆ‘ä»¬æƒ³å°†è¯·æ±‚ç¼“å­˜10åˆ†é’Ÿï¼Œåˆ™å¯ä»¥ä½¿ç”¨<code>Spec::cache(600)</code>å’Œ<code>Spec::roundDateTimeParams(600)</code> ã€‚ æœ€åˆï¼Œä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œå»ºè®®å°†è¿™ä¸¤ä¸ªä¿®é¥°ç¬¦ç»“åˆåœ¨ä¸€èµ·ï¼Œä½†å†³å®šå°†å®ƒä»¬åˆ†å¼€ä»¥è¿›è¡ŒSRPã€‚ </p><br><h1 id="vstroennye-specifikacii"> åµŒå…¥å¼è§„æ ¼ </h1><br><p>  Happyr Doctrine-Specificationå…·æœ‰å•ç‹¬çš„è§„èŒƒæ¥å£ï¼Œè¯¥æ¥å£ç»“åˆäº†è¿‡æ»¤å™¨å’Œè¯·æ±‚ä¿®é¥°ç¬¦ã€‚ å”¯ä¸€çš„é¢„å®šä¹‰è§„èŒƒæ˜¯<code>countOf</code>å®ƒå…è®¸æ‚¨è·å–ä¸è§„èŒƒç›¸å¯¹åº”çš„å®ä½“æ•°ã€‚ è¦åˆ›å»ºè‡ªå·±çš„è§„èŒƒï¼Œé€šå¸¸ä¼šæ‰©å±•æŠ½è±¡<code>BaseSpecification</code>ç±»ã€‚ </p><br><h1 id="novovvedeniya"> é©æ–°æ€§ </h1><br><p> æ–°æ–¹æ³•å·²æ·»åŠ åˆ°å­˜å‚¨åº“ï¼š </p><br><ul><li>  <code>matchSingleScalarResult</code>ç­‰æ•ˆäº<code>Query::getSingleScalarResult()</code> ; </li><li>  <code>matchScalarResult</code>ç­‰åŒäº<code>Query::getScalarResult()</code> ; </li><li>  <code>iterate</code>ç­‰æ•ˆäº<code>Query::iterate()</code> ã€‚ </li></ul><br><p>  <code>MemberOfX</code>äº†<code>MemberOfX</code>è§„èŒƒ- <code>MemberOfX</code>äº†<code>MEMBER OF</code>çš„DQLç­‰æ•ˆé¡¹<code>MEMBER OF</code>å¹¶ä¸”<code>indexBy</code>äº†<code>indexBy</code>æŸ¥è¯¢ä¿®é¥°ç¬¦-äº†<code>QueryBuilder::indexBy()</code>çš„ç­‰æ•ˆé¡¹ã€‚ </p><br><h2 id="operandy"> æ“ä½œæ•° </h2><br><p> æ–°ç‰ˆæœ¬å¼•å…¥äº†<strong>Operand</strong>çš„æ¦‚å¿µã€‚ è¿‡æ»¤å™¨ä¸­çš„æ‰€æœ‰æ¡ä»¶å‡ç”±å·¦å³æ“ä½œæ•°ä»¥åŠå®ƒä»¬ä¹‹é—´çš„è¿ç®—ç¬¦ç»„æˆã€‚ </p><br><pre> <code class="plaintext hljs">&lt;left_operand&gt; &lt;operator&gt; &lt;right_operand&gt;</code> </pre> <br><p> åœ¨ä»¥å‰çš„ç‰ˆæœ¬ä¸­ï¼Œå·¦æ“ä½œæ•°åªèƒ½æ˜¯ä¸€ä¸ªå®ä½“å­—æ®µï¼Œè€Œå³æ“ä½œæ•°åªèƒ½æ˜¯ä¸€ä¸ªå€¼ã€‚ è¿™æ˜¯ä¸€ç§ç®€å•æœ‰æ•ˆçš„æœºåˆ¶ï¼Œè¶³ä»¥å®Œæˆå¤§å¤šæ•°ä»»åŠ¡ã€‚ åŒæ—¶ï¼Œå®ƒæ–½åŠ äº†æŸäº›é™åˆ¶ï¼š </p><br><ul><li> æ— æ³•ä½¿ç”¨åŠŸèƒ½ï¼› </li><li> ä¸èƒ½ä¸ºå­—æ®µä½¿ç”¨åˆ«åï¼› </li><li> æ¯”è¾ƒä¸¤ä¸ªå­—æ®µæ˜¯ä¸å¯èƒ½çš„ã€‚ </li><li> æ¯”è¾ƒä¸¤ä¸ªå€¼æ˜¯ä¸å¯èƒ½çš„ã€‚ </li><li> æ— æ³•ä½¿ç”¨ç®—æœ¯è¿ç®—ï¼› </li><li> æ— æ³•ä¸ºå€¼æŒ‡å®šæ•°æ®ç±»å‹ã€‚ </li></ul><br><p> åœ¨æ–°ç‰ˆæœ¬ä¸­ï¼Œå°†æ“ä½œæ•°å¯¹â€‹â€‹è±¡ä¼ é€’åˆ°å‚æ•°ä¸­çš„è¿‡æ»¤å™¨ï¼Œå¹¶å°†å®ƒä»¬åœ¨DQLä¸­çš„è½¬æ¢å§”æ´¾ç»™æ“ä½œæ•°æœ¬èº«ã€‚ è¿™å¼€è¾Ÿäº†è®¸å¤šå¯èƒ½æ€§ï¼Œå¹¶ä½¿è¿‡æ»¤å™¨æ›´å®¹æ˜“ã€‚ </p><br><h3 id="pole-i-znachenie"> é¢†åŸŸä¸ä»·å€¼ </h3><br><p> ä¸ºäº†ä¿æŒå‘åå…¼å®¹æ€§ï¼Œå¦‚æœè¿‡æ»¤å™¨ä¸­çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸æ˜¯æ“ä½œæ•°ï¼Œåˆ™å°†å…¶è½¬æ¢ä¸ºå­—æ®µæ“ä½œæ•°ï¼Œæœ€åä¸€ä¸ªå‚æ•°ä¹Ÿå°†è½¬æ¢ä¸ºå€¼æ“ä½œæ•°ã€‚ å› æ­¤ï¼Œæ‚¨åº”è¯¥æ²¡æœ‰é—®é¢˜æ›´æ–°ã€‚ </p><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// DQL: e.day &gt; :day Spec::gt('day', $day); // or Spec::gt(Spec::field('day'), $day); // or Spec::gt(Spec::field('day', $dqlAlias), $day);</span></span></code> </pre> <br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// DQL: e.day &gt; :day Spec::gt('day', $day); // or Spec::gt('day', Spec::value($day)); // or Spec::gt('day', Spec::value($day, Type::DATE));</span></span></code> </pre> <br><p> æ‚¨å¯ä»¥æ¯”è¾ƒ2ä¸ªå­—æ®µï¼š </p><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// DQL: e.price_current &lt; e.price_old Spec::lt(Spec::field('price_current'), Spec::field('price_old'));</span></span></code> </pre> <br><p> æ‚¨å¯ä»¥æ¯”è¾ƒä¸åŒå®ä½“çš„2ä¸ªå­—æ®µï¼š </p><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// DQL: a.email = u.email Spec::eq(Spec::field('email', 'a'), Spec::field('email', 'u'));</span></span></code> </pre> <br><h3 id="arifmeticheskie-operacii"> ç®—æœ¯è¿ç®— </h3><br><p> æ·»åŠ äº†å¯¹æ ‡å‡†ç®—æœ¯è¿ç®—ç¬¦<code>-</code> ï¼Œ <code>+</code> ï¼Œ <code>*</code> ï¼Œ <code>/</code> ï¼Œ <code>%</code> ã€‚ ä¾‹å¦‚ï¼Œè€ƒè™‘ç”¨æˆ·ç‚¹çš„è®¡ç®—ï¼š </p><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// DQL: e.posts_count + e.likes_count &gt; :user_score Spec::gt( Spec::add(Spec::field('posts_count'), Spec::field('likes_count')), $user_score );</span></span></code> </pre> <br><p> ç®—æœ¯è¿ç®—å¯ä»¥ç›¸äº’åµŒå¥—ï¼š </p><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// DQL: ((e.price_old - e.price_current) / (e.price_current / 100)) &gt; :discount Spec::gt( Spec::div( Spec::sub(Spec::field('price_old'), Spec::field('price_current')), Spec::div(Spec::field('price_current'), Spec::value(100)) ), Spec::value($discount) );</span></span></code> </pre> <br><h3 id="funkcii"> åŠŸèƒ½ä»‹ç» </h3><br><p> æ–°ç‰ˆæœ¬æ·»åŠ äº†å¸¦æœ‰å‡½æ•°çš„æ“ä½œæ•°ã€‚ å®ƒä»¬å¯ä»¥ç”¨ä½œ<code>Spec</code>ç±»çš„é™æ€æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥é€šè¿‡<code>Spec::fun()</code>æ–¹æ³•ä½¿ç”¨ã€‚ </p><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// DQL: size(e.products) &gt; 2 Spec::gt(Spec::size('products'), 2); // or Spec::gt(Spec::fun('size', 'products'), 2); // or Spec::gt(Spec::fun('size', Spec::field('products')), 2);</span></span></code> </pre> <br><p> å‡½æ•°å¯ä»¥å½¼æ­¤åµŒå¥—ï¼š </p><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// DQL: trim(lower(e.email)) = :email Spec::eq(Spec::trim(Spec::lower('email')), trim(strtolower($email))); // or Spec::eq( Spec::fun('trim', Spec::fun('lower', Spec::field('email'))), trim(strtolower($email)) );</span></span></code> </pre> <br><p> å‡½æ•°çš„å‚æ•°å¯ä»¥ä½œä¸ºå•ç‹¬çš„å‚æ•°ä¼ é€’ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å°†å…¶ä¼ é€’ç»™æ•°ç»„æ¥ä¼ é€’ï¼š </p><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// DQL: DATE_DIFF(e.create_at, :date) Spec::DATE_DIFF('create_at', $date); // or Spec::DATE_DIFF(['create_at', $date]); // or Spec::fun('DATE_DIFF', 'create_at', $date); // or Spec::fun('DATE_DIFF', ['create_at', $date]);</span></span></code> </pre> <br><h2 id="upravlenie-vyborkoy"> æŠ½æ ·ç®¡ç† </h2><br><p> æœ‰æ—¶æ‚¨éœ€è¦ç®¡ç†ä¸€ä¸ªè¿”å›å€¼åˆ—è¡¨ã€‚ ä¾‹å¦‚ï¼š </p><br><ul><li> åœ¨ç»“æœä¸­æ·»åŠ å¦ä¸€ä¸ªå®ä½“ï¼Œä»¥å…è¿›è¡Œå­æŸ¥è¯¢æ¥è·å–é“¾æ¥ï¼› </li><li> ä¸è¿”å›æ•´ä¸ªå®ä½“ï¼Œè€Œæ˜¯ä»…è¿”å›ä¸€ç»„å•ç‹¬çš„å­—æ®µï¼› </li><li> ä½¿ç”¨åˆ«åï¼› </li><li> ä½¿ç”¨å¸¦æœ‰éšè—æ¡ä»¶çš„åˆ«åè¿›è¡Œæ’åºï¼ˆå®ƒè¦æ±‚ä½¿ç”¨Doctrineï¼Œä½†å®ƒä»¬<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ‰¿è¯ºä¼šå¯¹å…¶è¿›è¡Œä¿®å¤</a> ï¼‰ã€‚ </li></ul><br><p> åœ¨0.8.0ç‰ˆä¹‹å‰ï¼Œè¿™äº›ä»»åŠ¡éœ€è¦åˆ›å»ºæ»¡è¶³è¿™äº›éœ€æ±‚çš„è§„èŒƒã€‚ ä»ç‰ˆæœ¬0.8.0å¼€å§‹ï¼Œå¯ä»¥ä½¿ç”¨<code>getQueryBuilder()</code>æ–¹æ³•å¹¶é€šè¿‡QueryBuilderç•Œé¢ç®¡ç†é€‰æ‹©ã€‚ </p><br><p> æ–°ç‰ˆæœ¬1.0.0æ·»åŠ äº†<code>select</code>å’Œ<code>addSelect</code>è¯·æ±‚<code>addSelect</code> ã€‚  <code>select</code>å®Œå…¨æ›¿æ¢äº†å¯é€‰å€¼åˆ—è¡¨ï¼Œè€Œ<code>addSelect</code>å°†æ–°å€¼æ·»åŠ åˆ°åˆ—è¡¨ä¸­ã€‚ ä½œä¸ºå€¼ï¼Œå¯ä»¥ä½¿ç”¨å®ç°<code>Selection</code>æ¥å£æˆ–è¿‡æ»¤å™¨çš„å¯¹è±¡ã€‚ å› æ­¤ï¼Œæ‚¨å¯ä»¥æ ¹æ®éœ€è¦æ‰©å±•åº“çš„åŠŸèƒ½ã€‚ è€ƒè™‘å·²ç»å­˜åœ¨çš„æœºä¼šã€‚ </p><br><p> æ‚¨å¯ä»¥é€‰æ‹©ä¸€ä¸ªå­—æ®µï¼š </p><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// DQL: SELECT e.email FROM ... Spec::select('email') // or Spec::select(Spec::field('email'))</span></span></code> </pre> <br><p> æ‚¨å¯ä»¥å°†ä¸€ä¸ªå­—æ®µæ·»åŠ åˆ°é€‰æ‹©ä¸­ï¼š </p><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// DQL: SELECT e, u.email FROM ... Spec::addSelect(Spec::field('email', $dqlAlias))</span></span></code> </pre> <br><p> æ‚¨å¯ä»¥é€‰æ‹©å‡ ä¸ªå­—æ®µï¼š </p><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// DQL: SELECT e.title, e.cover, u.name, u.avatar FROM ... Spec::andX( Spec::select('title', 'cover'), Spec::addSelect(Spec::field('name', $dqlAlias), Spec::field('avatar', $dqlAlias)) )</span></span></code> </pre> <br><p> æ‚¨å¯ä»¥å°†å®ä½“æ·»åŠ åˆ°è¿”å›å€¼ï¼š </p><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// DQL: SELECT e, u FROM ... Spec::addSelect(Spec::selectEntity($dqlAlias))</span></span></code> </pre> <br><p> æ‚¨å¯ä»¥å¯¹å¯é€‰å­—æ®µä½¿ç”¨åˆ«åï¼š </p><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// DQL: SELECT e.name AS author FROM ... Spec::select(Spec::selectAs(Spec::field('name'), 'author'))</span></span></code> </pre> <br><p> æ‚¨å¯ä»¥å°†éšè—å­—æ®µæ·»åŠ åˆ°é€‰æ‹©ä¸­ï¼š </p><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// DQL: SELECT e, u.name AS HIDDEN author FROM ... Spec::addSelect(Spec::selectHiddenAs(Spec::field('email', $dqlAlias), 'author')))</span></span></code> </pre> <br><p> ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨è¡¨è¾¾å¼æ¥è·å¾—äº§å“çš„æŠ˜æ‰£ï¼š </p><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// DQL: SELECT (e.price_old is not null and e.price_current &lt; e.price_old) AS discount FROM ... Spec::select(Spec::selectAs( Spec::andX( Spec::isNotNull('price_old'), Spec::lt(Spec::field('price_current'), Spec::field('price_old')) ), 'discount' ))</span></span></code> </pre> <br><p> æ‚¨å¯ä»¥åœ¨è§„èŒƒä¸­ä½¿ç”¨åˆ«åï¼š </p><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// DQL: SELECT e.price_current AS price FROM ... WHERE price &lt; :low_cost_limit Spec::andX( Spec::select(Spec::selectAs('price_current', 'price')), Spec::lt(Spec::alias('price'), $low_cost_limit) )</span></span></code> </pre> <br><p> åŸºæœ¬ä¸Šå°±æ˜¯è¿™äº›ã€‚ è¿™å°±æ˜¯åˆ›æ–°çš„ç»ˆç‚¹ã€‚ æ–°ç‰ˆæœ¬å¸¦æ¥äº†è®¸å¤šæœ‰è¶£ä¸”æœ‰ç”¨çš„åŠŸèƒ½ã€‚ æˆ‘å¸Œæœ›ä»–ä»¬å¯¹ä½ æ„Ÿå…´è¶£ã€‚ </p><br><p>  <em>PSï¼šæˆ‘å¯ä»¥é€šè¿‡ä¸€ä¸ªç¤ºä¾‹åˆ†æè§„èŒƒçš„ä½¿ç”¨ï¼Œå¹¶è¯´æ˜ä½¿ç”¨è§„èŒƒçš„ä¼˜ç¼ºç‚¹ã€‚</em>  <em>å¦‚æœæ‚¨å¯¹æ­¤æ„Ÿå…´è¶£ï¼Œè¯·åœ¨è¯„è®ºä¸­æˆ–PMä¸­å†™ã€‚</em> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN455030/">https://habr.com/ru/post/zh-CN455030/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN455016/index.html">æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ‹¥æœ‰ç†æƒ³è¯„åˆ†çš„äººè¿¹ç½•è‡³çš„ç½‘ç«™Lighthouse</a></li>
<li><a href="../zh-CN455018/index.html">å¤§çˆ±å°ä¼ä¸šçš„èŒä½</a></li>
<li><a href="../zh-CN455020/index.html">ä½¿ç”¨Flutterè¿›è¡Œç§»åŠ¨å¼€å‘çš„ä¼˜ç¼ºç‚¹</a></li>
<li><a href="../zh-CN455024/index.html">åˆ›å»ºäº‘åŸç”Ÿåº”ç”¨ç¨‹åºçš„5æ¡å¸¸è¯†åŸåˆ™</a></li>
<li><a href="../zh-CN455026/index.html">ä¸Snomé€šè¯ï¼šé€‚ç”¨äºåœ¨å®¶å·¥ä½œçš„äºº</a></li>
<li><a href="../zh-CN455032/index.html">ä¸æ˜¯é”™è¯¯ï¼Œè€Œæ˜¯åŠŸèƒ½ï¼šç ”ç©¶å¤šæ€æ€§äººçš„è¿åŠ¨èƒ½åŠ›å’Œå¤§è„‘æ´»åŠ¨</a></li>
<li><a href="../zh-CN455040/index.html">æ”¹å–„Wi-Fiçš„å·¥ä½œã€‚ ç¬¬2éƒ¨åˆ†ã€‚è®¾å¤‡åŠŸèƒ½</a></li>
<li><a href="../zh-CN455042/index.html">Androidä¸­çš„Kotlin DSLï¼Œè£…ç½®å’Œä¼˜é›…çš„UIæµ‹è¯•</a></li>
<li><a href="../zh-CN455046/index.html">N + 7æœ¬ä¹¦</a></li>
<li><a href="../zh-CN455048/index.html">ç”¨äºåŒºåŸŸåˆ†æçš„çƒ­åŠ¿æ–¹æ³•çš„æŠ€æœ¯å®æ–½</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>