<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë∞üèª üíÇüèº üõ•Ô∏è Replica√ß√£o em cadeia: construindo um reposit√≥rio KV eficiente (parte 2/2) üôÖ üß§ üëÇüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Continuamos a considerar exemplos do uso da replica√ß√£o em cadeia. Defini√ß√µes b√°sicas e arquiteturas foram fornecidas na primeira parte ; eu recomendo ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Replica√ß√£o em cadeia: construindo um reposit√≥rio KV eficiente (parte 2/2)</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/432020/"><div style="text-align:center;"><img width="400" src="https://habrastorage.org/webt/ou/4j/jl/ou4jjlsyjknckeriwguidrfcqqs.jpeg"></div><br>  Continuamos a considerar exemplos do uso da replica√ß√£o em cadeia.  Defini√ß√µes b√°sicas e arquiteturas foram fornecidas na <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">primeira parte</a> ; eu recomendo que voc√™ se familiarize com isso antes de ler a segunda parte. <br><a name="habracut"></a><br>  Neste artigo, estudaremos os seguintes sistemas: <br><br><ul><li>  O Hibari √© um reposit√≥rio distribu√≠do e tolerante a falhas, escrito em erlang. </li><li>  HyperDex - armazenamento de valor-chave distribu√≠do com suporte para pesquisa r√°pida por atributos secund√°rios e pesquisa por intervalo. </li><li>  ChainReaction - Causal + consist√™ncia e georreplica√ß√£o. </li><li>  Construindo um sistema distribu√≠do sem usar processos adicionais de monitoramento / reconfigura√ß√£o externos. </li></ul><br><h1>  5. Hibari </h1><br>  O Hibari √© um reposit√≥rio KV tolerante a falhas distribu√≠do, escrito em erlang.  Utiliza replica√ß√£o em cadeia (abordagem b√°sica), ou seja,  alcan√ßa consist√™ncia estrita.  Nos testes, o Hibari mostra alto desempenho - v√°rios milhares de atualiza√ß√µes por segundo s√£o obtidas em servidores de duas unidades (solicita√ß√µes de 1 KB) <br><br><h3>  5.1 Arquitetura </h3><br>  Hash consistente √© usado para colocar dados.  A base do armazenamento s√£o blocos f√≠sicos e l√≥gicos.  O <i>bloco f√≠sico</i> √© um servidor com Linux, talvez uma inst√¢ncia do EC2 e, em geral, a VM como um todo.  Um bloco <i>l√≥gico</i> √© uma inst√¢ncia de armazenamento com a qual os principais processos do cluster funcionam e cada bloco √© um n√≥ em qualquer cadeia.  No exemplo abaixo, o cluster √© configurado com 2 blocos l√≥gicos em cada bloco f√≠sico e com um comprimento de cadeia de 2. Observe que os n√≥s da cadeia s√£o "manchados" sobre os blocos f√≠sicos para aumentar a confiabilidade. <br><br>  O processo mestre (veja a defini√ß√£o na primeira parte) √© chamado de <i>servidor Admin</i> . <br><br>  Os dados s√£o armazenados em "tabelas", que s√£o simplesmente divididas em espa√ßos para nome, cada tabela √© armazenada em pelo menos uma cadeia e cada cadeia armazena dados em apenas uma tabela. <br><br>  O cliente Hibari recebe atualiza√ß√µes do servidor Admin com uma lista de todas as cabe√ßas e cauda de todas as cadeias (e todas as tabelas).  Assim, os clientes sabem imediatamente para qual n√≥ l√≥gico enviar a solicita√ß√£o. <br><br><div style="text-align:center;"><img width="600" src="https://habrastorage.org/webt/k1/nh/yg/k1nhygstpeqkgzv5vyuwwsjoffm.png"></div><br><br><h3>  5.2 Hashing </h3><br>  Hibari usa um par <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1"><span class="noError" id="MJXp-Span-2" style="display: inline-block;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\ {T, K \}</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><span class="noError" style="display: inline-block;">\&nbsp;{T,&nbsp;K&nbsp;\}</span></span><script type="math/tex" id="MathJax-Element-1"> \ {T, K \} </script>  para determinar o nome da cadeia que armazena a chave <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4">K</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.066ex" height="2.057ex" viewBox="0 -780.1 889.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/432020/&amp;usg=ALkJrhguqYN9RaHJdzfZgtSZiG-UYw3OhQ#MJMATHI-4B" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-2"> K </script>  na mesa <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-5"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-6">T</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.636ex" height="2.057ex" viewBox="0 -780.1 704.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/432020/&amp;usg=ALkJrhguqYN9RaHJdzfZgtSZiG-UYw3OhQ#MJMATHI-54" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-3"> T </script>  : chave <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-7"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-8">K</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-4-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.066ex" height="2.057ex" viewBox="0 -780.1 889.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/432020/&amp;usg=ALkJrhguqYN9RaHJdzfZgtSZiG-UYw3OhQ#MJMATHI-4B" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-4"> K </script>  mapeado para o intervalo <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-9"><span class="MJXp-mo" id="MJXp-Span-10" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mn" id="MJXp-Span-11">0</span><span class="MJXp-mo" id="MJXp-Span-12" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-13">1</span><span class="MJXp-mo" id="MJXp-Span-14" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-15">1</span><span class="MJXp-mo" id="MJXp-Span-16" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-17">0</span><span class="MJXp-mo" id="MJXp-Span-18" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-5-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="9.303ex" height="2.66ex" viewBox="0 -832 4005.5 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/432020/&amp;usg=ALkJrhguqYN9RaHJdzfZgtSZiG-UYw3OhQ#MJMAIN-5B" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/432020/&amp;usg=ALkJrhguqYN9RaHJdzfZgtSZiG-UYw3OhQ#MJMAIN-30" x="278" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/432020/&amp;usg=ALkJrhguqYN9RaHJdzfZgtSZiG-UYw3OhQ#MJMAIN-2C" x="779" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/432020/&amp;usg=ALkJrhguqYN9RaHJdzfZgtSZiG-UYw3OhQ#MJMAIN-31" x="1224" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/432020/&amp;usg=ALkJrhguqYN9RaHJdzfZgtSZiG-UYw3OhQ#MJMAIN-2C" x="1724" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/432020/&amp;usg=ALkJrhguqYN9RaHJdzfZgtSZiG-UYw3OhQ#MJMAIN-31" x="2169" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/432020/&amp;usg=ALkJrhguqYN9RaHJdzfZgtSZiG-UYw3OhQ#MJMAIN-2C" x="2670" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/432020/&amp;usg=ALkJrhguqYN9RaHJdzfZgtSZiG-UYw3OhQ#MJMAIN-30" x="3115" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/432020/&amp;usg=ALkJrhguqYN9RaHJdzfZgtSZiG-UYw3OhQ#MJMAIN-29" x="3616" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-5"> [0,1, 1,0) </script>  (usando MD5), dividido em se√ß√µes pelas quais uma cadeia √© respons√°vel.  As se√ß√µes podem ter larguras diferentes, dependendo do "peso" da corrente, por exemplo: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/kt/hy/hq/kthyhqgqi5bn5xthknmw4f5sjou.png"></div><br><br>  Assim, se alguns blocos f√≠sicos s√£o muito poderosos, as cadeias localizadas nele podem receber se√ß√µes mais largas (mais teclas cair√£o sobre eles). <br><br><h1>  6. HyperDex </h1><br>  O objetivo deste projeto era construir um armazenamento de valor-chave distribu√≠do, que, diferentemente de outras solu√ß√µes populares (BigTable, Cassandra, Dynamo), suporta uma pesquisa r√°pida por atributos secund√°rios e pode executar rapidamente uma pesquisa por intervalo.  Por exemplo, nos sistemas considerados anteriormente, para procurar todos os valores em um determinado intervalo, voc√™ precisa passar por todos os servidores, o que, obviamente, √© inaceit√°vel.  O HyperDex resolve esse problema usando <i>Hyperspace Hashing</i> . <br><br><h3>  6.1 Arquitetura </h3><br>  A id√©ia do hash do hiperespa√ßo √© construir <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-19"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-20">n</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-6-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-6"> n </script>  espa√ßo tridimensional em que cada atributo corresponde a um eixo de coordenadas.  Por exemplo, para objetos (nome, sobrenome, n√∫mero de telefone), o espa√ßo pode ser assim: <br><br><div style="text-align:center;"><img width="400" src="https://habrastorage.org/webt/zf/be/hu/zfbehu3mpmbsb1bwdfpofn_xywa.png"></div><br><br>  O hiperplano cinza passa por todas as chaves, onde sobrenome = Smith, amarelo - por todas as chaves, onde nome = John.  A interse√ß√£o desses planos forma uma resposta aos n√∫meros de telefone da consulta de pesquisa de pessoas com o nome John e o sobrenome Smith.  Portanto, o pedido de <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-21"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-22">k</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-7-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-7"> k </script>  atributos retorna <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-23"><span class="MJXp-mo" id="MJXp-Span-24" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-25">n</span><span class="MJXp-mo" id="MJXp-Span-26" style="margin-left: 0.267em; margin-right: 0.267em;">‚àí</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-27">k</span><span class="MJXp-mo" id="MJXp-Span-28" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-8-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-8"> (n-k) </script>  subespa√ßo tridimensional. <br><br>  O espa√ßo de pesquisa √© dividido em <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-29"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-30">n</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-9-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-9"> n </script>  regi√µes disjuntas tridimensionais e cada regi√£o √© atribu√≠da a um √∫nico servidor.  Um objeto com coordenadas de uma regi√£o √© armazenado no servidor dessa regi√£o.  Assim, um hash √© constru√≠do entre objetos e servidores. <br><br>  Uma consulta de pesquisa (por intervalo) determinar√° as regi√µes inclu√≠das no hiperplano resultante e, portanto, reduzir√° o n√∫mero de servidores pesquisados ‚Äã‚Äãao m√≠nimo. <br><br>  H√° um problema com essa abordagem: o n√∫mero de servidores necess√°rios cresce exponencialmente a partir do n√∫mero de atributos, ou seja,  se atributos <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-31"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-32">k</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-10-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-10"> k </script>  ent√£o voc√™ precisa <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-33"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-34">O</span><span class="MJXp-mo" id="MJXp-Span-35" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-36"><span class="MJXp-mn" id="MJXp-Span-37" style="margin-right: 0.05em;">2</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-38" style="vertical-align: 0.5em;">k</span></span><span class="MJXp-mo" id="MJXp-Span-39" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-11-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-11"> O (2 ^ k) </script>  servidores.  Para resolver esse problema, o HyperDex aplica uma parti√ß√£o do hiperespa√ßo em subespa√ßos (com uma dimens√£o inferior) com, respectivamente, um subconjunto de atributos: <br><br><div style="text-align:center;"><img width="400" src="https://habrastorage.org/webt/s1/nf/tk/s1nftktukf2qd4e9ljjuzsgj_b0.png"></div><br><h3>  6.2 Replica√ß√£o </h3><br>  Para garantir consist√™ncia estrita, os autores desenvolveram uma abordagem especial baseada na replica√ß√£o em cadeia - <i>encadeamento dependente de valor</i> , em que cada n√≥ subsequente √© determinado por hash do atributo correspondente.  Por exemplo, a chave <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-40"><span class="MJXp-mo" id="MJXp-Span-41" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mo" id="MJXp-Span-42" style="margin-left: 0.333em; margin-right: 0.333em;">"</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-43">J</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-44">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-45">h</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-46">n</span><span class="MJXp-mo" id="MJXp-Span-47" style="margin-left: 0.333em; margin-right: 0.333em;">"</span><span class="MJXp-mo" id="MJXp-Span-48" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-49" style="margin-left: 0.333em; margin-right: 0.333em;">"</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-50">S</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-51">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-52">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-53">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-54">h</span><span class="MJXp-mo" id="MJXp-Span-55" style="margin-left: 0.333em; margin-right: 0.333em;">"</span><span class="MJXp-mo" id="MJXp-Span-56" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-12-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-12"> ("John", "Smith") </script>  primeiro ele ser√° dividido no espa√ßo principal (obtemos a cadeia principal, tamb√©m chamada <i>l√≠der de pontos</i> ), depois o hash de <math> </math> $ inline $ "John" $ inline $   para a coordenada no eixo correspondente e assim por diante.  (Veja a imagem abaixo para um exemplo de atualiza√ß√£o. <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-64"><span class="MJXp-msubsup" id="MJXp-Span-65"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-66" style="margin-right: 0.05em;">u</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-67" style="vertical-align: -0.4em;">1</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-14-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-14"> u_1 </script>  ) <br><br>  Todas as atualiza√ß√µes passam por um l√≠der de ponto, que solicita solicita√ß√µes (linearizabilidade). <br><br><div style="text-align:center;"><img width="400" src="https://habrastorage.org/webt/qp/ab/z4/qpabz4f0rpxaybrtt5pzhegrrqk.png"></div><br><br>  Se a atualiza√ß√£o levar a uma altera√ß√£o na regi√£o, primeiro a nova vers√£o ser√° gravada imediatamente ap√≥s a antiga (consulte atualiza√ß√£o <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-68"><span class="MJXp-msubsup" id="MJXp-Span-69"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-70" style="margin-right: 0.05em;">u</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-71" style="vertical-align: -0.4em;">2</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-15-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-15"> u_2 </script>  ) e depois de receber o ACK da cauda, ‚Äã‚Äão link para a vers√£o antiga do servidor anterior ser√° alterado.  Para solicita√ß√µes simult√¢neas (por exemplo, <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-72"><span class="MJXp-msubsup" id="MJXp-Span-73"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-74" style="margin-right: 0.05em;">u</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-75" style="vertical-align: -0.4em;">2</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-16-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-16"> u_2 </script>  e <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-76"><span class="MJXp-msubsup" id="MJXp-Span-77"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-78" style="margin-right: 0.05em;">u</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-79" style="vertical-align: -0.4em;">3</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-17-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-17"> u_3 </script>  ) n√£o violou o l√≠der do ponto de consist√™ncia que adiciona controle de vers√£o e outras meta informa√ß√µes ao servidor, se recebidas <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-80"><span class="MJXp-msubsup" id="MJXp-Span-81"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-82" style="margin-right: 0.05em;">u</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-83" style="vertical-align: -0.4em;">3</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-18-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-18"> u_3 </script>  antes <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-84"><span class="MJXp-msubsup" id="MJXp-Span-85"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-86" style="margin-right: 0.05em;">u</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-87" style="vertical-align: -0.4em;">2</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-19-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-19"> u_2 </script>  pode determinar que o pedido est√° quebrado e voc√™ precisa esperar <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-88"><span class="MJXp-msubsup" id="MJXp-Span-89"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-90" style="margin-right: 0.05em;">u</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-91" style="vertical-align: -0.4em;">2</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-20-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-20"> u_2 </script>  . <br><br><h1>  7. ChainReaction </h1><br>  √â usado um modelo causal + converg√™ncia, que adiciona a condi√ß√£o de converg√™ncia livre de conflito √† converg√™ncia causal (causal).  Para atender √† converg√™ncia causal, os metadados s√£o adicionados a cada solicita√ß√£o, o que indica as vers√µes de todas as chaves causalmente dependentes.  O ChainReaction permite a replica√ß√£o geogr√°fica em v√°rios data centers e √© um desenvolvimento adicional da ideia do CRAQ. <br><br><h3>  7.1 Arquitetura </h3><br>  A arquitetura do FAWN √© usada com pequenas altera√ß√µes - cada controlador de dom√≠nio consiste em <i>servidores</i> de <i>dados</i> - back-end (armazenamento de dados, replica√ß√£o, forma um anel DHT) e <i>proxies de cliente</i> - front-end (envia uma solicita√ß√£o para um n√≥ espec√≠fico).  Cada chave √© replicada para R n√≥s consecutivos, formando uma cadeia.  As solicita√ß√µes de leitura s√£o processadas pela cauda e gravadas pela cabe√ßa. <br><br><div style="text-align:center;"><img width="500" src="https://habrastorage.org/webt/xz/lv/ei/xzlveipiopeqi4enyao1b_fuehw.png"></div><br><h3>  7.2 Um data center </h3><br>  Observamos uma propriedade importante decorrente da replica√ß√£o em cadeia - se o n√≥ <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-92"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-93">k</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-21-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-21"> k </script>  causal consistente com algumas opera√ß√µes do cliente, e todos os n√≥s anteriores - tamb√©m.  Ent√£o, se a opera√ß√£o <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-94"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-95">O</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-96">p</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-22-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-22"> Op </script>  foi visto pela √∫ltima vez por n√≥s no site <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-97"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-98">j</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-23-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-23"> j </script>  , todos os dependentes causais (de <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-99"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-100">O</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-101">p</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-24-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-24"> Op </script>  ) opera√ß√µes de leitura s√≥ podem ser executadas em n√≥s da cabe√ßa ao <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-102"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-103">j</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-25-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-25"> j </script>  .  Assim que <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-104"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-105">O</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-106">p</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-26-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-26"> Op </script>  ser√° executado na cauda - n√£o haver√° restri√ß√µes de leitura.  Indique as opera√ß√µes de grava√ß√£o que foram executadas por cauda no controlador de dom√≠nio <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-107"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-108">d</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-27-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-27"> d </script>  como <b>DC-Write-Stable (d)</b> . <br><br>  Cada cliente armazena uma lista (metadados) de todas as chaves solicitadas pelo cliente no formato (chave, vers√£o, chainIndex), em que chainIndex √© a posi√ß√£o do n√≥ na cadeia que respondeu √† √∫ltima solicita√ß√£o da chave de chave.  <b>Os metadados s√£o armazenados apenas para chaves que o cliente n√£o est√° ciente se √© DC-Write-Stable (d) ou n√£o</b> . <br><br><h4>  7.2.1 Opera√ß√£o de grava√ß√£o </h4><br>  Observe que quando a opera√ß√£o se tornar DC-Write-Stable (d), nenhuma solicita√ß√£o de leitura poder√° ler as vers√µes anteriores. <br><br>  Para cada solicita√ß√£o de grava√ß√£o, uma lista de todas as chaves nas quais as opera√ß√µes de leitura foram executadas antes da adi√ß√£o da √∫ltima opera√ß√£o de grava√ß√£o.  Assim que o proxy do cliente recebe a solicita√ß√£o, ele executa leituras de bloqueio nas caudas de todas as chaves dos metadados (estamos aguardando confirma√ß√£o da presen√ßa da mesma ou da vers√£o mais recente, ou seja, atendemos √† condi√ß√£o de consist√™ncia causal).  Assim que as confirma√ß√µes s√£o recebidas, a solicita√ß√£o de grava√ß√£o √© enviada ao chefe da cadeia correspondente. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/l2/qo/k_/l2qok_yldb0_aaqjcfmzj2ap_gk.png"></div><br><br>  Depois que o novo valor for armazenado em <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-109"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-110">k</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-28-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-28"> k </script>  n√≥s da cadeia, uma notifica√ß√£o √© enviada ao cliente (com o √≠ndice do √∫ltimo n√≥).  O cliente atualiza o chainIndex e remove os metadados das chaves enviadas, conforme  ficou conhecido sobre eles que eles eram DC-Write-Stable (d).  Paralelamente, a grava√ß√£o continua ainda mais - <i>propaga√ß√£o lenta</i> .  Assim, √© dada prioridade para escrever opera√ß√µes no primeiro <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-111"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-112">k</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-29-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-29"> k </script>  n√≥s.  Assim que o tail armazena a nova vers√£o da chave, uma notifica√ß√£o √© enviada ao cliente e transmitida a todos os n√≥s da cadeia, para que eles marquem a chave como est√°vel. <br><br><h4>  7.2.2 Opera√ß√£o de leitura </h4><br>  O proxy do cliente envia uma solicita√ß√£o de leitura para <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-113"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-114">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-115">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-116">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-117">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-118">x</span><span class="MJXp-mo" id="MJXp-Span-119" style="margin-left: 0.111em; margin-right: 0.167em;">:=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-120">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-121">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-122">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-123">d</span><span class="MJXp-mo" id="MJXp-Span-124" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-125">1</span><span class="MJXp-mo" id="MJXp-Span-126" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-127">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-128">h</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-129">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-130">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-131">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-132">I</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-133">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-134">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-135">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-136">x</span><span class="MJXp-mo" id="MJXp-Span-137" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-30-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-30"> index: = rand (1, chainIndex) </script>  n√≥ no circuito, enquanto distribui a carga.  Em resposta, o n√≥ envia o valor e a vers√£o desse valor.  A resposta √© enviada ao cliente, enquanto: <br><br><ul><li>  Se a vers√£o for est√°vel, o novo chainIndex ser√° igual ao tamanho da cadeia. </li><li>  Se a vers√£o for mais recente, o novo chainIndex = index. </li><li>  Caso contr√°rio, chainIndex n√£o ser√° alterado. </li></ul><br><h4>  7.2.3 Failover de n√≥ </h4><br>  √â quase completamente id√™ntico √† abordagem b√°sica, com algumas diferen√ßas no fato de que, em alguns casos, o chainIndex no cliente se torna inv√°lido - isso √© facilmente determinado ao executar solicita√ß√µes (n√£o h√° chave nesta vers√£o) e a solicita√ß√£o √© redirecionada ao chefe da cadeia para procurar o n√≥ com a vers√£o desejada. <br><br><h3>  7.3 V√°rios ( <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-138"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-139">N</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-31-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-31"> N </script>  ) data centers (replica√ß√£o geogr√°fica) </h3><br>  Tomamos como base os algoritmos de uma arquitetura de servidor √∫nico e os adaptamos ao m√≠nimo.  Para iniciantes, em metadados, em vez de apenas valores version e chainIndex, precisamos de vetores versionados de N dimens√µes. <br><br>  Definimos Global-Write-Stable de maneira semelhante ao DC-Write-Stable (d) - a opera√ß√£o de grava√ß√£o √© considerada Global-Write-Stable se for executada na cauda em todos os CDs. <br><br>  Um novo componente aparece em cada controlador de dom√≠nio - <i>remote_proxy</i> , sua tarefa √© receber / enviar atualiza√ß√µes de outros controladores de dom√≠nio. <br><br><h4>  7.3.1 Executando uma opera√ß√£o de grava√ß√£o (no servidor <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-140"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-141">i</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-32-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-32"> i </script>  ) </h4><br>  O come√ßo √© semelhante a uma arquitetura de servidor √∫nico - executamos leituras de bloqueio, gravamos na primeira <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-142"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-143">k</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-33-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-33"> k </script>  n√≥s de uma corrente.  Nesse momento, o proxy do cliente envia ao cliente um novo vetor chainIndex, onde zeros est√£o em toda parte, exceto a posi√ß√£o <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-144"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-145">i</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-34-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-34"> i </script>  - existe um significado <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-146"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-147">k</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-35-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-35"> k </script>  .  Pr√≥ximo - como de costume.  Uma opera√ß√£o adicional no final - a atualiza√ß√£o √© enviada para remote_proxy, que acumula v√°rias solicita√ß√µes e envia tudo. <br><br>  Dois problemas surgem aqui: <br><br><ul><li>  Como garantir depend√™ncias entre diferentes atualiza√ß√µes provenientes de diferentes controladores de dom√≠nio? <br><br>  Cada remote_proxy armazena um vetor de vers√£o local <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-148"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-149">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-150">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-151">p</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-36-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-36"> rvp </script>  dimens√µes <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-152"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-153">N</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-37-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-37"> N </script>  , que armazena o n√∫mero de atualiza√ß√µes enviadas e recebidas e as envia em cada atualiza√ß√£o.  Portanto, ao receber uma atualiza√ß√£o de outro controlador de dom√≠nio, o remote_proxy verifica os contadores e, se o contador local for menor, a opera√ß√£o ser√° bloqueada at√© que a atualiza√ß√£o correspondente seja recebida. </li><li>  Como fornecer depend√™ncias para esta opera√ß√£o em outros controladores de dom√≠nio? <br><br>  Isso √© obtido usando um filtro Bloom.  Ao executar opera√ß√µes de grava√ß√£o / leitura a partir do proxy do cliente, al√©m dos metadados, um filtro bloom tamb√©m √© enviado para cada chave (denominada filtros de resposta).  Esses filtros s√£o armazenados na lista <i>AccessedObjects</i> e, ao solicitar opera√ß√µes de grava√ß√£o / leitura, os metadados tamb√©m enviam chaves OR enviadas aos filtros (chamados de filtro de depend√™ncia).  Da mesma forma, ap√≥s a opera√ß√£o de grava√ß√£o, os filtros correspondentes s√£o exclu√≠dos.  Ao enviar uma opera√ß√£o de grava√ß√£o para outro controlador de dom√≠nio, tamb√©m s√£o enviados um filtro de depend√™ncia e um filtro de resposta para essa solicita√ß√£o. <br><br>  Al√©m disso, o controlador de dom√≠nio remoto, depois de receber todas essas informa√ß√µes, verifica se, se os bits definidos do filtro de resposta coincidem com os bits definidos de v√°rios filtros de consulta, essas opera√ß√µes s√£o potencialmente dependentes ocasionais.  Potencialmente - porque um filtro de flora√ß√£o. </li></ul><br><h4>  7.3.2 Opera√ß√£o de leitura </h4><br>  Da mesma forma que uma arquitetura de servidor √∫nico, ajustada para o uso do vetor chainIndex em vez de um escalar e a possibilidade de aus√™ncia de uma chave no controlador de dom√≠nio (porque as atualiza√ß√µes s√£o ass√≠ncronas) - aguarde ou redirecione a solicita√ß√£o para outro controlador de dom√≠nio. <br><br><h4>  7.3.3 Resolu√ß√£o de conflitos </h4><br>  Gra√ßas aos metadados, as opera√ß√µes dependentes de causalidade s√£o sempre executadas na ordem correta (√†s vezes √© necess√°rio bloquear o processo para isso).  Mas mudan√ßas competitivas em diferentes CDs podem levar a conflitos.  Para resolver essas situa√ß√µes, o Last Write Wins √© usado, para o qual um par est√° presente em cada opera√ß√£o de atualiza√ß√£o <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-154"><span class="MJXp-mo" id="MJXp-Span-155" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-156">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-157">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-158">l</span><span class="MJXp-mrow" id="MJXp-Span-159"><span class="MJXp-mo" id="MJXp-Span-160" style="margin-left: 0em; margin-right: 0em;">√≥</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-161">g</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-162">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-163">o</span><span class="MJXp-mo" id="MJXp-Span-164" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-165">s</span><span class="MJXp-mo" id="MJXp-Span-166" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-38-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-38"> (rel√≥gio (s)</script>  onde <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-167"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-168">c</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-39-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-39"> c </script>  - horas de procura√ß√£o, e <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-169"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-170">s</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-40-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-40"> s </script>  - ID do DC. <br><br><h4>  7.3.4 Manipulando falhas do n√≥ </h4><br>  Semelhante √† arquitetura de servidor √∫nico. <br><br><h1>  8. Aproveitando o sharding no design de protocolos de replica√ß√£o escal√°vel </h1><br>  O objetivo do estudo √© construir um sistema distribu√≠do com shards e com replica√ß√£o sem usar um processo mestre externo para reconfigurar / monitorar o cluster. <br><br>  Nas principais abordagens atuais, os autores v√™em as seguintes desvantagens: <br><br>  Replica√ß√£o: <br><br><ul><li>  Prim√°rio / Backup - leva a uma discrep√¢ncia no estado se o Prim√°rio tiver sido identificado por falha por engano. </li><li>  Interse√ß√£o de quorum - pode levar a uma discrep√¢ncia de estado durante a reconfigura√ß√£o de cluster. </li></ul><br>  Consist√™ncia estrita: <br><br><ul><li>  Os protocolos contam com algoritmos de vota√ß√£o majorit√°ria (por exemplo, Paxos) quando necess√°rio <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-171"><span class="MJXp-mn" id="MJXp-Span-172">2</span><span class="MJXp-mo" id="MJXp-Span-173" style="margin-left: 0.267em; margin-right: 0.267em;">‚àó</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-174">N</span><span class="MJXp-mo" id="MJXp-Span-175" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-176">1</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-41-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-41"> 2 * N + 1 </script>  soltar n√≥s <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-177"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-178">N</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-42-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-42"> N </script>  n√≥s. </li></ul><br>  Detec√ß√£o de falhas do n√≥: <br><br><ul><li>  P / B e CR implica a presen√ßa de detec√ß√£o ideal de n√≥s com falha com um modelo de falha-parada, o que √© inating√≠vel na pr√°tica e voc√™ deve escolher um intervalo de varredura adequado. </li><li>  O ZooKeeper est√° sujeito aos mesmos problemas - com um grande n√∫mero de clientes, uma quantidade significativa de tempo (&gt; 1 segundo) √© necess√°ria para que eles atualizem a configura√ß√£o. </li></ul><br>  A abordagem proposta pelos autores, denominada <i>replica√ß√£o el√°stica</i> , √© desprovida dessas defici√™ncias e possui as seguintes caracter√≠sticas: <br><br><ul><li>  Consist√™ncia estrita. </li><li>  Para suportar a queda <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-179"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-180">N</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-43-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-43"> N </script>  n√≥s devem ter <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-181"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-182">N</span><span class="MJXp-mo" id="MJXp-Span-183" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-184">1</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-44-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-44"> N + 1 </script>  n√≥. </li><li>  Reconfigura√ß√£o sem perda de consist√™ncia. </li><li>  N√£o h√° necessidade de protocolos de consenso com base na vota√ß√£o majorit√°ria. </li></ul><br>  Placa de resumo: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/al/nh/yf/alnhyf9vzquirk-ztizoplkeypa.png"></div><br><h3>  8.1 Organiza√ß√£o de r√©plicas </h3><br>  Cada shard define uma sequ√™ncia de configura√ß√µes <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-185"><span class="MJXp-mtext" id="MJXp-Span-186">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-187">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-188">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-189">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-190">h</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-191">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-192">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-193">l</span><span class="MJXp-mrow" id="MJXp-Span-194"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-195">C</span></span><span class="MJXp-mo" id="MJXp-Span-196" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-197"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-198" style="margin-right: 0.05em;">C</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-199" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-200" style="margin-left: 0.111em; margin-right: 0.167em;">::</span><span class="MJXp-msubsup" id="MJXp-Span-201"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-202" style="margin-right: 0.05em;">C</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-203" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-204" style="margin-left: 0.111em; margin-right: 0.167em;">::</span><span class="MJXp-msubsup" id="MJXp-Span-205"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-206" style="margin-right: 0.05em;">C</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-207" style="vertical-align: -0.4em;">3</span></span><span class="MJXp-mtext" id="MJXp-Span-208">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-209">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-210">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-211">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-212">s</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-45-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-45"> \ mathcal {C} = C_1 :: C_2 :: C_3 \ dots </script>  por exemplo, a nova configura√ß√£o n√£o cont√©m algum tipo de r√©plica ca√≠da <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-213"><span class="MJXp-mtext" id="MJXp-Span-214">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-215">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-216">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-217">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-218">h</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-219">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-220">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-221">l</span><span class="MJXp-mrow" id="MJXp-Span-222"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-223">C</span></span><span class="MJXp-mo" id="MJXp-Span-224" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mtext" id="MJXp-Span-225">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-226">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-227">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-228">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-229">h</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-230">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-231">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-232">l</span><span class="MJXp-mrow" id="MJXp-Span-233"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-234">C</span></span><span class="MJXp-mo" id="MJXp-Span-235" style="margin-left: 0.111em; margin-right: 0.167em;">::</span><span class="MJXp-mo" id="MJXp-Span-236" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-237">R</span><span class="MJXp-mrow" id="MJXp-Span-238"><span class="MJXp-mo" id="MJXp-Span-239" style="margin-left: 0em; margin-right: 0em;">√©</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-240">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-241">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-242">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-243">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-244">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-245">s</span><span class="MJXp-mtext" id="MJXp-Span-246">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-247">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-248">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-249">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-250">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-251">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-252">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-253">u</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-254">s</span><span class="MJXp-msubsup" id="MJXp-Span-255"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-256" style="margin-right: 0.05em;">R</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-257" style="vertical-align: -0.4em;">j</span></span><span class="MJXp-mo" id="MJXp-Span-258" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-46-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-46"> \ mathcal {C} = \ mathcal {C}: :( R√©plicas \ setminus R_j) </script><br><br>  Cada elemento da sequ√™ncia de configura√ß√£o consiste em: <br><br><ul><li>  r√©plicas - um conjunto de r√©plicas. </li><li>  <i>ordenador</i> - ID de uma r√©plica com uma fun√ß√£o especial (veja abaixo). </li></ul><br>  Cada fragmento √© representado por um conjunto de r√©plicas (por constru√ß√£o - <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-259"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-260">N</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-47-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-47"> N </script>  ), ou seja,  n√£o dividimos os pap√©is de "fragmento" e "r√©plica". <br><br>  Cada r√©plica armazena os seguintes dados: <br><br><ul><li>  conf - ID da configura√ß√£o √† qual esta r√©plica pertence. </li><li>  ordenador - qual r√©plica √© o ordenador dessa configura√ß√£o. </li><li>  mode - modo de r√©plica, um dos tr√™s: <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-261"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-262">P</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-263">E</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-264">N</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-265">D</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-266">E</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-267">N</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-268">T</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-269">E</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-48-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-48"> PENDENTE </script>  (todas as r√©plicas de <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-270"><span class="MJXp-msubsup" id="MJXp-Span-271"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-272" style="margin-right: 0.05em;">C</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-273" style="vertical-align: -0.4em;">1</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-49-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-49"> C_1 </script>  ), <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-274"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-275">A</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-276">T</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-277">I</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-278">V</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-279">O</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-50-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-50"> ATIVO </script>  (todas as r√©plicas de <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-280"><span class="MJXp-msubsup" id="MJXp-Span-281"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-282" style="margin-right: 0.05em;">C</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-283" style="vertical-align: -0.4em;">1</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-51-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-51"> C_1 </script>  ), <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-284"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-285">I</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-286">M</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-287">M</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-288">U</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-289">T</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-290">A</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-291">B</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-292">L</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-293">E</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-52-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-52"> IMMUTABLE </script>  . </li><li>  hist√≥rico - sequ√™ncia de opera√ß√µes nos dados reais da r√©plica <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-294"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-295">o</span><span class="MJXp-msubsup" id="MJXp-Span-296"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-297" style="margin-right: 0.05em;">p</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-298" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-299" style="margin-left: 0.111em; margin-right: 0.167em;">::</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-300">o</span><span class="MJXp-msubsup" id="MJXp-Span-301"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-302" style="margin-right: 0.05em;">p</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-303" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-304" style="margin-left: 0.111em; margin-right: 0.167em;">::</span><span class="MJXp-mtext" id="MJXp-Span-305">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-306">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-307">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-308">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-309">s</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-53-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-53"> op_1 :: op_2 :: \ dots </script>  (ou apenas uma condi√ß√£o). </li><li>  est√°vel - o comprimento m√°ximo do prefixo do hist√≥rico que √© corrigido por esta r√©plica.  Obviamente, <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-310"><span class="MJXp-mn" id="MJXp-Span-311">0</span><span class="MJXp-mo" id="MJXp-Span-312" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-313">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-314">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-315">t</span><span class="MJXp-mrow" id="MJXp-Span-316"><span class="MJXp-mo" id="MJXp-Span-317" style="margin-left: 0em; margin-right: 0em;">√°</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-318">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-319">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-320">l</span><span class="MJXp-mo" id="MJXp-Span-321" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-322">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-323">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-324">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-325">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-326">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-327">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-328">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-329">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-330">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-331">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-332">o</span><span class="MJXp-mo" id="MJXp-Span-333" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-334">h</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-335">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-336">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-337">t</span><span class="MJXp-mrow" id="MJXp-Span-338"><span class="MJXp-mo" id="MJXp-Span-339" style="margin-left: 0em; margin-right: 0em;">√≥</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-340">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-341">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-342">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-343">o</span><span class="MJXp-mo" id="MJXp-Span-344" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-54-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-54"> 0 <= est√°vel <= comprimento (hist√≥rico) </script>  . </li></ul><br>  O objetivo principal de um ordenador de r√©plicas √© enviar solicita√ß√µes para o restante das r√©plicas e manter o maior prefixo do hist√≥rico: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/7_/hk/lo/7_hklowfxczcx0tjd5grugrw9a8.png"></div><br><h3>  8.2 Organiza√ß√£o de fragmentos </h3><br>  Os fragmentos s√£o combinados em an√©is chamados <i>el√°sticos</i> .  Cada fragmento pertence a apenas um anel.  O precursor de todo fragmento <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-345"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-346">X</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-55-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-55"> X </script>  desempenha um papel especial - ele √© um <i>sequenciador</i> para ele.  O trabalho do seq√ºenciador √© fornecer ao sucessor uma nova configura√ß√£o em caso de falhas de r√©plica. <br><br><div style="text-align:center;"><img width="300" src="https://habrastorage.org/webt/sc/8g/se/sc8gsegolx8iarmilhrkeftetfo.png"></div><br>  S√£o necess√°rias duas condi√ß√µes: <br><br><ul><li>  Cada faixa el√°stica possui pelo menos um fragmento e uma r√©plica em funcionamento. </li><li>  Cada faixa el√°stica possui pelo menos um fragmento, no qual todas as r√©plicas est√£o funcionando. </li></ul><br>  A segunda condi√ß√£o parece muito rigorosa, mas √© equivalente √† condi√ß√£o ‚Äútradicional‚Äù de que o processo mestre nunca cai. <br><br><h3>  8.3 Usando replica√ß√£o em cadeia </h3><br>  Como voc√™ deve ter adivinhado, as r√©plicas s√£o organizadas como uma cadeia (abordagem b√°sica) - o ordenador ser√° o chefe, com pequenas diferen√ßas: <br><br><ul><li>  Em caso de falha no CR, o n√≥ √© expulso da cadeia (e substitu√≠do por um novo), no ER - uma nova cadeia √© criada. </li><li>  Os pedidos de leitura no CR s√£o processados ‚Äã‚Äãpor cauda, ‚Äã‚Äãno ER, eles passam por toda a cadeia da mesma maneira que os pedidos de grava√ß√£o. </li></ul><br><h3>  8.5 Reconfigura√ß√£o em caso de falha </h3><br><ul><li>  As r√©plicas s√£o monitoradas pelas r√©plicas do seu fragmento e pelas r√©plicas de um fragmento do seq√ºenciador. </li><li>  Assim que uma falha √© detectada, as r√©plicas enviam um comando sobre isso. </li><li>  O seq√ºenciador envia uma nova configura√ß√£o (sem uma r√©plica com falha). </li><li>  Uma nova r√©plica √© criada que sincroniza seu estado com a faixa el√°stica. </li><li>  Depois disso, o seq√ºenciador envia a nova configura√ß√£o com a r√©plica adicionada. </li></ul><br><h1>  Refer√™ncias </h1><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://">Hibari</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">hyperdex.orgerdex.org</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">HyperDex: um armazenamento de valor-chave pesquis√°vel e distribu√≠do</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Rea√ß√£o em cadeia</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Aproveitando o sharding no design de protocolos de replica√ß√£o escal√°vel</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt432020/">https://habr.com/ru/post/pt432020/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt432006/index.html">A hist√≥ria de como entrei no t√≥pico da sa√∫de da mulher</a></li>
<li><a href="../pt432008/index.html">Perseguindo os padr√µes da Web</a></li>
<li><a href="../pt432012/index.html">Como testar contratos inteligentes</a></li>
<li><a href="../pt432014/index.html">Kali Linux para iniciantes</a></li>
<li><a href="../pt432016/index.html">Como a m√∫sica e o desenho me ensinaram a programar</a></li>
<li><a href="../pt432022/index.html">Forkney it: 8 V√° a projetos interessantes para cavar no c√≥digo fonte</a></li>
<li><a href="../pt432024/index.html">Gradle 5.0 - novidades</a></li>
<li><a href="../pt432030/index.html">O caminho para um detector de mentiras sem contato ou Como organizar uma hackathon na velocidade m√°xima</a></li>
<li><a href="../pt432032/index.html">Conclu√≠mos o campo de pesquisa do Google</a></li>
<li><a href="../pt432034/index.html">O livro ‚ÄúEletricidade passo a passo‚Äù, de Rudolf Svoren</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>