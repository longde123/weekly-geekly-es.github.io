<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ–Šï¸ ğŸ‘‡ğŸ¼ ğŸ‚ğŸ½ IngÃ©nierie des cadeaux âœ’ï¸ ğŸ‘©ğŸ»â€ğŸ­ ğŸ’…ğŸ¾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En dehors de la fenÃªtre il pleut, dÃ©cembre est au calendrier. Le temps des vacances approche et donc celui des cadeaux. Le collÃ¨gue Pavel veut un nouv...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>IngÃ©nierie des cadeaux</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/480792/"><img src="https://habrastorage.org/webt/md/lw/ph/mdlwpht7vhixr2jkxrftetb8hv4.jpeg"><br><br>  En dehors de la fenÃªtre il pleut, dÃ©cembre est au calendrier.  Le temps des vacances approche et donc celui des cadeaux.  Le collÃ¨gue Pavel veut un nouvel ordinateur portable pour lui-mÃªme, et sa petite amie Masha veut une maison au bord de la mer.  Et malgrÃ© le salaire digne de la profession de programmeur tyzh, nous ne vivons pas dans un monde de possibilitÃ©s infinies, ce qui signifie que je ne peux pas donner Ã  ces gens exactement ce qu'ils veulent le plus (mÃªme si Pacha est peut-Ãªtre mon meilleur Pavel, qui Je sais, mais Masha va trÃ¨s bien). <br><br>  C'est lÃ  que le problÃ¨me des Â«cadeaux bon marchÃ©Â» apparaÃ®t.  Cela ne fonctionne pas de donner un cadeau cher Ã  tout le monde, mais je ne veux pas donner une autre boÃ®te de chocolats, une bougie ou une figurine indistincte.  Vous devez donc combiner affaires et plaisir - j'aime faire les choses de mes propres mains, et le rÃ©sultat est excellent comme cadeau.  Ceci est une histoire sur la faÃ§on dont j'ai de nouveau prÃ©tendu Ãªtre ingÃ©nieur et fabriquÃ© plusieurs cadeaux Ã  la main. <br><a name="habracut"></a><br><h2>  Une petite digression du sujet principal </h2><br>  Je ne peux pas aller directement au sujet principal, je vais donc partir de loin.  Il y a quelques annÃ©es, le jeu Â«The Witcher 3Â» est sorti.  Mon ami m'a conseillÃ© de jouer, et en gÃ©nÃ©ral j'ai vraiment admirÃ© le jeu.  Ensuite, j'ai dÃ©cidÃ© quoi faire et lui donner quelque chose de thÃ©matique liÃ© au jeu ... Je n'entrerai pas trop dans la description du jeu (Google aidera tout le monde) ou je dirais que peu de choses me sont venues Ã  l'esprit pour les mots clÃ©s "The Witcher, Engineer, Gift". <br><br>  Le personnage principal du jeu a un cheval nommÃ© "Roach" (en voix russe), le hÃ©ros la conduit de temps en temps avec la phrase "Move, Roach".  J'ai dÃ©cidÃ© de fabriquer un jouet mÃ©canique sur le thÃ¨me des "cafards Ã©mouvants". <br><br>  Naturellement, le cadeau a Ã©tÃ© conÃ§u comme une chose complÃ¨tement inutile, stupide mais drÃ´le, donc le plan Ã©tait le suivant: <br><br><ol><li>  Il y a une boÃ®te qui cache le mÃ©canisme en soi. </li><li>  Le mÃ©canisme est un arbre en rotation que le cheval dÃ©place. </li><li>  La Â«tÃ©nacitÃ©Â» maximale du mouvement du cheval est la bienvenue.  Au dÃ©part, on pensait mÃªme que le cheval devait se dÃ©placer comme un poisson, et non comme un cheval (aprÃ¨s tout, un gardon), mais le rÃ©sultat Ã©tait Â«quelque chose entre les deuxÂ». </li><li>  Tout cela sera fait Ã  partir de contreplaquÃ©, qui selon les dessins peut Ãªtre coupÃ© avec prÃ©cision avec un laser. </li></ol><br>  Le principal inconvÃ©nient du choix du matÃ©riau et du fait que la dÃ©coupe sera rÃ©alisÃ©e sur commande est le fait que j'ai perdu l'opportunitÃ© de crÃ©er un prototype, ce qui signifie que tous les problÃ¨mes de mains tordues et de non-respect de la rÃ¨gle des Â«sept fois la mesureÂ» se sont fait sentir assez rapidement: <br><br><img src="https://habrastorage.org/webt/bq/9h/e2/bq9he2doyiixrvhr47zha5frml0.jpeg"><br><br>  Bien qu'Ã  la fin, le fait que de nombreux dÃ©tails du mÃ©canisme de jeu en raison de trop grands Ã©carts aient aidÃ© Ã  compenser le fait que j'ai connectÃ© les piÃ¨ces et l'arbre de faÃ§on assez tordue.  Ici, comme on dit, Â«moins moins donne plusÂ» et le mÃ©canisme dans son ensemble a fonctionnÃ© comme prÃ©vu: <br><br><img src="https://habrastorage.org/webt/cn/x2/gf/cnx2gfjjm2rasl3jtcd3oah-ors.gif"><br><br>  AprÃ¨s il n'y avait plus qu'une petite peinture et le rÃ©sultat Ã©tait une telle boÃ®te: <br><br><img src="https://habrastorage.org/webt/fe/x9/uf/fex9ufxoprduhzobingucsoinm4.jpeg"><br><br>  Ensuite, quelqu'un dira qu'il Ã©tait nÃ©cessaire de rendre la boÃ®te transparente pour qu'il soit possible d'observer le travail de l'intÃ©rieur, mais en fait j'ai d'abord pensÃ© que je ne pouvais pas assembler l'ensemble du mÃ©canisme et de la boÃ®te si propre et soigneusement de l'intÃ©rieur qu'il ne ferait pas de mal regardez Ã  travers les parois transparentes de la boÃ®te.  Par consÃ©quent, une boÃ®te opaque est une mesure nÃ©cessaire. <br><br>  Il ne reste plus qu'Ã  l'emballer, Ã  nouer un noeud sur une boite et le cadeau est prÃªt: <br><br><img src="https://habrastorage.org/webt/k9/47/k_/k947k_nkfln04gnb6adkqda9vs4.jpeg"><br><br>  Mais afin de ne pas dÃ©ranger l'enfant intÃ©rieur, qui voulait se sentir comme un ingÃ©nieur dans une situation oÃ¹ en fait j'ai collÃ© quelques morceaux de contreplaquÃ©, j'ai dÃ©cidÃ© de faire un Â«dessinÂ».  Pardonnez-moi tous ceux qui comprennent quelque chose dans les dessins techniques, car  Je comprends que c'est plus une parodie du dessin qu'un vrai dessin, mais comme il me semblait, il a ajoutÃ© de la valeur Ã  un simple jouet: <br><br><img src="https://habrastorage.org/webt/pk/t2/ms/pkt2msf9f2s496bchyrmdi6fs0w.png"><br><br><h2>  Aujourd'hui, je ... </h2><br>  Parfois, le destin joue avec nous et laisse entendre que quelque chose devrait arriver bientÃ´t.  L'histoire d'un de mes appareils commence exactement de la mÃªme maniÃ¨re.  J'ai commandÃ© quelques petits appareils Ã©lectroniques d'une valeur d'environ 5 $, qui, comme d'habitude, ont passÃ© un mois sur la route, aprÃ¨s quoi j'ai reÃ§u un SMS que le colis m'attendait au bureau de poste local.  La boÃ®te s'est avÃ©rÃ©e beaucoup plus grande que ce Ã  quoi je m'attendais et a immÃ©diatement soulevÃ© des doutes quant Ã  son contenu.  Les doutes ont Ã©tÃ© confirmÃ©s - Ã  l'intÃ©rieur, en plus des petites choses que j'ai commandÃ©es, il y avait aussi un Ã©cran e-ink tricolore avec une diagonale de 4,2 pouces.  J'ai contactÃ© le vendeur, il a confirmÃ© qu'il avait gÃ¢chÃ© quelque chose lors de l'emballage, mais a dit que je peux considÃ©rer cela comme un cadeau et l'utiliser comme bon me semble. <br><br>  Le destin m'a laissÃ© entendre que le moment Ã©tait venu de commencer un nouveau projet et que ce projet sera quelque chose avec un affichage Ã  encre Ã©lectronique.  AprÃ¨s m'Ãªtre briÃ¨vement familiarisÃ© avec les spÃ©cifications de l'appareil et connectÃ© l'Ã©cran au contrÃ´leur, je me suis assurÃ© que les spÃ©cifications ne me mentaient pas sur le temps de mise Ã  jour.  L'Ã©cran a Ã©tÃ© mis Ã  jour pendant plus de 10 secondes, clignotant et essayant de me provoquer une crise d'Ã©pilepsie: <br><br><img src="https://habrastorage.org/webt/ni/w1/h5/niw1h5wpnfczyud_2593yvxq-mg.gif"><br>  (Je n'ai pas de premiÃ¨res photos de la connexion de l'Ã©cran, alors ici, l'appareil a dÃ©jÃ  un look plus significatif) <br><br>  Il est devenu clair que vous avez besoin d'un appareil simple qui ne nÃ©cessitera pas d'animations complexes (et des animations en gÃ©nÃ©ral).  Et puis je suis tombÃ© sur un calendrier d'humeur: <br><img src="https://habrastorage.org/webt/zm/a0/dg/zma0dglgpkea9lkxbnqlndawc-o.jpeg"><br><br>  Le calendrier de l'humeur est un ensemble d'images simples et de signatures ironiques.  J'ai dÃ©cidÃ© que je ferais un calendrier (qui n'est en fait pas du tout un calendrier) avec le nom "Today I" ... Ce sera un appareil simple qui affiche chaque jour une image caractÃ©risant "l'Ã©tat d'esprit" aujourd'hui et une description de celui-ci.  De plus, le calendrier pourrait Ã©galement avoir d'autres fonctions, mais le calendrier principal serait prÃ©cisÃ©ment le Â«calendrierÂ» - sa propre image pour chaque jour. <br><br>  Le module papier Ã©lectronique permettait d'afficher trois couleurs (noir, rouge et blanc), qui devaient Ãªtre transmises au module, comme deux images - noir et blanc et rouge et blanc.  En fait, il serait plus correct de dire que l'Ã©cran attend simplement un bitmap monochrome, oÃ¹ chaque bit dÃ©termine la couleur d'un pixel (je ne suis pas sÃ»r que ce terme soit applicable au papier Ã©lectronique, mais j'espÃ¨re que l'idÃ©e est claire).  Un bitmap sÃ©parÃ© peut Ãªtre dÃ©fini pour le canal noir ou rouge.  Ainsi, il y a un ensemble d'octets oÃ¹ chaque bit qui est mis Ã  1 correspondra Ã  un pixel de couleur, et tous les bits qui restent 0 seront des pixels blancs Ã  l'Ã©cran.  La rÃ©solution d'Ã©cran est de 400 x 300 pixels, soit  pour une image en noir et blanc, 15 000 octets seront nÃ©cessaires (8 pixels sont encodÃ©s dans un octet).  Pour les trois couleurs, il faudra 30 000 octets, si vous n'essayez pas de compresser l'image de maniÃ¨re plus compacte.  Du point de vue de la mise en Å“uvre, les crÃ©ateurs de l'affichage pourraient simplement sÃ©lectionner deux bits par pixel et stocker l'Ã©tat rÃ©el des choses (oÃ¹ est le rouge, oÃ¹ est le noir et oÃ¹ est le blanc), mais cela nÃ©cessiterait les mÃªmes 30000 octets, mais mÃªme pour les images monochromes nÃ©cessiterait le transfert de 30 000 octets. <br><br>  Comme dans n'importe lequel de mes autres Â«mÃ©tiersÂ», j'ai commencÃ© Ã  m'inventer des tÃ¢ches pour que tout ne se transforme pas en Â«brancher le cÃ¢blage et tÃ©lÃ©charger la bibliothÃ¨queÂ».  MÃªme si nous prenons en compte la possibilitÃ© d'implÃ©menter une sorte d'algorithme de compression d'image du cÃ´tÃ© du contrÃ´leur, il est devenu clair que sans un stockage externe pour les fichiers d'image, le contrÃ´leur serait trÃ¨s dÃ©primÃ©.  Il a Ã©tÃ© dÃ©cidÃ© de prendre une carte SD et d'Ã©crire un simple wrapper de code pour travailler avec FAT32.  Bien sÃ»r, il serait possible de se passer d'un systÃ¨me de fichiers et d'Ã©crire directement des donnÃ©es sur une carte mÃ©moire, mais il me semblait que c'Ã©tait moins pratique pour ajouter de nouveaux fichiers, et il Ã©tait intÃ©ressant pour moi de mettre en Å“uvre les opÃ©rations de base pour travailler avec FAT32 de mes propres mains. <br><br>  Il est important de prÃ©ciser que j'ai l'habitude d'Ã©crire des choses moi-mÃªme (vous ne devriez pas me dire qu'il y a une mer de bibliothÃ¨ques, je connais et avec Google) quand je fais de telles choses  Avant cela, je n'avais pas eu le plaisir de travailler avec FAT32 Ã  un niveau bas, c'Ã©tait un processus plutÃ´t amusant. <br><br>  Je n'entrerai pas dans les dÃ©tails du travail avec FAT32 et la carte SD dans son ensemble, car  Internet regorge d'articles sur ce sujet (et je ne veux pas transformer mon histoire en une nouvelle version des spÃ©cifications), mais je vais parler de certaines choses qui devaient Ãªtre mises en Å“uvre.  Il est nÃ©cessaire d'implÃ©menter non seulement les fonctions de lecture d'un fichier et d'Ã©criture dans un fichier (j'ai dÃ©cidÃ© de stocker certains paramÃ¨tres et conditions sur la mÃªme carte SD, et non dans l'EEPROM), mais aussi les fonctions de recherche d'un fichier dans le systÃ¨me de fichiers si vous avez besoin de travailler avec de la maniÃ¨re habituelle. <br><br>  Toutes les donnÃ©es de la carte mÃ©moire sont divisÃ©es en grappes (l'unitÃ© adressable principale du systÃ¨me de fichiers FAT32) et les grappes sont dÃ©jÃ  divisÃ©es en secteurs.  Pour lire le fichier Â«habr.txtÂ» de la carte SD en FAT32, vous avez besoin de: <br><br><ol><li>  Initialisez la carte mÃ©moire. </li><li>  Lisez le secteur Ã  l'adresse zÃ©ro et vÃ©rifiez que le systÃ¨me de fichiers FAT32 a un certain en-tÃªte (vous pouvez sauter cette Ã©tape si nous croyons en la chance). </li><li>  Lisez le secteur Ã  l'adresse zÃ©ro et obtenez Â«Logical Block AddressingÂ» (LBA). </li><li>  Lisez le secteur Ã  l'adresse reÃ§ue (LBA) et obtenez-en les donnÃ©es nÃ©cessaires (quel cluster est la racine - le rÃ©pertoire racine, combien de secteurs se trouvent dans le cluster, etc.). </li><li>  Lisez le cluster Â«RÃ©pertoire racineÂ» (en fait, la lecture se fait par secteurs, il vous suffit de lire autant de secteurs qu'il y a de secteurs dans le cluster) par son numÃ©ro.  Il a sa propre formule pour convertir les numÃ©ros de sÃ©rie du cluster en adresses physiques.  Les informations sur les fichiers sont stockÃ©es ici, nous lisons donc les donnÃ©es Ã  la recherche du fichier souhaitÃ©.  Il y a une bagatelle de plus sur les noms de fichiers: le nom peut Ãªtre court ou long, selon cela, les donnÃ©es sont stockÃ©es soit en un seul endroit (dans la mÃªme structure) soit dans un enregistrement supplÃ©mentaire, qui doit Ã©galement Ãªtre lu sÃ©parÃ©ment.  Lorsqu'un fichier portant le nom souhaitÃ© est trouvÃ©, nous obtenons le cluster dans lequel se trouve son dÃ©but (ou peut-Ãªtre le fichier entier s'il tient dans la taille du cluster), ainsi que la taille du fichier.  Si le fichier n'est pas trouvÃ© dans ce cluster, nous recherchons le cluster suivant et rÃ©pÃ©tons le processus de recherche de fichier. </li><li>  Lisez le cluster Ã  l'adresse trouvÃ©e.  Continuez Ã  lire les clusters et recherchez le cluster suivant jusqu'Ã  ce que toutes les donnÃ©es aient Ã©tÃ© lues. </li></ol><br>  Il me semble qu'il est plus facile de dire le principe du systÃ¨me de fichiers Ã  ceux qui ont mis en place des listes chaÃ®nÃ©es au moins une fois, car  en fait, le systÃ¨me de fichiers FAT32 est un ensemble de blocs de donnÃ©es et une sorte de tableau qui indique oÃ¹ chercher le prochain bloc de donnÃ©es.  La lecture des donnÃ©es de FAT32 est un processus oÃ¹ nous lisons les donnÃ©es, recherchons l'adresse du bloc suivant, lisons les donnÃ©es, recherchons l'adresse du bloc suivant, etc. <br><br>  Je n'ai pas implÃ©mentÃ© tous les scÃ©narios possibles et simplifiÃ© certaines choses: <br><br><ul><li>  Tous les fichiers sont Ã  la racine de la carte mÃ©moire et la navigation dans les rÃ©pertoires n'est pas utilisÃ©e. </li><li>  Tous les fichiers ont des noms courts. </li><li>  Au dÃ©marrage, le contrÃ´leur lit une liste de fichiers et les stocke en mÃ©moire afin de ne pas rechercher Ã  nouveau chaque fichier. </li><li>  Le nombre maximum de fichiers est limitÃ© par une constante (et en fait je n'ai dessinÃ© que quelques dizaines d'images). </li></ul><br>  En bref, tout ce qui prÃ©cÃ¨de est une raison convaincante de prendre une bibliothÃ¨que prÃªte Ã  l'emploi et de ne pas passer beaucoup de temps Ã  lire la documentation, Ã  dÃ©velopper et Ã  dÃ©boguer.  Je me conseillerais de mettre en Å“uvre de telles choses uniquement Ã  des fins Ã©ducatives ou Â«pour le plaisirÂ». <br><br>  L'Ã©cran a Ã©galement imposÃ© certaines limitations, comme  n'importe quelle image dessus est affichÃ©e de cette faÃ§on: <br><br><ol><li>  Nous nous rÃ©veillons et initialisons l'Ã©cran (afin de prolonger sa durÃ©e de vie et d'Ã©conomiser de l'Ã©nergie, l'Ã©cran dort essentiellement). </li><li>  Nous exposons le canal nÃ©cessaire (par exemple, noir). </li><li>  Nous transmettons 15 000 octets de l'image. </li><li>  Nous exposons le canal nÃ©cessaire (par exemple, rouge). </li><li>  Nous transmettons 15 000 octets de l'image. </li><li>  Nous disons Ã  l'Ã©cran de tirer les donnÃ©es du tampon. </li><li>  Nous attendons que l'affichage ait fini de dessiner. </li><li>  Nous disons Ã  l'Ã©cran de dormir. </li></ol><br>  Pour les images monochromes, vous pouvez ignorer les Ã©tapes 4 et 5. Pour une image en trois couleurs, l'ordre de transmission des images en noir et blanc et rouge-blanc n'est pas important, car  le rouge est toujours peint sur le noir, le noir n'est que sur le blanc et seuls les pixels restent blancs, qui sont blanc et noir et blanc et rouge et blanc. <br><br>  Pour plus de simplicitÃ© (afin de ne pas augmenter le nombre total de fichiers), j'ai dÃ©cidÃ© de stocker les images en noir et blanc et rouge-blanc en un seul fichier, oÃ¹ l'image en noir et blanc est immÃ©diatement suivie de rouge-blanc: <br><br><img src="https://habrastorage.org/webt/qo/p-/4j/qop-4jlidhtf82tthoxxspebl2o.png"><br><br>  Le rÃ©sultat de la comparaison de ces images Ã©tait quelque chose comme Ã§a (il me semble que chacun de nous au moins une fois dans sa vie se sentait comme un cerf avec des cornes - une jambe): <br><br><img src="https://habrastorage.org/webt/7o/tb/cs/7otbcsv6yqjrqivfjutep87b1am.png"><br><br>  En fait, les deux images ont Ã©tÃ© suivies d'une autre image qui contenait une description de l'Ã©tat (en cliquant sur le bouton, vous pouvez obtenir une description qui correspond Ã  l'image qui est affichÃ©e aujourd'hui). <br><br>  En raison de la mÃ©moire limitÃ©e du contrÃ´leur, les donnÃ©es de la carte mÃ©moire ne sont jamais lues entiÃ¨rement dans la mÃ©moire du contrÃ´leur.  L'image de la carte mÃ©moire est lue en fragments qui sont dÃ©terminÃ©s par la taille du secteur (pour simplifier, nous supposons que cette taille est toujours statique et ne peut pas changer de carte en carte) et tombe dans le processus de traitement des donnÃ©es de la carte.  Dans mon implÃ©mentation, la fonction de lecture d'un fichier prend en entrÃ©e le numÃ©ro de cluster, la taille du fichier et le rappel Ã  "tirer" pour chaque secteur lu.  Cette approche nous a permis d'utiliser plusieurs fonctions diffÃ©rentes de traitement de fichiers pour lire et afficher l'image elle-mÃªme ou sa description. <br><br>  Ainsi, la logique suivante est tombÃ©e sur la fonction de rappel de lecture d'images Ã  partir d'une carte mÃ©moire: <br><br><ol><li>  DÃ©finissez le canal requis (le canal est dÃ©terminÃ© de maniÃ¨re alÃ©atoire) avant d'envoyer des donnÃ©es Ã  l'Ã©cran. </li><li>  Gardez une trace des donnÃ©es transmises pour changer de canal lorsque l'envoi des donnÃ©es pour le canal prÃ©cÃ©dent est terminÃ©. </li><li>  Envoyer les donnÃ©es reÃ§ues de la carte. </li><li>  DÃ©terminez que les donnÃ©es nÃ©cessaires ont Ã©tÃ© transmises et que le reste des donnÃ©es (image avec description) peut Ãªtre ignorÃ©. </li></ol><br>  C'Ã©tait compliquÃ© par le fait que j'ai dÃ©cidÃ© de saisir des images contenant plus de donnÃ©es que ce qui devrait Ãªtre affichÃ© Ã  l'Ã©cran.  C'est-Ã -dire  il y a une image, qui est l'arriÃ¨re-plan et est toujours statique et correspond Ã  la taille de l'Ã©cran, et il y a une image beaucoup plus grande Ã  partir de laquelle vous devez prendre une zone alÃ©atoire (la taille de l'Ã©cran) et l'afficher. <br><br>  Une telle image imposait des exigences supplÃ©mentaires au gestionnaire - il Ã©tait nÃ©cessaire de calculer combien d'octets de la ligne actuelle de l'Ã©cran ont Ã©tÃ© transfÃ©rÃ©s, combien il fallait ajouter lors du prochain appel (si la ligne tombait Ã  la frontiÃ¨re de la taille du secteur) et combien devaient Ãªtre ignorÃ©s. <br><br>  Visuellement, cette situation peut Ãªtre montrÃ©e comme ceci: <br><br><img src="https://habrastorage.org/webt/22/iy/sr/22iysrbf7x-8n4ptpq4mtbq6kjc.png"><br><br>  Il y a un certain tampon dans lequel il y a une Â«fenÃªtreÂ» de la taille requise (section verte) et il vous suffit de lire les donnÃ©es de cette fenÃªtre, en lisant les donnÃ©es du tampon en fragments de N octets.  Il serait possible de visualiser un tel processus de lecture comme celui-ci: <br><br><img src="https://habrastorage.org/webt/cp/me/qo/cpmeqoznzfnhkflphfxdhscxhq0.gif"><br><br>  En gÃ©nÃ©ral, l'ajout de la logique de travail avec l'Ã©cran dans une fonction qui reÃ§oit toujours un tampon de 512 octets et qui devrait dÃ©terminer lequel de ces 512 octets est nÃ©cessaire (si quelque chose est nÃ©cessaire) s'est avÃ©rÃ© ne pas Ãªtre une tÃ¢che aussi facile Ã  rÃ©soudre Â«Sur le frontÂ».  Plus prÃ©cisÃ©ment, la tÃ¢che n'Ã©tait pas tellement compliquÃ©e que non standard par rapport aux solutions de tous les jours, donc, de faÃ§on surprenante, il Ã©tait trÃ¨s intÃ©ressant de la rÃ©soudre.  Pour moi, c'Ã©tait comme une Â«tÃ¢che olympiqueÂ», oÃ¹ il fallait calculer la quantitÃ© d'Ã©lectricitÃ© nÃ©cessaire pour contracter les muscles afin de transfÃ©rer l'eau d'un seau Ã  l'autre avec deux cuillÃ¨res (une cuillÃ¨re dans chaque main). <br><br>  Afin de mieux comprendre quelle est la difficultÃ© ici, j'ajouterai une autre animation ici, uniquement Â«en termes deÂ» le contenu du cluster, et non le fichier entier (toutes les autres informations doivent Ãªtre stockÃ©es sÃ©parÃ©ment): <br><br><img src="https://habrastorage.org/webt/ba/vk/zg/bavkzgmfovjycovxj1uasy7kwae.gif"><br><br>  Comme prÃ©vu, le calendrier devrait afficher une nouvelle image chaque jour, c'est-Ã -dire  il doit pouvoir surveiller l'heure (mÃªme lorsqu'il est Ã©teint), ce qui signifie qu'un module d'horloge en temps rÃ©el (RTC) est Ã©galement nÃ©cessaire.  Et malgrÃ© le fait que mon contrÃ´leur dispose d'une horloge en temps rÃ©el intÃ©grÃ©e, il est presque impossible de rÃ©cupÃ©rer une batterie pour cela, car  les contacts ne sont pas cÃ¢blÃ©s Ã  la carte.  J'ai dÃ©cidÃ© de ne pas violer les jambes du contrÃ´leur pour tenter de les souder et j'ai pris le RTC chinois externe.  Travailler avec RTC Ã©tait censÃ© Ãªtre complÃ¨tement simple: <br><br><ul><li>  Une fois allumÃ©, obtenez l'heure du RTC chinois. </li><li>  RÃ©glez l'heure en RTC interne. </li><li>  Utilisez le RTC interne pour compter le temps et oublier les chinois jusqu'au prochain arrÃªt. </li></ul><br>  Mais ici, tout s'est avÃ©rÃ© pas si simple, car le RTC interne du contrÃ´leur fonctionne avec l'heure au format habituel (horodatage UNIX), et son ami chinois utilise le dÃ©cimal codÃ© binaire (BCD).  Avant cela, je n'avais pas rencontrÃ© ce format et j'Ã©tais trÃ¨s surpris que mÃªme les modules modernes pour Arduino l'utilisent.  L'essence du format est assez simple - il y a un octet, qui, par exemple, stocke le nombre de secondes.  Les quatre bits de poids fort stockent des dizaines et les quatre bits de poids faible stockent des unitÃ©s.  Il s'avÃ¨re que la reprÃ©sentation hexadÃ©cimale de cet octet lui-mÃªme contient un temps lisible - l'octet 0x49 correspond Ã  une valeur de 49 secondes (bien que dans le systÃ¨me dÃ©cimal, cet octet corresponde Ã  72). <br><br>  Si je comprends bien, cela s'est produit si historiquement qu'il Ã©tait plus facile d'utiliser RTC directement avec les encodeurs d'Ã©cran pour crÃ©er l'horloge, mais j'ai dÃ» convertir le BDC en horodatage UNIX avec des stylos. <br><br>  En plus de l'affichage, du module d'horloge en temps rÃ©el, de la carte mÃ©moire et du systÃ¨me de fichiers pour cela, il Ã©tait nÃ©cessaire d'envelopper tous ces presse-Ã©toupe dans un boÃ®tier, qui devait Ã©galement Ãªtre fabriquÃ©, c'est-Ã -dire  "Dessiner".  Vous pouvez lire plus en dÃ©tail sur toutes les douleurs que j'ai rencontrÃ©es dans ma derniÃ¨re publication, tout Ã©tait exactement le mÃªme ici: <br><br><img src="https://habrastorage.org/webt/f_/6i/jh/f_6ijh7_nag2fpzyjwzkdkapips.jpeg"><br>  (Je n'ai pas prÃ©vu de production de masse, tous les dÃ©tails autour sont le rÃ©sultat de mesures incorrectes ou de solutions mal pensÃ©es) <br><br>  En consÃ©quence, le boÃ®tier et les dÃ©tails nÃ©cessaires ont Ã©tÃ© dessinÃ©s (il n'y a pas de couverture sur l'image): <br><br><img src="https://habrastorage.org/webt/pg/k9/w-/pgk9w-ajyangtju3ianmi1dm9jo.jpeg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les boutons ont Ã©tÃ© placÃ©s dans une piÃ¨ce sÃ©parÃ©e pour faciliter l'assemblage (il semble que j'ai encore appris quelque chose du temps du dernier projet): </font></font><br><br><img src="https://habrastorage.org/webt/lp/c_/i8/lpc_i8kkwazohmmz2ujiynl2lea.jpeg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'assemblage (Ã  l'exception des couvertures avant et arriÃ¨re) de l'appareil ressemble Ã  ceci: l' </font></font><br><br><img src="https://habrastorage.org/webt/ah/yq/un/ahyqun2x2cwbvpn2hk5o59dupbw.jpeg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ã©cran est attachÃ© au boÃ®tier avec des liens. </font><font style="vertical-align: inherit;">Cela s'est avÃ©rÃ© Ãªtre une mÃ©thode beaucoup plus pratique que de la boulonner. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eh bien, un petit enfer pour les perfectionnistes (une barbe de fils et de composants): </font></font><br><br><img src="https://habrastorage.org/webt/tv/kh/pz/tvkhpznwutzclmhqaf_0q1abk_a.jpeg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'ensemble s'est avÃ©rÃ© Ãªtre un tel appareil, sur lequel j'ai fait un petit livre - instructions: </font></font><br><br><img src="https://habrastorage.org/webt/cw/s0/y9/cws0y9bk4nre9kwyjwjar2cvsui.jpeg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le capot arriÃ¨re est boulonnÃ©, ce qui vous permet de dÃ©monter l'appareil si une violence supplÃ©mentaire est requise sur son intÃ©rieur:</font></font><br><br><img src="https://habrastorage.org/webt/ec/dj/d6/ecdjd6m9-d85udrkqee-vphi1qe.jpeg"><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Oui, c'est plus facile d'acheter une maison en bord de mer! </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Et puis quelqu'un qui a lu jusqu'ici dira: Â«Et est-ce une alternative aux cadeaux simples?! Oui, vous devez immÃ©diatement investir 100 500 heures de votre temps, ce qui est beaucoup plus cher que l'argent! Â» Je ne discuterai pas de ce sujet, je dirai simplement que pour moi, c'est un processus mÃ©ditatif et je tue deux oiseaux avec une pierre - d'une part, je fais des choses dont personne n'a besoin (peu me paieraient pour dÃ©velopper quelque chose tels), mais qui m'intÃ©ressent Ã  faire, et une personne reÃ§oit un objet unique en cadeau qui, bien qu'il ne porte pas une charge utile Ã©vidente, donne le sourire. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cependant, pour qu'il n'y ait pas d'arriÃ¨re-goÃ»t de solutions qui nÃ©cessitent beaucoup de temps, je vais partager quelques histoires plus courtes.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Maintenant, en gÃ©nÃ©ral, il est devenu trÃ¨s Ã  la mode d'imprimer des choses sur une imprimante 3D. </font><font style="vertical-align: inherit;">Les appareils d'impression sont devenus beaucoup plus accessibles et le logiciel de crÃ©ation de modÃ¨les est assez simple Ã  comprendre pour les enfants.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Crie Ã  l'aide </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Au travail, nous avons une blague sur le fait que si vous avez besoin d'aide, il vous suffit de crier la mouette et quelqu'un vous aidera certainement. En vÃ©ritÃ©, je ne sais pas Ã  quoi elle est liÃ©e ni d'oÃ¹ vient cette blague, mais dans la correspondance interne des images de mouettes ont souvent commencÃ© Ã  apparaÃ®tre, laissant entendre que quelqu'un avait besoin d'aide. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cependant, le bureau de type ouvert et la modestie interne de certains collÃ¨gues ne leur ont pas permis de profiter pleinement de la possibilitÃ© d'appeler Ã  une telle aide. Ensuite, un Â«homme non ingÃ©nieurÂ» a dÃ©cidÃ© de venir Ã  la rescousse, prenant un Â«module de lecteur de musique MP3 pour ArduinoÂ» chinois chargÃ©, un clone chinois d'Arduino Nano, quelques fils et quelques mp3 avec l'enregistrement des sons des goÃ©lands.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En gÃ©nÃ©ral, il convient de noter ici que j'ai l'habitude de commander diffÃ©rents modules Ã  rabais, ce qui, il me semble, peut Ãªtre utile un jour, ou je reÃ§ois de tels appareils Ã©lectroniques en cadeau d'amis / connaissances qui n'ont pas trouvÃ© ces appareils Ã©lectroniques utiles. </font><font style="vertical-align: inherit;">Par consÃ©quent, le mot Â«traÃ®nerÂ» n'est pas accidentel, mais dÃ©crit trÃ¨s prÃ©cisÃ©ment l'Ã©tat des choses. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comme je suis une personne loin de la modÃ©lisation 3D, je viens de prendre un modÃ¨le tout prÃªt de la tÃªte de la mouette et d'y apporter les modifications nÃ©cessaires. </font><font style="vertical-align: inherit;">Ã€ savoir, Ã  partir des changements, il Ã©tait nÃ©cessaire:</font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> SÃ©parez le bec de la tÃªte pour imprimer le bec dans une couleur diffÃ©rente. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Faites une Â«cavitÃ©Â» dans laquelle toute l'Ã©lectronique se trouvera (haut-parleur, lecteur, arduino et fils). </font></font></li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le rÃ©sultat est quelque chose comme Ã§a (le bec est divisÃ© en deux parties pour une meilleure qualitÃ© d'impression): </font></font><br><br><img src="https://habrastorage.org/webt/r7/nz/9_/r7nz9_z7qibv9mqtowdvp038dki.jpeg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">je ne pense pas qu'il soit logique de parler du code, car </font><font style="vertical-align: inherit;">en plus d'initialiser le lecteur, il n'y avait qu'un gestionnaire de clic de bouton et jouant l'un des enregistrements vocaux de mouette (en gÃ©nÃ©ral: playSound (rand () &amp; 3);). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AprÃ¨s cela, laissez simplement la mouette pour imprimer et collecter tout ensemble. </font><font style="vertical-align: inherit;">En consÃ©quence, nous avons un Â«simulateur de thÃ©Â» Ã  part entiÃ¨re (la couleur de la mouette est dÃ©terminÃ©e par le plastique qui Ã©tait disponible), qui se connecte Ã  l'USB et lorsque vous cliquez sur le bouton sur la tÃªte de la mouette, il reproduit Â«l'appel Ã  l'aideÂ»:</font></font><br><br><img src="https://habrastorage.org/webt/ec/xg/ts/ecxgtsytg7czrd89196s2bwm8de.jpeg"><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Encore plus simple? </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Une collÃ¨gue s'est plainte d'avoir Ã©tÃ© constamment distraite pendant qu'elle passait des tests. </font><font style="vertical-align: inherit;">Nous trouvons sur Internet un modÃ¨le 3D de lunettes et faisons de petits changements: </font></font><br><br><img src="https://habrastorage.org/webt/kg/zz/jv/kgzzjvkhncuwiektwjpkjqciv54.jpeg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En consÃ©quence, nous avons des lunettes - des oeillÃ¨res. </font><font style="vertical-align: inherit;">Nous ne sommes pas distraits par nous-mÃªmes et les autres comprennent que vous ne devriez pas Ãªtre distrait:</font></font><br><br><img src="https://habrastorage.org/webt/ce/vm/k5/cevmk5j74alm2qbuzodzsk5uplc.jpeg"><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Assez simple! </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Donc, pour crÃ©er, vous avez besoin de: </font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> La possibilitÃ© de trouver ou de dessiner une bÃ©quille dans l'Ã©diteur de vecteur. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> La possibilitÃ© de dessiner 2 cylindres dans l'Ã©diteur 3D, l'un de plus que l'autre de ~ 0,4 mm. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> La possibilitÃ© de faire un simple morceau de papier - une Ã©tiquette. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Imprimante 3D (votre propre service d'impression ou personnalisÃ©). </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> L'imprimante est ordinaire. </font></font></li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Et maintenant, dans l'ordre ... Nous dessinons une bÃ©quille: </font></font><br><br><img src="https://habrastorage.org/webt/l6/z_/uv/l6z_uvppvank9lg9tnt00clmeeq.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous dessinons deux cylindres: Nous </font></font><br><br><img src="https://habrastorage.org/webt/aa/xi/yd/aaxiydolfoszxdnh8duxmhk3io0.jpeg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imprimons les piÃ¨ces et l'Ã©tiquette et obtenons un grand et simple cadeau pour "tyzhprogramistov":</font></font><br><br><img src="https://habrastorage.org/webt/ux/up/w9/uxupw9tma7hqfuhatlg6n2loies.jpeg"><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> C'Ã©tait pour quoi tout Ã§a? </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Â«Parfois, le destin joue avec nous et laisse entendre que quelque chose devrait arriver bientÃ´t.Â» Plusieurs fois dans ma vie, j'ai eu des idÃ©es que je voulais rÃ©aliser, mais j'ai attendu quelque chose. </font><font style="vertical-align: inherit;">Je ne ferais pas de Â«calendrierÂ» Ã©lectronique si un Ã©cran gratuit ne venait pas de Chine, ce qui signifie que je ne traiterais pas de FAT32, je ne me renseignerais pas sur le format BCD utilisÃ© dans RTC. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peut-Ãªtre que quelqu'un lira cette histoire (ou du moins regardera les photos) et pensera: "Merde, s'il pouvait le faire, alors je peux le faire encore mieux!" Et en consÃ©quence, cela apportera de la joie Ã  quelqu'un Ã  proximitÃ©. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En dehors de la fenÃªtre il pleut, le calendrier est dÃ©cembre. </font><font style="vertical-align: inherit;">Le temps des vacances approche et donc celui des cadeaux. </font><font style="vertical-align: inherit;">Faites et recevez des cadeaux intÃ©ressants, pas seulement une autre boÃ®te de chocolats, une bougie ou une figurine.</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr480792/">https://habr.com/ru/post/fr480792/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr480780/index.html">Comment assembler une illustration Ã  partir de cubes et de pictogrammes</a></li>
<li><a href="../fr480782/index.html">5 choses que j'aimerais savoir quand j'ai commencÃ© Ã  utiliser Angular</a></li>
<li><a href="../fr480786/index.html">Clonage profond indÃ©pendant d'objets en JavaScript</a></li>
<li><a href="../fr480788/index.html">Sapin de NoÃ«l sur la ligne de commande</a></li>
<li><a href="../fr480790/index.html">"EfficacitÃ© d'usine". Trouver un goulot d'Ã©tranglement et mettre en Å“uvre un systÃ¨me de traction pour augmenter la productivitÃ©</a></li>
<li><a href="../fr480794/index.html">Un peu sur le cas particulier de la mise en Å“uvre d'algorithmes de recherche de portes ouvertes</a></li>
<li><a href="../fr480796/index.html">Programmeurs, devops et chats Schrodinger</a></li>
<li><a href="../fr480798/index.html">C ++ Russia Piter 2019 rapporte l'examen</a></li>
<li><a href="../fr480800/index.html">Vous cherchez un testeur d'emploi? PrÃ©parez-vous Ã  dÃ©montrer les compÃ©tences des dÃ©veloppeurs</a></li>
<li><a href="../fr480802/index.html">Chaos Engineering, Part 3: MÃ©thodes et outils</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>