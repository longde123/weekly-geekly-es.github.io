<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚òùüèΩ üìî üë®üèº‚Äçüî¨ Depuraci√≥n como proceso üíº üêΩ üèß</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Se cree que el desarrollo lleva aproximadamente el 10% del tiempo, y la depuraci√≥n lleva el 90%. Quiz√°s esta afirmaci√≥n es exagerada, pero cualquier d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Depuraci√≥n como proceso</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jugru/blog/420793/"> Se cree que el desarrollo lleva aproximadamente el 10% del tiempo, y la depuraci√≥n lleva el 90%.  Quiz√°s esta afirmaci√≥n es exagerada, pero cualquier desarrollador estar√° de acuerdo en que la depuraci√≥n es un proceso extremadamente intensivo en recursos, especialmente en sistemas grandes de subprocesos m√∫ltiples. <br><br>  Por lo tanto, la optimizaci√≥n y sistematizaci√≥n del proceso de depuraci√≥n puede traer beneficios significativos en forma de horas hombre ahorradas, aumentando la velocidad de resoluci√≥n de problemas y, en √∫ltima instancia, aumentando la lealtad de sus usuarios. <br><br><img src="https://habrastorage.org/webt/lm/eb/rk/lmebrkzzdxjbw-vsbub7ybrlxjq.png"><br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Sergey Shchegrikovich</a> (dotmailer) en la conferencia <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">DotNext 2018 Piter</a> sugiri√≥ considerar la depuraci√≥n como un proceso que se puede describir y optimizar.  Si todav√≠a no tiene un plan claro para encontrar errores, debajo del video cortado y la transcripci√≥n del texto del informe de Sergey. <br><br>  (Y al final de la publicaci√≥n, agregamos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">el</a> atractivo de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">John Skeet</a> a todos los afiliados, aseg√∫rese de mirar) <br><a name="habracut"></a><br><iframe width="560" height="315" src="https://www.youtube.com/embed/Paxi4K5Om1Q" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br>  Mi objetivo es responder a la pregunta: c√≥mo solucionar errores de manera eficiente y cu√°l deber√≠a ser el enfoque.  Creo que la respuesta a esta pregunta es un proceso.  El proceso de depuraci√≥n, que consiste en reglas muy simples, y las conoce bien, pero probablemente las use sin saberlo.  Por lo tanto, mi tarea es sistematizarlos y mostrar c√≥mo ser m√°s efectivos usando un ejemplo. <br><br>  Desarrollaremos un lenguaje com√∫n para la comunicaci√≥n durante la depuraci√≥n, y tambi√©n veremos un camino directo para encontrar los principales problemas.  En mis ejemplos, mostrar√© lo que sucedi√≥ debido a una violaci√≥n de estas reglas. <br><br><h2>  Utilidades de depuraci√≥n </h2><br><img src="https://habrastorage.org/getpro/habr/post_images/292/518/f94/292518f94ecd468e034d8ec952398980.png"><br>  Por supuesto, cualquier depuraci√≥n no es posible sin las utilidades de depuraci√≥n.  Mis favoritos son: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Windbg</a> , que adem√°s del depurador en s√≠, tiene una rica funcionalidad para estudiar volcados de memoria.  Un volcado de memoria es una porci√≥n del estado de un proceso.  En √©l puede encontrar el valor de los campos de los objetos, las pilas de llamadas, pero, desafortunadamente, el volcado de memoria es est√°tico. <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">PerfView</a> es un generador de perfiles escrito sobre la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">tecnolog√≠a ETW</a> . <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Sysinternals</a> es una utilidad escrita por <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Mark Russinovich</a> , que le permite profundizar un poco m√°s en el dispositivo del sistema operativo. <br></li></ul><br><h2>  Servicio que cae </h2><br>  Comencemos con un ejemplo de mi vida en el que mostrar√© c√≥mo la naturaleza no sistem√°tica del proceso de depuraci√≥n conduce a la ineficiencia. <br><br>  Probablemente, esto les sucedi√≥ a todos, cuando vienes a una nueva empresa en un nuevo equipo para un nuevo proyecto, desde el primer d√≠a que quieres obtener beneficios irreparables.  As√≠ fue conmigo.  En ese momento, ten√≠amos un servicio que recib√≠a html para entrada y salida de im√°genes para salida. <br><br>  El servicio fue escrito bajo .Net 3.0 y fue hace mucho tiempo.  Este servicio ten√≠a una peque√±a caracter√≠stica: se bloque√≥.  Cay√≥ a menudo, aproximadamente una vez cada dos o tres horas.  Arreglamos esto elegantemente: establezca las propiedades de reinicio en las propiedades del servicio despu√©s de la ca√≠da. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0cc/b02/1a2/0ccb021a20b6c50d1639cd3e2bef7c28.png"><br><br>  El servicio no fue cr√≠tico para nosotros y pudimos sobrevivir.  Pero me un√≠ al proyecto y lo primero que decid√≠ hacer fue arreglarlo. <br><br>  ¬øA d√≥nde van los desarrolladores de .NET si algo no funciona?  Ellos van a EventViewer.  Pero all√≠ no encontr√© nada excepto el registro de que el servicio cay√≥.  No hubo mensajes sobre el error nativo, ni una pila de llamadas. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/be3/bdf/2fe/be3bdf2fe39777092ad0f2989e35d92e.png"><br><br>  Hay una herramienta probada para saber qu√© hacer a continuaci√≥n: envolvemos todo el <code>main</code> en <code>try-catch</code> . <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { ProcessRequest(); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception ex) { LogError(ex); }</code> </pre><br>  La idea es simple: <code>try-catch</code> funcionar√°, nos molestar√°, lo leeremos y arreglaremos el servicio.  Compilamos, implementamos en producci√≥n, el servicio se bloquea, no hay error.  Agrega otra <code>catch</code> . <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { ProcessRequest(); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception ex) { LogError(ex); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> { LogError(); }</code> </pre><br>  Repetimos el proceso: el servicio se bloquea, no hay errores en los registros.  Lo √∫ltimo que puede ayudar es <code>finally</code> , que siempre se llama. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { ProcessRequest(); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception ex) { LogError(ex); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> { LogError(); } <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span> { LogEndOfExecution(); }</code> </pre><br>  Compilamos, implementamos, el servicio se bloquea, no hay errores.  Pasan tres d√≠as detr√°s de este proceso, ahora ya vienen pensamientos de que finalmente debemos comenzar a pensar y hacer otra cosa.  Puede hacer muchas cosas: intente reproducir el error en la m√°quina local, observe los volcados de memoria, etc.  Parecieron otros dos d√≠as y arreglar√© este error ... <br><br>  Han pasado dos semanas. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1eb/f02/0c3/1ebf020c3dde595f5423fd8247c3137b.png"><br><br>  Mir√© en PerformanceMonitor, donde vi un servicio que falla, luego sube y luego vuelve a caer.  Esta condici√≥n se llama <i>desesperaci√≥n</i> y se ve as√≠: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/98b/e07/904/98be07904a35b99130ba9ddf871af47f.png"><br><br>  En esta variedad de etiquetas, ¬øest√°s tratando de descubrir d√≥nde est√° realmente el problema?  Despu√©s de varias horas de meditaci√≥n, el problema aparece de repente: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/379/2ba/caa/3792bacaa7c418f5fcffa318729bf1a0.png"><br><br>  La l√≠nea roja es el n√∫mero de identificadores nativos que posee el proceso.  Un identificador nativo es una referencia a un recurso del sistema operativo: archivo, registro, clave de registro, mutex, etc.  Por alguna extra√±a combinaci√≥n de circunstancias, la ca√≠da en el crecimiento en el n√∫mero de manijas coincide con los momentos en que el servicio cay√≥.  Esto lleva a la idea de que en alg√∫n lugar hay una fuga de manijas. <br><br>  Tomamos un volcado de memoria, lo abrimos en WinDbg.  Comenzamos a ejecutar comandos.  Intentemos ver la cola de finalizaci√≥n de aquellos objetos que la aplicaci√≥n deber√≠a liberar. <br><br><pre> <code class="hljs erlang-repl"><span class="hljs-number"><span class="hljs-number">0</span></span>:<span class="hljs-number"><span class="hljs-number">000</span></span>&gt; !FinalizeQueue</code> </pre><br>  Al final de la lista, encontr√© un navegador web. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d6f/aa5/eb3/d6faa5eb38c3b7a4429e55d7f8af655e.png"><br>  La soluci√≥n es simple: tome WebBrowser y llame a <code>dispose</code> para ello: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Process</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> webBrowser = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WebBrowser()) { <span class="hljs-comment"><span class="hljs-comment">// Processing ... } }</span></span></code> </pre><br>  Las conclusiones de esta historia se pueden extraer de la siguiente manera: dos semanas son demasiado largas y demasiado largas para encontrar una <code>dispose</code> no invitada;  que encontramos una soluci√≥n al problema: suerte, dado que no hab√≠a un enfoque espec√≠fico, no hab√≠a una naturaleza sistem√°tica. <br><br>  Despu√©s de eso, tuve una pregunta: ¬øc√≥mo debutar efectivamente y qu√© hacer? <br><br>  Para hacer esto, solo necesita saber tres cosas: <br><br><ol><li>  Reglas de depuraci√≥n <br></li><li>  Algoritmo para encontrar errores. <br></li><li>  T√©cnicas de depuraci√≥n proactiva. <br></li></ol><br><h2>  Reglas de depuraci√≥n </h2><br><ol><li>  Repite el error. <br></li><li>  Si no ha solucionado el error, entonces no est√° solucionado. <br></li><li>  Comprende el sistema. <br></li><li>  Verifica el enchufe. <br></li><li>  Divide y vencer√°s. <br></li><li>  Refr√©scate. <br></li><li>  Este es tu error. <br></li><li>  Cinco por qu√©. <br></li></ol><br>  Estas son reglas bastante claras que se describen a s√≠ mismas. <br><br>  Repite el error.  Una regla muy simple, porque si no puede cometer un error, entonces no hay nada que arreglar.  Pero hay diferentes casos, especialmente para los errores en un entorno multiproceso.  De alguna manera, tuvimos un error que apareci√≥ solo en los procesadores Itanium y solo en los servidores de producci√≥n.  Por lo tanto, la primera tarea en el proceso de depuraci√≥n es encontrar una configuraci√≥n del banco de pruebas en el que se reproducir√≠a el error. <br><br>  Si no ha solucionado el error, entonces no est√° solucionado.  A veces esto sucede: un rastreador de errores contiene un error que apareci√≥ hace medio a√±o, nadie lo ha visto durante mucho tiempo y existe el deseo de simplemente cerrarlo.  Pero en este momento perdemos la oportunidad de saber, la oportunidad de comprender c√≥mo funciona nuestro sistema y qu√© es lo que realmente le sucede.  Por lo tanto, cualquier error es una nueva oportunidad para aprender algo, aprender m√°s sobre su sistema. <br><br>  Comprende el sistema.  Brian Kernighan dijo una vez que si √©ramos tan inteligentes para escribir este sistema, entonces debemos ser doblemente inteligentes para debutarlo. <br><br>  Un peque√±o ejemplo de la regla.  Nuestro monitoreo dibuja gr√°ficos: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4cf/bfa/85b/4cfbfa85be2cf375741646b55aa373e6.png"><br>  Este es un gr√°fico del n√∫mero de solicitudes procesadas por nuestro servicio.  Una vez que lo miramos, se nos ocurri√≥ la idea de que ser√≠a posible aumentar la velocidad del servicio.  En este caso, el horario aumenta, puede ser posible reducir el n√∫mero de servidores. <br><br>  La optimizaci√≥n del rendimiento web se realiza simplemente: tomamos PerfView, lo ejecutamos en la m√°quina de producci√≥n, elimina el rastro en 3-4 minutos, llevamos este rastro a la m√°quina local y comenzamos a estudiarlo. <br><br>  Una de las estad√≠sticas que muestra PerfView es el recolector de basura. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d3a/ed0/c3f/d3aed0c3f4d3c6de77840aa9ffc10004.png"><br><br>  Al observar estas estad√≠sticas, vimos que el servicio pasa el 85% de su tiempo recolectando basura.  Puede ver en PerfView exactamente d√≥nde se pasa este tiempo. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/bb5/cd2/e4a/bb5cd2e4a54d4f71d832482217233281.png"><br><br>  En nuestro caso, esto est√° creando cadenas.  La correcci√≥n en s√≠ misma se sugiere: reemplazamos todas las cadenas con StringBuilders.  A nivel local, obtenemos un aumento de la productividad del 20-30%.  Implementar en producci√≥n, ver los resultados en comparaci√≥n con el calendario anterior: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/060/d63/21d/060d6321d41fa993d80d7b9d19d2d95c.png"><br><br>  La regla "Comprender el sistema" no se trata solo de comprender c√≥mo est√°n ocurriendo las interacciones en su sistema, c√≥mo van los mensajes, sino de intentar modelar su sistema. <br><br>  En el ejemplo, el gr√°fico muestra el ancho de banda.  Pero si observa todo el sistema desde el punto de vista de la teor√≠a de colas, resulta que el rendimiento de nuestro sistema depende de un solo par√°metro: la velocidad de llegada de nuevos mensajes.  De hecho, el sistema simplemente no ten√≠a m√°s de 80 mensajes a la vez, por lo que no hay forma de optimizar esta programaci√≥n. <br><br>  Verifica el enchufe.  Si abre la documentaci√≥n de cualquier electrodom√©stico, definitivamente se escribir√° all√≠: si el electrodom√©stico no funciona, verifique que el enchufe est√© insertado en el tomacorriente.  Despu√©s de varias horas en el depurador, a menudo me encuentro pensando que solo ten√≠a que volver a compilar o simplemente elegir la √∫ltima versi√≥n. <br><br>  La regla de "comprobar el enchufe" trata sobre hechos y datos.  La depuraci√≥n no comienza ejecutando WinDbg o PerfView en m√°quinas de producci√≥n, sino que verifica hechos y datos.  Si el servicio no responde, es posible que no se est√© ejecutando. <br><br>  Divide y vencer√°s.  Esta es la primera y probablemente la √∫nica regla que incluye la depuraci√≥n como proceso.  Se trata de hip√≥tesis, su promoci√≥n y prueba. <br><br>  Uno de nuestros servicios no quer√≠a detenerse. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4f2/cff/169/4f2cff1697473f917e815384d773149a.png"><br><br>  Hacemos una hip√≥tesis: tal vez hay un ciclo en el proyecto que procesa algo sin fin. <br><br>  Puede probar la hip√≥tesis de diferentes maneras, una opci√≥n es tomar un volcado de memoria.  <code>~*e!ClrStack</code> pilas de llamadas del volcado y todos los hilos usando el <code>~*e!ClrStack</code> .  Comenzamos a mirar y ver tres corrientes. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1d3/a54/35b/1d3a5435b697646daaf802e2bd838c7e.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/2f3/185/6b2/2f31856b23147722d7b3e534689572f8.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/d0f/ac7/760/d0fac7760f4e8e201d0f028c4deae23e.png"><br><br>  El primer hilo est√° en Principal, el segundo est√° en el controlador <code>OnStop()</code> , y el tercer hilo estaba esperando algunas tareas internas.  Por lo tanto, nuestra hip√≥tesis no est√° justificada.  No hay bucle, todos los hilos est√°n esperando algo.  Muy probablemente punto muerto. <br><br>  Nuestro servicio funciona de la siguiente manera.  Hay dos tareas: inicializaci√≥n y trabajo.  La inicializaci√≥n abre una conexi√≥n a la base de datos, el trabajador comienza a procesar los datos.  La comunicaci√≥n entre ellos ocurre a trav√©s de un indicador com√∫n, que se implementa utilizando <code>TaskCompletionSource</code> . <br><br>  Hacemos la segunda hip√≥tesis: quiz√°s tenemos un punto muerto de una tarea para la segunda.  Para verificar esto, puede ver cada tarea por separado a trav√©s de WinDbg. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c0f/536/1cf/c0f5361cf09ba6cd40d9a72e6d5dfb06.png"><br><br>  Resulta que una de las tareas cay√≥, y la segunda no.  En el proyecto, vimos el siguiente c√≥digo: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">await</span></span> openAsync(); _initLock.SetResult(<span class="hljs-literal"><span class="hljs-literal">true</span></span>);</code> </pre><br>  Significa que la tarea de inicializaci√≥n abre la conexi√≥n y luego establece <code>TaskCompletionSource</code> en verdadero.  Pero, ¬øqu√© pasa si una excepci√≥n cae aqu√≠?  Entonces no tenemos tiempo para establecer <code>SetResult</code> en verdadero, por lo que la soluci√≥n a este error fue as√≠: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> openAsync(); _initLock.SetResult(<span class="hljs-literal"><span class="hljs-literal">true</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span>(Exception ex) { _initLock.SetException(ex); }</code> </pre><br>  En este ejemplo, presentamos dos hip√≥tesis: el bucle infinito y el punto muerto.  La regla "divide y vencer√°s" ayuda a localizar el error.  Las aproximaciones sucesivas resuelven tales problemas. <br><br>  Lo m√°s importante en esta regla son las hip√≥tesis, porque con el tiempo se convierten en patrones.  Y dependiendo de la hip√≥tesis, usamos diferentes acciones. <br><br>  Refr√©scate.  Esta regla es que solo necesita levantarse de la mesa y caminar, beber agua, jugo o caf√©, hacer cualquier cosa, pero lo m√°s importante es distraerse de su problema. <br><br>  Hay un muy buen m√©todo llamado pato.  De acuerdo con el m√©todo, debemos informar sobre el problema del <i>agachamiento</i> .  Puedes usar un colega como <i>pato</i> .  Adem√°s, no tiene que responder, solo escuchar y estar de acuerdo.  Y a menudo, despu√©s de la primera conversaci√≥n sobre el problema, usted mismo encuentra una soluci√≥n. <br><br>  Este es tu error.  Dir√© sobre esta regla con un ejemplo. <br><br>  Hubo un problema en una <code>AccessViolationException</code> .  Mirando en la pila de llamadas, vi que ocurri√≥ cuando generamos la consulta LinqToSql dentro del cliente sql. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fd2/849/7a6/fd28497a66853c5bcf17eaa9d978524a.png"><br><br>  De este error qued√≥ claro que en alg√∫n lugar se viola la integridad de la memoria.  Afortunadamente, en ese momento ya utilizamos el sistema de gesti√≥n de cambios.  Como resultado, despu√©s de un par de horas qued√≥ claro lo que sucedi√≥: instalamos .Net 4.5.2 en nuestras m√°quinas de producci√≥n. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f24/bc8/438/f24bc84388e43df0ad4e7af27c0bbc24.png"><br><br>  En consecuencia, enviamos el error a Microsoft, lo examinan, nos comunicamos con ellos, solucionan el error en .Net 4.6.1. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/44a/c39/535/44ac39535a874ff0ea0f599a55f07252.png"><br><br>  Para m√≠, esto result√≥ en 11 meses de trabajo con el soporte de Microsoft, por supuesto, no todos los d√≠as, pero tard√≥ 11 meses en solucionarse.  Adem√°s, les enviamos docenas de gigabytes de volcados de memoria, colocamos cientos de ensamblados privados para detectar este error.  Y durante todo este tiempo, no pudimos decirles a nuestros clientes que Microsoft ten√≠a la culpa, no nosotros.  Por lo tanto, el error siempre es tuyo. <br><br>  Cinco por qu√©.  Nosotros en nuestra empresa usamos Elastic.  Elastic es bueno para la agregaci√≥n de registros. <br><br>  Vienes a trabajar por la ma√±ana, y Elastic miente. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1a1/c80/09b/1a1c8009b49f9c288b3c4b29daf194cc.png"><br><br>  La primera pregunta es ¬øpor qu√© es el√°stico?  Casi de inmediato qued√≥ claro: los nodos maestros cayeron.  Coordinan el trabajo de todo el grupo y cuando caen, todo el grupo deja de responder.  ¬øPor qu√© no se levantaron?  Tal vez deber√≠a haber un inicio autom√°tico?  Despu√©s de buscar la respuesta, encontramos que la versi√≥n del complemento no coincide.  ¬øPor qu√© cayeron los nodos maestros?  Fueron asesinados por OOM Killer.  Esto es as√≠ en las m√°quinas Linux, que en caso de falta de memoria cierra procesos innecesarios.  ¬øPor qu√© no hay suficiente memoria?  Porque ha comenzado el proceso de actualizaci√≥n, que se deduce de los registros del sistema.  ¬øPor qu√© funcion√≥ antes, pero no ahora?  Y debido a que agregamos nuevos nodos una semana antes, en consecuencia, los nodos maestros necesitaban m√°s memoria para almacenar √≠ndices y configuraciones de cl√∫ster. <br><br>  Las preguntas "¬øpor qu√©?"  Ayuda a encontrar la ra√≠z del problema.  En el ejemplo, podr√≠amos desactivar la ruta correcta muchas veces, pero la soluci√≥n completa se ve as√≠: actualizamos el complemento, iniciamos servicios, aumentamos la memoria y tomamos una nota para el futuro, que la pr√≥xima vez, al agregar nuevos nodos al cl√∫ster, debemos asegurarnos de que haya suficiente memoria en el Maestro Nodos <br><br>  La aplicaci√≥n de estas reglas le permite revelar problemas reales, cambia su enfoque para resolver estos problemas y ayuda a comunicarse.  Pero ser√≠a a√∫n mejor si estas reglas formaran un sistema.  Y existe tal sistema, se llama algoritmo de depuraci√≥n. <br><br><h2>  Algoritmo de depuraci√≥n </h2><br>  Por primera vez, le√≠ sobre el algoritmo de depuraci√≥n en el libro de John Robbins 'Depuraci√≥n de aplicaciones'.  Describe el proceso de depuraci√≥n de la siguiente manera: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f1e/2af/a07/f1e2afa078f2ab8587467660b25df052.png"><br><br>  Este algoritmo es √∫til para su ciclo interno: trabajar con una hip√≥tesis. <br><br>  Con cada vuelta del ciclo podemos comprobarnos: ¬øsabemos m√°s sobre el sistema o no?  Si presentamos hip√≥tesis, verifique, no funcionan, no aprendemos nada nuevo sobre el funcionamiento del sistema, entonces probablemente sea hora de refrescarse.  Dos preguntas actuales en este punto: qu√© hip√≥tesis has probado y qu√© hip√≥tesis est√°s probando ahora. <br><br>  Este algoritmo coincide muy bien con las reglas de depuraci√≥n de las que hablamos anteriormente: repita el error, este es su error, describa el problema, comprenda el sistema, formule una hip√≥tesis, divida y conquiste, pruebe la hip√≥tesis, verifique el enchufe, aseg√∫rese de que est√© solucionado, cinco por qu√©. <br><br>  Tengo un buen ejemplo para este algoritmo.  Una excepci√≥n recay√≥ en uno de nuestros servicios web. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/206/a57/d71/206a57d711a7c783c9f22389120d1bf8.png"><br><br>  Nuestro primer pensamiento no es nuestro problema.  Pero de acuerdo con las reglas, este sigue siendo nuestro problema. <br><br>  Primero, repite el error.  Por cada mil solicitudes, hay aproximadamente una <code>StructureMapException</code> , por lo que podemos reproducir el problema. <br><br>  En segundo lugar, estamos tratando de describir el problema: si el usuario realiza una solicitud http para nuestro servicio en el momento en que StructureMap est√° tratando de hacer una nueva dependencia, entonces se produce una excepci√≥n. <br><br>  En tercer lugar, planteamos la hip√≥tesis de que StructureMap es un contenedor y hay algo dentro que arroja una excepci√≥n interna.  Probamos la hip√≥tesis usando procdump.exe. <br><br><pre> <code class="hljs powershell">procdump.exe <span class="hljs-literal"><span class="hljs-literal">-ma</span></span> <span class="hljs-literal"><span class="hljs-literal">-e</span></span> <span class="hljs-operator"><span class="hljs-operator">-f</span></span> StructureMap w3wp.exe</code> </pre><br>  Resulta que adentro hay una <code>NullReferenceException</code> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2da/773/500/2da773500ffd18d1c28b91f6ff5b45e3.png"><br><br>  Al estudiar la pila de llamadas de esta excepci√≥n, entendemos que ocurre dentro del generador de objetos en el propio StructureMap. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5fd/347/8fc/5fd3478fc54df6295244471a33560a3d.png"><br><br>  Pero <code>NullReferenceException</code> no es el problema en s√≠, sino la consecuencia.  Necesita comprender d√≥nde ocurre y qui√©n lo genera. <br><br>  Presentamos la siguiente hip√≥tesis: por alguna raz√≥n, nuestro c√≥digo devuelve una dependencia nula.  Dado que en .Net todos los objetos en la memoria est√°n ubicados uno por uno, si miramos los objetos en el mont√≥n que se encuentran antes de la <code>NullReferenceException</code> , probablemente apunten al c√≥digo que arroj√≥ la excepci√≥n. <br><br>  En WinDbg hay un comando: Lista de objetos cercanos <code>!lno</code> .  Muestra que el objeto que nos interesa es la funci√≥n lambda, que se utiliza en el siguiente c√≥digo. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> CompoundInterceptor </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FindInterceptor</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Type type</span></span></span><span class="hljs-function">)</span></span> { CompoundInterceptop interceptor; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!_analyzedInterceptors.TryGetValue(type, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> interceptor)) { <span class="hljs-keyword"><span class="hljs-keyword">lock</span></span> (_locker) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!_analyzedInterceptors.TryGetValue(type, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> interceptor)) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> interceptorArray = _interceptors.FindAll(i =&gt; i.MatchesType(type)); interceptor = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CompoundInterceptor(interceptorArray); _analyzedInterceptors.Add(type, interceptor); } } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> interceptor; }</code> </pre><br>  En este c√≥digo, primero verificamos si el valor en el <code>Dictionary</code> <code>_analyzedInterceptors</code> en <code>_analyzedInterceptors</code> , si no lo encontramos, luego agregamos un nuevo valor dentro del <code>lock</code> . <br><br>  En teor√≠a, este c√≥digo nunca puede devolver nulo.  Pero el problema aqu√≠ est√° en <code>_analyzedInterceptors</code> , que usa un <code>Dictionary</code> regular en un entorno de subprocesos m√∫ltiples, no un <code>ConcurrentDictionary</code> . <br><br>  Se encontr√≥ la ra√≠z del problema, actualizamos a la √∫ltima versi√≥n de StructureMap, implementada, nos aseguramos de que todo estuviera solucionado.  El √∫ltimo paso de nuestro algoritmo es "aprender y contar".  En nuestro caso, fue una b√∫squeda en el c√≥digo de todos los <code>Dictionary</code> que se usan en la cerradura y verificar que todos se usan correctamente. <br><br>  Entonces, el algoritmo de depuraci√≥n es un algoritmo intuitivo que ahorra mucho tiempo.  Se centra en la hip√≥tesis, y esto es lo m√°s importante en la depuraci√≥n. <br><br><h2>  Depuraci√≥n proactiva </h2><br>  En esencia, la depuraci√≥n proactiva responde a la pregunta "qu√© sucede cuando aparece un error". <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7aa/718/900/7aa71890010a8c32900fa5b01e0b690a.png"><br><br>  La importancia de las t√©cnicas de depuraci√≥n proactiva se puede ver en el diagrama del ciclo de vida del error. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/be0/f6f/06c/be0f6f06cb0c810ca6b19cb861d998c4.png"><br><br>  El problema es que cuanto m√°s dura el error, m√°s recursos (tiempo) gastamos en √©l. <br><br>  Las reglas de depuraci√≥n y el algoritmo de depuraci√≥n nos centran en el momento en que se encuentra el error y podemos averiguar qu√© hacer a continuaci√≥n.  De hecho, queremos cambiar nuestro enfoque en el momento en que se cre√≥ el error.  Creo que deber√≠amos hacer el Producto m√≠nimo depurable (MDP), es decir, un producto que tenga el conjunto m√≠nimo de infraestructura necesario para una depuraci√≥n eficiente en la producci√≥n. <br><br>  MDP consta de dos cosas: funci√≥n de condici√≥n f√≠sica y m√©todo de USO. <br><br>  Funciones de acondicionamiento f√≠sico.  Fueron popularizados por Neil Ford y coautores en el libro Building Evolutionary Architectures.  En esencia, las funciones de aptitud f√≠sica, seg√∫n los autores del libro, se ven as√≠: hay una arquitectura de aplicaci√≥n que podemos cortar en diferentes √°ngulos, obteniendo propiedades arquitect√≥nicas como <i>mantenibilidad</i> , <i>rendimiento</i> , etc., y para cada secci√≥n debemos escribir una prueba: aptitud -funci√≥n  Por lo tanto, una funci√≥n de aptitud es una prueba de arquitectura. <br><br>  En el caso de MDP, la funci√≥n de aptitud es una prueba de depuraci√≥n.  Puede usar cualquier cosa que desee para escribir tales pruebas: NUnit, MSTest, etc.  Pero, dado que la depuraci√≥n a menudo funciona con herramientas externas, demostrar√© el uso de Pester (marco de prueba de unidad powershell) como ejemplo.  Su ventaja aqu√≠ es que funciona bien con la l√≠nea de comando. <br><br>  Por ejemplo, dentro de la empresa acordamos que utilizaremos bibliotecas espec√≠ficas para iniciar sesi√≥n;  al iniciar sesi√≥n usaremos patrones espec√≠ficos;  Los caracteres pdb siempre deben asignarse al servidor de s√≠mbolos.  Estas ser√°n las convenciones que probaremos en nuestras pruebas. <br><br><pre> <code class="hljs powershell">Describe <span class="hljs-string"><span class="hljs-string">'Debuggability'</span></span> { It <span class="hljs-string"><span class="hljs-string">'Contains line numbers in PDBs'</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">Get-ChildItem</span></span> <span class="hljs-literal"><span class="hljs-literal">-Path</span></span> . <span class="hljs-literal"><span class="hljs-literal">-Recurse</span></span> <span class="hljs-literal"><span class="hljs-literal">-Include</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">@</span></span>(<span class="hljs-string"><span class="hljs-string">"*.exe"</span></span>, <span class="hljs-string"><span class="hljs-string">"*. dll "</span></span>) ` | <span class="hljs-built_in"><span class="hljs-built_in">ForEach-Object</span></span> { &amp;symchk.exe /v <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$_</span></span></span><span class="hljs-string">"</span></span> /s <span class="hljs-string"><span class="hljs-string">"\\network\"</span></span> *&gt;&amp;<span class="hljs-number"><span class="hljs-number">1</span></span> } ` | <span class="hljs-built_in"><span class="hljs-built_in">Where-Object</span></span> { <span class="hljs-variable"><span class="hljs-variable">$_</span></span> <span class="hljs-operator"><span class="hljs-operator">-like</span></span> <span class="hljs-string"><span class="hljs-string">"*Line nubmers: TRUE*"</span></span> } ` | Should <span class="hljs-operator"><span class="hljs-operator">-Not</span></span> ‚ÄìBeNullOrEmpty } }</code> </pre><br>  Esta prueba verifica que todos los caracteres pdb se dieron al servidor de s√≠mbolos y se dieron correctamente, es decir, aquellos que contienen n√∫meros de l√≠nea en su interior.  Para hacer esto, tome la versi√≥n compilada de la producci√≥n, encuentre todos los archivos exe y dll, pase todos estos binarios a trav√©s de la utilidad syschk.exe, que se incluye en el paquete de herramientas de depuraci√≥n para Windows.  La utilidad syschk.exe comprueba el binario con el servidor de s√≠mbolos y, si encuentra un archivo pdb all√≠, imprime un informe al respecto.  En el informe, buscamos la l√≠nea "N√∫meros de l√≠nea: VERDADERO".  Y en la final comprobamos que el resultado no es "nulo o vac√≠o". <br><br>  Estas pruebas deben integrarse en una tuber√≠a de implementaci√≥n continua.  Despu√©s de que las pruebas de integraci√≥n y las pruebas unitarias han pasado, se lanzan las funciones de aptitud. <br><br>  Mostrar√© un ejemplo m√°s al verificar las bibliotecas necesarias en el c√≥digo. <br><br><pre> <code class="hljs powershell">Describe <span class="hljs-string"><span class="hljs-string">'Debuggability'</span></span> { It <span class="hljs-string"><span class="hljs-string">'Contains package for logging'</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">Get-ChildItem</span></span> <span class="hljs-literal"><span class="hljs-literal">-Path</span></span> . <span class="hljs-literal"><span class="hljs-literal">-Recurse</span></span> <span class="hljs-literal"><span class="hljs-literal">-Name</span></span> <span class="hljs-string"><span class="hljs-string">"packages.config"</span></span> ` | <span class="hljs-built_in"><span class="hljs-built_in">ForEach-Object</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">Get-Content</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$_</span></span></span><span class="hljs-string">"</span></span> } ` | <span class="hljs-built_in"><span class="hljs-built_in">Where-Object</span></span> { <span class="hljs-variable"><span class="hljs-variable">$_</span></span> <span class="hljs-operator"><span class="hljs-operator">-like</span></span> <span class="hljs-string"><span class="hljs-string">"*nlog*"</span></span> } ` | Should <span class="hljs-operator"><span class="hljs-operator">-Not</span></span> ‚ÄìBeNullOrEmpty } }</code> </pre><br>  En la prueba, tomamos todos los archivos package.config e intentamos encontrar las bibliotecas nlog en ellos.  De manera similar, podemos verificar que el campo de identificaci√≥n de correlaci√≥n se use dentro del campo nlog. <br><br>  UTILICE m√©todos.  Lo √∫ltimo que consiste en MDP es la m√©trica que necesita recopilar. <br><br>  Lo demostrar√© con el ejemplo del m√©todo USE, que fue popularizado por Brendan Gregg.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La idea es simple: si hay alg√∫n problema en el c√≥digo, es suficiente tomar tres m√©tricas: utilizaci√≥n (saturaci√≥n), errores (errores), que ayudar√°n a comprender d√≥nde est√° el problema. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Algunas compa√±√≠as, por ejemplo Circonus (hacen monitoreo suave), </font><font style="vertical-align: inherit;">construyen </font><font style="vertical-align: inherit;">sus </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">paneles</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en forma de m√©tricas designadas. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/70a/f58/382/70af583826e562f796fb0473c520db15.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si observa en detalle, por ejemplo, la memoria, entonces el uso es la cantidad de memoria libre, la saturaci√≥n es la cantidad de accesos al disco, los errores son cualquier error que haya aparecido. </font><font style="vertical-align: inherit;">Por lo tanto, para que los productos sean convenientes para la depuraci√≥n, debe recopilar m√©tricas USE para todas las funciones y todas las partes del subsistema. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si toma una caracter√≠stica comercial, lo m√°s probable es que pueda distinguir tres m√©tricas en ella:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Uso: tiempo de procesamiento de la solicitud. </font></font><br></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> La saturaci√≥n es la longitud de la cola. </font></font><br></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Errores: cualquier situaci√≥n excepcional. </font></font><br></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como ejemplo, veamos un gr√°fico del n√∫mero de solicitudes procesadas que realiza uno de nuestros sistemas. </font><font style="vertical-align: inherit;">Como puede ver, el servicio no ha procesado solicitudes durante las √∫ltimas tres horas. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/6cc/f89/7ab/6ccf897ab0758b344dfc940eb9be548b.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La primera hip√≥tesis que formulamos es que el servicio ha ca√≠do y necesitamos reiniciarlo. </font><font style="vertical-align: inherit;">Al verificar, resulta que el servicio est√° funcionando, utiliza 4-5% de la CPU. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/7e1/9a3/f4a/7e19a3f4a52547627e150401b0f1e7e7.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La segunda hip√≥tesis es que un error cae dentro del servicio que no vemos. </font><font style="vertical-align: inherit;">Utilizaremos la utilidad etrace.</font></font><br><br><pre> <code class="hljs powershell">etrace -<span class="hljs-literal"><span class="hljs-literal">-kernel</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Process</span></span> ^ -<span class="hljs-literal"><span class="hljs-literal">-where</span></span> ProcessName=Ex5<span class="hljs-literal"><span class="hljs-literal">-Service</span></span> ^ -<span class="hljs-literal"><span class="hljs-literal">-clr</span></span> Exception</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La utilidad le permite suscribirse a eventos ETW en tiempo real y mostrarlos en la pantalla. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/f1a/d13/52b/f1ad1352bc6e02e3a660f64ce90fdc87.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vemos que est√° cayendo </font></font><code>OutOfMemoryException</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Pero, la segunda pregunta, ¬øpor qu√© no est√° en los registros? </font><font style="vertical-align: inherit;">La respuesta es r√°pida: la interceptamos, tratamos de limpiar la memoria, esperamos un poco y comenzamos a trabajar nuevamente.</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (ShouldContinue()) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { Do(); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (OutOfMemoryException) { Thread.Sleep(<span class="hljs-number"><span class="hljs-number">100</span></span>); GC.CollectionCount(<span class="hljs-number"><span class="hljs-number">2</span></span>); GC.WaitForPendingFinalizers(); } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La siguiente hip√≥tesis es que alguien se come toda la memoria. </font><font style="vertical-align: inherit;">Seg√∫n el volcado de memoria, la mayor√≠a de los objetos est√°n en la memoria cach√©.</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Cache</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> ConcurrentDictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>, String&gt; _items = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ... <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> DateTime _nextClearTime = DateTime.UtcNow; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetFromCache</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> key</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_nextClearTime &lt; DateTime.UtcNow) { _nextClearTime = DateTime.UtcNow.AddHours(<span class="hljs-number"><span class="hljs-number">1</span></span>); _items.Clear(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _items[key]; } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El c√≥digo muestra que cada hora se debe borrar el cach√©. </font><font style="vertical-align: inherit;">Pero el recuerdo no fue suficiente, ni siquiera llegaron a la limpieza. </font><font style="vertical-align: inherit;">Veamos un ejemplo de la m√©trica USE cache. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/0c6/174/634/0c6174634447a3bd1af03adf10c14cbe.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Seg√∫n el cronograma, es inmediatamente visible: la memoria ha aumentado, los errores comenzaron de inmediato. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Entonces, conclusiones sobre qu√© es la depuraci√≥n proactiva.</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La depuraci√≥n es un requisito de arquitectura. </font><font style="vertical-align: inherit;">De hecho, lo que estamos desarrollando es un modelo del sistema. </font><font style="vertical-align: inherit;">El sistema en s√≠ es los bytes y bits que est√°n en la memoria en los servidores de producci√≥n. </font><font style="vertical-align: inherit;">La depuraci√≥n proactiva sugiere que debe pensar en su entorno operativo.</font></font><br></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reduzca la ruta de error en el sistema. </font><font style="vertical-align: inherit;">Las t√©cnicas de depuraci√≥n proactiva incluyen verificar todos los m√©todos p√∫blicos y sus argumentos; </font><font style="vertical-align: inherit;">lanzar una excepci√≥n tan pronto como aparezca, y no depurar hasta alg√∫n punto y as√≠ sucesivamente.</font></font><br></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> El producto m√≠nimo depurable es una buena herramienta para comunicarse entre s√≠ y desarrollar requisitos para la depuraci√≥n del producto. </font></font><br></li></ul><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Entonces, ¬øc√≥mo solucionar errores de manera eficiente? </font></font></h2><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Utilice la depuraci√≥n proactiva. </font></font><br></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Sigue el algoritmo. </font></font><br></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Prueba de hip√≥tesis. </font></font><br></li></ol><br><hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Esta vez, el patrocinador de nuestro anuncio es Jon Skeet. </font><font style="vertical-align: inherit;">Incluso si no vas a Mosc√∫ para el nuevo </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DotNext</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , vale la pena ver el video (John se esforz√≥ mucho).</font></font><br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/p2SQbq-umy4" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es420793/">https://habr.com/ru/post/es420793/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es420779/index.html">Compa√±√≠a de m√°scara aburrida: t√∫nel al estadio y la apertura del t√∫nel</a></li>
<li><a href="../es420783/index.html">Gesti√≥n de dependencias, eventos y patrones de observadores y mediadores</a></li>
<li><a href="../es420785/index.html">Trabaja como especialista en TI en el Lejano Oriente - √ìblast de Sajal√≠n</a></li>
<li><a href="../es420789/index.html">Arquitectura (A | a): ¬øpor qu√© es un mitap no est√°ndar para desarrolladores de sistemas altamente cargados?</a></li>
<li><a href="../es420791/index.html">Robots dom√©sticos: lo que puedes comprar. Descripci√≥n general de los robots dom√©sticos comerciales disponibles</a></li>
<li><a href="../es420795/index.html">Conceptos err√≥neos del analista.</a></li>
<li><a href="../es420797/index.html">El aprendizaje no puede posponerse</a></li>
<li><a href="../es420799/index.html">MPS 2018.2: Pruebas de generador, Complemento GitHub, Aspecto VCS, Notificaciones de migraci√≥n y m√°s</a></li>
<li><a href="../es420803/index.html">Lecciones de impresi√≥n 3D. Ahorro de pl√°stico al imprimir modelos no funcionales desde 3Dtool</a></li>
<li><a href="../es420805/index.html">[Traducci√≥n] Cu√°ndo usar flujos paralelos</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>