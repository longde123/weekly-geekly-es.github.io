<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèø‚Äç‚öïÔ∏è üóæ ü•Å Perl direkt von 1987 setzen üî§ üì´ üì©</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Nachdem ich die Nachricht ‚Äû Perl-Interpreter-Code offiziell auf GitHub portiert ‚Äú auf LINUX.ORG.RU gelesen hatte, beschloss ich, mir das Perl 5-Reposi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Perl direkt von 1987 setzen</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/473228/"> Nachdem ich die Nachricht ‚Äû <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" title="Perl-Interpreter-Code offiziell auf GitHub portiert, Neuigkeiten auf der LINUX.ORG.RU-Ressource">Perl-Interpreter-Code offiziell auf GitHub portiert</a> ‚Äú auf LINUX.ORG.RU gelesen hatte, beschloss ich, mir das Perl 5-Repository anzusehen, das jetzt bereits auf GitHub verf√ºgbar ist. <br><br>  Es ist erstaunlich, wie sie vor Ehrfurcht und Qualit√§t zitterten und nicht nur die gesamte 32-j√§hrige Geschichte des Projekts absolut bewahrten, sondern auch Fehlerberichte (Probleme), Patches (PRs), Ver√∂ffentlichungen und Zweige.  Die Inschrift "vor <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" title="Vor 32 Jahren auf Perl-Quelldateien, offizielles Perl 5 GitHub-Repository.">32 Jahren</a> " neben den Akten sorgt f√ºr ein unwillk√ºrliches L√§cheln. <br><br>  Was kann man an diesem tr√ºben Freitagabend noch tun, wenn Regen und Schnee unangenehm auf die Stra√üe nieseln und alle Stra√üenwege im Herbstbrei versinken?  Das stimmt, rot√§ugig!  Aus Gr√ºnden des Experiments und des Interesses habe ich mich entschlossen, das alte Perl auf einem modernen x86_64-Computer mit der neuesten Version von <strong>GCC 9.2.0</strong> als Compiler zu <strong>installieren</strong> .  Kann solch ein alter Code den Test der Zeit bestehen? <br><br><div style="text-align:center;"><img title="Demonstration von twm, einem der ersten Fenstermanager f√ºr das X Window System, auf einer modernen Arch Linux-Distribution." src="https://habrastorage.org/webt/-0/d5/wt/-0d5wtkg6ylqdd-h5g1hbtdiypi.png"></div><br>  <i>Demonstration von <strong>twm</strong> , einem der ersten Fenstermanager f√ºr das X Window System, auf einer modernen Arch Linux-Distribution.</i> <br><br>  Um absolut authentisch und nekromantnenko zu sein, habe ich eine virtuelle Maschine mit Bare X und Window Manager <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" title="twm, Wikipedia-Seite.">Twm bereitgestellt</a> , die ebenfalls aus dem Jahr 1987 stammt.  Wer wei√ü, vielleicht hat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" title="Larry Wall, Wikipedia-Seite.">Larry Wall</a> sein Perl mit genau <strong>Twm geschrieben</strong> , sozusagen mit der <strong>neuesten</strong> <em>Technologie</em> dieser Zeit.  Die verwendete Distribution ist Arch Linux.  Nur weil es einige n√ºtzliche Dinge in seinem Repository gibt, die sich sp√§ter als n√ºtzlich erwiesen haben.  Also lass uns gehen! <br><a name="habracut"></a><br><a name="article-content"></a><h2>  Inhalt: </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">1. Vorbereitung der Umwelt</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">2. Konfigurieren Sie den Quellcode</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">3. Fehler in der Yacc-Grammatikdatei</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">4. Fehler beim Kompilieren von Code auf "C"</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">5. Korrektur einiger Fehler Segmentierungsfehler</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">6. Zusammenfassend</a> <br><br><a name="environment"></a><h2>  1. Vorbereitung der Umwelt </h2><br>  Zuerst installieren wir auf einem bereitgestellten Betriebssystem in einer virtuellen Maschine alle Gentleman-Dienstprogramme und Compiler, die zum Zusammenstellen und Bearbeiten des Quellcodes erforderlich sind: <strong>gcc</strong> , <strong>make</strong> , <strong>vim</strong> , <strong>git</strong> , <strong>gdb</strong> usw. Einige von ihnen sind bereits installiert, w√§hrend andere im Metapaket verf√ºgbar sind <strong>base-devel</strong> muss installiert werden, wenn es nicht installiert ist.  Nachdem die Umgebung einsatzbereit ist, erhalten wir eine Kopie des 32 Jahre alten Perl-Quellcodes! <br><br><pre><code class="bash hljs">$ git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/Perl/perl5/ --depth=1 -b perl-1.0</code> </pre> <br>  Dank der Funktionen von Git m√ºssen wir nicht eine Reihe von Dateien ziehen, um zur ersten Version des Projekts zu gelangen: <br><br><pre> <code class="plaintext hljs">* commit 8d063cd8450e59ea1c611a2f4f5a21059a2804f1 (grafted, HEAD, tag: perl-1.0) Commit: Larry Wall &lt;lwall@jpl-devvax.jpl.nasa.gov&gt; CommitDate: Fri Dec 18 00:00:00 1987 +0000 a "replacement" for awk and sed</code> </pre><br>  Wir laden nur eine kleine Datenmenge herunter und daher ben√∂tigt das Repository mit dem Quellcode der ersten Version von Perl nur 150 KB. <br><br>  Zu dieser dunklen und dichten Zeit gab es keine elementaren Dinge wie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" title="GNU Autotools, Wikipedia-Seite.">Autotools</a> ( <em>was f√ºr ein Segen!</em> ). Es gibt jedoch ein <strong>Konfigurationsskript</strong> im Stammverzeichnis des Repositorys.  Was ist los  Tatsache ist jedoch, dass Larry Wall der Erfinder solcher Skripte ist, mit denen Makefiles f√ºr die buntesten UNIX-Maschinen dieser Zeit generiert werden konnten.  Wie der Wikipedia- <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" title="Konfigurieren Sie Skript, Verlauf, Wikipedia-Seite.">Artikel</a> √ºber die gleichnamigen Skripte besagt, hat Larry Wall die <strong>Configure-</strong> Datei drei weitere Jahre vor dem Schreiben von Perl mit einem Teil seiner Software geliefert, beispielsweise einem Newsreader.  In der Folge war Perl keine Ausnahme, und ein Skript, das bereits auf vielen Computern ausgef√ºhrt wurde, wurde zum Erstellen verwendet.  Sp√§ter haben auch andere Entwickler, zum Beispiel Programmierer von Trolltech, diese Idee aufgegriffen.  Sie verwendeten ein √§hnliches Skript, um den Build ihres Qt-Frameworks zu konfigurieren, das viele Leute mit der <strong>Konfiguration</strong> von <strong>Autotools</strong> verwechseln.  Es war der Zoo solcher Skripte von verschiedenen Entwicklern, der als Ansto√ü f√ºr die Erstellung von Tools f√ºr ihre vereinfachte und automatische Generierung diente. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><em>&lt;&lt; Zum Inhalt springen</em></a> <br><br><a name="configure"></a><h2>  2. Konfigurieren Sie den Quellcode </h2><br>  Das <strong>Konfigurationsskript</strong> der ‚Äûalten Schule‚Äú, das bereits aus dem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" title="Shebang, Unix, Wikipedia Seite.">Shebang hervorgeht</a> , der ein Leerzeichen hat: <br><br><pre> <code class="bash hljs">$ cat Configure | head -5 <span class="hljs-comment"><span class="hljs-comment">#! /bin/sh # # If these # comments don't work, trim them. Don't worry about any other # shell scripts, Configure will trim # comments from them for you. #</span></span></code> </pre><br>  Dem Kommentar zufolge gab es Muscheln in den Skripten, deren Kommentare nicht hinterlassen werden konnten!  Die Weltraumsituation sieht ungew√∂hnlich aus, aber sobald dies die Norm war, finden Sie hier den Link f√ºr weitere Informationen.  Vor allem gibt es f√ºr moderne Shell-Interpreten keinen Unterschied, ob es einen Raum gibt oder nicht. <br><br>  Genug der Texte, lasst uns zur Sache kommen!  Wir starten das Skript und sehen eine interessante Annahme, die sich als nicht ganz richtig herausstellt: <br><br><pre> <code class="plaintext hljs">$ ./Configure (I see you are using the Korn shell. Some ksh's blow up on Configure, especially on exotic machines. If yours does, try the Bourne shell instead.) Beginning of configuration questions for perl kit. Checking echo to see how to suppress newlines... ...using -n. Type carriage return to continue. Your cursor should be here--&gt;</code> </pre><br>  √úberraschenderweise ist das Skript interaktiv und enth√§lt eine Vielzahl verschiedener Hintergrundinformationen.  Das Benutzerinteraktionsmodell basiert auf Dialogen und analysiert die Antworten, auf die das Skript seine Parameter √§ndert, und generiert anschlie√üend Makefiles.  Ich war pers√∂nlich daran interessiert zu √ºberpr√ºfen, ob alle Shell-Befehle vorhanden sind. <br><br><pre> <code class="plaintext hljs">Locating common programs... expr is in /bin/expr. sed is in /bin/sed. echo is in /bin/echo. cat is in /bin/cat. rm is in /bin/rm. mv is in /bin/mv. cp is in /bin/cp. tr is in /bin/tr. mkdir is in /bin/mkdir. sort is in /bin/sort. uniq is in /bin/uniq. grep is in /bin/grep. Don't worry if any of the following aren't found... test is in /bin/test. egrep is in /bin/egrep. I don't see Mcc out there, offhand.</code> </pre><br>  Anscheinend war dies vorher weit davon entfernt.  Ich frage mich, wof√ºr das Dienstprogramm <strong>Mcc</strong> verantwortlich ist, das nicht gefunden werden konnte.  Das Lustige ist, dass dieses Drehbuch in den besten Hacker-Traditionen der Zeit voller freundlicher Humor ist.  Jetzt werden Sie das kaum noch sehen: <br><br><pre> <code class="plaintext hljs">Is your "test" built into sh? [n] (OK to guess) OK Checking compatibility between /bin/echo and builtin echo (if any)... They are compatible. In fact, they may be identical. Your C library is in /lib/libc.a. You're normal. Extracting names from /lib/libc.a for later perusal...done Hmm... Looks kind of like a USG system, but we'll see... Congratulations. You aren't running Eunice. It's not Xenix... Nor is it Venix... Checking your sh to see if it knows about # comments... Your sh handles # comments correctly. Okay, let's see if #! works on this system... It does. Checking out how to guarantee sh startup... Let's see if '#!/bin/sh' works... Yup, it does.</code> </pre><br>  Ich beantwortete die meisten Fragen mit dem Standardwert oder mit dem, was mir das Skript bot.  Besonders erfreut und √ºberrascht war die Anfrage nach Flags f√ºr den Compiler und Linker: <br><br><pre> <code class="plaintext hljs">Any additional cc flags? [none] Any additional ld flags? [none]</code> </pre><br>  Dort k√∂nnen Sie etwas Interessantes schreiben, z. B. <strong>-m32</strong> , um eine ausf√ºhrbare 32-Bit-Datei oder eine Bibliothek zu erstellen, die beim Verkn√ºpfen erforderlich ist.  Zur letzten Skriptfrage: <br><br><pre> <code class="plaintext hljs">Now you need to generate make dependencies by running "make depend". You might prefer to run it in background: "make depend &gt; makedepend.out &amp;" It can take a while, so you might not want to run it right now. Run make depend now? [n] y</code> </pre><br>  Ich antwortete positiv.  Gemessen an <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" title="makedepend, Geschichte, Wikipedia-Seite.">der</a> Wikipedia- <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" title="makedepend, Geschichte, Wikipedia-Seite.">Seite</a> wurde das alte <strong>Makedepend-</strong> Dienstprogramm zu Beginn des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" title="Projekt Athena, Wikipedia-Seite.">Athena-Projektlebens erstellt</a> , um die Arbeit mit Makefiles zu erleichtern.  Dieses Projekt gab uns das X Window System, Kerberos, Zephyr und beeinflusste viele andere Dinge, die heute bekannt sind.  Das alles ist wunderbar, aber woher kommt dieses Dienstprogramm in einer modernen Linux-Umgebung?  Es wurde lange Zeit von niemandem und irgendwo benutzt.  Wenn Sie sich jedoch das Stammverzeichnis des Repositorys genau ansehen, stellt sich heraus, dass Larry Wall seine Ersatzskriptversion geschrieben hat, die wir sorgf√§ltig entpackt und das Konfigurationsskript ausgef√ºhrt haben. <br><br>  <strong>Makedepend</strong> mit einigen seltsamen Fehlern abgeschlossen: <br><br><pre> <code class="bash hljs">./makedepend: <span class="hljs-built_in"><span class="hljs-built_in">command</span></span> substitution: line 82: unexpected EOF <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> looking <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> matching `<span class="hljs-string"><span class="hljs-string">''</span></span> ./makedepend: <span class="hljs-built_in"><span class="hljs-built_in">command</span></span> substitution: line 83: syntax error: unexpected end of file ./makedepend: <span class="hljs-built_in"><span class="hljs-built_in">command</span></span> substitution: line 82: unexpected EOF <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> looking <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> matching `<span class="hljs-string"><span class="hljs-string">''</span></span> ./makedepend: <span class="hljs-built_in"><span class="hljs-built_in">command</span></span> substitution: line 83: syntax error: unexpected end of file</code> </pre><br>  Vielleicht haben sie das Problem verursacht, aufgrund dessen die generierten Makefiles etwas gekaut wurden: <br><br><pre> <code class="bash hljs">$ make make: *** No rule to make target <span class="hljs-string"><span class="hljs-string">'&lt;built-in&gt;'</span></span>, needed by <span class="hljs-string"><span class="hljs-string">'arg.o'</span></span>. Stop.</code> </pre><br>  Ich wollte absolut nicht in den Dschungel der komplizierten Shell-Nudeln des <strong>Makedepend-</strong> Dienstprogramms gehen und beschloss, mir die Makefiles genau anzusehen, in denen ein seltsames Muster auftauchte: <br><br><pre> <code class="plaintext hljs">arg.o: arg.c arg.o: arg.h arg.o: array.h arg.o: &lt;built-in&gt; arg.o: cmd.h arg.o: &lt;command-line&gt; arg.o: config.h arg.o: EXTERN.h ... array.o: arg.h array.o: array.c array.o: array.h array.o: &lt;built-in&gt; array.o: cmd.h array.o: &lt;command-line&gt; array.o: config.h array.o: EXTERN.h ...</code> </pre><br>  Anscheinend hat ein Dienstprogramm seine Argumente falsch in den Auspuff eingef√ºgt.  Ich nahm das <s>Axt-</s> Dienstprogramm <strong>sed und</strong> beschloss, dieses Problem leicht zu beheben: <br><br><pre> <code class="bash hljs">$ sed -i <span class="hljs-string"><span class="hljs-string">'/built-in/d'</span></span> Makefile $ sed -i <span class="hljs-string"><span class="hljs-string">'/command-line/d'</span></span> Makefile</code> </pre><br>  √úberraschenderweise funktionierte der Trick und die Makefiles funktionierten wie sie sollten! <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><em>&lt;&lt; Zum Inhalt springen</em></a> <br><br><a name="yacc"></a><h2>  3. Fehler in der Yacc-Grammatikdatei </h2><br>  Es w√§re unglaublich, wenn der 32 Jahre alte Code ohne Probleme aufgenommen und zusammengestellt w√ºrde.  Leider geschehen keine Wunder.  Beim Studium des <strong>Quellbaums</strong> stie√ü ich auf eine <strong>perl.y-</strong> Datei, die eine Grammatikbeschreibung f√ºr das Dienstprogramm <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" title="yacc, Wikipedia-Seite.">yacc darstellt</a> , das in modernen Distributionen seit langem durch <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" title="GNU Bison, Wikipedia-Seite.">Bison</a> ersetzt wurde.  Das Skript im Pfad <strong>/ usr / bin / yacc</strong> ruft <strong>Bison</strong> einfach im Kompatibilit√§tsmodus mit <strong>yacc auf</strong> .  Es ist nur so, dass diese Kompatibilit√§t nicht vollst√§ndig ist und bei der Verarbeitung dieser Datei eine Vielzahl von Fehlern auftreten, die ich nicht korrigieren kann und nicht wirklich m√∂chte, da es eine alternative L√∂sung gibt, die ich k√ºrzlich kennengelernt habe. <br><br>  Noch vor ein oder zwei Jahren hat Helio Chissini de Castro, der Entwickler von KDE, √§hnliche Arbeiten durchgef√ºhrt und KDE 1, 2 und Qt 1, 2 an moderne Umgebungen und Compiler angepasst.  Ich interessierte mich f√ºr seine Arbeit, lud die Quellcodes der Projekte herunter, aber w√§hrend der Montage stie√ü ich auf eine √§hnliche <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" title="Qt 2 moderne Adaption von Helio Castro, Issues, GitHub Repository.">Gefahr</a> aufgrund der Inkompatibilit√§t von <strong>Yacc</strong> und <strong>Bison</strong> , die zum Erstellen der alten Version des <strong>Moc-</strong> Metacompilers verwendet wurden.  Anschlie√üend gelang es mir, eine L√∂sung f√ºr dieses Problem zu finden, indem <strong>Bison</strong> durch <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" title="Berkeley Yacc, Offizielle Seite.">das</a> Dienstprogramm <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" title="Berkeley Yacc, Offizielle Seite.">byacc</a> (Berkeley Yacc) ersetzt wurde, das sich als kompatibel mit alten Grammatiken f√ºr <strong>yacc</strong> herausstellte und in vielen Linux-Distributionen verf√ºgbar war. <br><br>  Ein einfaches Ersetzen von <strong>yacc</strong> durch <strong>byacc</strong> im Build-System hat mir dann geholfen, wenn auch nicht lange, da sie etwas sp√§ter in neuen Versionen von <strong>byacc</strong> immer noch die Kompatibilit√§t mit <strong>yacc</strong> brachen und das mit der <strong>yydebug-</strong> Entit√§t verbundene Debugging <strong>abbrachen</strong> .  Daher musste ich <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" title="Behebung eines undefinierten Referenzfehlers, Pull Requests, Qt 2 moderne Anpassung von Helio Castro, GitHub Repository.">die</a> Utility- <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" title="Behebung eines undefinierten Referenzfehlers, Pull Requests, Qt 2 moderne Anpassung von Helio Castro, GitHub Repository.">Grammatik</a> etwas korrigieren. <br><br>  Die Strategie zur Korrektur von Konstruktionsfehlern in der Datei <strong>perl.y</strong> wurde daher aufgrund fr√ºherer Erfahrungen vorhergesagt: Installieren Sie das Dienstprogramm <strong>byacc</strong> , √§ndern Sie <strong>yacc</strong> in <strong>byacc</strong> in allen Makefiles und schneiden Sie <strong>yydebug</strong> von √ºberall aus.  Diese Aktionen l√∂sten alle Probleme mit dieser Datei, die Fehler verschwanden und die Kompilierung wurde fortgesetzt. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><em>&lt;&lt; Zum Inhalt springen</em></a> <br><br><a name="c-errors"></a><h2>  4. Fehler beim Kompilieren von Code auf "C" </h2><br>  Perls alter Code war voller Schrecken, wie die l√§ngst veraltete und vergessene Notation von Funktionsdefinitionen vom Typ K &amp; R: <br><br><pre> <code class="cpp hljs">format(orec,fcmd) <span class="hljs-keyword"><span class="hljs-keyword">register</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">outrec</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">orec</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">register</span></span> FCMD *fcmd; { ... } <span class="hljs-function"><span class="hljs-function">STR * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hfetch</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(tb,key)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">register</span></span></span><span class="hljs-function"> HASH *tb</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *key; { ... } <span class="hljs-comment"><span class="hljs-comment">/*VARARGS1*/</span></span> fatal(pat,a1,a2,a3,a4) <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *pat; { <span class="hljs-built_in"><span class="hljs-built_in">fprintf</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">stderr</span></span>,pat,a1,a2,a3,a4); <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>); }</code> </pre><br>  √Ñhnliche Funktionen wurden beispielsweise in <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" title="Unterhaltsame Arch√§ologie. Oder PVS-Studio √ºberpr√ºft Microsoft Word 1.1a, Artikel in der Habr-Ressource.">Microsoft Word 1.1a-</a> Code gefunden, der ebenfalls ziemlich alt ist.  Der erste Standard der Programmiersprache ‚ÄûC‚Äú, genannt ‚ÄûC89‚Äú, wird erst in zwei Jahren erscheinen.  Moderne Compiler k√∂nnen mit solchem ‚Äã‚ÄãCode arbeiten, aber einige IDEs machen es nicht einfach, solche Definitionen zu analysieren und sie als Syntaxfehler hervorzuheben, z. B. hat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" title="Qt Creator IDE, Wikipedia-Seite.">Qt Creator</a> zuvor ges√ºndigt, bevor der darin enthaltene Code in die <strong>libclang-</strong> Bibliothek <strong>analysiert wurde</strong> . <br><br>  Der GCC 9.2.0-Compiler, der eine Vielzahl von Warnungen ausspuckte, verpflichtete sich, den alten Code der ersten Version von Perl zu kompilieren.  Die Bl√§tter aus den Warnungen waren so gro√ü, dass wir mehrere Seiten des Auspuffs nach oben scrollen mussten, um zum Fehler zu gelangen.  Zu meiner √úberraschung waren die meisten Kompilierungsfehler typisch und bezogen sich haupts√§chlich auf vordefinierte Definitionen, die die Rolle von Flags f√ºr die Assembly spielten. <br><br><div style="text-align:center;"><img title="Die Arbeit des modernen GCC 9.2.0-Compilers und des GDB 8.3.1-Debuggers im twm-Fenstermanager und im xterm-Terminalemulator." src="https://habrastorage.org/getpro/habr/post_images/3a9/b3c/004/3a9b3c0041c48a06e6805bd39883c6a4.png"></div><br>  <i>Die Arbeit des modernen GCC 9.2.0-Compilers und des GDB 8.3.1-Debuggers im <strong>twm-</strong> Fenstermanager und im <strong>xterm-</strong> Terminalemulator.</i> <br><br>  Unter STDSTDIO experimentierte Larry Wall mit einer alten und nicht standardm√§√üigen Programmiersprachenbibliothek ‚ÄûC‚Äú, und unter DEBUGGING <strong>gab</strong> es Debugging-Informationen mit dem ber√ºchtigten <strong>Yydebug</strong> , den ich oben erw√§hnte.  Standardm√§√üig waren diese Kontrollk√§stchen aktiviert.  Durch <strong>Deaktivieren</strong> in der Datei <strong>perl.h</strong> und Hinzuf√ºgen einiger vergessener <strong>Definitionen</strong> konnte ich die Anzahl der Fehler erheblich reduzieren. <br><br>  Eine andere Art von Fehler besteht darin, die jetzt standardisierten Funktionen der Standardbibliothek und der POSIX-Schicht zu √ºberschreiben.  Das Projekt hat seine eigenen <strong>malloc ()</strong> , <strong>setenv ()</strong> und andere Entit√§ten, die Konflikte verursacht haben. <br><br>  Einige Stellen definierten statische Funktionen ohne Deklarationen.  Im Laufe der Zeit gingen die Compiler dieses Problems strenger an und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" title="Wie l√∂st man eine statische Deklaration nach einer nicht statischen Deklaration im GCC C-Code? - Stapel√ºberlauf.">verwandelten die Warnung in einen Fehler</a> .  Und zum Schluss noch ein paar vergessene √úberschriften, wohin w√ºrden Sie ohne sie gehen? <br><br>  Zu meiner √úberraschung stellte sich heraus, dass der Patch f√ºr den 32 Jahre alten Code so klein war, dass er hier vollst√§ndig zitiert werden kann: <br><br><pre> <code class="diff hljs">diff --git a/malloc.cb/malloc.c index 17c3b27..a1dfe9c 100644 --- a/malloc.c +++ b/malloc.c @@ -79,6 +79,9 @@ static u_int nmalloc[NBUCKETS]; #include &lt;stdio.h&gt; #endif +static findbucket(union overhead *freep, int srchlen); +static morecore(register bucket); + #ifdef debug #define ASSERT(p) if (!(p)) botch("p"); else static diff --git a/perl.hb/perl.h index 3ccff10..e98ded5 100644 --- a/perl.h +++ b/perl.h @@ -6,16 +6,16 @@ * */ -#define DEBUGGING -#define STDSTDIO /* eventually should be in config.h */ +//#define DEBUGGING +//#define STDSTDIO /* eventually should be in config.h */ #define VOIDUSED 1 #include "config.h" -#ifndef BCOPY -# define bcopy(s1,s2,l) memcpy(s2,s1,l); -# define bzero(s,l) memset(s,0,l); -#endif +//#ifndef BCOPY +//# define bcopy(s1,s2,l) memcpy(s2,s1,l); +//# define bzero(s,l) memset(s,0,l); +//#endif #include &lt;stdio.h&gt; #include &lt;ctype.h&gt; @@ -183,11 +183,11 @@ double atof(); long time(); struct tm *gmtime(), *localtime(); -#ifdef CHARSPRINTF - char *sprintf(); -#else - int sprintf(); -#endif +//#ifdef CHARSPRINTF +// char *sprintf(); +//#else +// int sprintf(); +//#endif #ifdef EUNICE #define UNLINK(f) while (unlink(f) &gt;= 0) diff --git a/perl.yb/perl.y index 16f8a9a..1ab769f 100644 --- a/perl.y +++ b/perl.y @@ -7,6 +7,7 @@ */ %{ +#include &lt;stdlib.h&gt; #include "handy.h" #include "EXTERN.h" #include "search.h" diff --git a/perly.cb/perly.c index bc32318..fe945eb 100644 --- a/perly.c +++ b/perly.c @@ -246,12 +246,14 @@ yylex() static bool firstline = TRUE; retry: +#ifdef DEBUGGING #ifdef YYDEBUG if (yydebug) if (index(s,'\n')) fprintf(stderr,"Tokener at %s",s); else fprintf(stderr,"Tokener at %s\n",s); +#endif #endif switch (*s) { default: diff --git a/stab.cb/stab.c index b9ef533..9757cfe 100644 --- a/stab.c +++ b/stab.c @@ -7,6 +7,7 @@ */ #include &lt;signal.h&gt; +#include &lt;errno.h&gt; #include "handy.h" #include "EXTERN.h" #include "search.h" diff --git a/util.hb/util.h index 4f92eeb..95cb9bf 100644 --- a/util.h +++ b/util.h @@ -28,7 +28,7 @@ void prexit(); char *get_a_line(); char *savestr(); int makedir(); -void setenv(); +//void setenv(); int envix(); void notincl(); char *getval();</code> </pre><br>  Tolles Ergebnis f√ºr 32 Jahre alten Code!  Der <strong>undefinierte Verweis auf den "Crypt"</strong> <em>-Verbindungsfehler</em> wurde behoben, indem die Anweisung <em>-lcrypt</em> mit der entsprechenden <strong>libcrypt-</strong> Bibliothek zum Makefile hinzugef√ºgt wurde. <em>Danach</em> erhielt ich endlich die gew√ºnschte ausf√ºhrbare Perl-Interpreter-Datei: <br><br><pre> <code class="bash hljs">$ file perl perl: ELF 64-bit LSB pie executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=fd952ceae424613568530b3a2ca88ebd6477e0ae, <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> GNU/Linux 3.2.0, not stripped</code> </pre><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><em>&lt;&lt; Zum Inhalt springen</em></a> <br><br><a name="segfaults"></a><h2>  5. Korrektur einiger Fehler Segmentierungsfehler </h2><br>  Nach einer fast problemlosen Zusammenstellung drehte mir das Gl√ºck den R√ºcken zu.  Unmittelbar nach dem Starten des zusammengebauten Perl-Interpreters bekam ich einige seltsame Fehler und am Ende einen Segmentierungsfehler: <br><br><pre> <code class="bash hljs">$ ./perl -e <span class="hljs-string"><span class="hljs-string">'print "Hello World!\n";'</span></span> Corrupt malloc ptr 0x2db36040 at 0x2db36000 Corrupt malloc ptr 0x2db36880 at 0x2db36800 Corrupt malloc ptr 0x2db36080 at 0x2db36040 Corrupt malloc ptr 0x2db37020 at 0x2db37000 Segmentation fault (core dumped)</code> </pre><br>  Nachdem der Quelltext f√ºr die Phrase <em>Corrupt malloc</em> genagt worden war, stellte sich heraus, dass ab 1982 anstelle des Systems <strong>malloc ()</strong> eine Art benutzerdefinierter Allokator aufgerufen wurde.  Interessanterweise ist <strong>Berkeley</strong> in einem der String-Literale im Quellcode und <strong>Caltech</strong> in einem Kommentar daneben geschrieben.  Die Zusammenarbeit zwischen diesen Universit√§ten war damals sehr stark.  Im Allgemeinen habe ich diesen Hacker-Allokator auskommentiert und den Quellcode neu erstellt.  Speicherbesch√§digungsfehler verschwanden, aber der Segmentierungsfehler blieb bestehen.  Das war also nicht der Punkt, und jetzt m√ºssen wir den Debugger aufdecken. <br><br>  Beim Ausf√ºhren des Programms unter <strong>gdb stellte</strong> ich fest, dass der Absturz auftritt, wenn die Funktion zum Erstellen einer tempor√§ren Datei <strong>mktemp ()</strong> aus libc aufgerufen wird: <br><br><pre> <code class="plaintext hljs">$ gdb --args ./perl -e 'print "Hello, World!\n";' (gdb) r Starting program: /home/exl/perl5/perl -e print\ \"Hello\ World\!\\n\"\; Program received signal SIGSEGV, Segmentation fault. 0x00007ffff7cd20c7 in __gen_tempname () from /usr/lib/libc.so.6 (gdb) bt #0 0x00007ffff7cd20c7 in __gen_tempname () from /usr/lib/libc.so.6 #1 0x00007ffff7d71577 in mktemp () from /usr/lib/libc.so.6 #2 0x000055555556bb08 in main ()</code> </pre><br>  √úbrigens hat der Linker zuvor auf diese Funktion geschworen.  Kein Compiler, sondern ein Linker, was mich √ºberrascht hat: <br><br><pre> <code class="plaintext hljs">/usr/bin/ld: perl.o: in function `main': perl.c:(.text+0x978c): warning: the use of `mktemp' is dangerous, better use `mkstemp' or `mkdtemp'</code> </pre><br>  Der erste Gedanke, der Ihnen wahrscheinlich auch in den Sinn kam, war, die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" title="Die GNU C-Bibliothek, tempor√§re Dateien, offizielle GNU-Dokumentation.">unsichere Funktion</a> <strong>mktemp ()</strong> durch <strong>mkstemp ()</strong> zu ersetzen, was ich auch getan habe.  Die Linker-Warnung verschwand, aber der Segmentierungsfehler blieb trotzdem an dieser Stelle, nur jetzt war er in der Funktion <strong>mkstemp ()</strong> . <br><br>  Daher m√ºssen Sie sich jetzt den Code, der dieser Funktion zugeordnet ist, sehr genau ansehen.  Dort habe ich eine ziemlich seltsame Sache entdeckt, die in diesem Ausschnitt hervorgehoben wird: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *e_tmpname = <span class="hljs-string"><span class="hljs-string">"/tmp/perl-eXXXXXX"</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ mktemp(e_tmpname); e_fp = f_open(e_tmpname, <span class="hljs-string"><span class="hljs-string">"w"</span></span>); ... }</code> </pre><br>  Es stellt sich heraus, dass <strong>mktemp ()</strong> versucht, das Literal f√ºr die Maske zu √§ndern, die sich im Abschnitt <strong>.rodata befindet</strong> , der offensichtlich zum Scheitern verurteilt ist.  Oder war das vor 32 Jahren akzeptabel, traf sich im Code und funktionierte sogar irgendwie? <br><br>  Das Ersetzen von <strong>char * e_tmpname</strong> durch <strong>char e_tmpname [] hat</strong> diesen Segmentierungsfehler behoben und ich konnte das bekommen, was ich den ganzen Abend get√∂tet habe: <br><br><pre> <code class="bash hljs">$ ./perl -e <span class="hljs-string"><span class="hljs-string">'print "Hello World!\n";'</span></span> $ Hello, World! $ ./perl -e <span class="hljs-string"><span class="hljs-string">'$a = 5; $b = 6.3; $c = $a+$b; print $c."\n";'</span></span> $ 11.3000000000000007 $ ./perl -v <span class="hljs-variable"><span class="hljs-variable">$Header</span></span>: perly.c,v 1.0 87/12/18 15:53:31 root Exp $ Patch level: 0</code> </pre><br>  Wir haben die Ausf√ºhrung √ºber die Befehlszeile √ºberpr√ºft, aber was ist mit der Datei?  Ich habe die erste ‚ÄûHallo Welt‚Äú f√ºr die Programmiersprache Perl aus dem Internet heruntergeladen: <br><br><pre> <code class="perl hljs"><span class="hljs-comment"><span class="hljs-comment">################# test.pl #!/usr/bin/perl # # The traditional first program. # Strict and warnings are recommended. use strict; use warnings; # Print a message. print "Hello, World!\n";</span></span></code> </pre><br>  Dann habe ich versucht, es auszuf√ºhren, aber leider wartete der Segmentierungsfehler wieder auf mich.  Diesmal an einem ganz anderen Ort: <br><br><pre> <code class="plaintext hljs">$ gdb --args ./perl test.pl (gdb) r Starting program: /home/exl/perl5/perl test.pl Program received signal SIGSEGV, Segmentation fault. 0x00007ffff7d1da75 in __strcpy_sse2_unaligned () from /usr/lib/libc.so.6 (gdb) bt #0 0x00007ffff7d1da75 in __strcpy_sse2_unaligned () from /usr/lib/libc.so.6 #1 0x00005555555629ea in yyerror () #2 0x0000555555568dd6 in yyparse () #3 0x000055555556bd4f in main ()</code> </pre><br>  Der folgende interessante Punkt wurde in der Funktion <strong>yyerror () gefunden</strong> , ich zitiere das Original-Snippet: <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// perl.y char *tokename[] = { "256", "word", "append", ... // perl.c yyerror(s) char *s; { char tmpbuf[128]; char *tname = tmpbuf; if (yychar &gt; 256) { tname = tokename[yychar-256]; // ??? if (strEQ(tname,"word")) strcpy(tname,tokenbuf); // Oops! else if (strEQ(tname,"register")) sprintf(tname,"$%s",tokenbuf); // Oops! ...</span></span></code> </pre><br>  Wieder ist die Situation √§hnlich der, √ºber die ich oben geschrieben habe.  Die Daten im Abschnitt <strong>.rodata werden erneut ge√§ndert</strong> .  Vielleicht sind es nur Tippfehler wegen Copy-Paste und statt <strong>tname</strong> wollten sie <strong>tmpbuf</strong> schreiben?  Oder steckt wirklich eine versteckte Bedeutung dahinter?  In jedem Fall wird durch Ersetzen von <strong>char * tokename []</strong> durch <strong>char tokename [] [32]</strong> der Segmentierungsfehler <strong>behoben,</strong> und Perl teilt uns Folgendes mit: <br><br><pre> <code class="bash hljs">$ ./perl test.pl syntax error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> file test.pl at line 7, next token <span class="hljs-string"><span class="hljs-string">"strict"</span></span> Execution aborted due to compilation errors.</code> </pre><br>  Es stellt sich heraus, dass er nicht alle Arten von neuem <strong>Gebrauch streng</strong> mag, das versucht er uns zu sagen!  Wenn Sie diese Zeilen in der Datei l√∂schen oder auskommentieren, startet das Programm: <br><br><pre> <code class="bash hljs">$ ./perl test.pl Hello, World!</code> </pre><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><em>&lt;&lt; Zum Inhalt springen</em></a> <br><br><a name="theend"></a><h2>  6. Zusammenfassend </h2><br>  Tats√§chlich habe ich mein Ziel erreicht und den alten Code von 1987 nicht nur kompilieren lassen, sondern auch in einer modernen Linux-Umgebung arbeiten lassen.  Zweifellos gibt es immer noch einen gro√üen Stapel verschiedener Segmentierungsfehler, die m√∂glicherweise mit der Gr√∂√üe des Zeigers auf einer 64-Bit-Architektur zusammenh√§ngen.  All dies kann nach einigen Abenden mit dem bereitstehenden Debugger gereinigt werden.  Dies ist jedoch keine sehr angenehme und ziemlich m√ºhsame Aufgabe.  Schlie√ülich war dieses Experiment zun√§chst als Unterhaltung f√ºr einen langweiligen Abend geplant und nicht als vollwertige Arbeit, die beendet werden soll.  Gibt es einen praktischen Nutzen aus den ergriffenen Ma√ünahmen?  Vielleicht wird eines Tages ein digitaler Arch√§ologe auf diesen Artikel sto√üen und er wird ihm n√ºtzlich sein.  Aber in der realen Welt sind selbst die Erfahrungen aus solchen Forschungen meiner Meinung nach nicht allzu wertvoll. <br><br>  Wenn jemand interessiert ist, poste ich einen Satz von zwei Patches.  Der erste behebt Kompilierungsfehler und der zweite behebt einige Segmentierungsfehler. <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" title="Fix Kompilierungsfehler Patch, EXLMOTODEV GitHub Repository."><strong>Perl1987-Fix-compilation-error.patch</strong></a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" title="Behebung eines Patches f√ºr Segmentierungsfehler im EXLMOTODEV GitHub-Repository."><strong>Perl1987-Fix-some-Segmentation-Faults.patch</strong></a> </li></ul><br>  PS Ich beeile mich, Fans von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" title="Perl Single Line Programm, Lurkmore Artikel.">destruktiven Single-Line-Spielern</a> zu ver√§rgern, das funktioniert hier nicht.  Vielleicht ist Perls Version f√ºr solche Unterhaltung zu alt. <br>  PPS Alles gut und ein sch√∂nes Wochenende.  Vielen Dank an <strong>kawaii_neko</strong> f√ºr eine <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" title="Perl direkt von 1987, Kommentar zur LINUX.ORG.RU-Ressource">kleine L√∂sung</a> . <br><br>  <em>Update</em> 28.10.2019 <em>: Ein</em> Benutzer des LINUX.ORG.RU-Forums, der den Spitznamen <strong>utf8nowhere verwendet</strong> , hat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" title="Perl direkt von 1987, Kommentar zur LINUX.ORG.RU-Ressource">in seinem Kommentar</a> zu diesem Artikel recht interessante Links bereitgestellt, deren Informationen nicht nur die Situation mit ver√§nderlichen Zeichenfolgenliteralen verdeutlichen, sondern sogar das oben beschriebene Verwendungsproblem ber√ºcksichtigen <strong>mktemp ()</strong> funktioniert!  Lassen Sie mich diese Quellen zitieren, die verschiedene Inkompatibilit√§ten zwischen dem nicht standardisierten K &amp; R C und dem GNU C beschreiben: <br><blockquote>  <strong>Inkompatibilit√§ten von GCC</strong> <br>  Es gibt einige bemerkenswerte Inkompatibilit√§ten zwischen GNU C- und K &amp; R-Versionen (Nicht-ISO) von C. <br><br>  GCC macht String-Konstanten normalerweise schreibgesch√ºtzt.  Wenn mehrere identisch aussehende Zeichenfolgenkonstanten verwendet werden, speichert GCC nur eine Kopie der Zeichenfolge. <br>  Eine Konsequenz ist, dass Sie <strong>mktemp nicht</strong> mit einem String-Konstanten-Argument aufrufen <strong>k√∂nnen</strong> .  Die Funktion <strong>mktemp</strong> √§ndert immer die Zeichenfolge, auf die das Argument zeigt. <br><br>  Eine weitere Konsequenz ist, dass <strong>sscanf</strong> auf einigen Systemen nicht funktioniert, wenn eine Zeichenfolgenkonstante als Formatsteuerzeichenfolge oder Eingabe √ºbergeben wird.  Dies liegt daran, dass <strong>sscanf</strong> f√§lschlicherweise versucht, in die Zeichenfolgenkonstante zu schreiben.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ebenso </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fscanf</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">scanf</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die beste L√∂sung f√ºr diese Probleme besteht darin, das Programm so zu √§ndern, dass </font><font style="vertical-align: inherit;">f√ºr diese Zwecke </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">char-</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Array-Variablen mit Initialisierungszeichenfolgen anstelle von Zeichenfolgenkonstanten verwendet werden. </font><font style="vertical-align: inherit;">Ist dies jedoch nicht m√∂glich, k√∂nnen Sie das </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Flag -fwritable-strings</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> verwenden, mit dem GCC </font><strong><font style="vertical-align: inherit;">angewiesen wird, Zeichenfolgenkonstanten</font></strong><font style="vertical-align: inherit;"> wie die meisten C-Compiler zu behandeln. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quelle: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" title="Verwenden des offiziellen Handbuchs zur GNU Compiler Collection (GCC 3.3)."><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Verwenden des offiziellen Handbuchs zur GNU Compiler Collection (GCC 3.3)</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das Compiler-Flag </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-fwritable-strings</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> wurde in GCC 3.4 veraltet und in GCC 4.0 dauerhaft entfernt.</font></font><br><blockquote> <strong>ANSI C rationale | String literals</strong> <br> String literals are specified to be unmodifiable. This specification allows implementations to share copies of strings with identical text, to place string literals in read-only memory, and perform certain optimizations. However, string literals do not have the type array of const char, in order to avoid the problems of pointer type checking, particularly with library functions, since assigning a pointer to const char to a plain pointer to char is not valid. Those members of the Committee who insisted that string literals should be modifiable were content to have this practice designated a common extension (see F.5.5). <br><br> Existing code which modifies string literals can be made strictly conforming by replacing the string literal with an initialized static character array. For instance, <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *p, *make_temp(<span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *str); <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> p = make_temp(<span class="hljs-string"><span class="hljs-string">"tempXXX"</span></span>); <span class="hljs-comment"><span class="hljs-comment">/* make_temp overwrites the literal */</span></span> <span class="hljs-comment"><span class="hljs-comment">/* with a unique name */</span></span></code> </pre><br> can be changed to: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *p, *make_temp(<span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *str); <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>[ ] = <span class="hljs-string"><span class="hljs-string">"tempXXX"</span></span>; p = make_temp( <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> ); }</code> </pre><br> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" title="Begr√ºndung f√ºr den amerikanischen Nationalen Standard f√ºr Informationssysteme, Programmiersprache C, String-Literale.">Rationale for American National Standard for Information Systems, Programming Language C</a> . <br></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Benutzer </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VarfolomeyKote4ka</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> angeboten </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" title="Perl direkt von 1987, Kommentar zur LINUX.ORG.RU-Ressource"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">interessant gryaznenky Hack</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , die Sie in </font><font style="vertical-align: inherit;">den Bypass - </font><font style="vertical-align: inherit;">Fehler Segmentation Fehler erlaubt , </font><font style="vertical-align: inherit;">wenn Sie √Ñnderungsdaten in Abschnitt versuchen </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.rodata</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> indem sie sie in einen Abschnitt Umwandlung </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.rwdata</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Vor nicht allzu langer Zeit erschien im Internet ein sehr interessanter Artikel </font><font style="vertical-align: inherit;">des Programmierers </font><strong><font style="vertical-align: inherit;">guye1296</font></strong><font style="vertical-align: inherit;"> mit dem Titel </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" title="Von .rodata zu .rwdata - Einf√ºhrung in Memory Mapping und LD-Skripte, Guy on BITS."><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ÄûVon .rodata zu .rwdata - Einf√ºhrung in die Speicherzuordnung und LD-Skripte‚Äú</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , in dem erkl√§rt wird, wie dieser Trick ausgef√ºhrt wird. Um das gew√ºnschte Ergebnis zu </font><a href="" title="rwdata.ld-Skript f√ºr ld linker, guye1296, GitHub-Repository."><font style="vertical-align: inherit;">erzielen</font></a><font style="vertical-align: inherit;"> , hat der Autor des Artikels ein ziemlich umfangreiches Skript f√ºr den Standard-Linker </font><strong><font style="vertical-align: inherit;">ld</font></strong><font style="vertical-align: inherit;"> - </font><a href="" title="rwdata.ld-Skript f√ºr ld linker, guye1296, GitHub-Repository."><font style="vertical-align: inherit;">rwdata.ld erstellt</font></a></font><strong><font style="vertical-align: inherit;"></font></strong><font style="vertical-align: inherit;"></font><strong><font style="vertical-align: inherit;"></font></strong><font style="vertical-align: inherit;"></font><a href="" title="rwdata.ld-Skript f√ºr ld linker, guye1296, GitHub-Repository."><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Es reicht aus, dieses Skript herunterzuladen, im Stammverzeichnis des Perl-Quellverzeichnisses </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">abzulegen</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , das </font><strong><font style="vertical-align: inherit;">LDFLAGS-</font></strong><font style="vertical-align: inherit;"> Flag </font><font style="vertical-align: inherit;">wie folgt zu </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">korrigieren</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font><strong><font style="vertical-align: inherit;">LDFLAGS = -T rwdata.ld</font></strong><font style="vertical-align: inherit;"> , und dann das Projekt neu zu </font><strong><font style="vertical-align: inherit;">erstellen</font></strong><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Als Ergebnis haben wir Folgendes:</font></font><br><br><pre> <code class="bash hljs">$ make clean &amp;&amp; make -j1 $ mv perl perl_rodata $ curl -LOJ https://raw.githubusercontent.com/guye1296/ld_script_elf_blog_post/master/rwdata.ld $ sed -i <span class="hljs-string"><span class="hljs-string">'s/LDFLAGS =/LDFLAGS = -T rwdata.ld/'</span></span> Makefile $ make clean &amp;&amp; make -j1 $ mv perl perl_rwdata $ objdump -s -j .rodata perl_rodata | grep tmp -2 19da0 21233f5e 7e3d2d25 30313233 34353637 !<span class="hljs-comment"><span class="hljs-comment">#?^~=-%01234567 19db0 38392e2b 262a2829 2c5c2f5b 7c002400 89.+&amp;*(),\/[|.$. 19dc0 73746465 7272002f 746d702f 7065726c stderr./tmp/perl 19dd0 2d655858 58585858 00323536 00617070 -eXXXXXX.256.app 19de0 656e6400 6c6f6f70 63746c00 66756e63 end.loopctl.func $ objdump -s -j .rwdata perl_rodata | grep tmp -2 objdump: section '.rwdata' mentioned in a -j option, but not found in any input file $ objdump -s -j .rwdata perl_rwdata | grep tmp -2 41d9c0 21233f5e 7e3d2d25 30313233 34353637 !#?^~=-%01234567 41d9d0 38392e2b 262a2829 2c5c2f5b 7c002400 89.+&amp;*(),\/[|.$. 41d9e0 73746465 7272002f 746d702f 7065726c stderr./tmp/perl 41d9f0 2d655858 58585858 00323536 00617070 -eXXXXXX.256.app 41da00 656e6400 6c6f6f70 63746c00 66756e63 end.loopctl.func $ objdump -s -j .rodata perl_rwdata | grep tmp -2 objdump: section '.rodata' mentioned in a -j option, but not found in any input file $ ./perl_rodata -e 'print "Hello, World!\n";' Segmentation fault (core dumped) $ ./perl_rwdata -e 'print "Hello, World!\n";' Hello, World!</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es stellt sich heraus, dass dank dieses Hacks fast alle √Ñnderungen gegen√ºber dem zweiten Patch einfach weggelassen werden k√∂nnen! </font><font style="vertical-align: inherit;">Obwohl es nat√ºrlich immer noch vorzuziehen ist, den Code in eine Ansicht zu bringen, die nicht gegen Standards verst√∂√üt. </font></font><br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;&lt; Zum Inhalt springen</font></font></em></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de473228/">https://habr.com/ru/post/de473228/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de473212/index.html">Investoren, die Tesla-Aktien notieren, verloren t√§glich nach dem Anstieg √ºber 1,4 Milliarden US-Dollar</a></li>
<li><a href="../de473214/index.html">Yaga - slawische Geschichten in der mobilen Umgebung</a></li>
<li><a href="../de473220/index.html">Die Eckpfeiler der langsamen Codezerst√∂rung in Wolfram Language: Zehn-, Hundert- und Tausendfache Beschleunigung des Codes</a></li>
<li><a href="../de473222/index.html">Benutzerdefinierte iptables-Regeln f√ºr Docker am Beispiel von zabbix</a></li>
<li><a href="../de473224/index.html">Hochschulbildung vs. Kompetenz. Separate Stellungnahme eines Richters des Verfassungsgerichts der Russischen F√∂deration zum Stand der Hochschulbildung</a></li>
<li><a href="../de473230/index.html">Ist Satelliten-Internet ein neues Weltraumrennen?</a></li>
<li><a href="../de473232/index.html">Welches Versionskontrollsystem verwenden Sie (in der Praxis meistens)?</a></li>
<li><a href="../de473234/index.html">Erstellen einer REST-API mit Node.js und einer Oracle-Datenbank</a></li>
<li><a href="../de473236/index.html">Arbeit in den Bereichen IT, Projektmanagement, PD-Regulierung und Entwicklung in der Cloud: Megadigest von 1cloud.ru</a></li>
<li><a href="../de473238/index.html">Wie Netflix funktioniert</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>