<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßëüèº‚Äçü§ù‚Äçüßëüèº üòè üë©üèº‚Äçü§ù‚Äçüë®üèø Aplica√ß√£o reativa sem Redux / NgRx üî∞ üêù ü§î</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hoje vamos analisar em detalhes um aplicativo angular reativo ( reposit√≥rio github ), escrito inteiramente na estrat√©gia OnPush . Outro aplicativo usa...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Aplica√ß√£o reativa sem Redux / NgRx</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/true_engineering/blog/426819/"><img src="https://habrastorage.org/webt/d4/ck/od/d4ckodq4-ei9nntgvweinv65mdu.jpeg"><br><br>  Hoje vamos analisar em detalhes um aplicativo angular reativo ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">reposit√≥rio github</a> ), escrito inteiramente na estrat√©gia <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">OnPush</a> .  Outro aplicativo usa formul√°rios reativos, o que √© bastante t√≠pico para um aplicativo corporativo. <br><br>  N√£o usaremos Flux, Redux, NgRx e aproveitaremos os recursos j√° dispon√≠veis em Typescript, Angular e RxJS.  O fato √© que essas ferramentas n√£o s√£o uma bala de prata e podem adicionar complexidade desnecess√°ria at√© para aplicativos simples.  Somos honestamente alertados sobre isso por <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">um dos autores do Flux</a> , o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">autor do Redux</a> e o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">autor do NgRx</a> . <br><br>  Mas essas ferramentas oferecem aos nossos aplicativos recursos muito agrad√°veis: <br><br><ul><li>  Fluxo de dados previs√≠vel; </li><li>  Suporte OnPush por design; </li><li>  A imutabilidade dos dados, a falta de efeitos colaterais acumulados e outras coisas agrad√°veis. </li></ul><br>  Vamos tentar obter as mesmas caracter√≠sticas, mas sem introduzir complexidade adicional. <br><br>  Como voc√™ ver√° no final do artigo, esta √© uma tarefa bastante simples - se voc√™ remover os detalhes de Angular e OnPush do artigo, haver√° apenas algumas id√©ias simples. <br><a name="habracut"></a><br>  O artigo n√£o oferece um novo padr√£o universal, mas apenas compartilha com o leitor v√°rias id√©ias que, por toda a sua simplicidade, por algum motivo n√£o vieram imediatamente √† mente.  Al√©m disso, a solu√ß√£o desenvolvida n√£o contradiz nem substitui o Flux / Redux / NgRx.  Eles podem ser conectados, se isso for <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">realmente necess√°rio</a> . <br><br>  <i>Para uma leitura confort√°vel do artigo, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">√©</a> necess√°ria uma compreens√£o dos termos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">componentes inteligentes, de apresenta√ß√£o e de cont√™iner</a> .</i> <br><br><h2>  Plano de a√ß√£o </h2><br>  A l√≥gica da aplica√ß√£o, bem como a sequ√™ncia de apresenta√ß√£o do material, pode ser descrita na forma das seguintes etapas: <br><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Dados separados para leitura (GET) e grava√ß√£o (PUT / POST)</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Estado de carregamento como fluxo no componente de cont√™iner</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Distribuir State para uma hierarquia de componentes do OnPush</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Notificar o Angular sobre altera√ß√µes de componentes</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Edi√ß√£o de dados encapsulados</a> </li></ol><br>  Para implementar o OnPush, precisamos analisar todas as formas de executar a detec√ß√£o de altera√ß√µes no Angular.  Existem apenas quatro desses m√©todos, e os consideraremos sucessivamente ao longo do artigo. <br><br>  Ent√£o vamos l√°. <br><br><a name="backend"></a><h2>  Compartilhe dados para leitura e grava√ß√£o </h2><br>  Normalmente, aplicativos de front-end e back-end usam contratos digitados (caso contr√°rio, por que datilografado?). <br><br>  O projeto de demonstra√ß√£o que estamos considerando n√£o possui um back-end real, mas cont√©m um arquivo de descri√ß√£o pr√©-preparado <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">swagger.json</a> .  Com base nisso, contratos datilografados s√£o gerados pelo utilit√°rio <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">sw2dts</a> . <br><br>  Os contratos gerados t√™m duas propriedades importantes. <br><br>  Em primeiro lugar, a leitura e a escrita s√£o realizadas usando contratos diferentes.  Usamos uma pequena conven√ß√£o e nos referimos a ler contratos com o sufixo "State" e escrever contratos com o sufixo "Model". <br><br>  Ao separar os contratos dessa maneira, estamos compartilhando o fluxo de dados no aplicativo.  De cima para baixo, um estado somente leitura √© propagado pela hierarquia de componentes.  Para modificar os dados, √© criado um modelo que √© preenchido inicialmente com dados do estado, mas existe como um objeto separado.  No final da edi√ß√£o, o modelo √© enviado ao back-end como um comando. <br><br>  O segundo ponto importante √© que todos os campos de Estado s√£o marcados com modificador somente leitura.  Portanto, obtemos suporte de imunidade no n√≠vel de texto datilografado.  Agora n√£o poderemos alterar acidentalmente o estado no c√≥digo ou vincular a ele usando [(ngModel)] - ao compilar o aplicativo no modo AOT, obteremos um erro. <br><br><a name="container"></a><h2>  Estado de carregamento como fluxo no componente de cont√™iner </h2><br>  Para carregar e inicializar o estado, usaremos servi√ßos angulares comuns.  Eles ser√£o respons√°veis ‚Äã‚Äãpelos seguintes cen√°rios: <br><br><ul><li>  Um exemplo cl√°ssico √© o carregamento via HttpClient usando o par√¢metro id obtido pelo componente do roteador. </li><li>  Inicializando um estado vazio ao criar uma nova entidade.  Por exemplo, se os campos tiverem valores padr√£o ou para inicializar, voc√™ precisar√° solicitar dados adicionais do back-end. </li><li>  Reiniciando um estado j√° carregado depois que o usu√°rio executa uma opera√ß√£o que altera os dados para o back-end. </li><li>  Reinicializando o estado por notifica√ß√£o por push, por exemplo, ao co-editar dados.  Nesse caso, o servi√ßo mescla o estado local e o estado obtido do back-end. </li></ul><br>  No aplicativo de demonstra√ß√£o, consideraremos os dois primeiros cen√°rios como os mais comuns.  Al√©m disso, esses cen√°rios s√£o simples e permitem que o servi√ßo seja implementado como objetos simples sem estado e n√£o se distraia com a complexidade, que n√£o √© o assunto deste artigo em particular. <br><br>  Um exemplo de servi√ßo pode ser encontrado no arquivo <a href="">some-entity.service.ts</a> . <br><br>  Resta obter o servi√ßo atrav√©s da DI no componente do cont√™iner e no estado de carga.  Isso geralmente √© feito assim: <br><br><pre><code class="plaintext hljs">route.params .pipe( pluck('id'), filter((id: any) =&gt; { return !!id; }), switchMap((id: string) =&gt; { return myFormService.get(id); }) ) .subscribe(state =&gt; { this.state = state; });</code> </pre> <br>  Mas com essa abordagem, dois problemas surgem: <br><br><ul><li>  Voc√™ deve cancelar a assinatura manualmente da assinatura criada, caso contr√°rio, ocorrer√° um vazamento de mem√≥ria. </li><li>  Se voc√™ alternar o componente para a estrat√©gia OnPush, ele deixar√° de responder ao carregamento de dados. </li></ul><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Tubo ass√≠ncrono</a> vem em socorro.  Ele ouve diretamente o Observable e cancela a inscri√ß√£o quando necess√°rio.  Al√©m disso, ao usar o canal ass√≠ncrono, o Angular aciona automaticamente a detec√ß√£o de altera√ß√µes toda vez que o Observable publica um novo valor. <br><br>  Um exemplo de uso de canal ass√≠ncrono pode ser encontrado no modelo para o <a href="">componente some-entity.component</a> . <br><br>  E no c√≥digo do componente, removemos a l√≥gica repetida nos operadores RxJS personalizados, adicionamos o script para criar um estado vazio, mesclando as duas fontes de estado em um fluxo com o operador de mesclagem e criando um formul√°rio para edi√ß√£o, que discutiremos mais adiante: <br><br><pre> <code class="plaintext hljs">this.state$ = merge( route.params.pipe( switchIfNotEmpty("id", (requestId: string) =&gt; requestService.get(requestId) ) ), route.params.pipe( switchIfEmpty("id", () =&gt; requestService.getEmptyState()) ) ).pipe( tap(state =&gt; { this.form = new SomeEntityFormGroup(state); }) );</code> </pre><br>  Isso √© tudo o que era necess√°rio para ser feito no componente do cont√™iner.  E colocamos no cofrinho a primeira maneira de chamar a detec√ß√£o de altera√ß√µes no componente OnPush - tubo ass√≠ncrono.  Ser√° √∫til para n√≥s mais de uma vez. <br><br><a name="presentation"></a><h2>  Distribuir State para uma hierarquia de componentes do OnPush </h2><br>  Quando voc√™ precisa exibir um estado complexo, criamos uma hierarquia de pequenos componentes - √© assim que lidamos com a complexidade. <br><br>  Como regra, os componentes s√£o divididos em uma hierarquia semelhante √† hierarquia de dados e cada componente recebe seus pr√≥prios dados atrav√©s dos par√¢metros de Entrada para exibi-los no modelo. <br><br>  Como vamos implementar todos os componentes como OnPush, vamos discutir por um momento e discutir o que √© e como o Angular funciona com os componentes OnPush.  Se voc√™ j√° conhece este material, fique √† vontade para rolar at√© o final da se√ß√£o. <br><br>  Durante a compila√ß√£o do aplicativo, o Angular gera um detector de altera√ß√£o de classe especial para cada componente, que "lembra" todas as liga√ß√µes usadas no modelo de componente.  No tempo de execu√ß√£o, a classe gerada come√ßa a verificar as express√µes armazenadas em cada loop de detec√ß√£o de altera√ß√µes.  Se a verifica√ß√£o mostrou que o resultado de qualquer express√£o foi alterado, Angular redesenha o componente. <br><br>  Por padr√£o, o Angular n√£o sabe nada sobre nossos componentes e n√£o pode determinar quais componentes afetar√£o, por exemplo, o setTimeout acionado ou uma solicita√ß√£o AJAX que foi encerrada.  Portanto, ele √© for√ßado a verificar o aplicativo inteiro literalmente para todos os eventos dentro do aplicativo - mesmo um simples deslocamento da janela dispara repetidamente a detec√ß√£o de altera√ß√µes para toda a hierarquia dos componentes do aplicativo. <br><br>  Aqui est√° uma fonte potencial de problemas de desempenho - quanto mais complexos os modelos de componentes, mais dif√≠ceis s√£o as verifica√ß√µes do detector de altera√ß√µes.  E se houver muitos componentes e as verifica√ß√µes forem executadas com frequ√™ncia, a detec√ß√£o de altera√ß√µes come√ßar√° a levar um tempo consider√°vel. <br><br>  O que fazer? <br><br>  Se o componente n√£o depende de nenhum efeito global (a prop√≥sito, √© melhor projetar componentes dessa maneira), ent√£o seu estado interno √© determinado por: <br><br><ul><li>  Par√¢metros de entrada ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">@Input</a> ); </li><li>  Eventos que ocorreram no pr√≥prio componente ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">@Output</a> ). </li></ul><br>  Adiaremos o segundo ponto por enquanto e suporemos que o estado do nosso componente depende apenas dos par√¢metros de entrada. <br><br>  Se todos os par√¢metros de entrada do componente forem objetos imut√°veis, podemos marcar o componente como OnPush.  Ent√£o, antes de executar a detec√ß√£o de altera√ß√µes, o Angular verificar√° se os links para os par√¢metros de Entrada do componente foram alterados desde a verifica√ß√£o anterior.  E, se eles n√£o foram alterados, o Angular ignorar√° a detec√ß√£o de altera√ß√µes do pr√≥prio componente e de todos os seus componentes filhos. <br><br>  Assim, se construirmos todo o aplicativo de acordo com a estrat√©gia OnPush, eliminaremos toda uma classe de problemas de desempenho desde o in√≠cio. <br><br>  Como o estado em nosso aplicativo j√° √© imut√°vel, objetos imut√°veis ‚Äã‚Äãtamb√©m s√£o transferidos para os par√¢metros de entrada dos componentes filhos.  Ou seja, estamos prontos para ativar o OnPush para componentes filhos e eles responder√£o √†s altera√ß√µes de estado. <br>  Por exemplo, esses s√£o <a href="">componentes</a> <a href="">readonly-info.component</a> e <a href="">nested-items.component</a> <br><br>  Agora vamos ver como implementar a mudan√ßa no estado dos componentes no paradigma OnPush. <br><br><a name="output"></a><h2>  Fale com a Angular sobre sua condi√ß√£o </h2><br>  Estado da apresenta√ß√£o - s√£o os par√¢metros respons√°veis ‚Äã‚Äãpela apar√™ncia do componente: carregar indicadores, sinalizadores de visibilidade de elementos ou acessibilidade ao usu√°rio de uma a√ß√£o espec√≠fica, colados de tr√™s campos a uma linha do nome do usu√°rio, etc. <br><br>  Sempre que o estado de apresenta√ß√£o de um componente √© alterado, √© necess√°rio notificar o Angular para que ele possa exibir as altera√ß√µes na interface do usu√°rio. <br><br>  Dependendo da origem do estado do componente, existem v√°rias maneiras de notificar o Angular. <br><br><h4>  Estado da apresenta√ß√£o, calculado com base nos par√¢metros de entrada </h4><br>  Esta √© a op√ß√£o mais f√°cil.  Colocamos a l√≥gica de computa√ß√£o do estado de apresenta√ß√£o no gancho ngOnChanges.  A detec√ß√£o de altera√ß√µes ser√° iniciada alterando @ Input-parameters.  Na demonstra√ß√£o, este √© o <a href="">readonly-info.component</a> . <br><br><pre> <code class="plaintext hljs">export class ReadOnlyInfoComponent implements OnChanges { @Input() public state: Backend.SomeEntityState; public traits: ReadonlyInfoTraits; public ngOnChanges(changes: { state: SimpleChange }): void { this.traits = new ReadonlyInfoTraits(changes.state.currentValue); } }</code> </pre><br>  Tudo √© extremamente simples, mas h√° um ponto que deve ser prestado aten√ß√£o. <br><br>  Se o estado de apresenta√ß√£o do componente for complexo e, especialmente, se alguns de seus campos forem calculados com base em outros, tamb√©m calculados pelos par√¢metros de Entrada, coloque o estado do componente em uma classe separada, torne-o imut√°vel e recrie ngOnChanges sempre que iniciar.  Em um projeto de demonstra√ß√£o, um exemplo √© a classe <a href="">ReadonlyInfoComponentTraits</a> .  Usando essa abordagem, voc√™ se protege da necessidade de sincronizar dados dependentes quando eles mudam. <br><br>  Ao mesmo tempo, vale a pena considerar: talvez o componente tenha um estado dif√≠cil devido ao fato de haver muita l√≥gica nele.  Um exemplo t√≠pico √© uma tentativa em um componente de ajustar representa√ß√µes para diferentes usu√°rios que t√™m maneiras muito diferentes de trabalhar com o sistema. <br><br><h4>  Eventos Nativos do Componente </h4><br>  Para comunica√ß√£o entre componentes de aplicativos, usamos eventos de sa√≠da.  Essa tamb√©m √© a terceira maneira de executar a detec√ß√£o de altera√ß√µes.  Angular pressup√µe razoavelmente que, se um componente gerar um evento, algo poder√° ter mudado em seu estado.  Portanto, o Angular escuta todos os eventos de sa√≠da do componente e aciona a detec√ß√£o de altera√ß√µes quando eles ocorrem. <br><br>  No projeto de demonstra√ß√£o, √© completamente sint√©tico, mas um exemplo √© o componente <a href="">submit-button.component</a> , que gera um evento <i>formSaved</i> .  O componente do cont√™iner se inscreve neste evento e exibe um alerta com uma notifica√ß√£o. <br><br>  Use os eventos de sa√≠da para a finalidade pretendida, ou seja, crie-os para comunica√ß√£o com os componentes-pai e n√£o para acionar a detec√ß√£o de altera√ß√µes.  Caso contr√°rio, √© prov√°vel que, depois de meses e anos, n√£o se lembre por que esse evento √© desnecess√°rio para ningu√©m aqui e o exclua, quebrando tudo. <br><br><h4>  Mudan√ßas nos componentes inteligentes </h4><br>  √Äs vezes, o estado de um componente √© determinado por uma l√≥gica complexa: chamar o servi√ßo de forma ass√≠ncrona, conectar-se a um soquete da Web, verifica a execu√ß√£o de setInterval, mas voc√™ nunca sabe o que mais.  Esses componentes s√£o chamados de componentes inteligentes. <br><br>  Em geral, quanto menos componentes inteligentes no aplicativo n√£o forem componentes de cont√™iner, mais f√°cil ser√° viver.  Mas √†s vezes voc√™ n√£o pode ficar sem eles. <br><br>  A maneira mais simples de associar o estado de um componente inteligente √† detec√ß√£o de altera√ß√µes √© transform√°-lo em um Observable e usar o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">canal ass√≠ncrono</a> j√° discutido acima.  Por exemplo, se a origem das altera√ß√µes for uma chamada de servi√ßo ou status de formul√°rio reativo, esse ser√° um Observable pronto.  Se o estado for formado a partir de algo mais complexo, voc√™ poder√° usar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">fromPromise</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">websocket</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">timer</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">interval</a> da composi√ß√£o do RxJS.  Ou gere um fluxo usando o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Assunto</a> . <br><br><h4>  Se nenhuma das op√ß√µes for adequada </h4><br>  Nos casos em que nenhum dos tr√™s m√©todos j√° estudados √© adequado, ainda temos uma op√ß√£o √† prova de balas - usando o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ChangeDetectorRef</a> diretamente.  Estamos falando dos m√©todos detectChanges e markForCheck dessa classe. <br><br>  A documenta√ß√£o abrangente responde a todas as perguntas, portanto, n√£o iremos nos concentrar no seu trabalho.  Mas observe que o uso de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ChangeDetectorRef</a> deve ser limitado aos casos em que voc√™ entende claramente o que est√° fazendo, pois ainda √© a cozinha Angular interna. <br><br>  Durante todo o tempo, encontramos apenas alguns casos em que esse m√©todo pode ser necess√°rio: <br><br><ol><li>  Trabalho manual com detec√ß√£o de altera√ß√µes - usado na implementa√ß√£o de componentes de baixo n√≠vel e √© apenas o caso "voc√™ entende claramente o que est√° fazendo". </li><li>  Relacionamentos complexos entre componentes - por exemplo, quando voc√™ precisa criar um link para um componente em um modelo e pass√°-lo como par√¢metro para outro componente localizado mais alto na hierarquia ou mesmo em outra ramifica√ß√£o da hierarquia de componentes.  Parece complicado?  Assim √©.  E √© melhor apenas refatorar esse c√≥digo, porque trar√° dor n√£o apenas com a detec√ß√£o de altera√ß√µes. </li><li>  As especificidades do comportamento do pr√≥prio Angular - por exemplo, ao implementar um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ControlValueAccessor</a> personalizado <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">,</a> voc√™ pode <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">descobrir</a> que o valor do controle √© alterado <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">pelo Angular de forma ass√≠ncrona</a> e as altera√ß√µes n√£o s√£o aplicadas ao ciclo de detec√ß√£o de altera√ß√µes desejado. </li></ol><br>  Como exemplos de uso no aplicativo de demonstra√ß√£o, existe a classe base <a href="">OnPushControlValueAccessor</a> , que resolve o problema descrito no √∫ltimo par√°grafo.  Tamb√©m no projeto, h√° um herdeiro dessa classe - custom <a href="">radio-button.component</a> . <br><br>  Agora, discutimos todas as quatro maneiras de executar as op√ß√µes de implementa√ß√£o de detec√ß√£o de altera√ß√µes e OnPush para todos os tr√™s tipos de componentes: cont√™iner, inteligente e de apresenta√ß√£o.  Passamos ao ponto final - editando dados com formas reativas. <br><br><a name="form"></a><h2>  Edi√ß√£o de dados encapsulados </h2><br>  As formas reativas t√™m v√°rias limita√ß√µes, mas ainda √© uma das melhores coisas que aconteceram no ecossistema Angular. <br><br>  Antes de tudo, eles encapsulam o trabalho bem com o estado e fornecem todas as ferramentas necess√°rias para responder √†s mudan√ßas de maneira reativa. <br><br>  De fato, a forma reativa √© um tipo de mini-loja que encapsula o trabalho com o estado: dados e status desativados / v√°lidos / pendentes. <br><br>  Resta apoiar esse encapsulamento o m√°ximo poss√≠vel e evitar misturar a l√≥gica de apresenta√ß√£o e a l√≥gica do formul√°rio. <br><br>  No aplicativo de demonstra√ß√£o, √© poss√≠vel ver <a href="">classes de formul√°rio individuais</a> que encapsulam as especificidades de seu trabalho: valida√ß√£o, cria√ß√£o de FormGroups filhos, trabalhando com o estado desabilitado dos campos de entrada. <br><br>  Criamos o formul√°rio raiz no componente do cont√™iner no momento em que o estado √© carregado e, a cada reinicializa√ß√£o do estado, o formul√°rio √© recriado.  Isso n√£o √© um pr√©-requisito, mas, dessa maneira, podemos ter certeza de que n√£o h√° efeitos acumulados na l√≥gica do formul√°rio que sobraram do estado carregado anterior. <br><br>  Dentro do pr√≥prio formul√°rio, constru√≠mos os controles e "empurramos" os dados que v√™m deles, convertendo-os do contrato do Estado para o contrato Modelo.  A estrutura dos formul√°rios, na medida do poss√≠vel, corresponde aos contratos dos modelos.  Como resultado, a propriedade value do formul√°rio fornece um modelo pronto para enviar para o back-end. <br><br>  Se, no futuro, a estrutura do estado ou do modelo for alterada, obteremos um erro de compila√ß√£o de texto datilografado exatamente no local em que precisamos adicionar / remover campos, o que √© muito conveniente. <br><br>  Al√©m disso, se os objetos de estado e modelo tiverem uma estrutura absolutamente id√™ntica, a digita√ß√£o estrutural usada no texto datilografado elimina a necessidade de criar um mapeamento sem sentido de um para o outro. <br><br>  A l√≥gica total de formul√°rios √© isolada da l√≥gica de apresenta√ß√£o nos componentes e vive ‚Äúpor si s√≥‚Äù, sem aumentar a complexidade do fluxo de dados de nosso aplicativo como um todo. <br><br>  Isso √© quase tudo.  Existem casos de borda deixados quando n√£o podemos isolar a l√≥gica do formul√°rio do restante do aplicativo: <br><br><ol><li>  Altera√ß√µes no formul√°rio que levam a uma altera√ß√£o no estado da apresenta√ß√£o - por exemplo, visibilidade de um bloco de dados, dependendo do valor digitado.  N√≥s o implementamos no componente assinando eventos de formul√°rio.  Voc√™ pode fazer isso atrav√©s das caracter√≠sticas imut√°veis ‚Äã‚Äãdiscutidas anteriormente. </li><li>  Se voc√™ precisar de um validador ass√≠ncrono que chame o back-end, constru√≠mos AsyncValidatorFn no componente e o passamos para o construtor de formul√°rios, n√£o para o servi√ßo. </li></ol><br>  Assim, toda a l√≥gica "lim√≠trofe" permanece no lugar mais proeminente - nos componentes. <br><br><h2>  Conclus√µes </h2><br>  Vamos resumir o que obtivemos e que outros pontos existem para estudo e desenvolvimento. <br><br>  Primeiro de tudo, o desenvolvimento da estrat√©gia OnPush nos obriga a projetar cuidadosamente o fluxo de dados do aplicativo, j√° que agora estamos ditando as regras do jogo para Angular, e n√£o para ele. <br><br>  Existem duas consequ√™ncias para esta situa√ß√£o. <br><br>  Em primeiro lugar, temos uma agrad√°vel sensa√ß√£o de controle sobre o aplicativo.  N√£o h√° mais m√°gica que "de alguma forma funcione".  Voc√™ est√° claramente ciente do que est√° acontecendo a qualquer momento no seu aplicativo.  A intui√ß√£o est√° se desenvolvendo gradualmente, o que permite que voc√™ entenda o motivo do bug encontrado, mesmo antes de abrir o c√≥digo. <br><br>  Em segundo lugar, agora temos que gastar mais tempo projetando o aplicativo, mas o resultado ser√° sempre o mais "direto" e, portanto, a solu√ß√£o mais simples.  Isso leva a zero a probabilidade de uma situa√ß√£o em que, √† medida que o aplicativo cresce, ele se torna um monstro de enorme complexidade, os desenvolvedores perderam o controle dessa complexidade e o desenvolvimento agora se parece mais com rituais m√≠sticos. <br><br>  A complexidade controlada e a aus√™ncia de "m√°gica" reduzem a probabilidade de toda uma classe de problemas decorrentes, por exemplo, de atualiza√ß√µes c√≠clicas de dados ou efeitos colaterais acumulados.  Em vez disso, estamos lidando com problemas j√° vis√≠veis durante o desenvolvimento, quando o aplicativo simplesmente n√£o funciona.  E, for√ßosamente, voc√™ precisa fazer com que o aplicativo funcione de forma simples e clara. <br><br>  Tamb√©m mencionamos bons efeitos no desempenho.  Agora, usando ferramentas muito simples, como <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">profiler.timeChangeDetection</a> , podemos verificar a qualquer momento que nosso aplicativo ainda est√° em boas condi√ß√µes. <br><br>  Agora tamb√©m √© pecado n√£o tentar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">desativar o NgZone</a> .  Primeiramente, permitir√° que voc√™ n√£o carregue toda a biblioteca na inicializa√ß√£o do aplicativo.  Em segundo lugar, ele remover√° uma quantidade razo√°vel de magia do seu aplicativo. <br><br>  √â a√≠ que terminamos nossa hist√≥ria. <br><br>  Entraremos em contato! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt426819/">https://habr.com/ru/post/pt426819/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt426809/index.html">Zeev Surasky: O futuro do mecanismo Zend e do Zend Framework</a></li>
<li><a href="../pt426811/index.html">Parkour, dan√ßa e constru√ß√£o de Boston Dynamics</a></li>
<li><a href="../pt426813/index.html">? O Skype se tornou uma apar√™ncia mon√≥tona ... e um produto que permite obter acesso total ao seu sistema? Existe alguma esperan√ßa?</a></li>
<li><a href="../pt426815/index.html">Como obter uma bolsa de desenvolvimento de projeto se voc√™ √© um estudante pobre? E vale a pena</a></li>
<li><a href="../pt426817/index.html">Chaves privadas e API Web do CommuniGate Pro</a></li>
<li><a href="../pt426821/index.html">Como organizar o CI / CD em um projeto: da configura√ß√£o de tarefas √† configura√ß√£o do pipeline de implanta√ß√£o</a></li>
<li><a href="../pt426825/index.html">Algumas dicas para freelancers</a></li>
<li><a href="../pt426831/index.html">Conversa desagrad√°vel, herpetologista e completa surpresa</a></li>
<li><a href="../pt426835/index.html">An√°lise comparativa e detalhada de plug-ins de cache para WordPress</a></li>
<li><a href="../pt426837/index.html">Transmiss√£o de v√≠deo em seu site que funciona</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>