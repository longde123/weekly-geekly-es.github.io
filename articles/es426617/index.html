<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üåô üõ∑ üóëÔ∏è Licencia para conducir un autom√≥vil, o por qu√© las aplicaciones deben ser de actividad √∫nica üêä üë©üèø‚Äçü§ù‚Äçüë©üèº üë®üèø‚Äçüöí</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En AppsConf 2018 , que tuvo lugar del 8 al 9 de octubre, hice una presentaci√≥n sobre la creaci√≥n de aplicaciones de Android completamente en una Activ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Licencia para conducir un autom√≥vil, o por qu√© las aplicaciones deben ser de actividad √∫nica</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/redmadrobot/blog/426617/"><p><img src="https://habrastorage.org/webt/n0/m4/p4/n0m4p4tyrh-7bky85jet7jyzllc.png" alt="imagen"></p><br><p>  En <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">AppsConf 2018</a> , que tuvo lugar del 8 al 9 de octubre, hice una presentaci√≥n sobre la creaci√≥n de aplicaciones de Android completamente en una Actividad.  Aunque el tema es bien conocido, existen muchos prejuicios con respecto a esa elecci√≥n: la sala abarrotada y la cantidad de preguntas despu√©s del discurso lo confirman.  Para no esperar la grabaci√≥n del video, decid√≠ hacer un art√≠culo con una transcripci√≥n del discurso. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/1b8/c2d/a29/1b8c2da294869720e98d50d529300817.jpg"></p><br><p>  Lo que voy a decir </p><br><ol><li>  Por qu√© y por qu√© deber√≠a cambiar a Actividad √∫nica </li><li>  Un enfoque universal para resolver tareas que est√° acostumbrado a resolver en varias actividades </li><li>  Ejemplos de tareas comerciales est√°ndar </li><li>  Cuellos de botella donde el c√≥digo generalmente est√° apuntalado en lugar de hacer todo honestamente </li></ol><a name="habracut"></a><br><h2 id="pochemu-single-activity---eto-pravilno">  ¬øPor qu√© es correcta la actividad individual? </h2><br><h4 id="zhiznennyy-cikl">  Ciclo de vida </h4><br><p><img src="https://habrastorage.org/webt/6i/k8/fk/6ik8fkusqlvahretkm_yqfhfgg8.png"></p><br><p>  Todos los desarrolladores de Android conocen el esquema de arranque en fr√≠o de la aplicaci√≥n.  Primero, se llama a onCreate en la clase Aplicaci√≥n, luego el ciclo de vida de la primera Actividad entra en acci√≥n. <br>  Si hay varias actividades en nuestra aplicaci√≥n (y hay una mayor√≠a de tales aplicaciones), sucede lo siguiente: </p><br><pre><code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">App</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.onCreate</span></span>() <span class="hljs-selector-tag"><span class="hljs-selector-tag">ActivityA</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.onCreate</span></span>() <span class="hljs-selector-tag"><span class="hljs-selector-tag">ActivityA</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.onStart</span></span>() <span class="hljs-selector-tag"><span class="hljs-selector-tag">ActivityA</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.onResume</span></span>() <span class="hljs-selector-tag"><span class="hljs-selector-tag">ActivityA</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.onPause</span></span>() <span class="hljs-selector-tag"><span class="hljs-selector-tag">ActivityB</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.onCreate</span></span>() <span class="hljs-selector-tag"><span class="hljs-selector-tag">ActivityB</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.onStart</span></span>() <span class="hljs-selector-tag"><span class="hljs-selector-tag">ActivityB</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.onResume</span></span>() <span class="hljs-selector-tag"><span class="hljs-selector-tag">ActivityA</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.onStop</span></span>()</code> </pre> <br><p>  Este es el registro de inicio abstracto de la actividad B de la Actividad A.  Una l√≠nea vac√≠a es el momento en que se llam√≥ al lanzamiento de una nueva pantalla.  A primera vista, todo est√° bien.  Pero si volvemos a la documentaci√≥n, quedar√° claro: para garantizar que la pantalla sea visible para el usuario y que pueda interactuar con ella, es posible solo despu√©s de llamar al <code>onResume</code> en cada pantalla: </p><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">App</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.onCreate</span></span>() <span class="hljs-selector-tag"><span class="hljs-selector-tag">ActivityA</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.onCreate</span></span>() <span class="hljs-selector-tag"><span class="hljs-selector-tag">ActivityA</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.onStart</span></span>() <span class="hljs-selector-tag"><span class="hljs-selector-tag">ActivityA</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.onResume</span></span>() &lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">--------</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ActivityA</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.onPause</span></span>() <span class="hljs-selector-tag"><span class="hljs-selector-tag">ActivityB</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.onCreate</span></span>() <span class="hljs-selector-tag"><span class="hljs-selector-tag">ActivityB</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.onStart</span></span>() <span class="hljs-selector-tag"><span class="hljs-selector-tag">ActivityB</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.onResume</span></span>() &lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">--------</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ActivityA</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.onStop</span></span>()</code> </pre> <br><p>  El problema es que dicho registro no ayuda a comprender el ciclo de vida de la aplicaci√≥n.  Cuando el usuario todav√≠a est√° adentro, y cuando ya ha cambiado a otra aplicaci√≥n o ha minimizado la nuestra, etc.  Y esto es necesario <strong>cuando queremos vincular la l√≥gica empresarial a la LC de la aplicaci√≥n, por ejemplo, mantener una conexi√≥n de socket mientras el usuario est√° en la aplicaci√≥n y cerrarla al salir</strong> </p><br><p>  En una aplicaci√≥n Single-Activity, todo es simple: LC Activity se convierte en una aplicaci√≥n LC.  Todo lo que necesita para cualquier l√≥gica es f√°cil de vincular al estado de la aplicaci√≥n. </p><br><h4 id="zapusk-ekranov">  Pantallas de inicio </h4><br><p>  Como usuario, a menudo me encontr√© con el hecho de que no se produce una llamada de la gu√≠a telef√≥nica (y esto es claramente el lanzamiento de una Actividad separada) despu√©s de hacer clic en un contacto.  No est√° claro con qu√© est√° relacionado esto, pero aquellos a quienes intent√© comunicar sin √©xito dijeron que recibieron la llamada y escucharon el sonido de los pasos.  Al mismo tiempo, mi tel√©fono inteligente ha estado en mi bolsillo durante mucho tiempo. </p><br><p><img src="https://habrastorage.org/webt/iq/u5/kx/iqu5kxfhylvhmqh5wzuwvqpztzi.png"></p><br><p>  ¬°El problema es que comenzar una Actividad es un proceso completamente as√≠ncrono!  No hay garant√≠a de arranque instant√°neo y, lo que es peor, no podemos controlar el proceso.  Absolutamente </p><br><p>  En la aplicaci√≥n Single-Activity, trabajando con el administrador de fragmentos, podemos controlar el proceso. <br>  <code>transaction.commit()</code> : cambiar√° las pantallas de forma asincr√≥nica, lo que le permite abrir o cerrar varias pantallas a la vez. <br>  <code>transaction.commitNow()</code> : cambia la pantalla sincr√≥nicamente si no es necesario agregarla a la pila. <br>  fragmentManager.executePendingTransactions () `le permite ejecutar todas las transacciones iniciadas anteriormente en este momento. </p><br><h4 id="analiz-steka-ekranov">  An√°lisis de pila de pantalla </h4><br><p>  Imagine que la l√≥gica empresarial de su aplicaci√≥n depende de la profundidad actual de la pila de pantallas (por ejemplo, restricciones de anidamiento).  O, al final de alg√∫n proceso, debe volver a una pantalla determinada, y si hay varias id√©nticas, a la m√°s cercana a la ra√≠z (el comienzo de la cadena). <br>  ¬øC√≥mo obtener una pila de actividades?  ¬øQu√© par√°metros deben especificarse al iniciar la pantalla? </p><br><p><img src="https://habrastorage.org/webt/pk/bz/5h/pkbz5hhcjv_gqiyirr7ab5e27h8.png"></p><br><p>  Por cierto, sobre la magia de las opciones de lanzamiento de Activity: </p><br><ul><li>  puede especificar indicadores de inicio en Intenci√≥n (y tambi√©n mezclarlos y cambiarlos desde diferentes lugares); </li><li>  puede agregar par√°metros de inicio en el manifiesto, porque toda la Actividad debe describirse all√≠; </li><li>  agregue filtros de intenci√≥n aqu√≠ para manejar la activaci√≥n externa; </li><li>  y finalmente piense en MultiTasks, cuando las Actividades pueden ejecutarse en diferentes "tareas". </li></ul><br><p>  Juntos, esto crea confusi√≥n y problemas con la depuraci√≥n de soporte.  Nunca se puede decir con certeza exactamente c√≥mo se lanz√≥ la pantalla y c√≥mo afect√≥ a la pila. </p><br><p>  En una aplicaci√≥n de actividad √∫nica, todas las pantallas cambian solo a trav√©s de transacciones fragmentarias.  Puede analizar la pila actual de pantallas y transacciones guardadas. <br>  En la demostraci√≥n de la biblioteca <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Cicerone</a> , puede ver c√≥mo se muestra el estado actual de la pila en la barra de herramientas. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/45f/285/af2/45f285af219d69df32d0994db1eeb58d.gif" alt="imagen"></p><br><p>  <em>Nota:</em> en la √∫ltima versi√≥n, las bibliotecas de soporte bloquearon el acceso a la matriz de fragmentos dentro del administrador de fragmentos, pero si realmente lo desea, este problema siempre se puede resolver. </p><br><h4 id="activity-tolko-odna-na-ekrane">  Solo una actividad en pantalla </h4><br><p>  En aplicaciones reales, definitivamente necesitaremos combinar pantallas "l√≥gicas" en una Actividad, entonces no puede escribir una aplicaci√≥n real SOLAMENTE en Actividad.  La dualidad del enfoque siempre es mala, ya que el mismo problema se puede resolver de diferentes maneras (en alg√∫n lugar, el dise√±o est√° directamente en la Actividad, y en alg√∫n lugar, la Actividad es solo un contenedor). </p><br><h4 id="dont-keep-activities">  No guardes actividades </h4><br><p>  Este indicador de prueba realmente le permite encontrar algunos errores en la aplicaci√≥n, ¬°pero el comportamiento que reproduce <strong>NUNCA</strong> ocurre en realidad!  ¬°No sucede que el proceso de solicitud permanezca, y en ese momento la Actividad, aunque no est√° activa, muere!  Las actividades solo pueden morir con el proceso de solicitud.  Si la aplicaci√≥n se muestra al usuario y el sistema no tiene suficientes recursos, todo lo que est√© a su alrededor morir√° (otras aplicaciones inactivas, servicios e incluso el iniciador), y su aplicaci√≥n vivir√° hasta el final, y si tiene que morir, entonces ser√° completamente. <br>  Puedes comprobarlo. </p><br><h4 id="nasledie">  Legado </h4><br><p>  Hist√≥ricamente, hay una gran cantidad de l√≥gica innecesaria en Activity que probablemente no sea √∫til para usted.  Por ejemplo, todo lo que necesita para trabajar con <code>loaders</code> , <code>actionBar</code> , <code>action menu</code> etc.  Esto hace que la clase en s√≠ sea bastante masiva y pesada. </p><br><h4 id="animacii">  Animaciones </h4><br><p>  Quiz√°s, cualquiera puede hacer una animaci√≥n de cambio simple al cambiar entre Actividad.  Aqu√≠ vale la pena aclarar que necesita hacer un descuento en la asincron√≠a del lanzamiento de la Actividad, del que hablamos anteriormente. <br>  Si necesita algo m√°s interesante, puede recordar ejemplos de animaciones de transici√≥n que se realizan en la Actividad: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/62f/b33/b28/62fb33b285f8eb80ff856c813e278552.gif" alt="imagen"></p><br><p>  Pero hay un gran problema: personalizar esta animaci√≥n es casi imposible.  Es poco probable que esto complazca a los dise√±adores y al cliente. </p><br><p>  Con fragmentos, todo es diferente.  ¬°Podemos ir directamente al nivel de la jerarqu√≠a de la vista y hacer cualquier animaci√≥n que pueda imaginar!  Evidencia directa <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> : </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/446/23f/e72/44623fe72553a5f7ba0b0074c45109eb.gif" alt="imagen"></p><br><p>  Si observa el c√≥digo fuente, encontrar√° que esto se hace en un dise√±o regular.  S√≠, el c√≥digo es decente all√≠, pero la animaci√≥n siempre es lo suficientemente dif√≠cil, y tener esa oportunidad siempre es una ventaja.  Si tiene dos Actividades conmutadas, la aplicaci√≥n no tiene un contenedor com√∫n donde pueda realizar tales transiciones. </p><br><h4 id="izmenenie-konfiguracii-naletu">  Configurar configuraci√≥n sobre la marcha </h4><br><p>  Este punto no estaba en mi discurso, pero tambi√©n es muy importante.  Si tiene una funci√≥n para cambiar el idioma dentro de la aplicaci√≥n, con varias actividades ser√° bastante problem√°tico implementarla, si, entre otras cosas, no necesita reiniciar la aplicaci√≥n, sino permanecer en el mismo lugar donde estaba el usuario al momento de llamar a la funcionalidad. </p><br><p>  En una aplicaci√≥n de Actividad √∫nica, es suficiente cambiar la configuraci√≥n regional instalada en el contexto de la aplicaci√≥n y llamar a <code>recreate()</code> en la Actividad, el resto del sistema har√° todo por s√≠ mismo. </p><br><h4 id="naposledok">  Al final </h4><br><p>  Google tiene una soluci√≥n de navegaci√≥n, cuya documentaci√≥n <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">establece expl√≠citamente</a> que es aconsejable escribir aplicaciones de actividad √∫nica. </p><br><p>  En este punto, espero que no tenga dudas de que el enfoque cl√°sico con varias actividades contiene una serie de deficiencias, que es habitual hacer la vista gorda, escondi√©ndose detr√°s de la tendencia general del descontento de Android. </p><br><h2 id="esli-vse-tak-to-pochemu-single-activity-esche-ne-standart-razrabotki">  Si es as√≠, ¬øpor qu√© Single-Activity todav√≠a no es un est√°ndar de desarrollo? </h2><br><p>  Aqu√≠ citar√© a mi buen amigo: </p><br><p><img src="https://habrastorage.org/webt/z_/k_/ou/z_k_outvwlcibszeamtv2jhjst0.png"></p><br><p>  Al comenzar un nuevo proyecto serio, cualquier l√≠der tiene miedo de equivocarse y evita decisiones arriesgadas.  Esto es correcto  Pero tratar√© de proporcionar un plan integral para la transici√≥n a una sola actividad. </p><br><h4 id="perehod-na-single-activity">  Cambiar a una sola actividad </h4><br><p><img src="https://habrastorage.org/webt/vf/sw/8h/vfsw8hvr_sfcjs3olaxb3s2lptw.png"></p><br><p>  Si estudia esta aplicaci√≥n, puede determinar a partir de las animaciones y el comportamiento caracter√≠sticos que est√° escrita en varias Actividades.  Podr√≠a estar equivocado, y todo se hizo incluso en vistas personalizadas, pero esto no afectar√° nuestro razonamiento. </p><br><p>  Ahora atencion!  Lo hacemos as√≠: </p><br><p><img src="https://habrastorage.org/webt/0v/dt/cm/0vdtcmkom7y0jt0osv3fj61wn4k.png"></p><br><p>  Solo realizamos dos cambios: agregamos la clase AppActivity y reemplazamos toda la Actividad con FlowFragment.  Considere cada cambio con m√°s detalle. </p><br><p>  De qu√© <strong>AppActivity</strong> es responsable: </p><br><ul><li>  contiene solo un contenedor para fragmentos <br><ul><li>  es el punto de inicializaci√≥n de los objetos de UI de Scope (sol√≠a hacerse en la aplicaci√≥n, lo cual es incorrecto, porque, por ejemplo, los objetos de servicio en nuestra aplicaci√≥n definitivamente no necesitan tales objetos) </li><li>  es un proveedor de aplicaciones </li><li>  trae todos los beneficios de Single-Activity. </li></ul></li></ul><br><p>  ¬øQu√© es <strong>FlowFragment</strong> ? </p><br><ul><li>  hace exactamente lo mismo que la Actividad, en lugar de la que se cre√≥. </li></ul><br><h4 id="novaya-navigaciya">  Nueva navegaci√≥n </h4><br><p>  La principal diferencia con el viejo enfoque es la navegaci√≥n. </p><br><p><img src="https://habrastorage.org/webt/6c/xe/xm/6cxexm9iv1rxz4p9ag1hov7jb90.png"></p><br><p>  Anteriormente, el desarrollador ten√≠a una opci√≥n: lanzar una nueva Actividad o una transacci√≥n fragmentaria en la actual.  La elecci√≥n no ha desaparecido, pero los m√©todos han cambiado: ahora debemos decidir si iniciar la fragmentaci√≥n del fragmento en AppActivity o dentro del FlowFragment actual. </p><br><p><img src="https://habrastorage.org/webt/am/cq/ac/amcqacvs343ah96hpnaykgnixtw.png"></p><br><p>  Del mismo modo con el procesamiento del bot√≥n Atr√°s.  Anteriormente, la Actividad pasaba el evento al fragmento actual y, si no lo procesaba, tomaba la decisi√≥n en s√≠.  Ahora AppActivity pasa el evento al FlowFragment actual y, a su vez, lo pasa al fragmento actual. </p><br><h4 id="peredacha-rezultata-mezhdu-ekranami">  Transferencia de resultados entre pantallas </h4><br><p>  Para los desarrolladores sin experiencia, el problema de la transferencia de datos entre pantallas es el principal problema del nuevo enfoque, porque antes era posible usar la funcionalidad startActivityForResult (). </p><br><p>  No es el primer a√±o, se han discutido varios enfoques arquitect√≥nicos para aplicaciones de escritura.  La tarea principal al mismo tiempo sigue siendo la separaci√≥n de la interfaz de usuario y la capa de datos y la l√≥gica empresarial.  Desde este punto de vista, startActivityForResult () rompe el canon, ya que los datos entre las pantallas de <strong>una</strong> aplicaci√≥n se transfieren en el lado de la entidad de la capa UI.  Destaco que es solo <strong>una</strong> aplicaci√≥n, ya que tenemos una capa de datos com√∫n, modelos comunes en un √°mbito global, etc.  No usamos estas oportunidades y nos metemos en el marco de un paquete (serializaci√≥n, tama√±o y m√°s). <br>  <strong>Mi consejo</strong> : ¬°no uses startActivityForResult () dentro de la aplicaci√≥n!  √öselo solo para el prop√≥sito previsto: ejecutar aplicaciones externas y obtener resultados de ellas. </p><br><p>  ¬øC√≥mo, entonces, abrir una pantalla con una opci√≥n para otra pantalla?  Hay tres opciones: </p><br><ol><li>  Fragmento objetivo </li><li>  Eventbus </li><li>  modelo jet </li></ol><br><p>  TargetFragment: una opci√≥n "lista para usar", pero la misma transferencia de datos en el lado de la capa de interfaz de usuario.  <strong>Mala opci√≥n</strong> </p><br><p>  EventBus: si puede ponerse de acuerdo sobre un equipo y, lo que es m√°s importante, controlar los arreglos, puede implementar la transferencia de datos entre pantallas en el bus de datos global.  Pero dado que este es un movimiento peligroso, la conclusi√≥n es una <strong>mala opci√≥n.</strong> </p><br><p>  Modelo reactivo: este enfoque implica la presencia de devoluciones de llamada y m√°s.  El equipo de cada proyecto decide c√≥mo implementarlos.  Pero este enfoque es √≥ptimo, ya que proporciona control sobre lo que est√° sucediendo y no permite que el c√≥digo se use para otros fines.  <strong>Nuestra eleccion!</strong> </p><br><h4 id="itog">  Resumen </h4><br><p>  Me encantan los nuevos enfoques cuando son simples y tienen beneficios obvios.  Espero que este sea el caso en este caso.  Los beneficios se describen en la primera parte, y debe juzgar la dificultad.  Es suficiente reemplazar toda la Actividad con FlowFragment, manteniendo toda la l√≥gica sin cambios.  Cambie un poco el c√≥digo de navegaci√≥n y piense en trabajar con la transferencia de datos entre pantallas, si a√∫n no lo ha hecho. </p><br><p>  Para mostrar la simplicidad del enfoque, yo mismo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">cambi√© la aplicaci√≥n abierta</a> a Single-Activity, y me tom√≥ solo unas pocas horas (por supuesto, vale la pena considerar que este no es un legado antiguo, y todo es m√°s o menos bueno con la arquitectura all√≠). </p><br><h2 id="chto-poluchilos">  Que paso </h2><br><p>  Veamos c√≥mo resolver problemas est√°ndar en un nuevo enfoque. </p><br><h4 id="bottomnavigationbar-i-navigationdrawer">  BottomNavigationBar and NavigationDrawer </h4><br><p>  Usando la regla simple de que reemplazamos toda Actividad con FlowFragment, el men√∫ lateral ahora estar√° en alg√∫n fragmento y cambiar√° fragmentos anidados en √©l: </p><br><p><img src="https://habrastorage.org/webt/hp/dv/u9/hpdvu9gp85_zzzt2qi23ndafrxw.png"></p><br><p>  Similar con BottomNavigationBar. <br>  ¬°Es mucho m√°s interesante que podamos invertir algunos FlowFragment en otros, ya que estos todav√≠a son fragmentos ordinarios! </p><br><p><img src="https://habrastorage.org/webt/vk/qo/2r/vkqo2rovrabjb_2qorv-ot6leie.png"></p><br><p>  Esta opci√≥n se puede encontrar en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">GitFox</a> . </p><br><p>  Es la posibilidad de combinar simplemente algunos fragmentos dentro de otros lo que hace posible crear una interfaz de usuario din√°mica para diferentes dispositivos sin ning√∫n problema: tabletas + tel√©fonos inteligentes. </p><br><h4 id="di-skoupy">  Alcances DI </h4><br><p>  Si tiene un flujo de compras de productos desde varias pantallas, y necesita mostrar el nombre del producto en cada pantalla, probablemente ya lo haya colocado en una Actividad separada que almacena el producto y lo proporciona a las pantallas. <br>  Ser√° lo mismo con FlowFragment: contendr√° una escala DI con modelos para todas las pantallas anidadas.  Este enfoque elimina el complicado control de la vida √∫til del osciloscopio al vincularlo con la vida √∫til del FlowFragment. </p><br><p><img src="https://habrastorage.org/webt/jg/o7/fc/jgo7fcldgytixv_pi4rd4vv9ynw.png"></p><br><h4 id="deep-links">  Enlaces profundos </h4><br><p>  Si utiliz√≥ filtros en el manifiesto para iniciar una pantalla espec√≠fica en el enlace profundo, es posible que tenga problemas para iniciar la Actividad, sobre la que escrib√≠ en la primera parte.  En el nuevo enfoque, todos los enlaces profundos caen en AppActivity.onNewIntent.  Adem√°s, de acuerdo con los datos obtenidos, hay una transici√≥n a la pantalla requerida (o una cadena de pantallas. Propongo analizar dicha <a href="">funcionalidad en Chicheron</a> ). </p><br><p><img src="https://habrastorage.org/webt/hg/hv/dz/hghvdzuz1kp_zaj_mqqxwgbbmk0.png"></p><br><h4 id="smert-processa">  Proceso de muerte </h4><br><p>  Si la aplicaci√≥n est√° escrita en varias Actividades, debe saber que cuando la aplicaci√≥n muera, y luego cuando se restaure el proceso, el usuario estar√° en la √∫ltima Actividad, y todas las anteriores se restaurar√°n solo cuando se les devuelva. </p><br><p><img src="https://habrastorage.org/webt/za/39/ws/za39wsenkveryhdk21ngp0w-hyq.png"></p><br><p>  Si no tiene esto en cuenta de antemano, pueden surgir problemas.  Por ejemplo, si el alcance necesario en la √∫ltima Actividad abierta en la anterior, nadie lo volver√° a crear.  Que hacer  ¬øTraer esto a la clase de aplicaci√≥n?  ¬øLos puntos m√∫ltiples abren √°mbitos? </p><br><p>  Todo es m√°s simple con fragmentos, ya que est√°n dentro de una Actividad u otro FlowFragment, y cualquier contenedor se restaurar√° ANTES de volver a crear el fragmento. </p><br><p><img src="https://habrastorage.org/webt/8p/vd/q5/8pvdq5nmwbgjbfi6am26nzotpnq.png"></p><br><p>  Podemos discutir otras tareas pr√°cticas en los comentarios, ya que de lo contrario existe la posibilidad de que el art√≠culo resulte demasiado voluminoso. </p><br><p>  Y ahora la parte m√°s interesante. </p><br><h2 id="uzkie-mesta-nado-pomnit-i-dumat">  Cuellos de botella (necesita recordar y pensar). </h2><br><p>  Aqu√≠ se recopilan cosas importantes en las que debe pensar en cualquier proyecto, pero todos est√°n tan acostumbrados a "desgarrarlos" en proyectos en varias Actividades que vale la pena recordar y decir c√≥mo resolverlos correctamente en el nuevo enfoque.  Y primero en la lista </p><br><h4 id="povorot-ekrana">  Rotaci√≥n de la pantalla </h4><br><p>  Esa es la <u>historia</u> m√°s <u>terrible</u> para los fan√°ticos llorones de que Android recrea la Actividad cuando se gira la pantalla.  El m√©todo de soluci√≥n m√°s popular es arreglar la orientaci√≥n vertical.  Adem√°s, esta propuesta ya no es hecha por desarrolladores, sino por gerentes asustados por frases como " <em>mantener un giro es muy dif√≠cil y cuesta varias veces m√°s</em> ". <br>  No discutiremos sobre la exactitud de tal decisi√≥n.  Otra cosa es importante: ¬° <strong>arreglar la rotaci√≥n no est√° exento de la muerte de Activity!</strong>  Dado que los mismos procesos ocurren con muchos otros eventos: modo dividido, cuando se muestran varias aplicaciones en la pantalla, conectando un monitor externo, cambiando la configuraci√≥n de la aplicaci√≥n sobre la marcha, etc. </p><br><p>  Adem√°s, la rotaci√≥n de la pantalla le permite verificar la correcta "elasticidad" del dise√±o, por lo tanto, en nuestro equipo de San Petersburgo, no desactivamos la rotaci√≥n en todos los ensambles de ventas, incluso si no est√° en la versi√≥n de lanzamiento.  Sin mencionar los errores t√≠picos que a√∫n se encontrar√°n durante la verificaci√≥n. </p><br><p>  Ya se han escrito muchas soluciones para convertir, comenzando desde <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Moxy</a> y terminando con varias implementaciones de MVVM.  No lo hagas m√°s dif√≠cil que cualquier otra cosa. </p><br><p>  Considere otro caso interesante. <br>  Imagine una aplicaci√≥n de cat√°logo de productos.  Lo hacemos en una sola actividad.  En todas partes, el modo de retrato es fijo, pero el cliente quiere una funci√≥n cuando, al ver la galer√≠a de fotos, el usuario puede verlos en orientaci√≥n horizontal.  ¬øC√≥mo apoyar esto? </p><br><p>  Alguien ofrecer√° la <strong>primera muleta</strong> : </p><br><pre> <code class="hljs pgsql">&lt;activity android:<span class="hljs-type"><span class="hljs-type">name</span></span>=".AppActivity" android:configChanges="orientation" /&gt;</code> </pre> <br><pre> <code class="hljs kotlin"><span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onConfigurationChanged</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(newConfig: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Configuration</span></span></span></span><span class="hljs-function"><span class="hljs-params">?)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (newConfig?.orientation == Configuration.ORIENTATION_LANDSCAPE) { <span class="hljs-comment"><span class="hljs-comment">//ignore } else { super.onConfigurationChanged(newConfig) } }</span></span></code> </pre> <br><p>  Por lo tanto, no podemos llamar a <code>super.onConfigurationChanged(newConfig)</code> , sino procesarlo nosotros mismos y rotar solo la vista necesaria en la pantalla. <br>  Pero con API 23, el proyecto se bloquear√° con una <code>SuperNotCalledException</code> , por lo que es una <strong>mala elecci√≥n</strong> . </p><br><p>  <strong>Las declaraciones anteriores cometieron un error:</strong> <br>  Me corrigieron razonablemente en los comentarios que agregar android: configChanges = "orientaci√≥n | tama√±o de pantalla" es suficiente, y luego puede llamar a super y la actividad no se volver√° a crear en la rotaci√≥n.  Es √∫til usarlo cuando hay un WebView o un mapa en la pantalla que lleva mucho tiempo inicializar, y desea evitar esto. <br>  Esto ayudar√° a resolver el caso descrito con la galer√≠a, pero el mensaje principal de esta secci√≥n: <u>no ignore la recreaci√≥n de la Actividad</u> , esto puede suceder en muchos otros casos. </p><br><p>  Alguien podr√≠a sugerir otra soluci√≥n: </p><br><pre> <code class="hljs pgsql">&lt;activity android:<span class="hljs-type"><span class="hljs-type">name</span></span>=".AppActivity" android:screenOrientation="portrait" /&gt; &lt;activity android:<span class="hljs-type"><span class="hljs-type">name</span></span>=".RotateActivity" /&gt;</code> </pre> <br><p>  Pero de esta manera nos alejamos del enfoque de Actividad √önica para resolver un problema simple y privarnos de todos los beneficios del enfoque.  Esta es una muleta, y una muleta siempre es una <strong>mala elecci√≥n</strong> . </p><br><p>  Aqu√≠ est√° la soluci√≥n correcta: </p><br><pre> <code class="hljs pgsql">&lt;activity android:<span class="hljs-type"><span class="hljs-type">name</span></span>=".AppActivity" android:configChanges="orientation" /&gt;</code> </pre> <br><pre> <code class="hljs kotlin"><span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onResume</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onResume() activity?.requestedOrientation = ActivityInfo.SCREEN_ORIENTATION_SENSOR } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onPause</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onPause() activity?.requestedOrientation = ActivityInfo.SCREEN_ORIENTATION_PORTRAIT }</code> </pre> <br><p>  Es decir, cuando se abre el fragmento, la aplicaci√≥n comienza a "girar" y, cuando regresa, se repara nuevamente.  En mi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">experiencia,</a> as√≠ es como funciona la aplicaci√≥n <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">AirBnB</a> .  Si abre una vista de fotos de la vivienda, se activa el procesamiento de giro, pero en orientaci√≥n horizontal, puede arrastrar la foto hacia abajo para salir de la galer√≠a.  Debajo, la pantalla anterior ser√° visible en orientaci√≥n horizontal, lo que generalmente no encontrar√°, ya que inmediatamente despu√©s de salir de la galer√≠a la pantalla se convertir√° en un retrato y se reparar√°. </p><br><p><img src="https://habrastorage.org/webt/to/wt/kj/towtkjtucdgw_d2s5da7b2awzkm.png"></p><br><p>  Aqu√≠ es donde ayudar√° la preparaci√≥n oportuna para los giros de pantalla. </p><br><h4 id="transparent-status-bar">  Barra de estado transparente </h4><br><p>  Solo Activity puede funcionar con la barra del sistema, pero ahora solo tenemos una, por lo que siempre debe especificar </p><br><pre> <code class="hljs pgsql">&lt;item <span class="hljs-type"><span class="hljs-type">name</span></span>="android:windowTranslucentStatus"&gt;<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>&lt;/item&gt;</code> </pre> <br><p>  Pero en algunas pantallas no hay necesidad de "arrastrarse" debajo, y debe mostrar todo el contenido a continuaci√≥n.  La bandera viene al rescate </p><br><pre> <code class="hljs objectivec">android:fitsSystemWindows=<span class="hljs-string"><span class="hljs-string">"true"</span></span></code> </pre> <br><p>  que indica el dise√±o que no debe dibujar debajo de la barra del sistema.  Pero si lo especifica en el dise√±o del fragmento y luego intenta mostrar el fragmento a trav√©s de la transacci√≥n en el administrador de fragmentos, se sentir√° decepcionado ... ¬°no funcionar√°! <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">La respuesta es r√°pidamente google</a> <br>  Le recomiendo que se familiarice con una respuesta realmente completa y muchos enlaces √∫tiles. <br>  Una soluci√≥n r√°pida y funcional ( <em>pero no la correcta</em> ) es ajustar el dise√±o en <code>CoordinatorLayout</code> </p><br><pre> <code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">android.support.design.widget.CoordinatorLayout</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:android</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:app</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res-auto"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:fitsSystemWindows</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">android.support.design.widget.CoordinatorLayout</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Una mejor soluci√≥n ayuda a procesar el teclado tambi√©n. </p><br><h4 id="izmenenie-verstki-pri-poyavlenii-klaviatury">  Cambiar el dise√±o cuando aparece el teclado </h4><br><p>  Cuando el teclado se va, el dise√±o debe cambiar para que elementos importantes de la interfaz de usuario no queden fuera del alcance.  Y si antes pod√≠amos especificar diferentes modos de reacci√≥n para el teclado para diferentes actividades, ahora tenemos que hacer esto en Single-Activity.  Por lo tanto, es necesario usar </p><br><pre> <code class="hljs objectivec">android:windowSoftInputMode=<span class="hljs-string"><span class="hljs-string">"adjustResize"</span></span></code> </pre> <br><p>  Si utiliza el enfoque de la secci√≥n anterior para procesar una barra de estado transparente, encontrar√° un desafortunado error: si un fragmento se arrastr√≥ con √©xito debajo de la barra de estado, cuando aparezca el teclado, se encoger√° arriba y abajo, a medida que la barra de estado y el teclado dentro del sistema funcionan <code>SystemWindows</code> . </p><br><p>  Presta atenci√≥n al t√≠tulo. </p><br><p><img src="https://habrastorage.org/webt/vr/ay/xo/vrayxosszrpgfsq-eyia_z4hshi.gif"></p><br><p>  Que hacer  ¬°Lee la documentaci√≥n!     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Chris Banes  WindowInsets</a> . </p><br><p>  WindowInsets  </p><br><ul><li>      (   51dp) </li><li>          </li><li>    ( !) </li><li>       . </li></ul><br><p> <strong>  WindowInsets!</strong> </p><br><h4 id="splash-screen"> Splash screen </h4><br><p>  -    ,   Splash screen ‚Äî      ,   ,  ,     ,   Activity   .   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a>   . </p><br><p><img src="https://habrastorage.org/webt/fs/nd/nt/fsndntzk-erl-iebzisfiiftsfc.png"></p><br><p>    ,   Single-Activity,    Splash screen.     ,     deep-link      Splash screen     . </p><br><h4 id="zapusk-vashego-prilozheniya-iz-drugih-prilozheniy">       </h4><br><p>  <strong>    </strong> ,    ,      ,    . </p><br><p> ,       .    Single-Activity.    -         ,   ,    . <br>                 ... <br>  Intent,   ,        ... <br>  Que sigue   : </p><br><ul><li>    ,       ¬´¬ª.    ¬´¬ª,    .    ,   ! </li><li>      ,    ‚Ä¶ </li></ul><br><p>      ,     .           ?     ‚Äî           ¬´¬ª   ¬´¬ª   . </p><br><p>  Que hacer  ,    . </p><br><p>    Activity! <br> ,    :       ,   ‚Äî        . <br>       ‚Äî ,      (   Activity),    . </p><br><p>  Activity ‚Äî       .      Activity,         .     . </p><br><p><img src="https://habrastorage.org/webt/hj/cs/wd/hjcswdrykm21jtyzupyongbe494.png"></p><br><h2 id="zaklyuchenie">  Conclusi√≥n </h2><br><p>    ()   ,        Activity,        Android-.         ,             . </p><br><p>    :     Google       .        ‚Äî      ,   ,    Activity     . </p><br><p> ,    ,      ,        !  Gracias </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es426617/">https://habr.com/ru/post/es426617/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es426605/index.html">An√°lisis est√°tico de c√≥digo PHP usando PHPStan, Phan y Psalm como ejemplo</a></li>
<li><a href="../es426609/index.html">Office 365 y otros productos de MS agregar√°n E / S de voz para disl√©xicos</a></li>
<li><a href="../es426611/index.html">Integraci√≥n con SAP ERP, usando Django-python como ejemplo, usando el protocolo oData (rest)</a></li>
<li><a href="../es426613/index.html">No permita que la impresora 3D sea floja</a></li>
<li><a href="../es426615/index.html">Escribir una CLI en NodeJS</a></li>
<li><a href="../es426621/index.html">Cuerdas compactas en Java 9</a></li>
<li><a href="../es426623/index.html">Este es un autob√∫s el√©ctrico: ¬øqu√© sabemos sobre el transporte con una bater√≠a?</a></li>
<li><a href="../es426625/index.html">√Årboles multiling√ºes en Yii2 como ejemplo de creaci√≥n de un m√≥dulo de men√∫</a></li>
<li><a href="../es426627/index.html">Ejemplos de Flexbox</a></li>
<li><a href="../es426629/index.html">Filosof√≠a de reforma fiscal de Trump</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>