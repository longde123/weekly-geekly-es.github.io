<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü•´ üëô üï† Cocinar CSS perfecto üéπ üëÇüèª ü¶Ñ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola Habr! 

 No hace mucho tiempo, me di cuenta de que trabajar con CSS en todas mis aplicaciones es un dolor para el desarrollador y el usuario. 

 ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Cocinar CSS perfecto</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/constanta/blog/428800/">  Hola Habr! <br><br>  No hace mucho tiempo, me di cuenta de que trabajar con CSS en todas mis aplicaciones es un dolor para el desarrollador y el usuario. <br><br>  Debajo del corte est√°n mis problemas, un mont√≥n de c√≥digo extra√±o y dificultades en el camino para trabajar con estilos correctamente. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/hh/ut/5e/hhut5eodm-tw-e1wdqnecn7dxlu.png"></div><a name="habracut"></a><br><h2>  Problema de CSS </h2><br>  En los proyectos React y Vue que hice, el enfoque de los estilos era m√°s o menos el mismo.  El proyecto es ensamblado por webpack, se importa un archivo CSS desde el punto de entrada principal.  Este archivo importa dentro de s√≠ mismo el resto de los archivos CSS que usan BEM para nombrar clases. <br><br><pre><code class="plaintext hljs">styles/ indes.css blocks/ apps-banner.css smart-list.css ...</code> </pre> <br>  ¬øEso es familiar?  Us√© esta implementaci√≥n en casi todas partes.  Y todo estuvo bien hasta que uno de los sitios creci√≥ a tal estado que los problemas con los estilos comenzaron a irritarme mucho los ojos. <br><br>  <b>1. El problema de la recarga en caliente</b> <br>  La importaci√≥n de estilos entre s√≠ se produjo a trav√©s del complemento postcss o el cargador de stylus. <br>  El truco es este: <br><br>  Cuando resolvemos las importaciones a trav√©s del plugin postcss o stylus-loader, la salida es un archivo CSS grande.  Ahora, incluso con un ligero cambio en una de las hojas de estilo, todos los archivos CSS se procesar√°n nuevamente. <br><br>  Realmente mata la velocidad de la recarga en caliente: se tarda unos 4 segundos en procesar ~ 950 Kbytes de archivos de stylus. <br><br><div class="spoiler">  <b class="spoiler_title">Nota sobre css-loader</b> <div class="spoiler_text">  Si la importaci√≥n de archivos CSS se resolvi√≥ a trav√©s de css-loader, tal problema no habr√≠a surgido: <br>  css-loader convierte CSS en JavaScript.  Reemplazar√° todas las importaciones de estilo con require.  Luego, cambiar un archivo CSS no afectar√° a otros archivos y la recarga en caliente ocurrir√° r√°pidamente. <br><br>  Para css-loader <br><br><pre> <code class="css hljs"><span class="hljs-comment"><span class="hljs-comment">/* main.css */</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">'./test.css'</span></span>; <span class="hljs-selector-tag"><span class="hljs-selector-tag">html</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">body</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">margin</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">padding</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">width</span></span>: <span class="hljs-number"><span class="hljs-number">100%</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">height</span></span>: <span class="hljs-number"><span class="hljs-number">100%</span></span>; } <span class="hljs-selector-tag"><span class="hljs-selector-tag">body</span></span> { <span class="hljs-comment"><span class="hljs-comment">/* background-color: #a1616e; */</span></span> <span class="hljs-attribute"><span class="hljs-attribute">background-color</span></span>: red; }</code> </pre><br>  Despues <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* main.css */</span></span> <span class="hljs-comment"><span class="hljs-comment">// imports exports.i(require("-!../node_modules/css-loader/index.js!./test.css"), ""); // module exports.push([module.id, "html, body {\n margin: 0;\n padding: 0;\n width: 100%;\n height: 100%;\n}\n\nbody {\n /* background-color: #a1616e; */\n background-color: red;\n}\n", ""]); // exports</span></span></code> </pre><br></div></div><br>  <b>2. El problema de la divisi√≥n de c√≥digo</b> <br><br>  Cuando los estilos se cargan desde una carpeta separada, no conocemos el contexto de uso de cada uno de ellos.  Con este enfoque, no es posible dividir CSS en varias partes y cargarlas seg√∫n sea necesario. <br><br>  <b>3. Grandes nombres de clases CSS</b> <br><br>  Cada nombre de clase BEM se ve as√≠: block-name__element-name.  Un nombre tan largo afecta fuertemente el tama√±o final del archivo CSS: en el sitio web de Habr, por ejemplo, los nombres de clase CSS ocupan el 36% del tama√±o del archivo de estilo. <br><br>  Google es consciente de este problema y ha usado durante mucho tiempo la minificaci√≥n de nombres en todos sus proyectos: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/zb/ft/yx/zbftyxjxnsh-irc6odfc5cszvxk.png" alt="Un pedazo de google.com"></div><br>  <font color="#999999"><i>Un pedazo de google.com</i></font> <br><br>  Todos estos problemas me pusieron en orden, finalmente decid√≠ terminarlos y lograr el resultado perfecto. <br><br><h2>  Selecci√≥n de decisiones </h2><br>  Para deshacerme de todos los problemas anteriores, encontr√© dos soluciones: CSS en JS (componentes con estilo) y m√≥dulos CSS. <br><br>  No vi fallas cr√≠ticas en estas soluciones, pero al final mi elecci√≥n recay√≥ en los m√≥dulos CSS debido a varias razones: <br><br><ul><li>  Puede poner CSS en un archivo separado para el almacenamiento en cach√© por separado de JS y CSS. </li><li>  M√°s opciones para estilos de lintering. </li><li>  Es m√°s com√∫n trabajar con archivos CSS. </li></ul><br>  La elecci√≥n est√° hecha, ¬°es hora de comenzar a cocinar! <br><br><h2>  Ajuste b√°sico </h2><br>  Configurar webpack un poco.  Agregue css-loader y habilite los m√≥dulos CSS en √©l: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* webpack.config.js */</span></span> <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = { <span class="hljs-comment"><span class="hljs-comment">/* ‚Ä¶ */</span></span> <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>: { <span class="hljs-attr"><span class="hljs-attr">rules</span></span>: [ <span class="hljs-comment"><span class="hljs-comment">/* ‚Ä¶ */</span></span> { <span class="hljs-attr"><span class="hljs-attr">test</span></span>: <span class="hljs-regexp"><span class="hljs-regexp">/\.css$/</span></span>, <span class="hljs-attr"><span class="hljs-attr">use</span></span>: [ <span class="hljs-string"><span class="hljs-string">'style-loader'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">loader</span></span>: <span class="hljs-string"><span class="hljs-string">'css-loader'</span></span>, <span class="hljs-attr"><span class="hljs-attr">options</span></span>: { <span class="hljs-attr"><span class="hljs-attr">modules</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, } }, ], }, ], }, };</code> </pre><br>  Ahora difundiremos los archivos CSS en carpetas con componentes.  Dentro de cada componente importamos los estilos necesarios. <br><br><pre> <code class="plaintext hljs">project/ components/ CoolComponent/ index.js index.css</code> </pre><br><pre> <code class="css hljs"><span class="hljs-comment"><span class="hljs-comment">/* components/CoolComponent/index.css */</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.contentWrapper</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">padding</span></span>: <span class="hljs-number"><span class="hljs-number">8px</span></span> <span class="hljs-number"><span class="hljs-number">16px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">background-color</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">rgba</span></span>(45, 45, 45, .3); } <span class="hljs-selector-class"><span class="hljs-selector-class">.title</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">font-size</span></span>: <span class="hljs-number"><span class="hljs-number">14px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">font-weight</span></span>: bold; } <span class="hljs-selector-class"><span class="hljs-selector-class">.text</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">font-size</span></span>: <span class="hljs-number"><span class="hljs-number">12px</span></span>; }</code> </pre><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* components/CoolComponent/index.js */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> styles <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./index.css'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> ({ text }) =&gt; ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{styles.contentWrapper}</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{styles.title}</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> Weird title </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{styles.text}</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> {text} </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> );</code> </pre><br>  Ahora que hemos roto los archivos CSS, la recarga en caliente solo procesar√° los cambios en un archivo.  Problema n√∫mero 1 resuelto, ¬°salud! <br><br><h2>  Divide CSS en trozos </h2><br>  Cuando un proyecto tiene muchas p√°ginas y el cliente solo necesita una de ellas, no tiene sentido extraer todos los datos.  React tiene una gran biblioteca cargable de reacci√≥n para esto.  Le permite crear un componente que descarga din√°micamente el archivo que necesitamos si es necesario. <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* AsyncCoolComponent.js */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Loadable <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-loadable'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Loading <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'path/to/Loading'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> Loadable({ <span class="hljs-attr"><span class="hljs-attr">loader</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span>(<span class="hljs-comment"><span class="hljs-comment">/* webpackChunkName: 'CoolComponent' */</span></span><span class="hljs-string"><span class="hljs-string">'path/to/CoolComponent'</span></span>), <span class="hljs-attr"><span class="hljs-attr">loading</span></span>: Loading, });</code> </pre><br>  Webpack convertir√° el componente CoolComponent en un archivo JS separado (fragmento), que se descargar√° cuando se represente AsyncCoolComponent. <br><br>  Al mismo tiempo, CoolComponent contiene sus propios estilos.  CSS se encuentra en √©l como una cadena JS hasta ahora y se inserta como un estilo usando style-loader.  Pero, ¬øpor qu√© no cortamos los estilos en un archivo separado? <br><br>  Haremos nuestro propio archivo CSS tanto para el archivo principal como para cada uno de los fragmentos. <br><br>  Instale el mini-css-extract-plugin y conjure con la configuraci√≥n del paquete web: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* webpack.config.js */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> MiniCssExtractPlugin = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'mini-css-extract-plugin'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> isDev = process.env.NODE_ENV === <span class="hljs-string"><span class="hljs-string">'development'</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = { <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>: { <span class="hljs-attr"><span class="hljs-attr">rules</span></span>: [ { <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> test: <span class="hljs-regexp"><span class="hljs-regexp">/\.css$/</span></span>, <span class="hljs-attr"><span class="hljs-attr">use</span></span>: [ (isDev ? <span class="hljs-string"><span class="hljs-string">'style-loader'</span></span> : MiniCssExtractPlugin.loader), { <span class="hljs-attr"><span class="hljs-attr">loader</span></span>: <span class="hljs-string"><span class="hljs-string">'css-loader'</span></span>, <span class="hljs-attr"><span class="hljs-attr">options</span></span>: { <span class="hljs-attr"><span class="hljs-attr">modules</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, }, }, ], }, ], }, <span class="hljs-attr"><span class="hljs-attr">plugins</span></span>: [ <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> ...(isDev ? [] : [ <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MiniCssExtractPlugin({ <span class="hljs-attr"><span class="hljs-attr">filename</span></span>: <span class="hljs-string"><span class="hljs-string">'[name].[contenthash].css'</span></span>, <span class="hljs-attr"><span class="hljs-attr">chunkFilename</span></span>: <span class="hljs-string"><span class="hljs-string">'[name].[contenthash].css'</span></span>, }), ]), ], };</code> </pre><br>  Eso es todo!  Armemos el proyecto en modo de producci√≥n, abra el navegador y vea la pesta√±a de red: <br><br><pre> <code class="plaintext hljs">//    GET /main.aff4f72df3711744eabe.css GET /main.43ed5fc03ceb844eab53.js //  CoolComponent ,   JS  CSS GET /CoolComponent.3eaa4773dca4fffe0956.css GET /CoolComponent.2462bbdbafd820781fae.js</code> </pre><br>  El problema n√∫mero 2 ha terminado. <br><br><h2>  Minimizamos las clases de CSS </h2><br>  Css-loader cambia los nombres de clase dentro y devuelve una variable con la asignaci√≥n de nombres de clase locales a globales. <br><br>  Despu√©s de nuestra configuraci√≥n b√°sica, css-loader genera un hash largo basado en el nombre y la ubicaci√≥n del archivo. <br><br>  En el navegador, nuestro CoolComponent ahora se ve as√≠: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"rs2inRqijrGnbl0txTQ8v"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"_2AU-QBWt5K2v7J1vRT0hgn"</span></span></span><span class="hljs-tag">&gt;</span></span> Weird title <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"_1DaTAH8Hgn0BQ4H13yRwQ0"</span></span></span><span class="hljs-tag">&gt;</span></span> Lorem ipsum dolor sit amet consectetur. <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Por supuesto, esto no es suficiente para nosotros. <br><br>  Es necesario que durante el desarrollo haya nombres para encontrar el estilo original.  Y en el modo de producci√≥n, los nombres de clase deben ser minificados. <br><br>  Css-loader le permite personalizar el cambio de nombres de clase a trav√©s de las opciones localIdentName y getLocalIdent.  En el modo de desarrollo, configuraremos el localIdentName descriptivo - '[ruta] _ [nombre] _ [local]', y para el modo de producci√≥n haremos una funci√≥n que minimizar√° los nombres de clase: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* webpack.config.js */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> getScopedName = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'path/to/getScopedName'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> isDev = process.env.NODE_ENV === <span class="hljs-string"><span class="hljs-string">'development'</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = { <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>: { <span class="hljs-attr"><span class="hljs-attr">rules</span></span>: [ <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> { <span class="hljs-attr"><span class="hljs-attr">test</span></span>: <span class="hljs-regexp"><span class="hljs-regexp">/\.css$/</span></span>, <span class="hljs-attr"><span class="hljs-attr">use</span></span>: [ <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">isDev ? </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'style-loader'</span></span></span></span><span class="hljs-function"><span class="hljs-params"> : MiniCssExtractPlugin.loader</span></span></span><span class="hljs-function">), { </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">loader</span></span></span><span class="hljs-function">: '</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">css</span></span></span><span class="hljs-function">-</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">loader</span></span></span><span class="hljs-function">', </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">options</span></span></span><span class="hljs-function">: { </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">modules</span></span></span><span class="hljs-function">: </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">true</span></span></span><span class="hljs-function">, ...(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">isDev ? { localIdentName: </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'[path]_[name]_[local]'</span></span></span></span><span class="hljs-function"><span class="hljs-params">, } : { getLocalIdent: (context, localIdentName, localName</span></span></span><span class="hljs-function">) =&gt;</span></span> ( getScopedName(localName, context.resourcePath) ), }), }, }, ], }, ], }, };</code> </pre><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* getScopedName.js */</span></span> <span class="hljs-comment"><span class="hljs-comment">/*   ,        CSS      */</span></span> <span class="hljs-comment"><span class="hljs-comment">//      const incstr = require('incstr'); const createUniqueIdGenerator = () =&gt; { const uniqIds = {}; const generateNextId = incstr.idGenerator({ //  d ,    ad, //      Adblock alphabet: 'abcefghijklmnopqrstuvwxyzABCEFGHJKLMNOPQRSTUVWXYZ', }); //       return (name) =&gt; { if (!uniqIds[name]) { uniqIds[name] = generateNextId(); } return uniqIds[name]; }; }; const localNameIdGenerator = createUniqueIdGenerator(); const componentNameIdGenerator = createUniqueIdGenerator(); module.exports = (localName, resourcePath) =&gt; { //   ,     index.css const componentName = resourcePath .split('/') .slice(-2, -1)[0]; const localId = localNameIdGenerator(localName); const componentId = componentNameIdGenerator(componentName); return `${componentId}_${localId}`; };</span></span></code> </pre><br>  Y aqu√≠ tenemos en el desarrollo de hermosos nombres visuales: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"src-components-ErrorNotification-_index_content-wrapper"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"src-components-ErrorNotification-_index_title"</span></span></span><span class="hljs-tag">&gt;</span></span> Weird title <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"src-components-ErrorNotification-_index_text"</span></span></span><span class="hljs-tag">&gt;</span></span> Lorem ipsum dolor sit amet consectetur. <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Y en las clases de producci√≥n minimizadas: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"e_f"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"e_g"</span></span></span><span class="hljs-tag">&gt;</span></span> Weird title <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"e_h"</span></span></span><span class="hljs-tag">&gt;</span></span> Lorem ipsum dolor sit amet consectetur. <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  El tercer problema est√° superado. <br><br><h2>  Eliminar la invalidaci√≥n de cach√© innecesaria </h2><br>  Usando la t√©cnica de minificaci√≥n de clase descrita anteriormente, intente construir el proyecto varias veces.  Presta atenci√≥n a las cach√©s de archivos: <br><br><pre> <code class="plaintext hljs">/*   */ app.bf70bcf8d769b1a17df1.js app.db3d0bd894d38d036117.css /*   */ app.1f296b75295ada5a7223.js app.eb2519491a5121158bd2.css</code> </pre><br>  Parece que despu√©s de cada nueva compilaci√≥n hemos invalidado cach√©s.  ¬øC√≥mo es eso? <br><br>  El problema es que webpack no garantiza el orden en que se procesan los archivos.  Es decir, los archivos CSS se procesar√°n en un orden impredecible, se generar√°n diferentes nombres minificados para el mismo nombre de clase con diferentes ensamblados. <br><br>  Para superar este problema, guardemos los datos sobre los nombres de clase generados entre ensamblados.  Actualice un poco el archivo getScopedName.js: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* getScopedName.js */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> incstr = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'incstr'</span></span>); <span class="hljs-comment"><span class="hljs-comment">//     const { getGeneratorData, saveGeneratorData, } = require('./generatorHelpers'); const createUniqueIdGenerator = (generatorIdentifier) =&gt; { //    const uniqIds = getGeneratorData(generatorIdentifier); const generateNextId = incstr.idGenerator({ alphabet: 'abcefghijklmnopqrstuvwxyzABCEFGHJKLMNOPQRSTUVWXYZ', }); return (name) =&gt; { if (!uniqIds[name]) { uniqIds[name] = generateNextId(); //    , //      // (   debounce  ) saveGeneratorData(generatorIdentifier, uniqIds); } return uniqIds[name]; }; }; //     , //          const localNameIdGenerator = createUniqueIdGenerator('localName'); const componentNameIdGenerator = createUniqueIdGenerator('componentName'); module.exports = (localName, resourcePath) =&gt; { const componentName = resourcePath .split('/') .slice(-2, -1)[0]; const localId = localNameIdGenerator(localName); const componentId = componentNameIdGenerator(componentName); return `${componentId}_${localId}`; };</span></span></code> </pre><br>  La implementaci√≥n del archivo generatorHelpers.js realmente no importa, pero si est√° interesado, aqu√≠ est√° el m√≠o: <br><br><div class="spoiler">  <b class="spoiler_title">generatorHelpers.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> fs = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fs'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> path = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'path'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> getGeneratorDataPath = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">generatorIdentifier</span></span></span><span class="hljs-function"> =&gt;</span></span> ( path.resolve(__dirname, <span class="hljs-string"><span class="hljs-string">`meta/</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${generatorIdentifier}</span></span></span><span class="hljs-string">.json`</span></span>) ); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> getGeneratorData = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">generatorIdentifier</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> path = getGeneratorDataPath(generatorIdentifier); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fs.existsSync(path)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(path); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> {}; }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> saveGeneratorData = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">generatorIdentifier, uniqIds</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> path = getGeneratorDataPath(generatorIdentifier); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> data = <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify(uniqIds, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>); fs.writeFileSync(path, data, <span class="hljs-string"><span class="hljs-string">'utf-8'</span></span>); }; <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = { getGeneratorData, saveGeneratorData, };</code> </pre><br></div></div><br>  Los cach√©s se han vuelto iguales entre las compilaciones, todo est√° bien.  ¬°Otro punto a nuestro favor! <br><br><h2>  Eliminar la variable de tiempo de ejecuci√≥n </h2><br>  Como decid√≠ tomar una mejor decisi√≥n, ser√≠a bueno eliminar esta variable con la asignaci√≥n de clases, porque tenemos todos los datos necesarios en la etapa de compilaci√≥n. <br><br>  Babel-plugin-react-css-modules nos ayudar√° con esto.  En tiempo de compilaci√≥n: <br><br><ol><li>  Encontrar√° la importaci√≥n de CSS en el archivo. </li><li>  Abrir√° este archivo CSS y cambiar√° los nombres de las clases CSS al igual que css-loader. </li><li>  Encontrar√° nodos JSX con el atributo styleName. </li><li>  Reemplaza los nombres de clase locales de styleName con nombres globales. </li></ol><br>  Configura este complemento.  Juguemos con la configuraci√≥n de babel: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* .babelrc.js */</span></span> <span class="hljs-comment"><span class="hljs-comment">//   ,     const getScopedName = require('path/to/getScopedName'); const isDev = process.env.NODE_ENV === 'development'; module.exports = { /* ... */ plugins: [ /* ... */ ['react-css-modules', { generateScopedName: isDev ? '[path]_[name]_[local]' : getScopedName, }], ], };</span></span></code> </pre><br>  Actualice nuestros archivos JSX: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* CoolComponent/index.js */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">'./index.css'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> ({ text }) =&gt; ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">styleName</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"content-wrapper"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">styleName</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"title"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> Weird title </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">styleName</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> {text} </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> );</code> </pre><br>  Y entonces dejamos de usar la variable con la visualizaci√≥n de nombres de estilo, ¬°ahora no la tenemos! <br><br>  ... o hay? <br><br>  Recopilaremos el proyecto y estudiaremos las fuentes: <br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* main.24436cbf94546057cae3.js */</span></span> <span class="hljs-comment"><span class="hljs-comment">/* ‚Ä¶ */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e, t, n</span></span></span><span class="hljs-function">) </span></span>{ e.exports = { <span class="hljs-string"><span class="hljs-string">"content-wrapper"</span></span>: <span class="hljs-string"><span class="hljs-string">"e_f"</span></span>, <span class="hljs-attr"><span class="hljs-attr">title</span></span>: <span class="hljs-string"><span class="hljs-string">"e_g"</span></span>, <span class="hljs-attr"><span class="hljs-attr">text</span></span>: <span class="hljs-string"><span class="hljs-string">"e_h"</span></span> } } <span class="hljs-comment"><span class="hljs-comment">/* ‚Ä¶ */</span></span></code> </pre><br>  Parece que la variable todav√≠a est√° all√≠, aunque no se usa en ning√∫n lado.  ¬øPor qu√© sucedi√≥ esto? <br><br>  El paquete web admite varios tipos de estructura modular, los m√°s populares son ES2015 (importaci√≥n) y commonJS (requerido). <br><br>  Los m√≥dulos ES2015, a diferencia de commonJS, admiten <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">la sacudida de √°rboles</a> debido a su estructura est√°tica. <br><br>  Pero tanto el cargador css-como el cargador mini-css-extract-plugin usan la sintaxis commonJS para exportar nombres de clase, por lo que los datos exportados no se eliminan de la compilaci√≥n. <br><br>  Escribiremos nuestro peque√±o cargador y eliminaremos los datos adicionales en modo producci√≥n: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* webpack.config.js */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> path = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'path'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> resolve = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">relativePath</span></span></span><span class="hljs-function"> =&gt;</span></span> path.resolve(__dirname, relativePath); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> isDev = process.env.NODE_ENV === <span class="hljs-string"><span class="hljs-string">'development'</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = { <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>: { <span class="hljs-attr"><span class="hljs-attr">rules</span></span>: [ <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> { <span class="hljs-attr"><span class="hljs-attr">test</span></span>: <span class="hljs-regexp"><span class="hljs-regexp">/\.css$/</span></span>, <span class="hljs-attr"><span class="hljs-attr">use</span></span>: [ ...(isDev ? [<span class="hljs-string"><span class="hljs-string">'style-loader'</span></span>] : [ resolve(<span class="hljs-string"><span class="hljs-string">'path/to/webpack-loaders/nullLoader'</span></span>), MiniCssExtractPlugin.loader, ]), { <span class="hljs-attr"><span class="hljs-attr">loader</span></span>: <span class="hljs-string"><span class="hljs-string">'css-loader'</span></span>, <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> }, ], }, ], }, };</code> </pre><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* nullLoader.js */</span></span> <span class="hljs-comment"><span class="hljs-comment">//     ,   module.exports = () =&gt; '// empty';</span></span></code> </pre><br>  Verifique nuevamente el archivo ensamblado: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* main.35f6b05f0496bff2048a.js */</span></span> <span class="hljs-comment"><span class="hljs-comment">/* ‚Ä¶ */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e, t, n</span></span></span><span class="hljs-function">) </span></span>{} <span class="hljs-comment"><span class="hljs-comment">/* ‚Ä¶ */</span></span></code> </pre><br>  Puedes exhalar con alivio, todo funcion√≥. <br><br><div class="spoiler">  <b class="spoiler_title">Error al eliminar la variable de asignaci√≥n de clase</b> <div class="spoiler_text">  Al principio, me pareci√≥ m√°s obvio usar el paquete de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">cargador nulo</a> ya existente. <br><br>  Pero todo result√≥ no ser tan simple: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/*  null-loader */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'// empty (null-loader)'</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pitch</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'// empty (null-loader)'</span></span>; }</code> </pre><br>  Como puede ver, adem√°s de la funci√≥n principal, null-loader tambi√©n exporta la funci√≥n de tono.  Aprend√≠ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">de la documentaci√≥n</a> que los m√©todos de tono se llaman antes que otros y pueden cancelar todos los cargadores posteriores si devuelven algunos datos de este m√©todo. <br><br>  Con un cargador nulo, la secuencia de producci√≥n de CSS comienza a verse as√≠: <br><br><ul><li>  Se llama al m√©todo pitch de null-loader, que devuelve una cadena vac√≠a. </li><li>  Debido al valor de retorno del m√©todo de tono, no se llaman todos los cargadores posteriores. </li></ul><br>  Ya no ve√≠a las soluciones y decid√≠ hacer mi propio cargador. <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Usar con Vue.js</b> <div class="spoiler_text">  Si solo tienes un Vue.js a tu alcance, pero realmente quieres comprimir los nombres de clase y eliminar la variable de tiempo de ejecuci√≥n, ¬°entonces tengo un gran truco! <br><br>  Todo lo que necesitamos son dos complementos: babel-plugin-transform-vue-jsx y babel-plugin-react-css-modules.  Necesitaremos el primero para escribir JSX en funciones de renderizado y el segundo, como ya sabe, para generar nombres en la etapa de compilaci√≥n. <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* .babelrc.js */</span></span> <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = { <span class="hljs-attr"><span class="hljs-attr">plugins</span></span>: [ <span class="hljs-string"><span class="hljs-string">'transform-vue-jsx'</span></span>, [<span class="hljs-string"><span class="hljs-string">'react-css-modules'</span></span>, { <span class="hljs-comment"><span class="hljs-comment">//    attributeNames: { styleName: 'class', }, }], ], };</span></span></code> </pre><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">'./index.css'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> TextComponent = { render(h) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">styleName</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> Lorem ipsum dolor. </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> ); }, mounted() { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'I\'m mounted!'</span></span>); }, }; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> TextComponent;</code> </pre><br></div></div><br><br><h2>  Comprime CSS al m√°ximo </h2><br>  Imagine que el siguiente CSS apareci√≥ en el proyecto: <br><pre> <code class="css hljs"><span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.component1__title</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">color</span></span>: red; } <span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.component2__title</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">color</span></span>: green; } <span class="hljs-selector-class"><span class="hljs-selector-class">.component2__title_red</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">color</span></span>: red; }</code> </pre><br>  Eres un minificador de CSS.  ¬øC√≥mo lo exprimir√≠as? <br><br>  Creo que tu respuesta es algo como esto: <br><br><pre> <code class="css hljs"><span class="hljs-selector-class"><span class="hljs-selector-class">.component2__title</span></span>{<span class="hljs-attribute"><span class="hljs-attribute">color</span></span>:green} <span class="hljs-selector-class"><span class="hljs-selector-class">.component2__title_red</span></span>, <span class="hljs-selector-class"><span class="hljs-selector-class">.component1__title</span></span>{<span class="hljs-attribute"><span class="hljs-attribute">color</span></span>:red}</code> </pre><br>  Ahora comprobaremos qu√© har√°n los minificadores habituales.  Pon nuestro c√≥digo en un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">minificador</a> en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">l√≠nea</a> : <br><br><pre> <code class="css hljs"><span class="hljs-selector-class"><span class="hljs-selector-class">.component1__title</span></span>{<span class="hljs-attribute"><span class="hljs-attribute">color</span></span>:red} <span class="hljs-selector-class"><span class="hljs-selector-class">.component2__title</span></span>{<span class="hljs-attribute"><span class="hljs-attribute">color</span></span>:green} <span class="hljs-selector-class"><span class="hljs-selector-class">.component2__title_red</span></span>{<span class="hljs-attribute"><span class="hljs-attribute">color</span></span>:red}</code> </pre><br>  ¬øPor qu√© no pod√≠a √©l? <br><br>  El minificador teme que, debido a un cambio en el orden de la declaraci√≥n de estilos, algo se rompa.  Por ejemplo, si el proyecto tiene este c√≥digo: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"component1__title component2__title"</span></span></span><span class="hljs-tag">&gt;</span></span>Some weird title<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Gracias a usted, el t√≠tulo se volver√° rojo, y el minificador en l√≠nea dejar√° el orden de declaraci√≥n de estilo correcto y se volver√° verde.  Por supuesto, usted sabe que nunca habr√° la intersecci√≥n de component1__title y component2__title, porque est√°n en diferentes componentes.  Pero, ¬øc√≥mo decirle esto al minificador? <br><br>  Despu√©s de buscar en la documentaci√≥n, encontr√© la capacidad de especificar el contexto para usar clases solo con <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">csso</a> .  Y no tiene una soluci√≥n conveniente para el paquete web listo para usar.  Para ir m√°s lejos, necesitamos una bicicleta peque√±a. <br><br>  Debe combinar los nombres de clase de cada componente en matrices separadas y asignarlo dentro de csso.  Un poco antes generamos nombres de clase minificados de acuerdo con este patr√≥n: '[componenteId] _ [classNameId]'.  Por lo tanto, los nombres de clase se pueden combinar simplemente por la primera parte del nombre. <br><br>  Abr√≥chense los cinturones de seguridad y escriba su complemento: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* webpack.config.js */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> cssoLoader = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'path/to/cssoLoader'</span></span>); <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = { <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> plugins: [ <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> cssoLoader(), ], };</code> </pre><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* cssoLoader.js */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> csso = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'csso'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> RawSource = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'webpack-sources/lib/RawSource'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> getScopes = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./helpers/getScopes'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> isCssFilename = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">filename</span></span></span><span class="hljs-function"> =&gt;</span></span> /\.css$/.test(filename); <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">cssoPlugin</span></span></span><span class="hljs-class"> </span></span>{ apply(compiler) { compiler.hooks.compilation.tap(<span class="hljs-string"><span class="hljs-string">'csso-plugin'</span></span>, (compilation) =&gt; { compilation.hooks.optimizeChunkAssets.tapAsync(<span class="hljs-string"><span class="hljs-string">'csso-plugin'</span></span>, (chunks, callback) =&gt; { chunks.forEach(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">chunk</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-comment"><span class="hljs-comment">//    CSS  chunk.files.forEach((filename) =&gt; { if (!isCssFilename(filename)) { return; } const asset = compilation.assets[filename]; const source = asset.source(); //  ast  CSS  const ast = csso.syntax.parse(source); //        const scopes = getScopes(ast); //  ast const { ast: compressedAst } = csso.compress(ast, { usage: { scopes, }, }); const minifiedCss = csso.syntax.generate(compressedAst); compilation.assets[filename] = new RawSource(minifiedCss); }); }); callback(); }); }); } } /*    sourceMap,     ,       https://github.com/zoobestik/csso-webpack-plugin" */</span></span></code> </pre><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* getScopes.js */</span></span> <span class="hljs-comment"><span class="hljs-comment">/*   ,          ,     */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> csso = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'csso'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> getComponentId = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">className</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> tokens = className.split(<span class="hljs-string"><span class="hljs-string">'_'</span></span>); <span class="hljs-comment"><span class="hljs-comment">//   ,   //   [componentId]_[classNameId], //     if (tokens.length !== 2) { return 'default'; } return tokens[0]; }; module.exports = (ast) =&gt; { const scopes = {}; //      csso.syntax.walk(ast, (node) =&gt; { if (node.type !== 'ClassSelector') { return; } const componentId = getComponentId(node.name); if (!scopes[componentId]) { scopes[componentId] = []; } if (!scopes[componentId].includes(node.name)) { scopes[componentId].push(node.name); } }); return Object.values(scopes); };</span></span></code> </pre><br>  Y no fue tan dif√≠cil, ¬øverdad?  Por lo general, esta minificaci√≥n tambi√©n comprime CSS en un 3-6%. <br><br><h2>  ¬øVali√≥ la pena? </h2><br>  Por supuesto <br><br>  En mis aplicaciones, finalmente apareci√≥ una recarga r√°pida en caliente, y CSS comenz√≥ a dividirse en trozos y pes√≥ en promedio un 40% menos. <br><br>  Esto acelerar√° la carga del sitio y reducir√° el tiempo para analizar estilos, lo que afectar√° no solo a los usuarios, sino tambi√©n a los CEO. <br><br>  El art√≠culo ha crecido mucho, pero me alegra que alguien haya podido desplazarlo hasta el final.  Gracias por tu tiempo! <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/cd/wm/b8/cdwmb8ygmq0mysnve4zjina7-iw.png"></div><br><h4>  Materiales utilizados </h4><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Reducir el tama√±o del paquete CSS en un 70% cortando los nombres de clase y utilizando el aislamiento del alcance</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es428800/">https://habr.com/ru/post/es428800/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es428790/index.html">Estamos escribiendo un chat bot para VKontakte en python usando longpoll. Segunda parte Dobles lazos, excepciones y otras herej√≠as</a></li>
<li><a href="../es428792/index.html">El nuevo chip Apple T2 hace que sea dif√≠cil escuchar a trav√©s del micr√≥fono incorporado de la computadora port√°til</a></li>
<li><a href="../es428794/index.html">Resumen de los m√©todos b√°sicos de optimizaci√≥n matem√°tica para problemas con restricciones</a></li>
<li><a href="../es428796/index.html">Manipulaci√≥n en tiempo real de mallas en la unidad</a></li>
<li><a href="../es428798/index.html">C√≥mo sobrevivir a un desarrollador independiente. Parte 2</a></li>
<li><a href="../es428806/index.html">An√°lisis de verificaci√≥n del consumidor: lo que compran en Amazon</a></li>
<li><a href="../es428808/index.html">Poca conveniencia en la vida estudiantil.</a></li>
<li><a href="../es428810/index.html">18 materiales sobre tecnolog√≠a digital en audio</a></li>
<li><a href="../es428812/index.html">TypeScript: Deserializaci√≥n de JSON en clases con validaci√≥n de tipo en propiedades</a></li>
<li><a href="../es428814/index.html">Coincidencia de productos con Elasticsearch para el servicio de monitoreo de precios de la competencia</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>