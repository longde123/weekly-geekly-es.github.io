<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üñïüèº ‚ñ´Ô∏è üëåüèª Fear and Loathing Threat Intelligence or 8 TI Practical Tips ü•ê „Ä∞Ô∏è üßúüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Nous avions deux abonnements commerciaux √† APT, dix √©changes d'informations, une dizaine de flux gratuits et la liste des n≈ìuds de sortie de Thor. Et ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Fear and Loathing Threat Intelligence or 8 TI Practical Tips</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/solarsecurity/blog/417297/"><img src="https://habrastorage.org/webt/31/k_/ho/31k_hosvjz67wnrm9qu0rrd_pp0.jpeg"><br><br>  Nous avions deux abonnements commerciaux √† APT, dix √©changes d'informations, une dizaine de flux gratuits et la liste des n≈ìuds de sortie de Thor.  Et aussi cinq inverseurs puissants, un ma√Ætre des scripts PowerShell, un loki-scanner et un abonnement payant √† virustotal.  Ce n'est pas que sans cela, le centre de surveillance ne fonctionne pas, mais si vous avez l'habitude d'attraper des attaques complexes, vous devez aller jusqu'√† ce passe-temps.  Surtout, nous √©tions pr√©occup√©s par l'automatisation potentielle de la v√©rification des indicateurs de compromis.  Il n'y a rien de plus immoral que l'intelligence artificielle, rempla√ßant une personne au travail o√π il faut penser.  Mais nous avons compris qu'avec une augmentation du nombre de clients, t√¥t ou tard nous y plongerions. <br><a name="habracut"></a><br>  Beaucoup disent que Threat Intelligence est d√©licieux, mais tout le monde ne comprend pas comment le cuisiner.  Encore moins qui comprennent quels processus doivent √™tre construits pour que TI fonctionne et g√©n√®re des b√©n√©fices.  Et tr√®s peu de gens savent comment choisir un fournisseur de flux, o√π v√©rifier l'indicateur de chutes et s'il est n√©cessaire de bloquer le domaine que le coll√®gue a envoy√© √† WhatsApp. <br><br>  Pendant plusieurs ann√©es de travail constant avec TI, nous avons r√©ussi √† marcher sur diff√©rents r√¢teaux et aujourd'hui nous voulons donner quelques conseils pratiques qui aideront les d√©butants √† √©viter les erreurs. <br><br><h3>  Astuce num√©ro 1.  N'esp√©rez pas attraper un hachage: la plupart des malwares sont polymorphes depuis longtemps </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Dans le dernier article,</a> nous avons parl√© de ce qu'est TI et donn√© quelques exemples de l'organisation du processus de travail.  Permettez-moi de vous rappeler que les informations sur les menaces (renseignement sur les menaces) se pr√©sentent sous diff√©rents formats et vues: il peut s'agir des adresses IP des centres de contr√¥le de botnet, des adresses e-mail des exp√©diteurs d'e-mails de phishing et des articles d√©crivant les techniques de contournement des outils de protection que les groupes APT -qui va commencer √† utiliser.  En g√©n√©ral, beaucoup de choses se produisent. <br><br>  Pour rationaliser toute cette honte, il y a quelques ann√©es, David Bianco a propos√© la soi-disant <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">¬´pyramide de la douleur¬ª</a> .  Il d√©crit assez bien la relation entre les types d'indicateurs que vous utilisez pour d√©tecter l'attaquant et la douleur que vous causerez √† l'attaquant si vous pouvez d√©tecter un type d'indicateur sp√©cifique. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/lz/ix/mv/lzixmvhlrhcdqpcjwi63chisyzq.png"></div><br><br>  Par exemple, si vous connaissez le hachage MD5 d'un fichier malveillant, il peut √™tre assez facilement d√©tect√© et d√©tect√© avec pr√©cision.  Cependant, cela apportera tr√®s peu de douleur √† l'attaquant - il suffit d'ajouter 1 bit d'informations au fichier, et le hachage est d√©j√† diff√©rent. <br><br><h3>  Astuce num√©ro 2.  Essayez d'utiliser ces indicateurs, dont le changement sera difficile techniquement ou √©conomiquement non rentable pour l'attaquant </h3><br>  Anticipant la question de savoir s'il existe un fichier avec ce hachage sur les postes de travail de notre entreprise, je r√©ponds: il existe diff√©rentes mani√®res.  L'un des plus simples consiste √† installer Kaspersky Security Center, qui contient une base de donn√©es de hachages MD5 de tous les fichiers ex√©cutables de l'entreprise, dans laquelle vous pouvez cr√©er SELECT. <br><br>  Revenons √† la pyramide de la douleur.  Contrairement √† la d√©tection de hachage, il sera plus productif si vous pouvez d√©tecter le TTP (tactique, technique, proc√©dure) de l'attaquant.  C'est plus compliqu√© et n√©cessite plus d'efforts, mais vous causerez plus de douleur. <br><br>  Par exemple, si vous savez qu'un groupe APT destin√© √† votre secteur √©conomique distribue des e-mails de phishing avec des fichiers * .HTA, le d√©veloppement d'une r√®gle de d√©tection qui recherche les fichiers dans le courrier avec des pi√®ces jointes similaires frappera durement l'attaquant.  Il devra changer la tactique du mailing, peut-√™tre m√™me investir $ $ dans l'achat d'exploits de 0 ou 1 jour, et ce n'est pas bon march√© ... <br><br><h3>  Astuce num√©ro 3.  N'ayez pas grand espoir concernant les r√®gles de d√©tection qui n'ont pas √©t√© d√©velopp√©es par vous; elles devront √™tre v√©rifi√©es pour les faux positifs et modifi√©es </h3><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/lb/fi/gx/lbfigxu0qc_msq7-qwn3hng6svw.jpeg"></div><br>  Lors du d√©veloppement de r√®gles de d√©tection, il est toujours tentant d'utiliser des r√®gles pr√©d√©finies.  Un exemple gratuit est le r√©f√©rentiel <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Sigma</a> , un format de r√®gle de d√©tection ind√©pendant de SIEM qui traduit les r√®gles de Sigma en requ√™tes ElasticSearch et en r√®gles Splunk ou Arcsight.  Dans le m√™me temps, le r√©f√©rentiel contient environ 200 r√®gles, dont environ 130 d√©crivent des attaques sur Windows.  √Ä premi√®re vue, c'est tr√®s cool, mais le diable, comme toujours, est dans les d√©tails. <br><br>  Jetons un coup d'≈ìil √† l' <a href="">une des r√®gles de</a> d√©tection de mimikatz <a href="">en</a> d√©tail: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/cg/sw/eu/cgsweugcondwgea0klgqmwafznw.png"></div><br>  La r√®gle d√©tecte les processus qui ont tent√© de lire la m√©moire du processus lsass.exe.  Mimikatz le fait lorsqu'il essaie d'obtenir des hachages NTLM et que la r√®gle d√©tecte les logiciels malveillants. <br><br>  Cependant, pour nous, en tant que sp√©cialistes qui sont impliqu√©s non seulement dans la d√©tection, mais aussi dans la r√©ponse aux incidents, il est extr√™mement important que ce soit vraiment du mimikatz.  Malheureusement, dans la pratique, il existe de nombreux autres processus l√©gitimes qui lisent la m√©moire de lsass.exe avec les m√™mes masques (certains antivirus, par exemple).  Par cons√©quent, dans un environnement de combat r√©el, une telle r√®gle apportera plus de faux positifs que de bien. <br><br>  Il existe des incidents encore plus int√©ressants li√©s √† la traduction automatique des r√®gles de Sigma en r√®gles SIEM: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/xu/0t/9l/xu0t9lchwgmepeu0hh9xnp92yko.png"></div><br>  Lors d'un des webinaires, des coll√®gues de SOC Prime fournissant des r√®gles de d√©tection payantes ont montr√© un exemple non fonctionnel d'une telle traduction: le champ deviceProduct dans SIEM doit √™tre √©gal √† Sysmon et √† Microsoft Windows, ce qui est impossible. <br><br>  Je ne veux bl√¢mer personne et me faire un doigt - tout le monde est fou, √ßa va.  Cependant, les consommateurs de Threat Intelligence doivent comprendre que la rev√©rification et le raffinement des r√®gles obtenues √† partir de sources ouvertes et ferm√©es sont toujours n√©cessaires. <br><br><h3>  Astuce n ¬∞ 4: v√©rifiez les noms de domaine et les adresses IP pour les logiciels malveillants non seulement sur le serveur proxy et le pare-feu, mais √©galement dans les journaux du serveur DNS, en faisant attention aux tentatives de r√©solution r√©ussies et infructueuses </h3><br>  Les domaines et adresses IP malveillants sont un indicateur optimal en termes de facilit√© de d√©tection et de quantit√© de douleur que vous livrez √† un attaquant.  Mais avec eux, tout n'est simple qu'√† premi√®re vue.  Au minimum, vous vous demandez peut-√™tre o√π obtenir le journal de domaine. <br><br>  Si vous vous limitez √† v√©rifier uniquement les journaux du serveur proxy, vous pouvez passer √† c√¥t√© de logiciels malveillants qui tentent d'acc√©der directement au r√©seau ou demandent un nom de domaine inexistant g√©n√©r√© par DGA, sans parler des tunnels DNS - tout cela ne sera pas dans les journaux de proxy d'entreprise. <br><br><h3>  Astuce num√©ro 5.  "Vous ne pouvez pas bloquer le moniteur" - ne mettez une virgule qu'apr√®s avoir connu le type d'indicateur et avoir compris les cons√©quences possibles d'un blocage </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/0x/cl/hi/0xclhi5dr1fohibe7rbsjseyze4.jpeg"></div><br>  Chaque agent de s√©curit√© en exercice √©tait confront√© √† une question difficile: bloquer la menace ou surveiller et, s'il y a des points positifs, lancer une enqu√™te?  Certaines r√©glementations et instructions √©crivent directement - bloquent, et parfois cette action est erron√©e. <br><br>  Si l'indicateur est le nom de domaine utilis√© par le groupement APT, <u>ne le mettez pas sur un verrou</u> , mais lancez la surveillance.  Les tactiques modernes d'attaques cibl√©es impliquent l'existence d'un canal de communication de secours cach√© suppl√©mentaire, qui ne peut √™tre identifi√© qu'au cours d'une enqu√™te d√©taill√©e.  Dans ce cas, le blocage automatique g√™nera la recherche de cette cha√Æne et les camarades de l'autre c√¥t√© de la barricade comprendront rapidement ce que vous avez appris sur leurs activit√©s. <br><br>  En revanche, si l'indicateur est un domaine de chiffrement, il <u>doit</u> d√©j√† <u>√™tre verrouill√©</u> .  Mais n'oubliez pas de surveiller les tentatives infructueuses d'acc√®s aux domaines bloqu√©s - plusieurs adresses de serveurs de gestion peuvent √™tre int√©gr√©es dans la configuration du chiffreur.  Certains d'entre eux peuvent manquer dans les flux et ne seront donc pas bloqu√©s.  T√¥t ou tard, le malware les contactera pour obtenir une cl√© que l'h√¥te chiffrera instantan√©ment.  Seule une analyse inverse de l'√©chantillon peut garantir que vous avez bloqu√© toutes les adresses du serveur de gestion. <br><br><h3>  Astuce num√©ro 6.  V√©rifiez la pertinence de tous les indicateurs entrants avant de les configurer pour la surveillance ou le blocage. </h3><br>  N'oubliez pas que les informations sur les menaces sont cr√©√©es par des personnes qui ont tendance √† faire des erreurs, ou des algorithmes d'apprentissage automatique, qui sont encore plus affect√©s par cela.  Nous avons d√©j√† vu comment divers fournisseurs de rapports payants sur les activit√©s des groupes APT ajoutent accidentellement des √©chantillons tout √† fait l√©gitimes aux listes de MD5 malveillants.  M√™me si les rapports de menace pay√©s contiennent des indicateurs de faible qualit√©, que pouvons-nous dire des indicateurs obtenus gr√¢ce au renseignement dans des sources ouvertes.  Les analystes TI ne v√©rifient pas toujours les indicateurs qu'ils cr√©ent pour les faux positifs, car une telle v√©rification tombe sur les √©paules du consommateur. <br><br>  Par exemple, si vous avez re√ßu l'adresse IP de la prochaine modification Zeus ou Dimnie, avant de l'utiliser dans des syst√®mes de d√©tection, <u>v√©rifiez si elle fait partie de l'h√©bergement ou du service qui indique votre IP</u> .  Sinon, il sera d√©sagr√©able d'analyser un grand nombre de faux positifs lorsque les utilisateurs d'un site h√©berg√© sur cet h√©bergement iront sur des sites totalement inoffensifs.  Une v√©rification similaire peut √™tre facilement effectu√©e avec: <br><br><ol><li>  Services de cat√©gorisation qui vous renseigneront sur la nature des activit√©s du site.  Par exemple, ipinfo.io √©crit directement le type: ¬´h√©bergement¬ª. </li><li>  Services Reverse IP, qui vous dira combien de domaines sont enregistr√©s sur cette adresse IP.  S'il y en a beaucoup, il est fort probable que vous h√©bergiez des sites. </li></ol><br>  Ainsi, par exemple, le r√©sultat de la v√©rification de l'indicateur ressemble √† celui d'un groupe Cobalt APT (selon le rapport d'un fournisseur TI respect√©): <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/qa/f-/dw/qaf-dw_6qr6st4mkhd6ju0owzzs.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/bc/dk/gy/bcdkgys-vierrjaj2san0gjz79k.png"></div><br>  Nous, sp√©cialistes de la r√©ponse, comprenons que les messieurs de Cobalt doivent avoir utilis√© cette adresse IP.  Cependant, cet indicateur ne pr√©sente aucun avantage - il n'est pas pertinent car il donne trop de faux positifs. <br><br><h3>  Astuce num√©ro 7.  Automatisez tous les processus avec des informations sur les menaces autant que possible.  Commencez par un simple - automatisez enti√®rement la v√©rification des faux positifs √† travers la liste d'arr√™t avec le r√©glage suppl√©mentaire d'indicateurs non stri√©s pour la surveillance dans SIEM </h3><br>  Pour √©viter un grand nombre de faux positifs li√©s √† l'intelligence et obtenus √† partir de sources ouvertes, une recherche pr√©alable de ces indicateurs dans les listes d'arr√™t (listes d'avertissement) peut.  Ces listes peuvent √™tre form√©es sur la base de la notation Alexa (top 1000), des adresses de sous-r√©seaux internes, des domaines de grands fournisseurs de services comme Google, Amazon AWS, MS Azure et d'autres services d'h√©bergement.  Une solution extr√™mement efficace sera √©galement une modification dynamique des listes d'arr√™t comprenant les principaux domaines / adresses IP visit√©s par les employ√©s de l'entreprise au cours de la derni√®re semaine ou du dernier mois. <br><br>  Le d√©veloppement de telles listes et d'un syst√®me de v√©rification peut √™tre difficile pour le SOC moyen, il est donc logique de penser √† mettre en ≈ìuvre les plates-formes dites Threat Intelligence.  Il y a environ six mois, Anti-malware.ru avait un bon <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">aper√ßu des</a> solutions payantes et gratuites de cette classe. <br><br><h3>  Astuce num√©ro 8.  Analyser l'ensemble de l'entreprise pour les indicateurs d'h√¥te, pas seulement les h√¥tes connect√©s √† SIEM </h3><br>  En raison du fait que, en r√®gle g√©n√©rale, tous les h√¥tes d'entreprise ne sont pas connect√©s √† SIEM, il n'est pas possible de rechercher un fichier malveillant avec un nom ou un chemin sp√©cifique en utilisant uniquement la fonctionnalit√© SIEM standard.  Vous pouvez sortir de cette situation des mani√®res suivantes: <br><br><ol><li>  Utilisez des scanners IoC comme <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Loki</a> .  Vous pouvez l'ex√©cuter sur tous les h√¥tes de l'entreprise via le m√™me SCCM et rediriger la sortie vers un dossier r√©seau public. </li><li>  Utilisez des scanners de vuln√©rabilit√©.  Certains d'entre eux ont des modes de conformit√© dans lesquels vous pouvez rechercher un fichier sp√©cifique sur un chemin sp√©cifique. </li><li>  √âcrivez un script PowerShell et ex√©cutez-le via WinRM.  Si vous √©crivez vous-m√™me la paresse, vous pouvez utiliser l'un des nombreux scripts, par exemple, celui- <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ci</a> . </li></ol><br>  Comme je l'ai dit au d√©but, cet article n'implique pas d'informations compl√®tes sur la fa√ßon de fonctionner correctement avec Threat Intelligence.  Cependant, selon notre exp√©rience, suivre m√™me ces r√®gles simples permettra aux d√©butants de ne pas marcher sur le r√¢teau et de commencer imm√©diatement avec un travail efficace avec divers indicateurs de compromis. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr417297/">https://habr.com/ru/post/fr417297/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr417285/index.html">O√π ins√©rer un guillemet dans IPv6</a></li>
<li><a href="../fr417287/index.html">"Calendrier des testeurs" pour juillet. Tests analytiques</a></li>
<li><a href="../fr417289/index.html">Journal du stagiaire: Jour 1. Stagiaire √† junior</a></li>
<li><a href="../fr417293/index.html">R√©cup√©ration de mot de passe et stockage principal dans le cloud, ou Nouveaut√©s de Zimbra 8.8.9</a></li>
<li><a href="../fr417295/index.html">Comment ai-je √©crit la biblioth√®que C ++ 11 standard ou pourquoi boost est si effrayant. Chapitre 3</a></li>
<li><a href="../fr417299/index.html">En ligne, hors ligne et P2P: comment acheter du bitcoin en Russie</a></li>
<li><a href="../fr417301/index.html">Recette de lib√©ration en douceur: PMy Note</a></li>
<li><a href="../fr417303/index.html">Hack pour prendre en charge les boutons du casque Windows Android</a></li>
<li><a href="../fr417305/index.html">Ultima Online: un look backstage</a></li>
<li><a href="../fr417307/index.html">Glaucome - vous n'avez pas entendu parler d'elle? Rencontrez le tueur en s√©rie de la vision silencieuse</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>