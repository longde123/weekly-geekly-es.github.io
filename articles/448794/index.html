<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üé™ üìπ ‚úäüèø Prueba de Python con pytest. Complementos CAP√çTULO 5 üßúüèæ üíü ‚óªÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Atr√°s Siguiente 


 Un potente Pytest desde el primer momento, se pone a√∫n mejor cuando le agregas una mezcla de complementos. La base de c√≥digo pytes...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Prueba de Python con pytest. Complementos CAP√çTULO 5</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/448794/"><p><img src="https://habrastorage.org/webt/jl/jn/bb/jljnbbjr-ejh473xy_eccsmknpk.png">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Atr√°s</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Siguiente</a> <img src="https://habrastorage.org/webt/rw/dy/-g/rwdy-grsvbpcetjttrmecdkxtlk.png"></p><br><p>  <em>Un potente Pytest desde el primer momento, se pone a√∫n mejor cuando le agregas una mezcla de complementos.</em>  <em>La base de c√≥digo pytest est√° estructurada por configuraciones y extensiones, y hay ganchos disponibles para modificaciones y mejoras a trav√©s de complementos.</em> </p><br><p><img src="https://habrastorage.org/webt/hd/--/9w/hd--9w134j0rxhmxftrflbbdopy.png"></p><a name="habracut"></a><br><p>  Los ejemplos en este libro est√°n escritos usando Python 3.6 y pytest 3.2.  pytest 3.2 es compatible con Python 2.6, 2.7 y Python 3.3+. </p><br><blockquote> El c√≥digo fuente para el proyecto Tareas, as√≠ como para todas las pruebas que se muestran en este libro, est√° disponible en el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" title="https://pragprog.com/titles/bopytest/source_code">enlace</a> en la p√°gina web del libro en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" title="https://pragprog.com/titles/bopytest">pragprog.com</a> .  No necesita descargar el c√≥digo fuente para comprender el c√≥digo de prueba;  El c√≥digo de prueba se presenta de forma conveniente en los ejemplos.  Pero para seguir las tareas del proyecto o adaptar ejemplos de prueba para probar su propio proyecto (¬°sus manos est√°n desatadas!), Debe ir a la p√°gina web del libro y descargar el trabajo.  All√≠, en la p√°gina web del libro, hay un enlace para mensajes de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" title="https://pragprog.com/titles/bopytest/errata">erratas</a> y un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" title="https://forums.pragprog.com/forums/438">foro de discusi√≥n</a> . </blockquote><p>  Debajo del spoiler hay una lista de art√≠culos en esta serie. </p><br><div class="spoiler">  <b class="spoiler_title">Tabla de contenidos</b> <div class="spoiler_text"><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><strong>Introduccion</strong></a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><strong>Cap√≠tulo 1: comenzando con pytest</strong></a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><strong>Cap√≠tulo 2: Funciones de prueba de escritura</strong></a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><strong>Cap√≠tulo 3: accesorios de Pytest</strong></a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><strong>Cap√≠tulo 4: Accesorios incorporados</strong></a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><strong>Cap√≠tulo 5: Complementos</strong></a> (este art√≠culo) </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><strong>Cap√≠tulo 6: Configuraci√≥n</strong></a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><strong>Cap√≠tulo 7: Uso de pytest con otras herramientas</strong></a> </li></ul></div></div><br><h2 id="poehali-dalshe">  ¬°Vamos m√°s all√°! </h2><br><p> Es posible que se sorprenda al saber que ya ha escrito algunos complementos si trabaj√≥ en los cap√≠tulos anteriores de este libro.  Cada vez que coloca accesorios y / o funciones de <code>conftest.py</code> archivo <code>conftest.py</code> nivel <code>conftest.py</code> del proyecto, crea un complemento de <code>conftest</code> local.  Es solo un peque√±o trabajo adicional convertir estos archivos <code>conftest.py</code> en complementos instalables que puede compartir entre proyectos, con otras personas o con el mundo. </p><br><p>  Comenzamos este cap√≠tulo respondiendo a la pregunta de d√≥nde buscar complementos de terceros.  Hay bastantes complementos disponibles, por lo que hay una buena posibilidad de que alguien ya haya escrito los cambios que desea realizar en <code>pytest</code> .  Dado que consideraremos los complementos de c√≥digo abierto, si el complemento hace casi lo que desea hacer, pero no del todo, puede desarrollarlo o utilizarlo como referencia para crear su propio complemento.  Aunque este cap√≠tulo trata sobre la creaci√≥n de sus propios complementos, se incluye el Ap√©ndice 3, el complemento <em>Sampler Pack</em> , en la p√°gina 163 para darle una idea de lo que es posible. </p><br><p>  En este cap√≠tulo aprender√° c√≥mo crear complementos y le mostrar√© la direcci√≥n correcta para realizar pruebas, empaques y distribuci√≥n.  El tema completo de empaquetado y distribuci√≥n de Python es demasiado extenso y pretende ser su propio libro, por lo que no cubriremos todo.  Pero obtendr√° suficiente informaci√≥n para poder intercambiar complementos con su equipo.  Tambi√©n hablar√© sobre algunas formas simples de crear complementos con soporte para PyPI y la menor cantidad de trabajo. </p><br><h2 id="poisk-plaginov">  Buscar complementos </h2><br><p>  Puede encontrar complementos de pytest de terceros en varios lugares.  Los complementos enumerados en el Ap√©ndice 3, Paquete de muestra de complementos, en la p√°gina 163, est√°n disponibles para su descarga desde PyPI.  Sin embargo, este no es el √∫nico lugar para encontrar excelentes complementos de pytest. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://docs.pytest.org/en/latest/plugins.html</a> </p><br><p>  El sitio principal de documentaci√≥n de pytest tiene una p√°gina que habla sobre la instalaci√≥n y el uso de complementos de pytest y enumera algunos complementos comunes. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://pypi.python.org</a> </p><br><p>  El Python Package Index (PyPI) es un excelente lugar para obtener muchos paquetes de Python, pero tambi√©n es un excelente lugar para buscar complementos de pytest.  Al buscar complementos de pytest, simplemente ingrese "pytest", "pytest -" o "-pytest" en el campo de b√∫squeda, ya que la mayor√≠a de los complementos de pytest comienzan con "pytest -" o terminan con "-pytest". </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://github.com/pytest-dev</a> </p><br><p>  El grupo pytest-dev en GitHub es donde se almacena el c√≥digo fuente de pytest.  Adem√°s, aqu√≠ puede encontrar complementos populares de pytest que el equipo del n√∫cleo de pytest deber√≠a admitir a largo plazo. </p><br><h2 id="ustanovka-plaginov">  Instalaci√≥n de complementos </h2><br><p>  Los complementos de Pytest se instalan con pip, como otros paquetes de Python.  Sin embargo <br>  puedes usar pip de varias maneras para instalar complementos. </p><br><h3 id="ustanovka-iz-pypi">  Instalar desde PyPI </h3><br><p>  Dado que PyPI es la ubicaci√≥n predeterminada para pip, la instalaci√≥n de complementos desde PyPI es el m√©todo m√°s f√°cil.  <code>pytest-cov</code> complemento <code>pytest-cov</code> : </p><br><pre> <code class="plaintext hljs">$ pip install pytest-cov</code> </pre> <br><p>  Se instalar√° la √∫ltima versi√≥n estable de PyPI. </p><br><h3 id="ustanovka-opredelennoy-versii-iz-pypi">  Instalar una versi√≥n espec√≠fica desde PyPI </h3><br><p>  Si desea una versi√≥n espec√≠fica del complemento, puede especificar la versi√≥n despu√©s de <code>==</code> : </p><br><pre> <code class="plaintext hljs">$ pip install pytest-cov==2.4.0</code> </pre> <br><h3 id="ustanovka-iz-fayla-targz-ili-whl">  Instalar desde un archivo .tar.gz o .whl </h3><br><p>  Los paquetes PyPI se distribuyen como archivos zip con las extensiones <code>.tar.gz</code> y / o <code>.whl</code> .  A menudo se les conoce como bolas y ruedas de alquitr√°n.  Si tiene problemas para tratar de trabajar con PyPI directamente (lo que puede suceder con los firewalls y otras complicaciones de la red), puede descargar <code>.tar.gz</code> o <code>.whl</code> e instalar desde esto o aquello. </p><br><p>  No necesita desempacar o bailar con una pandereta;  solo ap√∫ntele pip: </p><br><pre> <code class="plaintext hljs">$ pip install pytest-cov-2.4.0.tar.gz # or $ pip install pytest_cov-2.4.0-py2.py3-none-any.whl</code> </pre> <br><h3 id="ustanovka-iz-lokalnogo-kataloga">  Instalaci√≥n desde el directorio local </h3><br><p>  Puede tener los complementos para complementos (y otros paquetes de Python) en un directorio local o compartido en <code>.whl</code> <code>.tar.gz</code> o <code>.whl</code> y usar esto en lugar de PyPI para instalar complementos: </p><br><pre> <code class="plaintext hljs">$ mkdir some_plugins $ cp pytest_cov-2.4.0-py2.py3-none-any.whl some_plugins/ $ pip install --no-index --find-links=./some_plugins/ pytest-cov</code> </pre> <br><p>  <code>--no-index</code> le dice a <code>pip</code> no se conecte a PyPI.  <code>--find-links=./some_plugins/</code> le dice a pip que busque en el directorio <code>some_plugins</code> .  Este m√©todo es especialmente √∫til si tiene complementos nativos y de terceros almacenados localmente, as√≠ como si est√° creando nuevos entornos virtuales para una integraci√≥n continua o con tox.  (Hablaremos sobre tox e integraci√≥n continua en el cap√≠tulo 7, usando pytest con otras herramientas, en la p√°gina 125). </p><br><p>  Tenga en cuenta que con el m√©todo de instalaci√≥n del directorio local puede instalar varias versiones y especificar qu√© versi√≥n desea agregando == y el n√∫mero de versi√≥n: </p><br><pre> <code class="plaintext hljs">$ pip install --no-index --find-links=./some_plugins/ pytest-cov==2.4.0</code> </pre> <br><h3 id="ustanovka-iz-repozitoriya-git">  Instalar desde el repositorio de Git </h3><br><p>  Puede instalar complementos directamente desde el repositorio de Git en este caso GitHub: </p><br><pre> <code class="plaintext hljs">$ pip install git+https://github.com/pytest-dev/pytest-cov</code> </pre> <br><p>  Tambi√©n puede especificar la etiqueta de versi√≥n: </p><br><pre> <code class="plaintext hljs">$ pip install git+https://github.com/pytest-dev/pytest-cov@v2.4.0</code> </pre> <br><p>  O puede especificar una rama: </p><br><pre> <code class="plaintext hljs">$ pip install git+https://github.com/pytest-dev/pytest-cov@master</code> </pre> <br><p>  La instalaci√≥n desde el repositorio de Git es especialmente √∫til si est√° almacenando su propio trabajo en Git o si falta la versi√≥n requerida del complemento o complemento de PyPI. </p><br><blockquote>  <em>Nota del traductor:</em> <br><br>  pip admite la instalaci√≥n desde Git, Mercurial, Subversion y Bazaar y define el tipo de VCS utilizando los prefijos de url: "git +", "hg +", "svn +", "bzr +". <br>  Consulte la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">documentaci√≥n de PyPI para</a> m√°s detalles. </blockquote><br><h2 id="napisanie-sobstvennyh-plaginov">  Escribiendo tus propios complementos </h2><br><p>  Muchos complementos de terceros contienen mucho c√≥digo.  Esta es una de las razones por las que los usamos para ahorrarnos tiempo desarrollando todo esto por nuestra cuenta.  Sin embargo, para su c√≥digo espec√≠fico, sin duda obtendr√° accesorios especiales y modificaciones para ayudarlo a probarlo.  Al crear un complemento, puede compartir f√°cilmente incluso varios accesorios que desee compartir entre varios proyectos.  Puede compartir estos cambios con varios proyectos, y posiblemente con el resto del mundo, desarrollando y distribuyendo sus propios complementos.  Esto es bastante f√°cil de hacer.  En esta secci√≥n, desarrollaremos una peque√±a modificaci√≥n del comportamiento de pytest, lo empaquetaremos como un complemento, lo probaremos y consideraremos c√≥mo distribuirlo. </p><br><p>  Los complementos pueden incluir funciones de enlace que modifican el comportamiento de pytest.  Dado que pytest fue dise√±ado para permitir que los complementos cambien ligeramente el comportamiento de pytest, hay muchas funciones de enlace disponibles.  los ganchos para pytest se enumeran en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">el sitio de documentaci√≥n de pytest</a> .  En nuestro ejemplo, crearemos un complemento que cambiar√° la apariencia del estado de la prueba.  Agregue un par√°metro de l√≠nea de comando para habilitar este nuevo comportamiento.  Agregue texto al encabezado de salida.  En particular, cambiaremos todos los indicadores de estado FALLIDO (fallido) a "OPORTUNIDAD (prospectiva) para mejorar", cambiaremos F a O y agregaremos "Gracias por ejecutar las pruebas" al encabezado.  Para hacer esto, usaremos la opci√≥n <code>--nice</code> . </p><br><p>  Para mantener los cambios de comportamiento separados de la discusi√≥n sobre la mec√°nica de los complementos, realizaremos cambios en conftest.py antes de convertirlo en un complemento redistribuible.  No necesita ejecutar complementos de esta manera.  Pero a menudo, los cambios que pretend√≠a utilizar en un solo proyecto ser√°n lo suficientemente √∫tiles como para compartirlos y convertirlos en un complemento.  Por lo tanto, comenzamos agregando funcionalidad al archivo conftest.py, y luego, despu√©s de que todo funciona en conftest.py, movemos el c√≥digo al paquete. </p><br><p>  De vuelta al proyecto Tareas.  En la secci√≥n "Esperando excepciones" en la p√°gina 30, escribimos varias pruebas que verificaban si se generaban excepciones si alguien llamaba incorrectamente a la funci√≥n API.  Parece que hemos perdido al menos algunos posibles estados de error. </p><br><p>  Aqu√≠ hay un par de pruebas m√°s: </p><br><blockquote>  <strong>ch5 / a / task_proj / tests / func / test_api_exceptions.py</strong> </blockquote><br><pre> <code class="python hljs"><span class="hljs-string"><span class="hljs-string">"""     API wrong."""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pytest <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> tasks <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> tasks <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Task @pytest.mark.usefixtures(<span class="hljs-string"><span class="hljs-string">'tasks_db'</span></span>) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestAdd</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">()</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-string"><span class="hljs-string">""",   tasks.add()."""</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_missing_summary</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""  ,  summary missing."""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> pytest.raises(ValueError): tasks.add(Task(owner=<span class="hljs-string"><span class="hljs-string">'bob'</span></span>)) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_done_not_bool</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""  ,  done   bool."""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> pytest.raises(ValueError): tasks.add(Task(summary=<span class="hljs-string"><span class="hljs-string">'summary'</span></span>, done=<span class="hljs-string"><span class="hljs-string">'True'</span></span>))</code> </pre><br><p>  Ejec√∫telos para verificar si pasan: </p><br><pre> <code class="plaintext hljs">$ cd /path/to/code/ch5/a/tasks_proj $ pytest ===================== test session starts ====================== collected 57 items tests/func/test_add.py ... tests/func/test_add_variety.py ............................ tests/func/test_add_variety2.py ............ tests/func/test_api_exceptions.py .F....... tests/func/test_unique_id.py . tests/unit/test_task.py .... =========================== FAILURES =========================== __________________ TestAdd.test_done_not_bool __________________ self = &lt;func.test_api_exceptions.TestAdd object at 0x103a71a20&gt; def test_done_not_bool(self): """Should raise an exception if done is not a bool.""" with pytest.raises(ValueError): &gt; tasks.add(Task(summary='summary', done='True')) E Failed: DID NOT RAISE &lt;class 'ValueError'&gt; tests/func/test_api_exceptions.py:20: Failed ============= 1 failed, 56 passed in 0.28 seconds ==============</code> </pre><br><p>  Vamos a ejecutarlo nuevamente con <code>-v</code> para m√°s detalles.  Como ya has visto el rastro, puedes desactivarlo presionando <code>--tb=no</code> . </p><br><p>  Ahora centr√©monos en las nuevas pruebas con <code>-k TestAdd</code> , que funciona porque no hay otras pruebas con nombres que contengan "TestAdd". </p><br><p>  Podr√≠amos "dejar todo" e intentar arreglar esta prueba (y lo haremos m√°s tarde), pero ahora nos centraremos en tratar de hacer que las fallas sean m√°s agradables para los desarrolladores. </p><br><p>  Comencemos agregando un mensaje de agradecimiento al encabezado, que puede hacer con un gancho de <code>pytest_report_header()</code> llamado <code>pytest_report_header()</code> . </p><br><blockquote>  <strong>ch5 / b / task_proj / tests / conftest.py</strong> </blockquote><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pytest_report_header</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""    ."""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Thanks for running the tests."</span></span></code> </pre> <br><p>  Obviamente, escribir una nota de agradecimiento es bastante est√∫pido.  Sin embargo, la capacidad de agregar informaci√≥n al encabezado se puede ampliar.  Puede agregar un nombre de usuario, indicar el equipo utilizado y las versiones a probar.  En general, todo lo que puede convertir en una cadena se puede insertar en el t√≠tulo de la prueba. </p><br><p>  Luego cambiaremos el informe de estado de la prueba para cambiar <code>F</code> a <code>O</code> y <code>FAILED</code> a <code>OPPORTUNITY for improvement</code> .  Hay un gancho que permite este asunto: <code>pytest_report_teststatus()</code> : </p><br><blockquote>  <strong>ch5 / b / task_proj / tests / conftest.py</strong> </blockquote><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pytest_report_teststatus</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(report)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""   ."""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> report.when == <span class="hljs-string"><span class="hljs-string">'call'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> report.failed: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (report.outcome, <span class="hljs-string"><span class="hljs-string">'O'</span></span>, <span class="hljs-string"><span class="hljs-string">'OPPORTUNITY for improvement'</span></span>)</code> </pre> <br><p>  Y ahora tenemos la soluci√≥n que est√°bamos buscando.  Una sesi√≥n de prueba sin el indicador <code>--verbose</code> muestra <code>O</code> para fallas, es decir, son posibles mejoras: </p><br><pre> <code class="plaintext hljs">$ cd /path/to/code/ch5/b/tasks_proj/tests/func $ pytest --tb=no test_api_exceptions.py -k TestAdd ===================== test session starts ====================== Thanks for running the tests. collected 9 items test_api_exceptions.py .O ====================== 7 tests deselected ====================== ======= 1 failed, 1 passed, 7 deselected in 0.06 seconds =======</code> </pre> <br><p>  Con la bandera <code>-v</code> o <code>--verbose</code> ser√≠a mejor: </p><br><pre> <code class="plaintext hljs">$ pytest -v --tb=no test_api_exceptions.py -k TestAdd ===================== test session starts ====================== Thanks for running the tests. collected 9 items test_api_exceptions.py::TestAdd::test_missing_summary PASSED test_api_exceptions.py::TestAdd::test_done_not_bool OPPORTUNITY for improvement ====================== 7 tests deselected ====================== ======= 1 failed, 1 passed, 7 deselected in 0.07 seconds =======</code> </pre> <br><p>  El √∫ltimo cambio que haremos es agregar un par√°metro de l√≠nea de comando, <code>--nice,</code> para que los cambios en nuestro estado solo ocurran si sustituye <code>--nice</code> : </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pytest_addoption</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(parser)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">""" nice    --nice."""</span></span> group = parser.getgroup(<span class="hljs-string"><span class="hljs-string">'nice'</span></span>) group.addoption(<span class="hljs-string"><span class="hljs-string">"--nice"</span></span>, action=<span class="hljs-string"><span class="hljs-string">"store_true"</span></span>, help=<span class="hljs-string"><span class="hljs-string">"nice: turn failures into opportunities"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pytest_report_header</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""    ."""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> pytest.config.getoption(<span class="hljs-string"><span class="hljs-string">'nice'</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Thanks for running the tests."</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pytest_report_teststatus</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(report)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""   ."""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> report.when == <span class="hljs-string"><span class="hljs-string">'call'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> report.failed <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> pytest.config.getoption(<span class="hljs-string"><span class="hljs-string">'nice'</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (report.outcome, <span class="hljs-string"><span class="hljs-string">'O'</span></span>, <span class="hljs-string"><span class="hljs-string">'OPPORTUNITY for improvement'</span></span>)</code> </pre><br><p>  Vale la pena se√±alar que para este complemento usamos solo un par de ganchos.  Hay muchos otros que se pueden encontrar en el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">sitio principal de documentaci√≥n de Pytest</a> . </p><br><p>  Ahora podemos probar manualmente nuestro complemento simplemente ejecut√°ndolo en nuestro ejemplo.  Primero, sin la opci√≥n <code>--nice</code> , para asegurarse de que solo se muestre el nombre de usuario: </p><br><pre> <code class="plaintext hljs">$ cd /path/to/code/ch5/c/tasks_proj/tests/func $ pytest --tb=no test_api_exceptions.py -k TestAdd ===================== test session starts ====================== collected 9 items test_api_exceptions.py .F ====================== 7 tests deselected ====================== ======= 1 failed, 1 passed, 7 deselected in 0.07 seconds =======</code> </pre><br><p>  Ahora con <code>--nice</code> : </p><br><pre> <code class="plaintext hljs">$ pytest --nice --tb=no test_api_exceptions.py -k TestAdd ===================== test session starts ====================== Thanks for running the tests. collected 9 items test_api_exceptions.py .O ====================== 7 tests deselected ====================== ======= 1 failed, 1 passed, 7 deselected in 0.07 seconds =======</code> </pre> <br><p>  Ahora con <code>--nice</code> y <code>--verbose</code> : </p><br><pre> <code class="plaintext hljs">$ pytest -v --nice --tb=no test_api_exceptions.py -k TestAdd ===================== test session starts ====================== Thanks for running the tests. collected 9 items test_api_exceptions.py::TestAdd::test_missing_summary PASSED test_api_exceptions.py::TestAdd::test_done_not_bool OPPORTUNITY for improvement ====================== 7 tests deselected ====================== ======= 1 failed, 1 passed, 7 deselected in 0.06 seconds =======</code> </pre> <br><p>  Genial  Todos los cambios que quer√≠amos hacer se realizaron en aproximadamente diez l√≠neas de c√≥digo para el archivo <code>conftest.py</code> .  A continuaci√≥n, trasladaremos este c√≥digo a la estructura del complemento. </p><br><h2 id="sozdanie-ustanavlivaemogo-plagina">  Crear un complemento instalable </h2><br><p>  El proceso de compartir complementos con otros usuarios est√° claramente definido.  Incluso si nunca incluye su propio complemento en PyPI, pasar por este proceso le facilitar√° la lectura del c√≥digo de los complementos de c√≥digo abierto, y tendr√° m√°s oportunidades de evaluar si le ayudar√°n o no. </p><br><p>  Ser√≠a superfluo cubrir completamente el empaque y la distribuci√≥n de los paquetes de Python en este libro, ya que este tema est√° bien documentado en otra parte.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Aqu√≠</a> y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> en ruso.  Sin embargo, pasar del complemento de configuraci√≥n local que creamos en la secci√≥n anterior a algo instalado usando pip no es gran cosa.  , </p><br><p>  Primero, necesitamos crear un nuevo directorio para alojar nuestro c√≥digo de complemento.  No importa c√≥mo lo llames, pero como estamos creando un complemento para la bandera agradable, vamos a llamarlo pytest-nice.  Tendremos dos archivos en este nuevo directorio: pytest_nice.py y setup.py.  (El cat√°logo de prueba se analizar√° en la secci√≥n "Complementos de prueba" en la p√°gina 105). </p><br><pre> <code class="plaintext hljs">‚îÇ LICENSE ‚îÇ pytest_nice.py ‚îÇ setup.py ‚îÇ ‚îî‚îÄ‚îÄ‚îÄtests ‚îÇ conftest.py ‚îÇ test_nice.py</code> </pre><br><p>  En <code>pytest_nice.py</code> , colocamos el contenido exacto de nuestro conftest.py que estaba asociado con esta funci√≥n (y lo extraemos de <code>tasks_proj/tests/conftest.py</code> ): </p><br><p>  <strong>ch5 / pytest-nice / pytest_nice.py</strong> </p><br><pre> <code class="python hljs"><span class="hljs-string"><span class="hljs-string">"""  pytest-nice ."""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pytest <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pytest_addoption</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(parser)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">""" nice    --nice."""</span></span> group = parser.getgroup(<span class="hljs-string"><span class="hljs-string">'nice'</span></span>) group.addoption(<span class="hljs-string"><span class="hljs-string">"--nice"</span></span>, action=<span class="hljs-string"><span class="hljs-string">"store_true"</span></span>, help=<span class="hljs-string"><span class="hljs-string">"nice: turn FAILED into OPPORTUNITY for improvement"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pytest_report_header</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""    ."""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> pytest.config.getoption(<span class="hljs-string"><span class="hljs-string">'nice'</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Thanks for running the tests."</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pytest_report_teststatus</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(report)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""   ."""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> report.when == <span class="hljs-string"><span class="hljs-string">'call'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> report.failed <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> pytest.config.getoption(<span class="hljs-string"><span class="hljs-string">'nice'</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (report.outcome, <span class="hljs-string"><span class="hljs-string">'O'</span></span>, <span class="hljs-string"><span class="hljs-string">'OPPORTUNITY for improvement'</span></span>)</code> </pre> <br><p>  En <code>setup.py</code> necesitamos la llamada m√≠nima a <code>setup()</code> : </p><br><blockquote>  <strong>ch5 / pytest-nice / setup.py</strong> </blockquote><br><pre> <code class="python hljs"><span class="hljs-string"><span class="hljs-string">"""Setup  pytest-nice plugin."""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> setuptools <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> setup setup( name=<span class="hljs-string"><span class="hljs-string">'pytest-nice'</span></span>, version=<span class="hljs-string"><span class="hljs-string">'0.1.0'</span></span>, description=<span class="hljs-string"><span class="hljs-string">' Pytest,   FAILURE into OPPORTUNITY'</span></span>, url=<span class="hljs-string"><span class="hljs-string">'https:////////'</span></span>, author=<span class="hljs-string"><span class="hljs-string">' '</span></span>, author_email=<span class="hljs-string"><span class="hljs-string">'your_email@somewhere.com'</span></span>, license=<span class="hljs-string"><span class="hljs-string">'proprietary'</span></span>, py_modules=[<span class="hljs-string"><span class="hljs-string">'pytest_nice'</span></span>], install_requires=[<span class="hljs-string"><span class="hljs-string">'pytest'</span></span>], entry_points={<span class="hljs-string"><span class="hljs-string">'pytest11'</span></span>: [<span class="hljs-string"><span class="hljs-string">'nice = pytest_nice'</span></span>, ], }, )</code> </pre> <br><p>  Necesitar√° m√°s informaci√≥n en la configuraci√≥n si la va a distribuir a un p√∫blico amplio o en Internet.  Sin embargo, para un equipo peque√±o o solo para usted, esto ser√° suficiente. </p><br><p>  Puede incluir algunos otros par√°metros para la <code>setup()</code> ;  y aqu√≠ solo tenemos los campos obligatorios.  El campo de versi√≥n es la versi√≥n de este complemento.  Y depende totalmente de usted cuando aparezca la versi√≥n.  El campo URL es obligatorio.  Puede dejarlo en blanco, pero recibir√° una advertencia.  Los <code>author_email</code> <code>author</code> y <code>author_email</code> se pueden reemplazar con <code>maintainer</code> y <code>maintainer_email</code> , pero uno de estos pares deber√≠a estar all√≠.  El campo de <code>license</code> es un campo de texto corto.  Podr√≠a ser una de las muchas licencias de c√≥digo abierto, su nombre o empresa, o algo adecuado para usted.  La <code>py_modules</code> enumera <code>pytest_nice</code> como nuestro √∫nico m√≥dulo para este complemento.  Aunque esta es una lista, y puede incluir m√°s de un m√≥dulo, si tuviera m√°s de uno, usar√≠a el paquete y colocar√≠a todos los m√≥dulos en un directorio. </p><br><p>  Hasta ahora, todas las opciones de <code>setup()</code> son est√°ndar y son utilizadas por todos los instaladores de Python.  La parte que es diferente para los complementos de Pytest es el par√°metro <code>entry_points</code> .  Hemos enumerado <code>entry_points={'pytest11': ['nice = pytest_nice', ], },.</code>  La funci√≥n <code>entry_points</code> es est√°ndar para <code>setuptools</code> , pero pytest11 es el identificador especial que pytest est√° buscando.  En esta l√≠nea, le decimos a pytest que <code>nice</code> es el nombre de nuestro complemento, y <code>pytest_nice</code> nombre del m√≥dulo en el que vive nuestro complemento.  Si utilizamos el paquete, nuestra entrada aqu√≠ ser√≠a: </p><br><p>  Todav√≠a no he hablado sobre el archivo <code>README.rst</code> .  Alguna forma de README es un requisito de setuptools.  Si te lo pierdes, obtendr√°s esto: </p><br><pre> <code class="plaintext hljs">... warning: sdist: standard file not found: should have one of README, README.rst, README.txt ...</code> </pre><br><p>  Mantener README como la forma est√°ndar de incluir informaci√≥n del proyecto es una buena idea de todos modos.  Esto es lo que puse en el archivo para pytest-nice: </p><br><blockquote>  <strong>ch5 / pytest-nice / README.rst</strong> </blockquote><br><pre> <code class="plaintext hljs">pytest-nice : A pytest plugin =============================   pytest     .  -------- -   ,     pytest. -  ``--nice`` , : -  ``F``  ``O`` -  ``-v``,  ``FAILURE``  ``OPPORTUNITY for improvement``  ------------ ,    Pytest    .tar.gz    PATH,  : :: $ pip install PATH/pytest-nice-0.1.0.tar.gz $ pip install --no-index --find-links PATH pytest-nice  ----- :: $ pytest --nice</code> </pre><br><p>  Hay muchas opiniones sobre lo que deber√≠a estar en el archivo README.  Esta es una versi√≥n muy recortada, pero funciona. </p><br><h2 id="testirovanie-plaginov">  Complementos de prueba </h2><br><p>  Los complementos son c√≥digos que deben probarse como cualquier otro c√≥digo.  Sin embargo, probar los cambios en una herramienta de prueba es un poco m√°s complicado.  Cuando desarrollamos el c√≥digo del complemento en la secci√≥n "Escribir sus propios complementos", en la p√°gina 98, lo verificamos manualmente usando un archivo de prueba de muestra, ejecutando pytest con √©l y verificando la salida para asegurarnos de que fuera correcto.  Podemos hacer lo mismo en modo autom√°tico usando un complemento llamado <code>pytester</code> , que viene con pytest pero est√° deshabilitado de forma predeterminada. </p><br><p>  Hay dos archivos en nuestro directorio de prueba para pytest-nice: <code>conftest.py</code> y <code>test_nice.py</code> .  Para usar <code>pytester</code> , necesitamos agregar solo una l√≠nea a <code>conftest.py</code> : </p><br><blockquote>  <strong>ch5 / pytest-nice / tests / conftest.py</strong> </blockquote><br><pre> <code class="python hljs"><span class="hljs-string"><span class="hljs-string">"""pytester is needed for testing plugins."""</span></span> pytest_plugins = <span class="hljs-string"><span class="hljs-string">'pytester'</span></span></code> </pre> <br><p>  Esta l√≠nea incluye el complemento <code>pytester</code> .  Utilizaremos un dispositivo llamado <code>testdir</code> , que estar√° disponible cuando <code>pytester</code> encienda <code>pytester</code> . <br>  A menudo, las pruebas para complementos toman la forma que describimos manualmente: </p><br><ol><li>  Haz un archivo de prueba de ejemplo. </li><li>  Ejecute pytest con o sin algunos par√°metros en el directorio que contiene el archivo de muestra. </li><li>  Verifique la salida. </li><li>  Posible, para verificar el c√≥digo de resultado es 0 para todos los pases, 1 para algunos fallos. </li></ol><br><p>  Veamos un ejemplo: </p><br><blockquote>  <strong>ch5 / pytest-nice / tests / test_nice.py</strong> </blockquote><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_pass_fail</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(testdir)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment">#     Pytest testdir.makepyfile(""" def test_pass(): assert 1 == 1 def test_fail(): assert 1 == 2 """) #  pytest result = testdir.runpytest() # fnmatch_lines    result.stdout.fnmatch_lines([ '*.F', # .  Pass, F  Fail ]) # ,      '1'  testsuite assert result.ret == 1</span></span></code> </pre> <br><p>  Fixture <code>testdir</code> crea autom√°ticamente un directorio temporal para alojar archivos de prueba.  Tiene un m√©todo <code>makepyfile()</code> que le permite colocar el contenido de un archivo de prueba. En este caso, creamos dos pruebas: una que <em>pasa</em> y la otra que <em>no pasa</em> . </p><br><p>  Ejecutamos pytest para un nuevo archivo de prueba usando <code>testdir.runpytest()</code> .  Puede pasar par√°metros si lo desea.  El valor de retorno puede considerarse m√°s adelante y es del tipo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">RunResult</a> . </p><br><p>  Por lo general, miro <code>stdout</code> y <code>ret</code> .   ,    ,     ,  <code>fnmatch_lines</code> ,   ,      ,   ,  <code>ret</code>  0     1   . ,   <code>fnmatch_lines</code> ,    .        .  ,    ,   : </p><br><blockquote> <strong>ch5/pytest-nice/tests/test_nice.py</strong> </blockquote><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">@pytest.fixture() def sample_test(testdir): testdir.makepyfile(""" def test_pass(): assert 1 == 1 def test_fail(): assert 1 == 2 """) return testdir</span></span></code> </pre> <br><p> ,   ,    <code>sample_test</code>   ,       .      : </p><br><blockquote> <strong>ch5/pytest-nice/tests/test_nice.py</strong> </blockquote><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_with_nice</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(sample_test)</span></span></span><span class="hljs-function">:</span></span> result = sample_test.runpytest(<span class="hljs-string"><span class="hljs-string">'--nice'</span></span>) result.stdout.fnmatch_lines([<span class="hljs-string"><span class="hljs-string">'*.O'</span></span>, ]) <span class="hljs-comment"><span class="hljs-comment"># . for Pass, O for Fail assert result.ret == 1 def test_with_nice_verbose(sample_test): result = sample_test.runpytest('-v', '--nice') result.stdout.fnmatch_lines([ '*::test_fail OPPORTUNITY for improvement', ]) assert result.ret == 1 def test_not_nice_verbose(sample_test): result = sample_test.runpytest('-v') result.stdout.fnmatch_lines(['*::test_fail FAILED']) assert result.ret == 1</span></span></code> </pre> <br><p>     .  ,       : </p><br><blockquote> <strong>ch5/pytest-nice/tests/test_nice.py</strong> </blockquote><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_header</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(sample_test)</span></span></span><span class="hljs-function">:</span></span> result = sample_test.runpytest(<span class="hljs-string"><span class="hljs-string">'--nice'</span></span>) result.stdout.fnmatch_lines([<span class="hljs-string"><span class="hljs-string">'Thanks for running the tests.'</span></span>]) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_header_not_nice</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(sample_test)</span></span></span><span class="hljs-function">:</span></span> result = sample_test.runpytest() thanks_message = <span class="hljs-string"><span class="hljs-string">'Thanks for running the tests.'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> thanks_message <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> result.stdout.str()</code> </pre><br><p>       ,        ,      . </p><br><p>    : </p><br><blockquote> <strong>ch5/pytest-nice/tests/test_nice.py</strong> </blockquote><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_help_message</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(testdir)</span></span></span><span class="hljs-function">:</span></span> result = testdir.runpytest(<span class="hljs-string"><span class="hljs-string">'--help'</span></span>) <span class="hljs-comment"><span class="hljs-comment"># fnmatch_lines    result.stdout.fnmatch_lines([ 'nice:', '*--nice*nice: turn FAILED into OPPORTUNITY for improvement', ])</span></span></code> </pre> <br><p>  ,     , ,    . </p><br><p>         <code>pytest-nice</code>  ,    .       <code>.zip.gz</code> ,       : </p><br><pre> <code class="plaintext hljs">$ cd /path/to/code/ch5/pytest-nice/ $ pip install . Processing /path/to/code/ch5/pytest-nice Requirement already satisfied: pytest in /path/to/venv/lib/python3.6/site-packages (from pytest-nice==0.1.0) Requirement already satisfied: py&gt;=1.4.33 in /path/to/venv/lib/python3.6/site-packages (from pytest-&gt;pytest-nice==0.1.0) Requirement already satisfied: setuptools in /path/to/venv/lib/python3.6/site-packages (from pytest-&gt;pytest-nice==0.1.0) Building wheels for collected packages: pytest-nice Running setup.py bdist_wheel for pytest-nice ... done ... Successfully built pytest-nice Installing collected packages: pytest-nice Successfully installed pytest-nice-0.1.0</code> </pre> <br><p> ,   ,   : </p><br><pre> <code class="plaintext hljs">$ pytest -v ===================== test session starts ====================== plugins: nice-0.1.0 collected 7 items tests/test_nice.py::test_pass_fail PASSED tests/test_nice.py::test_with_nice PASSED tests/test_nice.py::test_with_nice_verbose PASSED tests/test_nice.py::test_not_nice_verbose PASSED tests/test_nice.py::test_header PASSED tests/test_nice.py::test_header_not_nice PASSED tests/test_nice.py::test_help_message PASSED =================== 7 passed in 0.34 seconds ===================</code> </pre> <br><blockquote> <strong>. :</strong>    ,    .      . <br><pre> <code class="plaintext hljs">platform win32 -- Python 3.6.5, pytest-3.9.3, py-1.7.0, pluggy-0.8.0 -- c:\venv36\scripts\python.exe collected 7 items tests/test_nice.py::test_pass_fail FAILED [ 14%] tests/test_nice.py::test_with_nice OPPORTUNITY for improvement [ 28%] tests/test_nice.py::test_with_nice_verbose OPPORTUNITY for improvement [ 42%] tests/test_nice.py::test_not_nice_verbose FAILED [ 57%] tests/test_nice.py::test_header PASSED [ 71%] tests/test_nice.py::test_header_not_nice PASSED [ 85%] tests/test_nice.py::test_help_message PASSED [100%] ================================== FAILURES =================================== _______________________________ test_pass_fail ________________________________</code> </pre> <br><br>     <br><pre> <code class="plaintext hljs"> result.stdout.fnmatch_lines([ '*.F', # . for Pass, F for Fail ])</code> </pre> <br><br>  en <br><pre> <code class="plaintext hljs"> result.stdout.fnmatch_lines([ '*.F*', # . for Pass, F for Fail ])</code> </pre> <br><br>   <code>*</code>  <code>F</code> <br><br>       <code>test_with_nice</code> , <code>test_with_nice_verbose</code> , <code>test_not_nice_verbose</code> <br><br>     pytest. <br>    c   <br> <code>'test_with_nice.py .O [100%]'</code> <br>   <code>.</code>        <br>  ,    <br><br> RemovedInPytest4Warning: usage of Session.Class is deprecated, please use pytest.Class instead <br><br>    ! <br><pre> <code class="plaintext hljs">(venv36) c:\_BOOKS_\pytest_si\bopytest-code\code\ch5\pytest-nice&gt;pytest -v ============================= test session starts ============================= platform win32 -- Python 3.6.5, pytest-3.9.3, py-1.7.0, pluggy-0.8.0 -- c:\venv36\scripts\python.exe cachedir: .pytest_cache rootdir: c:\_BOOKS_\pytest_si\bopytest-code\code\ch5\pytest-nice, inifile: plugins: nice-0.1.0 collected 7 items tests/test_nice.py::test_pass_fail PASSED [ 14%] tests/test_nice.py::test_with_nice PASSED [ 28%] tests/test_nice.py::test_with_nice_verbose PASSED [ 42%] tests/test_nice.py::test_not_nice_verbose PASSED [ 57%] tests/test_nice.py::test_header PASSED [ 71%] tests/test_nice.py::test_header_not_nice PASSED [ 85%] tests/test_nice.py::test_help_message PASSED [100%] ============================== warnings summary =============================== tests/test_nice.py::test_pass_fail c:\venv36\lib\site-packages\_pytest\compat.py:332: RemovedInPytest4Warning: usage of Session.Class is deprecated, please use pytest.Class instead return getattr(object, name, default)</code> </pre> <br></blockquote><p>  ¬°Hurra!   .     (pytest-nice),      Python <br>  pytest-: </p><br><pre> <code class="plaintext hljs">$ pip uninstall pytest-nice Uninstalling pytest-nice-0.1.0: Would remove: \path\to\venv\lib\site-packages\pytest_nice-0.1.0.dist-info\* ... Proceed (y/n)? y Successfully uninstalled pytest-nice-0.1.0</code> </pre> <br><p>        ‚Äî   ,     pytest,   PyPI. </p><br><h2 id="sozdanie-distributiva">   </h2><br><p>    ,      . ,         setup.py   : </p><br><pre> <code class="plaintext hljs">$ cd /path/to/code/ch5/pytest-nice $ python setup.py sdist running sdist running egg_info creating pytest_nice.egg-info ... running check creating pytest-nice-0.1.0 ... creating dist Creating tar archive ... $ ls dist pytest-nice-0.1.0.tar.gz</code> </pre> <br><p> ( ,  sdist  <em>source distribution</em> ‚Äî ‚Äú  .‚Äù) </p><br><p>  pytest-nice  dist      <code>pytest-nice-0.1.0.tar.gz</code> . </p><br><p>         ,    ,   : </p><br><pre> <code class="plaintext hljs">$ pip install dist/pytest-nice-0.1.0.tar.gz Processing ./dist/pytest-nice-0.1.0.tar.gz ... Installing collected packages: pytest-nice Successfully installed pytest-nice-0.1.0</code> </pre> <br><p>       <code>.tar.gz</code>   ,       . </p><br><h2 id="rasprostranenie-plaginov-cherez-obschiy-katalog">      </h2><br><p> <code>pip</code>       ,  ,    ,       ,   ,    ,     <code>.tar.gz</code>   . ,   <code>pytest-nice-0.1.0.tar.gz</code>     <code>myplugins</code> . </p><br><p>   <code>pytest-nice</code>  <code>myplugins</code> : </p><br><pre> <code class="plaintext hljs">$ pip install --no-index --find-links myplugins pytest-nice</code> </pre> <br><p> <code>--no-index</code>  <code>pip</code>    PyPI,   ,    . <br> The --find-links myplugins tells PyPI to look in myplugins for packages to install. And of course, pytest-nice is what we want to install. <br> <code>--find-links myplugins</code>  PyPI   <code>myplugins</code>   .  , <code>pytest-nice</code> ‚Äî  ,    . </p><br><p>         <code>myplugins</code>    ,    ,  <code>--upgrade</code> : </p><br><pre> <code class="plaintext hljs">$ pip install --upgrade --no-index --find-links myplugins pytest-nice</code> </pre> <br><p>      <code>pip</code> ,    <code>--no-index --find-links myplugins</code> . </p><br><h2 id="rasprostranenie-plaginov-cherez-pypi">    PyPI </h2><br><p>        ,    ,    .   ,    . ,          ,      ,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Python Packaging</a> . </p><br><p>     pytest,      ‚Äî  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>cookiecutter-pytest-plugin</code></a> : </p><br><pre> <code class="plaintext hljs">$ pip install cookiecutter $ cookiecutter https://github.com/pytest-dev/cookiecutter-pytest-plugin</code> </pre> <br><p>          .      ,      .          ; , ,     .     pytest,      ,       . </p><br><h2 id="uprazhneniya">  Ejercicios </h2><br><p>  <code>ch4/cache/test_slower.py</code>  autouse fixture,  <code>check_duration()</code> .        4.      . </p><br><ol><li>     pytest-slower,        ,  ,    ¬´  ¬ª  . 102. </li><li>    ,   pytest-slower ,   . </li><li>      . </li><li>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Python Package Index</a>   ¬´pytest-¬ª.   pytest,     . </li><li>          Tasks. </li></ol><br><h2 id="chto-dalshe">  Que sigue </h2><br><p>        <code>conftest.py</code>   .    ,     pytest,  <code>pytest.ini</code> .           ,   ,      . </p><br><p><img src="https://habrastorage.org/webt/jl/jn/bb/jljnbbjr-ejh473xy_eccsmknpk.png">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Atr√°s</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Siguiente</a> <img src="https://habrastorage.org/webt/rw/dy/-g/rwdy-grsvbpcetjttrmecdkxtlk.png"></p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/448794/">https://habr.com/ru/post/448794/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../448766/index.html">Cree un monorepository con espacios de trabajo de lerna e hilo</a></li>
<li><a href="../448774/index.html">SQL a CSV usando DBMS_SQL</a></li>
<li><a href="../448776/index.html">RxVMS: una arquitectura pr√°ctica para aplicaciones de flutter</a></li>
<li><a href="../448778/index.html">Presentaci√≥n de la depuraci√≥n de viajes en el tiempo para Visual Studio Enterprise 2019</a></li>
<li><a href="../448792/index.html">Prueba de Python con pytest. Accesorios incorporados, Cap√≠tulo 4</a></li>
<li><a href="../448796/index.html">Prueba de Python con pytest. Configuraci√≥n, CAP√çTULO 6</a></li>
<li><a href="../448798/index.html">Prueba de Python con pytest. Usando pytest con otras herramientas, CAP√çTULO 7</a></li>
<li><a href="../448800/index.html">Configure Visual Studio en toda su organizaci√≥n con .vsconfig</a></li>
<li><a href="../448802/index.html">Pensar con portales: crear portales en Unreal Engine 4</a></li>
<li><a href="../448804/index.html">Prepar√°ndose para el tiempo de ejecuci√≥n y el notario endurecidos de macOS</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>