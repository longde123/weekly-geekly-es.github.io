<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§ú ‚ò¶Ô∏è ‚åöÔ∏è Synth√©tiseur DDS sur Verilog üë®üèæ‚Äç‚öñÔ∏è üçø ‚úÇÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dans cet article, je partagerai comment j'ai compris l'√©criture d'un synth√©tiseur DDS sur Verilog. Il sera utilis√© pour g√©n√©rer une oscillation sinuso...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Synth√©tiseur DDS sur Verilog</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/457634/"><p><img src="https://habrastorage.org/webt/9a/zg/qs/9azgqsahwpzig90y6b8xbulgz9s.png"></p><br><p>  Dans cet article, je partagerai comment j'ai compris l'√©criture d'un synth√©tiseur DDS sur Verilog.  Il sera utilis√© pour g√©n√©rer une oscillation sinuso√Ødale, dont la fr√©quence et la phase initiale peuvent √™tre ajust√©es et calcul√©es pour √™tre utilis√©es avec un DAC unipolaire 8 bits.  Le fonctionnement du synth√©tiseur est bien √©crit dans un article de la revue <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Components and Technologies</a> .  Pour r√©duire la quantit√© de m√©moire utilis√©e de la table sinus, la sym√©trie est utilis√©e. </p><a name="habracut"></a><br><p> Pour la compilation sous Linux, j'ai utilis√© Iverilog et pour l'affichage GTKWave.  Pour plus de commodit√©, un simple Makefile a √©t√© √©crit, peut-√™tre qu'il sera utile pour quelqu'un.  Initialement, en utilisant le compilateur iverilog, nous obtenons le fichier tb.out, puis l'envoyons au simulateur vvp, qui est install√© avec iverilog.  En cons√©quence, vvp g√©n√©rera out.vcd, qui contient toutes les variables (signaux) utilis√©es dans le projet.  La cible d'affichage, en plus de ce qui pr√©c√®de, lancera GTKWave avec le fichier variable et vous pouvez voir les formes d'onde des signaux. </p><br><pre><code class="plaintext hljs">SRC = nco.v TB = nco_tb.v all: iverilog -o tb.out $(TB) vvp -lxt tb.out check: iverilog -v $(TB) display: iverilog -o tb.out $(TB) vvp -lxt tb.out gtkwave out.vcd &amp; clean: rm -rf *.out *.vcd *.vvp</code> </pre> <br><p>  Tout d'abord, vous devez placer une table du futur sinus en m√©moire, car j'ai √©crit un script Python simple qui divise un quart de la p√©riode sinuso√Ødale en 64 points et le g√©n√®re dans un format qui peut ensuite √™tre copi√© dans le code source.  Depuis que j'ai con√ßu l'impl√©mentation du DDS pour un DAC unipolaire externe avec une capacit√© en bits de pas plus de 8 bits, l'amplitude du sinus devrait √™tre comprise entre 0 et 256, o√π la demi-p√©riode n√©gative se situe dans la plage 0 ... 127, et la moiti√© positive dans 128 ... 255 .  √Ä cet √©gard, les valeurs sinuso√Ødales obtenues (de 0 √† pi / 4) sont multipli√©es par 127, puis 127 y est ajout√©. Par cons√©quent, les valeurs du premier trimestre de la p√©riode sont obtenues, dont l'amplitude est de 128 ... 256. </p><br><p>  J'attire l'attention sur le fait qu'avec cette formation, le sinus √† la sortie du DAC aura une composante constante.  Pour le retirer, il faut le faire passer √† travers un condensateur. </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> numpy <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> np x=np.linspace(<span class="hljs-number"><span class="hljs-number">0</span></span>,np.pi/<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">64</span></span>) print(np.sin(x)) y=<span class="hljs-number"><span class="hljs-number">127</span></span>*np.sin(x) print(len(y)) print(y) z=[] i = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> elem <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> y: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> int(elem)&lt;=<span class="hljs-number"><span class="hljs-number">16</span></span>: print(<span class="hljs-string"><span class="hljs-string">"lut[%d] = 7'h0%X;"</span></span> % (i, int(elem))) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: print(<span class="hljs-string"><span class="hljs-string">"lut[%d] = 7'h%X;"</span></span> % (i, int(elem))) z.append(hex(int(elem))) i = i + <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> <br><p>  Puisque la fonction sinus est sym√©trique (impair), vous pouvez trouver la premi√®re sym√©trie sin (x) = - sin (pi + x).  La deuxi√®me sym√©trie est caract√©ris√©e par le fait que le fait d'avoir une table pour un quart de la p√©riode, le deuxi√®me trimestre peut √™tre obtenu en parcourant la table dans l'ordre inverse (puisque le sinus sur la demi-p√©riode augmente d'abord, puis diminue). </p><br><h4 id="formiruem-sinus">  Nous formons un sinus </h4><br><p>  La majeure partie du synth√©tiseur DDS est une batterie de phase.  Il s'agit essentiellement de l'index d'un √©l√©ment de la table de recherche (LUT).  Pour chaque p√©riode du signal d'horloge, la valeur qu'il contient augmente d'une certaine valeur, en cons√©quence, un sinus est obtenu √† la sortie.  La fr√©quence du signal √† la sortie d√©pendra de la valeur de l'incr√©ment de l'accumulateur de phase - plus il est grand, plus la fr√©quence est √©lev√©e.  Cependant, selon le crit√®re de Kotelnikov, la fr√©quence d'√©chantillonnage devrait √™tre au moins 2 fois la fr√©quence du signal (pour √©viter l'effet de superposition du spectre), d'o√π la limitation de l'incr√©ment maximum est la moiti√© de l'accumulateur de phase.  En g√©n√©ral, le crit√®re d'ing√©nierie est la fr√©quence d'√©chantillonnage = 2,2 de la fr√©quence du signal, donc, ayant d√©cid√© de ne pas aller √† l'extr√™me, j'ai supprim√© un bit de plus, en laissant 6 bits incr√©ment√©s avec une batterie de phase de 8 bits (m√™me si la jackalite sinuso√Ødale d√©j√†). </p><br><p>  En raison de la sym√©trie utilis√©e, seuls les 6 bits inf√©rieurs de 2 ^ 6 = 64 seront directement utilis√©s pour l'√©chantillonnage d'index.  Les 2 bits sup√©rieurs sont utilis√©s pour identifier un quart de p√©riode de g√©n√©ration de sinus et, en cons√©quence, changer la direction de la travers√©e de la table.  Vous devriez obtenir quelque chose de similaire √†: </p><br><pre> <code class="plaintext hljs">module nco(clk, rst, out ); input clk, rst; output reg [7:0] out; reg [5:0] phase_inc = 6'h1; reg [7:0] phase_acc = 0; parameter LUT_SIZE = 64; reg [6:0] lut [0:LUT_SIZE-1]; always @(posedge clk) begin if (rst) begin phase_inc = 6'h1; phase_acc = 0; out = 0; lut[0] = 7'h00; //     lut[63] = 7'h7F; end else begin //      1    if (phase_acc[7:6] == 2'b00) begin //        LUT out &lt;= {1'b1,lut[phase_acc[5:0]]}; end if (phase_acc[7:6] == 2'b01) begin out &lt;= {1'b1,lut[~phase_acc[5:0]]}; end if (phase_acc[7:6] == 2'b10) begin out &lt;= {1'b0,~lut[phase_acc[5:0]]}; end if (phase_acc[7:6] == 2'b11) begin out &lt;= {1'b0,~lut[~phase_acc[5:0]]}; end phase_acc &lt;= phase_acc + {2'b0,phase_inc}; end end endmodule</code> </pre> <br><p>  Lors de la r√©initialisation, nous initialisons tout avec des z√©ros, √† l'exception de la valeur d'incr√©ment de phase, nous la d√©finissons sur un.  Pour pr√©server la synth√©tisabilit√© du code, le tableau sera √©galement rempli de valeurs lors de la r√©initialisation.  Dans un projet r√©el, il est conseill√© d'utiliser la m√©moire de bloc int√©gr√©e au FPGA √† de telles fins et de cr√©er un fichier de configuration distinct pour celui-ci, et d'utiliser le noyau IP dans le projet lui-m√™me. </p><br><p>  Une petite explication sur le fonctionnement de la sym√©trie.  A chaque cycle, il est v√©rifi√© (sur les 2 bits les plus significatifs) dans quel quart de phase l'accumulateur est actuellement situ√©.  Si le plus √©lev√© = 00, alors la sortie dans le chiffre le plus √©lev√© est 1 (responsable de la demi-onde positive), dans les plus basses - la valeur de la LUT conform√©ment √† l'indice.  Apr√®s que la valeur de l'accumulateur de phase d√©passe 63 (le premier trimestre passera), 01 appara√Ætra dans les bits hauts et les plus bas seront √† nouveau remplis de z√©ros. </p><br><p>  Pour passer la LUT dans l'ordre inverse, il suffit d'inverser les bits les moins significatifs de l'accumulateur de phase (il continuera d'augmenter pour chaque cycle d'horloge, et sa valeur invers√©e diminuera). </p><br><p>  Pour former une demi-onde n√©gative, nous √©crivons 0. Dans le bit sup√©rieur de la sortie, nous devons maintenant inverser la valeur elle-m√™me √† partir du sinus.  Le point ici est que vous devez obtenir une copie miroir du quart du sinus, et si cela n'est pas fait, vous obtenez la m√™me image qu'au premier trimestre, mais abaiss√©e de 127 vers le bas.  Vous pouvez le v√©rifier en supprimant l'inverse dans le code. </p><br><h4 id="menyaem-chastotu-i-nachalnuyu-fazu">  On change la fr√©quence et la phase initiale </h4><br><p>  Comme d√©j√† d√©crit ci-dessus, pour changer la fr√©quence, il faut changer la valeur de l'incr√©ment de phase.  De nouvelles entr√©es appara√Ætront: </p><br><pre> <code class="plaintext hljs">input [5:0] freq_res; input [7:0] phase;</code> </pre> <br><p>  Pour changer la valeur de l'incr√©ment de phase, il suffit de l'aligner √† chaque cycle: </p><br><pre> <code class="plaintext hljs">always @(posedge clk) begin if (rst) begin //... end else begin //... phase_inc &lt;= freq_res; end end</code> </pre> <br><p>  Avec la phase initiale, tout n'est pas si simple.  Vous devez d'abord l'√©crire dans le registre interm√©diaire et remplir l'accumulateur de phase avec cette valeur uniquement si la valeur de la phase initiale √† l'entr√©e ne co√Øncide pas avec celle pr√©c√©demment enregistr√©e.  Cela soul√®ve un autre point important li√© √† l'√©tat des races.  Nous avons d√©j√† un endroit o√π nous √©crivons <code>phase_acc</code> dans le registre.  Vous ne pouvez pas enregistrer en m√™me temps √† plusieurs endroits, car les donn√©es arriv√©es en premier seront enregistr√©es.  Par cons√©quent, la conception ressemblera √† ceci: </p><br><pre> <code class="plaintext hljs">reg change_phase = 0; //     //     (  ) //     : prev_phase &lt;= phase; if (phase != prev_phase) begin //       change_phase &lt;= 1'b1; end if (change_phase) begin //        phase_acc &lt;= prev_phase; change_phase &lt;= 1'b0; end else begin //           phase_acc &lt;= phase_acc + {2'b0,phase_inc}; end</code> </pre> <br><h4 id="testbench">  Banc d'essai </h4><br><p>  Le code du banc d'essai pour Iverilog et GTKWave a certains mod√®les (avec un signe dollar) qui ne sont pas utilis√©s dans l'ISE Design Suite ou Quartus habituel.  Leur signification se r√©sume √† s√©lectionner des signaux surveill√©s et √† les charger dans un fichier, afin qu'ils puissent ensuite √™tre transf√©r√©s vers le simulateur.  Le travail du banc d'essai lui-m√™me est trivial - nous effectuons une r√©initialisation, d√©finissons la fr√©quence / phase initiale et attendons un peu. </p><br><pre> <code class="plaintext hljs">`include "nco.v" `timescale 1ns / 1ps module nco_tb; reg clk = 0, rst = 0; reg [7:0] phase = 0; reg [5:0] freq_res; wire [7:0] out; nco nco_inst ( .clk(clk), .rst(rst), .phase(phase), .freq_res(freq_res), .out(out) ); always #2 clk &lt;= ~clk; initial begin $dumpfile("out.vcd"); $dumpvars(0, nco_tb); //$monitor("time =%4d out=%h",$time,out); rst = 1'b1; freq_res = 1; #8 rst = 1'b0; #300 phase = 8'b00100011; #300 phase = 8'b00001111; #1200 freq_res = 6'b111101; #1200 freq_res = 6'b001111; #1200 freq_res = 6'b011111; #400 phase = 8'b00010011; #1200 $finish; end endmodule</code> </pre> <br><h4 id="vremennye-diagrammy">  Chronogrammes </h4><br><p>  En sortie, nous obtenons quelque chose de similaire √† un sinus avec une fr√©quence et une phase initiale changeantes aux moments d√©finis dans le banc de test.  Il convient de noter qu'avec l'augmentation de la fr√©quence, la r√©solution le long de celle-ci (le nombre d'√©chantillons par p√©riode) diminue, respectivement, la fr√©quence d'horloge du synth√©tiseur et sa taille LUT jouent un r√¥le d√©cisif dans la reproduction du sinus pur (plus sa forme s'approche de l'id√©al, moins il y a de composants lat√©raux dans le spectre du r√©sultat obtenu). signal et le pic sera d√©j√† √† la fr√©quence g√©n√©r√©e). </p><br><p><img src="https://habrastorage.org/webt/zk/ws/zg/zkwszgjj7dw89xqygjhcc8uhzoc.png"></p><br><p>  On peut voir qu'un signal avec une deuxi√®me fr√©quence n'a d√©j√† pas un sinus aussi lisse que les autres.  Examinons de plus pr√®s. </p><br><p><img src="https://habrastorage.org/webt/ni/ja/cd/nijacdynrfxbcbq-xjxbmbjtqbe.png"></p><br><p>  On peut voir que c'est toujours un peu similaire au sinus, le r√©sultat deviendra encore meilleur apr√®s qu'un tel signal soit pass√© √† travers un filtre anti-aliasing (filtre passe-bas). </p><br><p>  Les sources du projet sont disponibles <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . </p><br><h4 id="istochniki">  Les sources </h4><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Fonctionnement du synth√©tiseur DDS</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Site Web Icarus Verilog</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr457634/">https://habr.com/ru/post/fr457634/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr457624/index.html">Comment nous avons cass√© l'ancienne cabane et construit un gratte-ciel √† sa place</a></li>
<li><a href="../fr457626/index.html">R√©vision des niveaux d'acc√®s utilisateur √† l'aide de Power BI √† l'aide de l'exemple de Bitrix CMS (BUS)</a></li>
<li><a href="../fr457628/index.html">Programme P2M efficace et gestion de projet</a></li>
<li><a href="../fr457630/index.html">Exp√©rience dans le d√©veloppement d'exigences pour les donn√©es scientifiques de qualit√© professionnelle</a></li>
<li><a href="../fr457632/index.html">Combien co√ªtent les tests unitaires?</a></li>
<li><a href="../fr457638/index.html">Attrape-moi si tu peux. Version Proph√®te</a></li>
<li><a href="../fr457640/index.html">Sur quoi s'appuient les experts en protection des donn√©es? Rapport du Congr√®s international de la cybers√©curit√©</a></li>
<li><a href="../fr457646/index.html">√Ä propos de l'antilope dans un masque √† gaz et des lacs de sel roses</a></li>
<li><a href="../fr457652/index.html">Comment organiser 120 000 photos et qu'il n'y ait pas de tryndets, avec diff√©rents niveaux d'acc√®s, pour l'√©quipe</a></li>
<li><a href="../fr457658/index.html">Union MS-11: un accident qui n'existait pas?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>