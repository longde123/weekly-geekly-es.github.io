<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏽‍🤝‍👨🏿 ➰ 🐩 Mencatat semua kueri basis data di Asp.Net Boilerplate 4.3 .Net Core 2.1 🎌 🤶🏾 🌭</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Seringkali dalam proyek ini ada kesalahan yang tidak dapat dimengerti yang diperlukan untuk pencatatan maksimum semua permintaan ke Database. Artikel ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Mencatat semua kueri basis data di Asp.Net Boilerplate 4.3 .Net Core 2.1</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/444660/"> Seringkali dalam proyek ini ada kesalahan yang tidak dapat dimengerti yang diperlukan untuk <b>pencatatan maksimum semua permintaan ke Database.</b>  Artikel ini akan membantu mereka yang menulis (menggunakan server) salah satu proyek pertama mereka di <b>Asp.Net Boilerplate</b> . <br><a name="habracut"></a><br>  Artikel ini ditulis untuk mereka yang baru mengenal teknologi Asp.Net Boilerplate yang telah mengalami kesalahan aneh terkait dengan Database.  Saat menggunakan PostgreSQL, ini mungkin, misalnya, proyek pertama.  Motivasi untuk menulis artikel adalah bahwa solusi untuk pertanyaan ini tidak begitu mudah ditemukan di Internet, bahkan dalam bahasa Inggris, belum lagi fakta bahwa solusi yang ditemukan tidak sepenuhnya menjawab semua pertanyaan tentang masalah ini. <br><br>  Versi Produk: Asp.Net Boilerplate 4.3, .NET Core 2.1 <br><br>  <u>Jika Anda menyelesaikan langkah-langkah ini</u> : Di file log utama Anda, Anda akan melihat semua permintaan ke Database masuk. <br><br><h2>  Langkah 1 </h2><br>  Anda harus membuat logger.  Sudah ada logger internal yang dikonfigurasi pada platform Boilerplate.  Ini bisa menjadi Log4Net sebagai standar.  Tidak perlu melakukan manipulasi dengannya.  Alih-alih, cukup membuat kelas logger yang Anda daftarkan sebagai pengolah semua pesan log dari Database. <br><br><h3>  Langkah 1.1 </h3><br>  Project * .EntityFrameworkCore.  Di sini kita perlu membuat 2 kelas.  Di satu sisi, logger yang hanya akan melakukan satu hal adalah untuk mengeluarkan semua pesan dari database ke log sistem.  Sebut saja <b>MyLogger.</b>  Dan penyedia logger ini yang akan membuat MyLogger.  Penyedia disebut <b>MyLoggerProvider.</b> <br><br>  Kami membuat satu file dengan kode berikut (satu file untuk penyederhanaan, meskipun, tentu saja, setiap file harus memiliki satu kelas): <br><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MyLoggerProvider</span></span> : <span class="hljs-title"><span class="hljs-title">ILoggerProvider</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Castle.Core.Logging.ILogger _logger; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MyLoggerProvider</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Castle.Core.Logging.ILogger logger</span></span></span><span class="hljs-function">)</span></span> { _logger = logger; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ILogger </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateLogger</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> categoryName</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MyLogger(_logger); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Dispose</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MyLogger</span></span> : <span class="hljs-title"><span class="hljs-title">ILogger</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Castle.Core.Logging.ILogger _logger; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MyLogger</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Castle.Core.Logging.ILogger logger</span></span></span><span class="hljs-function">)</span></span> { _logger = logger; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IDisposable BeginScope&lt;TState&gt;(TState state) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IsEnabled</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">LogLevel logLevel</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Log&lt;TState&gt;(LogLevel logLevel, EventId eventId, TState state, Exception exception, Func&lt;TState, Exception, <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt; formatter) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (IsEnabled(logLevel)) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> msg = formatter(state, exception); _logger.Info(<span class="hljs-string"><span class="hljs-string">"DB-REQUEST: "</span></span> + msg); } } }</code> </pre> <br>  Jika Anda melihat lebih dekat, Anda dapat melihat bagaimana beberapa logger lain diteruskan ke MyLoggerProvider, dan kemudian ke MyLogger.  Ternyata sudah yang ketiga!  Intinya adalah bahwa yang ketiga ini adalah kelas dari tingkat infrastruktur logging, yang harus diperoleh dari isi perut Boilerplate dengan bantuan yang pesannya akan disimpan dalam log.  Lihat di bawah. <br><br><h2>  Langkah 2 </h2><br>  Dalam kerangka kerja proyek * .EntityFrameworkCore yang sama, buka file * DbContextConfigurer.cs dan buat perubahan berikut di kedua metode Konfigurasi (): <br><br>  2.1) Tambahkan parameter loggerfactory dari tipe LoggerFactory <br><br>  2.2) Tambahkan dua baris ke badan metode: <br><br><pre> <code class="cs hljs">builder.UseLoggerFactory(loggerFactory); builder.EnableSensitiveDataLogging(<span class="hljs-literal"><span class="hljs-literal">true</span></span>);</code> </pre><br>  Arti <b>UseLoggerFactory</b> adalah untuk mengaktifkan penggunaan loggerFactory, yang diteruskan dalam parameter untuk masuk ke Database.  Sangat penting untuk diingat bahwa di sini kita mengaktifkan pendataan basis data. <br><br>  Arti <b>EnableSensitiveDataLogging</b> adalah untuk mengaktifkan pencatatan tidak hanya permintaan basis data, tetapi juga merekam semua data dalam kueri ini.  Tanpa pengaturan ini, Anda tidak akan dapat melihat data dalam kueri - mereka akan digantikan oleh tanda tanya. <br><br><h2>  Langkah 3 </h2><br>  Dalam kerangka proyek * .EntityFrameworkCore yang sama, kita pergi ke file * DbContextFactory.cs. <br><br>  3.1) Tambahkan metode baru: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> LoggerFactory </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetDbLoggerFactory</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LoggerFactory(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span>[] { <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MyLoggerProvider(NullLogger.Instance) }); }</code> </pre> <br>  3.2) Dalam metode CreateDbContext (): <br>  Karena  Karena kami sebelumnya menambahkan parameter baru ke kedua Konfigurasi () implementasi, kesalahan harus ditampilkan di sini.  Saatnya menentukan parameter baru ini - kami mendaftarkan GetDbLoggerFactory () dengan koma.  Yaitu  nilai parameter loggerFactory baru akan dikembalikan dengan metode baru dari klausa 3.1. <br><br><h2>  Langkah 4 </h2><br>  Dalam kerangka proyek * .EntityFrameworkCore yang sama, kita pergi ke file * EntityFrameworkModule.cs. <br><br>  4.1) Tambahkan metode baru: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> LoggerFactory </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetDbLoggerFactory</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LoggerFactory(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span>[] { <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MyLoggerProvider(Logger) }); }</code> </pre> <br>  4.2) Dalam metode PreInitialize (): <br><br>  Karena  Karena kami sebelumnya menambahkan parameter baru ke kedua Konfigurasi () implementasi, kesalahan juga harus ditampilkan di sini.  Kami menetapkan parameter baru yang mirip dengan Bagian 3.2 - kami mendaftarkan GetDbLoggerFactory () dengan koma.  Yaitu  nilai parameter loggerFactory baru akan dikembalikan dengan metode baru dari klausul 4.1. <br><br><h2>  Hasil </h2><br>  Dalam file log utama (secara default Logs.txt) Anda akan melihat semua pertanyaan yang didahului oleh urutan karakter DB-REQUEST (dari sini Anda dapat mencari data dalam log). <br><br><h2>  Pemahaman umum tentang solusinya </h2><br>  Jadi, sekarang saya akan menjelaskan apa yang telah kami lakukan.  Penjelasan diberikan di akhir artikel, karena  seringkali pembaca tertarik untuk mulai melakukan sesuatu yang spesifik. <br><br>  Di kelas * DbContextFactory, serta * EntityFrameworkModule, kami membuat LoggerFactory kami, dalam parameter yang kami tunjukkan MyLoggerProvider yang dibuat.  Tetapi sebagai kelas infrastruktur yang akan secara langsung masuk dalam kasus pertama (* DbContextFactory), kami melewati NullLogger.Instance stub sehingga tidak ada entri.  Dalam kasus kedua (* EntityFrameworkModule) kita melewati logger, yang sudah ada di modul-Abp.  Ini adalah bidang Logger.  Ini sudah diinisialisasi dan dapat dicatat.  Dengan demikian, MyLogger kami akan dapat menulis ke file Logs.txt menggunakan kelas ini. <br><br>  Logikanya keseluruhan adalah bahwa pabrik loggerFactory ini diinstal sebagai pabrik log untuk bekerja dengan Database.  Segera setelah logger dibutuhkan, itu dibuat oleh pabrik.  Dan ini adalah MyLogger kami, yang, pada gilirannya, mencatat semua yang datang ke Logs.txt (atau sumber yang dikonfigurasi untuk output dari log utama Anda). <br><br>  Seperti yang Anda lihat, tidak semuanya begitu sederhana dan tingkat abstraksi terkadang membeku, terutama untuk pemula!  Ajukan pertanyaan Anda di komentar. <br><br>  <u>Catatan:</u> <br><br>  - Solusinya dibuat untuk menyalakan logger, memahami apa kesalahannya dan mematikannya.  Itu tidak dirancang untuk penggunaan jangka panjang. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id444660/">https://habr.com/ru/post/id444660/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id444646/index.html">Rutoken, OpenSSL, dan CA lokal untuk menandatangani pesan</a></li>
<li><a href="../id444650/index.html">Bakterial deodorant: hubungan simbiotik antara katak pohon dan bakteri Pseudomonas</a></li>
<li><a href="../id444652/index.html">“Sudah waktunya untuk keluar dari front-end”: Andrey Sitnik tentang stagnasi komunitas, open source dan tidak hanya</a></li>
<li><a href="../id444654/index.html">Ekonomi kegembiraan. Mentoring sebagai kasus khusus. Hukum tiga persen</a></li>
<li><a href="../id444658/index.html">Video dari Badoo PHP Meetup # 2: Tentang Tes dan Kualitas Kode</a></li>
<li><a href="../id444662/index.html">Elemen khusus dalam pertempuran</a></li>
<li><a href="../id444664/index.html">Linux Foundation akan menangani chip open source</a></li>
<li><a href="../id444668/index.html">5 masalah yang paling umum pengusaha dalam memilih spesialis TI dari sudut pandang perekrut-outsourcing</a></li>
<li><a href="../id444670/index.html">Penelitian: musik merugikan pemikiran kreatif - pahami dan diskusikan pendapat alternatif</a></li>
<li><a href="../id444672/index.html">Roskachestvo mempresentasikan peringkat headphone berkabel dan nirkabel yang tersedia di Rusia</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>