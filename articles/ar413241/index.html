<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ ๐ผ ๐๐ฟ ุงุนุชุฑุงุถ ูุธุงุฆู ูู ููุงุฉ ููููุณ ุจุงุณุชุฎุฏุงู ftrace ๐๏ธ ๐ง๐ฝ ๐๐ป</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ูู ุฃุญุฏ ุงููุดุงุฑูุน ุงููุชุนููุฉ ุจุฃูู ุฃูุธูุฉ Linux ุ ููุง ุจุญุงุฌุฉ ุฅูู ุงุนุชุฑุงุถ ุงูููุงููุงุช ูููุธุงุฆู ุงููููุฉ ุฏุงุฎู ุงูููุงุฉ (ูุซู ูุชุญ ุงููููุงุช ูุชุดุบูู ุงูุนูููุงุช) ูุชูููุฑ ุงููุฏุฑุฉ ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ุงุนุชุฑุงุถ ูุธุงุฆู ูู ููุงุฉ ููููุณ ุจุงุณุชุฎุฏุงู ftrace</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/413241/" style=";text-align:right;direction:rtl"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><img src="https://habrastorage.org/webt/xy/k-/zy/xyk-zye1hkr1vaw41hvsxup3brc.png" alt="ูููุฌุง ุจููุฌููู ุ En3l" align="right" width="40%"></a>  ูู ุฃุญุฏ ุงููุดุงุฑูุน ุงููุชุนููุฉ ุจุฃูู ุฃูุธูุฉ Linux ุ ููุง ุจุญุงุฌุฉ ุฅูู ุงุนุชุฑุงุถ ุงูููุงููุงุช ูููุธุงุฆู ุงููููุฉ ุฏุงุฎู ุงูููุงุฉ (ูุซู ูุชุญ ุงููููุงุช ูุชุดุบูู ุงูุนูููุงุช) ูุชูููุฑ ุงููุฏุฑุฉ ุนูู ูุฑุงูุจุฉ ุงููุดุงุท ูู ุงููุธุงู ูููุน ูุดุงุท ุงูุนูููุงุช ุงููุดุจููุฉ ุจุดูู ููุงุฆู. <br><br>  ุฎูุงู ุนูููุฉ ุงูุชุทููุฑ ุ ุชูููุง ูู ุงุฎุชุฑุงุน ููุฌ ุฌูุฏ ุฌุฏูุง ุ ูุงูุฐู ูุณูุญ ููุง ุจุงุนุชุฑุงุถ ุฃู ูุธููุฉ ูู ุงูููุงุฉ ุจุดูู ููุงุฆู ูุชูููุฐ ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ุงูุฎุงุตุฉ ุจูุง ุญูู ููุงููุงุชูุง.  ูููู ุชุซุจูุช ุงููุนุชุฑุถ ูู ูุญุฏุฉ GPL ุงููุงุจูุฉ ููุชุญููู ุ ุฏูู ุฅุนุงุฏุฉ ุจูุงุก ุงูููุงุฉ.  ูุฏุนู ุงูุฃุณููุจ kernels ุงูุฅุตุฏุงุฑ 3.19+ ููุนูุงุฑูุฉ x86_64. <br><a name="habracut"></a><br>  <font color="gray">(ุตูุฑุฉ ุงูุจุทุฑูู ุฃุนูุงู: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ยฉ En3l with DeviantArt</a> .)</font> <br><br><h2 style=";text-align:right;direction:rtl">  ุงูููุงูุฌ ุงููุนุฑููุฉ </h2><br><h3 style=";text-align:right;direction:rtl">  ูุงุฌูุฉ ุจุฑูุฌุฉ ุชุทุจููุงุช ุฃูุงู Linux </h3><br>  ุงูุฃูุซุฑ ุตุญุฉ ูู ุงุณุชุฎุฏุงู <em>Linux Security API</em> - ูุงุฌูุฉ ุฎุงุตุฉ ุชู ุฅูุดุงุคูุง ุฎุตูุตูุง ููุฐู ุงูุฃุบุฑุงุถ.  ูู ุงูุฃูุงูู ุงูุญุฑุฌุฉ ูู ุฑูุฒ ุงูููุงุฉ ุ ุชูุฌุฏ ููุงููุงุช ุฅูู ูุธุงุฆู ุงูุฃูุงู ุ ูุงูุชู ุจุฏูุฑูุง ุชุณุชุฏุนู ุงูุงุณุชุฑุฌุงุนุงุช ุงูุชู ุชุญุฏุฏูุง ูุญุฏุฉ ุงูุฃูุงู.  ูููู ูููุญุฏุฉ ุงูุฃูููุฉ ูุญุต ุณูุงู ุงูุนูููุฉ ูุงุชุฎุงุฐ ูุฑุงุฑ ุจุดุฃู ูุง ุฅุฐุง ูุงู ูุณููุญูุง ุจูุง ุฃู ูุง. <br><br>  ูุณูุก ุงูุญุธ ุ ูุฏู Linux Security API ุจุนุถ ุงููููุฏ ุงููุงูุฉ: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูุง ูููู ุชุญููู ูุญุฏุงุช ุงูุญูุงูุฉ ุฏููุงูููููุง ุ ููู ุฌุฒุก ูู ุงูููุงุฉ ูุชุชุทูุจ ุฅุนุงุฏุฉ ุงูุจูุงุก </li><li style=";text-align:right;direction:rtl">  ูููู ุฃู ูููู ููุงู ูุญุฏุฉ ุฃูุงู ูุงุญุฏุฉ ููุท ูู ุงููุธุงู (ูุน ุจุนุถ ุงูุงุณุชุซูุงุกุงุช) </li></ul><br>  ุฅุฐุง ูุงู ูุถุน ูุทูุฑู ุงูููุงุฉ ุบุงูุถูุง ูููุง ูุชุนูู ุจุชุนุฏุฏ ุงููุญุฏุงุช ุ ูุฅู ุญุธุฑ ุงูุชุญููู ุงูุฏููุงูููู ุฃูุฑ ุฃุณุงุณู: ูุฌุจ ุฃู ุชููู ูุญุฏุฉ ุงูุฃูุงู ุฌุฒุกูุง ูู ุงูููุงุฉ ูุถูุงู ุงูุฃูุงู ุจุงุณุชูุฑุงุฑ ุ ูู ูุญุธุฉ ุงูุชุญููู. <br><br>  ูุจุงูุชุงูู ุ ูุงุณุชุฎุฏุงู ูุงุฌูุฉ ุจุฑูุฌุฉ ุชุทุจููุงุช ุงูุฃูุงู ุ ูุฌุจ ุนููู ุชูููุฑ ุชุฌููุน kernel ุงูุฎุงุต ุจู ุ ุจุงูุฅุถุงูุฉ ุฅูู ุฏูุฌ ูุญุฏุฉ ุงููุธููุฉ ุงูุฅุถุงููุฉ ูุน SELinux ุฃู AppArmor ุ ูุงูุชู ุชุณุชุฎุฏููุง ุงูุชูุฒูุนุงุช ุงูุดุงุฆุนุฉ.  ูู ูุฑุบุจ ุงูุนููู ูู ุงูุงุดุชุฑุงู ูู ูุฐู ุงูุงูุชุฒุงูุงุช ุ ูุฐูู ุชู ุฅุบูุงู ูุฐุง ุงููุณุงุฑ. <br><br>  ููุฐู ุงูุฃุณุจุงุจ ุ ูู ุชูุงุณุจูุง Security API ุ ูุฅูุง ุณูููู ุฎูุงุฑูุง ูุซุงูููุง. <br><br><h3 style=";text-align:right;direction:rtl">  ุชุนุฏูู ุฌุฏูู ุงุณุชุฏุนุงุก ุงููุธุงู </h3><br>  ูุงู ุงูุฑุตุฏ ูุทููุจูุง ุจุดูู ุฃุณุงุณู ููุฅุฌุฑุงุกุงุช ุงูุชู ุชููู ุจูุง ุชุทุจููุงุช ุงููุณุชุฎุฏู ุ ุจุญูุซ ูููู ูู ุญูุซ ุงููุจุฏุฃ ุชูููุฐูุง ุนูู ูุณุชูู ููุงููุงุช ุงููุธุงู.  ููุง ุชุนูู ุ ูุฎุฒู Linux ุฌููุน ูุนุงูุฌุงุช ููุงููุงุช ุงููุธุงู ูู ุงูุฌุฏูู <code>sys_call_table</code> .  ูุคุฏู ุงุณุชุจุฏุงู ุงูููู ูู ูุฐุง ุงูุฌุฏูู ุฅูู ุชุบููุฑ ูู ุณููู ุงููุธุงู ุจุฃูููู.  ูุจุงูุชุงูู ุ ูุน ุงูุงุญุชูุงุธ ุจุงูููู ุงููุฏููุฉ ูููุนุงูุฌ ูุงุณุชุจุฏุงู ุงููุนุงูุฌ ุงูุฎุงุต ุจูุง ูู ุงูุฌุฏูู ุ ูููููุง ุงุนุชุฑุงุถ ุฃู ุงุณุชุฏุนุงุก ูููุธุงู. <br><br>  ูุฐุง ุงูููุฌ ูู ูุฒุงูุง ูุนููุฉ: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <strong>ุชุญูู ูุงูู ูู ุฃู ููุงููุงุช ูุธุงู</strong> - ุงููุงุฌูุฉ ุงููุญูุฏุฉ ููููุงุฉ ูุชุทุจููุงุช ุงููุณุชุฎุฏู.  ุจุงุณุชุฎุฏุงูู ุ ูููููุง ุงูุชุฃูุฏ ูู ุฃููุง ูู ูููุช ุฃู ุฅุฌุฑุงุก ููู ุชููู ุจู ุนูููุฉ ุงููุณุชุฎุฏู. <br></li><li style=";text-align:right;direction:rtl">  <strong>ุงููููุงุช ุงูุนุงูุฉ ุงูุฏููุง.</strong>  ููุงู ุงุณุชุซูุงุฑ ุฑุฃุณูุงูู ููุฑุฉ ูุงุญุฏุฉ ุนูุฏ ุชุญุฏูุซ ุฌุฏูู ุงุณุชุฏุนุงุก ุงููุธุงู.  ุจุงูุฅุถุงูุฉ ุฅูู ุญูููุฉ ุงููุฑุงูุจุฉ ุงูุญุชููุฉ ุ ูุฅู ุงููููุงุช ุงููุญูุฏุฉ ูู ุงุณุชุฏุนุงุก ูุธููุฉ ุฅุถุงููุฉ (ูุงุณุชุฏุนุงุก ูุนุงูุฌ ุงุณุชุฏุนุงุก ุงููุธุงู ุงูุฃุตูู). <br></li><li style=";text-align:right;direction:rtl">  <strong>ุงูุญุฏ ุงูุฃุฏูู ูู ูุชุทูุจุงุช ุงูููุงุฉ.</strong>  ุฅุฐุง ุฑุบุจุช ูู ุฐูู ุ ูุง ูุชุทูุจ ูุฐุง ุงูููุฌ ุฃู ุฎูุงุฑุงุช ุชูููู ุฅุถุงููุฉ ูู ุงูููุงุฉ ุ ูุฐูู ูู ุงููุงุญูุฉ ุงููุธุฑูุฉ ูุฏุนู ุฃูุณุน ูุทุงู ูููู ูู ุงูุฃูุธูุฉ. <br></li></ul><br>  ููุน ุฐูู ุ ูุนุงูู ุฃูุถูุง ูู ุจุนุถ ุงูุนููุจ: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <strong>ุงูุชุนููุฏ ุงูููู ููุชูููุฐ.</strong>  ูู ุญุฏ ุฐุงุชู ุ ููุณ ูู ุงูุตุนุจ ุงุณุชุจุฏุงู ุงููุคุดุฑุงุช ูู ุงูุฌุฏูู.  ููู ุงูููุงู ุฐุงุช ุงูุตูุฉ ุชุชุทูุจ ุญูููุง ุบูุฑ ูุงุถุญุฉ ููุคููุงุช ูุนููุฉ: <br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุฌุฏูู ุงุณุชุฏุนุงุก ูุธุงู ุงูุจุญุซ </li><li style=";text-align:right;direction:rtl">  ุชุนุฏูู ุญูุงูุฉ ุงูุฌุฏูู ุชุฌุงูุฒ </li><li style=";text-align:right;direction:rtl">  ุงุณุชุจุฏุงู ุฐุฑู ูุขูู </li></ul><br>  ูุฐู ูููุง ุฃุดูุงุก ูุซูุฑุฉ ููุงูุชูุงู ุ ููููุง ุชุชุทูุจ ููุช ุชุทููุฑ ุซููู ุ ุฃููุงู ููุชูููุฐ ุ ุซู ููุฏุนู ูุงูููู. <br></li><li style=";text-align:right;direction:rtl">  <strong>ุนุฏู ุงููุฏุฑุฉ ุนูู ุงุนุชุฑุงุถ ุจุนุถ ุงููุนุงูุฌุงุช.</strong>  ูู ููุงุฉ ูุจู ุงูุฅุตุฏุงุฑ 4.16 ุ ุงุญุชูุช ูุนุงูุฌุฉ ุงุณุชุฏุนุงุก ุงููุธุงู ูุจููุฉ x86_64 ุนูู ุนุฏุฏ ูู ุงูุชุญุณููุงุช.  ุทุงูุจ ุจุนุถูู ุจุฃู ูููู ูุนุงูุฌ ุงุณุชุฏุนุงุก ุงููุธุงู ูุญูููุง ุฎุงุตูุง ูุชู ุชูููุฐู ูู ุงููุฌูุน.  ููููุง ูุฐูู ุ ุชููู ูุฐู ุงููุนุงูุฌุงุช ุตุนุจุฉ ูู ุจุนุถ ุงูุฃุญูุงู ุ ูุฃุญูุงููุง ูููู ูู ุงููุณุชุญูู ุงุณุชุจุฏุงููุง ุจูุนุงูู ุฎุงุต ุจู ุ ููุชูุจ ูู C.  ุนูุงูุฉ ุนูู ุฐูู ุ ูุชู ุงุณุชุฎุฏุงู ุชุญุณููุงุช ูุฎุชููุฉ ูู ุฅุตุฏุงุฑุงุช ูุฎุชููุฉ ูู ุงูููุงุฉ ุ ููุง ูุฒูุฏ ูู ุงูุตุนูุจุงุช ุงููููุฉ ููุจููู. <br></li><li style=";text-align:right;direction:rtl">  <strong>ูุชู ุงุนุชุฑุงุถ ููุงููุงุช ุงููุธุงู ููุท.</strong>  ูุณูุญ ูู ูุฐุง ุงูุฃุณููุจ ุจุงุณุชุจุฏุงู ูุนุงูุฌุงุช ุงุณุชุฏุนุงุก ุงููุธุงู ุ ููุง ูุญุฏ ูู ููุงุท ุงูุฏุฎูู ููุท.  ูุชู ุชูููุฐ ุฌููุน ุนูููุงุช ุงููุญุต ุงูุฅุถุงููุฉ ุฅูุง ูู ุงูุจุฏุงูุฉ ุฃู ูู ุงูููุงูุฉ ุ ููุฏููุง ููุท ูุณูุทุงุช ุงุณุชุฏุนุงุก ุงููุธุงู ููููุชูุง ุงููุฑุชุฌุนุฉ.  ูุคุฏู ุฐูู ุฃุญูุงููุง ุฅูู ุงูุญุงุฌุฉ ุฅูู ุชูุฑุงุฑ ุนูููุงุช ุงูุชุญูู ูู ููุงูุฉ ุงูุญุฌุฌ ูุนูููุงุช ุงูุชุญูู ูู ุงููุตูู.  ูู ุจุนุถ ุงูุฃุญูุงู ูุชุณุจุจ ุฐูู ูู ุญูู ุบูุฑ ุถุฑูุฑู ุนูุฏูุง ุชุญุชุงุฌ ุฅูู ูุณุฎ ุฐุงูุฑุฉ ุนูููุฉ ุงููุณุชุฎุฏู ูุฑุชูู: ุฅุฐุง ุชู ุชูุฑูุฑ ุงููุณูุทุฉ ูู ุฎูุงู ูุคุดุฑ ุ ูุนูููุง ุฃููุงู ูุณุฎูุง ุจุฃููุณูุง ุ ุซู ูููู ุงููุนุงูุฌ ุงูุฃุตูู ุจูุณุฎ ุงููุณูุทุฉ ูุฑุฉ ุฃุฎุฑู ูููุณู.  ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ูู ุจุนุถ ุงูุญุงูุงุช ุ ุชููุฑ ููุงููุงุช ุงููุธุงู ูุณุชูู ููุฎูุถูุง ุฌุฏูุง ูู ุงูุฃุญุฏุงุซ ุงูุชู ูุฌุจ ุฃู ุชุชู ุชุตููุชูุง ุจุดูู ุฅุถุงูู ูู ุงูุถูุถุงุก. <br></li></ul><br>  ูู ุงูุจุฏุงูุฉ ุ ุงุฎุชุฑูุง ูููุฐูุง ูุฐุง ุงูููุฌ ุจูุฌุงุญ ุ ูุน ุงูุณุนู ูุฑุงุก ูุฒุงูุง ุฏุนู ุฃูุจุฑ ุนุฏุฏ ูู ุงูุฃูุธูุฉ.  ููุน ุฐูู ุ ูู ุฐูู ุงูููุช ูุง ุฒููุง ูุง ูุนุฑู ุนู ููุฒุงุช x86_64 ูุงููููุฏ ุงูููุฑูุถุฉ ุนูู ุงูููุงููุงุช ุงูุชู ุชู ุงุนุชุฑุงุถูุง.  ูู ููุช ูุงุญู ุงุชุถุญ ุฃูู ุฃูุฑ ุญุงุณู ุจุงููุณุจุฉ ููุง ูุฏุนู ููุงููุงุช ุงููุธุงู ุงููุชุนููุฉ ุจุจุฏุก ุนูููุงุช ุฌุฏูุฏุฉ - ุงุณุชูุณุงุฎ () ู execve () - ููู ุฎุงุตุฉ ููุท.  ูุฐุง ูุง ูุงุฏูุง ุฅูู ุงูุจุญุซ ุนู ุฎูุงุฑุงุช ุฌุฏูุฏุฉ. <br><br><h3 style=";text-align:right;direction:rtl">  ุจุงุณุชุฎุฏุงู kprobes </h3><br>  ูุงู ุฃุญุฏ ุงูุฎูุงุฑุงุช ุงูุชู ุชู ุงููุธุฑ ูููุง ูู ุงุณุชุฎุฏุงู <em>kprobes</em> : ูุงุฌูุฉ ุจุฑูุฌุฉ ุชุทุจููุงุช ูุชุฎุตุตุฉ ูุตููุฉ ุฃุณุงุณูุง ูุชุตุญูุญ ุงูุฃุฎุทุงุก ูุชุชุจุน ุงูููุงุฉ.  ุชุชูุญ ูู ูุฐู ุงููุงุฌูุฉ ุชุนููู ูุนุงูุฌุงุช ูุง ูุจู ููุง ุจุนุฏ <em>ูุฃูุฉ ุชุนูููุงุช</em> ูู ุงูููุงุฉ ุ ููุฐูู ูุนุงูุฌุงุช ููุฏุฎูู ูุงูุนูุฏุฉ ูู ูุธููุฉ.  ูููู ูููุนุงูุฌุงุช ุงููุตูู ุฅูู ุงูุณุฌูุงุช ููููู ุชุบููุฑูุง.  ูููุฐุง ุ ูููููุง ุงูุญุตูู ุนูู ูู ูู ุงููุฑุงูุจุฉ ูุงููุฏุฑุฉ ุนูู ุงูุชุฃุซูุฑ ุนูู ูุณุงุฑ ุงูุนูู ุงูุฅุถุงูู. <br><br>  ููุงุฆุฏ ุงุณุชุฎุฏุงู kprobes ูุงุนุชุฑุงุถ: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <strong>ูุงุฌูุฉ ุจุฑูุฌุฉ ุชุทุจููุงุช ูุงุถุฌุฉ.</strong>  Kprobes ููุฌูุฏุฉ ูุชุญุณูุช ููุฐ ุฒูู ุณุญูู (2002).  ูุฏููู ูุงุฌูุฉ ููุซูุฉ ุฌูุฏูุง ุ ููุฏ ุชู ุจุงููุนู ุงูุนุซูุฑ ุนูู ูุนุธู ุงููุฒุงูู ุ ูุชู ุชุญุณูู ุนูููู ูุฏุฑ ุงูุฅููุงู ุ ููุง ุฅูู ุฐูู.  ุจุดูู ุนุงู ุ ุฌุจู ูุงูู ูู ุงููุฒุงูุง ุนูู ุงูุฏุฑุงุฌุงุช ุงูุชุฌุฑูุจูุฉ ุฐุงุชูุฉ ุงูุตูุน. <br></li><li style=";text-align:right;direction:rtl">  <strong>ุงุนุชุฑุงุถ ุฃู ููุงู ูู ุงูููุจ.</strong>  ูุชู ุชูููุฐ Kprobes ุจุงุณุชุฎุฏุงู ููุงุท ุงูุชููู (ุชุนูููุงุช int3) ุงููุถููุฉ ูู ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ุงููุงุจูุฉ ููุชูููุฐ ูู kernel.  ูุฐุง ูุณูุญ ูู ุจุชุซุจูุช kprobes ุญุฑููุง ูู ุฃู ููุงู ูู ุฃู ูุธููุฉ ุ ุฅุฐุง ูุงูุช ูุนุฑููุฉ.  ูุจุงููุซู ุ ูุชู ุชูููุฐ kretprobes ูู ุฎูุงู ุงูุชุญุงู ุนููุงู ุงูุฅุฑุฌุงุน ุนูู ุงูููุฏุณ ูุชุณูุญ ูู ุจุงุนุชุฑุงุถ ุงูุฅุฑุฌุงุน ูู ุฃู ูุธููุฉ (ุจุงุณุชุซูุงุก ุชูู ุงูุชู ูุง ุชุนูุฏ ูู ุญูุซ ุงููุจุฏุฃ ููุชุญูู). <br></li></ul><br>  ูุณุงูุฆ kprobes: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <strong>ุงูุตุนูุจุฉ ุงููููุฉ.</strong>  Kprobes ูู ูุฌุฑุฏ ุทุฑููุฉ ูุชุนููู ููุทุฉ ุชููู ูู ุฃู ููุงู ูู ุงูููุงุฉ.  ููุญุตูู ุนูู ุญุฌุฌ ุฏุงูุฉ ุฃู ููู ุงููุชุบูุฑุงุช ุงููุญููุฉ ุ ุชุญุชุงุฌ ุฅูู ูุนุฑูุฉ ุฃู ุงูุณุฌูุงุช ุฃู ููุงููุง ูู ุงูููุฏุณ ุ ูุงุณุชุฎุฑุงุฌูุง ุจุดูู ูุณุชูู ูู ููุงู.  ูุญุธุฑ ุงุณุชุฏุนุงุก ุฏุงูุฉ ุ ูุฌุจ ุนููู ุชุนุฏูู ุญุงูุฉ ุงูุนูููุฉ ูุฏูููุง ุจุญูุซ ูุนุชูุฏ ุงููุนุงูุฌ ุฃูู ูุฏ ุฃุนุงุฏ ุจุงููุนู ุงูุชุญูู ูู ุงููุธููุฉ. <br></li><li style=";text-align:right;direction:rtl">  <strong>ุชู ุฅููุงู Jprobes.</strong>  Jprobes ูู ุฅุถุงูุฉ ูู kprobes ุชุชูุญ ูู ุงุนุชุฑุงุถ ููุงููุงุช ุงููุธุงุฆู ุจุณูููุฉ.  ุณุชููู ุจุงุณุชุฎุฑุงุฌ ุงูุญุฌุฌ ุงูุฎุงุตุฉ ุจุงููุธููุฉ ุจุดูู ูุณุชูู ูู ุงูุณุฌูุงุช ุฃู ุงูููุฏุณ ูุงุณุชุฏุนุงุก ุงููุนุงูุฌ ุงูุฎุงุต ุจู ุ ูุงูุฐู ูุฌุจ ุฃู ูููู ูู ููุณ ุชูููุน ุงูุฏุงูุฉ ุงูููุตูุฉ.  ุงูุตูุฏ ูู ุฃู jprobes ููููู ูููุทูุน ูู ุงูููู ุงูุญุฏูุซุฉ. <br></li><li style=";text-align:right;direction:rtl">  <strong>ุงููููุงุช ุงูุนุงูุฉ ุบูุฑ ุงูุนุงุฏูุฉ.</strong>  ููุงุท ุงูุชููู ุจุงูุธุฉ ุงูุซูู ุ ููููุง ููุฑุฉ ูุงุญุฏุฉ.  ูุง ุชุคุซุฑ ููุงุท ุงูุชููู ุนูู ุงููุธุงุฆู ุงูุฃุฎุฑู ุ ูููู ูุนุงูุฌุชูุง ููููุฉ ูุณุจููุง.  ูุญุณู ุงูุญุธ ุ ูุชู ุชูููุฐ ุงูุชุญุณูู ุงูุณุฑูุน ููููุฏุณุฉ ุงููุนูุงุฑูุฉ x86_64 ุ ููุง ูููู ุจุดูู ูุจูุฑ ูู ุชูููุฉ kprobes ุ ููููู ูุง ูุฒุงู ุฃูุซุฑ ูู ุ ุนูู ุณุจูู ุงููุซุงู ุ ุนูุฏ ุชุนุฏูู ุฌุฏูู ุงุณุชุฏุนุงุก ุงููุธุงู. <br></li><li style=";text-align:right;direction:rtl">  <strong>ุญุฏูุฏ kretprobes.</strong>  ูุชู ุชูููุฐ Kretprobes ุนู ุทุฑูู ุงูุชุญุงู ุนููุงู ุงููุฑุณู ุนูู ุงูููุฏุณ.  ูุจูุงุกู ุนูู ุฐูู ุ ูุญุชุงุฌูู ุฅูู ุชุฎุฒูู ุงูุนููุงู ุงูุฃุตูู ูู ููุงู ูุง ูู ุฃุฌู ุงูุนูุฏุฉ ุฅููู ุจุนุฏ ูุนุงูุฌุฉ kretprobe.  ูุชู ุชุฎุฒูู ุงูุนูุงููู ูู ูุฎุฒู ูุคูุช ุฐู ุญุฌู ุซุงุจุช.  ูู ุญุงูุฉ ุงููุงุฆุถ ุ ุนูุฏูุง ูุชู ุชูููุฐ ุนุฏุฏ ูุจูุฑ ุฌุฏูุง ูู ุงูููุงููุงุช ุงููุชุฒุงููุฉ ูููุธููุฉ ุงูุชู ุชู ุงุนุชุฑุงุถูุง ูู ุงููุธุงู ุ ุณุชุชุฎุทู kretprobes ุงูุนูููุงุช. <br></li><li style=";text-align:right;direction:rtl">  <strong>ุจุซู ูุนุทู.</strong>  ูุธุฑูุง ูุฃู kprobes ูุนุชูุฏ ุนูู ุชุณุฌููุงุช ุงูููุงุทุนุงุช ูุงููุญุงููุงุช ุ ูููุฒุงููุฉ ุ ูุชู ุชูููุฐ ุฌููุน ุงููุนุงูุฌุงุช ูุน ุชุนุทูู ุงูุงุณุชุจุงููุฉ.  ููุฑุถ ูุฐุง ูููุฏูุง ูุนููุฉ ุนูู ุงููุนุงูุฌุงุช: ูุง ููููู ุงูุงูุชุธุงุฑ ูููุง - ุฎุตุต ุงููุซูุฑ ูู ุงูุฐุงูุฑุฉ ุ ููู ุจุฅุฏุฎุงู / ุฅุฎุฑุงุฌ ุ ูุงูููู ูู ุงููุคูุชุงุช ูุงูุฃุดุงุฑุงุช ุ ูุบูุฑูุง ูู ุงูุฃุดูุงุก ุงููุนุฑููุฉ. <br></li></ul><br>  ูู ุนูููุฉ ุงูุจุญุซ ุนู ุงูููุถูุน ุ ุณูุทุช ุฃุนูููุง ุนูู ุฅุทุงุฑ <strong>ftrace</strong> ุ ูุงูุฐู ูููู ุฃู ูุญู ูุญู jprobes.  ููุง ุงุชุถุญ ุ ูุฅูู ูุนูู ุจุดูู ุฃูุถู ูุงุญุชูุงุฌุงุช ุงุนุชุฑุงุถ ููุงููุงุช ุงููุธููุฉ ูุฏููุง.  ููุน ุฐูู ุ ุฅุฐุง ููุช ุจุญุงุฌุฉ ุฅูู ุชุชุจุน ุชุนูููุงุช ูุญุฏุฏุฉ ุฏุงุฎู ุงููุธุงุฆู ุ ููุง ููุจุบู ุฎุตู kprobes. <br><br><h3 style=";text-align:right;direction:rtl">  ุงูุฑุจุท </h3><br>  ูู ุฃุฌู ุงูุงูุชูุงู ุ ูุฌุฏุฑ ุฃูุถูุง ูุตู ุงูุทุฑููุฉ ุงูููุงุณูููุฉ ูุงุนุชุฑุงุถ ุงููุธุงุฆู ุ ูุงูุชู ุชุชููู ูู ุงุณุชุจุฏุงู ุงูุชุนูููุงุช ูู ุจุฏุงูุฉ ุงููุธููุฉ ุจุงูุชูุงู ุบูุฑ ูุดุฑูุท ูุคุฏู ุฅูู ูุนุงูุฌูุง.  ูุชู ููู ุงูุชุนูููุงุช ุงูุฃุตููุฉ ุฅูู ููุงู ุขุฎุฑ ููุชู ุชูููุฐูุง ูุจู ุงูุฑุฌูุน ุฅูู ุงููุธููุฉ ุงูุชู ุชู ุงุนุชุฑุงุถูุง.  ุจูุณุงุนุฏุฉ ุงุซููู ูู ุงูุชุญููุงุช ุ ูููุง ุจุฏูุฌ (ูุตู) ุฑูุฒูุง ุงูุฅุถุงูู ูู ุงููุธููุฉ ุ ูุจุงูุชุงูู ูุณูู ูุฐุง ุงูููุฌ <em>ุงูุฑุจุท</em> . <br><br>  ูุฐู ูู ุงูุทุฑููุฉ ุงูุชู ูุชู ุจูุง ุชูููุฐ ุงูุชุญุณูู ุงูุณุฑูุน ูู kprobes.  ุจุงุณุชุฎุฏุงู ุงูุฑุจุท ุ ููููู ุชุญููู ููุณ ุงููุชุงุฆุฌ ุ ูููู ุฏูู ุชูุงููู ุฅุถุงููุฉ ู kprobes ูุงูุชุญูู ุงููุงูู ูู ุงููููู. <br><br>  ููุงุฆุฏ ุงูุฑุจุท ูุงุถุญุฉ: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <strong>ุงูุญุฏ ุงูุฃุฏูู ูู ูุชุทูุจุงุช ุงูููุงุฉ.</strong>  ูุง ูุชุทูุจ ุงูุฑุจุท ุฃู ุฎูุงุฑุงุช ุฎุงุตุฉ ูู ุงูููุงุฉ ููุนูู ูู ุจุฏุงูุฉ ุฃู ูุธููุฉ.  ุชุญุชุงุฌ ููุท ุฅูู ูุนุฑูุฉ ุนููุงููุง. <br></li><li style=";text-align:right;direction:rtl">  <strong>ุงููููุงุช ุงูุนุงูุฉ ุงูุฏููุง.</strong>  ุงูุชูุงูุงู ุบูุฑ ูุดุฑูุทูู - ูุฐุง ูู ูู ุงูุฅุฌุฑุงุกุงุช ุงูุชู ูุฌุจ ุฃู ูููู ุจูุง ุงูุฑูุฒ ุงูุฐู ุชู ุงุนุชุฑุงุถู ูู ุฃุฌู ููู ุงูุชุญูู ุฅูู ุงููุนุงูุฌ ูุงูุนูุณ ุตุญูุญ.  ููุชููุน ุงููุนุงูุฌ ุชูุงููุง ูุซู ูุฐู ุงูุชุญููุงุช ููู ุฑุฎูุตุฉ ุฌุฏูุง. <br></li></ul><br>  ููุน ุฐูู ุ ูุฅู ุงูุนูุจ ุงูุฑุฆูุณู ููุฐุง ุงูููุฌ ูุญุฌุจ ุงูุตูุฑุฉ ุจุดูู ุฎุทูุฑ: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <strong>ุงูุตุนูุจุฉ ุงููููุฉ.</strong>  ุชุชุฏุญุฑุฌ.  ูุง ููููู ููุท ุฃุฎุฐ ุฑูุฒ ุงูุฌูุงุฒ ูุฅุนุงุฏุฉ ูุชุงุจุชู.  ูููุง ููู ูุงุฆูุฉ ูุตูุฑุฉ ูุบูุฑ ููุชููุฉ ุจุงูููุงู ุงููุทููุจ ุญููุง: <br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูุฒุงููุฉ ุงูุชุซุจูุช ูุฅุฒุงูุฉ ุงูุงุนุชุฑุงุถ (ูุงุฐุง ูู ุชู ุงุณุชุฏุนุงุก ุงููุธููุฉ ูุจุงุดุฑุฉ ูู ุนูููุฉ ุงุณุชุจุฏุงู ุชุนูููุงุชูุงุ) </li><li style=";text-align:right;direction:rtl">  ุชุฌุงูุฒ ุงูุญูุงูุฉ ุนูู ุชุนุฏูู ููุงุทู ุงูุฐุงูุฑุฉ ูุน ุฑูุฒ </li><li style=";text-align:right;direction:rtl">  ุฅุจุทุงู ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ููุญุฏุฉ ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉ ุจุนุฏ ุงุณุชุจุฏุงู ุงูุชุนูููุงุช </li><li style=";text-align:right;direction:rtl">  ุชูููู ุงูุชุนูููุงุช ุงููุงุจูุฉ ููุงุณุชุจุฏุงู ููุณุฎูุง ุจุงููุงูู </li><li style=";text-align:right;direction:rtl">  ุงูุชุญูู ูู ุนุฏู ูุฌูุฏ ุงูุชูุงูุงุช ุฏุงุฎู ุงููุทุนุฉ ุงููุณุชุจุฏูุฉ </li><li style=";text-align:right;direction:rtl">  ุชุญูู ูู ุฅููุงููุฉ ููู ุงููุทุนุฉ ุงููุณุชุจุฏูุฉ ุฅูู ูููุน ุขุฎุฑ </li></ul><br>  ูุนู ุ ููููู ุงูุชุฌุณุณ ุนูู kprobes ูุงุณุชุฎุฏุงู ุฅุทุงุฑ Livepatch ุงูุฏุงุฎูู ุ ููู ุงูุญู ุงูููุงุฆู ูุง ูุฒุงู ูุนูุฏูุง ููุบุงูุฉ.  ูู ุงููุฎูู ุชุฎูู ุนุฏุฏ ูุดุงูู ุงูููู ูู ูู ุชูููุฐ ุฌุฏูุฏ. <br></li></ul><br>  ุจุดูู ุนุงู ุ ุฅุฐุง ููุช ูุงุฏุฑูุง ุนูู ุงุณุชุฏุนุงุก ูุฐุง ุงูุดูุทุงู ุ ูุฅุฎุถุงุนู ููุท ูููุจุชุฏุฆูู ุ ูููุช ุนูู ุงุณุชุนุฏุงุฏ ูุชุญููู ูู ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ุงูุฎุงุตุฉ ุจู ุ ูุฅู ุงูุฑุจุท ูู ููุฌ ูุนุงู ุชูุงููุง ูุงุนุชุฑุงุถ ุงุณุชุฏุนุงุกุงุช ุงููุธุงุฆู.  ูุงู ูุฏู ูููู ุณูุจู ูู ูุชุงุจุฉ ุงูุฏุฑุงุฌุงุช ุ ูุฐูู ุธู ูุฐุง ุงูุฎูุงุฑ ูุณุฎุฉ ุงุญุชูุงุทูุฉ ููุง ูู ุญุงูุฉ ุนุฏู ูุฌูุฏ ุชูุฏู ุนูู ุงูุฅุทูุงู ูุน ุงูุญููู ุงูุฌุงูุฒุฉ ุฃุณูู. <br><br><h2 style=";text-align:right;direction:rtl">  ููุฌ ุฌุฏูุฏ ูุน ftrace </h2><br>  <strong>Ftrace</strong> ูู ุฅุทุงุฑ ุชุชุจุน kernel ุนูู ูุณุชูู ุงููุธููุฉ.  ุชู ุชุทููุฑู ููุฐ ุนุงู 2008 ููุฏูู ูุงุฌูุฉ ุฑุงุฆุนุฉ ูุจุฑุงูุฌ ุงููุณุชุฎุฏู.  ูุณูุญ ูู Ftrace ุจุชุชุจุน ุชูุฑุงุฑ ููุฏุฉ ููุงููุงุช ุงููุธุงุฆู ุ ูุนุฑุถ ุงูุฑุณูู ุงูุจูุงููุฉ ููููุงููุงุช ุ ูุชุตููุฉ ุงููุธุงุฆู ุงูุชู ุชูู ุงููุงูุจ ุ ููุง ุฅูู ุฐูู.  ููููู ุงูุจุฏุก ูู ุงููุฑุงุกุฉ ุญูู ููุฒุงุช ftrace <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูู ููุง</a> ุ ุซู ุงุชุจุน ุงูุฑูุงุจุท ูุงููุซุงุฆู ุงูุฑุณููุฉ. <br><br>  ูุทุจู ftrace ุนูู ุฃุณุงุณ ููุงุชูุญ ุงููุชุฑุฌู <code>-pg</code> ู <code>-mfentry</code> ุ ุงูุชู ุชูุฏุฑุฌ ุงูุงุณุชุฏุนุงุก ุฅูู ูุธููุฉ ุงูุชุชุจุน ุงูุฎุงุตุฉ mcount () ุฃู __fentry __ () ูู ุจุฏุงูุฉ ูู ูุธููุฉ.  ุนุงุฏุฉ ุ ูู ุจุฑุงูุฌ ุงููุณุชุฎุฏู ุ ูุชู ุงุณุชุฎุฏุงู ููุฒุฉ ุงููุชุฑุฌู ูุฐู ูู ูุจู ุงููุญูููู ูุชุชุจุน ุงูููุงููุงุช ุฅูู ุฌููุน ุงููุธุงุฆู.  ุชุณุชุฎุฏู ุงูููุงุฉ ูุฐู ุงููุธุงุฆู ูุชูููุฐ ุฅุทุงุฑ ุนูู ftrace. <br><br>  ุฅู ุงุณุชุฏุนุงุก ftrace ูู <em>ูู</em> ูุธููุฉ ุ ุจุงูุทุจุน ุ ููุณ ุฑุฎูุตูุง ุ ูุฐุง ูุฅู ุงูุชุญุณูู ูุชุงุญ <em>ููููุงูู</em> ุงููุนูุงุฑูุฉ ุงูุดุงุฆุนุฉ: <em>ftrace ุงูุฏููุงูููู</em> .  ุฎูุงุตุฉ ุงูููู ูู ุฃู ุงูููุงุฉ ุชุนุฑู ูููุน ุฌููุน ุงูููุงููุงุช ุฅูู mcount () ุฃู __fentry __ () ููู ุงููุฑุงุญู ุงูุฃููู ูู ุงูุชุญููู ุชุณุชุจุฏู ุฑูุฒ ุงูุฌูุงุฒ ุงูุฎุงุต ุจูุง ุจู <strong>nop</strong> - ููู ุชุนูููุงุช ุฎุงุตุฉ ูุง ุชูุนู ุดูุฆูุง.  ุนูุฏ ุชุถููู ุงูุชุชุจุน ูู ุงููุธุงุฆู ุงููุทููุจุฉ ุ ุชุชู ุฅุถุงูุฉ ููุงููุงุช ftrace ูุฑุฉ ุฃุฎุฑู.  ูุจุงูุชุงูู ุ ุฅุฐุง ูู ูุชู ุงุณุชุฎุฏุงู ftrace ุ ูุฅู ุชุฃุซูุฑู ุนูู ุงููุธุงู ูููู ุถุฆููุงู. <br><br><h3 style=";text-align:right;direction:rtl">  ูุตู ุงููุธุงุฆู ุงููุทููุจุฉ </h3><br>  ูููู ูุตู ูู ูุธููุฉ ุชู ุงุนุชุฑุงุถูุง ุจุงูุจููุฉ ุงูุชุงููุฉ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/** * struct ftrace_hook -    * * @name:    * * @function:  -,     *   * * @original:   ,     *  ,    * * @address:   ,    * * @ops:   ftrace,  , *      */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ftrace_hook</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *name; <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> *function; <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> *original; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> address; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ftrace_ops</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ops</span></span></span><span class="hljs-class">;</span></span> };</code> </pre><br>  ูุญุชุงุฌ ุงููุณุชุฎุฏู ูููุก ุงูุญููู ุงูุซูุงุซุฉ ุงูุฃููู ููุท: ุงูุงุณู ูุงููุธููุฉ ูุงูุฃุตู.  ุชุนุชุจุฑ ุงูุญููู ุงููุชุจููุฉ ุชูุงุตูู ุงูุชูููุฐ.  ูููู ุชุฌููุน ูุตู ุฌููุน ุงููุธุงุฆู ุงูุชู ุชู ุงุนุชุฑุงุถูุง ูู ุตููู ููููู ุงุณุชุฎุฏุงู ูุญุฏุงุช ุงููุงูุฑู ูุฒูุงุฏุฉ ุถุบุท ุงูุดูุฑุฉ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> HOOK(_name, _function, _original) \ { \ .name = (_name), \ .function = (_function), \ .original = (_original), \ } static struct ftrace_hook hooked_functions[] = { HOOK(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"sys_clone"</span></span></span><span class="hljs-meta">, fh_sys_clone, &amp;real_sys_clone), HOOK(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"sys_execve"</span></span></span><span class="hljs-meta">, fh_sys_execve, &amp;real_sys_execve), };</span></span></code> </pre><br>  ุงูุฃุบููุฉ ุนูู ุงููุธุงุฆู ุงูุชู ุชู ุงุนุชุฑุงุถูุง ูู ููุง ููู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/* *        execve(). *     .      *  :       , *    ABI (  "asmlinkage"). */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> asmlinkage </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">long</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(*real_sys_execve)</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> __user *filename, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> __user *</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> __user *argv, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> __user *</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> __user *envp)</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">/* *      .   โ  *   .      *  .      ,  *    . */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> asmlinkage </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">long</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fh_sys_execve</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> __user *filename, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> __user *</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> __user *argv, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> __user *</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> __user *envp)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> ret; pr_debug(<span class="hljs-string"><span class="hljs-string">"execve() called: filename=%p argv=%p envp=%p\n"</span></span>, filename, argv, envp); ret = real_sys_execve(filename, argv, envp); pr_debug(<span class="hljs-string"><span class="hljs-string">"execve() returns: %ld\n"</span></span>, ret); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ret; }</code> </pre><br>  ููุง ุชุฑู ุ ูุชู ุงุนุชุฑุงุถ ุงููุธุงุฆู ูุน ุญุฏ ุฃุฏูู ูู ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ุงูุฅุถุงููุฉ.  ุงูุดูุก ุงููุญูุฏ ุงูุฐู ูุชุทูุจ ุนูุงูุฉ ุฏูููุฉ ูู ุชูุงููุน ุงููุธููุฉ.  ูุฌุจ ุฃู ุชุชุทุงุจู ูุน ูุงุญุฏ ููุงุญุฏ.  ุจุฏูู ูุฐุง ุ ูู ุงููุงุถุญ ุ ุณูุชู ุชูุฑูุฑ ุงูุญุฌุฌ ุจุดูู ุบูุฑ ุตุญูุญ ูุณููุฎูุถ โโูู ุดูุก ุฅูู ุฃุณูู.  ูุงุนุชุฑุงุถ ููุงููุงุช ุงููุธุงู ุ ูุฐุง ุฃูู ุฃูููุฉ ุ ูุฃู ูุนุงูุฌุงุชูุง ูุณุชูุฑุฉ ููุบุงูุฉ ุ ููู ุฃุฌู ุงูููุงุกุฉ ุ ุชุชุฎุฐ ุงูุญุฌุฌ ุจููุณ ุงูุชุฑุชูุจ ุงูุฐู ูุทููู ุงููุธุงู ุจุฃููุณูู.  ููุน ุฐูู ุ ุฅุฐุง ููุช ุชุฎุทุท ูุงุนุชุฑุงุถ ูุธุงุฆู ุฃุฎุฑู ุ ูุฌุจ ุฃู ุชุชุฐูุฑ ุฃูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุง ุชูุฌุฏ ูุงุฌูุงุช ูุณุชูุฑุฉ ุฏุงุฎู ุงูููุงุฉ</a> . <br><br><h3 style=";text-align:right;direction:rtl">  ุงูุชููุฆุฉ Ftrace </h3><br>  ุฃููุงู ุ ูุญุชุงุฌ ุฅูู ุงูุนุซูุฑ ุนูู ุนููุงู ุงููุธููุฉ ุงูุชู ุณูุนุชุฑุถูุง ูุญูุธูุง.  ูุชูุญ ูู Ftrace ุชุชุจุน ุงููุธุงุฆู ุจุงูุงุณู ุ ูููููุง ูุง ุฒููุง ุจุญุงุฌุฉ ุฅูู ูุนุฑูุฉ ุนููุงู ุงููุธููุฉ ุงูุฃุตููุฉ ูู ุฃุฌู ุงูุงุชุตุงู ุจูุง. <br><br>  ููููู ุงูุญุตูู ุนูู ุงูุนููุงู ุจุงุณุชุฎุฏุงู <em>kallsyms</em> - ูุงุฆูุฉ ุจุฌููุน ุงูุดุฎุตูุงุช ูู ุงูููุงุฉ.  ุชุชุถูู ูุฐู ุงููุงุฆูุฉ <em>ุฌููุน</em> ุงูุฃุญุฑู ุ ููุง ูุชู ุชุตุฏูุฑูุง ููุท ูููุญุฏุงุช ุงูููุทูุฉ.  ูุจุฏู ุงูุญุตูู ุนูู ุนููุงู ุงููุธููุฉ ุงูููุตูุฉ ุดูุฆูุง ูุซู ูุฐุง: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resolve_hook_address</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(struct ftrace_hook *hook)</span></span></span><span class="hljs-function"> </span></span>{ hook-&gt;address = kallsyms_lookup_name(hook-&gt;name); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!hook-&gt;address) { pr_debug(<span class="hljs-string"><span class="hljs-string">"unresolved symbol: %s\n"</span></span>, hook-&gt;name); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> -ENOENT; } *((<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span>*) hook-&gt;original) = hook-&gt;address; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre><br>  ุจุนุฏ ุฐูู ุ ุชุญุชุงุฌ ุฅูู ุชููุฆุฉ ุจููุฉ <code>ftrace_ops</code> .  ุฅูู ููุฒู <br>  ุงููุฌุงู ูุฌุฑุฏ <em>ุธุงุฆู</em> ุ ููุง ูุดูุฑ ุฅูู ุฑุฏ ุงูุงุชุตุงู ุ ูููููุง ุจุญุงุฌุฉ ุฃูุถุง <br>  ุถุน ุจุนุถ ุงูุฃุนูุงู ุงููููุฉ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fh_install_hook</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(struct ftrace_hook *hook)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> err; err = resolve_hook_address(hook); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (err) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> err; hook-&gt;ops.func = fh_ftrace_thunk; hook-&gt;ops.flags = FTRACE_OPS_FL_SAVE_REGS | FTRACE_OPS_FL_IPMODIFY; <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> }</code> </pre><br>  <em>fh_ftrace_thunk</em> () ูู ุฑุฏ ุงูุงุชุตุงู ุงูุฐู ุณุชุณุชุฏุนูู ftrace ุนูุฏ ุชุชุจุน ุฏุงูุฉ.  ุนูู ูุงุญูุง.  ุณุชููู ุงูุนูุงูุงุช ุงูุชู ูุถุนูุง ุถุฑูุฑูุฉ ูุฅููุงู ุงูุงุนุชุฑุงุถ.  ููุฌููู ftrace ูุญูุธ ูุงุณุชุนุงุฏุฉ ุณุฌูุงุช ุงููุนุงูุฌ ุ ูุงูุชู ูููู ุชุบููุฑ ูุญุชููุงุชูุง ูู ุฑุฏ ุงูุงุชุตุงู. <br><br>  ุงูุขู ูุญู ุนูู ุงุณุชุนุฏุงุฏ ูุชูููู ุงุนุชุฑุงุถ.  ููููุงู ุจุฐูู ุ ูุฌุจ ุนููู ุฃููุงู ุชูููู ftrace ูููุธููุฉ ุงูุชู ุชูููุง ุจุงุณุชุฎุฏุงู ftrace_set_filter_ip () ุ ุซู ุงูุณูุงุญ ูู ftrace ุจุงูุงุชุตุงู ุจุงุณุชุฏุนุงุกูุง ุจุงุณุชุฎุฏุงู register_ftrace_function (): <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fh_install_hook</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(struct ftrace_hook *hook)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> err = ftrace_set_filter_ip(&amp;hook-&gt;ops, hook-&gt;address, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (err) { pr_debug(<span class="hljs-string"><span class="hljs-string">"ftrace_set_filter_ip() failed: %d\n"</span></span>, err); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> err; } err = register_ftrace_function(&amp;hook-&gt;ops); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (err) { pr_debug(<span class="hljs-string"><span class="hljs-string">"register_ftrace_function() failed: %d\n"</span></span>, err); <span class="hljs-comment"><span class="hljs-comment">/*    ftrace   . */</span></span> ftrace_set_filter_ip(&amp;hook-&gt;ops, hook-&gt;address, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> err; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre><br>  ูุชู ุฅููุงู ุงูุงุนุชุฑุงุถ ุจุงููุซู ุ ููุท ูู ุงูุชุฑุชูุจ ุงูุนูุณู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fh_remove_hook</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(struct ftrace_hook *hook)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> err; err = unregister_ftrace_function(&amp;hook-&gt;ops); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (err) { pr_debug(<span class="hljs-string"><span class="hljs-string">"unregister_ftrace_function() failed: %d\n"</span></span>, err); } err = ftrace_set_filter_ip(&amp;hook-&gt;ops, hook-&gt;address, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (err) { pr_debug(<span class="hljs-string"><span class="hljs-string">"ftrace_set_filter_ip() failed: %d\n"</span></span>, err); } }</code> </pre><br>  ุจุนุฏ ุงูุชูุงู ุงูุงุณุชุฏุนุงุก ูู unregister_ftrace_function () ุ ูุชู ุถูุงู ุนุฏู ุชูุนูู ุงูุชูุดูุท ุงูุฎุงุต ุจุงูุงุณุชุฏุนุงุก ุงููุซุจุช ูู ุงููุธุงู (ููุนู ุงูุฃุบููุฉ ุงูุฎุงุตุฉ ุจูุง).  ูุฐูู ุ ูููููุง ุ ุนูู ุณุจูู ุงููุซุงู ุ ุฅูุบุงุก ุชุญููู ูุญุฏุฉ ุงูุงุนุชุฑุงุถ ุจูุฏูุก ุ ุฏูู ุฎูู ูู ุฃู ูุธุงุฆููุง ูุง ุชุฒุงู ุชุคุฏู ูู ููุงู ูุง ูู ุงููุธุงู (ูุฃูู ุฅุฐุง ุงุฎุชูุช ุ ูุณูููู ุงููุนุงูุฌ ููุฒุนุฌูุง). <br><br><h3 style=";text-align:right;direction:rtl">  ุชูููุฐ ุฑุจุท ูุธููุฉ </h3><br>  ููู ูุชู ุงุนุชุฑุงุถ ุงููุงูุนุ  ุจุณูุท ุฌุฏุง.  ูุชูุญ ูู Ftrace ุชุบููุฑ ุญุงูุฉ ุงูุณุฌูุงุช ุจุนุฏ ุงูุฎุฑูุฌ ูู ุฑุฏ ุงูุงุชุตุงู.  ุนู ุทุฑูู ุชุบููุฑ ุชุณุฌูููช rip - ูุคุดุฑ ุฅูู ุงูุชุนูููุงุช ุงูุชูููุฐูุฉ ุงูุชุงููุฉ - ูููู ุจุชุบููุฑ ุงูุชุนูููุงุช ุงูุชู ูููุฐูุง ุงููุนุงูุฌ - ุฃู ูููููุง ูุฑุถู ุนูู ุชูููุฐ ุงูุชูุงู ุบูุฑ ูุดุฑูุท ูู ุงููุธููุฉ ุงูุญุงููุฉ ุฅูู ูุธููุชูุง.  ูููุฐุง ูุณูุทุฑ. <br><br>  ุงูุงุณุชุฏุนุงุก ุงูุฎุงุต ุจู ftrace ุนูู ุงููุญู ุงูุชุงูู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> notrace </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fh_ftrace_thunk</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ip, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> parent_ip, struct ftrace_ops *ops, struct pt_regs *regs)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ftrace_hook</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">hook</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">container_of</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ops</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ftrace_hook</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ops</span></span></span><span class="hljs-class">);</span></span> regs-&gt;ip = (<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span>) hook-&gt;function; }</code> </pre><br>  ุจุงุณุชุฎุฏุงู ุงููุงูุฑู container_of () ุ ูุญุตู ุนูู ุนููุงู <code>struct ftrace_hook</code> ุนูู ุนููุงู <code>struct ftrace_hook</code> ุงููุถููุฉ ููู ุ ุซู ูุณุชุจุฏู ูููุฉ ุงูุชุณุฌูููช rip ูู <code>struct pt_regs</code> .  ูุฐุง ูู ุดูุก.  ุจุงููุณุจุฉ ููููุงูู ุงูุฃุฎุฑู ุบูุฑ x86_64 ุ ูุฏ ููุณูู ูุฐุง ุงูุณุฌู ุจุดูู ูุฎุชูู (ูุซู IP ุฃู ุงูููุจููุชุฑ ุงูุดุฎุตู) ุ ููู ุงูููุฑุฉ ุชูุทุจู ูู ุญูุซ ุงููุจุฏุฃ ุนูููุง. <br><br>  ูุงุญุธ <strong>ูุคูู notrace</strong> ุงููุถุงูุฉ <strong>ูุฑุฏ</strong> ุงูุงุชุตุงู.  ูููููู ุงูุฅุจูุงุบ ุนู ุงูููุฒุงุช ุงูุชู ูุง ููุณูุญ ุจุชุชุจุนูุง ุจุงุณุชุฎุฏุงู ftrace.  ุนูู ุณุจูู ุงููุซุงู ุ ูุฐู ูู ุงูุทุฑููุฉ ุงูุชู ูุชู ุจูุง ุชูููุฒ ูุธุงุฆู ftrace ููุณูุง ุงูุชู ุชูุทูู ุนูููุง ุนูููุฉ ุงูุชุชุจุน.  ูุฐุง ูุณุงุนุฏ ุนูู ููุน ุงููุธุงู ูู ุงูุชุฌูุฏ ูู ุญููุฉ ูุง ููุงุฆูุฉ ุนูุฏ ุชุชุจุน ุฌููุน ุงููุธุงุฆู ูู ุงูููุงุฉ (ูููู ุฃู ุชูุนู ftrace ุฐูู). <br><br>  ุนุงุฏุฉ ูุง ูุชู ุงุณุชุฏุนุงุก ุฑุฏ ูุนู ftback ูุน ุชุนุทูู ุงูุจุซู (ูุซู kprobes).  ูุฏ ุชููู ููุงู ุงุณุชุซูุงุกุงุช ุ ูููู ูุง ูุฌุจ ุงูุงุนุชูุงุฏ ุนูููุง.  ููุน ุฐูู ุ ูู ุญุงูุชูุง ุ ูุฐุง ุงูุชูููุฏ ููุณ ููููุง ุ ูุฐูู ูุณุชุจุฏู ุซูุงููุฉ ุจุงูุชุงุช ููุท ูู ุงูุจููุฉ. <br><br>  ุณูุชู ุชูููุฐ ุฏุงูุฉ ุงููู ุ ุงูุชู ุชุณูู ูุงุญููุง ุ ูู ููุณ ุณูุงู ุงููุธููุฉ ุงูุฃุตููุฉ.  ูุฐูู ุ ููุงู ููููู ุงูููุงู ุจูุง ูู ูุณููุญ ุจู ูู ุงูุฏุงูุฉ ุงูุชู ุชู ุงุนุชุฑุงุถูุง.  ุนูู ุณุจูู ุงููุซุงู ุ ุฅุฐุง ุงุนุชุฑุถุช ูุนุงูุฌ ููุงุทุนุฉ ุ ููุง ูุฒุงู ุจุฅููุงูู ุงูููู ูู ุบูุงู. <br><br><h3 style=";text-align:right;direction:rtl">  ุญูุงูุฉ ุงูููุงููุฉ ุงูุนูุฏูุฉ </h3><br>     :      ,     ftrace,     ,     .     - . <br><br>   ,      โ   <code>parent_ip</code> โ    ftrace-,      ,    .         .       ,        . <br><br> ,    <code>parent_ip</code>     ,     โ -    .        ,       . <br><br>       ,       (    ).     ,        .       . <br><br> ,  ftrace-   : <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> notrace </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fh_ftrace_thunk</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ip, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> parent_ip, struct ftrace_ops *ops, struct pt_regs *regs)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ftrace_hook</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">hook</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">container_of</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ops</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ftrace_hook</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ops</span></span></span><span class="hljs-class">);</span></span> <span class="hljs-comment"><span class="hljs-comment">/*      . */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!within_module(parent_ip, THIS_MODULE)) regs-&gt;ip = (<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span>) hook-&gt;function; }</code> </pre><br>  /  : <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"> <strong>  .</strong>      .  ,   ,   . <br></li><li style=";text-align:right;direction:rtl"> <strong>   .</strong>         .       ,         . <br></li><li style=";text-align:right;direction:rtl"> <strong>   .</strong>     <em>kretprobes</em>         ,     (      ).           ,       . <br></li></ul><br><h3 style=";text-align:right;direction:rtl">    </h3><br>  :      <strong>ls</strong> ,       .   (, Bash)         <em>fork</em> () + <em>execve</em> ()     .        <strong>clone()</strong>  <strong>execve()</strong> . ,     execve(),     . <br><br>     -  : <br><br><img alt="sequence-  " src="https://habrastorage.org/webt/ok/mm/4x/okmm4xnova8g2nfmx7y60oocuju.png"><br><br>   ,    ( <font color="#66B2FF"></font> )      ( <font color="#EA6B66"></font> ),   ftrace ( <font color="#A680B8"></font> )      ( <font color="#97D077"></font> ). <br><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"> <strong>   SYSCALL.</strong>                 โ <em>entry_SYSCALL_64</em> ().       64-   64- . <br></li><li style=";text-align:right;direction:rtl"> <strong>    .</strong>     , <a href="">  </a> ,      <em>do_syscall_64</em> (), <a href="">  </a> .            <code>sys_call_table</code>          โ       <em>sys_execve</em> (). <br></li><li style=";text-align:right;direction:rtl"> <strong> ftrace.</strong>         <em>__fentry__</em> (),    ftrace.  ,    ,       <em>nop</em> ,      sys_execve()   . <br></li><li style=";text-align:right;direction:rtl"> <strong>Ftrace   .</strong>    ftrace     ,   .         ,    %rip,       . <br></li><li style=";text-align:right;direction:rtl"> <strong>  .</strong>     <code>parent_ip</code> ,   do_syscall_64() โ        sys_execve() โ     ,   <em> %rip</em>   <code>pt_regs</code> . <br></li><li style=";text-align:right;direction:rtl"> <strong>Ftrace  .</strong>   FTRACE_SAVE_REGS, ftrace      <code>pt_regs</code>   .    ftrace     .     %rip โ      โ          . <br></li><li style=";text-align:right;direction:rtl"> <strong>  -.</strong> -     sys_execve()   .       <em>fh_sys_execve</em> ().           ,                do_syscall_64(). <br></li><li style=";text-align:right;direction:rtl"> <strong>   .</strong>          .  fh_sys_execve()        (  )       .        .        โ sys_execve()  ,   <em>real_sys_execve</em> ,      . <br></li><li style=";text-align:right;direction:rtl"> <strong>  .</strong>      sys_execve(),     ftrace     . ,       -โฆ <br></li><li style=";text-align:right;direction:rtl"> <strong>   .</strong>       sys_execve()    fh_sys_execve(),     do_syscall_64().         sys_execve()   .     : ftrace    sys_execve() . <br></li><li style=";text-align:right;direction:rtl"> <strong>  .</strong>       sys_execve()      fh_sys_execve().        .   ,    execve()  ,   ,     ,  . . <br></li><li style=";text-align:right;direction:rtl"> <strong>  .</strong>  fh_sys_execve()      do_syscall_64(),  ,       .     . <br></li><li style=";text-align:right;direction:rtl"> <strong>    .</strong>     IRET ( SYSRET,   execve() โ  IRET),               .   (   ) . <br></li></ol><br><h2 style=";text-align:right;direction:rtl">    </h2><br>            ,   : <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"> <strong> API   .</strong>        .       ,     ,      .   โ   -,    . <br></li><li style=";text-align:right;direction:rtl"> <strong>    .</strong>            .   -     ,     ,  ,  - .      (    ),    . <br></li><li style=";text-align:right;direction:rtl"> <strong>   .</strong> ,       ftrace,            .  kprobes      ftrace. <br></li></ul><br>      ? <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"> <strong>   .</strong>        ftrace      : <br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">   kallsyms      </li><li style=";text-align:right;direction:rtl">  ftrace      </li><li style=";text-align:right;direction:rtl">  ftrace,     </li></ul><br>                . ,  ,   ,        ,           . ,     -  ,       . <br></li><li style=";text-align:right;direction:rtl"> <strong>   ftrace</strong> ,   kprobes (  ftrace    ),   ,   ,  . , <em> ftrace</em> โ      ,    ยซยป  ftrace   . <br></li><li style=";text-align:right;direction:rtl"> <strong>  .</strong>    ,      . ,         ,  ftrace    . ,         ,       . <br></li><li style=";text-align:right;direction:rtl"> <strong>  ftrace.</strong>       <code>parent_ip</code>     ftrace   .           ,        .    ,    :  ftrace    ,          5  (  call),   ftrace  . <br></li></ul><br>    . <br><br><h3 style=";text-align:right;direction:rtl">     </h3><br>  ,    ftrace  kallsyms.       : <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"> CONFIG_FTRACE </li><li style=";text-align:right;direction:rtl"> CONFIG_KALLSYMS </li></ul><br> , ftrace     .      <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"> CONFIG_DYNAMIC_FTRACE_WITH_REGS </li></ul><br> ,       <em> 3.19  </em> ,      FTRACE_OPS_FL_IPMODIFY.         %rip,    3.19        .         ,      โ   . <br><br> ,        ftrace  :      ,    (         ).      <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"> CONFIG_HAVE_FENTRY </li></ul><br>  x86_64   ,   i386 โ . -   i386      ftrace   ,     ftrace     .           %eip โ     ,   ,      . <br><br>       ftrace   32-  x86.  ,           (   ยซยป),      ,      ftrace. <br><br><h3 style=";text-align:right;direction:rtl">   </h3><br>         <em></em> :          . ,     ,    .        ,      . <br><br>  ,      .  -        ftrace-  <code>parent_ip</code>         . -    ,   ftrace      ,   -  . <br><br>  ,       ,    ,       .        ,       -. <br><br>    : <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> asmlinkage </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">long</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fh_sys_execve</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> __user *filename, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> __user *</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> __user *argv, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> __user *</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> __user *envp)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> ret; pr_debug(<span class="hljs-string"><span class="hljs-string">"execve() called: filename=%p argv=%p envp=%p\n"</span></span>, filename, argv, envp); ret = real_sys_execve(filename, argv, envp); pr_debug(<span class="hljs-string"><span class="hljs-string">"execve() returns: %ld\n"</span></span>, ret); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ret; }</code> </pre><br>    โ  : <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> asmlinkage </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">long</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fh_sys_execve</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> __user *filename, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> __user *</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> __user *argv, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> __user *</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> __user *envp)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> ret; pr_devel(<span class="hljs-string"><span class="hljs-string">"execve() called: filename=%p argv=%p envp=%p\n"</span></span>, filename, argv, envp); ret = real_sys_execve(filename, argv, envp); pr_devel(<span class="hljs-string"><span class="hljs-string">"execve() returns: %ld\n"</span></span>, ret); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ret; }</code> </pre><br>   ,      ?              ,    .       -    ,     . <br><br> ,  ,  ,   pr_devel()   .   printk-      .        ,     ,     DEBUG.        : <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> asmlinkage </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">long</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fh_sys_execve</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> __user *filename, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> __user *</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> __user *argv, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> __user *</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> __user *envp)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> real_sys_execve(filename, argv, envp); }</code> </pre><br>      .       <em>  </em> (tail call optimization).             ,           .       : <br><br><pre style=";text-align:right;direction:rtl"> <code class="hljs xml">0000000000000000 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">fh_sys_execve</span></span></span><span class="hljs-tag">&gt;</span></span>: 0: e8 00 00 00 00 callq 5 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">fh_sys_execve+0x5</span></span></span><span class="hljs-tag">&gt;</span></span> 5: ff 15 00 00 00 00 callq *0x0(%rip) b: f3 c3 repz retq</code> </pre><br>   โ  : <br><br><pre style=";text-align:right;direction:rtl"> <code class="hljs perl"><span class="hljs-number"><span class="hljs-number">0000000000000000</span></span> &lt;fh_sys_execve&gt;: <span class="hljs-number"><span class="hljs-number">0</span></span>: e8 <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> callq <span class="hljs-number"><span class="hljs-number">5</span></span> &lt;fh_sys_execve+<span class="hljs-number"><span class="hljs-number">0x5</span></span>&gt; <span class="hljs-number"><span class="hljs-number">5</span></span>: <span class="hljs-number"><span class="hljs-number">48</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span>b <span class="hljs-number"><span class="hljs-number">05</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> mov <span class="hljs-number"><span class="hljs-number">0x0</span></span>(%rip),%rax c: ff e<span class="hljs-number"><span class="hljs-number">0</span></span> jmpq *%rax</code> </pre><br>   CALL โ     __fentry__(),      .         real_sys_execve (   )   CALL    fh_sys_execve()    RET.       real_sys_execve()    JMP. <br><br>          ยซยป  ,      ,     CALL. ,         โ   <code>parent_ip</code>     .    fh_sys_execve()        ,    โ   .  <code>parent_ip</code>    ,          . <br><br>   ,       .          .          . <br><br>              -: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">pragma</span></span></span><span class="hljs-meta"> GCC optimize(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"-fno-optimize-sibling-calls"</span></span></span><span class="hljs-meta">)</span></span></code> </pre><br><h2 style=";text-align:right;direction:rtl">  ุงูุฎูุงุตุฉ </h2><br>    โฆ      Linux โ  .  ,    -     ,          . <br><br>       ,        <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="> Github</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar413241/">https://habr.com/ru/post/ar413241/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar413231/index.html">ููุฏูุฉ ููุนููุฏ ุงูุฐููุฉ</a></li>
<li><a href="../ar413233/index.html">ุชุฑุณู ุฎุฏูุฉ uLogin ุงูุจูุงูุงุช ูู ุงูููุงุฐุฌ (ุงูุจุฑูุฏ ูุงููุงุชู) ุฅูู ูููุน ุชุงุจุน ูุฌูุฉ ุฎุงุฑุฌูุฉ ููู ุตุงูุชุฉ ุจุดุฃู ุฐูู</a></li>
<li><a href="../ar413235/index.html">ุงูุฑูุงู ุนูู ุชููุนุงุช ุฃูุถู: ุฑูุงุถูุงุช ุฌุฏูุฏุฉ ููุชูุจุคุงุช ุงูุฌููุฉ</a></li>
<li><a href="../ar413237/index.html">ูููู Facebook ุฅุฑุณุงู ุจูุงูุงุช ูุตูุนู ุงูุฃุฌูุฒุฉ ุฅูู ููุณ ุจูุงูุงุช ูุทูุฑ ุงูุจุฑุงูุฌ Alexander Kogan</a></li>
<li><a href="../ar413239/index.html">ููููุฉ ุฌุนู ุงููุงุชู ุงูุฐูู ุฃูุซุฑ ุบุจุงุก</a></li>
<li><a href="../ar413243/index.html">ูุฏุฑุณุฉ ุงูุจูุงูุงุช: ููููุฉ ุงูุฌูุน ุจูู ุงูุฑูุงุถูุงุช ูุงูุฃุนูุงู</a></li>
<li><a href="../ar413245/index.html">ุนูู ูุนุฏุงุช Dolby Atmos - ุตูุช "ุฃุตูู" ููุท. ูุญุธุฑ Dolby ุงููุฒุฌ ุบูุฑ ุงูุฃุตูู</a></li>
<li><a href="../ar413247/index.html">ููุงุฐุง ูุฑุงูุจุฉ ุฃูุธูุฉ ุงูุชุฎุฒููุ</a></li>
<li><a href="../ar413249/index.html">ูุชุงุจุฉ ูุญุฏุฉ ููุงุฉ ููููุณ: I2C</a></li>
<li><a href="../ar413251/index.html">ุชูุงุนู ุณูุณูุฉ ุงูุจููุฑุฉ ูููุงุฏูููุณุชูู</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>