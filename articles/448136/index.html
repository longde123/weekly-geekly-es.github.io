<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üöÜ ‚úçüèª ü•Ö Instrucciones: c√≥mo probar roles ansibles y descubrir problemas antes de la producci√≥n üñêüèº ‚ù§Ô∏è üê∂</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola a todos! 


 Trabajo como ingeniero DevOps en el servicio de reservas de hotel Ostrovok.ru . En este art√≠culo quiero hablar sobre nuestra experie...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Instrucciones: c√≥mo probar roles ansibles y descubrir problemas antes de la producci√≥n</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ostrovok/blog/448136/"><p>  Hola a todos! </p><br><p>  Trabajo como ingeniero DevOps en el servicio de reservas de hotel <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Ostrovok.ru</a> .  En este art√≠culo quiero hablar sobre nuestra experiencia en la prueba de roles ansibles. </p><br><p>  En Ostrovok.ru, utilizamos ansible como administrador de configuraci√≥n.  Recientemente surgi√≥ la necesidad de probar roles, pero result√≥ que no hay muchas herramientas para esto: el marco Molecule es quiz√°s el m√°s popular, por lo que decidimos usarlo.  Pero result√≥ que su documentaci√≥n guardaba silencio sobre muchas trampas.  No pudimos encontrar una gu√≠a suficientemente detallada en ruso, por lo que decidimos escribir este art√≠culo. </p><br><img src="https://habrastorage.org/webt/a-/ia/np/a-ianpukaixuflfp5svh_vpj8tu.png"><a name="habracut"></a><br><h1>  Mol√©cula </h1><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Mol√©cula</a> : un marco para ayudar a probar roles ansibles. </p><br><p>  Descripci√≥n simplificada: la mol√©cula crea una instancia en la plataforma que especifique (nube, m√°quina virtual, contenedor; para obtener m√°s detalles, consulte la secci√≥n <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Controlador</a> ), ejecuta su funci√≥n en ella, luego ejecuta las pruebas y elimina la instancia.  En caso de falla en uno de los pasos, la Mol√©cula le informar√° de esto. </p><br><p>  Ahora con m√°s detalle. </p><br><h3 id="nemnogo-teorii">  Poco de teor√≠a </h3><br><p>  Considere las dos entidades clave de la mol√©cula: escenario y controlador. </p><br><h4 id="scenario">  Escenario </h4><br><p> El script contiene una descripci√≥n de qu√©, d√≥nde, c√≥mo y en qu√© secuencia se realizar√°.  Un rol puede tener varios scripts, y cada uno es un directorio a lo largo de la ruta <code>&lt;role&gt;/molecule/&lt;scenario&gt;</code> , que contiene descripciones de las acciones necesarias para la prueba.  La secuencia de comandos <code>default</code> debe estar presente, que se crear√° autom√°ticamente si inicializa el rol utilizando la Mol√©cula.  Los nombres de los siguientes escenarios se eligen a su discreci√≥n. </p><br><p>  La secuencia de prueba en el script se llama <strong>matriz</strong> , y por defecto es la siguiente: </p><br><p>  <em>(¬øLos pasos marcados con <code>?</code> omiten de forma predeterminada si el usuario no lo describe)</em> </p><br><ul><li>  <code>lint</code> : ejecute linter.  Por defecto, se <code>yamllint</code> y <code>flake8</code> , </li><li>  <code>destroy</code> : eliminar instancias del √∫ltimo lanzamiento de Molecule (si se dej√≥), </li><li>  <code>dependency</code> ?  - instalaci√≥n de dependencia ansible del rol probado, </li><li>  <code>syntax</code> : verifique la sintaxis de un rol usando <code>ansible-playbook --syntax-check</code> , </li><li>  <code>create</code> : crea una instancia, </li><li>  <code>prepare</code>  - preparaci√≥n de la instancia;  por ejemplo, verificar / instalar python2 </li><li>  <code>converge</code> - lanzamiento del libro de jugadas probado, </li><li>  <code>idempotence</code> : reinicie el libro de jugadas para la prueba de idempotencia, </li><li>  <code>side_effect</code> ?  - acciones no directamente relacionadas con el rol, pero necesarias para las pruebas, </li><li>  <code>verify</code> : ejecute pruebas de la configuraci√≥n resultante usando <code>testinfra</code> (predeterminado) / <code>goss</code> / <code>goss</code> , </li><li>  <code>cleanup</code> ?  - (en nuevas versiones) - en t√©rminos generales, la "limpieza" de la infraestructura externa afectada por la Mol√©cula, </li><li>  <code>destroy</code> : eliminar una instancia. </li></ul><br><p>  Esta secuencia cubre la mayor√≠a de los casos, pero puede cambiarla si es necesario. </p><br><p>  Cada uno de los pasos anteriores se puede ejecutar por separado utilizando la <code>molecule &lt;command&gt;</code> .  Pero vale la pena entender que para cada uno de estos comandos cli puede existir su propia secuencia de acciones, que puede reconocerse ejecutando la <code>molecule matrix &lt;command&gt;</code> la <code>molecule matrix &lt;command&gt;</code> .  Por ejemplo, cuando ejecuta el comando de <code>converge</code> (ejecute el libro de jugadas probado), se realizar√°n las siguientes acciones: </p><br><pre> <code class="bash hljs">$ molecule matrix converge ... ‚îî‚îÄ‚îÄ default <span class="hljs-comment"><span class="hljs-comment">#   ‚îú‚îÄ‚îÄ dependency #   ‚îú‚îÄ‚îÄ create #   ‚îú‚îÄ‚îÄ prepare #   ‚îî‚îÄ‚îÄ converge #  </span></span></code> </pre> <br><p>  La secuencia de estas acciones se puede editar.  Si algo de la lista ya se ha completado, se omitir√°.  El estado actual, as√≠ como la configuraci√≥n de la instancia, se almacenan en el directorio <code>$TMPDIR/molecule/&lt;role&gt;/&lt;scenario&gt;</code> . </p><br><p>  A√±adir pasos con <code>?</code>  Puede, despu√©s de haber descrito las acciones deseadas en el formato de ansible-playbook, y crear el nombre del archivo de acuerdo con el paso: <code>prepare.yml</code> / <code>side_effect.yml</code> .  La mol√©cula esperar√° estos archivos en la carpeta del script. </p><br><h4 id="driver">  Conductor </h4><br><p>  Un controlador es una entidad donde se crean instancias de prueba. <br>  La lista de controladores est√°ndar para los que la Mol√©cula tiene plantillas listas es la siguiente: Azure, Docker, EC2, GCE, LXC, LXD, OpenStack, Vagrant, Delegated. </p><br><p>  En la mayor√≠a de los casos, las plantillas son los <code>destroy.yml</code> <code>create.yml</code> y <code>destroy.yml</code> en la carpeta del script que describen la creaci√≥n y eliminaci√≥n de la instancia, respectivamente. <br>  Las excepciones son Docker y Vagrant, ya que las interacciones con sus m√≥dulos pueden ocurrir sin los archivos anteriores. </p><br><p>  Vale la pena resaltar el controlador Delegado, ya que si se usa en los archivos para crear y eliminar una instancia, solo se describe el trabajo con la configuraci√≥n de instancias, el resto debe ser descrito por el ingeniero. </p><br><p>  El controlador predeterminado es Docker. </p><br><p>  Ahora pasamos a la pr√°ctica y consideramos otras caracter√≠sticas all√≠. </p><br><h3 id="nachalo-raboty">  Empezando </h3><br><p>  Como "hola mundo", probamos el papel simple de instalar nginx.  Elegiremos docker como controlador. Creo que est√° instalado en la mayor√≠a de ustedes (y recuerden que docker es el controlador predeterminado). </p><br><p>  Prepare <code>virtualenv</code> e instale la <code>molecule</code> en √©l: </p><br><pre> <code class="bash hljs">&gt; pip install virtualenv &gt; virtualenv -p `<span class="hljs-built_in"><span class="hljs-built_in">which</span></span> python2` venv &gt; <span class="hljs-built_in"><span class="hljs-built_in">source</span></span> venv/bin/activate &gt; pip install molecule docker <span class="hljs-comment"><span class="hljs-comment"># molecule  ansible  ; docker  </span></span></code> </pre> <br><p>  El siguiente paso es inicializar un nuevo rol. <br>  La inicializaci√≥n de un nuevo rol, as√≠ como un nuevo escenario, se realiza utilizando el comando <code>molecule init &lt;params&gt;</code> : </p><br><pre> <code class="bash hljs">&gt; molecule init role -r nginx --&gt; Initializing new role nginx... Initialized role <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> &lt;path&gt;/nginx successfully. &gt; <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> nginx &gt; tree -L 1 . ‚îú‚îÄ‚îÄ README.md ‚îú‚îÄ‚îÄ defaults ‚îú‚îÄ‚îÄ handlers ‚îú‚îÄ‚îÄ meta ‚îú‚îÄ‚îÄ molecule ‚îú‚îÄ‚îÄ tasks ‚îî‚îÄ‚îÄ vars 6 directories, 1 file</code> </pre> <br><p>  El resultado fue un t√≠pico papel ansible.  Adem√°s, todas las interacciones con las mol√©culas CLI se hacen desde la ra√≠z del rol. </p><br><p>  Veamos qu√© hay en el directorio de roles: </p><br><pre> <code class="bash hljs">&gt; tree molecule/default/ molecule/default/ ‚îú‚îÄ‚îÄ Dockerfile.j2 <span class="hljs-comment"><span class="hljs-comment"># Jinja-  Dockerfile ‚îú‚îÄ‚îÄ INSTALL.rst. #       ‚îú‚îÄ‚îÄ molecule.yml #   ‚îú‚îÄ‚îÄ playbook.yml #    ‚îî‚îÄ‚îÄ tests #     verify ‚îî‚îÄ‚îÄ test_default.py 1 directory, 6 files</span></span></code> </pre> <br><p>  Analicemos la <code>molecule/default/molecule.yml</code> (reemplazaremos solo la imagen del acoplador): </p><br><pre> <code class="plaintext hljs">--- dependency: name: galaxy driver: name: docker lint: name: yamllint platforms: - name: instance image: centos:7 provisioner: name: ansible lint: name: ansible-lint scenario: name: default verifier: name: testinfra lint: name: flake8</code> </pre> <br><h4 id="dependency">  dependencia </h4><br><p>  Esta secci√≥n describe la fuente de las dependencias. </p><br><p>  Posibles opciones: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">galaxia</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">dorado</a> , concha. </p><br><p>  Shell es solo un shell de comando que se usa si galaxy y gilt no cubren sus necesidades. </p><br><p>  No me detendr√© aqu√≠ por mucho tiempo, se describe lo suficiente en la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">documentaci√≥n</a> . </p><br><h4 id="driver-1">  chofer </h4><br><p>  El nombre del conductor.  Tenemos esta ventana acoplable. </p><br><h4 id="lint">  pelusa </h4><br><p>  Como linter, se usa yamllint. </p><br><p>  Las opciones √∫tiles en esta parte de la configuraci√≥n son la capacidad de especificar un archivo de configuraci√≥n para yamllint, reenviar variables de entorno o deshabilitar la interfaz: </p><br><pre> <code class="plaintext hljs">lint: name: yamllint options: config-file: foo/bar env: FOO: bar enabled: False</code> </pre> <br><h4 id="platforms">  plataformas </h4><br><p>  Describe la configuraci√≥n de instancias. <br>  En el caso de la ventana acoplable como controlador, la mol√©cula se repite en esta secci√≥n y cada elemento de la lista est√° disponible en <code>Dockerfile.j2</code> como una variable de <code>item</code> . </p><br><p>  En el caso del controlador, en el que <code>destroy.yml</code> <code>create.yml</code> y <code>destroy.yml</code> , la secci√≥n est√° disponible en ellos como <code>molecule_yml.platforms</code> , y las iteraciones en √©l ya se describen en estos archivos. </p><br><p>  Dado que Molecule proporciona control de instancia para m√≥dulos ansibles, se debe buscar una lista de configuraciones posibles all√≠.  Para docker, por ejemplo, se <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">utiliza el</a> m√≥dulo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">docker_container_module</a> .  Los m√≥dulos que se utilizan en otros controladores se pueden encontrar en la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">documentaci√≥n</a> . </p><br><p>  Y tambi√©n se pueden encontrar ejemplos del uso de varios controladores <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">en las pruebas de la propia Mol√©cula</a> . </p><br><p>  Reemplace <strong>centos: 7</strong> en <strong>ubuntu aqu√≠</strong> . </p><br><h4 id="provisioner">  aprovisionador </h4><br><p>  "Proveedor" es la entidad que controla las instancias.  En el caso de la Mol√©cula, esto es ansible, el soporte para otros no est√° planificado, por lo que esta secci√≥n se puede llamar con reserva a la configuraci√≥n extendida de ansible. <br>  Aqu√≠ puede especificar muchas cosas, destacar√© los momentos principales, en mi opini√≥n: </p><br><ul><li>  <strong>libros de jugadas</strong> : puede especificar qu√© libros de jugadas deben usarse en ciertas etapas. </li></ul><br><pre> <code class="plaintext hljs">provisioner: name: ansible playbooks: create: create.yml destroy: ../default/destroy.yml converge: playbook.yml side_effect: side_effect.yml cleanup: cleanup.yml</code> </pre> <br><ul><li>  <strong>config_options</strong> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">config ansible</a> </li></ul><br><pre> <code class="plaintext hljs">provisioner: name: ansible config_options: defaults: fact_caching: jsonfile ssh_connection: scp_if_ssh: True</code> </pre> <br><ul><li>  <strong>connection_options</strong> : par√°metros de <strong>conexi√≥n</strong> </li></ul><br><pre> <code class="plaintext hljs">provisioner: name: ansible connection_options: ansible_ssh_common_args: "-o 'UserKnownHostsFile=/dev/null' -o 'ForwardAgent=yes'"</code> </pre> <br><ul><li>  <strong>opciones</strong> : <strong>opciones de</strong> respuesta y variables de entorno </li></ul><br><pre> <code class="plaintext hljs">provisioner: name: ansible options: vvv: true diff: true env: FOO: BAR</code> </pre> <br><h4 id="scenario-1">  escenario </h4><br><p>  El nombre y la descripci√≥n de las secuencias de comandos. <br>  Puede cambiar la matriz de acci√≥n predeterminada de un <code>&lt;command&gt;_sequence</code> agregando la <code>&lt;command&gt;_sequence</code> y determinando la lista de pasos que necesitamos como valor para ello. <br>  Supongamos que queremos cambiar la secuencia de acciones al ejecutar el comando de ejecuci√≥n del libro de jugadas: <code>molecule converge</code> </p><br><pre> <code class="plaintext hljs"># : # - dependency # - create # - prepare # - converge scenario: name: default converge_sequence: - create - converge</code> </pre> <br><h4 id="verifier">  verificador </h4><br><p>  Configurar el marco para las pruebas y la interfaz para ello.  Por defecto, <code>testinfra</code> y <code>flake8</code> se usan <code>testinfra</code> <code>flake8</code> .  Las opciones posibles son similares a las anteriores: </p><br><pre> <code class="plaintext hljs">verifier: name: testinfra additional_files_or_dirs: - ../path/to/test_1.py - ../path/to/test_2.py - ../path/to/directory/* options: n: 1 enabled: False env: FOO: bar lint: name: flake8 options: benchmark: True enabled: False env: FOO: bar</code> </pre> <br><p>  Volvamos a nuestro papel.  Edite el <code>tasks/main.yml</code> para que se vea as√≠: </p><br><pre> <code class="plaintext hljs">--- - name: Install nginx apt: name: nginx state: present - name: Start nginx service: name: nginx state: started</code> </pre><br><p>  Y agregue las pruebas a la <code>molecule/default/tests/test_default.py</code> </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_nginx_is_installed</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(host)</span></span></span><span class="hljs-function">:</span></span> nginx = host.package(<span class="hljs-string"><span class="hljs-string">"nginx"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> nginx.is_installed <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_nginx_running_and_enabled</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(host)</span></span></span><span class="hljs-function">:</span></span> nginx = host.service(<span class="hljs-string"><span class="hljs-string">"nginx"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> nginx.is_running <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> nginx.is_enabled <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_nginx_config</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(host)</span></span></span><span class="hljs-function">:</span></span> host.run(<span class="hljs-string"><span class="hljs-string">"nginx -t"</span></span>)</code> </pre><br><p>  Hecho, solo queda ejecutar (desde la ra√≠z del rol, te recuerdo): </p><br><pre> <code class="bash hljs">&gt; molecule <span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Escape largo debajo del aler√≥n:</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">--&gt; Validating schema &lt;path&gt;/nginx/molecule/default/molecule.yml. Validation completed successfully. --&gt; Test matrix ‚îî‚îÄ‚îÄ default ‚îú‚îÄ‚îÄ lint ‚îú‚îÄ‚îÄ destroy ‚îú‚îÄ‚îÄ dependency ‚îú‚îÄ‚îÄ syntax ‚îú‚îÄ‚îÄ create ‚îú‚îÄ‚îÄ prepare ‚îú‚îÄ‚îÄ converge ‚îú‚îÄ‚îÄ idempotence ‚îú‚îÄ‚îÄ side_effect ‚îú‚îÄ‚îÄ verify ‚îî‚îÄ‚îÄ destroy --&gt; Scenario: 'default' --&gt; Action: 'lint' --&gt; Executing Yamllint on files found in &lt;path&gt;/nginx/... Lint completed successfully. --&gt; Executing Flake8 on files found in &lt;path&gt;/nginx/molecule/default/tests/... Lint completed successfully. --&gt; Executing Ansible Lint on &lt;path&gt;/nginx/molecule/default/playbook.yml... Lint completed successfully. --&gt; Scenario: 'default' --&gt; Action: 'destroy' PLAY [Destroy] ***************************************************************** TASK [Destroy molecule instance(s)] ******************************************** changed: [localhost] =&gt; (item=None) changed: [localhost] TASK [Wait for instance(s) deletion to complete] ******************************* ok: [localhost] =&gt; (item=None) ok: [localhost] TASK [Delete docker network(s)] ************************************************ PLAY RECAP ********************************************************************* localhost : ok=2 changed=1 unreachable=0 failed=0 --&gt; Scenario: 'default' --&gt; Action: 'dependency' Skipping, missing the requirements file. --&gt; Scenario: 'default' --&gt; Action: 'syntax' playbook: &lt;path&gt;/nginx/molecule/default/playbook.yml --&gt; Scenario: 'default' --&gt; Action: 'create' PLAY [Create] ****************************************************************** TASK [Log into a Docker registry] ********************************************** skipping: [localhost] =&gt; (item=None) TASK [Create Dockerfiles from image names] ************************************* changed: [localhost] =&gt; (item=None) changed: [localhost] TASK [Discover local Docker images] ******************************************** ok: [localhost] =&gt; (item=None) ok: [localhost] TASK [Build an Ansible compatible image] *************************************** changed: [localhost] =&gt; (item=None) changed: [localhost] TASK [Create docker network(s)] ************************************************ TASK [Create molecule instance(s)] ********************************************* changed: [localhost] =&gt; (item=None) changed: [localhost] TASK [Wait for instance(s) creation to complete] ******************************* changed: [localhost] =&gt; (item=None) changed: [localhost] PLAY RECAP ********************************************************************* localhost : ok=5 changed=4 unreachable=0 failed=0 --&gt; Scenario: 'default' --&gt; Action: 'prepare' Skipping, prepare playbook not configured. --&gt; Scenario: 'default' --&gt; Action: 'converge' PLAY [Converge] **************************************************************** TASK [Gathering Facts] ********************************************************* ok: [instance] TASK [nginx : Install nginx] *************************************************** changed: [instance] TASK [nginx : Start nginx] ***************************************************** changed: [instance] PLAY RECAP ********************************************************************* instance : ok=3 changed=2 unreachable=0 failed=0 --&gt; Scenario: 'default' --&gt; Action: 'idempotence' Idempotence completed successfully. --&gt; Scenario: 'default' --&gt; Action: 'side_effect' Skipping, side effect playbook not configured. --&gt; Scenario: 'default' --&gt; Action: 'verify' --&gt; Executing Testinfra tests found in &lt;path&gt;/nginx/molecule/default/tests/... ============================= test session starts ============================== platform darwin -- Python 2.7.15, pytest-4.3.0, py-1.8.0, pluggy-0.9.0 rootdir: &lt;path&gt;/nginx/molecule/default, inifile: plugins: testinfra-1.16.0 collected 4 items tests/test_default.py .... [100%] ========================== 4 passed in 27.23 seconds =========================== Verifier completed successfully. --&gt; Scenario: 'default' --&gt; Action: 'destroy' PLAY [Destroy] ***************************************************************** TASK [Destroy molecule instance(s)] ******************************************** changed: [localhost] =&gt; (item=None) changed: [localhost] TASK [Wait for instance(s) deletion to complete] ******************************* changed: [localhost] =&gt; (item=None) changed: [localhost] TASK [Delete docker network(s)] ************************************************ PLAY RECAP ********************************************************************* localhost : ok=2 changed=2 unreachable=0 failed=0</code> </pre></div></div><br><p>  Nuestro papel simple fue probado sin problemas. <br>  Vale la pena recordar que si hubo problemas durante la operaci√≥n de la <code>molecule test</code> de la <code>molecule test</code> , entonces si no cambi√≥ la secuencia est√°ndar, la Mol√©cula eliminar√° la instancia. </p><br><p>  Los siguientes comandos son √∫tiles para la depuraci√≥n: </p><br><pre> <code class="bash hljs">&gt; molecule --debug &lt;<span class="hljs-built_in"><span class="hljs-built_in">command</span></span>&gt; <span class="hljs-comment"><span class="hljs-comment"># debug info.      . &gt; molecule converge #      . &gt; molecule login #    . &gt; molecule --help #   .</span></span></code> </pre> <br><h3 id="suschestvuyuschaya-rol">  Rol existente </h3><br><p>  Agregar un nuevo script a un rol existente ocurre <strong>desde el directorio de roles con los</strong> siguientes comandos: </p><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#     &gt; molecule init scenarion --help #    &gt; molecule init scenario -r &lt;role_name&gt; -s &lt;scenario_name&gt;</span></span></code> </pre> <br><p>  En caso de que este sea el primer script en el rol, se puede omitir la <code>-s</code> ya que se crear√° el script <code>default</code> . </p><br><h3 id="zaklyuchenie">  Conclusi√≥n </h3><br><p>  Como puede ver, la Mol√©cula no es muy complicada, y cuando usa sus propias plantillas, puede reducir la implementaci√≥n de un nuevo script para editar variables en libros de jugadas para crear y eliminar instancias.  La mol√©cula se integra a la perfecci√≥n con los sistemas de CI, lo que le permite aumentar la velocidad de desarrollo al reducir el tiempo que lleva probar manualmente los libros de jugadas. </p><br><p>  Gracias por su atencion  Si tienes experiencia probando roles ansibles, y no est√° relacionado con la Mol√©cula, ¬°cu√©ntanoslo en los comentarios! </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/448136/">https://habr.com/ru/post/448136/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../448122/index.html">C√≥mo funciona ReactJS Reaccionar paquete</a></li>
<li><a href="../448124/index.html">Mikrotik Control de SMS usando el servidor WEB</a></li>
<li><a href="../448126/index.html">Secretos de la API de dispositivos Android. Informe Yandex</a></li>
<li><a href="../448128/index.html">9 consejos para usar la biblioteca Cats en Scala</a></li>
<li><a href="../448130/index.html">Dise√±o de construcci√≥n de mazos de videojuegos</a></li>
<li><a href="../448140/index.html">SNA Hackathon 2019 - resultados</a></li>
<li><a href="../448142/index.html">Donde la evidencia, los hechos y la imaginaci√≥n convergen</a></li>
<li><a href="../448144/index.html">NASA: los cambios gen√©ticos causados ‚Äã‚Äãpor los viajes espaciales son temporales</a></li>
<li><a href="../448146/index.html">Desde el modelado de procesos hasta el dise√±o de un sistema automatizado (Parte 1)</a></li>
<li><a href="../448148/index.html">Planificaci√≥n de infraestructura para instalar Zimbra Collaboration Suite</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>