<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🌴 👩🏻 🚫 Instructions: comment tester les rôles ansibles et découvrir les problèmes avant la production 🕺 👩🏽‍✈️ 🔷</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour à tous! 


 Je travaille en tant qu'ingénieur DevOps dans le service de réservation d'hôtel Ostrovok.ru . Dans cet article, je veux parler de ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Instructions: comment tester les rôles ansibles et découvrir les problèmes avant la production</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ostrovok/blog/448136/"><p>  Bonjour à tous! </p><br><p>  Je travaille en tant qu'ingénieur DevOps dans le service de réservation d'hôtel <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Ostrovok.ru</a> .  Dans cet article, je veux parler de notre expérience dans le test des rôles ansibles. </p><br><p>  Chez Ostrovok.ru, nous utilisons ansible comme gestionnaire de configuration.  Nous avons récemment trouvé la nécessité de tester les rôles, mais il s'est avéré qu'il n'y avait pas beaucoup d'outils pour cela - le framework Molecule est peut-être le plus populaire, nous avons donc décidé de l'utiliser.  Mais il s'est avéré que sa documentation était muette sur de nombreux pièges.  Nous n'avons pas trouvé de guide suffisamment détaillé en russe, nous avons donc décidé d'écrire cet article. </p><br><img src="https://habrastorage.org/webt/a-/ia/np/a-ianpukaixuflfp5svh_vpj8tu.png"><a name="habracut"></a><br><h1>  Molécule </h1><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Molécule</a> - un cadre pour aider à tester les rôles ansibles. </p><br><p>  Description simplifiée: la molécule crée une instance sur la plateforme que vous spécifiez (cloud, machine virtuelle, conteneur; pour plus de détails, voir la section <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Pilote</a> ), y exécute votre rôle, puis exécute les tests et supprime l'instance.  En cas d'échec à l'une des étapes, la Molécule vous en informera. </p><br><p>  Maintenant plus en détail. </p><br><h3 id="nemnogo-teorii">  Un peu de théorie </h3><br><p>  Considérez les deux entités clés de la molécule: scénario et pilote. </p><br><h4 id="scenario">  Scénario </h4><br><p> Le script contient une description de quoi, où, comment et dans quelle séquence sera effectuée.  Un rôle peut avoir plusieurs scripts, et chacun est un répertoire sur le chemin <code>&lt;role&gt;/molecule/&lt;scenario&gt;</code> , qui contient des descriptions des actions nécessaires pour le test.  Le script <code>default</code> doit être présent et sera automatiquement créé si vous initialisez le rôle à l'aide de la molécule.  Les noms des scénarios suivants sont choisis à votre discrétion. </p><br><p>  La séquence de tests dans le script est appelée <strong>matrice</strong> et, par défaut, elle est la suivante: </p><br><p>  <em>(Les étapes marquées d'un <code>?</code> ignorées par défaut si elles ne sont pas décrites par l'utilisateur)</em> </p><br><ul><li>  <code>lint</code> - run linter.  Par défaut, <code>yamllint</code> et <code>flake8</code> , </li><li>  <code>destroy</code> - supprime les instances du dernier lancement de Molecule (si laissé), </li><li>  <code>dependency</code> ?  - mise en place d'une dépendance ansible du rôle testé, </li><li>  <code>syntax</code> - vérifier la syntaxe d'un rôle en utilisant <code>ansible-playbook --syntax-check</code> , </li><li>  <code>create</code> - crée une instance, </li><li>  <code>prepare</code> ?  - préparation de l'instance;  par exemple vérifier / installer python2 </li><li>  <code>converge</code> - lancement du playbook testé, </li><li>  <code>idempotence</code> - redémarrez le playbook pour le test d'idempotence, </li><li>  <code>side_effect</code> ?  - actions non directement liées au rôle, mais nécessaires aux tests, </li><li>  <code>verify</code> - exécuter des tests de la configuration résultante en utilisant <code>testinfra</code> (par défaut) / <code>goss</code> / <code>inspec</code> , </li><li>  <code>cleanup</code> ?  - (dans les nouvelles versions) - grosso modo, le «nettoyage» des infrastructures externes affectées par la Molécule, </li><li>  <code>destroy</code> - supprime une instance. </li></ul><br><p>  Cette séquence couvre la plupart des cas, mais vous pouvez la modifier si nécessaire. </p><br><p>  Chacune des étapes ci-dessus peut être exécutée séparément en utilisant la <code>molecule &lt;command&gt;</code> .  Mais il vaut la peine de comprendre que pour chacune de ces commandes cli, il peut exister sa propre séquence d’actions, qui peut être reconnue en exécutant la <code>molecule matrix &lt;command&gt;</code> .  Par exemple, lorsque vous exécutez la commande de <code>converge</code> (exécutez le playbook testé), les actions suivantes seront effectuées: </p><br><pre> <code class="bash hljs">$ molecule matrix converge ... └── default <span class="hljs-comment"><span class="hljs-comment">#   ├── dependency #   ├── create #   ├── prepare #   └── converge #  </span></span></code> </pre> <br><p>  La séquence de ces actions peut être modifiée.  Si quelque chose de la liste est déjà terminé, il sera ignoré.  L'état actuel, ainsi que la configuration de l'instance, sont stockés dans le <code>$TMPDIR/molecule/&lt;role&gt;/&lt;scenario&gt;</code> . </p><br><p>  Ajouter des étapes avec <code>?</code>  Vous pouvez, après avoir décrit les actions souhaitées au format ansible-playbook, et faire le nom du fichier selon l'étape: <code>prepare.yml</code> / <code>side_effect.yml</code> .  La molécule attendra ces fichiers dans le dossier de script. </p><br><h4 id="driver">  Chauffeur </h4><br><p>  Un pilote est une entité dans laquelle des instances de test sont créées. <br>  La liste des pilotes standard pour lesquels la molécule a des modèles prêts est la suivante: Azure, Docker, EC2, GCE, LXC, LXD, OpenStack, Vagrant, Delegated. </p><br><p>  Dans la plupart des cas, les modèles sont les <code>destroy.yml</code> <code>create.yml</code> et <code>destroy.yml</code> dans le dossier de script qui décrivent respectivement la création et la suppression de l'instance. <br>  Les exceptions sont Docker et Vagrant, car les interactions avec leurs modules peuvent se produire sans les fichiers ci-dessus. </p><br><p>  Il convient de souligner le pilote délégué, car s'il est utilisé dans les fichiers pour créer et supprimer une instance, seul le travail avec la configuration des instances est décrit, le reste doit être décrit par l'ingénieur. </p><br><p>  Le pilote par défaut est Docker. </p><br><p>  Maintenant, nous nous tournons vers la pratique et considérons d'autres fonctionnalités. </p><br><h3 id="nachalo-raboty">  Pour commencer </h3><br><p>  En tant que "bonjour le monde", nous testons le rôle simple de l'installation de nginx.  Nous choisirons docker comme pilote - je pense qu'il est installé sur la plupart d'entre vous (et rappelez-vous que docker est le pilote par défaut). </p><br><p>  Préparez <code>virtualenv</code> et installez-y la <code>molecule</code> : </p><br><pre> <code class="bash hljs">&gt; pip install virtualenv &gt; virtualenv -p `<span class="hljs-built_in"><span class="hljs-built_in">which</span></span> python2` venv &gt; <span class="hljs-built_in"><span class="hljs-built_in">source</span></span> venv/bin/activate &gt; pip install molecule docker <span class="hljs-comment"><span class="hljs-comment"># molecule  ansible  ; docker  </span></span></code> </pre> <br><p>  L'étape suivante consiste à initialiser un nouveau rôle. <br>  L'initialisation d'un nouveau rôle, ainsi que d'un nouveau scénario, s'effectue à l'aide de la commande <code>molecule init &lt;params&gt;</code> : </p><br><pre> <code class="bash hljs">&gt; molecule init role -r nginx --&gt; Initializing new role nginx... Initialized role <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> &lt;path&gt;/nginx successfully. &gt; <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> nginx &gt; tree -L 1 . ├── README.md ├── defaults ├── handlers ├── meta ├── molecule ├── tasks └── vars 6 directories, 1 file</code> </pre> <br><p>  Le résultat fut un rôle ansible typique.  De plus, toutes les interactions avec les molécules CLI sont faites à partir de la racine du rôle. </p><br><p>  Voyons ce qu'il y a dans le répertoire des rôles: </p><br><pre> <code class="bash hljs">&gt; tree molecule/default/ molecule/default/ ├── Dockerfile.j2 <span class="hljs-comment"><span class="hljs-comment"># Jinja-  Dockerfile ├── INSTALL.rst. #       ├── molecule.yml #   ├── playbook.yml #    └── tests #     verify └── test_default.py 1 directory, 6 files</span></span></code> </pre> <br><p>  Analysons la configuration <code>molecule/default/molecule.yml</code> (nous ne remplacerons que l'image docker): </p><br><pre> <code class="plaintext hljs">--- dependency: name: galaxy driver: name: docker lint: name: yamllint platforms: - name: instance image: centos:7 provisioner: name: ansible lint: name: ansible-lint scenario: name: default verifier: name: testinfra lint: name: flake8</code> </pre> <br><h4 id="dependency">  dépendance </h4><br><p>  Cette section décrit la source des dépendances. </p><br><p>  Options possibles: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">galaxie</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">dorure</a> , coquille. </p><br><p>  Shell est juste un shell de commande qui est utilisé si la galaxie et la dorure ne couvrent pas vos besoins. </p><br><p>  Je ne m'arrêterai pas ici longtemps, c'est assez décrit dans la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation</a> . </p><br><h4 id="driver-1">  chauffeur </h4><br><p>  Le nom du conducteur.  Nous avons ce docker. </p><br><h4 id="lint">  peluche </h4><br><p>  Comme linter, le yamllint est utilisé. </p><br><p>  Les options utiles dans cette partie de la configuration sont la possibilité de spécifier un fichier de configuration pour yamllint, de transmettre les variables d'environnement ou de désactiver le linter: </p><br><pre> <code class="plaintext hljs">lint: name: yamllint options: config-file: foo/bar env: FOO: bar enabled: False</code> </pre> <br><h4 id="platforms">  plateformes </h4><br><p>  Décrit la configuration des instances. <br>  Dans le cas du docker en tant que pilote, la molécule est itérée sur cette section et chaque élément de la liste est disponible dans <code>Dockerfile.j2</code> tant que variable d' <code>item</code> . </p><br><p>  Dans le cas du pilote, dans lequel <code>create.yml</code> et <code>destroy.yml</code> , la section y est disponible en tant que <code>molecule_yml.platforms</code> , et les itérations sur celui-ci sont déjà décrites dans ces fichiers. </p><br><p>  Étant donné que la molécule fournit un contrôle d'instance pour les modules ansible, une liste des paramètres possibles doit y être recherchée.  Pour docker, par exemple, le module <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">docker_container_module</a> est <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">utilisé</a> .  Les modules utilisés dans d'autres pilotes se trouvent dans la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation</a> . </p><br><p>  Et des exemples d'utilisation de divers pilotes peuvent être trouvés <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">dans les tests de la molécule elle-même</a> . </p><br><p>  Remplacez <strong>centos: 7</strong> sur <strong>ubuntu ici</strong> . </p><br><h4 id="provisioner">  approvisionneur </h4><br><p>  "Fournisseur" est l'entité qui contrôle les instances.  Dans le cas de la Molécule, c'est ansible, le support des autres n'est pas prévu, donc cette section peut être appelée avec réserve la configuration étendue d'ansible. <br>  Ici, vous pouvez spécifier beaucoup de choses, je vais souligner les principaux moments, à mon avis,: </p><br><ul><li>  <strong>playbooks</strong> : vous pouvez spécifier les playbooks à utiliser à certaines étapes. </li></ul><br><pre> <code class="plaintext hljs">provisioner: name: ansible playbooks: create: create.yml destroy: ../default/destroy.yml converge: playbook.yml side_effect: side_effect.yml cleanup: cleanup.yml</code> </pre> <br><ul><li>  <strong>config_options</strong> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">configuration ansible</a> </li></ul><br><pre> <code class="plaintext hljs">provisioner: name: ansible config_options: defaults: fact_caching: jsonfile ssh_connection: scp_if_ssh: True</code> </pre> <br><ul><li>  <strong>connection_options</strong> : paramètres de <strong>connexion</strong> </li></ul><br><pre> <code class="plaintext hljs">provisioner: name: ansible connection_options: ansible_ssh_common_args: "-o 'UserKnownHostsFile=/dev/null' -o 'ForwardAgent=yes'"</code> </pre> <br><ul><li>  <strong>options</strong> : options et variables d'environnement possibles </li></ul><br><pre> <code class="plaintext hljs">provisioner: name: ansible options: vvv: true diff: true env: FOO: BAR</code> </pre> <br><h4 id="scenario-1">  scénario </h4><br><p>  Le nom et la description des séquences de script. <br>  Vous pouvez modifier la matrice d'actions par défaut d'une <code>&lt;command&gt;_sequence</code> ajoutant la <code>&lt;command&gt;_sequence</code> et en déterminant la liste des étapes dont nous avons besoin comme valeur. <br>  Supposons que nous voulons changer la séquence d'actions lors de l'exécution de la commande playbook run: <code>molecule converge</code> </p><br><pre> <code class="plaintext hljs"># : # - dependency # - create # - prepare # - converge scenario: name: default converge_sequence: - create - converge</code> </pre> <br><h4 id="verifier">  vérificateur </h4><br><p>  Mise en place du cadre pour les tests et le linter à lui.  Par défaut, <code>testinfra</code> et <code>flake8</code> sont utilisés <code>testinfra</code> <code>flake8</code> .  Les options possibles sont similaires à celles ci-dessus: </p><br><pre> <code class="plaintext hljs">verifier: name: testinfra additional_files_or_dirs: - ../path/to/test_1.py - ../path/to/test_2.py - ../path/to/directory/* options: n: 1 enabled: False env: FOO: bar lint: name: flake8 options: benchmark: True enabled: False env: FOO: bar</code> </pre> <br><p>  Revenons à notre rôle.  Modifiez le <code>tasks/main.yml</code> pour qu'il ressemble à ceci: </p><br><pre> <code class="plaintext hljs">--- - name: Install nginx apt: name: nginx state: present - name: Start nginx service: name: nginx state: started</code> </pre><br><p>  Et ajoutez les tests à la <code>molecule/default/tests/test_default.py</code> </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_nginx_is_installed</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(host)</span></span></span><span class="hljs-function">:</span></span> nginx = host.package(<span class="hljs-string"><span class="hljs-string">"nginx"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> nginx.is_installed <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_nginx_running_and_enabled</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(host)</span></span></span><span class="hljs-function">:</span></span> nginx = host.service(<span class="hljs-string"><span class="hljs-string">"nginx"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> nginx.is_running <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> nginx.is_enabled <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_nginx_config</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(host)</span></span></span><span class="hljs-function">:</span></span> host.run(<span class="hljs-string"><span class="hljs-string">"nginx -t"</span></span>)</code> </pre><br><p>  Terminé, il ne reste plus qu'à courir (depuis la racine du rôle, je vous le rappelle): </p><br><pre> <code class="bash hljs">&gt; molecule <span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Échappement long sous le becquet:</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">--&gt; Validating schema &lt;path&gt;/nginx/molecule/default/molecule.yml. Validation completed successfully. --&gt; Test matrix └── default ├── lint ├── destroy ├── dependency ├── syntax ├── create ├── prepare ├── converge ├── idempotence ├── side_effect ├── verify └── destroy --&gt; Scenario: 'default' --&gt; Action: 'lint' --&gt; Executing Yamllint on files found in &lt;path&gt;/nginx/... Lint completed successfully. --&gt; Executing Flake8 on files found in &lt;path&gt;/nginx/molecule/default/tests/... Lint completed successfully. --&gt; Executing Ansible Lint on &lt;path&gt;/nginx/molecule/default/playbook.yml... Lint completed successfully. --&gt; Scenario: 'default' --&gt; Action: 'destroy' PLAY [Destroy] ***************************************************************** TASK [Destroy molecule instance(s)] ******************************************** changed: [localhost] =&gt; (item=None) changed: [localhost] TASK [Wait for instance(s) deletion to complete] ******************************* ok: [localhost] =&gt; (item=None) ok: [localhost] TASK [Delete docker network(s)] ************************************************ PLAY RECAP ********************************************************************* localhost : ok=2 changed=1 unreachable=0 failed=0 --&gt; Scenario: 'default' --&gt; Action: 'dependency' Skipping, missing the requirements file. --&gt; Scenario: 'default' --&gt; Action: 'syntax' playbook: &lt;path&gt;/nginx/molecule/default/playbook.yml --&gt; Scenario: 'default' --&gt; Action: 'create' PLAY [Create] ****************************************************************** TASK [Log into a Docker registry] ********************************************** skipping: [localhost] =&gt; (item=None) TASK [Create Dockerfiles from image names] ************************************* changed: [localhost] =&gt; (item=None) changed: [localhost] TASK [Discover local Docker images] ******************************************** ok: [localhost] =&gt; (item=None) ok: [localhost] TASK [Build an Ansible compatible image] *************************************** changed: [localhost] =&gt; (item=None) changed: [localhost] TASK [Create docker network(s)] ************************************************ TASK [Create molecule instance(s)] ********************************************* changed: [localhost] =&gt; (item=None) changed: [localhost] TASK [Wait for instance(s) creation to complete] ******************************* changed: [localhost] =&gt; (item=None) changed: [localhost] PLAY RECAP ********************************************************************* localhost : ok=5 changed=4 unreachable=0 failed=0 --&gt; Scenario: 'default' --&gt; Action: 'prepare' Skipping, prepare playbook not configured. --&gt; Scenario: 'default' --&gt; Action: 'converge' PLAY [Converge] **************************************************************** TASK [Gathering Facts] ********************************************************* ok: [instance] TASK [nginx : Install nginx] *************************************************** changed: [instance] TASK [nginx : Start nginx] ***************************************************** changed: [instance] PLAY RECAP ********************************************************************* instance : ok=3 changed=2 unreachable=0 failed=0 --&gt; Scenario: 'default' --&gt; Action: 'idempotence' Idempotence completed successfully. --&gt; Scenario: 'default' --&gt; Action: 'side_effect' Skipping, side effect playbook not configured. --&gt; Scenario: 'default' --&gt; Action: 'verify' --&gt; Executing Testinfra tests found in &lt;path&gt;/nginx/molecule/default/tests/... ============================= test session starts ============================== platform darwin -- Python 2.7.15, pytest-4.3.0, py-1.8.0, pluggy-0.9.0 rootdir: &lt;path&gt;/nginx/molecule/default, inifile: plugins: testinfra-1.16.0 collected 4 items tests/test_default.py .... [100%] ========================== 4 passed in 27.23 seconds =========================== Verifier completed successfully. --&gt; Scenario: 'default' --&gt; Action: 'destroy' PLAY [Destroy] ***************************************************************** TASK [Destroy molecule instance(s)] ******************************************** changed: [localhost] =&gt; (item=None) changed: [localhost] TASK [Wait for instance(s) deletion to complete] ******************************* changed: [localhost] =&gt; (item=None) changed: [localhost] TASK [Delete docker network(s)] ************************************************ PLAY RECAP ********************************************************************* localhost : ok=2 changed=2 unreachable=0 failed=0</code> </pre></div></div><br><p>  Notre rôle simple a été testé sans problème. <br>  Il convient de rappeler que s'il y a eu des problèmes pendant le fonctionnement du <code>molecule test</code> , alors si vous n'avez pas modifié la séquence standard, la molécule supprimera l'instance. </p><br><p>  Les commandes suivantes sont utiles pour le débogage: </p><br><pre> <code class="bash hljs">&gt; molecule --debug &lt;<span class="hljs-built_in"><span class="hljs-built_in">command</span></span>&gt; <span class="hljs-comment"><span class="hljs-comment"># debug info.      . &gt; molecule converge #      . &gt; molecule login #    . &gt; molecule --help #   .</span></span></code> </pre> <br><h3 id="suschestvuyuschaya-rol">  Rôle existant </h3><br><p>  L'ajout d'un nouveau script à un rôle existant s'effectue à <strong>partir du répertoire des rôles avec les</strong> commandes suivantes: </p><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#     &gt; molecule init scenarion --help #    &gt; molecule init scenario -r &lt;role_name&gt; -s &lt;scenario_name&gt;</span></span></code> </pre> <br><p>  Dans le cas où il s'agit du premier script du rôle, l' <code>-s</code> peut être omise car le script <code>default</code> sera créé. </p><br><h3 id="zaklyuchenie">  Conclusion </h3><br><p>  Comme vous pouvez le voir, la Molécule n'est pas très compliquée, et lorsque vous utilisez vos propres modèles, vous pouvez réduire le déploiement d'un nouveau script pour éditer des variables dans les playbooks pour créer et supprimer des instances.  La molécule s'intègre parfaitement aux systèmes CI, ce qui vous permet d'augmenter la vitesse de développement en réduisant le temps nécessaire pour tester manuellement les playbooks. </p><br><p>  Merci de votre attention.  Si vous avez de l'expérience dans les tests de rôles ansibles, et que cela n'est pas lié à la molécule - parlez-nous-en dans les commentaires! </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr448136/">https://habr.com/ru/post/fr448136/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr448122/index.html">Comment ReactJS fonctionne Forfait React</a></li>
<li><a href="../fr448124/index.html">Mikrotik. Contrôle SMS à l'aide du serveur WEB</a></li>
<li><a href="../fr448126/index.html">Secrets de l'API des appareils Android. Rapport Yandex</a></li>
<li><a href="../fr448128/index.html">9 conseils pour utiliser la bibliothèque Cats à Scala</a></li>
<li><a href="../fr448130/index.html">Conception de deckbuilding de jeux vidéo</a></li>
<li><a href="../fr448140/index.html">SNA Hackathon 2019 - résultats</a></li>
<li><a href="../fr448142/index.html">Où convergent preuves, faits et imagination</a></li>
<li><a href="../fr448144/index.html">NASA: les changements génétiques causés par les voyages dans l'espace sont temporaires</a></li>
<li><a href="../fr448146/index.html">De la modélisation des processus à la conception d'un système automatisé (partie 1)</a></li>
<li><a href="../fr448148/index.html">Planification de l'infrastructure pour l'installation de Zimbra Collaboration Suite</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>