<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üñêÔ∏è üî™ ‚òÉÔ∏è Extension pour Chrome: cr√©ation, publication, exp√©rience üë©üèø‚Äçüè≠ üôáüèø üí∏</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A la recherche de nouvelles plateformes d'activit√©s, j'ai attir√© l'attention sur les "widgets" de chrome, que j'utilise depuis longtemps, mais je n'y ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Extension pour Chrome: cr√©ation, publication, exp√©rience</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/431830/"> A la recherche de nouvelles plateformes d'activit√©s, j'ai attir√© l'attention sur les "widgets" de chrome, que j'utilise depuis longtemps, mais je n'y ai jamais attach√© d'importance.  J'ai imm√©diatement voulu essayer d'impl√©menter quelque chose. <br><br>  L'id√©e √©tait de cr√©er un gestionnaire de t√¢ches pour le d√©veloppeur (et pas seulement), qui serait toujours √† port√©e de main.  Il aurait d√ª afficher les <i>tickets trello</i> et <i>jira actuels</i> , les demandes √† <i>gitlab</i> , etc.  Ce sont les choses que je recherchais habituellement en tapant des mots-cl√©s dans la barre d'adresse du navigateur, comme "jira PM-20". <br><br><img src="https://habrastorage.org/webt/uk/1y/qz/uk1yqzybao8vdhc0styudgtb9r0.png"><br>  <font color="gray"><i>Extension Chrome</i></font> <br><a name="habracut"></a><br>  Je savais avec certitude que les extensions de navigateur sont des pages html r√©guli√®res aliment√©es par des scripts js.  Mais il n'avait aucune id√©e de comment les cr√©er.  La premi√®re chose que Google m'a donn√©e √† ce sujet est <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">un article sur un support</a> , pas une documentation officielle.  C'√©tait encore mieux car  c'√©tait un article de revue du widget le plus simple de l'id√©e √† la publication. <br><br>  L'article m'a donn√© une id√©e que le d√©veloppement d'un "widget" n'est pas trop compliqu√©.  J'ai imm√©diatement commenc√© √† cr√©er "bonjour le monde!". <br><br><h1>  La structure </h1><br><img src="https://habrastorage.org/webt/qy/ur/1k/qyur1knwe_yms0xfwkfgshzy63a.png"><br><br>  Il s'est av√©r√© que vous devez cr√©er <i>mainfest.json</i> √† la racine du projet.  Il d√©crit l'extension: nom, description, auteur, ic√¥ne, autorisation, etc.  J'ai fait la premi√®re version sans √©tudier la documentation. <br><br><img src="https://habrastorage.org/webt/ui/yf/q5/uiyfq5fyk9jngrs9wct5qfyf7sg.png"><br>  <font color="grey"><i>Premier manifeste.json</i></font> <br><br>  Les extensions vous permettent d'ex√©cuter des scripts js en arri√®re-plan, qui font quelque chose m√™me lorsque l'utilisateur ne les utilise pas.  J'ai ressenti cette fonctionnalit√© tr√®s superficiellement, juste pour comprendre comment cela peut fonctionner.  Il a simplement chang√© le titre dans le widget &lt;h1&gt;. <br><br>  La page html elle-m√™me m'int√©ressait: elle s'affiche lorsque je clique sur l'ic√¥ne dans le navigateur, elle s'appelle <i>popup.html</i> dans mon manifeste. <br><br>  Cette page, soit dit en passant, peut √™tre ouverte dans le navigateur comme n'importe quel site, seule l'extension chrome, par exemple l' <font color="blue"><i>extension chrome: // id-widget-in-webstore / popup.html,</i></font> sera utilis√©e comme ¬´protocole¬ª.  Ainsi, vous pouvez afficher le code source de n'importe quelle extension que vous avez install√©e. <br><br>  Il fonctionne de la m√™me mani√®re que n'importe quel site Web, √† l'exception de quelques fonctionnalit√©s, par exemple: les liens de clic ne fonctionnent qu'avec <i>target = "_ blank"</i> .  Il existe des restrictions techniques contr√¥l√©es par le d√©veloppeur, par exemple, une <i>politique de s√©curit√© du contenu</i> ou des <i>autorisations</i> sur les fonctionnalit√©s du navigateur, qui sont demand√©es √† l'utilisateur. <br><br><h1>  Ex√©cuter l'extension </h1><br>  Apr√®s avoir cr√©√© un dossier avec <i>manifest.json</i> et <i>popup.html √† l'</i> int√©rieur, vous pouvez d√©j√† le lancer en tant que widget.  La page de service <i>chrome: // extensions chrome: // extensions</i> comporte un bouton <i>T√©l√©charger</i> une <i>extension d√©compress√©e</i> .  En l'utilisant, s√©lectionnez le dossier <br><br><img src="https://habrastorage.org/webt/jg/nc/ha/jgnchavdydr1i6hp1ymjeawu3w4.png"><br><br>  et l'extension est imm√©diatement affich√©e dans la liste des ¬´widgets¬ª √† c√¥t√© de la barre d'adresse. <br><br>  A partir de l√†, l'extension peut d√©j√† √™tre test√©e: changez <i>popup.html</i> , et voyez les changements en <i>rouvrant le</i> ¬´widget¬ª en cliquant sur son ic√¥ne. <br><br><h1>  Publier sur la boutique en ligne </h1><br>  Pour commencer, la possibilit√© de publier les 20 premi√®res extensions co√ªte <b>5 $</b> .  Cela se produit dans le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">tableau de bord de la</a> boutique en ligne. Pour ce faire, vous devez remplir l'archive zip du contenu du dossier d'extension et travailler sur les textes et les images publicitaires. <br><br><img src="https://habrastorage.org/webt/hi/wi/mx/hiwimxrg4wexfpgqrokedvq3qnm.png"><br>  <font color="grey"><i>Pr√©paration de la publication d'une extension</i></font> <br><br>  La premi√®re partie de la description de l'extension sera affich√©e √† partir de la propri√©t√© de <i>description</i> du manifeste d'extension, le reste est ajout√© √† la description d√©taill√©e dans la gestion des extensions sur la boutique en ligne. <br><br>  L'extension a des param√®tres de publication flexibles: vous pouvez s√©lectionner des r√©gions du monde pour la publication, ainsi que la visibilit√© de l'extension. <br><br><img src="https://habrastorage.org/webt/tm/uq/ly/tmuqlyxnqnmgrpm0znpaatcubru.png"><br><br>  Il ne faut pas oublier que si vous choisissez de publier uniquement la F√©d√©ration de Russie, alors dans d'autres pays, l'extension n'appara√Ætra pas.  Je suis tomb√© sur ce probl√®me en Tha√Ølande: je ne comprenais pas pourquoi, apr√®s 2 jours, l'extension n'est pas recherch√©e dans le magasin, m√™me par son nom direct. <br><br><h1>  Options avanc√©es </h1><br>  J'ai d√©crit les √©tapes n√©cessaires pour publier une extension simple afin que le processus soit clair.  Maintenant, je veux mettre en √©vidence certains d√©tails pour √©crire un "widget" plus complexe. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/qq/gw/_j/qqgw_jneinomo-x5se1kxul67qk.png"></div><br>  L'essence de mon extension est d'utiliser les API d'autres personnes pour obtenir des informations.  Pour ce faire, j'ai besoin au moins de localStorage pour m√©moriser les jetons d'autorisation. <br><br>  J'ai utilis√© des <i>"autorisations": ["stockage"]</i> dans mon manifeste. <br><br><h2>  OAuth2 </h2><br>  Dans la plupart des cas, les d√©veloppeurs d'API proposent un protocole OAuth2 pour l'autorisation. <br><br>  Si vous n'√™tes pas familier avec ce protocole: il propose un processus s√©curis√© d'authentification et d'autorisation de l'application au nom de l'utilisateur sans acc√®s au login / mot de passe depuis cette application. <br><br>  Le protocole d√©crit plusieurs <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">m√©thodes d'autorisation</a> .  Id√©alement, vous devez utiliser le <b>flux de code d'autorisation,</b> qui suppose que l'application a un <i>backend</i> ;  L'API redirige l'utilisateur avec le code Auth vers l'application, et l'application sur le backend l'√©change contre un jeton. <br><br>  Il existe √©galement un <i>flux implicite</i> simplifi√© qui vous permet de vous connecter sans backend: apr√®s autorisation, l'API redirige l'utilisateur vers l'application avec un jeton dans l'URL. <br><br>  Comment utiliser cette autorisation de "redirection" dans l'extension de chrome?  D√©marrer un site Web?  Il s'av√®re que ce n'est pas n√©cessaire. <br><br><h3>  Mes b√©quilles </h3><br>  Au d√©part, j'ai commenc√© √† int√©grer Gitlalb et Trello.  Avec Gitlab, tout s'est av√©r√© √™tre ¬´simple¬ª: vous envoyez l'utilisateur au panneau d'administration sur son Gitlab pour qu'il fasse un jeton et vous le passe.  Je n'ai pas eu √† me soucier de cette approche pendant longtemps, j'ai simplement cr√©√© un champ pour entrer un jeton et d√©crit comment l'obtenir. <br><br>  Trello a fourni OAuth2, j'ai imm√©diatement remarqu√© qu'il y avait un <i>flux implicite</i> , mais un peu √©trange: le jeton est affich√© sur leur page / approuver dans ce formulaire <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ob/km/s3/obkms3gmcyih9glliorcwlcyk6y.png"></div><br>  Sans aller plus loin, j'ai √©galement cr√©√© un champ de saisie de jeton dans mon extension et d√©crit √† l'utilisateur comment le faire. <br><br><h3>  Bon chemin </h3><br>  Comme d'habitude, une bonne d√©cision ne vient pas imm√©diatement.  Je l'ai rencontr√© lorsque j'ai commenc√© l'int√©gration avec Jira, qui n'a que le flux de code d'autorisation. <br><br>  D'une certaine mani√®re, je suis tomb√© sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">chrome.identity</a> : une fonctionnalit√© de navigateur qui a d√©j√† impl√©ment√© toutes les ¬´b√©quilles¬ª pour l'autorisation.  Cette fonctionnalit√© n√©cessite l'inclusion de l' <i>identit√©</i> dans les autorisations de manifeste.  J'ai compl√©t√© mon manifeste: <i>"permissions": ["stockage", "identit√©"]</i> . <br><br>  Comme je l'ai dit: chaque extension a une URL comme <i>chrome-extension: // &lt;id&gt; /</i> .  Une telle adresse ne convient √† rien, mais <i>chrome.identity</i> fournit une v√©ritable URL <font color="blue"><i>https: // &lt;app-id&gt; .chromiumapp.org / *</i></font> , qui peut √™tre transmise √† l'API avec OAuth2 en tant que redirectUrl.  Apr√®s l'autorisation, l'API lui enverra l'utilisateur avec des param√®tres suppl√©mentaires, que ce soit authCode ou token, et chrome les r√©cup√©rera et leur transmettra des extensions √† votre js-callback. <br><br>  Pour ce faire, utilisez chrome.identity.launchWebAuthFlow (), qui ouvre la page d'autorisation API dans une nouvelle fen√™tre: <br><br><pre><code class="plaintext hljs">chrome.identity.launchWebAuthFlow( { 'url': JiraApi.url(), 'interactive': true }, jira.callback() );</code> </pre> <br>  Je dirai tout de suite: cette fen√™tre ne ressemble pas exactement √† la fen√™tre principale du navigateur, ce qui me poserait des questions si j'√©tais un utilisateur r√©gulier, car  cela ressemble √† une sorte de bloc de phishing, pas √† une fen√™tre.  Peut-√™tre que c'est juste ma perception, peut-√™tre que ce n'est que dans mon <abbr title="Linux Mint">syst√®me d'exploitation</abbr> . <br><br><img src="https://habrastorage.org/webt/4i/n5/ld/4in5ldmxa9aanys9f9oq2bwdo2u.png"><br>  <font color="gray"><i>Fen√™tre d'autorisation chrome.identity.launchWebAuthFlow</i></font> <br><br><h2>  Autres options </h2><br>  Lorsque l'id√©e d'impl√©menter une fonctionnalit√© surgit, je recommande l'API Google Chrome, car  il a d√©j√† beaucoup de fonctionnalit√©s similaires qui faciliteront votre travail.  Par exemple, le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">manifeste complet.json est</a> impressionnant: <br><br><pre> <code class="plaintext hljs">{ // Required "app": { "background": { // Optional "scripts": ["background.js"] } }, "manifest_version": 2, "name": "My App", "version": "versionString", // Recommended "default_locale": "en", "description": "A plain text description", "icons": {...}, // Optional "action_handlers": ["new_note"], "author": ..., "automation": ..., "bluetooth": { "uuids": ["1105", "1006"] }, "commands": {...}, "current_locale": ..., "event_rules": [{...}], "externally_connectable": { "matches": ["*://*.example.com/*"] }, "file_handlers": {...}, "file_system_provider_capabilities": { "configurable": true, "multiple_mounts": true, "source": "network" }, "import": [{"id": "aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"}], "key": "publicKey", "kiosk": { "always_update": ..., "required_platform_version": ... }, "kiosk_enabled": true, "kiosk_only": true, "kiosk_secondary_apps": ..., "minimum_chrome_version": "versionString", "nacl_modules": [...], "oauth2": ..., "offline_enabled": true, "optional_permissions": ["tabs"], "permissions": ["tabs"], "platforms": ..., "requirements": {...}, "sandbox": [...], "short_name": "Short Name", "signature": ..., "sockets": { "tcp": { "connect": "*" }, "udp": { "send": "*" } }, "storage": { "managed_schema": "schema.json" }, "system_indicator": ..., "update_url": "http://path/to/updateInfo.xml", "url_handlers": {...}, "usb_printers": { "filters": [...] }, "version_name": "aString", "webview": {...} }</code> </pre><br>  Traiter toutes les fonctionnalit√©s √† l'avance peut √™tre trop co√ªteux.  leur √©norme nombre. <br><br>  De plus, seul le c√¥t√© js de l'extension elle-m√™me peut atteindre de grandes tailles. <br><br><img src="https://habrastorage.org/webt/ei/k1/9y/eik19yftcv2f-rm1uodd98dpblo.png"><br>  <font color="gray"><i>Mon sch√©ma actuel</i></font> <br><br><h1>  La promotion </h1><br>  Il convient de mentionner un peu la promotion de son expansion.  Une caract√©ristique des ¬´widgets¬ª est qu'ils sont destin√©s aux utilisateurs d'ordinateurs de bureau, qui au cours des derni√®res ann√©es ont r√©ussi √† devenir une minorit√©. <br><br>  J'ai essay√© la publicit√© contextuelle et la publicit√© sur les r√©seaux sociaux.  Vous avez peu d'exp√©rience et aucune conversion. <br><br><h2>  Publicit√© contextuelle </h2><br>  Mon exp√©rience a jusqu'√† pr√©sent √©t√© limit√©e √† une seule plate-forme, je ne peux pas parler pour le reste, mais je pense que la m√™me chose est l√†. <br><br>  Il s'av√®re que vous ne pouvez pas cibler les appareils et les navigateurs dans la publicit√© contextuelle Yandex.  Donc, si votre extension est uniquement pour Chrome, les personnes assises sur d'autres navigateurs dont les transitions n'apporteront que des pertes suppl√©mentaires devront diffuser des annonces. <br><br>  Je ne voulais pas cr√©er un site distinct pour mon extension, j'ai donc annonc√© sa page dans la boutique en ligne.  L'inconv√©nient de cette approche est que vous ne pouvez faire confiance qu'aux statistiques du compte publicitaire et ne pouvez pas voir comment les utilisateurs se comportent sur la page publi√©e. <br><br><h2>  R√©seaux sociaux </h2><br>  Ils appartiennent simplement √† la cat√©gorie des sites sur lesquels le bureau est une minorit√© mourante. <br><br>  Vkontakte fournit le ciblage pour la version mobile et compl√®te de son site Web.  Mais cette coche est cach√©e √† la toute fin des param√®tres, je ne l'ai personnellement pas remarqu√© avant d'avoir divulgu√© le budget et vu une triste couverture dans les statistiques <br><br><img src="https://habrastorage.org/webt/uv/8-/ck/uv8-ckxr9iw4i_znpploac-1cyy.png"><br><br>  En fait, les vues mobiles √©taient beaucoup plus grandes ce jour-l√† <br><br><h1>  Enfin des pens√©es </h1><br>  Je pense que les extensions sont un outil puissant pour les personnes travaillant sur Internet, car  dans le navigateur, nous passons beaucoup de temps, que nous voulons parfois optimiser.  Par exemple, un widget de traducteur Google qui traduit du texte lors de la mise en √©vidence est un bon exemple d'optimisation.  La solution au probl√®me d'un grand nombre d'onglets ouverts "plus tard", j'ai √©galement d√©cid√© d'utiliser le widget. <br><br>  L'√©criture d'extensions vous donne de l'exp√©rience dans l'apprentissage de la partie sous-marine de l'iceberg ¬´Chrome¬ª et dans l'√©criture de ¬´frontend¬ª (surtout si vous √™tes un d√©veloppeur backend).  Les extensions peuvent √™tre √©crites sur le m√™me React JS √† partir duquel vous pouvez vous √©tendre aux applications d'√©criture pour les appareils mobiles.  Le processus d'√©criture des deux est tr√®s similaire. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr431830/">https://habr.com/ru/post/fr431830/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr431818/index.html">Comparez PHP FPM, PHP PPM, Nginx Unit, React PHP et RoadRunner</a></li>
<li><a href="../fr431820/index.html">Commencez √† l'ISS et freinez √† l'ast√©ro√Øde</a></li>
<li><a href="../fr431822/index.html">Source ferm√©e de facto: arguments en faveur d'un logiciel clair</a></li>
<li><a href="../fr431824/index.html">Des informations sur un smartphone de Yandex ont √©t√© accidentellement ouvertes sur le site M.Video quelques jours avant la pr√©sentation</a></li>
<li><a href="../fr431826/index.html">Commencez avec React et Bootstrap en 2 jours. Jour num√©ro 1</a></li>
<li><a href="../fr431832/index.html">Interactif technique lors de conventions fantastiques. Partie 1</a></li>
<li><a href="../fr431834/index.html">Plus de caf√©, moins de caf√©ine: Intel 9e g√©n√©ration (partie 4)</a></li>
<li><a href="../fr431836/index.html">Le condens√© de mati√®res fra√Æches du monde du front-end de la derni√®re semaine n ¬∞ 341 (26 novembre - 2 d√©cembre 2018)</a></li>
<li><a href="../fr431842/index.html">0xc00007b ou installation de pilotes sous le programme</a></li>
<li><a href="../fr431846/index.html">GeekBrains commence √† pr√©parer des d√©veloppeurs Python √† pile compl√®te</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>