<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üï∫ üõÉ üÖ∞Ô∏è Pengaturan Jaringan dari FreeRadius via DHCP üëêüèø üë®üèº‚Äçüöí üíÆ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Tugas telah tiba untuk mengatur penerbitan alamat IP untuk pelanggan. Kondisi tugas: 



- Kami tidak akan memberikan server terpisah untuk otorisasi ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Pengaturan Jaringan dari FreeRadius via DHCP</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/446586/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/xr/4d/ip/xr4dipb_zf-xknbveabx-fj5ifg.jpeg"></div><br>  Tugas telah tiba untuk mengatur penerbitan alamat IP untuk pelanggan.  Kondisi tugas: <br><br><ul><li>  Kami tidak akan memberikan server terpisah untuk otorisasi - Anda akan mengelola;) </li><li>  Pelanggan harus menerima pengaturan jaringan melalui DHCP </li><li>  Jaringannya beragam.  Ini adalah peralatan PON, dan sakelar biasa dengan Opsi 82 ‚Äã‚Äãdan basis WiFi yang dikonfigurasi dengan titik </li><li>  Jika data tidak termasuk dalam persyaratan untuk mengeluarkan IP, perlu mengeluarkan IP dari jaringan "tamu" </li></ul><br>  Dari yang baik: ada server di FreeBSD yang dapat "bekerja", tetapi "jauh";), itu tidak "tepat di jaringan ini." <br><a name="habracut"></a><br>  Ada juga perangkat Mikrotik yang luar biasa.  Diagram jaringan umum adalah sesuatu seperti ini: <br><br><img src="https://habrastorage.org/webt/xt/eo/lb/xteolbkbho0-dpea6bc7-j7koow.png"><br><br>  Setelah sedikit berpikir, diputuskan untuk menggunakan pelanggan FreeRadius untuk mengeluarkan pengaturan jaringan.  Pada prinsipnya, skema ini normal: pada Microtick kita nyalakan server DHCP, di atasnya Radius Client yang sama.  Kami mengkonfigurasi sekelompok server DHCP -&gt; Radius Client -&gt; Radius server. <br><br>  Sepertinya tidak sulit.  Tapi!  Iblis ada dalam perinciannya.  Yaitu: <br><br><ul><li>  Ketika PON OLT diotorisasi sesuai dengan skema ini, permintaan dikirim ke FreeRadius dengan Nama Pengguna sama dengan alamat MAC dari stasiun pusat, Agent-Circuit-Id sama dengan PON Onu MAC dan kata sandi kosong. </li><li>  Ketika mengotorisasi dengan sakelar dengan opsi 82, permintaan datang ke FreeRadius dengan Nama Pengguna kosong sama dengan perangkat MAC pelanggan dan tambahan Agent-Circuit-Id dan Agent-Remote-Id atribut tambahan yang mengandung, sekali lagi, relay switch MAC dan port dimana pelanggan terhubung. </li><li>  Beberapa pelanggan dengan poin WiFI diotorisasi melalui protokol PAP-CHAP </li><li>  Beberapa pelanggan dengan titik WIFI diotorisasi dengan Nama Pengguna sama dengan alamat MAC titik WIFI, tanpa kata sandi. </li></ul><br>  Latar Belakang Historis: Apa itu Opsi 82 ‚Äã‚Äãuntuk DHCP <br><br>  Ini adalah opsi tambahan untuk protokol DHCP yang memungkinkan Anda mentransfer informasi tambahan, misalnya, dalam bidang Agent-Circuit-Id dan Agent-Remote-Id.  Biasanya digunakan untuk mengirimkan alamat MAC dari sakelar relai dan port tempat pelanggan tersambung.  Dalam hal peralatan PON atau BTS WIFI, bidang Agent-Circuit-Id tidak membawa informasi yang berguna (tidak ada port pelanggan).  Dalam hal ini, skema umum DHCP dalam hal ini adalah sebagai berikut: <br><br><img src="https://habrastorage.org/webt/q2/5v/6b/q25v6bvigliru80rv6pu17c2ofm.png"><br><br>  Langkah demi langkah, skema ini berfungsi seperti ini: <br><br><ol><li>  Peralatan pelanggan membuat permintaan DHCP broadcast untuk pengaturan jaringan </li><li>  Perangkat (misalnya, saklar, WiFi atau PON base station) dimana peralatan pelanggan terhubung secara langsung "memotong" paket ini dan memodifikasinya, memperkenalkan opsi tambahan Opsi 82 ‚Äã‚Äãdan Relay alamat IP agen ke dalamnya, dan mentransfernya lebih jauh melalui jaringan. </li><li>  Server DHCP menerima permintaan, membentuk respons dan mengirimkannya ke perangkat relai </li><li>  Perangkat relai meneruskan paket respons ke perangkat pelanggan </li></ol><br>  Jadi semua ini tidak berfungsi, tentu saja, Anda memerlukan konfigurasi peralatan jaringan yang sesuai. <br><br><h4>  Instal FreeRadius </h4><br>  Dengan pengaturan konfigurasi FreeRadius, tentu saja, Anda dapat mencapai semua ini, tetapi sulit dan tidak jelas ... terutama ketika Anda mengintip di sana setelah N bulan "semuanya berfungsi".  Oleh karena itu, diputuskan untuk menulis modul otorisasi Anda untuk FreeRadius dengan Python.  Kami akan mengambil data untuk otorisasi dari database MySQL.  Tidak masuk akal untuk menggambarkan strukturnya, bagaimanapun, semua orang akan melakukannya "untuk diri mereka sendiri".  Secara khusus, saya mengambil struktur yang diusulkan dengan modul sql untuk FreeRadius, dan sedikit mengubahnya dengan menambahkan bidang mac dan port untuk setiap pelanggan, selain kata sandi masuk. <br><br>  Jadi, sebagai permulaan, instal FreeRadius: <br><br><pre><code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /usr/ports/net/freeradius3 make config make install clean</code> </pre> <br>  Dalam pengaturan, kami menandai untuk instalasi: <br><br><img src="https://habrastorage.org/webt/ny/ct/2j/nyct2jjsqsvzlc2cpjlqkex8z5a.png"><br><br>  Kami membuat symlink ke modul python (yaitu, aktifkan): <br><br><pre> <code class="bash hljs">ln -s /usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/etc/raddb/mods-available/python /usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/etc/raddb/mods-enabled</code> </pre> <br>  Instal modul tambahan untuk python: <br><br><pre> <code class="bash hljs">pip install mysql-connector</code> </pre> <br>  Dalam pengaturan modul python untuk FreeRadius, Anda perlu menentukan jalur pencarian modul dalam variabel python_path.  Misalnya, saya punya ini: <br><br><pre> <code class="bash hljs">python_path=<span class="hljs-string"><span class="hljs-string">"/usr/local/etc/raddb/mods-config/python:/usr/local/lib/python2.7:/usr/local/lib/python27.zip:/usr/local/lib/python2.7:/usr/local/lib/python2.7/plat-freebsd12:/usr/local/lib/python2.7/lib-tk:/usr/local/lib/python2.7/lib-old:/usr/local/lib/python2.7/lib-dynload:/usr/local/lib/python2.7/site-packages"</span></span></code> </pre><br>  Path dapat ditemukan dengan menjalankan interpreter python dan memasukkan perintah: <br><br><pre> <code class="bash hljs">root@phaeton:/usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/etc/raddb/mods-enabled<span class="hljs-comment"><span class="hljs-comment"># python Python 2.7.15 (default, Dec 8 2018, 01:22:25) [GCC 4.2.1 Compatible FreeBSD Clang 6.0.1 (tags/RELEASE_601/final 335540)] on freebsd12 Type "help", "copyright", "credits" or "license" for more information. &gt;&gt;&gt; import sys &gt;&gt;&gt; sys.path ['', '/usr/local/lib/python27.zip', '/usr/local/lib/python2.7', '/usr/local/lib/python2.7/plat-freebsd12', '/usr/local/lib/python2.7/lib-tk', '/usr/local/lib/python2.7/lib-old', '/usr/local/lib/python2.7/lib-dynload', '/usr/local/lib/python2.7/site-packages'] &gt;</span></span></code> </pre> <br>  Jika Anda tidak mengambil langkah ini, maka skrip yang ditulis dengan python dan dijalankan oleh FreeRadius tidak akan menemukan modul-modul yang terdaftar dalam impor.  Selain itu, perlu untuk membatalkan komentar fungsi otorisasi dan akuntansi dalam pengaturan modul.  Sebagai contoh, modul ini terlihat seperti ini: <br><br><pre> <code class="bash hljs">python { python_path=<span class="hljs-string"><span class="hljs-string">"/usr/local/etc/raddb/mods-config/python:/usr/local/lib/python2.7:/usr/local/lib/python2.7/site-packages:/usr/local/lib/python27.zip:/usr/local/lib/python2.7:/usr/local/lib/python2.7/plat-freebsd12:/usr/local/lib/python2.7/lib-tk:/usr/local/lib/python2.7/lib-old:/usr/local/lib/python2.7/lib-dynload:/usr/local/lib/python2.7/site-packages"</span></span> module = work mod_instantiate = <span class="hljs-variable"><span class="hljs-variable">${.module}</span></span> mod_detach = <span class="hljs-variable"><span class="hljs-variable">${.module}</span></span> mod_authorize = <span class="hljs-variable"><span class="hljs-variable">${.module}</span></span> func_authorize = authorize mod_authenticate = <span class="hljs-variable"><span class="hljs-variable">${.module}</span></span> func_authenticate = authenticate mod_preacct = <span class="hljs-variable"><span class="hljs-variable">${.module}</span></span> func_preacct = preacct mod_accounting = <span class="hljs-variable"><span class="hljs-variable">${.module}</span></span> func_accounting = accounting mod_checksimul = <span class="hljs-variable"><span class="hljs-variable">${.module}</span></span> mod_pre_proxy = <span class="hljs-variable"><span class="hljs-variable">${.module}</span></span> mod_post_proxy = <span class="hljs-variable"><span class="hljs-variable">${.module}</span></span> mod_post_auth = <span class="hljs-variable"><span class="hljs-variable">${.module}</span></span> mod_recv_coa = <span class="hljs-variable"><span class="hljs-variable">${.module}</span></span> mod_send_coa = <span class="hljs-variable"><span class="hljs-variable">${.module}</span></span> }</code> </pre> <br>  Skrip work.py (dan semua orang lain) harus diletakkan di / usr / local / etc / raddb / mods-config / python Total ada tiga skrip. <br><br><div class="spoiler">  <b class="spoiler_title">work.py:</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/local/bin/python # coding=utf-8 import radiusd import func import sys from pprint import pprint mysql_host="localhost" mysql_username="" mysql_password="" mysql_base="" def instantiate(p): print ("*** instantiate ***") print (p) # return 0 for success or -1 for failure def authenticate(p): print ("*** !!***") print (p) def authorize(p): radiusd.radlog(radiusd.L_INFO, '*** radlog call in authorize ***') conn=func.GetConnectionMysql(mysql_host, mysql_username, mysql_password, mysql_base); param=func.ConvertArrayToNames(p); pprint(param) print ("***  ***") reply = () conf = () cnt=0 username="";mac=""; #   " ",   / if ("User-Name" in param) and ("User-Password" in param) : print ("  (1):  -") pprint(param["User-Name"]) pprint(param["User-Password"]) pprint(conn) print(sys.version_info) print (radiusd.config) sql="select radreply.attribute,radreply.value from radcheck inner join radreply on radreply.username=radcheck.username where radcheck.username=%s and radcheck.value=%s" print(sql) cursor = conn.cursor(dictionary=True,buffered=True) cursor.execute(sql,[param["User-Name"], param["User-Password"]]); row = cursor.fetchone() while row is not None: cnt=cnt+1 username=row["username"] reply = reply+((str(row["attribute"]),str(row["value"])), ) row = cursor.fetchone() # ,  User-Name -    ,    if ("User-Name" in param) and ("User-Password" in param) and (cnt==0): if param["User-Password"] =='': if ":" in param["User-Name"]: pprint(param["User-Name"]) print ("  (2): User-Name -  MAC   ,    ") sql="select radreply.username,radreply.attribute,radreply.value from radcheck inner join radreply on radreply.username=radcheck.username where REPLACE(radcheck.mac,':','') = REPLACE(REPLACE('"+str(param["User-Name"])+"','0x',''),':','') and radcheck.sw_port=''" print (sql) cursor = conn.cursor(dictionary=True,buffered=True) cursor.execute(sql); row = cursor.fetchone() while row is not None: cnt=cnt+1 username=row["username"] mac=param["User-Name"] reply = reply+((str(row["attribute"]),str(row["value"])), ) row = cursor.fetchone() if ("Agent-Remote-Id" in param) and ("User-Password" in param) and (cnt==0): if param["User-Password"] =='': pprint(param["Agent-Remote-Id"]) print ("  (2.5): Agent-Remote-Id -  MAC  PON ") sql="select radreply.username,radreply.attribute,radreply.value from radcheck inner join radreply on radreply.username=radcheck.username where REPLACE(radcheck.mac,':','') = REPLACE(REPLACE('"+str(param["Agent-Remote-Id"])+"','0x',''),':','') and radcheck.sw_port=''" print (sql) cursor = conn.cursor(dictionary=True,buffered=True) cursor.execute(sql); row = cursor.fetchone() while row is not None: cnt=cnt+1 username=row["username"] mac=param["User-Name"] reply = reply+((str(row["attribute"]),str(row["value"])), ) row = cursor.fetchone() #,  Agent-Remote-Id -    ,        IP    if ("Agent-Remote-Id" in param) and ("User-Password" not in param) and (cnt==0): pprint(param["Agent-Remote-Id"]) print ("  (3): Agent-Remote-Id -   /.    ") sql="select radreply.username,radreply.attribute,radreply.value from radcheck inner join radreply on radreply.username=radcheck.username where REPLACE(radcheck.mac,':','') = REPLACE(REPLACE('"+str(param["Agent-Remote-Id"])+"','0x',''),':','') and radcheck.sw_port=''" print(sql) cursor = conn.cursor(dictionary=True,buffered=True) cursor.execute(sql); row = cursor.fetchone() while row is not None: cnt=cnt+1 mac=param["Agent-Remote-Id"] username=row["username"] reply = reply+((str(row["attribute"]),str(row["value"])), ) row = cursor.fetchone() #,      ,   Agent-Remote-Id  Agent-Circuit-Id if ("Agent-Remote-Id" in param) and ("Agent-Circuit-Id" in param) and (cnt==0): pprint(param["Agent-Remote-Id"]) pprint(param["Agent-Circuit-Id"]) print ("  (4):   Agent-Remote-Id  Agent-Circuit-Id,    /") sql="select radreply.username,radreply.attribute,radreply.value from radcheck inner join radreply on radreply.username=radcheck.username where upper(radcheck.sw_mac)=upper(REPLACE('"+str(param["Agent-Remote-Id"])+"','0x','')) and upper(radcheck.sw_port)=upper(RIGHT('"+str(param["Agent-Circuit-Id"])+"',2)) and radcheck.sw_port&lt;&gt;''" print(sql) cursor = conn.cursor(dictionary=True,buffered=True) cursor.execute(sql); row = cursor.fetchone() while row is not None: cnt=cnt+1 mac=param["Agent-Remote-Id"] username=row["username"] reply = reply+((str(row["attribute"]),str(row["value"])), ) row = cursor.fetchone() #      IP  ,      .. if cnt==0: print ("      ,  IP   ..") ip=func.GetGuestNet(conn) if ip!="": cnt=cnt+1; reply = reply+(("Framed-IP-Address",str(ip)), ) #    ,  Reject if cnt==0: conf = ( ("Auth-Type", "Reject"), ) else: #   (  ),     if username!="": func.InsertToHistory(conn,username,mac, reply); conf = ( ("Auth-Type", "Accept"), ) pprint (reply) conn=None; return radiusd.RLM_MODULE_OK, reply, conf def preacct(p): print ("*** preacct ***") print (p) return radiusd.RLM_MODULE_OK def accounting(p): print ("***  ***") radiusd.radlog(radiusd.L_INFO, '*** radlog call in accounting (0) ***') print (p) conn=func.GetConnectionMysql(mysql_host, mysql_username, mysql_password, mysql_base); param=func.ConvertArrayToNames(p); pprint(param) print("   ( 20   )"); sql="delete from radacct where TIMESTAMPDIFF(minute,acctupdatetime,now())&gt;20" cursor = conn.cursor(dictionary=True,buffered=True) cursor.execute(sql); conn.commit() print("/   ") if (("Acct-Unique-Session-Id" in param) and ("User-Name" in param) and ("Framed-IP-Address" in param)): sql='insert into radacct (radacctid,acctuniqueid,username,framedipaddress,acctstarttime) values (null,"'+str(param['Acct-Unique-Session-Id'])+'","'+str(param['User-Name'])+'","'+str(param['Framed-IP-Address'])+'",now()) ON DUPLICATE KEY update acctupdatetime=now()' print(sql) cursor = conn.cursor(dictionary=True,buffered=True) cursor.execute(sql) conn.commit() conn=None; return radiusd.RLM_MODULE_OK def pre_proxy(p): print ("*** pre_proxy ***") print (p) return radiusd.RLM_MODULE_OK def post_proxy(p): print ("*** post_proxy ***") print (p) return radiusd.RLM_MODULE_OK def post_auth(p): print ("*** post_auth ***") print (p) return radiusd.RLM_MODULE_OK def recv_coa(p): print ("*** recv_coa ***") print (p) return radiusd.RLM_MODULE_OK def send_coa(p): print ("*** send_coa ***") print (p) return radiusd.RLM_MODULE_OK def detach(): print ("***     ***") return radiusd.RLM_MODULE_OK</span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">func.py:</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/python2.7 # coding=utf-8 import mysql.connector from mysql.connector import Error #     MySQL def GetConnectionMysql(mysql_host, mysql_username, mysql_password, mysql_base): try: conn = mysql.connector.connect(host=mysql_host,database=mysql_base,user=mysql_username,password=mysql_password) if conn.is_connected(): print('---c   '+mysql_base+' ') except Error as e: print(": ",e); exit(1); return conn def ConvertArrayToNames(p): mass={}; for z in p: mass[z[0]]=z[1] return mass #        def InsertToHistory(conn,username,mac, reply): print("--  ") repl=ConvertArrayToNames(reply) if "Framed-IP-Address" in repl: sql='insert into radpostauth (username,reply,authdate,ip,mac,session_id,comment) values ("'+username+'","Access-Accept",now(),"'+str(repl["Framed-IP-Address"])+'","'+str(mac)+'","","")' print(sql) cursor = conn.cursor(dictionary=True,buffered=True) cursor.execute(sql); conn.commit() #       IP     def GetGuestNet(conn): ip="";id=0 sql="select * from guestnet order by dt limit 1" print (sql) cursor = conn.cursor(dictionary=True,buffered=True) cursor.execute(sql); row = cursor.fetchone() while row is not None: ip=row["ip"] id=row["id"] row = cursor.fetchone() if id&gt;0: sql="update guestnet set dt=now() where id="+str(id) print (sql) cursor = conn.cursor(dictionary=True,buffered=True) cursor.execute(sql); conn.commit() return ip</span></span></code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">radiusd.py:</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/python2.7 # coding=utf-8 # from modules.h RLM_MODULE_REJECT = 0 RLM_MODULE_FAIL = 1 RLM_MODULE_OK = 2 RLM_MODULE_HANDLED = 3 RLM_MODULE_INVALID = 4 RLM_MODULE_USERLOCK = 5 RLM_MODULE_NOTFOUND = 6 RLM_MODULE_NOOP = 7 RLM_MODULE_UPDATED = 8 RLM_MODULE_NUMCODES = 9 # from log.h L_AUTH = 2 L_INFO = 3 L_ERR = 4 L_WARN = 5 L_PROXY = 6 L_ACCT = 7 L_DBG = 16 L_DBG_WARN = 17 L_DBG_ERR = 18 L_DBG_WARN_REQ = 19 L_DBG_ERR_REQ = 20 # log function def radlog(level, msg): import sys sys.stdout.write(msg + '\n') level = level</span></span></code> </pre><br></div></div><br>  Seperti yang dapat Anda lihat dari kode, kami mencoba dengan semua cara yang tersedia untuk mengidentifikasi pelanggan dengan alamat MAC pelanggan yang dikenal atau bundel Opsi 82, dan jika ini tidak berhasil, kami akan mengeluarkan alamat IP tertua yang digunakan dari jaringan "tamu".  Masih mengkonfigurasi skrip default di folder situs-diaktifkan sehingga fungsi yang diperlukan dari skrip python berkedut pada waktu yang ditunjukkan.  Bahkan, itu sudah cukup untuk membawa file ke formulir: <br><br><div class="spoiler">  <b class="spoiler_title">standar</b> <div class="spoiler_text"><pre> <code class="bash hljs">server default { listen { <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> = auth ipaddr = * port = 0 <span class="hljs-built_in"><span class="hljs-built_in">limit</span></span> { max_connections = 16 lifetime = 0 idle_timeout = 30 } } listen { ipaddr = * port = 0 <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> = acct <span class="hljs-built_in"><span class="hljs-built_in">limit</span></span> { } } listen { <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> = auth port = 0 <span class="hljs-built_in"><span class="hljs-built_in">limit</span></span> { max_connections = 1600 lifetime = 0 idle_timeout = 30 } } listen { ipv6addr = :: port = 0 <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> = acct <span class="hljs-built_in"><span class="hljs-built_in">limit</span></span> { } } authorize { python filter_username preprocess expiration logintime } authenticate { Auth-Type PAP { pap python } Auth-Type CHAP { chap python } Auth-Type MS-CHAP { mschap python } eap } preacct { preprocess acct_unique suffix files } accounting { python <span class="hljs-built_in"><span class="hljs-built_in">exec</span></span> attr_filter.accounting_response } session { } post-auth { update { &amp;reply: += &amp;session-state: } <span class="hljs-built_in"><span class="hljs-built_in">exec</span></span> remove_reply_message_if_eap Post-Auth-Type REJECT { attr_filter.access_reject eap remove_reply_message_if_eap } Post-Auth-Type Challenge { } } pre-proxy { } post-proxy { eap } }</code> </pre><br></div></div><br>  Kami mencoba menjalankan dan melihat apa yang terbang ke log debug: <br><br><pre> <code class="bash hljs">/usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/etc/rc.d/radiusd debug</code> </pre> <br>  Apa lagi  Saat mengatur FreeRadius, akan lebih mudah untuk menguji operasinya menggunakan utilitas radclient.  Misalnya otorisasi: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"User-Name=4C:5E:0C:2E:7F:15,Agent-Remote-Id=0x9845623a8c98,Agent-Circuit-Id=0x00010006"</span></span> | radclient -x 127.0.0.1:1812 auth testing123</code> </pre> <br>  Atau akuntansi: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"User-Name=4C:5E:0C:2E:7F:15,Agent-Remote-Id=0x00030f26054a,Agent-Circuit-Id=0x00010002"</span></span> | radclient -x 127.0.0.1:1813 acct testing123</code> </pre> <br>  Saya ingin memperingatkan bahwa tidak mungkin menggunakan skema dan skrip serupa "tanpa perubahan" pada skala "industri".  Setidaknya mencolok: <br><br><ul><li>  kemungkinan alamat MAC "palsu".  Sudah cukup bagi pelanggan untuk mendaftarkan MAC asing untuk dirinya sendiri dan akan ada masalah </li><li>  logika mengeluarkan jaringan tamu di bawah semua kritik.  Bahkan tidak ada cek "apakah Anda sudah memiliki klien dengan alamat IP seperti itu?" </li></ul><br>  Itu hanya "solusi pada lutut" untuk bekerja secara khusus dalam kondisi saya, tidak lebih.  Jangan menilai dengan ketat;) </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id446586/">https://habr.com/ru/post/id446586/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id446570/index.html">Kisah GPU pertama: Rendition V√©rit√© 1000</a></li>
<li><a href="../id446572/index.html">Editor.js adalah editor yang sangat baik yang menyimpan kode sumber dalam format JSON</a></li>
<li><a href="../id446576/index.html">Mengganti impor, atau bagaimana Helikopter Rusia melakukan kesalahan</a></li>
<li><a href="../id446578/index.html">Bahasa pemrograman berbasis kartu pos</a></li>
<li><a href="../id446582/index.html">Refleksi tentang Hosting Surya untuk Lebah</a></li>
<li><a href="../id446588/index.html">Memeriksa Kode Sumber Roslyn</a></li>
<li><a href="../id446590/index.html">39 fitur baru akan tersedia di Java 12</a></li>
<li><a href="../id446592/index.html">Memeriksa kode sumber Roslyn</a></li>
<li><a href="../id446598/index.html">Menciptakan Font CRT</a></li>
<li><a href="../id446602/index.html">Maksimum Arus DC Melalui Transistor Efek Bidang</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>