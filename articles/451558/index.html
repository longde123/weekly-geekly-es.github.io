<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèº‚Äçüî¨ üë©‚Äçüëß‚Äçüë¶ üí™üèª Un d√≠a en la vida de la automatizaci√≥n del control de calidad. üë©üèª‚Äçüç≥ üë©üèø‚Äçü§ù‚Äçüë®üèº üßëüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="C√≥mo tuve que convertirme en una peque√±a automatizaci√≥n qa: lo que sent√≠, sobreviv√≠ y la maravillosa arquitectura e infraestructura de las pruebas aut...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Un d√≠a en la vida de la automatizaci√≥n del control de calidad.</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/451558/"><p>  C√≥mo tuve que convertirme en una peque√±a automatizaci√≥n qa: lo que sent√≠, sobreviv√≠ y la maravillosa arquitectura e infraestructura de las pruebas autom√°ticas a trav√©s de los ojos de un desarrollador que pasaba. </p><a name="habracut"></a><br><h2 id="vvedenie">  Introduccion </h2><br><p>  Como dicen, no soy ginec√≥logo, simplemente pas√© y decid√≠ mirar.  Por lo tanto, para empezar, dir√© sobre las razones para escribir.  Me parece que un especialista har√≠a frente al problema un orden de magnitud m√°s r√°pido y no recoger√≠a tantos rastrillos en su camino.  Pero √©l no estar√≠a tan interesado como yo, y no tendr√≠as nada que leer. </p><br><p>  Otra raz√≥n que me llev√≥ a escribir: durante bastante tiempo no entend√≠ qu√© ten√≠a de especial la infraestructura de las pruebas autom√°ticas.  Adem√°s, muchos gerentes de PM y superiores tampoco entendieron completamente lo que es tan c√≥smico all√≠ y por qu√© los desarrolladores escriben pruebas unitarias para uno o dos, y para las pruebas de phycestest, se toman individuos individuales, que escriben pruebas m√°s lentamente, constantemente reparan algo y La posibilidad de aprobar todas las especificaciones financieras es estrictamente inferior al 100%, siempre que la muestra sea lo suficientemente grande. </p><br><h2 id="problema">  El problema </h2><br><p>  Al tercer d√≠a, la especificaci√≥n del problema en el proyecto ferroviario cay√≥.  Aproximadamente una semana antes, nuestro √∫nico ingeniero de automatizaci√≥n decidi√≥ ir a trabajar a Chicago y a√∫n no hemos encontrado un nuevo especialista.  Por lo tanto, tuve que arremangarme y pretender ser QA.  Sobre c√≥mo fue y trato de contarlo. </p><br><p>  El problema parece bastante inofensivo.  Pero, para empezar, un poco de historia y descripci√≥n del entorno.  Tenemos muchos selectores de direcciones en nuestra plataforma.  Honestamente, esta es una de las principales entidades de la plataforma.  Los selectores van a la API de Google para obtener datos.  En las pruebas autom√°ticas, todas las solicitudes se estancan para ahorrar dinero y acelerar las pruebas.  Adem√°s, se ha agregado un poco de l√≥gica para proporcionar aproximadamente la misma l√≠nea de direcci√≥n que se solicit√≥ sin ir a servicios externos. </p><br><p>  Lo que se ha roto: ingresamos la direcci√≥n deseada en la barra de direcciones, aparece un cuadro desplegable con varias opciones, seleccionamos la deseada y ... el valor del elemento vecino se inserta en la entrada.  Siempre. </p><br><h2 id="dolgiy-put-k-istine">  Un largo camino hacia la verdad </h2><br><h3 id="pervye-gipotezy-i-naivnyy-podhod">  Primeras hip√≥tesis y enfoque ingenuo. </h3><br><p> Sin m√°s dilaci√≥n, tom√© la prueba de ca√≠da m√°s cercana, encontr√© la l√≠nea en la que se seleccion√≥ la direcci√≥n y comenc√© a examinarla cuidadosamente y a los vecinos.  La l√≠nea parece inofensiva: <code>new_order_page.destination_address.select(baker_street)</code> .  Pero entendemos que detr√°s de un c√≥digo hermoso siempre hay un mont√≥n de peque√±os dise√±os extra√±os y entra√±as desagradables. </p><br><p>  R√°pidamente record√© que toda esta econom√≠a funciona en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">SitePrism</a> .  Esto hace posible ajustar la p√°gina y los elementos en la clase y los m√©todos de clase, respectivamente.  Para los clics y otras acciones, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Capybara</a> y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">RSpec</a> son responsables.  Pero no tienen dudas, son confiables, como toda la flota civil.  Y si es as√≠, la primera hip√≥tesis se sugiere de inmediato: alguien escribi√≥ mal los selectores para el prisma o alguien torci√≥ el dise√±o en la parte delantera. </p><br><p>  La primera parte de la hip√≥tesis desapareci√≥ r√°pidamente, los selectores se escriben perfectamente.  No se encontr√≥ ning√∫n <code>xpath</code> con la elecci√≥n del tercer <code>li</code> dentro del elemento y el c√≥digo en s√≠ no cambi√≥ el a√±o pasado. </p><br><p>  Sin embargo, en el √°rea del m√©todo de <code>select</code> , se apil√≥ la l√≥gica con expresiones regulares para seleccionar la opci√≥n deseada de la lista desplegable.  Por supuesto, me enojo con las expresiones regulares y voy a revisarlas.  Paso media hora y entiendo que todo funciona bien.  Se selecciona exactamente la l√≠nea que se necesita.  <code>click</code> en √©l.  Y todo deber√≠a funcionar.  Es decir, la segunda parte de la hip√≥tesis del dise√±o tambi√©n desaparece.  Pero el pensamiento aparece sobre la curva <code>js</code> .  Despu√©s de todo, el elemento en la p√°gina que tenemos es personalizado, <code>js</code> organizan <code>js</code> alrededor de √©l y, adem√°s, en este <code>js</code> estado seleccionando. </p><br><h3 id="vo-vsyom-vinovat-js">  Js tiene la culpa </h3><br><p>  Esta es la raz√≥n est√°ndar para todos los problemas oscuros.  Algo as√≠ como "ve a <code>js</code> , porque ya est√° conmocionado".  Y, al parecer, en mi caso, tampoco podr√≠a prescindir de <code>js</code> .  En general, sin pensarlo dos veces, corro hacia el equipo de front-end y apunto con el dedo a las pruebas de ca√≠da, declarando que "todo funciona de nuestro lado, por favor repare su lado". </p><br><p>  Pero, los muchachos del dandy no son una se√±orita, eligen all√≠ por un par de horas, encuentran un par de errores que no est√°n relacionados con la narrativa y dicen que ¬° <code>js</code> no tiene la culpa!  Al mismo tiempo, arrojan informaci√≥n interesante de que una solicitud para la selecci√≥n no es suficiente y √©l hace otra, cuya respuesta coincide exactamente con el contenido incorrecto de la entrada. </p><br><p>  No esperaba tal giro.  Tenemos que volver y descubrir c√≥mo funciona la simulaci√≥n de solicitudes para nosotros. </p><br><h3 id="obstoyatelnyy-podhod">  Enfoque integral </h3><br><p>  Entonces, no hay otro lugar para esperar ayuda, Mosc√∫ est√° detr√°s de nosotros y cosas as√≠. </p><br><p>  En primer lugar, analizamos las formas en que Moka solicita a Google.  M√°s precisamente, primero buscamos d√≥nde sucede esto.  Esta no es una tarea trivial.  Resulta que tenemos un m√≥dulo completo <code>MockServices::Base</code> , que es responsable de la simulaci√≥n de diferentes solicitudes usando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">VCR</a> .  √âl est√° arrodillado astutamente en el controlador base y solo por el nombre del servicio responsable de las solicitudes externas, no se lo puede encontrar. </p><br><p>  Bien, encontr√© el moki.  Ahora miramos su implementaci√≥n.  La primera solicitud se moja simplemente: la informaci√≥n de los <code>params</code> se toma y se sustituye en la plantilla con la respuesta.  Por si acaso, verifiqu√© el contenido de los <code>params</code> y, como era de esperar, todo sale como deber√≠a. </p><br><p>  El m√©todo moka de la pr√≥xima solicitud es m√°s interesante.  Aparece alg√∫n tipo de <code>mock_data</code> all√≠.  Estos no son <code>params</code> y tenemos que averiguar de d√≥nde viene esta fecha.  Habiendo ca√≠do cinco veces en profundidad, se revela que estos datos se toman de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">RequestStore</a> usando la clave <code>x_mock_data</code> .  Ya m√°s interesante. </p><br><p>  Volvemos a la prueba original y notamos que hay una cosa <code>set_mock_header</code> que, despu√©s de un examen m√°s detallado, agrega algunos datos al mismo <code>RequestStore</code> .  M√°s interesante! </p><br><p>  En alg√∫n lugar en este momento, se produce una disonancia cognitiva en la cabeza: por un lado, es la causa probable del problema, las variables globales que nos da la solicitud secundaria se han roto.  Pero hay un matiz: el servidor para las especificaciones financieras y las especificaciones financieras en s√≠ son dos procesos independientes (de hecho, el servidor tiene al menos 3 procesos), por lo tanto, un d√©bito con cr√©dito no puede converger de ninguna manera, porque todav√≠a no se han introducido variables globales entre los procesos en este mundo.  Y con un servidor web multiproceso, ser√° un juego feroz, que no funcionar√° f√≠sicamente.  Significa que ahuequ√© algo y es necesario buscar. </p><br><p>  Miramos m√°s all√° y encontramos una cierta <code>bm</code> , a la que los encabezados dejan.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Contin√∫a</a> y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">date</a> cuenta de que <code>bm</code> es <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">BrowserMob</a> .  Luego me puse un poco alterado, ya que es un proxy en Java en un contenedor de rub√≠es.  Solo un piano en los arbustos. </p><br><p>  Comenzamos a elegir m√°s y entendemos que para las variables "globales" entre el cliente con <code>rspec</code> y el servidor con la aplicaci√≥n (por ejemplo, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">puma</a> ), se utilizan los mismos encabezados <code>X-Mock-Data</code> en la solicitud.  El problema es que la aplicaci√≥n no debe saber nada sobre estos lectores.  Solo para esto, necesita un proxy a trav√©s del cual todas las solicitudes volar√°n y que se encargar√° de configurar los encabezados.  Con astucia, no dir√°s nada. </p><br><p>  Vamos a probar y descubrimos que solo esto no funciona.  No se ven encabezados por ninguna parte: ni en las solicitudes ni en las respuestas.  Pero RequestStore se llena en el lado <code>rspec</code> y est√° vac√≠o en el lado del servidor web.  Eso significa con seguridad, est√° en el proxy. </p><br><p>  Luego, en el medio, resulta que no solo tenemos pruebas con direcciones <code>set_mock_header</code> , sino tambi√©n todo lo que usa el <code>set_mock_header</code> anterior. </p><br><p>  Genial  Queda por entender c√≥mo solucionar esto. </p><br><h3 id="razbiraemsya-s-proksikom">  Nos ocupamos de un proxy </h3><br><p>  Omitimos los puntos de excavaci√≥n en la regi√≥n donde se inicia el archivo <code>jar</code> y luego lo controlamos a trav√©s de Ruby.  Mejor preste atenci√≥n a la forma en que se especifica el proxy del navegador.  Usamos Chrome y pasamos informaci√≥n de proxy en uno de los muchos argumentos de la l√≠nea de comando cuando se inicia.  La caracter√≠stica de proxy es que usamos el archivo <code>pac</code> que generamos a partir de la plantilla para que el proxy no permita el tr√°fico de los sockets web. </p><br><p>  En alg√∫n lugar aqu√≠ hay un deseo de ir y googlear lo que hay en Chrome con la configuraci√≥n del proxy.  Resulta que no tienes que ir muy lejos y en la versi√≥n 72+ los chicos "terminaron" su trabajo.  En esta ocasi√≥n, incluso <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">trajeron un error por separado</a> .  Mi comentario favorito </p><br><blockquote>  "¬øPuede por favor dejar de ELIMINAR la funcionalidad?" </blockquote><p>  La tristeza es que se considera una caracter√≠stica y en el futuro prometen a√∫n m√°s esta√±o en t√©rminos de "secreto". </p><br><p>  En resumen, Chrome ya no admite el <code>file:</code> protocolo en el argumento <code>proxy-pac-url</code> .  Las soluciones son una mejor que la otra: </p><br><ul><li>  Pase el argumento <code>js</code> , que leer√° el archivo <code>pac</code> y lo convertir√° en base64: <code>--proxy-pac-url='data:application/x-javascript-config;base64,'$(base64 -w0 /path/to/pac/script)</code> ; </li><li>  elevar su servidor web en python para distribuir un archivo de acuerdo con un protocolo m√°s "correcto", que es compatible con el argumento para <code>pac</code> proxy; </li><li>  apague <code>NetworkService</code> y luego el <code>file:</code> protocolo deber√≠a funcionar, pero prometen que tambi√©n ser√° "reparado" en el futuro. </li></ul><br><p>  Las dos primeras opciones ciertamente no me inspiraron, y la tercera, curiosamente, ayud√≥. </p><br><h2 id="nedolgaya-radost">  Alegr√≠a de corta duraci√≥n </h2><br><p>  Regocij√°ndome de que se haya encontrado una conexi√≥n complicada entre los men√∫s desplegables inactivos y Chrome actualizado, no estuve contento por mucho tiempo.  Resulta que nuestro CI actualiz√≥ no solo Chrome, sino tambi√©n todos los paquetes adyacentes, y ahora tenemos a√∫n m√°s pruebas que <code>Selenium::WebDriver::Error::NoSuchDriverError</code> debido a un error desconocido <code>Selenium::WebDriver::Error::NoSuchDriverError</code> , que, curiosamente, no est√° relacionado con el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">controlador</a> de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">cromo</a> , pero est√° relacionado con una configuraci√≥n de Chrome, versiones de biblioteca y ejecuci√≥n de especificaciones paralelas. </p><br><p>  Pero esta es la tarea para el pr√≥ximo d√≠a h√°bil ... </p><br><p>  Mirando hacia el futuro: el argumento <code>disable-dev-shm-usage</code> ayud√≥ all√≠. </p><br><h2 id="vyvody">  Conclusiones </h2><br><p>  No rega√±e a la automatizaci√≥n.  Parece sufrir m√°s por circunstancias externas que son independientes de √©l. </p><br><p>  Es mejor hacerse amigo del ingeniero de automatizaci√≥n con los desarrolladores, para que organicen su infraestructura. <del>  con preferencia y cortesanas </del>  con versiones fijas y un entorno de prueba controlado.  Para m√≠, esto es mejor que sufrir CI patentado, cada uno de los cuales tiene sus propias muletas y heces subacu√°ticas muy sofisticadas, de las que aprender√° solo despu√©s de una estrecha integraci√≥n de su aplicaci√≥n y pruebas con el entorno de otra persona. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/451558/">https://habr.com/ru/post/451558/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../451538/index.html">Gu√≠a de escalado paralelo de Amazon Redshift y resultados de la prueba</a></li>
<li><a href="../451540/index.html">Cu√°ntos desarrolladores necesitan para crear servicios como Airbnb</a></li>
<li><a href="../451542/index.html">C√≥mo y por qu√© hicimos el reconocimiento de hitos en Mail.ru Cloud</a></li>
<li><a href="../451552/index.html">Creamos canales de venta en red del gadget DO-RA</a></li>
<li><a href="../451556/index.html">Flutter: localizaci√≥n de aplicaciones con Android Studio</a></li>
<li><a href="../451560/index.html">Estimado cliente, es por eso que este cambio tom√≥ tanto tiempo.</a></li>
<li><a href="../451562/index.html">¬øC√≥mo escapar de una secta?</a></li>
<li><a href="../451566/index.html">Operation TaskMasters: c√≥mo expusimos a las organizaciones de ataque del grupo cibern√©tico en Rusia y la CEI</a></li>
<li><a href="../451570/index.html">Mudarse a Francia por trabajo: salarios, visas y curr√≠culums</a></li>
<li><a href="../451572/index.html">Tendencias de tecnolog√≠a de desarrollo web 2019</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>