<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üçô üë©üèΩ‚Äçüî¨ üîç Embox come√ßa a escalar o Monte Elbrus üë≠ üë®üèæ‚Äçüíº üòª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Aqueles que est√£o acompanhando nosso projeto podem ter notado que uma pasta e2k apareceu no diret√≥rio com arquiteturas, que cont√©m suporte para proces...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Embox come√ßa a escalar o Monte Elbrus</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/embox/blog/421441/"><img src="https://habrastorage.org/webt/ic/4z/5o/ic4z5olelesc04boln85goculk4.png" align="right" width="320">  Aqueles que est√£o acompanhando nosso projeto podem ter notado que uma pasta e2k apareceu no diret√≥rio com arquiteturas, que cont√©m suporte para processadores dom√©sticos com <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">arquitetura Elbrus</a> .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Uma s√©rie de</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">artigos</a> sobre como transportar a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Embox</a> para plataformas dom√©sticas n√£o seria completa sem uma hist√≥ria sobre essa arquitetura. <br><br>  Farei alguns coment√°rios sobre o conte√∫do do artigo.  Primeiramente, o processo de dominar essa arquitetura por n√≥s est√° no est√°gio inicial, conseguimos lan√ßar o Embox nessa plataforma, mas ainda n√£o implementamos muitas das partes necess√°rias, que ser√£o discutidas em publica√ß√µes futuras.  Em segundo lugar, essa arquitetura √© complexa e <br>  uma descri√ß√£o detalhada requer muito mais texto do que o formato permite <br>  um artigo  Portanto, sugerimos que este artigo seja uma introdu√ß√£o, <br>  contendo um m√≠nimo de informa√ß√µes t√©cnicas sobre a pr√≥pria arquitetura. <br><br>  Vamos come√ßar. <br><a name="habracut"></a><br><h3>  Objeto de pesquisa - Layout do sistema incorporado na Elbrus </h3><br>  Como estamos envolvidos na Embox (e se algu√©m n√£o estiver ciente, √© focado em sistemas embarcados), est√°vamos interessados ‚Äã‚Äãprincipalmente na op√ß√£o de posicionar o pr√≥prio MTsST, inclusive para sistemas embarcados.  Voltando ao MCST, descobrimos que a empresa est√° interessada em usar seus processadores para sistemas embarcados.  Uma das solu√ß√µes mais recentes para esse segmento √© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">a placa E4C-COM</a> .  No processo de comunica√ß√£o com o MCST, ficou claro que, para portar e dominar a arquitetura, voc√™ pode usar qualquer uma das m√°quinas dispon√≠veis, e recebemos um computador chamado <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Monocub</a> para uso tempor√°rio.  Em geral, um monocubo n√£o √© exatamente o que estamos acostumados em sistemas embarcados.  Normalmente, os sistemas embarcados usam computadores de placa √∫nica, um chip - um sistema em um chip ou at√© mesmo um microcontrolador, mas o monocube √© um computador completo, mas como foi testado em "clima e mec√¢nica", ainda pode ser considerado um sistema embarcado. <br><br><h3>  Compilador, compila√ß√£o, imagem de preenchimento </h3><br>  Depois de receber a unidade do sistema, surgiu naturalmente a quest√£o - como preencher a imagem.  O MCST usa seu pr√≥prio BIOS (carregador de inicializa√ß√£o do sistema de primeiro n√≠vel).  Por padr√£o, o Elbrus OS est√° instalado (ou seja, Debian com modifica√ß√µes).  Estamos interessados ‚Äã‚Äãem lan√ßar nossa pr√≥pria imagem.  Felizmente, o carregador MTST pode executar imagens na rede.  Para fazer isso, use o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">protocolo ATA sobre Ethernet</a> . <br><br>  Depois que fomos ajudados a montar um estande e lan√ßar uma imagem externa pela rede, come√ßamos a desenvolver nossa pr√≥pria imagem.  Para fazer isso, precis√°vamos de um compilador.  N√£o encontramos o compilador no dom√≠nio p√∫blico, mas desde que assinamos o NDA, recebemos bin√°rios para o Linux.  O compilador acabou sendo bastante compat√≠vel com o gcc, e n√£o tivemos que mudar nada, √© claro, com exce√ß√£o dos sinalizadores de compila√ß√£o, que lan√ßamos em um arquivo de configura√ß√£o separado.  O que √© muito previs√≠vel, porque o Linux, embora com modifica√ß√µes, √© montado por este compilador. <br><br><h3>  Algumas perguntas t√©cnicas </h3><br>  Quem est√° envolvido em atividades espec√≠ficas, como transportar o sistema operacional para uma plataforma, sabe que a primeira coisa a fazer √© colocar corretamente o c√≥digo do programa na mem√≥ria.  Ou seja, escreva um script vinculador (lds) e implemente o c√≥digo inicial.  N√≥s descobrimos rapidamente o script do vinculador, mas, ao implementar o c√≥digo inicial, fomos confrontados com a primeira m√°gica, que n√£o entendemos completamente.  O fato √© que Elbrus tem um modo de compatibilidade com x86 e, em 0x00FF0000, existe um c√≥digo ao qual darei um <a href="">link</a> , j√° que o emprestamos do exemplo do MCST.  O script vinculador cont√©m <br><br><pre><code class="hljs pgsql">.bootinfo : { _bootinfo_start = .; <span class="hljs-comment"><span class="hljs-comment">/* . = 0x1000000 - 0x10000; */</span></span> <span class="hljs-comment"><span class="hljs-comment">/* 0x00FF0000 */</span></span> *(.x86_boot) . = _bootinfo_start + <span class="hljs-number"><span class="hljs-number">0x10000</span></span>; _bootinfo_end = .; } SECTION_REGION(bootinfo) .text : { _start = .; <span class="hljs-comment"><span class="hljs-comment">/* 0x01000000 */</span></span> *(.e2k_entry);</code> </pre> <br>  O c√≥digo inicial em si nem √© escrito no assembler, mas simplesmente em <a href="">C.</a>  Ele √© colocado na se√ß√£o localizada em 0x01000000, que, a prop√≥sito, corresponde ao endere√ßo inicial de m√°quinas x86 comuns - ali o cabe√ßalho de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">inicializa√ß√£o m√∫ltipla</a> ou outro cabe√ßalho fica nesse endere√ßo. <br><br>  Para garantir que o c√≥digo e os endere√ßos iniciais estejam corretos, voc√™ precisa obter alguma sa√≠da.  Se voc√™ pode imprimir qualquer caractere, provavelmente n√£o haver√° problemas com a sa√≠da de strings.  Usando esta sa√≠da, j√° ser√° poss√≠vel usar o familiar printf () para depura√ß√£o.  Al√©m disso, a maioria das plataformas fornece a capacidade de gerar caracteres fazendo uma entrada simples em um registro espec√≠fico (uma vez que o carregador de inicializa√ß√£o provavelmente configurou o UART conforme necess√°rio). <br><br>  Nosso computador usa o controlador de porta serial am85c30 (tamb√©m conhecido como <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">z85c30</a> , descobrimos rapidamente como imprimir um caractere e isso √© suficiente para o nosso printf funcionar. Imediatamente enfrentamos um problema estranho - alguns dos caracteres impressos pelo printf pareciam estar duplicados, mas √†s vezes confuso. Por exemplo, quando tentei produzir Ol√°, mundo! Ficou algo como Hhelellloo ,, woworrlldd. Agora parece √≥bvio que o assunto √© multin√∫cleo, mas a princ√≠pio n√≥s procur√°vamos no pr√≥prio driver. No monocub, h√° um Elbrus-2C de n√∫cleo duplo + (1891VM7YA) (  quatro n√∫cleos DSP n√£o contam) e o carregador de inicializa√ß√£o ativa todos os n√∫cleos do processador. Como resultado, para n√£o mexer com SMP (multicore), todos os n√∫cleos, exceto o primeiro, s√£o enviados para um loop infinito. Para isso, introduzimos uma vari√°vel para o n√∫mero do processador e o incrementamos usando adi√ß√£o at√¥mica O n√∫cleo zero continua a funcionar, enquanto outros kernels fazem loop. <br><br><pre> <code class="hljs cpp"> cpuid = __e2k_atomic32_add(<span class="hljs-number"><span class="hljs-number">1</span></span>, &amp;last_cpuid); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cpuid &gt; <span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-comment"><span class="hljs-comment">/* XXX currently we support only single core */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>); } <span class="hljs-comment"><span class="hljs-comment">/* copy of trap table */</span></span> <span class="hljs-built_in"><span class="hljs-built_in">memcpy</span></span>((<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>*)<span class="hljs-number"><span class="hljs-number">0</span></span>, &amp;_t_entry, <span class="hljs-number"><span class="hljs-number">0x1800</span></span>); kernel_start();</code> </pre> <br>  A chamada kernel_start () j√° √© uma transfer√™ncia de controle para o nosso c√≥digo. <br>  Tamb√©m emprestamos adi√ß√£o at√¥mica, para n√≥s parece m√°gica.  Mas, como voc√™ sabe, funciona - n√£o toque! <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> WMB_AFTER_ATOMIC </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">".word 0x00008001\n"</span></span></span><span class="hljs-meta"> \ </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">".word 0x30000084\n"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> __e2k_atomic32_add(__val, __addr) \ ({ \ int __rval; \ asm volatile (</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"\n1:"</span></span></span><span class="hljs-meta"> \ </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"\n\tldw,0 %[addr], %[rval], mas=0x7"</span></span></span><span class="hljs-meta"> \ </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"\n\tadds %[rval], %[val], %[rval]"</span></span></span><span class="hljs-meta"> \ </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"\n\t{"</span></span></span><span class="hljs-meta">\ </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"\n\tstw,2 %[addr], %[rval], mas=0x2"</span></span></span><span class="hljs-meta"> \ </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"\n\tibranch 1b ? %%MLOCK"</span></span></span><span class="hljs-meta"> \ </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"\n\t}"</span></span></span><span class="hljs-meta"> \ WMB_AFTER_ATOMIC \ : [rval] </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"=&amp;r"</span></span></span><span class="hljs-meta"> (__rval), [addr] </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"+m"</span></span></span><span class="hljs-meta"> (*(__addr)) \ : [val] </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"ir"</span></span></span><span class="hljs-meta"> (__val) \ : </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"memory"</span></span></span><span class="hljs-meta">); \ __rval; \ })</span></span></code> </pre> <br>  Outra m√°gica que precisei emprestar √© um c√≥digo necess√°rio para todos os n√∫cleos.  Ou seja <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e2k_wait_all</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ _Pragma (<span class="hljs-string"><span class="hljs-string">"no_asm_inline"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">asm</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">volatile</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"wait \ttrap = %0, ma_c = %1, fl_c = %2, ld_c = %3, "</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"st_c = %4, all_e = %5, all_c = %6"</span></span></span></span><span class="hljs-function"><span class="hljs-params"> : : </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"i"</span></span></span></span><span class="hljs-function"><span class="hljs-params"> (</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">), </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"i"</span></span></span></span><span class="hljs-function"><span class="hljs-params"> (</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span><span class="hljs-function"><span class="hljs-params">), </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"i"</span></span></span></span><span class="hljs-function"><span class="hljs-params"> (</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span><span class="hljs-function"><span class="hljs-params">), </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"i"</span></span></span></span><span class="hljs-function"><span class="hljs-params"> (</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">), </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"i"</span></span></span></span><span class="hljs-function"><span class="hljs-params"> (</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">), </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"i"</span></span></span></span><span class="hljs-function"><span class="hljs-params"> (</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span><span class="hljs-function"><span class="hljs-params">), </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"i"</span></span></span></span><span class="hljs-function"><span class="hljs-params"> (</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span><span class="hljs-function"><span class="hljs-params">) : </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"memory"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; }</code> </pre> <br>  Como resultado, depois de escrever o c√≥digo de inicializa√ß√£o, n√£o apenas recebemos as mensagens exibidas usando o printk, mas tamb√©m come√ßamos a carregar m√≥dulos, o que geralmente n√£o √© muito trivial para compiladores n√£o muito comuns.  Ent√£o, mais uma vez, observo que desta vez a compatibilidade com o gcc ficou muito satisfeita. <br><br>  O pr√≥ximo passo √© geralmente iniciar o controlador de interrup√ß√£o e o timer, mas, pensando que teremos que implementar n√£o apenas suporte para esses dispositivos, mas tamb√©m o c√≥digo de arquitetura para os manipuladores de interrup√ß√£o, decidimos que podemos come√ßar pela periferia.  O monocub possui um barramento PCIe, para os programadores parece um PCI comum.  Est√°vamos interessados ‚Äã‚Äãprincipalmente em dois dispositivos: um controlador de v√≠deo e um controlador de rede. <br><br>  O monocube usa um controlador gr√°fico da s√©rie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">sm750</a> .  Este √© um controlador gr√°fico para aplicativos incorporados, com suporte integrado para gr√°ficos 2D.  O chip √© soldado diretamente na placa-m√£e, como eu o entendo.  As fontes do driver para Linux podem ser encontradas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> . <br><br>  Depois que o driver foi encontrado, parecia que nossos problemas haviam acabado, restava apenas implementar o controlador para PCI.  mais precisamente, opera√ß√µes de leitura / grava√ß√£o do espa√ßo de configura√ß√£o do PCI para descobrir os par√¢metros.  A implementa√ß√£o dessas fun√ß√µes teve que ser emprestada novamente.  Como resultado, a leitura de registros se resumia a macros como <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/* * Do load with specified MAS */</span></span> <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> _E2K_READ_MAS(addr, mas, type, size_letter, chan_letter) \ ({ \ register type res; \ asm volatile (</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"ld"</span></span></span><span class="hljs-meta"> #size_letter </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">","</span></span></span><span class="hljs-meta"> #chan_letter </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">" \t0x0, [%1] %2, %0"</span></span></span><span class="hljs-meta"> \ : </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"=r"</span></span></span><span class="hljs-meta"> (res) \ : </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"r"</span></span></span><span class="hljs-meta"> ((__e2k_ptr_t) (addr)), \ </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"i"</span></span></span><span class="hljs-meta"> (mas)); \ res; \ }) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> _E2K_WRITE_MAS(addr, val, mas, type, size_letter, chan_letter) \ ({ \ asm volatile (</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"st"</span></span></span><span class="hljs-meta"> #size_letter </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">","</span></span></span><span class="hljs-meta"> #chan_letter </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">" \t0x0, [%0] %2, %1"</span></span></span><span class="hljs-meta"> \ : \ : </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"r"</span></span></span><span class="hljs-meta"> ((__e2k_ptr_t) (addr)), \ </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"r"</span></span></span><span class="hljs-meta"> ((type) (val)), \ </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"i"</span></span></span><span class="hljs-meta"> (mas) \ : </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"memory"</span></span></span><span class="hljs-meta">); \ })</span></span></code> </pre><br>  Existe alguma compreens√£o do que est√° acontecendo.  O Elbrus possui v√°rios espa√ßos de endere√ßo alternativos, como, por exemplo, na <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">arquitetura SPARC</a> .  A identifica√ß√£o √© feita usando o identificador do espa√ßo de endere√ßo.  Ou seja, o mesmo comando ld chega a diferentes endere√ßos internos, tamb√©m gera opera√ß√µes de leitura de diferentes comprimentos (8, 16, 32, 64 bits).  Se no SPARC este √© um comando lda / sta separado, no Elbrus devido aos par√¢metros, este √© o comando ld.  As <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">janelas do registro foram</a> emprestadas da arquitetura SPARC.  Adiarei uma hist√≥ria mais detalhada para os artigos subseq√ºentes. <br><br>  Como resultado, tudo acabou com o PCI.  Conseguimos obter todos os dados necess√°rios, transferimos o driver gr√°fico para n√≥s mesmos, mas depois enfrentamos o seguinte problema.  Para desenhar uma imagem na mem√≥ria de v√≠deo, voc√™ precisava escrever duas vezes.  Tudo apontava para o cache.  Para resolver esse problema, era necess√°rio lidar com a MMU, e isso, como dizem, n√£o pode ser resolvido com o condachka, pois, em princ√≠pio, muitos outros problemas que encontramos e que encontraremos mais de uma vez durante o desenvolvimento dessa arquitetura. <br><br>  Avan√ßamos em outras dire√ß√µes: interrup√ß√µes e chamadas do sistema, mas tamb√©m falaremos sobre isso nos pr√≥ximos artigos desta sub-s√©rie.  No final deste artigo, trarei a sa√≠da para o console (via porta serial). <br><img src="https://habrastorage.org/webt/uc/un/u2/ucunu20_gi-newvjygt_hfiygpe.png"><br><br><h3>  Conclus√µes </h3><br>  Como disse na introdu√ß√£o, quero me concentrar principalmente nos detalhes t√©cnicos, mas nos sentimentos gerais.  Portanto, os sentimentos s√£o contradit√≥rios, embora certamente mais positivos.  Por um lado, o processador existe e √© muito interessante em termos de recursos arquiteturais.  Com base neste processador, s√£o produzidos sistemas de computador, existe um software de alta qualidade.  Como eu disse, n√£o houve reclama√ß√µes sobre o compilador (at√© um certo ponto, que descreverei um pouco mais tarde), existe um Linux completo (SO "Elbrus").  Eu pessoalmente vi como, no pr√≥prio ICST, o desenvolvedor criou diretamente na √°rea de trabalho com a arquitetura Elbrus. <br><br>  Mas, por outro lado, n√£o entendo por que, com tanta persist√™ncia, eles est√£o tentando fazer uma substitui√ß√£o banal do Intel x86 deste processador.  De fato, em nenhum lugar do mundo eles usam processadores baseados na arquitetura <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">VLIW</a> como computadores pessoais universais.  O VLIW, devido √†s suas caracter√≠sticas arquitet√¥nicas, √© um excelente "triturador de n√∫meros", eles fazem DSP nele, criaram servidores de itanium, criaram placas gr√°ficas.  N√£o, com uma escavadeira, √© claro, voc√™ pode cavar um buraco para plantar uma √°rvore, mas vale a pena. <br><br>  O principal problema que impede o desenvolvimento da arquitetura, na minha opini√£o, √© a natureza fechada de todo o ecossistema.  Sim, para obter uma descri√ß√£o do sistema de comando, basta assinar o NDA, mas isso n√£o √© suficiente.  A arquitetura √© desconhecida e muito complexa.  Sim, eu sempre pensei que algum software b√°sico deveria ser desenvolvido diretamente do fabricante do processador, bem, ou em estreita coopera√ß√£o com ele.  De acordo com esse princ√≠pio, um PC no Elbrus possui um pacote de software com <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">o Elbrus OS</a> .  Mas ainda √© ing√™nuo acreditar que uma empresa, mesmo uma grande, pode oferecer suporte de qualidade a todos os componentes: um processador, um compilador, ferramentas de desenvolvimento e depura√ß√£o, software de sistema (v√°rios sistemas operacionais), software de aplicativo, ...  at√© a Intel n√£o pode fazer isso.  H√° muito que o mundo caminha para a chamada colabora√ß√£o ou desenvolvimento conjunto. <br><br>  Deixe-me dar um exemplo de um problema do compilador que encontramos.  O driver da porta serial em algum momento parou de exibir caracteres e, √† primeira vista, nada mudou.  Acabamos removendo a fun√ß√£o de depura√ß√£o n√£o utilizada, que inserimos para entender atrav√©s do desmontador como passar argumentos para a fun√ß√£o no assembler.  Ou seja, se a fun√ß√£o estiver presente, tudo estar√° bem, se n√£o, a sa√≠da desaparecer√°.  No in√≠cio, eles pecaram por alinhamento, mas acabou que a fun√ß√£o pode ser transferida para o final de C-Schnick, de modo que todos os personagens do motorista estavam nos mesmos lugares de antes, mas o problema foi reproduzido.  Embora esse problema n√£o tenha sido resolvido, continuamos investigando para mostrar aos desenvolvedores do compilador do MCST ou para entender onde cometemos um erro. <br><br>  O problema acima, na minha opini√£o, poderia ter sido evitado se houvesse mais usu√°rios de terceiros.  No m√≠nimo, o problema teria surgido mais cedo ou, seria poss√≠vel pesquisar no Google o que fizemos de errado. <br><br>  O ICST tamb√©m est√° ciente do problema do fechamento, j√° que o processo de descoberta de coisas n√£o classificadas j√° come√ßou.  Por exemplo, vi o Alt-Linux funcionar em v√°rios PCs da Elbrus em v√°rias confer√™ncias.  Aqui est√£o fotos da tela de uma das confer√™ncias deste ano (desculpe-me por ver mal, estava escuro).  Tamb√©m nos conectamos com o desenvolvimento.  Esperamos ser √∫teis para o ICST, porque, como se v√™, alguns dos destaques da arquitetura Elbrus n√£o podem ser suportados no Linux (ou os custos s√£o muito grandes), por exemplo, mem√≥ria marcada. <br><br><img src="https://habrastorage.org/webt/yy/e9/jr/yye9jr5eg1nw99rppron_47drlw.jpeg" align="right" width="50%"><br><br><img src="https://habrastorage.org/webt/ki/n1/vk/kin1vkulag_gynsmlebiv146das.jpeg" align="left" width="50%">  Outro ponto importante quando discutimos o problema do fechamento com os desenvolvedores do MCST, eles objetaram que, por exemplo, as fontes do kernel Linux estavam abertas por um longo tempo, mas apenas n√≥s e os desenvolvedores do Dolomant fizemos perguntas e as usamos de alguma forma. <br><br>  Al√©m disso, de acordo com minhas informa√ß√µes, o MCST vai organizar um estande <br>  acess√≠vel remotamente.  No qual ser√° poss√≠vel montar e executar o software em um PC com arquitetura Elbrus.  Se houver um interesse semelhante e voc√™ desejar usar o suporte, entre em contato, por exemplo, comigo: descreva como est√° planejado us√°-lo, quanto tempo leva e assim por diante, porque para compartilhar com a altera√ß√£o do software, √© necess√°rio organizar um cronograma.  Transferirei os dados para o ICST ou conectarei aqueles que desejarem com os organizadores. <br><br><hr><br>  Links √∫teis: <br><br>  O endere√ßo para correspond√™ncia dos usu√°rios √© o usu√°rio [at] mcst.ru <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Uma breve descri√ß√£o da arquitetura de Elbrus</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Fontes Embox</a> <br><br>  PS Vamos mostrar a todos que querem o que recebemos no festival de TI do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">TechTrain</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">de</a> 2 a 2 de setembro. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt421441/">https://habr.com/ru/post/pt421441/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt421429/index.html">LSTM - ANN Pre√ßos Din√¢micos no Varejo de Bens Dom√©sticos</a></li>
<li><a href="../pt421431/index.html">Gerenciamento de tempo ou gerenciamento eficaz do caos</a></li>
<li><a href="../pt421433/index.html">Faltava exatamente um dia para o in√≠cio do servidor.</a></li>
<li><a href="../pt421435/index.html">"Por que todos n√≥s estamos fazendo isso?" - Criador do Prisma e ex-l√≠der do projeto VK sobre seu novo projeto secreto</a></li>
<li><a href="../pt421439/index.html">Os japoneses introduziram um processador de prot√≥tipo para o supercomputador exaflops: como o chip funciona</a></li>
<li><a href="../pt421443/index.html">Novo no nosso mercado: Telefones IP Snom D385 e D785</a></li>
<li><a href="../pt421445/index.html">Estamos escrevendo um tradutor simples em Lisp - II</a></li>
<li><a href="../pt421447/index.html">Redmadrobot iOS Meetup</a></li>
<li><a href="../pt421451/index.html">Como proteger seu filho do lixo no YouTube e criar um player personalizado com uma lista branca de canais</a></li>
<li><a href="../pt421453/index.html">Situa√ß√£o: Sonos foi p√∫blico e pode "sair da sala"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>