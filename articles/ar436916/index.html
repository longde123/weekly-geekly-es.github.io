<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ ๐ฉ๐พโ๐คโ๐จ๐ฝ ๐ง๐พ VShard - ุงูุชุญุฌูู ุงูุฃููู ูู Tarantool ๐ฉ๐ฝโ๐คโ๐จ๐ป ๐ ๐๐ฝ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ุงุณูู ููุงุฏูุณูุงู ุ ุฃุดุงุฑู ูู ุชุทููุฑ Tarantool - DBMS ูุฎุงุฏู ุงูุชุทุจููุงุช ูู ุฒุฌุงุฌุฉ ูุงุญุฏุฉ. ูุงูููู ุณูู ุฃุฎุจุฑูู ููู ุทุจููุง ุงูููุงุณ ุงูุฃููู ูู ุชุงุฑุงูุชูู ุจุงุณุชุฎุฏุงู ูุญุฏุฉ V...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>VShard - ุงูุชุญุฌูู ุงูุฃููู ูู Tarantool</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/mailru/blog/436916/" style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/4p/e8/fo/4pe8foryc_t_l5joliydwpislhm.png"><br><br>  ุงุณูู ููุงุฏูุณูุงู ุ ุฃุดุงุฑู ูู ุชุทููุฑ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Tarantool</a> - DBMS ูุฎุงุฏู ุงูุชุทุจููุงุช ูู ุฒุฌุงุฌุฉ ูุงุญุฏุฉ.  ูุงูููู ุณูู ุฃุฎุจุฑูู ููู ุทุจููุง ุงูููุงุณ ุงูุฃููู ูู ุชุงุฑุงูุชูู ุจุงุณุชุฎุฏุงู ูุญุฏุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">VShard</a> . <br><a name="habracut"></a><br>  ุฃููุงู ุ ูุธุฑูุฉ ุตุบูุฑุฉ. <br><br>  ููุงู ููุนุงู ูู ุงูุชุญุฌูู: ุฃููู ูุนููุฏู.  ุงูุฃููู ูููุณู ุฅูู ููุนูู: ุงููุณุฎ ุงููุชูุงุซู ูุงููุดุงุฑูุฉ.  ูุชู ุงุณุชุฎุฏุงู ุงููุณุฎ ุงููุชูุงุซู ูุชูุณูุน ูุทุงู ุงูุญูุณุจุฉ ุ ููุณุชุฎุฏู ุงูุชูุณูู ูููุงุณ ุงูุจูุงูุงุช. <br><br>  ุชูุณู ุงููุดุงุฑูุฉ ุฅูู ููุนูู: ุงูุชูุณูู ุญุณุจ ุงููุทุงูุงุช ูุงูุชูุณูู ุจุงูุชุฌุฒุฆุฉ. <br><br>  ุนูุฏ ุงููุดุงุฑูุฉ ูุน ุงููุทุงูุงุช ุ ูุฅููุง ูุญุณุจ ุจุนุถ ููุชุงุญ shard ูู ูู ุณุฌู ูู ุงููุชูุฉ.  ูุชู ุนุฑุถ ููุงุชูุญ ุงููุดุฑุฉ ูุฐู ุนูู ุฎุท ูุณุชููู ุ ูุงูุฐู ูููุณู ุฅูู ูุทุงูุงุช ูุถูููุง ุฅูู ุงูุนูุฏ ุงููุงุฏูุฉ ุงููุฎุชููุฉ. <br><br>  ุงููุดุงุฑูุฉ ูุน ุงูุชุฌุฒุฆุงุช ูู ุฃุจุณุท: ูู ูู ุณุฌู ูู ุงููุชูุฉ ูุนุชุจุฑ ุฏุงูุฉ ุชุฌุฒุฆุฉ ุ ูุถูู ุงูุฅุฏุฎุงูุงุช ุงูุชู ููุง ููุณ ูููุฉ ุฏุงูุฉ ุงูุชุฌุฒุฆุฉ ุฅูู ุนูุฏุฉ ูุนููุฉ ูุงุญุฏุฉ. <br><br>  ุณุฃุชุญุฏุซ ุนู ุงูููุงุณ ุงูุฃููู ุจุงุณุชุฎุฏุงู ุชูุณูู ุงูุชุฌุฒุฆุฉ. <br><br><h1 style=";text-align:right;direction:rtl">  ุงูุชูููุฐ ุงูุณุงุจู </h1><br>  ุฃูู ูุญุฏุฉ ููุงุณ ุฃููู ูุงูุช ูุฏููุง ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Tarantool Shard</a> .  ูุฐุง ูู ุนูููุฉ ูุดุงุฑูุฉ ุจุณูุทุฉ ููุบุงูุฉ ูู ุฎูุงู ุงูุชุฌุฒุฆุฉ ุ ูุงูุชู ุชุฃุฎุฐ ุจุนูู ุงูุงุนุชุจุงุฑ ููุชุงุญ shard ูู ุงูููุชุงุญ ุงูุฃุณุงุณู ูุฌููุน ุงูุฅุฏุฎุงูุงุช ูู ุงููุชูุฉ. <br><br><pre style=";text-align:right;direction:rtl"><code class="plaintext hljs">function shard_function(primary_key) return guava(crc32(primary_key), shard_count) end</code> </pre> <br>  ูููู ุจุนุฏ ุฐูู ูุดุฃุช ูููุฉ ูู ูุชููู Tarantool Shard ูู ุงูุชุนุงูู ูุนูุง ูุซูุงุซุฉ ุฃุณุจุงุจ ุฃุณุงุณูุฉ. <br><br>  ุฃููุงู ุ ูุทููุจ ูููุน <b>ุงูุจูุงูุงุช ุงููุฑุชุจุทุฉ ููุทููุงู</b> .  ุนูุฏูุง ูููู ูุฏููุง ุจูุงูุงุช ูุชุตูุฉ ููุทููุงู ุ ูุฑูุฏ ุฏุงุฆููุง ุชุฎุฒูููุง ุนูู ุงูุนูุฏุฉ ุงููุงุฏูุฉ ููุณูุง ุ ุจุบุถ ุงููุธุฑ ุนู ููููุฉ ุชุบูุฑ ุทูุจูููุฌูุง ุงููุชูุฉ ุฃู ุฅุฌุฑุงุก ุงูุชูุงุฒู.  ู Tarantool ุดุงุฑุฏ ูุง ูุถูู ูุฐุง.  ุฅูู ูุง ูุนุชุจุฑ ุงูุชุฌุฒุฆุฉ ุฅูุง ุจุงูููุงุชูุญ ุงูุฃุณุงุณูุฉ ุ ูุนูุฏ ุฅุนุงุฏุฉ ุงูุชูุงุฒู ุ ูููู ูุตู ุงูุณุฌูุงุช ุงูุชู ููุง ููุณ ุงูุชุฌุฒุฆุฉ ูุจุนุถ ุงูููุช - ุงูููู ููุณ ุฐุฑููุง. <br><br>  ูุดููุฉ ุนุฏู ูุฌูุฏ ุงูุจูุงูุงุช ููุนุชูุง ุฃูุซุฑ ูู ุบูุฑูุง.  ุณุฃูุฏู ูุซุงูุง.  ููุฌุฏ ุจูู ุงูุชุชุญ ููู ุงูุนููู ุญุณุงุจูุง.  ูุฌุจ ุฏุงุฆููุง ุชุฎุฒูู ุจูุงูุงุช ุงูุญุณุงุจ ูุงูุนููู ูุนูุง ุญุชู ูููู ูุฑุงุกุชูุง ูู ุทูุจ ูุงุญุฏ ุ ููุชู ุชุจุงุฏููุง ูู ูุนุงููุฉ ูุงุญุฏุฉ ุ ุนูู ุณุจูู ุงููุซุงู ุ ุนูุฏ ุชุญููู ุงูุฃููุงู ูู ุญุณุงุจ.  ุฅุฐุง ููุช ุชุณุชุฎุฏู ูุดุงุฑูุฉ ุชูููุฏูุฉ ูุน Tarantool Shard ุ ูุฅู ููู ูุธุงุฆู shard ุณุชููู ูุฎุชููุฉ ููุญุณุงุจุงุช ูุงูุนููุงุก.  ูุฏ ุชููู ุงูุจูุงูุงุช ุนูู ุงูุนูุฏ ุงููุงุฏูุฉ ุงููุฎุชููุฉ.  ูุฐุง ูุนูุฏ ุฅูู ุญุฏ ูุจูุฑ ูู ูู ุงููุฑุงุกุฉ ูุงูุนูู ุงููุนุงููุงุช ูุน ูุซู ูุฐุง ุงูุนููู. <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">format = {{'id', 'unsigned'}, {'email', 'string'}} box.schema.create_space('customer', {format = format}) format = {{'id', 'unsigned'}, {'customer_id', 'unsigned'}, {'balance', 'number'}} box.schema.create_space('account', {format = format})</code> </pre><br>  ูู ุงููุซุงู ุฃุนูุงู ุ ูุง ูููู ุจุณูููุฉ ูุทุงุจูุฉ ุญููู <code>id</code> ูุน ุงูุญุณุงุจุงุช ูุงูุนููุงุก.  ุชุฑุชุจุท ูู ุฎูุงู ุญูู ุงูุญุณุงุจ <code>customer_id</code> <code>id</code> <code>customer_id</code> .  ุณูุคุฏู ุญูู <code>id</code> ููุณู ุฅูู ูุณุฑ ุชูุฑุฏ ููุชุงุญ ุงูุญุณุงุจ ุงูุฃุณุงุณู.  ูุจุทุฑููุฉ ุฃุฎุฑู Shard ุบูุฑ ูุงุฏุฑ ุนูู ูุดุฑุฉ. <br><br>  ุงููุดููุฉ ุงูุชุงููุฉ ูู <b>ุฅุนุงุฏุฉ ุงูุดุญู ุงูุจุทูุฆุฉ</b> .  ูุฐู ูู ุงููุดููุฉ ุงูููุงุณูููุฉ ูุฌููุน ุงููุทุน ุนูู ุงูุชุฌุฒุฆุฉ.  ุฎูุงุตุฉ ุงูููู ูู ุฃูู ุนูุฏูุง ูุบูุฑ ุชูููู ูุชูุฉ ุ ูุฅููุง ุนุงุฏุฉ ูุง ูุบูุฑ ูุธููุฉ ุดุงุฑุฏ ุ ูุฃูู ูุนุชูุฏ ุนุงุฏุฉ ุนูู ุนุฏุฏ ุงูุนูุฏ.  ูุนูุฏูุง ุชุชุบูุฑ ุงููุธููุฉ ุ ุชุญุชุงุฌ ุฅูู ุงุณุชุนุฑุงุถ ูู ุงูุฅุฏุฎุงูุงุช ูู ุงููุฌููุนุฉ ูุฅุนุงุฏุฉ ุญุณุงุจ ูุธููุฉ shard ูุฑุฉ ุฃุฎุฑู.  ุฑุจูุง ููู ุจุนุถ ุงูููุงุญุธุงุช.  ูุนูู ุงูุฑุบู ูู ุฃููุง ูููู ุจููููุง ุ ูุฅููุง ูุง ูุนุฑู ูุง ุฅุฐุง ูุงู ูุฏ ุชู ุจุงููุนู ููู ุงูุจูุงูุงุช ุงููุทููุจุฉ ุจูุงุณุทุฉ ุงูุทูุจ ุงููุงุฑุฏ ุงูุชุงูู ุ ุฑุจูุง ุชููู ุงูุขู ูู ุนูููุฉ ุงูููู.  ูุฐูู ุ ุฃุซูุงุก ุฅุนุงุฏุฉ ุงููุดุงุฑูุฉ ุ ูู ุงูุถุฑูุฑู ุฃู ุชูุฏู ูู ูุฑุงุกุฉ ุทูุจูุง ููุธุงุฆู ุงูุฏุงูุชูู: ุงููุฏูู ูุงูุฌุฏูุฏ.  ุงูุทูุจุงุช ุฃุตุจุญุช ุจุทูุฆุฉ ูุฑุชูู ุ ููุงู ูุฐุง ุบูุฑ ููุจูู ุจุงููุณุจุฉ ููุง. <br><br>  ููุฒุฉ ุฃุฎุฑู ูู Tarantool Shard ูู ุฃูู ุนูุฏูุง ุชูุดู ุจุนุถ ุงูุนูุฏ ูู ูุฌููุนุงุช ุงููุณุฎ ุงููุชูุงุซูุฉ ุ ูุฅููุง ุชุธูุฑ <b>ุถุนู ุฅููุงููุฉ ูุฑุงุกุฉ ุงููุฑุงุกุฉ</b> . <br><br><h1 style=";text-align:right;direction:rtl">  ุญู ุฌุฏูุฏ </h1><br>  ูุญู ุงููุดููุงุช ุงูุซูุงุซ ุงูููุตููุฉ ุ ุฃูุดุฃูุง <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Tarantool VShard</a> .  ูุชูุซู ุงูุงุฎุชูุงู ุงูุฑุฆูุณู ูู ุฃู ูุณุชูู ุชุฎุฒูู ุงูุจูุงูุงุช ูููู ุธุงูุฑููุง: ุชุธูุฑ ุงููุณุชูุฏุนุงุช ุงูุงูุชุฑุงุถูุฉ ุฃุนูู ุงููุฎุฒููุงุช ุงููุงุฏูุฉ ุ ููุชู ุชูุฒูุน ุงูุณุฌูุงุช ูููุง ุจูููุง.  ุชุณูู ูุฐู ุงููุณุชูุฏุนุงุช bucket'ami.  ูุง ูุญุชุงุฌ ุงููุณุชุฎุฏู ุฅูู ุงูุชูููุฑ ูู ุฃู ุนูุฏุฉ ุชููู ูููุง.  ุงูุฌุฑุงูุฉ ุนุจุงุฑุฉ ุนู ูุญุฏุฉ ูู ุงูุจูุงูุงุช ุงูุฐุฑูุฉ ุบูุฑ ุงููุงุจูุฉ ููุชุฌุฒุฆุฉ ุ ููุง ูู ุงูุญุงู ูู ุงูุชูุณูู ุงูููุงุณููู ุงููุงุญุฏ.  ูููู VShard ุฏุงุฆููุง ุจุชุฎุฒูู ุงูุฌุฑุงูุฉ ุจุฃููููุง ุนูู ุนูุฏุฉ ูุนููุฉ ูุงุญุฏุฉ ูุฎูุงู ุฅุนุงุฏุฉ ุงููุดุงุฑูุฉ ุ ูููู ุจููู ุฌููุน ุงูุจูุงูุงุช ุงูุฎุงุตุฉ ุจุงูุฌุฑุฏ ุงููุงุญุฏ ุชููุงุฆููุง.  ุจุณุจุจ ูุฐุง ุ ูุชู ุชูููุฑ ูุญููุฉ.  ูุญุชุงุฌ ููุท ุฅูู ูุถุน ุงูุจูุงูุงุช ูู ูุฌููุนุฉ ูุงุญุฏุฉ ุ ููููููุง ุฏุงุฆููุง ุงูุชุฃูุฏ ูู ุฃู ูุฐู ุงูุจูุงูุงุช ุณูู ุชุชุฑุงูู ูุน ุฃู ุชุบููุฑุงุช ูู ุงููุฌููุนุฉ. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/42e/a4f/87b/42ea4f87b5c0f0b05bdf0e0c75b356fe.png"><br><br>  ููู ูููููู ูุถุน ุงูุจูุงูุงุช ูู ูุฌููุนุฉ ูุงุญุฏุฉุ  ูู ุงููุฎุทุท ุงูุฐู ูุฏููุงู ูุณุจููุง ูุนููู ุงูุจูู ุ ุณูุถูู <code>bucket id</code> ุฅูู ุงูุฌุฏุงูู ููููุง ููุญูู ุงูุฌุฏูุฏ.  ุฅุฐุง ูุงูุช ุงูุจูุงูุงุช ุงููุฑุชุจุทุฉ ูู ููุณูุง ุ ุณุชููู ุงูุณุฌูุงุช ูู ููุณ ุงููุฌููุนุฉ.  ุงูููุฒุฉ ูู ุฃูู ูููููุง ุชุฎุฒูู ูุฐู ุงูุณุฌูุงุช ุจููุณ <code>bucket id</code> ูู ูุฑุงุบุงุช ูุฎุชููุฉ ุ ูุญุชู ูู ูุญุฑูุงุช ูุฎุชููุฉ.  <code>bucket id</code> ุชูููุฑ <code>bucket id</code> ุจุบุถ ุงููุธุฑ ุนู ููููุฉ ุชุฎุฒูู ูุฐู ุงูุณุฌูุงุช. <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">format = {{'id', 'unsigned'}, {'email', 'string'}, {'bucket_id', 'unsigned'}} box.schema.create_space('customer', {format = format}) format = {{'id', 'unsigned'}, {'customer_id', 'unsigned'}, {'balance', 'number'}, {'bucket_id', 'unsigned'}} box.schema.create_space('account', {format = format})</code> </pre><br>  ููุงุฐุง ูุญู ุญุฑูุตูู ุฌุฏุง ููุฐุงุ  ุฅุฐุง ูุงูุช ูุฏููุง ูุดุงุฑูุฉ ููุงุณูููุฉ ุ ููููู ุฃู ุชุชุณูู ุงูุจูุงูุงุช ุนุจุฑ ุฌููุน ุงููุฎุงุฒู ุงููุงุฏูุฉ ุงูุชู ูุฏููุง ููุท.  ูู ุงููุซุงู ูุน ุงูุจูู ุ ุนูุฏ ุทูุจ ุฌููุน ุญุณุงุจุงุช ุงูุนููู ุ ุณูู ุชุถุทุฑ ุฅูู ุงููุฌูุก ุฅูู ุฌููุน ุงูุนูุฏ.  ุงุชุถุญ ุตุนูุจุฉ ูุฑุงุกุฉ O (N) ุ ุญูุซ N ูู ุนุฏุฏ ุงููุชุงุฌุฑ ุงููุงุฏูุฉ.  ุจุทูุฆุฉ ุจูุธุงุนุฉ. <br><br>  ุจูุถู bucket'am ูุงููุญููุฉ ุญุณุจ <code>bucket id</code> ูููููุง ุฏุงุฆููุง ูุฑุงุกุฉ ุงูุจูุงูุงุช ูู ุนูุฏุฉ ูุงุญุฏุฉ ูู ุทูุจ ูุงุญุฏ ุ ุจุบุถ ุงููุธุฑ ุนู ุญุฌู ุงููุชูุฉ. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2bb/524/8b7/2bb5248b7757ea6249f47a3dca46a681.png"><br><br>  ุชุญุชุงุฌ ุฅูู ุญุณุงุจ <code>bucket id</code> ูุชุนููู ููุณ ุงูููู ุจููุณู.  ุจุงููุณุจุฉ ููุจุนุถ ุ ูุฐู ููุฒุฉ ูุดุฎุต ุนูุจ.  ุฃุนุชุจุฑูุง ููุฒุฉ ููููู ูู ุฎูุงููุง ุงุฎุชูุงุฑ ูุธููุฉ ุญุณุงุจ <code>bucket id</code> ุจููุณู. <br><br>  ูุง ูู ุงููุฑู ุงูุฑุฆูุณู ุจูู ุงููุดุงุฑูุฉ ุงูููุงุณูููุฉ ูุงููุดุงุฑูุฉ ุงูุงูุชุฑุงุถูุฉ ูุน ุงูุฌุฑุงูุฉุ <br><br>  ูู ุงูุญุงูุฉ ุงูุฃููู ุ ุนูุฏูุง ูุบูุฑ ุชูููู ุงููุชูุฉ ุ ูุฏููุง ุญุงูุชุงู: ุงูุญุงููุฉ (ุงููุฏููุฉ) ูุงูุฌุฏูุฏุฉ ุ ุงูุชู ูุฌุจ ุฃู ูุฐูุจ ูููุง.  ูู ุนูููุฉ ุงูููู ุ ูุง ุชุญุชุงุฌ ููุท ุฅูู ููู ุงูุจูุงูุงุช ุ ูููู ุฃูุถูุง ูุฅุนุงุฏุฉ ุญุณุงุจ ูุธุงุฆู ุงูุชุฌุฒุฆุฉ ูุฌููุน ุงูุณุฌูุงุช.  ูุฐุง ุบูุฑ ูุฑูุญ ููุบุงูุฉ ุ ูุฃููุง ูู ุฃู ููุช ูู ุงูุฃููุงุช ูุง ูุนุฑู ุงูุจูุงูุงุช ุงูุชู ุชู ููููุง ุจุงููุนู ูุฃููุง ุบูุฑ ุฐูู.  ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ูุฐุง ููุณ ููุซูููุง ููุง ุฐุฑููุง ุ ูุธุฑูุง ูุฃู ุงูููู ุงูุฐุฑู ููุฌููุนุฉ ูู ุงูุณุฌูุงุช ููุง ููุณ ูููุฉ ูุธููุฉ ุงูุชุฌุฒุฆุฉ ุ ูู ุงูุถุฑูุฑู ุชุฎุฒูู ุญุงูุฉ ุงูููู ุจุงุณุชูุฑุงุฑ ูู ุญุงูุฉ ุงูุงุณุชุฑุฏุงุฏ ุงูุถุฑูุฑู.  ููุงู ุชุนุงุฑุถุงุช ุ ุฃุฎุทุงุก ุ ูุฌุจ ุนููู ุฅุนุงุฏุฉ ุชุดุบูู ุงูุฅุฌุฑุงุก ุนุฏุฉ ูุฑุงุช. <br><br>  ุงูุชูุงุณู ุงูุงูุชุฑุงุถู ุฃุจุณุท ุจูุซูุฑ.  ููุณ ูุฏููุง ุญุงูุชุงู ูุญุฏุฏุชุงู ูู ุงููุชูุฉ ุ ูุฏููุง ููุท ุญุงูุฉ ุงููุฌููุนุฉ.  ุชุตุจุญ ุงููุฌููุนุฉ ุฃูุซุฑ ูุฏุฑุฉ ุนูู ุงูููุงูุฑุฉ ุ ููู ุชูุชูู ุชุฏุฑูุฌูุงู ูู ุญุงูุฉ ุฅูู ุฃุฎุฑู.  ูุงูุขู ููุงู ุฃูุซุฑ ูู ุฏููุชูู.  ุจูุถู ุงูุงูุชูุงู ุงูุณูุณ ุ ููููู ุชุบููุฑ ุงูุฑุตูุฏ ุฃุซูุงุก ุงูุชููู ุ ูุญุฐู ูุญุฏุฉ ุงูุชุฎุฒูู ุงููุถุงูุฉ ุญุฏูุซูุง.  ููุฐุง ูุนูู ุฃู ุฅููุงููุฉ ุงูุชุญูู ูู ุงูููุงุฒูุฉ ุชุฒุฏุงุฏ ุจุดูู ูุจูุฑ ุ ูุชุตุจุญ ุญุจูุจูุฉ. <br><br><h1 style=";text-align:right;direction:rtl">  ุงุณุชุฎุฏุงู </h1><br>  ูููุชุฑุถ ุฃููุง ุงุฎุชุฑูุง ูุธููุฉ <code>bucket id</code> ุงูุฌุฑุงูุงุช ูุตุจูุง ุงููุซูุฑ ูู ุงูุจูุงูุงุช ูู ุงููุฌููุนุฉ ุจุญูุซ ูู ููู ููุงู ูุณุงุญุฉ ุฅุถุงููุฉ.  ุงูุขู ูุฑูุฏ ุฅุถุงูุฉ ุงูุนูุฏ ุ ูุจุงูุชุงูู ุงูุชููุช ุงูุจูุงูุงุช ุฅูููู ุจุฃููุณูุง.  ูู VShard ุ ูุชู ุฐูู ุนูู ุงููุญู ุงูุชุงูู.  ุฃููุงู ุ ูู ุจุชุดุบูู ุงูุนูุฏ ุงูุฌุฏูุฏุฉ ู Tarantools ุนูููุง ุ ุซู ูู ุจุชุญุฏูุซ ุชูููู VShard.  ููู ูุตู ุฌููุน ุฃุนุถุงุก ุงููุฌููุนุฉ ุ ูุฌููุน ุงููุณุฎ ุงููุชูุงุซูุฉ ุ ููุฌููุนุงุช ุงููุณุฎ ุงููุชูุงุซูุฉ ุ ูุงููุงุฌุณุชูุฑ ุ ููุนุฑูุงุช ุงููุณุชุฎุฏููู ุงููุนููุฉ ุ ูุฃูุซุฑ ูู ุฐูู ุจูุซูุฑ.  ูุถูู ุนูุฏูุง ุฌุฏูุฏุฉ ููุชูููู ุ ูุจุงุณุชุฎุฏุงู ูุธููุฉ <code>VShard.storage.cfg</code> ุ ูุณุชุฎุฏููุง ูู ุฌููุน ุนูุฏ ุงููุชูุฉ. <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">function create_user(email) local customer_id = next_id() local bucket_id = crc32(customer_id) box.space.customer:insert(customer_id, email, bucket_id) end function add_account(customer_id) local id = next_id() local bucket_id = crc32(customer_id) box.space.account:insert(id, customer_id, 0, bucket_id) end</code> </pre> <br>  ููุง ุชุชุฐูุฑ ุ ูู ุงููุดุงุฑูุฉ ุงูููุงุณูููุฉ ูุน ุชุบููุฑ ูู ุนุฏุฏ ุงูุนูุฏ ุ ุชุชุบูุฑ ูุธููุฉ shard ุฃูุถูุง.  ูู VShard ูุฐุง ูุง ูุญุฏุซ ุ ูุฏููุง ุนุฏุฏ ุซุงุจุช ูู ุงููุฎุงุฒู ุงูุงูุชุฑุงุถูุฉ - bucket'ov.  ูุฐุง ูู ุงูุซุงุจุช ุงูุฐู ุชุญุฏุฏู ุนูุฏ ุจุฏุก ุชุดุบูู ุงููุชูุฉ.  ูุฏ ูุจุฏู ุฃูู ุจุณุจุจ ูุฐุง ุ ูุฅู ูุงุจููุฉ ุงูุชูุณุน ูุญุฏูุฏุฉ ุ ูููู ููุณ ุญููุง.  ููููู ุงุฎุชูุงุฑ ุนุฏุฏ ูุจูุฑ ูู bucket'ov ูุนุดุฑุงุช ููุฆุงุช ุงูุขูุงู.  ุงูุดูุก ุงูุฑุฆูุณู ูู ุฃูู ูุฌุจ ุฃู ูููู ููุงู ุทูุจุงู ุนูู ุงูุฃูู ูุฒูุฏ ุญุฌูููุง ุนู ุงูุญุฏ ุงูุฃูุตู ูุนุฏุฏ ูุฌููุนุงุช ุงููุณุฎ ุงููุชูุงุซูุฉ ุงูุชู ุณูููู ูุฏูู ูู ุงููุฌููุนุฉ. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/422/499/979/422499979e5b8c5728c3df2b967cf599.gif"><br><br>  ูุธุฑูุง ูุฃู ุนุฏุฏ ุงููุฎุงุฒู ุงูุงูุชุฑุงุถูุฉ ูุง ูุชุบูุฑ - ูุชุนุชูุฏ ูุธููุฉ shard ููุท ุนูู ูุฐู ุงููููุฉ - ูููููุง ุฅุถุงูุฉ ุฃูุจุฑ ุนุฏุฏ ูููู ูู ุงููุฎุงุฒู ุงููุนููุฉ ุฏูู ุฅุนุงุฏุฉ ุญุณุงุจ ูุธููุฉ shard. <br><br>  ููู ูุชู ุชูุฒูุน ุงูุจูููุชุงุช ุจูู ุงููุชุงุฌุฑ ุงููุงุฏูุฉ ุจููุฑุฏูุงุ  ุนูุฏูุง ูุชู ุงุณุชุฏุนุงุก VShard.storage.cfg ุนูู ุฅุญุฏู ุงูุนูุฏ ุ ุชุณุชููุธ ุนูููุฉ ุฅุนุงุฏุฉ ุงูุชูุงุฒู.  ูุฐู ุนูููุฉ ุชุญููููุฉ ุชุญุณุจ ุงูุชูุงุฒู ุงููุซุงูู ูู ุงููุชูุฉ.  ูุฐูุจ ุฅูู ุฌููุน ุงูุนูุฏ ุงููุงุฏูุฉ ุ ููุณุฃู ูู ูุฏูู ุนุฏุฏ bucket'ov ุ ููุจูู ุทุฑููุง ูุญุฑูุชูู ูู ุฃุฌู ูุชูุณุท โโุงูุชูุฒูุน.  ูุฑุณู rebalancer ุงูุทุฑู ุฅูู ุงููุฎุงุฒู ุงููุฒุฏุญูุฉ ุ ููุจุฏุฃูู ูู ุฅุฑุณุงู ุงูุฌุฑุฏู.  ุจุนุฏ ุจุนุถ ุงูููุช ุ ุชุตุจุญ ุงููุชูุฉ ูุชูุงุฒูุฉ. <br><br>  ูููู ูู ุงููุดุฑูุนุงุช ุงูุญููููุฉ ุ ูุฏ ูููู ููููู ุงูุชูุงุฒู ุงููุซุงูู ูุฎุชูููุง.  ุนูู ุณุจูู ุงููุซุงู ุ ุฃุฑูุฏ ุชุฎุฒูู ุจูุงูุงุช ุฃูู ุนูู ูุฌููุนุฉ ูุณุฎ ูุชูุงุซูุฉ ูุงุญุฏุฉ ุนู ุงูุฃุฎุฑู ุ ูุฃู ููุงู ูุณุงุญุฉ ูุฑุต ุฃูู.  ูุนุชูุฏ VShard ุฃู ูู ุดูุก ูุชูุงุฒู ุฌูุฏูุง ุ ููู ุงููุงูุน ุ ุงูุชุฎุฒูู ุนูู ูุดู ุงูุณุนุฉ.  ููุฏ ูุฏููุง โโุขููุฉ ูุถุจุท ููุงุนุฏ ุงูููุงุฒูุฉ ุจุงุณุชุฎุฏุงู ุงูุฃูุฒุงู.  ูููู ุชุนููู ูู ูุฌููุนุฉ ูุชูุงุซูุฉ ููุณุชูุฏุน.  ุนูุฏูุง ููุฑุฑ ุงูููุงุฒู ูู ุงูุฐู ุณูุฑุณู ุฅููู ุนุฏุฏ ุงูููุงุช ุ ูุฃุฎุฐ ูู ุงูุงุนุชุจุงุฑ <b>ุงูุนูุงูุฉ ุจูู</b> ุฌููุน ุฃุฒูุงุฌ ุงูุฃูุฒุงู. <br><br>  ุนูู ุณุจูู ุงููุซุงู ุ ูุจูุบ ูุฒู ุฃุญุฏ ุงููุชุงุฌุฑ 100 ุ ูุงูุขุฎุฑ ูุฏูู 200. ุซู ูุฎุฒู ุงูุฃูู ุฃูู ุนุฏุฏูุง ูู ุงูุฏูู ูุฑุชูู.  ูุฑุฌู ููุงุญุธุฉ ุฃููู ุฃุชุญุฏุซ ุชุญุฏูุฏุง ุนู <b>ูุณุจุฉ</b> ุงูุฃูุฒุงู.  ุงููุนุงูู ุงููุทููุฉ ููุง ุฃู ุชุฃุซูุฑ.  ููููู ุงุฎุชูุงุฑ ุงูุฃูุฒุงู ุจูุงุกู ุนูู ุชูุฒูุน ูุชูุฉ 100ูช: ูุญุชูู ุฃุญุฏ ุงููุชุงุฌุฑ ุนูู 30ูช ุ ูุงูุขุฎุฑ ูุฏูู 70ูช.  ููููู ุฃู ุชุฃุฎุฐ ุณุนุฉ ุงูุชุฎุฒูู ุจุงูุฌูุฌุงุจุงูุช ูุฃุณุงุณ ุ ุฃู ููููู ููุงุณ ุงูุฃูุฒุงู ูู ุนุฏุฏ bucket'ov.  ุงูุดูุก ุงูุฑุฆูุณู ูู ูุฑุงูุจุฉ ุงููููู ุงูุฐู ุชุญุชุงุฌู. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b4e/889/298/b4e889298991781b8c3ee01f4c066a6e.png"><br><br>  ูุซู ูุฐุง ุงููุธุงู ูู ุชุฃุซูุฑ ุฌุงูุจู ูุซูุฑ ููุงูุชูุงู: ุฅุฐุง ููุช ุจุชุนููู ูุฒู ุตูุฑู ูุจุนุถ ุงููุชุงุฌุฑ ุ ูุณูู ูุทูุจ ุงูููุงุฒู ูู ุงููุชุฌุฑ ุชูุฒูุน ูู ุฏููุชู.  ุจุนุฏ ุฐูู ุ ููููู ุฅุฒุงูุฉ ูุฌููุนุฉ ุงููุณุฎ ุงููุชูุงุซูุฉ ุจุงููุงูู ูู ุงูุชูููู. <br><br><h1 style=";text-align:right;direction:rtl">  ููู ุงูุฌุฑุงูุฉ ุงูุฐุฑูุฉ </h1><br>  ูุฏููุง ุฏูู ุ ููู ููุจู ููุนูุง ูุง ูู ุทูุจุงุช ุงููุฑุงุกุฉ ูุงููุชุงุจุฉ ุ ุซู ูุทูุจ ุงูููุงุฒู ูููู ุฅูู ูุญุฏุฉ ุชุฎุฒูู ุฃุฎุฑู.  ูุชููู ุงูุฏูู ุนู ูุจูู ุทูุจุงุช ุงูุชุณุฌูู ุ ูุฅูุง ุณูููู ูุฏููู ุงูููุช ูุชุญุฏูุซู ุฃุซูุงุก ุงูููู ุ ุซู ุณูููู ูุฏููู ุงูููุช ูุชุญุฏูุซ ุงูุชุญุฏูุซ ุงููุญููู ุ ุซู ุชุญุฏูุซ ุงูุชุญุฏูุซ ุงููุญููู ุ ููุง ุฅูู ุฐูู.  ูุฐูู ุ ูุชู ุญุธุฑ ุงูุณุฌู ุ ููุง ูุฒุงู ุจุฅููุงูู ุงููุฑุงุกุฉ ูู ุงููุฌููุนุฉ.  ูุจุฏุฃ ููู ุงููุทุน ุฅูู ููุงู ุฌุฏูุฏ.  ุจุนุฏ ุงูุชูุงู ุงูููู ุ ุณูุจุฏุฃ ุงูุฌุฑุงูุฉ ูุฑุฉ ุฃุฎุฑู ูู ูุจูู ุงูุทูุจุงุช.  ูู ุงูููุงู ุงููุฏูู ุ ูุง ุชุฒุงู ุงูุฃูุงุฐูุจ ุฃูุถูุง ุ ูููู ุชู ุชูููุฒูุง ุจุงููุนู ูููุงูุฉ ุ ูุจุนุฏ ุฐูู ุณูููู ุฌุงูุน ุงูุจูุงูุงุช ุงูููููุฉ ุจุญุฐููุง ุจุดูู ูุจูุฑ ุจูุงุณุทุฉ ููุทุน. <br><br>  ูุฑุชุจุท ูู ูุฌููุนุฉ ุจุจูุงูุงุช ุงูุชุนุฑูู ุงููุฎุฒูุฉ ูุนูููุง ุนูู ุงููุฑุต.  ูุชู ุญูุธ ุฌููุน ุงูุฎุทูุงุช ุงููุฐููุฑุฉ ุฃุนูุงู ุนูู ุงููุฑุต ุ ูุจุบุถ ุงููุธุฑ ุนู ูุง ูุญุฏุซ ูุน ุงููุณุชูุฏุน ุ ุณูุชู ุงุณุชุนุงุฏุฉ ุญุงูุฉ ุงููุฌููุนุฉ ุชููุงุฆููุง. <br><br>  ูุฏ ูููู ูุฏูู ุฃุณุฆูุฉ: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <b>ูุงุฐุง ุณูุญุฏุซ ูุชูู ุงูุทูุจุงุช ุงูุชู ุนููุช ูุน ุงููุฌููุนุฉ ุนูุฏูุง ุจุฏุฃุช ูู ููููุงุ</b> <br><br>  ููุงู ููุนุงู ูู ุงูุฑูุงุจุท ูู ุงูุจูุงูุงุช ุงููุตููุฉ ููู ูุฌููุนุฉ: ุงููุฑุงุกุฉ ูุงููุชุงุจุฉ.  ุนูุฏูุง ููุฏู ุงููุณุชุฎุฏู ุทูุจูุง ุฅูู ุงููุฌููุนุฉ ุ ูุดูุฑ ุฅูู ููููุฉ ุนููู ุฃู ุงููุฑุงุกุฉ ููุท ุฃู ูุฑุงุกุฉ ุงููุชุงุจุฉ.  ููู ุทูุจ ุ ูุชู ุฒูุงุฏุฉ ุงูุนุฏุงุฏ ุงููุฑุฌุนู ุงูููุงุจู. <br><br>  ููุงุฐุง ุฃุญุชุงุฌ ุฅูู ุนุฏุงุฏ ูุฑุฌุนู ููุฑุงุกุฉ ุงูุทูุจุงุชุ  ุฏุนูุง ูููู ููู ุงูุฌุฑุงูุฉ ุจูุฏูุก ุ ูููุง ูุฃุชู ุฌุงูุน ุงูููุงูุฉ ููุฑูุฏ ุญุฐู ูุฐุง ุงูุฌุฑุงูุฉ.  ูุฑู ุฃู ุนุฏุฏ ุงูุฑูุงุจุท ุฃูุจุฑ ูู ุงูุตูุฑ ุ ูุฐูู ูุง ููููู ุญุฐูู.  ูุนูุฏูุง ุชุชู ูุนุงูุฌุฉ ุงูุทูุจุงุช ุ ุณูุชููู ุฌุงูุน ุงูุจูุงูุงุช ุงูููููุฉ ูู ุฅููุงู ุนููู. <br><br>  ูุถูู ุงูุนุฏุงุฏ ุงููุฑุฌุนู ูุทูุจุงุช ุงููุชุงุจุฉ ุนุฏู ุจุฏุก ุงูุฌุฑุงูุฉ ูู ุงูุงุณุชูุฑุงุฑ ุฃุซูุงุก ุงูุนูู ูุน ุทูุจ ูุชุงุจุฉ ูุงุญุฏ ุนูู ุงูุฃูู.  ููู ูููู ุฃู ุชุฃุชู ุทูุจุงุช ุงููุชุงุจุฉ ุจุงุณุชูุฑุงุฑ ุ ููู ุซู ูู ูุชู ููู ุงูุฌุฑุงูุฉ ุฃุจุฏูุง.  ูุงูุญูููุฉ ูู ุฃูู ุฅุฐุง ุฃุนุฑุจ ุงูููุงุฒู ุนู ุฑุบุจุชู ูู ูููู ุ ูุณูุชู ุญุธุฑ ุทูุจุงุช ุงูุชุณุฌูู ุงูุฌุฏูุฏุฉ ุ ูุณููุชุธุฑ ุงููุธุงู ุงูุญุงูู ุงูุชูุงุก ุจุนุถ ุงููููุฉ.  ุฅุฐุง ูู ุชูุชูู ุงูุทูุจุงุช ูู ุงูููุช ุงููุฎุตุต ุ ุณูุจุฏุฃ ุงููุธุงู ูุฑุฉ ุฃุฎุฑู ูู ูุจูู ุทูุจุงุช ุงููุชุงุจุฉ ุงูุฌุฏูุฏุฉ ุ ูุน ุชุฃุฌูู ููู ุงููุฌููุนุฉ ูุจุนุถ ุงูููุช.  ูุจุงูุชุงูู ุ ูุฅู ุงูููุงุฒู ุณูุฌุนู ูุญุงููุงุช ุงูููู ุญุชู ุชูุฌุญ ูุงุญุฏุฉ. <br><br>  ูุญุชูู VShard ุนูู API bucket_ref ููุฎูุถ ุงููุณุชูู ูู ุญุงู ูุงู ูุฏูู ุจุนุถ ุงูููุฒุงุช ุนุงููุฉ ุงููุณุชูู.  ุฅุฐุง ููุช ุชุฑูุฏ ูุนู ุดูุก ูุง ุจููุณู ุ ููุง ุนููู ุณูู ุงููุตูู ุฅูู ูุงุฌูุฉ ุจุฑูุฌุฉ ุงูุชุทุจููุงุช ูุฐู ูู ุงูุฑูุฒ. </li><li style=";text-align:right;direction:rtl">  <b>ูู ูู ุงููููู ุนุฏู ุญุฌุจ ุงูุณุฌูุงุช ุนูู ุงูุฅุทูุงูุ</b> <br><br>  ูุฐุง ูุณุชุญูู.  ุฅุฐุง ูุงู ุงูุฏูู ูุญุชูู ุนูู ุจูุงูุงุช ูููุฉ ุชุญุชุงุฌ ุฅูู ูุตูู ุซุงุจุช ูููุชุงุจุฉ ุ ูุณูุชุนูู ุนููู ููุน ููููุง ุชูุงููุง.  ููุงู <code>bucket_pin</code> ูุธููุฉ ููุฐุง ุ ูุฅูู ูุนูู ุจุฅุญูุงู ุจุฅุญูุงู ูุฌููุนุฉ ุงููุณุฎ ุงููุชูุงุซูุฉ ุงูุญุงููุฉ ุ ูููุน ููููุง.  ูู ูุฐู ุงูุญุงูุฉ ุ ุณุชุชููู ุงููุฌููุนุฉ ุงููุฌุงูุฑุฉ ูู ุงูุชุญุฑู ุฏูู ูููุฏ. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b6a/848/fa7/b6a848fa775b0066ac6f69b73d97ed76.png"><br><br>  ููุงู ุฃุฏุงุฉ ุฃููู ูู <code>bucket_pin</code> - ุญุธุฑ ูุฌููุนุฉ ุงููุณุฎ ุงููุชูุงุซูุฉ.  ูู ูุนุฏ ูุชู ุฐูู ูู ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ุ ูููู ูู ุฎูุงู ุงูุชูููู.  ูุญุธุฑ ุญุธุฑ ุญุฑูุฉ ุฃู bucket'ov ูู ูุฐู ุงููุฌููุนุฉ ุงููุชูุงุซูุฉ set'a ูุงุณุชูุจุงู ุฌุฏูุฏุฉ.  ููููุง ูุฐูู ุ ุณุชููู ุฌููุน ุงูุจูุงูุงุช ูุชุงุญุฉ ููุชุณุฌูู ุจุงุณุชูุฑุงุฑ. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/65b/744/39c/65b74439c5b5743eda1168bdb320f8f4.png"></li></ul><br><h1 style=";text-align:right;direction:rtl">  VShard.router </h1><br>  ูุชููู VShard ูู ูุญุฏุชูู ูุฑุนูุชูู: VShard.storage ู VShard.router.  ูููู ุฅูุดุงุคูุง ุจุดูู ูุณุชูู ูุชูุณูุน ูุทุงููุง ุญุชู ูู ุญุงูุฉ ูุงุญุฏุฉ.  ุนูุฏ ุงููุตูู ุฅูู ูุธุงู ุงููุฌููุนุฉ ุ ูุง ูุนุฑู ููุงู ุชูุงุฌุฏ ุงูุฌุฑุงูุฉ ุ ูุณูุจุญุซ VShard.router ุนู <code>bucket id</code> . <br><br>  ุฏุนููุง ูููู ูุธุฑุฉ ุนูู ูุซุงู ููู ูุจุฏู ูุฐุง.  ูุนูุฏ ุฅูู ุงููุฌููุนุฉ ุงููุตุฑููุฉ ูุญุณุงุจุงุช ุงูุนููุงุก.  ุฃุฑูุฏ ุฃู ุฃููู ูุงุฏุฑูุง ุนูู ุณุญุจ ุฌููุน ุญุณุงุจุงุช ุนููู ูุนูู ูู ุงููุฌููุนุฉ.  ููููุงู ุจุฐูู ุ ุงูุชุจ ุงููุธููุฉ ุงููุนุชุงุฏุฉ ููุจุญุซ ุงููุญูู: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f78/e2b/df2/f78e2bdf2d977fcb9fb320b031592171.png"><br><br>  ุฅููุง ุชุจุญุซ ุนู ุฌููุน ุญุณุงุจุงุช ุงูุนููุงุก ุญุณุจ ูุนุฑูู.  ุฃุญุชุงุฌ ุงูุขู ุฅูู ุชุญุฏูุฏ ุฃู ูู ุงููุณุชูุฏุนุงุช ูุงุณุชุฏุนุงุก ูุฐู ุงููุธููุฉ.  ููููุงู ุจุฐูู ุ ุฃููู ุจุญุณุงุจ <code>bucket id</code> ูู ูุนุฑู ุงูุนููู ูู ุทูุจู ูุฃุทูุจ ูู VShard.router ุงูุงุชุตุงู ุจู ุจูุซู ูุฐู ุงููุธููุฉ ูู ูุญุฏุฉ ุงูุชุฎุฒูู ุญูุซ ูุนูุด ุงูุฌุฑุฏู ุฐู <code>bucket id</code> ุงููุงุชุฌ.  ููุฌุฏ ุฌุฏูู ุชูุฌูู ูู ุงููุญุฏุฉ ุงููุฑุนูุฉ ุ ุญูุซ ูุชู ุชุญุฏูุฏ ูููุน ุงููุฌููุนุฉ ูู ูุฌููุนุฉ ุงููุณุฎ ุงููุชูุงุซูุฉ.  ู VShard.router ูููุงุก ุทูุจู. <br><br>  ุจุงูุทุจุน ุ ูุฏ ูุญุฏุซ ุฃู ุจุฏุฃุช ุนูููุฉ ุฅุนุงุฏุฉ ุงูุดุญู ูุจุฏุฃ ุงูุฏูู ูู ุงูุชุญุฑู.  ูููู ุงูููุฌู ุงูููุฌูุฏ ูู ุงูุฎูููุฉ ุจุชุญุฏูุซ ุงูุฌุฏูู ุชุฏุฑูุฌููุง ุจุฃุฌุฒุงุก ูุจูุฑุฉ: ูุณุชุนูู ุนู ูุณุชูุฏุนุงุช ุงูุฌุฏุงูู ุงูุญุงููุฉ ููุฌุฑุงูุฉ. <br><br>  ูุฏ ูุญุฏุซ ุญุชู ุฃููุง ููุชูู ุฅูู ุงููุฌููุนุฉ ุงูุชู ุงูุชููุช ููุชู ุ ููู ูุชููู ุฌูุงุฒ ุงูุชูุฌูู ุจุนุฏ ูู ุชุญุฏูุซ ุฌุฏูู ุงูุชูุฌูู ุงูุฎุงุต ุจู.  ุซู ููุชูู ุฅูู ุงููุณุชูุฏุน ุงููุฏูู ุ ูุณูููู ุจุฅุฎุจุงุฑ ุงูููุฌู ุจููุงู ุงูุจุญุซ ุนู ุงูุฏูู ุ ุฃู ุงูุฅุฌุงุจุฉ ุจุจุณุงุทุฉ ุนูู ุฃูู ูุง ูุญุชูู ุนูู ุงูุจูุงูุงุช ุงููุงุฒูุฉ.  ุจุนุฏ ุฐูู ุณูู ูุชุฌูู ุฌูุงุฒ ุงูุชูุฌูู ูู ุฌููุน ุงููุฎุงุฒู ุจุญุซูุง ุนู ุงููุฌููุนุฉ ุงููุทููุจุฉ.  ููู ูุฐุง ุดูุงู ุจุงููุณุจุฉ ููุง ุ ููู ููุงุญุธ ุญุชู ุชูููุช ูู ุฌุฏูู ุงูุชูุฌูู. <br><br><h1 style=";text-align:right;direction:rtl">  ูุฑุงุกุฉ ุนุฏู ุงูุงุณุชูุฑุงุฑ </h1><br>  ุชุฐูุฑ ุงููุดุงูู ุงูุชู ูุงุฌููุงูุง ูู ุงูุจุฏุงูุฉ: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูู ููู ููุงู ููุงู ููุจูุงูุงุช.  ูุฑุฑูุง ุจุฅุถุงูุฉ bucket'ov. </li><li style=";text-align:right;direction:rtl">  ุฅุนุงุฏุฉ ุงููุดุงุฑูุฉ ุฃุจุทุฃุช ูู ุดูุก ูุชุจุงุทุฃุช.  ููุฐุช bucket'ami ููู ุงูุจูุงูุงุช ุงูุฐุฑูุฉ ุชูููุฐูุง ุ ุชุฎูุตุช ูู ุฅุนุงุฏุฉ ูุฑุฒ ูุธุงุฆู ูุดุฑุฉ. </li><li style=";text-align:right;direction:rtl">  ูุฑุงุกุฉ ุบูุฑ ูุณุชูุฑุฉ. </li></ul><br>  ูุชู ุญู ุงููุดููุฉ ุงูุฃุฎูุฑุฉ ุจูุงุณุทุฉ VShard.router ุจุงุณุชุฎุฏุงู ุงููุธุงู ุงููุฑุนู ูุชุฌุงูุฒ ูุฑุงุกุฉ ุชููุงุฆูุฉ. <br><br>  ูููู ุฌูุงุฒ ุงูุชูุฌูู ุจุฅุฌุฑุงุก ุงุฎุชุจุงุฑ ุฏูุฑู ููุชุฎุฒูู ุงููุญุฏุฏ ูู ุงูุชูููู.  ุซู ุชููู ุจุนุถูู ุนู ุงูุฃุฒูุฒ.  ูุญุชูู ุฌูุงุฒ ุงูุชูุฌูู ุนูู ุงุชุตุงู ูุณุฎ ุงุญุชูุงุทู ุณุงุฎู ููู ูุณุฎุฉ ูุชูุงุซูุฉ ุ ูุฅุฐุง ุชููู ุงูุฌูุงุฒ ุงูุญุงูู ุนู ุงูุงุณุชุฌุงุจุฉ ุ ูุณูู ููุชูู ุฅูู ูุณุฎุฉ ุฃุฎุฑู.  ุณุชุชู ูุนุงูุฌุฉ ุทูุจ ุงููุฑุงุกุฉ ุจุดูู ุทุจูุนู ุ ูุฃูู ูููููุง ูุฑุงุกุฉ ุงููุณุฎ ุงููุชูุงุซูุฉ (ูููู ููุณ ุงููุชุงุจุฉ).  ูููููุง ุชุนููู ุฃููููุฉ ุงููุณุฎ ุงููุชูุงุซูุฉ ุงูุชู ููุจุบู ูุฌูุงุฒ ุงูุชูุฌูู ุจูุงุณุทุชูุง ุชุญุฏูุฏ ุชุฌุงูุฒ ุงููุดู ูููุฑุงุกุงุช.  ูุญู ููุนู ูุฐุง ูุน ุชูุณูู ุงูููุงุทู. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5c3/5bf/dbd/5c35bfdbddd67fe8217f06730673bd43.png"><br><br>  ูููู ุจุชุนููู ุฑูู ููุทูุฉ ููู ูุณุฎุฉ ูุชูุงุซูุฉ ููู ุฌูุงุฒ ุชูุฌูู ููุถุน ุฌุฏูููุง ูุดูุฑ ููู ุฅูู ุงููุณุงูุฉ ุจูู ูู ุฒูุฌ ูู ุงูููุงุทู.  ุนูุฏูุง ููุฑุฑ ุฌูุงุฒ ุงูุชูุฌูู ููุงู ุฅุฑุณุงู ุทูุจ ูุฑุงุกุฉ ุ ูุฅูู ุณูุชู ุชุญุฏูุฏ ูุณุฎุฉ ูุชูุงุซูุฉ ูู ุงูููุทูุฉ ุงูุฃูุฑุจ ุฅูู ููุทูุชู. <br><br>  ููู ูุจุฏู ูู ุงูุชูููู: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/445/799/5ae/4457995ae5c7bc1761684cf7d4f3b2e4.png"><br><br>  ูู ุงูุญุงูุฉ ุงูุนุงูุฉ ุ ููููู ุงูุฑุฌูุน ุฅูู ูุณุฎุฉ ูุชูุงุซูุฉ ุชุนุณููุฉ ุ ูููู ุฅุฐุง ูุงูุช ุงููุชูุฉ ูุจูุฑุฉ ููุนูุฏุฉ ุ ูููุฒุนุฉ ููุบุงูุฉ ุ ูุฅู ุชูุณูู ุงูููุงุทู ูููุฏ ุฌุฏูุง.  ูููู ุฃู ุชููู ุฑููู ุงูุฎุงุฏู ุงููุฎุชููุฉ ููุงุทู ุ ุญุชู ูุง ูุชู ุชุญููู ุงูุดุจูุฉ ุจุญุฑูุฉ ูุฑูุฑ.  ุฃู ูููู ุฃู ุชููู ููุงุท ุจุนูุฏุฉ ุฌุบุฑุงููุง ุนู ุจุนุถูุง ุงูุจุนุถ. <br><br>  ูุณุงุนุฏ ุชูุณูู ุงูููุงุทู ุฃูุถูุง ุนูู ุงุฎุชูุงู ุฃุฏุงุก ุงููุณุฎ ุงููุชูุงุซูุฉ.  ุนูู ุณุจูู ุงููุซุงู ุ ูู ูู ูุฌููุนุฉ ูุณุฎ ูุชูุงุซูุฉ ุ ูุฏููุง ูุณุฎุฉ ูุชูุงุซูุฉ ุงุญุชูุงุทูุฉ ูุงุญุฏุฉ ุ ูุงูุชู ูุง ููุจุบู ุฃู ุชูุจู ุงูุทูุจุงุช ุ ูููู ููุท ุชุฎุฒูู ูุณุฎุฉ ูู ุงูุจูุงูุงุช.  ุซู ูุฌุนููุง ูู ุงูููุทูุฉ ุ ูุงูุชู ุณุชููู ุจุนูุฏุฉ ุฌุฏูุง ุนู ุฌููุน ุฃุฌูุฒุฉ ุงูุชูุฌูู ุงูููุฌูุฏุฉ ูู ุงูุฌุฏูู ุ ูุณูู ุชุชุญูู ุฅูููุง ูู ุงูุญุงูุฉ ุงููุตูู. <br><br><h1 style=";text-align:right;direction:rtl">  ุชุณุฌูู ุนุฏู ุงูุงุณุชูุฑุงุฑ </h1><br>  ูุธุฑูุง ูุฃููุง ูุชุญุฏุซ ุนู ุชุฌุงูุฒ ุงููุดู ูู ุงููุฑุงุกุฉ ุ ููุงุฐุง ุนู ูุดู ุงููุชุงุจุฉ ุนูุฏ ุชุบููุฑ ุงููุนุงูุฌุ  ููุง ุ VShard ููุณุช ูุฑุฏูุฉ ููุบุงูุฉ: ูู ูุชู ุชูููุฐ ุงูุชุฎุงุจ ุณูุฏ ุฌุฏูุฏ ูููุง ุ ุณูููู ุนููู ุงูููุงู ุจุฐูู ุจููุณู.  ุนูุฏูุง ูุฎุชุงุฑูุง ุจุทุฑููุฉ ุฃู ุจุฃุฎุฑู ุ ูู ุงูุถุฑูุฑู ุฃู ุชุชููู ูุฐู ุงูุญุงูุฉ ุงูุขู ุณูุทุฉ ุงูุณูุฏ.  ูููู ุจุชุญุฏูุซ ุงูุชูููู ุนู ุทุฑูู ุชุญุฏูุฏ <code>master = false</code> ููุณูุฏ ุงููุฏูู ุ ู <code>master = true</code> ููุชุทุจูู ุงูุฌุฏูุฏ ุ ูุชุทุจููู ุนุจุฑ VShard.storage.cfg ูููู ุนูู ูุญุฏุฉ ุงูุชุฎุฒูู.  ุซู ูู ุดูุก ูุญุฏุซ ุชููุงุฆูุง.  ุชููู ุงููุนูู ุงููุฏูู ุนู ูุจูู ุทูุจุงุช ุงููุชุงุจุฉ ููุจุฏุฃ ูู ุงููุฒุงููุฉ ูุน ุงูุทูุจ ุงูุฌุฏูุฏ ุ ูุฃูู ูุฏ ุชููู ููุงู ุจูุงูุงุช ุชู ุชุทุจูููุง ุจุงููุนู ุนูู ุงููุนูู ุงููุฏูู ุ ููู ุงูุทูุจ ุงูุฌุฏูุฏ ูู ูุตู ุจุนุฏ.  ุจุนุฏ ุฐูู ุ ูุฏุฎู ุงูุฑุฆูุณู ุงูุฌุฏูุฏ ุงูุฏูุฑ ููุจุฏุฃ ูู ูุจูู ุงูุทูุจุงุช ุ ููุตุจุญ ุงููุนูู ุงููุฏูู ูุณุฎุฉ ุทุจู ุงูุฃุตู.  ูุฐู ูู ุงูุทุฑููุฉ ุงูุชู ูุนูู ุจูุง ูุดู ุงููุชุงุจุฉ ูู VShard. <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">replicas = new_cfg.sharding[uud].replicas replicas[old_master_uuid].master = false replicas[new_master_uuid].master = true vshard.storage.cfg(new_cfg)</code> </pre> <br><h1 style=";text-align:right;direction:rtl">  ููู ุงูุขู ููุชุงุจุนุฉ ูู ูุฐู ุงูุฃุญุฏุงุซ ุงููุชููุนุฉุ </h1><br>  ูู ุงูุญุงูุฉ ุงูุนุงูุฉ ุ ูููู <code>VShard.storage.info</code> - <code>VShard.storage.info</code> ู <code>VShard.router.info</code> . <br><br>  ูุนุฑุถ VShard.storage.info ุงููุนูููุงุช ูู ุนุฏุฉ ุฃูุณุงู. <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">vshard.storage.info() --- - replicasets: &lt;replicaset_2&gt;: uuid: &lt;replicaset_2&gt; master: uri: storage@127.0.0.1:3303 &lt;replicaset_1&gt;: uuid: &lt;replicaset_1&gt; master: missing bucket: receiving: 0 active: 0 total: 0 garbage: 0 pinned: 0 sending: 0 status: 2 replication: status: slave Alerts: - ['MISSING_MASTER', 'Master is not configured for ''replicaset &lt;replicaset_1&gt;']</code> </pre> <br>  ุงูุฃูู ูู ูุณู ุงููุณุฎ ุงููุชูุงุซู.  ูุชู ุนุฑุถ ุญุงูุฉ ุงููุณุฎุฉ ุงููุชูุงุซูุฉ ุงูุชู ููุช ุจุชุทุจูููุง ุนูู ูุฐู ุงููุธููุฉ: ูุง ูู ุงููุณุฎ ุงููุชูุงุซู ุงูุฐู ุชุฎููู ุ ููู ูุฏูู ุงุชุตุงูุงุช ููู ูุง ูุชููุฑ ุ ููู ูู ูุชุงุญ ูุบูุฑ ูุชููุฑ ุ ูุฃู ูุนุงูุฌ ุชู ุชููููู ูู ุฃุฌูู ุ ุฅูุฎ. <br><br>  ูู ูุณู ุงูุฌุฑุงูุฉ ุ ููููู ุฃู ุชุฑู ูู ุงูููุช ุงููุนูู ุนุฏุฏ ุงูุฌุฑุงูุงุช ุงูุฐูู ููุชูููู ุญุงูููุง ุฅูู ูุฌููุนุฉ ุงููุณุฎ ุงููุชูุงุซูุฉ ุงูุญุงููุฉ ุ ูุนุฏุฏ ุงููุบุงุฏุฑูู ููุง ุ ูุนุฏุฏ ุงูุฐูู ูุนูููู ุนูููุง ุญุงูููุง ุ ูุนุฏุฏ ุงูุฌุณููุงุช ุงูุชู ุชู ูุถุน ุนูุงูุฉ ุนูููุง ูููุงูุฉ ุ ูุนุฏุฏ ุงููุฑููุงุช. <br><br>  ูุณู ุงูุชูุจูู ุนุจุงุฑุฉ ุนู ูุฌููุนุฉ ูุจูุฑุฉ ูู ุงููุดููุงุช ุงูุชู ุชููู VShard ูู ุชุญุฏูุฏูุง ุจุดูู ูุณุชูู: ูู ูุชู ุชูููู ุงูุฑุฆูุณู ุ ููุณุชูู ุงูุชูุฑุงุฑ ุบูุฑ ูุงู ุ ูุงูุณูุฏ ููุฌูุฏ ุ ูููู ูุดูุช ุฌููุน ุงููุณุฎ ุงููุชูุงุซูุฉ ุ ุฅูุฎ. <br><br>  ูุงููุณู ุงูุฃุฎูุฑ ูู ุถูุก ูุถูุก ุจุงูููู ุงูุฃุญูุฑ ุนูุฏูุง ุชุณูุก ุงูุฃููุฑ.  ุฅูู ุฑูู ูู ุตูุฑ ุฅูู ุซูุงุซุฉ ุ ููููุง ุฒุงุฏ ุนุฏุฏ ุงูุฃุณูุฃ. <br><br>  ูุญุชูู VShard.router.info ุนูู ููุณ ุงูุฃูุณุงู ุ ููููู ูุฎุชูููู ููููุงู. <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">vshard.router.info() --- - replicasets: &lt;replicaset_2&gt;: replica: &amp;0 status: available uri: storage@127.0.0.1:3303 uuid: 1e02ae8a-afc0-4e91-ba34-843a356b8ed7 bucket: available_rw: 500 uuid: &lt;replicaset_2&gt; master: *0 &lt;replicaset_1&gt;: replica: &amp;1 status: available uri: storage@127.0.0.1:3301 uuid: 8a274925-a26d-47fc-9e1b-af88ce939412 bucket: available_rw: 400 uuid: &lt;replicaset_1&gt; master: *1 bucket: unreachable: 0 available_ro: 800 unknown: 200 available_rw: 700 status: 1 alerts: - ['UNKNOWN_BUCKETS', '200 buckets are not discovered']</code> </pre> <br>  ุงููุณู ุงูุฃูู ูู ุงููุณุฎ ุงููุชูุงุซู.      ,    :    ,  replica set'  ,          ,   ,   replica set'  bucket'     ,     . <br><br>   Bucket    bucket',              ;    bucket'   ;  ,       replica set'. <br><br>   Alert,  ,   ,   failover,   bucket'. <br><br> ,         . <br><br><h1 style=";text-align:right;direction:rtl">     VShard? </h1><br>  โ    bucket'.       <code>int32_max</code> ?     bucket'   โ  30      16   .     bucket',     .           bucket',          bucket'.    ,          . <br><br>  โ   -   <code>bucket id</code> .    ,    -   ,   bucket โ           .      ,   bucket'   ,  VShard    bucket'.       -,      bucket'  bucket,  -.    . <br><br><h1 style=";text-align:right;direction:rtl">  ููุฎุต </h1><br> Vshard : <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ; </li><li style=";text-align:right;direction:rtl">  ; </li><li style=";text-align:right;direction:rtl">    ; </li><li style=";text-align:right;direction:rtl">  read failover; </li><li style=";text-align:right;direction:rtl">    bucket'. </li></ul><br> VShard   .  -    .  โ  <b>   </b> .     ,       .           . <br><br>  โ <b>lock-free  bucket'</b> .   ,       bucket'      .      ,     . <br><br>  โ <b>  </b> .          : -    ,   ,    ?        . <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">  </a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar436916/">https://habr.com/ru/post/ar436916/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar436904/index.html">32 ูููู ุนุชุจุฉ ููุจูุงูุงุช ูู AVR ูููุฑูููุชุฑููุฑ ROM</a></li>
<li><a href="../ar436908/index.html">6 ุทุฑู ูุฅุฎูุงุก ุงูุจูุงูุงุช ูู ุชุทุจูู Android</a></li>
<li><a href="../ar436910/index.html">ูุตุงุฆุญ ูุฅูุดุงุก ููุงู ุณูุฑ ุนูู ูุฎุตุตุฉ ูู GitLab CI</a></li>
<li><a href="../ar436912/index.html">2019 ุงุชุฌุงูุงุช ุฅุฏุงุฑุฉ ุนูุงูุงุช ุงูุนููุงุก: ูุชุนุฉ ุงููุฑุงุกุฉ ูุฎุทูุฑุฉ ููุงุนุชูุงุฏ</a></li>
<li><a href="../ar436914/index.html">ูุดุงูู ููู ุจุฏุก ุงูุชุดุบูู - ุงููุฑุงูุจุฉ</a></li>
<li><a href="../ar436918/index.html">ุฅูุดุงุก ูุนุจุฉ ูู Game Boy ุ ุงูุฌุฒุก 2</a></li>
<li><a href="../ar436920/index.html">PAS2JS transpiler ูู Pascal ุฅูู JavaScript: ุบูุฑ ูุชูุงูู ูุน Delphi ูุงูุญููู ุงูุจุฏููุฉ</a></li>
<li><a href="../ar436922/index.html">ุชุญุณูู ููุช ุจุฏุก ุชุดุบูู ุจุฑูููุซููุณ 2.6.0 ูุน pprof</a></li>
<li><a href="../ar436924/index.html">ุจุถุน ูููุงุช ุนู ุชูุธูู ุงููุณุงุจูุงุช ุงูุฑูุจูุชูุฉ</a></li>
<li><a href="../ar436926/index.html">ุฃุจุทุงู ุงููุตุงุฏูุฉ ุซูุงุฆูุฉ ุงูุนุงูู ุ ุฃู ููููุฉ "ุงููุดู ูู ุฃุญุฐูุฉ ุงูุขุฎุฑูู"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>