<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßñüèø üöé ü¶Å CSTroN - um monitor caseiro em uma matriz CSTN vintage com uma entrada VGA e uma placa de controle FPGA üçä üíáüèΩ ü§∑</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="E se o TFT nunca foi inventado? LCD de matriz CSTN 

 Entrada 
 Quando os monitores CRT prevaleceram, o seguinte argumento foi apresentado a seu favor...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>CSTroN - um monitor caseiro em uma matriz CSTN vintage com uma entrada VGA e uma placa de controle FPGA</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/444762/"><img src="https://habrastorage.org/webt/ts/vw/uo/tsvwuobygirooozzafy1gnmiiua.jpeg"><br><br>  E se o TFT nunca foi inventado?  LCD de matriz CSTN <br><br><h1>  Entrada </h1><br>  Quando os monitores CRT prevaleceram, o seguinte argumento foi apresentado a seu favor: apesar de todas as melhorias, os monitores LCD nunca superam os monitores de tubo na qualidade da imagem.  Eles, como antes, s√≥ encontrar√£o aplica√ß√£o onde efici√™ncia energ√©tica e pequena espessura s√£o necess√°rias [1].  D√©cadas se passaram e agora sabemos se os defensores desse argumento estavam certos.  Hoje, por√©m, √© interessante observar os LCDs da √©poca: eles s√£o realmente de m√° qualidade?  Como √© olhar para a matriz da CSTN em 2019? <a name="habracut"></a><br><br><img src="https://habrastorage.org/webt/fm/yv/rf/fmyvrfvnpiqfyih0abovza8tn-m.jpeg"><br><br>  <i>TFT esquerdo, CSTN direito, ambos os monitores dos anos noventa</i> <br><br><h1>  LCD no s√©culo passado </h1><br>  Antes de mudar para o TFT, uma variedade de tecnologias de tela era usada em laptops.  No in√≠cio, eles usavam os mesmos monitores CRT que em computadores de mesa, apenas os menores.  Por exemplo, em Compaq Portable (1983), IBM 5155 (1984) ou Commodore SX-64 (tamb√©m 1984). <br><br><img src="https://habrastorage.org/webt/ge/nb/za/genbzaejmhqeermw61pdxau4nli.jpeg"><br><br>  <i>IBM 5155, autor: Soupmeister, licenciado: CC-BY-SA-2.0, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">daqui</a></i> <br><br>  Carregar esse PC com voc√™ em todos os lugares era dif√≠cil, uma coisa completamente diferente - um laptop com um TN-LCD (twist nem√°tico), por exemplo, IBM 5140 (1986), Toshiba T1000 (1987).  Esses monitores t√™m baixo contraste e √¢ngulo de vis√£o. <br><br><img src="https://habrastorage.org/webt/ee/u8/xr/eeu8xrwciq0nl2cl6z8cha0zu5u.jpeg"><br><br>  <i>Toshiba T1100 com tela TN monocrom√°tica, autor: Johann H. Addicks, licen√ßa: GFDL, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">portanto</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">o</a> link est√° quebrado, tamb√©m no original</i> <br><br>  Alguns fabricantes experimentaram matrizes de descarga de g√°s, como Toshiba T3200 (1987) e IBM PS / 2 P70 (1991) viam a luz do dia.  Eles proporcionavam alto contraste e v√°rias grada√ß√µes de brilho de luz vermelho-laranja, mas eram muito caros.  Por fim, foram desenvolvidos STN-LCDs (supertwist nemmatic), como, por exemplo, no Electronics MC1504 e seu prot√≥tipo Toshiba T1100.  O contraste foi muito melhor - de 1: 5 a 1:50, e v√°rias grada√ß√µes de brilho foram suficientes para aplicativos de neg√≥cios (o uso de um laptop na vida cotidiana ainda era muito caro).  Mas e se o usu√°rio quiser uma imagem colorida?  Nesse caso, ele recebeu duas tecnologias: TFT e CSTN (cor nem√°tica de super-tor√ß√£o de cores).  O primeiro laptop com TFT - NEC PC9801NC - foi lan√ßado em 1990, a qualidade da imagem naqueles anos foi acima de tudo um elogio, mas custou "um brinquedo desse tipo" √© muito mais caro do que outros laptops caros.  Bem, uma tela CSTN √© apenas uma tela STN, na qual um filtro √© sobreposto.  Por um longo tempo, os laptops usaram matrizes dos dois tipos.  E no metr√¥ de Nova York, os monitores da CSTN ainda funcionam. <br><br><img src="https://habrastorage.org/webt/kk/ch/bd/kkchbdoyuc75xvwabt_3zwmrcp0.jpeg"><br><br>  <i>Um deles, fonte: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Transit + PLUS</a></i> <br><br><h1>  Cstron </h1><br>  O autor queria ver a exibi√ß√£o da CSTN.  Como  Para come√ßar, basta comprar um laptop antigo e us√°-lo.  Acabou sendo um processador AMD 5x86-P133.  Ou seja, a coisa mais din√¢mica que voc√™ pode executar nos jogos DOS (oh, o MPEG1 puxar√° o QV - translator no programa).  Obviamente, reproduzi-los √© √≥timo, mas eu queria ver como o YouTube, por exemplo, ou um jogo moderno se parece com essa tela - mas isso √© imposs√≠vel. <br><br>  Ou? <br><br>  Em geral, voc√™ precisa adicionar uma entrada VGA ou HDMI de alguma forma - e pode enviar um sinal de algo moderno.  As telas TFT dos laptops s√£o t√£o refeitas em monitores com bastante frequ√™ncia.  Basta comprar um quadro que corresponda √† matriz - e pronto.  E voc√™ pode criar seu pr√≥prio prefixo no FPGA, que converte um sinal VGA ou HDMI em um fluxo de dados de pixel. <br><br>  Era uma vez, tamb√©m foram produzidas placas para a convers√£o de matrizes CSTN em monitores VGA, mas isso n√£o √© mais encontrado.  Mas voc√™ pode adaptar a placa de depura√ß√£o do FPGA ML505 para isso. <br><br><img src="https://habrastorage.org/webt/ts/vw/uo/tsvwuobygirooozzafy1gnmiiua.jpeg"><br><br>  <i>O resultado final.</i>  <i>√â bastante incomum observar isso em uma tela CSTN: 16 GB de RAM.</i> <br><br><h1>  Gerenciamento de matrizes </h1><br>  Vamos come√ßar com o b√°sico.  Como qualquer exibi√ß√£o de matriz, a exibi√ß√£o CSTN possui linhas e colunas.  Voc√™ j√° controlou uma matriz de LED de um microcontrolador?  √â o mesmo aqui, mas as tens√µes s√£o vari√°veis.  Voc√™ precisa aplicar certos sinais √†s linhas e colunas selecionadas e n√£o selecionadas - e o pixel na interse√ß√£o da linha e coluna selecionada mostrar√° o que voc√™ precisa.  A forma dos sinais √© muito complexa, o valor m√©dio quadr√°tico da tens√£o, a mudan√ßa de fase entre as tens√µes na linha e na coluna e o deslocamento ... E assim, pixel por pixel, uma imagem √© formada. <br><br>  Felizmente, os FPGAs n√£o precisam gerar todos esses sinais, e mesmo em um n√∫mero t√£o grande de linhas.  Tudo isso √© feito pelo m√≥dulo embutido na tela.  L√°, o conversor de pulsos aumenta a tens√£o constante, passa pelo divisor e pelo repetidor, para obter a tens√£o de polariza√ß√£o.  Os drivers de linha e coluna transformam essa tens√£o em uma vari√°vel da forma necess√°ria.  Tudo o que √© necess√°rio √© enviar um fluxo de dados de estado de pixel ao m√≥dulo de exibi√ß√£o. <br><br>  Em um LCD TFT com uma interface DPI (interface paralela digital), todos os dados sobre um pixel chegam ao mesmo tempo em um ciclo.  Na linha de sincroniza√ß√£o horizontal e de quadro, os pulsos s√£o recebidos ap√≥s cada linha e quadro, respectivamente.  Os pixels s√£o simplesmente transmitidos continuamente linha por linha, quadro a quadro.  Se a transmiss√£o de quadro completo demorar 1/60 s, a taxa de atualiza√ß√£o ser√° de 60 Hz.  A largura do barramento de dados √© igual √† profundidade da cor em bits, geralmente 16 (5 bits para vermelho e azul, 6 para verde), 18 (6 bits para cada cor) ou 24 (8 bits para cada cor).  LVDS √© a mesma coisa, apenas bits n√£o s√£o transmitidos em paralelo, mas sequencialmente em pares diferenciais, mas no MIPI DSI eles tamb√©m s√£o combinados em pacotes.  O barramento SPI / i80 permite transmitir v√°rios comandos ao controlador e que, executando-os, gera sinais para DPI ou uma interface semelhante.  O que, por sua vez, lembra um pouco o VGA, apenas os dados sobre o brilho de cada uma das cores s√£o recebidos n√£o em anal√≥gico, mas em formato digital.  Existem conversores VGA para DPI e vice-versa.  As placas s√£o muito convenientes, permitindo que voc√™ receba um sinal VGA do Raspberry Pi, embora inicialmente este computador produza apenas HDMI e v√≠deo composto. <br><br>  Sinais muito semelhantes aos fornecidos a uma matriz TFT com uma interface DPI devem ser fornecidos ao m√≥dulo de exibi√ß√£o da matriz CSTN.  A folha de dados no SX21V001 [2] mostra como controlar uma tela CSTN com uma resolu√ß√£o de 640x480: <br><br><img src="https://habrastorage.org/webt/ga/au/fu/gaaufudmnscsyjt2mj89ir2hj-g.png"><br><br>  Isso mostra a transfer√™ncia de todo o quadro.  O sinal chega na linha CL1 ap√≥s cada linha, no FLM ap√≥s cada quadro.  E h√° um barramento de dados de 16 linhas.  Na verdade, ocorreu um erro nesta figura: durante a transmiss√£o da primeira e segunda linhas, os dados Y1 e Y2, e n√£o X1 e X2, mas Y140 e Y242, respectivamente, s√£o recebidos nas linhas UD0-UD7.  Aqui U e L s√£o, respectivamente, superior e inferior, ou seja, a tela consiste em duas matrizes com uma resolu√ß√£o de 640x240, localizadas uma acima da outra.  Aqui est√°, o misterioso "dual scan" de um antigo an√∫ncio de laptop, do qual surge uma faixa horizontal em toda a tela.  Para telas STN e CSTN, o contraste √© inversamente proporcional ao n√∫mero de linhas, portanto, essa separa√ß√£o permite aumentar.  Mas essa n√£o √© a √∫nica maneira de diferirem na maneira como s√£o controlados pelo TFT. <br><br><img src="https://habrastorage.org/webt/po/cu/_2/pocu_2wfevtfpev7hbuapasb2va.png"><br><br>  N√£o est√° claro por que o eixo horizontal foi chamado Y ... Mas, em qualquer caso, o CL2 aqui √© uma linha para fornecer pulsos de clock que alternam pixels.  Mas nos barramentos UD e LD em um ciclo, n√£o s√£o transmitidos dados sobre um pixel de v√°rios bits, como no TFT, mas dados sobre v√°rios pixels ao mesmo tempo, tr√™s bits cada.  Um bit por cor, tr√™s bits por pixel - oito cores no total. <br><br><img src="https://habrastorage.org/webt/ur/dr/6u/urdr6uzrqstflu-gy2r5q-opazy.jpeg"><br><br>  Mas como assim?  √â claro que os monitores CSTN t√™m poucas cores, por exemplo, 4096 ou 32768, mas n√£o 8.  Acontece que o PWM √© aplicado aqui.  Os LEDs s√£o controlados dessa maneira, o que significa que os pixels do LCD s√£o poss√≠veis.  Voc√™ precisa, por exemplo, de um brilho de 50% - ative o pixel em quadros pares e desative-o em quadros √≠mpares.  Esse m√©todo √© chamado FRC (controle de taxa de quadros), mas o PWM nesse contexto √© chamado controle de brilho de pixel da mesma maneira, mas em dois ou mais quadros, mas um.  O FRC implementa um dispositivo externo e o PWM implementa os chips do m√≥dulo de exibi√ß√£o, se houver suporte para esta fun√ß√£o.  O autor n√£o sabe que as exibi√ß√µes CSTN com PWM, mas ele sugere que estas s√£o matrizes do tipo HPA.  De qualquer forma, como o PWM n√£o est√° dispon√≠vel, a profundidade de cor necess√°ria pode ser obtida usando o FRC. <br><br><img src="https://habrastorage.org/webt/2s/fv/ui/2sfvuishe3qnnb9fytk4mmbthju.jpeg"><br><br>  A cintila√ß√£o ser√° o pre√ßo disso, portanto taxas de quadros monstruosas (comparadas ao TFT) podem ser encontradas nos monitores CSTN.  Por exemplo, este m√≥dulo inicialmente possu√≠a 120 Hz e o autor fez um overclock para 240. <br><br><h1>  Como foi implementado </h1><br>  O desenvolvedor enfrentou v√°rias dificuldades ao mesmo tempo: <br><br>  - o sinal de entrada tem uma taxa de quadros de 60 Hz, deve ser duplicado ou at√© quadruplicado <br><br>  - no sinal de entrada, o quadro n√£o √© dividido nas metades superior e inferior de 640x240 pixels cada, mas aqui √© necess√°rio dividir <br><br>  - voc√™ tamb√©m precisa implementar o FRC, caso contr√°rio, a profundidade da cor ser√° de 3 bits por pixel <br><br>  Os dois primeiros pontos significam que √© necess√°rio um buffer de quadro, e n√£o um simples, mas um de duas portas.  Bem, a terceira tarefa √© resolvida usando GLDP LUT (tabela de pesquisa de padr√µes de exibi√ß√£o em n√≠vel de escala de cinza) [3].  A tabela de pesquisa possui dois tipos de dados de entrada: a cor a ser exibida e o estado do contador de quadros.  E um tipo de sa√≠da: os tr√™s bits que precisam ser submetidos aos subpixels de um determinado pixel em um determinado momento.  Portanto, os seguintes n√≥s ser√£o necess√°rios: <br><br><img src="https://habrastorage.org/webt/fi/lx/4-/filx4-nrwyepv-5jjdvjd5jvgh0.png"><br><br>  A primeira coisa a fazer √© preencher a tela inteira com um pouco de cor.  Nesse est√°gio, n√£o √© necess√°rio saber onde est√° localizado o pixel; basta garantir que o m√≥dulo de exibi√ß√£o transmita os sinais de forma necess√°rios para a matriz.  O c√≥digo para preencher o FPGA est√° <a href="">aqui</a> . <br><br><img src="https://habrastorage.org/webt/_m/ux/-q/_mux-qskx5al8bielsybiavnvba.jpeg"><br><br>  Agora tente trazer algo para fora e com brilho incompleto tamb√©m.  Procurando por tabelas de pesquisa FRC para minimizar a cintila√ß√£o.  O autor apresentou duas tabelas aplicadas aos pixels em um padr√£o quadriculado.  Portanto, todos os dois pixels vizinhos piscam de forma ass√≠ncrona.  O c√≥digo est√° <a href="">aqui</a> . <br><br><img src="https://habrastorage.org/webt/f2/vl/n9/f2vln9pc18h0txrwkm632snrlns.jpeg"><br><br>  Portanto, j√° ‚Äúensinamos‚Äù o quadro a exibir a imagem, a pr√≥xima coisa que ser√° necess√°ria √© um buffer de quadro.  Em 640x480 e 5 bits para cada uma das cores, seu volume ser√° de aproximadamente 600 kilobytes.  N√£o muito, mas muitos em FPGAs.  Bem, a placa possui RAM como DDR2 e Xilinx MIG para control√°-la.  Dois FIFOs s√£o implementados, um para leitura e outro para escrita.  O √°rbitro decide se a pr√≥xima troca de dados com DDR2 √© de leitura ou grava√ß√£o.  Existem dois buffers, o registro vai para um, lendo do outro e, ao trocar de quadro, eles mudam de lugar.  O c√≥digo do √°rbitro est√° <a href="">aqui</a> . <br><br>  Resta implementar a captura de v√≠deo. Em um dos projetos anteriores, o autor j√° possui um tempo de opera√ß√£o semelhante; ap√≥s o refinamento, o c√≥digo do conversor de VGA para DPI tornou-se <a href="">assim</a> . <br><br><h1>  E o que aconteceu? </h1><br>  Assista! <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/hsehw-7-VTM" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Este √© o terceiro projeto FPGA para o autor, foi interessante trabalhar com o Xilinx MIG e DDR2, bem como com um transportador simples.  Um FRC melhor com modula√ß√£o delta sigma est√° planejado, bem como experimentos com pain√©is CSTN posteriores usando a tecnologia HPA (High Performance Addressing) da Sharp. <br><br>  Obrigado pela aten√ß√£o! <br><br><h1>  Fontes </h1><br>  1. Li, W. &amp; Guo, Q. (2000).  Tecnologia de aplica√ß√£o de display de cristal l√≠quido.  Pequim: Imprensa da Ind√∫stria El√©trica. <br><br>  2. HITACHI (1999).  SX21V001-Z4 Especifica√ß√µes de aceita√ß√£o do cliente. <br><br>  3. Hsueh, Y. &amp; Lee, J. (2008).  M√©todo de melhoria de imagem para o controlador de taxa de quadros do LCD.  Simp√≥sio Internacional IEEE de 2008 sobre Eletr√¥nicos de Consumo.  doi: 10.1109 / isce.2008.4559534 </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt444762/">https://habr.com/ru/post/pt444762/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt444748/index.html">3 qualidades-chave de um gerente de produto de sucesso: Yuri Golikov, vice-presidente de engenharia Wrike</a></li>
<li><a href="../pt444752/index.html">A hist√≥ria do SXSW: como tudo come√ßou</a></li>
<li><a href="../pt444756/index.html">DARPA desenvolver√° um motor nuclear de foguete</a></li>
<li><a href="../pt444758/index.html">Diferen√ßas t√©cnicas dos sistemas de BI (Power BI, Qlik Sense, Tableau)</a></li>
<li><a href="../pt444760/index.html">M√°quina CNC do que estava na garagem</a></li>
<li><a href="../pt444764/index.html">Criptografia em Java</a></li>
<li><a href="../pt444766/index.html">Os funcion√°rios do Facebook tiveram acesso √†s senhas de usu√°rio do Facebook e Instagram</a></li>
<li><a href="../pt444768/index.html">Reduzindo a depend√™ncia de dados marcados em redes generativo-advers√°rias</a></li>
<li><a href="../pt444770/index.html">Como procuramos por um vazamento de dados no SimilarWeb</a></li>
<li><a href="../pt444774/index.html">Erro com a migra√ß√£o de localidade ru-RU no Google Chrome e como se livrar dela</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>