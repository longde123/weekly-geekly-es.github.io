<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üà∑Ô∏è üòá üë¥üèø Mi primera m√°quina virtual: c√≥mo no meterse üêÇ ‚èÆÔ∏è üë©üèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Entonces, aqu√≠ hay una nueva organizaci√≥n en vCloud Director, y solo tiene que crear su primera m√°quina virtual. Hoy te dir√© qu√© configuraciones elegi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Mi primera m√°quina virtual: c√≥mo no meterse</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dataline/blog/472814/"> Entonces, aqu√≠ hay una nueva organizaci√≥n en vCloud Director, y solo tiene que crear su primera m√°quina virtual.  Hoy te dir√© qu√© configuraciones elegir al crear una m√°quina virtual para que funcione y no pida comida.  Vamos! <br><br><img src="https://habrastorage.org/webt/cw/kx/ed/cwkxedsfdfy2c1qdmhnal6cyti0.jpeg"><br>  <i>Fuente: drive2.ru</i> <br><a name="habracut"></a><br>  <b>Sistema operativo</b>  Elija distribuciones modernas.  Si lleva Windows 2008 R2 y versiones anteriores o Linux al kernel 4.19.x, espere problemas.  Cuales?  Bueno, por ejemplo, el proveedor ya ha dejado de admitir el estado actual de Windows 2008 R2 a partir de 2013 (EOL).  Esto significa que ya no desarrolla controladores para el hardware que se ha lanzado desde entonces, no modifica el sistema operativo para nada nuevo.  Con sistemas operativos antiguos, definitivamente no puede usar todas las caracter√≠sticas que proporciona un hipervisor moderno.  Y ya en estas vacaciones de A√±o Nuevo, habr√° un grave problema de seguridad, ya que el 14 de enero de 2020, el soporte extendido para Windows Server 2008 R2 finaliza y la actualizaci√≥n de seguridad deja de publicarse. <br><br>  <b>N√∫cleos por z√≥calo.</b>  Deje 1 n√∫cleo por socket, coloque tantos sockets como necesite procesadores virtuales.  S√≠, es l√≥gico por el contrario, pero con raz√≥n.  A menos que tenga requisitos de licencia especializados.  Por ejemplo, paga por un socket, y m√°s sockets significa m√°s licencias.  No apuestes 2/2 para obtener 4. Haz 4/1.  El hipervisor servir√° a dicha m√°quina de manera √≥ptima.  El planificador del hipervisor penalizar√° menos tales m√°quinas virtuales. <br>  Te lo explicar√© con los dedos.  Imagine que el conductor sienta a los pasajeros en el autom√≥vil, el autom√≥vil, como en Sapsan.  En el rol de planificador de conductores, los pasajeros son m√°quinas virtuales.  Los pasajeros que viajan solos (m√°quinas virtuales de un solo procesador) son los m√°s f√°ciles de distribuir: se pueden colocar en cualquier lugar.  Una familia de 4 (m√°quinas virtuales de 4 procesadores) ya es m√°s complicada.  Necesitan encontrar 4 asientos en un auto.  Ahora imagine que todos en la familia quieren ir solo uno frente al otro, y que solo hay 4 grupos de lugares alrededor de la mesa en el carro. Con una alta probabilidad, esa familia tendr√° que ir al pr√≥ximo carro (el siguiente tick de planificaci√≥n).  Esta es exactamente la situaci√≥n como si eligiera 2 z√≥calos con 2 n√∫cleos para obtener 4. Lo m√°s probable es que tenga que esperar a que se encuentren los lugares correctos.  Es lo mismo con las m√°quinas virtuales: tendr√° que esperar m√°s que las m√°quinas virtuales menos ‚Äúcaprichosas‚Äù con 1 z√≥calo y un mont√≥n de procesadores. <br><br>  Aunque esta historia es m√°s relevante para versiones anteriores de ESXi.  Comenzando con 6.5 (¬°pero no antes!) El mecanismo vNUMA no est√° vinculado a la cantidad de sockets virtuales, y la recomendaci√≥n anterior "no producir sockets" no es tan categ√≥rica.  Pero a√∫n depende de la aplicaci√≥n dentro del sistema operativo invitado. <br><br><img src="https://habrastorage.org/webt/yk/ca/wb/ykcawbp3aughrvmyn_uil1scgtu.png"><br><br>  <b>Agregado en caliente para CPU y memoria.</b>  Esta es una opci√≥n para agregar memoria de CPU para una m√°quina virtual en ejecuci√≥n.  Parecer√≠a ser una gran funci√≥n: no es necesario apagar un autom√≥vil para agotar los recursos.  Entonces, no todo es tan simple, y no es por nada que est√°n deshabilitados por defecto.  Es mejor no incluirlo si no sabe cu√°l es la topolog√≠a de NUMA.  Digamos que tenemos un servidor de doble socket bajo el cap√≥ de la nube.  Cada z√≥calo tiene 4 n√∫cleos.  Funciona igual que 4 + 4, no 8 n√∫cleos.  El mismo tema con la memoria: si hay 128 GB en cada socket, esto no agrega hasta 256 GB.  Cada z√≥calo del procesador tiene acceso directo solo a ranuras de memoria espec√≠ficas.  Cada socket, junto con su procesador y memoria, es un nodo NUMA f√≠sico. <br><br><img src="https://habrastorage.org/webt/ds/a_/jz/dsa_jz-y7x9n53bbi4pljvq75_0.jpeg"><br><br>  Si la m√°quina virtual se ajusta al tama√±o del nodo f√≠sico NUMA, entonces se ejecuta dentro de este nodo.  Si la m√°quina virtual no cabe en el nodo NUMA, por ejemplo, de la memoria, utilizar√° la memoria del nodo NUMA vecino.  La ruta a la memoria remota ser√° tortuosa, a trav√©s del bus interprocesador.  Esto no funcionar√° tan r√°pido como si la m√°quina virtual utilizara los recursos de un nodo. <br><br><img src="https://habrastorage.org/webt/ye/co/l9/yecol9u3huiwnyvsgjvr98gs_0c.jpeg"><br><br>  Cuando habilita la adici√≥n de procesadores virtuales y memoria a uno activo, todo esto va solo al nodo NUMA cero.  Por ejemplo, se agregaron 4 procesadores m√°s, y en el nodo NUMA 0 se convirti√≥ en 6, y en los procesadores NUMA-node 1 - 2.  El auto est√° un poco sesgado, y tambi√©n funciona oblicuamente.  Esto se debe a que cuando enciende vCPU, vNUMA de conexi√≥n en caliente deja de funcionar, a trav√©s de la cual vSphere intenta optimizar la topolog√≠a NUMA para m√°quinas virtuales.  Por lo tanto, al decidir si habilitar la CPU de adici√≥n en caliente, tenga en cuenta la topolog√≠a f√≠sica NUMA para garantizar el rendimiento de la m√°quina virtual.  Esto es muy cr√≠tico si por alguna raz√≥n la VM tiene varios sockets virtuales.  En este caso, la falta de coincidencia de la topolog√≠a f√≠sica provocar√° una severa ca√≠da del rendimiento: el Programador de CPU se volver√° loco tratando de proporcionar tiempo de procesador para tal VM, lo que har√° que la CPU Ready y Co-Stop crezcan. <br><br><img src="https://habrastorage.org/webt/xq/l9/sx/xql9sx66vwhgndfopapipmc3fwq.jpeg"><br>  <i>Todos los procesadores virtuales agregados (5-8) y la memoria llegaron al nodo NUMA 0.</i> <br><br>  Una historia separada es lo que suceder√° dentro del sistema operativo y la aplicaci√≥n despu√©s de tales "adiciones".  Por lo tanto, si decide utilizar esta opci√≥n, compruebe si su sistema operativo lo admite.  Las aplicaciones que no son compatibles con NUMA pueden disminuir considerablemente el rendimiento cuando se ubican en m√∫ltiples nodos NUMA. <br><br>  Si a√∫n agreg√≥ procesadores o memoria al hot, planee reiniciar inmediatamente la VM (no solo el sistema operativo) para el tiempo de inactividad programado m√°s cercano. <br><br><img src="https://habrastorage.org/webt/r6/3o/jv/r63ojvlyhjct7xjxnwnvcw3oklg.png"><br>  <i>No ponemos marcas de verificaci√≥n.</i> <br><br>  <b>Controlador de disco (tipo de bus).</b>  Para los discos, seleccione el Controlador de disco paravirtual.  Este tipo de controlador requiere la instalaci√≥n de controladores en el sistema operativo VMware Tools.  Paravirtual es un dispositivo virtual especial que se cre√≥ para trabajar en virtualizaci√≥n y no emula el funcionamiento de ning√∫n otro dispositivo de hardware.  Cualquier emulaci√≥n de un dispositivo de hardware siempre se ejecuta m√°s lentamente. <br><br>  Si no desea utilizar Paravirtual (pero ¬øpor qu√©?), Elija LSI Logic SAS.  Si el sistema operativo tampoco lo admite, LSI Logic Parallel.  Nunca use SATA e IDE.  VM funcionar√° lentamente, como resultado, no obtendr√° el rendimiento que va a la nube. <br><br>  Al instalar el sistema operativo, incluso la √∫ltima versi√≥n de Windows puede no encontrar el controlador para el adaptador paravirtual.  En este caso, monte dos archivos ISO en la VM: su imagen de arranque de Windows y el disco de herramientas de VMware.  Este √∫ltimo tiene el controlador necesario. <br><br><img src="https://habrastorage.org/webt/ui/vg/gd/uivggdf70jeowrco3lywhr3dre8.png"><br><br>  <b>Adaptador de red</b>  La elecci√≥n correcta es VMXNet3.  VMXNet3, como el adaptador de disco paravirtual, es un dispositivo paravirtual.  Tambi√©n requiere controladores que se incluyen con VMware Tools. <br><br>  Si VMXNet3 de repente no encaja (aparece alg√∫n tipo de incompatibilidad), entonces, en casos extremos, use el E1000E.  Pero no espere m√°s de 1 Gbps del E1000E. <br><br>  En general, no use el E1000E sin instrucciones expl√≠citas de los proveedores.  Parece que es m√°s nuevo, pero est√° hecho para proporcionar una compatibilidad a√∫n mayor con el legado. <br><br><img src="https://habrastorage.org/webt/qj/gz/ia/qjgziamw9setcz5xsh0q1hyrj1o.jpeg"><br>  <i>Aqu√≠ no es necesario E1000E.</i> <br><br>  <b>VMware Tools</b>  Aseg√∫rese de que est√©n instalados en el sistema operativo, en ejecuci√≥n y actualizados.  VMware Tools incluye controladores de dispositivos y varios otros componentes que permiten que el sistema operativo de la m√°quina virtual se comunique con el hipervisor, y viceversa.  A trav√©s de ellos, la hora del sistema operativo se sincroniza con el host de virtualizaci√≥n (desconectado), se activan los latidos que muestran al hipervisor que la m√°quina virtual est√° activa, y as√≠ sucesivamente.  Para ejecutar el sistema operativo en una m√°quina virtual, necesita al menos los controladores de una tarjeta de red, un adaptador de disco.  Las nuevas versiones de todo esto est√°n incluidas en VMware Tools. <br><br>  De forma predeterminada, las versiones actuales de Windows y Linux tienen controladores para trabajar con dispositivos virtuales VMware, pero si tiene VMware Tools, estos controladores siempre ser√°n nuevos.  Para Linux, se recomienda usar open-vm-tools.  Esta no es solo la mejor integraci√≥n con el sistema operativo, sino tambi√©n la actualizaci√≥n de los controladores con el sistema. <br><br><img src="https://habrastorage.org/webt/ou/81/op/ou81opmvo0by_eqmqcida4sehli.png"><br><br>  <b>Unidades de datos separadas.</b>  Utilice diferentes discos virtuales para datos y sistema operativo.  S√≠, y en servidores f√≠sicos vale la pena hacerlo.  Puede hacer una copia de seguridad de estos discos por separado (con diferentes programaciones, por ejemplo), puede cambiar el disco de datos o su clonaci√≥n a otra VM y as√≠ sucesivamente. <br><br>  Adem√°s, el nuevo disco virtual tambi√©n recibir√° una cuota adicional para el rendimiento del disco. <br><br><img src="https://habrastorage.org/webt/jt/za/iy/jtzaiybj9af7wil_pfgj78n5b6m.png"><br><br>  <b>Personalizaci√≥n</b>  Cuando enciende la VM por primera vez, debe personalizarla para que todas las configuraciones de la nube (por ejemplo, la direcci√≥n IP emitida por la nube) se apliquen al sistema operativo.  Luego, elimine este daw lejos del pecado, para no restablecer accidentalmente la configuraci√≥n del sistema operativo: SID, contrase√±a de administrador, etc. <br><br><img src="https://habrastorage.org/webt/dy/hz/s_/dyhzs_p9kbutwrafz3pkw2hwufc.png"><br><br>  Por supuesto, todo lo anterior es una imagen simplificada, las palabras "capit√°n O" y, en general, "todav√≠a lo s√©".  Pero, como muestra la pr√°ctica, m√°s del 70% de las m√°quinas virtuales en la nube contienen uno o varios errores descritos. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/472814/">https://habr.com/ru/post/472814/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../472796/index.html">YES retrocede FAANG * o [gu√≠a pr√°ctica] en la b√∫squeda de empleo en EE. UU. / Europa para un especialista en TI</a></li>
<li><a href="../472798/index.html">Mapas de Yandex para la aplicaci√≥n de Taxi</a></li>
<li><a href="../472802/index.html">MIRO es una plataforma abierta de robot de interior. Parte 2 - Dise√±o de robot</a></li>
<li><a href="../472810/index.html">Para el administrador del sistema principiante: c√≥mo hacer que el orden salga del caos</a></li>
<li><a href="../472812/index.html">¬øSe "apaga" el servidor si la prueba de humo del centro de datos "se incendi√≥"?</a></li>
<li><a href="../472816/index.html">Patrones elegantes en JavaScript moderno (ciclo de equipo de Bill Sourour)</a></li>
<li><a href="../472818/index.html">Movimiento colectivo: c√≥mo estudiaron los corchos de hormigas</a></li>
<li><a href="../472822/index.html">Cuando la Academia de Ciencias de Rusia no tiene poder</a></li>
<li><a href="../472826/index.html">Microinteracciones y su uso en interfaces de usuario</a></li>
<li><a href="../472830/index.html">C√≥mo escribir c√≥digo f√°cil de describir</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>