<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§òüèª ‚öïÔ∏è üë®üèº‚Äçü§ù‚Äçüë®üèª VMware NSX para o menor. Parte 6. Configura√ß√£o da VPN ‚úã üêº ü•ã</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Parte I Introdut√≥rio 
 Parte Dois Configurar regras de firewall e NAT 
 Parte tr√™s. Configura√ß√£o DHCP 
 Parte Quatro Configura√ß√£o de roteamento 
 Part...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>VMware NSX para o menor. Parte 6. Configura√ß√£o da VPN</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dataline/blog/454004/"><img src="https://habrastorage.org/webt/wq/yu/qy/wqyuqynprr8iaabtcn7nhbkqkje.png"><br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Parte I</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Introdut√≥rio</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Parte Dois</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Configurar regras de firewall e NAT</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Parte tr√™s.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Configura√ß√£o DHCP</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Parte Quatro</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Configura√ß√£o de roteamento</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Parte Cinco</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Configurando um Balanceador de Carga</a> <br><br>  Hoje, examinamos as op√ß√µes de configura√ß√£o de VPN que o NSX Edge nos oferece. <br><br>  Em geral, podemos dividir as tecnologias VPN em dois tipos principais: <br><br><ul><li>  <b>VPN site a site.</b>  Na maioria das vezes, o IPSec √© usado para criar um t√∫nel seguro, por exemplo, entre a rede do escrit√≥rio principal e a rede em um site remoto ou na nuvem. <br></li><li>  <b>VPN de acesso remoto.</b>  √â usado para conectar usu√°rios individuais a redes privadas de organiza√ß√µes usando o software cliente VPN. </li></ul><br>  O NSX Edge nos permite usar as duas op√ß√µes. <br>  Vamos configurar usando um banco de testes com dois NSX Edge, um servidor Linux com o daemon de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">guaxinim</a> instalado e um laptop Windows para testar a VPN de acesso remoto. <a name="habracut"></a><br><br><h3>  IPsec </h3><br><ol><li>  Na interface do vCloud Director, v√° para a se√ß√£o Administra√ß√£o e selecione vDC.  Na guia Edge Gateways, selecione o Edge de que precisamos, clique com o bot√£o direito do mouse e selecione Edge Gateway Services. <br><img src="https://habrastorage.org/webt/gx/g_/7s/gxg_7s4odqm4vy8lgxitl79ahtu.png"></li><li>  Na interface do NSX Edge, v√° para a guia VPN VPN-IPsec, v√° para a se√ß√£o Sites VPN IPsec e clique em + para adicionar um novo site. <br><br><img src="https://habrastorage.org/webt/9w/kw/yz/9wkwyzxy6fwv6mm6tiw30juuemc.png"></li><li>  Preencha os campos obrigat√≥rios: <br><ul><li>  <b>Ativado</b> - ativa o site remoto. </li><li>  <b>PFS</b> - garante que todas as novas chaves criptogr√°ficas n√£o estejam associadas a nenhuma chave anterior. </li><li>  <b>Local ID e Local Endpoin</b> t s√£o o endere√ßo externo do NSX Edge. </li><li>  <b>Sub-rede local</b> s - Redes locais que usar√£o a VPN IPsec. </li><li>  <b>ID de ponto e ponto final de ponto</b> - endere√ßo do site remoto. </li><li>  <b>Sub</b> -redes de mesmo n√≠vel - redes que usar√£o a VPN IPsec no lado remoto. </li><li>  <b>Algoritmo de criptografia</b> - algoritmo de criptografia de t√∫nel. </li></ul><br><img src="https://habrastorage.org/webt/fr/2h/af/fr2haf6yil98f0e9p2tpjpsdlu8.png"><br><br><ul><li>  <b>Autentica√ß√£o</b> - como autenticaremos um banquete.  Voc√™ pode usar uma chave pr√©-compartilhada ou um certificado. </li><li>  <b>Chave pr√©-compartilhada</b> - especifique a chave que ser√° usada para autentica√ß√£o e deve corresponder nos dois lados. </li><li>  <b>Grupo Diffie-Hellman</b> - algoritmo de troca de chaves. </li></ul><br>  Ap√≥s preencher os campos obrigat√≥rios, clique em Manter. <br><br><img src="https://habrastorage.org/webt/k9/yd/nk/k9ydnkf0ncd8dqajktdkux1wc58.png"></li><li>  Feito. <br><br><img src="https://habrastorage.org/webt/z9/ij/ot/z9ijot3wthx7dklptivvra-8pws.png"></li><li>  Ap√≥s adicionar o site, v√° para a guia Status da Ativa√ß√£o e ative o Servi√ßo IPsec. <br><br><img src="https://habrastorage.org/webt/p9/oc/la/p9oclawmegzrekhuxslid1cvnzu.png"></li><li>  Ap√≥s as configura√ß√µes serem aplicadas, v√° para a guia Estat√≠sticas -&gt; IPsec VPN e verifique o status do t√∫nel.  Vemos que o t√∫nel subiu. <br><br><img src="https://habrastorage.org/webt/fn/ai/fm/fnaifmaxtxbfs-sumd9t5xyfhn0.png"></li><li>  Verifique o status do encapsulamento no console do gateway Edge: <br><ul><li>  show service ipsec - verifique o status do servi√ßo. <br><br><img src="https://habrastorage.org/webt/tu/sv/_y/tusv_yq3-jzm_bavjx_fefpv_d0.png"></li><li>  show service ipsec site - informa√ß√µes sobre o estado do site e os par√¢metros acordados. <br><br><img src="https://habrastorage.org/webt/ct/ex/j0/ctexj0sypvimdsgyaogvob0rx1w.png"></li><li>  show service ipsec sa - Verifica√ß√£o de status da Security Association (SA). <br><br><img src="https://habrastorage.org/webt/m2/of/ng/m2ofnggyimplhfnlvfvnec_yawa.png"></li></ul></li><li>  Verifica√ß√£o de conectividade do site remoto: <br><br><pre><code class="plaintext hljs">root@racoon:~# ifconfig eth0:1 | grep inet inet 10.255.255.1 netmask 255.255.255.0 broadcast 0.0.0.0 root@racoon:~# ping -c1 -I 10.255.255.1 192.168.0.10 PING 192.168.0.10 (192.168.0.10) from 10.255.255.1 : 56(84) bytes of data. 64 bytes from 192.168.0.10: icmp_seq=1 ttl=63 time=59.9 ms --- 192.168.0.10 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 59.941/59.941/59.941/0.000 ms</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Arquivos de configura√ß√£o e comandos de diagn√≥stico adicionais do servidor Linux remoto:</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">root@racoon:~# cat /etc/racoon/racoon.conf log debug; path pre_shared_key "/etc/racoon/psk.txt"; path certificate "/etc/racoon/certs"; listen { isakmp 80.211.43.73 [500]; strict_address; } remote 185.148.83.16 { exchange_mode main,aggressive; proposal { encryption_algorithm aes256; hash_algorithm sha1; authentication_method pre_shared_key; dh_group modp1536; } generate_policy on; } sainfo address 10.255.255.0/24 any address 192.168.0.0/24 any { encryption_algorithm aes256; authentication_algorithm hmac_sha1; compression_algorithm deflate; } === root@racoon:~# cat /etc/racoon/psk.txt 185.148.83.16 testkey === root@racoon:~# cat /etc/ipsec-tools.conf #!/usr/sbin/setkey -f flush; spdflush; spdadd 192.168.0.0/24 10.255.255.0/24 any -P in ipsec esp/tunnel/185.148.83.16-80.211.43.73/require; spdadd 10.255.255.0/24 192.168.0.0/24 any -P out ipsec esp/tunnel/80.211.43.73-185.148.83.16/require; === root@racoon:~# racoonctl show-sa isakmp Destination Cookies Created 185.148.83.16.500 2088977aceb1b512:a4c470cb8f9d57e9 2019-05-22 13:46:13 === root@racoon:~# racoonctl show-sa esp 80.211.43.73 185.148.83.16 esp mode=tunnel spi=1646662778(0x6226147a) reqid=0(0x00000000) E: aes-cbc 00064df4 454d14bc 9444b428 00e2296e c7bb1e03 06937597 1e522ce0 641e704d A: hmac-sha1 aa9e7cd7 51653621 67b3b2e9 64818de5 df848792 seq=0x00000000 replay=4 flags=0x00000000 state=mature created: May 22 13:46:13 2019 current: May 22 14:07:43 2019 diff: 1290(s) hard: 3600(s) soft: 2880(s) last: May 22 13:46:13 2019 hard: 0(s) soft: 0(s) current: 72240(bytes) hard: 0(bytes) soft: 0(bytes) allocated: 860 hard: 0 soft: 0 sadb_seq=1 pid=7739 refcnt=0 185.148.83.16 80.211.43.73 esp mode=tunnel spi=88535449(0x0546f199) reqid=0(0x00000000) E: aes-cbc c812505a 9c30515e 9edc8c4a b3393125 ade4c320 9bde04f0 94e7ba9d 28e61044 A: hmac-sha1 cd9d6f6e 06dbcd6d da4d14f8 6d1a6239 38589878 seq=0x00000000 replay=4 flags=0x00000000 state=mature created: May 22 13:46:13 2019 current: May 22 14:07:43 2019 diff: 1290(s) hard: 3600(s) soft: 2880(s) last: May 22 13:46:13 2019 hard: 0(s) soft: 0(s) current: 72240(bytes) hard: 0(bytes) soft: 0(bytes) allocated: 860 hard: 0 soft: 0 sadb_seq=0 pid=7739 refcnt=0</code> </pre> <br></div></div></li><li>  Tudo est√° pronto, a VPN IPsec site a site est√° configurada e funcionando. <br><br>  Neste exemplo, usamos o PSK para autenticar o par, mas tamb√©m √© poss√≠vel uma op√ß√£o de autentica√ß√£o de certificado.  Para fazer isso, v√° para a guia Configura√ß√£o global, ative a autentica√ß√£o de certificado e selecione o pr√≥prio certificado. <br><br>  Al√©m disso, nas configura√ß√µes do site, ser√° necess√°rio alterar o m√©todo de autentica√ß√£o. <br><br><img src="https://habrastorage.org/webt/gv/x0/e8/gvx0e80ogisdslhrxbvcwci54gq.png"><br><br><img src="https://habrastorage.org/webt/uj/uf/xh/ujufxh2n4da4fcfb1hsrnlppv3w.png"><br><br>  Observo que o n√∫mero de t√∫neis IPsec depende do tamanho do Edge Gateway implantado (leia sobre isso em nosso <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">primeiro artigo</a> ). <br><br><img src="https://habrastorage.org/webt/bf/sq/rv/bfsqrvatekltpr2xy1wx4b35t-q.png"></li></ol><br><h3>  VPN SSL </h3><br>  SSL VPN-Plus √© uma das op√ß√µes para VPN de acesso remoto.  Ele permite que usu√°rios remotos individuais se conectem com seguran√ßa a redes privadas atr√°s do gateway do NSX Edge.  Um t√∫nel criptografado SSL VPN-plus √© estabelecido entre o cliente (Windows, Linux, Mac) e o NSX Edge. <br><br><ol><li>  Vamos configurar.  No painel de controle do servi√ßo Edge Gateway, v√° para a guia SSL VPN-Plus e, em seguida, para Configura√ß√µes do servidor.  Selecionamos o endere√ßo e a porta na qual o servidor escutar√° as conex√µes recebidas, ativamos o log e selecionamos os algoritmos de criptografia necess√°rios. <br><br><img src="https://habrastorage.org/webt/o4/nt/hq/o4nthq3cjj_sh1pwpz-5bm0q1oo.png"><br><br>  Aqui voc√™ pode alterar o certificado que o servidor usar√°. <br><br><img src="https://habrastorage.org/webt/ij/ep/eg/ijepegloixlveu3aa9juqhuegzg.png"></li><li>  Depois que tudo estiver pronto, ligue o servidor e n√£o esque√ßa de salvar as configura√ß√µes. <br><br><img src="https://habrastorage.org/webt/ml/dz/pj/mldzpjn23fhhyljhr7zlre9tdcm.png"></li><li>  Em seguida, precisamos configurar o pool de endere√ßos que emitiremos para os clientes quando conectados.  Essa rede √© separada de qualquer sub-rede existente no seu ambiente NSX, n√£o precisa ser configurada em outros dispositivos em redes f√≠sicas, exceto nas rotas que apontam para ela. <br><br>  V√° para a guia Pools de IPs e clique em +. <br><br><img src="https://habrastorage.org/webt/vb/yx/4x/vbyx4xh7xvbp4aacm0_dsrx4lau.png"></li><li>  Escolha endere√ßos, m√°scara de sub-rede e gateway.  Aqui voc√™ pode alterar as configura√ß√µes dos servidores DNS e WINS. <br><br><img src="https://habrastorage.org/webt/fy/s4/un/fys4unlo2c_-ees8uduwgw--_oa.png"></li><li>  O pool resultante. <br><br><img src="https://habrastorage.org/webt/2n/7_/lr/2n7_lrsb5jjtgi9o8vgbkrijck4.png"></li><li>  Agora adicione as redes √†s quais os usu√°rios que se conectam √† VPN ter√£o acesso.  V√° para a guia Redes privadas e clique em +. <br><br><img src="https://habrastorage.org/webt/cp/xj/c5/cpxjc55glum1i7qbultrqxeelwq.png"></li><li>  N√≥s preenchemos: <br><br><ul><li>  Rede - uma rede local √† qual os usu√°rios remotos ter√£o acesso. </li><li>  Enviar tr√°fego, ele tem duas op√ß√µes: <br>  - sobre t√∫nel - envia tr√°fego para a rede atrav√©s do t√∫nel, <br>  - desvio de t√∫nel - envia tr√°fego para a rede ignorando diretamente o t√∫nel. </li><li>  Ativar otimiza√ß√£o TCP - marque se a op√ß√£o Over Tunnel estiver selecionada.  Quando a otimiza√ß√£o est√° ativada, voc√™ pode especificar os n√∫meros de porta para os quais deseja otimizar o tr√°fego.  O tr√°fego para as portas restantes dessa rede espec√≠fica n√£o ser√° otimizado.  Se os n√∫meros de porta n√£o forem especificados, o tr√°fego para todas as portas ser√° otimizado.  Leia mais sobre esse recurso <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> . </li></ul><br><img src="https://habrastorage.org/webt/6z/pm/c7/6zpmc7-cic6jlregwi2ylyt9apu.png"></li><li>  Em seguida, v√° para a guia Autentica√ß√£o e clique em +.  Para autentica√ß√£o, usaremos um servidor local no pr√≥prio NSX Edge. <br><br><img src="https://habrastorage.org/webt/aq/kx/bp/aqkxbp8ux9csyx2bui2o5hxdtjc.png"></li><li>  Aqui, podemos escolher pol√≠ticas para gerar novas senhas e configurar op√ß√µes para bloquear contas de usu√°rio (por exemplo, o n√∫mero de tentativas quando a senha √© inserida incorretamente). <br><br><img src="https://habrastorage.org/webt/oz/gd/mi/ozgdmimubqauqwo6gymipuvv8va.png"><br><br><img src="https://habrastorage.org/webt/cp/6n/fl/cp6nflis843n8edmtjimkmk2gdo.png"></li><li>  Como usamos a autentica√ß√£o local, precisamos criar usu√°rios. <br><br><img src="https://habrastorage.org/webt/sb/ui/kt/sbuikttq8ew3bu8rhqt4kpiq7ho.png"></li><li>  Al√©m de coisas b√°sicas como nome e senha, aqui voc√™ pode, por exemplo, impedir que o usu√°rio altere a senha ou, inversamente, for√ß√°-lo a alterar a senha no pr√≥ximo login. <br><br><img src="https://habrastorage.org/webt/ki/am/qw/kiamqwt8jphlg5f0b_b2ifa4-wy.png"></li><li>  Ap√≥s a adi√ß√£o de todos os usu√°rios necess√°rios, v√° para a guia Pacotes de instala√ß√£o, clique em + e crie o pr√≥prio instalador, que far√° o download do funcion√°rio remoto para instala√ß√£o. <br><br><img src="https://habrastorage.org/webt/wg/js/4t/wgjs4tj0efxxlrj9mcpu-gql2z4.png"></li><li>  Clique em +.  Selecionamos o endere√ßo e a porta do servidor ao qual o cliente se conectar√° e as plataformas para as quais voc√™ deseja gerar o pacote de instala√ß√£o. <br><br><img src="https://habrastorage.org/webt/gd/sx/i4/gdsxi44atfhzs0yh-wcv8gooqp8.png"><br><br>  Voc√™ pode especificar as configura√ß√µes do cliente para Windows abaixo nesta janela.  Escolha: <br><br><ul><li>  iniciar cliente no logon - o cliente VPN ser√° adicionado √† inicializa√ß√£o em uma m√°quina remota; </li><li>  criar √≠cone da √°rea de trabalho - criar√° um √≠cone do cliente VPN na √°rea de trabalho; </li><li>  valida√ß√£o do certificado de seguran√ßa do servidor - validar√° o certificado do servidor na conex√£o. <br>  A configura√ß√£o do servidor est√° conclu√≠da. </li></ul><br><img src="https://habrastorage.org/webt/7j/po/ia/7jpoiawbsxmetmvijnvnvtu7mfm.png"></li><li>  Agora baixe o pacote de instala√ß√£o que criamos na √∫ltima etapa no PC remoto.  Ao configurar o servidor, especificamos seu endere√ßo externo (185.148.83.16) e a porta (445).  √â neste endere√ßo que precisamos acessar o navegador da web.  No meu caso, s√£o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">185.148.83.16</a> : 445. <br><br>  Na janela de autoriza√ß√£o, voc√™ deve inserir as credenciais do usu√°rio que criamos anteriormente. <br><br><img src="https://habrastorage.org/webt/w6/5t/b3/w65tb3thu0i3yvh2wkp0dq5enc4.png"></li><li>  Ap√≥s a autoriza√ß√£o, vemos uma lista dos pacotes de instala√ß√£o criados dispon√≠veis para download.  Criamos apenas um - e fa√ßa o download. <br><br><img src="https://habrastorage.org/webt/62/_m/af/62_mafqhlxpqpqa3wrq5g_9gpvo.png"></li><li>  Clicamos no link, o download do cliente come√ßa. <br><br><img src="https://habrastorage.org/webt/du/1n/th/du1nth1rhphihfhpctp1hmnk1es.png"></li><li>  Descompacte o arquivo baixado e execute o instalador. <br><br><img src="https://habrastorage.org/webt/np/bs/69/npbs69o4arrddkvwqxrvomnn5l0.png"></li><li>  Ap√≥s a instala√ß√£o, execute o cliente, na janela de autoriza√ß√£o, clique em Login. <br><br><img src="https://habrastorage.org/webt/og/lq/uc/oglqucpuesvmhe8tj9kphxxeqdk.png"></li><li>  Na janela de verifica√ß√£o de certificado, selecione Sim. <br><br><img src="https://habrastorage.org/webt/nf/m3/da/nfm3dacakvoreocayzwrmacmjoa.png"></li><li>  N√≥s inserimos as credenciais para o usu√°rio criado anteriormente e vemos que a conex√£o foi conclu√≠da com sucesso. <br><br><img src="https://habrastorage.org/webt/zz/ot/_r/zzot_riaf24alcpw2cmobskcl0c.png"><br><br><img src="https://habrastorage.org/webt/yq/d5/dz/yqd5dzwb3yarbdaqidoxk-g2l2a.png"></li><li>  Verifique as estat√≠sticas do cliente VPN no computador local. <br><br><img src="https://habrastorage.org/webt/mf/qi/yi/mfqiyi-qzvx7_aiyptg-jb7yocy.jpeg"><br><br><img src="https://habrastorage.org/webt/qv/no/fr/qvnofrg8hclsrdjrp1lo-pdkdom.jpeg"></li><li>  Na linha de comando do Windows (ipconfig / all), vemos que um adaptador virtual adicional apareceu e h√° conectividade com a rede remota, tudo funciona: <br><br><img src="https://habrastorage.org/webt/01/hf/5t/01hf5tzh6ej5o-6pq8a4wkms2dq.jpeg"><br><br><img src="https://habrastorage.org/webt/qb/km/he/qbkmhe0m1q1hfrhlceovxla3ldw.png"></li><li>  E finalmente - uma verifica√ß√£o no console do Edge Gateway. <br><br><img src="https://habrastorage.org/webt/2e/ot/wr/2eotwriama_etzynpyasqcimg2k.png"></li></ol><br><h3>  VPN L2 </h3><br>  O L2VPN √© necess√°rio quando voc√™ precisa combinar v√°rios <br>  redes distribu√≠das em um dom√≠nio de broadcast. <br><br>  Isso pode ser √∫til, por exemplo, ao migrar uma m√°quina virtual: quando uma VM √© movida para outro site geogr√°fico, a m√°quina salva as configura√ß√µes de endere√ßamento IP e n√£o perde a conectividade com outras m√°quinas localizadas no mesmo dom√≠nio L2. <br><br>  Em nosso ambiente de teste, conectaremos dois sites, chamaremos de A e B. respectivamente.Temos duas redes roteadas NSX e duas criadas de forma id√™ntica conectadas a um Edge diferente.  A m√°quina A tem o endere√ßo 10.10.10.250/24, a m√°quina B tem o endere√ßo 10.10.10.2/24. <br><br><ol><li>  No vCloud Director, v√° para a guia Administra√ß√£o, para o VDC necess√°rio, v√° para a guia Org VDC Networks e adicione duas novas redes. <br><br><img src="https://habrastorage.org/webt/jh/8x/oa/jh8xoarvrbmyd0cexp1forwc5fo.png"></li><li>  Selecionamos o tipo de rede roteada e ligamos essa rede ao nosso NSX.  Colocamos a caixa de sele√ß√£o Criar como subinterface. <br><br><img src="https://habrastorage.org/webt/ke/fa/gp/kefagptrkwzznjydhktrom9g2ww.png"></li><li>  Como resultado, devemos obter duas redes.  No nosso exemplo, eles s√£o chamados de rede-ae rede-b com as mesmas configura√ß√µes de gateway e a mesma m√°scara. <br><br><img src="https://habrastorage.org/webt/s2/fs/m0/s2fsm0dcmiqyrka4acercwf26ww.png"><br><br><img src="https://habrastorage.org/webt/ev/mr/k8/evmrk8fmiyzemartcv_hjakdhus.png"></li><li>  Agora vamos para as configura√ß√µes do primeiro NSX.  Esse ser√° o NSX ao qual a rede A. est√° conectada e atuar√° como um servidor. <br><br>  Volte para a interface do NSx Edge / V√° para a guia VPN -&gt; L2VPN.  Ativamos o L2VPN, selecione o modo de opera√ß√£o do servidor, nas configura√ß√µes globais do servidor, especifique o endere√ßo IP externo do NSX, no qual a porta do t√∫nel ser√° ouvida.  Por padr√£o, o soquete ser√° aberto na porta 443, mas pode ser alterado.  N√£o esque√ßa de escolher as configura√ß√µes de criptografia para o futuro t√∫nel. <br><br><img src="https://habrastorage.org/webt/5s/cp/yl/5scpylcprxcu_wmgtvgwxqi3bv0.png"></li><li>  V√° para a guia Sites do servidor e adicione um banquete. <br><br><img src="https://habrastorage.org/webt/9u/az/bm/9uazbmzmfihywslasekwqmrhm1o.png"></li><li>  Ligue o banquete, defina o nome, a descri√ß√£o, se necess√°rio, defina o nome de usu√°rio e a senha.  Mais tarde, precisaremos desses dados ao configurar o site do cliente. <br><br>  No Endere√ßo do gateway de otimiza√ß√£o de sa√≠da, defina o endere√ßo do gateway.  Isso √© necess√°rio para que n√£o haja conflito de endere√ßos IP, porque o gateway em nossas redes tem o mesmo endere√ßo.  Em seguida, pressionamos o bot√£o SELECT SUB-INTERFACES. <br><br><img src="https://habrastorage.org/webt/lh/y8/t2/lhy8t2pxycomacepgel1vess6jy.png"></li><li>  Aqui n√≥s selecionamos a subinterface desejada.  Salve as configura√ß√µes. <br><br><img src="https://habrastorage.org/webt/_o/hn/3l/_ohn3lperjba15rifdy6yyzvk0u.png"></li><li>  Vimos que o site do cliente rec√©m-criado apareceu nas configura√ß√µes. <br><br><img src="https://habrastorage.org/webt/sd/p_/lf/sdp_lf6amh08k9aexlsxl724ioc.png"></li><li>  Agora, vamos configurar o NSX no lado do cliente. <br><br>  Vamos para o lado B do NSX, vamos para VPN -&gt; L2VPN, ativamos o L2VPN, configuramos o modo L2VPN para o modo cliente.  Na guia Global do cliente, defina o endere√ßo e a porta do NSX A, que indicamos anteriormente como IP e porta de escuta no lado do servidor.  Tamb√©m √© necess√°rio definir as mesmas configura√ß√µes de criptografia para que sejam consistentes ao elevar o t√∫nel. <br><br><img src="https://habrastorage.org/webt/wn/yx/ug/wnyxug_ioltwju3lcqh-fzqk2sy.png"><br><br>  Role para baixo, selecione a subinterface atrav√©s da qual o t√∫nel para L2VPN ser√° constru√≠do. <br>  No Endere√ßo do gateway de otimiza√ß√£o de sa√≠da, defina o endere√ßo do gateway.  Defina o ID do usu√°rio e a senha.  Selecionamos a subinterface e n√£o esquecemos de salvar as configura√ß√µes. <br><br><img src="https://habrastorage.org/webt/bi/bf/qj/bibfqjjaw-s5rridzyz_vxtb_ng.png"></li><li>  Isso √© tudo, na verdade.  As configura√ß√µes do cliente e do servidor s√£o quase id√™nticas, com exce√ß√£o de algumas nuances. </li><li>  Agora podemos ver o que nosso t√∫nel ganhou, acessando Estat√≠sticas -&gt; L2VPN em qualquer NSX. <br><br><img src="https://habrastorage.org/webt/dj/uj/iu/djujiuzlvgswhq1osmpajodl4fe.png"></li><li>  Se formos para o console de qualquer Edge Gateway agora, veremos os endere√ßos das duas VMs em cada uma delas na tabela arp. <br><br><img src="https://habrastorage.org/webt/uy/si/r8/uysir84foday_fr6xip0tku5sca.png"></li></ol><br><br>  Isso √© tudo sobre VPN no NSX Edge.  Pergunte se algo n√£o est√° claro.  Esta √© tamb√©m a √∫ltima parte de uma s√©rie de artigos sobre como trabalhar com o NSX Edge.  Esperamos que tenham sido √∫teis :) </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt454004/">https://habr.com/ru/post/pt454004/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt453994/index.html">Badoo Techleads Meetup # 4. Burnout profissional e motiva√ß√£o</a></li>
<li><a href="../pt453996/index.html">Uhhhhhh. Como vender na Internet sem um site</a></li>
<li><a href="../pt453998/index.html">Aeroexpress: v√° para o dep√≥sito</a></li>
<li><a href="../pt454000/index.html">O SORRISO N√ÉO √â LASIK. Sobre a corre√ß√£o da vis√£o a laser</a></li>
<li><a href="../pt454002/index.html">Experi√™ncia: Como mascarar o Tor usando para ignorar bloqueios</a></li>
<li><a href="../pt454006/index.html">Sobre TI sem v√≠nculos: promo√ß√µes, reten√ß√£o e rotatividade em empresas da CEI e EUA</a></li>
<li><a href="../pt454010/index.html">Educa√ß√£o superior e continuada em TI: resultados do estudo My Circle</a></li>
<li><a href="../pt454012/index.html">O fim da era dos dispositivos de reparo. Como Apple e Amazon limpam antigos comerciantes de eletr√¥nicos</a></li>
<li><a href="../pt454016/index.html">3CX v16 Atualiza√ß√£o 1, aplicativo 3CX para iOS Beta e a nova vers√£o 3CX Call Flow Designer</a></li>
<li><a href="../pt454018/index.html">iOS Digest No. 6 (17 a 30 de maio)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>