<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üÖ∞Ô∏è üïâÔ∏è ‚úçÔ∏è Pendule √† coucou bas√©e sur Lego Mindstorms üå©Ô∏è üèë üëåüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Il y a deux ans et demi, j'ai achet√© le kit Lego Mindstorms EV3 pour faire mes premiers pas en robotique. Apr√®s avoir roul√© l'assemblage ev3dev sur le...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Pendule √† coucou bas√©e sur Lego Mindstorms</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/417255/">  Il y a deux ans et demi, j'ai achet√© le kit Lego Mindstorms EV3 pour faire mes premiers pas en robotique.  Apr√®s avoir roul√© l'assemblage ev3dev sur le contr√¥leur et jou√© suffisamment avec le moteur SSH et le contr√¥le du capteur, j'ai refroidi pour un achat pendant deux ans.  La raison en √©tait que je n'avais pas assez d'imagination pour le rendre possible: apr√®s plusieurs mod√®les assembl√©s de Lego Technics (√† la fois en bo√Æte et faits maison), j'√©tais d√©j√† habitu√© √† des miracles comme des jouets t√©l√©command√©s et de simples robots comme <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">les mod√®les de Lego</a> pr√©sent√©s √† l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">exposition de Cracovie,</a> comme une personne qui travaillait sur un syst√®me de t√©l√©m√©canique, n'inspiraient plus assez d'inspiration.  Je ne voulais pas vraiment r√©p√©ter l'exp√©rience d'un autre. <br><br>  En fin de compte, cela m'est apparu: une horloge √† coucou pouvait devenir un mod√®le assez complexe, int√©ressant, pratique et pas trop galvaud√©.  Inspir√© par cette id√©e, je me suis mis au travail. <br><a name="habracut"></a><br>  Selon mon id√©e, le mod√®le devait devenir non seulement un jouet, mais un appareil enti√®rement fonctionnel.  C'√©tait tout √† fait possible: l'horloge est accroch√©e √† mon mur et affiche l'heure actuelle en mode 24/7.  Je ne me suis pas donn√© pour t√¢che de reproduire le m√©canisme de l'original dans tous les d√©tails - par exemple, les fl√®ches sont ind√©pendantes, le son est reproduit via le haut-parleur du contr√¥leur, et les poids et le pendule sont utilis√©s exclusivement pour l'environnement.  Ayant donc transf√©r√© tout le travail principal √† la partie logicielle, j'ai assembl√© le m√©canisme dans la version la plus simple possible.  Je n'ai pas document√© l'ensemble du processus d'assemblage, je ne peux donc pas r√©assembler le mod√®le sous la m√™me forme;  N√©anmoins, les principes de base de l'association des logiciels et de la m√©canique sont tels que le programme devrait fonctionner avec des modifications minimes sur d'autres mod√®les assembl√©s selon un principe similaire. <br><br>  Des montres sous diff√©rentes formes sont pr√©sent√©es dans la vid√©o que j'ai post√©e sur Youtube: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/rCxNfV3xOM0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Des informations de base sur le mod√®le sont pr√©sent√©es dans la vid√©o.  Ci-dessous, je vais vous parler un peu plus en d√©tail de la m√©canique, du logiciel, ainsi que des probl√®mes survenus lors du montage et du fonctionnement de cette conception. <br><br><h2>  La m√©canique </h2><br>  L'assemblage de la partie m√©canique a pris 6 jours.  Apr√®s avoir dispos√© les bo√Ætes Lego sur la table, pendant les vacances du Nouvel An, j'ai assembl√© un m√©canisme qui ne diff√®re de la version finale que dans les portes derri√®re lesquelles vit le coucou (voir ci-dessous).  Je n'ai pas de comp√©tences particuli√®res en conception, donc la montre est une bo√Æte rectangulaire √† deux aiguilles et un cadran marqu√© de points sur le devant.  Dans la partie sup√©rieure de la montre, un compartiment ferm√© par deux portes, dans lequel le coucou s'est install√©, et dans la partie inf√©rieure, un pendule sch√©matique et deux poids.  Les pi√®ces ont √©t√© prises de plusieurs ensembles Lego: un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Lego Mindstorms EV3 (31313)</a> , deux <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">niveleuses Volvo (42030)</a> , un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">camion Mercedes avec une fl√®che pneumatique (42043)</a> et un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">camion-grue (42009)</a> .  Malgr√© l'abondance d'ensembles, il y avait √† peine assez de d√©tails pour un mod√®le de cette taille - le couvercle de la montre est assembl√© √† partir de bandes de diff√©rentes couleurs, ce qui, cependant, n'attire pas l'attention, car avec une installation murale, il est au-dessus du niveau des yeux. <br><br>  En tant qu'aiguille des minutes, la barre standard Lego Technics pour 15 unit√©s est utilis√©e.  Il est plac√© sur l'axe, le reliant fermement au moteur.  Ainsi, la pr√©cision du r√©glage de l'aiguille des minutes s'est av√©r√©e suffisante pour qu'elle puisse √™tre utilis√©e pour d√©terminer le temps pr√©cis en minutes.  L'aiguille des heures est plus courte et mont√©e sur un m√©canisme pivotant.  Il est connect√© au moteur par plusieurs engrenages, il y a donc un jeu assez sensible - cependant, pas assez grand pour causer des probl√®mes avec la d√©termination de l'heure. <br><br>  Les aiguilles sont entra√Æn√©es par deux gros moteurs (LM).  De plus, jumel√©e √† chacune des aiguilles externes, une autre fonctionne, celle interne - pour l'aiguille des minutes, elle est fix√©e sur le m√™me axe que la premi√®re, et pour l'horloge, le m√©canisme rotatif est dupliqu√© √† l'int√©rieur de la montre.  Le but des fl√®ches int√©rieures est d'appuyer sur le bouton (capteur tactile) tout en faisant passer les fl√®ches ext√©rieures en position haute.  Ainsi, le contr√¥leur a la capacit√© de d√©terminer la position des fl√®ches imm√©diatement apr√®s la mise sous tension et de d√©finir leur position correcte en fonction de l'heure du syst√®me, √©vitant √† l'utilisateur d'avoir √† saisir manuellement les fl√®ches. <br><br>  Les poids ont une fonction purement d√©corative.  Au d√©part, j'ai pens√© √† faire un poids, qui s'abaisserait lentement (comme dans une montre normale), puis remonterait rapidement en position haute (analogue au remontage manuel d'une pendule).  J'ai par la suite refus√© cette option pour plusieurs raisons.  Premi√®rement, le m√©canisme de commutation du rapport de transmission entre le moteur et le poids a ajout√© une complexit√© suppl√©mentaire au mod√®le (et l'entra√Ænement du pendule √† partir du m√™me moteur n'a fait que l'augmenter).  Deuxi√®mement, un eye-liner rapide, quoi que l'on puisse dire, sera une op√©ration bruyante, mais je voulais que la montre fonctionne aussi silencieusement que possible.  Troisi√®mement, dans un coucou conventionnel, il y a g√©n√©ralement deux poids (l'un fournit l'horloge, le second - le coucou), et placer imm√©diatement au bas de la montre deux roues pivotantes pour la cha√Æne entra√Ænerait une augmentation encore plus importante de la taille du mod√®le. <br><br>  Partant de l√†, j'ai pris un chemin plus simple: j'ai en fait install√© deux poids sur la montre, mais je les ai plac√©s sur un circuit commun projet√© sur une seule roue motrice.  Dans cette version, les poids se d√©placent toujours dans des directions anti-m√©t√©o, descendant √† leur tour.  Ce comportement n'a pas grand-chose √† voir avec les horloges √† pendule r√©elles, mais il semble assez int√©ressant. <br><br>  La cha√Æne est constitu√©e de garnitures ordinaires de trois unit√©s utilisant une combinaison d'axes et de pistons: un piston glissant est une pi√®ce assez rare, et j'ai utilis√© les axes pour doubler la longueur de la cha√Æne r√©sultante.  Ce n'√©tait pas si facile de fabriquer une roue qui d√©place une telle cha√Æne sans glissement ni panne, mais au final, c'√©tait possible. <br><br>  En ce qui concerne le changement de direction du mouvement des poids, ma premi√®re id√©e a √©t√© de le rendre purement m√©canique: lors du levage vers la paroi inf√©rieure du bo√Ætier de la montre, le grand axe mont√© directement au-dessus du poids appuie sur la plaque √† travers laquelle la cha√Æne est pass√©e et fait tourner la roue.  J'allais utiliser l'√©l√©ment de commutation de la m√™me mani√®re que, par exemple, la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">grue 42009</a> : la roue motrice, en mouvement, entre dans l'embrayage avec le voisin droit ou gauche.  Cette id√©e n'a cependant pas vol√©: le plateau de pression a amen√© la partie coulissante en position centrale lorsqu'elle n'√©tait engag√©e ni avec le voisin droit ni avec le voisin gauche, le couple a cess√© de venir √† la roue et l'interrupteur a gel√© en position centrale. <br><br>  Pour corriger cette situation, j'ai d√©cid√© d'ajouter un triangle mobile √† ce circuit, dont les deux c√¥t√©s auraient une longueur fixe, et le troisi√®me serait repr√©sent√© par une pi√®ce coulissante √† ressort utilis√©e dans la suspension de la m√™me grue de camion.  Le sens de cette conception √©tait que le triangle est toujours du c√¥t√© du panneau de pression qui correspond au poids de levage: lorsque le poids atteint le sommet, le panneau appuie sur le triangle, le ressort se comprime, le triangle passe par la position d'√©quilibre puis ¬´jette¬ª de l'autre c√¥t√©, lib√©rant √©nergie emmagasin√©e par une source.  Cette √©nergie, selon mon plan, √©tait cens√©e d√©placer le commutateur de vitesse dans la position d'√©quilibre, le traduisant imm√©diatement dans la position oppos√©e. <br><br>  Cependant, je n'ai pas r√©ussi √† stabiliser ce syst√®me.  Par la taille de l'horloge, vous pouvez comprendre que les m√©canismes miniatures ne sont pas mon truc, mais avec une augmentation de la taille du n≈ìud, les distorsions qui en r√©sultent entra√Ænent des frottements, qui consomment la plupart de l'√©nergie de commutation.  Apr√®s avoir √©t√© tourment√© par ce m√©canisme, j'ai finalement d√©cid√© de transf√©rer tout le sale boulot au microcontr√¥leur en installant un bouton au-dessus des panneaux poussoirs (capteur tactile) au lieu d'une m√©canique complexe. <br><br>  Un peu d'arithm√©tique simple.  L'EV3 poss√®de quatre entr√©es et quatre sorties.  Deux entr√©es et deux sorties √©taient d√©j√† occup√©es respectivement par des boutons et des moteurs fl√©ch√©s.  L'ajout √† ce circuit d'un moteur faisant tourner la roue √† cha√Æne et de deux boutons signifiait que, premi√®rement, je n'avais pas de ports libres pour connecter le capteur de position du coucou (je pensais utiliser un t√©l√©m√®tre optique √† cet effet), et deuxi√®mement, que les n≈ìuds restants (coucou et pendule) n'ont qu'un seul moteur.  J'ai envisag√© l'option o√π les deux panneaux poussoirs au-dessus des poids seraient connect√©s √† un bouton commun, mais je l'ai refus√©, car si au moment d'allumer l'horloge, l'un des poids serait en position sup√©rieure, en maintenant le bouton, la montre n'aurait pas assez d'informations pour s√©lectionner sens de d√©placement de la cha√Æne. <br><br>  Comme le pendule √©tait plus facile √† associer au m√©canisme de mouvement de la cha√Æne qu'au coucou (√† la fois en termes de nature de mouvement et d'emplacement), j'ai plac√© un autre gros moteur dans la partie inf√©rieure du corps, qui, tout d'abord, entra√Æne le pendule d'avant en arri√®re (1 r√©volution du moteur se traduit par une oscillation compl√®te du pendule), et d'autre part - gr√¢ce √† un r√©ducteur, la roue tourne, ce qui entra√Æne la cha√Æne.  Un tel syst√®me pr√©sente l'inconv√©nient qu'en inversant le sens de d√©placement de la cha√Æne et, par cons√©quent, la rotation du moteur, le pendule modifie √©galement le sens de d√©placement, m√™me s'il se trouve dans une position interm√©diaire, qui peut para√Ætre moche.  Cependant, changer la direction du mouvement des poids est une op√©ration assez rare, j'ai donc n√©glig√© ce probl√®me.  Un autre inconv√©nient de mon montage est le jeu plut√¥t rempla√ßable de l'entra√Ænement du pendule, c'est pourquoi lorsqu'il se d√©place lentement, le pendule s'arr√™te √† un point inf√©rieur pendant une fraction de seconde pour un ≈ìil perceptible.  J'√©tais trop paresseux pour r√©soudre ce probl√®me. <br><br>  En parlant de la vitesse du pendule.  Apr√®s l'avoir exp√©riment√©, j'ai choisi une valeur de 30 degr√©s du moteur par seconde.  Cela signifie que le pendule oscille compl√®tement en 12 secondes.  C'est beaucoup, cependant, avec l'augmentation de la vitesse, le moteur a commenc√© √† hurler, et la perspective d'√©couter continuellement sa chanson ne me sourit pas du tout.  C'√©tait trop paresseux pour passer par le m√©canisme et introduire un overdrive, j'ai donc opt√© pour un format aussi ¬´lunaire¬ª.  Les rapports de vitesse entre le moteur et la roue d'entra√Ænement de la cha√Æne sont tels que le poids passe de la position inf√©rieure √† la position sup√©rieure en 40 √† 50 minutes. <br><br>  Restant libre apr√®s toutes les manipulations pr√©c√©dentes, le port EV3 occupait le moteur central (moteur moyen), qui entra√Æne le coucou.  Le coucou lui-m√™me est assembl√© √† partir de parties des m√™mes techniques Lego.  En hauteur, l'oiseau atteint 11 unit√©s et est plac√© sur une barre r√©tractable (sur ceux-ci dans la grue de camion susmentionn√©e, des arr√™ts √† distance ont √©t√© plac√©s).  Un m√©canisme miniature introduit une transmission entre les ailes de l'oiseau et sa queue, √† travers laquelle j'ai jet√© un c√¢ble fix√© √† l'int√©rieur de la montre.  La longueur du c√¢ble est choisie de sorte que le coucou part compl√®tement avec ses ailes baiss√©es et seulement √† la toute fin du mouvement les √©carte l√©g√®rement.  Il s'est av√©r√© atmosph√©rique - juste au niveau de la m√©canisation de mod√®les de montres simples.  L‚Äôabsence de capteur de position est compens√©e par le fait que l‚Äôentra√Ænement du coucou est activ√© par le m√©canisme de glissement - il aide √† ne pas endommager le moteur, m√™me s‚Äôil essaie de d√©placer le coucou au-del√† des points limites.  Les portes sont √©troitement reli√©es √† la planche sur laquelle l'oiseau est fix√©, et s'ouvrent simultan√©ment avec le d√©part du coucou lui-m√™me. <br><br>  Au d√©part, j'ai utilis√© des panneaux 11 par 5 pour 1 unit√© comme portes, mais cela s'est av√©r√© √™tre une mauvaise id√©e: leurs bords n'√©taient pas arrondis et les portes, accroch√©es aux parties adjacentes, souvent bloqu√©es, laissant le coucou √† l'int√©rieur.  La vid√©o montre la deuxi√®me version de l'ensemble de porte - les garnitures ordinaires aux bords arrondis ne causent pas un tel probl√®me.  De plus, la version ¬´planche¬ª de la porte s'ouvre et se ferme beaucoup plus silencieusement. <br><br>  La montre est mont√©e sur un bracelet boulonn√© au mur.  L'ensemble de la structure p√®se plus d'un kilogramme. <br><br>  Sur cela, la description de la partie m√©canique se termine en principe.  Il ne reste plus qu'√† mentionner que le mod√®le est assembl√© √† 100% √† partir de Lego Mindstorms et Lego Technics, et la seule partie qui ne s'applique pas √† ces ensembles est le cordon d'alimentation, que j'ai soud√© √† mon EV3, de sorte que je n'ai pas eu √† changer les piles tout le temps.  Ce fil va √† l'alimentation branch√©e sur la prise. <br><br><h2>  Le programme </h2><br>  L'assemblage ev3dev fournit des liants pour de nombreux langages de programmation.  Afin de ne pas avoir de difficult√©s avec l'assemblage, j'ai d√©cid√© de me limiter √† un script Python.  Ce script est disponible <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">dans le r√©f√©rentiel GitLab</a> .  Ci-dessous, je passerai bri√®vement en revue ses fonctionnalit√©s. <br><br>  Le code qui d√©place les fl√®ches est relativement simple - il recalcule les minutes et les heures en degr√©s de rotation des moteurs en utilisant des donn√©es sur le nombre de degr√©s du moteur par tour de fl√®che et le d√©calage initial de la fl√®che par rapport √† la position verticale.  Tout le plaisir commence lorsque le programme essaie d'obtenir ces donn√©es. <br><br>  Comme je l'ai d√©j√† dit, il a √©t√© d√©cid√© d'abandonner la connexion manuelle du tireur.  Au lieu de cela, au d√©marrage, la montre effectue un √©talonnage en d√©terminant les param√®tres de g√©om√©trie.  L'√©talonnage est effectu√© pour les deux mains ind√©pendamment l'une de l'autre. <br><br>  L'algorithme d'√©talonnage est le suivant.  Tout d'abord, le moteur commence √† tourner √† une vitesse relativement √©lev√©e (j'utilise une valeur empirique de 180 degr√©s par seconde) jusqu'√† ce qu'un signal de confirmation vienne du bouton qui fixe la position sup√©rieure de la fl√®che.  Apr√®s cela, le moteur r√©initialise la vitesse √† 30 degr√©s par seconde et continue de faire tourner la fl√®che dans le sens des aiguilles d'une montre (le sens de rotation du moteur est cousu dans le programme) jusqu'√† ce qu'il soit s√©par√© de 70 degr√©s du point de la derni√®re ouverture du bouton.  Apr√®s cela, la fl√®che passe par la position sup√©rieure dans le sens oppos√©, fixant la premi√®re fermeture et la derni√®re ouverture des contacts (le bouton peut cliqueter dans les positions de bord).  S'√©loignant de la derni√®re ouverture des m√™mes 70 degr√©s, la fl√®che change √† nouveau la direction du mouvement en ligne droite, et la proc√©dure d'enregistrement du premier circuit et du dernier circuit est r√©p√©t√©e. <br><br>  On pense que la position sup√©rieure de la fl√®che correspond √† la moyenne arithm√©tique entre les quatre valeurs ainsi obtenues.  La pratique montre que cette approximation est assez bonne - l'√©cart de la position cible de l'aiguille des minutes par rapport √† la valeur r√©elle est rarement sup√©rieur √† 1 pas et ne d√©passe presque jamais deux pas.  (La vid√©o montre des √©carts plus importants en raison du fait que dans le but de la prise de vue, j'ai traduit l'heure du syst√®me et que les aiguilles se sont d√©plac√©es plus rapidement qu'en fonctionnement normal, ce qui augmente l'erreur de correction √† chaque tour, voir ci-dessous.) mais l'algorithme, bien s√ªr, utilise le m√™me. <br><br>  Apr√®s avoir calcul√© la position sup√©rieure de la fl√®che et la diff√©rence entre le premier allumage du capteur et en fait la position sup√©rieure de la fl√®che (cette valeur sera requise pour la correction, voir ci-dessous), l'algorithme d'√©talonnage augmente √† nouveau le r√©gime moteur √† 180 degr√©s par seconde et r√©p√®te la recherche de la position sup√©rieure.  La diff√©rence entre deux positions sup√©rieures cons√©cutives d√©termine la longueur d'un tour complet de la fl√®che en unit√©s de rotation du moteur.  La proc√©dure de recherche de position sup√©rieure est r√©p√©t√©e cinq fois, ce qui nous permet de faire la moyenne des valeurs obtenues et d'augmenter l√©g√®rement la pr√©cision. <br><br>  Une fois l'√©talonnage termin√©, les aiguilles passent au mode d'affichage de l'heure actuelle.  De plus, sur chaque cercle de la fl√®che, l'algorithme fixe la position de fermeture du disjoncteur.  La diff√©rence entre les angles de rotation r√©els et attendus du moteur √† ce moment est la quantit√© de correction;  Ainsi, m√™me si la longueur totale du cercle n'a pas √©t√© calcul√©e correctement au stade de l'√©talonnage (la sortie de d√©bogage montre que l'√©cart d√©passe rarement 1 degr√©), la correction sur chaque cercle ne permet pas √† la fl√®che de se d√©placer en raison de l'accumulation d'erreurs. <br><br>  Veuillez noter que la seule information sur le rapport du moteur et de la fl√®che, qui est explicitement cousue dans le programme, est le sens de rotation du moteur (avant ou arri√®re) correspondant au mouvement vers l'avant de la fl√®che.  Gr√¢ce aux capteurs de position, le besoin de donn√©es sur le rapport de vitesse et la position initiale de la fl√®che dispara√Æt.  Ainsi, si vous r√©cup√©rez une montre pour laquelle, en plus de l'heure et des minutes, une trotteuse sera √©galement pr√©sent√©e, l'algorithme vous permettra de l'utiliser en ajoutant seulement quelques lignes, sans perdre de temps √† compter les dents. <br><br>  Ce qui manque dans le programme de d√©placement des fl√®ches, c'est une protection contre le d√©bordement ou la perte de pr√©cision.  Je n'ai pas enqu√™t√© sur la question de ce qui se passera plus t√¥t: la profondeur de bits de l'angle de rotation du moteur d√©bordera ou les fl√®ches commenceront √† se d√©placer saccad√©es en raison du d√©part de la pr√©cision dans les chiffres sup√©rieurs du nombre √† virgule flottante.  Cependant, la pratique montre qu'√† des moments de l'ordre de plusieurs semaines, rien de tel ne se produit.  Si jamais je rencontre ce probl√®me, je vais probablement ajouter une commande de r√©initialisation du moteur √† chaque tour, avec la correction correspondante des angles dans le programme. <br><br>  Si la classe Hand de mon programme est responsable du mouvement des fl√®ches, alors la classe LedIndication s'allume, puis √©teint les LED du panneau avant de l'EV3.  Je sais que le m√™me effet peut √™tre obtenu avec une seule √©quipe, mais initialement cette fonctionnalit√© a √©t√© con√ßue pour suivre les plantages de programmes, puis elle est rest√©e.  Il n'y a rien de plus int√©ressant dans cette classe. <br><br>  La classe Pendule est responsable du mouvement des poids et d'un pendule.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'algorithme d√©marre simplement le moteur dans une direction et le fait tourner √† vitesse constante jusqu'√† ce que le bouton correspondant √† la lev√©e compl√®te de ce poids soit bloqu√©; apr√®s cela, le sens de d√©placement du moteur est invers√©. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans cette classe, en passant, la protection contre les plantages de programmes est pr√©sent√©e, ce qui consiste en ce que le moteur ne d√©marre que pendant 2 secondes avec une p√©riode de mise √† jour des commandes de 1 seconde. Si j'allumais le moteur en mode de rotation constante, puis lorsque le programme plantait, en appuyant sur le bouton, je continuerais √† monter, ce qui pourrait entra√Æner une surcharge du moteur, un glissement des vitesses ou m√™me des dommages au m√©canisme. La protection vous permet d'√©viter ce probl√®me.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enfin, la classe Cuckoo ex√©cute le coucou chaque fois qu'une valeur de 59 minutes est remplac√©e par une valeur de 0 minute. Tout d'abord, le coucou est pouss√© √† fond, puis le coucou une fois, reproduisant le son √† travers le haut-parleur EV3, puis se cachant √† nouveau dans le bo√Ætier de la montre. Le mouvement est r√©p√©t√© en fonction de l'heure actuelle - de 1 √† 12 fois. Le son a √©t√© extrait de la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">biblioth√®que gratuite FreeSound</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et modifi√© pour mieux sonner sur EV3. (Je ne peux pas dire que j'√©tais satisfait du r√©sultat, car la basse est presque inaudible lorsque le marteau est frapp√© au printemps.)</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le d√©lai entre la commande de suppression du coucou et la commande de reproduction du son est s√©lectionn√© exp√©rimentalement afin que le son soit entendu √† peu pr√®s au moment o√π le coucou atteint sa position extr√™me. Cependant, ev3dev a un l√©ger probl√®me: √† cause du chargement du syst√®me, le son est p√©riodiquement en retard, surtout s'il y a une connexion SSH √† l'horloge √† ce moment. Le d√©lai peut aller jusqu'√† plusieurs secondes. Je ne sais pas si c'est un probl√®me pour mon contr√¥leur, la construction elle-m√™me ou les mises √† jour re√ßues du r√©seau (apr√®s avoir install√© ev3dev, j'ai utilis√© par habitude la commande apt get upgrade, m√™me si je n'aurais probablement pas d√ª le faire), mais en moyenne, le coucou semble normal, donc Je ne vais pas d√©boguer cette question.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Soit dit en passant, un bug √©tait li√© au retard du son dans l'une des premi√®res versions du programme, alors que je n'avais pas encore ajout√© l'attente de la fin de la lecture: si le coucou a r√©ussi √† se cacher et √† r√©appara√Ætre pendant le temps de retard, le son suivant a √©t√© "aval√©" et le nombre de "coucous" n'a pas correspondu nombre d'heures. Plus tard, j'ai modifi√© le programme pour que le coucou s'attende √† ce que le son se termine dans la position extr√™me et qu'il ne soit ensuite parti que pour le cycle suivant. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les intervalles d'une demi-heure sont exprim√©s par un seul signal obtenu √† partir du m√™me son d'origine. Le coucou n'appara√Æt pas.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La vitesse de rotation du moteur qui entra√Æne le coucou et l'angle de rotation sont cousus dans le programme. Au d√©but du programme, le coucou est tir√© dans le bo√Ætier - compte tenu de l'engrenage coulissant install√© sur l'axe du moteur, cette op√©ration est s√ªre, mais elle a un effet si le coucou √©tait en dehors du bo√Ætier au moment du d√©marrage de l'horloge. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Afin de ne pas g√™ner le sommeil, les coucous coucous ne se produisent que pendant la journ√©e. Sa journ√©e de travail commence √† dix heures du matin et la derni√®re fois qu'elle s'exprime est minuit. J'ai √©galement d√©sactiv√© le coucou √† un moment o√π j'ai des appels hebdomadaires sur Skype, afin de ne pas interf√©rer.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le programme est install√© en tant que service et d√©marre au d√©marrage de Debian. </font><font style="vertical-align: inherit;">Ainsi, il suffit d‚Äôallumer l‚Äôhorloge et ils font tout plus loin eux-m√™mes. </font><font style="vertical-align: inherit;">Le temps est pris sur Internet - dans mon EV3, il y a un dongle WiFi. </font><font style="vertical-align: inherit;">Apr√®s le d√©marrage de l'horloge, je d√©connecte g√©n√©ralement le r√©seau, afin de ne pas cr√©er de charge suppl√©mentaire sur le processeur. </font></font><br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le programme</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est disponible sous licence BSD. </font><font style="vertical-align: inherit;">Si vous avez envie de construire un mod√®le similaire et d'utiliser mon logiciel, je n'en serai que content.</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr417255/">https://habr.com/ru/post/fr417255/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr417243/index.html">Installer 3CX SBC Session Edge Controller sur Windows, Raspberry Pi ou Debian 9</a></li>
<li><a href="../fr417245/index.html">Erlang pour l'IoT</a></li>
<li><a href="../fr417247/index.html">VSCE # 1: Podcast des entrepreneurs m√©diatiques</a></li>
<li><a href="../fr417249/index.html">La US Audit Chamber pr√©vient: SpaceX et Boeing attendent de nouveaux retards, une interruption des vols am√©ricains vers l'ISS est possible</a></li>
<li><a href="../fr417251/index.html">Utilisation de l'oeil de poisson sur Raspberry Pi 3 avec ROS - Partie 1</a></li>
<li><a href="../fr417257/index.html">Les pointeurs C comme paradoxe linguistique</a></li>
<li><a href="../fr417259/index.html">√âv√©nements num√©riques √† Moscou du 16 au 22 juillet</a></li>
<li><a href="../fr417261/index.html">Uber apr√®s un accident impliquant sa voiture robotique a d√©cid√© de r√©duire le personnel des op√©rateurs de machines intelligentes √† Pittsburgh</a></li>
<li><a href="../fr417269/index.html">O√π aller pour un designer: de prestigieux prix internationaux</a></li>
<li><a href="../fr417271/index.html">Un pirate peut-il bloquer la Manche?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>