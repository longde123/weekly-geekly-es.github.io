<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü•ê üßÄ üôÜüèΩ Criando um aplicativo Android para reconhecimento de texto em 10 minutos. Mobile Vision CodeLab ‚ÜîÔ∏è üèë üëçüèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Vers√£o em v√≠deo do tutorial 
 
 

 O reconhecimento √≥ptico de caracteres ( OCR ) fornece ao computador a capacidade de ler texto em uma imagem, permit...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Criando um aplicativo Android para reconhecimento de texto em 10 minutos. Mobile Vision CodeLab</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/412679/"><h2>  Vers√£o em v√≠deo do tutorial </h2><br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/mIEfqtn9nts" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<p> <em>O reconhecimento √≥ptico de caracteres</em> ( <strong>OCR</strong> ) fornece ao computador a capacidade de ler texto em uma imagem, permitindo que os aplicativos compreendam sinais, artigos, folhetos, p√°ginas de texto, menus ou qualquer coisa na forma de texto.  <code>Mobile Vision Text API</code> fornece aos desenvolvedores do <code>Android</code> um recurso <code>OCR</code> poderoso e confi√°vel que suporta a maioria dos dispositivos <code>Android</code> e n√£o aumenta o tamanho do seu aplicativo. </p><br><p>  Neste tutorial, voc√™ criar√° um aplicativo no qual todo o texto que cai no quadro ser√° reconhecido e reproduzido durante o processo de grava√ß√£o de v√≠deo. <a name="habracut"></a></p><br><p>  Tamb√©m publicamos artigos sobre outros recursos do Mobile Vision: </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">reconhecimento de objetos e emo√ß√µes humanas</a> ; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">reconhecimento de rosto</a> ; </li></ul><br><p>  O c√≥digo-fonte pode ser baixado <a href="">aqui</a> . </p><br><p>  Ou clone o reposit√≥rio <code>GitHub</code> na linha de comando: </p><br><pre> <code class="bash hljs">$ git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/googlesamples/android-vision.git</code> </pre> <br><p>  O reposit√≥rio <code>visionSamples</code> cont√©m muitos projetos de amostra relacionados ao <code>Mobile Vision</code> .  Apenas dois s√£o usados ‚Äã‚Äãnesta li√ß√£o: </p><br><ul><li> <strong><img src="https://habrastorage.org/getpro/habr/post_images/1e8/d51/ef8/1e8d51ef802bcde6a7d36bf83490b24d.png" width="22" height="22"></strong>  <strong>ocr-codelab / ocr-reader-start</strong> √© o c√≥digo inicial que voc√™ usar√° nesta li√ß√£o. </li><li> <strong><img src="https://habrastorage.org/getpro/habr/post_images/1e8/d51/ef8/1e8d51ef802bcde6a7d36bf83490b24d.png" width="22" height="22"></strong>  <strong>ocr-codelab / ocr-reader-complete</strong> - o c√≥digo completo para o aplicativo finalizado.  Voc√™ pode us√°-lo para solucionar problemas ou ir diretamente para o aplicativo em funcionamento. </li></ul><br><h2>  Atualiza√ß√£o dos servi√ßos do Google Play </h2><br><p>  Pode ser necess√°rio atualizar a vers√£o instalada do <code>Google Repository</code> para usar a <code>Mobile Vision Text API</code> do <code>Mobile Vision Text API</code> . </p><br><p>  Abra o <code>Android Studio</code> e abra o <code>SDK Manager</code> : </p><br><img src="https://habrastorage.org/getpro/habr/post_images/c09/c24/18f/c09c2418f842d747bb135a7d868c4931.png" width="240" height="117"><br><p><br>  Verifique se o <code>Google Repository</code> do <code>Google Repository</code> atualizado.  Deve ser pelo menos a vers√£o <code>26</code> . </p><br><img src="https://habrastorage.org/getpro/habr/post_images/55f/a3f/0ee/55fa3f0ee048bc97f5b14b9fff7734ea.png" width="750" height="502"><br><p></p><br><h2>  Adicione uma depend√™ncia dos Servi√ßos do Google Play e crie um aplicativo iniciador </h2><br><p>  Agora voc√™ pode abrir o projeto inicial: </p><br><ol><li><p>  Escolha um diret√≥rio de inicializa√ß√£o <strong><img src="https://habrastorage.org/getpro/habr/post_images/1e8/d51/ef8/1e8d51ef802bcde6a7d36bf83490b24d.png" width="22" height="22"></strong>  <code>ocr-reader</code> partir do c√≥digo baixado ( <strong>Arquivo</strong> &gt; <strong>Abrir</strong> &gt; <code>ocr-codelab/ocr-reader-start</code> ). </p><br></li><li><p>  Adicione a depend√™ncia do <code>Google Play Services</code> ao aplicativo.  Sem essa depend√™ncia, a <code>Text API</code> n√£o estar√° dispon√≠vel. </p><br></li></ol><br><p>  O projeto pode indicar a aus√™ncia do <strong>arquivo inteiro / google_play_services_version</strong> e <strong>cometer</strong> um erro.  Isso √© normal, vamos corrigi-lo na pr√≥xima etapa. </p><br><p>  Abra o arquivo <code>build.gradle</code> no m√≥dulo do <code>app</code> e altere o bloco de depend√™ncia para incluir a depend√™ncia <code>play-services-vision</code> nele.  Quando tudo estiver pronto, o arquivo deve ficar assim: </p><br><pre> <code class="hljs nginx"><span class="hljs-section"><span class="hljs-section">dependencies</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">implementation</span></span> fileTree(dir: <span class="hljs-string"><span class="hljs-string">'libs'</span></span>, include: [<span class="hljs-string"><span class="hljs-string">'*.jar'</span></span>]) implementation <span class="hljs-string"><span class="hljs-string">'com.android.support:support-v4:26.1.0'</span></span> implementation <span class="hljs-string"><span class="hljs-string">'com.android.support:design:26.1.0'</span></span> implementation <span class="hljs-string"><span class="hljs-string">'com.google.android.gms:play-services-vision:15.0.0'</span></span> }</code> </pre> <br><ol><li><p>  Clique em <img src="https://habrastorage.org/getpro/habr/post_images/f7d/f74/7c5/f7df747c534410a9c0391d47de0bb0e3.png" width="21" height="21">  Bot√£o de sincroniza√ß√£o <code>Gradle</code> . </p><br></li><li><p>  Clique em <img src="https://habrastorage.org/getpro/habr/post_images/82f/7df/0d1/82f7df0d1dce3d570e7c35d7d8fb4575.png" width="22" height="23">  bot√£o iniciar. </p><br></li></ol><br><p>  Ap√≥s alguns segundos, voc√™ ver√° a tela Ler texto, mas esta √© apenas uma tela preta. </p><br><img src="https://habrastorage.org/getpro/habr/post_images/c41/e98/6dc/c41e986dc883fb67fe0caf0760e99378.png" width="349" height="621"><br><p><br>  Nada est√° acontecendo agora, porque o <code>CameraSource</code> n√£o <code>CameraSource</code> configurado.  Vamos fazer isso. </p><br><p>  Se voc√™ n√£o conseguir, pode abrir um projeto <strong><img src="https://habrastorage.org/getpro/habr/post_images/1e8/d51/ef8/1e8d51ef802bcde6a7d36bf83490b24d.png" width="22" height="22"></strong>  <code>ocr-reader-complete</code> e verifique se ele funciona corretamente.  Este projeto √© uma vers√£o pronta da li√ß√£o e, se essa vers√£o n√£o funcionar, verifique se tudo est√° em ordem com o dispositivo e as configura√ß√µes do <code>Android Studio</code> . </p><br><h2>  Configurar TextRecognizer e CameraSource </h2><br><p>  Para come√ßar, criaremos nosso <code>TextRecognizer</code> .  Este objeto detector processa as imagens e determina qual texto aparece dentro delas.  Ap√≥s a inicializa√ß√£o, o <code>TextRecognizer</code> pode ser usado para detectar texto em todos os tipos de imagens.  Encontre o m√©todo <code>createCameraSource</code> e crie um <code>TextRecognizer</code> : </p><br><p>  <em>OcrCaptureActivity.java</em> </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createCameraSource</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> autoFocus, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> useFlash)</span></span></span><span class="hljs-function"> </span></span>{ Context context = getApplicationContext(); <span class="hljs-comment"><span class="hljs-comment">// </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> Create the TextRecognizer TextRecognizer textRecognizer = new TextRecognizer.Builder(context).build(); // </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> Set the TextRecognizer's Processor. // </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> Check if the TextRecognizer is operational. // </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> Create the mCameraSource using the TextRecognizer. }</span></span></code> </pre> <br><p>  Agora o <code>TextRecognizer</code> pronto para <code>TextRecognizer</code> .  No entanto, pode n√£o estar funcionando ainda.  Se o dispositivo n√£o tiver mem√≥ria suficiente ou o <code>Google Play Services</code> n√£o puder carregar depend√™ncias de <code>OCR</code> , o objeto <code>TextRecognizer</code> n√£o funcionar√°.  Antes de come√ßarmos a us√°-lo para reconhecimento de texto, devemos verificar se est√° pronto.  Adicionaremos essa verifica√ß√£o para <code>createCameraSource</code> ap√≥s a inicializa√ß√£o do <code>TextRecognizer</code> : </p><br><p>  <em>OcrCaptureActivity.java</em> </p><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">// </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> Check if the TextRecognizer is operational. if (!textRecognizer.isOperational()) { Log.w(TAG, "Detector dependencies are not yet available."); // Check for low storage. If there is low storage, the native library will not be // downloaded, so detection will not become operational. IntentFilter lowstorageFilter = new IntentFilter(Intent.ACTION_DEVICE_STORAGE_LOW); boolean hasLowStorage = registerReceiver(null, lowstorageFilter) != null; if (hasLowStorage) { Toast.makeText(this, R.string.low_storage_error, Toast.LENGTH_LONG).show(); Log.w(TAG, getString(R.string.low_storage_error)); } }</span></span></code> </pre> <br><p>  Agora que verificamos que o <code>TextRecognizer</code> pronto para uso, podemos us√°-lo para reconhecer quadros individuais.  Mas queremos fazer algo mais interessante: leia o texto no modo de v√≠deo.  Para fazer isso, criaremos um <code>CameraSource</code> pr√©-configurado para controlar a c√¢mera.  Precisamos definir uma alta resolu√ß√£o para fotografar e habilitar o foco autom√°tico para lidar com a tarefa de reconhecer texto pequeno.  Se voc√™ tiver certeza de que seus usu√°rios examinar√£o grandes blocos de texto, por exemplo, sinais, poder√° usar uma resolu√ß√£o mais baixa e o processamento de quadros ser√° mais r√°pido: </p><br><p>  <em>OcrCaptureActivity.java</em> </p><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">// </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> Create the cameraSource using the TextRecognizer. cameraSource = new CameraSource.Builder(getApplicationContext(), textRecognizer) .setFacing(CameraSource.CAMERA_FACING_BACK) .setRequestedPreviewSize(1280, 1024) .setRequestedFps(15.0f) .setFlashMode(useFlash ? Camera.Parameters.FLASH_MODE_TORCH : null) .setFocusMode(autoFocus ? Camera.Parameters.FOCUS_MODE_CONTINUOUS_VIDEO : null) .build();</span></span></code> </pre> <br><p>  Aqui est√° a <code>createCameraSource</code> m√©todo <code>createCameraSource</code> quando terminar: </p><br><p>  <em>OcrCaptureActivity.java</em> </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createCameraSource</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> autoFocus, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> useFlash)</span></span></span><span class="hljs-function"> </span></span>{ Context context = getApplicationContext(); <span class="hljs-comment"><span class="hljs-comment">// Create the TextRecognizer TextRecognizer textRecognizer = new TextRecognizer.Builder(context).build(); // </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> Set the TextRecognizer's Processor. // Check if the TextRecognizer is operational. if (!textRecognizer.isOperational()) { Log.w(TAG, "Detector dependencies are not yet available."); // Check for low storage. If there is low storage, the native library will not be // downloaded, so detection will not become operational. IntentFilter lowstorageFilter = new IntentFilter(Intent.ACTION_DEVICE_STORAGE_LOW); boolean hasLowStorage = registerReceiver(null, lowstorageFilter) != null; if (hasLowStorage) { Toast.makeText(this, R.string.low_storage_error, Toast.LENGTH_LONG).show(); Log.w(TAG, getString(R.string.low_storage_error)); } } // Create the cameraSource using the TextRecognizer. cameraSource = new CameraSource.Builder(getApplicationContext(), textRecognizer) .setFacing(CameraSource.CAMERA_FACING_BACK) .setRequestedPreviewSize(1280, 1024) .setRequestedFps(15.0f) .setFlashMode(useFlash ? Camera.Parameters.FLASH_MODE_TORCH : null) .setFocusMode(autoFocus ? Camera.Parameters.FOCUS_MODE_CONTINUOUS_VIDEO : null) .build(); }</span></span></code> </pre> <br><p>  Se voc√™ executar o aplicativo, ver√° que o v√≠deo foi iniciado!  Mas, para processar imagens da c√¢mera, precisamos adicionar este √∫ltimo <code>TODO</code> para <code>createCameraSource</code> : criar um <code>Processor</code> para processar o texto √† medida que ele chega. </p><br><h2>  Criando OcrDetectorProcessor </h2><br><p>  Seu aplicativo agora pode detectar texto em quadros individuais usando o m√©todo de descoberta no <code>TextRecognizer</code> .  Assim, voc√™ pode encontrar texto, por exemplo, em uma fotografia.  Mas, para ler o texto diretamente durante a grava√ß√£o de v√≠deo, voc√™ precisa implementar um <code>Processor</code> que processar√° o texto assim que ele aparecer na tela. </p><br><p>  V√° para a classe <code>OcrDetectorProcessor</code> implemente a interface <code>Detector.Processor</code> : </p><br><p>  <em>OcrDetectorProcessor.java</em> </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OcrDetectorProcessor</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Detector</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Processor</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TextBlock</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> GraphicOverlay&lt;OcrGraphic&gt; graphicOverlay; OcrDetectorProcessor(GraphicOverlay&lt;OcrGraphic&gt; ocrGraphicOverlay) { graphicOverlay = ocrGraphicOverlay; } }</code> </pre> <br><p>  Para implementar essa interface, voc√™ precisa substituir dois m√©todos.  O primeiro, <code>receiveDetections</code> , recebe <code>TextBlocks</code> do <code>TextRecognizer</code> medida que s√£o detectados.  O segundo, <code>release</code> , √© usado para liberar recursos quando um <code>TextRecognizer</code> destru√≠do.  Nesse caso, precisamos apenas limpar a tela gr√°fica, o que levar√° √† exclus√£o de todos os objetos <code>OcrGraphic</code> . </p><br><p>  <code>OcrGraphic</code> <code>TextBlocks</code> e <code>OcrGraphic</code> objetos <code>OcrGraphic</code> para cada bloco de texto detectado pelo processador.  Implementamos a l√≥gica de seu desenho na pr√≥xima etapa. </p><br><p>  <em>OcrDetectorProcessor.java</em> </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">receiveDetections</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Detector.Detections&lt;TextBlock&gt; detections)</span></span></span><span class="hljs-function"> </span></span>{ graphicOverlay.clear(); SparseArray&lt;TextBlock&gt; items = detections.getDetectedItems(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; items.size(); ++i) { TextBlock item = items.valueAt(i); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (item != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> &amp;&amp; item.getValue() != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { Log.d(<span class="hljs-string"><span class="hljs-string">"Processor"</span></span>, <span class="hljs-string"><span class="hljs-string">"Text detected! "</span></span> + item.getValue()); OcrGraphic graphic = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OcrGraphic(graphicOverlay, item); graphicOverlay.add(graphic); } } } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">release</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ graphicOverlay.clear(); }</code> </pre> <br><p>  Agora que o processador est√° pronto, precisamos configurar o <code>textRecognizer</code> para us√°-lo.  Retorne ao √∫ltimo <code>TODO</code> restante no m√©todo <code>OcrCaptureActivity</code> em <code>OcrCaptureActivity</code> : </p><br><p>  <em>OcrCaptureActivity.java</em> </p><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">// Create the TextRecognizer TextRecognizer textRecognizer = new TextRecognizer.Builder(context).build(); // </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> Set the TextRecognizer's Processor. textRecognizer.setProcessor(new OcrDetectorProcessor(graphicOverlay));</span></span></code> </pre> <br><p>  Agora execute o aplicativo.  Nesse ponto, quando voc√™ passa a c√¢mera sobre o texto, voc√™ ver√° as mensagens de depura√ß√£o "Texto detectado!"  no <code>Android Monitor Logcat</code> !  Mas essa n√£o √© uma maneira muito visual de visualizar o que o <code>TextRecognizer</code> v√™, certo? </p><br><p>  Na pr√≥xima etapa, desenharemos esse texto na tela. </p><br><h2>  Desenho de texto na tela </h2><br><p>  Vamos implementar o m√©todo <code>draw</code> em <code>OcrGraphic</code> .  Precisamos entender se h√° texto na imagem, converter as coordenadas de suas bordas em quadros de tela e desenhar as bordas e o texto. </p><br><p>  <em>OcrGraphic.java</em> </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">draw</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Canvas canvas)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> Draw the text onto the canvas. if (text == null) { return; } // Draws the bounding box around the TextBlock. RectF rect = new RectF(text.getBoundingBox()); rect = translateRect(rect); canvas.drawRect(rect, rectPaint); // Render the text at the bottom of the box. canvas.drawText(text.getValue(), rect.left, rect.bottom, textPaint); }</span></span></code> </pre> <br><p>  Inicie o aplicativo e teste-o neste texto de exemplo: </p><br><img src="https://habrastorage.org/getpro/habr/post_images/9f9/62d/41d/9f962d41d7ee963958a8bbc2f88b97ec.png" width="663" height="169"><br><p>  Voc√™ deve ver que um quadro aparece na tela com texto!  Voc√™ pode brincar com a cor do texto usando <code>TEXT_COLOR</code> . </p><br><p>  Que tal isso? </p><br><img src="https://habrastorage.org/getpro/habr/post_images/8f2/09a/d7c/8f209ad7cd7ae77245abaa3250ea91d2.png" width="621" height="441"><br><p>  O quadro ao redor do texto parece correto, mas o texto est√° na parte inferior. </p><br><img src="https://habrastorage.org/getpro/habr/post_images/8dc/0ef/ec1/8dc0efec1d11dadff02a2ca7aa83d752.png" width="351" height="622"><br><p><br>  Isso ocorre porque o mecanismo transfere todo o texto que ele reconhece no <code>TextBlock</code> como uma √∫nica frase, mesmo que veja uma frase dividida em v√°rias linhas.  Se voc√™ precisar obter toda a oferta, isso √© muito conveniente.  Mas e se voc√™ quiser saber onde cada linha de texto est√° localizada? </p><br><p>  Voc√™ pode obter <code>Lines</code> de um <code>TextBlock</code> chamando <code>getComponents</code> e, classificando cada linha, pode facilmente obter sua localiza√ß√£o e o texto dentro dela.  Isso permite desenhar texto no local onde ele realmente aparece. </p><br><p>  <em>OcrGraphic.java</em> </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">draw</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Canvas canvas)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> Draw the text onto the canvas. if (text == null) { return; } // Draws the bounding box around the TextBlock. RectF rect = new RectF(text.getBoundingBox()); rect = translateRect(rect); canvas.drawRect(rect, rectPaint); // Break the text into multiple lines and draw each one according to its own bounding box. List&lt;? extends Text&gt; textComponents = text.getComponents(); for(Text currentText : textComponents) { float left = translateX(currentText.getBoundingBox().left); float bottom = translateY(currentText.getBoundingBox().bottom); canvas.drawText(currentText.getValue(), left, bottom, textPaint); } }</span></span></code> </pre> <br><p>  Tente este texto novamente: </p><br><img src="https://habrastorage.org/getpro/habr/post_images/8f2/09a/d7c/8f209ad7cd7ae77245abaa3250ea91d2.png" width="655" height="465"><br><p>  √ìtimo!  Voc√™ pode at√© dividir o texto encontrado em componentes ainda menores, com base em suas necessidades.  Voc√™ pode chamar <code>getComponents</code> em cada linha e obter <code>Elements</code> (palavras latinas).  √â poss√≠vel configurar o <code>textSize</code> para que o texto <code>textSize</code> tanto espa√ßo quanto o texto real na tela. </p><br><img src="https://habrastorage.org/getpro/habr/post_images/102/3e0/2d2/1023e02d2d8659ec0a4d51662241037e.png" width="349" height="620"><br><p></p><br><h2>  Reproduzir texto quando clicado nele </h2><br><p>  Agora, o texto da c√¢mera √© convertido em linhas estruturadas e essas linhas s√£o exibidas na tela.  Vamos fazer outra coisa com eles. </p><br><p>  Usando a <code>TextToSpeech API</code> embutida no <code>Android</code> e o m√©todo <code>contains</code> em <code>OcrGraphic</code> , podemos ensinar o aplicativo a falar em voz alta quando voc√™ clica no texto. </p><br><p>  Primeiro, vamos implementar o m√©todo <code>contains</code> em <code>OcrGraphic</code> .  S√≥ precisamos verificar se as coordenadas <code>y</code> est√£o dentro dos limites do texto exibido. <br>  <em>OcrGraphic.java</em> </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">contains</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> Check if this graphic's text contains this point. if (text == null) { return false; } RectF rect = new RectF(text.getBoundingBox()); rect = translateRect(rect); return rect.contans(x, y); }</span></span></code> </pre> <br><p>  Voc√™ pode perceber que h√° muito em comum com o m√©todo <code>Draw</code> !  Neste projeto, voc√™ deve poder reutilizar o c√≥digo, mas aqui deixamos tudo como √© apenas por uma quest√£o de exemplo. </p><br><p>  Agora, vamos seguir para o m√©todo <code>onTap</code> em <code>OcrCaptureActivity</code> e processar o clique no texto, se houver um nesse local. </p><br><p>  <em>OcrCaptureActivity.java</em> </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onTap</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> rawX, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> rawY)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> Speak the text when the user taps on screen. OcrGraphic graphic = graphicOverlay.getGraphicAtLocation(rawX, rawY); TextBlock text = null; if (graphic != null) { text = graphic.getTextBlock(); if (text != null &amp;&amp; text.getValue() != null) { Log.d(TAG, "text data is being spoken! " + text.getValue()); // </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> Speak the string. } else { Log.d(TAG, "text data is null"); } } else { Log.d(TAG,"no text detected"); } return text != null; }</span></span></code> </pre> <br><p>  Voc√™ pode executar o aplicativo e garantir que o clique no texto esteja sendo processado pelo <code>Android Monitor Logcat</code> . </p><br><p>  Vamos fazer nosso aplicativo falar!  V√° para o in√≠cio da <code>Activity</code> e encontre o m√©todo <code>onCreate</code> .  Ao iniciar o aplicativo, precisamos inicializar o mecanismo <code>TextToSpeech</code> para uso futuro. </p><br><p>  <em>OcrCaptureActivity.java</em> </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Bundle bundle)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// (Portions of this method omitted) // </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> Set up the Text To Speech engine. TextToSpeech.OnInitListener listener = new TextToSpeech.OnInitListener() { @Override public void onInit(final int status) { if (status == TextToSpeech.SUCCESS) { Log.d("TTS", "Text to speech engine started successfully."); tts.setLanguage(Locale.US); } else { Log.d("TTS", "Error starting the text to speech engine."); } } }; tts = new TextToSpeech(this.getApplicationContext(), listener); }</span></span></code> </pre> <br><p>  Apesar de termos iniciado corretamente o <code>TextToSpeech</code> , como regra, voc√™ ainda precisa lidar com erros gerais, por exemplo, quando o mecanismo ainda n√£o est√° pronto na primeira vez em que voc√™ clica no texto. </p><br><p>  <code>TextToSpeech</code> tamb√©m depende do idioma.  Voc√™ pode alterar o idioma com base no idioma do texto reconhecido.  O reconhecimento de idiomas n√£o est√° incorporado na <code>Mobile Vision Text API</code> do <code>Mobile Vision Text API</code> , mas est√° dispon√≠vel na <code>Google Translate API</code> do <code>Google Translate API</code> .  Como idioma para reconhecimento de texto, voc√™ pode usar o idioma do dispositivo do usu√°rio. </p><br><p>  √ìtimo, tudo o que resta √© adicionar o c√≥digo de reprodu√ß√£o de texto no m√©todo <code>onTap</code> . </p><br><p>  <em>OcrCaptureActivity.java</em> </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onTap</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> rawX, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> rawY)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> Speak the text when the user taps on screen. OcrGraphic graphic = graphicOverlay.getGraphicAtLocation(rawX, rawY); TextBlock text = null; if (graphic != null) { text = graphic.getTextBlock(); if (text != null &amp;&amp; text.getValue() != null) { Log.d(TAG, "text data is being spoken! " + text.getValue()); // Speak the string. tts.speak(text.getValue(), TextToSpeech.QUEUE_ADD, null, "DEFAULT"); } else { Log.d(TAG, "text data is null"); } } else { Log.d(TAG,"no text detected"); } return text != null; }</span></span></code> </pre> <br><p>  Agora, quando voc√™ inicia o aplicativo e clica no texto detectado, seu dispositivo o reproduz.  Experimente! </p><br><h2>  Conclus√£o </h2><br><p>  Agora voc√™ tem um aplicativo que pode reconhecer texto da c√¢mera e falar em voz alta! </p><br><p>  Voc√™ pode aplicar o conhecimento adquirido de reconhecimento de texto em seus outros aplicativos.  Por exemplo, leia endere√ßos e n√∫meros de telefone de cart√µes de visita, pesquise o texto de fotografias de v√°rios documentos.  Em resumo, use o <code>OCR</code> sempre que precisar reconhecer o texto em uma imagem. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Fonte</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt412679/">https://habr.com/ru/post/pt412679/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt412667/index.html">Cybergroup Turla usa Metasploit na campanha Mosquito</a></li>
<li><a href="../pt412669/index.html">A gest√£o do tempo n√£o √© assustadora: como fazer mais</a></li>
<li><a href="../pt412671/index.html">Console BLE: uma maneira completamente nova de interagir com dispositivos BLE</a></li>
<li><a href="../pt412675/index.html">Contratos e endere√ßos multisig no Bitcoin e Ethereum</a></li>
<li><a href="../pt412677/index.html">Matriz de Rastreabilidade</a></li>
<li><a href="../pt412681/index.html">C√°lculos bin√°rios para aritm√©tica decimal</a></li>
<li><a href="../pt412683/index.html">Onde e como aprender o aprendizado de m√°quina?</a></li>
<li><a href="../pt412685/index.html">Rastreamento de caminho da unidade GPU - parte 2</a></li>
<li><a href="../pt412687/index.html">Implemente o IdM. Procedimentos e meios t√©cnicos - do b√°sico ao IdM</a></li>
<li><a href="../pt412689/index.html">A an√°lise preditiva de TI simplifica o monitoramento de aplicativos distribu√≠dos</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>