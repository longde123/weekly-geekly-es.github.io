<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®‚Äçüë®‚Äçüë¶ üìâ üê® PVS-Studio geht in die Cloud - Starten Sie die Analyse auf Travis CI üë©üèº‚Äçüè´ üë®‚Äçüë®‚Äçüëß‚Äçüë¶ üöµüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Derzeit sind Cloud-CI-Systeme ein sehr beliebter Dienst. In diesem Artikel erfahren Sie, wie Sie mithilfe der in PVS-Studio verf√ºgbaren Tools die Quel...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>PVS-Studio geht in die Cloud - Starten Sie die Analyse auf Travis CI</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/458072/">  Derzeit sind Cloud-CI-Systeme ein sehr beliebter Dienst.  In diesem Artikel erfahren Sie, wie Sie mithilfe der in PVS-Studio verf√ºgbaren Tools die Quellcodeanalyse am Beispiel des Travis CI-Dienstes in die Cloud-CI-Plattform integrieren k√∂nnen. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ee1/252/191/ee125219104f0ff7d27f8c9dfc2db8bf.png" alt="Bild 1"></div><br><a name="habracut"></a><br>  Warum betrachten wir Clouds von Drittanbietern und machen keine eigenen?  Es gibt eine Reihe von Gr√ºnden, und der Hauptgrund ist, dass SaaS ein ziemlich teures und schwieriges Verfahren ist.  Die direkte Integration der PVS-Studio-Analyse in eine Cloud-Plattform eines Drittanbieters (ob es sich um offene Plattformen wie CircleCI, Travis CI, GitLab oder eine spezialisierte Unternehmensl√∂sung handelt, die nur in einem bestimmten Unternehmen verwendet wird) ist eine recht einfache und triviale Aufgabe.  Das hei√üt, wir k√∂nnen sagen, dass <i>PVS-Studio bereits ‚Äûin den Clouds‚Äú verf√ºgbar ist</i> .  Ein v√∂llig anderes Thema ist die Organisation und Bereitstellung der Infrastruktur f√ºr solche Arbeiten rund um die Uhr.  Dies ist eine v√∂llig andere Aufgabe, und PVS-Studio hat nicht vor, eine eigene Cloud-Plattform bereitzustellen, auf der Analysen durchgef√ºhrt werden k√∂nnen. <br><br><h2>  Informationen zur verwendeten Software </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Travis CI</a> ist ein Dienst zum Erstellen und Testen von Software, die GitHub als Speicher verwendet.  Travis CI erfordert keine √Ñnderung des Programmcodes, um den Dienst nutzen zu k√∂nnen. Alle Einstellungen erfolgen in der Datei <i>.travis.yml</i> im Stammverzeichnis des Repositorys. <br><br>  Wir werden <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">LXC</a> (Linux Containers) als Testprojekt zum Testen mit PVS-Studio verwenden.  Es ist ein Virtualisierungssystem auf Betriebssystemebene zum Ausf√ºhren mehrerer Instanzen des Linux-Betriebssystems auf einem einzelnen Knoten. <br><br>  Das Projekt ist klein, aber mehr als genug, um es zu demonstrieren.  Die Ausgabe des Befehls cloc: <br><div class="scrollable-table"><table><tbody><tr><td>  Sprache <br></td><td>  Dateien <br></td><td>  leer <br></td><td>  Kommentar <br></td><td>  Code <br></td></tr><tr><td>  C. <br></td><td>  124 <br></td><td>  11937 <br></td><td>  6758 <br></td><td>  50836 <br></td></tr><tr><td>  C / C ++ - Header <br></td><td>  65 <br></td><td>  1117 <br></td><td>  3676 <br></td><td>  3774 <br></td></tr></tbody></table></div>  <b>Hinweis:</b> LXC-Entwickler verwenden Travis CI bereits, daher nehmen wir ihre Konfigurationsdatei als Grundlage und bearbeiten sie f√ºr unsere Zwecke. <br><br><h2>  Anpassung </h2><br>  Um mit Travis CI zu beginnen, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">folgen Sie dem Link</a> und authentifizieren Sie sich mit einem GitHub-Konto. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1ba/8fc/c5a/1ba8fcc5a0caf41da255093cf4feaa8e.png" alt="Bild 17"></div><br>  In dem sich √∂ffnenden Fenster m√ºssen Sie Travis CI autorisieren. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2d7/aec/13d/2d7aec13dec45022c952ff0498a6acae.png" alt="Bild 16"></div><br>  Nach der Autorisierung eine Weiterleitung zur Begr√º√üungsseite ‚ÄûZum ersten Mal hier?  Lass uns anfangen! ‚Äú  <b>,</b> die kurz beschreibt, was als n√§chstes getan werden muss, um loszulegen: <br><br><ul><li>  Repositorys aktivieren; </li><li>  F√ºgen Sie die Datei .travis.yml zum Repository hinzu. </li><li>  F√ºhren Sie den ersten Build aus. </li></ul><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/29c/17f/c83/29c17fc830db9fad9d6d9dcb7fa047d7.png" alt="Bild 18"></div><br>  Wir werden beginnen, diese Punkte auszuf√ºhren. <br><br>  Um unser Repository zu Travis CI hinzuzuf√ºgen, gehen Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">√ºber den Link</a> zu den Profileinstellungen und klicken Sie auf die Schaltfl√§che "Aktivieren". <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ab8/1f7/75e/ab81f775edc51c92b3238bf30b40527d.png" alt="Bild 19"></div><br>  Nach dem Klicken wird ein Fenster mit einer Auswahl von Repositorys ge√∂ffnet, auf die die Travis CI-Anwendung Zugriff erh√§lt. <br>  <b>Hinweis:</b> Um Zugriff auf das Repository zu erhalten, muss das Konto √ºber Administratorrechte verf√ºgen. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1e8/4fe/351/1e84fe351a57fcff37b5b70ec77e9cc5.png" alt="Bild 38"></div><br>  Wir w√§hlen das gew√ºnschte Repository aus, best√§tigen die Auswahl mit der Schaltfl√§che "Genehmigen &amp; Installieren" und werden zur√ºck zur Seite mit den Profileinstellungen weitergeleitet. <br><br>  Erstellen Sie sofort die Variablen, mit denen wir die Analyzer-Lizenzdatei erstellen und ihre Berichte senden.  Gehen Sie dazu zur Einstellungsseite - der Schaltfl√§che "Einstellungen" rechts neben dem gew√ºnschten Repository. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d35/f44/907/d35f449074bd079c1b35140dd8336173.png" alt="Bild 39"></div><br>  Das Einstellungsfenster wird ge√∂ffnet. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cfe/c5f/1a8/cfec5f1a8ea19bf2c6e9e63c7af4c68c.png" alt="Bild 41"></div><br>  Kurze Beschreibung der Einstellungen: <br><br><ul><li>  Abschnitt "Allgemein" - Einstellen von Triggern f√ºr Autorun-Aufgaben; </li><li>  Abschnitt "Automatische Abbrechen" - Erm√∂glicht das Konfigurieren der Baugruppe zum automatischen Abbrechen. </li><li>  Abschnitt "Umgebungsvariablen" - Mit dieser Option k√∂nnen Sie Umgebungsvariablen definieren, die sowohl √∂ffentliche als auch vertrauliche Informationen enthalten, z. B. Anmeldeinformationen und SSH-Schl√ºssel. </li><li>  Abschnitt ‚ÄûCron-Jobs‚Äú - Festlegen des Zeitplans f√ºr den Start der Aufgabe. </li></ul><br>  Im Abschnitt "Umgebungsvariablen" erstellen wir die Variablen <i>PVS_USERNAME</i> und <i>PVS_KEY</i> , die den Benutzernamen und den Lizenzschl√ºssel f√ºr den statischen Analysator enthalten.  Wenn Sie keine permanente PVS-Studio-Lizenz haben, k√∂nnen Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">eine Testlizenz anfordern</a> . <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8aa/731/483/8aa731483fc391273980c7de338f83be.png" alt="Bild 5"></div><br>  Erstellen Sie sofort die Variablen <i>MAIL_USER</i> und <i>MAIL_PASSWORD,</i> die den Benutzernamen und das Kennwort der Mailbox enthalten, mit denen wir Berichte senden. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/37d/a42/9b4/37da429b49812239ab900e3b6fe5a90d.png" alt="Bild 4"></div><br>  Wenn die Aufgabe gestartet wird, nimmt Travis CI Anweisungen aus der Datei .travis.yml entgegen, die sich im Stammverzeichnis des Repositorys befindet. <br><br>  Mit Travis CI k√∂nnen wir statische Analysen direkt in der virtuellen Maschine ausf√ºhren oder daf√ºr einen vorkonfigurierten Container verwenden.  Die Ergebnisse dieser Ans√§tze unterscheiden sich nicht voneinander. Die Verwendung eines vorkonfigurierten Containers kann jedoch n√ºtzlich sein, wenn beispielsweise bereits ein Container mit einer bestimmten Umgebung vorhanden ist, in der das Softwareprodukt erstellt und getestet wird, und diese Umgebung in Travis CI nicht wiederhergestellt werden soll . <br><br>  Erstellen wir eine Konfiguration zum Ausf√ºhren des Analysators in einer virtuellen Maschine. <br><br>  Zum Zusammenbau und Testen verwenden wir eine virtuelle Maschine, die auf Ubuntu Trusty basiert. Die Beschreibung finden Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> . <br><br>  Zun√§chst geben wir an, dass das Projekt in C geschrieben ist, und listen die Compiler auf, die wir f√ºr die Assemblierung verwenden werden: <br><br><pre><code class="cpp hljs">language: c compiler: - gcc - clang</code> </pre> <br>  <b>Hinweis</b> : Wenn Sie mehr als einen Compiler angeben, werden die Aufgaben f√ºr jeden von ihnen parallel gestartet.  Lesen Sie mehr <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">in der Dokumentation</a> . <br><br>  Bevor wir mit dem Build beginnen, m√ºssen wir das Analyzer-Repository hinzuf√ºgen, die Abh√§ngigkeiten und zus√§tzliche Pakete installieren: <br><br><pre> <code class="cpp hljs">before_install: - sudo add-apt-repository ppa:ubuntu-lxc/daily -y - wget -q -O - https:<span class="hljs-comment"><span class="hljs-comment">//files.viva64.com/etc/pubkey.txt | sudo apt-key add - - sudo wget -O /etc/apt/sources.list.d/viva64.list https://files.viva64.com/etc/viva64.list - sudo apt-get update -qq - sudo apt-get install -qq coccinelle parallel libapparmor-dev libcap-dev libseccomp-dev python3-dev python3-setuptools docbook2x libgnutls-dev libselinux1-dev linux-libc-dev pvs-studio libio-socket-ssl-perl libnet-ssleay-perl sendemail ca-certificates</span></span></code> </pre> <br>  Bevor Sie das Projekt erstellen, m√ºssen Sie die Umgebung vorbereiten: <br><br><pre> <code class="cpp hljs">script: - ./coccinelle/run-coccinelle.sh -i - git diff --<span class="hljs-built_in"><span class="hljs-built_in">exit</span></span>-code - <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> CFLAGS=<span class="hljs-string"><span class="hljs-string">"-Wall -Werror"</span></span> - <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> LDFLAGS=<span class="hljs-string"><span class="hljs-string">"-pthread -lpthread"</span></span> - ./autogen.sh - rm -Rf build - mkdir build - cd build - ../configure --enable-tests --with-distro=unknown</code> </pre> <br>  Als n√§chstes m√ºssen wir eine Datei mit einer Lizenz erstellen und die Projektanalyse ausf√ºhren. <br><br>  Der erste Befehl erstellt eine Lizenzdatei f√ºr den Analysator.  Die Daten f√ºr die Variablen <i>$ PVS_USERNAME</i> und <i>$ PVS_KEY</i> stammen aus den Projekteinstellungen. <br><br><pre> <code class="cpp hljs">- pvs-studio-analyzer credentials $PVS_USERNAME $PVS_KEY -o PVS-Studio.lic</code> </pre> <br>  Der folgende Befehl startet die Projektassembly-Ablaufverfolgung: <br><br><pre> <code class="cpp hljs">- pvs-studio-analyzer trace -- make -j4</code> </pre> <br>  Nachdem wir die statische Analyse gestartet haben. <br>  <b>Hinweis:</b> Wenn Sie eine <i>Testlizenz verwenden</i> , m√ºssen Sie den Parameter <i>--disableLicenseExpirationCheck</i> angeben. <br><br><pre> <code class="cpp hljs"> - pvs-studio-analyzer analyze -j2 -l PVS-Studio.lic -o PVS-Studio-${CC}.<span class="hljs-built_in"><span class="hljs-built_in">log</span></span> ‚Äì-disableLicenseExpirationCheck</code> </pre> <br>  Mit dem letzten Befehl wird die Analyser-Ergebnisdatei in einen HTML-Bericht konvertiert. <br><br><pre> <code class="cpp hljs">- plog-converter -t html PVS-Studio-${CC}.<span class="hljs-built_in"><span class="hljs-built_in">log</span></span> -o PVS-Studio-${CC}.html</code> </pre> <br>  Da TravisCI das √Ñndern des Formats von E-Mail-Benachrichtigungen nicht zul√§sst, verwenden wir das Sendemail-Paket, um im letzten Schritt Berichte zu senden: <br><br><pre> <code class="cpp hljs">- sendemail -t mail@domain.com -u <span class="hljs-string"><span class="hljs-string">"PVS-Studio $CC report, commit:$TRAVIS_COMMIT"</span></span> -m <span class="hljs-string"><span class="hljs-string">"PVS-Studio $CC report, commit:$TRAVIS_COMMIT"</span></span> -s smtp.gmail.com:<span class="hljs-number"><span class="hljs-number">587</span></span> -xu $MAIL_USER -xp $MAIL_PASSWORD -o tls=yes -f $MAIL_USER -a PVS-Studio-${CC}.<span class="hljs-built_in"><span class="hljs-built_in">log</span></span> PVS-Studio-${CC}.html</code> </pre> <br>  Volltext der Konfigurationsdatei zum Ausf√ºhren des Analysators in einer virtuellen Maschine: <br><br><pre> <code class="cpp hljs">language: c compiler: - gcc - clang before_install: - sudo add-apt-repository ppa:ubuntu-lxc/daily -y - wget -q -O - https:<span class="hljs-comment"><span class="hljs-comment">//files.viva64.com/etc/pubkey.txt | sudo apt-key add - - sudo wget -O /etc/apt/sources.list.d/viva64.list https://files.viva64.com/etc/viva64.list - sudo apt-get update -qq - sudo apt-get install -qq coccinelle parallel libapparmor-dev libcap-dev libseccomp-dev python3-dev python3-setuptools docbook2x libgnutls-dev libselinux1-dev linux-libc-dev pvs-studio libio-socket-ssl-perl libnet-ssleay-perl sendemail ca-certificates script: - ./coccinelle/run-coccinelle.sh -i - git diff --exit-code - export CFLAGS="-Wall -Werror" - export LDFLAGS="-pthread -lpthread" - ./autogen.sh - rm -Rf build - mkdir build - cd build - ../configure --enable-tests --with-distro=unknown - pvs-studio-analyzer credentials $PVS_USERNAME $PVS_KEY -o PVS-Studio.lic - pvs-studio-analyzer trace -- make -j4 - pvs-studio-analyzer analyze -j2 -l PVS-Studio.lic -o PVS-Studio-${CC}.log --disableLicenseExpirationCheck - plog-converter -t html PVS-Studio-${CC}.log -o PVS-Studio-${CC}.html - sendemail -t mail@domain.com -u "PVS-Studio $CC report, commit:$TRAVIS_COMMIT" -m "PVS-Studio $CC report, commit:$TRAVIS_COMMIT" -s smtp.gmail.com:587 -xu $MAIL_USER -xp $MAIL_PASSWORD -o tls=yes -f $MAIL_USER -a PVS-Studio-${CC}.log PVS-Studio-${CC}.html</span></span></code> </pre> <br>  Um einen statischen Analysator in einem Container auszuf√ºhren, erstellen Sie ihn zun√§chst mit der folgenden Docker-Datei: <br><br><pre> <code class="cpp hljs">FROM docker.io/ubuntu:trusty ENV CFLAGS=<span class="hljs-string"><span class="hljs-string">"-Wall -Werror"</span></span> ENV LDFLAGS=<span class="hljs-string"><span class="hljs-string">"-pthread -lpthread"</span></span> RUN apt-get update &amp;&amp; apt-get install -y software-properties-common wget \ &amp;&amp; wget -q -O - https:<span class="hljs-comment"><span class="hljs-comment">//files.viva64.com/etc/pubkey.txt | sudo apt-key add - \ &amp;&amp; wget -O /etc/apt/sources.list.d/viva64.list https://files.viva64.com/etc/viva64.list \ &amp;&amp; apt-get update \ &amp;&amp; apt-get install -yqq coccinelle parallel libapparmor-dev libcap-dev libseccomp-dev python3-dev python3-setuptools docbook2x libgnutls-dev libselinux1-dev linux-libc-dev pvs-studio git libtool autotools-dev automake pkg-config clang make libio-socket-ssl-perl libnet-ssleay-perl sendemail ca-certificates \ &amp;&amp; rm -rf /var/lib/apt/lists/*</span></span></code> </pre> <br>  In diesem Fall sieht die Konfigurationsdatei m√∂glicherweise folgenderma√üen aus: <br><br><pre> <code class="cpp hljs">before_install: - docker pull docker.io/oandreev/lxc env: - CC=gcc - CC=clang script: - docker run --rm --cap-add SYS_PTRACE -v $(pwd):/pvs -w /pvs docker.io/oandreev/lxc /bin/bash -c <span class="hljs-string"><span class="hljs-string">" ./coccinelle/run-coccinelle.sh -i &amp;&amp; git diff --exit-code &amp;&amp; ./autogen.sh &amp;&amp; mkdir build &amp;&amp; cd build &amp;&amp; ../configure CC=$CC &amp;&amp; pvs-studio-analyzer credentials $PVS_USERNAME $PVS_KEY -o PVS-Studio.lic &amp;&amp; pvs-studio-analyzer trace -- make -j4 &amp;&amp; pvs-studio-analyzer analyze -j2 -l PVS-Studio.lic -o PVS-Studio-$CC.log --disableLicenseExpirationCheck &amp;&amp; plog-converter -t html -o PVS-Studio-$CC.html PVS-Studio-$CC.log &amp;&amp; sendemail -t mail@domain.com -u 'PVS-Studio $CC report, commit:$TRAVIS_COMMIT' -m 'PVS-Studio $CC report, commit:$TRAVIS_COMMIT' -s smtp.gmail.com:587 -xu $MAIL_USER -xp $MAIL_PASSWORD -o tls=yes -f $MAIL_USER -a PVS-Studio-${CC}.log PVS-Studio-${CC}.html"</span></span></code> </pre> <br>  Wie Sie sehen, f√ºhren wir in diesem Fall nichts in der virtuellen Maschine aus, und absolut alle Aktionen zum Zusammenstellen und Testen des Projekts finden im Container statt. <br><br>  <b>Hinweis</b> : Beim Starten des Containers m√ºssen Sie den <i>Parameter --cap-add SYS_PTRACE</i> oder <i>--security-opt seccomp: uncfined angeben</i> , da der Systemaufruf ptrace zum Kompilieren des Trace verwendet wird. <br><br>  Wir laden die Konfigurationsdatei in das Stammverzeichnis des Repositorys und stellen fest, dass Travis CI eine Benachrichtigung √ºber das Vorhandensein von √Ñnderungen im Projekt erhalten und die Assembly automatisch gestartet hat. <br><br>  Detaillierte Informationen zum Fortschritt der Montage und zur √úberpr√ºfung durch den Analysator finden Sie in der Konsole. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/00a/846/95d/00a84695de9e00013c89760219f5292e.png" alt="Bild 2"></div><br>  Nach Abschluss der Tests erhalten wir zwei Briefe per Post: einen mit den Ergebnissen der statischen Analyse f√ºr die Erstellung des Projekts mit gcc und einen mit clang. <br><br><h2>  Kurz zu den Testergebnissen </h2><br>  Im Allgemeinen ist das Projekt ziemlich sauber, der Analysator gab nur 24 kritische und 46 durchschnittliche Warnungen aus.  Betrachten Sie einige interessante Benachrichtigungen, um die Arbeit zu demonstrieren: <br><br><h3>  Redundante Bedingungen in if </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">V590</a> √úberpr√ºfen Sie den Ausdruck 'ret! = (- 1) &amp;&amp; ret == 1'.  Der Ausdruck ist √ºbertrieben oder enth√§lt einen Druckfehler.  Anhang.c 107 <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> EOF -1 static struct lxc_proc_context_info *lxc_proc_get_context_info(pid_t pid) { .... while (getline(&amp;</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">line</span></span></span><span class="hljs-meta">, &amp;line_bufsz, proc_file) != -1) { ret = sscanf(</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">line</span></span></span><span class="hljs-meta">, </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"CapBnd: %llx"</span></span></span><span class="hljs-meta">, &amp;info-&gt;capability_mask); </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (ret != EOF &amp;&amp; ret == 1) </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">// &lt;= { found = true; break; } } .... }</span></span></span></span></code> </pre> <br>  Wenn <i>ret == 1 ist</i> , ist es definitiv nicht gleich -1 (EOF).  √úberm√§√üige Validierung, <i>ret! = EOF</i> kann entfernt werden. <br><br>  Zwei weitere Warnungen wurden ausgegeben: <br><br><ul><li>  V590 √úberpr√ºfen Sie den Ausdruck 'ret! = (- 1) &amp;&amp; ret == 1'.  Der Ausdruck ist √ºbertrieben oder enth√§lt einen Druckfehler.  Anhang.c 579 </li><li>  V590 √úberpr√ºfen Sie den Ausdruck 'ret! = (- 1) &amp;&amp; ret == 1'.  Der Ausdruck ist √ºbertrieben oder enth√§lt einen Druckfehler.  Anhang.c 583 </li></ul><br><h3>  Verlust von hohen Bits </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">V784</a> Die Gr√∂√üe der Bitmaske ist kleiner als die Gr√∂√üe des ersten Operanden.  Dies f√ºhrt zum Verlust h√∂herer Bits.  conf.c 1879 <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mount_opt</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *name; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> clear; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> flag; }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parse_mntopt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *opt, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *flags, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> **data, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">size_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> size)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mount_opt</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mo</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-comment"><span class="hljs-comment">/* If opt is found in mount_opt, set or clear flags. * Otherwise append it to data. */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (mo = &amp;mount_opt[<span class="hljs-number"><span class="hljs-number">0</span></span>]; mo-&gt;name != <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>; mo++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">strncmp</span></span>(opt, mo-&gt;name, <span class="hljs-built_in"><span class="hljs-built_in">strlen</span></span>(mo-&gt;name)) == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mo-&gt;clear) { *flags &amp;= ~mo-&gt;flag; <span class="hljs-comment"><span class="hljs-comment">// &lt;= } else { *flags |= mo-&gt;flag; } return; } } .... }</span></span></code> </pre> <br>  Unter Linux ist <i>long</i> eine 64-Bit-Ganzzahlvariable, <i>mo-&gt; flag</i> eine 32-Bit-Ganzzahlvariable.  Die Verwendung von <i>mo-&gt; flag</i> als Bitmaske f√ºhrt zum Verlust der 32 h√∂chstwertigen Bits.  Das implizite Umwandeln der Bitmaske in eine 64-Bit-Ganzzahlvariable nach bitweiser Inversion wird durchgef√ºhrt.  Die hohen Bits dieser Maske sind Null. <br><br>  Demonstrieren Sie mit einem Beispiel: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> x; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> y; .... x &amp;= ~y;</code> </pre> <br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1a3/59f/a71/1a359fa7163d8a99c8632ffc17cf7eb0.png" alt="Bild 3"></div><br><br>  Der richtige Code lautet: <br><br><pre> <code class="cpp hljs">*flags &amp;= ~(<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span>)(mo-&gt;flag);</code> </pre> <br>  Der Analysator gab eine weitere √§hnliche Warnung aus: <br><br><ul><li>  V784 Die Gr√∂√üe der Bitmaske ist kleiner als die Gr√∂√üe des ersten Operanden.  Dies f√ºhrt zum Verlust h√∂herer Bits.  conf.c 1933 </li></ul><br><h3>  Verd√§chtiger Zyklus </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">V612</a> Eine bedingungslose 'R√ºckkehr' innerhalb einer Schleife.  conf.c 3477 <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> lxc_list_for_each(__iterator, __list) \ for (__iterator = (__list)-&gt;next; __iterator != __list; \ __iterator = __iterator-&gt;next) static bool verify_start_hooks(struct lxc_conf *conf) { char path[PATH_MAX]; struct lxc_list *it; lxc_list_for_each (it, &amp;conf-&gt;hooks[LXCHOOK_START]) { int ret; char *hookname = it-&gt;elem; ret = snprintf(path, PATH_MAX, </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"%s%s"</span></span></span><span class="hljs-meta">, conf-&gt;rootfs.path ? conf-&gt;rootfs.mount : </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">""</span></span></span><span class="hljs-meta">, hookname); </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (ret </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt; 0 || ret &gt;= PATH_MAX) return false; ret = access(path, X_OK); if (ret &lt; 0) { SYSERROR("Start hook \"%s\" not found in container", hookname); return false; } return true; // &lt;= } return true; }</span></span></span></span></code> </pre> <br>  Der Zyklus beginnt und wird bei der ersten Iteration unterbrochen.  Vielleicht war dies beabsichtigt, aber dann kann der Zyklus weggelassen werden. <br><br><h3>  √úber die Grenzen eines Arrays hinausgehen </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">V557</a> Array-Unterlauf ist m√∂glich.  Der Wert des Index 'Bytes - 1' k√∂nnte -1 erreichen.  network.c 2570 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">lxc_create_network_unpriv_exec</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *lxcpath, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *lxcname, struct lxc_netdev *netdev, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">pid_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> pid, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> hooks_version)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> bytes; <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> buffer[PATH_MAX] = {<span class="hljs-number"><span class="hljs-number">0</span></span>}; .... bytes = lxc_read_nointr(pipefd[<span class="hljs-number"><span class="hljs-number">0</span></span>], &amp;buffer, PATH_MAX); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (bytes &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { SYSERROR(<span class="hljs-string"><span class="hljs-string">"Failed to read from pipe file descriptor"</span></span>); close(pipefd[<span class="hljs-number"><span class="hljs-number">0</span></span>]); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { buffer[bytes - <span class="hljs-number"><span class="hljs-number">1</span></span>] = <span class="hljs-string"><span class="hljs-string">'\0'</span></span>; } .... }</code> </pre> <br>  Bytes werden aus der Pipe in den Puffer eingelesen.  Im Fehlerfall gibt die Funktion <i>lxc_read_nointr</i> einen negativen Wert zur√ºck.  Wenn alles gut gegangen ist, wird das Null-Terminal als letztes Element geschrieben.  Wenn jedoch 0 Bytes gelesen werden, √ºberschreitet der Puffer die Grenzen, was zu undefiniertem Verhalten f√ºhrt. <br><br>  Der Analysator gab eine weitere √§hnliche Warnung aus: <br><br><ul><li>  V557 Array-Unterlauf ist m√∂glich.  Der Wert des Index 'Bytes - 1' k√∂nnte -1 erreichen.  network.c 2725 </li></ul><br><h3>  Puffer√ºberlauf </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">V576</a> Falsches Format.  √úberpr√ºfen Sie das dritte tats√§chliche Argument der Funktion 'sscanf'.  Es ist gef√§hrlich, einen String-Bezeichner ohne Breitenangabe zu verwenden.  Puffer√ºberlauf ist m√∂glich.  lxc_unshare.c 205 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">lookup_user</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *oparg, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uid_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *uid)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> name[PATH_MAX]; .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">sscanf</span></span>(oparg, <span class="hljs-string"><span class="hljs-string">"%u"</span></span>, uid) &lt; <span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-comment"><span class="hljs-comment">/* not a uid -- perhaps a username */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">sscanf</span></span>(oparg, <span class="hljs-string"><span class="hljs-string">"%s"</span></span>, name) &lt; <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-comment"><span class="hljs-comment">// &lt;= { free(buf); return false; } .... } .... }</span></span></code> </pre> <br>  Die Verwendung von <i>sscanf kann</i> in diesem Fall gef√§hrlich sein, da die L√§nge des <i>oparq-</i> Puffers gr√∂√üer als die L√§nge des <i>Namenspuffers</i> ist und bei der <i>Bildung</i> des <i>Namenspuffers</i> ins Ausland geht. <br><br><h2>  Fazit </h2><br>  Wie wir gesehen haben, ist das Einrichten einer statischen Code-Analyse-√úberpr√ºfung unseres Projekts in der Cloud eine ziemlich einfache Aufgabe.  Dazu m√ºssen Sie nur eine Datei zum Repository hinzuf√ºgen und die minimale Zeit f√ºr die Einrichtung des CI-Systems aufwenden.  Als Ergebnis erhalten wir ein Tool, mit dem Sie problematischen Code in der Schreibphase identifizieren k√∂nnen und das es Fehlern nicht erm√∂glicht, in die n√§chsten Testphasen zu gelangen, in denen ihre Korrektur mehr Zeit und Ressourcen in Anspruch nimmt. <br><br>  Die Verwendung von PVS-Studio in Verbindung mit Cloud-Plattformen ist nat√ºrlich nicht auf Travis CI beschr√§nkt.  In Analogie zu der im Artikel beschriebenen Methode kann die PVS-Studio-Analyse mit minimalen Unterschieden in andere g√§ngige Cloud-basierte CI-L√∂sungen wie CircleCI, GitLab usw. integriert werden. <br><br><h2>  N√ºtzliche Links </h2><br><ul><li>  Weitere Informationen zum Starten von PVS-Studio unter Linux und MacOS finden Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> . </li><li>  Informationen zum Erstellen, Konfigurieren und Verwenden von Containern mit dem installierten statischen PVS-Studio-Analyseger√§t finden Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> . </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">TravisCI-Dokumentation</a> . </li></ul><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/898/3b6/5a7/8983b65a74adb29a2113eba12fbec3f1.png" align="left"></a> </p><br><br>  Wenn Sie diesen Artikel einem englischsprachigen Publikum zug√§nglich machen m√∂chten, verwenden Sie bitte den Link zur √úbersetzung: Oleg Andreev.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">PVS-Studio in den Clouds - Ausf√ºhren der Analyse auf Travis CI</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de458072/">https://habr.com/ru/post/de458072/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de458060/index.html">Erstellen eines Grasshaders in der Unity-Engine</a></li>
<li><a href="../de458062/index.html">√úbersicht √ºber die UserGate-Plattform</a></li>
<li><a href="../de458064/index.html">PVS-Studio in den Clouds - Ausf√ºhren der Analyse auf Travis CI</a></li>
<li><a href="../de458068/index.html">PVS-Studio f√ºr Visual Studio</a></li>
<li><a href="../de458070/index.html">PVS-Studio f√ºr Visual Studio</a></li>
<li><a href="../de458074/index.html">Gehe zu Sprache: ORM-Auswahl</a></li>
<li><a href="../de458076/index.html">Marketing mit ML-Entscheidungsfindung</a></li>
<li><a href="../de458080/index.html">25. Juli, Moskau - QIWI iOS Meetup</a></li>
<li><a href="../de458084/index.html">50 ausgew√§hlte Materialien √ºber das Einkommen von Musikern, Sound in Spielen und Filmen, ungew√∂hnliche Instrumente und das vergessene Alte</a></li>
<li><a href="../de458088/index.html">Beste Linux-Distributionen f√ºr √§ltere Computer</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>