<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üè¥‚Äç‚ò†Ô∏è üöÄ ‚ûø Optimizando la carga de JavaScript en Wikipedia üôá üë©üèæ ‚õé</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="El autor del material, cuya traducci√≥n publicamos hoy, dice que √©l, a mediados de septiembre de 2019, finalmente complet√≥ el proyecto en el que ha est...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Optimizando la carga de JavaScript en Wikipedia</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/470874/">  El autor del material, cuya traducci√≥n publicamos hoy, dice que √©l, a mediados de septiembre de 2019, finalmente complet√≥ el proyecto en el que ha estado trabajando durante un a√±o.  El objetivo de este proyecto era reducir el tama√±o del manifiesto requerido para inicializar la canalizaci√≥n as√≠ncrona de JavaScript de Wikipedia.  Es decir, el tama√±o del manifiesto era 36 Kb.  Ten√≠a que caber en menos de 28 Kb, que corresponde a dos fragmentos de 14 kilobytes de la secuencia de paquetes de Internet. <br><br>  El resultado de este proyecto fue un ahorro diario de 4.3 terabytes de tr√°fico. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6fe/198/a19/6fe198a19b0e143d1bb82788cada2024.png"></div><br>  <i><font color="#999999">Al principio, el tama√±o del manifiesto super√≥ los 36 Kb, y despu√©s de la optimizaci√≥n, su tama√±o se hizo m√°s peque√±o que 28 Kb.</font></i> <br><br>  El gr√°fico muestra una disminuci√≥n gradual en el tama√±o del manifiesto.  Estamos hablando de datos comprimidos (es decir, es la carga neta en la red, lo que crea la transferencia de estos datos desde el servidor al navegador). <br><a name="habracut"></a><br><h2>  <font color="#3AC1EF">Proceso de optimizaci√≥n</font> </h2><br>  El manifiesto de inicializaci√≥n est√° representado por datos que no son f√°ciles de optimizar.  La mayor parte de su c√≥digo no es algo as√≠ como la l√≥gica funcional que se puede optimizar por medios tradicionales.  En cambio, casi todo el manifiesto est√° representado por datos puros.  Estos datos son generados autom√°ticamente por el sistema de entrega de contenido <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ResourceLoader</a> .  Son un registro de paquetes de m√≥dulos.  Wikipedia utiliza el sistema ResourceLoader para trabajar con JavaScript, CSS y recursos de texto. <br><br>  El registro incluye metadatos para todas las funcionalidades front-end implementadas en Wikipedia.  El manifiesto enumera los nombres de los paquetes, sus versiones actuales, sus dependencias de otros paquetes similares se describen aqu√≠. <br><br>  Comenc√© buscando c√≥digo que nunca se us√≥ en la pr√°ctica ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">T202154</a> ).  Esto incluy√≥ encontrar piezas de c√≥digo incompletas u olvidadas relacionadas con caracter√≠sticas heredadas.  El c√≥digo no utilizado se elimin√≥ de inmediato para garantizar la compatibilidad con los navegadores que ya no pasaron nuestra prueba, lo que asegur√≥ su inclusi√≥n en el grupo de navegadores modernos ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Grado A</a> ).  Tambi√©n prepar√© un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">documento</a> sobre el rendimiento de carga de la p√°gina.  Este documento sirvi√≥ como referencia, permitiendo a los desarrolladores comprender el impacto de los cambios de varios tipos en las diversas etapas del proceso de carga de la p√°gina. <br><br><h2>  <font color="#3AC1EF">Reduce la cantidad de m√≥dulos</font> </h2><br>  El siguiente paso fue colaborar con los equipos de ingenier√≠a de la Fundaci√≥n Wikimedia y Wikimedia Deutschland.  Necesit√°bamos descubrir qu√© caracter√≠sticas del sistema usan una cantidad excesiva de m√≥dulos.  Por ejemplo, habiendo entendido esto, ser√≠a posible combinar paquetes previamente dispersos a partir de los cuales se construy√≥ una cierta funcionalidad.  Dichos paquetes, incluso en un estado disperso, siempre se cargan juntos.  Esto llevar√≠a al hecho de que habr√≠a menos puntos finales en el sistema cuyos metadatos deber√≠an almacenarse en el registro formado por ResourceLoader. <br><br>  Aqu√≠ hay algunos puntos interesantes sobre la aplicaci√≥n de este enfoque de optimizaci√≥n: <br><br><ul><li>  La extensi√≥n WikiEditor ahora tiene 11 m√≥dulos menos que antes.  Se eliminaron otros 31 m√≥dulos de UploadWizard. </li><li>  Al optimizar el programa ContentTranslation, se combinaron 24 m√≥dulos. </li><li>  El proyecto MobileFrontend combina 25 m√≥dulos. </li><li>  20 m√≥dulos eliminados de RevisionSlider y TwoColConflict. </li></ul><br>  Tambi√©n es muy importante que el cliente de Wikidata para Wikipedia haya sido optimizado.  Esta parte del trabajo en s√≠ fue un proyecto √©pico ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">T203696</a> ).  Inicialmente, 248 m√≥dulos individuales fueron responsables de implementar esta caracter√≠stica.  Despu√©s de que pudimos deshacernos de m√°s de 200 m√≥dulos, solo hab√≠a 42 de ellos. <br><br>  El diagrama anterior muestra las peque√±as mejoras que se hicieron al proyecto durante el a√±o.  Todos ellos nos acercaron a la meta.  Especialmente me gustar√≠a notar dos grandes ca√≠das en el tama√±o del manifiesto.  Una de esas ca√≠das ocurri√≥ en la primera semana de agosto.  Fue entonces cuando se implement√≥ una versi√≥n mejorada de Wikidata.  La segunda ca√≠da en el tama√±o se puede observar al final del gr√°fico.  Sucedi√≥ a mediados de septiembre.  Ahora me gustar√≠a contarte sobre √©l. <br><br><h2>  <font color="#3AC1EF">Reduce los tama√±os de metadatos</font> </h2><br>  La mejora en el manifiesto que ocurri√≥ a mediados de septiembre fue posible gracias a dos cambios globales que apuntaban a una organizaci√≥n de datos m√°s inteligente. <br><br>  La primera mejora es que, anteriormente, los metadatos del esquema de extensi√≥n <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">EventLogging</a> formaban parte del manifiesto principal.  Este mecanismo se refactoriz√≥, por lo que los metadatos del esquema ahora se incluyeron en el paquete JS del cliente EventLogging.  Como resultado, la contribuci√≥n al tama√±o del manifiesto realizada anteriormente por EventLogging se ha reducido en m√°s del 90%.  ¬°Esto significa que la ruta cr√≠tica ahora contiene 2 KB menos de datos!  Esto, adem√°s, significaba que expandir las capacidades de EventLogging ya no conduc√≠a a un aumento en el tama√±o del manifiesto.  Al ensamblar dichos paquetes <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">, se utiliz√≥</a> una nueva caracter√≠stica de ResourceLoader, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Package Files</a> .  Esta caracter√≠stica se introdujo en febrero de 2019, uno de los motivos de inter√©s es el hecho de que podr√≠a ayudar a reducir la cantidad de m√≥dulos en el registro.  Package Files simplifica enormemente el proceso de combinar datos generados y c√≥digo JavaScript en un solo m√≥dulo. <br><br>  La segunda mejora ocurri√≥ cuando redujimos el tama√±o promedio de cada entrada de registro ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">T229245</a> ).  El manifiesto contiene dos entradas para cada m√≥dulo.  Este es el nombre del m√≥dulo y el identificador (ID) de su versi√≥n.  El identificador de versi√≥n necesitaba previamente 7 bytes de datos.  Despu√©s de pensar en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">la paradoja del cumplea√±os</a> en el contexto de ResourceLoader, decidimos que el espectro de probabilidad para las ID de versi√≥n podr√≠a reducirse de forma segura de 78 mil millones a "solo" 60 millones.  Los detalles sobre esto se pueden encontrar en los <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">comentarios del</a> c√≥digo.  Pero, para resumir esta mejora, podemos decir que esto nos permiti√≥ guardar 2 bytes en la descripci√≥n de cada uno de los 1,100 m√≥dulos que todav√≠a est√°n en el registro.  Como resultado, el tama√±o del manifiesto se redujo en otros 2-3 Kb. <br><br>  A continuaci√≥n se muestra un fragmento ampliado del diagrama que muestra los √∫ltimos d√≠as de funcionamiento (estos indicadores se toman del sistema de monitoreo sint√©tico, aqu√≠ se utilizan datos sin comprimir). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cfb/f35/fad/cfbf35fad375e7141350e3e432039c22.png"></div><br>  <i><font color="#999999">Cambio de tama√±o manifiesto en la etapa final de un proyecto</font></i> <br><br>  El cambio fue capturado por el sistema de monitoreo ResourceLoader.  La captura de pantalla muestra el panel de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">tama√±o del manifiesto de inicio</a> ubicado en una instancia p√∫blica de Grafana.  Aqu√≠ puede ver que el tama√±o del flujo de datos sin comprimir disminuy√≥ en 2,8 Kb. <br><br>  El despliegue del sistema, que tuvo lugar a mediados de septiembre, condujo al logro del objetivo original, que era comprimir el manifiesto a un tama√±o que no superara los 28 Kb.  La implementaci√≥n de este proyecto a gran escala llev√≥ al hecho de que el manifiesto de inicializaci√≥n se redujo en 9 Kb (estamos hablando de datos comprimidos).  Hace un a√±o, este tama√±o era de 36.2 Kb, y despu√©s de la finalizaci√≥n del proyecto ya era de 27.2 Kb. <br><br>  Alrededor de 363,000 visitas a la p√°gina se generan cada minuto en Wikipedia y proyectos relacionados.  En una hora: 21 millones y 800 mil.  Diariamente: 523 millones ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠ est√°n las</a> estad√≠sticas sobre las visitas a la p√°gina).  Esa versi√≥n del sistema, que se implement√≥ a mediados de septiembre, gener√≥ un ahorro de aproximadamente 1,4 terabytes de tr√°fico por d√≠a.  Y si compara lo que es hoy con lo que era hace un a√±o, resulta que 4.3 terabytes de tr√°fico ahora se guardan diariamente. <br><br><h2>  <font color="#3AC1EF">Que sigue</font> </h2><br>  Logramos ajustar el manifiesto de inicializaci√≥n de Wikipedia de 28 Kb.  Este es el tama√±o que se eligi√≥ debido al hecho de que es el tama√±o m√°s peque√±o que es un m√∫ltiplo de 14 Kb.  Los datos de este tama√±o se pueden colocar en fragmentos de la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">secuencia de</a> paquetes <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">de</a> Internet transmitidos al navegador. <br><br>  Ahora nos enfrentamos a una nueva tarea: no renunciar a los puestos.  En el √∫ltimo a√±o, he estado observando de cerca el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">manifiesto</a> .  Hice esto para asegurarme de nuestros √©xitos y descubrir posibles problemas que nos est√°n retrasando.  Al final, automatic√© este proceso usando el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">tablero</a> p√∫blico de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Grafana</a> . <br><br>  Si cree en este panel, todav√≠a tenemos muchas oportunidades para mejorar el empaque del c√≥digo y para resolver problemas que son a√∫n m√°s fuertes que ahora, facilitar la creaci√≥n de paquetes.  Espero que estas pr√≥ximas mejoras nos sean √∫tiles, pero por ahora estamos trabajando en nuevas caracter√≠sticas del sistema, mientras nos esforzamos por cumplir con los requisitos para el nivel de rendimiento del proyecto. <br><br>  <b>Estimados lectores!</b>  ¬øAlguna vez ha participado en la optimizaci√≥n de grandes proyectos de Internet? <br><br><div style="text-align:center;"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><img src="https://habrastorage.org/webt/it/t5/3p/itt53pns2iucwylb3bwn1fmmtnu.png"></a> </div><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/470874/">https://habr.com/ru/post/470874/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../470858/index.html">Antig√ºedades: punto de referencia del 386 ¬∞ procesador y de los elegantes noventa</a></li>
<li><a href="../470864/index.html">Sobre las delicias de cambiar al panel y no solo</a></li>
<li><a href="../470868/index.html">Tiempo para el primer byte: qu√© es y por qu√© es importante</a></li>
<li><a href="../470870/index.html">Precarga de fuentes</a></li>
<li><a href="../470872/index.html">M√©tricas de rendimiento para investigar aplicaciones web incre√≠blemente r√°pidas</a></li>
<li><a href="../470876/index.html">Cree construcciones de sintaxis JavaScript personalizadas con Babel. Parte 1</a></li>
<li><a href="../470878/index.html">Cree construcciones de sintaxis JavaScript personalizadas con Babel. Parte 2</a></li>
<li><a href="../470880/index.html">Mec√°nica del juego. Aventura, el concepto de terapia del habla cero y convincente</a></li>
<li><a href="../470882/index.html">¬øPor qu√© atrapaste mi mouse o un juego de mesa como modelo de interacci√≥n social?</a></li>
<li><a href="../470884/index.html">Escribir y leer datos en la cadena de bloques de Bitcoin</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>