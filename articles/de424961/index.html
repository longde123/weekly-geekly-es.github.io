<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üÜó üëàüèº üò≤ MTA-STS f√ºr Postfix üë©‚Äçüç≥ üîè ‚ôåÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="MTA-STS ist der vorgeschlagene RFC8461- Standard, der aus dem Entwurfsstatus herausgegangen ist und am 26. September 2018 offiziell ver√∂ffentlicht wur...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>MTA-STS f√ºr Postfix</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/424961/">  MTA-STS ist der vorgeschlagene <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">RFC8461-</a> Standard, der aus dem Entwurfsstatus herausgegangen ist und am 26. September 2018 offiziell ver√∂ffentlicht wurde.  Dieser Standard bietet einen Mechanismus zum Erkennen der M√∂glichkeit der Verwendung von vollst√§ndigem TLS zwischen Mailservern mit Datenverschl√ºsselung und Serverauthentifizierung.  Das hei√üt, dieser Standard sch√ºtzt fast vollst√§ndig vor St√∂rungen des E-Mail-Verkehrs zwischen Servern. <br><br>  Vereinfacht ausgedr√ºckt lautet der Kern des Standards wie folgt: <br><br><ol><li>  Unterst√ºtzende Mail-Dienste ver√∂ffentlichen eine Richtlinie (1 TXT-Datensatz und 1 HTTPS-Ressource f√ºr jede Dom√§ne). </li><li>  E-Mail-Dienste erkennen beim Senden von E-Mails an andere Dom√§nen die Empf√§ngerdom√§nenrichtlinie. </li><li>  Mail-Dienste stellen eine Verbindung zum Mail-Server der Empf√§ngerdom√§ne her und wenden gegebenenfalls die in der erkannten Richtlinie festgelegten TLS-Einschr√§nkungen an. </li></ol><br>  Es gibt gute Artikel ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">zum Beispiel</a> ), die √ºber den Standard selbst und warum er ben√∂tigt wird, MTA-STS mit anderen √§hnlichen Initiativen vergleichen und sogar zeigen, wie eine Richtlinie geschrieben und ver√∂ffentlicht wird.  Es war jedoch nicht so einfach zu finden, wie man √ºber den ersten Schritt hinausgeht. <a name="habracut"></a><br><br><h3>  Fangen Sie von vorne an </h3><br>  Vor der Implementierung von MTA-STS m√ºssen Sie die Mailserver-Zertifikate aufr√§umen.  Andernfalls lehnen Mailserver, die Ihre STS-Richtlinie ber√ºcksichtigen, die Verbindung zu Ihrem Server ab.  Folgende Bedingungen m√ºssen erf√ºllt sein: <br><br><ul><li>  Das Serverzertifikat wird von einer anerkannten Zertifizierungsstelle ausgestellt (Let's Encrypt ist gut). </li><li>  Die vom Server gesendete Zertifikatskette enth√§lt alle erforderlichen Zertifikate von Zwischenzertifizierungsstellen. </li><li>  Das Zertifikat enth√§lt ein Feld f√ºr den alternativen Antragstellernamen mit dem DNS-Namen Ihres MX-Servers. </li></ul><br>  Sie k√∂nnen den konfigurierten Server mit dem Zertifikat mit dem folgenden Befehl √ºberpr√ºfen: <br><br><pre><code class="bash hljs">[ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$(LANG=C openssl s_client -connect MX.EXAMPLE.COM:25 -starttls smtp -verify_hostname MX.EXAMPLE.COM &lt; /dev/null 2&gt;&amp;1 | fgrep 'error')</span></span></span><span class="hljs-string">"</span></span> = <span class="hljs-string"><span class="hljs-string">""</span></span> ] &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> OK || <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> FAIL</code> </pre> <br>  Dabei ist MX.EXAMPLE.COM der Dom√§nenname Ihres MX-Servers.  Um den Standard vollst√§ndig einzuhalten, ist es ratsam zu √ºberpr√ºfen, ob der gew√ºnschte Domainname nicht nur im allgemeinen Namen des Zertifikats, sondern zumindest im alternativen Antragstellernamen vorhanden ist. <br><br><h3>  Richtlinienbuchung </h3><br>  Um Ihre Domain als Unterst√ºtzung einer sicheren Verbindung mit ihr zu kennzeichnen, m√ºssen Sie die MTA-STS-Richtlinie ver√∂ffentlichen.  F√ºhren Sie dazu die folgenden einfachen Schritte in der angegebenen Reihenfolge aus (Beispiele f√ºr die Domain example.com). <br><br>  1. Platzieren bei <br><br><pre>  https://mta-sts.example.com/.well-known/mta-sts.txt </pre><br>  Textdatei des Formulars: <br><br><pre> Version: STSv1
 Modus: erzwingen
 mx: mail.example.com
 mx: * .example.net
 mx: backupmx.example.com
 max_age: 604800
</pre><br>  Die Datei muss mit dem Inhaltstyp angegeben werden: text / plain.  Weiterleitungen sind nicht zul√§ssig.  Zeilenvorsch√ºbe m√ºssen entweder LF oder CRLF sein.  Leere Zeilen sind nicht erlaubt.  Die letzte Zeile endet m√∂glicherweise mit einem Zeilenvorschub oder nicht damit - beide Optionen sind zul√§ssig.  Leerzeichen vor dem Doppelpunkt und am Zeilenanfang sind nicht zul√§ssig.  Der leere Raum nach dem Doppelpunkt ist in beliebiger Menge zul√§ssig.  Leerzeichen (Leerzeichen, Tabulatoren usw.) am Ende jeder Zeile werden ignoriert. <br><br>  Feldwerte: <br><br>  <b>version</b> : format version.  Es sollte immer gleich "STSv1" sein. <br>  <b>Modus</b> : Richtlinienmodus.  M√∂gliche Optionen: keine, testen, erzwingen.  Der Erzwingungsmodus entspricht der normalen Funktionsweise des Standards - f√ºr die Verbindung zum Server ist das richtige Zertifikat und eine stabile TLS-Verbindung erforderlich.  Im Testmodus m√ºssen Sie versuchen, eine sichere Verbindung zu verwenden. Im Fehlerfall senden Sie jedoch auf jeden Fall eine E-Mail mit einer Administratorbenachrichtigung √ºber den TLSRPT-Mechanismus.  Der Modus "Kein" entspricht der Situation, als ob die Richtlinie √ºberhaupt nicht ver√∂ffentlicht wurde.  Dieser Modus ist n√ºtzlich, um eine Richtlinie ordnungsgem√§√ü zu deaktivieren. <br>  <b>mx</b> : Ein oder mehrere Felder mit den Namen aller zul√§ssigen MX-Dom√§nenserver.  Wie Sie dem Beispiel entnehmen k√∂nnen, sind Vorlagen zul√§ssig, jedoch nur als untergeordnete Dom√§ne. <br>  <b>max_age</b> : Die Zeit in Sekunden, in der die Richtlinie zwischengespeichert werden kann und w√§hrend der Absender sie weiterhin verwenden k√∂nnen, wenn die Richtlinie nicht mehr verf√ºgbar ist.  Aufgrund dieser Standardfunktion ist das Deaktivieren von STS schneller, wenn eine neue Richtlinie ohne Modus ver√∂ffentlicht wird. <br><br>  2. Erstellen Sie einen TXT-Datensatz _mta-sts.example.com mit dem Inhalt des Formulars: <br><br><pre>  v = STSv1;  id = 20160831085700Z; </pre><br>  Leerzeichen um ein Semikolon k√∂nnen beliebig in beliebiger Menge angeordnet werden.  An anderen Stellen ist Leerzeichen nicht zul√§ssig.  Das letzte Semikolon kann entweder vorhanden sein oder fehlen. <br><br>  Feldwerte: <br><br>  <b>v</b> : Formatversion.  Es muss immer das erste Feld sein, es muss immer gleich STSv1 sein. <br>  <b>id</b> : eindeutige Kennung der ver√∂ffentlichten Richtlinie.  Es kann sich um eine Zeichenfolge mit einer L√§nge von 1 bis 32 Zeichen handeln, die aus Buchstaben von Registern und Zahlen besteht.  Das √Ñndern des ID-Werts ist ein Signal an die Absender, dass die Richtlinie aktualisiert wurde.  Daher m√ºssen Sie die Richtlinie aktualisieren, indem Sie zuerst eine neue Richtliniendatei ver√∂ffentlichen und dann die ID im TXT-Datensatz √§ndern. <br><br>  Von nun an senden Mailserver, die MTA-STS unterst√ºtzen, E-Mails nur noch √ºber eine sichere zertifikatauthentifizierte Verbindung an Ihre Domain.  Hier enden die meisten Handb√ºcher, aber der interessanteste Teil besteht darin, die MTA-STS-Richtlinie beim Senden von E-Mails von Ihrem eigenen Server abzurufen. <br><br><h3>  Am interessantesten </h3><br>  Die Hauptschwierigkeit besteht darin, dass dieser Standard von Mailservern, einschlie√ülich Postfix, nicht unterst√ºtzt wird.  Diese unangenehme Kleinigkeit sollte uns jedoch nicht aufhalten. <br><br>  Die Suche nach einer L√∂sung f√ºhrte mich zum Mailinglisten-Archiv der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Postfix-Benutzer, in dem</a> das Timing dieses Standards besprochen wurde.  In einem Beitrag weist Witsa Venema, Autorin von Postfix, auf die bevorzugte Richtung f√ºr die Implementierung dieser Funktionalit√§t hin - die Verwendung eines externen Servers zur Suche nach TLS-Richtlinien.  Es wird vorgeschlagen, die Konfigurationsanweisung des Formulars zu verwenden: <br><br><pre>  smtp_policy_maps = socketmap: inet: host: port: name </pre><br>  Ich habe einen solchen Server implementiert, um die MTA-STS-Richtlinie zu erhalten. <br><br>  ‚Üí <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Quellcode</a> <br>  ‚Üí <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Paket in PyPI</a> <br><br>  Der Anwendung fehlen einige der von RFC8461 vorgeschriebenen Funktionen, z. B. proaktives Abrufen von Richtlinien, Berichte und Begrenzen der H√§ufigkeit von Richtlinienanforderungen.  Die Hauptfunktion - Erkennen und Zwischenspeichern der TLS-Richtlinie - wird jedoch ausgef√ºhrt. <br><br>  Die App ben√∂tigt Python 3.5.3+.  Die Installation und Konfiguration dieses D√§mons kann mithilfe der folgenden Schritte erfolgen. <br><br><h4>  Paketinstallation </h4><br>  Es reicht aus, den Befehl auszuf√ºhren: <br><br><pre> <code class="bash hljs">pip3 install postfix-mta-sts-resolver</code> </pre> <br>  Hier werden alternative Installationsmethoden beschrieben. <br><br><h4>  Konfigurationsdatei erstellen </h4><br>  Wenn Sie mit den Standardeinstellungen zufrieden sind, reicht der Befehl aus <br><br><pre> <code class="bash hljs">touch /etc/postfix/mta-sts-daemon.yml</code> </pre> <br>  Andernfalls kann die Konfiguration dem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Beispiel</a> entnommen und auf Ihre Anforderungen zugeschnitten werden. <br><br>  Der wichtigste Parameter ist meiner Meinung nach der Parameter strict_testing.  Wenn der Wert auf true gesetzt ist (standardm√§√üig false), gibt die Anwendung auch f√ºr Dom√§nen mit einer Richtlinie im Testmodus eine sichere Richtlinie zur√ºck.  Dieses Verhalten ist gegen den Standard, aber aus praktischen Gr√ºnden ratsam: Wenn der Domaininhaber die STS-Richtlinie auch im Testmodus ver√∂ffentlicht hat, ist er wahrscheinlich bereit daf√ºr.  Das hei√üt, dann wird heute die Mail von gmail.com √ºber eine zuverl√§ssige Verbindung gesendet. <br><br><h4>  Startorganisation </h4><br>  Im Fall von systemd reicht es aus, eine <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">einfache Einheitendatei</a> in /etc/systemd/system/mta-sts-daemon.service abzulegen <br><br>  Danach m√ºssen Sie die Systemkonfiguration erneut lesen, den Autorun des D√§mons aktivieren und starten: <br><br><pre> <code class="bash hljs">systemctl daemon-reload systemctl <span class="hljs-built_in"><span class="hljs-built_in">enable</span></span> mta-sts-daemon.service systemctl start mta-sts-daemon.service</code> </pre> <br><h4>  Gesundheitscheck </h4><br>  Angenommen, der Standardport wird verwendet, der Befehl <br><br><pre> <code class="bash hljs">/usr/sbin/postmap -q dismail.de socketmap:inet:127.0.0.1:8461:postfix</code> </pre> <br>  sollte bringen <br><br><pre>  sichere √úbereinstimmung = mx1.dismail.de </pre><br><h4>  Stellen Sie eine Verbindung zu Postfix her </h4><br>  F√ºgen Sie eine Zeile zu main.cf hinzu: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">smtp_policy_maps</span></span> = socketmap:inet:<span class="hljs-number"><span class="hljs-number">127.0.0.1:8461</span></span>:postfix</code> </pre> <br>  Postfix neu starten: <br><br><pre> <code class="bash hljs">systemctl reload postfix.service</code> </pre> <br>  Wenn alles richtig gemacht wurde, dann f√ºr STS-Verbindungen im Protokoll /var/log/mail.info <br><br><pre>  Vertrauensw√ºrdige TLS-Verbindung hergestellt </pre><br>  Datens√§tze werden angezeigt <br><br><pre>  Verifizierte TLS-Verbindung hergestellt </pre><br><br><h3>  Fazit </h3><br>  Wenn Sie an diesen Ort gelangen, bedeutet dies h√∂chstwahrscheinlich: <br><br><ul><li>  Sie lesen den Artikel ohne ein einziges Bild. </li><li>  Von Tag zu Tag sinkt die Wahrscheinlichkeit, dass E-Mails in Ihrer Domain abgefangen werden, da andere E-Mail-Dienste den neuen Standard implementieren. </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de424961/">https://habr.com/ru/post/de424961/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de424947/index.html">Gestenerkennung mit APDS-9960</a></li>
<li><a href="../de424949/index.html">PHP Digest Nr. 140 (17. - 30. September 2018)</a></li>
<li><a href="../de424951/index.html">Hurra! Es war keine Paranoia</a></li>
<li><a href="../de424955/index.html">Die Verdauung von frischen Materialien aus der Welt des Frontends f√ºr die letzte Woche Nr. 332 (24. - 30. September 2018)</a></li>
<li><a href="../de424957/index.html">Generieren von Bildern aus Text mit AttnGAN</a></li>
<li><a href="../de424963/index.html">Zuckerberg-Finanzierung: Gemeinsam Werkzeuge f√ºr die Wissenschaft bauen</a></li>
<li><a href="../de424965/index.html">Reagieren Sie auf die Anwendungsentwicklung mit ReasonReact</a></li>
<li><a href="../de424967/index.html">JavaScript-Verkn√ºpfungen f√ºr Anf√§nger</a></li>
<li><a href="../de424969/index.html">Node.js-Handbuch, Teil 9: Arbeiten mit dem Dateisystem</a></li>
<li><a href="../de424971/index.html">Habrokast "Sunset Manually" # 1. Versuch, eine Umgebung f√ºr die Entwicklung eines Spielzeugs f√ºr Windows einzurichten</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>