<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>â›¹ğŸ» ğŸ‘’ ğŸ”¶ åœ¨BASCOM AVRç¯å¢ƒä¸­ç”¨äºMK AVRçš„AQUA RTOSå®æ—¶æ“ä½œç³»ç»Ÿ ğŸš´ğŸ¾ ğŸ¥™ ğŸ¤šğŸ»</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="å½“ç¼–å†™æ¯”â€œé—ªçƒç¯â€æ›´å¤æ‚çš„MKä»£ç æ—¶ï¼Œå¼€å‘äººå‘˜å°†é¢ä¸´â€œè¶…çº§å¾ªç¯åŠ ä¸­æ–­â€é£æ ¼çš„çº¿æ€§ç¼–ç¨‹å›ºæœ‰çš„å±€é™æ€§ã€‚ å¤„ç†ä¸­æ–­éœ€è¦é€Ÿåº¦å’Œç®€æ´æ€§ï¼Œè¿™ä¼šå¯¼è‡´åœ¨ä»£ç ä¸­æ·»åŠ æ ‡å¿—ï¼Œå¹¶ä½¿é¡¹ç›®æ ·å¼â€œå¸¦æœ‰ä¸­æ–­å’Œæ ‡å¿—çš„è¶…å¾ªç¯â€ã€‚ 

 å¦‚æœç³»ç»Ÿçš„å¤æ‚æ€§å¢åŠ ï¼Œåˆ™ç›¸äº’ä¾èµ–æ ‡å¿—çš„æ•°é‡å°†æˆå€å¢åŠ ï¼Œå¹¶ä¸”è¯¥é¡¹ç›®å°†è¿…é€Ÿå˜æˆå¯è¯»æ€§å·®ä¸”æ˜“äºç®¡ç†çš„â€œæ„å¤§...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>åœ¨BASCOM AVRç¯å¢ƒä¸­ç”¨äºMK AVRçš„AQUA RTOSå®æ—¶æ“ä½œç³»ç»Ÿ</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/453708/">å½“ç¼–å†™æ¯”â€œé—ªçƒç¯â€æ›´å¤æ‚çš„MKä»£ç æ—¶ï¼Œå¼€å‘äººå‘˜å°†é¢ä¸´â€œè¶…çº§å¾ªç¯åŠ ä¸­æ–­â€é£æ ¼çš„çº¿æ€§ç¼–ç¨‹å›ºæœ‰çš„å±€é™æ€§ã€‚ å¤„ç†ä¸­æ–­éœ€è¦é€Ÿåº¦å’Œç®€æ´æ€§ï¼Œè¿™ä¼šå¯¼è‡´åœ¨ä»£ç ä¸­æ·»åŠ æ ‡å¿—ï¼Œå¹¶ä½¿é¡¹ç›®æ ·å¼â€œå¸¦æœ‰ä¸­æ–­å’Œæ ‡å¿—çš„è¶…å¾ªç¯â€ã€‚ <br><br> å¦‚æœç³»ç»Ÿçš„å¤æ‚æ€§å¢åŠ ï¼Œåˆ™ç›¸äº’ä¾èµ–æ ‡å¿—çš„æ•°é‡å°†æˆå€å¢åŠ ï¼Œå¹¶ä¸”è¯¥é¡¹ç›®å°†è¿…é€Ÿå˜æˆå¯è¯»æ€§å·®ä¸”æ˜“äºç®¡ç†çš„â€œæ„å¤§åˆ©é¢ä»£ç â€ã€‚ <br><br> å®æ—¶æ“ä½œç³»ç»Ÿçš„ä½¿ç”¨æœ‰åŠ©äºæ‘†è„±â€œ pastaä»£ç â€ï¼Œå¹¶å°†çµæ´»æ€§å’Œå¯ç®¡ç†æ€§è¿”å›ç»™å¤æ‚çš„MKé¡¹ç›®ã€‚ <br> å·²ç»å¼€å‘äº†å‡ ç§åä½œå¼å®æ—¶æ“ä½œç³»ç»Ÿï¼Œå¹¶åœ¨AVRå¾®æ§åˆ¶å™¨ä¸­éå¸¸æµè¡Œã€‚ ä½†æ˜¯ï¼Œå®ƒä»¬éƒ½æ˜¯ç”¨Cæˆ–æ±‡ç¼–è¯­è¨€ç¼–å†™çš„ï¼Œå› æ­¤ä¸é€‚åˆåœ¨BASCOM AVRç¯å¢ƒä¸­å¯¹MKè¿›è¡Œç¼–ç¨‹çš„äººå‘˜ï¼Œè¿™ä½¿å®ƒä»¬å¤±å»äº†ç¼–å†™ä¸¥é‡åº”ç”¨ç¨‹åºçš„æœ‰ç”¨å·¥å…·ã€‚ <br><br> ä¸ºäº†çº æ­£æ­¤ç¼ºç‚¹ï¼Œæˆ‘ä¸ºBASCOM AVRç¼–ç¨‹ç¯å¢ƒå¼€å‘äº†ä¸€ä¸ªç®€å•çš„RTOSï¼Œå¼•èµ·äº†è¯»è€…çš„æ³¨æ„ã€‚ <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cd6/0be/c64/cd60bec64b2a0b96ed562770a9063355.jpg" alt="å›¾ç‰‡"><br><a name="habracut"></a><br> å¯¹äºè®¸å¤šäººæ¥è¯´ï¼Œç†Ÿæ‚‰çš„MKç¼–ç¨‹é£æ ¼å°±æ˜¯æ‰€è°“çš„  <i>è¶…å¾ªç¯</i> ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä»£ç ç”±ä¸€ç»„å‡½æ•°ï¼Œè¿‡ç¨‹å’Œæè¿°ç¬¦ï¼ˆå¸¸é‡ï¼Œå˜é‡ï¼‰ï¼ˆå¯èƒ½æ˜¯åº“å‡½æ•°ï¼‰ï¼ˆé€šå¸¸ç§°ä¸ºâ€œèƒŒæ™¯ä»£ç â€ï¼‰ä»¥åŠåŒ…å›´åœ¨<b>do-loop</b>ç»“æ„ä¸­çš„å¤§å‹æ— é™å¾ªç¯ç»„æˆã€‚ åœ¨å¯åŠ¨æ—¶ï¼Œé¦–å…ˆå¯¹MKæœ¬èº«çš„è®¾å¤‡å’Œå¤–éƒ¨è®¾å¤‡è¿›è¡Œåˆå§‹åŒ–ï¼Œè®¾ç½®å˜é‡çš„å¸¸é‡å’Œåˆå§‹å€¼ï¼Œç„¶åå°†æ§åˆ¶æƒè½¬ç§»åˆ°è¯¥æ— é™è¶…å¾ªç¯ã€‚ <br> è¶…å¾ªç¯çš„ç®€å•æ€§æ˜¾è€Œæ˜“è§ã€‚  MKæ‰§è¡Œçš„å¤§å¤šæ•°ä»»åŠ¡ï¼Œå› ä¸ºä¸€ç§æ–¹å¼æˆ–å¦ä¸€ç§å‘¨æœŸæ€§ã€‚ ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼šå¦‚æœæŸäº›è®¾å¤‡æˆ–ä¿¡å·éœ€è¦ç«‹å³åšå‡ºååº”ï¼Œåˆ™MKå°†åœ¨å‘¨æœŸå‘¨è½¬ä¹‹å‰ç«‹å³æä¾›ã€‚ å¦‚æœä¿¡å·æŒç»­æ—¶é—´çŸ­äºå¾ªç¯å‘¨æœŸï¼Œåˆ™å°†è·³è¿‡è¯¥ä¿¡å·ã€‚ <br><br> åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬è¦æ£€æŸ¥æŒ‰é’®æ˜¯å¦è¢«<b>æŒ‰ä¸‹</b> ï¼š <br><br><pre><code class="vbscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-comment"><span class="hljs-comment">' -  if button = 1 then '     '  -  loop</span></span></code> </pre> <br> æ˜¾ç„¶ï¼Œå¦‚æœâ€œæŸäº›ä»£ç â€çš„å·¥ä½œæ—¶é—´è¶³å¤Ÿé•¿ï¼Œåˆ™MKå¯èƒ½ä¸ä¼šæ³¨æ„åˆ°çŸ­æŒ‰æŒ‰é’®ã€‚ <br><br> å¹¸è¿çš„æ˜¯ï¼ŒMKé…å¤‡äº†å¯ä»¥è§£å†³æ­¤é—®é¢˜çš„ä¸­æ–­ç³»ç»Ÿï¼šæ‰€æœ‰å…³é”®ä¿¡å·éƒ½å¯ä»¥â€œæŒ‚â€åœ¨ä¸­æ–­ä¸Šï¼Œå¹¶ä¸”å¯ä»¥ä¸ºæ¯ä¸ªä¸­æ–­ç¼–å†™å¤„ç†ç¨‹åºã€‚ å› æ­¤å‡ºç°äº†ä¸‹ä¸€ä¸ªå±‚æ¬¡ï¼š <i>å¸¦æœ‰ä¸­æ–­</i>çš„<i>è¶…çº§å¾ªç¯</i> ã€‚ <br> ä¸‹é¢çš„ç¤ºä¾‹æ˜¾ç¤ºäº†å…·æœ‰è¶…å¾ªç¯å’Œå¤„ç†æŒ‰é’®å•å‡»çš„ä¸­æ–­çš„ç¨‹åºç»“æ„ï¼š <br><br><pre> <code class="vbscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">on</span></span> button button_isr <span class="hljs-comment"><span class="hljs-comment">'    enable interrupts ' ***  *** do ' -  loop end '   button_isr: '  -    return</span></span></code> </pre> <br> ä½†æ˜¯ï¼Œä½¿ç”¨ä¸­æ–­ä¼šå¸¦æ¥ä¸€ä¸ªæ–°é—®é¢˜ï¼šä¸­æ–­å¤„ç†ç¨‹åºä»£ç åº”å°½å¯èƒ½å¿«ä¸”çŸ­ä¸€äº›ï¼› å†…éƒ¨ä¸­æ–­ï¼ŒMKåŠŸèƒ½å—åˆ°é™åˆ¶ã€‚ ç”±äºAVR MKæ²¡æœ‰åˆ†çº§ä¸­æ–­ç³»ç»Ÿï¼Œå› æ­¤å¦ä¸€ä¸ªä¸­æ–­ä¸èƒ½åœ¨ä¸­æ–­å†…éƒ¨å‘ç”Ÿ-æ­¤æ—¶å®ƒä»¬å·²è¢«ç¡¬ä»¶ç¦ç”¨ã€‚ å› æ­¤ï¼Œä¸­æ–­åº”å°½å¿«æ‰§è¡Œï¼Œå¦åˆ™å…¶ä»–ä¸­æ–­ï¼ˆå¯èƒ½æ›´é‡è¦çš„ä¸­æ–­ï¼‰å°†è¢«è·³è¿‡è€Œä¸è¿›è¡Œå¤„ç†ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">ä¸­æ–­è®°å¿†</b> <div class="spoiler_text"> å®é™…ä¸Šï¼Œåœ¨ä¸­æ–­å†…éƒ¨ï¼ŒMKèƒ½å¤Ÿåœ¨ç‰¹æ®Šå¯„å­˜å™¨ä¸­è®°å½•å¦ä¸€ä¸ªä¸­æ–­çš„äº‹å®ï¼Œä»¥ä¾¿ç¨åå¯¹å…¶è¿›è¡Œå¤„ç†ã€‚ ä½†æ˜¯ï¼Œæ­¤ä¸­æ–­ä¸èƒ½ç«‹å³å¤„ç†ã€‚ <br></div></div><br> å› æ­¤ï¼Œæˆ‘ä»¬ä¸èƒ½åœ¨ä¸­æ–­å¤„ç†ç¨‹åºä¸­å†™ä¸€äº›å¤æ‚çš„ä¸œè¥¿ï¼Œå°¤å…¶æ˜¯å¦‚æœè¯¥ä»£ç åº”è¯¥æœ‰å»¶è¿Ÿçš„è¯-å› ä¸ºç›´åˆ°å»¶è¿Ÿèµ·ä½œç”¨ï¼ŒMKæ‰ä¼šè¿”å›ä¸»ç¨‹åºï¼ˆè¶…çº§å¾ªç¯ï¼‰ï¼Œè€Œå¯¹å…¶ä»–ä¸­æ–­å´æ— æ‰€ä½œä¸ºã€‚ <br><br> å› æ­¤ï¼Œåœ¨ä¸­æ–­å¤„ç†ç¨‹åºå†…éƒ¨ï¼Œæ‚¨é€šå¸¸åªéœ€è¦ç”¨ä¸€ä¸ªæ ‡å¿—ï¼ˆæ¯ä¸ªäº‹ä»¶è‡ªå·±æ‹¥æœ‰ï¼‰æ¥æ ‡å¿—äº‹ä»¶çš„äº‹å®ï¼Œç„¶åæ£€æŸ¥å¹¶å¤„ç†è¶…å¾ªç¯å†…çš„æ ‡å¿—å³å¯ã€‚ å½“ç„¶ï¼Œè¿™ä¼šå»¶é•¿äº‹ä»¶å“åº”æ—¶é—´ï¼Œä½†æ˜¯è‡³å°‘æˆ‘ä»¬ä¸ä¼šé”™è¿‡ä¸€äº›é‡è¦çš„äº‹æƒ…ã€‚ <br><br> å› æ­¤ï¼Œå‡ºç°äº†ä¸‹ä¸€çº§çš„å¤æ‚æ€§- <i>å…·æœ‰ä¸­æ–­å’Œæ ‡å¿—</i>çš„è¶…<i>å¾ªç¯</i> ã€‚ <br><br> æ˜¾ç¤ºä»¥ä¸‹ä»£ç ï¼š <br><br><pre> <code class="vbscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">on</span></span> button button_isr <span class="hljs-comment"><span class="hljs-comment">'    enable interrupts ' ***  *** do ' -  if button_flag = 1 then '     button_flag = 0 '     end if '  -  loop end ' ***    *** button_isr: button_flag = 1 return</span></span></code> </pre> <br>  MKçš„è®¸å¤šç¨‹åºéƒ½å—æ­¤é™åˆ¶ã€‚ ä½†æ˜¯ï¼Œæ­¤ç±»ç¨‹åºé€šå¸¸æˆ–å¤šæˆ–å°‘ç®€å•ã€‚ å¦‚æœæ‚¨ç¼–å†™æ›´å¤æ‚çš„å†…å®¹ï¼Œé‚£ä¹ˆæ ‡å¿—çš„æ•°é‡å°†åƒæ»šé›ªçƒä¸€æ ·å¼€å§‹å¢åŠ ï¼Œå¹¶ä¸”ä»£ç å˜å¾—è¶Šæ¥è¶Šæ··ä¹±å’Œéš¾ä»¥ç†è§£ã€‚ æ­¤å¤–ï¼Œåœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œå»¶è¿Ÿé—®é¢˜å°šæœªè§£å†³ã€‚ å½“ç„¶ï¼Œæ‚¨å¯ä»¥åœ¨è®¡æ—¶å™¨ä¸Šâ€œæŒ‚èµ·â€å•ç‹¬çš„ä¸­æ–­ï¼Œå¹¶ä¸”åœ¨å…¶ä¸­...è¿˜å¯ä»¥æ§åˆ¶å„ç§æ ‡å¿—ã€‚ ä½†æ˜¯ï¼Œè¿™ä½¿ç¨‹åºå˜å¾—éå¸¸ä¸‘é™‹ï¼Œç›¸äº’ä¾èµ–æ ‡å¿—çš„æ•°é‡å‘ˆæŒ‡æ•°å¢é•¿ï¼Œç”šè‡³å¼€å‘äººå‘˜æœ¬äººä¹Ÿå¾ˆéš¾å¾ˆå¿«æ‰¾åˆ°è¿™æ ·çš„â€œ pastaä»£ç â€ã€‚ åœ¨å¼€å‘æ–°é¡¹ç›®çš„è¿‡ç¨‹ä¸­ï¼Œå°è¯•å‘ç°é”™è¯¯æˆ–ä¿®æ”¹ä»£ç é€šå¸¸å˜å¾—åŒç­‰é‡è¦ã€‚ <br><br> å¦‚ä½•è§£å†³â€œ Pasta Codeâ€çš„é—®é¢˜ï¼Œä½¿å…¶æ›´å…·å¯è¯»æ€§å’Œå¯ç®¡ç†æ€§ï¼Ÿ  <i>æ“ä½œç³»ç»Ÿ</i> ï¼ˆOSï¼‰å¯ä»¥è§£å†³ã€‚ åœ¨å…¶ä¸­ï¼ŒMKåº”è¯¥å®ç°çš„åŠŸèƒ½åˆ†ä¸ºä»»åŠ¡ï¼Œå…¶æ“ä½œç”±OSæ§åˆ¶ã€‚ <br><br><h2>  MKçš„æ“ä½œç³»ç»Ÿç±»å‹ </h2><br>  MKçš„æ“ä½œç³»ç»Ÿå¯ä»¥åˆ†ä¸ºä¸¤å¤§ç±»ï¼šæ‹¥æŒ¤çš„OSå’Œåä½œçš„OSã€‚ åœ¨ä»»ä½•è¿™äº›æ“ä½œç³»ç»Ÿä¸­ï¼Œä»»åŠ¡éƒ½æ˜¯ç”±ç§°ä¸º<i>è°ƒåº¦</i>ç¨‹åºçš„ç‰¹æ®Šè¿‡ç¨‹æ§åˆ¶çš„ã€‚ åœ¨<i>æ‹¥æŒ¤</i>çš„æ“ä½œç³»ç»Ÿä¸­<i>ï¼Œ</i>è°ƒåº¦ç¨‹åºå¯ä»¥éšæ—¶ç‹¬ç«‹åœ°å°†æ‰§è¡Œä»ä¸€ä¸ªä»»åŠ¡åˆ‡æ¢åˆ°å¦ä¸€ä¸ªä»»åŠ¡ï¼Œä¸ºæ¯ä¸ªä»»åŠ¡åˆ†é…ä¸€å®šæ•°é‡çš„æ—¶é’Ÿå‘¨æœŸï¼ˆå¯èƒ½ä¼šæœ‰æ‰€ä¸åŒï¼Œå…·ä½“å–å†³äºä»»åŠ¡çš„ä¼˜å…ˆçº§ï¼‰ã€‚ æ€»ä½“ä¸Šè®²ï¼Œè¿™ç§æ–¹æ³•å¾ˆå¥½ç”¨ï¼Œä½¿æ‚¨å®Œå…¨ä¸å¿…çœ‹ä»»åŠ¡çš„å†…å®¹ï¼šæ‚¨è‡³å°‘å¯ä»¥ç¼–å†™ä»»åŠ¡ä»£ç  <br><br><pre> <code class="vbscript hljs"><span class="hljs-number"><span class="hljs-number">1</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> <br>  -ä»å°†æ‰§è¡Œå…¶ä½™ä»»åŠ¡ï¼ˆåŒ…æ‹¬æ­¤ä»»åŠ¡ï¼‰ã€‚ ä½†æ˜¯ï¼ŒæŠ¢å å¼OSéœ€è¦å¤§é‡èµ„æºï¼ˆå¤„ç†å™¨å†…å­˜å’Œæ—¶é’Ÿå‘¨æœŸï¼‰ï¼Œå› ä¸ºæ¯ä¸ªå¼€å…³éƒ½åº”å®Œå…¨ä¿å­˜è¦ç¦ç”¨çš„ä»»åŠ¡çš„ä¸Šä¸‹æ–‡å¹¶åŠ è½½ç®€å†çš„ä¸Šä¸‹æ–‡ã€‚ è¿™é‡Œçš„ä¸Šä¸‹æ–‡æŒ‡çš„æ˜¯æœºå™¨å¯„å­˜å™¨å’Œå †æ ˆçš„å†…å®¹ï¼ˆBASCOMä½¿ç”¨ä¸¤ä¸ªå †æ ˆ-ç¡¬ä»¶ç”¨äºå­ç¨‹åºçš„è¿”å›åœ°å€ï¼Œè€Œè½¯ä»¶ç”¨äºå‚æ•°ä¼ é€’ï¼‰ã€‚ è¿™æ ·çš„è´Ÿè½½ä¸ä»…éœ€è¦å¤§é‡çš„å¤„ç†å™¨å‘¨æœŸï¼Œè€Œä¸”æ¯ä¸ªä»»åŠ¡çš„ä¸Šä¸‹æ–‡éƒ½éœ€è¦å­˜å‚¨ä¸€æ®µæ—¶é—´æ‰èƒ½å·¥ä½œã€‚ åœ¨æœ€åˆé¢å‘å¤šä»»åŠ¡çš„â€œå¤§å‹â€å¤„ç†å™¨ä¸­ï¼Œè¿™äº›åŠŸèƒ½é€šå¸¸åœ¨ç¡¬ä»¶ä¸­å—æ”¯æŒï¼Œå¹¶ä¸”å®ƒä»¬å…·æœ‰æ›´å¤šçš„èµ„æºã€‚ åœ¨AVR MKä¸­ï¼Œä¸æ”¯æŒå¤šä»»åŠ¡å¤„ç†çš„ç¡¬ä»¶ï¼ˆä¸€åˆ‡éƒ½éœ€è¦â€œæ‰‹åŠ¨â€å®Œæˆï¼‰ï¼Œå¹¶ä¸”å¯ç”¨å†…å­˜å¾ˆå°ã€‚ å› æ­¤ï¼Œå°½ç®¡å­˜åœ¨æ›¿æ¢OSï¼Œä½†å®ƒä»¬ä¸å¤ªé€‚åˆç®€å•çš„MKã€‚ <br><br> å¦ä¸€ä»¶äº‹æ˜¯<i>åˆä½œæ“ä½œç³»ç»Ÿ</i> ã€‚ ä»»åŠ¡æœ¬èº«åœ¨æ­¤å¤„æ§åˆ¶å°†æ§åˆ¶æƒè½¬ç§»åˆ°è°ƒåº¦ç¨‹åºçš„æ—¶é—´ï¼Œä»è€Œå…è®¸ä»–å¯åŠ¨å…¶ä»–ä»»åŠ¡ã€‚ æ­¤å¤–ï¼Œæ‰§è¡Œæ­¤æ“ä½œéœ€è¦æ‰§è¡Œæ­¤å¤„çš„ä»»åŠ¡-å¦åˆ™ä»£ç æ‰§è¡Œå°†åœæ­¢ã€‚ ä¸€æ–¹é¢ï¼Œè¿™ç§æ–¹æ³•ä¼¼ä¹é™ä½äº†æ•´ä½“å¯é æ€§ï¼šå¦‚æœä»»åŠ¡æŒ‚èµ·ï¼Œå®ƒå°†æ°¸è¿œä¸ä¼šè°ƒç”¨è°ƒåº¦ç¨‹åºï¼Œå¹¶ä¸”æ•´ä¸ªç³»ç»Ÿå°†åœæ­¢å“åº”ã€‚ å¦ä¸€æ–¹é¢ï¼Œçº¿æ€§ä»£ç æˆ–è¶…çº§å¾ªç¯åœ¨è¿™æ–¹é¢æ²¡æœ‰æ›´å¥½çš„é€‰æ‹©-å› ä¸ºå®ƒä»¬å†»ç»“çš„é£é™©å®Œå…¨ç›¸åŒã€‚ <br><br> ä½†æ˜¯ï¼Œåä½œOSå…·æœ‰é‡è¦çš„ä¼˜åŠ¿ã€‚ ç”±äºç¨‹åºå‘˜åœ¨æ­¤å¤„è®¾ç½®äº†è‡ªå·±è¿›è¡Œåˆ‡æ¢çš„æ—¶é—´ï¼Œå› æ­¤ä¸å¯èƒ½çªç„¶å‘ç”Ÿï¼Œä¾‹å¦‚ï¼Œå½“ä»»åŠ¡æ­£åœ¨ä½¿ç”¨æŸäº›èµ„æºæˆ–æ­£åœ¨è®¡ç®—ç®—æœ¯è¡¨è¾¾å¼æ—¶ã€‚ å› æ­¤ï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œåœ¨åä½œå¼OSä¸­ï¼Œæ‚¨å¯ä»¥æ‰§è¡Œä»¥ä¸‹æ“ä½œè€Œæ— éœ€ç»´æŠ¤ä¸Šä¸‹æ–‡ã€‚ è¿™å¤§å¤§èŠ‚çœäº†å¤„ç†å™¨æ—¶é—´å’Œå†…å­˜ï¼Œå› æ­¤çœ‹èµ·æ¥æ›´é€‚åˆåœ¨MK AVRä¸Šå®æ–½ã€‚ <br><br><h2>  BASCOM AVRä¸­çš„ä»»åŠ¡åˆ‡æ¢ </h2><br> ä¸ºäº†åœ¨BASCOM AVRç¯å¢ƒä¸­å®ç°ä»»åŠ¡åˆ‡æ¢ï¼Œæ¯ä¸ªä»»åŠ¡ä»£ç ï¼ˆå‡ä»¥å¸¸è§„è¿‡ç¨‹å®ç°ï¼‰å¿…é¡»åœ¨æŸä¸ªä½ç½®è°ƒç”¨è°ƒåº¦ç¨‹åº-ä¹Ÿä»¥å¸¸è§„è¿‡ç¨‹å®ç°ã€‚ <br> æƒ³è±¡ä¸€ä¸‹ï¼Œæˆ‘ä»¬æœ‰ä¸¤ä¸ªä»»åŠ¡ï¼Œæ¯ä¸ªä»»åŠ¡åœ¨å…¶ä»£ç çš„æŸä¸ªä½ç½®ç”±è°ƒåº¦ç¨‹åºè°ƒç”¨ã€‚ <br><br><pre> <code class="vbscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">sub</span></span> task1() <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-comment"><span class="hljs-comment">'  1 '  loop end sub ' ---------------------------------- sub task2() do '  2 '  loop end sub</span></span></code> </pre> <br> å‡è®¾ä»»åŠ¡1å·²æ‰§è¡Œï¼Œè®©æˆ‘ä»¬çœ‹çœ‹æ‰§è¡Œâ€œè°ƒåº¦ç¨‹åºè°ƒç”¨â€æ—¶å †æ ˆä¸Šå‘ç”Ÿäº†ä»€ä¹ˆï¼š <br><br><blockquote> è¿”å›ä¸»ä»£ç çš„åœ°å€ï¼ˆ2ä¸ªå­—èŠ‚ï¼‰ <br> å †æ ˆé¡¶éƒ¨-&gt;è¿”å›ä»»åŠ¡1çš„åœ°å€ï¼Œè¯¥ä»»åŠ¡è°ƒç”¨äº†è°ƒåº¦ç¨‹åºï¼ˆ2ä¸ªå­—èŠ‚ï¼‰ </blockquote><br> å †æ ˆçš„é¡¶éƒ¨å°†æŒ‡å‘ä»»åŠ¡1ä¸­æŒ‡ä»¤çš„åœ°å€ï¼Œè¯¥åœ°å€ç´§è·Ÿè°ƒåº¦ç¨‹åºè°ƒç”¨ï¼ˆåœ¨æœ¬ä¾‹ä¸­ä¸º<b>å¾ªç¯</b>æŒ‡ä»¤ï¼‰ä¹‹åã€‚ <br><br> åœ¨æœ€ç®€å•çš„æƒ…å†µä¸‹ï¼Œè°ƒåº¦ç¨‹åºçš„ç›®æ ‡æ˜¯å°†æ§åˆ¶æƒè½¬ç§»ç»™ä»»åŠ¡2ã€‚é—®é¢˜æ˜¯å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹ï¼Ÿ  ï¼ˆå‡è®¾è°ƒåº¦ç¨‹åºå·²ç»çŸ¥é“ä»»åŠ¡2çš„åœ°å€ï¼‰ã€‚ <br><br> ä¸ºæ­¤ï¼Œè°ƒåº¦ç¨‹åºåº”ä»å †æ ˆï¼ˆä»¥åŠè¦è®°ä½çš„ä½ç½®ï¼‰ä¸­æ‹‰å‡ºè¿”å›ä»»åŠ¡1çš„åœ°å€ï¼Œå¹¶å°†ä»»åŠ¡2çš„åœ°å€æ”¾åœ¨å †æ ˆä¸Šçš„è¯¥ä½ç½®ï¼Œç„¶åå‘å‡ºreturnå‘½ä»¤ã€‚ å¤„ç†å™¨å°†ä»å †æ ˆä¸­æå–åœ°å€ï¼Œè€Œä¸æ˜¯è¿”å›åˆ°ä»»åŠ¡1ï¼Œè€Œæ˜¯ç»§ç»­æ‰§è¡Œä»»åŠ¡2ã€‚ <br><br> åè¿‡æ¥ï¼Œå½“ä»»åŠ¡2è°ƒç”¨è°ƒåº¦ç¨‹åºæ—¶ï¼Œæˆ‘ä»¬ä¹Ÿæ‹‰å‡ºå †æ ˆå¹¶ä¿å­˜å¯ä»¥è¿”å›åˆ°ä»»åŠ¡2çš„åœ°å€ï¼Œç„¶åå°†å…ˆå‰ä¿å­˜çš„ä»»åŠ¡1åœ°å€åŠ è½½åˆ°å †æ ˆä¸Šã€‚ç»™å‡º<b>return</b>å‘½ä»¤ï¼Œæˆ‘ä»¬å°†è¿›å…¥ä»»åŠ¡1çš„å»¶ç»­ç‚¹ã€‚ <br><br> ç»“æœï¼Œæˆ‘ä»¬é™·å…¥äº†æ··ä¹±ï¼š <br><br><blockquote> ä»»åŠ¡1-&gt;è°ƒåº¦ç¨‹åº-&gt;ä»»åŠ¡2-&gt;è°ƒåº¦ç¨‹åº-&gt;ä»»åŠ¡1 .... </blockquote><br> è¿˜ä¸é”™ï¼ è€Œä¸”æœ‰æ•ˆã€‚ ä½†æ˜¯ï¼Œå½“ç„¶ï¼Œè¿™å¯¹äºå®é™…å¯ç”¨çš„æ“ä½œç³»ç»Ÿæ˜¯ä¸å¤Ÿçš„ã€‚ æ¯•ç«Ÿï¼Œå¹¶éæ€»æ˜¯å¦‚æ­¤ï¼Œä¹Ÿä¸æ˜¯æ‰€æœ‰ä»»åŠ¡éƒ½åº”è¯¥èµ·ä½œç”¨â€”ä¾‹å¦‚ï¼Œå®ƒä»¬å¯ä»¥<i>æœŸæœ›</i>ä¸€äº›ä¸œè¥¿ï¼ˆå»¶è¿Ÿæ—¶é—´åˆ°æœŸï¼ŒæŸäº›ä¿¡å·çš„å‡ºç°ç­‰ï¼‰ã€‚ å› æ­¤ï¼Œä»»åŠ¡åº”å…·æœ‰<i>çŠ¶æ€</i> ï¼ˆâ€œå·¥ä½œâ€ï¼Œâ€œå°±ç»ªâ€ï¼Œâ€œé¢„æœŸâ€ç­‰ï¼‰ã€‚ å¦å¤–ï¼Œæœ€å¥½å°†ä»»åŠ¡åˆ†é…ç»™<i>priority</i> ã€‚ ç„¶åï¼Œå¦‚æœå‡†å¤‡æ‰§è¡Œå¤šä¸ªä»»åŠ¡ï¼Œåˆ™è°ƒåº¦ç¨‹åºå°†ç»§ç»­æ‰§è¡Œä¼˜å…ˆçº§æœ€é«˜çš„ä»»åŠ¡ã€‚ <br><br><h2> æ°´æ—RTOS </h2><br> ä¸ºäº†å®ç°æ‰€æè¿°çš„æ€æƒ³ï¼Œå¼€å‘äº†åä½œOS AQUA RTOSï¼Œå®ƒä¸ºä»»åŠ¡æä¾›äº†å¿…è¦çš„æœåŠ¡ï¼Œå¹¶å…è®¸åœ¨BASCOM AVRç¯å¢ƒä¸­å®ç°åä½œå¤šä»»åŠ¡ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">æœ‰å…³BASCOM AVRä¸­çš„è¿‡ç¨‹æ¨¡å¼çš„é‡è¦é€šçŸ¥</b> <div class="spoiler_text"> åœ¨å¼€å§‹æè¿°AUQA RTOSä¹‹å‰ï¼Œåº”æ³¨æ„ï¼ŒBASCOM AVRç¯å¢ƒæ”¯æŒä¸¤ç§ç±»å‹çš„å¯»å€è¿‡ç¨‹ã€‚ è¿™ç”±configå­æ¨¡å¼= new | æ—§çš„ã€‚ <br> åœ¨æŒ‡å®šæ—§é€‰é¡¹çš„æƒ…å†µä¸‹ï¼Œé¦–å…ˆï¼Œç¼–è¯‘å™¨å°†çº¿æ€§ç¼–è¯‘æ‰€æœ‰ä»£ç ï¼Œè€Œä¸ç®¡å®ƒæ˜¯å¦åœ¨æŸä¸ªåœ°æ–¹ä½¿ç”¨ï¼Œå…¶æ¬¡ï¼Œæ²¡æœ‰ä»¥å­åç§°/ end subæ ·å¼è®¾è®¡çš„å‚æ•°çš„è¿‡ç¨‹å°†è¢«è§†ä¸ºè¿‡ç¨‹ã€‚ ï¼Œå…¶åç§°é£æ ¼ä¸ºï¼š/ returnã€‚ è¿™å…è®¸æˆ‘ä»¬ä½¿ç”¨bylabelä¿®é¥°ç¬¦å°†è¿‡ç¨‹çš„åœ°å€ä½œä¸ºæ ‡ç­¾ä¼ é€’ç»™å¦ä¸€ä¸ªè¿‡ç¨‹ï¼Œä½œä¸ºå‚æ•°ã€‚ è¿™ä¹Ÿé€‚ç”¨äºä»¥å­åç§°/ç»“æŸå­æ ·å¼çš„æ ·å¼è®¾è®¡çš„è¿‡ç¨‹ï¼ˆæ‚¨éœ€è¦å°†è¿‡ç¨‹åç§°ä½œä¸ºæ ‡ç­¾ä¼ é€’ï¼‰ã€‚ <br> åŒæ—¶ï¼Œsubmode = oldæ¨¡å¼å¼ºåŠ äº†ä¸€äº›é™åˆ¶ï¼šä»»åŠ¡è¿‡ç¨‹ä¸€å®šä¸èƒ½åŒ…å«å‚æ•°ï¼› é€šè¿‡$ includeè¿æ¥çš„æ–‡ä»¶ä»£ç çº¿æ€§åŒ…å«åœ¨å¸¸è§„é¡¹ç›®ä¸­ï¼Œå› æ­¤ï¼Œåº”åœ¨è¿æ¥çš„æ–‡ä»¶ä¸­æä¾›ç»•è¡ŒåŠŸèƒ½-ä½¿ç”¨gotoå’Œæ ‡ç­¾ä»å¤´åˆ°å°¾è¿›è¡Œæ“ä½œã€‚ <br> å› æ­¤ï¼Œåœ¨AQUA RTOSä¸­ï¼Œç”¨æˆ·å¿…é¡»ä»…ä½¿ç”¨task_nameæ ·å¼çš„æ—§è¿‡ç¨‹è¡¨ç¤ºæ³•ï¼š/ returnç”¨äºä»»åŠ¡ï¼Œæˆ–è€…ä½¿ç”¨æ›´é€šç”¨çš„å­åç§°/ end subï¼Œåœ¨å…¶ä»£ç å¼€å¤´æ·»åŠ ä¿®é¥°ç¬¦submode = oldï¼Œå¹¶ç»•è¿‡åŒ…å«çš„æ–‡ä»¶è½¬åˆ°æ ‡ç­¾/åŒ…å«æ–‡ä»¶ä»£ç /æ ‡ç­¾ï¼šã€‚ <br></div></div><br><h3>  AQUA RTOSä»»åŠ¡çŠ¶æ€ </h3><br> ä¸ºAQUA RTOSä¸­çš„ä»»åŠ¡å®šä¹‰äº†ä»¥ä¸‹çŠ¶æ€ï¼š <br><br><pre> <code class="vbscript hljs">OSTS_UNDEFINE OSTS_READY OSTS_RUN OSTS_DELAY OSTS_STOP OSTS_WAIT OSTS_PAUSE OSTS_RESTART</code> </pre> <br> å¦‚æœä»»åŠ¡å°šæœªåˆå§‹åŒ–ï¼Œåˆ™å°†å…¶åˆ†é…ä¸ºçŠ¶æ€<b>OSTS_UNDEFINE</b> ã€‚ <br> åˆå§‹åŒ–åï¼Œä»»åŠ¡çš„çŠ¶æ€ä¸º<b>OSTS_STOP</b> ã€‚ <br> å¦‚æœä»»åŠ¡<i>å‡†å¤‡å¥½æ‰§è¡Œ</i> ï¼Œåˆ™å°†å…¶åˆ†é…ä¸ºçŠ¶æ€<b>OSTS_READY</b> ã€‚ <br> å½“å‰æ­£åœ¨è¿è¡Œçš„ä»»åŠ¡çš„çŠ¶æ€ä¸º<b>OSTS_RUN</b> ã€‚ <br> ä»ä¸­ï¼Œå¥¹å¯ä»¥è¿›å…¥çŠ¶æ€<b>OSTS_STOPï¼ŒOSTS_READYï¼ŒOSTS_DELAYï¼ŒOSTS_WAITï¼ŒOSTS_PAUSE</b> ã€‚ <br> çŠ¶æ€<b>OSTS_DELAY</b>å…·æœ‰å®Œæˆ<i>å»¶è¿Ÿ</i>çš„ä»»åŠ¡ã€‚ <br> çŠ¶æ€<b>OSTS_WAIT</b>åˆ†é…ç»™æ­£åœ¨<i>ç­‰å¾…ä¿¡å·é‡ï¼Œäº‹ä»¶æˆ–æ¶ˆæ¯çš„ä»»åŠ¡</i> ï¼ˆä¸‹é¢å°†è¯¦ç»†ä»‹ç»ï¼‰ã€‚ <br><br>  <b>OSTS_STOP</b>å’Œ<b>OSTS_PAUSEDçŠ¶æ€</b>ä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ <br> å¦‚æœç”±äºæŸç§åŸå› è¯¥ä»»åŠ¡æ¥æ”¶åˆ°<b>OSTS_STOP</b>çš„çŠ¶æ€ï¼Œ <b>åˆ™å°†</b>ä»å…¶å…¥å£ç‚¹ï¼ˆå³æ¥æ”¶åˆ°<b>OSTS_READY</b>çš„çŠ¶æ€ï¼‰æ‰§è¡Œè¯¥ä»»åŠ¡çš„åç»­æ¢å¤ã€‚ ä»ä¸€å¼€å§‹ã€‚ ä»<b>OSTS_PAUSE</b>çš„çŠ¶æ€<b>å¼€å§‹ï¼Œ</b>ä»»åŠ¡å°†åœ¨æŒ‚èµ·çš„ä½ç½®ç»§ç»­å·¥ä½œã€‚ <br><br><h3> ä»»åŠ¡çŠ¶æ€ç®¡ç† </h3><br>  OSæœ¬èº«éƒ½å¯ä»¥é€šè¿‡è°ƒç”¨OSæœåŠ¡æ¥è‡ªåŠ¨ç®¡ç†ä»»åŠ¡ä»¥åŠç”¨æˆ·ã€‚ æœ‰å‡ ç§ä»»åŠ¡ç®¡ç†æœåŠ¡ï¼ˆæ‰€æœ‰OSæœåŠ¡çš„åç§°<b>å‡ä»¥OS_</b>å‰ç¼€å¼€å¤´ï¼‰ï¼š <br><br><pre> <code class="vbscript hljs">OS_InitTask(task_label, task_prio) OS_Stop() OS_StopTask(task_label) OS_Pause() OS_PauseTask(task_label) OS_Resume() OS_ResumeTask(task_label) OS_Restart()</code> </pre> <br> å®ƒä»¬æ¯ä¸ªéƒ½æœ‰ä¸¤ä¸ªé€‰é¡¹ï¼š <b>OS_service</b>å’Œ<b>OS_serviceTask</b> ï¼ˆ <b>OS_InitTask</b>æœåŠ¡é™¤å¤–ï¼Œåè€…åªæœ‰ä¸€ä¸ªé€‰é¡¹ï¼› <b>OS_Init</b>æœåŠ¡åˆå§‹åŒ–OSæœ¬èº«ï¼‰ã€‚ <br><br>  <b>OS_service</b>å’Œ<b>OS_serviceTaskæœ‰</b>ä»€ä¹ˆ<b>åŒºåˆ«</b> ï¼Ÿ ç¬¬ä¸€ç§æ–¹æ³•å¯¹å¯¼è‡´ä»»åŠ¡çš„ä»»åŠ¡æœ¬èº«èµ·ä½œç”¨ï¼› ç¬¬äºŒä¸ªå…è®¸æ‚¨å°†æŒ‡å‘å¦ä¸€ä¸ªä»»åŠ¡çš„æŒ‡é’ˆè®¾ç½®ä¸ºå‚æ•°ï¼Œä»è€Œä»ä¸€ä¸ªä»»åŠ¡ç®¡ç†å¦ä¸€ä¸ªä»»åŠ¡ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">å…³äºOS_Resume</b> <div class="spoiler_text"> é™¤OS_Resumeå’ŒOS_ResumeTaskå¤–ï¼Œæ‰€æœ‰ä»»åŠ¡ç®¡ç†æœåŠ¡éƒ½å°†åœ¨å¤„ç†åè‡ªåŠ¨è°ƒç”¨ä»»åŠ¡ç®¡ç†å™¨ã€‚ ç›¸åï¼ŒOS_Resume *æœåŠ¡ä»…å°†ä»»åŠ¡çŠ¶æ€è®¾ç½®ä¸ºOSTS_READYã€‚ ä»…å½“æ˜¾å¼è°ƒç”¨è°ƒåº¦ç¨‹åºæ—¶ï¼Œæ‰ä¼šå¤„ç†æ­¤çŠ¶æ€ã€‚ <br></div></div><br><h3> ä¼˜å…ˆçº§å’Œä»»åŠ¡é˜Ÿåˆ— </h3><br> å¦‚ä¸Šæ‰€è¿°ï¼Œåœ¨å®é™…ç³»ç»Ÿä¸­ï¼ŒæŸäº›ä»»åŠ¡å¯èƒ½æ›´é‡è¦ï¼Œè€Œå…¶ä»–ä»»åŠ¡å¯èƒ½æ˜¯æ¬¡è¦çš„ã€‚ å› æ­¤ï¼Œæ“ä½œç³»ç»Ÿçš„ä¸€ä¸ªæœ‰ç”¨åŠŸèƒ½æ˜¯èƒ½å¤Ÿåˆ†é…ä»»åŠ¡ä¼˜å…ˆçº§ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœåŒæ—¶æœ‰å¤šä¸ª<i>ç°æˆçš„</i>ä»»åŠ¡ï¼Œåˆ™æ“ä½œç³»ç»Ÿå°†é¦–å…ˆé€‰æ‹©ä¼˜å…ˆçº§æœ€é«˜çš„ä»»åŠ¡ã€‚ å¦‚æœ<b>æ‰€æœ‰</b>ç°æˆçš„ä»»åŠ¡å…·æœ‰ç›¸åŒçš„ä¼˜å…ˆçº§ï¼Œåˆ™æ“ä½œç³»ç»Ÿå°†æŒ‰ç…§ç§°ä¸ºâ€œè½®æ’­â€æˆ–å¾ªç¯çš„é¡ºåºå°†å®ƒä»¬å¾ªç¯æ‰§è¡Œã€‚ <br><br> åœ¨AQUA RTOSä¸­ï¼Œé€šè¿‡è°ƒç”¨<b>OS_InitTask</b>æœåŠ¡<i>åˆå§‹åŒ–</i>ä»»åŠ¡æ—¶å°†ä¼˜å…ˆçº§åˆ†é…ç»™ä»»åŠ¡ï¼Œè¯¥æœåŠ¡<b>æ¥æ”¶</b>ä»»åŠ¡<b>çš„</b>åœ°å€ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå¹¶<b>æ¥æ”¶</b>ä»1åˆ°15çš„æ•°å­—ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ï¼Œ <i>æ•°å­—è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜</i> ã€‚ åœ¨OSæ“ä½œæœŸé—´ï¼Œä¸æä¾›åˆ†é…ç»™ä»»åŠ¡çš„ä¼˜å…ˆçº§çš„æ›´æ”¹ã€‚ <br><br><h3> å»¶è¯¯ </h3><br> åœ¨æ¯ä¸ªä»»åŠ¡ä¸­ï¼Œå»¶è¿Ÿéƒ½ç‹¬ç«‹äºå…¶ä»–ä»»åŠ¡å¤„ç†ã€‚ <br> å› æ­¤ï¼Œåœ¨OSè§£å†³ä¸€é¡¹ä»»åŠ¡çš„å»¶è¿Ÿæ—¶ï¼Œå¯ä»¥æ‰§è¡Œå…¶ä»–ä»»åŠ¡ã€‚ <br> ä¸ºç»„ç»‡å»¶è¿Ÿæä¾›äº†æœåŠ¡<b>OS_Delay |</b>  <b>OS_DelayTask</b> ã€‚ å‚æ•°æ˜¯ä»»åŠ¡<i>å»¶è¿Ÿ</i>çš„æ¯«ç§’æ•°ã€‚ ç”±äºå‚æ•°çš„ç»´æ•°ä¸º<b>dword</b> ï¼Œå› æ­¤æœ€å¤§å»¶è¿Ÿä¸º4294967295 msï¼Œæˆ–å¤§çº¦120å°æ—¶ï¼Œå¯¹äºå¤§å¤šæ•°åº”ç”¨ç¨‹åºæ¥è¯´ä¼¼ä¹å·²ç»è¶³å¤Ÿã€‚ è°ƒç”¨å»¶è¿ŸæœåŠ¡åï¼Œå°†è‡ªåŠ¨è°ƒç”¨è°ƒåº¦ç¨‹åºï¼Œè¯¥è°ƒåº¦ç¨‹åºå°†åœ¨å»¶è¿ŸæœŸé—´å°†æ§åˆ¶æƒè½¬ç§»åˆ°å…¶ä»–ä»»åŠ¡ã€‚ <br><br><h3> ä¿¡å·é‡ </h3><br>  AQUA RTOSä¸­çš„ä¿¡å·é‡ç±»ä¼¼äºå¯ç”¨äºä»»åŠ¡çš„æ ‡å¿—å’Œå˜é‡ã€‚ å®ƒä»¬æœ‰ä¸¤ç§ç±»å‹-äºŒè¿›åˆ¶å’Œå¯æ•°ã€‚ ç¬¬ä¸€ä¸ªåªæœ‰ä¸¤ç§çŠ¶æ€ï¼šç©ºé—²å’Œå…³é—­ã€‚ ç¬¬äºŒä¸ªæ˜¯å­—èŠ‚è®¡æ•°å™¨ï¼ˆå½“å‰ç‰ˆæœ¬çš„AQUA RTOSä¸­çš„ä¿¡å·é‡è®¡æ•°æœåŠ¡å°šæœªå®ç°ï¼ˆæˆ‘æ˜¯ä¸€ä¸ªæ‡’æƒ°çš„é©´å­ï¼Œå› æ­¤ä¸‹é¢æ‰€è¿°çš„å†…å®¹ä»…é€‚ç”¨äºäºŒè¿›åˆ¶ä¿¡å·é‡ï¼‰ã€‚ <br><br> ä¿¡å·é‡å’Œç®€å•æ ‡å¿—ä¹‹é—´çš„åŒºåˆ«åœ¨äºï¼Œå¯ä»¥ä½¿ä»»åŠ¡<i>ç­‰å¾…é‡Šæ”¾</i>æŒ‡å®šçš„ä¿¡å·é‡ã€‚ åœ¨æŸäº›æ–¹é¢ï¼Œä¿¡å·é‡çš„ä½¿ç”¨ç¡®å®ç±»ä¼¼äºé“è·¯ï¼šåˆ°è¾¾ä¿¡å·é‡åï¼Œç»„åˆï¼ˆä»»åŠ¡ï¼‰å°†æ£€æŸ¥ä¿¡å·é‡ï¼Œå¦‚æœä¿¡å·é‡æœªæ‰“å¼€ï¼Œå®ƒå°†ç­‰å¾…ä½¿èƒ½ä¿¡å·è¿›ä¸€æ­¥ä¼ æ’­ã€‚ æ­¤æ—¶ï¼Œå…¶ä»–ç«è½¦ï¼ˆä»»åŠ¡ï¼‰å¯ä»¥ç»§ç»­è¡Œé©¶ï¼ˆè¿è¡Œï¼‰ã€‚ <br><br> åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‰€æœ‰é»‘ä»¶éƒ½åˆ†é…ç»™è°ƒåº¦å‘˜ã€‚ ä¸€æ—¦ä»»åŠ¡è¢«å‘ŠçŸ¥ç­‰å¾…ä¿¡å·é‡ï¼Œæ§åˆ¶æƒå°±ä¼šè‡ªåŠ¨è½¬ç§»åˆ°è°ƒåº¦ç¨‹åºï¼Œå¹¶ä¸”ä»–å¯ä»¥å¯åŠ¨å…¶ä»–ä»»åŠ¡-ç›´åˆ°é‡Šâ€‹â€‹æ”¾æŒ‡å®šçš„ä¿¡å·é‡ä¸ºæ­¢ã€‚ ä¸€æ—¦ä¿¡å·é‡çš„çŠ¶æ€æ›´æ”¹ä¸º<i>free</i> ï¼Œè°ƒåº¦ç¨‹åºå°±ä¼šå°†ç­‰å¾…è¯¥ä¿¡å·é‡çš„æ‰€æœ‰ä»»åŠ¡åˆ†é…ä¸ºçŠ¶æ€<i>å°±ç»ª</i> ï¼ˆ <b>OSTS_READY</b> ï¼‰ï¼Œå¹¶å°†æŒ‰ç…§ä¼˜å…ˆçº§å’Œä¼˜å…ˆçº§çš„é¡ºåºæ‰§è¡Œå®ƒä»¬ã€‚ <br>  AQUA RTOSæ€»å…±æä¾›16ä¸ªäºŒè¿›åˆ¶ä¿¡å·é‡ï¼ˆåŸåˆ™ä¸Šå¯ä»¥é€šè¿‡æ›´æ”¹ä»»åŠ¡æ§åˆ¶å•å…ƒä¸­å˜é‡çš„å°ºå¯¸æ¥å¢åŠ æ­¤æ•°ç›®ï¼Œå› ä¸ºåœ¨å†…éƒ¨å®ƒä»¬æ˜¯ä½œä¸ºä½æ ‡å¿—å®ç°çš„ï¼‰ã€‚ <br> äºŒè¿›åˆ¶ä¿¡å·é‡é€šè¿‡ä»¥ä¸‹æœåŠ¡å·¥ä½œï¼š <br><br><pre> <code class="vbscript hljs">hBSem OS_CreateBSemaphore() OS_WaitBSemaphore(hBSem) OS_WaitBSemaphoreTask(task_label, hBSem) OS_BusyBSemaphore(hBSem) OS_FreeBSemaphore(hBSem)</code> </pre> <br> åœ¨ä½¿ç”¨ä¿¡å·é‡ä¹‹å‰ï¼Œå¿…é¡»å…ˆ<i>åˆ›å»º</i>ä¸€ä¸ªä¿¡å·é‡ã€‚ è¿™å¯ä»¥é€šè¿‡è°ƒç”¨<b>OS_CreateBSemaphore</b>æœåŠ¡æ¥å®Œæˆï¼Œè¯¥æœåŠ¡è¿”å›åˆ›å»ºçš„<b>hBSem</b>ä¿¡å·é‡çš„å”¯ä¸€å­—èŠ‚æ ‡è¯†ç¬¦ï¼ˆå¥æŸ„ï¼‰ï¼Œæˆ–è€…é€šè¿‡ç”¨æˆ·å®šä¹‰çš„å¤„ç†ç¨‹åºå¼•å‘é”™è¯¯<b>OSERR_BSEM_MAX_REACHED</b> ï¼ŒæŒ‡ç¤ºå·²è¾¾åˆ°æœ€å¤§æ•°é‡çš„äºŒè¿›åˆ¶ä¿¡å·é‡ã€‚ <br><br> æ‚¨å¯ä»¥é€šè¿‡å°†æ¥æ”¶åˆ°çš„æ ‡è¯†ç¬¦ä½œä¸ºå‚æ•°ä¼ é€’ç»™å…¶ä»–ä¿¡å·é‡æœåŠ¡æ¥ä½¿ç”¨å®ƒã€‚ <br><br> æœåŠ¡<b>OS_WaitBSemaphore |</b>  <b>OS_WaitBSemaphoreTask</b>å°†ï¼ˆå½“å‰|æŒ‡å®šçš„ï¼‰ä»»åŠ¡ç½®äºä¸€ç§çŠ¶æ€ï¼Œä»¥<i>åœ¨</i> <b>hBSem</b> <i>ä¿¡å·</i>ç¹å¿™æ—¶<i>ç­‰å¾…</i>è¯¥ä¿¡å·<i>çš„é‡Šæ”¾</i> ï¼Œç„¶åå°†æ§åˆ¶æƒè½¬ç§»åˆ°è°ƒåº¦ç¨‹åºï¼Œä»¥ä¾¿å®ƒå¯ä»¥å¯åŠ¨å…¶ä»–ä»»åŠ¡ã€‚ å¦‚æœè¯¥ä¿¡å·é‡æ˜¯ç©ºé—²çš„ï¼Œåˆ™ä¸ä¼šå‘ç”Ÿæ§åˆ¶è½¬ç§»ï¼Œå¹¶ä¸”è¯¥ä»»åŠ¡å°†ç»§ç»­è¿›è¡Œã€‚ <br><br>  <b>OS_BusyBSemaphore</b>å’Œ<b>OS_FreeBSemaphoreæœåŠ¡åˆ†åˆ«</b>å°†<b>hBSem</b>ä¿¡å·é‡è®¾ç½®ä¸º<i>å¿™</i>æˆ–<i>ç©ºé—²</i> ã€‚ <br><br> æ²¡æœ‰æä¾›é”€æ¯ä¿¡å·ä»¥ç®€åŒ–OSå¹¶å‡å°‘ä»£ç é‡çš„è¡Œä¸ºã€‚ å› æ­¤ï¼Œæ‰€æœ‰åˆ›å»ºçš„ä¿¡å·é‡éƒ½æ˜¯é™æ€çš„ã€‚ <br><br><h3> å¤§äº‹è®° </h3><br> é™¤äº†ä¿¡å·é‡ä¹‹å¤–ï¼Œä»»åŠ¡è¿˜å¯ä»¥ç”±äº‹ä»¶é©±åŠ¨ã€‚ å¯ä»¥æŒ‡ç¤ºä¸€ä¸ªä»»åŠ¡<i>é¢„æœŸæŸä¸ªäº‹ä»¶</i> ï¼Œè€Œå¦ä¸€ä¸ªä»»åŠ¡ï¼ˆä»¥åŠåå°ä»£ç ï¼‰å¯ä»¥<i>æŒ‡ç¤º</i>è¯¥äº‹ä»¶ã€‚ åŒæ—¶ï¼Œæ‰€æœ‰ç­‰å¾…æ­¤äº‹ä»¶çš„ä»»åŠ¡éƒ½å°†æ¥æ”¶<i>å‡†å¤‡æ‰§è¡Œ</i>çš„çŠ¶æ€ï¼ˆ <b>OSTS_READY</b> ï¼‰ï¼Œå¹¶ç”±è°ƒåº¦ç¨‹åºå°†å…¶è®¾ç½®ä¸ºæŒ‰ä¼˜å…ˆçº§å’Œä¼˜å…ˆçº§é¡ºåºæ‰§è¡Œã€‚ <br><br> ä»»åŠ¡å¯ä»¥å“åº”å“ªäº›äº‹ä»¶ï¼Ÿ å¥½å§ï¼Œä¾‹å¦‚ï¼š <br><ul><li> ä¸­æ–­ </li><li> å‘ç”Ÿé”™è¯¯ï¼› </li><li> é‡Šæ”¾èµ„æºï¼ˆæœ‰æ—¶ä¸ºæ­¤ä½¿ç”¨ä¿¡å·é‡æ›´ä¸ºæ–¹ä¾¿ï¼‰ï¼› </li><li> æ›´æ”¹I / Oçº¿çš„çŠ¶æ€æˆ–æŒ‰é”®ç›˜ä¸Šçš„é”®ï¼› </li><li> é€šè¿‡RS-232æ¥æ”¶æˆ–å‘é€å­—ç¬¦ï¼› </li><li> ä»åº”ç”¨ç¨‹åºçš„ä¸€éƒ¨åˆ†åˆ°å¦ä¸€éƒ¨åˆ†çš„ä¿¡æ¯ä¼ é€’ï¼ˆå¦è¯·å‚é˜…æ¶ˆæ¯ï¼‰ã€‚ </li></ul><br> äº‹ä»¶ç³»ç»Ÿæ˜¯é€šè¿‡ä»¥ä¸‹æœåŠ¡å®ç°çš„ï¼š <br><br><pre> <code class="vbscript hljs">hEvent OS_CreateEvent() OS_WaitEvent(hEvent) OS_WaitEventTask(task_label, hEvent) OS_WaitEventTO(hEvent, dwTimeout) OS_SignalEvent(hEvent)</code> </pre> <br> ä½¿ç”¨äº‹ä»¶ä¹‹å‰ï¼Œæ‚¨éœ€è¦<i>åˆ›å»ºå®ƒ</i> ã€‚ è¿™æ˜¯é€šè¿‡è°ƒç”¨<b>OS_CreateEvent</b>å‡½æ•°å®Œæˆçš„ï¼Œè¯¥å‡½æ•°ä¸º<b>hEvent</b>äº‹ä»¶è¿”å›å”¯ä¸€çš„å­—èŠ‚æ ‡è¯†ç¬¦ï¼ˆå¥æŸ„ï¼‰ï¼Œæˆ–è€…é€šè¿‡ç”¨æˆ·å®šä¹‰çš„å¤„ç†ç¨‹åºå¼•å‘<b>OSERR_EVENT_MAX_REACHED</b>é”™è¯¯ï¼Œè¡¨æ˜å·²è¾¾åˆ°å¯åœ¨OSä¸­ç”Ÿæˆçš„äº‹ä»¶æ•°é‡çš„é™åˆ¶ï¼ˆæœ€å¤š255ä¸ªä¸åŒäº‹ä»¶ï¼‰ã€‚ <br><br> è‹¥è¦ä½¿ä»»åŠ¡ç­‰å¾…<b>hEvent</b>äº‹ä»¶ï¼Œè¯·åœ¨å…¶ä»£ç ä¸­è°ƒç”¨<b>OS_WaitEvent</b> ï¼Œå¹¶å°†äº‹ä»¶å¥æŸ„ä½œä¸ºå‚æ•°ä¼ é€’ã€‚ è°ƒç”¨æ­¤æœåŠ¡åï¼Œæ§åˆ¶æƒå°†è‡ªåŠ¨è½¬ç§»åˆ°è°ƒåº¦ç¨‹åºã€‚ <br><br> ä¸ä¿¡å·é‡æœåŠ¡ä¸åŒï¼Œäº‹ä»¶æœåŠ¡æä¾›äº†ä¸€ä¸ªé€‰é¡¹æ¥ç­‰å¾…å¸¦æœ‰<i>è¶…æ—¶</i>çš„äº‹ä»¶ã€‚ ä¸ºæ­¤ï¼Œè¯·ä½¿ç”¨<b>OS_WaitEventTO</b>æœåŠ¡ã€‚ åœ¨è¿™é‡Œçš„ç¬¬äºŒä¸ªå‚æ•°å¯ä»¥æŒ‡å®šä»»åŠ¡å¯ä»¥é¢„æœŸäº‹ä»¶å‘ç”Ÿçš„æ¯«ç§’æ•°ã€‚ å¦‚æœæŒ‡å®šçš„æ—¶é—´å·²åˆ°æœŸï¼Œåˆ™ä»»åŠ¡å°†æ”¶åˆ°<i>å‡†å¤‡å¥½æ‰§è¡Œ</i>çŠ¶æ€<i>ï¼Œ</i>å°±å¥½åƒäº‹ä»¶å·²å‘ç”Ÿä¸€æ ·ï¼Œå¹¶ä¸”å°†ç”±è°ƒåº¦ç¨‹åºè®¾ç½®ä¸ºæŒ‰ä¼˜å…ˆçº§å’Œä¼˜å…ˆçº§é¡ºåºç»§ç»­æ‰§è¡Œã€‚ è¯¥ä»»åŠ¡å¯ä»¥å‘ç°è¿™ä¸æ˜¯äº‹ä»¶ï¼Œè€Œæ˜¯è¶…æ—¶ï¼Œä»»åŠ¡å¯ä»¥é€šè¿‡æ£€æŸ¥<b>OS_TIMEOUT</b>å…¨å±€æ ‡å¿—æ¥è¿›è¡Œæ£€æŸ¥ã€‚ <br><br> <i></i>             <b>OS_SignalEvent</b> ,       .    ,   ,    <i>  </i> ,           . <br><br><h3>  </h3><br>        ,       :         ,           â€“   . <br>     : <br><br><pre> <code class="vbscript hljs">hTopic OS_CreateMessage() OS_WaitMessage(hTopic) OS_WaitMessageTask(task_label, hTopic) OS_WaitMessageTO(hTopic, dwTimeout) OS_SendMessage(hTopic, wMessage) word_ptr OS_GetMessage(hTopic) word_ptr OS_PeekMessage(hTopic) <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> OS_GetMessageString(hTopic) <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> OS_PeekMessageString(hTopic)</code> </pre> <br>    ,    <i> </i> .     <b>OS_CreateMessage</b> ,      <b>hTopic</b> ,       <b>OSERR_TOPIC_MAX_REACHED</b> ,   ,       ,     . <br><br>        <b>hTopic</b> ,      <b>OS_WaitMessage</b> ,      .          .  ,        <i>    <b>hTopic</b></i> . <br><br>     <b>OS_WaitMessageTO</b>    <b>OS_WaitEventTO</b>  . <br><br>      <b>OS_SendMessage</b> .     ,     ,   â€“   <b>word</b> .      ,   <i>  </i> , ,   ,    . <br><br>    ,     BASCOM  <b>varptr</b> , , : <br><br><pre> <code class="vbscript hljs">strMessage = <span class="hljs-string"><span class="hljs-string">"Hello, world!"</span></span> OS_SendMessage hTopic, varptr (strMessage)</code> </pre> <br>     <b>OS_WaitMessage</b> ,  ,    ,          ,     â€”      .        .      <b>word</b> ,      ,    ,   .   <b>OS_GetMessage</b>   ,  <b>OS_PeekMessage</b>  . <br><br>     ,   ,    <b>OS_GetMessageString</b>  <b>OS_PeekMessageString</b> ,     ,   ,     . <br><br><h3>    </h3><br>        AQUA RTOS       <b>TIMER0</b> .  ,   (  )     .      , ..          .    1 . <br><br><h2>    AQUA RTOS </h2><br><h3>   </h3><br>       ,           .   <b>OS_SIM = TRUE | FALSE</b> ,    . <br><br>  ,      <b>OS_MAX_TASK</b> ,       .    ,     (  ),      .        ,   . <i>    ,    .</i> <br><br><h3>   </h3><br>    AQUA RTOS   .      <b>OS_Init</b> .      .    ,     â€“     .  ,   ,    â€“  . <br><br>         (    ) â€“      ,            .          ,      -    . <br><br> ,     AQUA RTOS            : <br><br><pre> <code class="vbscript hljs">OS_Init my_err_trap <span class="hljs-comment"><span class="hljs-comment">'... '... '... sub my_err_trap(err_code as byte) print err_code end sub</span></span></code> </pre> <br><h3>   </h3><br>     ,     : <br><br><pre> <code class="vbscript hljs">OS_InitTask task_1, <span class="hljs-number"><span class="hljs-number">1</span></span> OS_InitTask task_2 , <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-comment"><span class="hljs-comment">'... OS_InitTask task_N , 1</span></span></code> </pre> <br><h2>   </h2><br><h3>   </h3><br> ,    ,       Arduino Nano V3.       -  (, test),     bas-: <br><br><pre> <code class="vbscript hljs"><span class="hljs-comment"><span class="hljs-comment">'    config submode = old $include "..\aquaRTOS_1.05.bas" $regfile = "m328pdef.dat" $crystal = 16000000 $hwstack = 48 $swstack = 48 $framesize = 64 '   declare sub my_err_trap (byval err_code as byte) declare sub task_1() declare sub task_2() '       led_1 alias portd.4 led_2 alias portd.5 config portd.4 = output config portd.5 = output ' ***    *** '   OS_Init my_err_trap '   OS_InitTask task_1, 1 OS_InitTask task_2 , 1 '      Â«Â» (OSTS_STOP) '    ,     ' Â«  Â» (OSTS_READY)   OS_ResumeTask OS_ResumeTask task_1 OS_ResumeTask task_2 '      OS_Sheduler end ' ***  *** sub task_1 () do toogle led_1 '   1 OS_delay 1000 '   1000  loop end sub sub task_2 () do toogle led_2 '   2 OS_delay 333 '   333  loop end sub ' **************************************************** '   sub my_err_trap(err_code as byte) print "OS Error: "; err_code end sub</span></span></code> </pre> <br>      <b>D4</b>  <b>D5</b>  Arduino (   ,   -  ).     100...500     <b>GND</b> .      .       2  0,66 . <br><br>   . ,     (  ,      aliases),  â€“  ,   â€“ . <br><br>         Â«Â»,     Â«  Â» (,       â€“  -           ,        ,      ;          ).        <b>OS_ResumeTask</b> . <br><br>     ,    .    ? , !          . ,    ,      ,         <b>end</b> . <br><br>    .    ,         <b>do â€“ loop</b> .    â€“            ,   ,      â€“       ,      .       <b>OS_Delay</b> .        ,       . <br><br>       <b>OS_SIM = TRUE</b>       ,   ,   ,   . <br><br> ,   , ,      Â«  Â»,       .   ,    Â«   Â»,         . <br><br>  ,    (, <b>task_1</b> ),       (     <b>end</b>   )     <b>task_1</b> ,       ,    <b>return</b> ,             â€“  ,    <b>task_1</b> ( <b>do</b>   <b>task_1</b> ). <br><br>  <b>task_1</b> ,   ,   <b>OS_delay</b> , ,   ,   . <br><br>   ,    ,     <b>task_1</b> (  ,    <b>OS_delay</b> , ..  <b>loop</b> ),  , Â« Â», ,      <b>task_2</b> .       <b>task_2</b> (      <b>do</b>    <b>task_2</b> )    <b>return</b> ,             â€“  ,    <b>task_2</b> . <br><br>  <b>task_2</b> ,   ,   <b>OS_delay</b> , ,   ,   . <br><br>   ,    ,     <b>task_1</b> (  ,    <b>OS_delay</b> , ..  <b>loop</b> ),  , Â« Â», ,      <b>task_2</b> .       ,       <b>task_1</b>     ,   ,      .  (  <b>loop</b>    <b>task_1</b> ),    . <br><br>  <b>task_1</b>   <b>loop</b> ,     Â« 1 â€“  â€“  2 â€“ Â»   . <br><br><h3>   </h3><br>         . <br><br><pre> <code class="vbscript hljs"><span class="hljs-comment"><span class="hljs-comment">'    config submode = old $include "..\aquaRTOS_1.05.bas" $regfile = "m328pdef.dat" $crystal = 16000000 $hwstack = 48 $swstack = 48 $framesize = 64 '   declare sub my_err_trap (byval err_code as byte) declare sub task_1() declare sub task_2() const OS_SIM = TURE '       '   dim hTopic as byte '     dim task_1_cnt as byte '    1 dim strMessage as string * 16 '  ' ***    *** OS_CreateMessage hTopic OS_Init my_err_trap OS_InitTask task_1 , 1 OS_InitTask task_2 , 1 OS_ResumeTask task_1 OS_ResumeTask task_2 OS_Sheduler end ' ***  *** sub task_1() do print "task 1" OS_Sheduler incr task_1_cnt '    1 if task_1_cnt &gt; 3 then print "task 1 is sending message to task 2" strMessage = "Hello, task 2!" '    2 OS_SendMessage hTopic , varptr(strMessage) task_1_cnt = 0 end if loop end sub sub task_2() do print "task 2 is waiting messages..." '      1 OS_WaitMessage hTopic print "message recieved: " ; OS_GetMessageString (hTopic) loop end sub ' **************************************************** '   sub my_err_trap(err_code as byte) print "OS Error: "; err_code end sub</span></span></code> </pre> <br>           : <br><br><blockquote> task 1 <br> task 2 is waiting messagesâ€¦ <br> task 1 <br> task 1 <br> task 1 <br> task 1 is sending message to task 2 <br> task 1 <br> message recieved: Hello, task 2! <br> task 2 is waiting messagesâ€¦ <br> task 1 <br> task 1 <br>  ... <br></blockquote><br>  ,        .    1  <b>task 1</b> ,     ,      .  2  <b>task 2 is waiting messages...</b> ,        <b>hTopic</b> ,     ,     1.    <b>task 1</b>     . ,   ,   2   ,     1   <b>incr</b> ,    . <br>   <b>task_1_cnt</b>   1   ,   ,    â€“   <b>loop</b>    <b>task 1</b> .     ,   ,    2  ,    .    . <br><br><h3>   </h3><br>             : <br><br><pre> <code class="vbscript hljs"><span class="hljs-comment"><span class="hljs-comment">'    config submode = old $include "..\aquaRTOS_1.05.bas" $regfile = "m328pdef.dat" $crystal = 16000000 $hwstack = 48 $swstack = 48 $framesize = 64 '   declare sub my_err_trap (byval err_code as byte) declare sub task_scankeys() declare sub task_led_1() declare sub task_led_2() '        led_1 alias portd.4 led_2 alias portd.5 config portd.4 = output config portd.5 = output button_1 alias pind.6 button_2 alias pind.7 config portd.6 = input config portd.7 = input '   dim eventButton_1 as byte dim eventButton_2 as byte ' ***    *** eventButton_1 = OS_CreateEvent '       eventButton_2 = OS_CreateEvent OS_Init my_err_trap OS_InitTask task_scankeys , 1 OS_InitTask task_led_1 , 1 OS_InitTask task_led_2 , 1 OS_ResumeTask task_scankeys OS_ResumeTask task_led_1 OS_ResumeTask task_led_2 OS_Sheduler end ' ***  *** sub task_scankeys() do debounce button_1 , 0 , btn_1_click , sub debounce button_2 , 0 , btn_2_click , sub OS_Sheduler loop btn_1_click: OS_SignalEvent eventButton_1 return btn_2_click: OS_SignalEvent eventButton_2 return end sub sub task_led_1() do OS_WaitEvent eventButton_1 toggle led_1 loop end sub sub task_led_2() do OS_WaitEvent eventButton_2 toggle led_2 loop end sub ' **************************************************** '   sub my_err_trap(err_code as byte) print "OS Error: "; err_code end sub</span></span></code> </pre> <br><h2>     AQUA RTOS </h2><br><br>   ,         .           ;     ,   ,  .  ,     : ,      95â€¦97Â°;               (,  GSM-),      . <br><br><h3>    </h3><br>         Â« +  + Â»  ,     .     ,    . <br>        : <br><br><ul><li>     â€“ <b>ControlHeater()</b> </li><li>      â€“ <b>ShowGoods()</b> </li><li>  /    â€“ <b>AcceptMoney()</b> </li><li>   â€“ <b>ScanKeys()</b> </li><li>   â€“ <b>MakeChange()</b> </li><li>   â€“ <b>ReleaseCoffee()</b> </li><li>    â€“ <b>Alarm()</b> </li></ul><br>        . <br> <b>ControlHeater()</b>  ,        .       ,      ,    .      .     5. <br> <b>ShowGoods()</b>   .       ,   -   .      8,             . <br> <b>ScanKeys()</b>     ,       .     3,      40 . <br> <b>AcceptMoney()</b>     .      ,   <b>ScanKeys(),</b>     20 . <br> <b>MakeChange ()</b>     .     <b>ReleaseCoffee()</b>    10. <br> <b>ReleaseCoffee()</b>   ,           .       2. <br>   â€“    ,  <b>Alarm()</b>      â€“ 1,     ,      . <br><br>  ,       .  ,      EEPROM   ,       . <br><br><pre> <code class="vbscript hljs"><span class="hljs-comment"><span class="hljs-comment">'    declare sub ControlHeater() declare sub ShowGoods() declare sub AcceptMoney() declare sub ScanKeys() declare sub MakeChange () declare sub ReleaseCoffee() declare sub Alarm()</span></span></code> </pre> <br>     RTOS      :          (  ,    ) â€“      . <br><br> , <b>ReleaseCoffee()</b>    : <br><br><pre> <code class="vbscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">sub</span></span> ReleaseCoffee() <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> OS_WaitMessage bCoffeeSelection wItem = OS_GetMessage(bCoffeeSelection) Release wItem <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sub</span></span></code> </pre> <br>  <b>ReleaseCoffee</b>        <b>bCoffeeSelection</b>    ,     (   ,      ).    , <b>ReleaseCoffee()</b>    ,    ,     (  ) <b>wItem</b>    <b>OS_GetMessage</b>    .  <b>ReleaseCoffee()</b>   ,       : <br><br><pre> <code class="vbscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">dim</span></span> bCoffeeSelection as byte bCoffeeSelection = OS_CreateMessage()</code> </pre> <br>    , <b>ShowGoods()</b>            .       <b>ReleaseCoffee()</b> ,   .       : <br><br><pre> <code class="vbscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">dim</span></span> bGoodsReliased as byte bGoodsReliased = OS_CreateEvent()</code> </pre> <br>    <b>ReleaseCoffee()</b>   <b>Release wItem</b>     <b>bGoodsReliased</b> : <br><br><pre> <code class="vbscript hljs">OS_SignalEvent bGoodsReliased</code> </pre> <br><h3>   </h3><br>  ,     ,    ,      ,     .      <b>OS_Init</b> : <br><br><pre> <code class="vbscript hljs">OS_Init Mailfuncion</code> </pre> <br>       â€“ ,      : <br><br><pre> <code class="vbscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">sub</span></span> Mailfuncion (bCoffeeErr) print <span class="hljs-string"><span class="hljs-string">"Mailfunction! Error #: "</span></span>; bCoffeeErr <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> isErrCritical (bCoffeeErr) = <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> CallService(bCoffeeErr) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sub</span></span></code> </pre><br>      (    -  :  ,  GSM-  ..),   ,   ,    . <br><br><h3>   </h3><br>   ,  ,   ..     ,   .  ,           <b>OS_InitTask</b> : <br><br><pre> <code class="vbscript hljs">OS_InitTask ControlHeater , <span class="hljs-number"><span class="hljs-number">5</span></span> OS_InitTask ShowGoods , <span class="hljs-number"><span class="hljs-number">8</span></span> OS_InitTask AcceptMoney , <span class="hljs-number"><span class="hljs-number">3</span></span> OS_InitTask ScanKeys , <span class="hljs-number"><span class="hljs-number">3</span></span> OS_InitTask MakeChange, <span class="hljs-number"><span class="hljs-number">10</span></span> OS_InitTask ReleaseCoffee , <span class="hljs-number"><span class="hljs-number">2</span></span> OS_InitTask Alarm , <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> <br>      , ,    , ,         .          .     ,      <b>OS_ResumeTask</b>    Â«  Â»: <br><br><pre> <code class="vbscript hljs">OS_ResumeTask ControlHeater OS_ResumeTask ShowGoods OS_ResumeTask AcceptMoney OS_ResumeTask ScanKeys OS_ResumeTask MakeChange OS_ResumeTask ReleaseCoffee OS_ResumeTask Alarm</code> </pre> <br>   ,         ;          Â«Â»       .  <b>OS_ResumeTask</b>           (  ),    . ,  ,    ,   . <br><br><h3>   </h3><br>     ,   .     : <br><br><pre> <code class="vbscript hljs">OS_Sheduler</code> </pre> <br>          <b>end</b> â€“         . <br><br>     : <br><br><pre> <code class="vbscript hljs"><span class="hljs-comment"><span class="hljs-comment">'    config submode = old $include "..\aquaRTOS_1.05.bas" $include "coffee_hardware.bas" '      '       Coffee_ $regfile = "m328pdef.dat" ' Arduino Nano v3 $crystal = 16000000 $hwstack = 48 $swstack = 48 $framesize = 64 Coffee_InitHardware '    '   declare sub Mailfuncion (byval bCoffeeErr as byte) '   declare sub ControlHeater () '   declare sub ShowGoods () '    declare sub AcceptMoney () '   declare sub ScanKeys () '   declare sub MakeChange () '      declare sub ReleaseCoffee () '   declare sub Alarm () '    '     Coffee_InitHardware () '   dim wMoney as long '    dim wGoods as long '   ' ***    *** '   OS_Init Mailfuncion '       dim bCoffeeSelection as byte bCoffeeSelection = OS_CreateMessage() '     dim bGoodsReliased as byte bGoodsReliased = OS_CreateEvent() '   OS_InitTask ControlHeater , 5 OS_InitTask ShowGoods , 8 OS_InitTask AcceptMoney , 3 OS_InitTask ScanKeys , 3 OS_InitTask MakeChange, 10 OS_InitTask ReleaseCoffee , 2 OS_InitTask Alarm , 1 '     OS_ResumeTask ControlHeater OS_ResumeTask ShowGoods OS_ResumeTask AcceptMoney OS_ResumeTask ScanKeys OS_ResumeTask MakeChange OS_ResumeTask ReleaseCoffee OS_ResumeTask Alarm '   OS_Sheduler end ' ***   *** ' ----------------------------------- sub ControlHeater() do select case GetWaterTemp() case is &gt; 97 Coffee_HeaterOff '   case is &lt; 95 Coffee_HeaterOn '   case is &lt; 5 CallServce (WARNING_WATER_FROZEN) '   end select OS_Delay 60000 '  1  loop end sub ' ----------------------------------- sub ShowGoods() do LEDS = Coffee_GetDrinkSupplies() '    D, '         '   LEDS OS_WaitEvent bGoodsReliased '   " " loop end sub ' ----------------------------------- sub AcceptMoney() do wMoney = wMoney + ReadMoneyAcceptor() OS_Delay 20 loop end sub ' ----------------------------------- sub ScanKeys() do wGoods = ButtonPressed() if wMoney &gt;= GostOf(wGoods) then OS_SendMessage bCoffeeSelection, wGoods '     bCoffeeSelection,  '     end if OS_Delay 40 loop end sub ' ----------------------------------- sub MakeChange() do OS_WaitEvent bGoodsReliased '   " " Refund wMoney loop end sub ' ----------------------------------- sub ReleaseCoffee() do OS_WaitMessage bCoffeeSelection '  bCoffeeSelection wItem = OS_GetMessage(bCoffeeSelection) '   Release wItem '    wMoney = wMoney â€“ CostOf (wItem) '     OS_SignalEvent bGoodsReliased '     '  ,       : ' MakeChange  ShowGoods '  ,  ,     loop end sub ' ----------------------------------- sub Alarm() do OS_Delay 1000 if Hijack() = 1 then CallPolice() end if loop end sub ' ----------------------------------- ' ***    *** sub Mailfuncion (bCoffeeErr) print "Mailfunction! Error #: "; bCoffeeErr if isErrCritical (bCoffeeErr) = 1 then CallService() end if end sub</span></span></code> </pre> <br> ,             ,    .              <b>OS_SendMessage()</b>  ,        /.     .  ,   ,  ,  ,     . <br><br><h2>   AQUA RTOS </h2><br> <a href=""><b>   1.05     </b></a> <br><br><h2>  </h2><br> <i>Q:  AQUA?</i> <br> A: ,    ,   Â« Â»,   ,   .   ,   ,     ,  ,  Â« Â»   WiFi-.   ,  ,  ,     EEPROM  ,  , - .            .      â€“       Â« Â»,    ,  .    ,    .    AQUA. <br><br> <i>Q:        ?</i> <br> A: . ,  ,          ,      ,    ,    .   ,        .    ,   ,      ,       ,    ,  , -,  .   ,         . , -     ( ? â€“   )    .         . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN453708/">https://habr.com/ru/post/zh-CN453708/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN453694/index.html">åƒåœ¨Linuxä¸­ä¸€æ ·é€šè¿‡SSHè¿æ¥åˆ°Windows</a></li>
<li><a href="../zh-CN453696/index.html">è§’åº¦åŒå‘ç»‘å®šï¼Œå¤šä¸€ç‚¹ç†è§£</a></li>
<li><a href="../zh-CN453698/index.html">é‡å­æ„è¯†ä¸­çš„é‡å­ä¿¡æ¯</a></li>
<li><a href="../zh-CN453700/index.html">æœ‰å…³SDL 2çš„è¯¾ç¨‹ï¼šç¬¬1è¯¾-æ‚¨å¥½ï¼ŒSDL 2</a></li>
<li><a href="../zh-CN453706/index.html">æˆ‘å¦‚ä½•é€šè¿‡Google Cloud Professionalæ•°æ®å·¥ç¨‹å¸ˆè®¤è¯è€ƒè¯•</a></li>
<li><a href="../zh-CN453710/index.html">å¤§å‹é¡¹ç›®çš„å¼€å‘å®è·µï¼šmitp SberPractice iOSï¼ƒ1</a></li>
<li><a href="../zh-CN453712/index.html">eBayå¦‚ä½•åœ¨WebAssemblyä¸Šè¿›è¡Œæ¡å½¢ç æ‰«æä»ª</a></li>
<li><a href="../zh-CN453714/index.html">TONæµ‹è¯•å®¢æˆ·ç«¯ï¼ˆç”µæŠ¥å¼€æ”¾ç½‘ç»œï¼‰å’Œç”¨äºæ™ºèƒ½åˆçº¦çš„æ–°Fiftè¯­è¨€</a></li>
<li><a href="../zh-CN453716/index.html">å®¶åº­ITäººå‘˜çš„å›½å®¶/åœ°åŒºåˆä½œ-æœ‰äººå—ï¼Ÿ</a></li>
<li><a href="../zh-CN453720/index.html">Cï¼ƒä¸­Lambdaè¡¨è¾¾å¼çš„ç²¾å¦™ä¹‹å¤„</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>