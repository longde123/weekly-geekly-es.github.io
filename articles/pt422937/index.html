<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üõçÔ∏è üò≥ ü¶å Armazenamento em cache em disco de √°rvores de computa√ß√£o pregui√ßosa üîÑ üë≤üèª üë©üèæ‚Äçü§ù‚Äçüë®üèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="N√£o vale a pena falar em detalhes sobre o conceito de computa√ß√£o lenta. A id√©ia de fazer a mesma coisa com menos frequ√™ncia, especialmente se for long...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Armazenamento em cache em disco de √°rvores de computa√ß√£o pregui√ßosa</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/422937/"><p>  N√£o vale a pena falar em detalhes sobre o conceito de computa√ß√£o lenta.  A id√©ia de fazer a mesma coisa com menos frequ√™ncia, especialmente se for longa e pesada, √© t√£o antiga quanto o mundo.  Porque imediatamente ao ponto. </p><br><p>  Segundo o autor deste texto, um lenificador normal deve: </p><br><ol><li>  Salve os c√°lculos entre as chamadas do programa. </li><li>  Rastreie as altera√ß√µes na √°rvore de c√°lculo. </li><li>  Possui sintaxe moderadamente transparente. </li></ol><br><p><img src="https://habrastorage.org/webt/de/dw/ec/dedwectoekaqhwzkercd2dgnk1u.jpeg" alt="√Årvore pregui√ßosa"></p><a name="habracut"></a><br><h2 id="koncepciya">  Conceito </h2><br><p>  Em ordem: </p><br><ol><li> Salve os c√°lculos entre as chamadas do programa: <br>  De fato, se chamamos o mesmo script v√°rias dezenas de centenas de vezes por dia, por que devemos recalcular o mesmo cada vez que o script √© chamado, se √© poss√≠vel armazenar o objeto de resultado em um arquivo.  √â melhor puxar um objeto do disco, mas ... devemos ter certeza de sua relev√¢ncia.  De repente, o script √© reescrito e o objeto salvo est√° desatualizado.  Com base nisso, n√£o podemos carregar o objeto apenas com a exist√™ncia de um arquivo.  O segundo ponto segue a partir disso. </li><li>  Acompanhe as altera√ß√µes na √°rvore de c√°lculo: <br>  A necessidade de atualizar o objeto deve ser calculada com base nos dados sobre os argumentos da fun√ß√£o que o gera.  Portanto, teremos certeza de que o objeto carregado √© v√°lido.  De fato, para uma fun√ß√£o pura, o valor de retorno depende apenas dos argumentos.  Isso significa que, enquanto armazenamos em cache os resultados de fun√ß√µes puras e monitoramos a mudan√ßa de argumentos, podemos ter calma quanto √† relev√¢ncia do cache.  Al√©m disso, se o objeto calculado depender de outro objeto armazenado em cache (lento), que por sua vez depende de outro, ser√° necess√°rio trabalhar corretamente as altera√ß√µes nesses objetos, atualizando oportunamente os n√≥s da cadeia que deixaram de ser relevantes.  Por outro lado, seria bom levar em considera√ß√£o que nem sempre precisamos carregar os dados de toda a cadeia de c√°lculo.  Freq√ºentemente, carregar apenas o objeto de resultado final √© suficiente. </li><li>  Possui sintaxe moderadamente transparente: <br>  Este ponto √© claro.  Se, para reescrever o script para c√°lculos pregui√ßosos, for necess√°rio alterar o c√≥digo inteiro, essa √© uma solu√ß√£o mais ou menos.  As altera√ß√µes devem ser feitas no m√≠nimo. </li></ol><br><p>  Essa linha de racioc√≠nio levou a uma solu√ß√£o t√©cnica, denominada em python pela biblioteca evalcache (links no final do artigo). </p><br><h2 id="sintaksicheskoe-reshenie-i-mehanizm-raboty">  Solu√ß√£o de sintaxe e mecanismo de trabalho </h2><br><div class="spoiler">  <b class="spoiler_title">Exemplo simples</b> <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> evalcache <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> hashlib <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> shelve lazy = evalcache.Lazy(cache = shelve.open(<span class="hljs-string"><span class="hljs-string">".cache"</span></span>), algo = hashlib.sha256) @lazy <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">summ</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a,b,c)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a + b + c @lazy <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sqr</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a * a a = <span class="hljs-number"><span class="hljs-number">1</span></span> b = sqr(<span class="hljs-number"><span class="hljs-number">2</span></span>) c = lazy(<span class="hljs-number"><span class="hljs-number">3</span></span>) lazyresult = summ(a, b, c) result = lazyresult.unlazy() print(lazyresult) <span class="hljs-comment"><span class="hljs-comment">#f8a871cd8c85850f6bf2ec96b223de2d302dd7f38c749867c2851deb0b24315c print(result) #8</span></span></code> </pre> </div></div><br><p>  Como isso funciona? </p><br><p>  A primeira coisa que chama sua aten√ß√£o aqui √© a cria√ß√£o do decorador pregui√ßoso.  Essa solu√ß√£o sint√°tica √© bastante padr√£o para os pit√£es Python.  O decorador lento √© passado para um objeto de cache no qual o lenificator armazenar√° os resultados dos c√°lculos.  Os requisitos da interface do tipo dict s√£o sobrepostos ao tipo de cache.  Em outras palavras, podemos armazenar em cache tudo o que implementa a mesma interface que o tipo de ditado.  Para demonstrar no exemplo acima, usamos o dicion√°rio da biblioteca de arquivar. </p><br><p>  O decorador tamb√©m recebe um protocolo de hash que ele usar√° para construir chaves de hash de objetos e algumas op√ß√µes adicionais (permiss√£o de grava√ß√£o, permiss√£o de leitura, sa√≠da de depura√ß√£o), que podem ser encontradas na documenta√ß√£o ou no c√≥digo. </p><br><p>  O decorador pode ser aplicado a fun√ß√µes e objetos de outros tipos.  Nesse momento, um objeto lento √© constru√≠do com base em uma chave de hash calculada com base na representa√ß√£o (ou usando uma fun√ß√£o de hash especialmente definida para esse tipo de fun√ß√£o). </p><br><p>  Um recurso importante da biblioteca √© que um objeto lento pode gerar outros objetos pregui√ßosos, e o hash do pai (ou pais) ser√° misturado √† chave de hash do descendente.  Para objetos pregui√ßosos, √© permitido o uso da opera√ß√£o de obter um atributo, o uso de chamadas ( <code>__call__</code> ) de objetos e o uso de operadores. </p><br><p>  Ao passar por um script, de fato, nenhum c√°lculo √© realizado.  Para b, o quadrado n√£o √© calculado e para o resultado lazyres, a soma dos argumentos n√£o √© considerada.  Em vez disso, uma √°rvore de opera√ß√µes √© constru√≠da e chaves de hash de objetos pregui√ßosos s√£o calculadas. </p><br><p>  C√°lculos reais (se o resultado n√£o tiver sido colocado anteriormente no cache) ser√£o executados apenas na linha: <code>result = lazyresult.unlazy()</code> </p><br><p>  Se o objeto foi calculado anteriormente, ele ser√° carregado a partir do arquivo. <br>  Voc√™ pode visualizar a √°rvore de constru√ß√£o: </p><br><div class="spoiler">  <b class="spoiler_title">Criar visualiza√ß√£o em √°rvore</b> <div class="spoiler_text"><pre> <code class="python hljs">evalcache.print_tree(lazyresult) ... generic: &lt;function summ at <span class="hljs-number"><span class="hljs-number">0x7f1cfc0d5048</span></span>&gt; args: <span class="hljs-number"><span class="hljs-number">1</span></span> generic: &lt;function sqr at <span class="hljs-number"><span class="hljs-number">0x7f1cf9af29d8</span></span>&gt; args: <span class="hljs-number"><span class="hljs-number">2</span></span> ------- <span class="hljs-number"><span class="hljs-number">3</span></span> -------</code> </pre> </div></div><br><p>  Como os hashes dos objetos s√£o constru√≠dos com base nos dados dos argumentos que geram esses objetos, quando o argumento muda, o hash do objeto muda e, com ele, os hashes de toda a cadeia, dependendo dele.  Isso permite que voc√™ mantenha os dados do cache atualizados, fazendo atualiza√ß√µes no prazo. </p><br><p>  Objetos pregui√ßosos se alinham em uma √°rvore.  Se realizarmos uma opera√ß√£o pregui√ßosa em um dos objetos, exatamente quantos objetos ser√£o carregados e contados conforme necess√°rio para obter um resultado v√°lido.  Idealmente, o objeto necess√°rio simplesmente ser√° carregado.  Nesse caso, o algoritmo n√£o puxar√° objetos formadores para a mem√≥ria. </p><br><h2 id="v-deystvii">  Em a√ß√£o </h2><br><p>  Acima foi um exemplo simples que mostra a sintaxe, mas n√£o demonstra o poder computacional da abordagem. <br>  Aqui est√° um exemplo um pouco mais pr√≥ximo da vida real (usado pelo sympy). </p><br><div class="spoiler">  <b class="spoiler_title">Exemplo usando sympy e numpy</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/python3.5 from sympy import * import numpy as np import math import evalcache lazy = evalcache.Lazy(evalcache.DirCache(".evalcache"), diag = True) pj1, psi, y0, gamma, gr= symbols("pj1 psi y0 gamma gr") ###################### Construct sympy expression ##################### F = 2500 xright = 625 re = 625 y0 = 1650 gr = 2*math.pi / 360 #gamma = pi / 2 xj1q = xright + re * (1 - cos(psi)) yj1q = (xright + re) * tan(psi) - re * sin(psi) #+ y0 pj1 = sqrt(xj1q**2 + yj1q**2) pj2 = pj1 + y0 * sin(psi) zj2 = (pj2**2)/4/F asqrt = sqrt(pj2**2 + 4*F**2) xp2 = 2*F / asqrt yp2 = pj2 / asqrt xp3 = yp2 yp3 = -xp2 xmpsi = 1295 gmpsi = 106 * gr aepsi = 600 bepsi = 125 b = 0.5*(1-cos(pi * gamma / gmpsi)) p1 = ( (gamma * xmpsi / gmpsi * xp2) * (1-b) + (aepsi * xp2 * sin(gamma) + bepsi * yp2 * (1-cos(gamma)))*b + pj1 ) ####################################################################### #First lazy node. Simplify is long operation. #Sympy has very good representations for expressions print("Expression:", repr(p1)) print() p1 = lazy(simplify)(p1) ######################################################################################### ## Really don't need to lazify fast operations Na = 200 angles = [t * 2 * math.pi / 360 / Na * 106 for t in range(0,Na+1)] N = int(200) a = (np.arange(0,N+1) - N/2) * 90/360*2*math.pi/N ######################################################################################### @lazy def genarray(angles, a, p1): points = [] for i in range(0, len(angles)): ex = p1.subs(gamma, angles[i]) func = lambdify(psi, ex, 'numpy') # returns a numpy-ready function rads = func(a) xs = rads*np.cos(a) ys = rads*np.sin(a) arr = np.column_stack((xs,ys,[i*2]*len(xs))) points.append(arr) return points #Second lazy node. arr = genarray(angles, a, p1).unlazy() print("\nResult list:", arr.__class__, len(arr))</span></span></code> </pre> </div></div><br><p>  Opera√ß√µes para simplificar express√µes simb√≥licas s√£o extremamente caras e pedem literalmente lenifica√ß√£o.  A constru√ß√£o adicional de uma grande variedade leva ainda mais tempo, mas, gra√ßas √† lenifica√ß√£o, os resultados ser√£o extra√≠dos do cache.  Observe que, se quaisquer coeficientes forem alterados na parte superior do script em que a express√£o sympy √© gerada, os resultados ser√£o recalculados porque a chave de hash do objeto lento ser√° alterada (gra√ßas √†s declara√ß√µes <code>__repr__</code> ). </p><br><p>  Muitas vezes, uma situa√ß√£o ocorre quando um pesquisador realiza experimentos computacionais em um objeto gerado por um longo tempo.  Ele pode usar v√°rios scripts para separar a gera√ß√£o e o uso do objeto, o que pode causar problemas com a atualiza√ß√£o prematura dos dados.  A abordagem proposta pode facilitar esse caso. </p><br><h2 id="radi-chego-vsyo-zatevalos">  O que √© isso tudo? </h2><br><p>  evalcache faz parte do projeto zencad.  Este √© um pequeno script cadic, inspirado e explorando as mesmas id√©ias do openscad.  Diferentemente do openscad orientado a malha, o zencad em execu√ß√£o no n√∫cleo opencascade usa uma representa√ß√£o brep de objetos, e os scripts s√£o escritos em python. </p><br><p>  As opera√ß√µes geom√©tricas s√£o frequentemente realizadas por um longo per√≠odo de tempo.  A desvantagem dos sistemas de script cad √© que toda vez que voc√™ executa o script, o produto √© completamente recontado novamente.  Al√©m disso, com o crescimento e a complica√ß√£o do modelo, os custos indiretos n√£o crescem linearmente.  Isso leva ao fato de que voc√™ pode trabalhar confortavelmente apenas com modelos extremamente pequenos. </p><br><p>  A tarefa do evalcache era amenizar esse problema.  No zencad, todas as opera√ß√µes s√£o declaradas pregui√ßosas. </p><br><p>  Exemplos: </p><br><div class="spoiler">  <b class="spoiler_title">Exemplo de constru√ß√£o de modelo</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/python3 #coding: utf-8 from zencad import * xgate = 14.65 ygate = 11.6 zgate = 11 t = (xgate - 11.7) / 2 ear_r = 8.6/2 ear_w = 7.8 - ear_r ear_z = 3 hx_h = 2.0 bx = xgate + ear_w by = 2 bz = ear_z+1 gate = ( box(xgate, ygate, t).up(zgate - t) + box(t, ygate, zgate) + box(t, ygate, zgate).right(xgate - t) ) gate = gate.fillet(1, [5, 23,29, 76]) gate = gate.left(xgate/2) ear = (box(ear_w, ear_r * 2, ear_z) + cylinder(r = ear_r, h = ear_z).forw(ear_r).right(ear_w)).right(xgate/2 - t) hx = linear_extrude( ngon(r = 2.5, n = 6).rotateZ(deg(90)).forw(ear_r), hx_h ).up(ear_z - hx_h).right(xgate/2 -t + ear_w) m = ( gate + ear + ear.mirrorYZ() - hx - hx.mirrorYZ() - box(xgate-2*t, ygate, zgate, center = True).forw(ygate/2) - box(bx, by, bz, center = True).forw(ear_r).up(bz/2) - cylinder(r = 2/2, h = 100, center = True).right(xgate/2-t+ear_w).forw(ear_r) - cylinder(r = 2/2, h = 100, center = True).left(xgate/2-t+ear_w).forw(ear_r) ) display(m) show()</span></span></code> </pre> <br><p>  Este script gera o seguinte modelo: <br><img src="https://habrastorage.org/webt/np/4i/go/np4igo9nth8jdmuplhz6pd2o9mg.png"><br>  Observe que n√£o h√° chamadas evalcache no script.  O truque √© que a lenifica√ß√£o √© incorporada na pr√≥pria biblioteca do zencad e nem √© vis√≠vel √† primeira vista, embora todo o trabalho aqui esteja trabalhando com objetos pregui√ßosos, e o c√°lculo direto seja realizado apenas na fun√ß√£o 'display'.  Obviamente, se algum par√¢metro do modelo for alterado, o modelo ser√° recontado do local onde a primeira chave de hash foi alterada. </p></div></div><br><div class="spoiler">  <b class="spoiler_title">Modelos de computa√ß√£o volumosos</b> <div class="spoiler_text"><p>  Aqui est√° outro exemplo.  Desta vez, nos limitaremos a fotos: <br><img src="https://habrastorage.org/webt/go/3f/zu/go3fzuma_btpyqlvqsb8zxnc6qc.png"><br>  O c√°lculo de uma superf√≠cie rosqueada n√£o √© uma tarefa f√°cil.  No meu computador, esse parafuso √© constru√≠do na ordem de dez segundos ... A edi√ß√£o de um modelo com threads √© muito mais agrad√°vel usando o cache. </p><br><p>  E agora isso √© um milagre: <br><img src="https://habrastorage.org/webt/ux/qs/kc/uxqskci0b_u_3cfdghkpdliygou.png"><br>  Cruzar superf√≠cies rosqueadas √© uma tarefa computacional complexa.  Valor pr√°tico, no entanto, nada al√©m de verificar a matem√°tica.  O c√°lculo leva um minuto e meio.  Um objetivo digno de lenifica√ß√£o. </p></div></div><br><h2 id="problemy">  Os problemas </h2><br><p>  O cache pode n√£o funcionar como planejado. <br>  Os erros de cache podem ser divididos em <strong>falso positivo</strong> e <strong>falso negativo</strong> . </p><br><h3 id="lozhnootricatelnye-oshibki">  Erros negativos falsos </h3><br><p>  Erros de falso negativo s√£o situa√ß√µes em que o resultado do c√°lculo est√° no cache, mas o sistema n√£o o encontrou. <br>  Isso acontece se o algoritmo de chave de hash usado pelo evalcache, por algum motivo, produziu uma chave diferente para rec√°lculo.  Se a fun√ß√£o hash n√£o for substitu√≠da pelo objeto do tipo em cache, o evalcache utilizar√° o <code>__repr__</code> objeto para construir a chave. <br>  Ocorre um erro, por exemplo, se a classe que est√° sendo <code>object.__repr__</code> n√£o substituir o <code>object.__repr__</code> padr√£o <code>object.__repr__</code> , que muda do in√≠cio ao in√≠cio.  Ou, se o <code>__repr__</code> substitu√≠do, depende de alguma forma insignificante para o c√°lculo dos dados alterados (como o endere√ßo do objeto ou o carimbo de data / hora). </p><br><p>  Ruim: </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">A</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.i = <span class="hljs-number"><span class="hljs-number">3</span></span> A_lazy = lazy(A) A_lazy().unlazy() <span class="hljs-comment"><span class="hljs-comment">#        -  __repr__.</span></span></code> </pre> <br><p>  Bom: </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">A</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.i = <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__repr__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"A({})"</span></span>.format(self.i) A_lazy = lazy(A) A_lazy().unlazy() <span class="hljs-comment"><span class="hljs-comment">#     .</span></span></code> </pre> <br><p>  Os erros falsos negativos levam ao fato de que a lenifica√ß√£o n√£o funciona.  O objeto ser√° recontado a cada nova execu√ß√£o de script. </p><br><h3 id="lozhnopolozhitelnye-oshibki">  Erros de falsos positivos </h3><br><p>  Este √© um tipo de erro mais vil, pois leva a erros no objeto final de c√°lculo: <br>  Isso pode acontecer por duas raz√µes. </p><br><ul><li>  Incr√≠vel: <br>  Ocorreu uma colis√£o de chave de hash no cache.  Para o algoritmo sha256 com um espa√ßo de 115792089237316195423570985008687907853269984665640564039457584007913129639936 chaves poss√≠veis, a probabilidade de uma colis√£o √© desprez√≠vel. </li><li>  Prov√°vel: <br>  Uma representa√ß√£o de um objeto (ou uma fun√ß√£o de hash substitu√≠da) n√£o a descreve completamente ou coincide com a representa√ß√£o de um objeto de outro tipo. </li></ul><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">A</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.i = <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__repr__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"({})"</span></span>.format(self.i) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">B</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.i = <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__repr__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"({})"</span></span>.format(self.i) A_lazy = lazy(A) B_lazy = lazy(B) a = A_lazy().unlazy() b = B_lazy().unlazy() <span class="hljs-comment"><span class="hljs-comment">#.     B,        A.</span></span></code> </pre> <br><p>  Ambos os problemas est√£o relacionados a um objeto <code>__repr__</code> incompat√≠vel.  Se, por algum motivo, for imposs√≠vel substituir o tipo de objeto <code>__repr__</code> , a biblioteca permitir√° definir uma fun√ß√£o de hash especial para o tipo de usu√°rio. </p><br><h2 id="ob-analogah">  Sobre an√°logos </h2><br><p>  Existem muitas bibliotecas de lenifica√ß√£o que basicamente consideram suficiente executar um c√°lculo n√£o mais de uma vez por chamada de script. </p><br><p>  Existem muitas bibliotecas de cache de disco que, a seu pedido, salvar√£o um objeto com a chave necess√°ria para voc√™. </p><br><p>  Mas ainda n√£o consegui encontrar bibliotecas que permitissem resultados de armazenamento em cache na √°rvore de execu√ß√£o.  Se houver, por favor, inseguro. </p><br><p>  Refer√™ncias: </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Projeto Github</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Projeto Pypi</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt422937/">https://habr.com/ru/post/pt422937/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt422923/index.html">Como marcar o dia do programador sem decorar o ficus do escrit√≥rio com zeros e uns</a></li>
<li><a href="../pt422925/index.html">Entrevista com o palestrante da confer√™ncia RubyRussia, Godfrey Chan</a></li>
<li><a href="../pt422929/index.html">O Yandex Mail [ficou] indispon√≠vel por cerca de uma hora √†s 12:16, hor√°rio de Moscou</a></li>
<li><a href="../pt422931/index.html">Examinamos as ferramentas para monitorar aplicativos distribu√≠dos</a></li>
<li><a href="../pt422935/index.html">O 2GIS est√° ao seu alcance. Como adicionamos um mapa ao Apple Watch</a></li>
<li><a href="../pt422939/index.html">O livro "Kali Linux from developer"</a></li>
<li><a href="../pt422941/index.html">"Tr√™s em um barco, pobreza e c√£es", ou como o antiplagiarismo procura parafrasear</a></li>
<li><a href="../pt422943/index.html">Um pouco sobre minera√ß√£o industrial</a></li>
<li><a href="../pt422945/index.html">27 de setembro de Moscou - Mitap QIWI SERVER PARTY 3.0</a></li>
<li><a href="../pt422947/index.html">Como configurar os backups da Veeam no armazenamento de blob do Microsoft Azure usando o StarWind VTL</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>