<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🛸 👩‍💼 🧙 كيف لا تطلق النار على ساقك مع آلة الدولة 👨🏿‍💼 📇 🤠</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="نادرًا ما يتم استخدام آلة الحالة من قبل مطوري الهواتف المحمولة. على الرغم من أن الأغلبية تعرف مبادئ العمل وتنفذها بسهولة بشكل مستقل. في المقالة ، سنكت...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>كيف لا تطلق النار على ساقك مع آلة الدولة</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/oleg-bunin/blog/423293/" style=";text-align:right;direction:rtl"> نادرًا ما يتم استخدام آلة الحالة من قبل مطوري الهواتف المحمولة.  على الرغم من أن الأغلبية تعرف مبادئ العمل وتنفذها بسهولة بشكل مستقل.  في المقالة ، سنكتشف المهام التي يتم حلها بواسطة جهاز الحالة باستخدام مثال تطبيقات iOS.  يتم تطبيق القصة في الطبيعة ومخصصة للجوانب العملية للعمل. <br><br>  تحت الخفض ، ستجد <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" class="user_link">نصًا موسعًا</a> لخطاب ألكسندر سيشيف ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" class="user_link">Brain89</a> ) على <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">AppsConf</a> ، والذي شارك فيه خياراته لاستخدام جهاز الحالة في تطوير تطبيقات غير ألعاب. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/GKMrJe3mfwU" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <b>نبذة عن المتحدث: شارك</b> ألكسندر سيشيف في تطوير iOS لمدة ثماني سنوات ، شارك خلالها في إنشاء تطبيقات بسيطة وعملاء معقدين للشبكات الاجتماعية والقطاع المالي.  في الوقت الحالي ، هو رائد فني في Sberbank. <br><a name="habracut"></a><br>  يأتون إلى البرمجة من العديد من المجالات ، ولديهم خلفيات وخبرات مختلفة ، لذلك نتذكر أولاً النظرية الأساسية. <br><br><h2 style=";text-align:right;direction:rtl">  بيان المشكلة <br></h2><br><img src="https://habrastorage.org/webt/ow/wa/vd/owwavd51w_12g14nwehehu4yfu4.jpeg"><br><br>  آلة الحالة عبارة عن تجريد رياضي يتكون من ثلاثة عناصر رئيسية: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  العديد من الدول الداخلية </li><li style=";text-align:right;direction:rtl">  مجموعة إشارات الإدخال التي تحدد الانتقال من الحالة الحالية إلى الحالة التالية ، </li><li style=";text-align:right;direction:rtl">  مجموعات من الحالات النهائية ، عند الانتقال التي يكملها الأوتوماتي عمله ("تقبل كلمة الإدخال س"). </li></ul><br><h3 style=";text-align:right;direction:rtl">  الشرط <br></h3><br>  نعني بالحالة متغيرًا أو مجموعة من المتغيرات التي تحدد سلوك كائن ما.  على سبيل المثال ، في تطبيق "الإعدادات <strong>"</strong> القياسي لنظام iOS ، يوجد عنصر "غامق" ("أساسي → وصول عام").  تسمح لك قيمة هذا العنصر بالتبديل بين خيارين لعرض النص على شاشة الجهاز. <br><br><img src="https://habrastorage.org/webt/mx/if/68/mxif68m4rgadt4kgjqovnzswvny.jpeg"><br><br>  عن طريق إرسال نفس الإشارة "تغيير قيمة مفتاح التبديل <strong>"</strong> ، نحصل على رد فعل مختلف للنظام: إما نمط الخط المعتاد أو غامق - كل شيء بسيط.  كونه في حالات مختلفة ويتلقى نفس الإشارة ، يتفاعل الكائن بشكل مختلف مع التغيير في الحالة. <br><br><h2 style=";text-align:right;direction:rtl">  المهام التقليدية <br></h2><br>  من الناحية العملية ، غالبًا ما يصادف المبرمجون آلة محدودة. <br><br><h3 style=";text-align:right;direction:rtl">  تطبيقات الألعاب <br></h3><br>  هذا هو أول شيء يتبادر إلى الذهن - كجزء من اللعب ، يتم تحديد كل شيء تقريبًا من خلال حالة اللعبة الحالية.  لذا ، تفترض Apple استخدام أجهزة الحالة بشكل أساسي في تطبيقات الألعاب (سنناقش هذا بالتفصيل لاحقًا). <br><br>  يمكن توضيح سلوك النظام عند معالجة نفس الإشارة ولكن مع حالة داخلية مختلفة من خلال الأمثلة التالية.  على سبيل المثال: <br><br>  ● يمكن أن تكون شخصية اللعبة ذات نقاط قوة مختلفة: واحدة في الدروع الميكانيكية وبندقية الليزر ، والأخرى يتم ضخها بشكل ضعيف.  اعتمادًا على هذه الحالة ، يتم تحديد سلوك الأعداء: إما أن يهاجموا أو يهربوا. <br><br><img src="https://habrastorage.org/webt/-9/ur/ci/-9urcijninqy6zo8as2i8adn46o.jpeg"><br><br>  ● اللعبة متوقفة مؤقتًا - لا حاجة لرسم الإطار الحالي ؛  اللاعب في وضع القائمة أو في عملية اللعبة - العرض مختلف تمامًا. <br><br><h3 style=";text-align:right;direction:rtl">  تحليل النص <br></h3><br>  تعد مرشحات البريد العشوائي من أكثر مهام تحليل النص شيوعًا والمرتبطة باستخدام جهاز الحالة.  يجب ألا يكون هناك مجموعة من كلمات التوقف وتسلسل الإدخال.  يجب عليك إما تصفية هذا التسلسل أو عدم عرضه على الإطلاق. <br><br><img src="https://habrastorage.org/webt/vo/ka/c2/vokac2-lpmhmsapxqmtked5buo4.jpeg"><br><br>  رسميا ، هذه هي مهمة العثور على سلسلة فرعية في سلسلة.  لحلها ، يتم استخدام خوارزمية Knut-Morris-Pratt ، والتي يكون تنفيذ البرنامج لها عبارة عن آلة حالة محدودة.  الحالة هي إزاحة تسلسل الإدخال وعدد الأحرف الموجودة في النمط - كلمة التوقف. <br><br>  أيضًا ، <strong>عند تحليل التعبيرات العادية</strong> ، غالبًا ما يتم استخدام آلات الحالة المحدودة. <br><br><h3 style=";text-align:right;direction:rtl">  معالجة الاستعلام الموازي <br></h3><br>  جهاز الحالة هو أحد الخيارات لتنفيذ معالجة الطلب وتنفيذ مجموعة صارمة من التعليمات. <br><br><img src="https://habrastorage.org/webt/i_/ll/n9/i_lln9kr6-tfmnr0ejx7mjn3ytk.jpeg"><br><br>  على سبيل المثال ، في خادم الويب nginx ، تتم معالجة طلبات إدخال البروتوكولات المختلفة باستخدام أجهزة الحالة.  بناءً على البروتوكول المحدد ، يتم تحديد تنفيذ محدد لآلة الحالة ، وبالتالي يتم تنفيذ مجموعة من التعليمات المعروفة. <br><br>  بشكل عام ، يتم الحصول على فئتين من المشاكل: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  إدارة منطق كائن معقد مع حالة داخلية معقدة ، </li><li style=";text-align:right;direction:rtl">  تشكيل التحكم وتدفق البيانات (وصف الخوارزمية). </li></ul><br>  من الواضح أن مثل هذه المهام الشائعة تصادف في ممارسة أي مبرمج.  لذلك ، من الممكن استخدام جهاز حالة ، بما في ذلك في تطبيقات المحتوى غير المخصصة للألعاب ، والتي تشارك في معظم مطوري الهواتف المحمولة. <br><br>  بعد ذلك ، سنحلل أين ومتى يمكن استخدام آلة الحالة لإنشاء تطبيقات iOS نموذجية. <br><br>  تحتوي معظم تطبيقات الهاتف المحمول على بنية ذات طبقات.  هناك ثلاث طبقات أساسية. <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  طبقة العرض. </li><li style=";text-align:right;direction:rtl">  طبقة منطق الأعمال. </li><li style=";text-align:right;direction:rtl">  مجموعة من المساعدين وعملاء الشبكة وما إلى ذلك (الطبقة الأساسية). </li></ul><br>  كما هو موضح أعلاه ، تتحكم آلة الحالة في الكائنات ذات السلوك المعقد ، أي  مع حالة معقدة.  توجد هذه الكائنات بالتأكيد في طبقة العرض التقديمي ، لأنها تتخذ قرارات عن طريق معالجة مدخلات المستخدم أو الرسائل من نظام التشغيل.  دعونا نلقي نظرة على الأساليب المختلفة لتنفيذها. <br><br><img src="https://habrastorage.org/webt/ic/iq/pw/iciqpwtfuuokmoik0j5abflppg4.jpeg"><br><br>  في الاستعارة المعمارية الكلاسيكية لـ Model-View-Controller ، ستكون الحالة في وحدة التحكم: فهي تقرر ما يتم عرضه في طريقة العرض وكيفية الاستجابة لإشارات الإدخال: الضغط على زر وتغيير شريط التمرير وما إلى ذلك.  من المنطقي أن أحد تطبيقات وحدة التحكم هو جهاز الحالة. <br><br><img src="https://habrastorage.org/webt/xt/sv/cr/xtsvcrd3ehffxfreo8ivtwx7jy8.jpeg"><br><br>  في VIPER ، تكون الدولة في مقدم العرض: هو الذي يحدد انتقال التنقل المحدد من الشاشة الحالية وعرض البيانات في طريقة العرض. <br><br><img src="https://habrastorage.org/webt/_p/ob/xb/_pobxbwjjwduuken8qiucqg5o30.jpeg"><br><br>  في Model-View-ViewModel ، تكون الحالة في ViewModel.  بغض النظر عما إذا كان لدينا ملفات تفاعلية أم لا ، سيتم تسجيل سلوك الوحدة المحددة في استعارة MVVM في ViewModel.  من الواضح أن تنفيذه من خلال جهاز الدولة هو خيار مقبول. <br><br><img src="https://habrastorage.org/webt/x0/8e/kf/x08ekfoc9zyg1s9_9jiirethpgm.jpeg"><br><br>  كائنات معقدة بمجموعة غير تافهة من الحالات مصادفة أيضًا على طبقة منطق العمل الخاصة بالتطبيق.  على سبيل المثال ، عميل شبكة ، يقوم ، بناءً على ما إذا كان يتم إنشاء اتصال بالخادم أم لا ، بإرسال الطلبات أو حظرها.  أو كائن للعمل مع قاعدة بيانات تحتاج إلى ترجمة وظائف اللغة إلى استعلام SQL ، وتنفيذها ، والحصول على استجابة ، وترجمتها إلى كائنات ، إلخ. <br><br><img src="https://habrastorage.org/webt/pb/bq/yt/pbbqytlwgtmbcutdlliqv5xkwjs.jpeg"><br><br>  في المهام الأكثر تحديدًا ، مثل وحدة الدفع ، حيث تكون مجموعة أوسع من الحالات والمنطق المعقد ، يكون استخدام جهاز الحالة صحيحًا أيضًا. <br><br>  ونتيجة لذلك ، نجد أنه في التطبيقات المحمولة هناك العديد من الأشياء التي تم وصف حالتها ومنطق سلوكها أكثر تعقيدًا من جملة واحدة.  يجب أن يكونوا قادرين على الإدارة. <br><br>  ضع في اعتبارك <strong>مثالًا حقيقيًا</strong> وافهم في أي نقطة تكون هناك حاجة فعلية لآلة حالة محدودة ، وأين لا يكون مبررًا لتطبيقها. <br><br><img src="https://habrastorage.org/webt/96/hk/lw/96hklw8ditorh2imz2zcx36wmga.jpeg"><br><br>  ضع في اعتبارك ViewController من تطبيق Championship iOS ، وهو مورد رياضي شهير.  تعرض وحدة التحكم هذه مجموعة من التعليقات في شكل جدولي.  يقوم المستخدمون بإدخال وصف المباراة ، وعرض الصور ، وقراءة الأخبار وترك تعليقاتهم.  الشاشة بسيطة للغاية: تعطي الطبقة الأساسية البيانات ، وتتم معالجتها وعرضها على الشاشة. <br><img src="https://habrastorage.org/webt/m7/m1/yz/m7m1yz9--h4qttlcuxjrozagl48.jpeg"><br><br>  يمكن إرسال بيانات حقيقية أو خطأ إلى الشاشة.  لذلك يظهر أول عامل شرطي ، الفرع الأول ، الذي يحدد السلوك الإضافي للتطبيق. <br><br>  السؤال التالي هو ماذا تفعل إذا لم تكن هناك بيانات.  هل هذا الشرط خطأ؟  على الأرجح لا: ليس لدى كل أخبار تعليقات المستخدمين.  على سبيل المثال ، لا يهتم الهوكي في مصر بأي شخص ؛ في مثل هذه المقالة لا توجد تعليقات في العادة.  هذا هو السلوك الطبيعي والحالة العادية للشاشة التي تحتاج إلى عرضها.  لذلك يظهر العامل الشرطي الثاني. <br><br>  من المنطقي أن نفترض أن هناك أيضًا حالة بداية يتوقع فيها المستخدم البيانات (على سبيل المثال ، عندما تظهر شاشة التعليق على الشاشة فقط).  في هذه الحالة ، اعرض مؤشر التحميل بشكل صحيح.  هذا هو البيان الشرطي الثالث. <br><br>  لذلك لدينا بالفعل أربع حالات على شاشة واحدة بسيطة ، يتم وصف منطق العرض الخاص بها من خلال بنية if-else-if-else. <br><br><img src="https://habrastorage.org/webt/ys/yg/mq/ysygmq4fbj3mog3p6mjb0t5av9o.jpeg"><br><br>  ولكن ماذا لو كان هناك المزيد من هذه الدول؟  يؤدي التطور التكراري للشاشة إلى تشابك معقد للبنى الشرطية ، أو مجموعة من الأعلام ، أو حالة تبديل متعددة مرهقة.  هذا الرمز مخيف.  تخيل أن المطور الذي سيدعمه يعرف المكان الذي تعيش فيه ولديه منشار يحمله معه دائمًا.  وتريد حقًا أن ترقى إلى معاشك الصغير ولكن الذي تستحقه. <br><br>  أعتقد في هذه الحالة أنه من الجدير التفكير فيما إذا كان من الجدير ترك مثل هذا التنفيذ في التطبيق. <br><br><h3 style=";text-align:right;direction:rtl">  المساوئ <br></h3><br>  دعونا نفهم ما لا يعجبنا في هذا الرمز. <br><br><img src="https://habrastorage.org/webt/2u/a-/67/2ua-67iwmlvw9zki5oxmjf4mfqe.jpeg"><br><br>  بادئ ذي بدء ، من <strong>الصعب القراءة</strong> . <br><br>  نظرًا لأن قراءة الرمز ضعيفة ، فهذا يعني أنه سيكون من الصعب على المطور الجديد معرفة ما يتم تنفيذه بالضبط في مكان معين في المشروع.  وبناءً على ذلك ، سوف يقضي الكثير من الوقت في تحليل منطق سلوك التطبيق - <strong>ستزداد تكلفة الدعم والتطوير</strong> . <br><br>  هذا الرمز غير <strong>مرن</strong> .  إذا كنت بحاجة إلى إضافة حالة جديدة لا تتبع السلم الحالي ، فقد لا تنجح على الإطلاق!  إذا كنت بحاجة إلى ممر - توقف فجأة عن فحص الشيكات على هذا السلم - كيف نفعل ذلك؟  لا شيء تقريبًا. <br><br>  أيضا ، مع هذا النهج ، <strong>لا توجد حماية من الدول الوهمية</strong> .  عندما يتم وصف التحولات من خلال حالة مفتاح التبديل ، فمن المرجح أن يتم تنفيذ السلوك الافتراضي.  هذه الحالة منطقية من حيث سلوك البرنامج ، لكنها بالكاد منطقية من حيث المنطق البشري أو التجاري للتطبيق. <br><br>  ماذا يمكن أن يكون الحل لأوجه القصور المشار إليها؟  بالطبع ، هذا هو بناء منطق كل وحدة نمطية / وحدة تحكم / كائن معقد ، لا يعتمد على الحدس ، ولكن باستخدام نهج رسمي جيد.  على سبيل المثال ، آلة حالة محدودة. <br><br><h2 style=";text-align:right;direction:rtl">  لعبة اللعب <br></h2><br>  <strong>كمثال ،</strong> نأخذ ما تقدمه Apple.  ضمن إطار عمل GameplayKit ، هناك فئتان تساعداننا في العمل مع جهاز الحالة. <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  GKState. </li><li style=";text-align:right;direction:rtl">  GKStateMachine. </li></ul><br>  يوضح اسم الإطار أن شركة آبل تريد استخدامها في الألعاب.  ولكن <strong>في التطبيقات غير المخصصة للألعاب ،</strong> سيكون ذلك مفيدًا. <br><br><img src="https://habrastorage.org/webt/pz/ez/de/pzezdem8jc81mab3alsm3e8pqwo.png"><br><br>  تحدد فئة <strong>GKState</strong> الدولة.  لوصف ذلك ، تحتاج إلى تنفيذ خطوات بسيطة.  نرث من هذه الفئة ، ونعين اسم الدولة ، ونحدد ثلاث طرق. <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  isValidNextState - ما إذا كانت الحالة الحالية صالحة بناءً على الحالة السابقة. </li><li style=";text-align:right;direction:rtl">  didEnterFrom - الإجراءات عند الانتقال إلى هذه الحالة. </li><li style=";text-align:right;direction:rtl">  willExitTo - الإجراءات عند الخروج من هذه الحالة. </li></ul><br><br><img src="https://habrastorage.org/webt/z2/q2/gj/z2q2gj0bg2-vsoejvz0crdbhmb4.png"><br><br>  <strong>GKStateMachine هي</strong> فئة من أجهزة الدولة.  إنه أسهل.  يكفي القيام بعملين. <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  نقوم بتمرير مجموعة حالات الإدخال إلى الصفيف المكتوب من خلال المُهيئ. </li><li style=";text-align:right;direction:rtl">  نقوم بعمل انتقالات اعتمادًا على إشارات الإدخال باستخدام طريقة الإدخال.  من خلاله ، يتم تعيين الحالة الأولية أيضًا. </li></ul><br>  قد يكون من المربك أن يتم تمرير أي فئة كوسيطة لأسلوب <strong>الإدخال</strong> .  ولكن تجدر الإشارة إلى أنه لا يمكن تعريف كائن من أي فئة في مجموعة من الحالات <strong>-</strong> وهذا يمنع الكتابة الصارمة.  وفقًا لذلك ، إذا قمت بتعيين فئة عشوائية على أنها فئة الحالة التالية ، فلن يحدث شيء ، وستُرجع طريقة الإدخال خطأ. <br><br><h3 style=";text-align:right;direction:rtl">  الدول والتحولات بينهما <br></h3><br>  بعد أن تعرفت على إطار عمل Apple ، فلنعد إلى المثال.  من الضروري وصف الحالات والتحولات بينها.  تحتاج إلى القيام بذلك بأكثر طريقة يمكن فهمها.  هناك خياران شائعان: جدول أو كرسم بياني انتقالي.  في رأيي ، فإن الرسم البياني الانتقالي هو خيار أكثر قابلية للفهم.  إنه في UML بطريقة موحدة.  لذلك ، نختارها. <br><br>  في الرسم البياني للانتقال ، هناك حالات تم وصفها بالأسماء ، والأسهم التي تربط هذه الحالات لوصف التحولات.  في المثال ، هناك حالة أولية <strong>-</strong> نتوقع بيانات <strong>-</strong> وهناك ثلاث حالات يمكن الوصول إليها من الحالة الأولى: البيانات المستلمة ، لا توجد بيانات وخطأ. <br><br><img src="https://habrastorage.org/webt/cg/dn/gs/cgdngsj7omvfgbfvkpdgtazpeva.jpeg"><br><br>  في التنفيذ ، نحصل على أربع فئات صغيرة. <br><br><img src="https://habrastorage.org/webt/qo/tc/rq/qotcrq6wbihios-sonhj8ajfhey.png"><br><br>  دعنا نحلل حالة "البيانات المعلقة".  عند المدخل ، يجدر عرض مؤشر التنزيل.  وعند الخروج من هذه الحالة <strong>، قم</strong> بإخفائها.  للقيام بذلك ، تحتاج إلى أن يكون لديك ارتباط ضعيف إلى ViewController ، الذي يتم التحكم فيه بواسطة جهاز الحالة الذي تم إنشاؤه. <br><br><img src="https://habrastorage.org/webt/p8/41/aa/p841aapjpxsvcqirsklkcy9o4us.png"><br><br><h3 style=";text-align:right;direction:rtl">  معلمات الآلة <br></h3><br>  الخطوة الثانية التي يجب القيام بها <strong>هي</strong> تعيين معلمات آلة الحالة.  للقيام بذلك ، قم بإنشاء حالات ونقلها إلى الكائن الآلي. <br><br><img src="https://habrastorage.org/webt/zd/ww/pm/zdwwpm8i_i6lxoxjkzh_a2deqzi.jpeg"><br><br>  تأكد أيضًا من تعيين الحالة الأولية <br><br><img src="https://habrastorage.org/webt/mx/sg/ka/mxsgkacbkni4fjczcvsagtec8lm.png"><br><br>  من حيث المبدأ ، كل شيء ، الجهاز جاهز.  الآن من الضروري معالجة ردود الفعل على الأحداث الخارجية ، وتغيير حالة الأوتوماتيكي. <br><br><img src="https://habrastorage.org/webt/_c/jt/hf/_cjthf0r7-5d5u0fdxucgksdz2w.png"><br><br>  أذكر بيان المشكلة.  لقد حصلنا على سلم من if-else ، والذي تم على أساسه تحديد الإجراء الذي يجب القيام به.  كعنصر تحكم لآلية بسيطة ، قد يكون خيار التنفيذ هذا (في الواقع ، مفتاحًا بسيطًا <strong>-</strong> هذا هو تنفيذ بدائي لآلة حالة محدودة) ، لكننا لا نتخلص عمليًا من العوائق المذكورة سابقًا. <br><br>  هناك نهج آخر يسمح لك بالابتعاد عن هذه السلالم.  تقترحه كلاسيكيات البرمجة <strong>-</strong> ما يسمى ب "عصابة الأربعة". <br><br><img src="https://habrastorage.org/webt/qv/if/sf/qvifsfqe0iqs3rsroauy4bptayg.jpeg"><br><br>  هناك نمط تصميم خاص يسمى "الحالة". <br><br><img src="https://habrastorage.org/webt/nd/eh/wp/ndehwptccwh7lh90dmsixkzybo0.jpeg"><br><br>  هذا هو نمط سلوكي مشابه لاستراتيجية تصف تجريد آلة الدولة.  يسمح للكائن بتغيير سلوكه اعتمادًا على الحالة.  الغرض الرئيسي من التطبيق <strong>هو</strong> تغليف السلوك والبيانات المرتبطة بحالة معينة في فئة منفصلة.  وبالتالي ، فإن آلة الحالة ، التي اتخذت في البداية القرار الذي ستسببه ، ستقوم الآن بإرسال إشارة ، وترجمتها إلى حالة ، وستتخذ الدولة قرارًا.  لذا قم بتفريغ السلم جزئيًا ، وسيصبح الرمز أكثر متعة في الاستخدام. <br><br>  لا يعرف الإطار القياسي كيف.  يقترح أن <strong>GKStateMachine</strong> سيتخذ القرار.  لذلك ، نقوم بتوسيع جهاز الحالة المحدودة باستخدام طريقة جديدة ، حيث ننقل كتكوين وصف جميع المتغيرات الشرطية التي تحدد الحالة التالية بشكل فريد.  داخل هذه الطريقة ، يمكنك تفويض تحديد الحالة التالية إلى الحالة الحالية. <br><br><img src="https://habrastorage.org/webt/gu/sw/nr/guswnro2dw8m3fsctqqjx8_7js8.png"><br><br>  من الممارسات الجيدة وصف الحالة بكائن واحد وتمريرها دائمًا ، بدلاً من كتابة العديد من معلمات الإدخال.  بعد ذلك ، نفوض اختيار الدولة التالية إلى الحالة الحالية.  هذه هي الترقية الكاملة. <br><br><img src="https://habrastorage.org/webt/te/9t/5a/te9t5acirqz1o5awpxzy1tsbyia.png"><br><br>  <strong>مزايا GameplayKit.</strong> <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  مكتبة قياسية.  لا حاجة لتنزيل أي شيء ، استخدم cocoapods أو قرطاج. </li><li style=";text-align:right;direction:rtl">  المكتبة سهلة التعلم. </li><li style=";text-align:right;direction:rtl">  هناك تطبيقان في وقت واحد: على الهدف- C وعلى Swift. </li></ul><br>  <strong>العيوب:</strong> <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ترتبط إدراك الدول والتحولات ارتباطًا وثيقًا. <br>  انتهك مبدأ المسؤولية وحدها: فالدولة تعرف إلى أين تذهب وكيف. </li><li style=";text-align:right;direction:rtl">  لا يتم التحكم في الحالات المكررة بأي شكل من الأشكال. <br>  يتم تمرير مصفوفة إلى جهاز الحالة ، وليس العديد من الحالات.  إذا قمت بنقل عدة حالات متطابقة ، فسيتم استخدام آخر حالة من القائمة. </li></ul><br>  ما هي تطبيقات آلة الحالة المحدودة؟  ألق نظرة على GitHub. <br><br><h2 style=";text-align:right;direction:rtl">  تنفيذ الهدف جيم <br></h2><br><img src="https://habrastorage.org/webt/vo/zt/zy/voztzyatty-amllrmtl8ny4ke3c.png"><br><br><h3 style=";text-align:right;direction:rtl">  TransitionKit <br></h3><br>  هذه هي مكتبة Objective-C الأكثر شيوعًا لفترة طويلة ، وخالية من العيوب المحددة في GamePlayKit.  يسمح لنا بتنفيذ جهاز الدولة وجميع الإجراءات المرتبطة به على الكتل. <br><br>  <strong>الدولة منفصلة عن التحولات</strong> . <br><br>  يوجد في TransitionKit فئتين. <br><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  TKState - لتحديد الحالات والمدخلات وإجراءات الإخراج. </li><li style=";text-align:right;direction:rtl">  TKEvent عبارة عن فصل لوصف الانتقال. <br>  TKEvent يربط بعض الدول بغيرها.  يتم تعريف الحدث نفسه بسلسلة. </li></ol><br>  بالإضافة إلى ذلك ، هناك فوائد إضافية. <br><br>  <strong>يمكنك نقل البيانات المفيدة أثناء النقل</strong> .  يعمل هذا تمامًا مثل عند استخدام NSNotificationCenter.  تأتي كل الحمولة النافعة على شكل قاموس userInfo ، ويحلل المستخدم المعلومات. <br><br>  <strong>وصف الانتقال الخاطئ</strong>  عندما نحاول إجراء انتقال غير موجود - مستحيل - لا نحصل على قيمة NO فقط عند العودة من طريقة الانتقال ، ولكن أيضًا على وصف تفصيلي للخطأ ، وهو أمر مفيد عند تصحيح أخطاء جهاز الحالة. <br><br><img src="https://habrastorage.org/webt/hi/x9/bx/hix9bx5ctgjldoay4btqajopgb0.jpeg"><br><br>  يتم استخدام TransitionKit في حصادة شبكة RestKit الشهيرة.  هذا مثال جيد على كيفية استخدام جهاز الحالة في نواة التطبيق عند تنفيذ عمليات الشبكة. <br><br><img src="https://habrastorage.org/webt/ls/os/d3/lsosd3z1zbg5knnmbrggmpq2zro.jpeg"><br><br>  يحتوي RestKit على فئة خاصة - RKOperationStateMachine - لإدارة العمليات المتزامنة.  عند الإدخال ، يقبل العملية التي تتم معالجتها وقائمة الانتظار لتنفيذها. <br><br><img src="https://habrastorage.org/webt/r2/pn/mc/r2pnmcfsl_6uzdzhsin_mrq_vkg.jpeg"><br><br>  داخليا ، آلة الحالة بسيطة للغاية: ثلاث حالات (جاهزة ، منفذة ، مكتملة) وتحولان: البدء والتنفيذ.  بعد بدء المعالجة (وفي أي انتقالات) ، تبدأ آلة الحالة في التحكم في كتلة التعليمات البرمجية المعرفة بواسطة المستخدم في قائمة الانتظار المحددة عند إنشاء قائمة الانتظار. <br><br>  تقوم العملية المرتبطة بأوتوماتها بنقل الأحداث الخارجية إلى الأوتوماتون ، وتقوم بإجراء انتقالات بين الدول وجميع الإجراءات ذات الصلة.  آلة الدولة تعتني <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  تنفيذ التعليمات البرمجية غير المتزامنة ، </li><li style=";text-align:right;direction:rtl">  تنفيذ الشفرة الذرية خلال التحولات ، </li><li style=";text-align:right;direction:rtl">  تحكم الانتقال </li><li style=";text-align:right;direction:rtl">  إلغاء العمليات </li><li style=";text-align:right;direction:rtl">  صحة تغيير متغيرات حالة العملية: isReady، isExecuting، is Finish. </li></ul><br><h3 style=";text-align:right;direction:rtl">  التحول <br></h3><br>  بالإضافة إلى TransitionKit ، تجدر الإشارة إلى <strong>Shift</strong> بشكل منفصل - مكتبة صغيرة تم تنفيذها كفئة فوق NSObject.  يسمح لك هذا النهج بتحويل أي كائن إلى جهاز حالة ، يصف حالته في شكل ثوابت سلسلة وإجراءات في الكتل أثناء التحولات.  بالطبع ، هذا أكثر من مشروع تدريب ، ولكنه مثير للاهتمام ويسمح لك بتجربة ما هي آلة الدولة بأقل تكلفة. <br><br><h2 style=";text-align:right;direction:rtl">  تطبيقات سريعة <br></h2><br><img src="https://habrastorage.org/webt/_t/dx/kd/_tdxkdwt0sqzgy78o-q-_z0c_nq.png"><br><br>  هناك العديد من تطبيقات الآلة المحدودة على Swift.  سوف أذكر واحدة ( <strong>ملاحظة</strong> : لسوء الحظ ، لم يتم تطوير المشروع في العامين الماضيين بعد التقرير ، لكن الأفكار الواردة فيه تستحق أن نقول في المقالة). <br><br><h3 style=";text-align:right;direction:rtl">  SwiftyStateMachine <br></h3><br>  في SwiftyStateMachine ، يتم تمثيل جهاز الحالة بهيكل غير مستقر ؛ من خلال طرق didSet للخاصية ، يمكنك بسهولة التقاط تغييرات الحالة. <br><br>  في هذه المكتبة ، يتم تعريف آلة الحالة من خلال جدول مراسلات الدول والانتقالات بينها.  يتم وصف هذا المخطط بشكل منفصل عن الكائن الذي ستتحكم فيه الماكينة.  يتم تنفيذ ذلك من خلال مفتاح التبديل المتداخل. <br><br><img src="https://habrastorage.org/webt/y5/cz/dl/y5czdlkikmxb4kyylgwgxfsdxuy.png"><br><br>  ,    . <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">       . <br>       ,        . </li><li style=";text-align:right;direction:rtl">    . <br>    state machine ,         state machine. </li><li style=";text-align:right;direction:rtl">    ,   ,      . </li><li style=";text-align:right;direction:rtl"> ,     DOT. <br>        state- — DOT.    ,  ,     . </li></ul><br><img src="https://habrastorage.org/webt/wb/zg/du/wbzgduy9duy-shpt0pcjjjt0ru8.jpeg"><br><br><h2 style=";text-align:right;direction:rtl">  الخلاصة <br></h2><br>          . <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"> <strong>.</strong> <br>           ,     .    ,         . ,   . <br></li><li style=";text-align:right;direction:rtl"> <strong>  .</strong> <br>     ( ). <br></li><li style=";text-align:right;direction:rtl"> <strong> .</strong> <br>       ,    ,        . </li><li style=";text-align:right;direction:rtl"> <strong>       .</strong> , SwiftyStateMachine     ,    ,     .     . </li><li style=";text-align:right;direction:rtl"> <strong> .</strong> <br>   ,    . , ,      .       . <br></li></ul><br>        . <br><br><img src="https://habrastorage.org/webt/wb/ek/ww/wbekwwlr0a_w8wzt6z0bo12jdmm.jpeg"><br><br>       .      ,    .    , ,    switch case:  ,  ,  —     . <br><br><img src="https://habrastorage.org/webt/hq/ay/db/hqaydbygw58xgcalwyvph1haeho.jpeg"><br><br>  .    .    ,  .  ,    ,  ,     .    . <br><br><img src="https://habrastorage.org/webt/b9/mb/ze/b9mbze-xdkufz2mbs7p61obsjqo.jpeg"><br><br>      ,      ,      .     . <br><br><img src="https://habrastorage.org/webt/bc/qp/hr/bcqphramltmjhaakirn_uo00e4i.png"><br><br>    —  <strong> </strong> .       :      , —    . <br><br><img src="https://habrastorage.org/webt/iw/qz/we/iwqzwefnjh4xnqexwoovxccugqo.jpeg"><br><br><img src="https://habrastorage.org/webt/i4/80/vk/i480vkfuwmhwpdd31totlvl5298.jpeg"><br><br>   «-»     <strong> </strong> . <br><br><img src="https://habrastorage.org/webt/s-/kf/ox/s-kfoxsckujhbrzsslebpzuqwei.jpeg"><br><br> ,    .         . <br><br><img src="https://habrastorage.org/webt/le/oo/ju/leoojuz3yycfncczpfbgftsa1tq.jpeg"><br><br>        <strong>app coordinators</strong> —   ,     ,    : ,     .       ,       . <br><br>  , app coordinator ,  state machine.            . ,    app coordinators  state machine,         , ,  , <strong>  </strong> .      , ,   ,         .    . <br><br><img src="https://habrastorage.org/webt/mx/yu/1q/mxyu1qczcjazzunuhe7jfoolv2e.png"><br><br> , state machine  ,    ,         . <br><br>     state machine  ,     if-else.   ,         . <br><br><blockquote style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">هذا العام في Apps Conf 2018 ، الذي سيعقد في 8 و 9 أكتوبر ، </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">يخطط</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ألكسندر </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;">لمناقشة</font></a><font style="vertical-align: inherit;"> خمسة مبادئ أساسية للبرمجة الشيئية وحدود تطبيقها. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">لمزيد من تقارير تطوير الجوال ، تحقق من </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">قناتنا على YouTube</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">وإذا كنت ترغب في تلقي معلومات حول النصوص الجديدة والتقارير المثيرة للاهتمام ، اشترك في </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">النشرة الإخبارية</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br></blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar423293/">https://habr.com/ru/post/ar423293/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar423279/index.html">كيف طورت الجهاز اللوحي الروسي</a></li>
<li><a href="../ar423281/index.html">ردود الفعل في الفريق ، 360 و 14 فبراير</a></li>
<li><a href="../ar423283/index.html">نمذجة تأثير سانياك باستخدام البصريات الهندسية</a></li>
<li><a href="../ar423285/index.html">الهندسة الاجتماعية: العدو المراوغ في عالم الأمن السيبراني</a></li>
<li><a href="../ar423291/index.html">حقق الروس رقمًا قياسيًا: 110 أفلام مقرصنة لكل شخص</a></li>
<li><a href="../ar423295/index.html">مؤتمر تطوير الجوال الأكثر فائدة</a></li>
<li><a href="../ar423297/index.html">من Android Developer إلى DevOps</a></li>
<li><a href="../ar423299/index.html">منسق التطبيق في تطبيقات iOS</a></li>
<li><a href="../ar423303/index.html">الذكاء الاصطناعي ، دورة عملية. تحويل الموسيقى القائمة على العاطفة</a></li>
<li><a href="../ar423305/index.html">أداء الخراب</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>