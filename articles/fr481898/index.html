<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧑‍🤝‍🧑 🤕 🏮 Serveur Web simple pour SPA / PWA en 5 minutes 👌🏼 👨🏽‍🔧 👨🏽‍💼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Comment créer un serveur Web simple en utilisant uniquement des instructions nodejs standard 


 Souvent, un simple serveur Web est nécessaire pour dé...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Serveur Web simple pour SPA / PWA en 5 minutes</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/481898/"><h1 id="kak-sozdat-prostoy-veb-server-ispolzuya-tolko-standartnye-instrukcii-nodejs">  Comment créer un serveur Web simple en utilisant uniquement des instructions nodejs standard </h1><br><p> Souvent, un simple serveur Web est nécessaire pour développer des applications MPA / SPA / PWA.  Une fois, lors d'un grand rassemblement en réponse à la question: «Que faisiez-vous?», J'ai dit que je levais un serveur Web pour héberger une application PWA.  Nous avons tous ri pendant longtemps et oui, au fait, PWA n'est pas de la colle.  Comme SPA, ce n'est pas un salon de beauté.  Ce sont toutes sortes d'applications Web.  Et la SSR n'est pas un pays :-).  Si vous lancez une telle application simplement en ouvrant la page de démarrage de index.html via un navigateur, cela ne fonctionnera pas comme il se doit, dans le meilleur des cas, nous obtiendrons une version hors ligne.  J'adore JavaScript et vais résoudre le problème en utilisant uniquement les moyens dont je dispose, pour ainsi dire hors de la boîte. </p><a name="habracut"></a><br><p>  Commençons par le plan: </p><br><ol><li>  S'il n'y a pas de <a href="https://nodejs.org/dist/">NodeJS,</a> téléchargez LTS, installez, ne modifiez pas les paramètres, cliquez sur suivant </li><li>  Dans notre endroit isolé, où tous les projets sont collectés, créez le dossier <strong>simple-web-server</strong> </li><li>  Dans le dossier du projet, exécutez la commande npm init --yes // sans --yes l'initialiseur posera beaucoup de questions </li><li>  Dans le fichier <strong>package.json</strong> de la section <strong>scripts</strong> , ajoutez la propriété et sa valeur - <strong>"main": "index.js"</strong> - afin que nous puissions démarrer rapidement notre serveur en utilisant la commande npm run </li><li>  Créer un dossier <strong>lib</strong> Il est recommandé d'y mettre tout votre code, ce qui ne nécessite pas d'assemblage et d'étapes supplémentaires pour son fonctionnement </li><li>  Créez un fichier <strong>index.js</strong> dans le dossier <strong>lib</strong> <strong>.</strong> Il s'agit de notre futur serveur. </li><li>  Créez un dossier <strong>dist</strong> - ce sera le dossier dans lequel il y aura des fichiers accessibles au public, y compris index.html, en d'autres termes, le statique que notre serveur distribuera </li><li>  Ouvrez le fichier /index.js </li><li>  Écrivez du code </li></ol><br><p>  Alors, que savons-nous de ce que notre serveur doit faire? </p><br><ol><li>  Gérer les demandes </li><li>  Lire des fichiers </li><li>  Répondre à la demande avec le contenu du fichier </li></ol><br><p>  Créez d'abord notre serveur, importez-le dans le fichier <strong>idex.js</strong> </p><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> {createServer} = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'http'</span></span>);</code> </pre> <br><p>  Cette instruction déstructure l'objet du module <a href="http.html"><strong>http</strong></a> et affecte une expression, la fonction <a href="http_createserver.asp"><strong>createServer</strong></a> , à l'identificateur de variable <a href="http_createserver.asp"><strong>createServer</strong></a> . </p><br><p>  Créez un nouveau serveur à l'aide de l'instruction suivante </p><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> server = createServer();</code> </pre> <br><p>  Lorsque vous accédez pour la première fois à l'hôte du serveur, le navigateur envoie une demande de réception du document.  Par conséquent, afin de traiter cet événement, nous devons écouter ces demandes.  Le serveur que nous avons créé a une méthode d' <strong>écoute</strong> , comme paramètre nous passons le numéro de port 3000. </p><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> eventsEmitter = server.listen(<span class="hljs-number"><span class="hljs-number">3000</span></span>);</code> </pre> <br><p>  L'expression de cette méthode sera un objet <a href="https://nodejs.org/api/events.html"><strong>EventEmitter</strong></a> qui sera stocké dans une variable avec l'identifiant <strong>eventsEmitter</strong> .  Cet objet est observable.  Nous souscrivons à ses événements à l'aide de l'appel de méthode <a href="https://nodejs.org/api/events.html"><strong>on / addEventListener</strong></a> avec deux paramètres de <strong>fonction de</strong> <strong>chaîne</strong> requis.  Le premier paramètre indique quels événements nous intéressent; <a href="&amp;xid=17259,15700023,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhgOy1Pc2THzO5WKqtDZPZRLoq8i0g#"><strong>demander le</strong></a> second est une fonction qui traitera cet événement. </p><br><pre> <code class="javascript hljs"> eventsEmitter.on(<span class="hljs-string"><span class="hljs-string">'request'</span></span>, (req, res) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">debugger</span></span>; });</code> </pre> <br><p>  Ouvrez le <a href="http://localhost:3000/">lien</a> dans le navigateur </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/ad7/533/9ab/ad75339aba986a5e052325240422696c.png" alt="image"></p><br><p>  Nous avons donc choisi les instructions du débogueur.  Nous voyons qu'en tant que paramètres, nous obtenons deux objets <a href="&amp;xid=17259,15700023,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhgOy1Pc2THzO5WKqtDZPZRLoq8i0g#http_class_"><strong>req</strong></a> , <a href="&amp;xid=17259,15700023,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhgOy1Pc2THzO5WKqtDZPZRLoq8i0g#http_class_"><strong>res</strong></a> . Ces objets sont des instances d'objets de type <a href="https://nodejs.org/api/stream.html">flux,</a> donc <a href="https://nodejs.org/api/stream.html"><strong>req</strong></a> est le flux de lecture et <a href="https://nodejs.org/api/stream.html"><strong>res</strong></a> est le flux d'écriture. </p><br><p>  Nous avons traité la demande et nous pouvons dire que «l'affaire est dans le chapeau».  Il ne reste plus qu'à lire et rendre le fichier.  Vous devez d'abord comprendre de quel type de fichier nous avons besoin.  Dans le débogueur, après avoir étudié toutes les propriétés du paramètre <strong>req</strong> , j'ai vu qu'il avait la propriété <strong>url</strong> .  Mais seulement, il n'y a rien de tel que <strong>index.html</strong> . </p><br><p>  Regardons à nouveau notre navigateur: nous voyons que nous ne l'avons pas explicitement indiqué.  Réessayons, mais nous spécifierons déjà explicitement <a href="http://localhost:3000/index.html">index.html</a> . </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/b98/ff2/fb4/b98ff2fb48f53fd0e89b94103a2802b7.png" alt="image"></p><br><p>  Maintenant, il est clair que le nom du fichier vient dans la demande dans la propriété <strong>url</strong> et rien de plus, nous n'avons pas besoin de lire le fichier de la demande.  Nous la décomposons à l'aide d'une paire d'accolades, spécifions le nom de la propriété <strong>url</strong> et, via l'opérateur <strong>:,</strong> définissons un nom arbitraire en utilisant un identificateur de variable valide, dans mon cas <strong>requestUrl</strong> . </p><br><pre> <code class="javascript hljs"> eventsEmitter.addListener(<span class="hljs-string"><span class="hljs-string">'request'</span></span>, ({<span class="hljs-attr"><span class="hljs-attr">url</span></span>: requestUrl}, res) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">debugger</span></span> });</code> </pre> <br><p>  Super, quelle est la prochaine étape?  En vérité, je n'aime pas vraiment le fait que index.html devra toujours être explicitement spécifié, alors résolvons ce problème tout de suite.  J'ai décidé que la façon la plus simple de le faire est d'utiliser la fonction <a href="https://nodejs.org/api/path.html"><strong>extname</strong></a> standard <a href="https://nodejs.org/api/path.html"><strong>;</strong></a> elle est incluse dans le package standard <br>  NodeJS du module de <a href="https://nodejs.org/api/path.html"><strong>chemin</strong></a> nous l'importons en utilisant l'instruction suivante. </p><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> {extname} = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'path'</span></span>);</code> </pre> <br><p>  Vous pouvez maintenant l'appeler en passant l'expression d'identifiant requestUrl comme paramètre et obtenir l'expression de la chaîne du format approximatif <code>'.extension'</code> .  Si la demande ne spécifie pas explicitement un fichier, une chaîne vide sera retournée.  En utilisant ce principe, nous ajouterons la valeur par défaut de <strong>'index.html'</strong> .  Nous écrivons l'instruction suivante </p><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> url = extname(requestUrl) === <span class="hljs-string"><span class="hljs-string">''</span></span> ? DEFAULT_FILE_NAME : requestUrl;</code> </pre> <br><p>  Je suis sûr que l'utilisateur du serveur voudra remplacer ce nom et également configurer une variable d'environnement à l'aide de l'instruction suivante </p><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> {<span class="hljs-attr"><span class="hljs-attr">env</span></span>: {DEFAULT_FILE_NAME = <span class="hljs-string"><span class="hljs-string">'/index.html'</span></span>}} = process;<span class="hljs-string"><span class="hljs-string">`</span></span></code> </pre> <br><p>  Dans le <a href="https://nodejs.org/api/process.html"><strong>processus de</strong></a> variable globale <a href="https://nodejs.org/api/process.html"><strong>, il y a</strong></a> beaucoup d'informations utiles, je vais juste en enterrer une partie, en particulier, la propriété <a href="https://nodejs.org/api/process.html"><strong>env</strong></a> , il contient toutes les propriétés de l'environnement de l'utilisateur et nous y chercherons déjà <strong>DEFAULT_FILE_NAME</strong> si l'utilisateur ne le spécifie pas - nous utilisons index.html par défaut. </p><br><blockquote>  IMPORTANT: si la valeur de la propriété d'environnement DEFAULT_FILE_NAME est tout sauf indéfinie, l'attribution d'une valeur par défaut ne fonctionnera pas.  Cela mérite d'être rappelé, mais pas maintenant, nous faisons tout au minimum :-) </blockquote><p><img src="https://habrastorage.org/getpro/habr/post_images/0db/3cf/e97/0db3cfe97b528ef15c02994bad3781f3.png" alt="image"></p><br><p>  Maintenant que nous avons un lien relatif vers le fichier, nous devons obtenir le chemin absolu vers le fichier dans le système de fichiers de notre serveur.  Nous avons décidé que tous les fichiers publics seront stockés dans le dossier <strong>dist</strong> , donc pour obtenir le <strong>chemin absolu du fichier</strong> , nous utiliserons une autre fonction de <a href="https://nodejs.org/api/path.html"><strong>résolution</strong></a> du module que nous connaissons déjà <br>  <a href="https://nodejs.org/api/path.html"><strong>chemin</strong></a> simplement l'indiquer dans l'instruction précédemment créée sur la ligne 5 </p><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> {resolve, extname} = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'path'</span></span>);</code> </pre> <br><p>  Ensuite, à la ligne 10, nous écrivons une instruction qui recevra et enregistrera le <strong>chemin absolu vers la</strong> variable <strong>filePath.</strong> J'ai également "wang" à l'avance que le nom de ce dossier peut être redéfini pour plus de flexibilité.  Par conséquent, je développe l'instruction sur la ligne 6, en ajoutant le nom <br>  variable d'environnement <strong>DIST_FOLDER</strong> ! </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/128/919/e1f/128919e1ffb4aed7911e31764414ee4b.png" alt="image"></p><br><p>  Maintenant, tout est prêt à lire le fichier.  Vous pouvez lire un fichier de différentes manières de manière asynchrone, synchrone ou utiliser des <a href="https://nodejs.org/api/stream.html">flux</a> .  J'utiliserai des streams :-) c'est beau et plus efficace, du point de vue des ressources dépensées.  Créez d'abord un fichier de test dans le dossier <strong>dist</strong> pour qu'il y ait quelque chose à lire :-) </p><br><pre> <code class="html hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">lang</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"en"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">charset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"UTF-8"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>Title<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> TESTING 1,2,3... <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Maintenant, nous avons besoin d'une fonction qui créera un flux de lecture de fichiers, elle est également incluse dans la distribution standard de NodeJS, nous l'extrayons du module <a href="https://nodejs.org/api/fs.html"><strong>fs en</strong></a> utilisant l'instruction suivante </p><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> {createReadStream} = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fs'</span></span>);</code> </pre> <br><p>  et sur la ligne 12 dans le corps du processeur de demande, nous utilisons la déclaration suivante </p><br><pre> <code class="javascript hljs"> createReadStream(filePath)</code> </pre> <br><p>  en conséquence, l'instance de l'objet de flux de lecture sera retournée en l'utilisant <br>  nous pouvons basculer les flux de lecture sur le flux d'écriture, nous pouvons également transformer les flux et beaucoup d'autres choses utiles.  Donc, le paramètre <strong>res</strong> est un flux de lecture, non? </p><br><p>  Essayons de basculer immédiatement le flux de lecture de fichiers que nous avons créé dans le flux d'écriture <strong>res</strong> pour <br>  de cela, sur la ligne 12, nous continuons l'instruction en appelant la méthode <strong>pipe</strong> , et en tant que paramètre, nous passons notre flux d'écriture <strong>res</strong> </p><br><pre> <code class="javascript hljs"> createReadStream(filePath).pipe(res);</code> </pre> <br><p><img src="https://habrastorage.org/getpro/habr/post_images/412/712/851/412712851c4ce2bcc2bf4a2bcb36ef86.png" alt="image"></p><br><p>  C'est tout?  Nooon.  Et qui va gérer les erreurs?  Quel genre d'erreurs?  Essayons de télécharger le fichier css dans le fichier index.html, mais nous ne le créerons pas et voyons ce qui se passe :-) </p><br><pre> <code class="html hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">lang</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"en"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">charset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"UTF-8"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>Title<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stylesheet"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"index1.css"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> TESTING 1,2,3... <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p><img src="https://habrastorage.org/getpro/habr/post_images/487/052/185/487052185b1c4adc32a05f658c7dafb6.jpg" alt="image"></p><br><p>  Attendu, mais le serveur est tombé en panne!  Ce n'est pas du tout le cas.  Le fait est que, par défaut, les erreurs ne sont pas détectées dans les flux et que vous devez le faire vous-même :-) <strong>createReadStream</strong> renvoie le flux dans lequel l'erreur se produit.  Par conséquent, nous ajoutons un gestionnaire d'erreurs.  Utilisation de l'appel à la méthode on. Spécification du nom de l'événement d' <strong>erreur</strong> et du gestionnaire d'une fonction.  Il mettra fin au flux de lecture en lecture avec un code de réponse 404. </p><br><pre> <code class="javascript hljs"> createReadStream(filePath) .on(<span class="hljs-string"><span class="hljs-string">'error'</span></span>, error =&gt; res.writeHead(<span class="hljs-number"><span class="hljs-number">404</span></span>).end()) .pipe(res);</code> </pre> <br><p>  vérifier! </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/747/29e/584/74729e584b652a032a34c5a82d754a2d.jpg" alt="image"></p><br><p>  Une autre chose.  Soit dit en passant, le serveur n'est pas encore prêt et si nous essayons de l'ouvrir dans un autre navigateur, la page ne fonctionnera pas correctement :-) qui l'a deviné, veuillez écrire dans les commentaires, qu'avez-vous oublié de faire?  Le fait est que lorsqu'un serveur répond à la demande d'un serveur avec un fichier, une extension ne suffit pas pour que le navigateur comprenne de quel type sont ce fichier et les autres navigateurs: ni Chrome ni les versions plus anciennes ne fonctionneront avec les fichiers téléchargés sans spécifier l'en-tête de réponse Content-Type. entre autres, notre serveur doit spécifier le <a href="https://developer.mozilla.org/ru/docs/Web/HTTP/Basics_of_HTTP/MIME_types">type MIME.</a> Pour ce faire, nous allons créer une variable distincte avec tous les types de mai courants.  Nous offrons également la possibilité de les étendre en passant comme variable d'environnement </p><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> {<span class="hljs-attr"><span class="hljs-attr">env</span></span>: {DEFAULT_FILE_NAME = <span class="hljs-string"><span class="hljs-string">'/index.html'</span></span>, DIST_FOLDER = <span class="hljs-string"><span class="hljs-string">'dist'</span></span>, DEFAULT_MIME_TYPES = <span class="hljs-string"><span class="hljs-string">'{}'</span></span>}} = process; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> {text} = mimeTypes = { <span class="hljs-string"><span class="hljs-string">'html'</span></span>: <span class="hljs-string"><span class="hljs-string">'text/html'</span></span>, <span class="hljs-string"><span class="hljs-string">'jpeg'</span></span>: <span class="hljs-string"><span class="hljs-string">'image/jpeg'</span></span>, <span class="hljs-string"><span class="hljs-string">'jpg'</span></span>: <span class="hljs-string"><span class="hljs-string">'image/jpeg'</span></span>, <span class="hljs-string"><span class="hljs-string">'png'</span></span>: <span class="hljs-string"><span class="hljs-string">'image/png'</span></span>, <span class="hljs-string"><span class="hljs-string">'js'</span></span>: <span class="hljs-string"><span class="hljs-string">'text/javascript'</span></span>, <span class="hljs-string"><span class="hljs-string">'css'</span></span>: <span class="hljs-string"><span class="hljs-string">'text/css'</span></span>, <span class="hljs-string"><span class="hljs-string">'text'</span></span>: <span class="hljs-string"><span class="hljs-string">'plain/text'</span></span>, <span class="hljs-string"><span class="hljs-string">'json'</span></span>: <span class="hljs-string"><span class="hljs-string">'application/json'</span></span>, ...JSON.parse(DEFAULT_MIME_TYPES) };</code> </pre> <br><p>  Eh bien, vous devez maintenant spécifier le type MIME avant de passer du flux de lecture au flux d'écriture.  J'ai utilisé les noms d'extension de fichier comme clés, donc nous obtiendrons l'extension de fichier avec la fonction <strong>extname</strong> familière </p><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> fileExtension = extname(url).split(<span class="hljs-string"><span class="hljs-string">'.'</span></span>).pop();</code> </pre> <br><p>  et avec l'aide du gestionnaire d'événements <strong>pipe</strong> , nous définissons le type MIME souhaité </p><br><pre> <code class="plaintext hljs">res.on('pipe', () =&gt; res.setHeader(contentType, mimeTypes[fileExtension] || text));</code> </pre> <br><p>  Vérifier </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/b9e/bad/f34/b9ebadf34d25b2fa8991387d880bc331.jpg" alt="image"></p><br><p>  C'est tout - le serveur est prêt.  Bien sûr, ce n'est pas parfait, mais pour un démarrage rapide, c'est tout.  Si vous souhaitez développer cette idée, merci d'écrire dans les commentaires :-) </p><br><p>  <a href="http-server">Code de projet complet</a> </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/5YhIxvbMLp8" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><iframe width="560" height="315" src="https://www.youtube.com/embed/TssbLe5I2Ec" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr481898/">https://habr.com/ru/post/fr481898/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr481886/index.html">Comment créer rapidement un journal de présence</a></li>
<li><a href="../fr481890/index.html">Importation de résidus d'uranium allemands en Russie. Partie 2. Enrichissement</a></li>
<li><a href="../fr481892/index.html">Qubits au lieu de bits: quel avenir les ordinateurs quantiques ont-ils pour nous?</a></li>
<li><a href="../fr481894/index.html">Comment une start-up russe de biotechnologie aide à lutter contre le cancer</a></li>
<li><a href="../fr481896/index.html">PHP Vs ASP.NET: Comment choisir le bon?</a></li>
<li><a href="../fr481902/index.html">Modélisation du fonctionnement d'une véritable centrale thermique pour optimiser les modes: vapeur et mathématiques</a></li>
<li><a href="../fr481904/index.html">Vladimir Marshinin alias mavl: «L'appel« Ne copiez pas d'autres cartes »vous permet d'éviter les problèmes de licence OpenStreetMap»</a></li>
<li><a href="../fr481906/index.html">Cerveau chinois, ou pour la défense du printemps</a></li>
<li><a href="../fr481910/index.html">Écriture de VerticalSwipeBehavior flexible</a></li>
<li><a href="../fr481912/index.html">Pendant une semaine, j'étais stagiaire chez SRE-engineer. Regardez à travers les yeux d'un ingénieur logiciel</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>