<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üàöÔ∏è ‚ù§Ô∏è ü§µüèª Orthodoxes Backend üë©üèΩ‚Äç‚úàÔ∏è ü§üüèº üë©üèΩ‚Äç‚öñÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Das moderne Backend ist vielf√§ltig, befolgt jedoch einige unausgesprochene Regeln. Viele von uns, die Serveranwendungen entwickeln, sind mit allgemein...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Orthodoxes Backend</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/474504/"><img src="https://habrastorage.org/webt/dj/q5/y-/djq5y-xjov_bqvrrnb08bfyqn4i.jpeg"><br><br>  Das moderne Backend ist vielf√§ltig, befolgt jedoch einige unausgesprochene Regeln.  Viele von uns, die Serveranwendungen entwickeln, sind mit allgemein anerkannten Ans√§tzen konfrontiert, wie beispielsweise Clean Architecture, SOLID, Persistence Ignorance, Dependency Injection und anderen.  Viele der Attribute der Serverentwicklung sind so abgedroschen, dass sie keine Fragen aufwerfen und gedankenlos verwendet werden.  Sie reden viel √ºber einige, benutzen sie aber nie.  Die Bedeutung des Rests wird entweder falsch interpretiert oder verzerrt.  Der Artikel befasst sich mit dem Aufbau einer einfachen, v√∂llig typischen Backend-Architektur, die nicht nur den Grunds√§tzen ber√ºhmter Programmiertheoretiker entspricht, sondern diese auch in gewissem Ma√üe verbessert. <br><a name="habracut"></a><br>  <i>Allen gewidmet, die nicht an Programmieren ohne Sch√∂nheit denken und Sch√∂nheit inmitten von Absurdit√§t nicht akzeptieren.</i> <br><br><h2>  Dom√§nenmodell </h2><br>  In der Modellierung sollte die Softwareentwicklung in einer idealen Welt beginnen.  Aber wir sind alle nicht perfekt, wir reden viel dar√ºber, aber wir machen alles wie gewohnt.  Oft liegt der Grund in der Unvollkommenheit vorhandener Werkzeuge.  Und um ehrlich zu sein, unsere Faulheit und Angst, Verantwortung zu √ºbernehmen, um von "Best Practices" wegzukommen.  In einer unvollkommenen Welt beginnt die Softwareentwicklung bestenfalls mit dem Ger√ºstbau, und im schlimmsten Fall wird nichts mit der Leistungsoptimierung getan.  Trotzdem m√∂chte ich die harten Beispiele ‚Äûherausragender‚Äú Architekten verwerfen und √ºber gew√∂hnlichere Dinge spekulieren. <br><br>  Wir haben also eine technische Aufgabe und sogar ein Benutzeroberfl√§chendesign (oder nicht, wenn die Benutzeroberfl√§che nicht bereitgestellt wird).  Der n√§chste Schritt besteht darin, die Anforderungen im Dom√§nenmodell widerzuspiegeln.  Zu Beginn k√∂nnen Sie der √úbersichtlichkeit halber ein Diagramm von Modellobjekten skizzieren: <br><br><img src="https://habrastorage.org/webt/4n/hp/m5/4nhpm5kbhwvomryj9xhyww1eep0.png"><br><br>  Dann beginnen wir in der Regel, das Modell auf die Mittel seiner Implementierung zu projizieren - eine Programmiersprache, einen objektrelationalen Konverter (Object-Relational Mapper, ORM) oder auf ein komplexes Framework wie ASP.NET MVC oder Ruby on Rails, mit anderen Worten - Schreiben Sie Code.  In diesem Fall folgen wir dem Pfad des Frameworks, der meiner Meinung nach im auf dem Modell basierenden Entwicklungsrahmen nicht korrekt ist, egal wie bequem es zun√§chst erscheinen mag.  Hier machen Sie eine gro√üe Annahme, die anschlie√üend die Vorteile der dom√§nenbasierten Entwicklung zunichte macht.  Als eine freiere Option, die nicht durch den Umfang eines Werkzeugs beschr√§nkt ist, w√ºrde ich vorschlagen, nur syntaktische Werkzeuge einer Programmiersprache zum Erstellen eines Objektmodells eines Themenbereichs zu verwenden.  In meiner Arbeit benutze ich verschiedene Programmiersprachen - C #, JavaScript, Ruby.  Das Schicksal hat entschieden, dass die √ñkosysteme Java und C # meine Inspiration sind, JS mein Haupteinkommen ist und Ruby die Sprache ist, die ich mag.  Daher werde ich weiterhin einfache Beispiele in Ruby zeigen: Ich bin √ºberzeugt, dass dies Entwicklern in anderen Sprachen keine Probleme bereiten wird, diese zu verstehen.  Portieren Sie das Modell also in die Invoice-Klasse in Ruby: <br><br><pre><code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Invoice</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr_reader</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">amount</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">date</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">created_at</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">paid_at</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">initialize</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attrs</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">payment_service</span></span></span><span class="hljs-class">) @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">created_at</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DateTime</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">now</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">paid_at</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nil</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">amount</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attrs</span></span></span><span class="hljs-class">[:</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">amount</span></span></span><span class="hljs-class">] @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">date</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attrs</span></span></span><span class="hljs-class">[:</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">date</span></span></span><span class="hljs-class">] @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">subscription</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attrs</span></span></span><span class="hljs-class">[:</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">subscription</span></span></span><span class="hljs-class">] @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">payment_service</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">payment_service</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">pay</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">credit_card</span></span></span><span class="hljs-class"> = @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">subscription</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">customer</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">credit_card</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">amount</span></span></span><span class="hljs-class"> = @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">subscription</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">plan</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">price</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">payment_service</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">charge</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">credit_card</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">amount</span></span></span><span class="hljs-class">) @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">paid_at</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DateTime</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">now</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre> <br>  Das hei√üt  Wir haben eine Klasse, deren Konstruktor einen Hash von Attributen, Objektabh√§ngigkeiten und Initialisierungen seiner Felder akzeptiert, und eine Bezahlmethode, die den Status des Objekts √§ndern kann.  Alles ist sehr einfach.  Jetzt √ºberlegen wir nicht, wie und wo wir dieses Objekt anzeigen und speichern werden.  Es existiert einfach, wir k√∂nnen es erstellen, seinen Zustand √§ndern, mit anderen Objekten interagieren.  Bitte beachten Sie, dass der Code keine fremden Artefakte wie BaseEntity und anderen M√ºll enth√§lt, der nicht mit dem Modell zusammenh√§ngt.  Es ist sehr wichtig.  √úbrigens k√∂nnen wir zu diesem Zeitpunkt bereits mit der Entwicklung durch Testen (TDD) beginnen, wobei Stub-Objekte anstelle von Abh√§ngigkeiten wie payment_service verwendet werden: <br><br><pre> <code class="ruby hljs">RSpec.describe Invoice <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> before <span class="hljs-symbol"><span class="hljs-symbol">:each</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> @payment_service = double(<span class="hljs-symbol"><span class="hljs-symbol">:payment_service</span></span>) allow(@payment_service).to receive(<span class="hljs-symbol"><span class="hljs-symbol">:charge</span></span>) @amount = <span class="hljs-number"><span class="hljs-number">100</span></span> @credit_card = CreditCard.new({...}) @customer = Customer.new({<span class="hljs-symbol"><span class="hljs-symbol">credit_card:</span></span> @credit_card, ...}) @subscription = Subscription.new({<span class="hljs-symbol"><span class="hljs-symbol">customer:</span></span> customer, ...}) @invoice = Invoice.new({<span class="hljs-symbol"><span class="hljs-symbol">amount:</span></span> @amount, <span class="hljs-symbol"><span class="hljs-symbol">date:</span></span> DateTime.now, @subscription: subscription}, payment_service) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> describe <span class="hljs-string"><span class="hljs-string">'pay'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> it <span class="hljs-string"><span class="hljs-string">"charges customer's credit card"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> expect(@payment_service).to receive(<span class="hljs-symbol"><span class="hljs-symbol">:charge</span></span>).with(@credit_card, @amount) @invoice.pay <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> it <span class="hljs-string"><span class="hljs-string">'makes the invoice paid'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> expect(@invoice.paid_at).not_to be_nil @invoice.pay <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br>  oder spielen Sie sogar mit dem Modell im Interpreter (irb f√ºr Ruby), bei dem es sich m√∂glicherweise um die, wenn auch nicht sehr benutzerfreundliche, Benutzeroberfl√§che handelt: <br><br><pre> <code class="bash hljs">irb &gt; invoice = Invoice.new({amount: @amount, date: DateTime.now, @subscription: subscription}, payment_service) irb &gt; invoice.pay</code> </pre><br>  Warum ist es in dieser Phase so wichtig, ‚Äûfremde Artefakte‚Äú zu vermeiden?  Tatsache ist, dass das Modell keine Ahnung haben sollte, wie es gespeichert wird oder ob es √ºberhaupt gespeichert wird.  Letztendlich kann f√ºr einige Systeme das Speichern von Objekten direkt im Speicher durchaus geeignet sein.  Zum Zeitpunkt der Modellierung m√ºssen wir dieses Detail vollst√§ndig abstrahieren.  Dieser Ansatz wird als Persistenz-Ignoranz bezeichnet.  Es sollte betont werden, dass wir die Probleme bei der Arbeit mit dem Repository nicht ignorieren, egal ob es sich um eine relationale oder eine andere Datenbank handelt. Wir vernachl√§ssigen nur die Details der Interaktion mit ihr in der Modellierungsphase.  Persistenz-Ignoranz bedeutet die absichtliche Eliminierung von Mechanismen f√ºr die Arbeit mit dem Status des Modells sowie aller Arten von Metadaten, die mit diesem Prozess zusammenh√§ngen, aus dem Modell selbst.  Beispiele: <br><br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment">#  class User &lt; Entity #     table :users #     # mapping  field :name, type: 'String' #   def save ... end end user = User.load(id) #     user.save #    </span></span></code> </pre><br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment">#  class User #   ,      attr_accessor :name, :lastname end user = repo.load(id) #     repo.save(user) #    </span></span></code> </pre><br>  Dieser Ansatz beruht auch auf fundamentalen Gr√ºnden - der Einhaltung des Grundsatzes der alleinigen Verantwortung (Prinzip der Einzelverantwortung, S in SOLID).  Wenn das Modell zus√§tzlich zu seiner Funktionskomponente die Parameter f√ºr die Zustandserhaltung beschreibt und sich auch mit seiner Erhaltung und Belastung befasst, hat es offensichtlich zu viele Verantwortlichkeiten.  Der resultierende und nicht der letzte Vorteil von Persistence Ignorance ist die M√∂glichkeit, das Speicherwerkzeug und sogar die Art des Speichers selbst w√§hrend des Entwicklungsprozesses zu ersetzen. <br><br><h2>  Model-View-Controller </h2><br>  Das MVC-Konzept ist in der Entwicklungsumgebung verschiedener, nicht nur Server-, Anwendungen in verschiedenen Sprachen und Plattformen so beliebt, dass wir nicht mehr dar√ºber nachdenken, was es ist und warum es √ºberhaupt ben√∂tigt wird.  Ich habe die meisten Fragen aus dieser Abk√ºrzung hei√üt "Controller".  Unter dem Gesichtspunkt der Organisation der Struktur des Codes ist es eine gute Sache, Aktionen auf dem Modell zu gruppieren.  Der Controller sollte jedoch √ºberhaupt keine Klasse sein, sondern vielmehr ein Modul, das Methoden f√ºr den Zugriff auf das Modell enth√§lt.  Sollte es √ºberhaupt einen Ort geben, an dem man sein kann?  Als Entwickler, der dem Pfad von .NET -&gt; Ruby -&gt; Node.js folgte, wurde ich einfach von den JS (ES5) -Controllern ber√ºhrt, die im Rahmen von express.js implementiert werden.  Mit der F√§higkeit, die den Controllern zugewiesene Aufgabe in einem funktionaleren Stil zu l√∂sen, schreiben die Entwickler, wie verhext, den magischen ‚ÄûController‚Äú immer wieder.  Warum ist ein typischer Controller schlecht? <br><br>  Ein typischer Controller ist eine Reihe von Methoden, die nicht eng miteinander verwandt sind, sondern nur durch eine einzige Methode vereint werden - eine bestimmte Essenz des Modells.  und manchmal nicht nur eine, schlimmer.  Jede einzelne Methode kann unterschiedliche Abh√§ngigkeiten erfordern.  Mit Blick auf die Zukunft stelle ich fest, dass ich die Praxis der Abh√§ngigkeitsinversion (Abh√§ngigkeitsinversion, D in SOLID) unterst√ºtze.  Daher muss ich diese Abh√§ngigkeiten irgendwo au√üerhalb initialisieren und an den Controller-Konstruktor √ºbergeben.  Wenn ich zum Beispiel ein neues Konto erstelle, muss ich Benachrichtigungen an den Buchhalter senden, f√ºr den ich einen Benachrichtigungsdienst ben√∂tige. Bei anderen Methoden ist dies nicht erforderlich: <br><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">InvoiceController</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">initialize</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">invoice_repository</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">notification_service</span></span></span><span class="hljs-class">) @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">repository</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">invoice_repository</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">notification_service</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">notification_service</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">index</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">repository</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">get_all</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">show</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">) @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">repository</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">get_by_id</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">create</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">data</span></span></span><span class="hljs-class">) @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">repository</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">create</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">data</span></span></span><span class="hljs-class">) @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">notification_service</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">notify_accountant</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre><br>  Hier bittet die Idee darum, Methoden f√ºr die Arbeit mit dem Modell in separate Klassen zu unterteilen, und warum nicht? <br><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ListInvoices</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">initialize</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">invoice_repository</span></span></span><span class="hljs-class">) @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">repository</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">invoice_repository</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">repository</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">get_all</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CreateInvoice</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">initialize</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">invoice_repository</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">notification_service</span></span></span><span class="hljs-class">) @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">repository</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">invoice_repository</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">notification_service</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">notification_service</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">repository</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">create</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">data</span></span></span><span class="hljs-class">) @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">notification_service</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">notify_accountant</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre><br>  Nun, anstelle des Controllers gibt es jetzt eine Reihe von ‚ÄûFunktionen‚Äú f√ºr den Zugriff auf das Modell, die √ºbrigens auch beispielsweise √ºber Dateisystemverzeichnisse strukturiert werden k√∂nnen.  Jetzt m√ºssen Sie diese Methoden nach au√üen "√∂ffnen", d. H.  organisiere so etwas wie einen Router.  Als Person, die mit allen Arten von DSL (Domain-Specific Language) versucht ist, w√ºrde ich eine visuellere Beschreibung der Anweisungen f√ºr eine Webanwendung bevorzugen als Tricks in Ruby oder einer anderen Allzwecksprache zum Festlegen von Routen: <br><br><pre> <code class="plaintext hljs">`HTTP GET /invoices -&gt; return all invoices` `HTTP POST /invoices -&gt; create new invoice`</code> </pre><br>  oder zumindest <br><br><pre> <code class="plaintext hljs">`HTTP GET /invoices -&gt; ./invoices/list_invoices` `HTTP POST /invoices -&gt; ./invoices/create`</code> </pre><br>  Dies ist einem typischen Router sehr √§hnlich, mit dem einzigen Unterschied, dass er nicht mit den Controllern, sondern direkt mit den Aktionen im Modell interagiert.  Es ist klar, dass wir uns um die Serialisierung und Deserialisierung von Objekten und vielem mehr k√ºmmern m√ºssen, wenn wir JSON senden und empfangen m√∂chten.  Auf die eine oder andere Weise k√∂nnen wir die Controller loswerden, einen Teil ihrer Verantwortung auf die Verzeichnisstruktur und den fortgeschritteneren Router verlagern. <br><br><h2>  Abh√§ngigkeitsinjektion </h2><br>  Ich habe absichtlich einen "fortgeschritteneren Router" geschrieben.  Damit der Router mithilfe des Abh√§ngigkeitsinjektionsmechanismus auf deklarativer Ebene wirklich den Ablauf von Aktionen auf dem Modell zulassen kann, sollte er im Inneren wahrscheinlich recht komplex sein.  Das allgemeine Schema seiner Arbeit sollte ungef√§hr so ‚Äã‚Äãaussehen: <br><br><img src="https://habrastorage.org/webt/62/v1/ts/62v1tsjynvq067lnqxmpqefw0lg.png"><br><br>  Wie Sie sehen k√∂nnen, ist mein gesamter Router mit Abh√§ngigkeitsinjektion unter Verwendung eines IoC-Containers durchsetzt.  Warum ist das √ºberhaupt n√∂tig?  Das Konzept der ‚ÄûAbh√§ngigkeitsinjektion‚Äú geht auf die Abh√§ngigkeitsinversionstechnik zur√ºck, mit der die Konnektivit√§t von Objekten reduziert werden soll, indem die Abh√§ngigkeitsinitialisierung aus dem Anwendungsbereich verschoben wird.  Ein Beispiel: <br><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Repository</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-comment"><span class="hljs-comment">#  (   ) class A def initialize </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@repo</span></span></span><span class="hljs-comment"> = Repository.new end end #  (   ) class A def initialize(repo) </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@repo</span></span></span><span class="hljs-comment"> = repo end end</span></span></code> </pre><br>  Dieser Ansatz hilft denjenigen, die Test-Driven Development verwenden, sehr.  Im obigen Beispiel k√∂nnen wir einfach einen Stub im Konstruktor anstelle des realen Repository-Objekts platzieren, das seiner Schnittstelle entspricht, ohne das Objektmodell zu ‚Äûhacken‚Äú.  Dies ist nicht der einzige DI-Bonus: Bei korrekter Anwendung bringt dieser Ansatz viel angenehme Magie in Ihre Anwendung, aber das Wichtigste zuerst.  Die Abh√§ngigkeitsinjektion ist ein Ansatz, mit dem Sie die Abh√§ngigkeitsinversionstechnik in eine vollst√§ndige Architekturl√∂sung integrieren k√∂nnen.  Das Implementierungstool ist normalerweise ein IoC- (Inversion of Control) -Container.  Es gibt Unmengen von wirklich coolen IoC-Containern in der Java- und .NET-Welt, davon gibt es Dutzende.  In JS und Ruby gibt es leider keine geeigneten Optionen f√ºr mich.  Insbesondere habe ich mir Trockenbeh√§lter ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow">Trockenbeh√§lter</a> ) angesehen.  So w√ºrde meine Klasse aussehen: <br><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Invoice</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">include</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Import</span></span></span><span class="hljs-class">['</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">payment_service</span></span></span><span class="hljs-class">'] </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">pay</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">credit_card</span></span></span><span class="hljs-class"> = @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">subscription</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">customer</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">credit_card</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">amount</span></span></span><span class="hljs-class"> = @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">subscription</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">plan</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">price</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">payment_service</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">charge</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">credit_card</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">amount</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre><br>  Anstelle der schlanken Verwendung des Konstruktors belasten wir die Klasse durch die Einf√ºhrung eigener Abh√§ngigkeiten, die uns im Anfangsstadium von einem sauberen und unabh√§ngigen Modell abbringen.  Nun, etwas, und das Modell sollte √ºberhaupt nichts √ºber IoC wissen!  Dies gilt f√ºr Aktionen wie CreateInvoice.  F√ºr den gegebenen Fall bin ich in meinen Tests bereits verpflichtet, IoC als etwas Unver√§u√üerliches zu verwenden.  Das ist v√∂llig falsch.  Anwendungsobjekte sollten gr√∂√ütenteils nicht √ºber die Existenz von IoC informiert sein.  Nachdem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow">ich</a> viel gesucht und nachgedacht hatte, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow">skizzierte ich mein IoC</a> , was nicht so aufdringlich w√§re. <br><br><h2>  Modell speichern und laden </h2><br>  Persistenz Ignoranz erfordert einen unauff√§lligen Objekttransformator.  In diesem Artikel meine ich die Arbeit mit einer relationalen Datenbank. Die wichtigsten Punkte gelten f√ºr andere Arten von Speichern.  Ein objektrelationaler Konverter - ORM (Object Relational Mapper) - wird als √§hnlicher Konverter f√ºr relationale Datenbanken verwendet.  In der Welt von .NET und Java gibt es eine F√ºlle wirklich leistungsf√§higer ORM-Tools.  Alle von ihnen haben einige oder andere kleinere M√§ngel, vor denen Sie Ihre Augen schlie√üen k√∂nnen.  In JS und Ruby gibt es keine guten L√∂sungen.  Alle binden das Modell auf die eine oder andere Weise starr an das Framework und zwingen sie, fremde Elemente zu deklarieren, ganz zu schweigen von der Unanwendbarkeit von Persistence Ignorance.  Wie im Fall von IoC dachte ich dar√ºber nach, ORM selbst zu implementieren. Dies ist der Stand der Dinge in Ruby.  Ich habe nicht alles von Grund auf neu gemacht, sondern eine einfache ORM-Fortsetzung zugrunde gelegt, die unauff√§llige Tools f√ºr die Arbeit mit verschiedenen relationalen DBMS bietet.  Zun√§chst war ich an der M√∂glichkeit interessiert, Abfragen in Form von regul√§rem SQL auszuf√ºhren und am Ausgang ein Array von Strings (Hash-Objekten) zu erhalten.  Es blieb nur, Ihren Mapper zu implementieren und Persistence Ignorance bereitzustellen.  Wie bereits erw√§hnt, m√∂chte ich keine Zuordnungsfelder in das Dom√§nenmodell mischen. Daher implementiere ich Mapper so, dass eine separate Konfigurationsdatei im Typformat verwendet wird: <br><br><pre> <code class="ruby hljs">entity Invoice <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> field <span class="hljs-symbol"><span class="hljs-symbol">:amount</span></span> field <span class="hljs-symbol"><span class="hljs-symbol">:date</span></span> field <span class="hljs-symbol"><span class="hljs-symbol">:start_date</span></span> field <span class="hljs-symbol"><span class="hljs-symbol">:end_date</span></span> field <span class="hljs-symbol"><span class="hljs-symbol">:created_at</span></span> field <span class="hljs-symbol"><span class="hljs-symbol">:updated_at</span></span> reference <span class="hljs-symbol"><span class="hljs-symbol">:user</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">type:</span></span> User reference <span class="hljs-symbol"><span class="hljs-symbol">:subscription</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">type:</span></span> Subscription <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br>  Persistenz Ignoranz ist recht einfach mit einem externen Objekt vom Typ Repository zu implementieren: <br><br><pre> <code class="ruby hljs">repository.save(user)</code> </pre> <br>  Wir werden jedoch noch weiter gehen und das Muster der Arbeitseinheit implementieren.  Dazu m√ºssen Sie das Konzept einer Sitzung hervorheben.  Eine Sitzung ist ein Objekt, das im Laufe der Zeit existiert und in dem eine Reihe von Aktionen f√ºr das Modell ausgef√ºhrt werden, bei denen es sich um eine einzelne logische Operation handelt.  Im Verlauf einer Sitzung k√∂nnen Modellobjekte geladen und ge√§ndert werden.  Am Ende der Sitzung wird der Transaktionsstatus des Modells gespeichert. <br>  Beispiel f√ºr eine Arbeitseinheit: <br><br><pre> <code class="ruby hljs">user = session.load(User, <span class="hljs-symbol"><span class="hljs-symbol">id:</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>) plan = session.load(Plan, <span class="hljs-symbol"><span class="hljs-symbol">id:</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>) subscription = Subscription.new(user, plan) session.attach(subscription) invoice = Invoice.new(subscription) session.attach(invoice) <span class="hljs-comment"><span class="hljs-comment"># ... # -       if Date.today.yday == 1 subscription.comment = 'New year offer' invoice.amount /= 2 end session.flush</span></span></code> </pre><br>  Infolgedessen werden 2 Anweisungen in der Datenbank anstelle von 4 ausgef√ºhrt, und beide werden innerhalb derselben Transaktion ausgef√ºhrt. <br><br>  Und dann erinnere dich pl√∂tzlich an die Repositories!  Hier gibt es ein Gef√ºhl von Deja Vu, wie bei den Controllern: Ist das Repository nicht dieselbe rudiment√§re Einheit?  Mit Blick auf die Zukunft werde ich antworten - ja, das ist es.  Der Hauptzweck des Repositorys besteht darin, die Ebene der Gesch√§ftslogik vor der Interaktion mit dem realen Speicher zu sch√ºtzen.  Im Kontext relationaler Datenbanken bedeutet dies beispielsweise, dass SQL-Abfragen direkt in den Gesch√§ftslogikcode geschrieben werden.  Dies ist zweifellos eine sehr vern√ºnftige Entscheidung.  Aber zur√ºck zu dem Moment, als wir den Controller losgeworden sind.  Aus Sicht von OOP ist das Repository im Wesentlichen derselbe Controller - die gleichen Methoden, nicht nur f√ºr die Verarbeitung von Anforderungen, sondern auch f√ºr die Arbeit mit dem Repository.  Das Repository kann auch in Aktionen unterteilt werden.  Bei allen Angaben unterscheiden sich diese Aktionen in keiner Weise von dem, was wir anstelle des Controllers vorgeschlagen haben.  Das hei√üt, wir k√∂nnen Repository und Controller zugunsten einer einzigen einheitlichen Aktion ablehnen! <br><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LoadPlan</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">initialize</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">session</span></span></span><span class="hljs-class">) @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">session</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">session</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sql</span></span></span><span class="hljs-class"> = &lt;&lt;~</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SQL</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SELECT</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">p</span></span></span><span class="hljs-class">.* </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AS</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ENTITY</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">plan</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FROM</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">plans</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">p</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WHERE</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">p</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class"> = 1 </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SQL</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">session</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">fetch</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Plan</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sql</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre><br>  Sie haben wahrscheinlich bemerkt, dass ich SQL anstelle einer Art Objektsyntax verwende.  Das ist Geschmackssache.  Ich bevorzuge SQL, weil es eine Abfragesprache ist, eine Art DSL f√ºr die Arbeit mit Daten.  Es ist klar, dass es immer einfacher ist, Plan.load (id) zu schreiben als das entsprechende SQL, aber dies ist f√ºr triviale F√§lle.  Wenn es um etwas komplexere Dinge geht, wird SQL zu einem sehr willkommenen Werkzeug.  Manchmal verflucht man ein anderes ORM, wenn man versucht, es wie reines SQL zu machen. "Ich w√ºrde in ein paar Minuten schreiben."  F√ºr diejenigen, die Zweifel haben, empfehle ich einen Blick in die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow">MongoDB-Dokumentation</a> , in der die Erkl√§rungen in einer SQL-√§hnlichen Form gegeben werden, die sehr lustig aussieht!  Daher ist die Schnittstelle f√ºr Abfragen in <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow">ORM JetSet</a> , die ich f√ºr meine Zwecke geschrieben habe, SQL mit minimalen Impr√§gnierungen wie ‚ÄûAS ENTITY‚Äú.  √úbrigens verwende ich in den meisten F√§llen keine Modellobjekte, verschiedene DTOs usw. zum Anzeigen von Tabellendaten - ich schreibe einfach eine SQL-Abfrage, erhalte ein Array von Hash-Objekten und zeige sie in der Ansicht an.  Auf die eine oder andere Weise schaffen es nur wenige Menschen, Big Data zu ‚Äûscrollen‚Äú, indem sie verwandte Tabellen auf ein Modell projizieren.  In der Praxis wird eher eine flache Projektion (Ansicht) verwendet, und sehr ausgereifte Produkte erreichen die Optimierungsphase, wenn komplexere L√∂sungen wie CQRS (Command and Query Responsibility Segregation) verwendet werden. <br><br><h2>  Alles zusammenf√ºgen </h2><br>  Also, was wir haben: <br><br><ul><li>  Wir haben herausgefunden, wie das Modell geladen und gespeichert werden kann. Au√üerdem haben wir eine grobe Architektur des Web Delivery-Tools des Modells, eines bestimmten Routers, entworfen. </li><li>  Wir kamen zu dem Schluss, dass alle Logik, die nicht Teil des Themenbereichs ist, in Actions (Actions) anstelle von Controllern und Repositories aufgenommen werden kann. </li><li>  Aktionen m√ºssen die Abh√§ngigkeitsinjektion unterst√ºtzen </li><li>  anst√§ndiges Tool Dependency Injection implementiert; </li><li>  Das notwendige ORM ist implementiert. </li></ul><br>  Jetzt m√ºssen Sie nur noch denselben "Router" implementieren.  Da wir Repositorys und Controller zugunsten von Aktionen entfernt haben, ist es offensichtlich, dass wir f√ºr eine Anforderung mehrere Aktionen ausf√ºhren m√ºssen.  Handlungen sind autonom und wir k√∂nnen nicht ineinander investieren.  Aus diesem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow">Grund habe</a> ich als Teil des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow">Dandy-Frameworks</a> einen Router implementiert, mit dem Sie Aktionsketten erstellen k√∂nnen.  Konfigurationsbeispiel (auf / pl√§ne achten): <br><br><pre> <code class="plaintext hljs">:receive .-&gt; :before -&gt; common/open_db_session GET -&gt; welcome -&gt; :respond &lt;- show_welcome /auth -&gt; :before -&gt; current_user@users/load_current_user /profile -&gt; GET -&gt; plan@plans/load_plan \ -&gt; :respond &lt;- users/show_user_profile PATCH -&gt; users/update_profile /plans -&gt; GET -&gt; current_plan@plans/load_current_plan \ -&gt; plans@plans/load_plans \ -&gt; :respond &lt;- plans/list :catch -&gt; common/handle_errors</code> </pre><br>  "GET / auth / plans" zeigt alle verf√ºgbaren Abonnements an und "markiert" das aktuelle Abonnement.  Folgendes passiert: <br><br><ol><li>  ": before -&gt; common / open_db_session" - √ñffnen einer JetSet-Sitzung </li><li>  / auth ": before -&gt; current_user @ users / load_current_user" - L√§dt den aktuellen Benutzer (per Token).  Das Ergebnis wird im IoC-Container als current_user (current_user @ Anweisung) protokolliert. </li><li>  / auth / plans "current_plan @ plans / load_current_plan" - L√§dt den aktuellen Plan.  Dazu wird der Wert @current_user aus dem Container √ºbernommen.  Das Ergebnis wird im IoC-Container als current_plan (current_plan @ Anweisung) aufgezeichnet: <br><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LoadCurrentPlan</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">initialize</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">current_user</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">session</span></span></span><span class="hljs-class">) @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">current_user</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">current_user</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">session</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">session</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sql</span></span></span><span class="hljs-class"> = &lt;&lt;~</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SQL</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SELECT</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">p</span></span></span><span class="hljs-class">.* </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AS</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ENTITY</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">plan</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FROM</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">plans</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">p</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">INNER</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">JOIN</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">subscriptions</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">s</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ON</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">s</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">user_id</span></span></span><span class="hljs-class"> = :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">user_id</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AND</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">s</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">current</span></span></span><span class="hljs-class"> = '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">t</span></span></span><span class="hljs-class">' </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WHERE</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">p</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class"> = :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">user_id</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LIMIT</span></span></span><span class="hljs-class"> 1 </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SQL</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">session</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">execute</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sql</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">user_id</span></span></span><span class="hljs-class">: @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">current_user</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">do</span></span></span><span class="hljs-class"> |</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">row</span></span></span><span class="hljs-class">| </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">map</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Plan</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">row</span></span></span><span class="hljs-class">, '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">plan</span></span></span><span class="hljs-class">') </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre><br></li><li>  "Plans @ plans / load_plans" - L√§dt eine Liste aller verf√ºgbaren Pl√§ne.  Das Ergebnis wird im IoC-Container als Pl√§ne (plans @ instruction) registriert. </li><li>  ": Antwort &lt;- Pl√§ne / Liste" - registrierter ViewBuilder, zum Beispiel JBuilder, zeichnet View 'Pl√§ne / Liste' vom Typ: <br><br><pre> <code class="ruby hljs">json.plans @plans <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-params"><span class="hljs-params">|plan|</span></span> json.id plan.id json.name plan.name json.price plan.price json.active plan.id == @current_plan.id <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br></li></ol><br>  Als @plans und @current_plan werden die in den vorherigen Schritten registrierten Werte aus dem Container abgerufen.  Im Action-Konstruktor k√∂nnen Sie im Allgemeinen alles "bestellen", was Sie ben√∂tigen, oder vielmehr alles, was im Container registriert ist.  Ein aufmerksamer Leser wird h√∂chstwahrscheinlich eine Frage haben, aber gibt es eine Isolierung solcher Variablen im Mehrbenutzermodus?  Ja, das tut es.  Tatsache ist, dass der Hypo IoC-Container die Lebensdauer von Objekten festlegen und dar√ºber hinaus an die Lebensdauer anderer Objekte binden kann.  In Dandy sind Variablen wie @plans, @current_plan, @current_user an das Anforderungsobjekt gebunden und werden sofort nach Abschluss der Anforderung zerst√∂rt.  √úbrigens ist die JetSet-Sitzung auch an die Anforderung gebunden - ein Zur√ºcksetzen ihres Status wird auch durchgef√ºhrt, wenn die Dandy-Anforderung abgeschlossen ist.  Das hei√üt  Jede Anfrage hat einen eigenen isolierten Kontext.  Hypo beherrscht Dandys gesamten Lebenszyklus, egal wie viel Spa√ü dieses Wortspiel bei der w√∂rtlichen √úbersetzung der Namen machte. <br><br><h2>  Schlussfolgerungen </h2><br>  Im Rahmen der gegebenen Architektur benutze ich das Objektmodell, um den Themenbereich zu beschreiben;  Ich verwende geeignete Methoden wie Abh√§ngigkeitsinjektion.  Ich kann sogar Vererbung verwenden.  Gleichzeitig sind alle diese Aktionen im Wesentlichen gew√∂hnliche Funktionen, die auf deklarativer Ebene miteinander verkettet werden k√∂nnen.  Wir haben das gew√ºnschte Backend in einem funktionalen Stil erhalten, aber mit allen Vorteilen des Objektansatzes, wenn Sie keine Probleme mit Abstraktionen haben und Ihren Code testen.  Am Beispiel des DSL-Routers Dandy k√∂nnen wir die erforderlichen Sprachen zur Beschreibung von Routen und mehr erstellen. <br><br><h2>  Fazit </h2><br>  Als Teil dieses Artikels f√ºhrte ich eine Art Exkursion zu den grundlegenden Aspekten der Erstellung eines Backends durch, wie ich es sehe.  Ich wiederhole, der Artikel ist oberfl√§chlich, er hat nicht viele wichtige Themen angesprochen, wie zum Beispiel die Leistungsoptimierung.  Ich habe versucht, mich nur auf die Dinge zu konzentrieren, die f√ºr die Community als Denkansto√ü wirklich n√ºtzlich sein k√∂nnen, und nicht noch einmal von leer zu leer zu sch√ºtten, was SOLID, TDD ist, wie das MVC-Schema aussieht und so weiter.  Strenge Definitionen dieser und anderer Begriffe, die von neugierigen Lesern verwendet werden, sind in dem riesigen Netzwerk leicht zu finden, ganz zu schweigen von den Kollegen im Gesch√§ft, f√ºr die diese Abk√ºrzungen Teil der Alltagssprache sind.  Und schlie√ülich, betone ich, versuche ich mich nicht auf die Werkzeuge zu konzentrieren, die ich implementieren musste, um die aufgeworfenen Probleme zu l√∂sen.      ,    .     - ,       . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de474504/">https://habr.com/ru/post/de474504/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de474494/index.html">Wie war der Zabbix-Gipfel 2019?</a></li>
<li><a href="../de474496/index.html">Datenbanken unter HighLoad ++ 2019</a></li>
<li><a href="../de474498/index.html">JavaFX Tutorial: Hallo Welt</a></li>
<li><a href="../de474500/index.html">Plugin-Entwicklung f√ºr Grafana: die Geschichte der Vollkegel</a></li>
<li><a href="../de474502/index.html">Odnoklassniki-Analyse beim Joker 2019</a></li>
<li><a href="../de474508/index.html">Erfolge des 3D-Bio-Drucks von Hauttransplantaten</a></li>
<li><a href="../de474514/index.html">Wie √ºberleben chinesische Bitcoin-Bergbaumagnaten?</a></li>
<li><a href="../de474516/index.html">Sprachanwendungen: Der milliardste Markt, den Russland nicht bemerkt</a></li>
<li><a href="../de474518/index.html">FP gegen OOP</a></li>
<li><a href="../de474522/index.html">Mutt Geschichte</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>