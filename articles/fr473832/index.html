<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🍨 🛀🏽 ⛹🏻 ShIoTiny: mises à jour et notifications 🐨 👇🏻 🤷🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="De quoi parle cet article 
 Nous continuons la série d'articles sur ShIoTiny - un contrôleur visuellement programmable basé sur la puce ESP8266 . 

 C...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ShIoTiny: mises à jour et notifications</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/473832/"><img src="https://habrastorage.org/webt/2x/3l/hz/2x3lhz-tej3w7wnbri8k_crqjbs.jpeg"><br><br><h4>  De quoi parle cet article </h4><br>  Nous continuons la série d'articles sur <b>ShIoTiny</b> - un contrôleur visuellement programmable basé sur la puce <b>ESP8266</b> . <br><br>  Cet article <b>décrit</b> ce qui a changé depuis le précédent firmware <b>ShIoTiny</b> : comment l'interface utilisateur a changé;  comment réaffecter des "jambes" et d'autres choses moins importantes, mais non moins attendues. <br><br>  L'article présente quelque chose comme une " <i><b>fiche d'information</b></i> " sur la situation dans le domaine du <b>développement de</b> firmware <b>ShIoTiny</b> .  Ceux qui ne sont pas intéressés par le développement de cet article peuvent sauter cet article en toute conscience. <br><br>  Ceux qui ne savent pas de quoi ils parlent, mais qui veulent le savoir, peuvent lire mes précédents articles sur le firmware <b>ShIoTiny</b> ou se référer à la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation</a> . <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><b>Site du</b> projet <b>ShIoTiny</b></a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">La version en ligne de l'éditeur <b>ElDraw</b></a> est exactement la même que dans le firmware, pour référence. <br><br>  Liens vers des schémas, des micrologiciels et plus encore - sur le site Web <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><b>ShIoTiny</b></a> dans la section documentation. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><b>Articles ShIoTiny</b> précédents et mes autres articles</a> <br><a name="habracut"></a><br><h3>  Intro pour rassurer le vénérable public </h3><br>  Il se trouve que le quatrième trimestre est une ruée permanente.  Par conséquent, certains camarades ont déjà commencé à enterrer le projet <b>ShIoTiny</b> et m'écrivent par la poste, ils disent - «hé, auteur, où êtes-vous?!  pourquoi n'écris-tu pas?!  nous utilisons votre firmware ici!  et vous n'êtes pas un seul nouvel article! " <br>  Bien sûr, c'était d'une manière polie, mais en termes de signification.  Certains, au contraire, ont écrit des suggestions et des commentaires, qui ont beaucoup aidé à attraper les puces logicielles.  Merci les gars.  Il est toujours agréable de ne pas cuisiner dans son propre jus, mais d'avoir des personnes partageant les mêmes idées. <br><br>  Mes amis!  Je vous rappelle que mon projet est un hobby et en plus j'ai un travail, une femme et des enfants.  Alors je vous en prie: soyez indulgents!  L'auteur écrit comment il peut et peut :) <br><br>  Je m'empresse de rassurer tout le monde: le <u>projet n'est pas mort</u> !  J'ai attrapé pas mal de puces dans le code et, en plus, refait le site du projet (même si je ne l'ai pas encore fini - je remplis le site de contenu). <br><br>  Du point de vue de la plupart des enseignements philosophiques du monde, il n'y a rien de permanent.  Même notre univers évolue.  Que pouvons-nous dire du micrologiciel du microcontrôleur ou du site Web du projet? <br><br>  Les changements clés dans le firmware <b>ShIoTiny ont</b> affecté principalement deux choses: la possibilité de redéfinir les jambes et la page d'état du contrôleur.  Nous en parlerons.  Quant au nouveau design du site du projet, je ne le toucherai pas ici: toute personne curieuse viendra, regardera et critiquera. <br><br><h3>  Redéfinir les jambes <b>ESP8266</b> </h3><br>  Donc, les jambes ou ce sont - <b>GPIO</b> .  Initialement, les jambes du microcontrôleur <b>ESP866 n'étaient</b> pas destinées à être redéfinies.  Ils étaient cloués de façon rigide aux entrées et sorties de la carte <b>ESP-07</b> (toute personne intéressée - tout est sur le site Web du projet). <br><br>  Mais tout à coup, il s'est avéré que mon firmware sans aucune modification va non seulement sur le module <b>ESP-07</b> avec 1 Mo de FLASH, mais aussi sur l' <b>ESP-01</b> , <b>ESP-12</b> et même sur l' <b>ESP-8285</b> ! <br><br>  La question s'est posée à juste titre que l'un a besoin de 5 entrées et une sortie, les 6 autres sorties et aucune entrée, et les trois troisièmes thermomètres en même temps. <br><br>  Une vague de lettres du public indigné a presque assombri les restes de mon esprit!  Ma femme se préparait déjà à m'appeler infirmière avec une chemise de mort ... Mais je me suis avéré être un dur à cuire! <br>  Serrant les dents et buvant trois litres de café, j'ai récupéré les restes du cerveau, qui par hasard n'étaient pas bu dans le corps étudiant, et j'ai compris comment mettre en œuvre l'astuce en redéfinissant les jambes pour que tout le monde se sente bien. <br><br>  Je n'ennuierai pas le lecteur avec la cuisine du programme interne.  Du point de vue de l'utilisateur, tout semble extrêmement simple: il enfonce la souris sur un nœud qui est connecté à n'importe quelle jambe du module <b>GPIO</b> et sélectionne une jambe dans la liste des possibles.  Approximativement comme indiqué dans la figure ci-dessous. <br><br><img src="https://habrastorage.org/webt/zn/-f/9x/zn-f9x5xesj70levkx1noewx5ay.jpeg"><br><br>  <b>N / A</b> - signifie que le pied n'est pas sélectionné. <br>  S'il y a un nœud dans le circuit avec un <b>segment</b> <b>N / A</b> non sélectionné, alors un tel circuit ne peut pas être chargé dans l'appareil - l'éditeur <b>ElDraw</b> ne le permettra <b>pas</b> .  Mais un tel schéma peut être téléchargé sur le disque pour continuer à le modifier «un peu plus tard». <br><br>  Tout est très simple, mais il y a des nuances. <br><br>  <b>Tout d'abord</b> , ce qui est très pratique à mon avis, seules les jambes inutilisées sont affichées dans la liste.  Autrement dit, choisir une jambe deux fois est impossible. <br><br>  <b>Deuxièmement</b> , la jambe <b>GPIO15</b> est réservée au bouton AP et ne peut pas être utilisée à d'autres fins.  Désolé, mais sinon, pas question ... <br><br>  <b>Troisièmement</b> , la jambe <b>GPIO16</b> ne peut pas être utilisée comme entrée binaire standard (nœud d' <b>entrée</b> ). <br><br>  <b>Quatrièmement</b> , les <b>jambes</b> <b>GPIO9</b> et <b>GPIO10</b> ne peuvent être utilisées que sur le module <b>ESP-8285</b> .  Sur d'autres modules, le résultat sera désastreux - dépendance totale et redémarrage sans fin! <br><br>  Le dernier point - le blocage de certains modules lors du choix des <b>jambes</b> <b>GPIO9</b> et <b>GPIO10</b> m'a fait réfléchir.  Après tout, je ne veux pas modifier le contrôleur à chaque fois si les jambes sont mal sélectionnées!  Et j'ai trouvé une nouvelle façon de passer en mode de configuration. <br><br><h3>  Nouvelle façon d'entrer en mode configuration </h3><br>  Si quelqu'un a lu mes articles précédents, il se souvient que le mode de configuration du firmware <b>ShIoTiny</b> est le mode lorsque la puce ESP8266 devient un point d'accès ouvert et que le circuit du programme ne démarre pas automatiquement après le redémarrage.  Et s'il ne démarre pas, il ne se bloquera pas lors du choix des jambes <b>GPIO</b> . <br><br>  Autrement dit, en mode de configuration, vous pouvez changer les jambes de problème de <b>GPIO9</b> et <b>GPIO10</b> à d'autres.  Mais le problème est que vous ne pouvez entrer en mode de configuration qu'en maintenant le bouton <b>AP</b> pendant environ 4 secondes!  Et pendant ce temps, le contrôleur aura le temps de commencer à exécuter le programme de circuit "courbe" et de geler! <br><br>  Pour résoudre ce problème, j'ai trouvé un intervalle de garde d'une demi-seconde après le redémarrage du contrôleur.  Si le bouton <b>AP</b> est enfoncé dans les 0,5 secondes après le redémarrage du contrôleur, le contrôleur redémarrera immédiatement en mode de configuration.  Dans le même temps, pendant l'intervalle de garde d'une demi-seconde, le schéma de programme ne démarre pas.  Et cela signifie qu'il ne peut pas se bloquer. <br><br>  Les inconvénients sont évidents - le programme ne démarre pas immédiatement, mais une demi-seconde plus tard.  Les avantages sont beaucoup plus importants - si vous sélectionnez les «jambes incorrectes» ou si le programme du circuit se bloque pour une autre raison, vous pouvez toujours passer en mode configuration et corriger la situation sans faire clignoter le contrôleur. <br><br>  En pratique, tout semble plus simple qu'un navet cuit à la vapeur: nous appuyons sur le bouton <b>Reset</b> et, en relâchant le bouton <b>Reset</b> tout de suite, sans interférer, nous appuyons sur le bouton <b>AP</b> .  Immédiatement pendant environ une demi-seconde, la LED <b>STATUS</b> bleue s'allume (si vous l'avez bien sûr soudée à <b>GPIO0</b> ) et le contrôleur redémarre en mode configuration. <br><br>  Si le circuit du programme fonctionne normalement, vous pouvez toujours basculer en mode de configuration de «l'ancienne» manière - en appuyant sur le bouton <b>AP</b> et en le maintenant enfoncé pendant environ 4 secondes (jusqu'à ce que la LED bleue <b>STATUS</b> s'allume). <br><br><h3>  <b>Page d'</b> état <b>ShIoTiny</b> </h3><br>  La possibilité de connecter les jambes par la volonté de l'utilisateur a conduit à une révision de la page d'informations principale du firmware <b>ShIoTiny</b> . <br><br>  Après de longues délibérations, je suis arrivé à la conclusion que la page devrait être a) informative et b) ne pas en contenir trop. <br><br>  Ce que j'ai obtenu est illustré dans la figure ci-dessous. <br><br><img src="https://habrastorage.org/webt/c6/lr/as/c6lrasjcqqtzgd1fhz_gk--k4z4.jpeg"><br><br>  La page d'informations principale comprend deux sections: <b>Info</b> - informations générales et <b>GPIO utilisés</b> - informations sur l'utilisation des tronçons d'E / S.  Examinons-les plus en détail. <br><br><h4>  Section Info </h4><br>  <b>Nom: esp_8266_155da4</b> - un nom unique pour l'appareil.  Il est généré automatiquement et ne peut pas être modifié. <br><br>  <b>Ver: 2019-10-22 22:54:51 +0700 6b5ee82 clean</b> - version du firmware (date de construction et identifiant de validation). <br><br>  <b>MQTT: connecté à: 192.168.1.2:21064, SSL</b> - connexion au serveur MQTT.  Affiche l'adresse IP ou l'URL du serveur, le port du serveur et le mode SSL si une connexion sécurisée est utilisée.  N'oubliez pas que si le programme de circuit ne contient pas de nœuds pour travailler avec MQTT, la connexion ne sera jamais établie! <br><br>  <b>WiFi: IP STA: 192.168.1.134.</b>  - Mode de fonctionnement <b>WiFi ESP8266</b> : <b>STA</b> - station, <b>AP</b> - point d'accès.  Les deux modes avec des adresses IP différentes peuvent être sélectionnés en même temps. <br><br>  <b>Maintenant: mer.30 octobre 2019 21:49:28 GMT + 0700</b> - heure actuelle.  Il est montré que seul le temps défini par le nœud <b>Définir l'heure</b> !  Sinon, il sera indiqué que l'heure n'est pas synchronisée et n'est pas réglée. <br><br><h4>  Section GPIO utilisée </h4><br>  Cette section montre toutes les jambes de module utilisées dans le diagramme de programme et leur état actuel. <br><br>  Le format de sortie est évident: <b>GPIO &lt;numéro de jambe&gt; (fonction): état</b> <br>  Le numéro de jambe est le numéro ou, pour l' <b>ADC</b> , au lieu du numéro sera l'inscription <b>adc</b> . <br>  Fonction: <b>Entrée</b> - entrée binaire;  <b>Relais</b> - sortie binaire;  <b>ADC</b> - ADC ou type de capteur: <b>DS182x</b> ou <b>DHTxx</b> . <br><br>  Champ «état» - dépend du but de la jambe. <br>  Pour les entrées et sorties binaires - 0 ou 1. <br>  Pour capteurs - température, humidité. <br>  Pour l'ADC - ses lectures recalculées selon la formule donnée (voir la description du travail avec l'ADC dans les instructions). <br><br>  À mon avis, la page principale contient toutes les informations nécessaires sur le fonctionnement du contrôleur. <br><br><h3>  Conclusion </h3><br>  Voici, en fait, tous les changements majeurs dans le firmware aujourd'hui.  En plus de ces innovations, des dizaines de cinq erreurs mineures ont été corrigées. <br><br>  Comme d'habitude - des instructions détaillées sur le site Web <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><b>ShIoTiny</b></a> dans la section documentation ou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . <br><br>  Suggestions, souhaits, critiques, <s>argent, cadeaux</s> , etc. - envoyez-moi un commentaire ou un e-mail: <b>shiotiny@yandex.ru</b> . <br><br>  En attente de commentaires et suggestions. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr473832/">https://habr.com/ru/post/fr473832/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr473818/index.html">Application sur TSD et communication avec 1C: Enterprise 8.3 via HTTP-Service. Partie 4 (scanner OnKeyUp. SC avec émulation clavier)</a></li>
<li><a href="../fr473822/index.html">Offre d'emploi en 1 jour: comment nous avons interviewé et commenté le même jour</a></li>
<li><a href="../fr473824/index.html">Comment construire une technologie d'entreprise pour la planification des ventes dans un seul système</a></li>
<li><a href="../fr473826/index.html">Authentification OTP sur le serveur Web Apache</a></li>
<li><a href="../fr473828/index.html">La vision par ordinateur comme alternative aux laissez-passer de bureau</a></li>
<li><a href="../fr473834/index.html">Surveillance de Blackbox dans les réseaux Clos. Rapport Yandex</a></li>
<li><a href="../fr473838/index.html">DJI Mavic Mini: le quadricoptère pliant le plus léger</a></li>
<li><a href="../fr473840/index.html">Diffusez des vidéos depuis un appareil Android via UDP vers une application JAVA</a></li>
<li><a href="../fr473842/index.html">Sommaire des actualités sur l'apprentissage automatique et l'intelligence artificielle d'octobre</a></li>
<li><a href="../fr473844/index.html">Pourquoi avons-nous besoin de plages de C ++ 20 dans un simple broyeur?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>