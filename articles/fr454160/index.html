<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üíú üë©üèø‚ÄçüöÄ üê§ Utilisation de PowerShell pour augmenter les privil√®ges des comptes locaux üßú ‚è¨ üë∂üèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="L'escalade de privil√®ges est l'utilisation par un attaquant des droits du compte courant pour obtenir un niveau d'acc√®s suppl√©mentaire, g√©n√©ralement p...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Utilisation de PowerShell pour augmenter les privil√®ges des comptes locaux</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/varonis/blog/454160/"><img src="https://habrastorage.org/webt/5m/dx/hq/5mdxhqpfywe6rsdm6qeus22zxhu.jpeg"><br><br>  L'escalade de privil√®ges est l'utilisation par un attaquant des droits du compte courant pour obtenir un niveau d'acc√®s suppl√©mentaire, g√©n√©ralement plus √©lev√© au syst√®me.  Malgr√© le fait que l'escalade de privil√®ges peut √™tre le r√©sultat de l'exploitation de vuln√©rabilit√©s zero-day, ou du travail de pirates informatiques de premier ordre menant une attaque cibl√©e, ou d'un malware correctement d√©guis√©, mais cela se produit le plus souvent en raison d'une configuration incorrecte de l'ordinateur ou du compte.  En poursuivant le d√©veloppement de l'attaque, les attaquants exploitent un certain nombre de vuln√©rabilit√©s distinctes qui, ensemble, peuvent entra√Æner une fuite de donn√©es catastrophique. <br><a name="habracut"></a><br><h2>  Pourquoi les utilisateurs ne devraient-ils pas disposer de droits d'administrateur local? </h2><br>  Si vous √™tes un sp√©cialiste de la s√©curit√©, il peut sembler √©vident que les utilisateurs ne devraient pas avoir de droits d'administrateur local, comme ceci: <br><br><ul><li>  Rend leurs comptes plus vuln√©rables √† diverses attaques. </li><li>  Rend ces attaques beaucoup plus graves. </li></ul><br>  Malheureusement, pour de nombreuses organisations, cela reste un sujet tr√®s controvers√© et s'accompagne parfois de discussions anim√©es (voir, par exemple, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">mon responsable dit que tous les utilisateurs doivent √™tre des administrateurs locaux</a> ).  Sans entrer dans les d√©tails de cette discussion, nous pensons que l'attaquant a obtenu les droits d'un administrateur local sur le syst√®me √† l'√©tude: soit par un exploit, soit parce que les machines n'√©taient pas correctement prot√©g√©es. <br><br><h2>  √âtape 1. Inversez la r√©solution des noms DNS via PowerShell </h2><br>  Par d√©faut, PowerShell est install√© sur de nombreux postes de travail locaux et sur la plupart des serveurs Windows.  Bien qu'il ne soit pas exag√©r√©, il est consid√©r√© comme un outil d'automatisation et de contr√¥le incroyablement utile, il est √©galement capable de se transformer en un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">malware sans fil</a> presque invisible (un programme de piratage qui ne laisse pas de traces d'une attaque). <br><br>  Dans notre cas, l'attaquant commence √† effectuer une reconnaissance du r√©seau √† l'aide du script PowerShell, triant s√©quentiellement l'espace d'adressage IP du r√©seau, essayant de d√©terminer si cette IP est autoris√©e pour l'h√¥te, et si oui, quel est le nom de r√©seau de cet h√¥te. <br>  Il existe plusieurs fa√ßons d'accomplir cette t√¢che, mais l'utilisation de l'applet de commande Get-ADComputer est une option fiable car elle renvoie un ensemble de donn√©es vraiment riche sur chaque n≈ìud: <br><br><pre><code class="plaintext hljs">import-module activedirectory Get-ADComputer -property * -filter { ipv4address -eq '10.10.10.10'}</code> </pre> <br>  Si la vitesse de travail dans les grands r√©seaux pose des probl√®mes, le rappel du syst√®me DNS peut √™tre utilis√©: <br><br><pre> <code class="plaintext hljs">[System.Net.Dns]::GetHostEntry('10.10.10.10').HostName</code> </pre> <br><br><img src="https://habrastorage.org/webt/ah/3l/ia/ah3liarl5izowrmwwo8r8uo0gte.png"><br><br>  Cette m√©thode de listage des n≈ìuds sur un r√©seau est tr√®s populaire, car la plupart des r√©seaux n'utilisent pas de mod√®le de s√©curit√© √† confiance nulle et ne suivent pas les demandes DNS internes pour les pics d'activit√© suspects. <br><br><h2>  √âtape 2: s√©lection des objectifs </h2><br>  Le r√©sultat final de cette √©tape est d'obtenir une liste de noms d'h√¥te de serveur et de poste de travail pouvant √™tre utilis√©s pour poursuivre l'attaque. <br><br><img src="https://habrastorage.org/webt/q8/c6/fw/q8c6fwmptneowdatiefmti5wgdq.png"><br><br>  A en juger par le nom, le serveur 'HUB-FILER' semble √™tre un objectif louable, car  au fil du temps, les serveurs de fichiers ont tendance √† accumuler un grand nombre de dossiers r√©seau et un acc√®s excessif √† eux par trop de personnes. <br><br>  L'affichage √† l'aide de l'Explorateur Windows nous permet de d√©terminer s'il existe un dossier partag√© ouvert, mais notre compte actuel ne peut pas y acc√©der (nous n'avons probablement que les droits de listage). <br><br><h2>  <b>√âtape 3: Apprenez l'ACL</b> </h2><br>  Maintenant sur notre h√¥te HUB-FILER et le dossier de partage cible, nous pouvons ex√©cuter le script PowerShell pour obtenir l'ACL.  Nous pouvons le faire √† partir de la machine locale, car nous avons d√©j√† des droits d'administrateur local: <br><br><pre> <code class="plaintext hljs">(get-acl \\hub-filer\share).access | ft IdentityReference,FileSystemRights,AccessControlType,IsInherited,InheritanceFlags ‚Äìauto</code> </pre> <br><br>  R√©sultat d'ex√©cution: <br><br><img src="https://habrastorage.org/webt/ia/4c/ep/ia4cepe0xbhgippr_kuyco53bpm.png"><br><br>  De l√†, nous voyons que le groupe Utilisateurs du domaine n'a acc√®s qu'√† la liste, mais le groupe Helpdesk a √©galement le droit de changer. <br><br><h2>  √âtape 4: identifier les comptes </h2><br>  En ex√©cutant <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Get-ADGroupMember</a> , nous pouvons obtenir tous les membres de ce groupe: <br><br><pre> <code class="plaintext hljs">Get-ADGroupMember -identity Helpdesk</code> </pre> <br><br><img src="https://habrastorage.org/webt/t0/zl/0f/t0zl0fhqq2fulbe2ma9yrq-7tpc.png"><br><br>  Dans cette liste, nous voyons un compte d'ordinateur que nous avons d√©j√† identifi√© et auquel nous avons d√©j√† acc√©d√©: <br><br><img src="https://habrastorage.org/webt/6o/hd/4r/6ohd4ryvgxomnhzaonjt2udhnxa.png"><br><br><h2>  √âtape 5: utiliser PSExec pour travailler √† partir d'un compte d'ordinateur </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">PsExec</a> de Microsoft Sysinternals vous permet d'ex√©cuter des commandes dans le contexte du compte syst√®me SYSTEM @ HUB-SHAREPOINT, qui, comme nous le savons, est membre du groupe de travail Helpdesk.  Autrement dit, il nous suffit d'effectuer: <br><br><pre> <code class="plaintext hljs">PsExec.exe -s -i cmd.exe</code> </pre> <br>  Eh bien, vous avez alors un acc√®s complet au dossier cible \\ HUB-FILER \ share \ HR, car vous travaillez dans le contexte du compte d'ordinateur HUB-SHAREPOINT.  Et avec cet acc√®s, les donn√©es peuvent √™tre copi√©es sur un p√©riph√©rique de stockage portable ou autrement r√©cup√©r√©es et transf√©r√©es sur le r√©seau. <br><br><h2>  √âtape 6: d√©tecter cette attaque </h2><br>  Cette vuln√©rabilit√© particuli√®re pour la d√©finition des privil√®ges de compte (les comptes d'ordinateur acc√©dant aux dossiers r√©seau partag√©s au lieu des comptes d'utilisateur ou des comptes de service) peut √™tre d√©tect√©e.  Cependant, sans les bons outils, c'est tr√®s difficile. <br><br>  Pour d√©tecter et pr√©venir cette cat√©gorie d'attaques, nous pouvons utiliser <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">DatAdvantage</a> pour identifier les groupes contenant des comptes d'ordinateurs, puis fermer l'acc√®s √† ceux-ci.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">DatAlert</a> va plus loin et vous permet de cr√©er une notification sp√©cifiquement pour un tel sc√©nario. <br><br>  La capture d'√©cran ci-dessous montre une notification utilisateur qui sera d√©clench√©e chaque fois qu'un compte d'ordinateur acc√®de aux donn√©es sur un serveur surveill√©. <br><br><img src="https://habrastorage.org/webt/y8/eu/6g/y8eu6gawfmubmafib8epqcgaflk.png"><br><br><h2>  √âtapes suivantes √† l'aide de PowerShell </h2><br>  Envie d'en savoir plus?  Utilisez le code de d√©verrouillage ¬´blog¬ª pour acc√©der gratuitement au <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">cours vid√©o</a> complet <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">PowerShell et aux principes de base d'Active Directory</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr454160/">https://habr.com/ru/post/fr454160/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr454140/index.html">D'un avocat √† un testeur √† Yandex. L'histoire de mon stage</a></li>
<li><a href="../fr454144/index.html">Dans Java 13, ils veulent ajouter des ¬´blocs de texte¬ª</a></li>
<li><a href="../fr454148/index.html">V√©rification des performances SOC</a></li>
<li><a href="../fr454154/index.html">"Branches de l'enfer": contr√¥le des nuages ‚Äã‚Äãdes d√©charges ill√©gales et des d√©charges dangereuses</a></li>
<li><a href="../fr454156/index.html">Pneus et protocoles en automatisation industrielle: comment tout cela fonctionne</a></li>
<li><a href="../fr454164/index.html">Comment fonctionnent les tests A / B dans Avito?</a></li>
<li><a href="../fr454166/index.html">6 juin - VeeamON Forum √† Moscou</a></li>
<li><a href="../fr454168/index.html">L'ar√®ne principale du pays. Comment Luzhniki a-t-il √©t√© mis √† jour avant la Coupe du monde</a></li>
<li><a href="../fr454170/index.html">Bienvenue au Meetup DroidHeads le 8 juin</a></li>
<li><a href="../fr454172/index.html">Envoi de statistiques d'un DataFrame √† BigQuery en utilisant les statistiques Yandex.Direct comme exemple</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>