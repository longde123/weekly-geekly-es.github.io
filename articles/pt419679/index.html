<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëêüèΩ üëåüèΩ üõï Implementando a API do Spring Framework a partir do zero. Passo a passo para iniciantes. Parte 1 üî± üíáüèº üë®‚Äçüè≠</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="O Spring Framework √© um dos mais complicados para entender e aprender. A maioria dos desenvolvedores aprende devagar, atrav√©s de tarefas pr√°ticas e do...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Implementando a API do Spring Framework a partir do zero. Passo a passo para iniciantes. Parte 1</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/419679/"><img src="https://habrastorage.org/webt/iw/mz/82/iwmz824_ptetkxwvc6sqtwjmbjw.png"><br><br>  O Spring Framework √© um dos mais complicados para entender e aprender.  A maioria dos desenvolvedores aprende devagar, atrav√©s de tarefas pr√°ticas e do google.  Essa abordagem n√£o √© eficaz, pois n√£o fornece uma imagem completa e, ao mesmo tempo, √© cara. <br><br>  Gostaria de oferecer a voc√™ uma abordagem fundamentalmente nova para o estudo da primavera.  Consiste no fato de que uma pessoa passa por uma s√©rie de tutoriais especialmente preparados e implementa independentemente o funcionamento da primavera.  A peculiaridade dessa abordagem √© que, al√©m de uma compreens√£o 100% dos aspectos estudados do Spring, tamb√©m oferece um grande aumento no Java Core (anota√ß√µes, reflex√£o, arquivos, gen√©ricos). <br><br>  O artigo fornecer√° uma experi√™ncia inesquec√≠vel e far√° voc√™ se sentir como um desenvolvedor Pivotal.  Passo a passo, voc√™ far√° suas aulas se tornarem melhores e organizar√° seu ciclo de vida (o mesmo que em uma primavera real).  As classes que voc√™ implementar√° s√£o <b>BeanFactory</b> , <b>Component</b> , <b>Service</b> , <b>BeanPostProcessor</b> , <b>BeanNameAware</b> , <b>BeanFactoryAware</b> , <b>InitializingBean</b> , <b>PostConstruct</b> , <b>PreDestroy</b> , <b>DisposableBean</b> , <b>ApplicationContext</b> , <b>ApplicationListener</b> , <b>ContextClosedEvent</b> . <br><a name="habracut"></a><br><h2>  Um pouco sobre voc√™ </h2><br>  Meu nome √© Yaroslav e sou desenvolvedor Java com 4 anos de experi√™ncia.  No momento, trabalho na EPAM Systems (SPB) e me aprofundo nas tecnologias que usamos.  Muitas vezes tenho que lidar com a primavera, e vejo nela um meio-termo no qual voc√™ pode crescer (Java todo mundo sabe t√£o bem, e ferramentas e tecnologias espec√≠ficas demais podem ir e vir). <br><br>  H√° alguns meses, passei na certifica√ß√£o Spring Professional v5.0 (sem fazer cursos).  Depois disso, pensei em como ensinar outras pessoas a saltar.  Infelizmente, no momento n√£o existe uma metodologia de ensino eficaz.  A maioria dos desenvolvedores tem uma id√©ia muito superficial da estrutura e seus recursos.  Depurar as fontes da primavera √© muito dif√≠cil e absolutamente n√£o √© eficaz do ponto de vista do treinamento (eu gostava disso).  Fa√ßa 10 projetos?  Sim, voc√™ pode aprofundar seu conhecimento em algum lugar e obter muita experi√™ncia pr√°tica, mas muito do que est√° ‚Äúescondido‚Äù nunca ser√° aberto antes de voc√™.  Leia Primavera em a√ß√£o?  Legal, mas caro no esfor√ßo.  Eu trabalhei 40% (durante a prepara√ß√£o para a certifica√ß√£o), mas n√£o foi f√°cil. <br><br>  A √∫nica maneira de entender algo at√© o fim √© desenvolv√™-lo voc√™ mesmo.  Recentemente, tive a ideia de que voc√™ pode liderar uma pessoa atrav√©s de um tutorial interessante que supervisionar√° o desenvolvimento de sua estrutura de DI.  Sua principal caracter√≠stica ser√° que a API coincidir√° com a API que est√° sendo estudada.  A grandiosidade dessa abordagem √© que, al√©m de uma compreens√£o profunda (sem espa√ßos) da primavera, uma pessoa ter√° uma enorme quantidade de experi√™ncia no Java Core.  Francamente, eu pr√≥prio aprendi muitas coisas novas durante a prepara√ß√£o do artigo, tanto no Spring quanto no Java Core.  Vamos come√ßar a desenvolver! <br><br><h2>  Projeto do zero </h2><br>  Portanto, a primeira coisa a fazer √© abrir seu IDE favorito e criar um projeto a partir do zero.  N√£o conectaremos nenhum Maven ou qualquer biblioteca de terceiros.  N√≥s nem vamos conectar as depend√™ncias do Spring.  Nosso objetivo √© desenvolver uma API que seja mais semelhante √† API Spring e implement√°-la. <br><br>  Em um projeto limpo, crie 2 pacotes principais.  O primeiro pacote √© seu aplicativo ( <code>com.kciray</code> ) e a classe <code>Main.java</code> dentro dele.  O segundo pacote √© org.springframework.  Sim, duplicaremos a estrutura do pacote da mola original, o nome de suas classes e seus m√©todos.  H√° um efeito t√£o interessante - quando voc√™ cria algo pr√≥prio, esse come√ßa a parecer simples e compreens√≠vel.  Ent√£o, quando voc√™ trabalha em grandes projetos, parece que tudo √© criado l√° com base na sua pe√ßa de trabalho.  Essa abordagem pode ter um efeito muito positivo na compreens√£o do sistema como um todo, aprimorando-o, corrigindo bugs, resolvendo problemas e assim por diante. <br><br>  Se voc√™ tiver algum problema, pode <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">fazer um</a> projeto em funcionamento <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> . <br><br><h2>  Crie um container </h2><br>  Para come√ßar, defina a tarefa.  Suponha que tenhamos 2 classes - <code>ProductFacade</code> e <code>PromotionService</code> .  Agora imagine que voc√™ deseja conectar essas classes entre si, mas para que as pr√≥prias classes n√£o se conhe√ßam (Padr√£o DI).  Precisamos de uma classe separada que gerencie todas essas classes e determine as depend√™ncias entre elas.  Vamos chamar de cont√™iner.  Vamos criar a classe <code>Container</code> ... Embora n√£o, espere!  O Spring n√£o possui uma √∫nica classe de cont√™iner.  Temos muitas implementa√ß√µes de cont√™ineres, e todas essas implementa√ß√µes podem ser divididas em 2 tipos - f√°bricas e contextos.  A f√°brica de caixas cria beans e os vincula (inje√ß√£o de depend√™ncia, DI), e o contexto faz o mesmo, al√©m de adicionar alguns recursos adicionais (por exemplo, internacionalizar mensagens).  Mas como n√£o precisamos dessas fun√ß√µes adicionais agora, trabalharemos com a f√°brica de lixeiras. <br><br>  Crie uma nova classe <code>BeanFactory</code> e coloque-a no pacote <code>org.springframework.beans.factory</code> .  Deixe os <code>Map&lt;String, Object&gt; singletons</code> armazenados dentro dessa classe, na qual o <code>id</code> compartimento √© mapeado para o pr√≥prio compartimento.  Adicione a ele o <code>Object getBean(String beanName)</code> , que extrai os beans pelo identificador. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BeanFactory</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Map&lt;String, Object&gt; singletons = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashMap(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Object </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getBean</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String beanName)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> singletons.get(beanName); } }</code> </pre> <br>  Observe que <code>BeanFactory</code> e <code>FactoryBean</code> s√£o duas coisas diferentes.  A primeira √© a f√°brica de lixeiras (cont√™iner) e a segunda √© a f√°brica de lixeiras, que fica dentro do cont√™iner e tamb√©m produz caixas.  F√°brica dentro da f√°brica.  Se voc√™ estiver confuso entre essas defini√ß√µes, lembre-se de que em ingl√™s o segundo substantivo √© o principal e o primeiro √© algo como um adjetivo.  Na <b>F√°brica de</b> Feij√£o <b>, a</b> palavra principal √© a f√°brica, e na F√°brica de <b>Feij√£o</b> , o feij√£o. <br><br>  Agora, crie as classes <code>ProductService</code> e <code>PromotionsService</code> .  <code>ProductService</code> retornar√° o produto do banco de dados, mas antes disso voc√™ precisar√° verificar se h√° descontos (Promo√ß√µes) aplic√°veis ‚Äã‚Äãa este produto.  No com√©rcio eletr√¥nico, o trabalho com desconto geralmente √© alocado para uma classe de servi√ßo separada (e √†s vezes para um servi√ßo da web de terceiros). <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PromotionsService</span></span></span><span class="hljs-class"> </span></span>{ } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ProductService</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> PromotionsService promotionsService; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> PromotionsService </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getPromotionsService</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> promotionsService; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setPromotionsService</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(PromotionsService promotionsService)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.promotionsService = promotionsService; } }</code> </pre><br>  Agora precisamos fazer nosso cont√™iner ( <code>BeanFactory</code> ) detectar nossas classes, cri√°-las para n√≥s e injetar uma na outra.  Opera√ß√µes como o <code>new ProductService()</code> devem estar localizadas dentro do cont√™iner e feitas pelo desenvolvedor.  Vamos usar a abordagem mais moderna (digitaliza√ß√£o de classe e anota√ß√µes).  Para fazer isso, precisamos criar uma anota√ß√£o <code>@Component</code> com as <code>@Component</code> ( <code> org.springframework.beans.factory.stereotype</code> ). <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Retention</span></span>(RetentionPolicy.RUNTIME) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-meta"><span class="hljs-meta">@interface</span></span> Component { }</code> </pre><br>  Por padr√£o, as anota√ß√µes n√£o s√£o carregadas na mem√≥ria enquanto o programa est√° em execu√ß√£o ( <code>RetentionPolicy.CLASS</code> ).  Alteramos esse comportamento por meio de uma nova pol√≠tica de reten√ß√£o ( <code>RetentionPolicy.RUNTIME</code> ). <br><br>  Agora adicione <code>@Component</code> antes das classes <code>ProductService</code> e antes do <code>PromotionService</code> . <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Component</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ProductService</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//... } @Component public class PromotionService { //... }</span></span></code> </pre> <br><br>  Precisamos do <code>BeanFactory</code> escanear nosso pacote ( <code>com.kciray</code> ) e encontrar classes nele anotadas por <code>@Component</code> .  Esta tarefa est√° longe de ser trivial.  N√£o existe <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">uma solu√ß√£o pronta</a> no Java Core, e teremos que fazer uma muleta.  Milhares de aplica√ß√µes de molas usam a digitaliza√ß√£o de componentes nessa muleta.  Voc√™ aprendeu a terr√≠vel verdade.  Voc√™ ter√° que extrair os nomes de <code>ClassLoader</code> do <code>ClassLoader</code> e verificar <code>ClassLoader</code> eles terminam com ".class" ou n√£o, e ent√£o criar seu nome completo e extrair objetos de classe! <br><br>  Quero avisar imediatamente que haver√° muitas exce√ß√µes verificadas, portanto, esteja preparado para quebr√°-las.  Mas primeiro, vamos decidir o que queremos.  Queremos adicionar um m√©todo especial ao <code>BeanFactory</code> e cham√°-lo em <code>Main</code> : <br><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">//BeanFactory.java public class BeanFactory{ public void instantiate(String basePackage) { } } //Main.java BeanFactory beanFactory = new BeanFactory(); beanFactory.instantiate("com.kciray");</span></span></code> </pre><br>  Em seguida, precisamos obter o <code>ClassLoader</code> .  Ele √© respons√°vel pelo carregamento de classes e √© extra√≠do de maneira simples: <br><br><pre> <code class="java hljs">ClassLoader classLoader = ClassLoader.getSystemClassLoader();</code> </pre> <br>  Voc√™ provavelmente j√° percebeu que os pacotes s√£o separados por um ponto e os arquivos por uma barra.  Precisamos converter o caminho do lote para o caminho da pasta e obter algo como <code>List&lt;URL&gt;</code> (os caminhos no seu sistema de arquivos onde voc√™ pode procurar por arquivos de classe). <br><br><pre> <code class="java hljs">String path = basePackage.replace(<span class="hljs-string"><span class="hljs-string">'.'</span></span>, <span class="hljs-string"><span class="hljs-string">'/'</span></span>); <span class="hljs-comment"><span class="hljs-comment">//"com.kciray" -&gt; "com/kciray" Enumeration&lt;URL&gt; resources = classLoader.getResources(path);</span></span></code> </pre> <br>  Ent√£o espere um momento!  <code>Enumeration&lt;URL&gt;</code> n√£o √© uma <code>List&lt;URL&gt;</code> .  O que √© isso tudo?  Ah, horror, esse √© o antigo progenitor do <code>Iterator</code> , dispon√≠vel desde o Java 1.0.  √â com esse legado que devemos lidar.  Se for poss√≠vel percorrer o <code>Iterable</code> usando for (todas as cole√ß√µes o implementam), no caso de <code>Enumeration</code> voc√™ precisar√° fazer um desvio de identificador, atrav√©s de <code>while(resources.hasMoreElements())</code> e <code>nextElement()</code> .  E, no entanto, n√£o h√° como remover itens da cole√ß√£o.  Apenas 1996, apenas hardcore.  Ah, sim, no Java 9 eles adicionaram o m√©todo <code>Enumeration.asIterator()</code> , para que voc√™ possa trabalhar com ele. <br><br>  Vamos mais longe.  Precisamos extrair as pastas e trabalhar com o conte√∫do de cada uma delas.  Converta o URL em um arquivo e obtenha seu nome.  Deve-se notar aqui que n√£o verificaremos pacotes aninhados para n√£o complicar o c√≥digo.  Voc√™ pode complicar sua tarefa e fazer uma recurs√£o, se desejar. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (resources.hasMoreElements()) { URL resource = resources.nextElement(); File file = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> File(resource.toURI()); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(File classFile : file.listFiles()){ String fileName = classFile.getName();<span class="hljs-comment"><span class="hljs-comment">//ProductService.class } }</span></span></code> </pre><br>  Em seguida, precisamos obter o nome do arquivo sem a extens√£o.  No estaleiro em 2018, o Java desenvolveu o File I / O (NIO 2) por muitos anos, mas ainda n√£o pode separar a extens√£o do nome do arquivo.  Eu tenho que criar minha pr√≥pria bicicleta, porque  decidimos n√£o usar bibliotecas de terceiros como o Apache Commons.  Vamos usar o antigo av√¥ como <code>lastIndexOf(".")</code> : <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(fileName.endsWith(<span class="hljs-string"><span class="hljs-string">".class"</span></span>)){ String className = fileName.substring(<span class="hljs-number"><span class="hljs-number">0</span></span>, fileName.lastIndexOf(<span class="hljs-string"><span class="hljs-string">"."</span></span>)); }</code> </pre> <br>  Em seguida, podemos obter o objeto de classe usando o nome completo da classe (para isso chamamos de classe da classe <code>Class</code> ): <br><br><pre> <code class="java hljs">Class classObject = Class.forName(basePackage + <span class="hljs-string"><span class="hljs-string">"."</span></span> + className);</code> </pre> <br>  Ok, agora nossas aulas est√£o em nossas m√£os.  Al√©m disso, resta apenas destacar entre eles aqueles que possuem a anota√ß√£o <code>@Component</code> : <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(classObject.isAnnotationPresent(Component.class)){ System.out.println(<span class="hljs-string"><span class="hljs-string">"Component: "</span></span> + classObject); }</code> </pre> <br>  Corra e verifique.  O console deve ser algo como isto: <br><br><pre> <code class="bash hljs">Component: class com.kciray.ProductService Component: class com.kciray.PromotionsService</code> </pre> <br>  Agora precisamos criar nosso bean.  Voc√™ precisa fazer algo como o <code>new ProductService()</code> , mas para cada bean, temos nossa pr√≥pria classe.  A reflex√£o em Java nos fornece uma solu√ß√£o universal (o construtor padr√£o √© chamado): <br><br><pre> <code class="java hljs">Object instance = classObject.newInstance();<span class="hljs-comment"><span class="hljs-comment">//=new CustomClass()</span></span></code> </pre> <br>  Em seguida, precisamos colocar esse bean nos <code>Map&lt;String, Object&gt; singletons</code> .  Para fazer isso, selecione o nome do bean (seu ID).  Em Java, chamamos vari√°veis ‚Äã‚Äãcomo classes (apenas a primeira letra √© min√∫scula).  Essa abordagem tamb√©m pode ser aplicada aos beans, porque o Spring √© uma estrutura Java!  Converta o nome da lixeira para que a primeira letra seja pequena e adicione-a ao mapa: <br><br><pre> <code class="java hljs">String beanName = className.substring(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>).toLowerCase() + className.substring(<span class="hljs-number"><span class="hljs-number">1</span></span>); singletons.put(beanName, instance);</code> </pre> <br>  Agora verifique se tudo funciona.  O cont√™iner deve criar beans e eles devem ser recuperados pelo nome.  Observe que o nome do seu m√©todo <code>instantiate()</code> e o nome do m√©todo <code>classObject.newInstance();</code>  tem uma raiz comum.  Al√©m disso, <code>instantiate()</code> faz parte do ciclo de vida do feij√£o.  Em Java, tudo est√° interconectado! <br><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">//Main.java BeanFactory beanFactory = new BeanFactory(); beanFactory.instantiate("com.kciray"); ProductService productService = (ProductService) beanFactory.getBean("productService"); System.out.println(productService);//ProductService@612</span></span></code> </pre> <br><br>  Tente tamb√©m implementar a anota√ß√£o <code>org.springframework.beans.factory.stereotype.Service</code> .  Ele executa exatamente a mesma fun√ß√£o que o <code>@Component</code> , mas √© chamado de maneira diferente.  O ponto principal est√° no nome - voc√™ demonstra que a classe √© um servi√ßo, n√£o apenas um componente.  Isso √© algo como digita√ß√£o conceitual.  Na certifica√ß√£o da primavera, houve a pergunta "Quais anota√ß√µes s√£o estereotipadas?"  (dos listados). ‚Äù  Portanto, anota√ß√µes estereotipadas s√£o aquelas que est√£o no pacote de <code>stereotype</code> . <br><br><h2>  Preencha as propriedades </h2><br>  Veja o diagrama abaixo, que mostra o in√≠cio do ciclo de vida do feij√£o.  O que fizemos antes disso √© o Instantiate (criando beans atrav√©s de <code>newInstance()</code> ).  O pr√≥ximo passo √© a inje√ß√£o cruzada de feij√£o (inje√ß√£o de depend√™ncia, √© tamb√©m a invers√£o de controle (IoC)).  Voc√™ precisa examinar as propriedades dos beans e entender quais propriedades voc√™ precisa injetar.  Se voc√™ chamar <code>productService.getPromotionsService()</code> , ser√° <code>null</code> porque  depend√™ncia ainda n√£o adicionada. <br><br><img src="https://habrastorage.org/webt/2i/4v/4c/2i4v4cbsb-bdpdrgb0grh_swclu.png"><br><br>  Primeiro, crie o pacote <code>org.springframework.beans.factory.annotation</code> e adicione a anota√ß√£o <code>@Autowired</code> .  A id√©ia √© sinalizar campos que s√£o depend√™ncias com esta anota√ß√£o. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Retention</span></span>(RetentionPolicy.RUNTIME) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-meta"><span class="hljs-meta">@interface</span></span> Autowired { }</code> </pre> <br>  Em seguida, adicione-o √† propriedade: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Component</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ProductService</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> PromotionsService promotionsService; <span class="hljs-comment"><span class="hljs-comment">//... }</span></span></code> </pre> <br>  Agora precisamos ensinar nosso <code>BeanFactory</code> encontrar essas anota√ß√µes e injetar depend√™ncias nelas.  Adicione um m√©todo separado para isso e chame-o de <code>Main</code> : <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BeanFactory</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//... public void populateProperties(){ System.out.println("==populateProperties=="); } }</span></span></code> </pre> <br>  Em seguida, precisamos apenas examinar todos os nossos compartimentos no mapa de <code>singletons</code> e, para cada compartimento, todos os seus campos ( <code>object.getClass().getDeclaredFields()</code> retorna todos os campos, incluindo os privados).  E verifique se o campo possui uma anota√ß√£o <code>@Autowired</code> : <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (Object object : singletons.values()) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (Field field : object.getClass().getDeclaredFields()) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (field.isAnnotationPresent(Autowired.class)) { } } }</code> </pre> <br>  Em seguida, precisamos examinar todas as caixas mais uma vez e ver seu tipo - de repente, esse √© o tipo que nossa lixeira quer usar por si mesma.  Sim, temos um ciclo tridimensional! <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (Object dependency : singletons.values()) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (dependency.getClass().equals(field.getType())) { } }</code> </pre> <br>  Al√©m disso, quando encontramos o v√≠cio, precisamos injet√°-lo.  A primeira coisa que voc√™ pode pensar √© escrever o campo <code>promotionsService</code> usando a reflex√£o diretamente.  Mas a primavera n√£o funciona assim.  Afinal, se o campo tiver um modificador <code>private</code> , primeiro precisaremos defini-lo como <code>public</code> , depois escreva nosso valor e, em seguida, defina- <code>private</code> novamente como <code>private</code> (para manter a integridade).  Parece uma muleta grande.  Em vez de uma muleta grande, vamos fazer uma muleta pequena (formaremos o nome do levantador e o chamaremos): <br><br><pre> <code class="java hljs">String setterName = <span class="hljs-string"><span class="hljs-string">"set"</span></span> + field.getName().substring(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>).toUpperCase() + field.getName().substring(<span class="hljs-number"><span class="hljs-number">1</span></span>);<span class="hljs-comment"><span class="hljs-comment">//setPromotionsService System.out.println("Setter name = " + setterName); Method setter = object.getClass().getMethod(setterName, dependency.getClass()); setter.invoke(object, dependency);</span></span></code> </pre> <br>  Agora execute seu projeto e certifique-se de que, ao chamar <code>productService.getPromotionsService()</code> vez de <code>null</code> , nosso bean seja retornado. <br><br>  O que implementamos √© a inje√ß√£o por tipo.  Tamb√©m h√° uma inje√ß√£o pelo nome (anota√ß√£o <code>javax.annotation.Resource</code> ).  √â diferente porque, em vez do tipo do campo, seu nome ser√° extra√≠do e, de acordo com ele - a depend√™ncia do mapa.  Tudo √© semelhante aqui, mesmo em algo mais simples.  Eu recomendo que voc√™ experimente e crie seu pr√≥prio bean, injete-o com <code>@Resource</code> e estenda o m√©todo <code>populateProperties()</code> . <br><br><h2>  Apoiamos beans que sabem sobre seu nome </h2><br><img src="https://habrastorage.org/webt/ds/ge/nn/dsgennl2rvz-spa6h51l_yox81o.png"><br><br>  H√° momentos em que voc√™ precisa colocar o nome dele dentro da lixeira.  Essa necessidade n√£o surge frequentemente, porque  caixas, em ess√™ncia, n√£o devem saber um sobre o outro e que s√£o caixas.  Nas primeiras vers√µes da primavera, foi assumido que o bean √© um POJO (Plain Old Java Objec, o bom e antigo objeto Java) e toda a configura√ß√£o √© renderizada em arquivos XML e separada da implementa√ß√£o.  Mas implementamos essa funcionalidade, pois a inje√ß√£o de nome faz parte do ciclo de vida da lixeira. <br><br>  Como sabemos qual bean quer saber qual √© o nome dele e o que ele n√£o quer?  A primeira coisa que vem √† mente √© fazer uma nova anota√ß√£o do tipo <code>@InjectName</code> e esculpir em campos do tipo String.  Mas essa solu√ß√£o ser√° muito geral e permitir√° que voc√™ se atire v√°rias vezes (coloque essa anota√ß√£o em campos de tipos inapropriados (n√£o String) ou tente inserir um nome em v√°rios campos da mesma classe).  Existe outra solu√ß√£o, mais precisa - para criar uma interface especial com um m√©todo de incuba√ß√£o.  Todos os compartimentos que o implementam recebem seu nome.  Crie a classe <code>BeanNameAware</code> no pacote <code>org.springframework.beans.factory</code> : <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BeanNameAware</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setBeanName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String name)</span></span></span></span>; }</code> </pre> <br>  Em seguida, permita que o nosso <code>PromotionsService</code> implemente: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Component</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PromotionsService</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BeanNameAware</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String beanName; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setBeanName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String name)</span></span></span><span class="hljs-function"> </span></span>{ beanName = name; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getBeanName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> beanName; } }</code> </pre> <br>  E, finalmente, adicione um novo m√©todo √† f√°brica de feij√£o.  Tudo √© simples aqui - examinamos nosso bin-singleton, verificamos se o bin implementa nossa interface e chamamos o setter: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">injectBeanNames</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (String name : singletons.keySet()) { Object bean = singletons.get(name); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(bean <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> BeanNameAware){ ((BeanNameAware) bean).setBeanName(name); } } }</code> </pre> <br>  Execute e verifique se tudo funciona: <br><br><pre> <code class="java hljs">BeanFactory beanFactory = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BeanFactory(); beanFactory.instantiate(<span class="hljs-string"><span class="hljs-string">"com.kciray"</span></span>); beanFactory.populateProperties(); beanFactory.injectBeanNames(); <span class="hljs-comment"><span class="hljs-comment">//... System.out.println("Bean name = " + promotionsService.getBeanName());</span></span></code> </pre><br>  Note-se que na primavera existem outras interfaces semelhantes.  Eu recomendo que voc√™ implemente a interface <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">BeanFactoryAware</a> , que permite que os beans recebam um link para a f√°brica de beans.  √â implementado de maneira semelhante. <br><br><h2>  Inicializar Beans </h2><br><img src="https://habrastorage.org/webt/yq/0w/5t/yq0w5t8x0kqrgqwllfuxsi77xug.png"><br><br>  Imagine que voc√™ tem uma situa√ß√£o em que precisa executar algum c√≥digo ap√≥s as depend√™ncias serem injetadas (as propriedades da bandeja s√£o definidas).  Em termos simples, precisamos dar √† lixeira a capacidade de se inicializar.  Como alternativa, podemos criar uma interface <code>InitializingBean</code> e colocar a assinatura do m√©todo <code>void afterPropertiesSet()</code> nela.  A implementa√ß√£o desse mecanismo √© exatamente a mesma apresentada para a interface <code>BeanNameAware</code> , portanto, a solu√ß√£o est√° sob o spoiler.  Pratique e fa√ßa voc√™ mesmo em um minuto: <br><br><div class="spoiler">  <b class="spoiler_title">Solu√ß√£o de Inicializa√ß√£o do Bean</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">//InitializingBean.java package org.springframework.beans.factory; public interface InitializingBean { void afterPropertiesSet(); } //BeanFactory.java public void initializeBeans(){ for (Object bean : singletons.values()) { if(bean instanceof InitializingBean){ ((InitializingBean) bean).afterPropertiesSet(); } } } //Main.java beanFactory.initializeBeans();</span></span></code> </pre> <br></div></div><br><br><h2>  Adicionando p√≥s-processadores </h2><br>  Imagine-se no lugar dos primeiros desenvolvedores da primavera.  Sua estrutura est√° crescendo e √© muito popular entre os desenvolvedores; cartas s√£o enviadas diariamente para o correio com solicita√ß√µes para adicionar um ou outro recurso √∫til.  Se, para cada um desses recursos, voc√™ adicionar sua pr√≥pria interface e verificar o ciclo de vida do bean, ele (o ciclo de vida) ficar√° entupido com informa√ß√µes desnecess√°rias.  Em vez disso, podemos criar uma interface universal que nos permita adicionar alguma l√≥gica (absolutamente qualquer, esteja ela verificando anota√ß√µes, substituindo a bandeja por outra, definindo algumas propriedades especiais e assim por diante). <br><br>  Vamos pensar sobre o que √© essa interface.  Ele precisa fazer algum p√≥s-processamento dos beans, portanto, pode ser chamado de BeanPostProcessor.  Mas estamos diante de uma pergunta dif√≠cil - quando a l√≥gica deve ser seguida?  Afinal, podemos execut√°-lo antes da inicializa√ß√£o, mas podemos execut√°-lo depois.  Para algumas tarefas, a primeira op√ß√£o √© melhor, para outras - a segunda ... Como ser? <br><br>  Podemos ativar as duas op√ß√µes ao mesmo tempo.  Deixe um p√≥s-processador transportar duas l√≥gicas, dois m√©todos.  Um √© executado antes da inicializa√ß√£o (antes do m√©todo <code>afterPropertiesSet()</code> ) e o outro depois.  Agora, vamos pensar nos pr√≥prios m√©todos - quais par√¢metros eles devem ter?  Obviamente, o pr√≥prio <code>Object bean</code> ( <code>Object bean</code> ) deve estar l√°.  Por conveni√™ncia, al√©m do bean, voc√™ pode passar o nome desse bean.  Voc√™ se lembra que o pr√≥prio compartimento n√£o sabe sobre o seu nome.  E n√£o queremos for√ßar todos os beans a implementar a interface BeanNameAware.  Mas, no n√≠vel p√≥s-processador, o nome do bean pode ser muito √∫til.  Portanto, n√≥s o adicionamos como o segundo par√¢metro. <br><br>  E o que o m√©todo deve retornar ao p√≥s-processamento do bean?  Vamos fazer com que ele devolva a lixeira.  Isso nos d√° uma super flexibilidade, porque em vez de uma lixeira, voc√™ pode colocar um objeto proxy que encerra suas chamadas (e adiciona seguran√ßa).  Ou voc√™ pode retornar completamente outro objeto recriando a bandeja novamente.  Os desenvolvedores t√™m uma grande liberdade de a√ß√£o.  Abaixo est√° a vers√£o final da interface projetada: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> org.springframework.beans.factory.config; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BeanPostProcessor</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-function">Object </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">postProcessBeforeInitialization</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Object bean, String beanName)</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">Object </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">postProcessAfterInitialization</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Object bean, String beanName)</span></span></span></span>; }</code> </pre> <br>  Em seguida, precisamos adicionar uma lista de processadores simples √† nossa f√°brica de beans e a capacidade de adicionar novos.  Sim, este √© um ArrayList regular. <br><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">//BeanFactory.java private List&lt;BeanPostProcessor&gt; postProcessors = new ArrayList&lt;&gt;(); public void addPostProcessor(BeanPostProcessor postProcessor){ postProcessors.add(postProcessor); }</span></span></code> </pre> <br>  Agora mude o m√©todo <code>initializeBeans</code> para levar em conta os p√≥s-processadores: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initializeBeans</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (String name : singletons.keySet()) { Object bean = singletons.get(name); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (BeanPostProcessor postProcessor : postProcessors) { postProcessor.postProcessBeforeInitialization(bean, name); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (bean <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> InitializingBean) { ((InitializingBean) bean).afterPropertiesSet(); } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (BeanPostProcessor postProcessor : postProcessors) { postProcessor.postProcessAfterInitialization(bean, name); } } }</code> </pre> <br>  Vamos criar um pequeno p√≥s-processador que simplesmente rastreia as chamadas para o console e adicione-o √† nossa f√°brica de feij√£o: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CustomPostProcessor</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BeanPostProcessor</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Object </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">postProcessBeforeInitialization</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Object bean, String beanName)</span></span></span><span class="hljs-function"> </span></span>{ System.out.println(<span class="hljs-string"><span class="hljs-string">"---CustomPostProcessor Before "</span></span> + beanName); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> bean; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Object </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">postProcessAfterInitialization</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Object bean, String beanName)</span></span></span><span class="hljs-function"> </span></span>{ System.out.println(<span class="hljs-string"><span class="hljs-string">"---CustomPostProcessor After "</span></span> + beanName); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> bean; } }</code> </pre> <br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">//Main.java BeanFactory beanFactory = new BeanFactory(); beanFactory.addPostProcessor(new CustomPostProcessor());</span></span></code> </pre> <br><br>  Agora execute e verifique se tudo funciona.  Como tarefa de treinamento, crie um p√≥s-processador que fornecer√° a anota√ß√£o <code>@PostConstruct (javax.annotation.PostConstruct)</code> .  Ele fornece uma maneira alternativa de inicializar (enraizada em Java, n√£o na primavera).  Sua ess√™ncia √© que voc√™ coloca a anota√ß√£o em algum m√©todo, e esse m√©todo ser√° chamado ANTES da inicializa√ß√£o padr√£o da primavera (InitializingBean). <br><br>  Certifique-se de criar todas as anota√ß√µes e pacotes (mesmo javax.annotation) manualmente, n√£o conecte as depend√™ncias!  Isso ajudar√° voc√™ a ver a diferen√ßa entre o n√∫cleo da mola e suas extens√µes (suporte a javax), e lembre-se disso.  Isso manter√° um estilo no futuro. <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Voc√™ estar√° interessado no fato de que, em uma primavera real, a anota√ß√£o </font></font><code>@PostConstruct</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√© implementada dessa maneira, por meio do CommonAnnotationBeanPostProcessor do p√≥s-processador. </font><font style="vertical-align: inherit;">Mas n√£o espie l√°, escreva sua implementa√ß√£o. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por fim, recomendo que voc√™ adicione um m√©todo </font></font><code>void close()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√† classe </font></font><code>BeanFactory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e elabore mais dois mecanismos. </font><font style="vertical-align: inherit;">A primeira √© uma anota√ß√£o </font></font><code>@PreDestroy (javax.annotation.PreDestroy)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, destinada a m√©todos que devem ser chamados quando o cont√™iner √© fechado. </font><font style="vertical-align: inherit;">O segundo √© a interface </font></font><code>org.springframework.beans.factory.DisposableBean</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que cont√©m o m√©todo </font></font><code>void destroy()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Todos os compartimentos executando esta interface ter√£o a capacidade de se destruir (liberar recursos, por exemplo).</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@PreDestroy + DisposableBean</font></font></b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">//DisposableBean.java package org.springframework.beans.factory; public interface DisposableBean { void destroy(); } //PreDestroy.java package javax.annotation; import java.lang.annotation.Retention; import java.lang.annotation.RetentionPolicy; @Retention(RetentionPolicy.RUNTIME) public @interface PreDestroy { } //DisposableBean.java public void close() { for (Object bean : singletons.values()) { for (Method method : bean.getClass().getMethods()) { if (method.isAnnotationPresent(PreDestroy.class)) { try { method.invoke(bean); } catch (IllegalAccessException e) { e.printStackTrace(); } catch (InvocationTargetException e) { e.printStackTrace(); } } } if (bean instanceof DisposableBean) { ((DisposableBean) bean).destroy(); } } }</span></span></code> </pre> <br></div></div><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ciclo de vida completo do feij√£o </font></font></h2><img src="https://habrastorage.org/webt/ns/uh/lk/nsuhlk9ko9d9gxtzmcytopfruim.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por isso, implementamos o ciclo de vida completo da lixeira, em sua forma moderna. </font><font style="vertical-align: inherit;">Espero que essa abordagem ajude voc√™ a se lembrar dela.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Nosso contexto favorito </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Os programadores costumam usar o termo contexto, mas nem todos entendem o que realmente significa. </font><font style="vertical-align: inherit;">Agora vamos colocar tudo em ordem. </font><font style="vertical-align: inherit;">Como observei no in√≠cio do artigo, o contexto √© a implementa√ß√£o do cont√™iner, assim como </font></font><code>BeanFactory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Mas, al√©m das fun√ß√µes b√°sicas (DI), ele ainda adiciona alguns recursos interessantes. </font><font style="vertical-align: inherit;">Um desses recursos √© o envio e o processamento de eventos entre os compartimentos. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O artigo acabou sendo muito grande e o conte√∫do come√ßou a ser cortado, ent√£o coloquei as informa√ß√µes de contexto embaixo do spoiler.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Percebemos o contexto</font></font></b> <div class="spoiler_text">    .   <code>org.springframework.context</code> ,   <code>ApplicationContext</code>  .        <code>BeanFactory</code> .      ,      <code>close()</code> . <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ApplicationContext</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> BeanFactory beanFactory = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BeanFactory(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ApplicationContext</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String basePackage)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> ReflectiveOperationException</span></span>{ System.out.println(<span class="hljs-string"><span class="hljs-string">"******Context is under construction******"</span></span>); beanFactory.instantiate(basePackage); beanFactory.populateProperties(); beanFactory.injectBeanNames(); beanFactory.initializeBeans(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">close</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ beanFactory.close(); } }</code> </pre> <br><br>     <code>Main</code> ,   ,   : <br><br><pre> <code class="java hljs">ApplicationContext applicationContext = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ApplicationContext(<span class="hljs-string"><span class="hljs-string">"com.kciray"</span></span>); applicationContext.close();</code> </pre> <br>   ,   .       <code>close()</code> ,     ¬´ ¬ª     - .   ,   : <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> org.springframework.context.event; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ContextClosedEvent</span></span></span><span class="hljs-class"> </span></span>{ }</code> </pre> <br>      <code>ApplicationListener</code> ,      .        ,          ( <code>ApplicationListener&lt;E&gt;</code> ). ,    Java-,         . ,      ,    : <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> org.springframework.context; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ApplicationListener</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">E</span></span></span><span class="hljs-class">&gt;</span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onApplicationEvent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(E event)</span></span></span></span>; }</code> </pre> <br>     <code>ApplicationContext</code> .     <code>close()</code>     ,  ,      .    <code>ApplicationListener&lt;ContextClosedEvent&gt;</code> ,     <code>onApplicationEvent(ContextClosedEvent)</code> .    ,   ? <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">close</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ beanFactory.close(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(Object bean : beanFactory.getSingletons().values()) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (bean <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> ApplicationListener) { } } }</code> </pre> <br>  Mas n√£o.   .       <code>bean instanceof ApplicationListener&lt;ContextClosedEvent&gt;</code> .      Java.      <i>  (type erasure)</i> ,    &lt;T&gt;   &lt;Object&gt;.   ,   ?    ,    <code>ApplicationListener&lt;ContextClosedEvent&gt;</code> ,     ? <br><br>   ,       ,       .  ,      ,    ,     ,   : <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (Type type: bean.getClass().getGenericInterfaces()){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(type <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> ParameterizedType){ ParameterizedType parameterizedType = (ParameterizedType) type; } }</code> </pre> <br> ,       ,  ,   ‚Äî   .   ,         : <br><br><pre> <code class="java hljs">Type firstParameter = parameterizedType.getActualTypeArguments()[<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(firstParameter.equals(ContextClosedEvent.class)){ Method method = bean.getClass().getMethod(<span class="hljs-string"><span class="hljs-string">"onApplicationEvent"</span></span>, ContextClosedEvent.class); method.invoke(bean, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ContextClosedEvent()); }</code> </pre> <br>        ApplicationListener: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Service</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PromotionsService</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BeanNameAware</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ApplicationListener</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ContextClosedEvent</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//... @Override public void onApplicationEvent(ContextClosedEvent event) { System.out.println("&gt;&gt; ContextClosed EVENT"); } }</span></span></code> </pre> <br> ,     Main  ,    ,   : <br><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">//Main.java void testContext() throws ReflectiveOperationException{ ApplicationContext applicationContext = new ApplicationContext("com.kciray"); applicationContext.close(); }</span></span></code> </pre> <br></div></div><br><h2>  Conclus√£o </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inicialmente, planejei este artigo para o Baeldung em ingl√™s, mas depois pensei que o p√∫blico do Habr√© poderia avaliar positivamente essa abordagem do treinamento. </font><font style="vertical-align: inherit;">Se voc√™ gostou das minhas id√©ias, n√£o deixe de apoiar o artigo. </font><font style="vertical-align: inherit;">Se ela obtiver uma classifica√ß√£o superior a 30, prometo continuar. </font><font style="vertical-align: inherit;">Ao escrever o artigo, tentei mostrar exatamente o conhecimento do Spring Core, que √© mais frequentemente usado, e tamb√©m com base no </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Guia de Estudo de Certifica√ß√£o</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> do </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">Core Spring 5.0</font></a><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">No futuro, com a ajuda desses tutoriais, voc√™ poder√° cobrir toda a certifica√ß√£o e tornar a primavera mais acess√≠vel para os desenvolvedores Java.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Atualiza√ß√£o 05/10/2018 </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cartas constantemente me chegam com perguntas "e quando a continua√ß√£o estamos esperando por ele". </font><font style="vertical-align: inherit;">Mas n√£o h√° tempo, e outros projetos pessoais s√£o uma prioridade. </font><font style="vertical-align: inherit;">No entanto, se um de voc√™s realmente gostou da ideia, pode estudar a se√ß√£o estreita da primavera e escrever um artigo de continua√ß√£o. </font><font style="vertical-align: inherit;">Se voc√™ n√£o possui uma conta habr, posso publicar um artigo da minha conta ou ajud√°-lo a receber um convite. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Distribui√ß√£o de t√≥picos: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring Container - [nome de usu√°rio] </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring AOP - [nome de usu√°rio] </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring Web - [nome de usu√°rio] </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring Cloud - [nome de usu√°rio]</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt419679/">https://habr.com/ru/post/pt419679/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt419669/index.html">Dez melhores mouses para jogos para qualquer carteira</a></li>
<li><a href="../pt419671/index.html">Limita√ß√µes que precisam ser violadas ou como aceleramos os testes funcionais tr√™s vezes</a></li>
<li><a href="../pt419673/index.html">O universo primitivo 6. A din√¢mica de um universo em expans√£o homog√™neo, parte 2</a></li>
<li><a href="../pt419675/index.html">Avalia√ß√£o do aluguel por minuto de scooters el√©tricas em Moscou, ver√£o de 2018</a></li>
<li><a href="../pt419677/index.html">Como detectar o tr√°fego HTTPS de um dispositivo iOS</a></li>
<li><a href="../pt419683/index.html">O que as m√©tricas significam para equipes √°geis?</a></li>
<li><a href="../pt419685/index.html">As estruturas de dados mais importantes que voc√™ deve saber sobre sua entrevista de programa√ß√£o</a></li>
<li><a href="../pt419687/index.html">Teclado secreto n√≠vel 3 ou como imprimir um tra√ßo longo</a></li>
<li><a href="../pt419689/index.html">I. Desadapta√ß√£o. II TDAH ou um idiota pregui√ßoso?</a></li>
<li><a href="../pt419693/index.html">Mikrotik: reset, backups e DualBoot</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>