<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯзЭЁЯП╝ ЁЯзЦЁЯП╛ ЁЯСйтАНтЪХя╕П рдорд┐рдХреНрд░реЛрдЯрд┐рдХ рдФрд░ рдХреЗрд░рд┐рдпрд╛рдУ рдирд┐рдпрдВрддреНрд░рдг рдХреЗ рдмреАрдЪ IPSec рд╡реАрдкреАрдПрди рдХрдиреЗрдХреНрд╢рди тЫЕя╕П тЮ░ ЁЯЩОЁЯП┐</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рдкреНрд░рд╛рд░рдВрднрд┐рдХ рдкреИрд░рд╛рдореАрдЯрд░: 



1. рджреЛ рд╕реАрдорд╛ рд╕рдореАрдкрд╡рд░реНрддреА рдХреЗрд░рд┐рдпрд╛рдУ рдирд┐рдпрдВрддреНрд░рдг v.9.2.9 рдХреЗ рд╕рд╛рде рдЙрджреНрдпрдо рдХрд╛ рдкреНрд░рдзрд╛рди рдХрд╛рд░реНрдпрд╛рд▓рдп 3171 рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдХрд░рддрд╛ рд╣реИ (рдХреЗрд░рд┐рдУ рдХреЗ рдкреАрдЫреЗ рдПрдХ рд╕рд┐рд╕реНрдХреЛ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>рдорд┐рдХреНрд░реЛрдЯрд┐рдХ рдФрд░ рдХреЗрд░рд┐рдпрд╛рдУ рдирд┐рдпрдВрддреНрд░рдг рдХреЗ рдмреАрдЪ IPSec рд╡реАрдкреАрдПрди рдХрдиреЗрдХреНрд╢рди</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/439736/"><img src="https://habrastorage.org/webt/zg/b9/cd/zgb9cd1ivkh83waulyxllysswwe.png"><br><br>  рдкреНрд░рд╛рд░рдВрднрд┐рдХ рдкреИрд░рд╛рдореАрдЯрд░: <br><br><ol><li>  рджреЛ рд╕реАрдорд╛ рд╕рдореАрдкрд╡рд░реНрддреА рдХреЗрд░рд┐рдпрд╛рдУ рдирд┐рдпрдВрддреНрд░рдг v.9.2.9 рдХреЗ рд╕рд╛рде рдЙрджреНрдпрдо рдХрд╛ рдкреНрд░рдзрд╛рди рдХрд╛рд░реНрдпрд╛рд▓рдп 3171 рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдХрд░рддрд╛ рд╣реИ (рдХреЗрд░рд┐рдУ рдХреЗ рдкреАрдЫреЗ рдПрдХ рд╕рд┐рд╕реНрдХреЛ 3550 рд╕реНрд╡рд┐рдЪ рд╣реИ рдЬреЛ рдХрд╛рд░реНрдпрд╛рд▓рдп рдХреЗ рд╕реНрдерд╛рдиреАрдп рдиреЗрдЯрд╡рд░реНрдХ рдХреЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХреЛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рддрд╛ рд╣реИ)ред </li><li>  рдкреНрд░рддреНрдпреЗрдХ Kerio рдореЗрдВ рджреЛ рдЪреИрдирд▓ рд╣реИрдВ рдЬрд┐рдирдореЗрдВ ISP (рдЪрд┐рддреНрд░ рдореЗрдВ - ISP # 1 рдФрд░ ISP # 2) рдХрд╛ рд▓реЛрдб рд╕рдВрддреБрд▓рди рд╕реНрдерд┐рд░ рд╕рдлреЗрдж IP рдХреЗ рд╕рд╛рде рд╣реИред </li><li>  рджреВрд░рд╕реНрде рдХрд╛рд░реНрдпрд╛рд▓рдп рдХреА рдУрд░ рд╕реЗ, рдорд┐рдХреНрд░реЛрдЯрд┐рдХ 951G-2HnD (OS v.6.43.11) рд╕реНрдерд╛рдкрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред </li><li>  рджреЛ ISP рдорд┐рдХреНрд░реЛрдЯрд┐рдХ рдореЗрдВ рдЖрддреЗ рд╣реИрдВ (рдЖрд░реЗрдЦ рдореЗрдВ ISP # 3 рдФрд░ ISP # 4 рд╣реИрдВ)ред </li></ol><br>  рд▓реЗрдЦрди рдХреЗ рд╕рдордп, рдкреНрд░рдзрд╛рди рдХрд╛рд░реНрдпрд╛рд▓рдп рдФрд░ рджреВрд░рд╕реНрде рдХрд╛рд░реНрдпрд╛рд▓рдп рджреЛрдиреЛрдВ рдореЗрдВ, рдкреНрд░рджрд╛рддрд╛рдУрдВ рдХреЗ рд╕рд╛рде рд╕рдВрдмрдВрдз рдЬреБрдбрд╝рд╛рд╡ рдерд╛ред <br><br><h3>  рдХрд╛рд░реНрдпреЛрдВ рдХреА рд╕реВрдЪреА: </h3><br><ol><li>  MikroTik рдФрд░ Kerio рдирд┐рдпрдВрддреНрд░рдг рдХреЗ рдмреАрдЪ рдПрдХ IPSec рд╡реАрдкреАрдПрди рдХрдиреЗрдХреНрд╢рди рд╕реНрдерд╛рдкрд┐рдд рдХрд░реЗрдВ, рдЬрд╣рд╛рдВ MikroTik рдЖрд░рдВрднрдХрд░реНрддрд╛ рд╣реЛрдЧрд╛ред </li><li> рд╡реАрдкреАрдПрди рдХрдиреЗрдХреНрд╢рди рдХреА рдЧрд▓рддреА рд╕рд╣рдирд╢реАрд▓рддрд╛ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░реЗрдВ, рдЕрд░реНрдерд╛рддреНред  рдЗрд╕ рддрдереНрдп рдХреЗ рдЕрд▓рд╛рд╡рд╛ рдХрд┐ рдорд┐рдХреНрд░реЛрдЯрд┐рдХ рдХреЛ рдЕрдкрдиреЗ рдЖрдИрдПрд╕рдкреА ( <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдпрд╣рд╛рдВ</a></b> рд▓реЗрдЦ) рдХреЗ рдкреНрд░рджрд░реНрд╢рди рдХреА рдирд┐рдЧрд░рд╛рдиреА рдХрд░рдиреА рдЪрд╛рд╣рд┐рдП, рдЙрд╕реЗ рдкреНрд░рддреНрдпреЗрдХ рдХреЗрд░реАрдУ рд╕рд░реНрд╡рд░ рдХреА рдЙрдкрд▓рдмреНрдзрддрд╛ рдХреА рдирд┐рдЧрд░рд╛рдиреА рднреА рдХрд░рдиреА рдЪрд╛рд╣рд┐рдП рдФрд░ рдХрд┐рд╕ рдЪреИрдирд▓ (рдЬрд┐рд╕рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдХреЗрд░рд┐рдУ рд╕реЗ рдЖрдИрдПрд╕рдкреА) рддрдХ рдкрд╣реБрдВрдЪ рдХрд╛ рдирд┐рд░реНрдзрд╛рд░рдг рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред </li><li>  рдиреЗрдЯрд╡рд░реНрдХ рдкрддреЗ рдХреЛ рдмрджрд▓рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рдкреНрд░рджрд╛рди рдХрд░реЗрдВ, рдЬрд┐рд╕рдХреЗ рд╕рд╛рде рдорд┐рдХреНрд░реЛрдЯрд┐рдХ рдХреЗрд░рд┐рдпреЛ рд╕реЗ рдЬреБрдбрд╝рддрд╛ рд╣реИред  рдпрд╣ рдЗрд╕ рддрдереНрдп рдХреЗ рдХрд╛рд░рдг рд╣реИ рдХрд┐ рдХреЗрд░реАрдУ, рдФрд░ рд░рд╛рдЙрдЯрд░ рдирд╣реАрдВ, "рд╕реАрдорд╛" рдореБрдЦреНрдпрд╛рд▓рдп рдкрд░ рд╣реИрдВред </li></ol><a name="habracut"></a><br><br><h3>  рдЖрдЙрдЯрдкреБрдЯ рдкрд░ рд╣рдореЗрдВ рдХреНрдпрд╛ рдорд┐рд▓рддрд╛ рд╣реИ? </h3><br><ol><li>  рдЬрдм рдорд┐рдХреНрд░реЛрдЗрдЯрд┐рдХ (рд╢реЗрдбреНрдпреВрд▓рд╕реНрдЯрд╛рд░реНрдЯрдЕрдк) рд▓реЙрдиреНрдЪ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдПрдВрдЯрд░рдкреНрд░рд╛рдЗрдЬрд╝ рдиреЗрдЯрд╡рд░реНрдХ рдХреЗ рд▓рд┐рдП рдПрдХ рдЪреИрдирд▓ рдЖрдпреЛрдЬрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ (рдЪреИрдирд▓ рдорд┐рдХреНрд░реЛрдЯрд┐рдХ рджреНрд╡рд╛рд░рд╛ рд╢реБрд░реВ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛), рдПрдХ рджреВрд░рд╕реНрде рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдХреЗрд░реЛ рдХреНрд▓рд╛рдЗрдВрдЯ рд╢реБрд░реВ рдХрд░рдиреЗ рдФрд░ рдСрдкрд░реЗрдЯрд┐рдВрдЧ рд╕рд┐рд╕реНрдЯрдо рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдмрд┐рдирд╛ рдПрдХ рдЕрддрд┐рд░рд┐рдХреНрдд рд╡реАрдкреАрдПрди рдХрдиреЗрдХреНрд╢рди рд╕реНрдерд╛рдкрд┐рдд рдХрд┐рдП рдмрд┐рдирд╛ рдХреЙрд░реНрдкреЛрд░реЗрдЯ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ; </li><li>  рдорд┐рдХреНрд░реЛрдЯрд┐рдХ рдлреЗрд▓рдУрд╡рд░ рдХреЛ рд▓рд╛рдЧреВ рдХрд░реЗрдЧрд╛, рдЬреЛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдПрдХ рд▓рд╛рдЗрд╡ рдЖрдИрдПрд╕рдкреА рдкрд░ рд╕реНрд╡рд┐рдЪ рдХрд░рддрд╛ рд╣реИ; </li><li>  рдЖрдк рдХрд░рд┐рдпрд░ рдХрдВрдЯреНрд░реЛрд▓ рд╕реЗ рдХрдиреЗрдХреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдП рдЧрдП рд╕рд╛рдерд┐рдпреЛрдВ рдХреЗ рд╕рдВрдмрджреНрдзрддрд╛ рдХреЛ рдорд┐рдХреНрд░реЛрдЗрдЯрд┐рдХ рдореЗрдВ рдПрдХ рдпрд╛ рдХрд┐рд╕реА рдЕрдиреНрдп рдкреЙрд▓рд┐рд╕реА рдЯреЗрдореНрдкреНрд▓реЗрдЯ рд╕рдореВрд╣ рдореЗрдВ рдПрдХ рдпрд╛ рдЕрдиреНрдп рдкреЙрд▓рд┐рд╕реА рдЯреЗрдореНрдкреНрд▓реЗрдЯ рд╕рдореВрд╣ рдореЗрдВ рдмрджрд▓рдХрд░ рдкреНрд░рд╛рдердорд┐рдХрддрд╛рдПрдВ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ; </li><li>  рдорд┐рдХреНрд░реЛрдЯрд┐рдХ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ Kerio рдирд┐рдпрдВрддреНрд░рдг рд╕рд░реНрд╡рд░реЛрдВ рдХреЗ рдкреНрд░рджрд░реНрд╢рди рдХреА рдирд┐рдЧрд░рд╛рдиреА рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛрдЧрд╛, рдФрд░ рдпрджрд┐ рдкреНрд░рд╛рдердорд┐рдХрддрд╛ рдмрд┐рдВрджреБ рдХреЗ рд╕рд╛рде рдХрдиреЗрдХреНрд╢рди рдЯреВрдЯ рдЧрдпрд╛ рд╣реИ, рддреЛ рд╕реНрд╡рддрдВрддреНрд░ рд░реВрдк рд╕реЗ рд▓рд╛рдЗрд╡ рдЪреИрдирд▓ рдкрд░ рд╕реНрд╡рд┐рдЪ рдХрд░реЗрдВ; </li><li>  рдпрджрд┐ рдЖрдкрдХреЗ Kerio рдирд┐рдпрдВрддреНрд░рдг рд╕рд░реНрд╡рд░ рдмрд╛рд╣рд░реА DNS рд╕рд░реНрд╡рд░реЛрдВ рдкрд░ рдкреНрд░рдХрд╛рд╢рд┐рдд рд╣реЛрддреЗ рд╣реИрдВ, рддреЛ MikroTik рдЕрдкрдиреЗ рдЖрдИрдкреА рдкрддреЗ (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдпрджрд┐ рдЖрдкрдХрд╛ рдкреНрд░рджрд╛рддрд╛ рдмрджрд▓рддрд╛ рд╣реИ) рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрди рдХреЛ рдЯреНрд░реИрдХ рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛрдЧрд╛ рдФрд░ рд╕реНрд╡рддрдВрддреНрд░ рд░реВрдк рд╕реЗ рдЗрд╕рдХреЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдореЗрдВ рдмрджрд▓рд╛рд╡ рдХрд░реЗрдЧрд╛ (scriptSetIPSecSADstAddrFrDDNS)ред </li></ol><br><br>  рдореБрдЭреЗ рддреБрд░рдВрдд рдпрд╣ рдХрд╣рдирд╛ рд╣реЛрдЧрд╛ рдХрд┐ рдпрд╣ рд▓реЗрдЦ рдПрдХ рдЯреНрдпреВрдЯреЛрд░рд┐рдпрд▓ рдирд╣реАрдВ рд╣реИ (рд╕рд┐рджреНрдзрд╛рдВрдд рд░реВрдк рдореЗрдВ, рдореИрдВ рд░рд╛рдЙрдЯрд░реЛрдВ рд╕реЗ рдкрд░рд┐рдЪрд┐рдд рдерд╛ рдФрд░ рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдмрдирдиреЗ рд╕реЗ рдареАрдХ рджреЛ рдорд╣реАрдиреЗ рдкрд╣рд▓реЗ (2017 рдХреЗ рдЕрдВрдд рдореЗрдВ) рдорд┐рдХреНрд░реЛрдЗрдЯрд┐рдХ рдХреЗ рд╕рд╛рде) рдФрд░ рдпрд╣ рдкреНрд░рд╢реНрдиреЛрдВ рдХреЛ рд╕рдВрдмреЛрдзрд┐рдд рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИ "рдХреНрдпреЛрдВ?", рдпрд╣ рдпрд╣рд╛рдБ рд╣реЛрдЧрд╛ рдПрдХ рд╡рд╛рд╕реНрддрд╡рд┐рдХ рдЙрджреНрдпрдо рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рдорд┐рдХреНрд░реЛрдЯрд┐рдХ рдХреЗ рдХрд╛рд░реНрдп рд╡рд┐рдиреНрдпрд╛рд╕ рдХрд╛ рд╡рд┐рд╡рд░рдг рджрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред <br><br>  <b>рдиреЛрдЯ:</b> <br><ol><li>  рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЛрдб рдХреЛ рдмрдлрд░ рдореЗрдВ рдХреЙрдкреА рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдФрд░ рдмрдлрд░ рд╕реЗ рдЪрд┐рдкрдХрд╛рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ, рд░реВрд╕реА рднрд╛рд╖рд╛ рдХреА рдЯрд┐рдкреНрдкрдгрд┐рдпреЛрдВ рдХреЛ рдорд┐рдХреНрд░реЛрдЯрд┐рдХ рдореЗрдВ рд░рдЦрдиреЗ рдХреЗ рд▓рд┐рдП, рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░реЗрдВ рдХрд┐ рд░реВрд╕реА рдХреАрдмреЛрд░реНрдб рд▓реЗрдЖрдЙрдЯ рдЪрд╛рд▓реВ рд╣реИ; </li><li>  рдпрджрд┐ рдЖрдк рдкрд╛рддреЗ рд╣реИрдВ рдХрд┐ рд▓реЙрдЧрд┐рдВрдЧ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдмрд╣реБрдд рд╣реА рдХрдо рд╣реИ, рддреЛ рдЖрдк "рд▓реЙрдЧ рдЪреЗрддрд╛рд╡рдиреА" рдФрд░ "рд▓реЙрдЧ рддреНрд░реБрдЯрд┐" рдХреЗ рд╕рд╛рде рд▓рд╛рдЗрдиреЛрдВ рдХреЛ рд╣рдЯрд╛ рдпрд╛ рд╣рдЯрд╛ рд╕рдХрддреЗ рд╣реИрдВ; </li><li>  рдЖрдк рдХреЛрдб рдореЗрдВ "рд▓реЙрдЧ рдЪреЗрддрд╛рд╡рдиреА" рдФрд░ "рд▓реЙрдЧ рддреНрд░реБрдЯрд┐" рдЯрд┐рдкреНрдкрдгреА рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдпрд╣ рдЕрдВрдЧреНрд░реЗрдЬреА рдореЗрдВ рд▓реЙрдЧрд┐рдВрдЧ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рдХреЛ рдЬреЛрдбрд╝рдиреЗ рдХрд╛ рдПрдХ рдкреНрд░рдпрд╛рд╕ рд╣реИ ... </li></ol><br><br>  рддреЛ рдЪрд▓рд┐рдП рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВ: <br><br>  <b>рдореВрд▓ рдкреИрд░рд╛рдореАрдЯрд░:</b> <br><br><ol><li>  рдореВрд▓ рд╕рдВрдЧрдарди рдХрд╛ рдиреЗрдЯрд╡рд░реНрдХ (рдХреЗрд░реАрдУ рдХреЗ рдкреАрдЫреЗ) 192.168.77.0/24 рд╣реИ (рдпрд╣рд╛рдВ рд╣рдо рдЙрд╕ рдиреЗрдЯрд╡рд░реНрдХ рдХреЗ рдкрддреЗ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ рдЬрд╣рд╛рдВ рдХреЗрд░реАрдУ рдПрдВрдЯрд░рдкреНрд░рд╛рдЗрдЬрд╝ рдиреЗрдЯрд╡рд░реНрдХ рдореЗрдВ рд╕реНрдерд┐рдд рд╣реИ) </li><li>  рд╢рд╛рдЦрд╛ рдиреЗрдЯрд╡рд░реНрдХ (рдорд┐рдХреНрд░реЛрдЯрд┐рдХ рдХреЗ рдкреАрдЫреЗ) - 192.168.11.0/24 </li><li>  рдХреЗрд░рд┐рдУ рдХрдВрдЯреНрд░реЛрд▓ # 1 - 192.168.22.0/24 рд╕реЗ рдХрдиреЗрдХреНрдЯ рд╣реЛрдиреЗ рдкрд░ рд╢рд╛рдЦрд╛ рдиреЗрдЯрд╡рд░реНрдХ рдЬрд┐рд╕ рдиреЗрдЯрд╡рд░реНрдХ рдореЗрдВ рдореИрдк рдХрд░реЗрдЧрд╛ </li><li>  рдХреЗрд░рд┐рдпреЛ рдХрдВрдЯреНрд░реЛрд▓ # 2 - 192.168.33.0/24 рд╕реЗ рдХрдиреЗрдХреНрдЯ рд╣реЛрдиреЗ рдкрд░ рд╢рд╛рдЦрд╛ рдиреЗрдЯрд╡рд░реНрдХ рдореИрдк рдХрд░реЗрдЧрд╛ </li><li>  рдЖрдИрдПрд╕рдкреА # 1 рдкреВрд▓ (рдХреЗрд░рд┐рдУ # 1) рд╕реЗ рдЖрдИрдкреА рдкрддрд╛ - 11.11.11.111 </li><li>  рдЖрдИрдПрд╕рдкреА # 2 рдкреВрд▓ (рдХреЗрд░рд┐рдУ # 1) рд╕реЗ рдЖрдИрдкреА рдкрддрд╛ - 22.22.22.111 </li><li>  рдЖрдИрдПрд╕рдкреА # 1 рдкреВрд▓ (рдХреЗрд░рд┐рдУ # 2) рд╕реЗ рдЖрдИрдкреА рдкрддрд╛ - 11.11.11.222 </li><li>  ISP # 2 рдкреВрд▓ (Kerio # 2) рд╕реЗ IP рдкрддрд╛ 22.22.22.222 рд╣реИ </li><li>  рдЖрдИрдПрд╕рдкреА # 3 рдкреВрд▓ (рдорд┐рдХреНрд░реЛрдЯрд┐рдХ) рд╕реЗ рдЖрдИрдкреА рдкрддрд╛ - 33.33.33.111 </li><li>  рдЖрдИрдПрд╕рдкреА # 4 рдкреВрд▓ (рдорд┐рдХреНрд░реЛрдЯрд┐рдХ) рд╕реЗ рдЖрдИрдкреА рдкрддрд╛ - 44.44.44.111 </li></ol><br>  рдкрд╣рд▓реА рдмрд╛рдд рдпрд╣ рд╣реИ рдХрд┐ MikroTik рдкрд░ DDNS рд╕рдХреНрд╖рдо рд╣реИ: <br><br><pre><code class="plaintext hljs">/ip cloud set ddns-enabled=yes</code> </pre> <br>  рдЗрд╕ рддрдереНрдп рдХреЗ рдХрд╛рд░рдг рдХрд┐ рдорд┐рдХреНрд░реЛрдЯрд┐рдХ рдореЗрдВ рдПрдХ рд╕реНрдерд┐рд░ рд╕рдлреЗрдж рдЖрдИрдкреА рдкрддрд╛ рдирд╣реАрдВ рд╣реЛрдЧрд╛, рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдФрд░ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХрд╛ рдЖрдЧреЗ рдХрд╛ рдХрд╛рдо рдбреАрдбреАрдПрдирдПрд╕ рдХреЗ рдЙрдкрдпреЛрдЧ рдкрд░ рдЖрдзрд╛рд░рд┐рдд рд╣реИред <br><br>  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛ рдЖрдИрдкреА ---&gt; рдХреНрд▓рд╛рдЙрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдорд┐рдХреНрд░реЛрдЯрд┐рдХ рдХреЗ рдмрд╛рд╣рд░реА рдЖрдИрдкреА рдкрддреЗ рдХреЛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдпрд╣ рдЗрдВрдЯрд░рдиреЗрдЯ рдкрд░ рджрд┐рдЦрддрд╛ рд╣реИред <br><br>  рдЕрдм рдХреЗрд░рд┐рдпрд╛рдУ рдХрдВрдЯреНрд░реЛрд▓ # 1 рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рддреЗ рд╣реИрдВ, рддрд╛рдХрд┐ рдмрд╛рдж рдореЗрдВ рд╣рдо рдЗрд╕реЗ рд╡рд╛рдкрд╕ рди рдХрд░реЗрдВ: <br>  рд╣рдо "рдЗрдВрдЯрд░рдлреЗрд╕" рдЕрдиреБрднрд╛рдЧ рдкрд░ рдЬрд╛рддреЗ рд╣реИрдВ рдФрд░ рдирдП "рд╡реАрдкреАрдПрди рд╕реБрд░рдВрдЧ" рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдХреЛ рдЬреЛрдбрд╝рддреЗ рд╣реИрдВ ... <br><br><div class="spoiler">  <b class="spoiler_title">Kerio рдирд┐рдпрдВрддреНрд░рдг рдореЗрдВ рд╕реБрд░рдВрдЧ рд╡рд┐рдиреНрдпрд╛рд╕</b> <div class="spoiler_text">  1. рдирд╛рдо рдХреНрд╖реЗрддреНрд░ рдореЗрдВ, рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдХреЛ рдПрдХ рдирд╛рдо рдЕрд╕рд╛рдЗрди рдХрд░реЗрдВ; <br>  2. рд╕реНрд╡рд┐рдЪ рдХреЛ рд╕реНрдерд┐рддрд┐ рдореЗрдВ рд░рдЦреЗрдВ "рдирд┐рд╖реНрдХреНрд░рд┐рдп - рдХреЗрд╡рд▓ рдЖрдиреЗ рд╡рд╛рд▓реЗ рдХрдиреЗрдХреНрд╢рди рдХреЛ рд╕реНрд╡реАрдХрд╛рд░ рдХрд░рддрд╛ рд╣реИ"; <br>  3. рдЯрд╛рдЗрдк рдХрд░реЗрдВ "IPSec" рдЫреЛрдбрд╝ рджреЗрдВ; <br>  4. рдЯреИрдм "рдкреНрд░рдорд╛рдгреАрдХрд░рдг": <br><br><ul><li>  4.1 рдХреНрд╖реЗрддреНрд░ рдореЗрдВ "рдкреВрд░реНрд╡рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХреБрдВрдЬреА:" рдХреБрдВрдЬреА рд╡рд╛рдХреНрдпрд╛рдВрд╢ рджрд░реНрдЬ рдХрд░реЗрдВ рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрдиреЗрдХреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛; </li><li>  <b>рдиреЛрдЯ:</b> <br><br>  рдореИрдВ рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рд╕рднреА рд╡реАрдкреАрдПрди рд╕реБрд░рдВрдЧреЛрдВ рдкрд░ рд╕рднреА рдкреНрд░рдореБрдЦ рд╡рд╛рдХреНрдпрд╛рдВрд╢реЛрдВ рдХреЛ рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдХреЗрд░реЛ рд╕рд░реНрд╡рд░ рдкрд░ рдмрдирд╛рдП рдЬрд╛рдиреЗ рдХреА рд╕рд▓рд╛рд╣ рджреЗрддрд╛ рд╣реВрдВ! <br><br>  рдпрд╣ рдЗрд╕ рддрдереНрдп рдХреЗ рдХрд╛рд░рдг рд╣реИ рдХрд┐ рдХреЗрд░реАрдУ рдореЗрдВ рдПрдХ рдЕрд╕реНрдерд╛рдпреА рдмрдЧ рд╣реИ, рдЬрд┐рд╕реЗ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдореЗрдВ рд╡реНрдпрдХреНрдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред <br><br>  рдХрд▓реНрдкрдирд╛ рдХрд░реЗрдВ рдХрд┐ рдореЗрд░реЗ рдорд╛рдорд▓реЗ рдореЗрдВ, рдХреЗрд░реАрдУ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдореЗрдВ, рдорд┐рдХреНрд░реЛрдЯрд┐рдХ рд╕реЗ рдХрдиреЗрдХреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдП рдЧрдП рдХрдИ "рд╡реАрдкреАрдПрди рд╕реБрд░рдВрдЧ" рдЗрдВрдЯрд░рдлреЗрд╕ рд╣реИрдВ, рдЬреЛ рдХреЗрд╡рд▓ "рд╕реНрдерд╛рдиреАрдп рдЖрдИрдбреА:" рдлрд╝реАрд▓реНрдб (рдиреАрдЪреЗ рдЪрд░реНрдЪрд╛ рдХреА рдЬрд╛рдПрдЧреА) рдореЗрдВ рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдореЗрдВ рдПрдХ рджреВрд╕рд░реЗ рд╕реЗ рднрд┐рдиреНрди рд╣реЛрддреЗ рд╣реИрдВред <br><br>  рдЗрд╕рд▓рд┐рдП, рдмрдирд╛рддреЗ рд╕рдордп (рдореИрдВ рдЗрд╕реЗ рдХреЙрд▓ рдХрд░реВрдВрдЧрд╛) рдПрдХ рдЖрдиреЗ рд╡рд╛рд▓реА рд╕реБрд░рдВрдЧ рдХреА рдкрд░рд╡рд╛рд╣ рдХрд┐рдП рдмрд┐рдирд╛, рдмрд╛рд╣рд░реА рдЖрдИрдкреА рдкрддреЗ рдХреЗрд░реАрдУ рдорд┐рдХреНрд░реЛрдЯрд┐рдХ рд╕реЗ рд╕рдВрдкрд░реНрдХ рдХрд░реЗрдЧрд╛, рдХреЗрд░рд┐рдУ (рдХрд┐рд╕реА рдХрд╛рд░рдг рд╕реЗ) рдЙрд╕ рдкрд╛рд░ рдЖрдиреЗ рд╡рд╛рд▓реЗ рдкрд╣рд▓реЗ рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдХреЛ рд╕рдХреНрд░рд┐рдп рдХрд░реЗрдЧрд╛, рдФрд░ рдЕрдЧрд░ рдЖрдИрдкреА рдкрддрд╛ рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдореЗрдВ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рд╣реИред рдХреЗрд░рд┐рдпреЛ рдХреА рддрд░рдл рдХреА рд╕реБрд░рдВрдЧ рдЙрд╕ рд╕реЗ рдЕрд▓рдЧ рд╣реИ рдЬрд┐рд╕реЗ рдорд┐рдХреНрд░реЛрдЯрд┐рдХ рдмрддрд╛рддрд╛ рд╣реИ, рд╕реБрд░рдВрдЧ рд╡реНрдпрд╡рд╕реНрдерд┐рдд рдирд╣реАрдВ рд╣реИред <br><br>  рдФрд░ рдорд╛рдорд▓реЗ рдореЗрдВ рдЬрдм рд╕рднреА рд╕реБрд░рдВрдЧреЛрдВ рдХреЗ рд▓рд┐рдП рдЕрд▓рдЧ-рдЕрд▓рдЧ рдХреБрдВрдЬреА рд╡рд╛рдХреНрдпрд╛рдВрд╢реЛрдВ рдХрд╛ рд╕рдВрдХреЗрдд рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдпрд╣ рд╕рдорд╕реНрдпрд╛ рдмрдВрдж рд╣реЛ рдЬрд╛рддреА рд╣реИред </li><li>  4.2 "рд▓реЛрдХрд▓ рдЖрдИрдбреА:" рдлрд╝реАрд▓реНрдб рдореЗрдВ, ISP # 1 рдПрдбреНрд░реЗрд╕ рдкреВрд▓ рд╕реЗ рдЖрдИрдкреА рдПрдбреНрд░реЗрд╕ рджрд░реНрдЬ рдХрд░реЗрдВ (рдЙрджрд╛рд╣рд░рдг рдореЗрдВ 11.11.11.111) рдХреЗрд░реАрдУ рдХрдВрдЯреНрд░реЛрд▓ # 1 WAN рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдХреЛ рд╕реМрдВрдкрд╛, рдЬрд┐рд╕реЗ рдорд┐рдХреНрд░реЛрдЯрд┐рдХ рдПрдХреНрд╕реЗрд╕ рдХрд░реЗрдЧрд╛; </li><li>  4.3 "рд░рд┐рдореЛрдЯ рдЖрдИрдбреА:" рдлрд╝реАрд▓реНрдб рдореЗрдВ, FQDN рджрд░реНрдЬ рдХрд░реЗрдВ, рдЬреЛ рдбреАрдбреАрдПрдирдПрд╕ (рдЖрдИрдкреА ---&gt; рдХреНрд▓рд╛рдЙрдб ---&gt; рдбреАрдПрдирдПрд╕ рдирд╛рдо) рд╕реЗ рд╣рдорд╛рд░реЗ рдорд┐рдХреНрд░реЛрдЯрд┐рдХ рджреНрд╡рд╛рд░рд╛ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред  рдпрд╣ рд╕реЗрдЯрд┐рдВрдЧ рд╣рдореЗрдВ рдЗрд╕ рдмрд╛рдд рдХреА рдкрд░рд╡рд╛рд╣ рдирд╣реАрдВ рдХрд░рдиреЗ рджреЗрддреА рд╣реИ рдХрд┐ ISP рдорд┐рдХреНрд░реЛрдЯрд┐рдХ рдХреИрд╕реЗ рдХреЗрд░реЛ рдкрд╣реБрдВрдЪрддрд╛ рд╣реИ; </li><li>  4.4 "рдЪрд░рдг 1 рд╕рд┐рдлрд░ (IKE)" рдлрд╝реАрд▓реНрдб рдореЗрдВ: рд╕реВрдЪреА рд╕реЗ aes128-sha1-modp2048 рдХрд╛ рдЪрдпрди рдХрд░реЗрдВ; </li><li>  4.5 рдХреНрд╖реЗрддреНрд░ рдореЗрдВ "рдЪрд░рдг 2 рд╕рд┐рдлрд░ (рдИрдПрд╕рдкреА):" рд╕реВрдЪреА рд╕реЗ 3des-sha1-modp2048 рдХрд╛ рдЪрдпрди рдХрд░реЗрдВ; </li><li>  <b>рдиреЛрдЯ:</b> <br>  "рдмрджрд▓реЗрдВ ..." рдмрдЯрди рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛рдиреЗ рд╡рд╛рд▓реА рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдХреЛ рд╕рдВрдкрд╛рджрд┐рдд рдХрд░рдирд╛; <br>  рджреЛрдиреЛрдВ рд╕рд╛рдЗрдлрд░ рдХреЛ "рд╡реИрдЬреНрдЮрд╛рдирд┐рдХ рдкреЛрдХрд┐рдВрдЧ рд╡рд┐рдзрд┐" рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЪреБрдирд╛ рдЧрдпрд╛ рд╣реИред </li></ul><br>  5. рдЯреИрдм "рджреВрд░рд╕реНрде рдиреЗрдЯрд╡рд░реНрдХ": <br><br>  рдпрд╣рд╛рдВ рд╣рдо рдЙрд╕ рд╕реНрдерд╛рдиреАрдп рдиреЗрдЯрд╡рд░реНрдХ рдХрд╛ рдЖрдИрдкреА рдкрддрд╛ рджрд░реНрдЬ рдХрд░рддреЗ рд╣реИрдВ, рдЬреЛ рдЗрд╕ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдХреЗрд░рд┐рдпрд╛рдУ рдХрдВрдЯреНрд░реЛрд▓ рд╕рд░реНрд╡рд░ (рдЙрджрд╛рд╣рд░рдг рдореЗрдВ - 192.168.22.0/24) рд╕реЗ рдХрдиреЗрдХреНрдЯ рдХрд░рддреЗ рд╕рдордп рдорд┐рдХреНрд░реЛрдЯрд┐рдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдЧрд╛ред <br>  рдорд╣рддреНрд╡рдкреВрд░реНрдг!  рдмрд╛рдХреА рд╕рднреА (рдореЗрд░реЗ рдорд╛рдорд▓реЗ рдореЗрдВ рдпрд╣ рдХреЗрд░рд┐рдпреЛ рд╕реЗ рдЖрдИрдПрд╕рдкреА рдХреА рд╕рдВрдЦреНрдпрд╛ рд╕реЗ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рд╣реЛрддрд╛ рд╣реИ) рдорд┐рдХреНрд░реЛрдЯрд┐рдХ рдкрд░ рд╕реБрд░рдВрдЧреЛрдВ, рдЗрд╕ рдХреЗрд░реАрдУ рд╕рд░реНрд╡рд░ рдкрд░, рд╕рдорд╛рди рдЖрдИрдкреА рдкрддреЗ рдХреЛ рдЗрдВрдЧрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП! <br><br>  рдореБрдЭреЗ рдЖрдкрдХреЛ рдпрд╛рдж рджрд┐рд▓рд╛рдирд╛ рд╣реИ рдХрд┐ рдпрд╣ рдореБрдЦреНрдп рдХрд╛рд░реНрдпрд╛рд▓рдп рдиреЗрдЯрд╡рд░реНрдХ рд╕реЗ рдЗрд╕ рдиреЗрдЯрд╡рд░реНрдХ рдХреЗ рд▓рд┐рдП рдорд╛рд░реНрдЧ рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдХреЗ рдХрд╛рд░рдг рд╣реИред <br><br>  6. рдЯреИрдм "рд╕реНрдерд╛рдиреАрдп рдХреНрд╖реЗрддреНрд░ рдиреЗрдЯрд╡рд░реНрдХ": <br><br><ul><li>  6.1 рдмреЙрдХреНрд╕ рдХреЛ рдЕрдирдЪреЗрдХ рдХрд░реЗрдВ "рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рд╕реНрдерд╛рдиреАрдп рдиреЗрдЯрд╡рд░реНрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ"; </li><li>  6.2 "рдХрд╕реНрдЯрдо рдиреЗрдЯрд╡рд░реНрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ" рд╕реЗрдЯ рдХрд░реЗрдВ: рдЪреЗрдХрдмреЙрдХреНрд╕, рдФрд░ рдиреЗрдЯрд╡рд░реНрдХ рдкрддрд╛ "рдХрд╡рд░" рдЬреЛрдбрд╝реЗрдВ рдХреЗрд░рд┐рдУ рдХрдВрдЯреНрд░реЛрд▓ рдХреЗ рдкреАрдЫреЗ рд╕реНрдерд╛рдиреАрдп рдиреЗрдЯрд╡рд░реНрдХ рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рдкрддреЗ рдХреА рдкреВрд░реА рд╢реНрд░реГрдВрдЦрд▓рд╛ рдиреЗрдЯрд╡рд░реНрдХ рдХреА рд╕реВрдЪреА рдореЗрдВ (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП - 192.168.0.0/16)ред </li></ul><br>  рд╣рдо рдПрдХ рд╣реА Kerio рд╕рд░реНрд╡рд░ рдкрд░ рджреВрд╕рд░реА рд╕реБрд░рдВрдЧ рдХреЗ рд▓рд┐рдП рдЙрдкрд░реЛрдХреНрдд рд╕рднреА рдЪрд░рдгреЛрдВ рдХреЛ рджреЛрд╣рд░рд╛рддреЗ рд╣реИрдВред <br><br>  рджреВрд╕рд░реА рд╕реБрд░рдВрдЧ рд╡рд┐рдиреНрдпрд╛рд╕ рдХреЗрд╡рд▓ рдПрдХ рдЕрд▓рдЧ рдкрд╛рд╕рдлрд╝реНрд░реЗрдЬрд╝ (рдЦрдВрдб 4.1) рдФрд░ ISP # 2 рдкрддрд╛ рдкреВрд▓ (рдЦрдВрдб 4.2) рд╕реЗ рдПрдХ рдЕрд▓рдЧ рдмрд╛рд╣рд░реА рдЖрдИрдкреА рдкрддреЗ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЕрд▓рдЧ рд╣реЛрдЧрд╛ (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, 22.22.22.111)ред <br><br>  рджреВрд░рд╕реНрде рдиреЗрдЯрд╡рд░реНрдХ рдЯреИрдм (рдкреАред 5) (рдЙрджрд╛рд╣рд░рдг рдореЗрдВ, 192.168.33.0/24) рдФрд░ рдЙрд╕рдХреЗ рдЕрдиреБрд╕рд╛рд░, рд╕реНрдерд╛рдиреАрдп рдЖрдИрдбреА: рдлрд╝реАрд▓реНрдб ( рд╕реЗрдХред 4.2), рдЬрд┐рд╕реЗ рдХреЗрд░реАрдУ рдХрдВрдЯреНрд░реЛрд▓ # 2 рдбрдмреНрд▓реНрдпреВрдПрдПрди рдЗрдВрдЯрд░рдлреЗрд╕ (рдЙрджрд╛рд╣рд░рдг рдореЗрдВ, 11.11.11.222 рдФрд░ 22.22.22.222) рдХреЛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдЖрдИрдкреА рдкрддреЗ рд╕реЗ рдЪреБрдирд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред <br></div></div><br>  рдЕрдЧрд▓рд╛, рд╣рдо MikroTik рд╕реЗ рд╣рдорд╛рд░реЗ рдХреЗрд░реЛ рдХреЛ рдкрд┐рдВрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдЕрдиреБрдорддрд┐ рдирд┐рдпрдо рдмрдирд╛рддреЗ рд╣реИрдВ ... <br><br><div class="spoiler">  <b class="spoiler_title">рдХреЗрд░рд┐рдпреЛ рдХрдВрдЯреНрд░реЛрд▓ рдореЗрдВ рдкрд┐рдВрдЧ рдирд┐рдпрдо</b> <div class="spoiler_text">  рд╣рдо "рдЯреНрд░реИрдлрд╝рд┐рдХ рдирд┐рдпрдо" рдЕрдиреБрднрд╛рдЧ рдкрд░ рдЬрд╛рддреЗ рд╣реИрдВ рдФрд░ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдорд╛рдкрджрдВрдбреЛрдВ рдХреЗ рд╕рд╛рде рдПрдХ рдирдпрд╛ рдирд┐рдпрдо рдмрдирд╛рддреЗ рд╣реИрдВ: <br><br><ul><li>  source - FNSDN рдХреЛ рдЗрдВрдЧрд┐рдд рдХрд░реЗрдВ рдЬреЛ DDNS рд╕реЗ тАЛтАЛрд╣рдорд╛рд░реЗ рдорд┐рдХреНрд░реЛрдЯрд┐рдХ рджреНрд╡рд╛рд░рд╛ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛; </li><li>  рдЧрдВрддрд╡реНрдп - рдлрд╝рд╛рдпрд░рд╡реЙрд▓ </li><li>  рд╕реЗрд╡рд╛ - рдкрд┐рдВрдЧ; </li><li>  рдЖрдк IP рд╕рдВрд╕реНрдХрд░рдг (IPv4) рднреА рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдпрд╣ рдЖрд╡рд╢реНрдпрдХ рдирд╣реАрдВ рд╣реИред </li></ul><br>  рд╣рдо рдирд┐рдпрдо рдХреЛ рдРрд╕реЗ рдирд╛рдо рдХреЗ рд╕рд╛рде рд╕рд╣реЗрдЬрддреЗ рд╣реИрдВ рдЬреЛ рдЖрдкрдХреЗ рд▓рд┐рдП рд╕рдордЭ рдореЗрдВ рдЖрддрд╛ рд╣реИ рдФрд░ рдЗрд╕реЗ рдирд┐рдпрдореЛрдВ рдХреА рд╕реВрдЪреА рдХреЗ рдмрд╣реБрдд рдКрдкрд░ рддрдХ рдЦреАрдВрдЪрддрд╛ рд╣реИред <br><br>  рд╣рдо рджреВрд╕рд░реЗ рдХреЗрд░рд┐рдУ рд╕рд░реНрд╡рд░ рдкрд░ рдПрдХ рд╣реА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рджреЛрд╣рд░рд╛рддреЗ рд╣реИрдВред <br></div></div><br>  рд╣реЗрдб рдСрдлрд┐рд╕ рдХреА рддрд░рдл рд╕реНрд╡рд┐рдЪ рдпрд╛ рд░рд╛рдЙрдЯрд░ рдореЗрдВ рдорд┐рдХреНрд░реЛрдЯрд┐рдХ рдХреЗ рдкреАрдЫреЗ рдиреЗрдЯрд╡рд░реНрдХ рдкрд░ рдорд╛рд░реНрдЧреЛрдВ рдХреЛ рдкрдВрдЬреАрдХреГрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдордд рднреВрд▓рдирд╛ рддрд╛рдХрд┐ рд╣реЗрдб рдСрдлрд┐рд╕ рдиреЗрдЯрд╡рд░реНрдХ рдХреЛ рдкрддрд╛ рдЪрд▓ рд╕рдХреЗ рдХрд┐ рдЯреНрд░реИрдлрд╝рд┐рдХ рдХрд╣рд╛рдВ рдирд┐рд░реНрджреЗрд╢рд┐рдд рдХрд░рдирд╛ рд╣реИ (рдореЗрд░реЗ рдорд╛рдорд▓реЗ рдореЗрдВ, рдпреЗ 192.168.23.0/24 рдФрд░ 192.168.33.0/24 рдиреЗрдЯрд╡рд░реНрдХ рдкрд░ рджреЛ рд╕реНрдерд┐рд░ рдорд╛рд░реНрдЧ рд╣реИрдВ)ред <br><br>  рдкреНрд░рдзрд╛рди рдХрд╛рд░реНрдпрд╛рд▓рдп рд╕реЗ, рд╣рдордиреЗ рд╕рдм рдХреБрдЫ рдХрд┐рдпрд╛, рдЕрдм рд╣рдо рдорд┐рдХреНрд░реЛрдЯрд┐рдХ рдкрд░ рдЖрдЧреЗ рдмрдврд╝ рд░рд╣реЗ рд╣реИрдВред <br><br>  рдЖрдЗрдП, рд╡реАрдкреАрдПрди рд╕реБрд░рдВрдЧ рдХреЗ рдЖрдпреЛрдЬрди рдФрд░ рдкрд░реАрдХреНрд╖рдг рдХреЗ рд▓рд┐рдП рдмреБрдирд┐рдпрд╛рджреА рд╡рд┐рдиреНрдпрд╛рд╕ рд╡рд╕реНрддреБрдУрдВ рдХрд╛ рдирд┐рд░реНрдорд╛рдг рд╢реБрд░реВ рдХрд░реЗрдВред <br><br>  рдкрд╣рд▓рд╛ рдХрджрдо рдПрдХ рд╕реНрдерд╛рдиреАрдп рд╕рдмрдиреЗрдЯ рдкрддрд╛ рд╕реВрдЪреА рдмрдирд╛рдирд╛ рд╣реИред  рд╣рдо рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдлрд╝рд╛рдпрд░рд╡реЙрд▓ рдирд┐рдпрдореЛрдВ рдореЗрдВ рдХрд░реЗрдВрдЧреЗред <br><br><pre> <code class="plaintext hljs">/ip firewall address-list #      MikroTik, # IP-      DHCP add address=192.168.11.0/24 list="Local subnet" #  ,        MikroTik #   VPN-  Kerio Control #1 # (     VPN-  Kerio Control #1, #   " ") add address=192.168.22.0/24 list="Local subnet" #  ,        MikroTik #   VPN-  Kerio Control #2 # (     VPN-  Kerio Control #2, #   " ") add address=192.168.33.0/24 list="Local subnet"</code> </pre> <br>  рдЕрдЧрд▓рд╛, IKE рдЯреНрд░реИрдлрд╝рд┐рдХ рдХреЗ рд▓рд┐рдП рдПрдХ рдЕрдиреБрдорддрд┐ рдирд┐рдпрдо рдмрдирд╛рдПрдВ рдФрд░ рдЗрд╕реЗ рдирд┐рдпрдо рд╕реВрдЪреА рдХреЗ рдмрд╣реБрдд рдКрдкрд░ рд░рдЦреЗрдВред <br><br><pre> <code class="plaintext hljs">add action=accept chain=input comment="VPN Allow IKE" dst-port=500 protocol=udp</code> </pre> <br>  рдлрд┐рд░ рд╡реАрдкреАрдПрди рдЯреНрд░реИрдлрд╝рд┐рдХ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдлрд╝рд╛рдпрд░рд╡реЙрд▓ рдлрд╝рд┐рд▓реНрдЯрд░ рдореЗрдВ рджреЛ рдирд┐рдпрдо рдЬреЛрдбрд╝реЗрдВ ... <br><br><pre> <code class="plaintext hljs">/ip firewall filter add action=accept chain=forward comment="VPN In IpSec" dst-address-list=\ "Local subnet" ipsec-policy=in,ipsec src-address=192.168.0.0/16 \ src-address-list="!Local subnet" add action=accept chain=forward comment="VPN Out" dst-address=192.168.0.0/16 \ dst-address-list="!Local subnet" src-address-list="Local subnet"</code> </pre> <br>  ... рдФрд░ рдЙрдиреНрд╣реЗрдВ <b>рдбреНрд░реЙрдк рдирд┐рдпрдо рд╕реЗ</b> рддреБрд░рдВрдд <b>рдКрдкрд░ рдХреА</b> рд╕реНрдерд┐рддрд┐ рдореЗрдВ рд▓реЗ рдЬрд╛рдПрдВ, рдЬреЛ рд▓реИрди рдХреЗ рдмрд╛рд╣рд░ рд╕реЗ рдЖрдиреЗ рд╡рд╛рд▓реЗ рдпрд╛рддрд╛рдпрд╛рдд рдХреЛ рдкреНрд░рддрд┐рдмрдВрдзрд┐рдд рдХрд░рддрд╛ рд╣реИред  рдореЗрд░реЗ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдореЗрдВ, рдпрд╣ рдЯрд┐рдкреНрдкрдгреА "рдбрд┐рдлреЙрдиреНрдл: рдбреНрд░реЙрдк рдЖрд▓ рд╕реЗ рдирд╣реАрдВ рдЖрдиреЗ рд╡рд╛рд▓реА рд▓реИрди" рдХреЗ рд╕рд╛рде рдереА <br><br>  рдлрд╝рд╛рдпрд░рд╡реЙрд▓ рдЪреВрдбрд╝реА рдкрд░ рдЬрд╛рдПрдБ рдФрд░ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдирд┐рдпрдо рдмрдирд╛рдПрдБ: <br><br><pre> <code class="plaintext hljs">/ip firewall mangle #      , #  ... add action=mark-connection chain=prerouting comment="VPN In" \ new-connection-mark=VPN_conn_in passthrough=no src-address=192.168.0.0/16 \ src-address-list="!Local subnet" # ...   add action=mark-routing chain=output comment="VPN In" connection-mark=\ VPN_conn_in new-routing-mark=VPN_route_in passthrough=yes #     MikroTik      . #     NAT. add action=mark-connection chain=postrouting comment="VPN Out" dst-address=\ 192.168.0.0/16 dst-address-list="!Local subnet" new-connection-mark=\ VPN_conn_out passthrough=no</code> </pre> <br>  рдЕрдЧрд▓рд╛, рд╣рдо рдлрд╝рд╛рдпрд░рд╡реЙрд▓ NAT рдореЗрдВ рдзреНрдпрд╛рди рджреЗрдВ: <br><br><pre> <code class="plaintext hljs">/ip firewall nat #     MikroTik     #      , #    Kerio- (:  Kerio Control #1 - 192.168.22.0/24,  Kerio Control #2 - 192.168.33.0/24) # ! # comment=KerioVpnNatOut   ! add action=netmap chain=srcnat comment=KerioVpnNatOut connection-mark=\ VPN_conn_out to-addresses=192.168.22.0/24 #     MikroTik     #          MikroTik add action=netmap chain=dstnat comment=KerioVpnNatIn connection-mark=\ VPN_conn_in to-addresses=192.168.11.0/24 #  MikroTik  Kerio- add action=accept chain=srcnat comment=KerioVpnNatPing out-interface-list=WAN protocol=icmp</code> </pre> <br>  <b>рдорд╣рддреНрд╡рдкреВрд░реНрдг!</b>  рдЗрди рдирд┐рдпрдореЛрдВ рдХреЛ рдорд╛рд╕реНрдХрд┐рдВрдЧ рдирд┐рдпрдореЛрдВ рдХреЗ рдКрдкрд░ рд░рдЦрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред <br><br>  рдЕрдм рд╣рдо рд╕реЗрдХреНрд╢рди IP ---&gt; IPSec рдкрд░ рдЬрд╛рддреЗ рд╣реИрдВ, рдЬрд╣рд╛рдБ рд╣рдореЗрдВ рдкреЙрд▓рд┐рд╕реА, рдкреАрдпрд░, рдкреЙрд▓рд┐рд╕реА рдЯреЗрдореНрдкреНрд▓реЗрдЯ рд╕рдореВрд╣ рдмрдирд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ (рдореИрдВ рдмрд╛рдж рдореЗрдВ рдЙрдирдХреЗ рдЙрджреНрджреЗрд╢реНрдп рдкрд░ рдЪрд░реНрдЪрд╛ рдХрд░реВрдБрдЧрд╛) рдФрд░ рдЪрд░рдг 2 рд╕рд┐рдлрд░ рдХреА рд╕реНрдерд╛рдкрдирд╛ рдХрд╛ рдкреНрд░рд╕реНрддрд╛рд╡ рдХрд░рддрд╛ рд╣реВрдБред <br><br><div class="spoiler">  <b class="spoiler_title">рдЖрдИрдкреА тАЛтАЛipsec рдкреНрд░рд╕реНрддрд╛рд╡</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">/ip ipsec proposal add enc-algorithms=3des name=KerioVPNProposal#01 pfs-group=modp2048</code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">рдЖрдИрдкреА тАЛтАЛipsec рдиреАрддрд┐ рд╕рдореВрд╣</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">/ip ipsec policy group add name=1 add name=2 add name=3 add name=4</code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">рдЖрдИрдкреА тАЛтАЛipsec рд╕рд╣рдХрд░реНрдореА</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">/ip ipsec peer add address=11.11.11.111/32 comment=vs01-i01-01.domain.ru exchange-mode=\ main-l2tp local-address=33.33.33.111 my-id=\ fqdn:mikrotik.sn.mynetname.net policy-template-group=1 profile=\ profile_4 secret=pass1111</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">рдЖрдИрдкреА тАЛтАЛipsec рдиреАрддрд┐</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">/ip ipsec policy add comment=KerioVPNPolicy dst-address=192.168.77.0/24 proposal=KerioVPNProposal#01 \ sa-dst-address=11.11.11.111 sa-src-address=33.33.33.111 src-address=\ 192.168.22.0/24 tunnel=yes</code> </pre> <br></div></div><br>  рдЯрд┐рдкреНрдкрдгреА: <br><br>  1. "рдЖрдИрдкреА ipsec рдкреНрд░рд╕реНрддрд╛рд╡ - рд╡рд╣реА рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдкреИрд░рд╛рдореАрдЯрд░ рджрд░реНрдЬ рдХрд░реЗрдВ рдЬрд┐рд╕реЗ рд╣рдордиреЗ" рдЪрд░рдг 2 рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди (ESP): "рдлрд╝реАрд▓реНрдб рдореЗрдВ рдХреЗрд░рд┐рдпрд╛рдУ рдХрдВрдЯреНрд░реЛрд▓ рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рддреЗ рд╕рдордп рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд┐рдпрд╛ рдерд╛ред <br><br>  <b>рдиреЛрдЯ:</b> <br><br>  "рдирд╛рдо = KerioVPNProposal # 01" рдкреИрд░рд╛рдореАрдЯрд░ рдкрд░ рдзреНрдпрд╛рди рджреЗрдВред <br><br>  рдпрд╣ рдирд╛рдо рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рдирд╣реАрдВ рд╣реИ, рд▓реЗрдХрд┐рди рдпрджрд┐ рдЖрдк рдХрд┐рд╕реА рдЕрдиреНрдп рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХрд╛ рдирд┐рд░реНрдгрдп рд▓реЗрддреЗ рд╣реИрдВ, рддреЛ рдЗрд╕реЗ рдмрджрд▓рдиреЗ рдХреЗ рдмрд╛рдж рдЖрдкрдХреЛ рдЬрд╛рдВрдЪ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдФрд░, рдпрджрд┐ рдЖрд╡рд╢реНрдпрдХ рд╣реЛ, рддреЛ рд╕рдВрдмрдВрдзрд┐рдд IPSec рдиреАрддрд┐ рдХреА рд╕реЗрдЯрд┐рдВрдЧ рдореЗрдВ рдмрджрд▓рд╛рд╡ рдХрд░реЗрдВ, рд╕рд╛рде рд╣реА рд╕реНрдХреНрд░рд┐рдкреНрдЯ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдореЗрдВ DefKerioPameName рдЪрд░ рдХреЗ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдорд╛рди рдХреЛ рдмрджрд▓реЗрдВ, рдЬрд┐рд╕рдХреА рдЪрд░реНрдЪрд╛ рдХреА рдЬрд╛рдПрдЧреАред рдЖрдЧреЗ рднрд╛рд╖рдгред <br><br>  (рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рд╡рд░реНрдгрд┐рдд рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдореЗрдВ рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рдХреЗ рдЕрдзрд┐рдХрд╛рдВрд╢ рдирд╛рдо рдФрд░ рдЯрд┐рдкреНрдкрдгрд┐рдпрд╛рдВ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛рддреА рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рдЙрдирдХрд╛ рдирд╛рдо рдмрджрд▓рдиреЗ рд╕реЗ рдЖрдкрдХреЛ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЛрдб рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрди рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдХреЗ рдХрд╛рд░рдг рдХреБрдЫ рдЕрд╕реБрд╡рд┐рдзрд╛ рд╣реЛ рд╕рдХрддреА рд╣реИред рдореИрдВ рдРрд╕реА рд╡рд╕реНрддреБрдУрдВ рдХреА рдЦреЛрдЬ рдХреЛ рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдкрд╛рда рдореЗрдВ рдЙрдкрдпреБрдХреНрдд рдиреЛрдЯреНрд╕ рдмрдирд╛рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░реВрдВрдЧрд╛ред) <br><br>  2. "рдЖрдИрдкреА ipsec рдиреАрддрд┐ рд╕рдореВрд╣ <br><br>  рд╕рдореВрд╣реЛрдВ рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдЗрд╕ рддрдереНрдп рдХреЗ рдХрд╛рд░рдг рд╣реИ рдХрд┐ рднрд╡рд┐рд╖реНрдп рдореЗрдВ рд╣рдо рдЙрдирдХреЗ рдирд╛рдореЛрдВ (1, 2, ... n) рдХреЛ рд▓рд┐рдкрд┐рдпреЛрдВ рдореЗрдВ рд╕рдВрд╕рд╛рдзрд┐рдд рдХрд░реЗрдВрдЧреЗ рдФрд░ рдЙрдирдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрд░рд┐рдпреЛ рд╕рд░реНрд╡рд░ рдХреЗ рдЖрдИрдкреА рдкрддреЗ рдХреЛ рдкреНрд░рд╛рдердорд┐рдХрддрд╛ рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░реЗрдВрдЧреЗ рдЬреЛ рд╣рдо рдПрдХреНрд╕реЗрд╕ рдХрд░реЗрдВрдЧреЗред <br><br>  рдореИрдВ рдПрдХ рд╕рд╛рде рдЪрд╛рд░ рд╕рдореВрд╣ рдмрдирд╛рддрд╛ рд╣реВрдВред  рдореЗрд░реЗ рдкрд╛рд╕ рджреЛ ISP рд╣реИрдВ, рдЬрд┐рдирдореЗрдВ рд╕реЗ рдкреНрд░рддреНрдпреЗрдХ рдкрд░ рджреЛ рдмрд╛рд╣рд░реА IP рд╣реИрдВред  рдЗрд╕ рд╕реНрддрд░ рдкрд░, рд╣рдо рдЕрдм рддрдХ рдХреЗрд╡рд▓ рдПрдХ рд╕рдореВрд╣ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣реЗ рд╣реИрдВред <br><br>  3. 3. рдЖрдИрдкреА ipsec рд╕рд╣рдХрд░реНрдореА <br><br>  рд╕рд╣рдХрд░реНрдореА рдореЗрдВ, рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░реЗрдВ: <br><br><ul><li>  рдкрддрд╛ - рдХреЗрд░рд┐рдУ рдХрд╛ рдЖрдИрдкреА-рдкрддрд╛, рдЬрд┐рд╕реЗ рдорд┐рдХреНрд░реЛрдЯрд┐рдХ рд╕реЗ рд╕рдВрдкрд░реНрдХ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред  рд╡рд╣реА рдкрддрд╛ рдЬрд┐рд╕реЗ рд╣рдордиреЗ / ip ipsec рдкреЙрд▓рд┐рд╕реА sa-dst-address рдореЗрдВ рджрд░реНрдЬ рдХрд┐рдпрд╛ рд╣реИ, рдХреЗрд╡рд▓ рдорд╛рд╕реНрдХ "/ 32" рдХреЗ рд╕рд╛рде рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП; </li><li>  рд╕реНрдерд╛рдиреАрдп рдкрддрд╛ - рдорд┐рдХреНрд░реЛрдЯрд┐рдХ рдХрд╛ рдЖрдИрдкреА-рдкрддрд╛, рдЬрд┐рд╕рд╕реЗ рдХреЗрд░рд┐рдУ рдПрдХреНрд╕реЗрд╕ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред  рд╡рд╣реА рдкрддрд╛ рдЬреЛ рд╣рдордиреЗ / ip ipsec рдиреАрддрд┐ sa-src-address рдореЗрдВ рджрд░реНрдЬ рдХрд┐рдпрд╛ рд╣реИ, рдЙрд╕реЗ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП; </li><li>  рдкреНрд░рдорд╛рдгреАрдХрд░рдгред  рд╡рд┐рдзрд┐ - рд╕реВрдЪреА рд╕реЗ "рдкреВрд░реНрд╡ рд╕рд╛рдЭрд╛ рдХреБрдВрдЬреА" рдЪреБрдиреЗрдВ; </li><li>  рдПрдХреНрд╕рдЪреЗрдВрдЬ рдореЛрдб - рд╕реВрдЪреА рд╕реЗ рдореБрдЦреНрдп- l2tp рдЪреБрдиреЗрдВ; </li><li>  рдпрджрд┐ рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рддреЛ "рдирд┐рд╖реНрдХреНрд░рд┐рдп" рдмреЙрдХреНрд╕ рдХреЛ рдЕрдирдЪреЗрдХ рдХрд░реЗрдВ; </li><li>  рдЧреБрдкреНрдд - рдкрд╛рд╕рдлрд╝реНрд░реЗрдЬрд╝ рджрд░реНрдЬ рдХрд░реЗрдВ рдЬреЛ рд╣рдордиреЗ рджрд░реНрдЬ рдХрд┐рдпрд╛ рдерд╛ рдЬрдм рд╣рдордиреЗ "рдкреВрд░реНрд╡рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХреБрдВрдЬреА:" рдлрд╝реАрд▓реНрдб рдореЗрдВ "рдкреНрд░рдорд╛рдгреАрдХрд░рдг" рдЯреИрдм рдкрд░, рдХреЗрд░реАрдУ рдкрд░ рд╡реАрдкреАрдПрди рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдерд╛; </li><li>  рдиреАрддрд┐ рдЯреЗрдореНрдкрд▓реЗрдЯ рд╕рдореВрд╣ - рдЙрд╕ рд╕реВрдЪреА рд╕реЗ рдЪреБрдиреЗрдВ рдЬрд┐рд╕реЗ рд╣рдордиреЗ рдкрд╣рд▓реЗ "1" рдирд╛рдо рд╕реЗ рдмрдирд╛рдпрд╛ рдерд╛; </li><li>  рдиреИрдЯ рдЯреНрд░реИрд╡рд░рд▓ рдХреЛ рдЕрдирдЪреЗрдХ рдХрд░реЗрдВ; </li><li>  рдореЗрд░рд╛ рдЖрдИрдбреА рдкреНрд░рдХрд╛рд░ - рд╕реВрдЪреА рд╕реЗ "fqdn" рдорд╛рди рдХрд╛ рдЪрдпрди рдХрд░реЗрдВ; </li><li>  рдореЗрд░реА рдЖрдИрдбреА - рдбреАрдбреАрдПрдирдПрд╕ рдореЗрдВ рдорд┐рдХреНрд░реЛрдЯрд┐рдХ рджреНрд╡рд╛рд░рд╛ рд╕реМрдВрдкреА рдЧрдИ рдПрдлрдХреНрдпреВрдбреАрдПрди рджрд░реНрдЬ рдХрд░реЗрдВ; </li><li>  "рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди" рдЯреИрдм рдкрд░, рдЙрд╕ рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдкреИрд░рд╛рдореАрдЯрд░ рдХрд╛ рдЪрдпрди рдХрд░реЗрдВ рдЬреЛ рд╣рдордиреЗ рджрд░реНрдЬ рдХрд┐рдпрд╛ рдерд╛ рдЬрдм рд╣рдордиреЗ "рдкреНрд░рдорд╛рдгреАрдХрд░рдг" рдЯреИрдм рдкрд░, "рдЪрд░рдг 1 (IKE) рд╕рд┐рдлрд░:" рдлрд╝реАрд▓реНрдб рдореЗрдВ рдХреЗрд░реАрдУ рдкрд░ рд╡реАрдкреАрдПрди рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдерд╛; </li><li>  рдЯрд┐рдкреНрдкрдгреА ( <b>рдЪреЗрддрд╛рд╡рдиреА! рд▓рд┐рдкрд┐рдпреЛрдВ рдореЗрдВ рдкреНрд░рдпреБрдХреНрдд!</b> )ред </li></ul><br>  рдЯрд┐рдкреНрдкрдгреА рдореЗрдВ, рдореИрдВ рдЕрдкрдиреЗ рд╕рд░реНрд╡рд░ рдХреЗ рдкреВрд░реНрдг рддрдХрдиреАрдХреА FQDN рдХрд╛ рд╕рдВрдХреЗрдд рджреЗрддрд╛ рд╣реВрдВ, рдЬреЛ DNS рд╕рд░реНрд╡рд░ рдкрд░ рдореЗрд░реЗ рдмрд╛рд╣рд░реА рдХреНрд╖реЗрддреНрд░ рдХреА рд╕реЗрд╡рд╛ рдореЗрдВ рдкреНрд░рдХрд╛рд╢рд┐рдд рд╣реЛрддреЗ рд╣реИрдВред <br><br>  рдЗрд╕ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдпрд╣ рдореБрдЭреЗ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЧрдП Kerio рд╕рд░реНрд╡рд░ рдХреЗ рдмрд╛рд╣рд░реА рдЖрдИрдкреА рдкрддреЗ рдХреА рдЬрд╛рдирдХрд╛рд░реА рд░рдЦрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ (рдореБрдЭреЗ рдмрд╛рд╣рд░реА DNS рд╕рд░реНрд╡рд░ рдкрд░ рдЖрдИрдкреА рдкрддреЗ рдХреЛ рдмрджрд▓рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдФрд░ рдпрд╣ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдорд┐рдХреНрд░реЛрдЯрд┐рдХ ( <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдпрд╣рд╛рдВ</a></b> рд▓реЗрдЦ) рдореЗрдВ рдмрджрд▓ рдЬрд╛рдПрдЧрд╛ред <br><br>  рдЙрди рд▓реЛрдЧреЛрдВ рдХреЗ рд▓рд┐рдП рдЬреЛ рд╕рдордЭрдиреЗ рдореЗрдВ рдмрд╣реБрдд рдЖрд▓рд╕реА рд╣реИрдВ, рдореИрдВ рдХрд╛рдо рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдХреЛрдб рдХреЛ рдЙрджреНрдзреГрдд рдХрд░рддрд╛ рд╣реВрдВ: <br><br><pre> <code class="plaintext hljs">/system script add dont-require-permissions=no name=scriptSetIPSecSADstAddrFromDNS owner=\ admin policy=read,write</code> </pre><br><div class="spoiler">  <b class="spoiler_title">рд╕реНрдХреНрд░рд┐рдкреНрдЯ рд▓рд┐рд╕реНрдЯрд┐рдВрдЧ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рд╕реНрдХреНрд░рд┐рдкреНрдЯрд╕реЗрдЯрд╕реИрдбрд╕реНрдЯреИрдбрдбреНрд░реЙрдлрд╝рдбреАрдбреАрдПрдирдПрд╕</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">:if ([:len [/system script job find script=SetIPSecSADstAddrFromDNS]]&gt;1) do={ :error } :local DnsNameFromComment :local ResolvedIpFromComment :local ResolvedIpWithMaskFromComment :local IpPeerAddr :foreach IpSecPeerCount in=[/ip ipsec peer find] do={ :set DnsNameFromComment [/ip ipsec peer get $IpSecPeerCount comment] :if ($DnsNameFromComment!="") do={ :do { :set ResolvedIpFromComment [:resolve $DnsNameFromComment] :set ResolvedIpWithMaskFromComment ($ResolvedIpFromComment . "/32") :set IpPeerAddr [/ip ipsec peer get $IpSecPeerCount address] :if ($ResolvedIpWithMaskFromComment!=$IpPeerAddr) do={ :log warning ("[SetIPSecSADstAddrFromDNS]     " . DnsNameFromComment . "  IP-  " . $IpPeerAddr . "  " . $ResolvedIpFromComment) #:log warning ("[SetIPSecSADstAddrFromDNS] In the peer to the server " . DnsNameFromComment . " changed IP address from " . $IpPeerAddr . " on " . $ResolvedIpFromComment) /ip ipsec peer set $IpSecPeerCount address=$ResolvedIpWithMaskFromComment } } on-error={ :set ResolvedIpFromComment "unknown" :log error ("[SetIPSecSADstAddrFromDNS]     " . $DnsNameFromComment) #:log error ("[SetIPSecSADstAddrFromDNS] Cant resolve name " . $DnsNameFromComment) } } } :log warning ("[SetIPSecSADstAddrFromDNS]  IP- VPN- ") #:log warning ("[SetIPSecSADstAddrFromDNS] The IP-addresses of the VPN-servers are checked")</code> </pre><br></div></div><br>  <b>рд╕рд╛рдерд┐рдпреЛрдВ рдореЗрдВ рдЯрд┐рдкреНрдкрдгреА рдкрд░ рд▓рд╛рдЧреВ рд╣реЛрдиреЗ рд╡рд╛рд▓рд╛ рдореВрд▓ рдирд┐рдпрдо рдпрд╣</b> рд╣реИ рдХрд┐ рдирд╛рдо рдХрд┐рд╕реА рднреА рдЕрдХреНрд╖рд░ рдФрд░ / рдпрд╛ рд╕рдВрдЦреНрдпрд╛ рдХреЗ рд╕рд╛рде рд╢реБрд░реВ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП, рдмрд┐рдирд╛ рд░рд┐рдХреНрдд рд╕реНрдерд╛рди рдХреЗ, рдЬрд┐рд╕рдХреЗ рдмрд╛рдж <b>MANDATORY рд╣рд╛рдЗрдлрд╝рди</b> ("-"), рдХрд┐рд╕реА рднреА рд╕рдВрдЦреНрдпрд╛ рдореЗрдВ рдордирдорд╛рдиреЗ рдЕрдХреНрд╖рд░ рд╣реЛрдВрдЧреЗред <br><br>  рдореИрдВ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреНрд░рд╛рд░реВрдк рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реВрдВ: <br><br>  vsNN-pNN-NN.domain.ru <br><br>  рдЬрд╣рд╛рдВ: <br><br>  vsNN - vpn-server #NN (рдЯрд┐рдкреНрдкрдгреА рдХрд╛ рдпрд╣ рд╣рд┐рд╕реНрд╕рд╛ рд▓рд┐рдкрд┐рдпреЛрдВ рдореЗрдВ рд╕рдВрд╕рд╛рдзрд┐рдд рд╣реЛрддрд╛ рд╣реИ рдФрд░ рдЖрдИрдкреА рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ ---&gt; рдлрд╝рд╛рдпрд░рд╡реЙрд▓ ---&gt; рдкрддрд╛ рд╕реВрдЪрд┐рдпрд╛рдБ (рдиреАрдЪреЗ рджреЗрдЦреЗрдВ)); <br>  pNN - ISP #NN; <br>  рдПрдирдПрди - рдХреЗрд░рд┐рдУ рдкрд░ рдкреНрд░рджрд╛рддрд╛ рджреНрд╡рд╛рд░рд╛ рдореБрдЭреЗ рдЬрд╛рд░реА рдХрд┐рдП рдЧрдП рдкрддреЗ рдХреЗ рдкреВрд▓ рдореЗрдВ рдмрд╛рд╣рд░реА рдЖрдИрдкреА рдкрддреЗ рдХреА рдХреНрд░рдо рд╕рдВрдЦреНрдпрд╛; <br><br>  4. * рдЖрдИрдкреА ipsec рдиреАрддрд┐ <br><br>  рд░рд╛рдЬрдиреАрддрд┐ рдореЗрдВ, рд╣рдо рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рддреЗ рд╣реИрдВ: <br><br><ul><li>  Dstред  рдкрддрд╛ - Kerio рдХреЗ рдкреАрдЫреЗ рдиреЗрдЯрд╡рд░реНрдХ рдкрддрд╛ (dst-address); </li><li>  Srcред  рдкрддрд╛ - рд╡рд╣ рдиреЗрдЯрд╡рд░реНрдХ рдкрддрд╛ рдЬрд┐рд╕рдХреЗ рд▓рд┐рдП рдорд┐рдХреНрд░реЛрдЯрд┐рдХ рдорд╛рд╕реНрдХ рд╣реЛрдЧрд╛ (IP рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рджреЗрдЦреЗрдВ ---&gt; рдлрд╝рд╛рдпрд░рд╡реЙрд▓ ---&gt; NAT рдиреАрдЪреЗ) рдЗрд╕рдХрд╛ рд╕реНрдерд╛рдиреАрдп рдиреЗрдЯрд╡рд░реНрдХ (src-address)ред  рдпрд╣ рдиреЗрдЯрд╡рд░реНрдХ рдкрддрд╛ Kerio рдХреА рдУрд░ рд╕реЗ рджрд┐рдЦрд╛рдИ рджреЗрдЧрд╛ (рд╣рдордиреЗ рдЗрд╕реЗ рддрдм рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд┐рдпрд╛ рдерд╛ рдЬрдм рд╣рдордиреЗ Kerio рдкрд░ VPN рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдХреЛ рджреВрд░рд╕реНрде рдиреЗрдЯрд╡рд░реНрдХ рдЯреИрдм рдкрд░ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдерд╛); </li><li>  рдкреНрд░реЛрдЯреЛрдХреЙрд▓ - 255 (рд╕рднреА); </li><li>  рдХреНрд░рд┐рдпрд╛ - рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ; </li><li>  рд╕реНрддрд░ - рдЖрд╡рд╢реНрдпрдХрддрд╛; </li><li>  IPSec рдкреНрд░реЛрдЯреЛрдХреЙрд▓ - esp; </li><li>  рдкреИрд░рд╛рдореАрдЯрд░ рд╕реБрд░рдВрдЧ рд╕реЗрдЯ рдХрд░реЗрдВ = рд╣рд╛рдБ; </li><li>  SA Srcред  рдкрддрд╛ - рдорд┐рдХреНрд░реЛрдЯрд┐рдХ рдХрд╛ рдмрд╛рд╣рд░реА рдЖрдИрдкреА рдкрддрд╛, рдЬрд┐рд╕рдореЗрдВ рд╕реЗ рдХреЗрд░рд┐рдпреЛ рдПрдХреНрд╕реЗрд╕ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ (sa-src-address); </li><li>  SA Dstред  рдкрддрд╛ - рдХреЗрд░реАрдУ рдХрд╛ рдЖрдИрдкреА рдкрддрд╛, рдЬрд┐рд╕рдХреЗ рд▓рд┐рдП рдорд┐рдХреНрд░реЛрдЯрд┐рдХ рд╕реЗ рд╕рдВрдкрд░реНрдХ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ (sa-dst-address); </li><li>  рдкреНрд░рд╕реНрддрд╛рд╡ - / рдЖрдИрдкреА ipsec рдкреНрд░рд╕реНрддрд╛рд╡ рдЕрдиреБрднрд╛рдЧ рдореЗрдВ рдирд╛рдо рдкреИрд░рд╛рдореАрдЯрд░ рдХреЛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдорд╛рди рджрд░реНрдЬ рдХрд░реЗрдВ (рдЗрд╕ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдореЗрдВ - KerioVPNProposal # 01); </li><li>  рдЯрд┐рдкреНрдкрдгреА ( <b>рдЪреЗрддрд╛рд╡рдиреА! рд▓рд┐рдкрд┐рдпреЛрдВ рдореЗрдВ рдкреНрд░рдпреБрдХреНрдд!</b> ) - KerioVPNPolicyред </li></ul><br>  рдпрджрд┐ рд╕рдм рдХреБрдЫ рд╕рд╣реА рдврдВрдЧ рд╕реЗ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдкреЙрд▓рд┐рд╕реА рдХреЛ рдмрдЪрд╛рдиреЗ рдХреЗ рдмрд╛рдж, "PH2 рд░рд╛рдЬреНрдп" рдлрд╝реАрд▓реНрдб рдореЗрдВ "рд╕реНрдерд╛рдкрд┐рдд" рдорд╛рди рджрд┐рдЦрд╛рдИ рджреЗрдирд╛ рдЪрд╛рд╣рд┐рдП, рдЬреЛ рдХрд┐ рдорд┐рдХреНрд░реЛрдЯрд┐рдХ рдФрд░ рдХреЗрд░рд┐рдУ рдХреЗ рдмреАрдЪ рд╡реАрдкреАрдПрди рдЪреИрдирд▓ рдХреА рд╕реНрдерд╛рдкрдирд╛ рдХреЛ рдЗрдВрдЧрд┐рдд рдХрд░рддрд╛ рд╣реИред <br>  рдЖрдк рдХреЗрд░реАрдУ рдХрдВрдЯреНрд░реЛрд▓ рдореЗрдВ рд╡реАрдкреАрдПрди рдЗрдВрдЯрд░рдлреЗрд╕ рдХреА рд╕реНрдерд┐рддрд┐ рдХреА рдЬрд╛рдВрдЪ рдХрд░рдХреЗ рдЗрд╕реЗ рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рд╡рд╣рд╛рдВ, "рд╕реВрдЪрдирд╛" рдлрд╝реАрд▓реНрдб рдореЗрдВ, рдЬрд┐рд╕ рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рд╕реЗ рдХрдиреЗрдХреНрд╢рди рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдЙрд╕рдХреЗ рд╡рд┐рдкрд░реАрдд, рд╢рд┐рд▓рд╛рд▓реЗрдЦ "IP_your_MikroTik рдкрд░ рд╕реНрдерд╛рдкрд┐рдд рд╣реИ" рджрд┐рдЦрд╛рдИ рджреЗрдирд╛ рдЪрд╛рд╣рд┐рдПред <br><br>  рд╣рдо рдЬрд╛рд░реА рд░рдЦрддреЗ рд╣реИрдВ ... <br><br>  рдЕрдм рд╣рдо рдХреЗрд░реАрдУ-рд╕рд░реНрд╡рд░ рдХреЗ рд╕рднреА рд╢реЗрд╖ рдЖрдИрдкреА рдкрддреЗ рдХреЗ рд▓рд┐рдП рд╕рд╛рдерд┐рдпреЛрдВ рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдХрд░реЗрдВрдЧреЗ (рдореЗрд░реЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдореЗрдВ рддреАрди рдФрд░ рд╕рд╛рдерд┐рдпреЛрдВ рдХреЛ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рд╣реИ)ред <br><br>  рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рдкреИрд░рд╛рдЧреНрд░рд╛рдл 3 (/ ip ipsec peer) рдореЗрдВ рджрд┐рдП рдЧрдП рд╕рднреА рдЪрд░рдгреЛрдВ рдХреЛ рджреЛрд╣рд░рд╛рдирд╛ рд╣реЛрдЧрд╛, рд▓реЗрдХрд┐рди рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдмрд╛рддреЛрдВ рдкрд░ рдзреНрдпрд╛рди рджреЗрдВ: <br><br><ul><li>  рдкрддрд╛ - рдХреЗрд░рд┐рдУ рдХрд╛ рдЖрдИрдкреА рдкрддрд╛ рдмрджрд▓реЗрдВ; </li><li>  рдЧреБрдкреНрдд - рдмрдирд╛рдпрд╛ рдЬрд╛ рд░рд╣рд╛ рд╣реИ (pass2222, pass3333, ... passNNNN) рдХрдиреЗрдХреНрд╢рди рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рдкрд╛рд╕рдлрд╝реНрд░реЗрдЬрд╝ рджрд░реНрдЬ рдХрд░реЗрдВ; </li><li>  рдиреАрддрд┐ рдЯреЗрдореНрдкрд▓реЗрдЯ рд╕рдореВрд╣ - рд╕реВрдЪреА рд╕реЗ рдЕрдЧрд▓реЗ рд╕рдореВрд╣ рдХрд╛ рдЪрдпрди рдХрд░реЗрдВ (2, 3, ... n)ред </li></ul><br>  <b>рдиреЛрдЯ:</b> <br><br>  рдлрд┐рд░ рдЖрдк рдкреАрдпрд░ рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдореЗрдВ рд╕рдореВрд╣ рдХреЛ рдмрджрд▓рдХрд░ рдХрд┐рд╕реА рднреА рд╕рдордп рдЕрдкрдиреЗ рд╕рд░реНрд╡рд░ рдХреА рдкреНрд░рд╛рдердорд┐рдХрддрд╛ рдмрджрд▓ рд╕рдХрддреЗ рд╣реИрдВред <br><br><ul><li>  рдЯрд┐рдкреНрдкрдгреА - рдореЗрд░реЗ рдорд╛рдорд▓реЗ рдореЗрдВ рдпрд╣ рдПрдХ рдФрд░ Kerio рд╕рд░реНрд╡рд░ FQDN рдореЗрдВ рдмрджрд▓ рдЬрд╛рддрд╛ рд╣реИред </li></ul><br>  рдЕрдиреНрдп рд╕рднреА рдорд╛рдкрджрдВрдбреЛрдВ рдХреЛ рдкрд╣рд▓реЗ рджрд╛рд╡рдд рдХреЗ рд░реВрдк рдореЗрдВ рджрд░реНрдЬ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдЬрд┐рдиреНрд╣реЗрдВ рдмрджрд▓рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреА рдЙрдиреНрд╣реЗрдВ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рджреНрд╡рд╛рд░рд╛ рд╕рдВрд╕рд╛рдзрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдЖрдк рдЙрдиреНрд╣реЗрдВ рдЕрднреА рдХреЗ рд▓рд┐рдП рдЕрдкрд░рд┐рд╡рд░реНрддрд┐рдд рдХреЙрдкреА рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред <br><br>  рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЛ рдХрд╛рдо рд╕реЗ рдЬреЛрдбрд╝рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдиреЗ рдХрд╛ рдЕрдВрддрд┐рдо рдЪрд░рдг рдорд┐рдХреНрд░реЛрдЯрд┐рдХ рдХреЛ рд╕реНрдерд┐рд░рд╛рдВрдХ рдХреЗ рднрдВрдбрд╛рд░ рдХреЗ рд░реВрдк рдореЗрдВ рдХрд╛рдо рдХрд░рдирд╛ рд╣реИ, рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рд╣рдо рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдореЗрдВ рдХрд░реЗрдВрдЧреЗ ... <br>  рдлрд╝рд╛рдпрд░рд╡реЙрд▓ рдкрддрд╛ рд╕реВрдЪрд┐рдпреЛрдВ рдореЗрдВ рджреЛ рд╕реВрдЪрд┐рдпрд╛рдБ рдЬреЛрдбрд╝реЗрдВ ( <b>рдЪреЗрддрд╛рд╡рдиреА! рд▓рд┐рдкрд┐рдпреЛрдВ рдореЗрдВ рдкреНрд░рдпреБрдХреНрдд!</b> ): <br><br><pre> <code class="plaintext hljs">/ip firewall address-list add address=192.168.22.0/24 list=vs01 add address=192.168.33.0/24 list=vs02</code> </pre> <br>  рдЙрдирдореЗрдВ рд╣рдо Kerio- рд╕рд░реНрд╡рд░ рдирд╛рдо рдЙрдкрд╕рд░реНрдЧреЛрдВ рдХреЗ рд╕рдВрджрд░реНрдн рдореЗрдВ рдиреЗрдЯрд╡рд░реНрдХ рдХреЗ рдкрддреЗ рджрд░реНрд╢рд╛рддреЗ рд╣реИрдВ, рдЬрд┐рд╕рдореЗрдВ рд╣рдо рдЖрдЙрдЯрдЧреЛрдЗрдВрдЧ рд╡реАрдкреАрдПрди рдЯреНрд░реИрдлрд╝рд┐рдХ рдХреЛ рдореИрдк рдХрд░реЗрдВрдЧреЗред <br><br>  рдЦреИрд░, рдЗрд╕ рд╕рднреА рдЕрдкрдорд╛рди рдХреЗ рдХрд╛рдо рдХреЛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рджреЛ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдФрд░ рддреАрди рд╢реЗрдбреНрдпреВрд▓ рдЬреЛрдбрд╝рддреЗ рд╣реИрдВ <b>(рдпрджрд┐ рдЖрдк рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХрд╛ рдирд╛рдо рдмрджрд▓рдиреЗ рдХрд╛ рдирд┐рд░реНрдгрдп рд▓реЗрддреЗ рд╣реИрдВ, рддреЛ рдХреЛрдб рдореЗрдВ рдЙрдЪрд┐рдд рдмрджрд▓рд╛рд╡ рдХрд░рдирд╛ рди рднреВрд▓реЗрдВ)</b> ред <br><br><pre> <code class="plaintext hljs">/system script add dont-require-permissions=no name=scriptFunctionsList owner=admin policy=ftp,reboot,read,write,policy,test,password,sniff,sensitive,romon</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">рд╕реНрдХреНрд░рд┐рдкреНрдЯрд┐рдВрдЧ рд▓рд┐рдкрд┐ ScriptFunctionsList</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">#   IP --&gt; Cloud   DNS- #  : # # $start (true/false); # #  ""  "updated" :global subUpdateCloudDns do={ put ($start); :if ($start=false) do={ set $CloudDnsStatus; #     set $m 1; log warning ("[subUpdateCloudDns] ---&gt; DDNS  ---&gt;  "); #log warning ("[subUpdateCloudDns] ---&gt; DDNS status ---&gt; CHECK STARTED"); do { log warning ("[subUpdateCloudDns] ---&gt; DDNS ,  ---&gt; " . $m); [/ip cloud force-update]; delay 30000ms; set $CloudDnsStatus ([/ip cloud get status]); set $m ($m+1); :if ($CloudDnsStatus="updated") do={ log warning ("[subUpdateCloudDns] ---&gt; DDNS  ---&gt; " . $CloudDnsStatus); #log warning ("[subUpdateCloudDns] ---&gt; DDNS status ---&gt; " . $CloudDnsStatus); } else={ log error ("[subUpdateCloudDns] ---&gt; DDNS  ---&gt; " . $CloudDnsStatus); #log error ("[subUpdateCloudDns] ---&gt; DDNS status ---&gt; " . $CloudDnsStatus); } } while=(($CloudDnsStatus!="updated") and ($m&lt;10)); return ($CloudDnsStatus); } } #    IP --&gt; Cloud #   : # # 0 - ; # 1 - ,   ; # 2 -    :global subCheckCloudDDNS do={ set $CloudDnsActive ([/ip cloud get ddns-enabled]); #  - ( $m=0 ) set $m 0; :if ($CloudDnsActive=yes) do { #  IP---&gt;Cloud  ( $m=1 ) set $m ($m+1); set $CloudDnsStatus ([/ip cloud get status]); #    IP- (  IP---&gt;Cloud    DNS) set $CloudDnsIP ([/ip cloud get public-address]); set $CheckIpAddr ([resolve [/ip cloud get dns-name]]); :if ($CloudDnsIP!=$CheckIpAddr) do={ #  IP  (  MikroTik  )... set $CloudDnsStatus "updating..."; } :if ($CloudDnsStatus="updated") do { #  IP---&gt;Cloud    ( $m=2 ) set $m ($m+1); } } return ($m); } #       #  : # # $ScriptName ( ) :global subRepeatScript do={ put ($ScriptName); :if ($ScriptName!="") do { [/system script run $ScriptName]; } } #     VPN-   # #   IP- VPN-     :global subGetVpnServers do={ #    IP- VPN-        :foreach IpSecPeerId in=[/ip ipsec peer find passive!=yes] do={ set $CheckIpAddr [/ip ipsec peer get $IpSecPeerId address]; :if ($CheckIpAddr!="") do={ set $MaskPos [find $CheckIpAddr "/"]; set $GroupFromPeer ([/ip ipsec peer get $IpSecPeerId policy-template-group]); set $IpFromPeer ([pick $CheckIpAddr 0 $MaskPos]); set $VpnServersList ($VpnServersList, {{$GroupFromPeer; $IpFromPeer}}); } } return ($VpnServersList); } #        # #    ID   :global subDisableIpSecPeers do={ # ...  ,  (passive=false) ... :foreach IpSecPeerId in=[/ip ipsec peer find passive!=yes] do={ log warning ("[IP IPSec Peer] ---&gt;    ---&gt; " . [/ip ipsec peer get $IpSecPeerId comment]); #log warning ("[IP IPSec Peer] ---&gt; processed peer on ---&gt; " . [/ip ipsec peer get $IpSecPeerId comment]); #  address   ... set $CheckIpAddr [/ip ipsec peer get $IpSecPeerId address]; :if ($CheckIpAddr!="") do={ #  address  ,  IP-  ... set $MaskPos ([find $CheckIpAddr "/"]); set $CheckIpAddr ([pick $CheckIpAddr 0 $MaskPos]); # ...   IPSec- :foreach IpSecPolicyId in=[/ip ipsec policy find sa-dst-address=$CheckIpAddr] do={ :if ($IpSecPolicyId!="") do={ :if ([/ip ipsec policy get $IpSecPolicyId disabled]!=yes) do={ [/ip ipsec policy disable $IpSecPolicyId]; log warning ("[IP IPSec Policy] ---&gt;  " . [/ip ipsec policy get $IpSecPolicyId comment] . " "); #log warning ("[IP IPSec Policy] ---&gt; policy " . [/ip ipsec policy get $IpSecPolicyId comment] . " deactivated"); } #    ID     set $IdList ($IdList, $IpSecPolicyId); } } } # :     ,      :if ([/ip ipsec peer get $IpSecPeerId disabled]!=yes) do={ [/ip ipsec peer disable $IpSecPeerId]; log warning ("[IP IPSec Peer] ---&gt; " . [/ip ipsec peer get $IpSecPeerId comment] . " ---&gt; "); #log warning ("[IP IPSec Peer] ---&gt; " . [/ip ipsec peer get $IpSecPeerId comment] . " ---&gt; deactivated"); } } return ($IdList); } #        #  : # # $PeerID (ID   VPN-); # $PolIdList ( ID  $subDisableIpSecPeers); # $CloudIP (IP MikroTik  DDNS); # $SrcIP (src-address    VPN-) :global subEnableIpSecPeers do={ put ($PeerID); put ($PolIdList); put ($CloudIP); :if (($PeerID!="")&amp;&amp;($PeerID!=nil)&amp;&amp;($PolIdList!="")&amp;&amp;($PolIdList!=nil)&amp;&amp;($CloudIP!="")&amp;&amp;($CloudIP!=nil)) do={ #   VPN- set $ActiveVPN [/ip ipsec peer get $PeerID address]; :if ($ActiveVPN!="") do={ #  ,  IP-   set $MaskPos [find $ActiveVPN "/"]; set $ActiveVPN ([pick $ActiveVPN 0 $MaskPos]); } #   ,      :if ([/ip ipsec peer get $PeerID disabled]=yes) do={ delay 5000ms; [/ip ipsec peer enable $PeerID]; log warning ("[IP IPSec Peer] ---&gt;  peer  ---&gt; " . [/ip ipsec peer get $PeerID address]); #log warning ("[IP IPSec Peer] ---&gt; activated peer on ---&gt; " . [/ip ipsec peer get $PeerID address]); } #    ID   PolIdList, ,    Src. Address, SA Src. Address  SA Dst. Address,   :foreach IpSecPolicyId in=$PolIdList do={ :if ($IpSecPolicyId!="") do={ :if ([/ip ipsec policy get $IpSecPolicyId src-address]!=$SrcIP) do={ [/ip ipsec policy set $IpSecPolicyId src-address=$SrcIP]; log warning ("[IP IPSec Policy] ---&gt;  src-address"); #log warning ("[IP IPSec Policy] ---&gt; src-address changed"); } :if ([/ip ipsec policy get $IpSecPolicyId sa-src-address]!=$CloudIP) do={ [/ip ipsec policy set $IpSecPolicyId sa-src-address=$CloudIP]; log warning ("[IP IPSec Policy] ---&gt;  sa-src-address"); #log warning ("[IP IPSec Policy] ---&gt; sa-src-address changed"); } :if ([/ip ipsec policy get $IpSecPolicyId sa-dst-address]!=$ActiveVPN) do={ [/ip ipsec policy set $IpSecPolicyId sa-dst-address=$ActiveVPN]; log warning ("[IP IPSec Policy] ---&gt;  sa-dst-address"); #log warning ("[IP IPSec Policy] ---&gt; sa-dst-address changed"); } :if ([/ip ipsec policy get $IpSecPolicyId disabled]=yes) do={ delay 3000ms; [/ip ipsec policy enable $IpSecPolicyId]; log warning ("[IP IPSec Policy] ---&gt;  "); #log warning ("[IP IPSec Policy] ---&gt; policy activated"); #  DNS- [/ip dns cache flush] } } } } } #      ID  #  : # # $PeerIP (IP    ); # $CloudIP (IP MikroTik  DDNS); # $action (enable/disable/skip) # #    ID,   ,  :global subGetPoliciesByPeer do={ put ($PeerIP); put ($CloudIP); put ($action); :if (($action="")||($action=nil)) do={ set $action "skip"; } :foreach IpSecPolicyId in=[/ip ipsec policy find sa-dst-address=$PeerIP] do={ :if ($IpSecPolicyId!="") do={ #     $action=disable,   :if (([/ip ipsec policy get $IpSecPolicyId disabled]!=yes)&amp;&amp;($action="disable")) do={ [/ip ipsec policy disable $IpSecPolicyId]; log warning ("[IP IPSec Policy] ---&gt;  "); #log warning ("[IP IPSec Policy] ---&gt; policy deactivated"); } #     $CloudIP  sa-src-address!=$CloudIP ( ISP),     sa-src-address :if (($CloudIP!="")&amp;&amp;($CloudIP!=nil)&amp;&amp;([/ip ipsec policy get $IpSecPolicyId sa-src-address]!=$CloudIP)) do={ [/ip ipsec policy disable $IpSecPolicyId]; [/ip ipsec policy set $IpSecPolicyId sa-src-address=$CloudIP]; log warning ("[IP IPSec Policy] ---&gt;   ---&gt;  sa-src-address ---&gt; " . $CloudIP); #log warning ("[IP IPSec Policy] ---&gt; policy deactivated ---&gt; new sa-src-address ---&gt; " . $CloudIP); #   ,  Kerio   delay 30000ms; } #     $action=enable,   :if (([/ip ipsec policy get $IpSecPolicyId disabled]=yes)&amp;&amp;($action="enable")) do={ [/ip ipsec policy enable $IpSecPolicyId]; log warning ("[IP IPSec Policy] ---&gt;  "); #log warning ("[IP IPSec Policy] ---&gt; policy activated"); #  DNS- [/ip dns cache flush] } #    ID     set $IdList ($IdList, $IpSecPolicyId); } } return ($IdList); } #   local-address  #  : # # $PeerID (ID   VPN-); # $CloudIP (IP MikroTik  DDNS) :global subCheckPeerLocalIp do={ put ($PeerID); put ($CloudIP); :if (($PeerID!="")&amp;&amp;($PeerID!=nil)&amp;&amp;($CloudIP!="")&amp;&amp;($CloudIP!=nil)) do={ #   DDNS-IP :if ([/ip ipsec peer get $PeerID local-address]!=$CloudIP) do={ [/ip ipsec peer set $PeerID local-address=$CloudIP]; log warning ("[IP IPSec Peer] ---&gt;  local-address"); #log warning ("[IP IPSec Peer] ---&gt; local-address changed"); } } }</code> </pre> <br></div></div><br><pre> <code class="plaintext hljs">/system script add dont-require-permissions=no name=scriptCheckActiveVpnServer owner=admin policy=ftp,reboot,read,write,policy,test,password,sniff,sensitive,romon</code> </pre><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕реНрдХреНрд░рд┐рдкреНрдЯ рд▓рд┐рд╕реНрдЯрд┐рдВрдЧ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдЪреЗрдХрдЪреЗрдХрдПрдХреНрдЯрд┐рд╡ рд╡реАрдкреАрдПрди рд╕реЗрд╡рд░</font></font></b> <div class="spoiler_text"><pre> <code class="plaintext hljs">:if ([:len [/system script job find script=scriptCheckActiveVpnServer]]&gt;1) do={ :error } #      scheduleStartup #   ,       :global subCheckCloudDDNS :global subCheckPeerLocalIp :global subDisableIpSecPeers :global subEnableIpSecPeers :global subGetPoliciesByPeer :global subGetVpnServers :global subUpdateCloudDns :local CheckIP :local CheckPeer #     DDNS ( ) :local CloudDnsStatus ([:put [$subCheckCloudDDNS]]) :local Exit false :local DefMikroTikSrcNet 192.168.11.0/24 :local DefKerioDstNet 192.168.77.0/24 :local DefKerioPropName KerioVPNProposal#01 :local DefKerioPolName KerioVPNPolicy :local IpSecPolicyId :local KerioName :local KerioVpnNatRuleName KerioVpnNatOut :local m :local n 1 :local PeerCount 0 :local PeerDisabled :local PingCount 3 :local PingResult :local PoliciesList :local PublicIp :local VpnServersList #   DDNS ,  ,    IP- MikroTik :if ($CloudDnsStatus=0) do={ #  Cloud DDNS  ,         :log error ("[schedule CheckActiveVpnServer] ---&gt;    VPN-   Cloud DDNS! (IP -&gt; Cloud)") # :log error ("[schedule CheckActiveVpnServer] ---&gt; to connect to the VPN server, you need to activate Cloud DDNS! (IP -&gt; Cloud)") :error } :if ($CloudDnsStatus=1) do={ #  Cloud DDNS ,   ,   ( ) :set CloudDnsStatus [:put [$subUpdateCloudDns start=false]] :if ($CloudDnsStatus="updated") do={ :set CloudDnsStatus 2 } } :if ($CloudDnsStatus=2) do { #  Cloud DDNS    ... #  IP  DDNS :set PublicIp [/ip cloud get public-address] #   VPN-  ,    ( ) :set VpnServersList ([:put [$subGetVpnServers]]) #     :foreach VpnIpId in=$VpnServersList do={ :set PeerCount ($PeerCount+1) } #   VPN-    DDNS-IP ( ,   VPN-    ) :while (($Exit!=true)&amp;&amp;$n&lt;=$PeerCount) do={ :foreach VpnIpId in=$VpnServersList do={ #  IP- VPN-    :if (($VpnIpId-&gt;0)=$n) do={ :set CheckIP ($VpnIpId-&gt;1) :if ($CheckIP!="") do={ #    IP :set PingResult ([:put [/ping address=$CheckIP count=$PingCount src-address=$PublicIp]]) :if ($PingResult=$PingCount) do={ :log warning ("[schedule CheckActiveVpnServer] ---&gt; DDNS-IP ---&gt; " . $PublicIp . " ---&gt; VPN-IP ---&gt; " . $CheckIP . " ---&gt; Ping Result ---&gt; " . $PingResult) #  IP ,     IP- :set CheckPeer (:put [/ip ipsec peer find address=($CheckIP . "/32")]) :if ($CheckPeer!="") do={ #   ,     src- (IP ---&gt; Firewall ---&gt; Address Lists),     Kerio #    Kerio    :set KerioName [/ip ipsec peer get $CheckPeer comment] #    (  ,  FQDN  Kerio   KerioName-Parameter1-...-Parameter_n :if ($KerioName!="") do={ #    :set m ([find $KerioName "-"]) #  KerioName    :set KerioName ([pick $KerioName 0 $m]) #    Firewall -&gt; Address List (       : # Name ---&gt; KerioName (eg srv1) # Address ---&gt; DefMikroTikSrcNet (eg 192.168.99.0/24)) :set m [/ip firewall address-list find list=$KerioName] :set DefMikroTikSrcNet ([/ip firewall address-list get $m address]) } # ...          Kerio :set IpSecPolicyId (:put [/ip ipsec policy find comment="$DefKerioPolName"]) #      ,       # (    )         :if ($IpSecPolicyId="") do={ [/ip ipsec policy add disabled=yes dst-address=$DefKerioDstNet proposal=$DefKerioPropName sa-dst-address=$CheckIP sa-src-address=$PublicIp src-address=$DefMikroTikSrcNet tunnel=yes comment=$DefKerioPolName place-before=0] :log warning ("[schedule CheckActiveVpnServer] ---&gt;   " . $DefKerioPolName . " ---&gt;    ") #:log warning ("[schedule CheckActiveVpnServer] ---&gt; created policy " . $DefKerioPolName . " ---&gt; default parameters used") } else={ #   ,     src-address,   . :if ($DefMikroTikSrcNet!=[/ip ipsec policy get $IpSecPolicyId src-address]) do={ [/ip ipsec policy set $IpSecPolicyId src-address=$DefMikroTikSrcNet]; :log warning ("[schedule CheckActiveVpnServer] ---&gt;  " . $DefKerioPolName . "  ---&gt; src-address   ---&gt; " . $DefMikroTikSrcNet) #:log warning ("[schedule CheckActiveVpnServer] ---&gt; policy " . $DefKerioPolName . " changed ---&gt; src-address changed to ---&gt; " . $DefMikroTikSrcNet) } } #   :set m #  NAT-      Kerio  :set m [/ip firewall nat find comment=$KerioVpnNatRuleName] :if ($m!="") do={ #   src-address   ipsec,       Kerio  :if ([/ip firewall nat get $m to-addresses]!=$DefMikroTikSrcNet) do={ [/ip firewall nat set $m to-addresses $DefMikroTikSrcNet] :log warning ("[IP Firewall NAT] ---&gt;    ---&gt; " . $KerioVpnNatRuleName) #:log warning ("[IP Firewall NAT] ---&gt; netmap rule changed ---&gt; " . $KerioVpnNatRuleName) } } # ... local-address      IP MikroTik,    ( ) :put [$subCheckPeerLocalIp PeerID=$CheckPeer CloudIP=$PublicIp] # ...    :set PeerDisabled ([/ip ipsec peer get $CheckPeer disabled]) :if ($PeerDisabled=true) do={ #   ... #       ( ) :set PoliciesList ([:put [$subDisableIpSecPeers]]) #     VPN-   ( ) :put [$subEnableIpSecPeers PeerID=$CheckPeer PolIdList=$PoliciesList CloudIP=$PublicIp SrcIP=$DefMikroTikSrcNet] } else={ #   ... #      ,    ( ) :set PoliciesList ([:put [$subGetPoliciesByPeer PeerIP=$CheckIP CloudIP=$PublicIp SrcIP=$DefMikroTikSrcNet action="enable"]]) } :set Exit true } } else={ :log error ("[schedule CheckActiveVpnServer] ---&gt; DDNS-IP ---&gt; " . $PublicIp . " ---&gt; VPN-IP ---&gt; " . $CheckIP . " ---&gt; Ping Result ---&gt; " . $PingResult) } } } } :set n ($n+1) } }</code> </pre><br></div></div><br><pre> <code class="plaintext hljs">/system scheduler add interval=1h name=scheduleCheckIPSecSADstAddrFromDNS on-event=\ "/system script run scriptSetIPSecSADstAddrFromDNS" policy=read,write \ start-date=oct/30/2017 start-time=00:10:00 add name=scheduleStartup on-event=":global StartupScript true :global RepeatRun false /system script run scriptFunctionsList" policy=\ ftp,reboot,read,write,policy,test,password,sniff,sensitive,romon \ start-time=startup add interval=5m name=scheduleCheckActiveVpnServer on-event=\ "/system script run scriptCheckActiveVpnServer" policy=\ ftp,reboot,read,write,policy,test,password,sniff,sensitive,romon \ start-date=nov/29/2017 start-time=00:00:00</code> </pre><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╢реЗрдбреНрдпреВрд▓ рд▓рд┐рд╕реНрдЯрд┐рдВрдЧ рд╢реЗрдбреНрдпреВрд▓рд╕реНрдЯрд╛рд░реНрдЯрдЕрдк</font></font></b> <div class="spoiler_text"><pre> <code class="plaintext hljs">:global StartupScript true :global RepeatRun false /system script run scriptFunctionsList</code> </pre><br></div></div><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕реВрдЪреАрдХрд░рдг рд╕реВрдЪреА рдЕрдиреБрд╕реВрдЪреА</font></font></b> <div class="spoiler_text"><pre> <code class="plaintext hljs">/system script run scriptSetIPSecSADstAddrFromDNS</code> </pre><br></div></div><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕реВрдЪреАрдХрд░рдг рд╕реВрдЪреА рдЕрдиреБрд╕реВрдЪреА</font></font></b> <div class="spoiler_text"><pre> <code class="plaintext hljs">/system script run scriptCheckActiveVpnServer</code> </pre><br></div></div><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдВрддрд┐рдо рд╕реНрдкрд░реНрд╢:</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╕рд╣реА рдврдВрдЧ рд╕реЗ Kerio рдХрдВрдЯреНрд░реЛрд▓ рдХреЗ рдкреАрдЫреЗ рд╕реНрдерд┐рдд рдПрдВрдЯрд░рдкреНрд░рд╛рдЗрдЬрд╝ DNS рд╕рд░реНрд╡рд░ рд╕реЗ рд╕рдВрдкрд░реНрдХ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдорд┐рдХреНрд░реЛрдЯрд┐рдХ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рдЖрдИрдкреА ---&gt; DNS ---&gt; рд╕реНрдЯреЗрдЯрд┐рдХ рд╕реЗрдХреНрд╢рди ... рдореЗрдВ рдорд┐рдХреНрд░реЛрдЯрд┐рдХ рдореЗрдВ рдЕрдкрдиреЗ рдкрддреЛрдВ рдХреЗ рд╕рд╛рде рд╕реНрдереИрддрд┐рдХ рд░рд┐рдХреЙрд░реНрдб рдЬреЛрдбрд╝рдиреЗ рдХреА рдЬрд░реВрд░рдд рд╣реИ ... </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЦреИрд░, рдХрд╣реАрдВ рдРрд╕рд╛ рд╣реА! </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдореБрдЭреЗ рдЖрд╢рд╛ рд╣реИ рдХрд┐ рдореИрдВрдиреЗ рдХрднреА рдЧрд▓рддреА рдирд╣реАрдВ рдХреА рд╣реИ рдФрд░ рдХреБрдЫ рднреА рдирд╣реАрдВ рднреВрд▓ рдЧрдпрд╛ ...</font></font><br><br>  рдЖрдкрдХрд╛ рдзреНрдпрд╛рди рдХреЗ рд▓рд┐рдП рдзрдиреНрдпрд╡рд╛рдж! <br><br>  ps <br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдВрдкрд╛рджрди рдФрд░ рдкрд░рд┐рд╡рд░реНрддрди рдХрд╛ рдЗрддрд┐рд╣рд╛рд╕:</font></font></b> <br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЬреЛрдбрд╝рд╛ рдЧрдпрд╛ рдЕрдиреБрднрд╛рдЧ "рд╣рдореЗрдВ рдЖрдЙрдЯрдкреБрдЯ рдореЗрдВ рдХреНрдпрд╛ рдорд┐рд▓рддрд╛ рд╣реИ ?:"; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдореВрд▓ рдХрдВрдкрдиреА рдХреЗ рдиреЗрдЯрд╡рд░реНрдХ рдкрддреЗ рдкрд░ рдПрдХ рдЯрд┐рдкреНрдкрдгреА рдЬреЛрдбрд╝реА рдЧрдИ рд╣реИ; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рд╡рд┐рд╡рд░рдг рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЧрдП рдЖрдИрдПрд╕рдкреА рдкреВрд▓ рд╕реЗ рдиреЗрдЯрд╡рд░реНрдХ рдХреЗ рдЖрдИрдкреА рдкрддреЗ рдХреЛ рдмрджрд▓ рджрд┐рдпрд╛; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЬреЛрдбрд╝рд╛ рдЧрдпрд╛ рдЖрдЗрдЯрдо "рдлрд┐рдирд┐рд╢рд┐рдВрдЧ рдЯрдЪ:"; </font></font></li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi439736/">https://habr.com/ru/post/hi439736/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi439726/index.html">рд▓реЙрдХ-рдЗрди: рд╕рд╣реА рдпрд╛ рдХрд╛рд▓реНрдкрдирд┐рдХ?</a></li>
<li><a href="../hi439728/index.html">Zextras рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдмрд┐рдирд╛ рдкреВрд░реНрдг рдФрд░ рдЕрд▓рдЧ Acronra OSE рдмреИрдХрдЕрдк рдФрд░ рдкреБрдирд░реНрдкреНрд░рд╛рдкреНрддрд┐ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░реЗрдВ</a></li>
<li><a href="../hi439730/index.html">рдПрдХ рдорд╛рдирдХ рд╡рд░реНрдЧ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ reducer рдХрд╛ рд╕рдВрдЧрдарди</a></li>
<li><a href="../hi439732/index.html">рд▓рд╛рдЬрд░ - TImageFragment рдШрдЯрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП рд╕рд░рд▓ рдПрдиреАрдореЗрд╢рди</a></li>
<li><a href="../hi439734/index.html">MicroK8s рдХреЗ рд╕рд╛рде рдорд┐рдирдЯреЛрдВ рдореЗрдВ рдбреЗрд╕реНрдХрдЯреЙрдк рдкрд░ Kubernetes рддреИрдирд╛рдд рдХрд░рдирд╛</a></li>
<li><a href="../hi439738/index.html">"рдЕрдЪреНрдЫреА рддрд░рд╣ рд╕реЗ рдХрд░реЗрдВ" рдмрдЯрди рдХреА рддрд▓рд╛рд╢ рдореЗрдВред рдЫреЛрдЯреЗ рдФрд░ рдордзреНрдпрдо рдЖрдХрд╛рд░ рдХреЗ рд╡реНрдпрд╡рд╕рд╛рдпреЛрдВ рдХреЗ рдиреЗрдЯрд╡рд░реНрдХ рдореЗрдВ Zyxel</a></li>
<li><a href="../hi439742/index.html">ITMO рд╡рд┐рд╢реНрд╡рд╡рд┐рджреНрдпрд╛рд▓рдп рдореЗрдВ рдорд╛рд╕реНрдЯрд░ рдкреНрд░реЛрдЧреНрд░рд╛рдо JetBrains рдореЗрдВ рдкреНрд░рд╡реЗрд╢</a></li>
<li><a href="../hi439744/index.html">рдПрдордЖрдИрдЯреА рдХреЗ рд╢реЛрдзрдХрд░реНрддрд╛рдУрдВ рдиреЗ "рд░реЗрдХреНрдЯреЗрдирд╛" рдбрд┐рдЬрд╛рдЗрди рдХрд┐рдпрд╛ рдЬреЛ рд╡рд╛рдИ-рдлрд╛рдИ рд╕рд┐рдЧреНрдирд▓ рдХреЛ рдмрд┐рдЬрд▓реА рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрд┐рдд рдХрд░рддрд╛ рд╣реИ</a></li>
<li><a href="../hi439746/index.html">рдЬрд╛рд╡рд╛рд╕реНрдХреНрд░рд┐рдкреНрдЯ рд╡рд╛рджреЗ рдХреЛ рд╕рдордЭрдирд╛</a></li>
<li><a href="../hi439748/index.html">рдореЛрдмрд╛рдЗрд▓ # 285 рдбреЗрд╡рд▓рдкрд░ рдХреЗ рд▓рд┐рдП рджрд┐рд▓рдЪрд╕реНрдк рд╕рд╛рдордЧреНрд░рд┐рдпреЛрдВ рдХрд╛ рдкрд╛рдЪрди (4 рдлрд░рд╡рд░реА - 10)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>