<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏿‍🎤 🍅 🧛🏻 后院-多云和混合基础架构之上的自动化服务网格 👩‍🏭 👨🏽‍🎓 🚬</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="在您自己的群集上测试后院： curl https://getbackyards.sh | sh && backyards install -a --run-demo curl https://getbackyards.sh | sh && backyards install -a --run-dem...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>后院-多云和混合基础架构之上的自动化服务网格</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/itsumma/blog/479742/"><img src="https://habrastorage.org/getpro/habr/post_images/83b/36e/e0b/83b36ee0bc8ba785116ec27befe716bc.png"><br><br><blockquote>在您自己的群集上测试后院： <code>curl https://getbackyards.sh | sh &amp;&amp; backyards install -a --run-demo</code>  <code>curl https://getbackyards.sh | sh &amp;&amp; backyards install -a --run-demo</code> 。 如果有兴趣，请参阅<a href="https://banzaicloud.com/blog/backyards-release-1-0/">最新版本</a>的<a href="https://banzaicloud.com/blog/backyards-release-1-0/">详细信息</a> 。 </blockquote><br>  6月，我们在<a href="https://github.com/cloud/istio-operator">Istio运营商</a>之上<a href="https://banzaicloud.com/blog/istio-the-easy-way/">推出了Backyards</a> ，这是一种<b>自动化的“服务网格”</b> 。 它极大地简化了多云和混合基础架构中的服务网格管理。  Backyards已集成到Banzai Cloud上<b>的<a href="https://github.com/banzaicloud/pipeline">Pipeline</a>容器管理平台中</b> ，但也可以作为<b>独立</b>产品使用。 当然，与Pipeline集成提供了许多特定的好处（例如<a href="https://banzaicloud.com/blog/istio-multicluster-the-easy-way/">管理多个云上的应用程序</a> ），但是Backyards可以在任何Kubernetes安装中使用。 <br><a name="habracut"></a><br> 在<a href="https://banzaicloud.com/blog/istio-the-easy-way/">Backyards公告中，</a>我们讨论了一些主要功能：只需单击几下即可创建服务网格；通过独特的图形表示监视应用程序；以及通过便捷的UI管理Istio功能。 然后，我们提到了该平台能够管理多云和混合部署中的Istio多集群服务网络。 <br><br> 在本文中，我们将仔细研究此功能- <b>自动多集群服务网格</b> 。 <br><br><blockquote> 无论是一个或多个集群，多云还是混合环境，Backyards都使用相同的功能集和便捷的界面。 从一个群集开始非常容易，然后单击几下即可将服务网格扩展到其他群集（多云或混合云）。 </blockquote><br><h1> 动机 </h1><br> 混合云和多云系统迅速进入企业的日常生活。 自从Google在今年4月推出<a href="https://cloud.google.com/blog/topics/hybrid-cloud/new-platform-for-managing-applications-in-todays-multi-cloud-world">Anthos</a>以来，人们的兴趣和决策已大大增加。 <br><br> 我们还注意到，与我们讨论此主题的大多数公司对此兴趣有所增加。 有人更喜欢在自己的数据中心中处理数据，仅在高峰负载时间访问云服务。 其他公司则一直在寻找云提供商的最低价格和最佳交易，仅在价格允许的情况下才增加工作量。 由于监管法规或业务要求，它们都需要一种方便的方法来根据特定客户端的请求在不同的云之间移动，以及在此多云和混合基础架构之上构建<a href="https://banzaicloud.com/blog/istio-multi-mesh/">几种不同的拓扑</a> 。 <br><br> 随着对混合和多集群解决方案需求的增长，我们开始思考如何满足客户的需求。 <br><br><blockquote> 管道用户使用一个或多个云。 这取决于他们需要什么特定功能。 可以区分三个关键功能： <br><br><ul><li>  <a href="https://banzaicloud.com/blog/multi-cloud-apps/">多云应用管理</a> <br></li><li>  <a href="https://banzaicloud.com/blog/istio-multicluster-the-easy-way/">在多云和混合基础架构之上的基于Istio的自动化服务网格</a> <br></li><li>  <a href="https://banzaicloud.com/blog/multi-cloud-fedv2/">通过Kubernetes Federation v2进行资源和应用程序的联合部署</a> </li></ul></blockquote><br><h1> 背景知识 </h1><br> 从一开始，管道平台就支持不同级别（集群，部署和服务）的不同云提供商的连接。 这一直是我们的优先事项之一。 <br><br> 同时，我们正在积极研究Istio。 最初发布该<a href="https://banzaicloud.com/blog/istio-operator/">运营商是</a>为了简化Istio的部署和管理，然后<a href="https://banzaicloud.com/tags/federation/">探讨了</a>其多集群功能。 因此， <b>我们</b>与开源运营商Istio一起<b>创建了Backyards，这是一种用于多云和混合基础架构的自动化产品</b> ，已集成到Pipeline中。 <br><br><h1> 管道后院 </h1><br>  <b>在管道中，您可以安装混合或多集群服务网格并在本地环境中或我们支持的五种云提供商的任何组合中对其进行管理。</b> <br><br><blockquote> 群集<b>分组</b>功能（群集组）允许您形成一组群集，前提是您选择一个群集作为主要群集。 然后，您可以将它们与各种功能相关联，例如<code>Multi-cluster Deployment</code>或<code>Service Mesh</code> 。 <br><br>  <code>Multi-cluster Deployment</code>允许您在多个集群上同时部署应用程序。 这里我们<b>不</b>关注此功能，而是<b>将其</b>用于轻松地在多个群集上部署应用程序。 在<a href="https://banzaicloud.com/blog/multi-cloud-apps/">本文中</a>阅读有关它的更多信息。 <br><br> 本文将仔细研究<code>Service Mesh</code>功能。 它将Istio安装在主群集上，并使用<a href="https://github.com/banzaicloud/istio-operator">Istio运算符</a>自动加入组中的所有群集。 此后，您将获得服务的集群间视图，并且从管理的角度来看，多集群网格实际上与传统的单集群系统没有什么不同。 </blockquote><br><h1> 功能介绍 </h1><br><h4> 创建服务网格 </h4><br> 让我们从使用轻量级和经CNCF认证的Kubernetes发行版-PKE在AWS上创建集群开始。 然后在此群集上构建服务网格Istio。 <br><br><blockquote> 创建服务网格时，背景中还会形成一个<i>群集组</i> 。 </blockquote><br> 几秒钟后，“网格”已安装并可以使用。 <br><br><img src="https://habrastorage.org/webt/y3/in/et/y3inetitm4ngvd4wbcwkzrtpbzw.gif"><br><br><h4> 应用部署 </h4><br> 现在，我们需要一个带有微服务的演示应用程序，以展示我们产品的功能。 为了演示，我们创建了一个非常简单的<a href="https://github.com/banzaicloud/allspark">AllSpark</a>项目，还制作了带有AllSpark部署的初步配置的Helm图，该图模拟了电影院票务预订系统。 一切都在我们<a href="https://banzaicloud.com/blog/chart-repository-service/">针对Helm图的云服务（SaaS）服务中完成</a> 。 <br><br> 使用上述的<code>Multi-cluster Deployment</code>功能，我们将通过转到用户界面中的“ <code>Multi Cluster Deployments</code>标签来部署此应用程序。 将存储库<code>https://charts.banzaicloud.io/gh/spotguidetest</code>添加到管道中，然后添加<code>meshdemo</code>图并单击<code>DEPLOY</code> （要安装所有组件，请确保所有值都设置为<code>true</code> ）。 <br><br><img src="https://habrastorage.org/webt/xm/el/jy/xmeljy6q3iqbshd48bybu8lqmig.gif"><br><br><blockquote> 可以为一个集群选择一个简单的部署，但是我们指出了一个多集群选项，稍后在使用多个集群时会派上用场。 </blockquote><br><h4> 服务网格概述 </h4><br> 如果返回服务网格列表并单击<code>observe</code>按钮，将出现控制面板。 由于我们的测试应用程序中没有流量，并且系统中也没有度量标准，因此在这里我们将看不到任何可视化。 该接口具有<code>test flight</code>功能，可将流量引导至选定的端点。 如果单击右上角的<code>HTTP</code>按钮，则可以填写包含有关端点信息的表单，并将一些测试流量发送到您的服务。 在我们的示例中，流量应转到端口8080上的首页服务。 <br><br> 几秒钟后，将显示您的服务时间表。 其上的节点代表服务或工作负载，箭头代表不同服务之间的网络连接。 该图基于Prometheus的Istio指标。 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a39/7e0/099/a397e00992f49c862bb4fc039328d4cb.png"><br><br><h4> 创建其他集群 </h4><br> 只需单击几下，即可将服务网格扩展到其他群集（甚至来自多个不同的云提供商）。 让我们在三个不同的提供商处创建三个额外的集群，这更有趣。 我们可以轻松地在Azure中部署另一个PKE群集以及OKE和GKE群集。 <br><br><img src="https://habrastorage.org/webt/bd/g7/wp/bdg7wpkuagluo5redzodlh3q0ka.gif"><br><br><h4> 服务网格扩展 </h4><br> 让我们回到服务网格列表，按一下<code>RESIZE MESH</code>按钮，然后按一下<code>ADD NEW CLUSTER</code> 。 选择先前创建的集群，然后按<code>ADD</code>按钮。 仅此而已。 <br><br><img src="https://habrastorage.org/webt/mm/g9/rp/mmg9rp74sdp8hmybk7odulh9yzi.gif"><br><br> 扩展过程可能需要几分钟：每个群集必须连接并达到<code>HEALTHY</code>状态。 <br><br><h4> 在多个集群中部署应用程序 </h4><br> 现在，我们在多个群集上都有一个服务网格，并且先前已激活了Pipeline中的<code>Multi-cluster Deployment</code>功能，因此可以轻松地在这些群集上部署演示微服务。 在此特定的Helm图中，您可以轻松地打开和关闭组件。 由于“ <code>Multi-cluster Deployment</code>功能支持为每个集群重新定义参数，因此您只需要编辑部署并确定我们要在哪个集群中运行的组件。 <br><br> 对于多集群部署，我们通过以下方式更改设置： <br><br> <code>PKE  AWS <br> <br> services: true <br> istioresources: true <br> frontpage: true <br> catalog: true <br> bookings: true <br> <br> PKE  Azure <br> <br> services: true <br> moviesv1: true <br> moviesv2: true <br> moviesv3: true <br> <br> OKE <br> <br> services: true <br> payments: true <br> notifications: true <br> <br> GKE <br> <br> services: true <br> analytics: true</code> <br> <br><img src="https://habrastorage.org/webt/hi/zd/1a/hizd1ajvovnzl7nn0cg5dstgtrg.gif"><br><br><h4> 跨多个集群的服务网格概述 </h4><br> 再次，在界面中选择<code>test flight</code> ，以将其他流量引向先前选择的端点。 几秒钟后，将出现类似于下图的内容。 现在，我们的应用程序分布在<b>四个</b>不同提供商的<b>四个</b>集群中。 <br><br>  <i>太好了</i>吧？ <br><br><img src="https://habrastorage.org/getpro/habr/post_images/11a/72c/12a/11a72c12a16805ea697effda2d9d17f9.png"><br><br><h4>  NRA配置 </h4><br> 在完成本文之前，请看一下最后的设置： <a href="https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/">Horizo​​ntal Pod Autoscaler</a> 。 在管道的“ <code>Single-cluster Deployment</code>页面上，您可以轻松地为任何部署配置HPA（在我们的示例中为<code>analytics-v1</code> ）。 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1ef/ac0/7ec/1efac07ecb4dc9f722b6b970c8a2647a.png"><br><br> 当您安装HPA并将足够的流量发送到您的服务以开始自动缩放时，您将看到与<code>analytics-v1</code>项目相对应的界面中出现的吊舱越来越多。 您还将看到沿着图边缘的查询流增加，这反映在边缘的数字和厚度上。 <br><br><img src="https://habrastorage.org/webt/lw/0p/7d/lw0p7dzyj5eq9rtbcaqgc_l53km.gif"><br><br><h1> 总结 </h1><br><blockquote> 多亏了Pipeline的Backyards，您可以轻松设置混合或多集群服务网格。 然后，您可以使用一个方便的用户界面在多个群集中部署，跟踪，管理和故障排除应用程序。 <br><br>  <a href="https://beta.banzaicloud.io/">免费试用</a> ！ </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN479742/">https://habr.com/ru/post/zh-CN479742/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN479726/index.html">Vladimir aka wowik：“ OpenStreetMap需要在其他系统中无法实现的想法”</a></li>
<li><a href="../zh-CN479728/index.html">如何组织成功的启动？</a></li>
<li><a href="../zh-CN479732/index.html">停止发出其他内容作为内存泄漏</a></li>
<li><a href="../zh-CN479736/index.html">相机或激光</a></li>
<li><a href="../zh-CN479738/index.html">像Youtube和Instagram：国际化和本地化Python应用程序</a></li>
<li><a href="../zh-CN479744/index.html">Python内存管理：关于内存碎片的一些知识</a></li>
<li><a href="../zh-CN479746/index.html">企业软件使您的员工更酷。 需要吗</a></li>
<li><a href="../zh-CN479748/index.html">GoLand 2019.3具有改进的性能，增强的Go模块支持等</a></li>
<li><a href="../zh-CN479750/index.html">2. Fortinet入门v 6.0。 解决方案架构</a></li>
<li><a href="../zh-CN479756/index.html">打开数据。 罗斯科莫斯。 跟上美国</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>