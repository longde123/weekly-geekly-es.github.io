<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëû üï≥Ô∏è üë©üèø‚Äç‚úàÔ∏è C√≥mo atravesamos el Gran Cortafuegos chino (Parte 1) ü§ô üíæ ü•§</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola a todos! 


 En contacto Nikita es ingeniero de sistemas de SEMrush . Hoy les contar√© c√≥mo enfrentamos la tarea de garantizar la estabilidad de n...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>C√≥mo atravesamos el Gran Cortafuegos chino (Parte 1)</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/semrush/blog/458602/"><p>  Hola a todos! </p><br><p>  En contacto Nikita es ingeniero de sistemas de <strong>SEMrush</strong> .  Hoy les contar√© c√≥mo enfrentamos la tarea de garantizar la estabilidad de nuestro servicio semrush.com en China, y qu√© problemas encontramos durante su implementaci√≥n (dada la ubicaci√≥n de nuestro centro de datos en la costa este de los EE. UU.). </p><br><p>  Esta ser√° una gran historia, dividida en varios art√≠culos.  Te dir√© c√≥mo sucedi√≥ todo con nosotros: desde un servicio de China que no funciona hasta el desempe√±o del servicio al nivel de su versi√≥n estadounidense para estadounidenses.  Prometo que ser√° interesante y √∫til.  Entonces vamos. </p><br><img src="https://habrastorage.org/webt/cv/6s/sv/cv6ssvuv-od31op6cjnadtw6xsy.png"><br><h2 id="problemy-kitayskogo-interneta">  Problemas de internet chinos </h2><br><p>  Incluso la persona m√°s distante de los detalles de la administraci√≥n de la red al menos una vez escuch√≥ sobre el <strong>Gran Firewall chino</strong> .  Uhh, eso suena bien, ¬øeh?  Pero lo que es, c√≥mo funciona realmente es una pregunta bastante complicada.  En Internet puede encontrar muchos art√≠culos sobre esto, pero desde un punto de vista t√©cnico, el dispositivo de este firewall no se describe en ninguna parte.  Lo cual, sin embargo, no es sorprendente.  Inmediatamente confieso que, en base a los resultados del a√±o de trabajo, no puedo decir exactamente c√≥mo funciona, pero s√≠ puedo contar mis comentarios y conclusiones pr√°cticas.  Y comenzaremos con rumores sobre este firewall. </p><a name="habracut"></a><br><p>  Hay muchos rumores sobre este mismo firewall.  Recopilemos los principales y m√°s interesantes de ellos en una lista: </p><br><ul><li>  Google, Facebook, Twitter y otros servicios similares est√°n bloqueados y no funcionan en China. </li><li>  Cualquier tr√°fico que vaya m√°s all√° de China y hacia China es analizado y limitado por el aprendizaje autom√°tico (en el caso de tr√°fico sospechoso), que lo ralentiza en gran medida (el tr√°fico) que pasa por la frontera. </li><li>  Las agencias de inteligencia chinas descifran el tr√°fico encriptado que pasa a trav√©s de su firewall. </li><li>  Los t√∫neles VPN, los t√∫neles IPSEC son inestables, caen y est√°n constantemente bloqueados. </li><li>  Cuanto m√°s simple es el cifrado, m√°s simple es la frase de contrase√±a utilizada para la autenticaci√≥n / cifrado de tr√°fico, m√°s r√°pido pasa el cortafuegos chino. </li></ul><br><p>  Esto es lo que hemos logrado descubrir sobre estos rumores: </p><br><ul><li>  Google, Facebook, Twitter y otros servicios similares est√°n realmente bloqueados (su KO), pero muchos dominios t√©cnicos de Google, por ejemplo, no est√°n prohibidos y funcionan (el mismo gstatic.com).  Esto lleva a la conclusi√≥n: no recorte imprudentemente todos los recursos de Google y otros que parecen estar bloqueados, aparentemente bloqueados. </li><li>  Cualquier tr√°fico que pase por la frontera realmente agrega un serio retraso a su tiempo.  Mira los dos resultados.  Un sitio, una p√°gina, simple get <em>curl</em> .  La primera medici√≥n de China (la hermosa ciudad de Shenzhen).  El segundo se congel√≥ afuera de Hong Kong (tiene soberan√≠a y no hay un cortafuegos entre este y el mundo).  La distancia entre ciudades en l√≠nea recta es de unos 30-40 km. </li></ul><br><pre><code class="bash hljs">nikita@china-shenzhen:~<span class="hljs-comment"><span class="hljs-comment"># curl -o /dev/null -w@curl_time "https://www.semrush.com/info/ebay.com" % Total % Received % Xferd Average Speed Time Time Time Current Dload Upload Total Spent Left Speed 100 381k 0 381k 0 0 71824 0 --:--:-- 0:00:05 --:--:-- 82832 time_namelookup: 0.004500 time_connect: 0.169342 time_appconnect: 0.723189 time_pretransfer: 0.723499 time_redirect: 0.000000 time_starttransfer: 1.532912 ---------- time_total: 5.443407 ---------- size_download: 390968 Bytes speed_download: 71824.000B/s nikita@china-hongkong:~# curl -o /dev/null -w@curl_time "https://www.semrush.com/info/ebay.com" % Total % Received % Xferd Average Speed Time Time Time Current Dload Upload Total Spent Left Speed 100 319k 0 319k 0 0 2555k 0 --:--:-- --:--:-- --:--:-- 2573k time_namelookup: 0.029366 time_connect: 0.030742 time_appconnect: 0.047310 time_pretransfer: 0.047388 time_redirect: 0.000000 time_starttransfer: 0.120793 ---------- time_total: 0.124871 ---------- size_download: 326755 Bytes speed_download: 2616740.000B/s</span></span></code> </pre> <br><p>  Presta atenci√≥n a <strong>time_connect</strong> .  Y en general, ves el resultado: el firewall agrega 4 segundos adicionales, que es monstruosamente largo. </p><br><ul><li>  Las VPN y los t√∫neles IPSEC caen a menudo.  Hablar√© de esto un poco m√°s tarde y con m√°s detalle.  Los servidores VPN que utilizan los usuarios se bloquean con el tiempo (generalmente dentro de un d√≠a despu√©s del inicio del uso). </li><li>  Se ha recibido la opini√≥n de personas que viven en China de que cuanto m√°s f√°cil es el cifrado del tr√°fico, m√°s r√°pido pasa a trav√©s de la frontera, porque es f√°cil entender que no hay nada ilegal en √©l.  Y as√≠ como el tr√°fico "limpio" obtiene m√°s ancho de banda y velocidad, y el tr√°fico "sucio", que no distingue nada, obtiene un pase m√°s lento por el contrario.  Por ejemplo, traer√© curl a <em>ifconfig.co</em> usando los protocolos HTTPS y HTTP. </li></ul><br><pre> <code class="bash hljs">curl -o /dev/null -w@curl_time <span class="hljs-string"><span class="hljs-string">"https://ifconfig.co/"</span></span> % Total % Received % Xferd Average Speed Time Time Time Current Dload Upload Total Spent Left Speed 100 13 100 13 0 0 2 0 0:00:06 0:00:05 0:00:01 3 time_namelookup: 0.004305 time_connect: 0.397465 time_appconnect: 5.149305 time_pretransfer: 5.149393 time_redirect: 0.000000 time_starttransfer: 5.568847 ---------- time_total: 5.568893 ---------- size_download: 13 Bytes speed_download: 2.000B/s curl -o /dev/null -w@curl_time <span class="hljs-string"><span class="hljs-string">"http://ifconfig.co/"</span></span> % Total % Received % Xferd Average Speed Time Time Time Current Dload Upload Total Spent Left Speed 100 13 100 13 0 0 28 0 --:--:-- --:--:-- --:--:-- 28 time_namelookup: 0.004282 time_connect: 0.212457 time_appconnect: 0.000000 time_pretransfer: 0.212484 time_redirect: 0.000000 time_starttransfer: 0.450565 ---------- time_total: 0.450620 ---------- size_download: 13 Bytes speed_download: 28.000B/s</code> </pre> <br><p>  La diferencia es de 5 segundos para un tiempo de carga total de 13 bytes.  Al hacer esta prueba varias veces, puede ver que GET en HTTP se completa en general al mismo tiempo cada vez, mientras usa HTTPS, el sitio a veces responde en 3, 5, 10 e incluso 17 segundos.  A veces se producen errores de SSL: </p><br><p> <code>Unknown SSL protocol error in connection to ifconfig.co:443.</code> </p> <br><p>  Entonces lo que tenemos: </p><br><ul><li>  Los problemas creados por el firewall chino descritos anteriormente. </li><li>  Pings a los recursos externos y dentro de los t√∫neles desaparecen peri√≥dicamente. </li><li>  La latencia entre dos puntos cambia constantemente y, a menudo, es simplemente impredecible.  Al conectar diferentes ciudades / regiones, espera que, seg√∫n la ubicaci√≥n geogr√°fica de las regiones, el retraso sea menor y obtenga exactamente la situaci√≥n opuesta. </li><li>  Internet y los canales de comunicaci√≥n son r√°pidos o lentos.  Hay una ligera dependencia de la hora del d√≠a y el d√≠a de la semana, pero no siempre. </li><li>  Las consultas de DNS al mundo exterior desde China a veces exceden el tiempo de espera permitido. </li></ul><br><p>  La imagen parece simplemente "excelente". </p><br><p>  El centro de datos, como ya dije, est√° en el este de los EE. UU., Y todo el SEMrush consta de docenas de productos interconectados, backends, frontends, bases de datos y todo esto en el centro de datos y en las nubes.  Como equipo de administradores de sistemas, nos encargaron un peque√±o esfuerzo para comenzar a trabajar r√°pidamente en China. </p><br><p>  Tuvimos que responder una pregunta importante: ¬øpodemos salir con un poco de sangre y resolver todos los problemas asociados con Internet y firewall chinos en el nivel de red / nube / servidor? </p><br><p>  Comenzamos obteniendo una <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">licencia <strong>ICP</strong></a> . </p><br><h2 id="icp-licenziya">  Licencia ICP </h2><br><p>  Para poder colocar su servicio dentro de China (China continental) y realizar pruebas, primero debe obtener una licencia de dominio ICP. </p><br><p>  Si el tr√°fico de usuarios de su sitio se termina dentro de China continental, y si su dominio no tiene una licencia ICP, su tr√°fico se bloquear√° en el lado del proveedor / alojamiento.  Curiosamente, un proveedor espec√≠fico se ajusta a la licencia ICP, ya sea Cloudflare o Alibaba Cloud.  Por lo tanto, si recibi√≥ una licencia ICP para Cloudflare y aloj√≥ su sitio con ellos, entonces no podr√° mudarse "sin problemas" a Alibaba Cloud.  Ser√° necesario agregar un hosting m√°s a esta licencia. </p><br><p>  Despu√©s de recibir una licencia de dominio ICP, pudimos encontrar e implementar ideas y soluciones t√©cnicas espec√≠ficas. </p><br><h2 id="testirovanie-resheniy">  Soluciones de prueba </h2><br><p>  Pero antes de crear directamente las opciones para la puesta en escena, girar los mandos, optimizar el sitio y su velocidad, debe elegir una herramienta para probarlo y ver qu√© acciones mejoran o empeoran el trabajo del sitio. </p><br><p>  Nuestra herramienta de prueba ten√≠a que cumplir con dos requisitos principales: </p><br><ul><li>  deber√≠a poder realizar pruebas desde China, </li><li>  Debe tener pruebas de navegador. </li></ul><br><p>  ¬°As√≠ que encontramos el punto de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">captura</a> !  Tienen una excelente cobertura con puntos de prueba en todo el mundo.  En China, a trav√©s de esta herramienta, tambi√©n puede ejecutar pruebas desde 100,500 provincias.  En cada uno, varios proveedores diferentes + la capacidad de hacer pruebas de <strong>Backbone</strong> (algo as√≠ como una m√°quina <strong>virtual</strong> en un centro de datos) y pruebas de <strong>Lastmile</strong> (lo m√°s cerca posible de las condiciones del usuario, tambi√©n conocido como estaci√≥n de trabajo).  El √∫ltimo tipo de prueba es m√°s costoso. </p><br><p>  Habiendo concluido un contrato de un a√±o (no se puede hacer menos), comenzamos a estudiar la herramienta.  Francamente, nos sorprendi√≥ gratamente su funcionalidad.  Puedes ejecutar: </p><br><ul><li>  Pruebas de DNS </li><li>  Pruebas web (navegador, GET / POST simple, emulaci√≥n de un cliente m√≥vil, etc.), </li><li>  Cheques transaccionales (por ejemplo, inicio de sesi√≥n), </li><li>  Pruebas de API </li><li>  Ping, traceroute, NTP, etc. </li></ul><br><p>  No puedes enumerar todo.  Y lo m√°s importante, cada prueba se puede personalizar bastante bien agregando un mont√≥n de encabezados y otros par√°metros.  El resultado es una gran cantidad de informaci√≥n que describe completamente su prueba.  Si hablamos de lo m√°s interesante para nosotros (pruebas de navegador), el resultado incluye: </p><br><ul><li>  Conectar, esperar, cargar, SSL, hora DNS, </li><li>  TTFB, TTLB, documento completo, tiempo de procesamiento, carga DOM, </li><li>  Respuesta (algo parecido al Tiempo hasta el primer byte), Respuesta de la p√°gina web (algo parecido al Tiempo hasta el √∫ltimo byte), </li><li>  Cualquier percentil, promedio, tiempo medio </li><li>  Etc. </li></ul><br><p>  En consecuencia, todas estas m√©tricas lo ayudan a ver los cambios y comprender si ha mejorado.  Observamos principalmente la <strong>respuesta, la respuesta de la p√°gina web, la mediana, los percentiles 75 y 95</strong> . </p><br><p>  Una pregunta importante que ha estado en el aire desde el principio: ¬øes <strong>posible creer en Catchpoint</strong> ?  ¬øEsta herramienta refleja la velocidad de carga real del sitio en China desde diferentes ciudades o es solo una especie de prueba en el vac√≠o que no tiene nada que ver con la experiencia real del usuario? <br>  Este es un gran problema, porque estar en Rusia es casi imposible saber de manera confiable c√≥mo funciona el sitio desde China.  Al hacer el proxy de calcetines a trav√©s de una m√°quina virtual, al final se carga el sitio web en un par de minutos, lo cual es simplemente inaceptable para las pruebas, por lo que la √∫nica opci√≥n para las pruebas manuales es obtener GETs curvos y simples desde la consola con medici√≥n de tiempo.  Esto ayuda, porque esta prueba refleja la velocidad de la soluci√≥n de red, y si hay pruebas de navegador, es muy buena. </p><br><p>  M√°s tarde, fuimos a China nosotros mismos y nos aseguramos de que <strong>se pueda confiar en Catchpoint, ya que refleja con bastante precisi√≥n los indicadores reales de velocidad.</strong> </p><br><h2 id="cloudflare-china-network">  Red china de Cloudflare </h2><br><p>  Como utilizamos con √©xito Cloudflare para el dominio principal de semrush.com, decidimos probar de inmediato su funci√≥n llamada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">China Network</a> .  Esta opci√≥n est√° habilitada solo para sitios de Enterprise a pedido y por una tarifa.  Tambi√©n est√° disponible solo para sitios que tienen la licencia ICP apropiada, en la que Cloudflare se especifica como el proveedor.  Despu√©s de que se enciende, un "CDN chino" de Cloudflare est√° disponible para el sitio: el tr√°fico de las regiones chinas aterriza en el pr√≥ximo PoP (Puntos de Presencia) CF, y luego se entrega al origen a trav√©s de sus redes o redes de proveedores / socios. </p><br><p>  El esquema de este banco de pruebas se presenta a continuaci√≥n. </p><br><img src="https://habrastorage.org/webt/zk/hw/um/zkhwumkneyyxkij6gdffhzcl6qw.png"><br><p>  Esta es una gran opci√≥n para nosotros.  Resulta que el segundo dominio tambi√©n ser√° para CF, que no agrega la cantidad de soluciones utilizadas en la empresa, y tampoco complica pr√°cticamente la infraestructura. </p><br><p>  Ejecutamos las pruebas del navegador, y esto es lo que sucedi√≥: </p><br><img src="https://habrastorage.org/webt/cs/wo/hp/cswohpvoexjj3nanyzxloxk2poo.png"><br><p>  Los diamantes rojos son archivos de prueba.  Los siguientes archivos son errores de DNS (tiempo de espera resuelto).  Los fallos anteriores son tiempos de espera. </p><br><p>  <em>Tiempo de actividad: 86.6</em> <em><br></em>  <em>Mediana: 18 a√±os</em> <em><br></em>  <em>75 Percentil: 29.3s</em> <em><br></em>  <em>Percentil 95: a√±os 60</em> </p><br><p>  La mediana, despu√©s de <em>eliminar la</em> descarga de <em>reCaptcha</em> (un servicio de <em>Google</em> bloqueado en China), disminuy√≥ de 28 a 18 segundos.  Pero a√∫n as√≠, estos son indicadores terribles, dado que la misma prueba para semrush.com (de EE. UU.) Dio menos de 10 segundos para el 95% de los usuarios (de EE. UU.) A la misma p√°gina (estad√≠sticas + din√°mica). </p><br><p>  En cada prueba, puede ir a ver <em>Cascada</em> y otros par√°metros m√°s detallados.  Comenzamos a investigar las causas de los errores, y si durante los tiempos de espera todo est√° menos o menos claro: Internet en China "se est√° cayendo, luego se est√° yendo", debido a esto la velocidad de conexi√≥n y carga de recursos desde el extranjero es inestable y desigual, entonces los errores de DNS nos sorprendieron enormemente. .  Descubrimos que los PoP de Cloudflare est√°n ubicados en China, la direcci√≥n del sitio se resuelve en una sola IP de difusi√≥n ilimitada, pero los servidores DNS son utilizados por los EE. UU., Es por eso que las consultas DNS se ven obligadas a cruzar la frontera, por lo que a veces fallan. </p><br><p>  Despu√©s de aclarar esta pregunta con CF, result√≥ que <strong>no tienen sus propios servidores DNS en China</strong> , y a√∫n se desconoce cu√°ndo ser√°. </p><br><p>  Por lo tanto, decidimos probar solo DNS de Cloudflare y cambiamos el mecanismo de Cloudflare para nuestro sitio al modo " <strong>Solo DNS</strong> ".  Este es un modo en el que Cloudflare no representa el tr√°fico proxy a trav√©s de s√≠ mismo, lo que significa que no proporciona protecci√≥n DDoS, CDN y otras caracter√≠sticas, y funciona en el modo de un servidor DNS normal. </p><br><p>  Este soporte se muestra esquem√°ticamente en la siguiente figura.  La figura tiene en cuenta el conocimiento emergente de que el servidor DNS de Cloudflare est√° detr√°s del firewall. </p><br><img src="https://habrastorage.org/webt/ac/w0/r7/acw0r7fgqahq9w2kckq6-myxjky.png"><br><p>  En Catchpoint, ejecutamos pruebas GET simples (sin navegador) que mostraron muchos fallos.  La raz√≥n de ellos fueron los mismos errores de DNS. </p><br><img src="https://habrastorage.org/webt/_w/3c/wu/_w3cwuxv8j9tdeuvp20jblktqoi.png"><br><p>  Comenzamos a depurar estos errores usando <em>dig</em> y descubrimos que la direcci√≥n se determina correctamente en la primera solicitud, y en la solicitud repetida recibimos <em>SERVFAIL</em> y <em>no se encuentra</em> cada vez.  ¬øQu√© es de repente? </p><br><pre> <code class="bash hljs">root@iZwz97n2wgbp61qucbfrjsZ:~<span class="hljs-comment"><span class="hljs-comment"># host semrushchina.cn semrushchina.cn has address 220.170.186.192 Host semrushchina.cn not found: 2(SERVFAIL) root@iZwz97n2wgbp61qucbfrjsZ:~# host semrushchina.cn semrushchina.cn has address 220.170.186.192 Host semrushchina.cn not found: 2(SERVFAIL) root@iZwz97n2wgbp61qucbfrjsZ:~# host semrushchina.cn semrushchina.cn has address 220.170.186.192 Host semrushchina.cn not found: 2(SERVFAIL) root@iZwz97n2wgbp61qucbfrjsZ:~# host semrushchina.cn semrushchina.cn has address 220.170.186.192 Host semrushchina.cn not found: 2(SERVFAIL)</span></span></code> </pre> <br><p>  Al solicitar servidores Cloudflare NS directamente, no existen tales errores: </p><br><pre> <code class="bash hljs">root@iZwz97n2wgbp61qucbfrjsZ:~<span class="hljs-comment"><span class="hljs-comment"># for i in `seq 1 2`; do host semrushchina.cn ray.ns.cloudflare.com.; done Using domain server: Name: ray.ns.cloudflare.com. Address: 173.245.59.138#53 Aliases: semrushchina.cn has address 220.170.186.192 semrushchina.cn has address 220.170.186.192 Using domain server: Name: ray.ns.cloudflare.com. Address: 173.245.59.138#53 Aliases: semrushchina.cn has address 220.170.186.192 semrushchina.cn has address 220.170.186.192</span></span></code> </pre> <br><p>  Esto significa que el problema est√° del lado del servidor DNS "local" o del servidor del proveedor. <br>  Investigaciones posteriores mostraron que recibimos <em>SERVFAIL</em> sobre la resoluci√≥n del registro <em>AAAA</em> . </p><br><p>  Result√≥ que cuando Cloudflare solicit√≥ un registro <em>AAAA</em> que no estaba en el dominio, Cloudflare respondi√≥ con un registro <em>A</em> , que es un error de RFC y falta de coincidencia.  Debido a que el solucionador local ( <em>xxxx</em> ) no le gust√≥ esto, y respondi√≥ <em>SERVFAIL</em> .  En el registro a continuaci√≥n, este comportamiento es claramente visible: </p><br><pre> <code class="bash hljs">root@iZwz97n2wgbp61qucbfrjsZ:~<span class="hljs-comment"><span class="hljs-comment"># dig -t AAAA semrushchina.cn @xxxx ; &lt;&lt;&gt;&gt; DiG 9.10.3-P4-Ubuntu &lt;&lt;&gt;&gt; -t AAAA semrushchina.cn @xxxx ;; global options: +cmd ;; Got answer: ;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: SERVFAIL, id: 55467 ;; flags: qr rd ra; QUERY: 1, ANSWER: 0, AUTHORITY: 0, ADDITIONAL: 1 ;; OPT PSEUDOSECTION: ; EDNS: version: 0, flags:; udp: 4096 ;; QUESTION SECTION: ;semrushchina.cn. IN AAAA ;; Query time: 334 msec ;; SERVER: xxxx#53(xxxx) ;; WHEN: Tue Aug 14 23:38:50 CST 2018 ;; MSG SIZE rcvd: 44 root@iZwz97n2wgbp61qucbfrjsZ:~# dig -t AAAA semrushchina.cn @dana.ns.cloudflare.com. ; &lt;&lt;&gt;&gt; DiG 9.10.3-P4-Ubuntu &lt;&lt;&gt;&gt; -t AAAA semrushchina.cn @dana.ns.cloudflare.com. ;; global options: +cmd ;; Got answer: ;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 63944 ;; flags: qr aa rd; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1 ;; WARNING: recursion requested but not available ;; OPT PSEUDOSECTION: ; EDNS: version: 0, flags:; udp: 512 ;; QUESTION SECTION: ;semrushchina.cn. IN AAAA ;; ANSWER SECTION: semrushchina.cn. 300 IN A 220.170.186.192 ;; Query time: 185 msec ;; SERVER: 173.245.58.105#53(173.245.58.105) ;; WHEN: Tue Aug 14 23:43:03 CST 2018 ;; MSG SIZE rcvd: 60</span></span></code> </pre><br><p>  Enviamos un informe de error de Cloudflare, y lo arreglaron despu√©s de un tiempo.  Result√≥ ser interesante: en la actualidad, todav√≠a no hay soporte IPv6 en China, por lo que Cloudflare no pudo dar su direcci√≥n IPv6 en respuesta a una solicitud de un registro <em>AAAA</em> .  Al final, todo se decidi√≥ de modo que para China Cloudflare comenz√≥ a responder <em>NODATA</em> a tales solicitudes. </p><br><p>  Entonces, los errores de DNS en las pruebas de Catchpoint disminuyeron dr√°sticamente, pero no hasta el final.  Los tiempos de espera tampoco desaparecieron: </p><br><img src="https://habrastorage.org/webt/u5/i7/fj/u5i7fjgo6pb9fl4mddq27uhk9lo.png"><br><p>  Y comenzamos a buscar otra soluci√≥n. </p><br><p>  En la siguiente parte, contar√© c√≥mo probamos la <strong>nube</strong> china de <strong>Alibaba</strong> , c√≥mo con la ayuda de un peque√±o Nginx "m√°gico" pudimos crear r√°pidamente soluciones PoC (Prueba de concepto), c√≥mo creamos soluciones Multi-Cloud, una de las cuales finalmente ayud√≥ mucho acelerar el servicio de China. </p><br><p>  <strong>Est√©n atentos!</strong> </p><br><h3 id="vse-chasti">  Todas las partes </h3><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Parte 2</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Parte 3</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/458602/">https://habr.com/ru/post/458602/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../458590/index.html">Enfoques arquitect√≥nicos en aplicaciones iOS</a></li>
<li><a href="../458594/index.html">No olvide aumentar la posibilidad de una respuesta al cliente utilizando una solicitud repetida en el equilibrio L7</a></li>
<li><a href="../458596/index.html">Petty little joy # 6: OpenAI Gym - juega juegos y controla robots</a></li>
<li><a href="../458598/index.html">Reconocimiento de fuentes de luz en mapas ambientales.</a></li>
<li><a href="../458600/index.html">¬øQu√© son las bicicletas el√©ctricas (revisi√≥n grupal en dos partes de cinco modelos de dos fabricantes), parte 1</a></li>
<li><a href="../458604/index.html">¬øPor qu√© los dos mayores fabricantes de productos electr√≥nicos unieron fuerzas en un nuevo proyecto de GPU?</a></li>
<li><a href="../458606/index.html">Ejecute OpenVPN en Docker en 2 segundos</a></li>
<li><a href="../458608/index.html">Herramientas de desarrollo de Node.js Cola de trabajo</a></li>
<li><a href="../458612/index.html">Cosmos 7 a√±os</a></li>
<li><a href="../458614/index.html">Crear un enlace Reactivo UsePosition () para obtener y rastrear las coordenadas del navegador</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>