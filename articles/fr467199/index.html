<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👂🏿 😱 👩🏾‍⚕️ Journal de Tom Hunter: Le chien des Baskerville ➗ 👩🏿‍💼 👡</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Retarder la signature est une chose courante pour toute grande entreprise. Une exception n'était pas un accord entre Tom Hunter et une animalerie en l...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Journal de Tom Hunter: Le chien des Baskerville</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/tomhunter/blog/467199/">  Retarder la signature est une chose courante pour toute grande entreprise.  Une exception n'était pas un accord entre Tom Hunter et une animalerie en ligne pour un pentesting approfondi.  Il était nécessaire de vérifier à la fois le site et le réseau interne, et même le Wi-Fi fonctionnel. <br><br>  Il n'est pas surprenant que les mains aient été peignées avant le règlement de toutes les formalités.  Eh bien, scannez le site juste au cas où, il est peu probable qu'un magasin aussi connu que le "Chien Baskervilov" fasse des erreurs ici.  Après quelques jours, Tom a néanmoins livré l'original signé du contrat - à ce moment-là, derrière la troisième tasse de café, Tom du CMS interne a évalué avec intérêt l'intérêt des entrepôts ... <br><br><img src="https://habrastorage.org/webt/y0/bf/ef/y0bfefcwg_2j0dk3qexegw3isxg.jpeg">  <i>Source: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Ehsan Taebloo</a></i> <br><a name="habracut"></a><br>  Mais il n'était pas possible de gérer en particulier dans CMS - les administrateurs du site ont interdit l'IP de Tom Hunter.  Bien qu'on puisse réussir à générer des bonus sur la carte du magasin et nourrir le chat bien-aimé à bon marché pendant des mois ... "Pas cette fois, Dark Sidious", pensa Tom avec un sourire.  Il serait tout aussi amusant de passer de la zone du site Web au réseau local du client, mais apparemment, ces segments ne sont pas connectés avec le client.  Pourtant, cela se produit plus souvent dans les très grandes entreprises. <br><br>  Après toutes les formalités, Tom Hunter s'est armé du compte VPN fourni et s'est rendu sur le réseau local du client.  Le compte était à l'intérieur du domaine Active Directory, il était donc possible de prendre et sans aucune astuce pour vider AD - pour fusionner toutes les informations publiques sur les utilisateurs et les machines qui fonctionnent. <br><br>  Tom a lancé l'utilitaire adfind et a commencé à envoyer des demandes LDAP au contrôleur de domaine.  Avec un filtre par classe objectategory, spécifiant person comme attribut.  La réponse est revenue ici avec cette structure: <br><br><pre><code class="plaintext hljs">dn:CN=,CN=Users,DC=domain,DC=local &gt;objectClass: top &gt;objectClass: person &gt;objectClass: organizationalPerson &gt;objectClass: user &gt;cn:  &gt;description:           &gt;distinguishedName: CN=,CN=Users,DC=domain,DC=local &gt;instanceType: 4 &gt;whenCreated: 20120228104456.0Z &gt;whenChanged: 20120228104456.0Z</code> </pre> <br>  De plus, il y avait encore beaucoup d'informations utiles, mais la plus intéressante était dans le champ&gt; description:&gt; description.  Ce commentaire de compte est, en principe, un endroit pratique pour stocker des notes mineures.  Mais les administrateurs du client ont considéré que les mots de passe peuvent également rester calmement ici.  Qui, après tout, pourrait être intéressé par tous ces dossiers de service mineurs?  Par conséquent, les commentaires reçus par Tom ressemblaient à: <br><br><pre> <code class="plaintext hljs"> , 2018.11.16 7po!*Vqn</code> </pre> <br>  Vous n'avez pas besoin d'avoir sept travées dans le front pour comprendre pourquoi la combinaison est utile à la fin.  Il restait à analyser un gros fichier de réponses du CD par le champ&gt; description: et les voici - 20 paires login-mot de passe.  Et près de la moitié ont des droits d'accès RDP.  Bon pied, il est temps de diviser les forces attaquantes. <br><br><h2>  Environnement réseau </h2><br>  Les boules accessibles de Baskerville Dogs ressemblaient à une grande ville dans tout son chaos et son imprévisibilité.  Avec des profils d'utilisateurs et de RDP, Tom Hunter était un pauvre garçon dans cette ville, mais même il a réussi à regarder beaucoup de choses à travers les fenêtres brillantes des politiques de sécurité. <br><br>  Des parties de serveurs de fichiers, des comptes comptables et même des scripts qui leur sont associés - tout cela a été partagé.  Dans les paramètres de l'un de ces scripts, Tom a trouvé le hachage MS SQL d'un utilisateur.  Un peu de magie par force brute - et le hachage de l'utilisateur transformé en mot de passe en texte brut.  Merci à John The Ripper et Hashcat. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/475/884/6c0/4758846c0301c7914bc41c33ad92efba.png"><br><br>  Cette clé aurait dû venir à un coffre.  Le coffre a été retrouvé et de plus, dix autres «coffres» y étaient reliés.  Et dans six laïcs ... droits de superutilisateur, nt autorité \ système!  Sur deux, j'ai réussi à exécuter la procédure stockée xp_cmdshell et à envoyer des commandes cmd à Windows.  Que voulez-vous de plus? <br><br><h2>  Contrôleurs de domaine </h2><br>  Tom Hunter a préparé le deuxième coup pour les contrôleurs de domaine.  Il y en avait trois dans le réseau des chiens Baskerville, selon le nombre de serveurs géographiquement éloignés.  Chaque contrôleur de domaine a un dossier public, comme une vitrine ouverte dans un magasin, à côté duquel le même garçon appauvri Tom traîne. <br><br>  Et cette fois, le gars a de nouveau eu de la chance - ils ont oublié de supprimer le script de la fenêtre où le mot de passe de l'administrateur du serveur local était codé en dur.  Le chemin vers le contrôleur de domaine était donc ouvert.  Entrez, Tom! <br><br>  Ici, un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">mimikatz a</a> été extrait du chapeau magique, ce qui a été rentable pour plusieurs administrateurs de domaine.  Tom Hunter a eu accès à toutes les machines du réseau local, et un rire diabolique a fait peur au chat depuis une chaise voisine.  Ce chemin était plus court que prévu. <br><br><h2>  Eternalblue </h2><br>  La mémoire de WannaCry et Petya est toujours vivante dans l'esprit des pentesters, mais certains administrateurs semblent avoir oublié les cryptographes dans le flux d'autres nouvelles du soir.  Tom a découvert trois nœuds avec une vulnérabilité dans le protocole SMB - CVE-2017-0144 ou EternalBlue.  Il s'agit de la même vulnérabilité à l'aide du ransomware WannaCry et Petya, une vulnérabilité qui permet d'exécuter du code arbitraire sur un hôte.  À l'un des nœuds vulnérables, il y avait une session d'administration de domaine - «exploiter et obtenir».  Que pouvez-vous faire, le temps n'a pas enseigné à tout le monde. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/090/a04/c4d/090a04c4d07cd5a393972031e33776b3.png"><br><br><h2>  Le chien de Basterville </h2><br>  Les classiques de la sécurité de l'information aiment répéter que le point le plus faible de tout système est une personne.  Notez que le titre ci-dessus ne correspond pas au nom du magasin?  Peut-être que tout le monde n'est pas si prudent. <br><br>  Dans la meilleure tradition des blockbusters de phishing, Tom Hunter a enregistré un domaine d'une lettre différent du domaine des chiens Baskerville.  L'adresse postale de ce domaine simule l'adresse du service de sécurité des informations du magasin.  Dans les 4 jours de 16h00 à 17h00, un message comme celui-ci a été envoyé uniformément à 360 adresses à partir d'une fausse adresse: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/135/744/e45/135744e454ee0075f4745eee7906fdbc.png"><br><br>  Peut-être que seule leur propre paresse a sauvé les employés du déversement massif de mots de passe.  Sur les 360 lettres, seulement 61 ont été ouvertes - le service de sécurité n'est pas très populaire.  Mais c'était plus facile. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/54a/d2f/c25/54ad2fc254381272cac2dcaefb743cf1.png"><br>  <i>Page de phishing</i> <br><br>  46 personnes ont cliqué sur le lien et près de la moitié - 21 employés - n'ont pas regardé dans la barre d'adresse et ont calmement entré leurs noms d'utilisateur et mots de passe.  Bonne prise, Tom. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3ef/c17/e88/3efc17e88dd9a32689c7f6a679118f43.jpg"><br><br><h2>  Réseau Wi-Fi </h2><br>  Maintenant, je n'avais plus à compter sur l'aide d'un chat.  Tom Hunter a jeté quelques morceaux de fer dans sa vieille berline et s'est dirigé vers le bureau des chiens de Baskerville.  Sa visite n’a pas été acceptée: Tom allait tester le Wi-Fi du client.  Dans le parking du centre d'affaires, il y avait plusieurs places libres qui ont réussi à pénétrer dans le périmètre du réseau cible.  Apparemment, ils n'ont pas spécialement pensé à sa restriction - comme si les administrateurs avaient piqué au hasard des points supplémentaires en réponse à une plainte concernant une connexion Wi-Fi faible. <br><br>  Comment fonctionne la protection WPA / WPA2 PSK?  Le chiffrement entre le point d'accès et les clients fournit une clé de pré-session - Pairwise Transient Key (PTK).  PTK utilise la clé pré-partagée et cinq autres paramètres - SSID, Authenticator Nounce (ANounce), Supplicant Nounce (SNounce), adresses MAC du point d'accès et du client.  Tom a intercepté les cinq paramètres, et maintenant seule la clé pré-partagée était manquante. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/793/240/7a8/7932407a8089981039a332bfb1d97bf6.png"><br><br>  L'utilitaire Hashcat a obtenu ce lien manquant en environ 50 minutes - et notre héros s'est retrouvé dans un réseau invité.  Dans le quartier, vous pouviez voir le réseau de travail de l'entreprise - curieusement, ici, Tom a géré le mot de passe pendant environ neuf minutes.  Et tout cela sans quitter le parking, sans aucun VPN.  Le réseau de travail a ouvert nos espaces ouverts de héros pour une activité monstrueuse, mais il ... n'a pas lancé de bonus sur la carte du magasin. <br><br>  <i>Tom fit une pause, regarda sa montre, jeta quelques billets sur la table et, au revoir, quitta le café.</i>  <i>Peut-être encore une fois un pentest, ou peut-être que j'ai imaginé une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">chaîne de télégramme</a> ...</i> <i><br></i> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr467199/">https://habr.com/ru/post/fr467199/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr467187/index.html">Créer la dernière bibliothèque technologique</a></li>
<li><a href="../fr467189/index.html">Échantillonnage de température</a></li>
<li><a href="../fr467191/index.html">Comment nous avons créé Vivaldi pour Android</a></li>
<li><a href="../fr467193/index.html">Virus mineur avec «Heaven's Gate»</a></li>
<li><a href="../fr467197/index.html">Comment le polymorphisme est implémenté dans la JVM</a></li>
<li><a href="../fr467201/index.html">Expérience CacheBrowser: Contournement d'un pare-feu chinois sans proxy à l'aide de la mise en cache de contenu</a></li>
<li><a href="../fr467203/index.html">Juste la division, ou comment créer une théorie mathématique et y gagner 400 000 $. Deuxième série, avant-dernière</a></li>
<li><a href="../fr467205/index.html">Nous développons une application qui envoie des données vers d'autres applications (application écosystème)</a></li>
<li><a href="../fr467207/index.html">Cinq langages de programmation prometteurs avec un bel avenir (3 ans plus tard)</a></li>
<li><a href="../fr467209/index.html">"Agents autonomes" ou exécutez du code dans la cryptoplateforme ouverte Obyte</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>