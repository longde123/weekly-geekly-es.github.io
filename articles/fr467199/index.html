<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘‚ğŸ¿ ğŸ˜± ğŸ‘©ğŸ¾â€âš•ï¸ Journal de Tom Hunter: Le chien des Baskerville â— ğŸ‘©ğŸ¿â€ğŸ’¼ ğŸ‘¡</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Retarder la signature est une chose courante pour toute grande entreprise. Une exception n'Ã©tait pas un accord entre Tom Hunter et une animalerie en l...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Journal de Tom Hunter: Le chien des Baskerville</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/tomhunter/blog/467199/">  Retarder la signature est une chose courante pour toute grande entreprise.  Une exception n'Ã©tait pas un accord entre Tom Hunter et une animalerie en ligne pour un pentesting approfondi.  Il Ã©tait nÃ©cessaire de vÃ©rifier Ã  la fois le site et le rÃ©seau interne, et mÃªme le Wi-Fi fonctionnel. <br><br>  Il n'est pas surprenant que les mains aient Ã©tÃ© peignÃ©es avant le rÃ¨glement de toutes les formalitÃ©s.  Eh bien, scannez le site juste au cas oÃ¹, il est peu probable qu'un magasin aussi connu que le "Chien Baskervilov" fasse des erreurs ici.  AprÃ¨s quelques jours, Tom a nÃ©anmoins livrÃ© l'original signÃ© du contrat - Ã  ce moment-lÃ , derriÃ¨re la troisiÃ¨me tasse de cafÃ©, Tom du CMS interne a Ã©valuÃ© avec intÃ©rÃªt l'intÃ©rÃªt des entrepÃ´ts ... <br><br><img src="https://habrastorage.org/webt/y0/bf/ef/y0bfefcwg_2j0dk3qexegw3isxg.jpeg">  <i>Source: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Ehsan Taebloo</a></i> <br><a name="habracut"></a><br>  Mais il n'Ã©tait pas possible de gÃ©rer en particulier dans CMS - les administrateurs du site ont interdit l'IP de Tom Hunter.  Bien qu'on puisse rÃ©ussir Ã  gÃ©nÃ©rer des bonus sur la carte du magasin et nourrir le chat bien-aimÃ© Ã  bon marchÃ© pendant des mois ... "Pas cette fois, Dark Sidious", pensa Tom avec un sourire.  Il serait tout aussi amusant de passer de la zone du site Web au rÃ©seau local du client, mais apparemment, ces segments ne sont pas connectÃ©s avec le client.  Pourtant, cela se produit plus souvent dans les trÃ¨s grandes entreprises. <br><br>  AprÃ¨s toutes les formalitÃ©s, Tom Hunter s'est armÃ© du compte VPN fourni et s'est rendu sur le rÃ©seau local du client.  Le compte Ã©tait Ã  l'intÃ©rieur du domaine Active Directory, il Ã©tait donc possible de prendre et sans aucune astuce pour vider AD - pour fusionner toutes les informations publiques sur les utilisateurs et les machines qui fonctionnent. <br><br>  Tom a lancÃ© l'utilitaire adfind et a commencÃ© Ã  envoyer des demandes LDAP au contrÃ´leur de domaine.  Avec un filtre par classe objectategory, spÃ©cifiant person comme attribut.  La rÃ©ponse est revenue ici avec cette structure: <br><br><pre><code class="plaintext hljs">dn:CN=,CN=Users,DC=domain,DC=local &gt;objectClass: top &gt;objectClass: person &gt;objectClass: organizationalPerson &gt;objectClass: user &gt;cn:  &gt;description:           &gt;distinguishedName: CN=,CN=Users,DC=domain,DC=local &gt;instanceType: 4 &gt;whenCreated: 20120228104456.0Z &gt;whenChanged: 20120228104456.0Z</code> </pre> <br>  De plus, il y avait encore beaucoup d'informations utiles, mais la plus intÃ©ressante Ã©tait dans le champ&gt; description:&gt; description.  Ce commentaire de compte est, en principe, un endroit pratique pour stocker des notes mineures.  Mais les administrateurs du client ont considÃ©rÃ© que les mots de passe peuvent Ã©galement rester calmement ici.  Qui, aprÃ¨s tout, pourrait Ãªtre intÃ©ressÃ© par tous ces dossiers de service mineurs?  Par consÃ©quent, les commentaires reÃ§us par Tom ressemblaient Ã : <br><br><pre> <code class="plaintext hljs"> , 2018.11.16 7po!*Vqn</code> </pre> <br>  Vous n'avez pas besoin d'avoir sept travÃ©es dans le front pour comprendre pourquoi la combinaison est utile Ã  la fin.  Il restait Ã  analyser un gros fichier de rÃ©ponses du CD par le champ&gt; description: et les voici - 20 paires login-mot de passe.  Et prÃ¨s de la moitiÃ© ont des droits d'accÃ¨s RDP.  Bon pied, il est temps de diviser les forces attaquantes. <br><br><h2>  Environnement rÃ©seau </h2><br>  Les boules accessibles de Baskerville Dogs ressemblaient Ã  une grande ville dans tout son chaos et son imprÃ©visibilitÃ©.  Avec des profils d'utilisateurs et de RDP, Tom Hunter Ã©tait un pauvre garÃ§on dans cette ville, mais mÃªme il a rÃ©ussi Ã  regarder beaucoup de choses Ã  travers les fenÃªtres brillantes des politiques de sÃ©curitÃ©. <br><br>  Des parties de serveurs de fichiers, des comptes comptables et mÃªme des scripts qui leur sont associÃ©s - tout cela a Ã©tÃ© partagÃ©.  Dans les paramÃ¨tres de l'un de ces scripts, Tom a trouvÃ© le hachage MS SQL d'un utilisateur.  Un peu de magie par force brute - et le hachage de l'utilisateur transformÃ© en mot de passe en texte brut.  Merci Ã  John The Ripper et Hashcat. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/475/884/6c0/4758846c0301c7914bc41c33ad92efba.png"><br><br>  Cette clÃ© aurait dÃ» venir Ã  un coffre.  Le coffre a Ã©tÃ© retrouvÃ© et de plus, dix autres Â«coffresÂ» y Ã©taient reliÃ©s.  Et dans six laÃ¯cs ... droits de superutilisateur, nt autoritÃ© \ systÃ¨me!  Sur deux, j'ai rÃ©ussi Ã  exÃ©cuter la procÃ©dure stockÃ©e xp_cmdshell et Ã  envoyer des commandes cmd Ã  Windows.  Que voulez-vous de plus? <br><br><h2>  ContrÃ´leurs de domaine </h2><br>  Tom Hunter a prÃ©parÃ© le deuxiÃ¨me coup pour les contrÃ´leurs de domaine.  Il y en avait trois dans le rÃ©seau des chiens Baskerville, selon le nombre de serveurs gÃ©ographiquement Ã©loignÃ©s.  Chaque contrÃ´leur de domaine a un dossier public, comme une vitrine ouverte dans un magasin, Ã  cÃ´tÃ© duquel le mÃªme garÃ§on appauvri Tom traÃ®ne. <br><br>  Et cette fois, le gars a de nouveau eu de la chance - ils ont oubliÃ© de supprimer le script de la fenÃªtre oÃ¹ le mot de passe de l'administrateur du serveur local Ã©tait codÃ© en dur.  Le chemin vers le contrÃ´leur de domaine Ã©tait donc ouvert.  Entrez, Tom! <br><br>  Ici, un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">mimikatz a</a> Ã©tÃ© extrait du chapeau magique, ce qui a Ã©tÃ© rentable pour plusieurs administrateurs de domaine.  Tom Hunter a eu accÃ¨s Ã  toutes les machines du rÃ©seau local, et un rire diabolique a fait peur au chat depuis une chaise voisine.  Ce chemin Ã©tait plus court que prÃ©vu. <br><br><h2>  Eternalblue </h2><br>  La mÃ©moire de WannaCry et Petya est toujours vivante dans l'esprit des pentesters, mais certains administrateurs semblent avoir oubliÃ© les cryptographes dans le flux d'autres nouvelles du soir.  Tom a dÃ©couvert trois nÅ“uds avec une vulnÃ©rabilitÃ© dans le protocole SMB - CVE-2017-0144 ou EternalBlue.  Il s'agit de la mÃªme vulnÃ©rabilitÃ© Ã  l'aide du ransomware WannaCry et Petya, une vulnÃ©rabilitÃ© qui permet d'exÃ©cuter du code arbitraire sur un hÃ´te.  Ã€ l'un des nÅ“uds vulnÃ©rables, il y avait une session d'administration de domaine - Â«exploiter et obtenirÂ».  Que pouvez-vous faire, le temps n'a pas enseignÃ© Ã  tout le monde. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/090/a04/c4d/090a04c4d07cd5a393972031e33776b3.png"><br><br><h2>  Le chien de Basterville </h2><br>  Les classiques de la sÃ©curitÃ© de l'information aiment rÃ©pÃ©ter que le point le plus faible de tout systÃ¨me est une personne.  Notez que le titre ci-dessus ne correspond pas au nom du magasin?  Peut-Ãªtre que tout le monde n'est pas si prudent. <br><br>  Dans la meilleure tradition des blockbusters de phishing, Tom Hunter a enregistrÃ© un domaine d'une lettre diffÃ©rent du domaine des chiens Baskerville.  L'adresse postale de ce domaine simule l'adresse du service de sÃ©curitÃ© des informations du magasin.  Dans les 4 jours de 16h00 Ã  17h00, un message comme celui-ci a Ã©tÃ© envoyÃ© uniformÃ©ment Ã  360 adresses Ã  partir d'une fausse adresse: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/135/744/e45/135744e454ee0075f4745eee7906fdbc.png"><br><br>  Peut-Ãªtre que seule leur propre paresse a sauvÃ© les employÃ©s du dÃ©versement massif de mots de passe.  Sur les 360 lettres, seulement 61 ont Ã©tÃ© ouvertes - le service de sÃ©curitÃ© n'est pas trÃ¨s populaire.  Mais c'Ã©tait plus facile. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/54a/d2f/c25/54ad2fc254381272cac2dcaefb743cf1.png"><br>  <i>Page de phishing</i> <br><br>  46 personnes ont cliquÃ© sur le lien et prÃ¨s de la moitiÃ© - 21 employÃ©s - n'ont pas regardÃ© dans la barre d'adresse et ont calmement entrÃ© leurs noms d'utilisateur et mots de passe.  Bonne prise, Tom. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3ef/c17/e88/3efc17e88dd9a32689c7f6a679118f43.jpg"><br><br><h2>  RÃ©seau Wi-Fi </h2><br>  Maintenant, je n'avais plus Ã  compter sur l'aide d'un chat.  Tom Hunter a jetÃ© quelques morceaux de fer dans sa vieille berline et s'est dirigÃ© vers le bureau des chiens de Baskerville.  Sa visite nâ€™a pas Ã©tÃ© acceptÃ©e: Tom allait tester le Wi-Fi du client.  Dans le parking du centre d'affaires, il y avait plusieurs places libres qui ont rÃ©ussi Ã  pÃ©nÃ©trer dans le pÃ©rimÃ¨tre du rÃ©seau cible.  Apparemment, ils n'ont pas spÃ©cialement pensÃ© Ã  sa restriction - comme si les administrateurs avaient piquÃ© au hasard des points supplÃ©mentaires en rÃ©ponse Ã  une plainte concernant une connexion Wi-Fi faible. <br><br>  Comment fonctionne la protection WPA / WPA2 PSK?  Le chiffrement entre le point d'accÃ¨s et les clients fournit une clÃ© de prÃ©-session - Pairwise Transient Key (PTK).  PTK utilise la clÃ© prÃ©-partagÃ©e et cinq autres paramÃ¨tres - SSID, Authenticator Nounce (ANounce), Supplicant Nounce (SNounce), adresses MAC du point d'accÃ¨s et du client.  Tom a interceptÃ© les cinq paramÃ¨tres, et maintenant seule la clÃ© prÃ©-partagÃ©e Ã©tait manquante. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/793/240/7a8/7932407a8089981039a332bfb1d97bf6.png"><br><br>  L'utilitaire Hashcat a obtenu ce lien manquant en environ 50 minutes - et notre hÃ©ros s'est retrouvÃ© dans un rÃ©seau invitÃ©.  Dans le quartier, vous pouviez voir le rÃ©seau de travail de l'entreprise - curieusement, ici, Tom a gÃ©rÃ© le mot de passe pendant environ neuf minutes.  Et tout cela sans quitter le parking, sans aucun VPN.  Le rÃ©seau de travail a ouvert nos espaces ouverts de hÃ©ros pour une activitÃ© monstrueuse, mais il ... n'a pas lancÃ© de bonus sur la carte du magasin. <br><br>  <i>Tom fit une pause, regarda sa montre, jeta quelques billets sur la table et, au revoir, quitta le cafÃ©.</i>  <i>Peut-Ãªtre encore une fois un pentest, ou peut-Ãªtre que j'ai imaginÃ© une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">chaÃ®ne de tÃ©lÃ©gramme</a> ...</i> <i><br></i> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr467199/">https://habr.com/ru/post/fr467199/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr467187/index.html">CrÃ©er la derniÃ¨re bibliothÃ¨que technologique</a></li>
<li><a href="../fr467189/index.html">Ã‰chantillonnage de tempÃ©rature</a></li>
<li><a href="../fr467191/index.html">Comment nous avons crÃ©Ã© Vivaldi pour Android</a></li>
<li><a href="../fr467193/index.html">Virus mineur avec Â«Heaven's GateÂ»</a></li>
<li><a href="../fr467197/index.html">Comment le polymorphisme est implÃ©mentÃ© dans la JVM</a></li>
<li><a href="../fr467201/index.html">ExpÃ©rience CacheBrowser: Contournement d'un pare-feu chinois sans proxy Ã  l'aide de la mise en cache de contenu</a></li>
<li><a href="../fr467203/index.html">Juste la division, ou comment crÃ©er une thÃ©orie mathÃ©matique et y gagner 400 000 $. DeuxiÃ¨me sÃ©rie, avant-derniÃ¨re</a></li>
<li><a href="../fr467205/index.html">Nous dÃ©veloppons une application qui envoie des donnÃ©es vers d'autres applications (application Ã©cosystÃ¨me)</a></li>
<li><a href="../fr467207/index.html">Cinq langages de programmation prometteurs avec un bel avenir (3 ans plus tard)</a></li>
<li><a href="../fr467209/index.html">"Agents autonomes" ou exÃ©cutez du code dans la cryptoplateforme ouverte Obyte</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>