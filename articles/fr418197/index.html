<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üóÇÔ∏è üë©‚Äçüëß‚Äçüëß üë≤üèΩ Cours MIT "S√©curit√© des syst√®mes informatiques". Conf√©rence 4: ¬´Partager les privil√®ges¬ª, partie 2 üë®üèª‚Äçüîß üïé üêÆ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Institut de technologie du Massachusetts. Cours magistral # 6.858. "S√©curit√© des syst√®mes informatiques." Nikolai Zeldovich, James Mickens. 2014 ann√©e...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Cours MIT "S√©curit√© des syst√®mes informatiques". Conf√©rence 4: ¬´Partager les privil√®ges¬ª, partie 2</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ua-hosting/blog/418197/"><h3>  Institut de technologie du Massachusetts.  Cours magistral # 6.858.  "S√©curit√© des syst√®mes informatiques."  Nikolai Zeldovich, James Mickens.  2014 ann√©e </h3><br>  Computer Systems Security est un cours sur le d√©veloppement et la mise en ≈ìuvre de syst√®mes informatiques s√©curis√©s.  Les conf√©rences couvrent les mod√®les de menace, les attaques qui compromettent la s√©curit√© et les techniques de s√©curit√© bas√©es sur des travaux scientifiques r√©cents.  Les sujets incluent la s√©curit√© du syst√®me d'exploitation (OS), les fonctionnalit√©s, la gestion du flux d'informations, la s√©curit√© des langues, les protocoles r√©seau, la s√©curit√© mat√©rielle et la s√©curit√© des applications Web. <br><br>  Cours 1: ¬´Introduction: mod√®les de menace¬ª <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 1</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 2</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 3</a> <br>  Conf√©rence 2: ¬´Contr√¥le des attaques de pirates¬ª <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 1</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 2</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 3</a> <br>  Conf√©rence 3: ¬´D√©bordements de tampon: exploits et protection¬ª <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 1</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 2</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 3</a> <br>  Conf√©rence 4: ¬´S√©paration des privil√®ges¬ª <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 1</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 2</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 3</a> <a name="habracut"></a><br><br>  Alors qu'avions-nous d'autre sur cette liste?  Processus.  La m√©moire est quelque chose qui se produit simultan√©ment avec le processus.  Ainsi, si vous n'√™tes pas dans ce processus, vous ne pouvez pas acc√©der √† sa m√©moire.  La m√©moire virtuelle am√©liore parfaitement cet isolement pour nous.  De plus, le m√©canisme de d√©bogage vous permet de "pop" dans la m√©moire d'un autre processus, si vous avez le m√™me ID utilisateur <br><br>  Ensuite, nous avons le r√©seau.  Les r√©seaux sous <b>Unix</b> ne correspondent pas tout √† fait au mod√®le d√©crit ci-dessus, en partie du fait que le <b>syst√®me d'</b> exploitation <b>Unix</b> a d'abord √©t√© d√©velopp√©, puis un r√©seau est apparu, qui est rapidement devenu populaire.  Il a un ensemble de r√®gles l√©g√®rement diff√©rent.  Par cons√©quent, les op√©rations dont nous devons vraiment nous occuper sont de connecter quelqu'un au r√©seau si vous g√©rez le r√©seau ou d'√©couter un port si vous agissez en tant que serveur.  Vous devrez peut-√™tre lire ou √©crire des donn√©es sur cette connexion, ou envoyer et recevoir <b>des</b> paquets <b>bruts</b> . <br><br><img src="https://habrastorage.org/webt/dw/gn/zv/dwgnzva6txwuj_esllvdnx3uexg.jpeg"><br><br>  Ainsi, les r√©seaux sous <b>Unix</b> sont pour la plupart sans rapport avec l' <b>ID utilisateur</b> .  Les r√®gles sont que n'importe qui peut toujours se connecter √† n'importe quelle machine ou n'importe quelle adresse IP ou ouvrir une connexion.  Si vous voulez √©couter sur un port, alors dans ce cas il y a une diff√©rence, c'est que la plupart des utilisateurs sont interdits d'√©couter des ports avec un nombre inf√©rieur √† la ¬´valeur magique¬ª de 1024. En principe, vous pouvez √©couter de tels ports, mais dans ce cas, vous devriez Soyez un utilisateur sp√©cial appel√© <b>"super utilisateur"</b> avec <b>uid = 0</b> . <br><br>  En g√©n√©ral, sous Unix, il y a le concept d'administrateur, ou de superutilisateur, qui est repr√©sent√© par l'identifiant uid = 0, qui peut contourner presque toutes ces v√©rifications, donc si vous travaillez avec des droits root, vous pouvez lire et √©crire des fichiers, changer les droits d'acc√®s pour eux.  Le syst√®me d'exploitation vous permettra de le faire car il pense que vous devriez avoir tous les privil√®ges.  Et vous avez vraiment besoin de tels privil√®ges pour √©couter sur les ports avec un nombre &lt;1024. Que pensez-vous d'une restriction aussi √©trange? <br><br>  <b>Public:</b> il identifie des num√©ros de port sp√©cifiques pour des connexions sp√©cifiques, par exemple, pour <b>http</b> sur le port 80. <br><br>  <b>Professeur:</b> oui, par d√©faut le <b>protocole HTTP</b> utilise le port 80. En revanche, d'autres services peuvent utiliser des ports avec un nombre sup√©rieur √† 1024, pourquoi cette restriction est-elle n√©cessaire?  Quelle est l'utilit√© ici? <br><br>  <b>Public:</b> parce que vous ne voulez pas que quelqu'un √©coute accidentellement votre <b>HTTP</b> . <br><br>  <b>Professeur:</b> oui.  Je pense que la raison en est que vous aviez auparavant de nombreux utilisateurs sur la m√™me machine.  Ils se sont connect√©s avec leurs identifiants de connexion, ont lanc√© leurs applications, vous vouliez donc vous assurer qu'un utilisateur al√©atoire, s'√©tant connect√© √† l'ordinateur, ne pourrait pas mettre la main sur le serveur Web en cours d'ex√©cution.  Parce que les utilisateurs se connectant de l'ext√©rieur ne savent pas qui travaille sur ce port, et ils se connectent simplement au port 80. Si je veux entrer dans cette machine et d√©marrer mon propre serveur Web, je transf√®re simplement tout le trafic du serveur Web vers cette voiture.  Ce n'est probablement pas un tr√®s bon plan, mais c'est la fa√ßon dont le sous-syst√®me r√©seau Unix emp√™che les utilisateurs al√©atoires de contr√¥ler les services connus s'ex√©cutant sur ces num√©ros de port bas.  Telle est la justification d'une telle limitation. <br><br><img src="https://habrastorage.org/webt/ba/0o/qn/ba0oqn2qgabud4-_hmizsks086s.jpeg"><br><br>  De plus, du point de vue de la lecture et de l'√©criture des donn√©es de connexion, si vous avez un fichier descripteur pour un socket sp√©cifique, <b>Unix</b> vous permettra de lire et d'√©crire toutes les donn√©es de cette <b>connexion TCP</b> ou <b>uTP</b> .  Lors de l'envoi <b>de</b> paquets <b>bruts</b> , <b>Unix</b> se comporte comme un parano√Øaque, il ne vous permettra donc pas d'envoyer des paquets arbitraires sur le r√©seau.  Cela devrait √™tre dans le contexte de la connexion sp√©ciale, sauf si vous avez <b>root - le</b> droit et vous pouvez faire ce que vous voulez. <br><br>  Donc, une question int√©ressante que vous pourriez poser est d'o√π viennent tous ces <b>ID utilisateur</b> ? <br><br>  Nous parlons de processus ayant <b>userid</b> ou <b>groupid</b> .  Lorsque vous lancez <b>PS</b> sur votre ordinateur, vous verrez certainement une s√©rie de processus avec diff√©rentes valeurs <b>uid</b> .  D'o√π venaient-ils? <br><br>  Nous avons besoin d'un m√©canisme pour charger toutes ces valeurs d' <b>ID utilisateur</b> .  <b>Unix</b> a plusieurs appels syst√®me con√ßus pour cela.  Par cons√©quent, pour amorcer ces valeurs d'identificateur, il existe une fonction appel√©e <b>setuid (uid)</b> , vous pouvez donc attribuer le num√©ro <b>uid</b> d'un processus en cours √† cette valeur.  C'est en fait une op√©ration dangereuse, comme tout le reste dans la tradition <b>Unix</b> , car vous ne pouvez le faire que si votre <b>uid = 0</b> .  En tout cas, il devrait en √™tre ainsi. <br><br>  Ainsi, si vous √™tes un utilisateur avec des droits root et que <b>uid = 0</b> , vous pouvez appeler <b>setuid (uid)</b> et basculer l'utilisateur vers n'importe quel processus.  Il existe quelques autres appels syst√®me similaires pour initialiser le <b>gid</b> li√© au processus: ce sont <b>setgid</b> et <b>setgroups</b> .  Par cons√©quent, ces appels syst√®me vous permettent de configurer les privil√®ges de processus. <br><br><img src="https://habrastorage.org/webt/qs/6m/bk/qs6mbkc520bn-n_vlpznivx1z0q.jpeg"><br><br>  Le fait que vos processus obtiennent les droits d'acc√®s corrects lorsque vous vous connectez √† la machine <b>Unix</b> ne se produit pas car vous avez le m√™me <b>ID</b> que les processus, car le syst√®me ne sait pas encore qui vous √™tes.  Au lieu de cela, sous <b>Unix,</b> il existe une sorte de proc√©dure de connexion lorsque le <b>protocole de</b> shell s√©curis√© <b>SSH</b> d√©marre le processus pour quiconque se connecte √† l'ordinateur et essaie d'authentifier l'utilisateur. <br><br>  Ainsi, initialement, ce processus de connexion commence par <b>uid = 0</b> comme pour un utilisateur avec des droits root, puis, lorsqu'il re√ßoit un nom d'utilisateur et un mot de passe sp√©cifiques, il les v√©rifie dans sa propre base de donn√©es de comptes.  G√©n√©ralement, sous <b>Unix,</b> ces donn√©es sont stock√©es dans deux fichiers: <b>/ etc / password</b> (pour des raisons historiques, les mots de passe ne sont plus stock√©s dans ce fichier) et dans le fichier <b>/ etc / shadow</b> , dans lequel les mots de passe sont stock√©s.  Cependant, il existe une table dans le fichier <b>/ etc / password</b> qui affiche chaque nom d'utilisateur dans le syst√®me sous forme de valeur enti√®re. <br><br>  Ainsi, votre nom d'utilisateur est mapp√© √† un entier sp√©cifique dans ce fichier <b>/ etc / password</b> , puis le processus de connexion v√©rifie si votre mot de passe est correct en fonction de ce fichier.  S'il trouve votre <b>uid</b> entier, il d√©finit les fonctions <b>setuid</b> sur cette valeur <b>uid</b> et d√©marre le shell avec la commande <b>exec (/ bin / sh)</b> .  Vous pouvez maintenant interagir avec le shell, mais cela fonctionne sous votre <b>UID</b> , vous ne pourrez donc pas endommager accidentellement cette machine. <br><br><img src="https://habrastorage.org/webt/oa/vi/t8/oavit8bjjn_skjz8-n1k5dhc6co.jpeg"><br><br>  <b>Public: est-</b> il possible de d√©marrer un nouveau processus avec <b>uid = 0</b> si votre <b>uid</b> n'est pas vraiment 0? <br><br>  <b>Professeur:</b> si vous avez des privil√®ges root, vous pouvez vous limiter √† un autre <b>uid</b> , r√©duire votre autorit√©, mais dans tous les cas, vous pouvez cr√©er un processus avec uniquement le m√™me <b>uid</b> que le v√¥tre.  Mais il arrive que pour diverses raisons vous souhaitiez augmenter vos privil√®ges.  Supposons que vous devez installer un package pour lequel vous avez besoin <b>des</b> privil√®ges <b>root</b> . <br><br>  Il existe deux fa√ßons de d√©finir des privil√®ges sur <b>Unix</b> .  Celui que nous avons d√©j√† mentionn√© est un descripteur de fichier.  Donc, si vous voulez vraiment augmenter vos privil√®ges, vous pouvez parler √† quelqu'un qui travaille sous les droits root et lui demander d'ouvrir ce fichier pour vous.  Ou vous devez installer une nouvelle interface, puis cet assistant ouvre un fichier pour vous et vous renvoie un descripteur de fichier en utilisant le transfert <b>fd</b> .  C'est une fa√ßon d'augmenter vos privil√®ges, mais cela n'est pas pratique car dans certains cas, des processus s'ex√©cutent avec un grand nombre de privil√®ges.  Pour cela, <b>Unix</b> a un m√©canisme intelligent mais en m√™me temps probl√©matique appel√© <b>"binaires setuid"</b> .  Ce m√©canisme est un ex√©cutable standard sur un <b>syst√®me de</b> fichiers <b>Unix</b> , sauf lorsque vous ex√©cutez <b>exec</b> sur le binaire <b>setuid</b> , par exemple, <b>/ bin / su</b> sur la plupart des machines, ou <b>sudo</b> , au d√©marrage. <br><br>  Un syst√®me <b>Unix</b> typique a un tas de binaires <b>setuid</b> .  La diff√©rence est que lorsque vous ex√©cutez l'un de ces binaires, il bascule r√©ellement l' <b>ID utilisateur du</b> processus vers le propri√©taire de ce binaire.  Ce m√©canisme semble √©trange lorsque vous le voyez pour la premi√®re fois.  En r√®gle g√©n√©rale, les fa√ßons de l'utiliser sont que ce ¬´binaire¬ª a tr√®s probablement un <b>UID de</b> propri√©taire <b>de</b> 0, car vous voulez vraiment restaurer de nombreux privil√®ges. <br><br><img src="https://habrastorage.org/webt/zt/s5/8d/zts58db83nchnbo1a6qqobpbpuw.jpeg"><br><br>  Vous voulez restaurer les droits de superutilisateur afin que vous puissiez ex√©cuter cette commande <b>su</b> , et le noyau, lorsque vous ex√©cutez ce binaire, basculera l' <b>uid</b> du processus sur 0, de sorte que ce programme effectuera maintenant certaines choses privil√©gi√©es. <br><br>  <b>Public:</b> si vous avez <b>uid = 0</b> et que vous changez l' <b>uid de</b> tous ces binaires <b>setuid</b> en autre chose que 0, pouvez-vous restaurer vos privil√®ges? <br><br>  <b>Professeur:</b> non, de nombreux processus ne pourront pas restaurer les privil√®ges lors de la baisse du niveau d'acc√®s, vous pouvez donc √™tre bloqu√© √† cet endroit.  Ce m√©canisme n'est pas li√© √† <b>uid = 0</b> .  Comme tout utilisateur d'un syst√®me <b>Unix</b> , vous pouvez cr√©er n'importe quel fichier binaire, cr√©er un programme, le compiler et d√©finir ce bit <b>setuid</b> sur le programme lui-m√™me.  Il vous appartient, l'utilisateur, votre ID utilisateur.  Et cela signifie que toute personne qui ex√©cute votre programme ex√©cutera ce code avec votre ID utilisateur.  Y a-t-il un probl√®me avec cela?  Que faut-il faire? <br><br>  <b>Public:</b> c'est-√†-dire, s'il y a eu une erreur dans votre candidature, quelqu'un pourrait-il en faire quoi que ce soit, en agissant avec vos privil√®ges? <br><br>  <b>Professeur: c'est</b> vrai, cela arrive si mon application est "buggy", ou si elle vous permet d'ex√©cuter tout ce que vous voulez.  Supposons que je puisse copier le shell du syst√®me et le configurer pour moi, mais n'importe qui peut ex√©cuter ce shell sous mon compte.  Ce n'est probablement pas le meilleur plan d'action.  Mais un tel m√©canisme ne cr√©e pas de probl√®me, car la seule personne qui peut d√©finir le bit <b>setuid</b> sur un fichier binaire est le propri√©taire de ce fichier.  En tant que propri√©taire du fichier, vous disposez du privil√®ge <b>uid</b> , vous pouvez donc transf√©rer votre compte √† une autre personne, mais cette autre personne ne pourra pas cr√©er le binaire <b>setuid</b> avec votre <b>ID utilisateur</b> . <br><br>  Ce bit setuid est stock√© √† c√¥t√© de ces bits d'autorisation, c'est-√†-dire que dans chaque <b>inode</b> il y a aussi un bit <b>setuid</b> qui indique si ce fichier ex√©cutable devrait ou si le programme est pass√© √† l' <b>uid</b> du propri√©taire pendant l'ex√©cution. <br><br><img src="https://habrastorage.org/webt/4d/o0/cf/4do0cfauri7y6g94omunnrdyv14.jpeg"><br><br>  Il s'av√®re que c'est un m√©canisme tr√®s d√©licat lorsqu'il est utilis√© correctement, et gr√¢ce √† lui, le noyau impl√©mente le programme correctement.  En fait, c'est assez facile √† faire, car une seule v√©rification est effectu√©e: si ce bit <b>setuid</b> existe, le processus passe √† <b>uid</b> .  C'est assez simple. <br><br>  Mais l'utiliser en toute s√©curit√© est assez difficile, car, comme cela vient d'√™tre indiqu√©, si ce programme contient des erreurs ou fait quelque chose d'inattendu, vous avez la possibilit√© de faire des choses arbitraires sous <b>uid = 0</b> ou sous tout autre <b>uid</b> .  Sous <b>Unix,</b> lorsque vous ex√©cutez un programme, vous h√©ritez de beaucoup de choses de votre processus parent. <br><br>  Par exemple, vous pouvez transmettre des variables d'environnement aux binaires <b>setuid</b> .  Le fait est que sous <b>Unix,</b> vous pouvez sp√©cifier la biblioth√®que partag√©e √† utiliser pour le processus en d√©finissant la variable d'environnement, et les binaires <b>setuid</b> ne se soucient pas de filtrer ces variables d'environnement. <br><br>  Par exemple, vous pouvez ex√©cuter <b>bin / su</b> , mais utiliser des biblioth√®ques partag√©es pour la fonction <b>printf</b> , afin que votre <b>printf</b> d√©marre lorsque <b>bin / su</b> imprime quelque chose, et vous pouvez ex√©cuter le shell au lieu de printingf. <br><br>  Il y a beaucoup de subtilit√©s que vous devez comprendre correctement concernant la m√©fiance du programme envers les donn√©es que l'utilisateur entre.  Parce que vous faites g√©n√©ralement confiance aux entr√©es utilisateur, <b>setuid</b> n'a jamais √©t√© la partie la plus s√ªre d'un syst√®me <b>Unix</b> complet.  Vous avez des questions √† ce sujet? <br><br>  <b>Public:</b> <b>setuid</b> s'applique-t-il √©galement aux groupes ou uniquement √† l'utilisateur? <br><br>  <b>Professeur:</b> il y a un bit <b>setgid</b> sym√©trique au bit <b>setuid</b> , que vous pouvez √©galement r√©gler.  Si le fichier a un <b>gid</b> sp√©cifique et que ce bit <b>setgid</b> est d√©fini au d√©marrage du programme, vous l'obtiendrez. <br><br>  <b>Setgid n'est</b> pas particuli√®rement utilis√©, mais peut √™tre utile dans les cas o√π vous souhaitez fournir des privil√®ges tr√®s sp√©cifiques.  Par exemple, <b>bin / su a</b> probablement besoin de beaucoup de privil√®ges, mais il y a peut-√™tre un programme qui a besoin de quelques privil√®ges suppl√©mentaires, par exemple, pour √©crire quelque chose dans un fichier journal sp√©cial.  Par cons√©quent, vous souhaiterez probablement lui fournir un certain groupe et cr√©er un fichier journal pour elle qui sera accessible en √©criture par ce groupe.  Donc, m√™me si le programme est ¬´bugg√©¬ª, vous ne perdrez rien d'autre que ce groupe.  Ceci est utile comme m√©canisme qui, pour une raison quelconque, n'est pas utilis√© trop souvent, car apr√®s tout, les gens devraient utiliser davantage les droits root. <br><br>  <b>Public:</b> Existe-t-il des restrictions quant √† qui peut modifier l'acc√®s? <br><br>  <b>Professeur:</b> oui.  Diff√©rentes impl√©mentations <b>Unix</b> ont des v√©rifications diff√©rentes pour cela.  La r√®gle g√©n√©rale est que seul root peut changer le propri√©taire du fichier, car vous ne voulez pas cr√©er de fichiers qui appartiendront √† quelqu'un d'autre et bien s√ªr vous ne voulez pas vous approprier les fichiers d'autres personnes.  Donc, si votre <b>UID n'est</b> pas 0, alors vous √™tes coinc√©.  Vous ne pouvez pas modifier la propri√©t√© d'un fichier.  Si votre <b>uid = 0</b> , vous avez des privil√®ges root et vous pouvez changer le propri√©taire en n'importe qui.  Il y a quelques complications si vous avez un <b>setuid</b> binaire et que vous passez d'un <b>uid</b> √† un autre, c'est assez d√©licat, mais en gros vous ne pouvez pas changer le propri√©taire du fichier si vous n'avez pas les privil√®ges root. <br><br>  Par tous les comptes, c'est un syst√®me l√©g√®rement d√©pass√©.  Vous pourriez probablement imaginer de nombreuses fa√ßons de simplifier les processus d√©crits ci-dessus, mais en fait, la plupart des syst√®mes avanc√©s ressemblent √† ceci car ils √©voluent avec le temps.  Mais vous pouvez parfaitement utiliser ces m√©canismes comme un "bac √† sable". <br><br>  Ce ne sont que des principes de base d' <b>Unix</b> , qui apparaissent dans presque tous les syst√®mes d'exploitation de type Unix: <b>Mac OS X</b> , <b>Linux</b> , <b>FreeBSD</b> , <b>Solaris</b> , si quelqu'un d'autre l'utilise, etc.  Mais chacun de ces syst√®mes poss√®de des m√©canismes plus sophistiqu√©s que vous pourriez utiliser.  Par exemple, sous <b>Linux,</b> il existe un ensemble ¬´bac √† sable¬ª <b>COMP</b> , <b>Mac OS X</b> utilise la <b>ceinture de s√©curit√©</b> ¬´bac √† sable¬ª.  La semaine prochaine, je vous donnerai des exemples de bacs √† sable disponibles sur chaque syst√®me bas√© sur <b>Unix</b> . <br><br>  Ainsi, l'un des derniers m√©canismes, que nous examinerons avant de plonger dans <b>OKWS</b> , explique comment vous devez g√©rer les binaires <b>setuid</b> et montre comment vous prot√©ger contre les failles de s√©curit√© existantes.  Le probl√®me est que vous aurez in√©vitablement des binaires <b>setuid</b> sur votre syst√®me, comme <b>/ bin / su</b> , ou <b>sudo</b> , ou autre chose, et il est probable que vos programmes auront des erreurs.  Pour cette raison, quelqu'un pourra ex√©cuter le binaire <b>setuid</b> et le processus pourra acc√©der √† la <b>racine</b> , ce que vous ne voulez pas autoriser. <br><br><img src="https://habrastorage.org/webt/gy/nt/aa/gyntaadl0kgyfcku6ncq8v334kg.jpeg"><br><br>  Le m√©canisme <b>Unix</b> , qui est souvent utilis√© pour emp√™cher l'ex√©cution d'un processus potentiellement malveillant √† l'aide de binaires <b>setuid</b> , consiste √† utiliser l'espace de noms du syst√®me de fichiers pour le modifier √† l'aide de l'appel syst√®me <b>chroot</b> , l'op√©ration de modification du r√©pertoire racine.  <b>OKWS</b> , en tant que serveur Web sp√©cialis√© dans la cr√©ation de services Web rapides et s√©curis√©s, l'utilise assez largement. <br><br><img src="https://habrastorage.org/webt/m3/x1/xr/m3x1xrg_tmht2b2l8rwd8kzzy7s.jpeg"><br><br>  Donc, sous <b>Unix,</b> vous pouvez ex√©cuter <b>chroot</b> dans un r√©pertoire sp√©cifique, vous pouvez donc peut-√™tre aussi ex√©cuter <b>chroot ("/ foo")</b> . <br><br>  Il y a 2 explications pour ce que fait <b>chroot</b> .  Le premier est simplement intuitif, cela signifie qu'apr√®s avoir ex√©cut√© <b>chroot</b> , le r√©pertoire racine ou le r√©pertoire situ√© derri√®re la barre oblique est fondamentalement √©quivalent √† ce que <b>/ foo a utilis√©</b> avant d'appeler <b>chroot</b> .  Cela ressemble √† limiter l'espace de noms sous votre <b>/ foo</b> .  Par cons√©quent, si vous avez un fichier qui s'appelait auparavant <b>/ foo / x</b> , apr√®s avoir appel√© <b>chroot,</b> vous pouvez obtenir ce fichier simplement en ouvrant <b>/ x</b> .  Limitez donc votre espace de noms √† un sous-r√©pertoire.  Voici ce qu'est la version intuitive. <br><br><img src="https://habrastorage.org/webt/2w/58/wf/2w58wflgecku62k-urraxwggxcc.jpeg"><br><br>  Bien s√ªr, en mati√®re de s√©curit√©, ce n'est pas la version intuitive qui compte, mais que fait exactement le noyau avec cet appel syst√®me?  Et cela fait essentiellement deux choses.  Tout d'abord, il change la valeur de cette barre oblique, donc chaque fois que vous acc√©dez ou lorsque vous d√©marrez le nom du r√©pertoire avec une barre oblique, le noyau inclut tout fichier que vous avez fourni avec des op√©rations <b>chroot</b> .  Dans notre exemple, il s'agit du fichier <b>/ foo</b> avant d'appeler <b>chroot</b> , c'est-√†-dire que nous obtenons ce <b>/ = / foo</b> . <br><br><img src="https://habrastorage.org/webt/gn/yx/-t/gnyx-tksd5brn4avys0dhppaw6c.jpeg"><br><br>  La prochaine chose que le noyau essaiera de faire est de vous emp√™cher de "vous √©chapper" de votre <b>/</b> si vous le faites <b>/../</b> .  Parce que sur <b>Unix,</b> je pourrais vous demander de me donner, par exemple, <b>/../etc/password</b> .  Donc, si je venais de compl√©ter cette ligne comme ceci: <b>/foo/../etc/password</b> , ce ne serait pas bien, car je pourrais simplement quitter <b>/ foo</b> et continuer pour obtenir <b>/ etc / password</b> . <br><br>  La deuxi√®me chose que le noyau fait avec un appel syst√®me <b>Unix</b> est que lorsque vous appelez <b>chroot</b> pour ce processus particulier, il change la fa√ßon dont <b>/../ est</b> √©valu√© dans ce r√©pertoire.  Par cons√©quent, il modifie <b>/../</b> afin que <b>/ foo</b> pointe vers lui-m√™me.  Ainsi, cela ne vous permet pas de ¬´vous √©chapper¬ª, et ce changement ne s'applique qu'√† ce processus et n'affecte pas le reste.  Quelles id√©es avez-vous sur la fa√ßon de ¬´s'√©chapper¬ª de l'environnement <b>chroot en</b> utilisant la fa√ßon dont il est mis en ≈ìuvre? <br><br>  Fait int√©ressant, le noyau ne surveille qu'un seul r√©pertoire <b>chroot</b> , vous pouvez donc probablement effectuer l'op√©ration <b>chroot = (/ foo)</b> , mais vous seriez coinc√© √† cet endroit.  Vous voulez donc obtenir <b>/ etc / password</b> , mais comment faire?  Vous pouvez maintenant ouvrir le r√©pertoire racine en tapant <b>open (* / *)</b> .  Cela vous donnera un descripteur de fichier d√©crivant ce qu'est <b>/ foo</b> .  Ensuite, vous pouvez √† nouveau appeler <b>chroot</b> et ex√©cuter <b>chroot (`/ bar)</b> . <br><br><img src="https://habrastorage.org/webt/er/ce/o6/erceo6xadygvj95nuy8fj-zn1bi.jpeg"><br><br> ,    : <b>root</b>   <b>/foo</b> ,  <b>/foo/bar</b>   <b>/../</b>     <b>/foo / bar/..</b> <br><br><img src="https://habrastorage.org/webt/gi/vb/zy/givbzygict7u1xirzzwneycl3sw.jpeg"><br><br>  ,          <b>/foo</b> .            <b>fchdir (fd)</b>     <b>(*/*)</b> ,      <b>chdir (..)</b> . <br><br><img src="https://habrastorage.org/webt/lb/qz/mx/lbqzmxnz8308avfwfyaxxprq7d8.jpeg"><br><br><img src="https://habrastorage.org/webt/gu/cn/kd/gucnkdez6q9ntda3zwtotnc4igg.jpeg"><br><br>       <b>/foo</b> ,     <b>/../</b> .     <b>/foo</b>        ,       <b>root</b> ,       . <br><br> ,    ,       .       .   <b>Unix</b>    root-   <b>chroot</b> ,  <b>chroot</b>     .  ,  <b>Unix</b>    <b>uid = 0</b>  ,      <b>chroot</b> .   .           ,         ,    <b>chroot</b> ,   <b>userid</b>   .   ,     <b>Unix</b> ,     ,    <b>root</b> ,    . <br><br>       ,  , ,     .      <b>chroot</b>       ‚Äî      .    . <br><br> <b>:</b>  ,       <b>inod</b> ,      ? <br><br> <b>:</b>    !              ,  , , : ¬´   <b>inode</b>  23¬ª,      -        <b>hroot</b> .  ,  <b>Unix</b>     <b>inode</b>   <b>inode</b> ,  , ,   root-. <br><br>  ,      ,  ,   <b>OKWS</b> .  ,      <b>OKWS</b> . <br><br>  ,     -,   ,      -  ,      .          , , <b>httpd</b> , ,  <b>Apache</b> . <br><br>        <b>userid</b>   <b>www</b>  <b>/etc/password</b> .     ,   ,     <b>SSL</b> ,      <b>PHP</b>   ,        .   ,       , , <b>MySQL</b> ,           .    <b>MySQL</b>     .      <b>MySQL</b> , , ,      . <br><br><img src="https://habrastorage.org/webt/sx/tx/gd/sxtxgdpf7q9jr3q_tfxyzi6zgdc.jpeg"><br><br> ,  ,    ,    <b>MySQL</b>    ,        ,             . <br><br>         ,       ,  ,         ,   .    ,      , ,     <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apache</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , ou en </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SSL</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , ou peut-√™tre dans le code d'application ou dans l'interpr√©teur </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PHP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Et comme il y a des erreurs, vous pouvez les utiliser pour obtenir l'int√©gralit√© du contenu de l'application. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">52:30 min </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Suite:</font></font><br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Cours MIT "S√©curit√© des syst√®mes informatiques".</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conf√©rence 4: ¬´Partager les privil√®ges¬ª, partie 2</font></font></a> <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/dNl22h1kW1k" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La version compl√®te du cours est disponible </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br>  Merci de rester avec nous.  Aimez-vous nos articles?  Vous voulez voir des mat√©riaux plus int√©ressants?  Soutenez-nous en passant une commande ou en le recommandant √† vos amis, une <b>r√©duction de 30% pour les utilisateurs Habr sur un analogue unique de serveurs d'entr√©e de gamme que nous avons invent√©s pour vous:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Toute la v√©rit√© sur VPS (KVM) E5-2650 v4 (6 c≈ìurs) 10 Go DDR4 240 Go SSD 1 Gbps √† partir de 20 $ ou comment diviser le serveur?</a>  (les options sont disponibles avec RAID1 et RAID10, jusqu'√† 24 c≈ìurs et jusqu'√† 40 Go de DDR4). <br><br>  <b>Dell R730xd 2 fois moins cher?</b>  Nous avons seulement <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">2 x Intel Dodeca-Core Xeon E5-2650v4 128 Go DDR4 6x480 Go SSD 1 Gbps 100 TV √† partir de 249 $</a> aux Pays-Bas et aux √âtats-Unis!</b>  Pour en savoir plus sur la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">cr√©ation d'un b√¢timent d'infrastructure.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">classe utilisant des serveurs Dell R730xd E5-2650 v4 co√ªtant 9 000 euros pour un sou?</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr418197/">https://habr.com/ru/post/fr418197/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr418187/index.html">En Am√©rique, ils ont sugg√©r√© de remplacer toutes les biblioth√®ques par des hubs Amazon. Le public s'indigne</a></li>
<li><a href="../fr418189/index.html">H√©ritier de Zeus: pourquoi le cheval de Troie IcedID est dangereux pour les clients des banques</a></li>
<li><a href="../fr418191/index.html">Analogues en Python et JavaScript. Troisi√®me partie</a></li>
<li><a href="../fr418193/index.html">Comment vous sentez-vous de cr√©er un jeu pour Game Boy en 2017</a></li>
<li><a href="../fr418195/index.html">Cours MIT "S√©curit√© des syst√®mes informatiques". Conf√©rence 4: ¬´Partager les privil√®ges¬ª, partie 1</a></li>
<li><a href="../fr418199/index.html">Comment faire une t√¢che technique simple et ne pas perdre d'argent et de nerfs</a></li>
<li><a href="../fr418201/index.html">Pouvons-nous relancer Duck Hunt?</a></li>
<li><a href="../fr418203/index.html">API GraphQL (CRUD) sur Go</a></li>
<li><a href="../fr418205/index.html">Space Language Vol.2: Bienvenue, GJ273b</a></li>
<li><a href="../fr418207/index.html">Examen des ordinateurs portables de jeu ASUS ROG Strix GL504GS SCAR II et ASUS ROG Strix GL504GM HERO II</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>