<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèª‚Äçüé® üõ©Ô∏è ü•¢ Evolu√ß√£o da abordagem de implanta√ß√£o de c√≥digo no Reddit üë©üèª‚Äçüé§ ‚ôâÔ∏è üö£üèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="N√≥s, da equipe de servi√ßos de pagamento em blockchain da Wirex , estamos familiarizados com a experi√™ncia da necessidade de refinar e melhorar constan...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Evolu√ß√£o da abordagem de implanta√ß√£o de c√≥digo no Reddit</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/wirex/blog/404577/"><img src="https://habrastorage.org/web/ff7/6e9/159/ff76e9159228455b8f91663d289c8e2f.png" alt="imagem"><br><br>  <i>N√≥s, da <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">equipe de</a> servi√ßos de pagamento em blockchain da <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Wirex</a> , estamos familiarizados com a experi√™ncia da necessidade de refinar e melhorar constantemente a solu√ß√£o tecnol√≥gica existente.</i>  <i>O autor do material abaixo fala sobre a hist√≥ria da evolu√ß√£o da implanta√ß√£o de c√≥digo da famosa plataforma de not√≠cias sociais Reddit.</i> <br><br><blockquote>  "√â importante seguir a dire√ß√£o do seu desenvolvimento para poder envi√°-lo em uma boa dire√ß√£o a tempo." </blockquote><br>  A equipe do Reddit est√° constantemente implantando c√≥digo.  Todos os membros da equipe de desenvolvimento escrevem regularmente c√≥digos que s√£o verificados novamente pelo pr√≥prio autor e testados externamente, para que ele possa ir para a "produ√ß√£o".  Toda semana fazemos pelo menos 200 "implanta√ß√µes", cada uma das quais geralmente leva menos de 10 minutos. <br><br>  O sistema que fornece tudo isso evoluiu ao longo dos anos.  Vamos ver o que mudou nisso todo esse tempo e o que permaneceu inalterado. <br><br><h3>  In√≠cio da hist√≥ria: implanta√ß√µes est√°veis ‚Äã‚Äãe recorrentes (2007-2010) </h3><br>  Todo o sistema que temos hoje cresceu a partir de uma semente - um script Perl chamado push.  Foi escrito h√° muito tempo, em tempos muito diferentes para o Reddit.  Toda a nossa equipe t√©cnica era t√£o pequena naquele momento que se <a href="">encaixava</a> silenciosamente <a href="">em uma pequena ‚Äúsala de reuni√µes‚Äù</a> .  N√£o usamos a AWS na √©poca.  O site funcionou em um n√∫mero finito de servidores e qualquer capacidade adicional teve que ser adicionada manualmente.  Tudo funcionou em um aplicativo Python monol√≠tico grande chamado r2. <br><a name="habracut"></a><br>  Uma coisa ao longo dos anos permaneceu inalterada.  As solicita√ß√µes foram classificadas no balanceador de carga e distribu√≠das entre os "conjuntos" que cont√™m servidores de aplicativos mais ou menos id√™nticos.  Por exemplo, as p√°ginas da <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">lista de t√≥picos</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">coment√°rios</a> s√£o processadas por diferentes conjuntos de servidores.  De fato, qualquer processo r2 pode lidar com qualquer tipo de solicita√ß√£o; no entanto, a divis√£o em conjuntos permite proteger cada um deles de saltos repentinos no tr√°fego em conjuntos vizinhos.  Assim, no caso de crescimento do tr√°fego, a falha n√£o amea√ßa todo o sistema, mas seus pools individuais. <br><br><img src="https://habrastorage.org/web/63d/7b1/8e7/63d7b18e768d4b15a6310ecf6f0e15d5.png" alt="imagem"><br><br>  A lista de servidores de destino foi escrita manualmente no c√≥digo da ferramenta de envio e o processo de implanta√ß√£o funcionou com um sistema monol√≠tico.  A ferramenta percorreu a lista de servidores, conectados via SSH, executou uma das seq√º√™ncias predefinidas de comandos que atualizavam a c√≥pia atual do c√≥digo usando o git e reiniciam todos os processos de aplicativos.  A ess√™ncia do processo (o c√≥digo √© bastante simplificado para uma compreens√£o geral): <br><br><pre><code class="hljs mel">#            <span class="hljs-string"><span class="hljs-string">`make -C /home/reddit/reddit static`</span></span> <span class="hljs-string"><span class="hljs-string">`rsync /home/reddit/reddit/static public:/var/www/`</span></span> #    app-        #    ,   foreach $h (@hostlist) { <span class="hljs-string"><span class="hljs-string">`git push $h:/home/reddit/reddit master`</span></span> <span class="hljs-string"><span class="hljs-string">`ssh $h make -C /home/reddit/reddit`</span></span> <span class="hljs-string"><span class="hljs-string">`ssh $h /bin/restart-reddit.sh`</span></span> }</code> </pre> <br>  A implanta√ß√£o ocorreu sequencialmente, um servidor ap√≥s o outro.  Por toda a sua simplicidade, o esquema teve uma vantagem importante: √© muito semelhante √† " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">implanta√ß√£o de can√°rios</a> ".  Ao implantar o c√≥digo em v√°rios servidores e perceber erros, voc√™ percebeu imediatamente que havia erros, pode interromper (Ctrl-C) o processo e reverter antes que surjam problemas com todas as solicita√ß√µes de uma s√≥ vez.  A facilidade de implanta√ß√£o tornou f√°cil e sem s√©rias consequ√™ncias verificar as coisas na produ√ß√£o e reverter se elas n√£o funcionaram.  Al√©m disso, era conveniente determinar qual implanta√ß√£o espec√≠fica causou erros, onde especificamente e o que precisa ser revertido. <br><br>  Esse mecanismo fez um bom trabalho ao garantir estabilidade e controle durante a implanta√ß√£o.  A ferramenta funcionou muito r√°pido.  As coisas deram certo. <br><br><h3>  Nosso regimento chegou (2011) </h3><br>  Ent√£o contratamos mais pessoas, agora havia seis desenvolvedores e nossa nova <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">‚Äúsala de reuni√µes‚Äù ficou mais espa√ßosa</a> .  Come√ßamos a perceber que o processo de implanta√ß√£o de c√≥digo agora precisava de mais coordena√ß√£o, principalmente quando os colegas trabalhavam em casa.  O utilit√°rio push foi atualizado: agora anunciava o in√≠cio e o fim das implanta√ß√µes usando o chatbot do IRC, que simplesmente ficava no IRC e anunciava os eventos.  Os processos realizados durante as implanta√ß√µes n√£o sofreram quase nenhuma altera√ß√£o, mas agora o sistema fez tudo pelo desenvolvedor e contou a todos sobre as modifica√ß√µes feitas. <br><br>  A partir desse momento, o uso do bate-papo come√ßou no fluxo de trabalho de implanta√ß√£o.  A conversa sobre o gerenciamento da implanta√ß√£o a partir de bate-papos era bastante popular na √©poca, no entanto, como usamos servidores IRC de terceiros, n√£o pod√≠amos confiar cem vezes no bate-papo no gerenciamento do ambiente de produ√ß√£o e, portanto, o processo permaneceu no n√≠vel de um fluxo unidirecional de informa√ß√µes. <br><br>  √Ä medida que o tr√°fego para o site crescia, tamb√©m aumentava a infraestrutura que o apoiava.  De tempos em tempos, t√≠nhamos que iniciar um novo grupo de servidores de aplicativos e coloc√°-los em opera√ß√£o.  O processo ainda n√£o foi automatizado.  Em particular, a lista de hosts em push ainda precisava ser atualizada manualmente. <br><br>  O poder dos pools geralmente aumentava com a adi√ß√£o de v√°rios servidores por vez.  Como resultado, a execu√ß√£o sucessiva da lista conseguiu rolar as altera√ß√µes para um grupo inteiro de servidores no mesmo pool, sem afetar os outros, ou seja, n√£o houve diversifica√ß√£o pelos pools. <br><br><img src="https://habrastorage.org/web/ccd/063/580/ccd0635803d647b7b0161762c2aa5ff7.png" alt="imagem"><br><br>  O UWSGI foi usado para controlar os processos de trabalho; portanto, quando atribu√≠mos ao aplicativo um comando de reinicializa√ß√£o, ele eliminou todos os processos existentes de uma s√≥ vez, substituindo-os por novos.  Novos processos levaram algum tempo para se preparar para processar solicita√ß√µes.  No caso de uma reinicializa√ß√£o n√£o intencional de um grupo de servidores localizados no mesmo pool, a combina√ß√£o dessas duas circunst√¢ncias afetou seriamente a capacidade desse pool de atender solicita√ß√µes.  Ent√£o, chegamos a um limite na velocidade de implanta√ß√£o segura de c√≥digo em todos os servidores.  √Ä medida que o n√∫mero de servidores aumentou, tamb√©m aumentou a dura√ß√£o de todo o procedimento. <br><br><h3>  Implanta√ß√£o de instrumento de reciclagem (2012) </h3><br>  Redesenhamos completamente a ferramenta de implanta√ß√£o.  E embora seu nome, apesar de uma altera√ß√£o completa, permanecesse o mesmo (push), desta vez foi escrito em Python.  A nova vers√£o teve algumas melhorias importantes. <br><br>  Primeiro, ele pegou a lista de hosts do DNS, e n√£o da sequ√™ncia codificada no c√≥digo.  Isso permitiu que apenas a lista fosse atualizada, sem a necessidade de atualizar o c√≥digo push.  Surgiram os prim√≥rdios de um sistema de descoberta de servi√ßos. <br><br>  Para resolver o problema de reinicializa√ß√µes sucessivas, embaralh√°mos a lista de hosts antes das implanta√ß√µes.  O embaralhamento reduziu os riscos e permitiu acelerar o processo. <br><br><img src="https://habrastorage.org/web/b13/1ec/1ee/b131ec1eec994fa0bc9900bd9d8f7766.PNG" alt="imagem"><br><br>  A vers√£o original embaralhava a lista aleatoriamente a cada vez, no entanto, isso dificultava a revers√£o r√°pida, porque cada vez que a lista do primeiro grupo de servidores era diferente.  Portanto, corrigimos a mistura: agora ela gerava uma certa ordem que poderia ser usada durante a implanta√ß√£o repetida ap√≥s a revers√£o. <br><br>  Outra mudan√ßa pequena, mas importante, foi a implanta√ß√£o constante de alguma vers√£o fixa do c√≥digo.  A vers√£o anterior da ferramenta sempre atualizava a ramifica√ß√£o mestre no host de destino, mas o que acontece se o mestre muda corretamente durante a implanta√ß√£o devido ao fato de algu√©m ter iniciado o c√≥digo por engano?  A implanta√ß√£o de uma determinada revis√£o do git em vez de chamar pelo nome da filial tornou poss√≠vel garantir que a mesma vers√£o do c√≥digo fosse usada em cada servidor de produ√ß√£o. <br><br>  E, finalmente, a nova ferramenta distinguiu seu c√≥digo (trabalhou principalmente com uma lista de hosts e os acessou via SSH) e os comandos executados nos servidores.  Ainda dependia muito das necessidades do R2, mas tinha algo como um prot√≥tipo de API.  Isso permitiu ao r2 seguir suas pr√≥prias etapas de implanta√ß√£o, o que facilitou as mudan√ßas cont√≠nuas e liberou o fluxo.  A seguir, √© apresentado um exemplo de comandos executados em um servidor separado.  O c√≥digo, novamente, n√£o √© o c√≥digo exato, mas no geral essa sequ√™ncia descreve bem o fluxo de trabalho r2: <br><br><pre> <code class="hljs pgsql">sudo /opt/reddit/deploy.py <span class="hljs-keyword"><span class="hljs-keyword">fetch</span></span> reddit sudo /opt/reddit/deploy.py deploy reddit f3bbbd66a6 sudo /opt/reddit/deploy.py <span class="hljs-keyword"><span class="hljs-keyword">fetch</span></span>-names sudo /opt/reddit/deploy.py <span class="hljs-keyword"><span class="hljs-keyword">restart</span></span> <span class="hljs-keyword"><span class="hljs-keyword">all</span></span></code> </pre> <br>  Especialmente digno de nota s√£o os nomes de busca: esta instru√ß√£o √© exclusiva para r2. <br><br><h3>  Escalonamento autom√°tico (2013) </h3><br>  Finalmente, decidimos mudar para uma nuvem com dimensionamento autom√°tico (um t√≥pico para uma postagem separada).  Isso nos permitiu economizar muito dinheiro nos momentos em que o site n√£o estava carregado com tr√°fego e aumentar automaticamente a capacidade de lidar com qualquer aumento acentuado de solicita√ß√µes. <br><br>  Aprimoramentos anteriores, carregando automaticamente a lista de hosts do DNS, tornaram essa transi√ß√£o uma quest√£o natural.  A lista de hosts mudou com mais frequ√™ncia do que antes, mas, do ponto de vista da ferramenta de implanta√ß√£o, isso n√£o teve nenhum papel.  A mudan√ßa, que foi originalmente introduzida como uma melhoria de qualidade, tornou-se um dos principais componentes necess√°rios para executar o dimensionamento autom√°tico. <br><br>  No entanto, o dimensionamento autom√°tico levou a alguns casos fronteiri√ßos interessantes.  Havia uma necessidade de controlar lan√ßamentos.  O que acontece se o servidor iniciar corretamente durante a implanta√ß√£o?  Precis√°vamos garantir que cada novo servidor em execu√ß√£o verificasse a disponibilidade do novo c√≥digo e o aceitasse, se houvesse um.  N√£o poder√≠amos esquecer os servidores que ficaram offline no momento da implanta√ß√£o.  A ferramenta precisava se tornar mais inteligente e aprender a determinar que o servidor ficou offline como parte do procedimento, e n√£o como resultado de um erro que ocorreu durante a implanta√ß√£o.  No √∫ltimo caso, ele teve que avisar em voz alta todos os colegas envolvidos no problema. <br><br>  Ao mesmo tempo, n√≥s, a prop√≥sito, e por v√°rias raz√µes, mudamos de uWSGI para <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Gunicorn</a> .  No entanto, do ponto de vista do t√≥pico deste post, essa transi√ß√£o n√£o levou a altera√ß√µes significativas. <br><br>  Ent√£o funcionou por um tempo. <br><br><h3>  Muitos servidores (2014) </h3><br>  Com o tempo, o n√∫mero de servidores necess√°rios para atender ao pico de tr√°fego aumentou.  Isso levou ao fato de que as implanta√ß√µes exigiam cada vez mais tempo.  No pior cen√°rio, uma implanta√ß√£o normal levou cerca de uma hora - um resultado ruim. <br><br>  Reescrevemos a ferramenta para que ela possa oferecer suporte ao trabalho paralelo com hosts.  A nova vers√£o √© chamada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">rollingpin</a> .  A vers√£o antiga exigia muito tempo para inicializar as conex√µes ssh e aguardar a conclus√£o de todos os comandos; portanto, a paraleliza√ß√£o dentro de limites razo√°veis ‚Äã‚Äãnos permitiu acelerar a implanta√ß√£o.  O tempo de implanta√ß√£o diminuiu novamente para cinco minutos. <br><br><img src="https://habrastorage.org/web/efb/7ba/c3d/efb7bac3df5a4905897b462dea14bf62.PNG" alt="imagem"><br><br>  Para reduzir o impacto da reinicializa√ß√£o simult√¢nea de v√°rios servidores, o componente de mistura da ferramenta se tornou mais inteligente.  Em vez de embaralhar cegamente a lista, ele classificou os pools de servidores para que os hosts de um pool estivessem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">o mais</a> afastados <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">poss√≠vel</a> . <br><br>  A mudan√ßa mais importante na nova ferramenta foi que a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">API entre a ferramenta de implanta√ß√£o e as ferramentas em cada servidor</a> foi definida muito mais claramente e separada das necessidades de r2.  Inicialmente, isso foi feito com o desejo de tornar o c√≥digo mais orientado ao c√≥digo-fonte, mas logo essa abordagem foi muito √∫til de outra maneira.  A seguir, √© apresentado um exemplo de implanta√ß√£o com a sele√ß√£o de comandos da API iniciados remotamente: <br><br><img src="https://habrastorage.org/web/a8b/2d4/750/a8b2d4750f65444998587581f1d1132f.png" alt="imagem"><br><br><h3>  Muitas pessoas (2015) </h3><br>  De repente, chegou um momento em que muitas pessoas j√° estavam trabalhando no R2.  Foi legal e, ao mesmo tempo, significava que haveria ainda mais implanta√ß√µes.  Cumprir a regra de uma implanta√ß√£o por vez tornou-se cada vez mais dif√≠cil.  Os desenvolvedores tiveram que concordar um com o outro sobre o procedimento para emitir o c√≥digo.  Para otimizar a situa√ß√£o, adicionamos outro elemento ao chatbot que coordena a fila de implanta√ß√£o.  Os engenheiros solicitaram uma reserva de implanta√ß√£o e a receberam ou seu c√≥digo "em fila".  Isso ajudou a simplificar as implanta√ß√µes, e quem quisesse conclu√≠-las poderia esperar com calma pela sua vez. <br><br>  Outra adi√ß√£o importante √† medida que a equipe cresceu foi acompanhar as implanta√ß√µes em <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">um s√≥ lugar</a> .  Alteramos a ferramenta de implanta√ß√£o para enviar m√©tricas para o Graphite.  Isso facilitou o rastreamento da correla√ß√£o entre implanta√ß√µes e altera√ß√µes de m√©tricas. <br><br><h3>  Muitos (dois) servi√ßos (tamb√©m 2015) </h3><br>  De repente, chegou o momento do lan√ßamento do segundo servi√ßo on-line.  Era uma vers√£o m√≥vel do site com sua pr√≥pria pilha completamente diferente, seus pr√≥prios servidores e o processo de compila√ß√£o.  Este foi o primeiro teste real de uma API de ferramenta de implanta√ß√£o dividida.  Al√©m disso, a capacidade de executar todas as etapas de montagem em diferentes "locais" para cada projeto permitiu suportar a carga e lidar com a manuten√ß√£o de dois servi√ßos no mesmo sistema. <br><br><h3>  25 servi√ßos (2016) </h3><br>  Durante o pr√≥ximo ano, testemunhamos a r√°pida expans√£o da equipe.  Em vez de dois servi√ßos, duas d√∫zias apareceram, em vez de duas equipes de desenvolvimento, quinze.  A maioria dos servi√ßos foi criada no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Baseplate</a> , em nossa estrutura de back-end ou em aplicativos clientes, semelhantes √† Web m√≥vel.  A infraestrutura por tr√°s das implanta√ß√µes √© a mesma para todos.  Em breve, muitos outros novos servi√ßos ser√£o lan√ßados on-line, e tudo isso se deve em grande parte √† versatilidade do rolo.  Permite simplificar o lan√ßamento de novos servi√ßos usando ferramentas familiares √†s pessoas. <br><br><h3>  Airbag (2017) </h3><br>  √Ä medida que o n√∫mero de servidores no mon√≥lito aumentou, o tempo de implanta√ß√£o aumentou.  Quer√≠amos aumentar significativamente o n√∫mero de implanta√ß√µes paralelas, mas isso causaria muitas reinicializa√ß√µes simult√¢neas dos servidores de aplicativos.  Obviamente, essas coisas levam a uma queda na taxa de transfer√™ncia e √† perda da capacidade de atender √†s solicita√ß√µes recebidas devido √† sobrecarga dos servidores restantes. <br><br>  O processo principal do Gunicorn usou o mesmo modelo do uWSGI, recarregando todos os trabalhadores ao mesmo tempo.  Os novos processos de trabalho n√£o conseguiram atender √†s solicita√ß√µes at√© que estivessem totalmente carregados.  O tempo de lan√ßamento do nosso mon√≥lito variou de 10 a 30 segundos.  Isso significava que, durante esse per√≠odo, n√£o poder√≠amos processar solicita√ß√µes.  Para encontrar uma sa√≠da para essa situa√ß√£o, substitu√≠mos o processo principal do gunicorn pelo gerente de trabalho <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Einhorn</a> do Stripe, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">preservando a pilha HTTP do Gunicorn e o cont√™iner WSGI</a> .  Durante a reinicializa√ß√£o, o Einhorn cria um novo trabalhador, espera at√© que esteja pronto, se livra de um trabalhador antigo e repete o processo at√© que a atualiza√ß√£o seja conclu√≠da.  Isso cria um airbag e nos permite manter a largura de banda em um n√≠vel durante as implanta√ß√µes. <br><br>  O novo modelo criou outro problema.  Como mencionado anteriormente, a substitui√ß√£o de um trabalhador por um novo e totalmente conclu√≠do levou at√© 30 segundos.  Isso significava que, se houvesse um erro no c√≥digo, ele n√£o aparecia imediatamente e conseguia implantar em muitos servidores antes de ser detectado.  Para evitar isso, introduzimos um mecanismo para bloquear a transi√ß√£o do procedimento de implanta√ß√£o para o novo servidor, que estava em vigor at√© que todos os processos de trabalho fossem reiniciados.  Foi implementado simplesmente - pesquisando o estado de einhorn e aguardando a prontid√£o de todos os novos trabalhadores.  Para manter a velocidade no mesmo n√≠vel, expandimos o n√∫mero de servidores sendo processados ‚Äã‚Äãem paralelo, o que era completamente seguro sob as novas condi√ß√µes. <br><br>  Esse mecanismo nos permite implantar simultaneamente em um n√∫mero muito maior de m√°quinas, e o tempo de implanta√ß√£o, cobrindo aproximadamente 800 servidores, √© reduzido para 7 minutos, levando em considera√ß√£o pausas adicionais para verifica√ß√£o de bugs. <br><br><h3>  Olhando para tr√°s </h3><br>  A infraestrutura de implanta√ß√£o descrita aqui √© um produto nascido de muitos anos de melhorias consistentes, em vez de um esfor√ßo √∫nico e focado.  Os ecos das decis√µes tomadas uma vez e alcan√ßados nos est√°gios iniciais dos compromissos ainda se fazem sentir no sistema atual, e esse sempre foi o caso em todos os est√°gios.  Essa abordagem evolutiva tem seus pr√≥s e contras: requer um m√≠nimo de esfor√ßo em qualquer est√°gio; no entanto, h√° um risco, mais cedo ou mais tarde, de parar.  √â importante seguir a dire√ß√£o do seu desenvolvimento para poder envi√°-lo em uma boa dire√ß√£o no prazo. <br><br><h3>  O futuro </h3><br>  A infraestrutura do Reddit deve estar pronta para suporte cont√≠nuo da equipe √† medida que cresce e lan√ßa coisas novas.  A taxa de crescimento da empresa est√° mais r√°pida do que nunca, e estamos trabalhando em projetos ainda mais interessantes e em larga escala do que tudo o que fizemos antes.  Os problemas que enfrentamos hoje s√£o de natureza dupla: por um lado, √© necess√°rio aumentar a autonomia dos desenvolvedores, por outro lado, para manter a seguran√ßa da infraestrutura de produ√ß√£o e melhorar o airbag, o que permite aos desenvolvedores executar implanta√ß√µes com rapidez e confian√ßa. <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/files/4bd/bf6/597/4bdbf659775744b1bdbb4d8a00a0a980.png" alt="imagem"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt404577/">https://habr.com/ru/post/pt404577/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt404567/index.html">Editora Peter. Venda de ver√£o</a></li>
<li><a href="../pt404569/index.html">Part√≠culas, antipart√≠culas e sua aniquila√ß√£o</a></li>
<li><a href="../pt404571/index.html">Redes sociais - uma nova fonte s√©ria de amea√ßas cibern√©ticas</a></li>
<li><a href="../pt404573/index.html">Ganhar o "monstro matem√°tico": n√£o se trata de n√∫meros, mas de aprender a pensar</a></li>
<li><a href="../pt404575/index.html">A IA da Microsoft quebrou o recorde de um homem na Sra. Pac-man</a></li>
<li><a href="../pt404579/index.html">Polybius ICO levantou US $ 20 milh√µes em duas semanas</a></li>
<li><a href="../pt404583/index.html">O Facebook est√° experimentando um bot que pode barganhar e mentir</a></li>
<li><a href="../pt404585/index.html">Enquanto n√≥s, na aldeia de chal√©, fornec√≠amos</a></li>
<li><a href="../pt404587/index.html">Fic√ß√£o e fantasia em dois anos e meio, quase cem bons livros</a></li>
<li><a href="../pt404589/index.html">Mundo dos drones: de dispositivos port√°teis a anti-UAVs</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>