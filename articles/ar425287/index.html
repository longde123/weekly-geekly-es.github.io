<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ช ๐ณ๐ฟ โ๐ฟ ุจููุช FIAS ูู PostgreSQL ๐ฉ๐ปโ๐ซ โฐ ๐จโ๐จโ๐งโ๐ง</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ุงูููุงู ุงูุณุงุจู ุงูุฐู ูุตู ุนูุงููู ููุธุงุฆู FIAS ููุนูู ูุนูู ูู ุจูุฆุฉ PostgreSQL ุฃุซุงุฑ ุงูุงูุชูุงู ุจูู ุฌุฒุก ุตุบูุฑ ูู ุงููุฑุงุก. 

 ูุฐูู ุ ูู ุงูููุทูู ูุตู ุงููุธุงุฆู ุงูููุงุซู...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ุจููุช FIAS ูู PostgreSQL</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/425287/" style=";text-align:right;direction:rtl">  ุงูููุงู ุงูุณุงุจู ุงูุฐู ูุตู ุนูุงููู ููุธุงุฆู FIAS ููุนูู ูุนูู ูู ุจูุฆุฉ PostgreSQL ุฃุซุงุฑ ุงูุงูุชูุงู ุจูู ุฌุฒุก ุตุบูุฑ ูู ุงููุฑุงุก. <br><br>  ูุฐูู ุ ูู ุงูููุทูู ูุตู ุงููุธุงุฆู ุงูููุงุซูุฉ ูู PL / pgSQL ููุนูู ูุน ูุงุฆูุฉ ููุงุฒู FIAS ุงูุชู ุชู ุชุญููููุง ูู ูุงุนุฏุฉ ุจูุงูุงุช ุชุดุบู PostgreSQL. <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/files/94a/cb7/fbc/94acb7fbc32a4cf18fd15e854b62360c.png"></div><br>  ููุฏู ุงููุตู ุงูุฃูู ูู ุงูููุงูุฉ ุชุนูููุงุช ุนูู ุชูููุฐ ุงููุธุงุฆู.  ูู ุงูุซุงููุฉ ุ ุฑููุฒ ูุตุฏุฑ ุงููุธุงุฆู ุ ููุฐูู ุงููุตูุต ูุฅูุดุงุก ุฌุฏูู ุจุณุฌูุงุช ููุฒู FIAS ุ ููุฐูู ุชุญููู ุงูุจูุงูุงุช ูู ูุฐุง ุงูุฌุฏูู ูู ููู ุจุชูุณูู CSV.  ุจุงููุณุจุฉ ูููุฑุงุก ุงูููุชููู ููุท ุจุงููุตูุต ุงููุตุฏุฑ ุ ููุชุฑุญ ุงููุชุงุจุนุฉ ุงูููุฑูุฉ ููููุญู. <br><a name="habracut"></a><br>  ุชุฑุชุจุท ูุฐู ุงูููุงูุฉ ุงุฑุชุจุงุทูุง ูุซูููุง ุจููุงุฏ ุณูุณูุฉ ุงูููุงูุงุช "ุนูุงููู FIAS ูู ุจูุฆุฉ PostgreSQL" ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูุจุฏุงูุฉ</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุงูุงุณุชูุฑุงุฑ 1</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุงูุงุณุชูุฑุงุฑ 2</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุงูููุงูุฉ</a> ). <br><a name="tfHousesAOT_def"></a><h3 style=";text-align:right;direction:rtl">  ุดุฌุฑุฉ ุงูุนุงุฆูุฉ ูู ุงูููุฒู </h3><br><p style=";text-align:right;direction:rtl">  ููุจุฏุฃ ุจูุซุงู. <br></p><p style=";text-align:right;direction:rtl">  <b>ุณูุคุฏู</b> ุงุณุชุฏุนุงุก ุงููุธููุฉ f <b>stf_Houses_AddressObjectTree</b> ('42301ab8-9ead-4f8e-8281-e64f2769a254') ุฅูู ูุงุฆูุฉ ุงูุฅุฏุฎุงูุงุช ุงูุชุงููุฉ. </p><br>  <b>ุงูุฌุฏูู 1. ูุชูุฌุฉ ุงููุธููุฉ.</b> <br><br><img src="https://habrastorage.org/webt/3n/2w/ir/3n2wirseekn4w0oz6kcnzhazl4o.png"><br><br><p style=";text-align:right;direction:rtl">  ุนูุฏ ุงููุญุต ุงูุฏููู ุ ูุฏ ุชูุงุญุธ ุฃู ูุนุฑู ุงูุนูุตุฑ ( <b>HOUSEGUID</b> ) "ุฏ.  1 ุ ุจูุงูุฉ.  2 ุ ุต 26 "ุ ุชู ุงุณุชูุงู ุณุชุฉ ุณุฌูุงุช ูุชูุฌุฉ ูุฐูู: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุซูุงุซุฉ ุณุฌูุงุช ุฑุฆูุณูุฉ ูุน ุนูุงุตุฑ ุชุดูู ุงูุนููุงู: ุญูู ุงูููุทูุฉ ูุงููุฏููุฉ ูุงูุดุงุฑุน ุ </li><li style=";text-align:right;direction:rtl">  ุซูุงุซุฉ ุณุฌูุงุช ููุง ุฎุตุงุฆุต ุฑูู ุงูููุฒู: ุฑูู ุงูููุฒู ูุฑูู ุงููุจูู ูุฑูู ุงููุจูู. </li></ul><br><p style=";text-align:right;direction:rtl">  ุชุญุชูู ุงููุธููุฉ ุนูู ูุนููุฉ ุงุฎุชูุงุฑูุฉ ุฃุฎุฑู - ุชุงุฑูุฎ ุงูุชูุงุก ุตูุงุญูุฉ ุงูุณุฌู ( <b>EndDate</b> ) ุ ุงูุฐู ููููู ูู ุฎูุงูู ุนุฑุถ ูุณุจ ููุณ ููุท ุงูุณุฌู ุงูุญุงูู ุญูู ุงูููุฒู ุ ูููู ุฃูุถูุง ุงูุณุฌูุงุช ุงููุฏููุฉ ุจุงููุนู. <br><br>  ููุฑุฏ ุงููุต ุงููุงูู ููุฏุงูุฉ ูู ุงูููุญู ูู ูุณู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุฅูุดุงุก ุงููุธููุฉ fstf_Houses_AddressObjectTree</a> . </p><br><h4 style=";text-align:right;direction:rtl">  ูู ุงูุจุฏุงูุฉ </h4><br><p style=";text-align:right;direction:rtl">  ุฅุฐุง ููุช ุชุนุฑู ููู ูุชู ุชุฑุชูุจ ุทุงููุฉ ููุฒู FIAS ุ ููููู ุชุฎุทู ูุฐุง ุงููุณู. <br>  ุจููุช FIAS ( <b>HOUSES</b> ) ูู ูุงุฆูุฉ <b>ูุฑุนูุฉ ููุงุฆูุฉ</b> ุนูุงุตุฑ ุชูููุฏ ุงูุนูุงููู ูู FIAS ( <b>ADDROBJ</b> ).  ูุดูุฑ ูู ุฅุฏุฎุงู ูุงุฆูุฉ ููุฒู ุฅูู ุนูุตุฑ ุฅูุดุงุก ุนููุงู FIAS ุจูููุฉ ุญูู <b>AOGUID</b> .  ูู ุฃุฌู ุชุญุฏูุฏ ุงูุดุงุฑุน ูุงูููุงู ุงูุฐู ููุน ููู ุงูููุฒู ุ ุชุญุชุงุฌ ุฅูู ุงูุนุซูุฑ ุนูู ุงูุณุฌู ุงูููุงุจู ูู ููุณ <b>ูุนุฑู</b> ูุงุฆูุฉ <b>ADDROBJ</b> ุจูุงุณุทุฉ ูููุฉ <b>AOGUID</b> ูุณุฌู <b>HOUSES</b> . </p><br><p style=";text-align:right;direction:rtl">  ุนูู ุงูุฑุบู ูู ุงูุจุณุงุทุฉ ุงูุฎุงุฑุฌูุฉ ูุขููุฉ ุงูุชูุงุนู ุจูู ูุงุฆูุฉ ุงูููุงุฒู ููุงุฆูุฉ ุงูุนูุงุตุฑ ุงูููููุฉ ููุนูุงููู ูู ุชูุงุนููุง ุ ุฅูุง ุฃู ุงูููุฒุงุช ุงูุชู ุชุนูุฏ ุชูููุฐ ุงููุธุงุฆู ูู <b>ุงูููุงุฒู</b> . </p><br><p style=";text-align:right;direction:rtl">  ุฃููุงู ุ ูุดูุฑ ูู ุณุฌู ููุงุฆูุฉ ุงูููุงุฒู ุจูุงุณุทุฉ ูุนุฑู <b>AOGUID</b> ุฅูู ูุฌููุนุฉ ูู ุนูุงุตุฑ ุชูููู ุงูุนููุงู ุ ุฃุญุฏูุง ุฐู ุตูุฉ. </p><br><p style=";text-align:right;direction:rtl">  ุซุงูููุง ุ ููุงู ุนุฏุฉ ุฅุฏุฎุงูุงุช ูู ูุงุฆูุฉ FIAS ููุง ููุณ ูุฌููุนุฉ ุฎุตุงุฆุต ุฑูู ุงูููุฒู: ุฑูู ุงูููุฒู ุ ุฑูู ุงููุจูู ุ ุฑูู ุงููุจูู. </p><br><p style=";text-align:right;direction:rtl">  ุซุงูุซูุง ุ ูุง ูุชู ุชุณุฌูู ุณุฌู ุงูููุฒู ุฏุงุฆููุง ูู ุณุฌู ุดุงุฑุน ุงููุฑูุฉ. </p><br>  ูููู ุ ุฃูู ุดูุก ุฃููุงู. <br><p style=";text-align:right;direction:rtl">  ููุฒูุฏ ูู ุงููุธุฑ ูู ุชุฎุฒูู ุงููุนูููุงุช ุญูู ุงูููุงุฒู ูู FIAS ุ ูููู ุฃู ููุชุตุฑ ุนูู 4 ุฌุฏุงูู (ูููุงุช DBF): </p><br><img src="https://habrastorage.org/webt/ba/zn/e3/bazne3xtr_fqhud7hgzdxzjgl-8.png"><br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <b>ADDROBJ</b> - ูุงุฆูุฉ ุนูุงุตุฑ ุชุดููู ุงูุนููุงู ุ </li><li style=";text-align:right;direction:rtl">  ููุงุฒู - ูุงุฆูุฉ ุงูููุงุฒู. </li><li style=";text-align:right;direction:rtl">  <b>STRSTAT</b> - ุฏููู ุงูุณูุงุช ุงููููููุฉ ุ </li><li style=";text-align:right;direction:rtl">  <b>ESTSTAT</b> - ุฏููู ุนูุงูุงุช ุงูููููุฉ. </li></ul><br><p style=";text-align:right;direction:rtl">  ุชูุช ููุงูุดุฉ ADDROBJ ุจุงูุชูุตูู ูู ููุดูุฑ ุณุงุจู ุจุนููุงู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">"ุนูุงููู FIAS ูู PostgreSQL" ุ</a> ูุฐุง ุณุชุชู ููุงูุดุฉ ููุฒุงุชู ููุง ุจูุฏุฑ ูุง ูู ุถุฑูุฑู ููุตู ุฎุตุงุฆุต ุงูููุงุฒู. </p><br>  <b>ุงูุฌุฏูู 2. ุชุงุฑูุฎ ุงูููุฒู "ุฅูููู ูุฑุงุณูููุงุฑุณู ุ ููุทูุฉ ุชูููุฑ ุฏููุฌุงู-ููููุชุณูู ุ ุฏูุฏูููุง ุ ุฃูู.</b>  <b>ุฏูุฏููุณูุงูุง ุ 1</b> <b><br></b> <br><br><img src="https://habrastorage.org/webt/5b/vu/8k/5bvu8k8v5lriarnghwlo7n5lmk8.png"><br><br><p style=";text-align:right;direction:rtl">  ููุง ูุชุจูู ูู ุงูุฌุฏูู ุ ุนูู ุนูุณ ุงููุงุฆูุงุช ุงูุชู ุชุดูู ุงูุนููุงู ุ ูุฅู ุณุฌูุงุช ุชุงุฑูุฎ ุงูููุฒู ููุณ ููุง ุนูุงูุงุช ุฎุงุตุฉ ุนูู ุงูุตูุฉ.  ุงูุณุฌู ุฐู ุชุงุฑูุฎ ุงูุชูุงุก ุงููุชุฑุฉ ุงูุฃูุฏู ุ ูุงูุฐู ูู ุฃูุจุฑ ูู ุงูุชุงุฑูุฎ ุงูุญุงูู ุ ุฐู ุตูุฉ.  ุญุชู ุงูุขู ุ ุชู ุชูููุฒ ุณุฌูุงุช ุงูููุงุฒู ุงูุญุงููุฉ ุจุชุงุฑูุฎ 06.06.2079.  ุชุนุชุจุฑ ุฌููุน ุงูุณุฌูุงุช ุงูุฃุฎุฑู ุญูู ุงูููุฒู ุชุงุฑูุฎูุฉ ุ ูุชููุฒ ุชุงุฑูุฎู ุงูุจุฏุก ูุงูุงูุชูุงุก ูุชุฑุฉ ุตูุฉ ูู ุณุฌู. </p><br><p style=";text-align:right;direction:rtl">  ูุง ุชุญุชูู ูุงุฆูุฉ ููุงุฒู FIAS ุนูู ูุคุดุฑุงุช ููุณุฌูุงุช ุงูุณุงุจูุฉ ูุงูุชุงููุฉ ุญูู ุงูููุฒู.  ูุฐูู ุ ูุชู ุชุญุฏูุฏ ุชุฑุชูุจ ุงูุณุฌูุงุช ูู ุงูุนูู ุงููุนูู ูู ุชุงุฑูุฎ ุงูููุฒู ูู ุฎูุงู ุชุงุฑูุฎ ุงูุงูุชูุงุก ุงููุชูุงูุต ููุง ุจุนุฏู ุชุงุฑูุฎ ุจุฏุก ุงููุชุฑุฉ ุ ุนูู ุงูุชูุงูู <b>EndDate</b> ู <b>StartDate</b> . </p><br><br><pre style=";text-align:right;direction:rtl"><code class="pgsql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> fias_Houses h <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> h.HOUSEGUID=<span class="hljs-string"><span class="hljs-string">'2fd64ecd-4b4b-4fc8-bd15-4a4a2f310b21'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> h.ENDDATE <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span>,h.STARTDATE <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span>;</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงููุงุฑุฆ ุงูููุธ ููุธุฑ ูู ุงูุดูู.  1 ุ ุฑุจูุง ุณุฃูุช ููุณู ุงูุณุคุงู: ููุงุฐุง ูุชู ุฐูุฑ ุงููุชุจ ุงููุฑุฌุนูุฉ ูุนูุงูุงุช ุงููููู ูุงูููููุฉุ  ุชุณุชุฎุฏู FIAS ุฃูุซุฑ ูู 10 ูู ูุฐุง ุงูููุน ูู ุงูุฃุฏูุฉ ุ ูููุงุฐุง ูุชู ุชูููุฒ ูุฐูู ุงูุงุซูููุ </p><br><p style=";text-align:right;direction:rtl">  ุณูู ููุงุฌุฆ ุงูุฌูุงุจ ุงููุซูุฑูู - ูู ูุฌูุฉ ูุธุฑ "ููุทู FIAS" ุ ูู ูุชู ุชุญุฏูุฏ ุนููุงู ุงูููุฒู ุจุงููุงูู ูู ุฎูุงู ุนููุงู ุงูุดุงุฑุน ูุงูููุฒู ูุงููุจูู ูุฃุฑูุงู ุงููุจุงูู.  ุชู ุงุณุชุฎุฏุงู ูุตุทูุญ "ููุทู FIAS" ูู ุฅุฌุงุจุฉ ููุธู ูู ูุตูุญุฉ ุงูุถุฑุงุฆุจ ุงูููุฏุฑุงููุฉ ุนูู ุณุคุงูู ููุงุฐุง ููุฌุฏ ูู ูุงุฆูุฉ ุงูููุงุฒู ูู ุฅูููู ูุฑุงุณูููุงุฑุณู ุฃูุซุฑ ูู 250 ุนููุงู ููุงุฒู ููุชุฑูุฉ.  ูุงูุช ููุณ ุงูุฅุฌุงุจุฉ ุฃู ุชูุฑุฏ ุงูุณุฌู ูุชู ุชูููุฑู ูู ุฎูุงู ููู AOGUID ู HOUSENUM ู BUILDNUM ู STRUCNUM ู STRSTATUS ู ESTSTATUS. </p><br><br><img src="https://habrastorage.org/webt/xi/13/1l/xi131l6giem5x7mcbj4f-vpxfli.png"><br><br><p style=";text-align:right;direction:rtl">  ูุจุนุจุงุฑุฉ ุฃุฎุฑู ุ ููุนุซูุฑ ุนูู ุดูุก ูุง ุ ูุง ูููู ูุนุฑูุฉ ุงูููุทูุฉ ุฃู ุงูุดุงุฑุน ุฃู ุฑูู ุงูููุฒู.  ูุฌุจ ุฃู ุชุนุฑู ุฃูุถูุง: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  "ุงูุญูุงุฒุฉ" ุฃู "ููููุฉ ุงูููุฒู" ุ </li><li style=";text-align:right;direction:rtl">  ุญุงูุฉ ูุฐุง ุงููุงุฆู ูุญุฏุฏุฉ ุฃู ุบูุฑ ูุญุฏุฏุฉ ุ </li><li style=";text-align:right;direction:rtl">  ุงูุฎ. </li></ul><br><img src="https://habrastorage.org/webt/np/9i/6n/np9i6n0cehorqtwgf6fzwyqm4mu.png"><br><br><p style=";text-align:right;direction:rtl">  ูุฐู ูู ุงูุทุฑููุฉ ุงูุชู ุชุจุฏู ุจูุง ุนููุฉ ูู ุงููุงุฆูุฉ ุงูุนุงูุฉ ูููุงุฒู FIAS ุฐุงุช ุงูุนูุงููู ุงูููุฑุฑุฉ. <br>  ุญูููุฉ ุฃู ูุงุฆูุงุช ูุฎุชููุฉ ููุง ููุณ ุงูุนููุงู ููุณุช ููุงุฌุฆุฉ.  ุงููุจูู ูุงูุฃุฑุถ ุงูุชู ุชุญุชู ุ  ููุฒู ุ ูุฑุขุจ ุ ุญูุงู ููุงูู ูุงุญุฏ.  ูููู ูุฏููู ููุณ ุงูุนููุงู.  ููู FIAS ูู ุณุฌู ุงูุนููุงู ุ ุฃู  ูุงุฆูุฉ ุงูุนูุงููู.  ูุฐูู ุ ูู ุงูุทุจูุนู ุฃู ูุชููุน ุฃู ุชููู ุงูุนูุงููู ูุฑูุฏุฉ ูู ููุนูุง ุ ูููุณ ุงููุจุงูู ูุงูููุงูู ูุงูููุงูู. </p><br><p style=";text-align:right;direction:rtl">  ุนูู ุณุจูู ุงููุซุงู  ุจุฏุฃุช ูุงุฆูุฉ ููุงุฒู FIAS ูู ูุงุฆูุฉ ุนูุงููู ุงูููุงุฒู ูู ุงูุชุทูุฑ ูุญู ูุงุฆูุฉ ุงููุจุงูู ุงูุฃุฑุถูุฉ.  ููุณุชุฎุฏูู FIAS ุจุญุงุฌุฉ ุฅูู ุงููุธุฑ ูู ูุฐุง. </p><br><p style=";text-align:right;direction:rtl">  ูููู ููุฌููุน ุงูุชุญูู ูู ูุฌูุฏ ููุงุฒู ุฐุงุช ุนูุงููู ููุฑุฑุฉ ูู ุฎูุงู ุชูููุฐ ุนุจุงุฑุฉ SELECT ูุดุงุจูุฉ ููุง ููู.  ูู ุงูููุช ููุณู ุ ูุง ูููู ุงุณุชุฎุฏุงู ุงููุธููุฉ fsfn_Houses_TreeActualName ุ ูุฃูู  ูุชู ุงุณุชุฎุฏุงูู ููุท ูุชูููู ุนุฏุฏ ุงูุฃุนูุฏุฉ ูู ุงููุชูุฌุฉ.  ููุณ ูู ุงูุถุฑูุฑู ุงุณุชุฎุฏุงู ุฏูููู fias_StructureStatus (ุชูุงุธุฑู ูู STRSTAT) ู fias_EstateStatus (ููุงุซู ูู ESTSTAT) ุ  ูููู ุฃูุถูุง ุชุชุจุน ุงูุฃุซุฑ ุงูููุญูุธ ุนูู ุฑููุฒ ุนูุงูุงุช ุงูุจูุงุก ูุงูุญูุงุฒุฉ. </p><br><img src="https://habrastorage.org/webt/ch/d_/gr/chd_grqqzvzh7u_z058i-qxjkmk.png"><br><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ููุฏ ูุตุฏุฑ ุงููุดุบู</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> fsfn_Houses_TreeActualName(h.AOGUID,h.HOUSEGUID),h.HOUSEGUID,str.StructureStatusName,est.EstateStatusName <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> fias_Houses h <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> AOGUID,HOUSENUM,BUILDNUM,STRUCNUM,COUNT(*) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> fias_Houses h <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> EndDate =TO_TIMESTAMP(<span class="hljs-string"><span class="hljs-string">'2079-06-06 00:00:00'</span></span>,<span class="hljs-string"><span class="hljs-string">'YYYY-MM-DD HH24:MI:SS'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> AOGUID,HOUSENUM,BUILDNUM,STRUCNUM <span class="hljs-keyword"><span class="hljs-keyword">HAVING</span></span> COUNT(*)&gt;<span class="hljs-number"><span class="hljs-number">1</span></span>) hg <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> h.AOGUID=hg.AOGUID <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> h.HOUSENUM=hg.HOUSENUM <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> COALESCE(h.BUILDNUM,<span class="hljs-string"><span class="hljs-string">''</span></span>)=COALESCE(hg.BUILDNUM,<span class="hljs-string"><span class="hljs-string">''</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> COALESCE(h.STRUCNUM,<span class="hljs-string"><span class="hljs-string">''</span></span>)=COALESCE(hg.STRUCNUM,<span class="hljs-string"><span class="hljs-string">''</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">LEFT OUTER JOIN</span></span> fias_StructureStatus str <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> h.STRSTATUS=str.StructureStatusID <span class="hljs-keyword"><span class="hljs-keyword">LEFT OUTER JOIN</span></span> fias_EstateStatus est <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> h.ESTSTATUS=est.EstateStatusID <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> h.EndDate =TO_TIMESTAMP(<span class="hljs-string"><span class="hljs-string">'2079-06-06 00:00:00'</span></span>,<span class="hljs-string"><span class="hljs-string">'YYYY-MM-DD HH24:MI:SS'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> h.AOGUID,h.HOUSENUM,h.BUILDNUM,h.STRUCNUM,h.STRSTATUS,h.ESTSTATUS;</code> </pre><br></div></div><br><p style=";text-align:right;direction:rtl">  ูุฃุฎูุฑูุง ุ ููุงู ููุฒุฉ ุฃุฎุฑู ููุงุฆูุฉ ููุฒู FIAS.  ูุญุชูู ูู ุณุฌู ููุฒู ููุฐู ุงููุงุฆูุฉ ุนูู ุงุฑุชุจุงุท ุจุนูุตุฑ ุชูููู ุงูุนููุงู ุ ููุงุฆูุชู ูู ุชุณูุณู ูุฑูู ููุฐู ุงูุนูุงุตุฑ.  ูู ูู ูุณุชูู ูู ูุณุชููุงุช ุงูุชุณูุณู ุงููุฑูู ุชูุฌุฏ ุนูุงุตุฑ ุชุดูู ุงูุนููุงู ุชูุชูู ุฅูู ุฃููุงุน ูุฎุชููุฉ.  ูุฐุง ูุฅู ุงูุนูุตุฑ ุงูุฌุฐุฑู ูู ุงูููุทูุฉ (ุฅูููู ูุฑุงุณูููุงุฑุณู ูู ุญุงูุชูุง) ุ ูู ุงููุณุชูู ุงูุชุงูู ูู ููุทูุฉ ุฃููุฑูุฌ ูุณุชููุฉ ุฃู ููุทูุฉ ุฃู ูุฏููุฉ ุชุงุจุนุฉ ุฅูููููุฉ.  ูููุฐุง ุฏูุงููู.  (ููุญุตูู ุนูู ุงูุชูุงุตูู ุ ุฑุงุฌุน "ุนูุงููู FIAS ูู PostgreSQL"). </p><br><p style=";text-align:right;direction:rtl">  ุฑุณูููุง ุ ูุณูุญ ูู ุงูุณุฌู ุงูููุฒูู ุจุงูุฑุฌูุน ุฅูู ุนูุตุฑ ุงูุชุณูุณู ุงููุฑูู ุนูู ุฃู ูุณุชูู.  ูุญุณู ุงูุญุธ ุ ูู ุชูู ููุงู ููุงุฒู ุชุดูุฑ ุฅูู ููุทูุฉ ุฃู ููุทูุฉ ุจูู ุจูุงูุงุช ุฅูููู ูุฑุงุณูููุงุฑุณู.  ููุน ุฐูู ุ ูุง ุชุดูุฑ ุฌููุน ุงูููุงุฒู ุฅูู ุดุงุฑุน ุงููุฑูุฉ: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  98 ูช ูู ููุงุฒู FIAS ูุฑุชุจุทุฉ ุจุงูุดูุงุฑุน ูู ุงูููุงุทู ุงููุฃูููุฉ ุจุงูุณูุงู ุ </li><li style=";text-align:right;direction:rtl">  1.2 ูช ูู ุงูููุงุฒู - ูุน ุงูุดูุงุฑุน ูู ุฌูุนูุงุช ุงูุจุณุชูุฉ ุ </li><li style=";text-align:right;direction:rtl">  0.3ูช ูู ุงูููุงุฒู ูุน ุงููุณุชูุทูุงุช. </li><li style=";text-align:right;direction:rtl">  0.5ูช ูู ุงูููุงุฒู ูุน ุนูุงุตุฑ ุฃุฎุฑู ูููู ุงูุชุนุงูู ูุนูุง. </li></ul><br><img src="https://habrastorage.org/webt/mh/xq/3u/mhxq3ukmrzmjlboytqt2q4fsxno.png"><br>  <b>ุงูุชูู.</b>  <b>2.</b> <br><br><h4 style=";text-align:right;direction:rtl">  ูุดุฑ ุนูุงููู ุงูููุงุฒู ูู ูุจู ุงููุงูููู (FIAS ููุงุจู ุงูุฎุฑูุทุฉ) </h4><br><p style=";text-align:right;direction:rtl">  ูุชู ูุตู ูุดููุฉ ููุง ุชุคุฏู ุฅูู ุชูุณูุฑ ุบุงูุถ ูุดุฌุฑุฉ ุงูุนุงุฆูุฉ.  (ููุช ุงูุชุจุงูู ุฅูู ูุฐู ุงููุดููุฉ ุฅูุฌูุฑ ูููููุฏูููุชุด ุชูููุดููููู ุ ุงุฎุชุตุงุตู ูุธู ุงููุนูููุงุช ุงูุฌุบุฑุงููุฉ ุ Aigeo LLC ุ ูุฑุงุณูููุงุฑุณู). </p><br><p style=";text-align:right;direction:rtl">  ููุถุญ ูุง ุณุจู ููู ุชุญุชูู ุงูุนุฏูุฏ ูู ุงูุณุฌูุงุช ุนูู ููุณ ุงูุนููุงู ูู ุงูููุฒู.  ูุง ูููู ุชูุณูุฑู ุจุฑุบุจุฉ ููุชุดูุฉ ุงูุถุฑุงุฆุจ ูู ุงูุงุญุชูุงุธ ููุณ ููุท ุจุณุฌู ูููุฒู ุฎุงุต ุ ูููู ุฃูุถูุง ูููุจุงูู ุงููุญูุทุฉ: ูุฑุขุจ ุ ุญุธูุฑุฉ ุ ุฅูุฎ.  ูููู ููุงู ุฃูุซูุฉ ุนูุณูุฉ ุนูุฏูุง ุชุชุทุงุจู ุงูุนุฏูุฏ ูู ุงููุจุงูู (fias_Houses) ูุน ูุจูู ูุงุญุฏ (ููุฒู) ุจุฃุฑูุงู ูุฎุชููุฉ ููุฐุง ุงูููุฒู. </p><br><br><img src="https://habrastorage.org/webt/5-/u6/cs/5-u6csqwbyl14t6fwhnix-r3nue.png"><br><br><p style=";text-align:right;direction:rtl">  ุงูู ูุธุฑุฉ ุนูู ูุฐู ุงูุตูุฑุฉ  ุนูู ุงููุณุงุฑ ุชูุฌุฏ ููุทุฉ ููุดุงุดุฉ ูุน ุฎุฑูุทุฉ ูููุฑูุฉ ุญูุซ ุชูุฌุฏ ููุงุฒู ูุงูููู.  ูุฐู ููุงุฒู ุนุงุฏูุฉ ูู ุทุงุจู ูุงุญุฏ ูุน ูุฏุฎููู.  ุชุนูุด ุนุงุฆูุฉ ูุงุญุฏุฉ ุนูู ุงููููู ูุฃุฎุฑู ุนูู ุงููุณุงุฑ.  ูุง ูุฒุงู ูู ุงููููู ุชุฎูููุง ูููุงุฒู ูู ุดูุชูู. </p><br><p style=";text-align:right;direction:rtl">  ุงูุขู ุงูุธุฑ ุฅูู ุงูุทุงููุฉ ุนูู ุงููููู.  ูู ุฐูู ุ ูุชุทุงุจู ูู ููุฒู ุชูุฑูุจูุง ูุน ูุงูููู ูุน 3 ุฅุฏุฎุงูุงุช.  ุนูู ุณุจูู ุงููุซุงู  ููุถุญ ุฌุฏูู ุจููุช FIAS ููุง ูู ุนููุงู ุงูููุฒู ุงููุฑุฏู ("ุฏ. 1") ูุนูุงููู ุฃุฌุฒุงุก ุงูููุฒู ("ุฏ. 1/1" ุ "ุฏ. 1/2") ุงูุฎุงุตุฉ ุจูุงูู ูุงุญุฏ. </p><br><h4 style=";text-align:right;direction:rtl">  ููู ูุนูู </h4><br><p style=";text-align:right;direction:rtl">  <b>ุชุญุชูู</b> ุงููุธููุฉ <b>fstf_Houses_AddressObjectTree</b> ุนูู ูุณุฎุชูู: ูุน ุฃุฑุจุนุฉ ุฃู ูุน ูุนููุชูู.  ูู ุฅุตุฏุงุฑ ุงููุธููุฉ ูุน ูุนููุชูู ุ ูุชู ุฅุฑุณุงู ูุนุฑู ุงูููุฒู ( <b>HouseGUID</b> ) ูุชุงุฑูุฎ ุงูุชูุงุก ุตูุงุญูุฉ ุงูุณุฌู <b>(EndDate</b> ).  ูุชุทูุจ ุงูุฅุตุฏุงุฑ ุงูุฐู ูุญุชูู ุนูู ุฃุฑุจุน ูุนููุงุช ุฃูุถูุง ูุนุฑููุง ูุนูุตุฑ ุฅูุดุงุก ุงูุนููุงู ( <b>AOGUID</b> ) ูุงูุญุงูุฉ ุงูุญุงููุฉ ( <b>CurrStatus</b> ). </p><br><img src="https://habrastorage.org/webt/f9/9k/mv/f99kmvqqmijnjjs14z0vmakvrmq.png"><br><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ููุฏ ูุตุฏุฑ ุงููุดุบู</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> v_AOGUID,v_CurrStatus h.AOGUID,<span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> &lt; <span class="hljs-keyword"><span class="hljs-keyword">ALL</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> iao.currstatus <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> fias_AddressObjects iao <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> ao.aoguid = iao.aoguid) <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> MAX(iao.currstatus) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> fias_AddressObjects iao <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> ao.aoguid = iao.aoguid) <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> fias_Houses h <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> fias_AddressObjects ao <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> h.AOGUID=ao.AOGUID <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> h.HOUSEGUID=a_HOUSEGUID <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> h.ENDDATE= COALESCE(a_ENDDATE, TO_TIMESTAMP(<span class="hljs-string"><span class="hljs-string">'2079-06-06 00:00:00'</span></span>,<span class="hljs-string"><span class="hljs-string">'YYYY-MM-DD HH24:MI:SS'</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> h.ENDDATE <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span>;</code> </pre><br></div></div><br><p style=";text-align:right;direction:rtl">  ุชุญุณุจ ุฏุงูุฉ ุฐุงุช ูุนููุงุช ุฃูู ููู ุงููุนููุงุช ุงูููููุฏุฉ ูุชุณุชุฏุนู ุฏุงูุฉ ุฐุงุช ุนุฏุฏ ูุจูุฑ ูู ุงููุนููุงุช.  ููููุงู ุจุฐูู ุ ูุชู ุงุณุชุฎุฑุงุฌ ูุนุฑู ุนูุตุฑ ุชูููู ุงูุนููุงู ุจุจุณุงุทุฉ ูู ุงูุญูู ุงูููุงุจู ูุฌุฏูู ุงูููุฒู (f <b>ias_Houses</b> ).  ูุชุญุณุจ ูููุฉ ุงููุถุน ุงูุญุงูู ( <b>CurrStatus</b> ) ูููุง ููููุงุนุฏ ุงูุชุงููุฉ: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุฅุฐุง ูู ููู ุฃู ูู ุณุฌูุงุช ุงููุญููุธุงุช ูุนูุตุฑ ุชูููู ุงูุนููุงู ูุญุชูู ุนูู 0 ูู ุญูู CurrStatus ุ ููุชู ุชุนููู ูุชุบูุฑ v_CurrStatus ููููุฉ ุงูุญูู ุงููุตูู ูุนูุตุฑ ุชูููู ุงูุนููุงู ูุฐุง ุ </li><li style=";text-align:right;direction:rtl">  ูุฅูุง ุ ูุชู ุชุนููู ุงููููุฉ 0 ูุฐุง ุงููุชุบูุฑ. </li></ul><br><p style=";text-align:right;direction:rtl">  ุชููู ุฏุงูุฉ ุฐุงุช ุนุฏุฏ ูุจูุฑ ูู ุงููุนููุงุช ุฃููุงู ุจุงุณุชุฏุนุงุก ุงููุธููุฉ <b>fstf_AddressObjects_AddressObjectTree</b> ุ ูุงูุชู ุชููู ุจุฅุฑุฌุงุน ุนูุงุตุฑ ุชูููู ุงูุนููุงู ุงูุฃุตู ููููุฒู.  ููููู ูุฑุงุกุฉ ุงููุฒูุฏ ุญูู ูุธููุฉ fstf_AddressObjects_AddressObjectTree ูู ูุณู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงููุณุจ ูุนูุตุฑ ุชูููู ุงูุนููุงู ูู ูุณุชูุฏ FIAS ุงูุนูุงููู ูู PostgreSQL</a> </p>  . <br><p style=";text-align:right;direction:rtl">  ุซู ูุชู ุงุณุชููุงู ุงูุฅุฏุฎุงูุงุช ุญูู ุนูุงุตุฑ ุชูููู ุงูุนููุงู ุจุฅุฏุฎุงูุงุช ุญูู ุฃุฑูุงู ุงูููุฒู ูุงููุจูู ูุงููููู (ุงูุธุฑ ุงูุฌุฏูู 1) ุ ูุงูุชู ูุชู ุฅูุดุงุคูุง ููู ุญูู ุบูุฑ ูุงุฑุบ ุญูู ุนุฏุฏ ุงูููุฒู ูุงููุจูู ูุงููููู. </p><br><p style=";text-align:right;direction:rtl">  ูู ุฃุฌู ุฃู ูููู ูุฌููุน ุณุฌูุงุช ุงููุฎุฑุฌุงุช ููุณ ุงูุจููุฉ ูููุณ ุจุฏูู ุฌุฒุก ูู ุงูุงูุจูุงุฑ ุ ูุชู ุฅูุดุงุก ููู ูุณุชูู ุฑูุฒ ุงูุญููู ( <b>AOLevel</b> ) ูุงูุญุงูุฉ ุงูุญุงููุฉ ( <b>CurrStatus</b> ) ูุญุงูุฉ ุงูููุงุกูุฉ ( <b>ActStatus</b> ) ุจุดูู ูุตุทูุน ูู ูุต ุงููุธููุฉ. </p><br><p style=";text-align:right;direction:rtl">  ูุชู ุฏุงุฆููุง ุชุนููู ุฑูุฒ ูุณุชูู ุงูููุฒู (ุงููุจูู ูุงููููู) ุฅูู 8 ุ ุฑุงุฌุน ุงููุชุงุจ ุงููุฑุฌุนู "ูุณุชููุงุช ุงููุงุฆูุงุช ุงููุงุจูุฉ ููุนูููุฉ" ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุนูููุงุช ูุนูููุงุช FIAS ุญูู ุชูููู ุงููุนูููุงุช</a> ). </p><br><p style=";text-align:right;direction:rtl">  ูุชู ุชุนููู ุญุงูุฉ ุงูุตูุฉ ุฅูู <b>1</b> ุฅุฐุง ูุงู ุชุงุฑูุฎ ุงูุชูุงุก ุตูุงุญูุฉ ุงูุณุฌู ( <b>EndDate</b> ) ูู <b>06.06.2079</b> ู 0 ุฎูุงู ุฐูู. </p><br><p style=";text-align:right;direction:rtl">  <b>ุชููู ููู</b> ุญูู <b>CurrStatus</b> ุฃูุซุฑ ุชุนููุฏูุง.  ุจุงุณุชุฎุฏุงู ููููุง ุ ูุชู ุญู ูููุชูู ูู ููุช ูุงุญุฏ: ูุชู ุชุนููู ูุนุฑู ูู ุฅุตุฏุงุฑ ูู ุงูุณุฌู ุญูู ุนูุตุฑ ุชูููู ุงูุนููุงู ููุชู ุชุนููู ุนูุงูุฉ ุตูุฉ ุงูุณุฌู.  ูุฐูู ุ ูุญุชูู ุขุฎุฑ ุณุฌู ุญุงูู ุญูู ุนูุตุฑ ุนูู ูููุฉ <b>0</b> ูู ูุฐุง ุงูุญูู ุ ููุชู ุชุฑููู ุฌููุน ุงูุณุฌูุงุช ุงูุชุงุฑูุฎูุฉ ุจุชุฑุชูุจ ุงููุธูุฑ - "1" ูู ุฃูู ุณุฌู ุ ูููู ูู ุงูููุช - "2" ุ ุฅูุฎ.  ูุชู ูุตู ุชุฑุชูุจ ุชุนููู ุงูููู ูุญูู CurrStatus ุจูุฒูุฏ ูู ุงูุชูุงุตูู ูู ุงูููุดูุฑ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">FIAS Addresses ูู PostgreSQL</a> . </p><br><img src="https://habrastorage.org/webt/8t/13/og/8t13ogvul4asrek6okocveb8frq.png"><br><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุนููุงู ุงูููุณุฏ</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> h.AOGUID, h.HOUSEGUID, h.HOUSENUM, h.BUILDNUM, h.STRUCNUM, h.ENDDATE, <span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> COALESCE(h.ENDDATE, TO_TIMESTAMP(<span class="hljs-string"><span class="hljs-string">'2079-06-06 00:00:00'</span></span>,<span class="hljs-string"><span class="hljs-string">'YYYY-MM-DD HH24:MI:SS'</span></span>)) =TO_TIMESTAMP(<span class="hljs-string"><span class="hljs-string">'2079-06-06 00:00:00'</span></span>,<span class="hljs-string"><span class="hljs-string">'YYYY-MM-DD HH24:MI:SS'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> RANK() <span class="hljs-keyword"><span class="hljs-keyword">OVER</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">PARTITION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> h.AOGUID, h.HOUSEGUID <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> h.ENDDATE <span class="hljs-keyword"><span class="hljs-keyword">ASC</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> HouseCurrStatus, <span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> COALESCE (h.ENDDATE, TO_TIMESTAMP(<span class="hljs-string"><span class="hljs-string">'2079-06-06 00:00:00'</span></span>,<span class="hljs-string"><span class="hljs-string">'YYYY-MM-DD HH24:MI:SS'</span></span>)) =TO_TIMESTAMP(<span class="hljs-string"><span class="hljs-string">'2079-06-06 00:00:00'</span></span>,<span class="hljs-string"><span class="hljs-string">'YYYY-MM-DD HH24:MI:SS'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> HouseActStatus <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> fias_Houses h <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> fias_AddressObjects ao <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> h.AOGUID=ao.AOGUID <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> h.AOGUID=a_AOGUID <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> h.HOUSEGUID=a_HOUSEGUID <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> h.ENDDATE= COALESCE(a_ENDDATE, TO_TIMESTAMP(<span class="hljs-string"><span class="hljs-string">'2079-06-06 00:00:00'</span></span>,<span class="hljs-string"><span class="hljs-string">'YYYY-MM-DD HH24:MI:SS'</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> h.ENDDATE <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span>;</code> </pre><br></div></div><br><h3 style=";text-align:right;direction:rtl">  ุนููุงู ุงูููุฒู ุจุงููุงูู </h3><br><p style=";text-align:right;direction:rtl">  ุชุชูุซู ุงูููุฑุฉ ุงูุฑุฆูุณูุฉ ููุฏุงูุฉ <b>fsfn_Houses_TreeActualName</b> ูู ุฅุฑุฌุงุน ุฑูู ุงูููุฒู ุงููุชุตู ูู ุณุทุฑ ูุงุญุฏ ุฅูู ุฌุงูุจ ุฃุณูุงุก ุฌููุน ุฃุณูุงูู - ุนูุงุตุฑ ุชูููู ุงูุนููุงู. </p><br><p style=";text-align:right;direction:rtl">  ุนูู ุณุจูู ุงููุซุงู ุ ุฏุน ุฏุงูุฉ ุดุฌุฑุฉ ุงูุนุงุฆูุฉ (fstf_Houses_AddressObjectTree) ุชูุฑุฌุน ูุงุฆูุฉ ุงูููู ุงูุชุงููุฉ. </p><br>  <b>ุงูุฌุฏูู 4. ูุชูุฌุฉ ุงููุธููุฉ fstf_Houses_AddressObjectTree ('0c0d670f-097c-4e1d-bcac-9e9b22fb1b99')</b> <br><br><img src="https://habrastorage.org/webt/5s/iu/ks/5siuksa7hfbicjmqsdt-fiqu1z0.png"><br><br><p style=";text-align:right;direction:rtl">  ุซู ูุฌุจ ุฃู <b>ููุฑุฌุน fsfn_Houses_TreeActualName</b> ('0c0d670f-097c-4e1d-bcac-9e9b22fb1b99'): " <b>ุงูุณูุฏ ูุฑุงุณูููุงุฑุณู ุ 34 ุฃ ุณุงูุช ูุงุฒู ุ ุจูุฏ.</b>  <b>6 ุ ุต .17</b> ". </p><br><p style=";text-align:right;direction:rtl">  ูููู ุชุจุณูุท ุงููุธููุฉ <b>fsfn_Houses_TreeActualName</b> ููุธููุฉ ูุฌูุนุฉ <b>STRING_AGG</b> ููู ูุชูุฌุฉ ุฏุงูุฉ ุชููู ุจุฅุฑุฌุงุน ุดุฌุฑุฉ ุนุงุฆูุฉ ูู ุงูููุฒู. </p><br><p style=";text-align:right;direction:rtl">  ุชุญุชูู ุงููุธููุฉ ุงููุนููุฉ ุนูู ูุนููุฉ ุงุฎุชูุงุฑูุฉ ุฃุฎุฑู - ูุฌููุนุฉ ูู ุงูุฃููุนุฉ ( <b>a_MaskArray</b> ) ุ ูุงูุชู ููููู ุชุถููููุง ูู ุงููุชูุฌุฉ ููุณ ูู ุฃุณูุงุก ุงูุนูุงุตุฑ ุ ูููู ููุท ุชูู ุงููุทููุจุฉ. </p><br>  <b>ุงูุฌุฏูู 5. ูุงุฆูุฉ ุฃููุนุฉ ุงููุธุงุฆู.</b> <br><br><img src="https://habrastorage.org/webt/6e/dl/q5/6edlq5zop1sqnwemc1s2zmbmgme.png"><br><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ูุณุฎุฉ ูุตูุฉ ูู ุงูุฌุฏูู</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><table style=";text-align:right;direction:rtl"><tbody><tr><th>  ุงููููุฉ </th><th>  ููุงุญุธุฉ </th></tr><tr><td>  {HS} </td><td>  ุงูููุงุน - ุฑูู ุงูููุฒู </td></tr><tr><td>  {BY} </td><td>  ุงูููุงุน - ุฑูู ุงูุญุงูุฉ </td></tr><tr><td>  {BG} </td><td>  ุงูููุงุน - ุฑูู ุงููุจูู </td></tr><tr><td>  {ST} </td><td>  ููุงุน - ุดุงุฑุน </td></tr><tr><td>  {ZC} </td><td>  ุงูููุงุน - ุงูุฑูุฒ ุงูุจุฑูุฏู </td></tr><tr><td>  {DT} </td><td>  ููุงุน - ููุทูุฉ ุญุถุฑูุฉ </td></tr><tr><td>  {LP} </td><td>  ููุงุน - ูุฏููุฉ ุชุงุจุนุฉ </td></tr><tr><td>  {LM} </td><td>  ููุงุน - ุงููุณุชูุทูุฉ ุงูุฑุฆูุณูุฉ </td></tr><tr><td>  {TP} </td><td>  ููุงุน - ููุทูุฉ ููุถูุน ุงูุงุชุญุงุฏ </td></tr><tr><td>  {TM} </td><td>  ููุงุน - ููุถูุน ุงูุงุชุญุงุฏ (ุงูููุทูุฉ) </td></tr><tr><td>  {CY} </td><td>  ููุงุน - ุงูุจูุฏ </td></tr></tbody></table><br></div></div><br>  ุงูุธุฑ ุฃูุถูุง ูุณู " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูุงุณู ุงููุงูู ูุนูุตุฑ ุชูููู ุงูุนููุงู" ูู ุงูููุดูุฑ "ุนูุงููู FIAS ูู PostgreSQL</a> ". <br>  ููุฑุฏ ูุต ุงููุธููุฉ ูู ูุณู ุงูุชุทุจูู " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุฅูุดุงุก ูุธููุฉ fsfn_Houses_TreeActualName</a> ". <br><br><h3 style=";text-align:right;direction:rtl">  ุจุญุซ ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ FIAS </h3><br><p style=";text-align:right;direction:rtl">  ุฅู ุงููุธููุฉ <b>fstf_Houses_SearchByName</b> ูุฎุตุตุฉ ููุจุญุซ ูู ุนูุงููู ููุงุฒู FIAS ุญุณุจ ุฃุฑูุงููุง ูุฃุณูุงุก ุนูุงุตุฑ ุชูููู ุงูุนููุงู.  ุนูุงูุฉ ุนูู ุฐูู ุ ูููู ุฅุฌุฑุงุก ุงูุจุญุซ ููุณ ููุท ุจุงุณู ุงูุนูุตุฑ ุงูุญุงูู ูููุนู ุ ูููู ุฃูุถูุง ุจุฃุณูุงุก ูุฃููุงุน ูุงุญุฏ ุฃู ุงุซููู ูู ุฃูุฑุจ ุฃุณูุงูู. </p><br><p style=";text-align:right;direction:rtl">  ุฏุนููุง ูููู ูุธุฑุฉ ุนูู ุจุนุถ ุงูุฃูุซูุฉ.  ุจุงุฏุฆ ุฐู ุจุฏุก ุ ุณูุฌุฏ ุฌููุน ุงูููุงุฒู ุจุฑูู "220". </p><br>  <b>ุงูุฌุฏูู 6. ูุชูุฌุฉ ุงููุธููุฉ fstf_Houses_SearchByName ('220')</b> <br><br><img src="https://habrastorage.org/webt/lk/82/od/lk82odn1sragk7w8oudjxihuqye.png"><br><br><p style=";text-align:right;direction:rtl">  ุนูู ุนูุณ ูุธููุฉ ุงูุจุญุซ ุนู ุนูุงุตุฑ ุชูููู ุงูุนููุงู ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">fstf_AddressObjects_SearchByName</a> ) ุ ูุฅู ูุชูุฌุฉ ูุฐู ุงููุธููุฉ ูุง ุชุญุชูู ุนูู ุชุฃุซูุฑ "ุงูุณุจุงุญุฉ" ูู ุฎูุงู ูุณุชููุงุช ุนูุงุตุฑ ุชูููู ุงูุนููุงู.  ุชุญุชูู ุงููุนููุฉ ุงูุฃููู ููุฏุงูุฉ ุฏุงุฆููุง ุนูู ููุท ุงูุจุญุซ ูุฑูู ุงูููุฒู ุ ูุงูุซุงููุฉ - ุฑูู ุงููุจูู ุ ูุฑูู ุงููุจูู ุงูุซุงูุซ. </p><br><p style=";text-align:right;direction:rtl">  ุงูุขู ูู ุจุชุบููุฑ ุงูุทูุจ.  ูุฌุฏ ุฌููุน ููุงุฒู ุนูุงุตุฑ ุชูููู ุงูุนููุงู ุ ุงูุชู ูุญุชูู ุนุฏุฏูุง ุนูู ุงูุฑูู "1" ุ ูุชุธูุฑ ูููุฉ "Krasnoyarsk" ูู ุงูุฃุณูุงุก. </p><br>  <b>ุงูุฌุฏูู 7. ูุชูุฌุฉ ุงููุธููุฉ fstf_Houses_SearchByName ('1'ุ NULLุ NULLุ 'Krasnoyarsk')</b> <br><br><img src="https://habrastorage.org/webt/bi/jm/as/bijmasrtluarib2trzq_f4m-jf8.png"><br><br><p style=";text-align:right;direction:rtl">  ูุชุฒุงูู ุงูุบุฑุถ ูู ุงููุนููุงุช ุงููุชุจููุฉ ุชูุงููุง ูุน ุงูุบุฑุถ ูู ูุนููุงุช ูุธููุฉ ุงูุจุญุซ ูุนูุงุตุฑ ุชูููุฏ ุงูุนููุงู (fstf_AddressObjects_SearchByName). <br>  ูุต ุงููุธููุฉ ููุฌูุฏ ูู ูุณู ุงูุชุทุจูู " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุฅูุดุงุก ูุธููุฉ fstf_Houses_SearchByName</a> " </p>  . <br><h4 style=";text-align:right;direction:rtl">  ููู ูุนูู </h4><br><p style=";text-align:right;direction:rtl">  <b>ูุดุจู</b> ุชูููุฐ <b>fstf_Houses_SearchByName</b> ูู ููุงุญ ุนุฏูุฏุฉ ุชูููุฐ ูุธููุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูุจุญุซ ูุนูุงุตุฑ ุชูููุฏ ุงูุนููุงู (fstf_AddressObjects_SearchByName)</a> .  ูุงููุฑู ุงูุฑุฆูุณู ูู ุฃู ุงูุจุญุซ ูุชู ูู ุฌุฏูููู <b>ูุฑุชุจุทูู</b> ุ <b>fias_Houses</b> ู <b>fias_AddressObjects</b> . </p><br><p style=";text-align:right;direction:rtl">  ุชุญุชูู ุงูุฏุงูุฉ ุนูู 9 ูุณูุทุงุช.  ุฃูู ุซูุงุซุฉ ูููู ูู ุฃุฑูุงู ุงูููุงุฒู ( <b>a_HouseNum</b> ) ูุงููุจูู <b>(a_BuildNum</b> ) ูุงููุจูู ( <b>a_StrucNum</b> ).  <b>ูุชุทุงุจู ุชูุงููุง</b> ุงูู 6 ุงููุชุจููุฉ ( <b>a_FormalName</b> ุ <b>a_ShortName</b> ุ <b>a_ParentFormalName</b> ุ <b>a_ParentShortName</b> ุ <b>a_GrandParentFormalName</b> ุ <b>a_GrandParentShortName</b> ) ุชูุงููุง ูุน ูุนููุงุช ุงูุฏุงูุฉ. <br><br>  ุฅุฐุง ููุช ุจุชุนููู ูููุฉ ูุนููุฉ "ุฑูู ุงูููุฒู" ููุท ุ ูุณุชูุฑุฌุน ุงูุฏุงูุฉ ุฌููุน ุงูุนูุงููู ูู ุฑูู ุงูููุฒู ุงูุชู ููุชูู ุจูุง ุงูุชุณูุณู ุงููุญุฏุฏ ุจุฑูุฒ.  ุฅุฐุง ููุช ุจุชูุฑูุฑ NULL ุฃู ุณูุณูุฉ ูุงุฑุบุฉ ("") ูุฑูู ุงูููุฒู ุ ูุณูุชู ุฅุฑุฌุงุน ุนูุงููู ุฌููุน ุงูููุงุฒู ุงูุชู ุชู ุชุญุฏูุฏ ุนูุงุตุฑ ุนููุงููุง ุจูุงุณุทุฉ ูุฌููุนุฉ ูู ุงููุนููุงุช ุงูุฃุฎุฑู. <br><br><img src="https://habrastorage.org/webt/bo/sh/ht/boshhtjrbef92owia3wp2j2_6sm.png"><br><br></p><h3 style=";text-align:right;direction:rtl">  ุงูุฎุงุชูุฉ </h3><br><p style=";text-align:right;direction:rtl">  ูุญุชูู ูุฐุง ุงููุณู ุนูู ุชูุตูุงุช ุญูู ููููุฉ ุชุญููู ูุงุฆูุฉ ููุงุฒู FIAS ูู ุฌุฏูู <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">fias_Houses</a></b> . </p><br><p style=";text-align:right;direction:rtl">  ูุชู ุชุญููู ุงูุจูุงูุงุช ูู ุฌุฏูู ุงูููุงุฒู ุจููุณ ุงูุทุฑููุฉ ุงูุชู ูุชู ุจูุง <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุชุญููู ุงูุจูุงูุงุช ูู ุฌุฏูู ุนูุงุตุฑ ุชูููู ุงูุนููุงู</a> .  ุณูููู ุงูููู ุงููุตุฏุฑ ููุท <b>HOUSE99.DBF</b> ูููุณ <b>ADDROB99.DBF</b> .  ููุง <b>99</b> ูู ุฑูู ุงูููุทูุฉ (ุฌูููุฑูุฉ ุ ุฅูููู ุ ุฅูููู).  ุนูู ุณุจูู ุงููุซุงู ุ ุจุงููุณุจุฉ ุฅูู ุฅูููู ูุฑุงุณูููุงุฑุณู ุ ูููู ุงูููู ุงููุตุฏุฑ ูู ููู <b>HOUSE24.DBF</b> . </p><br><p style=";text-align:right;direction:rtl">  ุฃููุงู ุ ูุชู ุชูุฒูู ุงูุฃุฑุดูู ุงูุชุงูู ูุน ุงูุชุญุฏูุซ ูู ุตูุญุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุชุญุฏูุซุงุช</a> FIAS.  ูุชู ุงุณุชุฎุฑุงุฌ ููู <b>HOUSE99.DBF</b> ููู <b>.</b> </p><p style=";text-align:right;direction:rtl">  . <br></p><p style=";text-align:right;direction:rtl">  ุซู <b>ูุชู</b> ุชุญููู ููู <b>HOUSE99.DBF</b> ุฅูู ุชูุณูู <b>CSV</b> ูุชุญูููู ุจุงููุนู ุ ูุชู ุชุญูููู ุจูุงุณุทุฉ ุนุจุงุฑุฉ COPY ูู ุงูุฌุฏูู ุงููุคูุช <b>fias_Houses_Temp</b> . </p><br><p style=";text-align:right;direction:rtl">  ูุฃุฎูุฑูุง ุ ูุชู ุงุณุชุฎุฏุงู ุงูุจูุงูุงุช ุงููุคูุชุฉ ูุชุญุฏูุซ ุงูุฌุฏูู ุงูุฑุฆูุณู ุ ุฃู  ุชุชู ุฅุถุงูุฉ ุบูุฑ ููุฌูุฏุฉ ูู fias_House ุ ููุชู ุงุณุชุจุฏุงู ุงูููุงุฒู ุงูููุฌูุฏุฉ. <br>  ููุฑุฏ ูุซุงู ุนูู ุจุฑูุงูุฌ ูุตู ูุชุญุฏูุซ ุฌุฏูู ุงูููุงุฒู ูู ูุณู " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุชูุฒูู ุชุญุฏูุซุงุช ููุฒู FIAS ุฅูู fias_Houses Table</a> ". </p><br><h3 style=";text-align:right;direction:rtl">  ุงูุชุทุจูู </h3><br><a name="tfHousesAOT"></a><h3 style=";text-align:right;direction:rtl">  ุฅูุดุงุก ุฏุงูุฉ fstf_Houses_AddressObjectTree </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูููู ุงูุนุซูุฑ ุนูู ุงูุชุนูููุงุช ุนูู ุฑูุฒ ูุตุฏุฑ ุงููุธููุฉ ููุง</a> . <br><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุฑูุฒ ุงููุธููุฉ</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs"><span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TRANSACTION</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> fstf_Houses_AddressObjectTree(a_AOGUID <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">36</span></span>), a_HOUSEGUID <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">36</span></span>),a_CurrStatus <span class="hljs-type"><span class="hljs-type">INTEGER</span></span>,a_ENDDATE <span class="hljs-type"><span class="hljs-type">TIMESTAMP</span></span>); <span class="hljs-comment"><span class="hljs-comment">/******************************************************************/</span></span> <span class="hljs-comment"><span class="hljs-comment">/*   (  )   */</span></span> <span class="hljs-comment"><span class="hljs-comment">/*      */</span></span> <span class="hljs-comment"><span class="hljs-comment">/******************************************************************/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OR REPLACE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> fstf_Houses_AddressObjectTree( a_AOGUID <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">36</span></span>), <span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> <span class="hljs-comment"><span class="hljs-comment">/*  */</span></span> a_HOUSEGUID <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">36</span></span>),<span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> a_CurrStatus <span class="hljs-type"><span class="hljs-type">INTEGER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-comment"><span class="hljs-comment">/*    4: */</span></span> <span class="hljs-comment"><span class="hljs-comment">/* 0 - , */</span></span> <span class="hljs-comment"><span class="hljs-comment">/* 1-50 - , ..  */</span></span> <span class="hljs-comment"><span class="hljs-comment">/*  , */</span></span> <span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> <span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> <span class="hljs-comment"><span class="hljs-comment">/*  , */</span></span> <span class="hljs-comment"><span class="hljs-comment">/* 51 -  */</span></span> a_ENDDATE <span class="hljs-type"><span class="hljs-type">TIMESTAMP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-string"><span class="hljs-string">'2079-06-06'</span></span> <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">RETURNS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> (rtf_GUID <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">36</span></span>), rtf_CurrStatus <span class="hljs-type"><span class="hljs-type">INTEGER</span></span>,rtf_ActStatus <span class="hljs-type"><span class="hljs-type">INTEGER</span></span>, rtf_AOLevel <span class="hljs-type"><span class="hljs-type">INTEGER</span></span>,rtf_ShortTypeName <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>),rtf_AddressObjectName <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">100</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> $BODY$ <span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> c_HouseAOLevel <span class="hljs-keyword"><span class="hljs-keyword">CONSTANT</span></span> <span class="hljs-type"><span class="hljs-type">INTEGER</span></span>:=<span class="hljs-number"><span class="hljs-number">8</span></span>; c_HouseShortTypeName <span class="hljs-keyword"><span class="hljs-keyword">CONSTANT</span></span> <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>):=<span class="hljs-string"><span class="hljs-string">'.'</span></span>; c_BuildShortTypeName <span class="hljs-keyword"><span class="hljs-keyword">CONSTANT</span></span> <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>):=<span class="hljs-string"><span class="hljs-string">'.'</span></span>; c_StructShortTypeName <span class="hljs-keyword"><span class="hljs-keyword">CONSTANT</span></span> <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>):=<span class="hljs-string"><span class="hljs-string">'.'</span></span>; c_StatusActual <span class="hljs-keyword"><span class="hljs-keyword">CONSTANT</span></span> <span class="hljs-type"><span class="hljs-type">INTEGER</span></span>:=<span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> c_StatusNotActual <span class="hljs-keyword"><span class="hljs-keyword">CONSTANT</span></span> <span class="hljs-type"><span class="hljs-type">INTEGER</span></span>:=<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> c_MAXENDDATE <span class="hljs-keyword"><span class="hljs-keyword">CONSTANT</span></span> <span class="hljs-type"><span class="hljs-type">TIMESTAMP</span></span>:=to_timestamp(<span class="hljs-string"><span class="hljs-string">'2079-06-06 00:00:00'</span></span>, <span class="hljs-string"><span class="hljs-string">'YYYY-MM-DD'</span></span>); v_HouseActStatus <span class="hljs-type"><span class="hljs-type">INTEGER</span></span>; <span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> v_HouseCurrStatus <span class="hljs-type"><span class="hljs-type">INTEGER</span></span>; <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> v_ENDDATE <span class="hljs-type"><span class="hljs-type">TIMESTAMP</span></span>; <span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> v_HOUSEGUID <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">36</span></span>); <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> v_HOUSENUM <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>); <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> v_BUILDNUM <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>); <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> v_STRUCNUM <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>); <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> v_Return_Error <span class="hljs-type"><span class="hljs-type">Integer</span></span> :=<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> <span class="hljs-comment"><span class="hljs-comment">--************************************************************ --************************************************************ BEGIN RETURN QUERY SELECT * FROM fstf_AddressObjects_AddressObjectTree (a_AOGUID,a_CurrStatus); IF a_ENDDATE IS NULL THEN SELECT INTO v_ENDDATE MAX(ENDDATE) FROM fias_Houses WHERE AOGUID=a_AOGUID AND HOUSEGUID=a_HOUSEGUID; ELSE v_ENDDATE:=a_ENDDATE; END IF; SELECT INTO v_HOUSENUM,v_BUILDNUM,v_STRUCNUM, v_ENDDATE,v_HouseCurrStatus h.HOUSENUM,h.BUILDNUM,h.STRUCNUM, h.ENDDATE,ah.HouseCurrStatus FROM fias_Houses h INNER JOIN (SELECT AOGUID,HOUSEGUID,ENDDATE, RANK() OVER (PARTITION BY AOGUID, HOUSEGUID ORDER BY ENDDATE ASC) AS HouseCurrStatus FROM fias_Houses insh WHERE insh.AOGUID=a_AOGUID AND insh.HOUSEGUID=a_HOUSEGUID) as ah ON h.AOGUID=ah.AOGUID AND h.HOUSEGUID=ah.HOUSEGUID AND h.ENDDATE=ah.ENDDATE WHERE h.ENDDATE=v_ENDDATE; v_HouseActStatus:=CASE WHEN COALESCE(v_ENDDATE,c_MAXENDDATE)= c_MAXENDDATE THEN c_StatusActual ELSE c_StatusNotActual END; v_HouseCurrStatus:=CASE WHEN COALESCE(v_ENDDATE,c_MAXENDDATE)= c_MAXENDDATE THEN 0 ELSE v_HouseCurrStatus END; IF v_HOUSENUM IS NOT NULL THEN RETURN QUERY SELECT a_HOUSEGUID,v_HouseCurrStatus,v_HouseActStatus, c_HouseAOLevel,c_HouseShortTypeName,v_HOUSENUM; END IF; IF v_BUILDNUM IS NOT NULL THEN RETURN QUERY SELECT a_HOUSEGUID,v_HouseCurrStatus,v_HouseActStatus, c_HouseAOLevel,c_BuildShortTypeName,v_BUILDNUM; END IF; IF v_STRUCNUM IS NOT NULL THEN RETURN QUERY SELECT a_HOUSEGUID,v_HouseCurrStatus,v_HouseActStatus, c_HouseAOLevel,c_StructShortTypeName,v_STRUCNUM; END IF; END; $BODY$ LANGUAGE plpgsql; COMMENT ON FUNCTION fstf_Houses_AddressObjectTree(a_AOGUID VARCHAR(36), a_HOUSEGUID VARCHAR(36),a_CurrStatus INTEGER,a_ENDDATE TIMESTAMP) IS '  (  )       '; --ROLLBACK TRANSACTION; COMMIT TRANSACTION; BEGIN TRANSACTION; DROP FUNCTION IF EXISTS fstf_Houses_AddressObjectTree(a_HOUSEGUID VARCHAR(36),a_ENDDATE TIMESTAMP); /******************************************************************/ /*   (  )   */ /*      */ /******************************************************************/ CREATE OR REPLACE FUNCTION fstf_Houses_AddressObjectTree( a_HOUSEGUID VARCHAR(36),/*     */ a_ENDDATE TIMESTAMP default '2079-06-06'/*     */ ) RETURNS TABLE (rtf_GUID VARCHAR(36), rtf_CurrStatus INTEGER,rtf_ActStatus INTEGER, rtf_AOLevel INTEGER,rtf_ShortTypeName VARCHAR(10),rtf_AddressObjectName VARCHAR(100)) AS $BODY$ DECLARE c_MaxEndDate CONSTANT TIMESTAMP:=TO_TIMESTAMP('2079-06-06','YYYY-MM-DD'); c_ActualStatusCode CONSTANT INTEGER :=1; /*      */ c_NotActualStatusCode CONSTANT INTEGER :=0; /*     */ v_AOGUID VARCHAR(36); /*   */ /*   */ v_CurrStatus INTEGER; /*    4: */ /* 0 - , */ /* 1-50 - , */ /* ..   , */ /*     */ /*     , */ /* 51 - */ v_Return_Error Integer :=0; /*   */ --******************************************************************* --******************************************************************* BEGIN SELECT INTO v_AOGUID,v_CurrStatus h.AOGUID, CASE WHEN 0 &lt; ALL(SELECT iao.currstatus FROM fias_AddressObjects iao WHERE ao.aoguid = iao.aoguid) THEN (SELECT MAX(iao.currstatus) FROM fias_AddressObjects iao WHERE ao.aoguid = iao.aoguid) ELSE 0 END FROM fias_Houses h INNER JOIN fias_AddressObjects ao ON h.AOGUID=ao.AOGUID WHERE h.HOUSEGUID=a_HOUSEGUID AND h.ENDDATE=COALESCE(a_ENDDATE,c_MaxEndDate) ORDER BY h.ENDDATE DESC; RETURN QUERY SELECT * FROM fstf_Houses_AddressObjectTree( v_AOGUID,a_HOUSEGUID, v_CurrStatus,a_ENDDATE); END; $BODY$ LANGUAGE plpgsql; COMMENT ON FUNCTION fstf_Houses_AddressObjectTree(a_HOUSEGUID VARCHAR(36),a_ENDDATE TIMESTAMP) IS '  (  )       '; --ROLLBACK TRANSACTION; COMMIT TRANSACTION; SELECT * FROM fstf_Houses_AddressObjectTree('8b40b028-68eb-4315-a256-ea300c604688','42301ab8-9ead-4f8e-8281-e64f2769a254') ORDER BY rtf_AOLevel; SELECT * FROM fstf_Houses_AddressObjectTree('42301ab8-9ead-4f8e-8281-e64f2769a254') ORDER BY rtf_AOLevel;</span></span></code> </pre><br></div></div><br><a name="fnHousesTAN"></a><br><h3 style=";text-align:right;direction:rtl">  ุฅูุดุงุก ูุธููุฉ fsfn_Houses_TreeActualName </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูููู ุงูุนุซูุฑ ุนูู ุงูุชุนูููุงุช ุนูู ุฑูุฒ ูุตุฏุฑ ุงููุธููุฉ ููุง</a> . <br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุฑูุฒ ุงููุธููุฉ</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs"><span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TRANSACTION</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> fsfn_Houses_TreeActualName(a_AOGUID <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">36</span></span>),a_HOUSEGUID <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">36</span></span>),a_MaskArray <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">2</span></span>)[<span class="hljs-number"><span class="hljs-number">10</span></span>]) <span class="hljs-keyword"><span class="hljs-keyword">CASCADE</span></span>; <span class="hljs-comment"><span class="hljs-comment">/*****************************************************************/</span></span> <span class="hljs-comment"><span class="hljs-comment">/*           */</span></span> <span class="hljs-comment"><span class="hljs-comment">/*****************************************************************/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OR REPLACE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> fsfn_Houses_TreeActualName( a_AOGUID <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">36</span></span>), <span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> a_HOUSEGUID <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">36</span></span>), <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> a_MaskArray <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">2</span></span>)[<span class="hljs-number"><span class="hljs-number">10</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-string"><span class="hljs-string">'{TP,LM,LP,ST,HS,BY,BG}'</span></span> <span class="hljs-comment"><span class="hljs-comment">/*  ,   */</span></span> <span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">RETURNS</span></span> <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">1000</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> $BODY$ <span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> c_HouseMaskArray <span class="hljs-keyword"><span class="hljs-keyword">CONSTANT</span></span> <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">2</span></span>)[<span class="hljs-number"><span class="hljs-number">3</span></span>]:=<span class="hljs-string"><span class="hljs-string">'{HS,BY,BG}'</span></span>; <span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> c_HouseNoMask <span class="hljs-keyword"><span class="hljs-keyword">CONSTANT</span></span> <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">2</span></span>)[<span class="hljs-number"><span class="hljs-number">1</span></span>] :=<span class="hljs-string"><span class="hljs-string">'{HS}'</span></span>; c_BodyNoMask <span class="hljs-keyword"><span class="hljs-keyword">CONSTANT</span></span> <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">2</span></span>)[<span class="hljs-number"><span class="hljs-number">1</span></span>] :=<span class="hljs-string"><span class="hljs-string">'{BY}'</span></span>;<span class="hljs-comment"><span class="hljs-comment">/*  */</span></span> c_BuildingNoMask <span class="hljs-keyword"><span class="hljs-keyword">CONSTANT</span></span> <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">2</span></span>)[<span class="hljs-number"><span class="hljs-number">1</span></span>] :=<span class="hljs-string"><span class="hljs-string">'{BG}'</span></span>;<span class="hljs-comment"><span class="hljs-comment">/*  */</span></span> c_HouseShortTypeName <span class="hljs-keyword"><span class="hljs-keyword">CONSTANT</span></span> <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>):=<span class="hljs-string"><span class="hljs-string">'.'</span></span>; c_BuildShortTypeName <span class="hljs-keyword"><span class="hljs-keyword">CONSTANT</span></span> <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>):=<span class="hljs-string"><span class="hljs-string">'.'</span></span>; c_StructShortTypeName <span class="hljs-keyword"><span class="hljs-keyword">CONSTANT</span></span> <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>):=<span class="hljs-string"><span class="hljs-string">'.'</span></span>; v_ENDDATE <span class="hljs-type"><span class="hljs-type">TIMESTAMP</span></span>; <span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> v_HOUSENUM <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>); <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> v_BUILDNUM <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>); <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> v_STRUCNUM <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>); <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> v_TreeAddressObjectName <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">1000</span></span>); <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> v_Return_Error <span class="hljs-type"><span class="hljs-type">Integer</span></span> :=<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> <span class="hljs-comment"><span class="hljs-comment">--******************************************************* --******************************************************* BEGIN v_TreeAddressObjectName:=fsfn_AddressObjects_TreeActualName (a_AOGUID,a_MaskArray); SELECT INTO v_ENDDATE MAX(ENDDATE) FROM fias_Houses WHERE AOGUID=a_AOGUID AND HOUSEGUID=a_HOUSEGUID; SELECT INTO v_HOUSENUM,v_BUILDNUM,v_STRUCNUM HOUSENUM, BUILDNUM,STRUCNUM FROM fias_Houses WHERE AOGUID=a_AOGUID AND HOUSEGUID=a_HOUSEGUID AND ENDDATE=v_ENDDATE; IF c_HouseNoMask &lt;@ a_MaskArray AND COALESCE(TRIM(v_HOUSENUM),'')&lt;&gt;'' THEN v_TreeAddressObjectName:=v_TreeAddressObjectName|| CASE WHEN v_TreeAddressObjectName='' THEN '' ELSE ', ' ||c_HouseShortTypeName||' '||v_HOUSENUM END; END IF; IF c_BodyNoMask &lt;@ a_MaskArray AND COALESCE(TRIM(v_BUILDNUM),'')&lt;&gt;'' THEN v_TreeAddressObjectName:=v_TreeAddressObjectName|| CASE WHEN v_TreeAddressObjectName='' THEN '' ELSE ', ' || c_BuildShortTypeName||' '||v_BUILDNUM END; END IF; IF c_BuildingNoMask &lt;@ a_MaskArray AND COALESCE(TRIM(v_STRUCNUM),'')&lt;&gt;'' THEN v_TreeAddressObjectName:=v_TreeAddressObjectName|| CASE WHEN v_TreeAddressObjectName='' THEN '' ELSE ', ' || c_StructShortTypeName||' '||v_STRUCNUM END; END IF; RETURN v_TreeAddressObjectName; END; $BODY$ LANGUAGE plpgsql ; COMMENT ON FUNCTION fsfn_Houses_TreeActualName(a_AOGUID VARCHAR(36),a_HOUSEGUID VARCHAR(36),a_MaskArray VARCHAR(2)[10]) IS '         '; --ROLLBACK TRANSACTION; COMMIT TRANSACTION; BEGIN TRANSACTION; DROP FUNCTION IF EXISTS fsfn_Houses_TreeActualName(a_HOUSEGUID VARCHAR(36),a_MaskArray VARCHAR(2)[10]) CASCADE; /*****************************************************************/ /*           */ /*****************************************************************/ CREATE OR REPLACE FUNCTION fsfn_Houses_TreeActualName( a_HOUSEGUID VARCHAR(36), /*     */ a_MaskArray VARCHAR(2)[10] default '{TP,LM,LP,ST,HS,BY,BG}' /*  ,   */ /*    */ ) RETURNS VARCHAR(1000) AS $BODY$ DECLARE c_MaxEndDate CONSTANT TIMESTAMP:=TO_TIMESTAMP('2079-06-06','YYYY-MM-DD'); v_AOGUID VARCHAR(36); /*    */ v_TreeAddressObjectName VARCHAR(1000); /*     */ v_Return_Error Integer :=0; /*   */ --********************************************************** --********************************************************** BEGIN SELECT INTO v_AOGUID h.AOGUID FROM fias_Houses h INNER JOIN fias_AddressObjects ao ON h.AOGUID=ao.AOGUID WHERE h.HOUSEGUID=a_HOUSEGUID AND h.ENDDATE=c_MaxEndDate ORDER BY h.ENDDATE DESC; v_TreeAddressObjectName:=fsfn_Houses_TreeActualName (v_AOGUID,a_HOUSEGUID,a_MaskArray); RETURN v_TreeAddressObjectName; END; $BODY$ LANGUAGE plpgsql ; COMMENT ON FUNCTION fsfn_Houses_TreeActualName(a_HOUSEGUID VARCHAR(36),a_MaskArray VARCHAR(2)[10]) IS '         '; --ROLLBACK TRANSACTION; COMMIT TRANSACTION; SELECT fsfn_Houses_TreeActualName('8b40b028-68eb-4315-a256-ea300c604688','42301ab8-9ead-4f8e-8281-e64f2769a254'); SELECT fsfn_Houses_TreeActualName('42301ab8-9ead-4f8e-8281-e64f2769a254');</span></span></code> </pre><br></div></div><br><a name="tfHousesSBN"></a><br><h3 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุฅูุดุงุก ุฏุงูุฉ fstf_Houses_SearchByName </font></font></h3><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูููู ุงูุนุซูุฑ ุนูู ุงูุชุนูููุงุช ุนูู ุฑูุฒ ูุตุฏุฑ ุงููุธููุฉ ููุง</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><div class="spoiler" style=";text-align:right;direction:rtl"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฑูุฒ ุงููุธููุฉ</font></font></b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs"><span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TRANSACTION</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> fstf_Houses_SearchByName(a_HouseNum <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">20</span></span>),a_BuildNum <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>),a_StrucNum <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>),a_FormalName <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">150</span></span>),a_ShortName <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">20</span></span>),a_ParentFormalName <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">150</span></span>),a_ParentShortName <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">20</span></span>), a_GrandParentFormalName <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">150</span></span>),a_GrandParentShortName <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">20</span></span>)); <span class="hljs-comment"><span class="hljs-comment">/*****************************************************/</span></span> <span class="hljs-comment"><span class="hljs-comment">/*       */</span></span> <span class="hljs-comment"><span class="hljs-comment">/*        */</span></span> <span class="hljs-comment"><span class="hljs-comment">/*****************************************************/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OR REPLACE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> fstf_Houses_SearchByName( a_HouseNum <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">20</span></span>), <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> a_BuildNum <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>,<span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> a_StrucNum <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>, <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> a_FormalName <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">150</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>, <span class="hljs-comment"><span class="hljs-comment">/*  */</span></span> <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> a_ShortName <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">20</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>, <span class="hljs-comment"><span class="hljs-comment">/*  */</span></span> <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> a_ParentFormalName <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">150</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>, <span class="hljs-comment"><span class="hljs-comment">/*  */</span></span> <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> a_ParentShortName <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">20</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>, <span class="hljs-comment"><span class="hljs-comment">/*  */</span></span> <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> a_GrandParentFormalName <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">150</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>, <span class="hljs-comment"><span class="hljs-comment">/*  */</span></span> <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> a_GrandParentShortName <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">20</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span> <span class="hljs-comment"><span class="hljs-comment">/*  */</span></span> <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">RETURNS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> (rtf_AOGUID <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">36</span></span>),rtf_HOUSEGUID <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">36</span></span>),rtf_AOLevel <span class="hljs-type"><span class="hljs-type">INTEGER</span></span>,rtf_HousesFullName <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">1000</span></span>),rtf_HouseNum <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">20</span></span>),rtf_BuildNum <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>),rtf_StrucNum <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>),rtf_EndDate <span class="hljs-type"><span class="hljs-type">TIMESTAMP</span></span>,rtf_ShortName <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">20</span></span>),rtf_FormalName <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">150</span></span>), rtf_CurrStatus <span class="hljs-type"><span class="hljs-type">INTEGER</span></span>,rtf_ActStatus <span class="hljs-type"><span class="hljs-type">INTEGER</span></span>, rtf_ParentShortName <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">20</span></span>),rtf_ParentFormalName <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">150</span></span>),rtf_GrandParentShortName <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">20</span></span>),rtf_GrandParentFormalName <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">150</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> $BODY$ <span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> c_WildChar <span class="hljs-keyword"><span class="hljs-keyword">CONSTANT</span></span> <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">2</span></span>)=<span class="hljs-string"><span class="hljs-string">'%'</span></span>; c_BlankChar <span class="hljs-keyword"><span class="hljs-keyword">CONSTANT</span></span> <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">2</span></span>)=<span class="hljs-string"><span class="hljs-string">' '</span></span>; v_HouseNumTemplate <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">150</span></span>); <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> v_BuildNumTemplate <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">150</span></span>); <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> v_StrucNumTemplate <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">150</span></span>); <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> v_FormalNameTemplate <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">150</span></span>); <span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> v_ShortNameTemplate <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">20</span></span>); <span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> <span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> v_ParentFormalNameTemplate <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">150</span></span>); <span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> <span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> v_ParentShortNameTemplate <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">20</span></span>); <span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> v_GrandParentFormalNameTemplate <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">150</span></span>); <span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> <span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> v_GrandParentShortNameTemplate <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">20</span></span>); <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> <span class="hljs-comment"><span class="hljs-comment">--*************************************************************** --*************************************************************** BEGIN v_ShortNameTemplate:=UPPER(COALESCE(c_WildChar ||REPLACE(TRIM(a_ShortName),c_BlankChar,c_WildChar) ||c_WildChar,c_WildChar)); v_FormalNameTemplate:=UPPER(COALESCE(c_WildChar ||REPLACE(TRIM(a_FormalName),c_BlankChar,c_WildChar) ||c_WildChar,c_WildChar)); v_HouseNumTemplate:= CASE WHEN TRIM(COALESCE(a_HouseNum,''))='' THEN '' ELSE LOWER(c_WildChar ||REPLACE(TRIM(a_HouseNum),c_BlankChar,c_WildChar)) END ||CASE WHEN TRIM(COALESCE(a_BuildNum,''))='' THEN '' ELSE LOWER(c_WildChar ||REPLACE(TRIM(a_BuildNum),c_BlankChar,c_WildChar)) END || CASE WHEN TRIM(COALESCE(a_StrucNum,''))='' THEN '' ELSE LOWER(c_WildChar ||REPLACE(TRIM(a_StrucNum),c_BlankChar,c_WildChar)) END; v_HouseNumTemplate:=v_HouseNumTemplate||c_WildChar; v_HouseNumTemplate:=CASE WHEN TRIM(COALESCE(a_HouseNum,''))='' THEN '' ELSE LOWER(c_WildChar ||REPLACE(TRIM(a_HouseNum),c_BlankChar,c_WildChar)) END ||c_WildChar; v_BuildNumTemplate:=CASE WHEN TRIM(COALESCE(a_BuildNum,''))='' THEN '' ELSE LOWER(c_WildChar ||REPLACE(TRIM(a_BuildNum),c_BlankChar,c_WildChar)) END ||c_WildChar; v_StrucNumTemplate:=CASE WHEN TRIM(COALESCE(a_StrucNum,''))='' THEN '' ELSE LOWER(c_WildChar ||REPLACE(TRIM(a_StrucNum),c_BlankChar,c_WildChar)) END||c_WildChar; IF a_FormalName IS NOT NULL AND a_ParentFormalName IS NULL AND a_ParentShortName IS NULL AND a_GrandParentFormalName IS NULL AND a_GrandParentShortName IS NULL THEN IF a_HouseNum IS NOT NULL OR a_BuildNum IS NOT NULL OR a_StrucNum IS NOT NULL THEN RETURN QUERY SELECT cfa.AOGUID,h.HouseGUID,cfa.AOLevel, fsfn_Houses_TreeActualName(h.AOGUID,h.HouseGUID), h.HouseNum,h.BuildNum,h.StrucNum, h.EndDate,cfa.ShortName,cfa.FORMALNAME, cfa.currstatus,cfa.Actstatus, NULL::VARCHAR,NULL::VARCHAR,NULL::VARCHAR,NULL::VARCHAR FROM fias_AddressObjects cfa INNER JOIN fias_Houses h ON cfa.aoguid = h.aoguid WHERE cfa.currstatus= CASE WHEN 0 &lt; ALL(SELECT iao.currstatus FROM fias_AddressObjects iao WHERE cfa.aoguid = iao.aoguid) THEN (SELECT MAX(iao.currstatus) FROM fias_AddressObjects iao WHERE cfa.aoguid = iao.aoguid) ELSE 0 END AND h.EndDate=(SELECT MAX(ih.EndDate) FROM fias_Houses ih WHERE cfa.aoguid = ih.aoguid AND h.HouseGUID = ih.HouseGUID) AND UPPER(cfa.FORMALNAME) LIKE v_FormalNameTemplate AND UPPER(cfa.ShortName) LIKE v_ShortNameTemplate AND TRIM(LOWER(COALESCE(h.HouseNum,''))) LIKE v_HouseNumTemplate AND TRIM(LOWER(COALESCE(h.BuildNum,''))) LIKE v_BuildNumTemplate AND TRIM(LOWER(COALESCE(h.StrucNum,''))) LIKE v_StrucNumTemplate ORDER BY cfa.AOLevel,cfa.ShortName,cfa.FORMALNAME, TO_NUMBER(SUBSTRING(h.HouseNum,E'\\d+'),'9999'),h.HouseNum, TO_NUMBER(SUBSTRING(h.BuildNum,E'\\d+'),'9999'),h.BuildNum, TO_NUMBER(SUBSTRING(h.StrucNum,E'\\d+'),'9999'),h.StrucNum; ELSE RETURN QUERY SELECT cfa.AOGUID,h.HouseGUID,cfa.AOLevel, fsfn_Houses_TreeActualName(h.AOGUID,h.HouseGUID), h.HouseNum,h.BuildNum,h.StrucNum,h.EndDate, cfa.ShortName,cfa.FORMALNAME,cfa.currstatus,cfa.Actstatus, NULL::VARCHAR,NULL::VARCHAR,NULL::VARCHAR,NULL::VARCHAR FROM fias_AddressObjects cfa INNER JOIN fias_Houses h ON cfa.aoguid = h.aoguid WHERE cfa.currstatus= CASE WHEN 0 &lt; ALL(SELECT iao.currstatus FROM fias_AddressObjects iao WHERE cfa.aoguid = iao.aoguid) THEN (SELECT MAX(iao.currstatus) FROM fias_AddressObjects iao WHERE cfa.aoguid = iao.aoguid) ELSE 0 END AND h.EndDate=(SELECT MAX(ih.EndDate) FROM fias_Houses ih WHERE cfa.aoguid = ih.aoguid AND h.HouseGUID = ih.HouseGUID) AND UPPER(cfa.FORMALNAME) LIKE v_FormalNameTemplate AND UPPER(cfa.ShortName) LIKE v_ShortNameTemplate ORDER BY cfa.AOLevel,cfa.ShortName,cfa.FORMALNAME, TO_NUMBER(SUBSTRING(h.HouseNum,E'\\d+'),'9999'),h.HouseNum, TO_NUMBER(SUBSTRING(h.BuildNum,E'\\d+'),'9999'),h.BuildNum, TO_NUMBER(SUBSTRING(h.StrucNum,E'\\d+'),'9999'),h.StrucNum; END IF; ELSIF a_FormalName IS NOT NULL AND a_ParentFormalName IS NOT NULL AND a_GrandParentFormalName IS NULL AND a_GrandParentShortName IS NULL THEN v_ParentShortNameTemplate:=UPPER(COALESCE(c_WildChar ||REPLACE(TRIM(a_ParentShortName),c_BlankChar,c_WildChar) ||c_WildChar,c_WildChar)); v_ParentFormalNameTemplate:=UPPER(c_WildChar ||REPLACE(TRIM(a_ParentFormalName),c_BlankChar,c_WildChar) ||c_WildChar); v_FormalNameTemplate:=COALESCE(v_FormalNameTemplate,c_WildChar); IF a_HouseNum IS NOT NULL OR a_BuildNum IS NOT NULL OR a_StrucNum IS NOT NULL THEN RETURN QUERY SELECT cfa.AOGUID,h.HouseGUID,cfa.AOLevel, fsfn_Houses_TreeActualName(h.AOGUID,h.HouseGUID), h.HouseNum,h.BuildNum,h.StrucNum,h.EndDate, cfa.ShortName,cfa.FORMALNAME,cfa.currstatus, cfa.Actstatus,pfa.ShortName,pfa.FORMALNAME, NULL::VARCHAR,NULL::VARCHAR FROM fias_AddressObjects pfa INNER JOIN fias_AddressObjects cfa ON pfa.AOGUID=cfa.ParentGUID INNER JOIN fias_Houses h ON cfa.aoguid = h.aoguid WHERE cfa.currstatus= CASE WHEN 0 &lt; ALL(SELECT iao.currstatus FROM fias_AddressObjects iao WHERE cfa.aoguid = iao.aoguid) THEN (SELECT MAX(iao.currstatus) FROM fias_AddressObjects iao WHERE cfa.aoguid = iao.aoguid) ELSE 0 END AND h.EndDate=(SELECT MAX(ih.EndDate) FROM fias_Houses ih WHERE cfa.aoguid = ih.aoguid AND h.HouseGUID = ih.HouseGUID) AND pfa.currstatus= CASE WHEN 0 &lt; ALL(SELECT iao.currstatus FROM fias_AddressObjects iao WHERE cfa.aoguid = iao.aoguid) THEN (SELECT MAX(iao.currstatus) FROM fias_AddressObjects iao WHERE pfa.aoguid = iao.aoguid) ELSE 0 END AND UPPER(pfa.FORMALNAME) LIKE v_ParentFormalNameTemplate AND UPPER(pfa.ShortName) LIKE v_ParentShortNameTemplate AND UPPER(cfa.FORMALNAME) LIKE v_FormalNameTemplate AND UPPER(cfa.ShortName) LIKE v_ShortNameTemplate AND TRIM(LOWER(COALESCE(h.HouseNum,''))) LIKE v_HouseNumTemplate AND TRIM(LOWER(COALESCE(h.BuildNum,''))) LIKE v_BuildNumTemplate AND TRIM(LOWER(COALESCE(h.StrucNum,''))) LIKE v_StrucNumTemplate ORDER BY pfa.ShortName,pfa.FORMALNAME,cfa.AOLevel, cfa.ShortName,cfa.FORMALNAME, TO_NUMBER(SUBSTRING(h.HouseNum,E'\\d+'),'9999'), h.HouseNum,TO_NUMBER(SUBSTRING(h.BuildNum,E'\\d+'),'9999'), h.BuildNum,TO_NUMBER(SUBSTRING(h.StrucNum,E'\\d+'),'9999'), h.StrucNum; ELSE RETURN QUERY SELECT cfa.AOGUID,h.HouseGUID,cfa.AOLevel, fsfn_Houses_TreeActualName(h.AOGUID,h.HouseGUID), h.HouseNum,h.BuildNum,h.StrucNum, h.EndDate,cfa.ShortName,cfa.FORMALNAME, cfa.currstatus,cfa.Actstatus,pfa.ShortName, pfa.FORMALNAME,NULL::VARCHAR,NULL::VARCHAR FROM fias_AddressObjects pfa INNER JOIN fias_AddressObjects cfa ON pfa.AOGUID=cfa.ParentGUID INNER JOIN fias_Houses h ON cfa.aoguid = h.aoguid WHERE cfa.currstatus= CASE WHEN 0 &lt; ALL(SELECT iao.currstatus FROM fias_AddressObjects iao WHERE cfa.aoguid = iao.aoguid) THEN (SELECT MAX(iao.currstatus) FROM fias_AddressObjects iao WHERE cfa.aoguid = iao.aoguid) ELSE 0 END AND h.EndDate=(SELECT MAX(ih.EndDate) FROM fias_Houses ih WHERE cfa.aoguid = ih.aoguid AND h.HouseGUID = ih.HouseGUID) AND pfa.currstatus= CASE WHEN 0 &lt; ALL(SELECT iao.currstatus FROM fias_AddressObjects iao WHERE cfa.aoguid = iao.aoguid) THEN (SELECT MAX(iao.currstatus) FROM fias_AddressObjects iao WHERE pfa.aoguid = iao.aoguid) ELSE 0 END AND UPPER(pfa.FORMALNAME) LIKE v_ParentFormalNameTemplate AND UPPER(pfa.ShortName) LIKE v_ParentShortNameTemplate AND UPPER(cfa.FORMALNAME) LIKE v_FormalNameTemplate AND UPPER(cfa.ShortName) LIKE v_ShortNameTemplate ORDER BY pfa.ShortName,pfa.FORMALNAME,cfa.AOLevel, cfa.ShortName,cfa.FORMALNAME, TO_NUMBER(SUBSTRING(h.HouseNum,E'\\d+'),'9999'), h.HouseNum, TO_NUMBER(SUBSTRING(h.BuildNum,E'\\d+'),'9999'), h.BuildNum, TO_NUMBER(SUBSTRING(h.StrucNum,E'\\d+'),'9999'),h.StrucNum; END IF; ELSE v_GrandParentShortNameTemplate:=COALESCE(UPPER( COALESCE(c_WildChar ||REPLACE(TRIM(a_GrandParentShortName),c_BlankChar,c_WildChar) ||c_WildChar,c_WildChar)),c_WildChar); v_GrandParentFormalNameTemplate:=COALESCE(UPPER( c_WildChar ||REPLACE(TRIM(a_GrandParentFormalName),c_BlankChar,c_WildChar) ||c_WildChar),c_WildChar); v_ParentShortNameTemplate:=COALESCE(UPPER( COALESCE(c_WildChar ||REPLACE(TRIM(a_ParentShortName),c_BlankChar,c_WildChar) ||c_WildChar,c_WildChar)),c_WildChar); v_ParentFormalNameTemplate:=COALESCE(UPPER( c_WildChar||REPLACE(TRIM(a_ParentFormalName),c_BlankChar,c_WildChar) ||c_WildChar),c_WildChar); v_FormalNameTemplate:=COALESCE(v_FormalNameTemplate,c_WildChar); IF a_HouseNum IS NOT NULL OR a_BuildNum IS NOT NULL OR a_StrucNum IS NOT NULL THEN RETURN QUERY SELECT cfa.AOGUID,h.HouseGUID,cfa.AOLevel, fsfn_Houses_TreeActualName(h.AOGUID,h.HouseGUID), h.HouseNum,h.BuildNum,h.StrucNum, h.EndDate,cfa.ShortName,cfa.FORMALNAME, cfa.currstatus,cfa.Actstatus,pfa.ShortName, pfa.FORMALNAME,gpfa.ShortName,gpfa.FORMALNAME FROM fias_AddressObjects gpfa INNER JOIN fias_AddressObjects pfa ON gpfa.AOGUID=pfa.ParentGUID INNER JOIN fias_AddressObjects cfa ON pfa.AOGUID=cfa.ParentGUID INNER JOIN fias_Houses h ON cfa.aoguid = h.aoguid WHERE cfa.currstatus= CASE WHEN 0 &lt; ALL(SELECT iao.currstatus FROM fias_AddressObjects iao WHERE cfa.aoguid = iao.aoguid) THEN (SELECT MAX(iao.currstatus) FROM fias_AddressObjects iao WHERE cfa.aoguid = iao.aoguid) ELSE 0 END AND pfa.currstatus= CASE WHEN 0 &lt; ALL(SELECT iao.currstatus FROM fias_AddressObjects iao WHERE cfa.aoguid = iao.aoguid) THEN (SELECT MAX(iao.currstatus) FROM fias_AddressObjects iao WHERE pfa.aoguid = iao.aoguid) ELSE 0 END AND gpfa.currstatus= CASE WHEN 0 &lt; ALL(SELECT iao.currstatus FROM fias_AddressObjects iao WHERE cfa.aoguid = iao.aoguid) THEN (SELECT MAX(iao.currstatus) FROM fias_AddressObjects iao WHERE gpfa.aoguid = iao.aoguid) ELSE 0 END AND h.EndDate=(SELECT MAX(ih.EndDate) FROM fias_Houses ih WHERE cfa.aoguid = ih.aoguid AND h.HouseGUID = ih.HouseGUID) AND UPPER(gpfa.FORMALNAME) LIKE v_GrandParentFormalNameTemplate AND UPPER(gpfa.ShortName) LIKE v_GrandParentShortNameTemplate AND UPPER(pfa.FORMALNAME) LIKE v_ParentFormalNameTemplate AND UPPER(pfa.ShortName) LIKE v_ParentShortNameTemplate AND UPPER(cfa.FORMALNAME) LIKE v_FormalNameTemplate AND UPPER(cfa.ShortName) LIKE v_ShortNameTemplate AND TRIM(LOWER(COALESCE(h.HouseNum,''))) LIKE v_HouseNumTemplate AND TRIM(LOWER(COALESCE(h.BuildNum,''))) LIKE v_BuildNumTemplate AND TRIM(LOWER(COALESCE(h.StrucNum,''))) LIKE v_StrucNumTemplate ORDER BY gpfa.ShortName,gpfa.FORMALNAME,pfa.ShortName, pfa.FORMALNAME,cfa.AOLevel,cfa.ShortName, cfa.FORMALNAME, TO_NUMBER(SUBSTRING(h.HouseNum,E'\\d+'),'9999'), h.HouseNum, TO_NUMBER(SUBSTRING(h.BuildNum,E'\\d+'),'9999'), h.BuildNum, TO_NUMBER(SUBSTRING(h.StrucNum,E'\\d+'),'9999'),h.StrucNum; ELSE RETURN QUERY SELECT cfa.AOGUID,h.HouseGUID,cfa.AOLevel, fsfn_Houses_TreeActualName(h.AOGUID,h.HouseGUID), h.HouseNum,h.BuildNum,h.StrucNum, h.EndDate,cfa.ShortName,cfa.FORMALNAME, cfa.currstatus,cfa.Actstatus,pfa.ShortName, pfa.FORMALNAME,gpfa.ShortName,gpfa.FORMALNAME FROM fias_AddressObjects gpfa INNER JOIN fias_AddressObjects pfa ON gpfa.AOGUID=pfa.ParentGUID INNER JOIN fias_AddressObjects cfa ON pfa.AOGUID=cfa.ParentGUID INNER JOIN fias_Houses h ON cfa.aoguid = h.aoguid WHERE cfa.currstatus= CASE WHEN 0 &lt; ALL(SELECT iao.currstatus FROM fias_AddressObjects iao WHERE cfa.aoguid = iao.aoguid) THEN (SELECT MAX(iao.currstatus) FROM fias_AddressObjects iao WHERE cfa.aoguid = iao.aoguid) ELSE 0 END AND pfa.currstatus= CASE WHEN 0 &lt; ALL(SELECT iao.currstatus FROM fias_AddressObjects iao WHERE cfa.aoguid = iao.aoguid) THEN (SELECT MAX(iao.currstatus) FROM fias_AddressObjects iao WHERE pfa.aoguid = iao.aoguid) ELSE 0 END AND gpfa.currstatus= CASE WHEN 0 &lt; ALL(SELECT iao.currstatus FROM fias_AddressObjects iao WHERE cfa.aoguid = iao.aoguid) THEN (SELECT MAX(iao.currstatus) FROM fias_AddressObjects iao WHERE gpfa.aoguid = iao.aoguid) ELSE 0 END AND h.EndDate=(SELECT MAX(ih.EndDate) FROM fias_Houses ih WHERE cfa.aoguid = ih.aoguid AND h.HouseGUID = ih.HouseGUID) AND UPPER(gpfa.FORMALNAME) LIKE v_GrandParentFormalNameTemplate AND UPPER(gpfa.ShortName) LIKE v_GrandParentShortNameTemplate AND UPPER(pfa.FORMALNAME) LIKE v_ParentFormalNameTemplate AND UPPER(pfa.ShortName) LIKE v_ParentShortNameTemplate AND UPPER(cfa.FORMALNAME) LIKE v_FormalNameTemplate AND UPPER(cfa.ShortName) LIKE v_ShortNameTemplate ORDER BY gpfa.ShortName,gpfa.FORMALNAME,pfa.ShortName, pfa.FORMALNAME,cfa.AOLevel,cfa.ShortName, cfa.FORMALNAME, TO_NUMBER(SUBSTRING(h.HouseNum,E'\\d+'),'9999'), h.HouseNum, TO_NUMBER(SUBSTRING(h.BuildNum,E'\\d+'),'9999'), h.BuildNum, TO_NUMBER(SUBSTRING(h.StrucNum,E'\\d+'),'9999'), h.StrucNum; END IF; END IF; END; $BODY$ LANGUAGE plpgsql; COMMENT ON FUNCTION fstf_Houses_SearchByName(a_HouseNum VARCHAR(20),a_BuildNum VARCHAR(10),a_StrucNum VARCHAR(10),a_FormalName VARCHAR(150),a_ShortName VARCHAR(20),a_ParentFormalName VARCHAR(150),a_ParentShortName VARCHAR(20), a_GrandParentFormalName VARCHAR(150),a_GrandParentShortName VARCHAR(20)) IS '            '; --ROLLBACK TRANSACTION; COMMIT TRANSACTION; --SELECT * FROM fstf_Houses_SearchByName('220'); --SELECT * FROM fstf_Houses_SearchByName(NULL,NULL,'220'); SELECT * FROM fstf_Houses_SearchByName('1',NULL,NULL,''); SELECT * FROM fstf_Houses_SearchByName(NULL,NULL,NULL,'','','',NULL,'');</span></span></code> </pre><br></div></div><br><a name="HousesCreate"></a><h3 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุฅูุดุงุก fias_Houses ููุฒู ููุฒู FIAS </font></font></h3><br><div class="spoiler" style=";text-align:right;direction:rtl"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุฏ ุงูุจุฑูุงูุฌ ุงููุตู</font></font></b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs"><span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TRANSACTION</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> fias_Houses; <span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> fias_EstateStatus; <span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> fias_StructureStatus; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> fias_Houses( HOUSEID <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">36</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>, AOGUID <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">36</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>, HOUSEGUID <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">36</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>, HOUSENUM <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>, BUILDNUM <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>, STRUCNUM <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>, POSTALCODE <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">6</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>, OKATO <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>, OKTMO <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>, IFNSFL <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">4</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>, TERRIFNSFL <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">4</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>, IFNSUL <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">4</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>, TERRIFNSUL <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">4</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>, ESTSTATUS <span class="hljs-type"><span class="hljs-type">INTEGER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>, STATSTATUS <span class="hljs-type"><span class="hljs-type">INTEGER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>, STRSTATUS <span class="hljs-type"><span class="hljs-type">INTEGER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>, STARTDATE <span class="hljs-type"><span class="hljs-type">TIMESTAMP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>, ENDDATE <span class="hljs-type"><span class="hljs-type">TIMESTAMP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>, UPDATEDATE <span class="hljs-type"><span class="hljs-type">TIMESTAMP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>, NORMDOC <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">36</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>, COUNTER <span class="hljs-type"><span class="hljs-type">INTEGER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>, CADNUM <span class="hljs-type"><span class="hljs-type">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">50</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>, DIVTYPE <span class="hljs-type"><span class="hljs-type">INTEGER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> XPKfias_Houses <span class="hljs-keyword"><span class="hljs-keyword">PRIMARY KEY</span></span> ( HOUSEID )) <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">OIDS</span></span>=<span class="hljs-keyword"><span class="hljs-keyword">False</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> XIE1fias_Houses <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> fias_Houses(AOGUID); <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> XIE2fias_Houses <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> fias_Houses(HOUSEGUID); <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> XIE3fias_Houses <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> fias_Houses(AOGUID,HOUSEGUID); <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> XIE4fias_Houses <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> fias_Houses(HOUSENUM,BUILDNUM,STRUCNUM); <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> XIE5fias_Houses <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> fias_Houses(HOUSENUM); <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> XIE6fias_Houses <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> fias_Houses(BUILDNUM); <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> XIE7fias_Houses <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> fias_Houses(STRUCNUM); <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> fias_Houses <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-string"><span class="hljs-string">'HOUSE         ,     .'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> fias_Houses.HOUSEID <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-string"><span class="hljs-string">'   '</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> fias_Houses.AOGUID <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-string"><span class="hljs-string">'      (, ,    ..)'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> fias_Houses.HOUSEGUID <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-string"><span class="hljs-string">'   '</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> fias_Houses.HOUSENUM <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-string"><span class="hljs-string">' '</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> fias_Houses.BUILDNUM <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-string"><span class="hljs-string">' '</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> fias_Houses.STRUCNUM <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-string"><span class="hljs-string">' '</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> fias_Houses.POSTALCODE <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-string"><span class="hljs-string">' '</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> fias_Houses.IFNSFL <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-string"><span class="hljs-string">'  '</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> fias_Houses.TERRIFNSFL <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-string"><span class="hljs-string">'    '</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> fias_Houses.IFNSUL <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-string"><span class="hljs-string">'  '</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> fias_Houses.TERRIFNSUL <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-string"><span class="hljs-string">'    '</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> fias_Houses.OKATO <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> fias_Houses.OKTMO <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> fias_Houses.ESTSTATUS <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-string"><span class="hljs-string">' '</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> fias_Houses.STRSTATUS <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-string"><span class="hljs-string">' '</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> fias_Houses.STATSTATUS <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-string"><span class="hljs-string">' '</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> fias_Houses.STARTDATE <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-string"><span class="hljs-string">'  '</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> fias_Houses.ENDDATE <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-string"><span class="hljs-string">'  '</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> fias_Houses.UPDATEDATE <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-string"><span class="hljs-string">'  () '</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> fias_Houses.NORMDOC <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-string"><span class="hljs-string">'    '</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> fias_Houses.COUNTER <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-string"><span class="hljs-string">'     4'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> fias_Houses.CADNUM <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-string"><span class="hljs-string">'  '</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> fias_Houses.DIVTYPE <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-string"><span class="hljs-string">' : 0 โ   1 โ  2 โ '</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> fias_EstateStatus( EstateStatusID <span class="hljs-type"><span class="hljs-type">INTEGER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>, EstateStatusName <span class="hljs-type"><span class="hljs-type">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">60</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>, EstateStatusShortName <span class="hljs-type"><span class="hljs-type">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">20</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> XPKfias_EstateStatus <span class="hljs-keyword"><span class="hljs-keyword">PRIMARY KEY</span></span> (EstateStatusID)) <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">OIDS</span></span>=<span class="hljs-keyword"><span class="hljs-keyword">False</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> fias_EstateStatus <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-string"><span class="hljs-string">' ()  '</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> fias_EstateStatus.EstateStatusID <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-string"><span class="hljs-string">' .  :0 โ  ,1 โ ,2 โ ,3 โ '</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> fias_EstateStatus.EstateStatusName <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> fias_EstateStatus.EstateStatusShortName <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-string"><span class="hljs-string">' '</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> fias_StructureStatus( StructureStatusID <span class="hljs-type"><span class="hljs-type">INTEGER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>, StructureStatusName <span class="hljs-type"><span class="hljs-type">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">60</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>, StructureStatusShortName <span class="hljs-type"><span class="hljs-type">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">20</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> XPKfias_StructureStatus <span class="hljs-keyword"><span class="hljs-keyword">PRIMARY KEY</span></span> (StructureStatusID)) <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">OIDS</span></span>=<span class="hljs-keyword"><span class="hljs-keyword">False</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> fias_StructureStatus <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-string"><span class="hljs-string">' ()  '</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> fias_StructureStatus.StructureStatusID <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-string"><span class="hljs-string">' .  :0 โ  ,1 โ ,2 โ ,3 โ '</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> fias_StructureStatus.StructureStatusName <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> fias_StructureStatus.StructureStatusShortName <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-string"><span class="hljs-string">' '</span></span>; <span class="hljs-comment"><span class="hljs-comment">--ROLLBACk TRANSACTION; COMMIT TRANSACTION;</span></span></code> </pre><br></div></div><br><a name="HousesFilling"></a><br><h3 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุชูุฒูู ุชุญุฏูุซุงุช FIAS ุงูุฑุฆูุณูุฉ ุฅูู fias_Houses Table </font></font></h3><br><div class="spoiler" style=";text-align:right;direction:rtl"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุฏ ูุตุฏุฑ ุงูุจุฑูุงูุฌ ุงููุตู</font></font></b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs"><span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TRANSACTION</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> $$<span class="pgsql"><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">BEGIN</span></span></span><span class="pgsql"> </span><span class="hljs-comment"><span class="pgsql"><span class="hljs-comment">/****************************************/</span></span></span><span class="pgsql"> </span><span class="hljs-comment"><span class="pgsql"><span class="hljs-comment">/*    */</span></span></span><span class="pgsql"> </span><span class="hljs-comment"><span class="pgsql"><span class="hljs-comment">/****************************************/</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">DROP</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">TABLE</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">IF</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">EXISTS</span></span></span><span class="pgsql"> fias_DeletedHouses_temp; </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">DROP</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">TABLE</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">IF</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">EXISTS</span></span></span><span class="pgsql"> fias_Houses_temp; </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">DROP</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">TABLE</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">IF</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">EXISTS</span></span></span><span class="pgsql"> fias_EstateStatus_temp; </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">DROP</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">TABLE</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">IF</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">EXISTS</span></span></span><span class="pgsql"> fias_StructureStatus_temp; </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">CREATE</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">TABLE</span></span></span><span class="pgsql"> fias_Houses_temp </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">AS</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">SELECT</span></span></span><span class="pgsql"> * </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">FROM</span></span></span><span class="pgsql"> fias_Houses </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">LIMIT</span></span></span><span class="pgsql"> </span><span class="hljs-number"><span class="pgsql"><span class="hljs-number">1</span></span></span><span class="pgsql">; </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">DELETE</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">FROM</span></span></span><span class="pgsql"> fias_Houses_temp; </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">CREATE</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">TABLE</span></span></span><span class="pgsql"> fias_DeletedHouses_temp </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">AS</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">SELECT</span></span></span><span class="pgsql"> * </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">FROM</span></span></span><span class="pgsql"> fias_Houses </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">LIMIT</span></span></span><span class="pgsql"> </span><span class="hljs-number"><span class="pgsql"><span class="hljs-number">1</span></span></span><span class="pgsql">; </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">DELETE</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">FROM</span></span></span><span class="pgsql"> fias_DeletedHouses_temp; </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">CREATE</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">TABLE</span></span></span><span class="pgsql"> fias_EstateStatus_temp </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">AS</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">SELECT</span></span></span><span class="pgsql"> * </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">FROM</span></span></span><span class="pgsql"> fias_EstateStatus </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">LIMIT</span></span></span><span class="pgsql"> </span><span class="hljs-number"><span class="pgsql"><span class="hljs-number">1</span></span></span><span class="pgsql">; </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">DELETE</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">FROM</span></span></span><span class="pgsql"> fias_EstateStatus_temp; </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">CREATE</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">TABLE</span></span></span><span class="pgsql"> fias_StructureStatus_temp </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">AS</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">SELECT</span></span></span><span class="pgsql"> * </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">FROM</span></span></span><span class="pgsql"> fias_StructureStatus </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">LIMIT</span></span></span><span class="pgsql"> </span><span class="hljs-number"><span class="pgsql"><span class="hljs-number">1</span></span></span><span class="pgsql">; </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">DELETE</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">FROM</span></span></span><span class="pgsql"> fias_StructureStatus_temp; </span><span class="hljs-comment"><span class="pgsql"><span class="hljs-comment">/*****************************************************/</span></span></span><span class="pgsql"> </span><span class="hljs-comment"><span class="pgsql"><span class="hljs-comment">/*     fias_EstateStatus  */</span></span></span><span class="pgsql"> </span><span class="hljs-comment"><span class="pgsql"><span class="hljs-comment">/*  " "   */</span></span></span><span class="pgsql"> </span><span class="hljs-comment"><span class="pgsql"><span class="hljs-comment">/*****************************************************/</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">COPY</span></span></span><span class="pgsql"> fias_EstateStatus_temp(EstateStatusID,EstateStatusNAME,EstateStatusShortName) </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">FROM</span></span></span><span class="pgsql"> </span><span class="hljs-string"><span class="pgsql"><span class="hljs-string">'W:\Projects\Enisey GIS\DB\SourceData\ESTSTAT_20180827.csv'</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">WITH</span></span></span><span class="pgsql"> (</span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">FORMAT</span></span></span><span class="pgsql"> csv,</span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">DELIMITER</span></span></span><span class="pgsql"> </span><span class="hljs-string"><span class="pgsql"><span class="hljs-string">';'</span></span></span><span class="pgsql">, </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">ENCODING</span></span></span><span class="pgsql"> </span><span class="hljs-string"><span class="pgsql"><span class="hljs-string">'UTF8'</span></span></span><span class="pgsql">); </span><span class="hljs-comment"><span class="pgsql"><span class="hljs-comment">/*************************************************/</span></span></span><span class="pgsql"> </span><span class="hljs-comment"><span class="pgsql"><span class="hljs-comment">/*     */</span></span></span><span class="pgsql"> </span><span class="hljs-comment"><span class="pgsql"><span class="hljs-comment">/* " "     */</span></span></span><span class="pgsql"> </span><span class="hljs-comment"><span class="pgsql"><span class="hljs-comment">/*************************************************/</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">UPDATE</span></span></span><span class="pgsql"> fias_EstateStatus s </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">SET</span></span></span><span class="pgsql"> EstateStatusNAME=t.EstateStatusNAME, EstateStatusShortName=t.EstateStatusShortName </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">FROM</span></span></span><span class="pgsql"> fias_EstateStatus ds </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">INNER</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">JOIN</span></span></span><span class="pgsql"> fias_EstateStatus_temp t </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">ON</span></span></span><span class="pgsql"> ds.EstateStatusID=t.EstateStatusID </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">WHERE</span></span></span><span class="pgsql"> ds.EstateStatusID=s.EstateStatusID; </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">INSERT</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">INTO</span></span></span><span class="pgsql"> fias_EstateStatus(EstateStatusID,EstateStatusNAME,EstateStatusShortName) </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">SELECT</span></span></span><span class="pgsql"> EstateStatusID,EstateStatusNAME,EstateStatusShortName </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">FROM</span></span></span><span class="pgsql"> fias_EstateStatus_temp t </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">WHERE</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">NOT</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">EXISTS</span></span></span><span class="pgsql"> (</span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">SELECT</span></span></span><span class="pgsql"> * </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">FROM</span></span></span><span class="pgsql"> fias_EstateStatus os </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">WHERE</span></span></span><span class="pgsql"> t.EstateStatusID=os.EstateStatusID); </span><span class="hljs-comment"><span class="pgsql"><span class="hljs-comment">/******************************************************/</span></span></span><span class="pgsql"> </span><span class="hljs-comment"><span class="pgsql"><span class="hljs-comment">/*     fias_StructureStatus  */</span></span></span><span class="pgsql"> </span><span class="hljs-comment"><span class="pgsql"><span class="hljs-comment">/*  " "  */</span></span></span><span class="pgsql"> </span><span class="hljs-comment"><span class="pgsql"><span class="hljs-comment">/******************************************************/</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">COPY</span></span></span><span class="pgsql"> fias_StructureStatus_temp(StructureStatusID,StructureStatusNAME,StructureStatusShortName) </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">FROM</span></span></span><span class="pgsql"> </span><span class="hljs-string"><span class="pgsql"><span class="hljs-string">'W:\Projects\Enisey GIS\DB\SourceData\STRSTAT_20180827.csv'</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">WITH</span></span></span><span class="pgsql"> (</span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">FORMAT</span></span></span><span class="pgsql"> csv,</span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">DELIMITER</span></span></span><span class="pgsql"> </span><span class="hljs-string"><span class="pgsql"><span class="hljs-string">';'</span></span></span><span class="pgsql">, </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">ENCODING</span></span></span><span class="pgsql"> </span><span class="hljs-string"><span class="pgsql"><span class="hljs-string">'UTF8'</span></span></span><span class="pgsql">); </span><span class="hljs-comment"><span class="pgsql"><span class="hljs-comment">/*****************************************************************/</span></span></span><span class="pgsql"> </span><span class="hljs-comment"><span class="pgsql"><span class="hljs-comment">/*     " "  */</span></span></span><span class="pgsql"> </span><span class="hljs-comment"><span class="pgsql"><span class="hljs-comment">/*   */</span></span></span><span class="pgsql"> </span><span class="hljs-comment"><span class="pgsql"><span class="hljs-comment">/*****************************************************************/</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">UPDATE</span></span></span><span class="pgsql"> fias_StructureStatus s </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">SET</span></span></span><span class="pgsql"> StructureStatusNAME=t.StructureStatusNAME, StructureStatusShortName=t.StructureStatusShortName </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">FROM</span></span></span><span class="pgsql"> fias_StructureStatus ds </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">INNER</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">JOIN</span></span></span><span class="pgsql"> fias_StructureStatus_temp t </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">ON</span></span></span><span class="pgsql"> ds.StructureStatusID=t.StructureStatusID </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">WHERE</span></span></span><span class="pgsql"> ds.StructureStatusID=s.StructureStatusID; </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">INSERT</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">INTO</span></span></span><span class="pgsql"> fias_StructureStatus(StructureStatusID,StructureStatusNAME,StructureStatusShortName) </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">SELECT</span></span></span><span class="pgsql"> StructureStatusID,StructureStatusNAME,StructureStatusShortName </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">FROM</span></span></span><span class="pgsql"> fias_StructureStatus_temp t </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">WHERE</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">NOT</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">EXISTS</span></span></span><span class="pgsql"> (</span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">SELECT</span></span></span><span class="pgsql"> * </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">FROM</span></span></span><span class="pgsql"> fias_StructureStatus os </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">WHERE</span></span></span><span class="pgsql"> t.StructureStatusID=os.StructureStatusID); </span><span class="hljs-comment"><span class="pgsql"><span class="hljs-comment">/***********************************************************************/</span></span></span><span class="pgsql"> </span><span class="hljs-comment"><span class="pgsql"><span class="hljs-comment">/*     fias_Houses_temp     */</span></span></span><span class="pgsql"> </span><span class="hljs-comment"><span class="pgsql"><span class="hljs-comment">/**********************************************************************/</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">COPY</span></span></span><span class="pgsql"> fias_Houses_temp(AOGUID,BUILDNUM,ENDDATE,ESTSTATUS,HOUSEGUID,HOUSEID,HOUSENUM,STATSTATUS,IFNSFL,IFNSUL,OKATO,OKTMO,POSTALCODE,STARTDATE,STRUCNUM,STRSTATUS,TERRIFNSFL,TERRIFNSUL,UPDATEDATE,NORMDOC,COUNTER,CADNUM,DIVTYPE) </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">FROM</span></span></span><span class="pgsql"> </span><span class="hljs-string"><span class="pgsql"><span class="hljs-string">'W:\Projects\Enisey GIS\DB\SourceData\HOUSE24_20180827.csv'</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">WITH</span></span></span><span class="pgsql"> (</span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">FORMAT</span></span></span><span class="pgsql"> csv,</span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">DELIMITER</span></span></span><span class="pgsql"> </span><span class="hljs-string"><span class="pgsql"><span class="hljs-string">';'</span></span></span><span class="pgsql">, </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">ENCODING</span></span></span><span class="pgsql"> </span><span class="hljs-string"><span class="pgsql"><span class="hljs-string">'UTF8'</span></span></span><span class="pgsql">); </span><span class="hljs-comment"><span class="pgsql"><span class="hljs-comment">/************************************************************/</span></span></span><span class="pgsql"> </span><span class="hljs-comment"><span class="pgsql"><span class="hljs-comment">/*     fias_DeletedHouses_temp , */</span></span></span><span class="pgsql"> </span><span class="hljs-comment"><span class="pgsql"><span class="hljs-comment">/*        */</span></span></span><span class="pgsql"> </span><span class="hljs-comment"><span class="pgsql"><span class="hljs-comment">/************************************************************/</span></span></span><span class="pgsql"> </span><span class="hljs-comment"><span class="pgsql"><span class="hljs-comment">/*  DHOUSE24      . */</span></span></span><span class="pgsql"> </span><span class="hljs-comment"><span class="pgsql"><span class="hljs-comment">/*         */</span></span></span><span class="pgsql"> </span><span class="hljs-comment"><span class="pgsql"><span class="hljs-comment">/************************************************************/</span></span></span><span class="pgsql"> </span><span class="hljs-comment"><span class="pgsql"><span class="hljs-comment">/* COPY fias_DeletedHouses_temp(AOGUID,BUILDNUM,ENDDATE,ESTSTATUS,HOUSEGUID,HOUSEID,HOUSENUM,STATSTATUS,IFNSFL,IFNSUL,OKATO,OKTMO,POSTALCODE,STARTDATE,STRUCNUM,STRSTATUS,TERRIFNSFL,TERRIFNSUL,UPDATEDATE,NORMDOC,COUNTER,CADNUM,DIVTYPE) FROM 'W:\Projects\Enisey GIS\DB\SourceData\DHOUSE24_20180827.csv' WITH (FORMAT csv,DELIMITER ';', ENCODING 'UTF8'); */</span></span></span><span class="pgsql"> </span><span class="hljs-comment"><span class="pgsql"><span class="hljs-comment">/***********************************************************************/</span></span></span><span class="pgsql"> </span><span class="hljs-comment"><span class="pgsql"><span class="hljs-comment">/*        */</span></span></span><span class="pgsql"> </span><span class="hljs-comment"><span class="pgsql"><span class="hljs-comment">/***********************************************************************/</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">UPDATE</span></span></span><span class="pgsql"> fias_Houses h </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">SET</span></span></span><span class="pgsql"> AOGUID=t.AOGUID, BUILDNUM=t.BUILDNUM, ENDDATE=t.ENDDATE, ESTSTATUS=t.ESTSTATUS, HOUSEGUID=t.HOUSEGUID, HOUSENUM=t.HOUSENUM, STATSTATUS=t.STATSTATUS, IFNSFL=t.IFNSFL, IFNSUL=t.IFNSUL, OKATO=t.OKATO, OKTMO=t.OKTMO, POSTALCODE=t.POSTALCODE, STARTDATE=t.STARTDATE, STRUCNUM=t.STRUCNUM, STRSTATUS=t.STRSTATUS, TERRIFNSFL=t.TERRIFNSFL, TERRIFNSUL=t.TERRIFNSUL, UPDATEDATE=t.UPDATEDATE, NORMDOC=t.NORMDOC, COUNTER=t.COUNTER, CADNUM=t.CADNUM, DIVTYPE=t.DIVTYPE </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">FROM</span></span></span><span class="pgsql"> fias_Houses dh </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">INNER</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">JOIN</span></span></span><span class="pgsql"> fias_Houses_Temp t </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">ON</span></span></span><span class="pgsql"> t.HOUSEID=dh.HOUSEID </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">WHERE</span></span></span><span class="pgsql"> h.HOUSEID=dh.HOUSEID; </span><span class="hljs-comment"><span class="pgsql"><span class="hljs-comment">/****************************************************/</span></span></span><span class="pgsql"> </span><span class="hljs-comment"><span class="pgsql"><span class="hljs-comment">/*       */</span></span></span><span class="pgsql"> </span><span class="hljs-comment"><span class="pgsql"><span class="hljs-comment">/*       */</span></span></span><span class="pgsql"> </span><span class="hljs-comment"><span class="pgsql"><span class="hljs-comment">/* fias_DeletedHouses_temp */</span></span></span><span class="pgsql"> </span><span class="hljs-comment"><span class="pgsql"><span class="hljs-comment">/****************************************************/</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">DELETE</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">FROM</span></span></span><span class="pgsql"> fias_Houses h </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">WHERE</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">EXISTS</span></span></span><span class="pgsql">(</span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">SELECT</span></span></span><span class="pgsql"> </span><span class="hljs-number"><span class="pgsql"><span class="hljs-number">1</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">FROM</span></span></span><span class="pgsql"> fias_DeletedHouses_temp delh </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">WHERE</span></span></span><span class="pgsql"> delh.HOUSEID=h.HOUSEID); </span><span class="hljs-comment"><span class="pgsql"><span class="hljs-comment">/****************************************************/</span></span></span><span class="pgsql"> </span><span class="hljs-comment"><span class="pgsql"><span class="hljs-comment">/*       */</span></span></span><span class="pgsql"> </span><span class="hljs-comment"><span class="pgsql"><span class="hljs-comment">/*  fias_Houses,  */</span></span></span><span class="pgsql"> </span><span class="hljs-comment"><span class="pgsql"><span class="hljs-comment">/*    fias_Houses_Temp */</span></span></span><span class="pgsql"> </span><span class="hljs-comment"><span class="pgsql"><span class="hljs-comment">/****************************************************/</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">INSERT</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">INTO</span></span></span><span class="pgsql"> fias_Houses(AOGUID,BUILDNUM,ENDDATE,ESTSTATUS,HOUSEGUID,HOUSEID,HOUSENUM,STATSTATUS,IFNSFL,IFNSUL,OKATO,OKTMO,POSTALCODE,STARTDATE,STRUCNUM,STRSTATUS,TERRIFNSFL,TERRIFNSUL,UPDATEDATE,NORMDOC,COUNTER,CADNUM,DIVTYPE) </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">SELECT</span></span></span><span class="pgsql"> AOGUID,BUILDNUM,ENDDATE,ESTSTATUS,HOUSEGUID,HOUSEID,HOUSENUM,STATSTATUS,IFNSFL,IFNSUL,OKATO,OKTMO,POSTALCODE,STARTDATE,STRUCNUM,STRSTATUS,TERRIFNSFL,TERRIFNSUL,UPDATEDATE,NORMDOC,COUNTER,CADNUM,DIVTYPE </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">FROM</span></span></span><span class="pgsql"> fias_Houses_Temp t </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">WHERE</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">NOT</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">EXISTS</span></span></span><span class="pgsql">(</span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">SELECT</span></span></span><span class="pgsql"> * </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">FROM</span></span></span><span class="pgsql"> fias_Houses h </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">WHERE</span></span></span><span class="pgsql"> t.HOUSEID=h.HOUSEID); </span><span class="hljs-comment"><span class="pgsql"><span class="hljs-comment">/************************************/</span></span></span><span class="pgsql"> </span><span class="hljs-comment"><span class="pgsql"><span class="hljs-comment">/*    */</span></span></span><span class="pgsql"> </span><span class="hljs-comment"><span class="pgsql"><span class="hljs-comment">/************************************/</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">DROP</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">TABLE</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">IF</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">EXISTS</span></span></span><span class="pgsql"> fias_DeletedHouses_temp; </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">DROP</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">TABLE</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">IF</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">EXISTS</span></span></span><span class="pgsql"> fias_Houses_temp; </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">DROP</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">TABLE</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">IF</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">EXISTS</span></span></span><span class="pgsql"> fias_EstateStatus_temp; </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">DROP</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">TABLE</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">IF</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">EXISTS</span></span></span><span class="pgsql"> fias_StructureStatus_temp; </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">END</span></span></span><span class="pgsql">; $$</span><span class="undefined"></span></span><span class="hljs-keyword"><span class="pgsql"><span class="undefined"></span></span><span class="hljs-keyword">LANGUAGE</span></span> plpgsql; <span class="hljs-comment"><span class="hljs-comment">--ROLLBACK TRANSACTION; COMMIT TRANSACTION; SELECT (SELECT COUNT(*) FROM fias_Houses) AS HouseCount, (SELECT COUNT(*) FROM fias_EstateStatus) AS EStatusCount, (SELECT COUNT(*) FROM fias_StructureStatus) AS SStatusCount;</span></span></code> </pre><br></div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar425287/">https://habr.com/ru/post/ar425287/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar425275/index.html">12 ูุตูุญุฉ ูุชุญุฌูู Node.js</a></li>
<li><a href="../ar425279/index.html">ููููุฉ ููุงุจูุฉ ุฌูุฌู: ูุงุฐุง ุชููู ุ ููุง ูุง ููุฑ</a></li>
<li><a href="../ar425281/index.html">ุฅุฑุดุงุฏุงุช ูุฌูุจ ุงุณุชูุณุงุฎ ูุฌูุงุฒ ุงูุชูุฌูู ุงูุตููู ุงูุดููุฑ Hame A15 ุ ุงููุนุฑูู ุฃูุถูุง ุจุงุณู "A5-V11"</a></li>
<li><a href="../ar425283/index.html">ุชุฑุฌูุฉ ูุง ููุงุฆูุฉ ุ ุฃู ููู ูุชุฑุฌู ุฎุฑูุทุฉ ูู ุงูููุช ุงููุนูู</a></li>
<li><a href="../ar425285/index.html">ุฅุฐุง ููุช ูุง ุชูุธู ุฌููุฒ ุ ูุฃูุช ูุง ุชุณุชุญู ุงูููุฑุฏุงุช</a></li>
<li><a href="../ar425289/index.html">ุชุฑููุฒ ุงูุดุฑูุฉ</a></li>
<li><a href="../ar425291/index.html">ูุชุงุฆุฌ ุงูุชุฏุฑูุจ ุงูุตููู 2018: ุงูุชุณุญูุง ุฎูุณูุงุฆุฉ ุจูุช ุดุงูุฑูุง. ููุฌุง</a></li>
<li><a href="../ar425293/index.html">ุงูููุงุจูุฉ ุงููุซุงููุฉ (ุนูู ุงูุฃุฑุฌุญ) ููุทูุฑ ูุชูุณุท โโุงููุฏู ููููุงุชู ุงููุญูููุฉ</a></li>
<li><a href="../ar425295/index.html">KotlinConf 2018 ูุจุงุดุฑ - ูุญู ุนูู ุงูููุงุก</a></li>
<li><a href="../ar425297/index.html">ุซูุงุซ ุณูุงุนุงุช ููุฃูุนุงุจ ุงูุฑูุงุถูุฉ ุฃู ููู ุฃุญุจุจุช ุชูุตูู ุงูุนุธุงู</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>