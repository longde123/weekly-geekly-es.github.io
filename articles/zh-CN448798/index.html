<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ¤¯ ğŸ“º ğŸ‘¸ğŸ¼ ä½¿ç”¨pytestè¿›è¡ŒPythonæµ‹è¯•ã€‚ å°†pytestä¸å…¶ä»–å·¥å…·ç»“åˆä½¿ç”¨ï¼Œç¬¬7ç«  ğŸ£ ğŸ™ ğŸ³</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="å›å» 


 é€šå¸¸ï¼Œpytestä¸æ˜¯å•ç‹¬ä½¿ç”¨ï¼Œè€Œæ˜¯åœ¨å¸¦æœ‰å…¶ä»–å·¥å…·çš„æµ‹è¯•ç¯å¢ƒä¸­ä½¿ç”¨ã€‚ æœ¬ç« è®¨è®ºäº†é€šå¸¸ä¸pytestç»“åˆä½¿ç”¨ä»¥è¿›è¡Œæœ‰æ•ˆæµ‹è¯•çš„å…¶ä»–å·¥å…·ã€‚ å°½ç®¡è¿™ç»ä¸æ˜¯ä¸€ä¸ªè¯¦å°½çš„æ¸…å•ï¼Œä½†æ˜¯è¿™é‡Œè®¨è®ºçš„å·¥å…·å°†ä½¿æ‚¨äº†è§£å°†pytestä¸å…¶ä»–å·¥å…·æ··åˆä½¿ç”¨çš„å¨åŠ›ã€‚ 





 æœ¬ä¹¦ä¸­çš„ç¤ºä¾‹æ˜¯ä½¿ç”¨Python 3.6å’Œ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ä½¿ç”¨pytestè¿›è¡ŒPythonæµ‹è¯•ã€‚ å°†pytestä¸å…¶ä»–å·¥å…·ç»“åˆä½¿ç”¨ï¼Œç¬¬7ç« </h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/448798/"><p><img src="https://habrastorage.org/webt/jl/jn/bb/jljnbbjr-ejh473xy_eccsmknpk.png">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å›å»</a> </p><br><p>  <em>é€šå¸¸ï¼Œpytestä¸æ˜¯å•ç‹¬ä½¿ç”¨ï¼Œè€Œæ˜¯åœ¨å¸¦æœ‰å…¶ä»–å·¥å…·çš„æµ‹è¯•ç¯å¢ƒä¸­ä½¿ç”¨ã€‚</em>  <em>æœ¬ç« è®¨è®ºäº†é€šå¸¸ä¸pytestç»“åˆä½¿ç”¨ä»¥è¿›è¡Œæœ‰æ•ˆæµ‹è¯•çš„å…¶ä»–å·¥å…·ã€‚</em>  <em>å°½ç®¡è¿™ç»ä¸æ˜¯ä¸€ä¸ªè¯¦å°½çš„æ¸…å•ï¼Œä½†æ˜¯è¿™é‡Œè®¨è®ºçš„å·¥å…·å°†ä½¿æ‚¨äº†è§£å°†pytestä¸å…¶ä»–å·¥å…·æ··åˆä½¿ç”¨çš„å¨åŠ›ã€‚</em> </p><br><p><img src="https://habrastorage.org/webt/hd/--/9w/hd--9w134j0rxhmxftrflbbdopy.png"></p><a name="habracut"></a><br><p> æœ¬ä¹¦ä¸­çš„ç¤ºä¾‹æ˜¯ä½¿ç”¨Python 3.6å’Œpytest 3.2ç¼–å†™çš„ã€‚  pytest 3.2æ”¯æŒPython 2.6ã€2.7å’ŒPython 3.3+ã€‚ </p><br><blockquote>æœ¬ä¹¦ç½‘é¡µä¸Šçš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" title="https://pragprog.com/titles/bopytest/source_code">é“¾æ¥</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" title="https://pragprog.com/titles/bopytest">pragprog.com</a>ä¸Šæä¾›äº†Tasksé¡¹ç›®ä»¥åŠæœ¬ä¹¦ä¸­æ˜¾ç¤ºçš„æ‰€æœ‰æµ‹è¯•çš„æºä»£ç ã€‚ æ‚¨æ— éœ€ä¸‹è½½æºä»£ç å³å¯äº†è§£æµ‹è¯•ä»£ç ã€‚ ç¤ºä¾‹ä¸­ä»¥æ–¹ä¾¿çš„å½¢å¼æä¾›äº†æµ‹è¯•ä»£ç ã€‚ ä½†æ˜¯ï¼Œä¸ºäº†è·Ÿä¸Šé¡¹ç›®çš„ä»»åŠ¡ï¼Œæˆ–è€…æ”¹ç¼–æµ‹è¯•ç¤ºä¾‹æ¥æµ‹è¯•è‡ªå·±çš„é¡¹ç›®ï¼ˆä¸è´¹åŠ›æ°”ï¼ï¼‰ï¼Œæ‚¨å¿…é¡»è½¬åˆ°æœ¬ä¹¦çš„ç½‘é¡µå¹¶ä¸‹è½½å·¥ä½œã€‚ åœ¨è¯¥ä¹¦çš„ç½‘é¡µä¸Šï¼Œæœ‰ä¸€ä¸ª<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" title="https://pragprog.com/titles/bopytest/errata">å‹˜è¯¯</a>ä¿¡æ¯é“¾æ¥å’Œä¸€ä¸ª<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" title="https://forums.pragprog.com/forums/438">è®ºå›</a> ã€‚ </blockquote><p> åœ¨å‰§é€ä¸‹æ–¹æ˜¯è¯¥ç³»åˆ—æ–‡ç« çš„åˆ—è¡¨ã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">ç›®å½•</b> <div class="spoiler_text"><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><strong>å¼•è¨€</strong></a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><strong>ç¬¬1ç« ï¼špytestå…¥é—¨</strong></a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><strong>ç¬¬2ç« ï¼šç¼–å†™æµ‹è¯•å‡½æ•°</strong></a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><strong>ç¬¬3ç« ï¼šPytestå›ºå®šè£…ç½®</strong></a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><strong>ç¬¬4ç« ï¼šå†…ç½®ç¯å…·</strong></a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><strong>ç¬¬5ç« ï¼šæ’ä»¶</strong></a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><strong>ç¬¬6ç« ï¼šé…ç½®</strong></a> </li><li>  [ <strong>ç¬¬7ç« ï¼šä¸å…¶ä»–å·¥å…·ä¸€èµ·ä½¿ç”¨pytest</strong> ]ï¼ˆæœ¬æ–‡ï¼‰ï¼ˆ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://habr.com/zh/post/448798/</a> ï¼‰ </li></ul></div></div><br><h2 id="pdb-debugging-test-failures">  pdbï¼šè°ƒè¯•æµ‹è¯•å¤±è´¥ </h2><br><p> <code>pdb</code>æ¨¡å—æ˜¯æ ‡å‡†åº“ä¸­çš„Pythonè°ƒè¯•å™¨ã€‚ æ‚¨ä½¿ç”¨<code>--pdb</code>ä»¥ä¾¿pyteståœ¨å‡ºç°æ•…éšœæ—¶å¯åŠ¨è°ƒè¯•ä¼šè¯ã€‚ è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹Tasksé¡¹ç›®ä¸Šä¸‹æ–‡ä¸­çš„<code>pdb</code> ã€‚ </p><br><p> åœ¨ç¬¬64é¡µçš„â€œå‚æ•°åŒ–å¤¹å…·â€ä¸­ï¼Œæˆ‘ä»¬ä½¿Tasksé¡¹ç›®ç•™ä¸‹äº†ä¸€äº›é”™è¯¯ï¼š </p><br><pre> <code class="plaintext hljs">$ cd /path/to/code/ch3/c/tasks_proj $ pytest --tb=no -q .........................................FF.FFFF FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF.FFF........... 42 failed, 54 passed in 4.74 seconds</code> </pre> <br><p> åœ¨æŸ¥çœ‹<code>pdb</code>å¦‚ä½•å¸®åŠ©æˆ‘ä»¬è°ƒè¯•æ­¤æµ‹è¯•ä¹‹å‰ï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹å¯ç”¨çš„pytesté€‰é¡¹ä»¥åŠ å¿«è°ƒè¯•æµ‹è¯•é”™è¯¯çš„é€Ÿåº¦ï¼Œæˆ‘ä»¬é¦–å…ˆåœ¨ç¬¬9é¡µçš„â€œä½¿ç”¨é€‰é¡¹â€éƒ¨åˆ†ä¸­è¿›è¡Œäº†æ£€æŸ¥ï¼š </p><br><ul><li>  <code>--tb=[auto/long/short/line/native/no]</code> ï¼šæ§åˆ¶è·Ÿè¸ªæ ·å¼ã€‚ </li><li>  <code>-v / --verbose</code> ï¼šæ˜¾ç¤ºæ‰€æœ‰é€šè¿‡æˆ–å¤±è´¥çš„æµ‹è¯•åç§°ã€‚ </li><li>  <code>-l / --showlocals</code> ï¼šåœ¨å †æ ˆè·Ÿè¸ªæ—è¾¹æ˜¾ç¤ºå±€éƒ¨å˜é‡ã€‚ </li><li>  <code>-lf / --last-failed</code> ï¼šä»…è¿è¡Œå¤±è´¥çš„æµ‹è¯•ã€‚ </li><li>  <code>-x / --exitfirst</code> ï¼šåœ¨ç¬¬ä¸€æ¬¡å¤±è´¥æ—¶åœæ­¢æµ‹è¯•ä¼šè¯ã€‚ </li><li>  <code>--pdb</code> ï¼šåœ¨æ•…éšœç‚¹å¯åŠ¨äº¤äº’å¼è°ƒè¯•ä¼šè¯ã€‚ </li></ul><br><hr><br><p>  <em>å®‰è£…MongoDB</em> </p><br><hr><br><p> å¦‚ç¬¬49é¡µçš„ç¬¬3ç« â€œ Pytestå›ºå®šè£…ç½®â€ä¸­æ‰€è¿°ï¼Œè¿è¡ŒMongoDBæµ‹è¯•éœ€è¦<code>MongoDB</code>å’Œ<code>pymongo</code>å®‰è£…ã€‚ </p><br><p> æˆ‘æµ‹è¯•äº†ä½äº<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://www.mongodb.com/download-centerä¸Š</a>çš„ç¤¾åŒºæœåŠ¡å™¨çš„ç‰ˆæœ¬ã€‚  pymongoä½¿ç”¨<code>pip install pymongo</code> ï¼š <code>pip install pymongo</code> ã€‚ ä½†æ˜¯ï¼Œè¿™æ˜¯ä½¿ç”¨MongoDBçš„ä¹¦ä¸­çš„æœ€åä¸€ä¸ªç¤ºä¾‹ã€‚ è¦åœ¨ä¸ä½¿ç”¨MongoDBçš„æƒ…å†µä¸‹å°è¯•è°ƒè¯•å™¨ï¼Œå¯ä»¥ä»<code>code/ch2/</code>è¿è¡Œpytestå‘½ä»¤ï¼Œå› ä¸ºè¯¥ç›®å½•è¿˜åŒ…å«ä¸€äº›å¤±è´¥çš„æµ‹è¯•ã€‚ </p><br><hr><br><p> æˆ‘ä»¬åªæ˜¯ä»<code>code/ch3/c</code>è¿è¡Œäº†æµ‹è¯•ï¼Œä»¥ç¡®ä¿å…¶ä¸­ä¸€äº›ä¸èµ·ä½œç”¨ã€‚ æˆ‘ä»¬æ²¡æœ‰çœ‹åˆ°å›æº¯æˆ–æµ‹è¯•åç§°ï¼Œå› ä¸º<code>--tb=no</code>ç¦ç”¨äº†è·Ÿè¸ªï¼Œå¹¶ä¸”æ²¡æœ‰å¯ç”¨<code>--verbose</code> ã€‚ è®©æˆ‘ä»¬ç”¨è¯¦ç»†çš„æ–‡æœ¬é‡å¤é”™è¯¯ï¼ˆä¸è¶…è¿‡ä¸‰ä¸ªï¼‰ï¼š </p><br><pre> <code class="plaintext hljs">$ pytest --tb=no --verbose --lf --maxfail=3 ============================= test session starts ============================= collected 96 items / 52 deselected run-last-failure: rerun previous 44 failures tests/func/test_add.py::test_add_returns_valid_id[mongo] ERROR [ 2%] tests/func/test_add.py::test_added_task_has_id_set[mongo] ERROR [ 4%] tests/func/test_add.py::test_add_increases_count[mongo] ERROR [ 6%] =================== 52 deselected, 3 error in 0.72 seconds ====================</code> </pre> <br><p> ç°åœ¨æˆ‘ä»¬çŸ¥é“å“ªäº›æµ‹è¯•å¤±è´¥äº†ã€‚ è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹å…¶ä¸­çš„ä¸€ä¸ªï¼Œä½¿ç”¨<code>-x</code> ï¼Œæ‰“å¼€è·Ÿè¸ªï¼Œä¸ä½¿ç”¨<code>--tb=no</code> ï¼Œå¹¶ä½¿ç”¨<code>-l</code>æ˜¾ç¤ºå±€éƒ¨å˜é‡ï¼š </p><br><pre> <code class="plaintext hljs">$ pytest -v --lf -l -x ===================== test session starts ====================== run-last-failure: rerun last 42 failures collected 96 items tests/func/test_add.py::test_add_returns_valid_id[mongo] FAILED =========================== FAILURES =========================== _______________ test_add_returns_valid_id[mongo] _______________ tasks_db = None def test_add_returns_valid_id(tasks_db): """tasks.add(&lt;valid task&gt;) should return an integer.""" # GIVEN an initialized tasks db # WHEN a new task is added # THEN returned task_id is of type int new_task = Task('do something') task_id = tasks.add(new_task) &gt; assert isinstance(task_id, int) E AssertionError: assert False E + where False = isinstance(ObjectId('59783baf8204177f24cb1b68'), int) new_task = Task(summary='do something', owner=None, done=False, id=None) task_id = ObjectId('59783baf8204177f24cb1b68') tasks_db = None tests/func/test_add.py:16: AssertionError !!!!!!!!!!!! Interrupted: stopping after 1 failures !!!!!!!!!!!! ===================== 54 tests deselected ====================== =========== 1 failed, 54 deselected in 2.47 seconds ============</code> </pre><br><p> é€šå¸¸è¿™è¶³ä»¥äº†è§£æµ‹è¯•å¤±è´¥çš„åŸå› ã€‚ åœ¨è¿™ç§ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œå¾ˆæ˜æ˜¾<code>task_id</code>ä¸æ˜¯æ•´æ•°-å®ƒæ˜¯ObjectIdçš„å®ä¾‹ã€‚  ObjectIdæ˜¯MongoDBåœ¨æ•°æ®åº“ä¸­ç”¨äºå¯¹è±¡æ ‡è¯†ç¬¦çš„ç±»å‹ã€‚ æˆ‘å¯¹<code>tasksdb_pymongo.py</code>å±‚çš„æ„å›¾æ˜¯ä½¿ç³»ç»Ÿå…¶ä½™éƒ¨åˆ†éšè—MongoDBå®ç°çš„æŸäº›ç»†èŠ‚ã€‚ å¾ˆæ˜æ˜¾ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒä¸èµ·ä½œç”¨ã€‚ </p><br><p> ä½†æ˜¯ï¼Œæˆ‘ä»¬å¸Œæœ›äº†è§£å¦‚ä½•å°†pdbä¸pytestä¸€èµ·ä½¿ç”¨ï¼Œå› æ­¤è®©æˆ‘ä»¬æƒ³è±¡ä¸€ä¸‹å°šä¸æ¸…æ¥šè¯¥æµ‹è¯•ä¸ºä½•å¤±è´¥ã€‚ æˆ‘ä»¬å¯ä»¥ä½¿pytestå¯åŠ¨è°ƒè¯•ä¼šè¯ï¼Œå¹¶ä½¿ç”¨<code>--pdb</code>åœ¨æ•…éšœç‚¹<code>--pdb</code> ï¼š </p><br><pre> <code class="plaintext hljs">$ pytest -v --lf -x --pdb ===================== test session starts ====================== run-last-failure: rerun last 42 failures collected 96 items tests/func/test_add.py::test_add_returns_valid_id[mongo] FAILED &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; traceback &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; tasks_db = None def test_add_returns_valid_id(tasks_db): """tasks.add(&lt;valid task&gt;) should return an integer.""" # GIVEN an initialized tasks db # WHEN a new task is added # THEN returned task_id is of type int new_task = Task('do something') task_id = tasks.add(new_task) &gt; assert isinstance(task_id, int) E AssertionError: assert False E + where False = isinstance(ObjectId('59783bf48204177f2a786893'), int) tests/func/test_add.py:16: AssertionError &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; entering PDB &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &gt; /path/to/code/ch3/c/tasks_proj/tests/func/test_add.py(16) &gt; test_add_returns_valid_id() -&gt; assert isinstance(task_id, int) (Pdb)</code> </pre> <br><p> ç°åœ¨ï¼Œæˆ‘ä»¬å°†åœ¨æç¤ºç¬¦ï¼ˆPdbï¼‰çš„æç¤ºä¸‹ï¼Œè®¿é—®æ‰€æœ‰äº¤äº’å¼pdbè°ƒè¯•åŠŸèƒ½ã€‚ æŸ¥çœ‹å´©æºƒæ—¶ï¼Œæˆ‘ç»å¸¸ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š </p><br><ul><li>  <code>p/print expr</code> ï¼šæ‰“å°expçš„å€¼ã€‚ </li><li>  <code>pp expr</code> ï¼šæ¼‚äº®æ‰“å°å‡ºexprçš„å€¼ã€‚ </li><li>  <code>l/list</code> ï¼šåˆ—å‡ºæ•…éšœç‚¹ä»¥åŠä¸Šä¸‹ä¸¤è¡Œä»£ç ã€‚ </li><li>  <code>l/list begin,end</code> ï¼šæšä¸¾ç‰¹å®šçš„è¡Œå·ã€‚ </li><li>  <code>a/args</code> ï¼šæ˜¾ç¤ºå½“å‰å‡½æ•°çš„å‚æ•°åŠå…¶å€¼ã€‚ </li><li>  <code>u/up</code> ï¼šå°†å †æ ˆè·¯å¾„ä¸Šç§»ä¸€å±‚ã€‚ </li><li>  <code>d/down</code> ï¼šåœ¨å †æ ˆè·Ÿè¸ªä¸­ä¸‹ç§»ä¸€çº§ã€‚ </li><li>  <code>q/quit</code> ï¼šç»“æŸè°ƒè¯•ä¼šè¯ã€‚ </li></ul><br><p> å…¶ä»–å¯¼èˆªå‘½ä»¤ï¼ˆä¾‹å¦‚stepå’Œnextï¼‰ä¸æ˜¯å¾ˆæœ‰ç”¨ï¼Œå› ä¸ºæˆ‘ä»¬ä½äºassertè¯­å¥ä¸­ã€‚ æ‚¨ä¹Ÿå¯ä»¥ç®€å•åœ°è¾“å…¥å˜é‡åç§°å¹¶è·å–å€¼ã€‚ </p><br><p> æ‚¨å¯ä»¥ä¸<code>-l/--showlocals</code>ç±»ä¼¼åœ°ä½¿ç”¨<code>p/print expr</code>æ¥æŸ¥çœ‹å‡½æ•°ä¸­çš„å€¼ï¼š </p><br><pre> <code class="plaintext hljs">(Pdb) p new_task Task(summary='do something', owner=None, done=False, id=None) (Pdb) p task_id ObjectId('59783bf48204177f2a786893') (Pdb)</code> </pre> <br><p> ç°åœ¨ï¼Œæ‚¨å¯ä»¥é€€å‡ºè°ƒè¯•å™¨å¹¶ç»§ç»­æµ‹è¯•ã€‚ </p><br><pre> <code class="plaintext hljs">(Pdb) q !!!!!!!!!!!! Interrupted: stopping after 1 failures !!!!!!!!!!!! ===================== 54 tests deselected ====================== ========== 1 failed, 54 deselected in 123.40 seconds ===========</code> </pre> <br><p> å¦‚æœæˆ‘ä»¬ä¸ä½¿ç”¨<code>-</code> ï¼Œpytestå°†åœ¨ä¸‹ä¸€ä¸ªæµ‹è¯•ä¸­å†æ¬¡æ‰“å¼€Pdbã€‚  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Pythonæ–‡æ¡£ä¸­</a>æä¾›äº†æœ‰å…³ä½¿ç”¨pdbæ¨¡å—çš„æ›´å¤šä¿¡æ¯ã€‚ </p><br><h2 id="coveragepy-opredelenie-obema-testiruemogo-koda">  Coverage.pyï¼šç¡®å®šæµ‹è¯•ä»£ç çš„æ•°é‡ </h2><br><p> ä»£ç è¦†ç›–ç‡æ˜¯ä¸€ç»„æµ‹è¯•æ‰€æµ‹è¯•çš„å·²æµ‹è¯•ä»£ç ç™¾åˆ†æ¯”çš„æŒ‡æ ‡ã€‚ åœ¨ä¸ºâ€œä»»åŠ¡â€é¡¹ç›®è¿è¡Œæµ‹è¯•æ—¶ï¼ŒæŸäº›â€œä»»åŠ¡â€åŠŸèƒ½åœ¨æ¯æ¬¡æµ‹è¯•æ—¶éƒ½ä¼šæ‰§è¡Œï¼Œä½†ä¸ä¼šå…¨éƒ¨æ‰§è¡Œã€‚ </p><br><p> ä»£ç è¦†ç›–ç‡å·¥å…·éå¸¸é€‚åˆè®©æ‚¨çŸ¥é“æµ‹è¯•å®Œå…¨å¿½ç•¥äº†ç³»ç»Ÿçš„å“ªäº›éƒ¨åˆ†ã€‚ </p><br><p>  <code>Coverage.py</code>æ˜¯é¦–é€‰çš„Pythonè¦†ç›–ç‡å·¥å…·ï¼Œç”¨äºæµ‹é‡ä»£ç çš„è¦†ç›–ç‡ã€‚ </p><br><p> æ‚¨å°†ä½¿ç”¨å®ƒé€šè¿‡pytestéªŒè¯Tasksé¡¹ç›®ä»£ç ã€‚ </p><br><p> è¦ä½¿ç”¨<code>coverage.py</code>æ‚¨éœ€è¦å®‰è£…å®ƒã€‚ å®‰è£…åä¸º<code>pytest-cov</code>çš„æ’ä»¶<code>pytest-cov</code>æ²¡æœ‰ä»€ä¹ˆåå¤„ï¼Œè¯¥æ’ä»¶ä½¿æ‚¨å¯ä»¥ä»pytestä¸­è°ƒç”¨<code>coverage.py</code>å¹¶æä¾›å…¶ä»–ä¸€äº›pytesté€‰é¡¹ã€‚ ç”±äº<code>coverage</code>æ˜¯<code>pytest-cov</code>çš„ä¾èµ–é¡¹ä¹‹ä¸€ï¼Œå› æ­¤åªéœ€å®‰è£…<code>pytest-cov</code> ï¼Œå®ƒå°†é‡‡ç”¨<code>coverage.py</code> ï¼š </p><br><pre> <code class="plaintext hljs">$ pip install pytest-cov Collecting pytest-cov Using cached pytest_cov-2.5.1-py2.py3-none-any.whl Collecting coverage&gt;=3.7.1 (from pytest-cov) Using cached coverage-4.4.1-cp36-cp36m-macosx_10_10_x86 ... Installing collected packages: coverage, pytest-cov Successfully installed coverage-4.4.1 pytest-cov-2.5.1</code> </pre> <br><p> è®©æˆ‘ä»¬è¿è¡Œç¬¬äºŒä¸ªä»»åŠ¡ç‰ˆæœ¬çš„è¦†ç›–ç‡æŠ¥å‘Šã€‚ å¦‚æœæ‚¨ä»ç„¶å®‰è£…äº†Tasksé¡¹ç›®çš„ç¬¬ä¸€ä¸ªç‰ˆæœ¬ï¼Œè¯·å¸è½½å®ƒå¹¶å®‰è£…ç‰ˆæœ¬2ï¼š </p><br><pre> <code class="plaintext hljs">$ pip uninstall tasks Uninstalling tasks-0.1.0: /path/to/venv/bin/tasks /path/to/venv/lib/python3.6/site-packages/tasks.egg-link Proceed (y/n)? y Successfully uninstalled tasks-0.1.0 $ cd /path/to/code/ch7/tasks_proj_v2 $ pip install -e . Obtaining file:///path/to/code/ch7/tasks_proj_v2 ... Installing collected packages: tasks Running setup.py develop for tasks Successfully installed tasks $ pip list ... tasks (0.1.1, /path/to/code/ch7/tasks_proj_v2/src) ...</code> </pre> <br><p> ç°åœ¨å·²å®‰è£…ä»»åŠ¡çš„ä¸‹ä¸€ç‰ˆæœ¬ï¼Œæ‚¨å¯ä»¥è¿è¡ŒåŸºæœ¬è¦†ç›–ç‡æŠ¥å‘Šï¼š </p><br><pre> <code class="plaintext hljs">$ cd /path/to/code/ch7/tasks_proj_v2 $ pytest --cov=src ===================== test session starts ====================== plugins: mock-1.6.2, cov-2.5.1 collected 62 items tests/func/test_add.py ... tests/func/test_add_variety.py ............................ tests/func/test_add_variety2.py ............ tests/func/test_api_exceptions.py ......... tests/func/test_unique_id.py . tests/unit/test_cli.py ..... tests/unit/test_task.py .... ---------- coverage: platform darwin, python 3.6.2-final-0 ----------- Name Stmts Miss Cover -------------------------------------------------- src\tasks\__init__.py 2 0 100% src\tasks\api.py 79 22 72% src\tasks\cli.py 45 14 69% src\tasks\config.py 18 12 33% src\tasks\tasksdb_pymongo.py 74 74 0% src\tasks\tasksdb_tinydb.py 32 4 88% -------------------------------------------------- TOTAL 250 126 50% ================== 62 passed in 0.47 seconds ===================</code> </pre> <br><p> ç”±äºå½“å‰ç›®å½•ä¸º<code>tasks_proj_v2</code> ï¼Œå¹¶ä¸”å—æµ‹è¯•çš„æºä»£ç ä½äºsrcä¸­ï¼Œå› æ­¤æ·»åŠ <code>--cov=src</code>é€‰é¡¹ä»…é’ˆå¯¹è¯¥å—æµ‹è¯•ç›®å½•ç”Ÿæˆè¦†ç›–æŠ¥å‘Šã€‚ </p><br><p> å¦‚æ‚¨æ‰€è§ï¼ŒæŸäº›æ–‡ä»¶çš„è¦†ç›–ç‡éå¸¸ä½ï¼Œç”šè‡³ä¸º0ï¼…ã€‚ è¿™äº›æ˜¯æœ‰ç”¨çš„æé†’ï¼š <code>tasksdb_pymongo.py</code> 0ï¼…ï¼Œå› ä¸ºæˆ‘ä»¬å·²ç¦ç”¨æ­¤ç‰ˆæœ¬ä¸­çš„MongoDBæµ‹è¯•ã€‚ å…¶ä¸­ä¸€äº›æ˜¯ç›¸å½“ä½çš„ã€‚ åœ¨å‡†å¤‡é»„é‡‘æ—¶é—´ä¹‹å‰ï¼Œè¯¥é¡¹ç›®å½“ç„¶å¿…é¡»ä¸ºæ‰€æœ‰è¿™äº›é¢†åŸŸæä¾›æµ‹è¯•ã€‚ </p><br><p> æˆ‘ç›¸ä¿¡å‡ ä¸ªæ–‡ä»¶çš„è¦†ç›–ç‡æ›´é«˜ï¼š <code>api.py</code>å’Œ<code>tasksdb_tinydb.py</code> ã€‚ è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹<code>tasksdb_tinydb.py</code> ï¼Œçœ‹çœ‹ç¼ºå°‘äº†ä»€ä¹ˆã€‚ æˆ‘è®¤ä¸ºåšåˆ°è¿™ä¸€ç‚¹çš„æœ€ä½³æ–¹æ³•æ˜¯ä½¿ç”¨HTMLæŠ¥å‘Šã€‚ </p><br><p> å¦‚æœä½¿ç”¨<code>--cov-report=html</code>é€‰é¡¹å†æ¬¡è¿è¡Œ<code>coverage.py</code> ï¼Œå°†ç”Ÿæˆ<code>--cov-report=html</code> ï¼š </p><br><pre> <code class="plaintext hljs">$ pytest --cov=src --cov-report=html ===================== test session starts ====================== plugins: mock-1.6.2, cov-2.5.1 collected 62 items tests/func/test_add.py ... tests/func/test_add_variety.py ............................ tests/func/test_add_variety2.py ............ tests/func/test_api_exceptions.py ......... tests/func/test_unique_id.py . tests/unit/test_cli.py ..... tests/unit/test_task.py .... ---------- coverage: platform darwin, python 3.6.2-final-0 ----------- Coverage HTML written to dir htmlcov ================== 62 passed in 0.45 seconds ===================</code> </pre> <br><p> ç„¶åï¼Œæ‚¨å¯ä»¥åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€<code>htmlcov/index.html</code> ï¼Œåœ¨ä»¥ä¸‹å±å¹•ä¸Šæ˜¾ç¤ºè¾“å‡ºï¼š </p><br><p><img src="https://habrastorage.org/webt/vs/sc/84/vssc84hovxefvf2g65740gu3ll0.png"></p><br><p> å•å‡»<code>tasksdb_tinydb.py</code>å°†æ˜¾ç¤ºä¸€ä¸ªæ–‡ä»¶çš„æŠ¥å‘Šã€‚ è¦†ç›–è¡Œçš„ç™¾åˆ†æ¯”æ˜¾ç¤ºåœ¨æŠ¥å‘Šçš„é¡¶éƒ¨ï¼ŒåŠ ä¸Šè¦†ç›–çš„è¡Œæ•°å’Œæœªè¦†ç›–çš„è¡Œï¼Œå¦‚ä¸‹ä¸€å±å¹•æ‰€ç¤ºï¼š </p><br><p><img src="https://habrastorage.org/webt/os/pc/-o/ospc-o_yzzdfh1lzllw_1qtilrc.png"></p><br><p> å‘ä¸‹æ»šåŠ¨ï¼Œæ‚¨å¯ä»¥çœ‹åˆ°ç¼ºå¤±çš„è¡Œï¼Œå¦‚ä»¥ä¸‹å±å¹•æ‰€ç¤ºï¼š </p><br><p><img src="https://habrastorage.org/webt/85/rg/lt/85rgltocwrunycedzbeweix4zyc.png"></p><br><p> å³ä½¿æ­¤å±å¹•ä¸æ˜¯è¯¥æ–‡ä»¶çš„å®Œæ•´é¡µé¢ï¼Œä¹Ÿè¶³ä»¥å‘Šè¯‰æˆ‘ä»¬ï¼š </p><br><ol><li> æˆ‘ä»¬ä¸ä½¿ç”¨æ‰€æœ‰è€…é›†æ¥æµ‹è¯•<code>list_tasks()</code> ã€‚ </li><li> æˆ‘ä»¬ä¸æµ‹è¯•<code>update()</code>æˆ–<code>delete()</code> ã€‚ </li><li> ä¹Ÿè®¸æˆ‘ä»¬æ²¡æœ‰å½»åº•æµ‹è¯•<code>unique_id()</code> ã€‚ </li></ol><br><p> å¤ªå¥½äº† æˆ‘ä»¬å¯ä»¥å°†å®ƒä»¬åŒ…æ‹¬åœ¨æˆ‘ä»¬çš„TO-DOæµ‹è¯•åˆ—è¡¨ä¸­ï¼ŒåŒæ—¶å¯ä»¥æµ‹è¯•é…ç½®ç³»ç»Ÿã€‚ </p><br><p> å°½ç®¡ä»£ç è¦†ç›–ç‡å·¥å…·éå¸¸æœ‰ç”¨ï¼Œä½†æ˜¯äº‰å–100ï¼…è¦†ç›–ç‡å¯èƒ½å¾ˆå±é™©ã€‚ å½“æ‚¨çœ‹åˆ°æœªç»æµ‹è¯•çš„ä»£ç æ—¶ï¼Œå¯èƒ½æ„å‘³ç€éœ€è¦æµ‹è¯•ã€‚ ä½†è¿™ä¹Ÿæ„å‘³ç€æœ‰äº›ç³»ç»ŸåŠŸèƒ½æ˜¯ä¸éœ€è¦çš„ï¼Œå¯ä»¥åˆ é™¤ã€‚ åƒæ‰€æœ‰è½¯ä»¶å¼€å‘å·¥å…·ä¸€æ ·ï¼Œä»£ç è¦†ç›–ç‡åˆ†æä¹Ÿä¸èƒ½å–ä»£æ€ç»´ã€‚ </p><br><p> æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><code> coverage.py</code></a>å’Œ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><code>pytest-cov</code></a>çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><code> coverage.py</code></a> ã€‚ </p><br><h2 id="mock-podmena-chastey-sistemy"> æ¨¡æ‹Ÿï¼šæ›¿æ¢ç³»ç»Ÿé›¶ä»¶ </h2><br><p> æ¨¡æ‹ŸåŒ…ç”¨äºæ›¿æ¢ç³»ç»Ÿçš„æŸäº›éƒ¨åˆ†ï¼Œä»¥å°†æµ‹è¯•ä»£ç çš„éƒ¨åˆ†ä¸ç³»ç»Ÿçš„å…¶ä½™éƒ¨åˆ†éš”ç¦»å¼€ã€‚ æ¨¡æ‹Ÿ-å¯¹è±¡æœ‰æ—¶è¢«ç§°ä¸ºæµ‹è¯•åŒæ‰“ï¼Œé—´è°ï¼Œå‡è´§æˆ–å­˜æ ¹ã€‚ </p><br><p> åœ¨æ‚¨è‡ªå·±çš„pytest Monkeypatchå¤¹å…·ï¼ˆåœ¨ç¬¬85é¡µçš„ä½¿ç”¨Monkeypatchä¸­æ‰€è¿°ï¼‰å’Œæ¨¡æ‹Ÿä¹‹é—´ï¼Œæ‚¨åº”è¯¥å…·æœ‰æ‰€æœ‰å¿…éœ€çš„åŒé‡æµ‹è¯•åŠŸèƒ½ã€‚ </p><br><blockquote> æ³¨æ„ï¼ æ¨¡æ‹Ÿå’Œå¾ˆå¥‡æ€ª <br> å¦‚æœè¿™æ˜¯æ‚¨ç¬¬ä¸€æ¬¡é‡åˆ°æ¨¡æ‹Ÿï¼Œå­˜æ ¹å’Œé—´è°ä¹‹ç±»çš„æµ‹è¯•åŒèƒèƒï¼Œè¯·åšå¥½å‡†å¤‡ï¼ è¿™å°†æ˜¯éå¸¸å¥‡æ€ªï¼Œéå¸¸å¿«ï¼Œæœ‰è¶£ï¼Œå°½ç®¡éå¸¸ä»¤äººå°è±¡æ·±åˆ»ã€‚ </blockquote><p>  <code>mock</code>åŒ…éšé™„æ ‡å‡†çš„Pythonåº“ï¼Œè‡ªPython 3.3èµ·<code>unittest.mock</code> ã€‚ åœ¨æ—©æœŸç‰ˆæœ¬ä¸­ï¼Œå®ƒä½œä¸ºé€šè¿‡PyPIå®‰è£…çš„å•ç‹¬è½¯ä»¶åŒ…æä¾›ã€‚ è¿™æ„å‘³ç€æ‚¨å¯ä»¥ä½¿ç”¨Python 2.6çš„<code>mock</code> PyPIç‰ˆæœ¬åˆ°æœ€æ–°çš„Pythonç‰ˆæœ¬ï¼Œå¹¶è·å¾—ä¸æœ€æ–°çš„<code>mock</code> Pythonç›¸åŒçš„åŠŸèƒ½ã€‚ ä½†æ˜¯ï¼Œä¸pytestä¸€èµ·ä½¿ç”¨æ—¶ï¼Œåä¸º<code>pytest-mock</code>çš„æ’ä»¶å…·æœ‰ä¸€äº›åŠŸèƒ½ï¼Œä½¿å…¶æˆä¸ºæˆ‘çš„æ¨¡æ‹Ÿç³»ç»Ÿé¦–é€‰ç•Œé¢ã€‚ </p><br><p> å¯¹äºTasksé¡¹ç›®ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨<code>mock</code>æ¥å¸®åŠ©æˆ‘ä»¬æµ‹è¯•å‘½ä»¤è¡Œç•Œé¢ã€‚ åœ¨Coverage.pyä¸­ï¼šé€šè¿‡ç¡®å®šè¦æµ‹è¯•çš„ä»£ç é‡ï¼Œåœ¨ç¬¬129é¡µä¸Šï¼Œæ‚¨çœ‹åˆ°æˆ‘ä»¬çš„<code>cli.py</code>æ–‡ä»¶æ ¹æœ¬æ²¡æœ‰ç»è¿‡æµ‹è¯•ã€‚ æˆ‘ä»¬ç°åœ¨å°†å¼€å§‹ä¿®å¤å®ƒã€‚ ä½†æ˜¯ï¼Œè®©æˆ‘ä»¬å…ˆè°ˆè°ˆç­–ç•¥ã€‚ </p><br><p>  Tasksé¡¹ç›®ä¸­çš„ç¬¬ä¸€ä¸ªè§£å†³æ–¹æ¡ˆæ˜¯é€šè¿‡<code>api.py</code>è¿›è¡Œå¤§å¤šæ•°åŠŸèƒ½æµ‹è¯•ã€‚ å› æ­¤ï¼Œä¸€ä¸ªåˆç†çš„è§£å†³æ–¹æ¡ˆæ˜¯å‘½ä»¤è¡Œæµ‹è¯•ä¸å¿…æ˜¯å®Œæ•´çš„åŠŸèƒ½æµ‹è¯•ã€‚ å¦‚æœåœ¨CLIæµ‹è¯•æœŸé—´è·å¾—æ¹¿APIçº§åˆ«ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®ä¿ç³»ç»Ÿå°†é€šè¿‡CLIæ­£å¸¸å·¥ä½œã€‚ è¿™ä¹Ÿæ˜¯ä¸€ç§æ–¹ä¾¿çš„è§£å†³æ–¹æ¡ˆï¼Œå¯è®©æˆ‘ä»¬åœ¨æ­¤éƒ¨åˆ†ä¸­æŸ¥çœ‹mokiã€‚ </p><br><p>  CLI Taskså®ç°ä½¿ç”¨ç¬¬ä¸‰æ–¹<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Click</a>å‘½ä»¤è¡Œç•Œé¢åŒ…ã€‚ æœ‰è®¸å¤šå®ç°å‘½ä»¤è¡Œç•Œé¢çš„æ–¹æ³•ï¼ŒåŒ…æ‹¬å†…ç½®åœ¨Python <code>argparse</code>çš„æ¨¡å—ã€‚ æˆ‘é€‰æ‹©Clickçš„åŸå› ä¹‹ä¸€æ˜¯å› ä¸ºå®ƒåŒ…å«ä¸€ä¸ªå¯å¸®åŠ©æˆ‘ä»¬æµ‹è¯•Clickåº”ç”¨ç¨‹åºçš„æµ‹è¯•å¼•æ“ã€‚ ä½†æ˜¯ï¼Œå°½ç®¡æˆ‘ä»¬å¸Œæœ›<code>cli.py</code>çš„ä»£ç æ˜¯Clickåº”ç”¨ç¨‹åºçš„å…¸å‹ï¼Œä½†å®ƒå¹¶ä¸æ˜æ˜¾ã€‚ </p><br><p> è®©æˆ‘ä»¬æ”¾æ…¢é€Ÿåº¦å¹¶å®‰è£…ç¬¬ä¸‰ä¸ªç‰ˆæœ¬çš„Tasksï¼š </p><br><pre> <code class="plaintext hljs">$ cd /path/to/code/ $ pip install -e ch7/tasks_proj_v2 ... Successfully installed tasks</code> </pre> <br><p> åœ¨æœ¬èŠ‚çš„å…¶ä½™éƒ¨åˆ†ï¼Œæ‚¨å°†å¼€å‘ä¸€äº›æµ‹è¯•æ¥æµ‹è¯•åˆ—è¡¨çš„åŠŸèƒ½ã€‚ <br> è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹å®ƒçš„ä½œç”¨ï¼Œä»¥äº†è§£æˆ‘ä»¬è¦æ£€æŸ¥çš„å†…å®¹ï¼š </p><br><blockquote>  <strong><em>è¯‘è€…æ³¨ï¼š</em></strong>åœ¨ä½¿ç”¨Windowså¹³å°æ—¶ï¼Œåœ¨æµ‹è¯•ä¸‹é¢çš„ä¼šè¯æ—¶é‡åˆ°äº†å‡ ä¸ªé—®é¢˜ã€‚ <br><ol><li> åº”è¯¥åœ¨ç”¨æˆ·æ–‡ä»¶å¤¹ä¸­ä¸ºåä¸º<strong><code>tasks_db</code></strong>çš„æ•°æ®åº“åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ã€‚ ä¾‹å¦‚<code>c:\Users\User_1\tasks_db\</code> <br> å¦åˆ™ï¼Œæˆ‘ä»¬å¾—åˆ°-&gt;&gt; FileNotFoundErrorï¼š[Errno 2]æ²¡æœ‰è¿™æ ·çš„æ–‡ä»¶æˆ–ç›®å½•ï¼š'cï¼š\ Users \ User_1 // tasks_db // tasks_db.json' </li><li> ä½¿ç”¨åŒå¼•å·è€Œä¸æ˜¯æ’‡å·ã€‚ å¦åˆ™ä¼šå‡ºç°é”™è¯¯ <br>  â€œåšç‚¹å¾ˆæ£’çš„äº‹â€ <br> ç”¨æ³•ï¼šä»»åŠ¡æ·»åŠ [é€‰é¡¹]æ‘˜è¦ <br> å°è¯•â€œä»»åŠ¡æ·»åŠ -hâ€ä»¥è·å–å¸®åŠ©ã€‚ <br><br> é”™è¯¯ï¼šå‡ºç°äº†æ„å¤–çš„é¢å¤–å‚æ•°ï¼ˆå¾ˆæ£’çš„â€œâ€ï¼‰ <br></li></ol><br></blockquote><br><pre> <code class="plaintext hljs">$ tasks list ID owner done summary -- ----- ---- ------- $ tasks add 'do something great' $ tasks add "repeat" -o Brian $ tasks add "again and again" --owner Okken $ tasks list ID owner done summary -- ----- ---- ------- 1 False do something great 2 Brian False repeat 3 Okken False again and again $ tasks list -o Brian ID owner done summary -- ----- ---- ------- 2 Brian False repeat $ tasks list --owner Brian ID owner done summary -- ----- ---- ------- 2 Brian False repeat</code> </pre> <br><p> çœ‹èµ·æ¥å¾ˆç®€å•ã€‚  <code>tasks list</code>å‘½ä»¤åœ¨æ ‡é¢˜ä¸‹æ˜¾ç¤ºæ‰€æœ‰ä»»åŠ¡çš„åˆ—è¡¨ã€‚ <br> å³ä½¿åˆ—è¡¨ä¸ºç©ºï¼Œä¹Ÿä¼šæ‰“å°æ ‡é¢˜ã€‚ å¦‚æœä½¿ç”¨<code>-o</code>æˆ–<code>--owner</code> ï¼Œåˆ™è¯¥å‘½ä»¤ä»…æ˜¾ç¤ºæ¥è‡ªä¸€ä¸ªæ‰€æœ‰è€…çš„æ•°æ®ã€‚ ä»¥åŠæˆ‘ä»¬å¦‚ä½•æ£€æŸ¥å‘¢ï¼Ÿ æœ‰å¾ˆå¤šæ–¹æ³•ï¼Œä½†æ˜¯æˆ‘ä»¬å°†ä½¿ç”¨mokiã€‚ </p><br><p> ä½¿ç”¨MOKçš„æµ‹è¯•å¿…å®šæ˜¯<em>ç™½ç›’æµ‹è¯•</em> ï¼Œæˆ‘ä»¬éœ€è¦ç ”ç©¶ä»£ç æ¥ç¡®å®šè¦å‡»æ‰“çš„å†…å®¹å’Œä½ç½®ã€‚ ä¸»è¦å…¥å£ç‚¹åœ¨è¿™é‡Œï¼š </p><br><blockquote>  ch7 /tasks_proj_v2/src/tasks/cli.py </blockquote><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__ == <span class="hljs-string"><span class="hljs-string">'__main__'</span></span>: tasks_cli()</code> </pre> <br><p> è¿™åªæ˜¯å¯¹<code>tasks_cli()</code>çš„è°ƒç”¨ï¼š </p><br><blockquote>  ch7 /tasks_proj_v2/src/tasks/cli.py </blockquote><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">@click.group(context_settings={'help_option_names': ['-h', '--help']}) @click.version_option(version='0.1.1') def tasks_cli(): """Run the tasks application.""" pass</span></span></code> </pre> <br><p> æ˜¾ç„¶å—ï¼Ÿ ä¸è¡Œ ä½†æ˜¯ï¼Œç­‰ç­‰ï¼Œå®ƒä¼šå˜å¾—å¥½ï¼ˆæˆ–åï¼Œå–å†³äºæ‚¨çš„è§‚ç‚¹ï¼‰ã€‚ è¿™æ˜¯<code>list</code>å‘½ä»¤ä¹‹ä¸€ï¼š </p><br><blockquote>  ch7 /tasks_proj_v2/src/tasks/cli.py </blockquote><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">@tasks_cli.command(name="list", help="list tasks") @click.option('-o', '--owner', default=None, help='list tasks with this owner') def list_tasks(owner): """    .   ,      . """ formatstr = "{: &gt;4} {: &gt;10} {: &gt;5} {}" print(formatstr.format('ID', 'owner', 'done', 'summary')) print(formatstr.format('--', '-----', '----', '-------')) with _tasks_db(): for t in tasks.list_tasks(owner): done = 'True' if t.done else 'False' owner = '' if t.owner is None else t.owner print(formatstr.format( t.id, owner, done, t.summary))</span></span></code> </pre> <br><p> å½“æ‚¨ä¹ æƒ¯äºç¼–å†™Clickä»£ç æ—¶ï¼Œè¯·ç¡®ä¿è¯¥ä»£ç è¿˜ä¸é”™ã€‚ æˆ‘ä¸ä¼šåœ¨è¿™é‡Œè§£é‡Šå®ƒåœ¨æ­¤åŠŸèƒ½ä¸­çš„ä½œç”¨å’Œå·¥ä½œæ–¹å¼ï¼Œå› ä¸ºå‘½ä»¤è¡Œä»£ç çš„å¼€å‘ä¸æ˜¯æœ¬ä¹¦çš„é‡ç‚¹ã€‚ ä½†æ˜¯ï¼Œå°½ç®¡æˆ‘å‡ ä¹ç»å¯¹å¯ä»¥ç¡®ä¿æˆ‘æ‹¥æœ‰æ­£ç¡®çš„ä»£ç ï¼Œä½†æ˜¯æ€»ä¼šæœ‰å¾ˆå¤§çš„äººä¸ºé”™è¯¯ä½™åœ°ã€‚ å› æ­¤ï¼Œè¦ç¡®ä¿æ­¤åŠŸèƒ½æ­£å¸¸è¿è¡Œï¼Œå¿…é¡»è¿›è¡Œä¸€ç³»åˆ—è‰¯å¥½çš„è‡ªåŠ¨åŒ–æµ‹è¯•ã€‚ <br> æ­¤<code>list_tasks(owner)</code>å‡½æ•°ä¾èµ–äºå…¶ä»–å‡ ä¸ªå‡½æ•°ï¼š <code>tasks_db()</code>æ˜¯ä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼Œè€Œ<code>tasks.list_tasks(owner)</code>æ˜¯APIå‡½æ•°ã€‚ </p><br><p> æˆ‘ä»¬å°†ä½¿ç”¨<code>mock</code>å°†è™šå‡å‡½æ•°æ”¾ç½®åœ¨<code>tasks_db()</code>å’Œ<code>tasks.list_tasks()</code>é€‚å½“ä½ç½®ã€‚ ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å‘½ä»¤è¡Œç•Œé¢è°ƒç”¨<code>list_tasks</code>æ–¹æ³•ï¼Œå¹¶ç¡®ä¿å®ƒè°ƒç”¨äº†<code>tasks.list_tasks()</code>å‡½æ•°ï¼Œè¯¥å‡½æ•°å¯ä»¥æ­£å¸¸å·¥ä½œå¹¶æ­£ç¡®å¤„ç†è¿”å›å€¼ã€‚ <br> è¦æ·¹æ²¡<code>tasks_db()</code> ï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸ªå®é™…çš„å®ç°ï¼š </p><br><p><img src="https://habrastorage.org/webt/jl/jn/bb/jljnbbjr-ejh473xy_eccsmknpk.png">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å›å»</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN448798/">https://habr.com/ru/post/zh-CN448798/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN448782/index.html">ä½¿ç”¨pytestè¿›è¡ŒPythonæµ‹è¯•ã€‚ pytestå…¥é—¨ï¼Œç¬¬1ç« </a></li>
<li><a href="../zh-CN448786/index.html">ä½¿ç”¨pytestè¿›è¡ŒPythonæµ‹è¯•ã€‚ ç¬¬3ç« pytestå›ºå®šè£…ç½®</a></li>
<li><a href="../zh-CN448788/index.html">ä½¿ç”¨pytestè¿›è¡ŒPythonæµ‹è¯•ã€‚ ç¬¬2ç« ï¼Œç¼–å†™æµ‹è¯•å‡½æ•°</a></li>
<li><a href="../zh-CN448790/index.html">SpaceVIL-ç”¨äºåœ¨.Net Coreï¼Œ.Net Standardå’ŒJVMä¸Šå¼€å‘çš„è·¨å¹³å°GUIæ¡†æ¶</a></li>
<li><a href="../zh-CN448796/index.html">ä½¿ç”¨pytestè¿›è¡ŒPythonæµ‹è¯•ã€‚ é…ç½®ï¼Œç¬¬6ç« </a></li>
<li><a href="../zh-CN448800/index.html">ä½¿ç”¨.vsconfigåœ¨æ•´ä¸ªç»„ç»‡ä¸­é…ç½®Visual Studio</a></li>
<li><a href="../zh-CN448802/index.html">å…³äºé—¨æˆ·ç½‘ç«™çš„æ€è€ƒï¼šåœ¨è™šå¹»å¼•æ“4ä¸­åˆ›å»ºé—¨æˆ·ç½‘ç«™</a></li>
<li><a href="../zh-CN448804/index.html">ä¸ºmacOSçš„å¼ºåŒ–è¿è¡Œæ—¶å’Œå…¬è¯åšå¥½å‡†å¤‡</a></li>
<li><a href="../zh-CN448806/index.html">åœ¨Qtåº“ä¸Šåˆ›å»ºæ‰©å±•ç³»ç»Ÿ</a></li>
<li><a href="../zh-CN448808/index.html">å…³äºç®€å•çš„äº‹æƒ…ï¼Œå¤æ‚çš„ã€‚ â€œç¡è§‰çš„é’¢ã€‚â€ å¦‚ä½•ç”¨å•ä¸ªèºæ “å¯¹ç”Ÿé”ˆçš„èºæ “æˆ–éWD-40èºæ “æ¶¦æ»‘</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>