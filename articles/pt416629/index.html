<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßñüèº üíä ‚èπÔ∏è RabbitMQ vs. Kafka: Duas Abordagens Diferentes de Mensagens üßí üëÉüèº üë©‚Äç‚öñÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Nos dois √∫ltimos artigos, falamos sobre o IIoT - a Internet industrial das coisas - constru√≠mos uma arquitetura para receber dados dos sensores, solda...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>RabbitMQ vs. Kafka: Duas Abordagens Diferentes de Mensagens</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/itsumma/blog/416629/"><p>  Nos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">dois</a> √∫ltimos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">artigos,</a> falamos sobre o IIoT - a Internet industrial das coisas - constru√≠mos uma arquitetura para receber dados dos sensores, soldamos os pr√≥prios sensores.  A pedra angular das arquiteturas IIoT e de qualquer arquitetura que trabalhe com o BigData √© o processamento de fluxo de dados.  √â baseado no conceito de mensagens e filas.  O padr√£o para trabalhar com mensagens agora se tornou Apache Kafka.  No entanto, para entender suas vantagens (e entender suas desvantagens), seria bom entender o b√°sico da opera√ß√£o de sistemas de filas em geral, seus mecanismos de opera√ß√£o, padr√µes de uso e funcionalidade b√°sica. </p><br><p><img src="https://habrastorage.org/webt/-5/p1/rn/-5p1rnrr3yks4ukkp0kyovqykli.png"></p><br><p>  Encontramos uma excelente s√©rie de artigos que comparam a funcionalidade do Apache Kafka e outro gigante (imerecidamente ignorado) entre os sistemas de filas - o RabbitMQ.  Traduzimos esta s√©rie de artigos, fornecemos coment√°rios e complementamos.  Embora a s√©rie tenha sido escrita em dezembro de 2017, o mundo dos sistemas de mensagens (e especialmente o Apache Kafka) est√° mudando t√£o rapidamente que, no ver√£o de 2018, algumas coisas mudaram. </p><a name="habracut"></a><br><blockquote>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Fonte</a> </blockquote><br><h2 id="rabbitmq-vs-kafka">  RabbitMQ vs Kafka </h2><br><p>  As mensagens s√£o a parte central de muitas arquiteturas, e os dois pilares nessa √°rea s√£o RabbitMQ e Apache Kafka.  At√© o momento, o Apache Kafka tornou-se um padr√£o quase industrial no processamento e an√°lise de dados; portanto, nesta s√©rie, examinaremos mais de perto o RabbitMQ e o Kafka no contexto de seu uso em infraestruturas em tempo real. </p><br><p> O Apache Kafka agora est√° em ascens√£o, mas parece que eles come√ßaram a esquecer o RabbitMQ.  Todo o hype focado em Kafka, e isso acontece por raz√µes √≥bvias, mas o RabbitMQ ainda √© uma √≥tima op√ß√£o para mensagens.  Uma das raz√µes pelas quais o Kafka voltou sua aten√ß√£o √© sua obsess√£o geral pela escalabilidade, e obviamente o Kafka √© mais escal√°vel que o RabbitMQ, mas a maioria de n√≥s n√£o se preocupa com a escala na qual o RabbitMQ tem problemas.  A maioria de n√≥s n√£o √© o Google ou o Facebook.  A maioria de n√≥s lida com volumes di√°rios de mensagens de centenas de milhares a centenas de milh√µes, e n√£o com volumes de bilh√µes a trilh√µes (mas, a prop√≥sito, h√° casos em que as pessoas escalam o RabbitMQ para bilh√µes de mensagens di√°rias). </p><br><p>  Portanto, em nossa s√©rie de artigos, n√£o falaremos sobre casos em que extrema escalabilidade √© necess√°ria (e essa √© a prerrogativa de Kafka), mas focaremos nas vantagens exclusivas que cada um dos sistemas em considera√ß√£o oferece.  Curiosamente, cada sistema tem suas pr√≥prias vantagens, mas ao mesmo tempo s√£o bastante diferentes um do outro.  √â claro que escrevi muito sobre o RabbitMQ, mas garanto que n√£o dou nenhuma prefer√™ncia particular a ele.  Gosto de coisas bem feitas, e RabbitMQ e Kafka s√£o sistemas de mensagens bastante maduros, confi√°veis ‚Äã‚Äãe, sim, escal√°veis. </p><br><p>  Come√ßaremos no n√≠vel superior e depois come√ßaremos a estudar os v√°rios aspectos dessas duas tecnologias.  Esta s√©rie de artigos √© destinada a profissionais envolvidos na organiza√ß√£o de sistemas de mensagens ou arquitetos / engenheiros que desejam entender os detalhes do n√≠vel mais baixo e sua aplica√ß√£o.  N√£o escreveremos c√≥digo, mas focaremos na funcionalidade oferecida pelos dois sistemas, nos modelos de processo de mensagens que cada um deles oferece e nas decis√µes que os desenvolvedores e arquitetos de decis√£o devem tomar. </p><br><h2 id="rabbitmq-protiv-kafka-dva-raznyh-podhoda-k-obmenu-soobscheniyami">  RabbitMQ vs. Kafka: Duas Abordagens Diferentes de Mensagens </h2><br><p>  Nesta parte, veremos o que RabbitMQ e Apache Kafka s√£o e sua abordagem para as mensagens.  Ambos os sistemas abordam a arquitetura de mensagens de diferentes √¢ngulos, cada um dos quais possui pontos fortes e fracos.  Neste cap√≠tulo, n√£o chegaremos a nenhuma conclus√£o importante; em vez disso, propomos que este artigo seja um manual de tecnologia para iniciantes, para que possamos nos aprofundar nos pr√≥ximos artigos da s√©rie. </p><br><h3 id="rabbitmq">  Rabbitmq </h3><br><p>  RabbitMQ √© um sistema de gerenciamento de fila de mensagens distribu√≠do.  Distribu√≠do, porque geralmente funciona como um cluster de n√≥s, onde as filas s√£o distribu√≠das entre n√≥s e, opcionalmente, s√£o replicadas para serem resistentes a erros e alta disponibilidade.  Regularmente, implementa o AMQP 0.9.1 e oferece outros protocolos, como STOMP, MQTT e HTTP atrav√©s de m√≥dulos adicionais. </p><br><p>  O RabbitMQ usa abordagens de mensagens cl√°ssicas e inovadoras.  Cl√°ssico no sentido de focar na fila de mensagens e inovador - na possibilidade de roteamento flex√≠vel.  Esse recurso de roteamento √© sua vantagem exclusiva.  Criar um sistema de mensagens distribu√≠do r√°pido, escal√°vel e confi√°vel √© uma conquista em si, mas a funcionalidade de roteamento de mensagens o torna realmente excelente entre muitas tecnologias de mensagens. </p><br><h3 id="exchangei-i-ocheredi">  Trocas e filas </h3><br><p>  Revis√£o super simplificada: </p><br><ul><li>  Editores (editores) enviam mensagens para trocas </li><li>  Exchange'i envia mensagens em filas e para outras trocas </li><li>  O RabbitMQ envia confirma√ß√µes aos editores ap√≥s o recebimento de uma mensagem </li><li>  Os destinat√°rios (consumidores) mant√™m conex√µes TCP persistentes com o RabbitMQ e anunciam quais filas que recebem </li><li>  RabbitMQ envia mensagens para os destinat√°rios </li><li>  Os destinat√°rios enviam confirma√ß√µes de sucesso / erro </li><li>  Ap√≥s o recebimento bem-sucedido, as mensagens s√£o removidas das filas. </li></ul><br><p>  Essa lista cont√©m um grande n√∫mero de decis√µes que desenvolvedores e administradores devem tomar para obter as garantias de entrega necess√°rias, caracter√≠sticas de desempenho etc., cada uma das quais discutiremos mais adiante. </p><br><p>  Vamos ver um exemplo de trabalho com um editor, troca, fila e destinat√°rio: </p><br><p><img src="https://habrastorage.org/webt/u2/ii/3d/u2ii3dm9jk-nuzly06mpebzac8y.png"><br>  <em>Fig.</em>  <em>1. Um editor e um destinat√°rio</em> </p><br><p>  O que fazer se voc√™ tiver v√°rios editores da mesma <br>  mensagens?  E se tivermos v√°rios destinat√°rios, cada um dos quais deseja receber todas as mensagens? </p><br><p><img src="https://habrastorage.org/webt/ug/tw/3d/ugtw3df8efgqhmwpwfs47b9ivoo.png"><br>  <em>Fig.</em>  <em>2. V√°rios editores, v√°rios destinat√°rios independentes</em> </p><br><p>  Como voc√™ pode ver, os editores enviam suas mensagens para o mesmo trocador, que envia cada mensagem em tr√™s filas, cada uma com um destinat√°rio.  No caso do RabbitMQ, as filas permitem que diferentes destinat√°rios recebam todas as mensagens.  Compare com a tabela abaixo: </p><br><p><img src="https://habrastorage.org/webt/2_/dj/vd/2_djvdk1k1tnb9u-z9x3q9k2k6o.png"><br>  <em>Fig.</em>  <em>3. V√°rios editores, uma fila com v√°rios destinat√°rios concorrentes</em> <em><br></em> </p><br><p>  Na Figura 3, vemos tr√™s destinat√°rios que usam a mesma fila.  Esses s√£o destinat√°rios concorrentes, ou seja, est√£o competindo para receber mensagens da fila.  Assim, pode-se esperar que, em m√©dia, cada destinat√°rio receba um ter√ßo das mensagens na fila.  Usamos destinat√°rios concorrentes para escalar nosso sistema de processamento de mensagens e, usando o RabbitMQ, √© muito simples: adicionar ou remover destinat√°rios mediante solicita√ß√£o.  N√£o importa quantos destinat√°rios concorrentes voc√™ tenha, o RabbitMQ entregar√° apenas mensagens para um destinat√°rio. </p><br><p>  N√≥s podemos combinar arroz.  2 e 3 para receber v√°rios conjuntos de destinat√°rios concorrentes, em que cada conjunto recebe cada mensagem. </p><br><p><img src="https://habrastorage.org/webt/gr/g4/pk/grg4pk5gfkbocpagiccsvcd3oro.png"><br>  <em>Fig.</em>  <em>4. V√°rios editores, v√°rias filas com destinat√°rios concorrentes</em> </p><br><p>  As setas entre trocadores e filas s√£o chamadas de liga√ß√µes, e falaremos mais sobre elas em mais detalhes. </p><br><h3 id="garantii">  Garantias </h3><br><p>  O RabbitMQ oferece garantias de "entrega √∫nica" e "pelo menos uma entrega", mas n√£o "exatamente uma entrega". </p><br><p>  <em>Nota do tradutor: Antes da vers√£o 0.11 do Kafka, a entrega de mensagens de entrega exatamente uma vez n√£o estava dispon√≠vel; atualmente, uma funcionalidade semelhante est√° presente no Kafka.</em> <em><br></em> </p><br><p>  As mensagens s√£o entregues na ordem em que chegam na fila (afinal, essa √© a defini√ß√£o da fila).  Isso n√£o garante que a conclus√£o do processamento de mensagens corresponda √† mesma ordem quando houver destinat√°rios concorrentes.  Este n√£o √© um erro do RabbitMQ, mas a realidade fundamental do processamento paralelo de um conjunto ordenado de mensagens.  Esse problema pode ser resolvido usando o Consistent Hashing Exchange, como voc√™ ver√° no pr√≥ximo cap√≠tulo sobre modelos e topologias. </p><br><h3 id="protalkivanie-push-i-predvaritelnaya-vyborka-poluchateley">  Enviar e pr√©-buscar destinat√°rios </h3><br><p>  O RabbitMQ envia mensagens para os destinat√°rios (tamb√©m existe uma API para receber mensagens do RabbitMQ, mas essa funcionalidade est√° obsoleta no momento).  Isso pode sobrecarregar os destinat√°rios se as mensagens chegarem na fila mais rapidamente do que os destinat√°rios podem process√°-las.  Para evitar isso, cada destinat√°rio pode definir um limite de pr√©-busca (tamb√©m conhecido como limite de QoS).  De fato, o limite de QoS √© um limite no n√∫mero de mensagens que n√£o foram reconhecidas pelo destinat√°rio acumulado.  Ele age como um fus√≠vel quando o receptor come√ßa a ficar lento. </p><br><p>  Por que foi decidido que as mensagens na fila s√£o enviadas por push (push) e n√£o descarregadas (pull)?  Em primeiro lugar, porque h√° menos tempo de atraso.  Em segundo lugar, idealmente, quando temos destinat√°rios concorrentes da mesma fila, queremos distribuir uniformemente a carga entre eles.  Se cada destinat√°rio solicitar / baixar mensagens, dependendo da quantidade solicitada, a distribui√ß√£o do trabalho poder√° se tornar bastante desigual.  Quanto mais desigual a distribui√ß√£o de mensagens, maior o atraso e a perda adicional de ordem das mensagens durante o processamento.  Esses fatores orientam a arquitetura RabbitMQ em dire√ß√£o a um mecanismo de envio de uma mensagem por vez.  Essa √© uma das limita√ß√µes da escala do RabbitMQ.  A limita√ß√£o √© atenuada pelo fato de que as confirma√ß√µes podem ser agrupadas. </p><br><h3 id="marshrutizaciya">  Encaminhamento </h3><br><p>  As trocas s√£o basicamente roteadores de mensagens para filas e / ou outras trocas.  Para que uma mensagem seja movida do Exchange para uma fila ou para outro Exchange, √© necess√°ria uma liga√ß√£o.  Trocas diferentes requerem liga√ß√µes diferentes.  Existem quatro tipos de trocas e liga√ß√µes associadas: </p><br><ul><li>  Fanout  Direciona para todas as filas e trocadores vinculados √† troca do submodelo Padr√£o de Pub. </li><li>  Direto (direto).  Encaminha mensagens com base na chave de roteamento que a mensagem carrega, definida pelo editor.  A chave de roteamento √© uma sequ√™ncia curta.  Trocadores diretos enviam mensagens para / trocam filas que possuem uma chave de emparelhamento que corresponde exatamente √† chave de roteamento. </li><li>  T√≥pico (tem√°tico).  Encaminha mensagens com base na chave de roteamento, mas permite o uso de correspond√™ncia incompleta (curinga). </li><li>  Cabe√ßalho (cabe√ßalho).  O RabbitMQ permite adicionar cabe√ßalhos de destinat√°rios √†s mensagens.  Trocas de cabe√ßalho enviam mensagens de acordo com esses valores de cabe√ßalho.  Cada liga√ß√£o inclui uma correspond√™ncia exata dos valores do cabe√ßalho.  Voc√™ pode adicionar v√°rios valores √† liga√ß√£o com QUALQUER ou TODOS os valores necess√°rios para corresponder. </li><li>  Hashing consistente.  Este √© um trocador que mistura uma chave de roteamento ou um cabe√ßalho de mensagem e envia apenas em uma fila.  Isso √© √∫til quando voc√™ precisa cumprir as garantias da ordem de processamento e ainda conseguir dimensionar os destinat√°rios. </li></ul><br><p><img src="https://habrastorage.org/webt/jb/2d/gr/jb2dgryq0qn6bivddj265nvuyeu.png"><br>  <em>Fig.</em>  <em>5. Exemplo de troca de t√≥picos</em> </p><br><p>  Tamb√©m consideraremos o roteamento com mais detalhes, mas o exemplo de troca de t√≥picos √© dado acima.  Neste exemplo, os editores publicam logs de erro usando o formato da chave de roteamento LEVEL (N√≠vel de erro) .AppName. </p><br><p>  A fila 1 receber√° todas as mensagens porque usa um n√∫mero curinga com v√°rias palavras. </p><br><p>  A fila 2 receber√° qualquer n√≠vel de log do aplicativo ECommerce.WebUI.  Ele usa curinga *, capturando, assim, o n√≠vel de uma √∫nica nomea√ß√£o de t√≥pico (ERROR.Ecommerce.WebUI, NOTICE.ECommerce.WebUI, etc.). </p><br><p>  A fila 3 exibir√° todas as mensagens de erro de qualquer aplicativo.  Ele usa o caractere curinga # para cobrir todos os aplicativos (ERROR.ECommerce.WebUi, ERROR.SomeApp.SomeSublevel, etc.). </p><br><p>  Gra√ßas a quatro m√©todos de roteamento de mensagens e com a capacidade de trocar mensagens para enviar mensagens para outras trocas, o RabbitMQ permite que voc√™ use um conjunto poderoso e flex√≠vel de modelos de troca de mensagens.  Al√©m disso, falaremos sobre trocas com trocas de cartas mortas, sobre trocas e filas sem dados (trocas e filas ef√™meras), e o RabbitMQ se expandir√° para todo o seu potencial. </p><br><h3 id="exchangei-s-nedostavlennymi-soobscheniyami">  Troca n√£o entregue </h3><br><p>  <em>Nota do tradutor: quando as mensagens da fila n√£o podem ser recebidas por um motivo ou outro (energia do consumidor n√£o √© suficiente, problemas de rede etc.), elas podem ser atrasadas e processadas separadamente.</em> </p><br><p>  Podemos configurar filas para que as mensagens sejam enviadas para troca nas seguintes condi√ß√µes: </p><br><ul><li>  A fila excede o n√∫mero especificado de mensagens. </li><li>  A fila excede o n√∫mero especificado de bytes. </li><li>  O tempo de transmiss√£o da mensagem (TTL) expirou.  O editor pode definir o tempo de vida da mensagem e a pr√≥pria fila tamb√©m pode ter um TTL especificado para a mensagem.  Nesse caso, um TTL mais curto dos dois ser√° usado. </li></ul><br><p>  Criamos uma fila vinculada a trocas com mensagens n√£o entregues e essas mensagens s√£o armazenadas l√° at√© que alguma a√ß√£o seja tomada. </p><br><p>  Como muitas fun√ß√µes do RabbitMQ, as trocas com mensagens n√£o entregues tornam poss√≠vel o uso de modelos que n√£o foram fornecidos originalmente.  Podemos usar mensagens TTL e trocas com mensagens n√£o entregues para implementar filas adiadas e filas de repeti√ß√£o. </p><br><h3 id="obmenniki-i-ocheredi-bez-dannyh">  Trocadores e filas sem dados </h3><br><p>  Trocas e filas podem ser criadas dinamicamente e voc√™ pode definir crit√©rios para a remo√ß√£o autom√°tica.  Isso permite o uso de padr√µes como RPCs baseados em mensagens. </p><br><h3 id="dopolnitelnye-moduli">  M√≥dulos adicionais </h3><br><p>  O primeiro plug-in que voc√™ provavelmente deseja instalar √© o plug-in de gerenciamento, que fornece ao servidor HTTP uma interface da web e uma API REST.  √â muito f√°cil de instalar e possui uma interface f√°cil de usar.  A implanta√ß√£o de scripts por meio da API REST tamb√©m √© muito simples. </p><br><p>  Al√©m disso: </p><br><ul><li>  Troca de hash consistente, troca de sharding e muito mais </li><li>  protocolos como STOMP e MQTT </li><li>  ganchos da web </li><li>  tipos adicionais de trocadores </li><li>  Integra√ß√£o SMTP </li></ul><br><p>  H√° muitas outras coisas que podem ser ditas sobre o RabbitMQ, mas este √© um bom exemplo que permite descrever o que o RabbitMQ pode fazer.  Agora, examinamos o Kafka, que usa uma abordagem completamente diferente das mensagens e, ao mesmo tempo, tamb√©m possui seu pr√≥prio conjunto de recursos distintos e interessantes. </p><br><h3 id="apache-kafka">  Apache kafka </h3><br><p>  Kafka √© um log de confirma√ß√£o replicado distribu√≠do.  Kafka n√£o tem um conceito de filas, o que pode parecer estranho a princ√≠pio, uma vez que √© usado como um sistema de mensagens.  As filas s√£o sin√¥nimo de sistemas de mensagens.  Primeiro, vamos ver o que significa um "log de confirma√ß√£o de altera√ß√µes replicado e distribu√≠do": </p><br><ul><li>  Distribu√≠do porque o Kafka √© implantado como um cluster de n√≥s, tanto para toler√¢ncia a erros quanto para dimensionamento </li><li>  Replicado, pois as mensagens geralmente s√£o replicadas em v√°rios n√≥s (servidores). </li><li>  Um log de confirma√ß√£o porque as mensagens s√£o armazenadas em logs segmentados, somente anexos, chamados t√≥picos.  Esse conceito de registro √© a principal vantagem exclusiva do Kafka. </li></ul><br><p>  Compreender o di√°rio (e o t√≥pico) e as parti√ß√µes √© a chave para entender o Kafka.  Ent√£o, como um log particionado difere de um conjunto de filas?  Vamos imaginar como √©. </p><br><p><img src="https://habrastorage.org/webt/sg/r-/lr/sgr-lrlwlvgr-hxciwvo5uk3ix0.png"><br>  <em>Fig.</em>  <em>6 Um produtor, um segmento, um destinat√°rio</em> </p><br><p>  Em vez de colocar mensagens na fila FIFO e monitorar o status dessa mensagem na fila, como o RabbitMQ faz, Kafka simplesmente a adiciona ao log, e isso √© tudo. </p><br><p>  A mensagem permanece, independentemente de ser recebida uma ou mais vezes.  Ele √© exclu√≠do de acordo com a pol√≠tica de reten√ß√£o, tamb√©m chamada de per√≠odo de janela.  Como as informa√ß√µes s√£o tiradas do t√≥pico? </p><br><p>  Cada destinat√°rio controla onde est√° localizado no log: h√° um ponteiro para a √∫ltima mensagem recebida e esse ponteiro √© chamado de endere√ßo de deslocamento.  Os destinat√°rios suportam esse endere√ßo por meio de bibliotecas cliente e, dependendo da vers√£o do Kafka, o endere√ßo √© armazenado no ZooKeeper ou no pr√≥prio Kafka. </p><br><p>  Uma caracter√≠stica distintiva do modelo de registro no di√°rio √© que elimina instantaneamente muitas dificuldades em rela√ß√£o ao status da entrega de mensagens e, mais importante para os destinat√°rios, permite que eles retrocedam, retornem e recebam mensagens no endere√ßo relativo anterior.  Por exemplo, imagine que voc√™ est√° implantando um servi√ßo que emite faturas que levam em conta os pedidos feitos pelos clientes.  O servi√ßo tem um erro e n√£o calcula corretamente todas as contas em 24 horas.  Com o RabbitMQ, na melhor das hip√≥teses, voc√™ precisar√° republicar esses pedidos apenas no servi√ßo de conta.  Mas com Kafka, voc√™ simplesmente move o endere√ßo relativo desse destinat√°rio 24 horas atr√°s. </p><br><p>  Ent√£o, vamos ver como fica quando h√° um t√≥pico em que h√° uma parti√ß√£o e dois destinat√°rios, cada um dos quais deve receber cada mensagem. </p><br><p><img src="https://habrastorage.org/webt/w1/ii/zh/w1iizhiisxgsumup_ufs8rm_dvk.png"><br>  <em>Fig.</em>  <em>7. Um produtor, uma parti√ß√£o, dois destinat√°rios independentes</em> </p><br><p>  Como pode ser visto no diagrama, dois destinat√°rios independentes recebem a mesma parti√ß√£o, mas lidos em diferentes endere√ßos de deslocamento.  Talvez o servi√ßo de cobran√ßa demore mais para processar as mensagens do que o servi√ßo de notifica√ß√£o por push.  ou talvez o servi√ßo de cobran√ßa n√£o estivesse dispon√≠vel por algum tempo e tentasse recuperar o atraso mais tarde.  Ou talvez tenha havido um erro, e o endere√ßo de deslocamento teve que ser adiado por v√°rias horas. </p><br><p>  Agora, suponha que o servi√ßo de cobran√ßa precise ser dividido em tr√™s partes, porque n√£o pode acompanhar a velocidade da mensagem.  Com o RabbitMQ, simplesmente implantamos mais dois aplicativos de servi√ßo de cobran√ßa que chegam da fila de cobran√ßa.  Mas o Kafka n√£o suporta destinat√°rios concorrentes na mesma parti√ß√£o; o bloco de simultaneidade Kafka √© a pr√≥pria parti√ß√£o.  Portanto, se precisarmos de tr√™s destinat√°rios de contas, precisaremos de pelo menos tr√™s parti√ß√µes.  Ent√£o agora temos: </p><br><p><img src="https://habrastorage.org/webt/3k/fn/rd/3kfnrdjpllbt0nqidfaxrveqvfc.png"><br>  <em>Fig.</em>  <em>8. Tr√™s parti√ß√µes e dois grupos de tr√™s destinat√°rios</em> </p><br><p>  Assim, entende-se que voc√™ precisa de pelo menos tantas parti√ß√µes quanto o destinat√°rio horizontal mais dimensionado.  Vamos falar um pouco sobre parti√ß√µes. </p><br><h3 id="particii-i-gruppy-poluchateley">  Parti√ß√µes e grupos de destinat√°rios </h3><br><p>  Cada parti√ß√£o √© um arquivo separado no qual a sequ√™ncia de mensagens √© garantida.  √â importante lembrar: a ordem das mensagens √© garantida em apenas uma parti√ß√£o.  No futuro, isso pode levar a alguma contradi√ß√£o entre os requisitos de enfileiramento de mensagens e os requisitos de desempenho, j√° que o desempenho no Kafka tamb√©m √© dimensionado por parti√ß√µes.  A parti√ß√£o n√£o pode suportar destinat√°rios concorrentes, portanto, nosso aplicativo de cobran√ßa pode usar apenas uma parte para cada se√ß√£o. </p><br><p>  As mensagens podem ser redirecionadas para segmentos por um algoritmo c√≠clico ou por uma fun√ß√£o hash: hash (chave da mensagem)% n√∫mero de parti√ß√µes.      ,      ,     , ,   ,     ,     .            . </p><br><p>       RabbitMQ.                .   ,     RabbitMQ    ,              .  ,                . </p><br><p>   RabbitMQ                    .  Kafka ,      . </p><br><p>  ,   ,    Kafka   ,   RabbitMQ   ‚Äî    . RabbitMQ     ,            . Kafka      ,      . ,        ,  Kafka     ,     . </p><br><p> ,     ,      ,           (  ).       ,          ,     .  ,      ,      ,        . </p><br><p>      RabbitMQ ‚Äî   Consistent Hashing exchange,      .   Kafka'   ,  Kafka      ,             ,   , ,     ,      -.  RabbitMQ      ,     ,    ,    . </p><br><p>     :   ,     ,    Id 1000     ,     Id 1000    .    ,    ,    .   ,      . </p><br><h3 id="protalkivanie-push-protiv-vygruzki-pull">  (push)   (pull) </h3><br><p> RabbitMQ    (push) ,  ,          .                RabbitMQ   .   , Kafka    (pull),         .     ,          , Kafka  long-polling. </p><br><p>   (pull)    Kafka -  .  Kafka        ,           ,       . </p><br><p>       RabbitMQ,             ,     ,       ,      .   Kafka       ,            . </p><br><h3 id="publikaciya-i-podpiska">    </h3><br><p> Kafka    /¬ª    ,   ,       .       ,            . </p><br><p><img src="https://habrastorage.org/webt/w1/ii/zh/w1iizhiisxgsumup_ufs8rm_dvk.png"><br>  <em>Fig.</em> <em>9.     </em> </p><br><p>       ,       ,       Kafka     : </p><br><p> . 10.  ,         <br> <em><img src="https://habrastorage.org/webt/zl/uu/eu/zluueuxxppnji50tgqnar-pnmfk.png"></em> </p><br><p>           ,   : </p><br><p><img src="https://habrastorage.org/webt/xo/bw/op/xobwopr8b9fey8huqbclx85mh4y.png"><br>  <em>Fig.</em> <em>11.      </em> </p><br><p>         , ,               . </p><br><p> ,     ,  ,     ,  . </p><br><p><img src="https://habrastorage.org/webt/uf/wn/a4/ufwna4h-bmmmr48gp0yo8akk4je.png"><br>  <em>Fig.</em> <em>12.   </em> </p><br><p>          .         . </p><br><p><img src="https://habrastorage.org/webt/ok/vs/ce/okvsce2-xvrnztcupmx-fkbyg5w.png"></p><br><p>      : </p><br><ul><li>      </li><li>      ( ,       ) </li><li>    </li></ul><br><p>           ,               .     ,   ,    . </p><br><p>     Kafka ‚Äì       , , ,     , ,     .    .            ,         .  ,   ,     . </p><br><h3 id="szhatie-zhurnala">   </h3><br><p>     ‚Äî       . ,        50 .        ‚Äì  .   ,   ,         ,  . </p><br><p>  ,    ,     .  ,    ,       .           ,         .  ,    ,      ,    . </p><br><p>                    .   ,  ,        . </p><br><h3 id="podrobnee-ob-uporyadochenii-soobscheniy">     </h3><br><p>  ,           RabbitMQ,    Kafka,   Kafka   .  RabbitMQ           ,    ,   ZooKeeper  Consul. </p><br><p>   RabbitMQ    ,    Kafka.      RabbitMQ,     ,      .  :            . </p><br><p>    .        ,         .     .         ,    .            .       .  ,   ,    -   . </p><br><p>           ,   Kafka,     .     .  ,         ,       . </p><br><p>  ,    . RabbitMQ        ,  Kafka        . </p><br><h3 id="vyvody">  Conclus√µes </h3><br><p> RabbitMQ          ,    .           ,     ,     .    ,           .             ,     ,    . </p><br><p>   Kafka         .               ,         .   Kafka       ,  RabbitMQ    . ,  Kafka    ,  RabbitMQ,         ,       . </p><br><p>              RabbitMQ. </p><br><blockquote> , ,      IoT  ,    . : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">t.me/justiothings</a> </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt416629/">https://habr.com/ru/post/pt416629/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt416619/index.html">Semin√°rio on-line aberto ‚ÄúCriando um site na estrutura Yii2‚Äù</a></li>
<li><a href="../pt416621/index.html">Homo Extensis. Expandir as capacidades humanas ou como combinar humano e rob√¥</a></li>
<li><a href="../pt416623/index.html">A objetividade da psicoterapia</a></li>
<li><a href="../pt416625/index.html">Novo sistema de reconhecimento facial instalado pela pol√≠cia de Londres n√£o reconhece ningu√©m</a></li>
<li><a href="../pt416627/index.html">Gerenciamento do transportador de TI, ou L√° e volta</a></li>
<li><a href="../pt416633/index.html">QUIC, TLS 1.3, DNS sobre HTTPS e depois em todos os lugares</a></li>
<li><a href="../pt416635/index.html">Da direita para a esquerda. Como ativar a interface do site em RTL</a></li>
<li><a href="../pt416637/index.html">M√∫sica de papel e papel√£o: uma breve hist√≥ria do variofone e do ‚Äúsom desenhado‚Äù</a></li>
<li><a href="../pt416639/index.html">Entrevista com um pioneiro do rejuvenescimento</a></li>
<li><a href="../pt416641/index.html">8 etapas do processo de desenvolvimento de uma interface de aplicativo m√≥vel</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>