<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>☘️ 〰️ 👩🏾‍🔬 支付通道和闪电网络在比特币中如何工作？ 🏍️ 🦅 👨🏼‍🏫</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="本文专门讨论链下支付渠道：它们的类型，操作原理和应用程序功能。 所提供的材料将有助于理解为什么付款渠道的概念在财务会计系统中具有革命性意义。 我们将讨论专门针对比特币的支付渠道。 本文对于不熟悉支付渠道概念的人将非常有用，并且还将使您了解闪电网络的原理。 

 付款渠道及其基本信息 
 什么是付款渠...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>支付通道和闪电网络在比特币中如何工作？</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/distributedlab/blog/414793/">本文专门讨论链下支付渠道：它们的类型，操作原理和应用程序功能。 所提供的材料将有助于理解为什么付款渠道的概念在财务会计系统中具有革命性意义。 我们将讨论专门针对比特币的支付渠道。 本文对于不熟悉支付渠道概念的人将非常有用，并且还将使您了解闪电网络的原理。 <br><a name="habracut"></a><br><h2>  <b>付款渠道及其基本信息</b> </h2><br><h3> 什么是付款渠道？ </h3><br> 支付渠道是一种无需向区块链添加交易即可进行多次支付的方法。 同时，通道成员仅彼此交互。 不需要其他验证者或第三方信任的存在。 <br><br><h3> 付款渠道的好处 </h3><br> 与常规交易相比，付款渠道有什么好处？ <br> 作为已经开放的付款渠道的一部分，参与者有机会进行即时付款。 接收方执行快速独立验证并接受付款。 基本版本中没有佣金。 因此，小额支付有一个地方。 由于此功能，支付渠道也称为小额支付渠道。 <br><br> 另一个有趣的优势是，渠道参与者的交互可以私下进行。 因此，尽管每个人都知道在特定比特币地址之间使用支付渠道这一事实，但每个小额支付的细节仍将对其他所有人保密。 <br><br><h3> 付款渠道功能 </h3><br> 这并不是说与常规交易相比，支付渠道存在严重缺陷，但是存在一些特征。 <br><br> 必须打开支付渠道，因此迟早要关闭。 这是通过单独的链上交易完成的。 对于他们来说，支付佣金是不可避免的，需要等待确认。 对于未完成的交易，最好等待完全确认。 <br><br> 在特定渠道内，只能在预定金额内付款。 它由参与者自己设置，并使用特殊的比特币脚本冻结所需的数量。 <br><br> 支付渠道可以分别为单向和双向，单向或双向。 这取决于渠道实施方法本身。 <br><br> 渠道的有效期和最高付款次数可能会受到限制，也可能不受限制。 这取决于技术。 因此，可以在一定时间之后或提前关闭通道。 此外，可以通过参与者的相互同意或应参与者之一的要求关闭该通道，但具有某些功能。 <br><br> 在简化的版本中，可以以这种方案来描述支付通道的操作。 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f84/251/b78/f84251b787c3efeb82464fed23f5b534.png" alt="图片"><br><br> 有一个比特币网络。 有两个用户：Alice和Bob。 他们有比特币钱包，带有用于支付渠道的附加模块，可以根据某种方法工作。 这些模块交换数据以直接付款。 <br><br><h3> 谁的主意？ </h3><br> 中本聪（Satoshi Nakamoto）本人在多年前给活跃协议开发者之一的一封私人信中首次描述了支付渠道的想法。 然后回到比特币，没有接受非常重要的更新，这使得设计可靠的支付渠道成为可能。 但是，后来成为可能，并在2013年恢复了这一真正有前途的想法。 <br><br><h2>  <b>关于实现支付渠道的方法</b> </h2><br> 我们将考虑四个主要方面。 <br>  Spillman式付款渠道是单向渠道的最简单版本，使用寿命有限，付款次数不受限制。 <br><br> 后来，采用了比特币协议的另一种改进，代表了先前方法的改进的CLTV式支付渠道成为可能。 <br><br>  Poon-Dryja支付渠道是一种具有无限运行时间的双向渠道方法。 他们需要对最近采用的比特币协议进行更多更新。 此外，这些通道还用于闪电网络的设计中。 <br><br>  Decker-Wattenhofer双向支付渠道是可以同时使用两个单向渠道的一种选择，它通过形成可替换交易的顺序链而不是整个可替换交易树来改善其性能。 此外，此类渠道可以有两个以上的参与者。 <br><br> 我们将更详细地介绍前两种方法，但首先，我们将重复比特币协议的某些功能。 <br><br><h3> 一些比特币协议 </h3><br>  nLockTime是每个事务主体中的一个字段，其中包含时间戳或块号。 在此时间或区块链高度之前，不允许验证者在区块中包含交易。 <br><br>  nSequence是每个交易输入中的一个字段，其中包含无法确认该交易的时间值。 而且，该时间是相对于确认该输入所花费的输出的时间而计算的。 <br><br>  MultiSignature使得可以在交易结束时设置此类条件，根据该条件有必要提供多个电子签名。 这些签名将通过特定的公共密钥进行验证。 <br><br><h2>  <b>Spillman式付款渠道</b> </h2><br> 因此，Spillman样式的支付渠道是一种创建具有发送者角色和接收者角色的单向支付渠道的方法。 这样的频道的工作时间由发送方任意设置，而接收方可以过早关闭该频道。 <br><br> 让我们在图中查看该通道的主要步骤。 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a9d/aa9/5e5/a9daa95e5f47dad9f23a9010450482b8.png" alt="图片"><br><br> 为了方便起见，假设有一些服务可以通过wi-fi接入点来交换对全球网络的访问权，而某些客户想要一天访问该网络。 该服务将花费一个比特币。 显然，客户端不信任该数量的服务，而是想为每秒的流量付费。 <br><br> 然后，他们决定打开一天的支付渠道，充值一个比特币。 该服务生成用于电子签名的新密钥对，并将公共密钥传输给客户端。 客户端依次生成一个新的密钥对，并使用其公共密钥和服务的公共密钥形成多重签名地址2-of-2。 此外，客户形成第一笔交易，在其中他将一个比特币发送到一个多重签名地址进行签名，但不将其分发给比特币网络，因为该服务可以替代客户并拒绝签署任何交易以进一步转移一个比特币。 <br><br> 因此，客户形成第二笔交易，将具有多重签名地址的硬币发送到他控制的地址。 此外，它设置nLockTime字段，以便可以在一天内确认交易。 他不签署该交易，而是将其发送到服务。 反过来，服务商同意客户可以自己（但不能在一天之内）拿起全部硬币，并用他的钥匙签署交易。 他将签名传递给客户端，客户端对其进行检查。 现在，他有机会用他的钥匙对交易进行预签名，并且如果服务决定拒绝服务，则可以保证取回硬币。 <br><br> 下一步，客户端将交易号1分发到比特币网络，或者将其转移到服务中进行分发（如果它本身没有连接）。 在确认第一笔交易后，付款渠道被认为是开放的。 <br><br> 在这种情况下，第一交易称为资金交易，第二交易称为退款交易。 <br><br> 付款渠道中的计算如何进行交互？ 让我们看下图。 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b11/5a8/44d/b115a844d69e7d50aa5825b42fdf6c50.png" alt="图片"><br><br> 为了发送第一笔付款，客户要求比特币服务地址，由他独立控制。 此外，客户形成第三笔交易，其中具有多重签名地址的硬币被分配在两个输出之间：第一个是在访问点操作的一秒钟内向服务地址付款，第二个是到客户自己的地址的交货。 客户用他的密钥签署第三笔交易，并将其传递给服务。 该服务会检查交易和签名的准确性，然后接受付款，因为该服务可以使用其私钥对交易进行重新签名，并且保证在24小时之内可以收到流量的第一秒。 但是，如果服务打算继续向客户提供服务并在渠道内接收付款，则只需在本地保存第三笔交易，直到渠道关闭。 <br><br> 要发送所有后续付款，客户分别更改第三笔交易的输出，将其重新签名，然后仅将签名和零钱转移给服务。 该服务还检查接收到的数据并保存新的交易编号3版本，因为在此版本中它将接收更多硬币。 <br><br> 如何关闭频道？ <br><br><img src="https://habrastorage.org/getpro/habr/post_images/92b/ac3/b25/92bac3b25a0a7c2afed0ad714334b4c1.png" alt="图片"><br><br> 该图显示，该服务必须有时间在该频道的运营时间结束之前在比特币网络上发布最新版本的第三笔交易。 否则，发件人可以作弊，预先签名并发布第二笔交易，他会将全部金额带到他的地址。 <br><br> 值得注意的是，客户可以在频道运作期间的任何时间发布退款交易。 服务人员会将此类行为视为麻瓜。 因此，他不断监视此交易在网络上的外观，并且如果检测到该交易，则终止与客户的合同，并通过发布最新版本的第三交易来提前关闭渠道。 <br><br><h2>  <b>CLTV风格的支付渠道</b> </h2><br> 现在让我们看一下这种方法的改进版本，即CLTV风格的支付渠道。 <br><br> 在通过添加新脚本代码OP_CHECKLOCKTIMEVERIF进行了软叉比特币更新后，这种付款渠道方法变得适用。 它的特殊之处在于，现在您可以在交易输出中设置这样的规则，根据这些规则，只有在设置的nLockTime参数不小于指定的nLockTime参数的情况下，才能在交易中花费硬币。 实际上，这意味着，除其他条件外，硬币只能在一定时间后使用。 现在，使用脚本化条件分支操作（即IF-ELSE），您可以根据时间设置不同的支出条件。 与以前的付款渠道相比，这些付款渠道的优势在于您无需创建退款交易。 相反，您可以在资金交易的输出脚本中为花硬币指定双重条件。 即，在通道关闭时间之前，可以根据多重签名规则花费硬币，并且在关闭之后一个签名就足够了。 <br><br><h2>  <b>付款渠道如何应用？</b> </h2><br> 有两种选择：要么以纯形式在预先建立的当事方之间定期付款，要么通过在彼此之间切换信道来形成闪电网络。 切换意味着可以在尚未彼此打开支付渠道但与其他网络参与者具有开放渠道的用户之间进行支付。 然后，该值将通过一系列未经授权的参与者（如果存在）进行传输。 <br><br> 对于雷电网络，还有其他困难和功能。 这是用于交换信道和通信协议节点的普遍接受的格式的发展。 重要的是，一些开发人员的钱包可以与其他开发人员的钱包一起使用。 另一个挑战是该网络上的路由问题。 考虑到在每个通道中每个方向上的转移量都受到限制这一事实，您需要找到最短的转移价值的方法。 <br><br><h3> 网络功能 </h3><br> 在下图中，让我们看一下比特币网络和闪电网络的功能。 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4d5/fd6/ca1/4d5fd6ca1842b9a846847f814b81ea7a.png" alt="图片"><br><br> 在比特币网络中，节点交换有关交易和区块的数据，以及彼此的网络地址。 在这种情况下，达成共识并形成一个公共数据库。 除了完整的节点外，比特币网络中还有一些轻量级节点，它们仅接收所需信息，而不处理和存储整个历史记录。 <br><br> 在闪电网络中，节点不会交换现成的事务，也不会达成共识。 但是对他们来说，更新彼此状态的信息并交换消息以维持付款渠道内的工作也很重要。 应该注意的是，闪电网络也不会是同质的，从某种意义上说，将存在负载越来越大的节点以及活动不稳定的节点。 最有可能的是，网络中将存在集线器，节点具有大量开放的支付渠道，并且它们将不得不应付大量的负载。 普通用户最多可以使用这些中心之一打开一个或两个付款渠道。 <br><br> 之所以会这样，是因为要打开每个付款渠道，您需要冻结一定数量的硬币，然后您只能接受并发送有限数量的付款。 如果普通用户将他的硬币分成几个部分并打开几个渠道，那么实际上，与原始金额相比，他在每个渠道中会收到很小的付款窗口。 同时，大型组织（例如钱包开发人员，集中式交易所或受欢迎的商人）将充当枢纽。 他们有能力维持大量频道的大量开放，并且长时间不脱机。 <br><br><h2>  <b>热点问题</b> </h2><br> 考虑有关支付渠道和闪电网络的常见问题。 <br><br>  <i>-与常规比特币交易相比，渠道中的付款有多可靠？</i> <br><br> 通过可靠性，可以将渠道中的付款与普通付款进行比较，也就是说，不会取走硬币，也不会取消付款。 但是有很多功能，例如需要及时打开和关闭通道，限制通道内的数量，需要与比特币网络持续同步，冻结硬币一段时间的可能性。 <br><br>  <i>-通道和闪电网络的带宽是否受到限制？</i> <br><br> 事实是没有任何限制，但是可能存在与信道处理，网络侦察和路由构建相关的延迟，具体取决于特定参与者的性能。 另外，节点可能会意外地脱机，这在其他参与者进行付款时可能会受到某些限制。 <br><br>  <i>-频道成员应该互相信任吗？</i> <br><br> 不可以，支付渠道的机制可以防止交互方进行任何恶意操作。 <br><br>  <i>-对于只想发送一笔付款的人，渠道有什么用？</i> <br><br> 如果某人想摆脱最新的硬币，而不再打算接受和发送付款，那么打开渠道就没有意义，您需要发送正常的链上交易。 在所有其他情况下，打开频道将很有用。 <br><br> 区块链在线课程“ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">脱链支付渠道</a> ”的演讲之一也致力于该主题。 </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN414793/">https://habr.com/ru/post/zh-CN414793/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN414779/index.html">Vertex Impress Nero评测：金属+ 18：9屏幕+ 3300 mAh电池，价格为6,990卢布</a></li>
<li><a href="../zh-CN414785/index.html">使用Angular和D3进行数据可视化</a></li>
<li><a href="../zh-CN414787/index.html">新的Android RAT使用电报协议</a></li>
<li><a href="../zh-CN414789/index.html">特斯拉Model S再次亮相，并在Model 3装配车间发现了蓄意破坏[根据Elon Mask]的行为</a></li>
<li><a href="../zh-CN414791/index.html">研讨会“面向开发人员的虚拟基础架构：机遇，应用和服务”，6月28日，圣彼得堡</a></li>
<li><a href="../zh-CN414797/index.html">我们如何在Bitrix24上创建开放线</a></li>
<li><a href="../zh-CN414799/index.html">LLTR第0部分：自动网络拓扑检测和非托管交换机。 不可能完成任务吗？</a></li>
<li><a href="../zh-CN414801/index.html">Mail.Ru集团的Moscow Vue.js聚会＃2</a></li>
<li><a href="../zh-CN414803/index.html">我们如何在香港的黑客马拉松中看到物联网支付</a></li>
<li><a href="../zh-CN414805/index.html">公开网络研讨会“替代招募方式”</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>