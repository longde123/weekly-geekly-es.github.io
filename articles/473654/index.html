<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëèüèª üí∏ üîß PHP Composer: arregla las dependencias sin dolor üë©üèæ‚Äçüîß üëç üë©üèø‚Äç‚úàÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Muchos de ustedes deben haberse encontrado con una situaci√≥n en la que hay un error o no la funcionalidad necesaria en la biblioteca o el marco que es...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>PHP Composer: arregla las dependencias sin dolor</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/badoo/blog/473654/"><p>  Muchos de ustedes deben haberse encontrado con una situaci√≥n en la que hay un error o no la funcionalidad necesaria en la biblioteca o el marco que est√°n utilizando.  Supongamos que no fue demasiado vago y form√≥ una solicitud de extracci√≥n.  Pero no lo aceptar√°n de inmediato, y la pr√≥xima versi√≥n del producto en general puede ocurrir en un a√±o. </p><br><p><img src="https://habrastorage.org/webt/jv/ys/9h/jvys9h_dh2zmefozo_xhrosiipo.jpeg" alt="PHP Composer: arregla las dependencias sin dolor"></p><br><p>  ¬øQu√© hacer si necesita urgentemente extender la correcci√≥n al producto?  La soluci√≥n obvia es usar una bifurcaci√≥n de una biblioteca o marco.  Sin embargo, no todo es simple con horquillas.  Usar la herencia para anular la funcionalidad que necesita ser cambiada no siempre es posible y a menudo requiere cambios importantes.  Los complementos para Composer que pueden parchear dependencias vienen al rescate. </p><br><p>  En este art√≠culo hablar√© m√°s sobre por qu√© las bifurcaciones son inconvenientes, y tambi√©n considerar√© dos complementos para Composer para parchear dependencias: c√≥mo difieren, c√≥mo usarlos y cu√°les son sus ventajas.  Si ha encontrado problemas similares o simplemente se pregunta, bienvenido a cat. <a name="habracut"></a></p><br><p> El problema se considera m√°s convenientemente con un ejemplo.  Digamos que queremos cambiar algo en la biblioteca de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Cobertura de C√≥digo PHP</a> , que se usa en el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">marco de</a> prueba <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">PHPUnit</a> para medir el nivel de cobertura de c√≥digo por pruebas.  Supongamos que queremos arreglar algo como esto en la versi√≥n 7.0.8 (archivo <code>myFix.patch</code> ): </p><br><pre> <code class="diff hljs">diff --git a/src/CodeCoverage.php b/src/CodeCoverage.php index 2c92ae2..514171e 100644 --- a/src/CodeCoverage.php +++ b/src/CodeCoverage.php @@ -190,6 +190,7 @@ public function filter(): Filter */ public function getData(bool $raw = false): array { + // for example some changes here if (!$raw &amp;&amp; $this-&gt;addUncoveredFilesFromWhitelist) { $this-&gt;addUncoveredFilesFromWhitelist(); }</code> </pre> <br><p>  Creemos nuestra biblioteca de ejemplo.  Deja que sea <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">php-composer-patches-example</a> .  Los detalles aqu√≠ no son muy importantes, pero en caso de que decida ver qu√© es la biblioteca, traigo la salida de la consola bajo el spoiler. </p><br><div class="spoiler">  <b class="spoiler_title">Texto oculto</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">$ git clone git@github.com:mougrim/php-composer-patches-example.git   ¬´php-composer-patches-example¬ª‚Ä¶ remote: Enumerating objects: 3, done. remote: Counting objects: 100% (3/3), done. remote: Compressing objects: 100% (2/2), done. remote: Total 3 (delta 0), reused 0 (delta 0), pack-reused 0  : 100% (3/3), . $ cd php-composer-patches-example/ $ $ composer.phar init --name=mougrim/php-composer-patches-example --description="It's an example for article with using forks and patches for changing dependencies" --author='Mougrim &lt;rinat@mougrim.ru&gt;' --type=library --require='phpunit/phpunit:^8.4.2' --license=MIT --homepage='https://github.com/mougrim/php-composer-patches-example' Welcome to the Composer config generator This command will guide you through creating your composer.json config. Package name (&lt;vendor&gt;/&lt;name&gt;) [mougrim/php-composer-patches-example]: Description [It's an example for article with using forks and patches for changing dependencies]: Author [Mougrim &lt;rinat@mougrim.ru&gt;, n to skip]: Minimum Stability []: Package Type (eg library, project, metapackage, composer-plugin) [library]: License [MIT]: Define your dependencies. Would you like to define your dev dependencies (require-dev) interactively [yes]? no { "name": "mougrim/php-composer-patches-example", "description": "It's an example for article with using forks and patches for changing dependencies", "type": "library", "homepage": "https://github.com/mougrim/php-composer-patches-example", "require": { "phpunit/phpunit": "^8.4.2" }, "license": "MIT", "authors": [ { "name": "Mougrim", "email": "rinat@mougrim.ru" } ] } Do you confirm generation [yes]? yes Would you like to install dependencies now [yes]? yes Loading composer repositories with package information Updating dependencies (including require-dev) Package operations: 29 installs, 0 updates, 0 removals - Installing sebastian/version (2.0.1): Loading from cache - Installing sebastian/type (1.1.3): Loading from cache - Installing sebastian/resource-operations (2.0.1): Loading from cache - Installing sebastian/recursion-context (3.0.0): Loading from cache - Installing sebastian/object-reflector (1.1.1): Loading from cache - Installing sebastian/object-enumerator (3.0.3): Loading from cache - Installing sebastian/global-state (3.0.0): Loading from cache - Installing sebastian/exporter (3.1.2): Loading from cache - Installing sebastian/environment (4.2.2): Loading from cache - Installing sebastian/diff (3.0.2): Loading from cache - Installing sebastian/comparator (3.0.2): Loading from cache - Installing phpunit/php-timer (2.1.2): Loading from cache - Installing phpunit/php-text-template (1.2.1): Loading from cache - Installing phpunit/php-file-iterator (2.0.2): Loading from cache - Installing theseer/tokenizer (1.1.3): Loading from cache - Installing sebastian/code-unit-reverse-lookup (1.0.1): Loading from cache - Installing phpunit/php-token-stream (3.1.1): Loading from cache - Installing phpunit/php-code-coverage (7.0.8): Loading from cache - Installing doctrine/instantiator (1.2.0): Loading from cache - Installing symfony/polyfill-ctype (v1.12.0): Loading from cache - Installing webmozart/assert (1.5.0): Loading from cache - Installing phpdocumentor/reflection-common (2.0.0): Loading from cache - Installing phpdocumentor/type-resolver (1.0.1): Loading from cache - Installing phpdocumentor/reflection-docblock (4.3.2): Loading from cache - Installing phpspec/prophecy (1.9.0): Loading from cache - Installing phar-io/version (2.0.1): Loading from cache - Installing phar-io/manifest (1.0.3): Loading from cache - Installing myclabs/deep-copy (1.9.3): Loading from cache - Installing phpunit/phpunit (8.4.2): Loading from cache sebastian/global-state suggests installing ext-uopz (*) phpunit/phpunit suggests installing phpunit/php-invoker (^2.0.0) phpunit/phpunit suggests installing ext-soap (*) Writing lock file Generating autoload files $ $ echo 'vendor/' &gt; .gitignore $ echo 'composer.lock' &gt;&gt; .gitignore $ git add .gitignore composer.json $ $ git commit --gpg-sign --message='Init composer' [master ce800ae] Init composer 2 files changed, 18 insertions(+) create mode 100644 .gitignore create mode 100644 composer.json $ git push origin master  : 4, . Delta compression using up to 4 threads.  : 100% (3/3), .  : 100% (4/4), 1.21 KiB | 1.21 MiB/s, . Total 4 (delta 0), reused 0 (delta 0) To github.com:mougrim/php-composer-patches-example.git f31c342..ce800ae master -&gt; master</code> </pre> </div></div><br><h2 id="chto-ne-tak-s-forkom-zavisimosti">  ¬øQu√© tiene de malo un tenedor de adicci√≥n? </h2><br><p>  Veamos c√≥mo se produce la dependencia de la bifurcaci√≥n.  Intentemos bifurcar la cobertura del c√≥digo PHP. </p><br><ol><li>  Vamos a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">la p√°gina de Cobertura de C√≥digo PHP en GitHub</a> . </li><li>  Presione el bot√≥n de la horquilla <img src="https://habrastorage.org/webt/qj/ff/ta/qjfftaa4kurvcfu91mlrvr2twie.png" alt="Bot√≥n de horquilla">  (nota: tendr√° su bifurcaci√≥n, reemplace mougrim con su nombre de usuario). </li><li>  Clonar el tenedor: <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ../ git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> git@github.com:mougrim/php-code-coverage.git <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> php-code-coverage</code> </pre> </li><li>  Vaya a la versi√≥n que queremos parchear: <br><pre> <code class="bash hljs">git checkout 7.0.8</code> </pre> </li><li>  Cree una rama para corregir: <br><pre> <code class="bash hljs">git checkout -b 7.0.8-myFix</code> </pre> </li><li>  Hacemos los cambios necesarios, nos comprometemos, empujamos: <br><pre> <code class="bash hljs">git apply ../myFix.patch git add src/CodeCoverage.php git commit --gpg-sign --message=<span class="hljs-string"><span class="hljs-string">'My fix'</span></span> git push -u origin 7.0.8-myFix</code> </pre> </li><li>  Agregue fork como repositorio en composer.json para nuestra biblioteca (esto es necesario para que cuando se conecte el <code>phpunit/php-code-coverage</code> , no se conecte el paquete original, sino el fork): <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ../php-composer-patches-example git checkout -b useFork composer.phar config repositories.phpunit/php-code-coverage vcs https://github.com/mougrim/php-code-coverage.git</code> </pre> </li><li>  Cambie la versi√≥n de dependencia a brunch: <br><pre> <code class="bash hljs">composer.phar require phpunit/php-code-coverage <span class="hljs-string"><span class="hljs-string">'dev-7.0.8-myFix'</span></span></code> </pre> </li></ol><br><p>  Pero en realidad es a√∫n m√°s complicado: Composer dice que la instalaci√≥n es imposible, ya que <code>phpunit/phpunit</code> requiere <code>phpunit/php-code-coverage</code> version <code>^7.0.7</code> , y para nuestro proyecto requiere <code>dev-7.0.8-myFix</code> : </p><br><pre> <code class="plaintext hljs">$ composer.phar require phpunit/php-code-coverage 'dev-7.0.8-myFix' ./composer.json has been updated Loading composer repositories with package information Updating dependencies (including require-dev) Your requirements could not be resolved to an installable set of packages. Problem 1 - phpunit/phpunit 8.4.2 requires phpunit/php-code-coverage ^7.0.7 -&gt; satisfiable by phpunit/php-code-coverage[7.0.x-dev]. - phpunit/phpunit 8.4.2 requires phpunit/php-code-coverage ^7.0.7 -&gt; satisfiable by phpunit/php-code-coverage[7.0.x-dev]. - phpunit/phpunit 8.4.2 requires phpunit/php-code-coverage ^7.0.7 -&gt; satisfiable by phpunit/php-code-coverage[7.0.x-dev]. - Can only install one of: phpunit/php-code-coverage[7.0.x-dev, dev-7.0.8-myFix]. - Installation request for phpunit/php-code-coverage dev-7.0.8-myFix -&gt; satisfiable by phpunit/php-code-coverage[dev-7.0.8-myFix]. - Installation request for phpunit/phpunit ^8.4.2 -&gt; satisfiable by phpunit/phpunit[8.4.2]. Installation failed, reverting ./composer.json to its original content.</code> </pre> <br><p>  ¬øQu√© hacer al respecto?  Hay cuatro opciones: </p><br><ol><li>  Adem√°s de la bifurcaci√≥n de <code>phpunit/php-code-coverage</code> , bifurca PHPUnit y escribe la versi√≥n <code>dev-7.0.8-myFix</code> para la dependencia <code>phpunit/php-code-coverage</code> .  Esta ruta es bastante complicada en t√©rminos de soporte y cuanto m√°s complicada, m√°s bibliotecas dependen de la <code>phpunit/php-code-coverage</code> . </li><li>  Use <a href="">alias</a> al conectar <code>phpunit/php-code-coverage</code> .  Pero los alias no se extraen de las dependencias, lo que significa que siempre deber√°n escribirse manualmente. </li><li>  Realice la <code>phpunit/php-code-coverage</code> en su bifurcaci√≥n para que la etiqueta <code>7.0.8</code> a otra confirmaci√≥n.  Esto al menos no es obvio, pero como m√°ximo, en Git es inconveniente trabajar con etiquetas que hacen referencia a diferentes confirmaciones con el mismo nombre en diferentes repositorios remotos. </li><li>  En su fork <code>phpunit/php-code-coverage</code> use la etiqueta de lanzamiento alfa, por ejemplo <code>7.0.8-a+myFix</code> (puede haber colisiones con lanzamientos alfa de la biblioteca fuente). </li></ol><br><p>  Todas las opciones tienen sus inconvenientes.  Tambi√©n intent√© usar una etiqueta como <code>7.0.8.1</code> , pero Composer no acepta tales etiquetas. </p><br><p>  Las opciones segunda y cuarta parecen ser los males menores.  Por el n√∫mero de acciones, son aproximadamente las mismas, en este art√≠culo consideraremos solo una: la cuarta.  Crea una etiqueta de lanzamiento alfa: </p><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ../php-code-coverage git tag 7.0.8<span class="hljs-_"><span class="hljs-_">-a</span></span>+myFix git push origin 7.0.8<span class="hljs-_"><span class="hljs-_">-a</span></span>+myFix <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ../php-composer-patches-example composer.phar require phpunit/php-code-coverage <span class="hljs-string"><span class="hljs-string">'7.0.8-a+myFix'</span></span> git add composer.json git commit --gpg-sign --message=<span class="hljs-string"><span class="hljs-string">'Use fork'</span></span> git push -u origin useFork</code> </pre> <br><p>  Digamos que queremos usar nuestra biblioteca <code>mougrim/php-composer-patches-example</code> en un proyecto que depende de <code>phpunit/phpunit</code> .  Aqu√≠, uno no puede prescindir del chamanismo, nuevamente tendr√° que especificar el repositorio <code>https://github.com/mougrim/php-code-coverage.git</code> para <code>phpunit/php-code-coverage</code> , as√≠ como indicar expl√≠citamente la dependencia de <code>phpunit/php-code-coverage</code> versi√≥n <code>7.0.8-a+myFix</code> (de lo contrario, la instalaci√≥n no tendr√° √©xito): </p><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ../ mkdir php-project <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> php-project/ composer.phar require phpunit/phpunit <span class="hljs-string"><span class="hljs-string">'^8.4.2'</span></span> composer.phar config repositories.mougrim/php-composer-patches-example vcs https://github.com/mougrim/php-composer-patches-example.git composer.phar config repositories.phpunit/php-code-coverage vcs https://github.com/mougrim/php-code-coverage.git composer.phar require phpunit/php-code-coverage 7.0.8<span class="hljs-_"><span class="hljs-_">-a</span></span>+myFix composer.phar require mougrim/php-composer-patches-example dev-useFork</code> </pre> <br><p>  Tenga en cuenta que php-composer-patches-example est√° conectado como un repositorio, ya que este repositorio es solo un ejemplo y, por lo tanto, no se ha agregado a Packagist.  En su caso, es m√°s probable que omita este paso. </p><br><p>  Para resumir el uso de horquillas. </p><br><p>  Las ventajas de este enfoque: </p><br><ul><li>  No es necesario instalar complementos para Composer. </li></ul><br><p>  Contras de este enfoque: </p><br><ul><li>  si usa <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>roave/security-advisories</code></a> , no ver√° informaci√≥n de que la versi√≥n de la dependencia que bifurc√≥ y modific√≥ contiene una vulnerabilidad; </li><li>  cuando salga una nueva versi√≥n de la dependencia, la historia de la bifurcaci√≥n tendr√° que repetirse nuevamente; </li><li>  si desea corregir una dependencia de dependencia, como en el ejemplo considerado, entonces <code>dev-*</code> no funcionar√° y debe chamanizar con versiones o bifurcaci√≥n para dependencias conflictivas; </li><li>  Si hay proyectos que dependen de su biblioteca, no tendr√° que instalar la biblioteca en el proyecto de la manera m√°s obvia y conveniente; </li><li>  si hay proyectos que dependen de su biblioteca, para ellos la versi√≥n de <code>phpunit/php-code-coverage</code> ser√° estrictamente fija, lo que no siempre es aceptable; </li><li>  Adem√°s, si los proyectos de los puntos anteriores ya bifurcaron la Cobertura de C√≥digo PHP por alguna otra raz√≥n, entonces todo se vuelve a√∫n m√°s complicado. </li></ul><br><p>  Creo que ya te diste cuenta de que abandonar la adicci√≥n no es una buena idea. </p><br><h2 id="ispolzovanie-cweaganscomposer-patches">  Usando cweagans / composer-parches </h2><br><p>  Una vez m√°s, experimentando dolor y sufrimiento al usar tenedores, me encontr√© con <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>cweagans/composer-patches</code></a> en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">PHP Digest No. 101</a> (por cierto, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link">pronskiy tiene un</a> blog √∫til, recomiendo suscribirse).  Este es un complemento para omposer, que le permite aplicar parches a las dependencias.  Despu√©s de leer la descripci√≥n, pens√© que esto es exactamente lo que necesitas. </p><br><p>  C√≥mo usar cweagans / composer-parches: </p><br><ol><li>  Clonar la cobertura del c√≥digo PHP: <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ../ rm -rf php-code-coverage git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> git@github.com:sebastianbergmann/php-code-coverage.git <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> php-code-coverage</code> </pre> </li><li>  Vaya a la versi√≥n que queremos parchear: <br><pre> <code class="bash hljs">git checkout 7.0.8</code> </pre> </li><li>  Hacemos los cambios necesarios. </li><li>  Crea un parche: <br><pre> <code class="bash hljs">mkdir -p ../php-composer-patches-example/patches/phpunit/php-code-coverage git diff HEAD &gt; ../php-composer-patches-example/patches/phpunit/php-code-coverage/myFix.patch</code> </pre> </li><li>  En nuestro proyecto conectamos <code>cweagans/composer-patches</code> : <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ../php-composer-patches-example git checkout master composer.phar update git checkout -b cweagansComposerPatches composer.phar require cweagans/composer-patches <span class="hljs-string"><span class="hljs-string">'^1.6.7'</span></span></code> </pre> </li><li>  Para configurar <code>cweagans/composer-patches</code> agregue lo siguiente a <code>composer.json</code> (puede especificar varios parches para un paquete): <br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"config"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"preferred-install"</span></span>: <span class="hljs-string"><span class="hljs-string">"source"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"extra"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"patches"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"phpunit/php-code-coverage"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"My fix description"</span></span>: <span class="hljs-string"><span class="hljs-string">"patches/phpunit/php-code-coverage/myFix.patch"</span></span> } }, <span class="hljs-attr"><span class="hljs-attr">"enable-patching"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } }</code> </pre> </li><li>  Actualizar dependencias: <br><pre> <code class="bash hljs">composer.phar update</code> </pre> </li><li>  Si algo sali√≥ mal, esto se puede ver en la salida del comando anterior, pero por si acaso, puede verificar que nuestros cambios se hayan aplicado: <br><pre> <code class="plaintext hljs">$ grep example vendor/phpunit/php-code-coverage/src/CodeCoverage.php // for example some changes here</code> </pre> </li><li>  Comprometerse e impulsar el resultado: <br><pre> <code class="bash hljs">git add composer.json patches/phpunit/php-code-coverage/myFix.patch git commit --gpg-sign --message=<span class="hljs-string"><span class="hljs-string">'Use cweagans/composer-patches'</span></span> git push -u origin cweagansComposerPatches</code> </pre> </li></ol><br><p>  Nos aseguramos de que al instalar nuestra biblioteca en el proyecto, el parche tambi√©n se aplique. </p><br><p>  Crea un proyecto: </p><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ../ rm -rf php-project mkdir php-project <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> php-project composer.phar require phpunit/phpunit <span class="hljs-string"><span class="hljs-string">'^8.4.2'</span></span></code> </pre> <br><p>  Agregue las siguientes l√≠neas a <code>composer.json</code> : </p><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"extra"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"enable-patching"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } }</code> </pre> <br><p>  Instale <code>mougrim/php-composer-patches-example</code> : </p><br><pre> <code class="bash hljs">composer.phar config repositories.mougrim/php-composer-patches-example vcs https://github.com/mougrim/php-composer-patches-example.git composer.phar require mougrim/php-composer-patches-example dev-cweagansComposerPatches</code> </pre> <br><p>  Parece que al conectar el paquete deber√≠a haber habido un intento de aplicar el parche, pero no. <br>  Actualizamos los paquetes para que se aplique el parche, pero esto no sucede: </p><br><pre> <code class="plaintext hljs">$ composer.phar update Removing package phpunit/php-code-coverage so that it can be re-installed and re-patched. - Removing phpunit/php-code-coverage (7.0.8) Loading composer repositories with package information Updating dependencies (including require-dev) Package operations: 1 install, 0 updates, 0 removals No patches supplied. Gathering patches for dependencies. This might take a minute. - Installing phpunit/php-code-coverage (7.0.8): Loading from cache - Applying patches for phpunit/php-code-coverage patches/phpunit/php-code-coverage/myFix.patch (My fix description) Could not apply patch! Skipping. The error was: The "patches/phpunit/php-code-coverage/myFix.patch" file could not be downloaded: failed to open stream: No such file or directory Writing lock file Generating autoload files</code> </pre> <br><p>  Habiendo hurgado en un rastreador de errores, descubr√≠ que los <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">parches basados ‚Äã‚Äãen archivos no se resuelven en el</a> error de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">dependencias</a> .  Resulta que debe especificar la URL antes del parche (lo que significa descargarlo desde alg√∫n lugar) o especificar la ruta del parche manualmente en cada proyecto donde instala una dependencia que requiere parches. </p><br><p>  Para resumir el uso de <code>cweagans/composer-patches</code> . </p><br><p>  Las ventajas de este enfoque: </p><br><ul><li>  el complemento tiene una comunidad; </li><li>  <code>roave/security-advisories</code> no dejar√°n de funcionar; </li><li>  cuando se lanza una nueva versi√≥n de la dependencia, si el parche se aplica con √©xito, ser√° suficiente para asegurarse de que todo funcione con la nueva versi√≥n (para lanzamientos menores, con una alta probabilidad de que funcione solo, para lanzamientos mayores tambi√©n es probable que no se haga nada); </li><li>  si hay proyectos que dependen de su biblioteca, para ellos la versi√≥n de <code>phpunit/php-code-coverage</code> no se fijar√° estrictamente; </li><li>  Adem√°s, en el caso del p√°rrafo anterior, dicho proyecto podr√° aplicar sus parches en la Cobertura de C√≥digo PHP. </li></ul><br><p>  Contras: </p><br><ul><li>  Este es un complemento para Composer, lo que significa que al actualizar Composer puede romperse; </li><li>  <code>enable-patching=true</code> debe especificarse para que los parches se apliquen desde dependencias; </li><li>  el responsable principal del proyecto no tiene mucho tiempo para tratarlo, por lo tanto, por regla general, acepta solicitudes de extracci√≥n, pero no desarrolla particularmente el proyecto (por ejemplo, ten√≠a ideas para la segunda versi√≥n en la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">tarea</a> , pero poco ha cambiado despu√©s de tres a√±os); </li><li>  hay <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">parches basados ‚Äã‚Äãen archivos que no se resuelven en el</a> error de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">dependencias</a> , lo cual es inconveniente y ha estado colgado en la cartera durante tres a√±os; </li><li>  No puede usar diferentes parches para diferentes versiones de dependencias. </li></ul><br><p>  El √∫ltimo punto se ha convertido en una barrera para m√≠.  Primero hice una <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">solicitud de funci√≥n</a> .  El responsable de mantenimiento escribi√≥ que no quer√≠a agregar esta funci√≥n al c√≥digo principal, pero en la segunda versi√≥n ser√≠a posible escribir un complemento (s√≠, un complemento para el complemento para Composer).  La perspectiva para la segunda versi√≥n era vaga, as√≠ que decid√≠ buscar alternativas.  Entre la peque√±a lista no encontr√© un complemento que ser√≠a compatible. </p><br><p>  No quer√≠a entrar en el c√≥digo del complemento, as√≠ que decid√≠ bifurcar bifurcaciones, seguro, alguien ya hab√≠a encontrado el problema y lo resolvi√≥. </p><br><h2 id="ispolzovanie-vaimo-composer-patches">  Usar parches de Vaimo Composer </h2><br><p>  En la mayor√≠a de las horquillas no hubo diferencias en absoluto con respecto a la original (¬øpor qu√© incluso se bifurcan?).  Parte de los tenedores se hicieron para solicitudes de extracci√≥n, que ya se fusionaron con la biblioteca principal.  Sin embargo, hab√≠a un candidato interesante que estaba resolviendo mi problema: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Vaimo Composer Patches</a> .  En ese momento todav√≠a estaba enmarcado como una bifurcaci√≥n, pero su responsable, al parecer, no iba a hacer solicitudes de extracci√≥n.  Entre otras cosas, por ejemplo, ya cambi√≥ el nombre del paquete a <code>vaimo/composer-patches</code> .  Pero hab√≠a un problema: los problemas estaban desactivados, es decir, no hab√≠a comentarios del autor en absoluto.  Adem√°s, el complemento no estaba alojado en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Packagist</a> . </p><br><p>  Un tenedor tan bueno no debe perderse en una pila de otros tenedores in√∫tiles.  Por lo tanto, contact√© al autor con una solicitud para habilitar problemas y agregar un paquete a Packagist.  Despu√©s de casi un mes, el autor respondi√≥ e hizo todo esto.  :) </p><br><p>  Usar <code>vaimo/composer-patches</code> no <code>vaimo/composer-patches</code> diferente de usar el complemento anterior, pero puede especificar diferentes parches para diferentes versiones. </p><br><ol><li>  <code>cweagans/composer-patches</code> nuestra biblioteca (es necesario eliminar la carpeta del <code>vendor</code> , ya que los complementos <code>cweagans/composer-patches</code> y <code>vaimo/composer-patches</code> no <code>vaimo/composer-patches</code> muy compatibles entre s√≠): <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ../php-composer-patches-example git checkout master rm -rf vendor/ composer.phar update</code> </pre> </li><li>  Realizamos los puntos 1-4 de la secci√≥n anterior. </li><li>  En nuestro proyecto conectamos <code>vaimo/composer-patches</code> : <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ../php-composer-patches-example git checkout -b vaimoComposerPatches composer.phar require vaimo/composer-patches <span class="hljs-string"><span class="hljs-string">'^4.20.2'</span></span></code> </pre> </li><li>  Para configurar <code>vaimo/composer-patches</code> agregue lo siguiente a <code>composer.json</code> (la documentaci√≥n se puede ver <a href="">aqu√≠</a> ): <br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"extra"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"patches"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"phpunit/php-code-coverage"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"My fix description"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"&lt; 7.0.0"</span></span>: <span class="hljs-string"><span class="hljs-string">"patches/phpunit/php-code-coverage/myFix-leagcy.patch"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"&gt;= 7.0.0"</span></span>: <span class="hljs-string"><span class="hljs-string">"patches/phpunit/php-code-coverage/myFix.patch"</span></span> } } } } }</code> </pre> </li><li>  Actualizar dependencias: <br><pre> <code class="bash hljs">composer.phar update</code> </pre> </li><li>  Si algo sali√≥ mal, esto se puede ver en la salida del comando anterior, pero por si acaso, puede asegurarse de que se apliquen nuestros cambios: <br><pre> <code class="plaintext hljs">$ grep example vendor/phpunit/php-code-coverage/src/CodeCoverage.php // for example some changes here</code> </pre> </li><li>  Comprometerse e impulsar el resultado: <br><pre> <code class="bash hljs">git add composer.json patches/phpunit/php-code-coverage/myFix.patch git commit --gpg-sign --message=<span class="hljs-string"><span class="hljs-string">'Use vaimo/composer-patches'</span></span> git push -u origin vaimoComposerPatches</code> </pre> </li></ol><br><p>  Nos aseguramos de que al instalar nuestra biblioteca en el proyecto, el parche tambi√©n se aplique. </p><br><p>  Cree un proyecto e instale <code>mougrim/php-composer-patches-example</code> : </p><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ../ rm -rf php-project mkdir php-project <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> php-project composer.phar require phpunit/phpunit <span class="hljs-string"><span class="hljs-string">'^8.4.2'</span></span> composer.phar config repositories.mougrim/php-composer-patches-example vcs https://github.com/mougrim/php-composer-patches-example.git composer.phar require mougrim/php-composer-patches-example dev-vaimoComposerPatches</code> </pre> <br><p>  Por si acaso, puede asegurarse de que se hayan aplicado nuestros cambios: </p><br><pre> <code class="plaintext hljs">$ grep example vendor/phpunit/php-code-coverage/src/CodeCoverage.php // for example some changes here</code> </pre> <br><p>  Para resumir el uso de <code>vaimo/composer-patches</code> . </p><br><p>  Las ventajas de este complemento son casi las mismas que las anteriores, pero tambi√©n incluyen lo siguiente: </p><br><ul><li>  el mantenedor est√° desarrollando activamente el complemento y ya ha lanzado la cuarta versi√≥n principal; </li><li>  no es necesario prescribir nada adicional para aplicar parches de dependencias; </li><li>  Puede usar diferentes parches para diferentes versiones de dependencias; </li><li>  el complemento tiene muchas configuraciones, por lo que si la funcionalidad descrita en el art√≠culo no es suficiente para usted, consulte la documentaci√≥n; tal vez la caracter√≠stica que necesita ya est√© implementada. </li></ul><br><p>  Contras: </p><br><ul><li>  como el anterior, este es un complemento para Composer, lo que significa que al actualizar Composer puede romperse; </li><li>  a diferencia del complemento anterior, esta comunidad tiene menos. </li></ul><br><h2 id="vyvody">  Conclusiones </h2><br><p>  Para resumir los resultados generales: </p><br><ul><li>  el uso de tenedores de paquetes para cualquier reparaci√≥n menor es inconveniente; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>cweagans/composer-patches</code></a> es un buen complemento, pero se desarrolla mal, por lo que no lo recomiendo; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Vaimo Composer Patches</a> es un excelente complemento que resuelve bien el problema de arreglar las dependencias, y tambi√©n tiene un mont√≥n de configuraciones; </li><li>  Vaimo Composer Patches tiene una comunidad peque√±a, pero espero que este art√≠culo la aumente; </li><li>  Si se requieren muchos cambios en la dependencia, entonces puede ser m√°s f√°cil recurrir a una bifurcaci√≥n dura (mantener la bifurcaci√≥n independiente de la dependencia original). </li></ul><br><p>  Tambi√©n hice una conclusi√≥n indirecta: si alg√∫n tipo de dependencia no proporciona la funcionalidad necesaria, entonces puede haber bifurcaciones que implementaron esta funcionalidad y a√∫n m√°s. </p><br><p>  En Badoo, usamos Vaimo Composer Patches en dos casos: </p><br><ul><li>  en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">SoftMocks</a> para parchear PHPUnit y cobertura de c√≥digo PHP; </li><li>  en el repositorio interno para el arreglo Webmozart <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Assert</a> para la compatibilidad con SoftMocks como un arreglo temporal (mientras que SoftMocks no admite construcciones <code>array_map(array('static', 'valueToString')</code> ). </li></ul><br><p>  Rinat Akhmadeev, Sr.  Desarrollador PHP </p><br><p>  <strong>UPD1</strong> : Gracias <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link">BoShurik</a> por el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">enlace</a> a los <a href="">alias</a> .  Se agreg√≥ un punto sobre alias al art√≠culo. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/473654/">https://habr.com/ru/post/473654/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../473640/index.html">Big Data Sunset</a></li>
<li><a href="../473642/index.html">Cribble Crabble Gradle: Auto-Build Magic</a></li>
<li><a href="../473646/index.html">Hackathon en una peque√±a empresa: c√≥mo organizar sin tirar un tren de recursos</a></li>
<li><a href="../473648/index.html">El caballo est√° muerto - llora: transici√≥n de tslint a eslint</a></li>
<li><a href="../473652/index.html">Crear una API REST con Node.js y una Base de datos Oracle. Parte 5</a></li>
<li><a href="../473656/index.html">Experiencia de generador de sitio est√°tico de Hugo</a></li>
<li><a href="../473658/index.html">Manejo de errores en Go 1.13</a></li>
<li><a href="../473660/index.html">Ingenier√≠a inversa de arcade: grabar Michael Jordan en NBA Jam</a></li>
<li><a href="../473664/index.html">Experiencia de aprendizaje de primera mano. Yandex.Practicum - Analista de datos</a></li>
<li><a href="../473666/index.html">Como escritor de ciencia ficci√≥n, Arthur Clark casi cierra la revista Tech - Youth</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>