<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üñ®Ô∏è üíÄ üë∞ ATmega16 + DS18B20 + LED + Matlab / Simulink = AR üë∏üèº üê≥ üéÖ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pensei em de alguma forma brincar com os sensores DS18B20 . Sim, n√£o apenas para obter os valores de temperatura (o que todos podem fazer), mas tamb√©m...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ATmega16 + DS18B20 + LED + Matlab / Simulink = AR</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/390985/"><img align="left" src="https://habrastorage.org/files/e2a/4a8/d70/e2a4a8d7092845e082baee85d185ebd2.bmp"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pensei em de alguma forma brincar com os sensores </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DS18B20</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Sim, n√£o apenas para obter os valores de temperatura (o que todos podem fazer), mas tamb√©m de alguma forma visualiz√°-los. </font><font style="vertical-align: inherit;">Havia uma ideia simples. </font><font style="vertical-align: inherit;">Colocamos a webcam. </font><font style="vertical-align: inherit;">Acendemos a luz em uma moldura regular; em uma estranha, a apagamos. </font><font style="vertical-align: inherit;">Subtraia a imagem - apenas o flash permanece. </font><font style="vertical-align: inherit;">Nele, procuramos a localiza√ß√£o do sensor, que est√° fisicamente conectado ao LED no espa√ßo. </font><font style="vertical-align: inherit;">E ent√£o processamento matem√°tico. </font><font style="vertical-align: inherit;">Bem, tudo isso em simulinka. </font><font style="vertical-align: inherit;">Sob katom, √© descrito como receber belas imagens. </font><font style="vertical-align: inherit;">E para aqueles que n√£o querem entender, sugiro olhar para os experimentos no final do artigo.</font></font><br>
<a name="habracut"></a><br>
<br clear="left">
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Circuitry</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O circuito √© extremamente simples. </font><font style="vertical-align: inherit;">O cora√ß√£o √© o ATmega16. </font><font style="vertical-align: inherit;">Todos os sensores DS18B20 ficam no mesmo pino (no meu caso, no PB0 da porta PORTB). </font><font style="vertical-align: inherit;">O pr√≥prio pino √© puxado para a tens√£o de alimenta√ß√£o atrav√©s de um resistor de 4,7 kŒ©. </font><font style="vertical-align: inherit;">O esquema √© escal√°vel. </font><font style="vertical-align: inherit;">A imagem √© clic√°vel.</font></font><br>
<br>
<a href=""><img src="https://habrastorage.org/files/1d6/87f/7dd/1d687f7ddbbc4e29858d20b4ceebcfe7.bmp"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todos os LEDs s√£o conectados √† porta PORTA atrav√©s de resistores de termina√ß√£o. </font><font style="vertical-align: inherit;">Um pol√≠gono cinza significa que esse LED est√° fisicamente conectado ao DS18B20. </font><font style="vertical-align: inherit;">O pino de redefini√ß√£o √© puxado alto atrav√©s de um resistor de 10 kŒ© para evitar redefini√ß√£o acidental devido a interfer√™ncia. </font><font style="vertical-align: inherit;">O microcontrolador tem clock de 16 MHz de quartzo. </font><font style="vertical-align: inherit;">Coloque o mais pr√≥ximo poss√≠vel das conclus√µes. </font><font style="vertical-align: inherit;">Tanques de carga s√£o usados ‚Äã‚Äãinternamente. </font><font style="vertical-align: inherit;">Configurado via fus√≠vel. </font><font style="vertical-align: inherit;">Sa√≠da separada de conectores ICP (para upload de firmware) e UART para "comunica√ß√£o". </font><font style="vertical-align: inherit;">Capacidades C1 (eletr√≥lito 10 ŒºF) e C2 (cer√¢mica 100 nF). </font><font style="vertical-align: inherit;">Coloque o mais pr√≥ximo poss√≠vel dos pinos de energia do microcontrolador. </font><font style="vertical-align: inherit;">Utilizado para evitar descargas acidentais durante a transfer√™ncia de carga.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Montagem de circuitos</font></font></b><div class="spoiler_text"><img src="https://habrastorage.org/files/20a/9b3/6fa/20a9b36fade242d9b70e10be068168ad.jpg"></div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O que √© um pol√≠gono cinza?</font></font></b><div class="spoiler_text"><img src="https://habrastorage.org/files/d61/bca/b30/d61bcab30e4041e6977ff8d55687d58a.jpg"></div></div><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Firmware + algoritmo de trabalho</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O firmware foi escrito em C no </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Atmel Studio 7</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> IDE. </font><font style="vertical-align: inherit;">As fontes s√£o postadas no </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitHub</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">O c√≥digo est√° maximamente documentado. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O projeto est√° dividido em v√°rios n√≠veis de abstra√ß√£o:</font></font><br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hardware</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - o n√≠vel mais baixo, a liga√ß√£o m√°xima ao hardware. </font><font style="vertical-align: inherit;">Trabalhe com a periferia do microcontrolador.</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Middleware</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √© o meio termo entre Hardware e Drivers. </font><font style="vertical-align: inherit;">Por exemplo, a implementa√ß√£o do protocolo 1-Wire.</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Drivers</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - n√≠vel do driver. </font><font style="vertical-align: inherit;">Por exemplo, trabalhando com o chip DS18B20.</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aplica√ß√£o</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - o n√≠vel mais alto de abstra√ß√£o. </font><font style="vertical-align: inherit;">Por exemplo, recebendo e transmitindo temperatura via UART.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Uma r√°pida olhada na fun√ß√£o principal. </font><font style="vertical-align: inherit;">Primeiro vem a tabela de endere√ßos ROM. </font><font style="vertical-align: inherit;">√â necess√°rio que o endere√ßo do sensor conectado fisicamente ao LED zero (pendurado no PA0 da porta PORTA) esteja na posi√ß√£o zero, etc. </font><font style="vertical-align: inherit;">Para obter a ROM, existe uma fun√ß√£o </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sendROMToUART</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Voc√™ s√≥ precisa lembrar que o sensor deve estar no barramento sozinho, caso contr√°rio, haver√° um conflito de endere√ßos.</font></font><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">principal</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">
</span></span>{	
	<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> ROM[][<span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(ROM_T)] = <span class="hljs-comment"><span class="hljs-comment">/* ROM array */</span></span><font></font>
	{<font></font>
		{<span class="hljs-number"><span class="hljs-number">0x26</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x04</span></span>, <span class="hljs-number"><span class="hljs-number">0x4B</span></span>, <span class="hljs-number"><span class="hljs-number">0x15</span></span>, <span class="hljs-number"><span class="hljs-number">0x89</span></span>, <span class="hljs-number"><span class="hljs-number">0x28</span></span>}, <span class="hljs-comment"><span class="hljs-comment">// 0</span></span>
		{<span class="hljs-number"><span class="hljs-number">0x71</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x04</span></span>, <span class="hljs-number"><span class="hljs-number">0x4A</span></span>, <span class="hljs-number"><span class="hljs-number">0xC0</span></span>, <span class="hljs-number"><span class="hljs-number">0x65</span></span>, <span class="hljs-number"><span class="hljs-number">0x28</span></span>}, <span class="hljs-comment"><span class="hljs-comment">// 1</span></span>
		{<span class="hljs-number"><span class="hljs-number">0xA5</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x04</span></span>, <span class="hljs-number"><span class="hljs-number">0x4A</span></span>, <span class="hljs-number"><span class="hljs-number">0xCB</span></span>, <span class="hljs-number"><span class="hljs-number">0xCE</span></span>, <span class="hljs-number"><span class="hljs-number">0x28</span></span>}, <span class="hljs-comment"><span class="hljs-comment">// 2</span></span>
		{<span class="hljs-number"><span class="hljs-number">0x41</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x04</span></span>, <span class="hljs-number"><span class="hljs-number">0x4A</span></span>, <span class="hljs-number"><span class="hljs-number">0xAC</span></span>, <span class="hljs-number"><span class="hljs-number">0x65</span></span>, <span class="hljs-number"><span class="hljs-number">0x28</span></span>}, <span class="hljs-comment"><span class="hljs-comment">// 3</span></span>
		{<span class="hljs-number"><span class="hljs-number">0x22</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x04</span></span>, <span class="hljs-number"><span class="hljs-number">0x4B</span></span>, <span class="hljs-number"><span class="hljs-number">0x06</span></span>, <span class="hljs-number"><span class="hljs-number">0x0D</span></span>, <span class="hljs-number"><span class="hljs-number">0x28</span></span>}, <span class="hljs-comment"><span class="hljs-comment">// 4</span></span>
		{<span class="hljs-number"><span class="hljs-number">0x86</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x04</span></span>, <span class="hljs-number"><span class="hljs-number">0x4A</span></span>, <span class="hljs-number"><span class="hljs-number">0xF6</span></span>, <span class="hljs-number"><span class="hljs-number">0x46</span></span>, <span class="hljs-number"><span class="hljs-number">0x28</span></span>}  <span class="hljs-comment"><span class="hljs-comment">// 5</span></span><font></font>
	};<font></font>
	<font></font>
	<span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> nDevices = <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(ROM) / <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(ROM_T); <span class="hljs-comment"><span class="hljs-comment">/* Number of DS18B20 devices */</span></span><font></font>
	<font></font>
	initUART(MYUBRR); <span class="hljs-comment"><span class="hljs-comment">/* Initialization of UART with appropriate baudrate */</span></span>
	initTimer0(); <span class="hljs-comment"><span class="hljs-comment">/* Initialization of Timer/counter0 */</span></span>
	initLED(nDevices); <span class="hljs-comment"><span class="hljs-comment">/* Initialization of LEDs */</span></span><font></font>
	<font></font>
	{ <span class="hljs-comment"><span class="hljs-comment">/* DS18B20s initialization */</span></span>
		<span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> nDevices = <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(ROM) / <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(ROM_T); <span class="hljs-comment"><span class="hljs-comment">/* Number of DS18B20 devices */</span></span>
		ROM_T *pROM = (ROM_T *)&amp;ROM; <span class="hljs-comment"><span class="hljs-comment">/* Pointer to ROM array */</span></span><font></font>
		<font></font>
		initDQ(); <span class="hljs-comment"><span class="hljs-comment">/* Initialization of DQ pin */</span></span><font></font>
		<font></font>
		<span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (nDevices--) <span class="hljs-comment"><span class="hljs-comment">/* For all DS18B20 */</span></span>
			initDS18B20(pROM++, RESOLUTION_11BIT); <span class="hljs-comment"><span class="hljs-comment">/* Initialization of DS18B20 with appropriate resolution */</span></span><font></font>
	}<font></font>
	<font></font>
	sei(); <span class="hljs-comment"><span class="hljs-comment">/* Global enable interrupts */</span></span><font></font>
	<font></font>
	<span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-comment"><span class="hljs-comment">/* Infinite loop */</span></span><font></font>
	{<font></font>
		sendTemperatureToUART((ROM_T *)&amp;ROM, nDevices); <span class="hljs-comment"><span class="hljs-comment">/* Execute function routine */</span></span><font></font>
	}<font></font>
}<font></font>
</code></pre></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A seguir, √© apresentada a inicializa√ß√£o dos perif√©ricos e do pr√≥prio DS-ok com a resolu√ß√£o apropriada. </font><font style="vertical-align: inherit;">O per√≠odo de amostragem da temperatura depende disso. </font><font style="vertical-align: inherit;">Para 11 bits, isso √© 375 ms. </font><font style="vertical-align: inherit;">Em um loop infinito, o programa l√™ continuamente a temperatura de cada sensor e a envia via UART. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O trabalho com LEDs √© baseado em interrup√ß√µes. </font><font style="vertical-align: inherit;">Pelo UART, o LED ID vem 2 vezes seguidas em um quadro par e √≠mpar. </font><font style="vertical-align: inherit;">No primeiro, o LED acende. </font><font style="vertical-align: inherit;">O temporizador apaga ap√≥s um certo tempo (no meu caso, 15 ms). </font><font style="vertical-align: inherit;">A segunda vez √© simplesmente ignorada. </font><font style="vertical-align: inherit;">O temporizador √© configurado no modo CTC para que ocorra uma interrup√ß√£o a cada 1 ms.</font></font><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c√≥digo</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">volatile</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> ledID = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* Current ledID value */</span></span>
<span class="hljs-keyword"><span class="hljs-keyword">volatile</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> ledID_prev = <span class="hljs-number"><span class="hljs-number">255</span></span>;  <span class="hljs-comment"><span class="hljs-comment">/* Previous ledID value */</span></span>
<span class="hljs-keyword"><span class="hljs-keyword">volatile</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> duration = FLASH_DURATION; <span class="hljs-comment"><span class="hljs-comment">/* Flash duration value */</span></span><font></font>
<font></font>
ISR(USART_RXC_vect) <span class="hljs-comment"><span class="hljs-comment">/* UART interrupt handler */</span></span><font></font>
{<font></font>
	ledID = UDR; <span class="hljs-comment"><span class="hljs-comment">/* Assign ledID to receive via UART value */</span></span>
	<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ledID != ledID_prev) <span class="hljs-comment"><span class="hljs-comment">/* If current ledID equal to previous value */</span></span><font></font>
	{<font></font>
		turnOnLED(ledID); <span class="hljs-comment"><span class="hljs-comment">/* Turn on the ledID LED */</span></span>
		timer0Start(); <span class="hljs-comment"><span class="hljs-comment">/* Start Timer0 */</span></span>
		ledID_prev = ledID; <span class="hljs-comment"><span class="hljs-comment">/* Previous ledID assign to current */</span></span>
		duration = FLASH_DURATION; <span class="hljs-comment"><span class="hljs-comment">/* Update LED flash duration */</span></span><font></font>
	}<font></font>
}<font></font>
<font></font>
ISR(TIMER0_COMP_vect) <span class="hljs-comment"><span class="hljs-comment">/* Timer0 compare interrupt handler */</span></span><font></font>
{<font></font>
	<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (--duration == <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-comment"><span class="hljs-comment">/* Decrement Duration value each 1ms and if it reach to 0 */</span></span><font></font>
	{<font></font>
		timer0Stop(); <span class="hljs-comment"><span class="hljs-comment">/* Stop Timer0 */</span></span>
		turnOffAllLED(); <span class="hljs-comment"><span class="hljs-comment">/* Turn off all LEDs */</span></span>
		timer0Clear(); <span class="hljs-comment"><span class="hljs-comment">/* Clear Timer0 counter register */</span></span><font></font>
	}<font></font>
}<font></font>
</code></pre></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As se√ß√µes de c√≥digo sens√≠veis ao tempo, que s√£o sinais de 1 fio, s√£o </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">agrupadas</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> em uma </font><font style="vertical-align: inherit;">constru√ß√£o </font><b><font style="vertical-align: inherit;">ATOMIC_BLOCK</font></b><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Todas as configura√ß√µes b√°sicas s√£o feitas em </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">global.h</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">O UART opera a uma velocidade de 250.000. R√°pido e sem erros para o quartzo de 16 MHz. </font><font style="vertical-align: inherit;">O driver DS18B20 possui a funcionalidade m√≠nima necess√°ria para este projeto. </font><font style="vertical-align: inherit;">O resto - veja o c√≥digo. </font><font style="vertical-align: inherit;">Haver√° perguntas - pergunte, n√£o seja t√≠mido. </font><font style="vertical-align: inherit;">Gostaria tamb√©m de lembr√°-lo sobre as configura√ß√µes dos fus√≠veis. </font><font style="vertical-align: inherit;">√â necess√°rio definir a capacidade de rel√≥gio do quartzo externo neles, caso contr√°rio, ser√° do gerador interno (e √© no m√°ximo 8 MHz e n√£o √© muito est√°vel). </font><font style="vertical-align: inherit;">Bem, programe o bit CKOPT, caso contr√°rio, o quartzo acima de 8 MHz n√£o ser√° iniciado. </font><font style="vertical-align: inherit;">Eu tenho </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fus√≠vel alto = 0xD9</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fus√≠vel baixo = 0xFF</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Modelo Simulink + algoritmo de opera√ß√£o</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vers√£o </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Matlab R2015b</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No Simulink</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , al√©m de o built-in biblioteca, usado principalmente </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Computer Vision System Toolbox</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Imagem Aquisi√ß√£o Toolbox</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">O modelo inteiro e os arquivos relacionados s√£o carregados no </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitHub</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Abaixo est√° uma descri√ß√£o detalhada com exemplos ilustrativos. </font><font style="vertical-align: inherit;">Todas as imagens s√£o clic√°veis.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M√≥dulo WebCamTemp</font></font></h2><br>
<a href=""><img align="left" src="https://habrastorage.org/files/f1d/b35/8bb/f1db358bbf3f4bb4b9b31dc3724daf27.bmp"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Os blocos amarelos indicam blocos de porta COM. Transmissor, receptor e configurador separadamente. As configura√ß√µes da porta devem corresponder exatamente √†s do microcontrolador (velocidade, paridade, n√∫mero de bits, etc.). O receptor mede a temperatura agrupando-a em uma matriz unidimensional do tamanho </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[n 1] do</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tipo </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int16</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , onde </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √© o n√∫mero de DS18B20 (eu tenho 6). Cada elemento dessa matriz √© dividido ainda mais por </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Isto √© da </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">folha de dados na</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> p√°gina 6. O transmissor envia o valor atual do contador para o </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">contador</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Apenas acende um LED espec√≠fico. Marcando de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> a </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Per√≠odo 2 amostras. </font><font style="vertical-align: inherit;">Os blocos respons√°veis ‚Äã‚Äãpor exibir / salvar o fluxo de v√≠deo est√£o agrupados em azul. </font><font style="vertical-align: inherit;">Verde - blocos para receber informa√ß√µes de v√≠deo. </font><font style="vertical-align: inherit;">Na verdade, a pr√≥pria webcam. </font><font style="vertical-align: inherit;">Existem muitas configura√ß√µes, diferentes, dependendo do fabricante. </font><font style="vertical-align: inherit;">A imagem √© exibida em tons de cinza. </font><font style="vertical-align: inherit;">T√£o interessante. </font><font style="vertical-align: inherit;">O bloco </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Diff</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> faz a diferen√ßa entre os quadros anteriores e os atuais. </font><font style="vertical-align: inherit;">O bloco </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√≠mpar Downsample</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> apenas destaca a diferen√ßa acesa - n√£o um LED aceso, mas n√£o vice-versa. </font><font style="vertical-align: inherit;">O bloco </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Downsample at√©</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pula apenas os quadros onde o LED est√° apagado.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Img diff</font></font></b><div class="spoiler_text"> ,  ‚Äî  .        (  ).    ,       .    0.25.<br>
<br>
<iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://www.youtube.com/embed/tbpDALqIc0g%3Ffeature%3Doembed&amp;usg=ALkJrhg0hRoqT3MqET49zL-5JO8eMZXE7g" frameborder="0" allowfullscreen=""></iframe><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Img cinza</font></font></b><div class="spoiler_text"> ,  ‚Äî ,     .      ,    .    .<br>
<br>
<iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://www.youtube.com/embed/ATGUUmG77eo%3Ffeature%3Doembed&amp;usg=ALkJrhgLx3ezKDQT1a9e3WlwQOd3FXFqCA" frameborder="0" allowfullscreen=""></iframe><br>
</div></div><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O Frame Rate Display</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> exibe o FPS atual. </font><font style="vertical-align: inherit;">Todo o processamento est√° nos </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LEDs</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> do bloco </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Vamos considerar o seguinte.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M√≥dulo de LEDs</font></font></h2><br>
<a href=""><img align="left" src="https://habrastorage.org/files/636/73d/92d/63673d92d053459c9c0c226edded2d13.bmp"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Violet agrupou blocos de obten√ß√£o de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gaussianos 2D</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Precisamos de dois: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Interfer√™ncia</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Opacidade</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Eles diferem em sigma. </font><font style="vertical-align: inherit;">O centro deles est√° no ponto m√°ximo (onde o LED estava aceso). </font><font style="vertical-align: inherit;">As coordenadas est√£o localizadas no bloco </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M√°ximo</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Em vez de gerar constantemente esses gaussianos (e o expoente √© uma opera√ß√£o matem√°tica muito demorada), decidiu-se elimin√°-los. </font><font style="vertical-align: inherit;">Para fazer isso, no arquivo m, dois </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Int</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Op s√£o</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> gerados </font><font style="vertical-align: inherit;">com dimens√µes 2 vezes maiores com o centro no meio, dos quais, al√©m disso, os necess√°rios s√£o simplesmente cortados com os blocos </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Interfer√™ncia de </font></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">corte</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font><b><font style="vertical-align: inherit;">Opacidade do</font></b><font style="vertical-align: inherit;"> corte </font><font style="vertical-align: inherit;">.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemplo de trabalho</font></font></b><div class="spoiler_text">  ‚Äî   .   ‚Äî         .   ‚Äî      .   ‚Äî     .     0.25.<br>
<br>
<iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://www.youtube.com/embed/wGYyoVUJ8nQ%3Ffeature%3Doembed&amp;usg=ALkJrhhM3ZHKvEt8qUJvzcwq4O_0cSMITw" frameborder="0" allowfullscreen=""></iframe><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Blocos de mem√≥ria est√£o circulados em verde. Seu objetivo √© armazenar as coordenadas e gaussianos para cada LED. Consideramos com mais detalhes abaixo. O bloco de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cores Para</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> destina </font><font style="vertical-align: inherit;">- </font><font style="vertical-align: inherit;">se a criar uma distribui√ß√£o de temperatura e um mapa de cores. Tamb√©m ser√° discutido abaixo. Sinal unidade composi√ß√£o </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Compositing</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> misturas das duas imagens </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Image1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Image2</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> da seguinte forma:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/files/84a/62d/3d6/84a62d3d604b42c5b0923eb74d8d58d4.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O bloco </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inserir texto</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> imp√µe texto formatado (neste caso, temperatura) na imagem. </font><font style="vertical-align: inherit;">Aceita </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> vari√°veis ‚Äã‚Äãe coordenadas no formato </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[XY]</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Voc√™ pode selecionar a fonte e seu tamanho. </font><font style="vertical-align: inherit;">Os blocos dentro do ret√¢ngulo vermelho implementam </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o algoritmo de m√©dia m√≥vel</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">As transi√ß√µes tornam-se menos tr√™mulas, o que preserva os nervos e agrada os olhos.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemplo</font></font></b><div class="spoiler_text"> ,  ‚Äî    8- .            (  )     .<br>
<br>
<iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://www.youtube.com/embed/Z8NgbGUZS50%3Ffeature%3Doembed&amp;usg=ALkJrhgnY-9I-m0SxM7wd33SI77J4SbZyA" frameborder="0" allowfullscreen=""></iframe><br>
</div></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M√≥dulos de mem√≥ria</font></font></h2><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A interfer√™ncia de mem√≥ria</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e a </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">opacidade da mem√≥ria</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> armazenam conjuntos Gaussianos 2D, pontos de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mem√≥ria</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - coordenadas para cada LED.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Interfer√™ncia na mem√≥ria e opacidade da mem√≥ria</font></font></b><div class="spoiler_text"><a href=""><img align="left" src="https://habrastorage.org/files/06d/f15/23e/06df1523e1d245f7b824b151f7dfa0e3.bmp"></a>   .   <b>Address</b>       .   .     .  <b>Delay</b>  <b>LEDs</b>     (  ,    ).      .  <b>Enable</b>  .   ,      (  <b>Maximum</b>  <b>Threshold</b>  <b>LEDs</b>).    ‚Äî    .       .      <b>[H W n]</b>,  <b>HxW</b> ‚Äî  -,   <b>n</b> ‚Äî  /.<br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pts de mem√≥ria</font></font></b><div class="spoiler_text"><a href=""><img align="left" src="https://habrastorage.org/files/f25/02b/441/f2502b4415bd4badad2de75142a84044.bmp"></a>     .           .   <b>Permute Matrix</b>    ,     <b>[Y X]</b>,   <b>[X Y]</b>.<br>
</div></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para colorir o m√≥dulo</font></font></h2><br>
<a href=""><img align="left" src="https://habrastorage.org/files/ff4/661/f73/ff4661f7313342bc87aab6257d405ee9.bmp"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Verde - Processamento de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">opacidade</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Resuma a matriz de entrada na terceira dimens√£o. N√≥s normalizamos ao m√°ximo. Multiplique pelo valor do </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ganho</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (de 0 a 1) </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(1)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . No total, temos uma matriz com Gaussianos sobrepostos e um </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ganho</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> m√°ximo </font><font style="vertical-align: inherit;">. Usado como um </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fator</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para misturar imagens. Vermelho - recebendo um mapa colorido de temperaturas. Aqui um pouco de matem√°tica diferente, todos os mesmos gaussianos. √â descrito pela f√≥rmula </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(2)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Grosso modo, a temperatura em um ponto arbitr√°rio √© a m√©dia ponderada de todos os sensores. Mas a influ√™ncia de cada sensor em uma propor√ß√£o percentual √© proporcional ao valor do Gaussiano nele. A soma de tudo √© tomada como 100%.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/files/87a/e2d/4a3/87ae2d4a31ba4759bb9cf4d093fff846.gif"></div><br>
<a href=""><img align="left" src="https://habrastorage.org/files/c51/f48/e29/c51f48e29b614eb28a0134f517ee49e8.bmp"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Resta considerar como a distribui√ß√£o de temperatura se transforma em um mapa de cores. </font><font style="vertical-align: inherit;">O que √© circulado em azul transforma a temperatura espec√≠fica em um valor entre 0 e 1. Na zona vermelha, o bloco de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pr√©</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font><b><font style="vertical-align: inherit;">configura√ß√£o</font></b><font style="vertical-align: inherit;"> calcula o √≠ndice pelo qual o valor de vermelho, verde e azul √© pesquisado. </font><font style="vertical-align: inherit;">A matriz de cores cont√©m 64 valores. </font><font style="vertical-align: inherit;">Os intermedi√°rios s√£o calculados por interpola√ß√£o. </font><font style="vertical-align: inherit;">Dos recursos, existem dois modos: relativo e absoluto. </font><font style="vertical-align: inherit;">No local mais frio e mais quente relativo, o m√≠nimo e o m√°ximo da matriz de entrada correspondem. </font><font style="vertical-align: inherit;">Em absoluto, existem alguns valores constantes. </font><font style="vertical-align: inherit;">No primeiro, √© mais conveniente olhar para o perfil de distribui√ß√£o de temperatura. </font><font style="vertical-align: inherit;">No outro, suas mudan√ßas absolutas.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">arquivo m</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√â executado no in√≠cio, antes da simula√ß√£o, introduzindo vari√°veis ‚Äã‚Äãno Espa√ßo de Trabalho.</font></font><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c√≥digo</font></font></b><div class="spoiler_text"><pre><code class="matlab hljs">H = <span class="hljs-number"><span class="hljs-number">480</span></span>; <span class="hljs-comment"><span class="hljs-comment">% Height of image</span></span>
W = <span class="hljs-number"><span class="hljs-number">640</span></span>; <span class="hljs-comment"><span class="hljs-comment">% Width of image</span></span>
minT = <span class="hljs-number"><span class="hljs-number">20</span></span>; <span class="hljs-comment"><span class="hljs-comment">% Min temperature</span></span>
maxT = <span class="hljs-number"><span class="hljs-number">25</span></span>; <span class="hljs-comment"><span class="hljs-comment">% Max temperature</span></span>
sigmaInt = <span class="hljs-number"><span class="hljs-number">40</span></span>; <span class="hljs-comment"><span class="hljs-comment">% Sigma interference</span></span>
sigmaOp = <span class="hljs-number"><span class="hljs-number">80</span></span>; <span class="hljs-comment"><span class="hljs-comment">% Sigma opacity</span></span>
gain = <span class="hljs-number"><span class="hljs-number">1.0</span></span>; <span class="hljs-comment"><span class="hljs-comment">% Gain value</span></span>
T = <span class="hljs-number"><span class="hljs-number">0.3</span></span>; <span class="hljs-comment"><span class="hljs-comment">% Threshold value</span></span>
nAvr = <span class="hljs-number"><span class="hljs-number">8</span></span>; <span class="hljs-comment"><span class="hljs-comment">% number of means</span></span>
<span class="hljs-comment"><span class="hljs-comment">% ------------------------------------------------------</span></span>
[M,N] = <span class="hljs-built_in"><span class="hljs-built_in">meshgrid</span></span>(-W:W, -H:H); <span class="hljs-comment"><span class="hljs-comment">% Meshgrid function</span></span><font></font>
<font></font>
R = <span class="hljs-built_in"><span class="hljs-built_in">sqrt</span></span>(M.^<span class="hljs-number"><span class="hljs-number">2</span></span> + N.^<span class="hljs-number"><span class="hljs-number">2</span></span>); <span class="hljs-comment"><span class="hljs-comment">% Distance from the center</span></span><font></font>
<font></font>
Int = normpdf(R, <span class="hljs-number"><span class="hljs-number">0</span></span>, sigmaInt); <span class="hljs-comment"><span class="hljs-comment">% 2D gaussian for interference</span></span>
Op = normpdf(R, <span class="hljs-number"><span class="hljs-number">0</span></span>, sigmaOp); <span class="hljs-comment"><span class="hljs-comment">% 2D gaussian for opacity</span></span><font></font>
<font></font>
Int = Int/<span class="hljs-built_in"><span class="hljs-built_in">max</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">max</span></span>(Int)); <span class="hljs-comment"><span class="hljs-comment">% Normalization of interference gaussian</span></span>
Op = Op/<span class="hljs-built_in"><span class="hljs-built_in">max</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">max</span></span>(Op)); <span class="hljs-comment"><span class="hljs-comment">% Normalization of opacity gaussian</span></span><font></font>
<font></font>
clear M N R sigmaInt sigmaOp <span class="hljs-comment"><span class="hljs-comment">% Delete unused variables from memory</span></span><font></font>
<font></font>
load(<span class="hljs-string"><span class="hljs-string">'MyColormaps'</span></span>,<span class="hljs-string"><span class="hljs-string">'mycmap'</span></span>); <span class="hljs-comment"><span class="hljs-comment">% Load colormap</span></span>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cont√©m as principais vari√°veis ‚Äã‚Äãde controle entre as quais:</font></font><br>
<ul>
<li><b>H</b> ‚Äî    .</li>
<li><b>W</b> ‚Äî    .</li>
<li><b>minT</b> ‚Äî   .</li>
<li><b>maxT</b> ‚Äî   .</li>
<li><b>sigmaInt</b> ‚Äî   Interference.</li>
<li><b>sigmaOp</b> ‚Äî   Opacity.</li>
<li><b>gain</b> ‚Äî   Factor.</li>
<li><b>T</b> ‚Äî    .</li>
<li><b>nAvr</b> ‚Äî     .</li>
</ul><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">H</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">W</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> devem corresponder √† corrente no bloco WebCamera. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">minT</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">maxT</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> afetam o mapa de cores no modo de temperatura absoluta. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">T est√°</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> definido de 0 a 1. √Äs vezes, a porta COM e a webcam est√£o fora de sincronia. </font><font style="vertical-align: inherit;">A fase da imagem diferencial pode mudar em 180 ¬∞. </font><font style="vertical-align: inherit;">E onde deveria haver um m√°ximo - h√° um m√≠nimo. </font><font style="vertical-align: inherit;">E o sistema pode escolher uma coordenada arbitr√°ria que n√£o corresponde √† realidade. </font><font style="vertical-align: inherit;">Para isso, existe um sistema de limites. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nAvr √© o</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> n√∫mero de m√©dias na m√©dia m√≥vel. </font><font style="vertical-align: inherit;">Quanto maior, mais suaves s√£o as transi√ß√µes, mas a relev√¢ncia √© perdida (uma mudan√ßa de tempo aparece). </font><font style="vertical-align: inherit;">Para entender o efeito das demais vari√°veis, n√£o se pode entender sem exemplos ilustrativos.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Efeito SigmaInt</font></font></b><div class="spoiler_text"> <img src="https://habrastorage.org/files/dd4/52e/fa0/dd452efa07f74879864a7da50c880f39.gif">      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> </a>.  <img src="https://habrastorage.org/files/5de/994/dd0/5de994dd0e834600b8fff948ae13eb07.gif">       ,   , .   ‚Äî    .<br>
<br>
<iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://www.youtube.com/embed/cZV_ayNrWgE%3Ffeature%3Doembed&amp;usg=ALkJrhj4DQVpGa6G-Oi3cSYm4C1SJ73tPw" frameborder="0" allowfullscreen=""></iframe><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Efeito SigmaOp</font></font></b><div class="spoiler_text">     .<br>
<br>
<iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://www.youtube.com/embed/S8R4A9AKFZU%3Ffeature%3Doembed&amp;usg=ALkJrhhtOBOyAidam3qGdZ-vJYDeZIhGVA" frameborder="0" allowfullscreen=""></iframe><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Efeito de ganho</font></font></b><div class="spoiler_text">-   .    ¬´¬ª  ¬´ ¬ª  .<br>
<br>
<iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://www.youtube.com/embed/mvKfUSIw3rI%3Ffeature%3Doembed&amp;usg=ALkJrhhfFXNOn2JxaaeNOIDNZL2s7W6cJw" frameborder="0" allowfullscreen=""></iframe><br>
</div></div><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Os experimentos</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Abaixo est√£o alguns experimentos.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Janela aberta</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os sensores est√£o espalhados na cama pela janela. </font><font style="vertical-align: inherit;">A janela abre e fecha depois de um tempo. </font><font style="vertical-align: inherit;">Um bom exemplo da diferen√ßa entre os modos relativo (esquerdo) e absoluto (direito). </font><font style="vertical-align: inherit;">Usando o primeiro, √© conveniente considerar a distribui√ß√£o, e o segundo, como o frio √© distribu√≠do ou o calor √© restaurado.</font></font><br>
<br>
<iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://www.youtube.com/embed/AlDT9XyCSeo%3Ffeature%3Doembed&amp;usg=ALkJrhi8EYo1c7T5jIG2tBVjeZPswHPhgA" frameborder="0" allowfullscreen=""></iframe><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peitoril da janela</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os sensores est√£o localizados ao longo do peitoril da janela. </font><font style="vertical-align: inherit;">A janela √© aberta - o perfil muda. </font><font style="vertical-align: inherit;">As zonas mais frias e mais quentes s√£o claramente vis√≠veis.</font></font><br>
<br>
<iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://www.youtube.com/embed/OX8_0pjPLZg%3Ffeature%3Doembed&amp;usg=ALkJrhjsPdbojvXhAadtR0BlubA4N4YnUQ" frameborder="0" allowfullscreen=""></iframe><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Est√° mais quente no topo?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eles dizem que o topo √© mais quente. </font><font style="vertical-align: inherit;">Este experimento √© uma confirma√ß√£o completa disso. </font><font style="vertical-align: inherit;">No d√©cimo segundo, a janela se abre, no dia 30 - fecha.</font></font><br>
<br>
<iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://www.youtube.com/embed/pUDan07bd-E%3Ffeature%3Doembed&amp;usg=ALkJrhjWAToFMyjlB7czaWirB3GXS2XzZw" frameborder="0" allowfullscreen=""></iframe><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclus√£o</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esse esquema n√£o substituir√° um termovisor completo. </font><font style="vertical-align: inherit;">Mas ele n√£o √© capaz de ver a propaga√ß√£o de massas de ar. </font><font style="vertical-align: inherit;">E por um pre√ßo esse design √© incomparavelmente mais baixo. </font><font style="vertical-align: inherit;">Voc√™ pode usar um mapa de cores diferente nele. </font><font style="vertical-align: inherit;">Voc√™ pode assumir outras fun√ß√µes em vez de gaussianas. </font><font style="vertical-align: inherit;">Voc√™ pode at√© mudar as leis da constru√ß√£o. </font><font style="vertical-align: inherit;">Ou reescreva no OpenCV + QT para velocidade e conveni√™ncia. </font><font style="vertical-align: inherit;">Mas √© isso que eu concebi - eu consegui. </font><font style="vertical-align: inherit;">Apenas </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">por divers√£o</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt390985/">https://habr.com/ru/post/pt390985/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt390975/index.html">Previs√µes para 2016: tr√™s grandes tend√™ncias na ind√∫stria de semicondutores</a></li>
<li><a href="../pt390977/index.html">Not√≠cias da Sony no MWC 2016: Xperia X, Xperia X Performance e Xperia XA</a></li>
<li><a href="../pt390979/index.html">Lenovo Ideacentre Stick 300: Pequeno Sim</a></li>
<li><a href="../pt390981/index.html">Como Motorika faz dentaduras para crian√ßas</a></li>
<li><a href="../pt390983/index.html">Lobos e ovelhas, zumbis e armadilhas para lagostas: um breve dicion√°rio de g√≠rias conservadas em estoque</a></li>
<li><a href="../pt390987/index.html">A Sony comprou um v√≠deo de um artista russo e o bloqueou no YouTube (novamente)</a></li>
<li><a href="../pt390989/index.html">Telefone Modular Fairphone 2 Agora Dispon√≠vel</a></li>
<li><a href="../pt390993/index.html">–ì–ª–∞–∑ –±–∞–±–æ—á–∫–∏ —Å—Ç–∞–ª –º–æ–¥–µ–ª—å—é –¥–ª—è –≥—Ä–∞—Ñ–µ–Ω–æ–≤—ã—Ö —Ä–µ–∫—Ç–µ–Ω–Ω —Å —Ä–µ–∫–æ—Ä–¥–Ω–æ–π —Å–≤–µ—Ç–æ–ø–æ–≥–ª–æ—â–∞–µ–º–æ—Å—Ç—å—é</a></li>
<li><a href="../pt390995/index.html">MasterCard prepara op√ß√µes de verifica√ß√£o do cliente usando selfies, tons de voz e freq√º√™ncia card√≠aca</a></li>
<li><a href="../pt390997/index.html">9 drones que n√£o precisam de registro</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>