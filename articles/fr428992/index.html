<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🍄 👨🏻‍🎤 🛳️ Contournement sélectif des verrous sur les routeurs avec le firmware Padavan et Keenetic OS 🤓 👨🏾‍🎓 😾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Un grand nombre d'instructions ont été publiées avec diverses options pour contourner le blocage des ressources Internet. Mais le sujet ne perd pas de...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Contournement sélectif des verrous sur les routeurs avec le firmware Padavan et Keenetic OS</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/428992/"> Un grand nombre d'instructions ont été publiées avec diverses options pour contourner le blocage des ressources Internet.  Mais le sujet ne perd pas de sa pertinence.  Plus souvent encore, des initiatives sont entendues au niveau législatif pour bloquer les articles sur les méthodes de contournement des serrures.  Et il y avait des rumeurs selon lesquelles Roskomnadzor recevrait un autre paquet d'argent des contribuables pour de "meilleures" serrures.  Les utilisateurs expérimentés n'apprendront rien de nouveau ou d'utile de l'article.  Mais d'autres recevront des instructions étape par étape prédéfinies pour un contournement sélectif simple et efficace des verrous sur les routeurs populaires avec le firmware Padavan et Keenetic. <br><br><img src="https://habrastorage.org/webt/is/kb/td/iskbtdxuaisqiyg3r4tsrjhj6aw.jpeg"><br><a name="habracut"></a><br><h1>  Table des matières </h1><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Présentation</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Comment allez-vous réussir à contourner les verrous après la configuration?</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Principe de fonctionnement</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Configuration d'un routeur Padavan</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Configuration d'un routeur avec Keenetic OS</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Méthodes de base pour diagnostiquer les erreurs après la configuration</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Contournement supplémentaire pour filtrer les requêtes DNS par le fournisseur</a> </li></ul><br><a name="con1"></a><h1>  Présentation </h1><br>  J'ai utilisé l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">option de contournement de verrouillage</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Zolg</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">pendant</a> environ deux ans.  De nombreuses instructions sur le réseau sont basées sur celui-ci.  Le mien inclus. <br><br>  Tout était bien, mais "le meilleur est toujours l'ennemi du bien".  Premièrement, certains nouveaux programmes sont devenus trop «intelligents» et résoudront les domaines en utilisant leurs propres méthodes, contournant le serveur DNS du routeur.  Cela ne permet pas à dnsmasq sur le routeur d'ajouter l'adresse à l'ensemble ipset pour le déverrouillage et conduit à un résultat logique - la ressource reste verrouillée.  Dans Android 9, prise en charge native de DNS sur TLS, c'est-à-dire  cette méthode de contournement du verrou cesse de fonctionner (si l'autre périphérique n'a pas accédé à dnsmasq auparavant).  Deuxièmement, la mise à jour de la liste complète des domaines depuis antizapret conduit à des résultats imprévisibles à chaque fois.  La liste peut inclure des domaines qui ne sont pas vraiment bloqués et dont le fonctionnement est important via le canal principal.  Vous devez être constamment en alerte et modifier les fichiers générés avec vos mains.  Troisièmement, je suis fatigué de "traîner" une énorme liste de domaines avec des dizaines de milliers de casinos et autres, qui ne sont tout simplement pas nécessaires.  Au fil du temps, j'ai réalisé que je n'avais besoin que d'une petite liste spécifique de ressources bloquées. <br><br>  Donc, depuis un an, j'utilise une méthode de déverrouillage légèrement modifiée, dont je suis entièrement satisfait: <br><br><ul><li>  Simplicité et facilité de contrôle (après configuration). </li><li>  Contrôle total sur les ressources dont vous avez besoin pour débloquer. </li><li>  Configuration minimale requise pour les ressources processeur et la RAM du routeur. </li><li>  Large couverture des nuances lors du contournement des verrous. </li></ul><br>  Il est important de noter que mon option n'est pas destinée au cas où vous devez déverrouiller des centaines et des milliers de domaines.  Parce que lorsque le routeur démarre, chaque domaine de la liste donnée est résolu.  Plus il y a de domaines dans la liste, plus l'initialisation de nombreux ipsets à débloquer est longue. <br><br>  La base pour contourner les verrous est la même - le réseau Tor.  Son utilisation est due à deux facteurs simples - gratuits, et la probabilité que Tor soit bloqué en Russie est proche de zéro, contrairement à tout service VPN.  Tor est le fondement du trafic de drogue en Russie du milieu vers le bas.  Le verrouillage de Tor conduira à la recherche de nouveaux outils pour le marché et à une diminution de l'anonymat, ce qui entraînera l'activation réussie du travail des services répressifs locaux.  En fin de compte, cela, comme un virus, commencera à affecter négativement le lien supérieur.  Compte tenu des dernières nouvelles étonnantes sur la relation des hauts responsables du gouvernement avec le trafic mondial de drogue en Russie, le blocage de Tor en Russie n'est qu'un tabou, bien qu'il soit trivial.  Ni Roskomnadzor, quel que soit le nombre de milliards alloués à cette agence, aucun tribunal russe n'a la permission d'en haut pour bloquer Tor.  Et cela ne surprend même personne et n'effraie personne, même si la Russie se noie simplement dans la drogue (tout écolier sait ce que ça va faire, et après 30 minutes, il est en fait possible dans n'importe quelle ville de 10 000 habitants de se procurer librement des drogues pratiquement en toute quantité - une si mauvaise vérité de la vie).  Dans le mode actuel, la probabilité de bloquer le réseau Tor est inférieure à la probabilité de bloquer le site du musée de l'Ermitage. <br><br>  Les instructions données sont faciles à adapter pour les routeurs avec OpenWrt.  De plus, de petits changements facilitent le remplacement de Tor par OpenVPN. <br><br><a name="con11"></a><h1>  Comment allez-vous réussir à contourner les verrous après la configuration? </h1><br>  Tout est très simple.  Vous avez le fichier /opt/etc/unblock.txt - une liste simple à déverrouiller.  Vous pouvez déverrouiller un domaine, une adresse IP, une plage d'adresses ou un CIDR.  Une ligne - un élément.  Les lignes vides sont autorisées et vous pouvez utiliser le caractère # au début de la ligne pour ignorer. <br><br><div class="spoiler">  <b class="spoiler_title">Voici un exemple de mon dossier personnel</b> <div class="spoiler_text"><pre><code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">###- rutracker.org rutor.info rutor.is mega-tor.org kinozal.tv nnm-club.me nnm-club.ws tfile.me tfile-home.org tfile1.cc megatfile.cc megapeer.org megapeer.ru tapochek.net tparser.org tparser.me rustorka.com uniongang.tv fast-torrent.ru ###    rezka.ag hdrezka.ag hdrezka.me filmix.co filmix.cc seasonvar.ru ### lib.rus.ec flibusta.is flibs.me flisland.net flibusta.site ### telegram.org tdesktop.com tdesktop.org tdesktop.info tdesktop.net telesco.pe telegram.dog telegram.me t.me telegra.ph web.telegram.org desktop.telegram.org updates.tdesktop.com venus.web.telegram.org flora.web.telegram.org vesta.web.telegram.org pluto.web.telegram.org aurora.web.telegram.org 149.154.160.0/20 91.108.4.0/22 91.108.8.0/22 91.108.12.0/22 91.108.16.0/22 91.108.56.0/22 109.239.140.0/24 67.198.55.0/24 ### 7-zip.org edem.tv 4pna.com 2019.vote ### Tor check.torproject.org ###   IP ( #   ) #195.82.146.214 ###   CIDR ( #   ) #103.21.244.0/22 ###    ( #   ) #100.100.100.200-100.100.100.210</span></span></code> </pre> <br></div></div><br>  Après avoir édité ce fichier, vous exécutez simplement la commande pour appliquer la nouvelle configuration: <br><br><pre> <code class="bash hljs">unblock_update.sh</code> </pre> <br>  Toutes les ressources de unblock.txt sont déverrouillées sans avoir à redémarrer le routeur. <br><br><a name="con12"></a><h1>  Principe de fonctionnement </h1><br><ul><li>  L'initialisation du routeur crée un ensemble vide d'adresses IP ipset appelé débloquer. </li><li>  Une règle pour rediriger tous les paquets avec des destinations de déblocage vers le service Tor est ajoutée au pare-feu. </li><li>  Le service Tor démarre en mode proxy transparent. </li><li>  Le script spécial unblock_ipset.sh est lancé, qui résout tous les domaines de unblock.txt et ajoute leurs adresses IP à l'ensemble de déblocage.  Les adresses IP, les plages et les CIDR de ce fichier sont également ajoutés pour débloquer. </li><li>  Dnsmasq est lancé avec un fichier de configuration supplémentaire, unblock.dnsmasq, qui indique l'ajout d'adresses IP de domaine de unblock.txt à l'ensemble de déblocage lors de la résolution. </li><li>  cron exécute unblock_ipset.sh avec une certaine fréquence pour compenser partiellement les éventuels cas avec des nuances. </li><li>  Si nécessaire, tous les domaines de unblock.txt (et seulement eux) se résolvent via dnscrypt-proxy si le fournisseur filtre le DNS. </li></ul><br><a name="con2"></a><h1>  Configuration d'un routeur Padavan </h1><br>  Vous devez avoir un routeur avec le firmware Padavan installé et un gestionnaire de packages Entware déjà configuré.  Sous Windows, vous pouvez utiliser le client <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">PuTTY</a> pour vous connecter au routeur via SSH. <br><br>  Assurez-vous que vous utilisez Entware, pas l'ancien Entware-ng.  Affichez le contenu du dossier / opt / var / opkg-lists.  Il y aura un fichier entware ou entware-ng.  Dans le second cas, vous devez mettre à jour le firmware Padavan de votre routeur vers la dernière version et réinstaller le gestionnaire de packages Entware.  Ensuite, continuez avec les instructions étape par étape. <br><br>  Comme l'ont montré les critiques, des problèmes surviennent principalement pour ceux qui ont configuré Entware incorrectement au départ (c'est-à-dire que les scripts d'init.d ne sont pas chargés) dans la mémoire interne du routeur.  Si vous avez Xiaomi Mi Router 3 ou 3G, et que vous n'êtes pas sûr que Entware dans votre mémoire interne fonctionne correctement (démarrage automatique), alors réinstallez tout.  Prenez PROMETHEUS.  Met à jour le script (1).  Mettez à jour le code source (2).  Récupérez et flashez le firmware le plus récent (4).  Réinitialiser les paramètres du firmware (NVRAM et stockage de fichiers) - Avancé&gt; Administration&gt; Paramètres.  Configurez l'accès Internet sur le routeur et activez SSH.  Effectuez dans PROMETHEUS Firmware&gt; Formatage RWFS.  Choisissez Avancé&gt; Administration&gt; Paramètres&gt; Monter le système de fichiers dans la section R / W&gt; UBIFS.  Redémarrez le routeur.  Tous les scripts de démarrage Entware actuels de la mémoire interne seront enregistrés automatiquement et tout fonctionnera comme une horloge. <br><br>  Pour les tests, j'ai utilisé le populaire Xiaomi Mi Router 3G (Entware est installé dans la mémoire interne) avec le dernier firmware - 32a93db.  Tout fonctionnera même sur le légendaire bébé WT3020 AD / F / H pour 10 $. <br><br><img src="https://habrastorage.org/webt/th/kf/2k/thkf2kvtt2rhtnbxvmx0qri7dsk.jpeg"><br><br><h3>  1. Installation du logiciel nécessaire sur le routeur </h3><br><pre> <code class="bash hljs">opkg update opkg install mc tor tor-geoip <span class="hljs-built_in"><span class="hljs-built_in">bind</span></span>-dig cron</code> </pre> <br>  <b>mc</b> - Gestionnaire de fichiers Midnight Commander.  Il n'est nécessaire qu'en raison de l'éditeur mcedit pratique.  Si vous avez l'habitude d'utiliser un autre éditeur de texte, alors mc ne peut pas être installé. <br>  <b>tor</b> - Service Tor. <br>  <b>tor-geoip</b> - base de données géo-IP pour Tor. <br>  <b>bind-dig</b> - client DNS (analogue de nslookup et hôte). <br>  <b>cron</b> - planificateur de tâches. <br><cut></cut><br><h3>  2. Initialisez l'ipset, créez plusieurs adresses IP de déblocage (start_script.sh) </h3><br>  Connectez les modules nécessaires et créez un ensemble d'adresses vide avec le nom <b>débloquer au</b> démarrage du routeur.  Pour ce faire, ouvrez le fichier <b>/etc/storage/start_script.sh</b> dans l'éditeur: <br><br><pre> <code class="bash hljs">mcedit /etc/storage/start_script.sh</code> </pre> <br>  Ajouter à la fin: <br><br><pre> <code class="bash hljs">modprobe ip_set modprobe ip_set_hash_ip modprobe ip_set_hash_net modprobe ip_set_bitmap_ip modprobe ip_set_list_set modprobe xt_set ipset create unblock <span class="hljs-built_in"><span class="hljs-built_in">hash</span></span>:net</code> </pre> <br>  Pour coller à partir du tampon, utilisez Shift + Insert, enregistrez - F2, quittez - F10. <br><br><img src="https://habrastorage.org/webt/tr/zp/cq/trzpcqqnadbonhsb0x3ebe7ltpo.png"><br><br>  Si vous le souhaitez, vous pouvez modifier le fichier start_script.sh via l'interface Web du routeur - "Avancé"&gt; "Personnalisation"&gt; "Scripts"&gt; "Exécuter avant d'initialiser le routeur".  Après la modification, cliquez sur "Appliquer". <br><br><img src="https://habrastorage.org/webt/yr/aa/8q/yraa8qgcfwu-vesrp3wvvne2vui.png"><br><br><h3>  3. Configuration de Tor </h3><br>  Supprimez le contenu du fichier de configuration Tor: <br><br><pre> <code class="bash hljs">cat /dev/null &gt; /opt/etc/tor/torrc</code> </pre> <br>  Ouvrez le fichier de configuration Tor: <br><br><pre> <code class="bash hljs">mcedit /opt/etc/tor/torrc</code> </pre> <br>  Collez (Maj + Insérer) le contenu: <br><br><pre> <code class="bash hljs">User admin PidFile /opt/var/run/tor.pid ExcludeExitNodes {RU},{UA},{AM},{KG},{BY} StrictNodes 1 TransPort 192.168.0.1:9141 ExitRelay 0 ExitPolicy reject *:* ExitPolicy reject6 *:* GeoIPFile /opt/share/tor/geoip GeoIPv6File /opt/share/tor/geoip6 DataDirectory /opt/var/lib/tor</code> </pre> <br>  Si nécessaire, remplacez <b>192.168.0.1</b> par l'adresse interne de votre routeur (LAN).  Brève description de la configuration: <br><br><ul><li>  Exclure les nœuds de sortie: Russie, Ukraine, Arménie Kirghizistan, Bélarus. </li><li>  Accrochez un proxy transparent à l'adresse 192.168.0.1, port 9141. </li><li>  Refuser d'être un point de sortie. </li></ul><br><h3>  4. La liste des domaines (et pas seulement) pour contourner le verrou (unblock.txt) </h3><br>  unblock.txt est une liste simple à déverrouiller.  Vous pouvez déverrouiller un domaine, une adresse IP, une plage ou un CIDR.  Une ligne - un élément.  Les lignes vides (y compris les espaces et les tabulations) sont ignorées.  Vous pouvez utiliser le caractère # au début d'une ligne pour l'ignorer. <br><br>  Créez le fichier <b>/opt/etc/unblock.txt</b> : <br><br><pre> <code class="bash hljs">mcedit /opt/etc/unblock.txt</code> </pre> <br>  Chaque ligne peut contenir un nom de domaine, une adresse IP, une plage ou un CIDR.  Vous pouvez utiliser le caractère # pour commenter les lignes. <br><br><div class="spoiler">  <b class="spoiler_title">Voici un exemple de mon dossier personnel</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">###- rutracker.org rutor.info rutor.is mega-tor.org kinozal.tv nnm-club.me nnm-club.ws tfile.me tfile-home.org tfile1.cc megatfile.cc megapeer.org megapeer.ru tapochek.net tparser.org tparser.me rustorka.com uniongang.tv fast-torrent.ru ###    rezka.ag hdrezka.ag hdrezka.me filmix.co filmix.cc seasonvar.ru ### lib.rus.ec flibusta.is flibs.me flisland.net flibusta.site ### telegram.org tdesktop.com tdesktop.org tdesktop.info tdesktop.net telesco.pe telegram.dog telegram.me t.me telegra.ph web.telegram.org desktop.telegram.org updates.tdesktop.com venus.web.telegram.org flora.web.telegram.org vesta.web.telegram.org pluto.web.telegram.org aurora.web.telegram.org 149.154.160.0/20 91.108.4.0/22 91.108.8.0/22 91.108.12.0/22 91.108.16.0/22 91.108.56.0/22 109.239.140.0/24 67.198.55.0/24 ### 7-zip.org edem.tv 4pna.com 2019.vote ### Tor check.torproject.org ###   IP ( #   ) #195.82.146.214 ###   CIDR ( #   ) #103.21.244.0/22 ###    ( #   ) #100.100.100.200-100.100.100.210</span></span></code> </pre> <br></div></div><br><h3>  5. Un script pour remplir un ensemble d'adresses IP de déblocage d'une liste donnée de domaines (unblock_ipset.sh) </h3><br>  Créez le script <b>/opt/bin/unblock_ipset.sh</b> : <br><br><pre> <code class="bash hljs">mcedit /opt/bin/unblock_ipset.sh</code> </pre> <br>  Collez (Maj + Insérer) le contenu: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh until ADDRS=$(dig +short google.com @localhost) &amp;&amp; [ -n "$ADDRS" ] &gt; /dev/null 2&gt;&amp;1; do sleep 5; done while read line || [ -n "$line" ]; do [ -z "$line" ] &amp;&amp; continue [ "${line:0:1}" = "#" ] &amp;&amp; continue cidr=$(echo $line | grep -Eo '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}/[0-9]{1,2}') if [ ! -z "$cidr" ]; then ipset -exist add unblock $cidr continue fi range=$(echo $line | grep -Eo '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}-[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}') if [ ! -z "$range" ]; then ipset -exist add unblock $range continue fi addr=$(echo $line | grep -Eo '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}') if [ ! -z "$addr" ]; then ipset -exist add unblock $addr continue fi dig +short $line @localhost | grep -Eo '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}' | awk '{system("ipset -exist add unblock "$1)}' done &lt; /opt/etc/unblock.txt</span></span></code> </pre> <br>  Donner des droits d'exécution: <br><br><pre> <code class="bash hljs">chmod +x /opt/bin/unblock_ipset.sh</code> </pre> <br>  Le script est assez simple, c'est l'essence même de son travail ... Nous attendons que la résolution du domaine google.com fonctionne (si ce n'est pas fait, beaucoup de déblocages ne seront pas effectués au démarrage du routeur, car le routeur sera toujours en cours d'initialisation).  Nous lisons les lignes du fichier unblock.txt.  Les lignes de lecture suppriment automatiquement les espaces et les tabulations au début et à la fin.  Évitez les lignes vides.  Ignorez les lignes commençant par le caractère #.  Nous cherchons dans la ligne CIDR.  Si CIDR est trouvé, ajoutez-le pour débloquer.  Nous recherchons une gamme dans la chaîne.  S'il est trouvé, ajoutez-le pour débloquer.  Nous recherchons l'adresse IP dans la chaîne.  Si l'IP est trouvée, ajoutez-la pour débloquer.  Résolvons une ligne en creusant.  Toutes les adresses IP du résultat sont ajoutées au déblocage. <br><br><h3>  6. Un script pour générer un fichier de configuration dnsmasq supplémentaire à partir d'une liste donnée de domaines (unblock_dnsmasq.sh) </h3><br>  Créez le script <b>/opt/bin/unblock_dnsmasq.sh</b> : <br><br><pre> <code class="bash hljs">mcedit /opt/bin/unblock_dnsmasq.sh</code> </pre> <br>  Collez (Maj + Insérer) le contenu: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh cat /dev/null &gt; /opt/etc/unblock.dnsmasq while read line || [ -n "$line" ]; do [ -z "$line" ] &amp;&amp; continue [ "${line:0:1}" = "#" ] &amp;&amp; continue echo $line | grep -Eq '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}' &amp;&amp; continue echo "ipset=/$line/unblock" &gt;&gt; /opt/etc/unblock.dnsmasq done &lt; /opt/etc/unblock.txt</span></span></code> </pre> <br>  Donner des droits d'exécution: <br><br><pre> <code class="bash hljs">chmod +x /opt/bin/unblock_dnsmasq.sh</code> </pre> <br>  Le script est assez simple, c'est l'essence de son travail ... Nous lisons séquentiellement les lignes de /opt/etc/unblock.txt.  Les lignes de lecture suppriment automatiquement les espaces et les tabulations au début et à la fin.  Évitez les lignes vides.  Évitez les lignes qui commencent par #.  Nous sautons les lignes qui contiennent l'adresse IP (IP, plage, CIDR), c'est-à-dire  nous ne sommes intéressés que par les chaînes avec des noms de domaine.  Dans le fichier /opt/etc/unblock.dnsmasq nous ajoutons des lignes de la forme "ipset = / nom_domaine / débloquer".  Cela signifie qu'après avoir déterminé les adresses IP d'un domaine particulier, elles seront automatiquement ajoutées à l'ensemble de déblocage. <br><br>  Assurez-vous d'exécuter le script pour générer le fichier unblock.dnsmasq: <br><br><pre> <code class="bash hljs">unblock_dnsmasq.sh</code> </pre> <br>  Vérifiez que le fichier unblock.dnsmasq est créé: <br><br><pre> <code class="bash hljs">cat /opt/etc/unblock.dnsmasq</code> </pre> <br><h3>  7. Le script de mise à jour forcée manuelle du système après avoir édité la liste des domaines (unblock_update.sh) </h3><br>  Créez le script <b>/opt/bin/unblock_update.sh</b> : <br><br><pre> <code class="bash hljs">mcedit /opt/bin/unblock_update.sh</code> </pre> <br>  Collez (Maj + Insérer) le contenu: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh ipset flush unblock /opt/bin/unblock_dnsmasq.sh restart_dhcpd sleep 3 /opt/bin/unblock_ipset.sh &amp;</span></span></code> </pre> <br>  Donner des droits d'exécution: <br><br><pre> <code class="bash hljs">chmod +x /opt/bin/unblock_update.sh</code> </pre> <br><h3>  8. Script pour remplir automatiquement un ensemble de déblocage lors du démarrage d'un routeur (S99unblock) </h3><br>  Créez le script <b>/opt/etc/init.d/S99unblock</b> : <br><br><pre> <code class="bash hljs">mcedit /opt/etc/init.d/S99unblock</code> </pre> <br>  Collez (Maj + Insérer) le contenu: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh [ "$1" != "start" ] &amp;&amp; exit 0 /opt/bin/unblock_ipset.sh &amp;</span></span></code> </pre><br>  Donner des droits d'exécution: <br><br><pre> <code class="bash hljs">chmod +x /opt/etc/init.d/S99unblock</code> </pre> <br><h3>  9. Transfert de paquets avec des destinations de déblocage à Tor (post_iptables_script.sh) </h3><br>  Ouvrez le fichier <b>/etc/storage/post_iptables_script.sh</b> dans l'éditeur: <br><br><pre> <code class="bash hljs">mcedit /etc/storage/post_iptables_script.sh</code> </pre> <br>  Ajouter à la fin: <br><br><pre> <code class="bash hljs">iptables -t nat -A PREROUTING -i br0 -p tcp -m <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> --match-set unblock dst -j REDIRECT --to-port 9141</code> </pre> <br><img src="https://habrastorage.org/webt/af/u2/dl/afu2dld3v0nrhtjwfekvo6i-wsi.png"><br><br>  Si vous le souhaitez, vous pouvez modifier le fichier post_iptables_script.sh via l'interface Web du routeur - "Avancé"&gt; "Personnalisation"&gt; "Scripts"&gt; "Exécuter après redémarrage des règles de pare-feu".  Après la modification, cliquez sur "Appliquer". <br><br><img src="https://habrastorage.org/webt/pv/be/ot/pvbeotspo0xhzrukgp3dgvu5aws.png"><br><br>  Vous pouvez ajouter (c'est facultatif) au même fichier pour rediriger toutes les demandes vers le port externe 53 vers vous-même.  Cela est nécessaire pour que les clients du réseau local n'utilisent pas de services DNS tiers.  Les demandes passeront par le serveur DNS standard. <br><br><pre> <code class="bash hljs">iptables -t nat -I PREROUTING -i br0 -p udp --dport 53 -j DNAT --to 192.168.0.1 iptables -t nat -I PREROUTING -i br0 -p tcp --dport 53 -j DNAT --to 192.168.0.1</code> </pre> <br>  Si nécessaire, remplacez <b>192.168.0.1</b> par l'adresse interne de votre routeur (LAN). <br><br><h3>  10. Connexion d'un fichier de configuration supplémentaire à dnsmasq </h3><br>  Nous devons connecter le fichier unblock.dnsmasq créé à dnsmasq.  Pour ce faire, ouvrez le fichier <b>/etc/storage/dnsmasq/dnsmasq.conf</b> dans l'éditeur: <br><br><pre> <code class="bash hljs">mcedit /etc/storage/dnsmasq/dnsmasq.conf</code> </pre> <br>  Ajouter à la fin: <br><br><pre> <code class="bash hljs">conf-file=/opt/etc/unblock.dnsmasq</code> </pre> <br>  Si vous le souhaitez (ceci est facultatif), vous pouvez ajouter un serveur supplémentaire pour la résolution et la fiabilité: <br><br><pre> <code class="bash hljs">server=8.8.8.8</code> </pre> <br>  Si vous le souhaitez, vous pouvez modifier le fichier dnsmasq.conf via l'interface Web du routeur - "Avancé"&gt; "LAN"&gt; "Serveur DHCP"&gt; "Fichier de configuration utilisateur dnsmasq.conf".  Après la modification, cliquez sur "Appliquer". <br><br><img src="https://habrastorage.org/webt/x0/ar/4c/x0ar4cm6v9pgsluqabh74qck-s0.png"><br><br><h3>  11. Ajout d'une tâche à cron pour mettre à jour périodiquement le contenu de l'ensemble de déblocage </h3><br>  Il s'agit d'une assurance supplémentaire si les programmes / appareils utilisent leur propre méthode de résolution et si l'adresse IP du domaine a changé.  Il vous suffit d'exécuter le script unblock_ipset.sh à la fréquence souhaitée.  Par exemple, nous lancerons tous les jours à 6 heures du matin. <br><br>  Remplacez le nom racine par admin dans le fichier de configuration cron: <br><br><pre> <code class="bash hljs">sed -i <span class="hljs-string"><span class="hljs-string">'s/root/admin/g'</span></span> /opt/etc/crontab</code> </pre> <br>  Ouvrez le fichier <b>/ opt / etc / crontab</b> dans l'éditeur: <br><br><pre> <code class="bash hljs">mcedit /opt/etc/crontab</code> </pre> <br>  Ajouter à la fin: <br><br><pre> <code class="bash hljs">00 06 * * * admin /opt/bin/unblock_ipset.sh</code> </pre> <br>  Si vous le souhaitez, vous pouvez commenter toutes les autres tâches du modèle.  Voici à quoi ressemblera votre fichier crontab: <br><br><img src="https://habrastorage.org/webt/hf/lb/fc/hflbfcv04lpvzlrjmehoc3l51ts.png"><br><br><h3>  12. Redémarrage du routeur </h3><br>  Exécutez la commande: <br><br><pre> <code class="bash hljs">reboot</code> </pre> <br>  Après le redémarrage, ouvrez le site Web check.torproject.org dans votre navigateur (il doit être ajouté à unblock.txt).  Si vous avez tout fait correctement, vous verrez l'inscription «Félicitations.  Ce navigateur est configuré pour utiliser Tor. ": <br><br><img src="https://habrastorage.org/webt/wa/19/dz/wa19dzxbu8qtldwrvkeijfqna7q.png"><br><br><br><a name="con3"></a><h1>  Configuration d'un routeur avec Keenetic OS </h1><br>  Vous devez disposer d'un routeur Keenetic / Zyxel avec Entware Package Manager (OPKG) déjà configuré.  Par exemple, voici une liste de certains routeurs qui prennent en charge Entware: Keenetic II, Keenetic III, Extra, Extra II, Giga II, Giga III, Omni, Omni II, Viva, Ultra, Ultra II, Omni (KN-1410), Extra (KN -1710), Giga (KN-1010), Ultra (KN-1810), Viva (KN-1910), DSL (KN-2010), Duo (KN-2110).  Les instructions pour configurer Entware peuvent être trouvées <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> (jusqu'à 10 points). <br><br>  Si auparavant (avec un firmware sous 2.07) vous avez déjà ajouté la prise en charge Entware, assurez-vous que vous <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">utilisez l'Entware-ng obsolète</a> . <br><br>  Assurez-vous d'activer "Modules du noyau du sous-système Netfilter" - Paramètres généraux&gt; Modifier le jeu de composants.  S'il ne figure pas dans la liste de ceux disponibles, essayez d'abord d'installer le composant de protocole IPv6.  Si après cela n'apparaît pas, essayez sans cela, mais il y a une forte probabilité que vous ne puissiez pas déverrouiller par plage et CIDR (car il n'y aura pas de support pour le hash: net set). <br><br><img src="https://habrastorage.org/webt/vv/dh/hi/vvdhhirhcktuefrgbxh3fkx5i0i.png"><br><br>  Pour les tests, j'ai utilisé Keenetic Ultra (KN-1810) avec le dernier firmware - 2.14.C.0.0-4. <br><br>  <u>Remarque importante.</u>  <u>Vous devrez désactiver le serveur DNS standard dans le système, nous utiliserons plutôt dnsmasq.</u>  <u>Vous perdrez la possibilité d'attribuer des services DNS (Yandex.DNS / SkyDNS / AdGuard DNS) individuellement aux clients, mais vous pouvez les utiliser globalement via les paramètres dnsmasq si nécessaire.</u> <br><br><h3>  1. Installation du logiciel nécessaire sur le routeur </h3><br><pre> <code class="bash hljs">opkg update opkg install mc tor tor-geoip <span class="hljs-built_in"><span class="hljs-built_in">bind</span></span>-dig cron dnsmasq-full ipset iptables</code> </pre> <br>  <b>mc</b> - Gestionnaire de fichiers Midnight Commander.  Il n'est nécessaire qu'en raison de l'éditeur mcedit pratique.  Si vous avez l'habitude d'utiliser un autre éditeur de texte, alors mc ne peut pas être installé. <br>  <b>tor</b> - Service Tor. <br>  <b>tor-geoip</b> - base de données géo-IP pour Tor. <br>  <b>bind-dig</b> - client DNS (analogue de nslookup et hôte). <br>  <b>cron</b> - planificateur de tâches. <br>  <b>dnsmasq-full</b> - serveur DNS. <br>  <b>ipset et iptables</b> sont des utilitaires de console <b>ipset et iptables</b> (ils peuvent déjà être sur le système et ne sont pas nécessaires, je les ai ajoutés pour des <b>raisons</b> de sécurité). <br><br><h3>  2. Initialisez l'ipset, créez plusieurs adresses IP de déblocage (100-ipset.sh) </h3><br>  Vérifiez que votre système de routeur prend en charge beaucoup de hash: net (comme il s'est avéré, tous les routeurs Keenetic ne l'ont pas): <br><br><pre> <code class="bash hljs">ipset create <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> <span class="hljs-built_in"><span class="hljs-built_in">hash</span></span>:net</code> </pre> <br>  Si l'équipe n'a pas donné d'erreurs ou de messages, il y a du support et suivez simplement les instructions.  Sinon (il y a une erreur) dans le script suivant, vous devez remplacer <b>hash: net</b> par <b>hash: ip</b> .  Dans ce cas, vous perdez la possibilité de déverrouiller la plage et le CIDR. <br><br>  Créez un ensemble d'adresses vide appelé <b>débloquer</b> lorsque le routeur démarre.  Pour ce faire, créez le fichier <b>/opt/etc/ndm/fs.d/100-ipset.sh</b> : <br><br><pre> <code class="bash hljs">mcedit /opt/etc/ndm/fs.d/100-ipset.sh</code> </pre> <br>  Collez (Maj + Insérer) le contenu: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh [ "$1" != "start" ] &amp;&amp; exit 0 ipset create unblock hash:net -exist exit 0</span></span></code> </pre> <br>  Pour coller à partir du tampon, utilisez Shift + Insert, enregistrez - F2, quittez - F10. <br><br>  Donner des droits d'exécution: <br><br><pre> <code class="bash hljs">chmod +x /opt/etc/ndm/fs.d/100-ipset.sh</code> </pre> <br><h3>  3. Configuration de Tor </h3><br>  Supprimez le contenu du fichier de configuration Tor: <br><br><pre> <code class="bash hljs">cat /dev/null &gt; /opt/etc/tor/torrc</code> </pre> <br>  Ouvrez le fichier de configuration Tor: <br><br><pre> <code class="bash hljs">mcedit /opt/etc/tor/torrc</code> </pre> <br>  Collez (Maj + Insérer) le contenu: <br><br><pre> <code class="bash hljs">User root PidFile /opt/var/run/tor.pid ExcludeExitNodes {RU},{UA},{AM},{KG},{BY} StrictNodes 1 TransPort 192.168.0.1:9141 ExitRelay 0 ExitPolicy reject *:* ExitPolicy reject6 *:* GeoIPFile /opt/share/tor/geoip GeoIPv6File /opt/share/tor/geoip6 DataDirectory /opt/var/lib/tor</code> </pre> <br>  Si nécessaire, remplacez <b>192.168.0.1</b> par l'adresse interne de votre routeur (LAN).  Brève description de la configuration: <br><br><ul><li>  Exclure les nœuds de sortie: Russie, Ukraine, Arménie Kirghizistan, Bélarus. </li><li>  Accrochez un proxy transparent à l'adresse 192.168.0.1, port 9141. </li><li>  Refuser d'être un point de sortie. </li></ul><br><h3>  4. La liste des domaines (et pas seulement) pour contourner le verrou (unblock.txt) </h3><br>  unblock.txt est une liste simple à déverrouiller.  Vous pouvez déverrouiller un domaine, une adresse IP, une plage ou un CIDR.  Une ligne - un élément.  Les lignes vides (y compris les espaces et les tabulations) sont ignorées.  Vous pouvez utiliser le caractère # au début d'une ligne pour l'ignorer. <br><br>  Créez le fichier <b>/opt/etc/unblock.txt</b> : <br><br><pre> <code class="bash hljs">mcedit /opt/etc/unblock.txt</code> </pre> <br>  Chaque ligne peut contenir un nom de domaine, une adresse IP, une plage ou un CIDR.  Vous pouvez utiliser le caractère # pour commenter les lignes. <br><br><div class="spoiler">  <b class="spoiler_title">Voici un exemple de mon dossier personnel</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">###- rutracker.org rutor.info rutor.is mega-tor.org kinozal.tv nnm-club.me nnm-club.ws tfile.me tfile-home.org tfile1.cc megatfile.cc megapeer.org megapeer.ru tapochek.net tparser.org tparser.me rustorka.com uniongang.tv fast-torrent.ru ###    rezka.ag hdrezka.ag hdrezka.me filmix.co filmix.cc seasonvar.ru ### lib.rus.ec flibusta.is flibs.me flisland.net flibusta.site ### telegram.org tdesktop.com tdesktop.org tdesktop.info tdesktop.net telesco.pe telegram.dog telegram.me t.me telegra.ph web.telegram.org desktop.telegram.org updates.tdesktop.com venus.web.telegram.org flora.web.telegram.org vesta.web.telegram.org pluto.web.telegram.org aurora.web.telegram.org 149.154.160.0/20 91.108.4.0/22 91.108.8.0/22 91.108.12.0/22 91.108.16.0/22 91.108.56.0/22 109.239.140.0/24 67.198.55.0/24 ### 7-zip.org edem.tv 4pna.com 2019.vote ### Tor check.torproject.org ###   IP ( #   ) #195.82.146.214 ###   CIDR ( #   ) #103.21.244.0/22 ###    ( #   ) #100.100.100.200-100.100.100.210</span></span></code> </pre> <br></div></div><br><h3>  5. Un script pour remplir un ensemble d'adresses IP de déblocage d'une liste donnée de domaines (unblock_ipset.sh) </h3><br>  Créez le script <b>/opt/bin/unblock_ipset.sh</b> : <br><br><pre> <code class="bash hljs">mcedit /opt/bin/unblock_ipset.sh</code> </pre> <br>  Collez (Maj + Insérer) le contenu: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh until ADDRS=$(dig +short google.com @localhost) &amp;&amp; [ -n "$ADDRS" ] &gt; /dev/null 2&gt;&amp;1; do sleep 5; done while read line || [ -n "$line" ]; do [ -z "$line" ] &amp;&amp; continue [ "${line:0:1}" = "#" ] &amp;&amp; continue cidr=$(echo $line | grep -Eo '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}/[0-9]{1,2}') if [ ! -z "$cidr" ]; then ipset -exist add unblock $cidr continue fi range=$(echo $line | grep -Eo '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}-[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}') if [ ! -z "$range" ]; then ipset -exist add unblock $range continue fi addr=$(echo $line | grep -Eo '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}') if [ ! -z "$addr" ]; then ipset -exist add unblock $addr continue fi dig +short $line @localhost | grep -Eo '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}' | awk '{system("ipset -exist add unblock "$1)}' done &lt; /opt/etc/unblock.txt</span></span></code> </pre> <br>  Donner des droits d'exécution: <br><br><pre> <code class="bash hljs">chmod +x /opt/bin/unblock_ipset.sh</code> </pre> <br>  Le script est assez simple, c'est l'essence même de son travail ... Nous attendons que la résolution du domaine google.com fonctionne (si ce n'est pas fait, beaucoup de déblocages ne seront pas effectués au démarrage du routeur, car le routeur sera toujours en cours d'initialisation).  Nous lisons les lignes du fichier unblock.txt.  Les lignes de lecture suppriment automatiquement les espaces et les tabulations au début et à la fin.  Évitez les lignes vides.  Ignorez les lignes commençant par le caractère #.  Nous cherchons dans la ligne CIDR.  Si CIDR est trouvé, ajoutez-le pour débloquer.  Nous recherchons une gamme dans la chaîne.  S'il est trouvé, ajoutez-le pour débloquer.  Nous recherchons l'adresse IP dans la chaîne.  Si l'IP est trouvée, ajoutez-la pour débloquer.  Résolvons une ligne en creusant.  Toutes les adresses IP du résultat sont ajoutées au déblocage. <br><br><h3>  6. Un script pour générer un fichier de configuration dnsmasq supplémentaire à partir d'une liste donnée de domaines (unblock_dnsmasq.sh) </h3><br>  Créez le script <b>/opt/bin/unblock_dnsmasq.sh</b> : <br><br><pre> <code class="bash hljs">mcedit /opt/bin/unblock_dnsmasq.sh</code> </pre> <br>  Collez (Maj + Insérer) le contenu: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh cat /dev/null &gt; /opt/etc/unblock.dnsmasq while read line || [ -n "$line" ]; do [ -z "$line" ] &amp;&amp; continue [ "${line:0:1}" = "#" ] &amp;&amp; continue echo $line | grep -Eq '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}' &amp;&amp; continue echo "ipset=/$line/unblock" &gt;&gt; /opt/etc/unblock.dnsmasq done &lt; /opt/etc/unblock.txt</span></span></code> </pre> <br>  Donner des droits d'exécution: <br><br><pre> <code class="bash hljs">chmod +x /opt/bin/unblock_dnsmasq.sh</code> </pre> <br>  Le script est assez simple.  Nous lisons séquentiellement les lignes de /opt/etc/unblock.txt.  Les lignes de lecture suppriment automatiquement les espaces et les tabulations au début et à la fin.  Évitez les lignes vides.  Évitez les lignes qui commencent par #.  Ignorer les lignes contenant une adresse IP (IP ou CIDR), c'est-à-dire  nous ne sommes intéressés que par les chaînes avec des noms de domaine.  Dans le fichier /opt/etc/unblock.dnsmasq nous ajoutons des lignes de la forme "ipset = / nom_domaine / débloquer".  Cela signifie qu'après avoir déterminé les adresses IP d'un domaine particulier, elles seront automatiquement ajoutées à l'ensemble de déblocage. <br><br>  Assurez-vous d'exécuter le script pour générer le fichier unblock.dnsmasq: <br><br><pre> <code class="bash hljs">unblock_dnsmasq.sh</code> </pre> <br>  Vérifiez que le fichier unblock.dnsmasq est créé: <br><br><pre> <code class="bash hljs">cat /opt/etc/unblock.dnsmasq</code> </pre> <br><h3>  7. Le script de mise à jour forcée manuelle du système après avoir édité la liste des domaines (unblock_update.sh) </h3><br>  Créez le script <b>/opt/bin/unblock_update.sh</b> : <br><br><pre> <code class="bash hljs">mcedit /opt/bin/unblock_update.sh</code> </pre> <br>  Collez (Maj + Insérer) le contenu: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh ipset flush unblock /opt/bin/unblock_dnsmasq.sh /opt/etc/init.d/S56dnsmasq restart /opt/bin/unblock_ipset.sh &amp;</span></span></code> </pre> <br>  Donner des droits d'exécution: <br><br><pre> <code class="bash hljs">chmod +x /opt/bin/unblock_update.sh</code> </pre> <br><h3>  8. Script pour remplir automatiquement un ensemble de déblocage lors du démarrage d'un routeur (S99unblock) </h3><br>  Créez le script <b>/opt/etc/init.d/S99unblock</b> : <br><br><pre> <code class="bash hljs">mcedit /opt/etc/init.d/S99unblock</code> </pre> <br>  Collez (Maj + Insérer) le contenu: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh [ "$1" != "start" ] &amp;&amp; exit 0 /opt/bin/unblock_ipset.sh &amp;</span></span></code> </pre><br>  Donner des droits d'exécution: <br><br><pre> <code class="bash hljs">chmod +x /opt/etc/init.d/S99unblock</code> </pre> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 9. Transfert de paquets avec des destinations de déblocage à Tor (100-redirect.sh) </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour ce faire, créez le fichier </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/opt/etc/ndm/netfilter.d/100-redirect.sh</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><pre> <code class="bash hljs">mcedit /opt/etc/ndm/netfilter.d/100-redirect.sh</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Collez (Maj + Insérer) le contenu: </font></font><br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh [ "$type" == "ip6tables" ] &amp;&amp; exit 0 if [ -z "$(iptables-save 2&gt;/dev/null | grep unblock)" ]; then ipset create unblock hash:net -exist iptables -w -t nat -A PREROUTING -i br0 -p tcp -m set --match-set unblock dst -j REDIRECT --to-port 9141 fi exit 0</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si vous avez utilisé </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hash: ip</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> à l'étape 2 </font><font style="vertical-align: inherit;">et non </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hash: net</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , remplacez hash: net par hash: ip. En fait, nous dupliquons également la fonction de création d'un ensemble de déblocage en 2 étapes. Ceci est nécessaire pour la sécurité, si les scripts de fs.d n'ont pas encore commencé à s'exécuter et que les scripts netfilter.d sont déjà en cours d'exécution. Ce n'est pas grave si le déblocage a déjà été créé plus tôt, la commande sera simplement ignorée. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vous pouvez ajouter (c'est facultatif) au même fichier pour rediriger toutes les demandes vers le port externe 53 vers vous-même. Cela est nécessaire pour que les clients du réseau local n'utilisent pas de services DNS tiers. Les demandes passeront par le serveur DNS standard. Avant la dernière sortie, ajoutez:</font></font><br><br><pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ -z <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$(iptables-save 2&gt;/dev/null | grep "udp \-\-dport 53 \-j DNAT")</span></span></span><span class="hljs-string">"</span></span> ]; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> iptables -w -t nat -I PREROUTING -i br0 -p udp --dport 53 -j DNAT --to 192.168.0.1 <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ -z <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$(iptables-save 2&gt;/dev/null | grep "tcp \-\-dport 53 \-j DNAT")</span></span></span><span class="hljs-string">"</span></span> ]; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> iptables -w -t nat -I PREROUTING -i br0 -p tcp --dport 53 -j DNAT --to 192.168.0.1 <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si nécessaire, remplacez </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">192.168.0.1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> par l'adresse interne de votre routeur (LAN). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Donner des droits d'exécution:</font></font><br><br><pre> <code class="bash hljs">chmod +x /opt/etc/ndm/netfilter.d/100-redirect.sh</code> </pre> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 10. Configurer dnsmasq et attacher un fichier de configuration supplémentaire à dnsmasq </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Supprimez le contenu du fichier de configuration dnsmasq: </font></font><br><br><pre> <code class="bash hljs">cat /dev/null &gt; /opt/etc/dnsmasq.conf</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ouvrez le fichier de configuration dnsmasq: </font></font><br><br><pre> <code class="bash hljs">mcedit /opt/etc/dnsmasq.conf</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Collez (Maj + Insérer) le contenu: </font></font><br><br><pre> <code class="bash hljs">user=nobody bogus-priv no-negcache clear-on-reload <span class="hljs-built_in"><span class="hljs-built_in">bind</span></span>-dynamic listen-address=192.168.0.1 listen-address=127.0.0.1 min-port=4096 cache-size=1536 expand-hosts <span class="hljs-built_in"><span class="hljs-built_in">log</span></span>-async conf-file=/opt/etc/unblock.dnsmasq server=8.8.8.8</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si nécessaire, remplacez </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">192.168.0.1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> par l'adresse interne de votre routeur (LAN).</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 11. Ajout d'une tâche à cron pour mettre à jour périodiquement le contenu de l'ensemble de déblocage </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il s'agit d'une assurance supplémentaire si les programmes / appareils utilisent leur propre méthode de résolution et si l'adresse IP du domaine a changé. </font><font style="vertical-align: inherit;">Il vous suffit d'exécuter le script unblock_ipset.sh à la fréquence souhaitée. </font><font style="vertical-align: inherit;">Par exemple, nous lancerons tous les jours à 6 heures du matin. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ouvrez le fichier </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ opt / etc / crontab</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dans l'éditeur </font><font style="vertical-align: inherit;">:</font></font><br><br><pre> <code class="bash hljs">mcedit /opt/etc/crontab</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ajouter à la fin: </font></font><br><br><pre> <code class="bash hljs">00 06 * * * root /opt/bin/unblock_ipset.sh</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si vous le souhaitez, vous pouvez commenter toutes les autres tâches du modèle. </font><font style="vertical-align: inherit;">Voici à quoi ressemblera votre fichier crontab:</font></font><br><br><img src="https://habrastorage.org/webt/le/y5/sl/ley5slcvjfvs-9odj9air9qdd8s.png"><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 12. Désactiver le serveur DNS normal et redémarrer le routeur </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Connectez-vous à la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CLI du routeur Keenetic</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (port 23 pour Telnet et 22 pour SSH si le composant «SSH Server» est ajouté au système). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exécutez la commande:</font></font><br><br><pre> <code class="bash hljs">opkg dns-override system configuration save system reboot</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le serveur DNS intégré au firmware sera désactivé et dnsmasq d'Entware sera utilisé à la place. </font><font style="vertical-align: inherit;">Le routeur, au démarrage, vérifie si le dossier opt est monté (y a-t-il un lecteur flash USB / lecteur avec Entware). </font><font style="vertical-align: inherit;">Si tel est le cas, un serveur DNS standard n'est pas utilisé. </font><font style="vertical-align: inherit;">Sinon, utilisez.</font></font> C'est-à-dire<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">retirer le lecteur flash et redémarrer le routeur, tout fonctionnera pour vous, comme avant (avant la configuration). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Après le redémarrage, ouvrez le site Web check.torproject.org dans votre navigateur (il doit être ajouté à unblock.txt). </font><font style="vertical-align: inherit;">Si vous avez tout fait correctement, vous verrez l'inscription «Félicitations. </font><font style="vertical-align: inherit;">Ce navigateur est configuré pour utiliser Tor. ":</font></font><br><br><img src="https://habrastorage.org/webt/wa/19/dz/wa19dzxbu8qtldwrvkeijfqna7q.png"><br><br><br><a name="con31"></a><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Méthodes de base pour diagnostiquer les erreurs après la configuration </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si la vérification avec le site check.torproject.org (il doit être ajouté à unblock.txt) réussit, mais que le talon du fournisseur continue de s'ouvrir pour d'autres ressources (ou ne s'ouvre pas), le fournisseur interférera probablement avec le trafic DNS, remplaçant les réponses - vous Une solution de contournement supplémentaire est nécessaire pour filtrer les requêtes DNS. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si après la configuration, quelque chose ne fonctionne pas comme il se doit, utilisez des commandes simples pour déterminer l'étape du problème. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Affichez le contenu de l'ensemble de déblocage:</font></font><br><br><pre> <code class="bash hljs">ipset list unblock</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si le système signale qu'il n'y a pas de tels ensembles, l'erreur se trouve à l'étape 2 ou vous n'avez pas activé le module Netfilter dans le système (dans le cas de Keenetic). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si l'ensemble s'avère vide, le script unblock_ipset.sh n'a pas fonctionné, qui à son tour doit être démarré par le script de démarrage S99unblock. Exécutez ce script unblock_ipset.sh manuellement. Si l'ensemble est plein, l'erreur est à l'étape 8. Si le script ne peut pas être exécuté (très probablement, il attend la résolution de google.com), l'erreur se situe quelque part du côté du serveur DNS, éventuellement à l'étape 10 ou 6. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Recherchez une redirection dans iptables :</font></font><br><br><pre> <code class="bash hljs">iptables-save 2&gt;/dev/null | grep unblock</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">S'il n'est pas là, l'erreur est à l'étape 9. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si tous les sites sont en panne, c'est-à-dire </font><font style="vertical-align: inherit;">DNS ne fonctionne pas, l'erreur se situe quelque part à l'étape 6 ou 10. Peut-être, à l'étape 9. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si tous les sites de unblock.txt ne fonctionnent pas (le délai est dépassé), mais que tous les autres fonctionnent, le problème se situe quelque part du côté de Tor, erreur au stade 3.</font></font><br><br><br><a name="con4"></a><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Contournement supplémentaire pour filtrer les requêtes DNS par le fournisseur </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si un fournisseur interfère avec le trafic DNS en remplaçant les réponses pour les ressources bloquées, cela est très facile à contourner. </font><font style="vertical-align: inherit;">Pour cela, nous utiliserons dnscrypt-proxy. </font><font style="vertical-align: inherit;">Si vous le souhaitez et expérimentez, vous pouvez facilement remplacer dnscrypt par stubby (DNS sur TLS). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dnscrypt ne sera utilisé que pour les domaines répertoriés dans unblock.txt. </font><font style="vertical-align: inherit;">Toutes les autres requêtes passeront par des serveurs DNS classiques. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si vous êtes sûr que votre fournisseur ne filtre pas les requêtes DNS, vous n'avez pas besoin d'effectuer cette configuration supplémentaire. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vous devez déjà avoir configuré le contournement des verrous décrits ci-dessus. </font><font style="vertical-align: inherit;">Les paramètres suivants sont identiques pour Padavan et Keenetic OS. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Installez des logiciels supplémentaires sur le routeur:</font></font><br><br><pre> <code class="bash hljs">opkg update opkg install dnscrypt-proxy2</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ouvrez le fichier de configuration dnscrypt-proxy: </font></font><br><br><pre> <code class="bash hljs">mcedit /opt/etc/dnscrypt-proxy.toml</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Recherchez les adresses listen_address, fallback_resolver, cache et modifiez-les: </font></font><br><br><pre> <code class="bash hljs">listen_addresses = [<span class="hljs-string"><span class="hljs-string">'127.0.0.1:9153'</span></span>] fallback_resolver = <span class="hljs-string"><span class="hljs-string">'77.88.8.8:1253'</span></span> cache = <span class="hljs-literal"><span class="hljs-literal">false</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">77.88.8.8:1253 est l'adresse du serveur DNS Yandex avec un port non standard. </font><font style="vertical-align: inherit;">Il s'agit d'une sauvegarde en cas de problème avec dnscrypt-proxy. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exécutez dnscrypt-proxy:</font></font><br><br><pre> <code class="bash hljs">/opt/etc/init.d/S09dnscrypt-proxy2 start</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Assurez-vous que dnscrypt-proxy fonctionne (vous devriez voir une liste d'adresses IP en réponse): </font></font><br><br><pre> <code class="bash hljs">dig +short google.com @localhost -p 9153</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ouvrez le script </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/opt/bin/unblock_ipset.sh</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dans l'éditeur </font><font style="vertical-align: inherit;">:</font></font><br><br><pre> <code class="bash hljs">mcedit /opt/bin/unblock_ipset.sh</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Remplacez le contenu par: </font></font><br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh until ADDRS=$(dig +short google.com @localhost -p 9153) &amp;&amp; [ -n "$ADDRS" ] &gt; /dev/null 2&gt;&amp;1; do sleep 5; done while read line || [ -n "$line" ]; do [ -z "$line" ] &amp;&amp; continue [ "${line:0:1}" = "#" ] &amp;&amp; continue cidr=$(echo $line | grep -Eo '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}/[0-9]{1,2}') if [ ! -z "$cidr" ]; then ipset -exist add unblock $cidr continue fi range=$(echo $line | grep -Eo '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}-[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}') if [ ! -z "$range" ]; then ipset -exist add unblock $range continue fi addr=$(echo $line | grep -Eo '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}') if [ ! -z "$addr" ]; then ipset -exist add unblock $addr continue fi dig +short $line @localhost -p 9153 | grep -Eo '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}' | awk '{system("ipset -exist add unblock "$1)}' done &lt; /opt/etc/unblock.txt</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous avons fait un petit changement - maintenant creuser pour résoudre n'utilise pas un serveur DNS normal, mais dnscrypt-proxy avec le port 9153. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ouvrez le script </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/opt/bin/unblock_dnsmasq.sh</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dans l'éditeur </font><font style="vertical-align: inherit;">:</font></font><br><br><pre> <code class="bash hljs">mcedit /opt/bin/unblock_dnsmasq.sh</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Remplacez le contenu par: </font></font><br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh cat /dev/null &gt; /opt/etc/unblock.dnsmasq while read line || [ -n "$line" ]; do [ -z "$line" ] &amp;&amp; continue [ "${line:0:1}" = "#" ] &amp;&amp; continue echo $line | grep -Eq '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}' &amp;&amp; continue echo "ipset=/$line/unblock" &gt;&gt; /opt/etc/unblock.dnsmasq echo "server=/$line/127.0.0.1#9153" &gt;&gt; /opt/etc/unblock.dnsmasq done &lt; /opt/etc/unblock.txt</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous avons fait un petit changement - maintenant lors de la génération du fichier unblock.dnsmasq, des lignes supplémentaires comme «server = / domain_name / 127.0.0.1 # 9153» sont ajoutées. </font><font style="vertical-align: inherit;">Cela signifie que la résolution des domaines de la liste se fera via dnscrypt-proxy. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exécutez unblock_update.sh:</font></font><br><br><pre> <code class="bash hljs">unblock_update.sh</code> </pre> <br>  C'est fait.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tous les paramètres compliqués sont derrière. </font><font style="vertical-align: inherit;">Maintenant, vous ne modifierez la liste unblock.txt que si nécessaire, en ajoutant ou supprimant des domaines ou des adresses IP pour le déverrouiller et en activant les modifications apportées avec la commande unblock_update.sh. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MISE À JOUR 04/01/2019</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Viennent souvent des messages personnels sur l'article avec des questions typiques. </font><font style="vertical-align: inherit;">Je répondrai ici le plus courant. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comment mettre à disposition des sites de zone de domaine .onion? </font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En torrc, ajouter:</font></font><br><pre> <code class="bash hljs">VirtualAddrNetwork 10.254.0.0/16 DNSPort 127.0.0.1:9053 AutomapHostsOnResolve 1</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Pour accéder à tous les domaines de la zone oignon, ajoutez à dnsmasq.conf: </font></font><br><pre> <code class="bash hljs">server=/onion/127.0.0.1<span class="hljs-comment"><span class="hljs-comment">#9053 ipset=/onion/unblock</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Si vous ne souhaitez pas ouvrir l'accès à tous les domaines de la zone oignon, mais uniquement à des domaines spécifiques, ajoutez les entrées suivantes dans dnsmasq.conf: </font></font><br><pre> <code class="bash hljs">server=/rutorc6mqdinc4cz.onion/127.0.0.1<span class="hljs-comment"><span class="hljs-comment">#9053 ipset=/rutorc6mqdinc4cz.onion/unblock server=/nnmclub5toro7u65.onion/127.0.0.1#9053 ipset=/nnmclub5toro7u65.onion/unblock server=/flibustahezeous3.onion/127.0.0.1#9053 ipset=/flibustahezeous3.onion/unblock</span></span></code> </pre> <br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comment contourner les verrous pour les clients d'un serveur VPN fonctionnant sur un routeur? </font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans torrc, remplacez la ligne par TransPort par:</font></font><br><pre> <code class="bash hljs">TransPort 0.0.0.0:9141</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ajoutez une redirection supplémentaire avec l'interface nécessaire (INTERFACE - Interface réseau VPN): </font></font><br><pre> <code class="bash hljs">iptables -t nat -A PREROUTING -i  -p tcp -m <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> --match-set unblock dst -j REDIRECT --to-port 9141</code> </pre> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr428992/">https://habr.com/ru/post/fr428992/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr428982/index.html">Comment écrire D sur ARM</a></li>
<li><a href="../fr428984/index.html">Julia et portraits de phases de systèmes dynamiques</a></li>
<li><a href="../fr428986/index.html">Conférence ThinkJava n ° 8 à Kharkov</a></li>
<li><a href="../fr428988/index.html">Conseils nature - Veilleuse nuageuse</a></li>
<li><a href="../fr428990/index.html">Exemples de configuration d'UIViewControllers utilisant RouteComposer</a></li>
<li><a href="../fr428994/index.html">Mise en réseau sous Android avec Corutin et Retrofit</a></li>
<li><a href="../fr428996/index.html">Club de Santa Clauses anonymes 2018-2019 sur Habrahabr</a></li>
<li><a href="../fr428998/index.html">Comment utiliser la nouvelle fonctionnalité Profiler expérimentale dans React</a></li>
<li><a href="../fr429000/index.html">Pourquoi Bill Gates a inventé les toilettes pour 233 milliards de dollars</a></li>
<li><a href="../fr429006/index.html">Chine: «l'atelier de montage mondial» n'est pas aussi simple qu'il y paraît</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>