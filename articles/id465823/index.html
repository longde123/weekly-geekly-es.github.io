<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸšµğŸ¾ ğŸ”´ ğŸ‘¦ Operator kubernet Tarantool ğŸ›‚ ğŸ“´ ğŸ˜˜</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Kubernetes menjadi standar de facto untuk menjalankan aplikasi stateless. Terutama karena secara signifikan dapat mengurangi waktu ke pasar untuk peng...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Operator kubernet Tarantool</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/mailru/blog/465823/"><img src="https://habrastorage.org/webt/pm/mm/lk/pmmmlkexzrcniami66ljv1ynirg.jpeg"><br><br>  Kubernetes menjadi standar de facto untuk menjalankan aplikasi stateless.  Terutama karena secara signifikan dapat mengurangi waktu ke pasar untuk pengiriman fitur-fitur baru.  Meluncurkan aplikasi stateful - basis data, microservices stateful - masih merupakan tugas yang sulit, tetapi kebutuhan untuk menahan persaingan dan mempertahankan tingkat pengiriman yang tinggi mendorong perusahaan untuk bereksperimen di bidang ini dan menciptakan permintaan untuk solusi tersebut. <br><br>  Kami hadir untuk Anda solusi kami untuk meluncurkan cluster stateful <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Tarantool Cartridge</a> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Tarantool Kubernetes Operator</a> , untuk detail yang saya tanyakan di bawah cat. <br><a name="habracut"></a><br>  Daftar isi: <br><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Alih-alih seribu kata</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Apa yang dilakukan operator sama sekali</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Sedikit tentang nuansa</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Cara operator bekerja</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Apa yang dikembangkan operator</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Ringkasan</a> </li></ol><br><br>  Tarantool adalah basis data opensource dan server aplikasi dalam satu paket.  Sebagai basis data, ia memiliki sejumlah karakteristik unik: efisiensi tinggi pemanfaatan besi, skema data fleksibel, dukungan untuk memori dan penyimpanan disk, dan kemungkinan ekspansi melalui penggunaan bahasa Lua.  Sebagai server aplikasi, ini memungkinkan Anda untuk memindahkan kode aplikasi sedekat mungkin dengan data, sambil mencapai waktu respons minimal dan throughput maksimum.  Selain itu, Tarantool memiliki <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">ekosistem yang luas</a> , menyediakan modul yang siap pakai untuk menyelesaikan masalah aplikasi: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sharding</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">antrian</a> , modul untuk memfasilitasi pengembangan ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">cartridge</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">luatest</a> ), solusi untuk operasi ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">metrik</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">dimungkinkan</a> ) - ini hanya beberapa contoh. <br><br>  Untuk semua kelebihannya, kemampuan turunan Tarantool tunggal tidak terbatas: untuk menyimpan terabyte data dan memproses jutaan permintaan, Anda perlu meningkatkan puluhan dan ratusan instance, dan ini adalah sistem terdistribusi, dengan semua masalahnya yang melekat.  Untuk mengatasinya, kami memiliki <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Tarantool Cartridge</a> , sebuah kerangka kerja yang tugas utamanya adalah menyembunyikan semua jenis kesulitan dalam menulis aplikasi terdistribusi dan memungkinkan pengembang untuk fokus pada nilai bisnis aplikasi tersebut.  Cartridge menyediakan seperangkat komponen yang kuat untuk orkestrasi klaster otomatis, distribusi data otomatis, webui untuk pengoperasian dan alat pengembang. <br><br>  Tarantool tidak hanya teknologi, tetapi juga tim insinyur yang terlibat dalam pengembangan sistem turnkey enterprise, solusi kotak dan dukungan untuk komponen opensource. <br><br>  Secara global, tugas kami dapat dibagi menjadi dua area: pengembangan sistem baru dan penambahan solusi yang ada.  Misalnya, ada basis besar dari vendor terkenal.  Untuk skala untuk membaca, mereka menempatkan cache akhirnya konsisten pada Tarantool di belakangnya.  Atau sebaliknya: untuk mengubah skala catatan, mereka menempatkan Tarantool dalam konfigurasi panas / dingin, di mana saat mereka "mendinginkan" data dibuang ke penyimpanan dingin dan secara paralel dengan antrian analitik.  Atau untuk membuat cadangan sistem yang ada, versi ringan dari sistem ini (cadangan fungsional) ditulis, yang cadangan "panas" utama dengan replikasi data dari sistem utama.  Informasi lebih lanjut dapat ditemukan di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">laporan dari T + 2019</a> . <br><br>  Semua sistem ini memiliki satu kesamaan: mereka cukup sulit dioperasikan.  Gulir dengan cepat sekelompok 100+ instance dengan redundansi ke 3 pusat data, perbarui aplikasi yang menyimpan data tanpa downtime dan penarikan perawatan, buat pengembalian cadangan jika terjadi bencana atau kesalahan buatan manusia, pastikan kegagalan komponen yang hati-hati, atur manajemen konfigurasi ... Secara umum, ada banyak menarik <br><br>  Dan akan lebih bagus jika semua ini masih dioperasikan hanya karena sedang dikembangkan.  Kubernet memungkinkan untuk mencapai hasil yang diinginkan, tetapi menggunakan operator khusus membuat hidup lebih mudah. <br><br><a name="1"></a><h2>  Alih-alih seribu kata </h2><br>  Kami telah menyiapkan contoh kecil berdasarkan Tarantool Cartridge, dan kami akan bekerja dengannya.  Aplikasi sederhana seperti "penyimpanan nilai kunci terdistribusi dengan antarmuka HTTP".  Setelah diluncurkan, kami mendapatkan gambar ini: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c24/235/2c7/c242352c708a0e0dfa8fc0896bbb986d.png"><br><br>  Dimana: <br><br><ul><li>  Router - bagian dari cluster yang bertanggung jawab untuk menerima dan memproses permintaan HTTP yang masuk; <br></li><li>  Penyimpanan adalah bagian dari cluster yang bertanggung jawab untuk menyimpan dan memproses data, 3 serpihan naik dari kotak, di setiap master dan replika. <br></li></ul><br>  Untuk menyeimbangkan lalu lintas HTTP yang masuk pada router, Kubernetian Ingress digunakan.  Data didistribusikan dalam penyimpanan di tingkat Tarantool itu sendiri menggunakan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">komponen vshard</a> . <br><br>  Kami membutuhkan kubernet 1.14+, minikube akan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">berfungsi</a> .  Juga ketersediaan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">kubectl</a> tidak akan sakit.  Untuk memulai operator, Anda perlu membuat ServiceAccount, Peran, dan Peran untuk itu: <br><br><pre><code class="bash hljs">$ kubectl create -f https://raw.githubusercontent.com/tarantool/tarantool-operator/0.0.1/deploy/service_account.yaml $ kubectl create -f https://raw.githubusercontent.com/tarantool/tarantool-operator/0.0.1/deploy/role.yaml $ kubectl create -f https://raw.githubusercontent.com/tarantool/tarantool-operator/0.0.1/deploy/role_binding.yaml</code> </pre> <br>  Operator Tarantool memperluas API Kubernetes dengan definisi sumber dayanya, kami akan membuatnya: <br><br><pre> <code class="bash hljs">$ kubectl create -f https://raw.githubusercontent.com/tarantool/tarantool-operator/0.0.1/deploy/crds/tarantool_v1alpha1_cluster_crd.yaml $ kubectl create -f https://raw.githubusercontent.com/tarantool/tarantool-operator/0.0.1/deploy/crds/tarantool_v1alpha1_role_crd.yaml $ kubectl create -f https://raw.githubusercontent.com/tarantool/tarantool-operator/0.0.1/deploy/crds/tarantool_v1alpha1_replicasettemplate_crd.yaml</code> </pre> <br>  Semuanya siap untuk meluncurkan operator, mari kita pergi: <br><br><pre> <code class="bash hljs">$ kubectl create -f https://raw.githubusercontent.com/tarantool/tarantool-operator/0.0.1/deploy/operator.yaml</code> </pre> <br>  Kami menunggu operator untuk memulai, dan kami dapat melanjutkan untuk meluncurkan aplikasi: <br><br><pre> <code class="bash hljs">$ kubectl create -f https://raw.githubusercontent.com/tarantool/tarantool-operator/0.0.1/examples/kv/deployment.yaml</code> </pre> <br>  Dalam file yaml dengan contohnya, Ingress dideklarasikan di UI web;  ini tersedia di <code>cluster_ip/admin/cluster</code> .  Ketika setidaknya satu Pod dari Ingress naik, Anda bisa pergi ke sana dan menonton bagaimana instance baru ditambahkan ke cluster dan bagaimana topologi berubah. <br><br>  Kami menunggu cluster untuk digunakan: <br><br><pre> <code class="bash hljs">$ kubectl describe clusters.tarantool.io examples-kv-cluster</code> </pre> <br>  Kami berharap bahwa dalam Status cluster akan ada yang berikut ini: <br><br><pre> <code class="plaintext hljs">â€¦ Status: State: Ready â€¦</code> </pre> <br>  Semuanya, aplikasi siap digunakan! <br><br>  Perlu lebih banyak ruang penyimpanan?  Tambahkan pecahan: <br><br><pre> <code class="bash hljs">$ kubectl scale roles.tarantool.io storage --replicas=3</code> </pre> <br>  Pecahan tidak bisa mengatasi beban?  Tambah jumlah instance dalam shard dengan mengedit templat replaset: <br><br><pre> <code class="bash hljs">$ kubectl edit replicasettemplates.tarantool.io storage-template</code> </pre> <br>  Set <code>.spec.replicas</code> , misalnya 2, untuk menambah jumlah instance dalam setiap replaset menjadi dua. <br><br>  Cluster tidak lagi dibutuhkan?  Kami menghapusnya bersama dengan semua sumber daya: <br><br><pre> <code class="bash hljs">$ kubectl delete clusters.tarantool.io examples-kv-cluster</code> </pre> <br>  Apakah ada yang salah?  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Skor tiketnya</a> , kami akan dengan cepat membongkar.  :) <br><br><a name="2"></a><h2>  Apa yang dilakukan operator sama sekali </h2><br>  Peluncuran dan pengoperasian cluster Tarantool Cartridge adalah kisah melakukan tindakan tertentu, dalam urutan tertentu, pada saat tertentu. <br><br>  Cluster itu sendiri dikelola terutama melalui API admin: GraphQL melalui HTTP.  Anda dapat, tentu saja, naik satu tingkat lebih rendah dan mengarahkan perintah langsung ke konsol, tetapi ini jarang terjadi.  Sebagai contoh, ini adalah bagaimana cluster dimulai: <br><br><ol><li>  Kami meningkatkan jumlah instance Tarantool yang diperlukan, misalnya, di bawah systemd. <br></li><li>  Gabungkan instance ke keanggotaan: <br><br><pre> <code class="plaintext hljs">mutation { probe_instance: probe_server(uri: "storage:3301") }</code> </pre> <br></li><li>  Tetapkan peran untuk instance, tentukan instance dan pengidentifikasi replaset.  API GraphQL juga digunakan untuk ini: <br><br><pre> <code class="plaintext hljs">mutation { join_server( uri:"storage:3301", instance_uuid: "cccccccc-cccc-4000-b000-000000000001", replicaset_uuid: "cccccccc-0000-4000-b000-000000000000", roles: ["storage"], timeout: 5 ) }</code> </pre> <br></li><li>  Kami melakukan bootstrap dari komponen yang bertanggung jawab atas sharding.  Juga melalui API: <br><br><pre> <code class="plaintext hljs">mutation { bootstrap_vshard cluster { failover(enabled:true) } }</code> </pre> <br></li></ol><br>  Mudah kan? <br><br>  Semuanya menjadi lebih menarik ketika harus memperluas cluster.  Peran Router dari skala contoh cukup: tingkatkan lebih banyak instance, kaitkan mereka ke cluster yang ada - selesai!  Peran Storages agak rumit.  Penyimpanan terbengkalai, jadi ketika menambahkan / menghapus instance, perlu menyeimbangkan kembali data untuk pindah ke instance baru / untuk pindah dari instance yang dihapus.  Jika ini tidak dilakukan, maka dalam satu kasus kami mendapat contoh kurang beban, di kedua - kami kehilangan data.  Dan jika bukan hanya satu, tetapi selusin cluster dengan topologi berbeda sedang beroperasi? <br><br>  Secara umum, Operator Tarantool sibuk dengan semua ini.  Pengguna menggambarkan keadaan yang diinginkan dari cluster Tarantool Cartridge, dan operator menerjemahkannya ke dalam serangkaian tindakan pada sumber daya k8s dan menjadi panggilan tertentu ke API admin cluster Tarantool dalam urutan tertentu, pada saat tertentu, dan umumnya mencoba menyembunyikan semua nuansa dari pengguna. <br><br><a name="3"></a><h2>  Sedikit tentang nuansa </h2><br>  Saat bekerja dengan API Cluster admin Tarantool Cartridge, urutan panggilan dan ke mana mereka datang itu penting.  Kenapa begitu <br><br>  Tarantool Cartridge membawa repositori topologi, komponen penemuan layanan, dan komponen konfigurasinya.  Setiap instance dari cluster menyimpan salinan topologi dan konfigurasi dalam file yaml. <br><br><pre> <code class="plaintext hljs">servers: d8a9ce19-a880-5757-9ae0-6a0959525842: uri: storage-2-0.examples-kv-cluster:3301 replicaset_uuid: 8cf044f2-cae0-519b-8d08-00a2f1173fcb 497762e2-02a1-583e-8f51-5610375ebae9: uri: storage-0-0.examples-kv-cluster:3301 replicaset_uuid: 05e42b64-fa81-59e6-beb2-95d84c22a435 â€¦ vshard: bucket_count: 30000 ...</code> </pre> <br>  Pembaruan terjadi dalam konser menggunakan mekanisme <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">komit dua fase</a> .  Peningkatan yang berhasil membutuhkan kuorum 100%: setiap contoh harus merespons, jika tidak, kembalikan.  Apa artinya ini dalam hal operasi?  Semua permintaan ke admin API yang memodifikasi keadaan cluster paling andal untuk dikirim ke satu instance, ke leader, jika tidak kita berisiko mengambil konfigurasi berbeda pada instance yang berbeda.  Kartrid Tarantool tidak tahu bagaimana membuat pemilihan pemimpin (namun tidak tahu bagaimana), dan Operator Tarantool dapat - dan Anda hanya dapat mengetahui hal ini sebagai fakta yang menghibur, karena operator akan merusak segalanya. <br><br>  Selain itu, setiap instance harus memiliki identitas tetap, yaitu seperangkat <code>instance_uuid</code> dan <code>replicaset_uuid</code> , serta <code>advertise_uri</code> .  Jika penyimpanan tiba-tiba dinyalakan kembali dan salah satu dari parameter ini berubah, maka Anda berisiko melanggar kuorum - operator juga melakukan ini. <br><br><a name="4"></a><h2>  Cara operator bekerja </h2><br>  Tugas operator adalah untuk membawa sistem ke dalam keadaan yang ditetapkan oleh pengguna dan memelihara sistem dalam keadaan ini sampai arah baru diterima.  Agar operator dapat melakukan pekerjaannya, ia membutuhkan: <br><br><ol><li>  Deskripsi status sistem. <br></li><li>  Kode yang membawa sistem ke kondisi ini. <br></li><li>  Mekanisme untuk mengintegrasikan kode ini ke k8s (misalnya, untuk menerima pemberitahuan perubahan status). <br></li></ol><br>  Cluster Tarantool Cartridge dijelaskan dalam istilah k8s melalui <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Custom Resource Definition (CRD)</a> ;  operator membutuhkan 3 sumber daya khusus seperti itu, disatukan di bawah grup tarantool.io/v1alpha: <br><br><ul><li>  Cluster adalah sumber daya tingkat atas yang sesuai dengan satu kluster Tarantool Cartridge. <br></li><li>  Peran - dalam hal Tarantool Cartridge, ini adalah <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">peran pengguna</a> . <br></li><li>  ReplicasetTemplate - template dimana StatefulSets akan dibuat (mengapa stateful - saya akan memberitahu Anda sedikit nanti; jangan dikacaukan dengan ReplicaSet k8s). <br></li></ul><br>  Semua sumber daya ini secara langsung mencerminkan model deskripsi klaster Tarantool Cartridge.  Memiliki kamus umum, lebih mudah bagi operator untuk berkomunikasi dengan pengembang dan memahami apa yang ingin mereka lihat di prod. <br><br>  Kode yang membawa sistem ke status yang diberikan - dalam hal k8s, ini adalah Controller.  Dalam kasus Operator Tarantool, ada beberapa pengontrol: <br><br><ul><li>  ClusterController - bertanggung jawab untuk berinteraksi dengan cluster Tarantool Cartridge, menghubungkan instance ke cluster, memutus instance dari cluster. <br></li><li>  RoleController adalah pengontrol peran pengguna, ia bertanggung jawab untuk menggunakan StatefulSets dari templat dan mempertahankan nomornya dalam jumlah tertentu. <br></li></ul><br>  Seperti apa pengontrolnya?  Serangkaian kode yang secara bertahap membawa dunia di sekitar Anda dalam urutan.  ClusterController dapat digambarkan secara skematis seperti ini: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/132/1d2/317/1321d23173a37f65743fcc0ee4d48ad2.png"><br><br>  Titik masuk adalah pemeriksaan untuk melihat apakah ada sumber daya Cluster sehubungan dengan peristiwa itu terjadi.  Tidak ada  Kami pergi.  Apa ada  Kami beralih ke blok berikutnya: ambil Kepemilikan di atas peran pengguna.  Diambil satu - kiri, pada lingkaran kedua kita tangkap yang kedua.  Dan seterusnya, sampai kita menangkap semuanya.  Apakah semua peran ditangkap?  Jadi pergi ke blok operasi selanjutnya.  Jadi, sampai kita mencapai yang terakhir;  maka kita dapat mengasumsikan bahwa sistem yang dikendalikan dalam keadaan tertentu. <br><br>  Secara umum, semuanya sederhana.  Penting untuk menentukan kriteria keberhasilan untuk melewati setiap tahap.  Sebagai contoh, kami menganggap berhasil operasi bergabung dengan sebuah cluster bukan ketika itu kembali kondisional sukses = benar, tetapi ketika itu mengembalikan kesalahan seperti "sudah bergabung". <br><br>  Dan bagian terakhir dari mekanisme ini adalah integrasi controller dengan k8s.  Tampilan udara, seluruh k8 terdiri dari satu set pengontrol yang menghasilkan peristiwa dan meresponsnya.  Acara melalui antrian yang dapat kami langgani.  Secara skematis, ini dapat direpresentasikan sebagai berikut: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/094/d57/3fb/094d573fbcf511ba2eea8e707a575423.jpg"><br><br>  Pengguna memanggil <code>kubectl create -f tarantool_cluster.yaml</code> , sumber daya Cluster yang sesuai dibuat.  ClusterController diberitahu tentang penciptaan sumber daya Cluster.  Dan hal pertama yang dia coba lakukan adalah menemukan semua sumber daya Peran yang seharusnya menjadi bagian dari klaster ini.  Jika ditemukan, maka tetapkan Cluster sebagai Pemilik untuk Peran dan perbarui sumber daya Peran.  RoleController menerima pemberitahuan pembaruan Peran, melihat bahwa sumber daya memiliki Pemilik, dan mulai membuat StatefulSets.  Dan seterusnya dalam lingkaran: pemicu pertama dari yang kedua, pemicu kedua dari yang ketiga - dan seterusnya sampai seseorang berhenti.  Dan Anda juga dapat memicu tepat waktu, misalnya, setiap 5 detik, yang kadang berguna. <br><br>  Itulah keseluruhan operator: buat sumber daya khusus dan tulis kode yang merespons acara tentang sumber daya. <br><br><a name="5"></a><h2>  Apa yang dikembangkan operator </h2><br>  Tindakan operator pada akhirnya menyebabkan k8 membuat Pod dan wadah.  Di Tarantool Cartridge cluster yang digunakan pada k8s, semua Pod digabung ke dalam StatefulSets. <br><br>  Mengapa StatefulSet?  Seperti yang saya tulis sebelumnya, setiap instance Tarantool Cluster menyimpan salinan topologi dan konfigurasi cluster, dan sering kali di server aplikasi, tidak, tidak, dan mereka menggunakan semacam ruang, misalnya, pada gilirannya atau data referensi, dan ini sudah merupakan keadaan penuh .  Dan StatefulSet juga menjamin pelestarian Pod identitas, yang penting ketika mengelompokkan instance dalam sebuah cluster: identitas instance harus diperbaiki, jika tidak, kita berisiko kehilangan kuorum saat memulai kembali. <br><br>  Ketika semua sumber daya gugus dibuat dan dibawa ke keadaan yang diinginkan, mereka membentuk hierarki berikut: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e27/89f/f7e/e2789ff7e8bf174c20baf8cc077bdad2.png"><br><br>  Tanda panah menunjukkan hubungan Pemilik-Tanggungan antara sumber daya.  Adalah perlu bahwa <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Pengumpul Sampah</a> membersihkan setelah kami dalam kasus, misalnya, penghapusan Cluster. <br><br>  Selain StatefulSets, Operator Tarantool menciptakan Layanan Tanpa Kepala, yang diperlukan untuk pemilihan pemimpin, dan melalui itu, mesin virtual berkomunikasi satu sama lain. <br><br>  Di bawah kap Operator Tarantool terletak <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Kerangka Operator</a> , kode operator itu sendiri ada di golang, tidak ada yang luar biasa di sini. <br><br><a name="6"></a><h2>  Ringkasan </h2><br>  Itu saja, secara umum!  Kami menunggu umpan balik dan tiket dari Anda - di mana tanpa itu, versi alfa semuanya sama.  Apa selanjutnya  Dan kemudian ada banyak pekerjaan untuk mengingat semua ini: <br><br><ul><li>  Unit, pengujian E2E; <br></li><li>  Pengujian Chaos Monkey <br></li><li>  stress testing; <br></li><li>  backup / restore; <br></li><li>  penyedia topologi eksternal. <br></li></ul><br>  Masing-masing topik ini luas dalam dirinya sendiri dan layak untuk materi yang terpisah, tunggu pembaruan! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id465823/">https://habr.com/ru/post/id465823/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id465811/index.html">14 tips untuk menulis kode Bereaksi bersih. Bagian 1</a></li>
<li><a href="../id465813/index.html">14 tips untuk menulis kode Bereaksi bersih. Bagian 2</a></li>
<li><a href="../id465815/index.html">Para ilmuwan telah menumbuhkan kelompok sel saraf dan mengirimnya ke ISS</a></li>
<li><a href="../id465817/index.html">Bagaimana ketidaknyamanan membantu kita meningkatkan proses pengembangan.</a></li>
<li><a href="../id465819/index.html">LAN yang ideal</a></li>
<li><a href="../id465825/index.html">Direktori telepon Asterisk FreePBX dari tabel SQL (direktori berbasis web, unggah ke file XML untuk ponsel Grandstream)</a></li>
<li><a href="../id465829/index.html">[Tutorial] Cara membuat game JavaScript IDLE tambahan pertama Anda</a></li>
<li><a href="../id465833/index.html">TOKEN2 Molto-1, token perangkat keras multi-profil multi-profil pertama di dunia</a></li>
<li><a href="../id465835/index.html">Pabrik abstrak di jari</a></li>
<li><a href="../id465839/index.html">Semua yang Perlu Anda Ketahui Tentang CSS Margin</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>