<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üìé üòµ üë©‚Äçüè≠ Selektive Verkehrsprotokollierung f√ºr SOAP-Dienste üßì üßëüèø‚Äçü§ù‚Äçüßëüèº ‚ÜïÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Fast in jedem unserer Projekte, die in den Kundenservice integriert sind, werden SOAP-Services verwendet. Und in jedem solchen Projekt gibt es die Auf...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Selektive Verkehrsprotokollierung f√ºr SOAP-Dienste</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/true_engineering/blog/456712/">  Fast in jedem unserer Projekte, die in den Kundenservice integriert sind, werden SOAP-Services verwendet.  Und in jedem solchen Projekt gibt es die Aufgabe, Informationen zu protokollieren.  Wir sind besonders an der Protokollierung von Anfragen interessiert, die sich auf den Gesch√§ftsbetrieb der L√∂sung beziehen.  Beispielsweise hat ein Mitarbeiter falsche Daten eingegeben und der Service hat einen Fehler zur√ºckgegeben.  Wir m√∂chten die Details dieses Fehlers kennen und ihn so schnell wie m√∂glich korrigieren oder zur Diskussion mit dem Kunden einreichen. <br><br>  Wir m√∂chten, dass die Anfragen unseres Kunden und die Antworten des Dienstes unver√§ndert bleiben, da dies hilft, die auftretenden Probleme zu l√∂sen. <br><br>  In diesem Artikel zeigen wir, wie wir die selektive Verkehrsprotokollierung f√ºr SOAP-Dienste einrichten. <br><br><img src="https://habrastorage.org/webt/nk/td/3n/nktd3nubg20h7vjsymgsbt9nhwc.png"><br><a name="habracut"></a><br><h2>  Das Problem </h2><br>  Zun√§chst verf√ºgt Spring √ºber eine integrierte Anforderungs- und Antwortprotokollierung, die durch die Konfiguration aktiviert wird <br><br><pre><code class="java hljs">logging.level.org.springframework.ws.client.MessageTracing.sent=TRACE logging.level.org.springframework.ws.client.MessageTracing.received=TRACE</code> </pre> <br>  Das Problem ist, dass diese Einstellungen die Protokollierung des gesamten SOAP-Verkehrs umfassen.  Wir brauchen nur wenige Methoden und dann nicht vollst√§ndig.  Beispielsweise m√∂chten wir keine Anforderungen zum Herunterladen von Dateien in den Protokollen sehen, da dies eine gro√üe Datenmenge ist. <br><br>  Im Spring Framework besteht der De-facto-Standard zum Erstellen eines Seifenclients darin, WebServiceGatewaySupport zu verwenden, in dem Sie auch die Anforderungs- und Antwortverarbeitung √ºber ClientInterceptor hinzuf√ºgen k√∂nnen.  Bei seinen Methoden ist es jedoch schwierig zu verstehen, welche Methode unseres Kunden den Anruf initiiert hat.  Und es ist nicht klar, ob es notwendig ist, nur eine Anfrage, eine Antwort oder alles auf einmal zu protokollieren. <br><br><h2>  L√∂sung </h2><br>  Wir werden den Standard-ClientInterceptor verwenden, ihm jedoch die fehlenden Informationen √ºber die Methodensignatur und die Flags "Eingabe", "Ausgabe" bereitstellen, anhand derer Sie bestimmen k√∂nnen, ob die Anforderung und die Antwort protokolliert werden sollen. <br><br>  Wir reservieren sofort, dass eine solche L√∂sung bei der Streaming-Serialisierung / Deserialisierung nicht funktioniert.  Wir verwenden jedoch Axiom, bei dem die Option "Payload Caching" standardm√§√üig aktiviert ist und diese L√∂sung funktioniert. <br><br>  Struktur zum Speichern von Informationen: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> lombok.Data; <span class="hljs-meta"><span class="hljs-meta">@Data</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SoapLoggingInfo</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String method; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> input = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> output = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; }</code> </pre> <br>  Kontext zum Speichern von Informationen: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SoapLoggingContext</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> ThreadLocal&lt;SoapLoggingInfo&gt; holder = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ThreadLocal&lt;&gt;(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">set</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(SoapLoggingInfo value)</span></span></span><span class="hljs-function"> </span></span>{ holder.set(value); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> SoapLoggingInfo </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> holder.get(); } }</code> </pre> <br>  Um Informationen in einen Kontext zu stellen, verwenden wir den AOP-Ansatz mit einem ‚ÄûSlice‚Äú unter Verwendung kommentierter Methoden und einiger ‚ÄûTipps‚Äú: vor und nach dem Aufruf der Methode. <br><br>  Anmerkung zur Methode: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Target</span></span>({ElementType.METHOD}) <span class="hljs-meta"><span class="hljs-meta">@Retention</span></span>(RetentionPolicy.RUNTIME) <span class="hljs-meta"><span class="hljs-meta">@Component</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-meta"><span class="hljs-meta">@interface</span></span> SoapLoggable { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">value</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">default</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">true</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">input</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">default</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">true</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">output</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">default</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">true</span></span></span></span>; }</code> </pre> <br>  Der Aspekt selbst wurde unter Katze gestellt. <br><br><div class="spoiler">  <b class="spoiler_title">Aspekt</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Aspect</span></span> <span class="hljs-meta"><span class="hljs-meta">@Component</span></span> <span class="hljs-meta"><span class="hljs-meta">@Slf</span></span>4j <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SoapLoggingAspect</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Value</span></span>(<span class="hljs-string"><span class="hljs-string">"${logging.soap.request.enabled:false}"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Boolean enabled; <span class="hljs-meta"><span class="hljs-meta">@Pointcut</span></span>(<span class="hljs-string"><span class="hljs-string">"execution(@ru.trueengineering.agentapi.logging.SoapLoggable * *(..))"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">soapLoggableMethod</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{} <span class="hljs-meta"><span class="hljs-meta">@Before</span></span>(<span class="hljs-string"><span class="hljs-string">"soapLoggableMethod()"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">beforeSoapLoggable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(JoinPoint joinPoint)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!enabled) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } SoapLoggable soapRequestLogger = getAnnotation(joinPoint); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (soapRequestLogger.value()) { SoapLoggingInfo loggingInfo = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SoapLoggingInfo(); loggingInfo.setInput(soapRequestLogger.input()); loggingInfo.setOutput(soapRequestLogger.output()); <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Class&lt;?&gt; aClass = joinPoint.getTarget().getClass(); <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Signature signature = joinPoint.getSignature(); <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String name = signature.getName(); loggingInfo.setMethod(aClass.getSimpleName() + <span class="hljs-string"><span class="hljs-string">"."</span></span> + name); SoapLoggingContext.set(loggingInfo); } } <span class="hljs-meta"><span class="hljs-meta">@After</span></span>(<span class="hljs-string"><span class="hljs-string">"soapLoggableMethod()"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">afterSoapLoggable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(JoinPoint joinPoint)</span></span></span><span class="hljs-function"> </span></span>{ SoapLoggingContext.set(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> SoapLoggable </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getAnnotation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(JoinPoint joinPoint)</span></span></span><span class="hljs-function"> </span></span>{ MethodSignature signature = (MethodSignature) joinPoint.getSignature(); Method method = signature.getMethod(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> method.getAnnotation(SoapLoggable.class); } }</code> </pre> <br></div></div><br><h2>  Nehmen wir auseinander </h2><br>  Ein Slice ist ein Ausdruck, der "alle von SoapLogable kommentierten Methoden" bedeutet.  Wir nutzen die Funktionen von AspectJ: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Pointcut</span></span>(<span class="hljs-string"><span class="hljs-string">"execution(@ru.trueengineering.agentapi.logging.SoapLoggable * *(..))"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">soapLoggableMethod</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{}</code> </pre> <br>  Es gibt Ratschl√§ge, die vor einer Methode genannt werden, die unter eine Scheibe gefallen ist: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Before</span></span>(<span class="hljs-string"><span class="hljs-string">"soapLoggableMethod()"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">beforeSoapLoggable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(JoinPoint joinPoint)</span></span></span><span class="hljs-function"> </span></span>{}</code> </pre> <br>  Bei dieser Methode nehmen wir die Annotation, extrahieren die Methodensignatur und die Metainformationen aus der Annotation, bilden das Objekt f√ºr den ClientInterceptor und setzen es in den Kontext. <br><br>  Nach dem Aufrufen einer Methode, die unter ein Slice gefallen ist, wird ein Tipp aufgerufen: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@After</span></span>(<span class="hljs-string"><span class="hljs-string">"soapLoggableMethod()"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">afterSoapLoggable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(JoinPoint joinPoint)</span></span></span><span class="hljs-function"> </span></span>{}</code> </pre> <br>  Es l√∂scht nur den Kontext.  Eigentlich unter der Katze anmelden: <br><br><div class="spoiler">  <b class="spoiler_title">Protokollierung</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Component</span></span> <span class="hljs-meta"><span class="hljs-meta">@Slf</span></span>4j <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SoapLoggingInterceptor</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ClientInterceptorAdapter</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handleRequest</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(MessageContext messageContext)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> WebServiceClientException </span></span>{ SoapLoggingInfo info = SoapLoggingContext.get(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (info != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> &amp;&amp; info.isInput()) { ByteArrayOutputStream xml = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ByteArrayOutputStream(); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { messageContext.getRequest().writeTo(xml); log.debug(<span class="hljs-string"><span class="hljs-string">": "</span></span> + info.getMethod() + <span class="hljs-string"><span class="hljs-string">", :"</span></span> + xml.toString(StandardCharsets.UTF_8)); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (IOException e) { log.error(<span class="hljs-string"><span class="hljs-string">"  SOAP request"</span></span>, e); } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handleResponse</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(MessageContext messageContext)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> WebServiceClientException </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> handleResponseOrFault(messageContext); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handleFault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(MessageContext messageContext)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> WebServiceClientException </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> handleResponseOrFault(messageContext); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handleResponseOrFault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(MessageContext messageContext)</span></span></span><span class="hljs-function"> </span></span>{ SoapLoggingInfo info = SoapLoggingContext.get(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (info != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> &amp;&amp; info.isOutput()) { ByteArrayOutputStream xml = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ByteArrayOutputStream(); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { messageContext.getResponse().writeTo(xml); log.debug(<span class="hljs-string"><span class="hljs-string">": "</span></span> + info.getMethod() + <span class="hljs-string"><span class="hljs-string">", :"</span></span> + xml.toString(StandardCharsets.UTF_8)); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (IOException e) { log.error(<span class="hljs-string"><span class="hljs-string">"  SOAP response"</span></span>, e); } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } }</code> </pre> <br></div></div><br>  Wir verwenden die Standardmethode zum Abfangen und Verarbeiten von SOAP-Anforderungen, verwenden jedoch Informationen aus dem Kontext, um nur die von uns ben√∂tigten Methoden selektiv zu protokollieren. <br><br><h3>  Gewinn! </h3><br>  Die Verwendung dieses Ansatzes ist sehr einfach. <br><br>  M√∂chten Sie die Anfrage mit der angeh√§ngten Datei nicht sehen?  Ok! <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@SoapLoggable</span></span>(input = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Optional&lt;Osago2Response&lt;ArrayOfKeyValuePairOfstringstring&gt;&gt; attachFile( <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> AttachFileRequest attachFileRequest) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> send(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WsAttachFileRequest(attachFileRequest)); }</code> </pre><br>  Willst du alles sehen?  Es ist noch einfacher. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@SoapLoggable</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Optional&lt;Osago2Response&lt;CalcResult&gt;&gt; calculate(<span class="hljs-keyword"><span class="hljs-keyword">final</span></span> CalcRequest calcRequest) { }</code> </pre> <br><h2>  Fazit </h2><br>  In diesem Artikel wurden ihre Erfahrungen zum Konfigurieren der selektiven Verkehrsprotokollierung f√ºr SOAP-Dienste geteilt.  Dank dessen √ºberwachen wir schnell den Gesch√§ftsbetrieb und verwenden jederzeit Protokolle, um Probleme zu analysieren.  Dar√ºber hinaus k√∂nnen wir denselben Mechanismus verwenden, um die f√ºr die Ausf√ºhrung einer SOAP-Anforderung aufgewendete Zeit zu verfolgen und die Fehlerursache schnell zu lokalisieren. <br><br>  Wir teilen auch einen n√ºtzlichen Link zu diesem Thema: eine <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">kurze Reihe von Beispielen f√ºr die Verwendung von Slices und Tipps zu AspectJ</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de456712/">https://habr.com/ru/post/de456712/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de456696/index.html">Wie fallen Darlehenszinsen an und wie werden sie angewendet?</a></li>
<li><a href="../de456700/index.html">GeekUniversity er√∂ffnet Rekrutierung an der Fakult√§t f√ºr Produktmanagement</a></li>
<li><a href="../de456702/index.html">Sicherheit von mobilem OAuth 2.0</a></li>
<li><a href="../de456704/index.html">Sechs M√∂glichkeiten, wie Tester profitieren k√∂nnen (neben Funktionstests)</a></li>
<li><a href="../de456710/index.html">Was ist eine Low-Code / No-Code-Plattform und CRM, CRM +, ERP</a></li>
<li><a href="../de456714/index.html">Gleitkommazahlen verstehen (Teil 0)</a></li>
<li><a href="../de456716/index.html">Nicht sehr gro√üe Datenmengen</a></li>
<li><a href="../de456722/index.html">PostgreSQL-Rezepte: Asynchroner Taskplaner</a></li>
<li><a href="../de456730/index.html">Buch "{Sie kennen JS nicht} Typen und Grammatikkonstruktionen"</a></li>
<li><a href="../de456736/index.html">PostgreSQL-Rezepte: cURL: Abrufen, Ver√∂ffentlichen und ... E-Mail</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>