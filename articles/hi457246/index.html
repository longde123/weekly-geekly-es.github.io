<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯСИ тШЭЁЯП╝ ЁЯСйЁЯП╜тАНЁЯФм C ++ 17, tuple рдФрд░ рдлрдВрддрд╛рд╕реА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ CortexM рдкрд░ 4 LED рдХреЛ рдХреИрд╕реЗ рдмреНрд▓рд┐рдВрдХ рдХрд░реЗрдВ ЁЯНЛ ЁЯМТ ЁЯФж</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рд╕рднреА рдХреЛ рдЕрдЪреНрдЫрд╛ рд╕реНрд╡рд╛рд╕реНрдереНрдп! 

 рдЬрдм рдЫрд╛рддреНрд░реЛрдВ рдХреЛ рд╡рд┐рд╢реНрд╡рд╡рд┐рджреНрдпрд╛рд▓рдп рдореЗрдВ рдорд╛рдЗрдХреНрд░реЛрдХрдВрдЯреНрд░реЛрд▓рд░ рдХреЗ рд▓рд┐рдП рдПрдореНрдмреЗрдбреЗрдб рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ рд╡рд┐рдХрд╕рд┐рдд рдХрд░рдиреЗ рдХрд╛ рддрд░реАрдХрд╛ рд╕рд┐рдЦрд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдореИрдВ C ++...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>C ++ 17, tuple рдФрд░ рдлрдВрддрд╛рд╕реА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ CortexM рдкрд░ 4 LED рдХреЛ рдХреИрд╕реЗ рдмреНрд▓рд┐рдВрдХ рдХрд░реЗрдВ</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/457246/"> рд╕рднреА рдХреЛ рдЕрдЪреНрдЫрд╛ рд╕реНрд╡рд╛рд╕реНрдереНрдп! <br><br>  рдЬрдм рдЫрд╛рддреНрд░реЛрдВ рдХреЛ рд╡рд┐рд╢реНрд╡рд╡рд┐рджреНрдпрд╛рд▓рдп рдореЗрдВ рдорд╛рдЗрдХреНрд░реЛрдХрдВрдЯреНрд░реЛрд▓рд░ рдХреЗ рд▓рд┐рдП рдПрдореНрдмреЗрдбреЗрдб рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ рд╡рд┐рдХрд╕рд┐рдд рдХрд░рдиреЗ рдХрд╛ рддрд░реАрдХрд╛ рд╕рд┐рдЦрд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдореИрдВ C ++ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реВрдВ рдФрд░ рдХрднреА-рдХрднреА рдореИрдВ рдРрд╕реЗ рдЫрд╛рддреНрд░реЛрдВ рдХреЛ рджреЗрддрд╛ рд╣реВрдВ рдЬреЛ рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ <s>рдмреАрдорд╛рд░</s> рдЫрд╛рддреНрд░реЛрдВ рдХреА рдкрд╣рдЪрд╛рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рднреА рдкреНрд░рдХрд╛рд░ рдХреЗ рдХрд╛рд░реНрдпреЛрдВ рдореЗрдВ рд░реБрдЪрд┐ рд░рдЦрддреЗ рд╣реИрдВред <br><br>  рдПрдХ рдмрд╛рд░ рдлрд┐рд░, рдРрд╕реЗ рдЫрд╛рддреНрд░реЛрдВ рдХреЛ рдЕрддрд┐рд░рд┐рдХреНрдд рдкреБрд╕реНрддрдХрд╛рд▓рдпреЛрдВ, рдЬреИрд╕реЗ рд╕реАрдПрдордПрд╕рдЖрдИрдПрд╕ рдФрд░ рдЙрдирдХреЗ рд╣реЗрдбрд░ рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ рд░рдЬрд┐рд╕реНрдЯрд░ рд╕рдВрд░рдЪрдирд╛рдУрдВ рдХреЗ рд╡рд┐рд╡рд░рдг рдХреЗ рд╕рд╛рде рдЬреЛрдбрд╝рдиреЗ рдХреЗ рдмрд┐рдирд╛, C ++ 17 рднрд╛рд╖рд╛ рдФрд░ рдорд╛рдирдХ C ++ рдкреБрд╕реНрддрдХрд╛рд▓рдп рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ 4 рдПрд▓рдЗрдбреА рдХреЛ рдмреНрд▓рд┐рдВрдХ рдХрд░рдиреЗ рдХрд╛ рдХрд╛рд░реНрдп рджрд┐рдпрд╛ рдЧрдпрд╛, рдФрд░ рдЗрд╕реА рддрд░рд╣ ... рдХреЛрдб рдХреЗ рд╕рд╛рде рдПрдХ рдЬреАрддрддрд╛ рд╣реИред рд░реЛрдо рдореЗрдВ рд╕рдмрд╕реЗ рдЫреЛрдЯрд╛ рдЖрдХрд╛рд░ рдФрд░ рдХрдо рд╕реЗ рдХрдо рдЦрд░реНрдЪ рд╣реЛрдиреЗ рд╡рд╛рд▓реА рд░реИрдо рд╣реЛрдЧреАред  рд╕рдВрдХрд▓рдХ рдЕрдиреБрдХреВрд▓рди рдордзреНрдпрдо рд╕реЗ рдЕрдзрд┐рдХ рдирд╣реАрдВ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред  IAR рдХрдВрдкрд╛рдЗрд▓рд░ 8.40.1ред <br>  рд╡рд┐рдЬреЗрддрд╛ <s>рдХреИрдирд░реА рдЬрд╛рддрд╛ рд╣реИ рдФрд░</s> рдкрд░реАрдХреНрд╖рд╛ рдХреЗ рд▓рд┐рдП 5 рдкреНрд░рд╛рдкреНрдд рдХрд░рддрд╛ рд╣реИред <br><br>  рдЗрд╕рд╕реЗ рдкрд╣рд▓реЗ, рдореИрдВ рдЦреБрдж рднреА рдЗрд╕ рд╕рдорд╕реНрдпрд╛ рдХрд╛ рд╕рдорд╛рдзрд╛рди рдирд╣реАрдВ рдХрд░рддрд╛ рдерд╛, рдЗрд╕рд▓рд┐рдП рдореИрдВ рдЖрдкрдХреЛ рдмрддрд╛рдКрдВрдЧрд╛ рдХрд┐ рдЫрд╛рддреНрд░реЛрдВ рдиреЗ рдЗрд╕реЗ рдХреИрд╕реЗ рд╣рд▓ рдХрд┐рдпрд╛ рдФрд░ рдореЗрд░реЗ рд╕рд╛рде рдХреНрдпрд╛ рд╣реБрдЖред  рдореИрдВ рдЖрдкрдХреЛ рддреБрд░рдВрдд рдЪреЗрддрд╛рд╡рдиреА рджреЗрддрд╛ рд╣реВрдВ рдХрд┐ рдпрд╣ рд╕рдВрднрд╛рд╡рдирд╛ рдирд╣реАрдВ рд╣реИ рдХрд┐ рдЗрд╕ рддрд░рд╣ рдХреЗ рдХреЛрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рд╡рд╛рд╕реНрддрд╡рд┐рдХ рдЕрдиреБрдкреНрд░рдпреЛрдЧреЛрдВ рдореЗрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдпрд╣реА рдХрд╛рд░рдг рд╣реИ рдХрд┐ рдореИрдВрдиреЗ рдкреНрд░рдХрд╛рд╢рди рдХреЛ "рдЕрд╕рд╛рдорд╛рдиреНрдп рдкреНрд░реЛрдЧреНрд░рд╛рдорд┐рдВрдЧ" рдЕрдиреБрднрд╛рдЧ рдореЗрдВ рдкреЛрд╕реНрдЯ рдХрд┐рдпрд╛ рд╣реИ, рд╣рд╛рд▓рд╛рдВрдХрд┐ рдХреМрди рдЬрд╛рдирддрд╛ рд╣реИред <br><a name="habracut"></a><br><h3>  рдЯрд╛рд╕реНрдХ рдХреА рд╢рд░реНрддреЗрдВ </h3><br>  рдмрдВрджрд░рдЧрд╛рд╣реЛрдВ рдкрд░ 4 рдПрд▓рдЗрдбреА рд╣реИрдВ GPIOA.5, GPIOC.5, GPIOC.8, GPIOC.9ред  рдЙрдиреНрд╣реЗрдВ рдкрд▓рдХ рдЭрдкрдХрдиреЗ рдХреА рдЬрд░реВрд░рдд рд╣реИред  рддреБрд▓рдирд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреБрдЫ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдордиреЗ C рдореЗрдВ рд▓рд┐рдЦрд╛ рдХреЛрдб рд▓рд┐рдпрд╛: <br><br><pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">delay</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">1000000</span></span>; ++i){ } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(;;) { GPIOA-&gt;ODR ^= (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">5</span></span>); GPIOC-&gt;ODR ^= (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">5</span></span>); GPIOC-&gt;ODR ^= (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">8</span></span>); GPIOC-&gt;ODR ^= (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">9</span></span>); delay(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> ; }</code> </pre> <br>  рдпрд╣рд╛рдВ <code>delay()</code> рдлрд╝рдВрдХреНрд╢рди рд╢реБрджреНрдз рд░реВрдк рд╕реЗ рдФрдкрдЪрд╛рд░рд┐рдХ рд╣реИ, рдПрдХ рдирд┐рдпрдорд┐рдд рдЪрдХреНрд░ рд╣реИ, рдЗрд╕реЗ рдЕрдиреБрдХреВрд▓рд┐рдд рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред <br>  рдпрд╣ рдорд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИ рдХрд┐ рдмрдВрджрд░рдЧрд╛рд╣реЛрдВ рдХреЛ рдЖрдЙрдЯрдкреБрдЯ рдХреЗ рд▓рд┐рдП рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рдФрд░ рдЙрди рдкрд░ рдХреНрд▓реЙрдХрд┐рдВрдЧ рд▓рд╛рдЧреВ рд╣реИред <br>  рдореИрдВ рдпрд╣ рднреА рдареАрдХ рд╕реЗ рдХрд╣реВрдВрдЧрд╛ рдХрд┐ рдХреЛрдб рдХреЛ рдкреЛрд░реНрдЯреЗрдмрд▓ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдмрд┐рдЯрдмреИрдВрдЧрд┐рдВрдЧ рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред <br><br>  рдпрд╣ рдХреЛрдб рд╕реНрдЯреИрдХ рдкрд░ 8 рдмрд╛рдЗрдЯреНрд╕ рд▓реЗрддрд╛ рд╣реИ рдФрд░ рдордзреНрдпрдо рдЕрдиреБрдХреВрд▓рди рдкрд░ рд░реЛрдо рдореЗрдВ 256 рдмрд╛рдЗрдЯреНрд╕ <br><blockquote>  255 рдмрд╛рдЗрдЯреНрд╕ рдЖрд╕рд╛рдиреА рд╕реЗ рдХреЛрдб рдореЗрдореЛрд░реА <br>  рд░реАрдбрдУрдирд▓реА рдбреЗрдЯрд╛ рдореЗрдореЛрд░реА рдХреА 1 рдмрд╛рдЗрдЯ <br>  рд░реАрдбрд░рд╛рдЗрдЯрдЗрдЯ рдбреЗрдЯрд╛ рдореЗрдореЛрд░реА рдХреЗ 8 рдмрд╛рдЗрдЯреНрд╕ </blockquote><br>  255 рдмрд╛рдЗрдЯреНрд╕ рдЗрд╕ рддрдереНрдп рдХреЗ рдХрд╛рд░рдг рдХрд┐ рдореЗрдореЛрд░реА рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ рдмрд╛рдзрд┐рдд рд╡реИрдХреНрдЯрд░ рдХреА рддрд╛рд▓рд┐рдХрд╛ рдХреЗ рддрд╣рдд рдЪрд▓рд╛ рдЧрдпрд╛, рдПрдХ рдЕрд╕реНрдерд╛рдпреА рдмрд┐рдВрджреБ рдмреНрд▓реЙрдХ рдХреЛ рдЖрд░рдореНрдн рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП IAR рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдХреЙрд▓ рдХрд░рддрд╛ рд╣реИ, рд╕рднреА рдкреНрд░рдХрд╛рд░ рдХреЗ рдбрд┐рдмрдЧрд┐рдВрдЧ рдлрд╝рдВрдХреНрд╢рди рдФрд░ __low_level_init рдлрд╝рдВрдХреНрд╢рди, рдЬрд╣рд╛рдВ рдкреЛрд░реНрдЯ рд╕реНрд╡рдпрдВ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдП рдЧрдП рдереЗред <br><br>  рддреЛ, рдкреВрд░реА рдЖрд╡рд╢реНрдпрдХрддрд╛рдПрдВ рд╣реИрдВ: <br><br><ul><li>  рдореБрдЦреНрдп () рдлрд╝рдВрдХреНрд╢рди рдореЗрдВ рдпрдерд╛рд╕рдВрднрд╡ рдХрдо рдХреЛрдб рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП </li><li>  рдЖрдк рдореИрдХреНрд░реЛрдЬрд╝ рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ </li><li>  IAR 8.40.1 рд╕рдВрдХрд▓рдХ C ++ 17 рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИ </li><li>  CMSIS рд╣реЗрдбрд░ рдлрд╛рдЗрд▓ рдЬреИрд╕реЗ "#include" stm32f411xe.h "рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ </li><li>  рдЖрдк рдЗрдирд▓рд╛рдЗрди рдлрд╝рдВрдХреНрд╢рди рдХреЗ рд▓рд┐рдП __forceinline рдирд┐рд░реНрджреЗрд╢ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ </li><li>  рдордзреНрдпрдо рд╕рдВрдХрд▓рдХ рдЕрдиреБрдХреВрд▓рди </li></ul><br><h3>  рдЫрд╛рддреНрд░реЛрдВ рдХрд╛ рдлреИрд╕рд▓рд╛ </h3><br>  рд╕рд╛рдорд╛рдиреНрдп рддреМрд░ рдкрд░, рдХрдИ рд╕рдорд╛рдзрд╛рди рдереЗ, рдореИрдВ рдХреЗрд╡рд▓ рдПрдХ рджрд┐рдЦрд╛рдКрдВрдЧрд╛ ... рдпрд╣ рдЗрд╖реНрдЯрддрдо рдирд╣реАрдВ рд╣реИ, рд▓реЗрдХрд┐рди рдореБрдЭреЗ рдпрд╣ рдкрд╕рдВрдж рдЖрдпрд╛ред <br><br>  рдЪреВрдВрдХрд┐ рд╣реЗрдбрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЫрд╛рддреНрд░реЛрдВ рдиреЗ рд╕рдмрд╕реЗ рдкрд╣рд▓рд╛ рдХрд╛рдо <code>Gpio</code> рд╡рд░реНрдЧ рдХрд╛ рдХрд┐рдпрд╛ рд╣реИ, рдЬрд┐рд╕реЗ рдЕрдкрдиреЗ рдкрддреЗ рдкрд░ рдкреЛрд░реНрдЯ рд░рдЬрд┐рд╕реНрдЯрд░реЛрдВ рдХреЗ рд▓рд┐рдП рдПрдХ рд▓рд┐рдВрдХ рд╕реНрдЯреЛрд░ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред  рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╡реЗ рдПрдХ рд╕рдВрд░рдЪрдирд╛ рдУрд╡рд░рд▓реЗ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ, рд╕рдмрд╕реЗ рдЕрдзрд┐рдХ рд╕рдВрднрд╛рд╡рдирд╛ рд╣реИ рдХрд┐ рд╡реЗ рдпрд╣рд╛рдВ рд╕реЗ рд╡рд┐рдЪрд╛рд░ рд▓реЗрддреЗ рд╣реИрдВ: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╕рдВрд░рдЪрдирд╛ рдУрд╡рд░рд▓реЗ</a> : <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Gpio</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: __<span class="hljs-function"><span class="hljs-function">forceinline </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Toggle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint8_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> bitNum)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">volatile</span></span></span><span class="hljs-function"> </span></span>{ Odr ^= bitNum ; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">volatile</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> Moder; <span class="hljs-keyword"><span class="hljs-keyword">volatile</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> Otyper; <span class="hljs-keyword"><span class="hljs-keyword">volatile</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> Ospeedr; <span class="hljs-keyword"><span class="hljs-keyword">volatile</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> Pupdr; <span class="hljs-keyword"><span class="hljs-keyword">volatile</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> Idr; <span class="hljs-keyword"><span class="hljs-keyword">volatile</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> Odr; <span class="hljs-comment"><span class="hljs-comment">//    static_assert(sizeof(Gpio) == sizeof(std::uint32_t) * 6); } ;</span></span></code> </pre> <br>  рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ, рдЙрдиреНрд╣реЛрдВрдиреЗ рддреБрд░рдВрдд <code>Gpio</code> рд╡рд░реНрдЧ рдХреА рдкрд╣рдЪрд╛рди рдЙрди рд╡рд┐рд╢реЗрд╖рддрд╛рдУрдВ рдХреЗ рд╕рд╛рде рдХреА рдЬреЛ рд╕рдВрдмрдВрдзрд┐рдд рд░рдЬрд┐рд╕реНрдЯрд░реЛрдВ рдХреЗ рдкрддреЗ рдкрд░ рд╕реНрдерд┐рдд рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдП рдФрд░ рдкреИрд░реЛрдВ рдХреА рд╕рдВрдЦреНрдпрд╛ рд╕реЗ рд░рд╛рдЬреНрдп рдХреЛ рд╕реНрд╡рд┐рдЪ рдХрд░рдиреЗ рдХреА рдПрдХ рд╡рд┐рдзрд┐: <br>  рдлрд┐рд░ рд╣рдордиреЗ <code>GpioPin</code> рд▓рд┐рдП рд╕рдВрд░рдЪрдирд╛ рдХреЛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд┐рд╕рдореЗрдВ <code>GpioPin</code> рдХреЛ рд╕реВрдЪрдХ рдФрд░ рдкреИрд░ рдХреА рд╕рдВрдЦреНрдпрд╛ рд╢рд╛рдорд┐рд▓ рд╣реИ: <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GpioPin</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">volatile</span></span> Gpio* port ; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> pinNum ; } ;</code> </pre> <br>  рдлрд┐рд░ рдЙрдиреНрд╣реЛрдВрдиреЗ рдПрд▓рдЗрдбреА рдХреА рдПрдХ рд╕рд░рдгреА рдмрдирд╛рдИ рдЬреЛ рдкреЛрд░реНрдЯ рдХреЗ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдкреИрд░реЛрдВ рдкрд░ рдмреИрдарддреА рд╣реИ рдФрд░ рдкреНрд░рддреНрдпреЗрдХ рдПрд▓рдИрдбреА рдХреЗ <code>Toggle()</code> рд╡рд┐рдзрд┐ рдХреЛ рдХреЙрд▓ рдХрд░рдХреЗ рдЙрд╕ рдкрд░ рдЪрд▓реА рдЧрдИ: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> GpioPin leds[] = {{<span class="hljs-keyword"><span class="hljs-keyword">reinterpret_cast</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">volatile</span></span> Gpio*&gt;(GpioaBaseAddr), <span class="hljs-number"><span class="hljs-number">5</span></span>}, {<span class="hljs-keyword"><span class="hljs-keyword">reinterpret_cast</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">volatile</span></span> Gpio*&gt;(GpiocBaseAddr), <span class="hljs-number"><span class="hljs-number">5</span></span>}, {<span class="hljs-keyword"><span class="hljs-keyword">reinterpret_cast</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">volatile</span></span> Gpio*&gt;(GpiocBaseAddr), <span class="hljs-number"><span class="hljs-number">9</span></span>}, {<span class="hljs-keyword"><span class="hljs-keyword">reinterpret_cast</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">volatile</span></span> Gpio*&gt;(GpiocBaseAddr), <span class="hljs-number"><span class="hljs-number">9</span></span>} } ; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LedsDriver</span></span></span><span class="hljs-class"> {</span></span> __<span class="hljs-function"><span class="hljs-function">forceinline </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ToggelAll</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">auto</span></span>&amp; it: leds) { it.port-&gt;Toggle(it.pinNum); } } } ;</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">рдЦреИрд░, рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдкреВрд░реЗ рдХреЛрдб:</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">constexpr</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> GpioaBaseAddr = <span class="hljs-number"><span class="hljs-number">0x4002'0000</span></span> ; <span class="hljs-keyword"><span class="hljs-keyword">constexpr</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> GpiocBaseAddr = <span class="hljs-number"><span class="hljs-number">0x4002'0800</span></span> ; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Gpio</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: __<span class="hljs-function"><span class="hljs-function">forceinline </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Toggle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint8_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> bitNum)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">volatile</span></span></span><span class="hljs-function"> </span></span>{ Odr ^= bitNum ; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">volatile</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> Moder; <span class="hljs-keyword"><span class="hljs-keyword">volatile</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> Otyper; <span class="hljs-keyword"><span class="hljs-keyword">volatile</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> Ospeedr; <span class="hljs-keyword"><span class="hljs-keyword">volatile</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> Pupdr; <span class="hljs-keyword"><span class="hljs-keyword">volatile</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> Idr; <span class="hljs-keyword"><span class="hljs-keyword">volatile</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> Odr; } ; <span class="hljs-comment"><span class="hljs-comment">//    static_assert(sizeof(Gpio) == sizeof(std::uint32_t) * 6); struct GpioPin { volatile Gpio* port ; std::uint32_t pinNum ; } ; const GpioPin leds[] = {{reinterpret_cast&lt;volatile Gpio*&gt;(GpioaBaseAddr), 5}, {reinterpret_cast&lt;volatile Gpio*&gt;(GpiocBaseAddr), 5}, {reinterpret_cast&lt;volatile Gpio*&gt;(GpiocBaseAddr), 9}, {reinterpret_cast&lt;volatile Gpio*&gt;(GpiocBaseAddr), 9} } ; struct LedsDriver { __forceinline static inline void ToggelAll() { for (auto&amp; it: leds) { it.port-&gt;Toggle(it.pinNum); } } } ; int main() { for(;;) { LedsContainer::ToggleAll() ; delay(); } return 0 ; }</span></span></code> </pre> <br></div></div><br>  рдордзреНрдпрдо рдЕрдиреБрдХреВрд▓рди рдкрд░ рдЙрдирдХреЗ рдХреЛрдб рдХреЗ рдЖрдБрдХрдбрд╝реЗ: <br><blockquote>  рд░реАрдбрдСрдирд▓реА рдХреЛрдб рдореЗрдореЛрд░реА рдХреЗ 275 рдмрд╛рдЗрдЯреНрд╕ <br>  рд░реАрдбрдУрдирд▓реА рдбреЗрдЯрд╛ рдореЗрдореЛрд░реА рдХреА 1 рдмрд╛рдЗрдЯ <br>  рд░реАрдбрд░рд╛рдЗрдЯрдЗрдЯ рдбреЗрдЯрд╛ рдореЗрдореЛрд░реА рдХреЗ 8 рдмрд╛рдЗрдЯреНрд╕ </blockquote><br>  рдПрдХ рдЕрдЪреНрдЫрд╛ рд╕рдорд╛рдзрд╛рди рд╣реИ, рд▓реЗрдХрд┐рди рдпрд╣ рдмрд╣реБрдд рд╕рд╛рд░реА рдореЗрдореЛрд░реА рд▓реЗрддрд╛ рд╣реИ :) <br><br><h3>  рдореЗрд░рд╛ рдлреИрд╕рд▓рд╛ </h3><br>  рдмреЗрд╢рдХ, рдореИрдВрдиреЗ рд╕рд░рд▓ рддрд░реАрдХреЛрдВ рдХреА рддрд▓рд╛рд╢ рдирд╣реАрдВ рдХрд░рдиреЗ рдХрд╛ рдлреИрд╕рд▓рд╛ рдХрд┐рдпрд╛ рдФрд░ рдЧрдВрднреАрд░ рд░реВрдк рд╕реЗ рдЕрднрд┐рдирдп рдХрд░рдиреЗ рдХрд╛ рдлреИрд╕рд▓рд╛ рдХрд┐рдпрд╛ :)ред <br>  рдПрд▓рдИрдбреА рд╡рд┐рднрд┐рдиреНрди рдмрдВрджрд░рдЧрд╛рд╣реЛрдВ рдФрд░ рд╡рд┐рднрд┐рдиреНрди рдкреИрд░реЛрдВ рдкрд░ рд╣реИрдВред  <code>Port</code> рдХреНрд▓рд╛рд╕ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ рд╕рдмрд╕реЗ рдкрд╣рд▓реА рдЪреАрдЬ рдЪрд╛рд╣рд┐рдП, рд▓реЗрдХрд┐рди рд░реИрдо рд▓реЗрдиреЗ рд╡рд╛рд▓реЗ рдкреЙрдЗрдВрдЯрд░реНрд╕ рдФрд░ рд╡реЗрд░рд┐рдПрдмрд▓реНрд╕ рд╕реЗ рдЫреБрдЯрдХрд╛рд░рд╛ рдкрд╛рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рд╕реНрдЯреИрдЯрд┐рдХ рддрд░реАрдХреЛрдВ рдХрд╛ рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред  рдмрдВрджрд░рдЧрд╛рд╣ рд╡рд░реНрдЧ рдЗрд╕ рддрд░рд╣ рджрд┐рдЦ рд╕рдХрддрд╛ рд╣реИ: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> addr&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Port</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-comment"><span class="hljs-comment">//  -  };</span></span></code> </pre> <br>  рдЯреЗрдореНрдкреНрд▓реЗрдЯ рдкреИрд░рд╛рдореАрдЯрд░ рдХреЗ рд░реВрдк рдореЗрдВ, рдЗрд╕рдХрд╛ рдПрдХ рдкреЛрд░реНрдЯ рдПрдбреНрд░реЗрд╕ рд╣реЛрдЧрд╛ред  <code>"#include "stm32f411xe.h"</code> , рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдкреЛрд░реНрдЯ A рдХреЗ рд▓рд┐рдП, рдЗрд╕реЗ GPIOA_BASE рдХреЗ рд░реВрдк рдореЗрдВ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред рд▓реЗрдХрд┐рди рд╣рдореЗрдВ рд╣реЗрдбрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдирд╣реАрдВ рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╣рдореЗрдВ рдХреЗрд╡рд▓ рдЕрдкрдирд╛ рд╕реНрд╡рдпрдВ рдХрд╛ рдирд┐рд░рдВрддрд░ рдмрдирд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред рдкрд░рд┐рдгрд╛рдорд╕реНрд╡рд░реВрдк, рд╡рд░реНрдЧ рдХрд╛ рдЙрдкрдпреЛрдЧ рдЗрд╕ рддрд░рд╣ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">constexpr</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> GpioaBaseAddr = <span class="hljs-number"><span class="hljs-number">0x4002'0000</span></span> ; <span class="hljs-keyword"><span class="hljs-keyword">constexpr</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> GpiocBaseAddr = <span class="hljs-number"><span class="hljs-number">0x4002'0800</span></span> ; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> PortA = Port&lt;GpioaBaseAddr&gt; ; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> PortC = Port&lt;GpiocBaseAddr&gt; ;</code> </pre><br>  рдмреНрд▓рд┐рдВрдХ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рдЯреЙрдЧрд▓ рд╡рд┐рдзрд┐ (const st :: uint8_t bit) рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ, рдЬреЛ рдПрдХ рд╡рд┐рд╢реЗрд╖ рдпрд╛ рдСрдкрд░реЗрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЖрд╡рд╢реНрдпрдХ рдмрд┐рдЯ рдХреЛ рд╕реНрд╡рд┐рдЪ рдХрд░реЗрдЧрд╛ред  рд╡рд┐рдзрд┐ рд╕реНрдерд┐рд░ рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдП, рдЗрд╕реЗ рдХрдХреНрд╖рд╛ рдореЗрдВ рдЬреЛрдбрд╝реЗрдВ: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> addr&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Port</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-comment"><span class="hljs-comment">//   __forceinline,        __forceinline inline static void Toggle(const std::uint8_t bitNum) { *reinterpret_cast&lt;std::uint32_t*&gt;(addr+20) ^= (1 &lt;&lt; bitNum) ; //addr + 20  ODR  } };</span></span></code> </pre> <br>  рдЙрддреНрдХреГрд╖реНрдЯ <code>Port&lt;&gt;</code> рд╣реИ, рдпрд╣ рдкреИрд░реЛрдВ рдХреА рд╕реНрдерд┐рддрд┐ рдХреЛ рд╕реНрд╡рд┐рдЪ рдХрд░ рд╕рдХрддрд╛ рд╣реИред  рдПрд▓рдИрдбреА рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдкреИрд░ рдкрд░ рдмреИрдарддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдХреНрд▓рд╛рд╕ <code>Pin</code> рдмрдирд╛рдирд╛ рддрд░реНрдХрд╕рдВрдЧрдд рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рдЯреЗрдореНрдкрд▓реЗрдЯ рдкреИрд░рд╛рдореАрдЯрд░ рдХреЗ рд░реВрдк рдореЗрдВ <code>Port&lt;&gt;</code> рдФрд░ рд▓реЗрдЧ рдирдВрдмрд░ рд╣реЛрдЧрд╛ред  рдЪреВрдВрдХрд┐ <code>Port&lt;&gt;</code> рдкреНрд░рдХрд╛рд░ рдЯреЗрдореНрдкрд▓реЗрдЯ рд╣реИ, рдЕрд░реНрдерд╛рдд  рд╡рд┐рднрд┐рдиреНрди рдмрдВрджрд░рдЧрд╛рд╣реЛрдВ рдХреЗ рд▓рд┐рдП рдЕрд▓рдЧ, рд╣рдо рдХреЗрд╡рд▓ рд╕рд╛рд░реНрд╡рднреМрдорд┐рдХ рдкреНрд░рдХрд╛рд░ рдЯреА рдкреНрд░рд╕рд╛рд░рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> T, <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> pinNum&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Pin</span></span></span><span class="hljs-class"> {</span></span> __<span class="hljs-function"><span class="hljs-function">forceinline </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Toggle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ T::Toggle(pinNum) ; } } ;</code> </pre> <br>  рдпрд╣ рдмреБрд░рд╛ рд╣реИ рдХрд┐ рд╣рдо рдХрд┐рд╕реА рднреА рдкреНрд░рдХрд╛рд░ рдХреЗ <code>T</code> рдХреЛ рдкрд╛рд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд┐рд╕рдореЗрдВ <code>Toggle()</code> рд╡рд┐рдзрд┐ рд╣реИ рдФрд░ рдпрд╣ рдХрд╛рдо рдХрд░реЗрдЧрд╛, рд╣рд╛рд▓рд╛рдВрдХрд┐ рдпрд╣ рдорд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИ рдХрд┐ рд╣рдореЗрдВ рдХреЗрд╡рд▓ <code>Port&lt;&gt;</code> рдЯрд╛рдЗрдк рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред  рдЗрд╕рд╕реЗ <code>PortBase</code> рдХреЛ рдмрдЪрд╛рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо <code>PortBase</code> рдмреЗрд╕ рдХреНрд▓рд╛рд╕ рд╕реЗ <code>Port&lt;&gt;</code> рдЗрдирд╣реЗрд░рд┐рдЯ рдХрд░реЗрдВрдЧреЗ, рдФрд░ рдЯреЗрдореНрдкреНрд▓реЗрдЯ рдореЗрдВ рд╣рдо рдпрд╣ рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░реЗрдВрдЧреЗ рдХрд┐ рд╣рдорд╛рд░рд╛ рдкрд╛рд╕ рдЯрд╛рдЗрдк рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ <code>PortBase</code> рдкрд░ рдЖрдзрд╛рд░рд┐рдд рд╣реИред  рд╣рдо рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреНрд░рд╛рдкреНрдд рдХрд░рддреЗ рд╣реИрдВ: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">constexpr</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> OdrAddrShift = <span class="hljs-number"><span class="hljs-number">20U</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PortBase</span></span></span><span class="hljs-class"> {</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> addr&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Port</span></span></span><span class="hljs-class">:</span></span> PortBase { __<span class="hljs-function"><span class="hljs-function">forceinline </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Toggle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint8_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> bit)</span></span></span><span class="hljs-function"> </span></span>{ *<span class="hljs-keyword"><span class="hljs-keyword">reinterpret_cast</span></span>&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span>*&gt;(addr ) ^= (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; bit) ; } }; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> T, <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> pinNum, <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">typename</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">std</span></span></span><span class="hljs-class">:</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">enable_if_t</span></span>&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::is_base_of&lt;PortBase, T&gt;::value&gt;&gt; <span class="hljs-comment"><span class="hljs-comment">//   struct Pin { __forceinline inline static void Toggle() { T::Toggle(pinNum) ; } } ;</span></span></code> </pre> <br>  рдЕрдм рдЯреЗрдореНрдкреНрд▓реЗрдЯ рдХреЛ рдХреЗрд╡рд▓ рддрднреА <code>PortBase</code> рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬрдм рд╣рдорд╛рд░реА рдХрдХреНрд╖рд╛ рдореЗрдВ рдмреЗрд╕ рдХреНрд▓рд╛рд╕ <code>PortBase</code> ред <br>  рд╕рд┐рджреНрдзрд╛рдВрдд рд░реВрдк рдореЗрдВ, рдЖрдк рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдЗрди рд╡рд░реНрдЧреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЖрдЗрдП рджреЗрдЦреЗрдВ рдХрд┐ рдЕрдиреБрдХреВрд▓рди рдХреЗ рдмрд┐рдирд╛ рдХреНрдпрд╛ рд╣реЛрддрд╛ рд╣реИ: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> PortA = Port&lt;GpioaBaseAddr&gt; ; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> PortC = Port&lt;GpiocBaseAddr&gt; ; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Led1 = Pin&lt;PortA, <span class="hljs-number"><span class="hljs-number">5</span></span>&gt; ; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Led2 = Pin&lt;PortC, <span class="hljs-number"><span class="hljs-number">5</span></span>&gt; ; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Led3 = Pin&lt;PortC, <span class="hljs-number"><span class="hljs-number">8</span></span>&gt; ; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Led4 = Pin&lt;PortC, <span class="hljs-number"><span class="hljs-number">9</span></span>&gt; ; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(;;) { Led1::Toggle(); Led2::Toggle(); Led3::Toggle(); Led4::Toggle(); delay(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> ; }</code> </pre> <br><blockquote>  рдЖрд╕рд╛рдиреА рд╕реЗ рдХреЛрдб рдореЗрдореЛрд░реА рдХреА 271 рдмрд╛рдЗрдЯреНрд╕ <br>  рд░реАрдбрдУрдирд▓реА рдбреЗрдЯрд╛ рдореЗрдореЛрд░реА рдХреА 1 рдмрд╛рдЗрдЯ <br>  рд░реАрдбрд░рд╛рдИрдЯ рдбреЗрдЯрд╛ рдореЗрдореЛрд░реА рдХреЗ 24 рдмрд╛рдЗрдЯреНрд╕ </blockquote><br>  рд░реИрдо рдореЗрдВ рдпреЗ рдЕрддрд┐рд░рд┐рдХреНрдд 16 рдмрд╛рдЗрдЯ рдФрд░ рд░реЛрдо рдореЗрдВ 16 рдмрд╛рдЗрдЯреНрд╕ рдХрд╣рд╛рдВ рд╕реЗ рдЖрдПред  рд╡реЗ рдЗрд╕ рддрдереНрдп рд╕реЗ рдЖрдП рдереЗ рдХрд┐ рд╣рдо рдкреЛрд░реНрдЯ рдХреНрд▓рд╛рд╕ рдХреЗ рдЯреЙрдЧрд▓ рдлрд╝рдВрдХреНрд╢рди (const std :: uint8_t bit) рдХреЗ рдмрд┐рдЯ рдкреИрд░рд╛рдореАрдЯрд░ рдХреЛ рдкрд╛рд╕ рдХрд░рддреЗ рд╣реИрдВ, рдФрд░ рдХрдВрдкрд╛рдЗрд▓рд░, рдЬрдм рдореБрдЦреНрдп рдлрд╝рдВрдХреНрд╢рди рдореЗрдВ рдкреНрд░рд╡реЗрд╢ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рд╕реНрдЯреИрдХ рдкрд░ 4 рдЕрддрд┐рд░рд┐рдХреНрдд рд░рдЬрд┐рд╕реНрдЯрд░реЛрдВ рдХреЛ рдмрдЪрд╛рддрд╛ рд╣реИ рдЬрд┐рд╕рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдпрд╣ рдкреИрд░рд╛рдореАрдЯрд░ рдЧреБрдЬрд░рддрд╛ рд╣реИ, рдлрд┐рд░ рдЗрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ рд░рдЬрд┐рд╕реНрдЯрд░ рдЬрд┐рд╕рдореЗрдВ рдкреНрд░рддреНрдпреЗрдХ рдкрд┐рди рдХреЗ рд▓рд┐рдП рд▓реЗрдЧ рдирдВрдмрд░ рдХреЗ рдорд╛рди рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ рдФрд░ рдЬрдм рдореБрдЦреНрдп рдЫреЛрдбрд╝рддреЗ рд╣реИрдВ рддреЛ рд╕реНрдЯреИрдХ рд╕реЗ рдЗрди рд░рдЬрд┐рд╕реНрдЯрд░реЛрдВ рдХреЛ рдкреБрдирд░реНрд╕реНрдерд╛рдкрд┐рдд рдХрд░рддреЗ рд╣реИрдВред  рдФрд░ рд╣рд╛рд▓рд╛рдВрдХрд┐ рд╕рдВрдХреНрд╖реЗрдк рдореЗрдВ рдпрд╣ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдмреЗрдХрд╛рд░ рдХрд╛рдо рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдлрдВрдХреНрд╢рдВрд╕ рдореЗрдВ рдХрд╛рдо рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдХрдВрдкрд╛рдЗрд▓рд░ рдорд╛рдирдХ рдХреЗ рдЕрдиреБрд╕рд╛рд░ рдкреВрд░реНрдг рд░реВрдк рд╕реЗ рдХрд╛рд░реНрдп рдХрд░рддрд╛ рд╣реИред <br>  рдЖрдк рдкреЛрд░реНрдЯ рдХреНрд▓рд╛рд╕ рдХреЛ рд╕рд╛рдорд╛рдиреНрдп рд░реВрдк рд╕реЗ рдирд┐рдХрд╛рд▓рдХрд░, <code>Pin</code> рдХреНрд▓рд╛рд╕ рдХреЗ рд▓рд┐рдП рдЯреЗрдореНрдкреНрд▓реЗрдЯ рдкреИрд░рд╛рдореАрдЯрд░ рдХреЗ рд░реВрдк рдореЗрдВ рдкреЛрд░реНрдЯ рдПрдбреНрд░реЗрд╕, рдФрд░ <code>Toggle()</code> рд╡рд┐рдзрд┐ рдХреЗ рдЕрдВрджрд░ рд╕реЗ рдЫреБрдЯрдХрд╛рд░рд╛ рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ, рдУрдбреАрдЖрд░ рд░рдЬрд┐рд╕реНрдЯрд░ рдХреЗ рдкрддреЗ рдХреА рдЧрдгрдирд╛ рдХрд░реЗрдВ: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">constexpr</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> OdrAddrShift = <span class="hljs-number"><span class="hljs-number">20U</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> addr, <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> pinNum, <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Pin</span></span></span><span class="hljs-class"> {</span></span> __<span class="hljs-function"><span class="hljs-function">forceinline </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Toggle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ *<span class="hljs-keyword"><span class="hljs-keyword">reinterpret_cast</span></span>&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span>*&gt;(addr + OdrAddrShift ) ^= (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; bit) ; } } ; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Led1 = Pin&lt;GpioaBaseAddr, <span class="hljs-number"><span class="hljs-number">5</span></span>&gt; ;</code> </pre> <br>  рд▓реЗрдХрд┐рди рдпрд╣ рдмрд╣реБрдд рдЕрдЪреНрдЫрд╛ рдФрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдЕрдиреБрдХреВрд▓ рдирд╣реАрдВ рджрд┐рдЦрддрд╛ рд╣реИред  рдЗрд╕рд▓рд┐рдП, рд╣рдореЗрдВ рдЙрдореНрдореАрдж рд╣реИ рдХрд┐ рд╕рдВрдХрд▓рдХ рдЗрд╕ рдЕрдирд╛рд╡рд╢реНрдпрдХ рд░рдЬрд┐рд╕реНрдЯрд░ рд╕рдВрд░рдХреНрд╖рдг рдХреЛ рдереЛрдбрд╝рд╛ рдЕрдиреБрдХреВрд▓рди рдХреЗ рд╕рд╛рде рд╣рдЯрд╛ рджреЗрддрд╛ рд╣реИред <br><br>  рд╣рдо рдордзреНрдпрдо рдкрд░ рдЕрдиреБрдХреВрд▓рди рдбрд╛рд▓рддреЗ рд╣реИрдВ рдФрд░ рдкрд░рд┐рдгрд╛рдо рджреЗрдЦрддреЗ рд╣реИрдВ: <br><blockquote>  251 рдмрд╛рдЗрдЯреНрд╕ рдХреЛрдб рдореЗрдореЛрд░реА рдХреА рдмрд╛рдЗрдЯ <br>  рд░реАрдбрдУрдирд▓реА рдбреЗрдЯрд╛ рдореЗрдореЛрд░реА рдХреА 1 рдмрд╛рдЗрдЯ <br>  рд░реАрдбрд░рд╛рдЗрдЯрдЗрдЯ рдбреЗрдЯрд╛ рдореЗрдореЛрд░реА рдХреЗ 8 рдмрд╛рдЗрдЯреНрд╕ </blockquote><br>  рд╡рд╛рд╣ рд╡рд╛рд╣ рд╡рд╛рд╣ ... рд╣рдорд╛рд░реЗ рдкрд╛рд╕ 4 рдмрд╛рдЗрдЯреНрд╕ рдХрдо рд╣реИрдВ <div class="spoiler">  <b class="spoiler_title">sishnogo рдХреЛрдб</b> <div class="spoiler_text"><blockquote>  255 рдмрд╛рдЗрдЯреНрд╕ рдЖрд╕рд╛рдиреА рд╕реЗ рдХреЛрдб рдореЗрдореЛрд░реА <br>  рд░реАрдбрдУрдирд▓реА рдбреЗрдЯрд╛ рдореЗрдореЛрд░реА рдХреА 1 рдмрд╛рдЗрдЯ <br>  рд░реАрдбрд░рд╛рдЗрдЯрдЗрдЯ рдбреЗрдЯрд╛ рдореЗрдореЛрд░реА рдХреЗ 8 рдмрд╛рдЗрдЯреНрд╕ </blockquote><br></div></div><br>  рдпрд╣ рдХреИрд╕реЗ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ?  рдЖрдЗрдП рд╕реА + рдХреЛрдб (рдмрд╛рдПрдВ) рдФрд░ рд╕реА рдХреЛрдб (рджрд╛рдПрдВ) рдХреЗ рд▓рд┐рдП рдбрд┐рдмрдЧрд░ рдореЗрдВ рдХреЛрдбрд╛рдВрддрд░рдХ рдкрд░ рдПрдХ рдирдЬрд╝рд░ рдбрд╛рд▓реЗрдВ: <br><br><img src="https://habrastorage.org/webt/vh/ym/d9/vhymd9hbcko9luonsasg-xz7w7e.png" alt="рдЫрд╡рд┐"><br><br>  рдпрд╣ рджреЗрдЦрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдХрд┐, рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рдХрдВрдкрд╛рдЗрд▓рд░ рдиреЗ рд╕рднреА рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рдмрд┐рд▓реНрдЯ-рдЗрди рдХрд┐рдпрд╛, рдЕрдм рдЗрд╕рдореЗрдВ рдХреЛрдИ рдХреЙрд▓ рдирд╣реАрдВ рд╣реИ, рдФрд░ рджреВрд╕рд░реА рдмрд╛рдд, рдпрд╣ рд░рдЬрд┐рд╕реНрдЯрд░реЛрдВ рдХреЗ рдЙрдкрдпреЛрдЧ рдХреЛ рдЕрдиреБрдХреВрд▓рд┐рдд рдХрд░рддрд╛ рд╣реИред  рдпрд╣ рджреЗрдЦрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рд╕реА рдХреЛрдб рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ, рдХрдВрдкрд╛рдЗрд▓рд░ рдпрд╛ рддреЛ R1 рдпрд╛ R2 рд░рдЬрд┐рд╕реНрдЯрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдкреЛрд░реНрдЯ рдПрдбреНрд░реЗрд╕ рдХреЛ рд╕реНрдЯреЛрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░рддрд╛ рд╣реИ рдФрд░ рд╣рд░ рдмрд╛рд░ рдмрд┐рдЯ рд╕реНрд╡рд┐рдЪ рд╣реЛрдиреЗ рдкрд░ рдЕрддрд┐рд░рд┐рдХреНрдд рдСрдкрд░реЗрд╢рди рдХрд░рддрд╛ рд╣реИ (рд░рдЬрд┐рд╕реНрдЯрд░ рдореЗрдВ рдПрдбреНрд░реЗрд╕ рдХреЛ R1 рдпрд╛ R2 рдореЗрдВ рд╕рд╣реЗрдЬреЗрдВ)ред  рджреВрд╕рд░реЗ рдорд╛рдорд▓реЗ рдореЗрдВ, рдпрд╣ рдХреЗрд╡рд▓ рдЖрд░ 1 рд░рдЬрд┐рд╕реНрдЯрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ, рдФрд░ рдЪреВрдВрдХрд┐ рд╕реНрд╡рд┐рдЪрд┐рдВрдЧ рдХреЗ рд▓рд┐рдП рдЕрдВрддрд┐рдо 3 рдХреЙрд▓ рд╣рдореЗрд╢рд╛ рдкреЛрд░реНрдЯ рд╕реА рд╕реЗ рд╣реЛрддреЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рд░рдЬрд┐рд╕реНрдЯрд░ рдореЗрдВ рд╕рдорд╛рди рдкреЛрд░реНрдЯ рд╕реА рдкрддреЗ рдХреЛ рдмрдЪрд╛рдиреЗ рдХреА рдХреЛрдИ рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИред  рдирддреАрдЬрддрди, 2 рдЯреАрдо рдФрд░ 4 рдмрд╛рдЗрдЯреНрд╕ рдмрдЪрд╛рдП рдЬрд╛рддреЗ рд╣реИрдВред <br><br>  рдпрд╣рд╛рдБ рдпрд╣ рдЖрдзреБрдирд┐рдХ рд╕рдВрдХрд▓рдХ рдХрд╛ рдПрдХ рдЪрдорддреНрдХрд╛рд░ рд╣реИ :) рдареАрдХ рд╣реИ, рдареАрдХ рд╣реИред  рд╕рд┐рджреНрдзрд╛рдВрдд рд░реВрдк рдореЗрдВ, рдХреЛрдИ рднреА рд╡рд╣рд╛рдВ рд░реБрдХ рд╕рдХрддрд╛ рдерд╛, рд▓реЗрдХрд┐рди рдЪрд▓реЛ рдЖрдЧреЗ рдмрдврд╝рддреЗ рд╣реИрдВред  рдореБрдЭреЗ рдирд╣реАрдВ рд▓рдЧрддрд╛ рдХрд┐ рдпрд╣ рдХрд┐рд╕реА рдФрд░ рдЪреАрдЬрд╝ рдХреЛ рдЕрдиреБрдХреВрд▓рд┐рдд рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реЛрдЧрд╛, рд╣рд╛рд▓рд╛рдВрдХрд┐ рдпрд╣ рд╢рд╛рдпрдж рд╕рд╣реА рдирд╣реАрдВ рд╣реИ, рдЕрдЧрд░ рдЖрдкрдХреЗ рдкрд╛рд╕ рд╡рд┐рдЪрд╛рд░ рд╣реИрдВ, рддреЛ рдЯрд┐рдкреНрдкрдгрд┐рдпреЛрдВ рдореЗрдВ рд▓рд┐рдЦреЗрдВред  рд▓реЗрдХрд┐рди рдореБрдЦреНрдп () рдХреЛрдб рдХреА рдорд╛рддреНрд░рд╛ рдХреЗ рд╕рд╛рде рдЖрдк рдХрд╛рдо рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред <br><br>  рдЕрдм рдореИрдВ рдЪрд╛рд╣рддрд╛ рд╣реВрдВ рдХрд┐ рд╕рднреА рдПрд▓ рдИ рдбреА рдХрд╣реАрдВ рдХрдВрдЯреЗрдирд░ рдореЗрдВ рд╣реЛрдВ, рдФрд░ рдЖрдк рд╡рд┐рдзрд┐ рдХреЛ рдХреЙрд▓ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рд╕рдм рдХреБрдЫ рд╕реНрд╡рд┐рдЪ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ ... рдХреБрдЫ рдЗрд╕ рддрд░рд╣: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(;;) { LedsContainer::ToggleAll() ; delay(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> ; }</code> </pre> <br>  рд╣рдо рдмреЗрд╡рдХреВрдлреЛрдВ рдХреЛ рдлрд╝рдВрдХреНрд╢рди рдореЗрдВ 4 рдПрд▓ рдИ рдбреА рдХреЗ рд╕реНрд╡рд┐рдЪрд┐рдВрдЧ рдХреЛ рд╕рдореНрдорд┐рд▓рд┐рдд рдирд╣реАрдВ рдХрд░реЗрдВрдЧреЗ LEDsContainer :: ToggleAll, рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рджрд┐рд▓рдЪрд╕реНрдк рдирд╣реАрдВ рд╣реИ :)ред  рд╣рдо рдПрд▓ рдИ рдбреА рдХреЛ рдПрдХ рдХрдВрдЯреЗрдирд░ рдореЗрдВ рд░рдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдФрд░ рдлрд┐рд░ рдЙрдирдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЬрд╛рддреЗ рд╣реИрдВ рдФрд░ рдкреНрд░рддреНрдпреЗрдХ рдкрд░ рдЯреЙрдЧрд▓ () рд╡рд┐рдзрд┐ рдХрд╣рддреЗ рд╣реИрдВред <br><br>  <i>рдЫрд╛рддреНрд░реЛрдВ рдиреЗ рдПрд▓рдЗрдбреА рд╕реЗ рдкреЙрдЗрдВрдЯрд░реНрд╕ рд╕реНрдЯреЛрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╕рд░рдгреА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ред</i>  рд▓реЗрдХрд┐рди рдореЗрд░реЗ рдкрд╛рд╕ рдЕрд▓рдЧ-рдЕрд▓рдЧ рдкреНрд░рдХрд╛рд░ рд╣реИрдВ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП: <code>Pin&lt;PortA, 5&gt;</code> , <code>Pin&lt;PortC, 5&gt;</code> , рдФрд░ рдореИрдВ рдПрдХ рд╕рд░рдгреА рдореЗрдВ рд╡рд┐рднрд┐рдиреНрди рдкреНрд░рдХрд╛рд░реЛрдВ рдХреЗ рд▓рд┐рдП рдкреЙрдЗрдВрдЯрд░реНрд╕ рд╕реНрдЯреЛрд░ рдирд╣реАрдВ рдХрд░ рд╕рдХрддрд╛ред  рдЖрдк рд╕рднреА рдкрд┐рди рдХреЗ рд▓рд┐рдП рдПрдХ рд╡рд░реНрдЪреБрдЕрд▓ рдмреЗрд╕ рдХреНрд▓рд╛рд╕ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдлрд┐рд░ рд╡рд░реНрдЪреБрдЕрд▓ рдлрд╝рдВрдХреНрд╢рдВрд╕ рдХреА рдПрдХ рддрд╛рд▓рд┐рдХрд╛ рджрд┐рдЦрд╛рдИ рджреЗрдЧреА рдФрд░ рдореИрдВ рдЫрд╛рддреНрд░реЛрдВ рдХреЛ рдЬреАрддрдиреЗ рдореЗрдВ рд╕рдлрд▓ рдирд╣реАрдВ рд╣реЛрдЧрд╛ред <br><br>  рдЗрд╕рд▓рд┐рдП, рд╣рдо рдЯрдкрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗред  рдпрд╣ рдЖрдкрдХреЛ рд╡рд┐рднрд┐рдиреНрди рдкреНрд░рдХрд╛рд░ рдХреА рд╡рд╕реНрддреБрдУрдВ рдХреЛ рд╕реНрдЯреЛрд░ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред  рдпрд╣ рдорд╛рдорд▓рд╛ рдЗрд╕ рддрд░рд╣ рджрд┐рдЦреЗрдЧрд╛: <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LedsContainer</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">constexpr</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> records = <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::make_tuple ( Pin&lt;PortA, <span class="hljs-number"><span class="hljs-number">5</span></span>&gt;{}, Pin&lt;PortC, <span class="hljs-number"><span class="hljs-number">5</span></span>&gt;{}, Pin&lt;PortC, <span class="hljs-number"><span class="hljs-number">8</span></span>&gt;{}, Pin&lt;PortC, <span class="hljs-number"><span class="hljs-number">9</span></span>&gt;{} ) ; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> tRecordsTuple = <span class="hljs-keyword"><span class="hljs-keyword">decltype</span></span>(records) ; }</code> </pre> <br>  рдПрдХ рдорд╣рд╛рди рдХрдВрдЯреЗрдирд░ рд╣реИ, рдпрд╣ рд╕рднреА рдПрд▓рдИрдбреА рд╕реНрдЯреЛрд░ рдХрд░рддрд╛ рд╣реИред  рдЕрдм рдЗрд╕рдореЗрдВ <code>ToggleAll()</code> рд╡рд┐рдзрд┐ рдЬреЛрдбрд╝реЗрдВ: <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LedsContainer</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: __<span class="hljs-function"><span class="hljs-function">forceinline </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ToggleAll</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//        } private: constexpr static auto records = std::make_tuple ( Pin&lt;PortA, 5&gt;{}, Pin&lt;PortC, 5&gt;{}, Pin&lt;PortC, 8&gt;{}, Pin&lt;PortC, 9&gt;{} ) ; using tRecordsTuple = decltype(records) ; }</span></span></code> </pre> <br>  рдЖрдк рдХреЗрд╡рд▓ рдПрдХ рдЯреНрдпреВрдкрд▓ рддрддреНрд╡реЛрдВ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдирд╣реАрдВ рдЪрд▓ рд╕рдХрддреЗ рд╣реИрдВ, рдХреНрдпреЛрдВрдХрд┐ рдЯрдкрд▓ рддрддреНрд╡ рдХреЗрд╡рд▓ рд╕рдВрдХрд▓рди рдЪрд░рдг рдореЗрдВ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред  рдЯрдкрд▓ рдХреЗ рддрддреНрд╡реЛрдВ рдХреЛ рдПрдХреНрд╕реЗрд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдЯреЗрдореНрдкреНрд▓реЗрдЯ рдкреНрд░рд╛рдкреНрдд рд╡рд┐рдзрд┐ рд╣реИред  рдЦреИрд░ рдпрд╛рдиреА  рдЕрдЧрд░ рд╣рдо <code>std::get&lt;0&gt;(records).Toggle()</code> рд▓рд┐рдЦрддреЗ рд╣реИрдВ <code>std::get&lt;0&gt;(records).Toggle()</code> , рддреЛ <code>Toggle()</code> рд╡рд┐рдзрд┐ рдХреЛ рдХреНрд▓рд╛рд╕ <code>Pin&lt;PortA, 5&gt;</code> рдХреЗ рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЗ рд▓рд┐рдП рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЕрдЧрд░ <code>std::get&lt;1&gt;(records).Toggle()</code> <code>Pin&lt;PortA, 5&gt;</code> <code>std::get&lt;1&gt;(records).Toggle()</code> ред рддрдм <code>Toggle()</code> рд╡рд┐рдзрд┐ рдХреЛ рдХрдХреНрд╖рд╛ <code>Pin&lt;Port, 5&gt;</code> рдФрд░ рдЗрддрдиреЗ рдкрд░ рд╡рд╕реНрддреБ рдХреЗ рд▓рд┐рдП рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ ... <br><br>  рдЖрдк <s>рдЕрдкрдиреЗ рдЫрд╛рддреНрд░реЛрдВ рдХреА рдирд╛рдХ рдкреЛрдВрдЫ рд╕рдХрддреЗ рд╣реИрдВ</s> рдФрд░ рдмрд╕ рд▓рд┐рдЦ рд╕рдХрддреЗ рд╣реИрдВ: <br><br><pre> <code class="cpp hljs"> __<span class="hljs-function"><span class="hljs-function">forceinline </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ToggleAll</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::get&lt;<span class="hljs-number"><span class="hljs-number">0</span></span>&gt;(records).Toggle(); <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::get&lt;<span class="hljs-number"><span class="hljs-number">1</span></span>&gt;(records).Toggle(); <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::get&lt;<span class="hljs-number"><span class="hljs-number">2</span></span>&gt;(records).Toggle(); <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::get&lt;<span class="hljs-number"><span class="hljs-number">3</span></span>&gt;(records).Toggle(); }</code> </pre> <br>  рд▓реЗрдХрд┐рди рд╣рдо рдкреНрд░реЛрдЧреНрд░рд╛рдорд░ рдХреЛ рддрдирд╛рд╡ рдирд╣реАрдВ рджреЗрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдЬреЛ рдЗрд╕ рдХреЛрдб рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдЧрд╛ рдФрд░ рдЙрд╕реЗ рдЕрддрд┐рд░рд┐рдХреНрдд рдХрд╛рдо рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдЧрд╛, рдЕрдкрдиреА рдХрдВрдкрдиреА рдХреЗ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреЛ рдЦрд░реНрдЪ рдХрд░рддреЗ рд╣реБрдП, рдХрд╣рддреЗ рд╣реИрдВ, рдпрджрд┐ рдХреЛрдИ рдЕрдиреНрдп рдПрд▓рдИрдбреА рджрд┐рдЦрд╛рдИ рджреЗрддрд╛ рд╣реИред  рдЖрдкрдХреЛ рджреЛ рдЬрдЧрд╣реЛрдВ рдкрд░, рдЯрдкрд▓ рдореЗрдВ рдФрд░ рдЗрд╕ рдкрджреНрдзрддрд┐ рдореЗрдВ рдХреЛрдб рдЬреЛрдбрд╝рдирд╛ рд╣реЛрдЧрд╛ - рдФрд░ рдпрд╣ рдЕрдЪреНрдЫрд╛ рдирд╣реАрдВ рд╣реИ рдФрд░ рдХрдВрдкрдиреА рдХрд╛ рдорд╛рд▓рд┐рдХ рдмрд╣реБрдд рдкреНрд░рд╕рдиреНрди рдирд╣реАрдВ рд╣реЛрдЧрд╛ред  рдЗрд╕рд▓рд┐рдП, рд╣рдо рд╕рд╣рд╛рдпрдХ рд╡рд┐рдзрд┐рдпреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЯрдкрд▓ рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рддреЗ рд╣реИрдВ: <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LedsContainer</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">friend</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: __<span class="hljs-function"><span class="hljs-function">forceinline </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ToggleAll</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//    3,2,1,0    ,     visit(std::make_index_sequence&lt;std::tuple_size&lt;tRecordsTuple&gt;::value&gt;()); } private: __forceinline template&lt;std::size_t... index&gt; static inline void visit(std::index_sequence&lt;index...&gt;) { Pass((std::get&lt;index&gt;(records).Toggle(), true)...); //    get&lt;3&gt;(records).Toggle(), get&lt;2&gt;(records).Toggle(), get&lt;1&gt;(records).Toggle(), get&lt;0&gt;(records).Toggle() } __forceinline template&lt;typename... Args&gt; static void inline Pass(Args... ) {//      } constexpr static auto records = std::make_tuple ( Pin&lt;PortA, 5&gt;{}, Pin&lt;PortC, 5&gt;{}, Pin&lt;PortC, 8&gt;{}, Pin&lt;PortC, 9&gt;{} ) ; using tRecordsTuple = decltype(records) ; }</span></span></code> </pre> <br>  рдпрд╣ рдбрд░рд╛рд╡рдирд╛ рд▓рдЧ рд░рд╣рд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдореИрдВрдиреЗ рд▓реЗрдЦ рдХреА рд╢реБрд░реБрдЖрдд рдореЗрдВ рдЪреЗрддрд╛рд╡рдиреА рджреА рдХрд┐ <s>рд╢рд┐рдЬрд╝рдиреА</s> рд╡рд┐рдзрд┐ рдмрд╣реБрдд рд╕рд╛рдорд╛рдиреНрдп рдирд╣реАрдВ рд╣реИ ... <br><br>  рд╕рдВрдХрд▓рди рдордВрдЪ рдкрд░ рдКрдкрд░ рд╕реЗ рдпрд╣ рд╕рдм рдЬрд╛рджреВ рд╕рдЪрдореБрдЪ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╣реИ: <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//  LedsContainer::ToggleAll() ; //   4 : Pin&lt;Port, 9&gt;().Toggle() ; Pin&lt;Port, 8&gt;().Toggle() ; Pin&lt;PortC, 5&gt;().Toggle() ; Pin&lt;PortA, 5&gt;().Toggle() ; //     Toggle() inline,   : *reinterpret_cast&lt;std::uint32_t*&gt;(0x40020814 ) ^= (1 &lt;&lt; 9) ; *reinterpret_cast&lt;std::uint32_t*&gt;(0x40020814 ) ^= (1 &lt;&lt; 8) ; *reinterpret_cast&lt;std::uint32_t*&gt;(0x40020814 ) ^= (1 &lt;&lt; 5) ; *reinterpret_cast&lt;std::uint32_t*&gt;(0x40020014 ) ^= (1 &lt;&lt; 5) ;</span></span></code> </pre> <br>  рдЖрдЧреЗ рдмрдврд╝реЛ рдФрд░ рдЕрдиреБрдХреВрд▓рди рдХреЗ рдмрд┐рдирд╛ рдХреЛрдб рдЖрдХрд╛рд░ рдХреЛ рд╕рдВрдХрд▓рд┐рдд рдХрд░реЗрдВ рдФрд░ рдЬрд╛рдВрдЪ рдХрд░реЗрдВ: <br><br><div class="spoiler">  <b class="spoiler_title">рд╡рд╣ рдХреЛрдб рдЬреЛ рд╕рдВрдХрд▓рд┐рдд рдХрд░рддрд╛ рд╣реИ</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;cstddef&gt; #include &lt;tuple&gt; #include &lt;utility&gt; #include &lt;cstdint&gt; #include &lt;type_traits&gt; //#include "stm32f411xe.h" #define __forceinline _Pragma("inline=forced") constexpr std::uint32_t GpioaBaseAddr = 0x4002'0000 ; constexpr std::uint32_t GpiocBaseAddr = 0x4002'0800 ; constexpr std::uint32_t OdrAddrShift = 20U; struct PortBase { }; template &lt;std::uint32_t addr&gt; struct Port: PortBase { __forceinline inline static void Toggle(const std::uint8_t bit) { *reinterpret_cast&lt;std::uint32_t*&gt;(addr + OdrAddrShift) ^= (1 &lt;&lt; bit) ; } }; template &lt;typename T, std::uint8_t pinNum, class = typename std::enable_if_t&lt;std::is_base_of&lt;PortBase, T&gt;::value&gt;&gt; struct Pin { __forceinline inline static void Toggle() { T::Toggle(pinNum) ; } } ; using PortA = Port&lt;GpioaBaseAddr&gt; ; using PortC = Port&lt;GpiocBaseAddr&gt; ; //using Led1 = Pin&lt;PortA, 5&gt; ; //using Led2 = Pin&lt;PortC, 5&gt; ; //using Led3 = Pin&lt;PortC, 8&gt; ; //using Led4 = Pin&lt;PortC, 9&gt; ; class LedsContainer { friend int main() ; public: __forceinline static inline void ToggleAll() { //    3,2,1,0    ,     visit(std::make_index_sequence&lt;std::tuple_size&lt;tRecordsTuple&gt;::value&gt;()); } private: __forceinline template&lt;std::size_t... index&gt; static inline void visit(std::index_sequence&lt;index...&gt;) { Pass((std::get&lt;index&gt;(records).Toggle(), true)...); } __forceinline template&lt;typename... Args&gt; static void inline Pass(Args... ) { } constexpr static auto records = std::make_tuple ( Pin&lt;PortA, 5&gt;{}, Pin&lt;PortC, 5&gt;{}, Pin&lt;PortC, 8&gt;{}, Pin&lt;PortC, 9&gt;{} ) ; using tRecordsTuple = decltype(records) ; } ; void delay() { for (int i = 0; i &lt; 1000000; ++i){ } } int main() { for(;;) { LedsContainer::ToggleAll() ; //GPIOA-&gt;ODR ^= 1 &lt;&lt; 5; //GPIOC-&gt;ODR ^= 1 &lt;&lt; 5; //GPIOC-&gt;ODR ^= 1 &lt;&lt; 8; //GPIOC-&gt;ODR ^= 1 &lt;&lt; 9; delay(); } return 0 ; }</span></span></span></span></code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">рдЕрд╕реЗрдВрдмрд▓рд░ рд╕рдмреВрдд, рдирд┐рдпреЛрдЬрд┐рдд рдХреЗ рд░реВрдк рдореЗрдВ рдЕрдирдкреИрдХреНрдб:</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/0e/aa/un/0eaaunh1qwmg73s1p-3ev4zcpws.png" alt="рдЫрд╡рд┐"><br></div></div><br>  рд╣рдо рджреЗрдЦрддреЗ рд╣реИрдВ рдХрд┐ рдореЗрдореЛрд░реА рдУрд╡рд░рдХрд┐рд▓ рд╣реИ, 18 рдмрд╛рдЗрдЯреНрд╕ рдЕрдзрд┐рдХ рд╣реИред  рд╕рдорд╕реНрдпрд╛рдПрдВ рд╕рдорд╛рди рд╣реИрдВ, рд╕рд╛рде рд╣реА рдПрдХ рдФрд░ 12 рдмрд╛рдЗрдЯреНрд╕ред  рдореБрдЭреЗ рд╕рдордЭ рдирд╣реАрдВ рдЖрдпрд╛ рдХрд┐ рд╡реЗ рдХрд╣рд╛рдБ рд╕реЗ рдЖрдП рд╣реИрдВ ... рд╢рд╛рдпрдж рдХреЛрдИ рд╕рдордЭрд╛рдПрдЧрд╛ред <br><blockquote>  рд░реАрдбрдСрдирд▓реА рдХреЛрдб рдореЗрдореЛрд░реА рдХреЗ 283 рдмрд╛рдЗрдЯреНрд╕ <br>  рд░реАрдбрдУрдирд▓реА рдбреЗрдЯрд╛ рдореЗрдореЛрд░реА рдХреА 1 рдмрд╛рдЗрдЯ <br>  рд░реАрдбрд░рд╛рдИрдЯ рдбреЗрдЯрд╛ рдореЗрдореЛрд░реА рдХреЗ 24 рдмрд╛рдЗрдЯреНрд╕ </blockquote><br>  рдЕрдм рдордзреНрдпрдо рдЕрдиреБрдХреВрд▓рди рдФрд░ рд▓реЛ рдФрд░ рдирд┐рд╣рд╛рд░рдирд╛ рдкрд░ рдПрдХ рд╣реА рдмрд╛рдд ... рд╣рдореЗрдВ рдорд╛рдереЗ рдореЗрдВ рд╕реА ++ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдХреЗ рд╕рдорд╛рди рдХреЛрдб рдФрд░ рдЕрдзрд┐рдХ рдЖрд╢рд╛рд╡рд╛рджреА рд╕реА рдХреЛрдб рдорд┐рд▓рд╛ред <br><blockquote>  251 рдмрд╛рдЗрдЯреНрд╕ рдХреЛрдб рдореЗрдореЛрд░реА рдХреА рдмрд╛рдЗрдЯ <br>  рд░реАрдбрдУрдирд▓реА рдбреЗрдЯрд╛ рдореЗрдореЛрд░реА рдХреА 1 рдмрд╛рдЗрдЯ <br>  рд░реАрдбрд░рд╛рдЗрдЯрдЗрдЯ рдбреЗрдЯрд╛ рдореЗрдореЛрд░реА рдХреЗ 8 рдмрд╛рдЗрдЯреНрд╕ </blockquote><br><div class="spoiler">  <b class="spoiler_title">рдХреЛрдбрд╛рдВрддрд░рдХ</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/y4/7w/l9/y47wl95frzmeyb2brdekbnvqvr8.png" alt="рдЫрд╡рд┐"><br></div></div><br>  рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ, рдореИрдВ рдЬреАрдд рдЧрдпрд╛, рдФрд░ <s>рдХреИрдирд░реА рджреНрд╡реАрдк рдкрд░ рдЪрд▓рд╛ рдЧрдпрд╛</s> рдФрд░ рдЪреЗрд▓реНрдпрд╛рдмрд┐рдВрд╕реНрдХ рдореЗрдВ рдЖрд░рд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкреНрд░рд╕рдиреНрди рд╣реВрдВ :), рд▓реЗрдХрд┐рди рдЫрд╛рддреНрд░ рднреА рдорд╣рд╛рди рдереЗ, рдЙрдиреНрд╣реЛрдВрдиреЗ рд╕рдлрд▓рддрд╛рдкреВрд░реНрд╡рдХ рдкрд░реАрдХреНрд╖рд╛ рдЙрддреНрддреАрд░реНрдг рдХреА! <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдХреМрди рдкрд░рд╡рд╛рд╣ рдХрд░рддрд╛ рд╣реИ, рдХреЛрдб рдпрд╣рд╛рдБ рд╣реИ</a> <br><br>  рдореИрдВ рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд╣рд╛рдВ рдХрд░ рд╕рдХрддрд╛ рд╣реВрдВ, рдареАрдХ рд╣реИ, рдореИрдВ рд╕рд╛рде рдЖрдпрд╛ рдерд╛, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЬреИрд╕реЗ, рд╣рдорд╛рд░реЗ рдкрд╛рд╕ EEPROM рдореЗрдореЛрд░реА рдореЗрдВ рдкреИрд░рд╛рдореАрдЯрд░ рд╣реИрдВ рдФрд░ рдЗрди рдорд╛рдкрджрдВрдбреЛрдВ рдХрд╛ рд╡рд░реНрдгрди рдХрд░рдиреЗ рд╡рд╛рд▓рд╛ рдПрдХ рд╡рд░реНрдЧ рд╣реИ (рдкреНрд░рд╛рд░рдВрднрд┐рдХ рдореВрд▓реНрдп рдХреЗ рд▓рд┐рдП рдкрдврд╝реЗрдВ, рд▓рд┐рдЦреЗрдВ, рд▓рд┐рдЦреЗрдВ)ред  рд╡рд░реНрдЧ рдЯреЗрдореНрдкрд▓реЗрдЯ рд╣реИ, рдЬреИрд╕реЗ <code>Param&lt;float&lt;&gt;&gt;</code> , <code>Param&lt;int&lt;&gt;&gt;</code> рдФрд░ рдЖрдкрдХреЛ рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдорд╛рдиреЛрдВ рдХреЗ рд▓рд┐рдП рд╕рднреА рдорд╛рдкрджрдВрдбреЛрдВ рдХреЛ рд░реАрд╕реЗрдЯ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  рдпрд╣ рд╡рд╣ рдЬрдЧрд╣ рд╣реИ рдЬрд╣рд╛рдВ рдЖрдк рд╕рднреА рдХреЛ рдПрдХ рдЯрдкрд▓ рдореЗрдВ рд░рдЦ рд╕рдХрддреЗ рд╣реИрдВ, рдХреНрдпреЛрдВрдХрд┐ рдкреНрд░рдХрд╛рд░ рдЕрд▓рдЧ рд╣реИ рдФрд░ рдкреНрд░рддреНрдпреЗрдХ рдкреИрд░рд╛рдореАрдЯрд░ рдкрд░ <code>SetToDefault()</code> рд╡рд┐рдзрд┐ рдХреЛ рдХреЙрд▓ рдХрд░реЗрдВред  рд╕рдЪ рд╣реИ, рдЕрдЧрд░ рдРрд╕реЗ 100 рдкреИрд░рд╛рдореАрдЯрд░ рд╣реИрдВ, рддреЛ рд░реЛрдо рдмрд╣реБрдд рдЦрд╛ рдЬрд╛рдПрдЧрд╛, рд▓реЗрдХрд┐рди рд░реИрдо рдХреЛ рдиреБрдХрд╕рд╛рди рдирд╣реАрдВ рд╣реЛрдЧрд╛ред <br><br>  PS рдореБрдЭреЗ рд╕реНрд╡реАрдХрд╛рд░ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП рдХрд┐ рдЕрдзрд┐рдХрддрдо рдЕрдиреБрдХреВрд▓рди рдкрд░ рдпрд╣ рдХреЛрдб C рдФрд░ рдореЗрд░реЗ рд╕рдорд╛рдзрд╛рди рдХреЗ рдЖрдХрд╛рд░ рдЬреИрд╕рд╛ рд╣реИред  рдФрд░ рдкреНрд░реЛрдЧреНрд░рд╛рдорд░ рдХреЗ рдХреЛрдб рдХреЛ рдмреЗрд╣рддрд░ рдмрдирд╛рдиреЗ рдХреЗ рд╕рднреА рдкреНрд░рдпрд╛рд╕ рдПрдХ рд╣реА рдХреЛрдбрд╛рдВрддрд░рдХ рдХреЛрдб рдкрд░ рдЖрддреЗ рд╣реИрдВред <br><br>  P.S1 <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" class="user_link">рдЕрдЪреНрдЫреА</a> рд╕рд▓рд╛рд╣ рдХреЗ рд▓рд┐рдП 0xd34df00d рдзрдиреНрдпрд╡рд╛рджред  рдЖрдк <code>std::apply()</code> рд╕рд╛рде рдПрдХ рдЯрдкрд▓ рдХреЛ рдЦреЛрд▓рдирд╛ рд╕рд░рд▓ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  <code>ToggleAll()</code> рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдХреЛрдб рдлрд┐рд░ рдЗрд╕реЗ рд╕рд░рд▓ рдХрд░рддрд╛ рд╣реИ: <br><br><pre> <code class="cpp hljs"> __<span class="hljs-function"><span class="hljs-function">forceinline </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ToggleAll</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::apply([](<span class="hljs-keyword"><span class="hljs-keyword">auto</span></span>... args) { (args.Toggle(), ...); }, records); }</code> </pre> <br>  рджреБрд░реНрднрд╛рдЧреНрдп рд╕реЗ, IAR рдореЗрдВ, std :: рд▓рд╛рдЧреВ рдЕрднреА рддрдХ рд╡рд░реНрддрдорд╛рди рд╕рдВрд╕реНрдХрд░рдг рдореЗрдВ рд▓рд╛рдЧреВ рдирд╣реАрдВ рд╣реИ, рд▓реЗрдХрд┐рди рдпрд╣ рднреА рдХрд╛рдо рдХрд░реЗрдЧрд╛, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">std рдХреЗ рд╕рд╛рде рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди</a> рджреЗрдЦреЗрдВ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">:: рд▓рд╛рдЧреВ рдХрд░реЗрдВ</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi457246/">https://habr.com/ru/post/hi457246/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi457224/index.html">Android рдореЗрдВ рдкреНрд░рддрд┐рдпреЛрдЧрд┐рддрд╛ рдХреЗ рд▓рд┐рдП рдПрдХ рдЖрдзреБрдирд┐рдХ рджреГрд╖реНрдЯрд┐рдХреЛрдг: рдХреЛрдЯрд▓рд┐рди рдореЗрдВ рдХреЛрд░реЛрдЯрд┐рдВрд╕</a></li>
<li><a href="../hi457232/index.html">рд░реЛрдмреЛрдЯ рдордзреБрдордХреНрдЦреА "рдмрдореНрдмрд▓" - рдЖрдИрдПрд╕рдПрд╕ рдХреЗ рдЕрдВрджрд░ рдкрд╣рд▓реА рдкрд░реАрдХреНрд╖рдг рдЙрдбрд╝рд╛рди</a></li>
<li><a href="../hi457234/index.html">рдЙрддреНрдкрд╛рдж рд╕рдВрдЬреНрдЮрд╛рдирд╛рддреНрдордХ рдкреВрд░реНрд╡рд╛рдЧреНрд░рд╣</a></li>
<li><a href="../hi457236/index.html">рдХреИрд╕реЗ рдПрдХ рдЖрдИрдЯреА рдХрдВрдкрдиреА рдиреЗ рд╕рдВрдЧреАрдд рдмреЗрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдВрдШрд░реНрд╖ рдХрд┐рдпрд╛</a></li>
<li><a href="../hi457240/index.html">рд╕рдкреНрддрд╛рд╣ рдХреА рдЦрдмрд░: рддрдВрддреНрд░рд┐рдХрд╛ рдиреЗрдЯрд╡рд░реНрдХ рдФрд░ рддрд╕реНрд╡реАрд░реЗрдВ рдЦреАрдВрдЪреА рдЧрдИ, рдпреИрдВрдбреЗрдХреНрд╕ рдХреЗ рд╢реЗрдпрд░реЛрдВ рдХреА рд╡реГрджреНрдзрд┐, рд╣реБрдЖрд╡реЗрдИ рдХреЛ рдкреЗрдЯреЗрдВрдЯ рдХреЗ рд▓рд┐рдП $ 1 рдмрд┐рд▓рд┐рдпрди рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ</a></li>
<li><a href="../hi457248/index.html">рдПрдХ рдЦрд░рд╛рдж рдХреЗ рд▓рд┐рдП рдЬрд╛рд╡рд╛рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдкреНрд░реЛрдЧреНрд░рд╛рдорд┐рдВрдЧ</a></li>
<li><a href="../hi457250/index.html">Vue.js рдХреЗ рд▓рд┐рдП рдХрд╛рд▓рд╛ рджрд┐рди</a></li>
<li><a href="../hi457254/index.html">рдореЛрдмрд╛рдЗрд▓ рдбреЗрд╡рд▓рдкрд░ рдХреЗ рд▓рд┐рдП рджрд┐рд▓рдЪрд╕реНрдк рд╕рд╛рдордЧреНрд░реА рдХрд╛ рдкрд╛рдЪрди # 303 (17 рдЬреВрди - 23)</a></li>
<li><a href="../hi457256/index.html">рдЗрдВрдЯрд░рдиреЗрдЯ рдХрд╛ рдЗрддрд┐рд╣рд╛рд╕: ARPANET - рдкреИрдХреЗрдЬ</a></li>
<li><a href="../hi457258/index.html">15 рд╕рд╛рд▓ рддрдХ рд╕рдореБрджреНрд░реА рдбрд╛рдХреВ рдмреЗ рдФрд░ рдорд╛рд░ рдирд╣реАрдВ рд╕рдХрд╛</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>