<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§≥üèº üíö ‚úçÔ∏è Fragmentos de Pinterest: C√≥mo escalamos nuestro parque MySQL üß£ üâê ‚ò∫Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="¬°Saludo, Khabrovites! Felicitaciones a todos en el d√≠a del programador y comparta la traducci√≥n del art√≠culo, que fue especialmente preparado para los...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Fragmentos de Pinterest: C√≥mo escalamos nuestro parque MySQL</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/467389/">  <i>¬°Saludo, Khabrovites!</i>  <i>Felicitaciones a todos en el d√≠a del programador y comparta la traducci√≥n del art√≠culo, que fue especialmente preparado para los estudiantes del curso <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">"Arquitecto de alta carga"</a> .</i> <br><br><img src="https://habrastorage.org/webt/3o/s-/k6/3os-k6l2f122mbs6d1lufcif6ke.png"><br><br>  <b><i>"Fragmentos.</i></b>  <b><i>O no lo rompas.</i></b>  <b><i>Sin intentarlo ".</i></b> <b><i><br></i></b>  <b><i>- Yoda</i></b> <br><br>  Hoy nos sumergiremos en la separaci√≥n de datos entre varios servidores MySQL.  Terminamos de fragmentar a principios de 2012, y este sistema todav√≠a se usa para almacenar nuestros datos b√°sicos. <a name="habracut"></a><br><br>  Antes de discutir c√≥mo compartir datos, vamos a conocerlos mejor.  Enciende una luz agradable, consigue fresas con chocolate, recuerda las citas de Star Trek ... <br><br>  Pinterest es un motor de b√∫squeda para todo lo que te interesa.  En t√©rminos de datos, Pinterest es el gr√°fico m√°s grande de intereses humanos en todo el mundo.  Contiene m√°s de 50 mil millones de pines que los usuarios han guardado en m√°s de mil millones de tableros.  Las personas guardan algunos pines para s√≠ mismos y, al igual que otros pines, se suscriben a otros pines, tableros e intereses, ven el feed de inicio de todos los pines, tableros e intereses a los que est√°n suscritos.  Genial  ¬°Ahora hag√°moslo escalable! <br><br><h3>  Crecimiento doloroso </h3><br>  En 2011, comenzamos a ganar impulso.  Seg√∫n algunas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">estimaciones</a> , crecimos m√°s r√°pido que cualquier startup conocida en ese momento.  Alrededor de septiembre de 2011, todos los componentes de nuestra infraestructura se sobrecargaron.  Ten√≠amos varias tecnolog√≠as NoSQL a nuestra disposici√≥n, y todas fallaron catastr√≥ficamente.  Tambi√©n ten√≠amos muchos esclavos MySQL, que sol√≠amos leer, lo que causaba muchos errores extraordinarios, especialmente al almacenar en cach√©.  Reconstruimos todo nuestro modelo de almacenamiento.  Para trabajar de manera eficiente, nos acercamos cuidadosamente al desarrollo de requisitos. <br><br><h3>  Requisitos </h3><br><ul><li>  Todo el sistema debe ser muy estable, f√°cil de usar y escalar desde el tama√±o de una caja peque√±a hasta el tama√±o de la luna a medida que el sitio crece. </li><li>  Todo el contenido generado por el marcador debe estar disponible en el sitio en cualquier momento. </li><li>  El sistema debe admitir la solicitud de N pines en el tablero en un orden determinista (por ejemplo, en el orden inverso del tiempo de creaci√≥n o en el orden especificado por el usuario).  Lo mismo es para pinners, pin, etc. </li><li> Para simplificar, debe buscar actualizaciones de todas las formas posibles.  Para obtener la consistencia necesaria, se necesitar√°n juguetes adicionales, como un diario de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">transacciones</a> distribuidas.  ¬°Es divertido y (no demasiado) f√°cil! </li></ul><br><h3>  Filosof√≠a de la arquitectura y notas </h3><br>  Debido a que quer√≠amos que estos datos abarcasen m√∫ltiples bases de datos, no podr√≠amos usar solo una combinaci√≥n, claves externas e √≠ndices para recopilar todos los datos, aunque pueden usarse para subconsultas que no abarcan la base de datos. <br><br>  Tambi√©n necesit√°bamos mantener el equilibrio de carga en los datos.  Decidimos que mover datos, elemento por elemento, har√≠a que el sistema fuera innecesariamente complejo y causar√≠a muchos errores.  Si necesit√°ramos mover datos, era mejor mover todo el nodo virtual a otro nodo f√≠sico. <br><br>  Para que nuestra implementaci√≥n entre r√°pidamente en circulaci√≥n, necesit√°bamos la soluci√≥n m√°s simple y conveniente y nodos muy estables en nuestra plataforma de datos distribuidos. <br>  Todos los datos tuvieron que replicarse en la m√°quina esclava para crear una copia de seguridad, con alta disponibilidad y volcado a S3 para MapReduce.  Interactuamos con master solo en producci√≥n.  En producci√≥n, no querr√° escribir ni leer en esclavo.  Retraso esclavo, y causa errores extra√±os.  Si se realiza el fragmentaci√≥n, no tiene sentido interactuar con un esclavo en la producci√≥n. <br><br>  Finalmente, necesitamos una buena forma de generar identificadores √∫nicos universales (UUID) para todos nuestros objetos. <br><br><h3>  C√≥mo hicimos sharding </h3><br>  Lo que √≠bamos a crear, ten√≠a que cumplir con los requisitos, trabajar de manera estable, en general, ser viable y mantenible.  Es por eso que hemos elegido la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">tecnolog√≠a</a> MySQL ya bastante madura como la tecnolog√≠a subyacente.  Intentamos desconfiar de las nuevas tecnolog√≠as para el escalado autom√°tico de MongoDB, Cassandra y Membase, porque estaban lo suficientemente lejos de la madurez (¬°y en nuestro caso se rompieron de manera impresionante!) <br><blockquote>  Adem√°s: todav√≠a recomiendo startups para evitar nuevas cosas extra√±as, solo trate de usar MySQL.  Conf√≠a en mi  Puedo probarlo con cicatrices. </blockquote>  MySQL: la tecnolog√≠a est√° probada, es estable y simple: funciona.  No solo lo usamos, es popular en otras compa√±√≠as con escalas a√∫n m√°s impresionantes.  MySQL satisface plenamente nuestra necesidad de optimizar las consultas de datos, seleccionando rangos de datos espec√≠ficos y transacciones a nivel de fila.  De hecho, en su arsenal hay muchas m√°s oportunidades, pero no todas las necesitamos.  Pero MySQL es una soluci√≥n "en caja", por lo que los datos tuvieron que ser fragmentados.  Aqu√≠ est√° nuestra soluci√≥n: <br>  Comenzamos con ocho servidores EC2, una instancia de MySQL en cada uno: <br><br><img src="https://habrastorage.org/webt/e0/d0/o0/e0d0o0fijurp6mabuvbwecacnfi.png"><br><br>  Cada servidor maestro-maestro MySQL se replica al host de respaldo en caso de una falla primaria.  Nuestros servidores de producci√≥n solo leen o escriben en master.  Te recomiendo que tambi√©n lo hagas.  Esto simplifica enormemente y evita errores con retrasos en la replicaci√≥n. <br><br>  Cada entidad MySQL tiene muchas bases de datos: <br><br><img src="https://habrastorage.org/webt/zf/vl/sx/zfvlsxbhhh6uict7kf9ly6f2y9m.png"><br><br>  Tenga en cuenta que cada base de datos tiene un nombre exclusivo: db00000, db00001 a dbNNNNN.  Cada base de datos es un fragmento de nuestros datos.  Tomamos una decisi√≥n arquitect√≥nica, sobre la base de la cual solo una parte de los datos cae en el fragmento, y nunca va m√°s all√° de este fragmento.  Sin embargo, puede obtener m√°s capacidad moviendo fragmentos a otras m√°quinas (hablaremos de eso m√°s adelante). <br><br>  Trabajamos con una tabla de configuraci√≥n que indica qu√© m√°quinas tienen fragmentos: <br><br><pre><code class="bash hljs">[{‚Äúrange‚Äù: (0,511), ‚Äúmaster‚Äù: ‚ÄúMySQL001A‚Äù, ‚Äúslave‚Äù: ‚ÄúMySQL001B‚Äù}, {‚Äúrange‚Äù: (512, 1023), ‚Äúmaster‚Äù: ‚ÄúMySQL002A‚Äù, ‚Äúslave‚Äù: ‚ÄúMySQL002B‚Äù}, ... {‚Äúrange‚Äù: (3584, 4095), ‚Äúmaster‚Äù: ‚ÄúMySQL008A‚Äù, ‚Äúslave‚Äù: ‚ÄúMySQL008B‚Äù}]</code> </pre> <br>  Esta configuraci√≥n solo cambia cuando necesitamos mover fragmentos o reemplazar el host.  Si el <code>master</code> muere, podemos usar el <code>slave</code> existente y luego elegir uno nuevo.  La configuraci√≥n se encuentra en <a href="">ZooKeeper</a> y, cuando se actualiza, se env√≠a a los servicios que sirven al fragmento de MySQL. <br><br>  Cada fragmento tiene el mismo conjunto de tablas: <code>pins</code> , <code>boards</code> , <code>users_has_pins</code> , <code>users_likes_pins</code> , <code>pin_liked_by_user</code> , etc.  Hablar√© de esto un poco m√°s tarde. <br><br>  ¬øC√≥mo distribuimos los datos para estos fragmentos? <br><br>  Creamos una ID de 64 bits que contiene la ID del fragmento, el tipo de datos que contiene y el lugar donde se encuentran estos datos en la tabla (ID local).  La identificaci√≥n del fragmento consta de 16 bits, la identificaci√≥n del tipo es de 10 bits y la identificaci√≥n local es de 36 bits.  Los matem√°ticos avanzados notar√°n que solo hay 62 bits.  Mi experiencia pasada como compilador y desarrollador de placas de circuitos me ha ense√±ado que los bits de respaldo valen su peso en oro.  Entonces, tenemos dos de esos bits (establecidos en cero). <br><br><pre> <code class="bash hljs">ID = (shard ID &lt;&lt; 46) | (<span class="hljs-built_in"><span class="hljs-built_in">type</span></span> ID &lt;&lt; 36) | (<span class="hljs-built_in"><span class="hljs-built_in">local</span></span> ID&lt;&lt;0)</code> </pre> <br>  Tomemos este pin: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://www.pinterest.com/pin/241294492511762325/</a> , analicemos su ID 241294492511762325: <br><br><pre> <code class="bash hljs">Shard ID = (241294492511762325 &gt;&gt; 46) &amp; 0xFFFF = 3429 Type ID = (241294492511762325 &gt;&gt; 36) &amp; 0x3FF = 1 Local ID = (241294492511762325 &gt;&gt; 0) &amp; 0xFFFFFFFFF = 7075733</code> </pre> <br>  Por lo tanto, el objeto pin vive en el fragmento 3429.  Su tipo es "1" (es decir, "Pin"), y est√° en la l√≠nea 7075733 en la tabla de pin.  Por ejemplo, imaginemos que este fragmento est√° en MySQL012A.  Podemos llegar a esto de la siguiente manera: <br><br><pre> <code class="bash hljs">conn = MySQLdb.connect(host=‚ÄùMySQL012A‚Äù) conn.execute(‚ÄúSELECT data FROM db03429.pins <span class="hljs-built_in"><span class="hljs-built_in">where</span></span> local_id=7075733‚Äù)</code> </pre> <br><br>  Hay dos tipos de datos: objetos y asignaciones.  Los objetos contienen partes, como datos de pin. <br><br><h4>  Tablas de objetos </h4><br>  Las tablas de objetos como Pines, usuarios, tableros y comentarios tienen una ID (ID local, con una clave primaria que aumenta autom√°ticamente) y un blob que contiene JSON con todos los datos del objeto. <br><br><pre> <code class="bash hljs">CREATE TABLE pins ( local_id INT PRIMARY KEY AUTO_INCREMENT, data TEXT, ts TIMESTAMP DEFAULT CURRENT_TIMESTAMP ) ENGINE=InnoDB;</code> </pre> <br>  Por ejemplo, los objetos pin se ven as√≠: <br><br><pre> <code class="bash hljs">{‚Äúdetails‚Äù: ‚ÄúNew Star Wars character‚Äù, ‚Äúlink‚Äù: ‚Äúhttp://webpage.com/asdf‚Äù, ‚Äúuser_id‚Äù: 241294629943640797, ‚Äúboard_id‚Äù: 241294561224164665, ‚Ä¶}</code> </pre> <br>  Para crear un nuevo pin, recopilamos todos los datos y creamos un blob JSON.  Luego seleccionamos la ID de fragmento (preferimos elegir la misma ID de fragmento que el tablero en el que se coloca, pero esto no es necesario).  Para el tipo de pin 1. Nos conectamos a esta base de datos e insertamos JSON en la tabla de pin.  MySQL devolver√° una identificaci√≥n local aumentada autom√°ticamente.  ¬°Ahora tenemos un fragmento, un tipo y una nueva ID local, por lo que podemos compilar un identificador completo de 64 bits! <br><br>  Para editar el pin, leemos, modificamos y escribimos JSON usando la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">transacci√≥n MySQL</a> : <br><br><pre> <code class="bash hljs">&gt; BEGIN &gt; SELECT blob FROM db03429.pins WHERE local_id=7075733 FOR UPDATE [Modify the json blob] &gt; UPDATE db03429.pins SET blob=<span class="hljs-string"><span class="hljs-string">'&lt;modified blob&gt;'</span></span> WHERE local_id=7075733 &gt; COMMIT</code> </pre> <br>  Para eliminar un pin, puede eliminar su fila en MySQL.  Sin embargo, es mejor agregar el campo <i>"activo"</i> en JSON y establecerlo en <i>"falso"</i> , as√≠ como filtrar los resultados en el lado del cliente. <br><br><h4>  Tablas de mapeo </h4><br>  La tabla de mapeo vincula un objeto a otro, por ejemplo, un tablero con alfileres.  La tabla MySQL para mapeos contiene tres columnas: 64 bits para la ID "de", 64 bits para la ID "donde" y la ID de secuencia.  En este triple (de d√≥nde, d√≥nde, secuencia) hay claves de √≠ndice, y est√°n en el fragmento del identificador "from". <br><br><pre> <code class="bash hljs">CREATE TABLE board_has_pins ( board_id INT, pin_id INT, sequence INT, INDEX(board_id, pin_id, sequence) ) ENGINE=InnoDB;</code> </pre> <br>  Las tablas de mapeo son unidireccionales, por ejemplo, como la tabla <code>board_has_pins</code> .  Si necesita la direcci√≥n opuesta, necesitar√° una tabla <code>pin_owned_by_board</code> separada.  La ID de secuencia define la secuencia (nuestras ID no se pueden comparar entre fragmentos, porque las nuevas ID locales son diferentes).  Por lo general, insertamos nuevos pines en una nueva placa con una ID de secuencia igual al tiempo en unix (marca de tiempo de unix).  Cualquier n√∫mero puede estar en la secuencia, pero el tiempo unix es una buena manera de almacenar nuevos materiales de forma secuencial, ya que este indicador aumenta de forma mon√≥tona.  Puede echar un vistazo a los datos en la tabla de mapeo: <br><br><pre> <code class="bash hljs">SELECT pin_id FROM board_has_pins WHERE board_id=241294561224164665 ORDER BY sequence LIMIT 50 OFFSET 150</code> </pre> <br>  Esto le dar√° m√°s de 50 pin_id, que luego puede usar para buscar objetos de pin. <br>  Lo que acabamos de hacer es una combinaci√≥n de capa de aplicaci√≥n (board_id -&gt; pin_id -&gt; pin objects).  Una de las incre√≠bles propiedades de las conexiones a nivel de aplicaci√≥n es que puede almacenar en cach√© la imagen por separado del objeto.  Almacenamos pin_id en el cach√© del objeto pin en el cl√∫ster de memcache, sin embargo, guardamos board_id en pin_id en el cl√∫ster redis.  Esto nos permite elegir la tecnolog√≠a correcta que mejor se adapte al objeto en cach√©. <br><br><h3>  Aumentar la capacidad </h3><br>  Hay tres formas principales de aumentar la capacidad en nuestro sistema.  La forma m√°s f√°cil de actualizar la m√°quina (para aumentar el espacio, poner discos duros m√°s r√°pidos, m√°s RAM). <br>  La siguiente forma de aumentar la capacidad es abrir nuevas gamas.  Inicialmente, creamos un total de 4096 fragmentos, a pesar de que la identificaci√≥n del fragmento consist√≠a en 16 bits (un total de 64k fragmentos).  Solo se pueden crear nuevos objetos en estos primeros fragmentos de 4k.  En alg√∫n momento, decidimos crear nuevos servidores MySQL con fragmentos de 4096 a 8191 y comenzamos a llenarlos. <br><br>  La √∫ltima forma en que aumentamos la capacidad es mover algunos fragmentos a nuevas m√°quinas.  Si queremos aumentar la capacidad de MySQL001A (con fragmentos de 0 a 511), creamos un nuevo par maestro-maestro con los siguientes nombres m√°ximos posibles (digamos MySQL009A y B) e iniciamos la replicaci√≥n desde MySQL001A. <br><br><img src="https://habrastorage.org/webt/d2/uf/gd/d2ufgd1tttsa6tmxvpywfzgqugs.png"><br><br>  Tan pronto como se completa la replicaci√≥n, cambiamos nuestra configuraci√≥n para que en MySQL001A solo haya fragmentos de 0 a 255, y en MySQL009A de 256 a 511. Ahora cada servidor debe procesar solo la mitad de los fragmentos que proces√≥ antes. <br><br><img src="https://habrastorage.org/webt/4f/cp/do/4fcpdo2g16molbdkkfbf8xvujbi.png"><br><br><h3>  Algunas caracter√≠sticas geniales </h3><br>  ¬°Aquellos que ya ten√≠an sistemas para generar nuevos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">UUID</a> entender√°n que en este sistema los obtenemos sin costo!  Cuando crea un nuevo objeto e lo inserta en la tabla de objetos, devuelve un nuevo identificador local.  Esta ID local, combinada con la ID de fragmento y la ID de tipo, le proporciona un UUID. <br><br>  Aquellos de ustedes que han realizado ALTERS para agregar m√°s columnas a las tablas de MySQL saben que pueden trabajar extremadamente lentamente y convertirse en un gran problema.  Nuestro enfoque no requiere ning√∫n cambio en el nivel de MySQL.  En Pinterest, probablemente solo hicimos un ALTER en los √∫ltimos tres a√±os.  Para agregar nuevos campos a los objetos, solo d√≠gale a sus servicios que hay varios campos nuevos en el esquema JSON.  Puede cambiar el valor predeterminado para que cuando deserialice JSON de un objeto sin un nuevo campo, obtenga el valor predeterminado.  Si necesita una tabla de mapeo, cree una nueva tabla de mapeo y comience a llenarla cuando lo desee.  Y cuando haya terminado, puede enviar! <br><br><h3>  Fragmento de mod </h3><br>  Es casi como un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">escuadr√≥n de mods</a> , solo que completamente diferente. <br><br>  Algunos objetos deben encontrarse sin una identificaci√≥n.  Por ejemplo, si un usuario inicia sesi√≥n con una cuenta de Facebook, necesitamos mapear desde la ID de Facebook a la ID de Pinterest.  Para nosotros, los ID de Facebook son solo bits, por lo que los almacenamos en un sistema de fragmentos separado llamado mod shard. <br><br>  Otros ejemplos incluyen direcciones IP, nombre de usuario y direcci√≥n de correo electr√≥nico. <br>  Mod Shard es muy similar al sistema de fragmentaci√≥n descrito en la secci√≥n anterior, con la √∫nica diferencia de que puede buscar datos utilizando datos de entrada arbitrarios.  Esta entrada se codifica y modifica de acuerdo con el n√∫mero total de fragmentos en el sistema.  Como resultado, se obtendr√° un fragmento en el que los datos estar√°n o ya est√°n ubicados.  Por ejemplo: <br><br><pre> <code class="bash hljs">shard = md5(‚Äú1.2.3.4<span class="hljs-string"><span class="hljs-string">") % 4096</span></span></code> </pre> <br>  En este caso, el fragmento ser√° igual a 1524. Procesamos el archivo de configuraci√≥n correspondiente a la ID del fragmento: <br><br><pre> <code class="bash hljs">[{‚Äúrange‚Äù: (0, 511), ‚Äúmaster‚Äù: ‚Äúmsdb001a‚Äù, ‚Äúslave‚Äù: ‚Äúmsdb001b‚Äù}, {‚Äúrange‚Äù: (512, 1023), ‚Äúmaster‚Äù: ‚Äúmsdb002a‚Äù, ‚Äúslave‚Äù: ‚Äúmsdb002b‚Äù}, {‚Äúrange‚Äù: (1024, 1535), ‚Äúmaster‚Äù: ‚Äúmsdb003a‚Äù, ‚Äúslave‚Äù: ‚Äúmsdb003b‚Äù}, ‚Ä¶]</code> </pre> <br>  Por lo tanto, para encontrar datos en la direcci√≥n IP 1.2.3.4, necesitaremos hacer lo siguiente: <br><br><pre> <code class="bash hljs">conn = MySQLdb.connect(host=‚Äùmsdb003a‚Äù) conn.execute(‚ÄúSELECT data FROM msdb001a.ip_data WHERE ip=<span class="hljs-string"><span class="hljs-string">'1.2.3.4'</span></span>‚Äù)</code> </pre> <br>  Est√° perdiendo algunas buenas propiedades de la ID del fragmento, como la localidad espacial.  Tendr√° que comenzar con todos los fragmentos creados al principio y crear la clave usted mismo (no se generar√° autom√°ticamente).  Siempre es mejor representar objetos en su sistema con ID inmutables.  Por lo tanto, no necesita actualizar muchos enlaces cuando, por ejemplo, el usuario cambia su "nombre de usuario". <br><br><h3>  √öltimos pensamientos </h3><br>  Este sistema ha estado produciendo en Pinterest durante 3.5 a√±os, y es probable que permanezca all√≠ para siempre.  Implementarlo fue relativamente simple, pero ponerlo en funcionamiento y mover todos los datos de las m√°quinas antiguas fue dif√≠cil.  Si encuentra un problema cuando acaba de crear un nuevo fragmento, considere crear un grupo de m√°quinas de procesamiento de datos en segundo plano (sugerencia: use <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">piras</a> ) para mover sus datos con scripts de bases de datos antiguas a su nuevo fragmento.  Le garantizo que algunos de los datos se perder√°n, no importa cu√°nto lo intente (es todo gremlins, lo juro), as√≠ que repita la transferencia de datos una y otra vez hasta que la cantidad de informaci√≥n nueva en el fragmento se vuelva muy peque√±a o no sea nada. <br><br>  Se ha hecho todo lo posible para este sistema.  Pero no proporciona atomicidad, aislamiento o coherencia de ninguna manera.  Wow!  Eso suena mal!  Pero no te preocupes.  Seguramente, te sentir√°s excelente sin ellos.  Siempre puede construir estas capas con otros procesos / sistemas, si es necesario, pero de manera predeterminada y sin costo ya obtiene bastante: capacidad de trabajo.  ¬°Fiabilidad lograda a trav√©s de la simplicidad, e incluso funciona r√°pido! <br><br>  ¬øPero qu√© hay de la tolerancia a fallas?  Creamos un servicio para el mantenimiento de fragmentos de MySQL, guardamos la tabla de configuraci√≥n de fragmentos en ZooKeeper.  Cuando el servidor maestro falla, levantamos la m√°quina esclava y luego levantamos la m√°quina que la reemplazar√° (siempre actualizada).  No utilizamos el procesamiento autom√°tico de fallas hasta el d√≠a de hoy. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/467389/">https://habr.com/ru/post/467389/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../467377/index.html">Tres seguidos: los 10 mejores informes de Mobius 2019 Piter</a></li>
<li><a href="../467381/index.html">LED de varios pisos, luces inteligentes y bombillas por 18 rublos</a></li>
<li><a href="../467383/index.html">"El gerente necesita seguir codificando": entrevista con Stephen Chin</a></li>
<li><a href="../467385/index.html">Una selecci√≥n de preguntas t√©cnicas psicol√≥gicas y at√≠picas de entrevistas con desarrolladores de Java</a></li>
<li><a href="../467387/index.html">Soluciones para trabajar con comentarios y experiencia del cliente: desde servicios peque√±os hasta plataformas pesadas</a></li>
<li><a href="../467391/index.html">Yandex presenta RPKI</a></li>
<li><a href="../467393/index.html">NX Bootcamp comienza en octubre</a></li>
<li><a href="../467395/index.html">Habr Weekly # 18 / New Apple Gadgets, un tel√©fono inteligente completamente modular, el pueblo de programadores en Bielorrusia, el fen√≥meno XY</a></li>
<li><a href="../467399/index.html">No puede prohibir traer: c√≥mo implementar el concepto BYOD y no da√±ar la seguridad de la informaci√≥n</a></li>
<li><a href="../467401/index.html">Comparaci√≥n de Tesla Model S y Porsche Taycan</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>