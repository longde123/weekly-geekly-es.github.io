<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§π üë®üèæ‚Äç‚úàÔ∏è üë¥üèº Construye un andador de hierro fundido en Spring Boot y AppCDS ü§úüèæ üïë üñ§</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Application Class Data Sharing (AppCDS) : funci√≥n JVM para acelerar el inicio y ahorrar memoria. Despu√©s de haber aparecido en su infancia en HotSpot ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Construye un andador de hierro fundido en Spring Boot y AppCDS</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/472638/"><p><img src="https://habrastorage.org/webt/se/py/8z/sepy8zdhkojsr-xiqs-lwdtyegy.jpeg"></p><br><p> <strong>Application Class Data Sharing (AppCDS)</strong> : funci√≥n JVM para acelerar el inicio y ahorrar memoria.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Despu√©s de haber aparecido</a> en su infancia en HotSpot en JDK 1.5 (2004), durante mucho tiempo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">permaneci√≥</a> muy limitado e incluso parcialmente comercial.  Solo con OpenJDK 10 (2018) se <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">puso a</a> disposici√≥n de simples mortales, al mismo tiempo que se ampli√≥ el alcance.  Y recientemente <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">lanzado</a> Java 13 intent√≥ simplificar esta aplicaci√≥n. </p><br><p>  La idea de AppCDS es "compartir" clases una vez cargadas entre instancias de la misma JVM en el mismo host.  Parece que esto deber√≠a ser excelente para los microservicios, especialmente los "broilers" en Spring Boot con sus miles de clases de biblioteca, porque ahora estas clases no necesitar√°n cargarse (analizarse y verificarse) en cada inicio de cada instancia de JVM, y no se duplicar√°n en la memoria.  Esto significa que el lanzamiento deber√≠a ser m√°s r√°pido y el consumo de memoria deber√≠a ser menor.  Maravilloso, ¬øno es as√≠? </p><br><p>  Todo es as√≠, todo es as√≠.  Pero si usted, el odnokhabryanin, sol√≠a creer no en los letreros del bulevar, sino en n√∫meros y ejemplos espec√≠ficos, entonces bienvenido a kat, tratemos de descubrir c√≥mo es realmente ... </p><a name="habracut"></a><br><h2 id="vmesto-disclaimera">  En lugar de descargo de responsabilidad </h2><br><p>  Ante ti no es una gu√≠a para usar AppCDS, sino un resumen de los resultados de un peque√±o estudio.  Estaba interesado en comprender c√≥mo esta funci√≥n JVM es aplicable en mi proyecto de trabajo, y trat√© de evaluarla desde la perspectiva de un desarrollador empresarial, exponiendo el resultado en este art√≠culo.  Esto no incluy√≥ temas como el uso de AppCDS en la ruta del m√≥dulo, la implementaci√≥n de AppCDS en otras m√°quinas virtuales (no HotSpot) y las complejidades del uso de contenedores.  Pero hay una parte te√≥rica para explorar el tema, as√≠ como una parte experimental escrita para que pueda repetir la experiencia usted mismo.  Ninguno de los resultados se ha aplicado a√∫n en producci√≥n, pero qui√©n sabe c√≥mo ser√° el ma√±ana ... </p><br><h2 id="teoriya">  Teor√≠a </h2><br><h3 id="kratkoe-vvedenie-v-appcds">  Una breve introducci√≥n a AppCDS </h3><br><p>  Es posible que se haya familiarizado con este tema en varias fuentes, por ejemplo: </p><br><ul><li>  en un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">art√≠culo</a> de Nikolai Parlog (incluidos los bollos Java 13, pero sin Spring Boot) </li><li>  en un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">informe</a> y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">art√≠culo</a> de Volker Simonis (sin Java 13, pero con detalles) </li><li>  en un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">informe del</a> autor de estas l√≠neas (sin Java 13, pero con √©nfasis en Spring Boot) </li></ul><br><p>  Para no volver a contar, destacar√© solo algunos puntos que son importantes para este art√≠culo. </p><br><p>  En primer lugar, AppCDS es una extensi√≥n de la funci√≥n CDS que ha aparecido durante mucho tiempo en HotSpot, cuya esencia es la siguiente: </p><br><p><img src="https://habrastorage.org/webt/gi/kg/ro/gikgrobp0s_hbnr5ox8z6d1ziqc.png"></p><br><p>  Para hacer realidad ambas ideas, debe hacer lo siguiente (en t√©rminos generales): </p><br><ol><li>  Obtenga una lista de clases que desea compartir entre instancias de aplicaci√≥n </li><li>  Combinar estas clases en un archivo adecuado para la asignaci√≥n de memoria </li><li>  Conecte el archivo a cada instancia de la aplicaci√≥n al inicio </li></ol><br><p>  Parece que el algoritmo tiene solo 3 pasos: t√≥malo y hazlo.  Pero aqu√≠ comienzan las noticias, todo tipo de cosas. </p><br><p>  Lo malo es que, en el peor de los casos, cada uno de estos elementos se convierte en al menos un lanzamiento de JVM con sus propias opciones espec√≠ficas, lo que significa que todo el algoritmo es un malabarismo sutil del mismo tipo de opciones y archivos.  Eso no suena muy prometedor, ¬øverdad? </p><br><p>  Pero hay buenas noticias: el trabajo para mejorar este algoritmo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">est√° en curso</a> , y con cada lanzamiento de Java, su aplicaci√≥n se vuelve m√°s f√°cil.  Entonces, por ejemplo: </p><br><ul><li> En OpenJDK <strong>10 y 11,</strong> puede omitir el paso <strong>1</strong> si desea compartir solo las clases principales de JDK, ya que ya han sido compiladas para nosotros y puestas en <code>$JAVA_HOME\lib\classlist</code> (‚âà1200 piezas). </li><li>  En OpenJDK <strong>12,</strong> puede omitir el <strong>paso 2</strong> , porque junto con la lista de clases, el archivo de distribuci√≥n tambi√©n incluye un archivo listo para usar, que se usa de f√°brica y no requiere una conexi√≥n expl√≠cita. </li><li>  En caso de que quieras compartir todo lo dem√°s (y generalmente solo quieres) <br>  OpenJDK <strong>13</strong> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">proporciona</a> archivos din√°micos de CDS: archivos que se recopilan durante el funcionamiento de la aplicaci√≥n y se guardan cuando tiene personal.  Esto le permite contraer los <strong>puntos 1 y 2</strong> en un punto no demasiado confuso (aunque no todo es tan simple, pero m√°s sobre eso m√°s adelante). </li></ul><br><p>  Por lo tanto, no importa cu√°l sea el proceso de preparaci√≥n de AppCDS, los 3 pasos enumerados anteriormente siempre est√°n detr√°s, solo en algunos casos est√°n velados. </p><br><p>  Como probablemente haya notado, con el advenimiento de AppCDS, muchas clases de aplicaciones comienzan una doble vida: viven simult√°neamente en sus lugares anteriores (con mayor frecuencia archivos JAR) y en un nuevo archivo compartido.  Al mismo tiempo, el desarrollador contin√∫a cambi√°ndolos / elimin√°ndolos / complet√°ndolos en el mismo lugar, y la JVM los toma del nuevo cuando trabaja.  Uno no necesita ser un adivino para ver el peligro de tal situaci√≥n: si no se hace nada, tarde o temprano copias de las clases se corroer√°n, y obtendremos muchos encantos del t√≠pico "infierno JAR".  Est√° claro que la JVM no puede evitar cambios de clase, pero deber√≠a ser capaz de detectar una discrepancia en el tiempo.  Sin embargo, hacer esto comparando clases por pares, incluso por sumas de verificaci√≥n, es una idea;  puede negar el resto de las ganancias de productividad.  Esta es probablemente la raz√≥n por la cual los ingenieros de JVM no seleccionaron las clases individuales como el objeto de comparaci√≥n, sino el classpath completo, y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">declararon</a> en la documentaci√≥n de AppCDS: "El classpath al crear un archivo compartido debe ser el mismo (o al menos un prefijo) que con los lanzamientos de aplicaciones posteriores". </p><br><blockquote>  Tenga en cuenta que el classpath utilizado en el momento de creaci√≥n del archivo debe ser el mismo (o un prefijo) que el classpath utilizado en el tiempo de ejecuci√≥n. </blockquote><p>  Pero esta no es una declaraci√≥n inequ√≠voca, porque, como recordar√°, un classpath se puede formar de diferentes maneras, como: </p><br><ul><li>  leer archivos <code>.class</code> desnudos de directorios de paquetes compilados, <br>  Por ejemplo, <code>java com.example.Main</code> </li><li>  escanear directorios con archivos JAR cuando se usa comod√≠n, <br>  por ejemplo, <code>java -cp mydir/* com.example.Main</code> </li><li>  listado expl√≠cito de archivos JAR y / o ZIP, <br>  por ejemplo, <code>java -cp lib1.jar;lib2.jar com.example.Main</code> </li></ul><br><p>  (esto sin mencionar el hecho de que classpath tambi√©n se puede configurar de manera diferente, por ejemplo, a trav√©s de las opciones JVM <code>-cp/-classpath/--class-path</code> , la variable de entorno <code>CLASSPATH</code> o el atributo del archivo JAR de <code>Class-Path</code> que se lanzar√°) </p><br><p>  De estos m√©todos, solo uno es compatible con AppCDS: enumeraci√≥n expl√≠cita de archivos JAR.  Aparentemente, los ingenieros de HotSpot JVM consideraron que comparar classpaths en el archivo AppCDS y en la aplicaci√≥n lanzada ser√≠a lo suficientemente r√°pido y confiable solo si se especificaran con la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">mayor</a> claridad <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">posible</a> , con una lista exhaustiva habitual. </p><br><blockquote>  CDS / AppCDS solo admite clases de archivo de archivos JAR. </blockquote><p>  Es importante tener en cuenta aqu√≠ que esta declaraci√≥n no es recursiva, es decir  no se aplica a los archivos JAR dentro de los archivos JAR (a menos que se trate de CDS din√°mico, consulte a continuaci√≥n).  Esto significa que las mu√±ecas JAR habituales emitidas por Spring Boot no funcionar√°n as√≠ con AppCDS regular, tendr√° que sentarse. </p><br><p>  Otro inconveniente en el trabajo de CDS es que los archivos compartidos se proyectan en la memoria con direcciones fijas (generalmente a partir de <code>0x800000000</code> ).  Esto en s√≠ mismo no es malo, pero dado que la Aleatorizaci√≥n del dise√±o del espacio de direcciones (ASLR) est√° habilitada de manera predeterminada en la mayor√≠a de los sistemas operativos, el rango de memoria requerido puede estar parcialmente ocupado.  Lo que hace el HotSpot JVM en este caso es la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">opci√≥n</a> especial <code>-Xshare</code> que admite tres valores: </p><br><ul><li>  <code>-Xshare:on</code> - force CDS / AppCDS;  Si el rango est√° ocupado, la JVM sale con un error.  Este modo <strong>no se recomienda para su uso en producci√≥n</strong> , ya que puede provocar bloqueos espor√°dicos al iniciar aplicaciones. </li><li>  <code>-Xshare:off</code> - (usted) cambia CDS / AppCDS;  desactiva el uso de datos compartidos por completo (incluidos los archivos incrustados) </li><li>  <code>-Xshare:auto</code> : el comportamiento predeterminado de la JVM cuando, en caso de imposibilidad de asignar el rango de memoria requerido, se entrega silenciosamente y carga las clases como de costumbre </li></ul><br><p>  Al momento de escribir este art√≠culo, Oracle solo est√° <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">trabajando</a> para solucionar estos problemas, pero a√∫n no se ha asignado un n√∫mero de versi√≥n. </p><br><p>  Estas opciones son parcialmente √∫tiles para nosotros m√°s adelante, pero por ahora veamos ... </p><br><h3 id="varianty-primeneniya-appcds">  Aplicaciones de AppCDS </h3><br><p>  Hay varias formas de hacerlo con AppCDS. <del>  arruinar tu vida </del>  optimizar el trabajo de microservicios.  Var√≠an mucho en complejidad y ganancias potenciales, por lo que es importante decidir de inmediato cu√°l se discutir√° m√°s adelante. </p><br><p>  Lo m√°s simple es usar ni siquiera AppCDS, sino solo CDS; esto es cuando solo las clases de plataforma entran en el archivo compartido (consulte "Una breve introducci√≥n a AppCDS").  Eliminaremos esta opci√≥n de inmediato, porque cuando se aplica a microservicios en Spring Boot, genera muy pocas ganancias.  Esto se puede ver por la proporci√≥n del n√∫mero de clases compartidas en su distribuci√≥n general usando el ejemplo de un microservicio real (ver el segmento verde): </p><br><p><img src="https://habrastorage.org/webt/lz/7x/9l/lz7x9lodfzwv4ihwjjifjyxsf_a.png"></p><br><p>  M√°s complejo, pero prometedor es el uso de AppCDS completo, es decir, la inclusi√≥n de las clases de biblioteca y aplicaci√≥n en el mismo archivo.  Esta es una familia completa de opciones que se deriva de combinaciones de la cantidad de aplicaciones participantes y la cantidad de instancias.  Las siguientes son evaluaciones subjetivas de los autores sobre los beneficios y dificultades de varias aplicaciones de AppCDS. </p><br><div class="scrollable-table"><table><thead><tr><th>  No </th><th>  Aplicaciones </th><th>  Instancias </th><th>  Beneficio de la CPU </th><th>  Ganancia de RAM </th><th>  Dificultad </th></tr></thead><tbody><tr><td>  1 </td><td>  Uno </td><td>  Uno </td><td>  + </td><td>  ¬± </td><td>  Bajo </td></tr><tr><td>  <strong>2</strong> </td><td>  <strong>Uno</strong> </td><td>  <strong>Unos pocos</strong> </td><td>  <strong>++</strong> </td><td>  <strong>++</strong> </td><td>  <strong>Bajo</strong> </td></tr><tr><td>  3 </td><td>  Unos pocos </td><td>  Uno a la vez </td><td>  ++ </td><td>  ++ </td><td>  Alta </td></tr><tr><td>  4 4 </td><td>  Unos pocos </td><td>  Unos pocos </td><td>  +++ </td><td>  +++ </td><td>  Alta </td></tr></tbody></table></div><br><p>  Presta atenci√≥n: </p><br><ul><li>  En la aplicaci√≥n para una aplicaci√≥n en una instancia (No. 1), el beneficio de la memoria puede llegar a ser cero o incluso negativo (especialmente cuando se mide <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">bajo Windows</a> ) </li><li>  La creaci√≥n del archivo compartido correcto requiere acciones, cuya complejidad no depende de cu√°ntas copias se lanzar√° la aplicaci√≥n (compare los pares de opciones No. 1-2 y No. 3-4) </li><li>  Al mismo tiempo, la transici√≥n de una instancia a varias, obviamente, aumenta las ganancias para ambos indicadores, pero no afecta la complejidad de la preparaci√≥n. </li></ul><br><p>  En este art√≠culo, <strong>solo llegaremos a la opci√≥n n. ¬∞ 2</strong> (a trav√©s del n. ¬∞ 1), ya que es lo suficientemente simple para un conocimiento cercano de AppCDS y solo sin trucos adicionales podemos usar los archivos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">JEP-350</a> Dynamic CDS lanzados recientemente, que quiero sentir en acci√≥n. </p><br><h3 id="dynamic-cds-archives">  Archivos din√°micos de CDS </h3><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Los</a> archivos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">JEP-350</a> Dynamic CDS, una de las principales innovaciones de Java 13, est√°n dise√±ados para simplificar el uso de AppCDS.  Para sentir la simplificaci√≥n, primero debe comprender la complejidad.  Perm√≠tame recordarle que el algoritmo cl√°sico "limpio" para aplicar AppCDS consta de 3 pasos: (1) obtener una lista de clases compartidas, (2) crear un archivo a partir de ellas y (3) ejecutar la aplicaci√≥n con el archivo conectado.  De estos pasos, solo el tercero es realmente √∫til, el resto es solo preparaci√≥n para ello.  Y aunque obtener una lista de clases (paso 1) puede parecer muy simple (en algunos casos, incluso es opcional), de hecho, cuando se trabaja con aplicaciones no triviales, resulta ser la m√°s dif√≠cil, especialmente con respecto a Spring Boot.  Por lo tanto, se necesita JEP-350 solo para eliminar este paso, o mejor dicho, automatizarlo.  La idea es que la propia JVM dibuje una lista de las clases que necesita la aplicaci√≥n, y luego forme a s√≠ misma el llamado archivo "din√°mico".  De acuerdo, suena bien.  Pero el problema es que ahora no est√° claro en qu√© punto dejar de acumular clases y proceder a colocarlas en el archivo.  Anteriormente, en el cl√°sico AppCDS, eleg√≠amos ese momento nosotros mismos e incluso pod√≠amos meternos entre estas acciones para cambiar algo en la lista de clases antes de convertirlo en un archivo.  Ahora esto est√° sucediendo autom√°ticamente y solo en un momento, para el cual los ingenieros de JVM han elegido, quiz√°s, la √∫nica opci√≥n de compromiso: el apagado regular de la JVM.  Esto significa que el archivo no se crear√° hasta que la aplicaci√≥n se detenga.  Esta soluci√≥n tiene un par de consecuencias importantes: </p><br><ul><li>  En el caso de un bloqueo de JVM, el archivo no se crear√°, no importa cu√°n maravillosa sea la lista de clases acumuladas para entonces (no puede extraerla m√°s tarde usando medios regulares). </li><li>  El archivo se crear√° solo a partir de aquellas clases que lograron cargarse durante la sesi√≥n de la aplicaci√≥n.  Para las aplicaciones web, esto significa que crear un archivo iniciando y deteni√©ndose all√≠ mismo no es correcto, ya que muchas clases importantes no entrar√°n en el archivo.  Es necesario ejecutar al menos una solicitud HTTP a la aplicaci√≥n (y es mejor ejecutarla correctamente en todos los escenarios) para que se carguen todas las clases que realmente utiliza. </li></ul><br><p>  Una diferencia importante entre los archivos din√°micos y est√°ticos es que siempre representan un "complemento" sobre los archivos est√°ticos b√°sicos, que pueden ser archivos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">integrados</a> en el kit de distribuci√≥n de Java o creados por separado en una forma cl√°sica de 3 pasos. </p><br><p>  Sint√°cticamente, el uso de Dynamic CDS Archives se reduce a dos lanzamientos de JVM con dos opciones: </p><br><ol><li>  <code>-XX:ArchiveClassesAtExit=archive.jsa</code> prueba con la opci√≥n <code>-XX:ArchiveClassesAtExit=archive.jsa</code> , al final del cual se crear√° un archivo din√°mico (puede especificar cualquier ruta y nombre) </li><li>  Lanzamiento √∫til con la opci√≥n <code>-XX:SharedArchiveFile=archive.jsa</code> , que utilizar√° el archivo creado anteriormente </li></ol><br><p>  La segunda opci√≥n no es diferente de conectar un archivo est√°tico normal.  Pero si de repente el archivo est√°tico b√°sico no est√° en la ubicaci√≥n predeterminada (dentro del JDK), entonces esta opci√≥n tambi√©n puede incluir una indicaci√≥n de la ruta, por ejemplo: </p><br><pre> <code class="bash hljs">-XX:SharedArchiveFile=base.jsa:dynamic.jsa</code> </pre> <br><p>  <em>(en Windows, el separador de ruta debe ser el car√°cter ";")</em> </p><br><p>  Ahora ya sabe lo suficiente sobre AppCDS para poder verlo en acci√≥n. </p><br><h2 id="praktika">  Practica </h2><br><h3 id="podopytnyy-krolik">  Conejo experimental </h3><br><p>  Para que nuestra aplicaci√≥n de AppCDS en la pr√°ctica no se limite a un t√≠pico HelloWorld, tomaremos como base la aplicaci√≥n real en Spring Boot.  Mis colegas y yo a menudo tenemos que ver registros de aplicaciones en servidores de prueba remotos y ver "en vivo", tal como est√°n escritos.  Para usar esto, un agregador de registro completo (como ELK) a menudo no es apropiado;  descargar archivos de registro sin fin, durante mucho tiempo, y mirar la salida gris de la consola de la <code>tail</code> es deprimente.  Por lo tanto, cre√© una aplicaci√≥n web que puede generar cualquier registro en tiempo real directamente en el navegador, colorear las l√≠neas por nivel de importancia (al mismo tiempo formateando XML), agregar varios registros en uno, as√≠ como otros trucos.  Se llama <strong>ANAL√ìGICO</strong> (como un "analizador de registros", aunque esto no es cierto) y se encuentra <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">en GitHub</a> .  Haga clic en la captura de pantalla para ampliar: </p><br><p> <a href=""><img src="https://habrastorage.org/webt/q3/lo/m_/q3lom_x6c9wghlerm1g9oa9-yfw.png"></a> </p><br><p>  T√©cnicamente, esta es una aplicaci√≥n en Spring Boot + Spring Integration, bajo la cual <code>kubectl</code> <code>tail</code> , <code>docker</code> y <code>kubectl</code> (para admitir registros de archivos, contenedores Docker y recursos de Kubernetes, respectivamente).  Viene en la forma del cl√°sico archivo "grueso" Spring Boot JAR.  En tiempo de ejecuci√≥n, <strong>las clases K10K est√°n colgadas</strong> en la memoria de la aplicaci√≥n, de las cuales la gran mayor√≠a son clases Spring y JDK.  Obviamente, estas clases cambian muy raramente, lo que significa que pueden colocarse en un archivo compartido y reutilizarse en todas las instancias de la aplicaci√≥n, ahorrando memoria y CPU. </p><br><h3 id="odinochnyy-eksperiment">  Experimento individual </h3><br><p>  Ahora apliquemos el conocimiento existente de Dynamic AppCDS al conejo experimental.  Como todo se sabe en comparaci√≥n, necesitaremos alg√∫n punto de referencia: el estado del programa con el que compararemos los resultados obtenidos durante el experimento. </p><br><h4 id="vvodnye-zamechaniya">  Observaciones introductorias </h4><br><ul><li>  Todos los comandos adicionales son para Linux.  Las diferencias para Windows y macOS no son fundamentales. </li><li>  La compilaci√≥n JIT puede afectar notablemente los resultados y, en teor√≠a, por la pureza del experimento, podr√≠a desactivarse (con la opci√≥n <code>-Xint</code> , como se hizo en el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">art√≠culo</a> mencionado), pero en aras de la m√°xima credibilidad se decidi√≥ no hacerlo. </li><li>  Los siguientes n√∫meros sobre la hora de inicio se obtuvieron en un servidor de prueba r√°pida.  En m√°quinas en funcionamiento, los n√∫meros similares, por regla general, son m√°s modestos, pero como no estamos interesados ‚Äã‚Äãen valores absolutos, sino en incrementos porcentuales, consideramos que esta diferencia es insignificante. </li><li>  Para no entrar prematuramente en la complejidad de medir la memoria compartida, por ahora omitiremos obtener lecturas precisas en bytes.  En su lugar, presentamos el concepto de " <strong>potencial de CDS</strong> " <strong>,</strong> expresado como un porcentaje del n√∫mero de clases compartidas al n√∫mero total de clases cargadas.  Esto, por supuesto, es una cantidad abstracta, pero por otro lado, afecta directamente el consumo de memoria real;  Adem√°s, su definici√≥n no depende en absoluto del sistema operativo, y para su c√°lculo, solo los registros son suficientes. </li></ul><br><h4 id="referentnaya-tochka">  Punto de referencia </h4><br><p>  Deje que este punto sea el estado de una aplicaci√≥n reci√©n descargada, es decir  sin el uso expl√≠cito de cualquier AppCDS'ov y otros.  Para evaluarlo, necesitamos: </p><br><ol><li><p>  Instale OpenJDK 13 (por ejemplo, la distribuci√≥n nacional de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Liberica</a> , pero no la versi√≥n lite). <br>  Tambi√©n debe agregarse a la variable de entorno PATH o a <code>JAVA_HOME</code> , por ejemplo, as√≠: </p><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">export</span></span> JAVA_HOME=~/tools/jdk-13</code> </pre> <br></li><li><p>  <a href="">Descargue</a> ANALOG (al momento de escribir este art√≠culo, la √∫ltima versi√≥n era v0.12.1). </p><br><p>  Si es necesario, puede especificar en el archivo <code>config/application.yaml</code> en el par√°metro <code>server.address</code> el nombre del host externo para acceder a la aplicaci√≥n (de manera predeterminada, <code>localhost</code> se especifica all√≠). </p><br></li><li><p>  Habilite el registro de carga de clase JVM. <br>  Para hacer esto, puede <code>JAVA_OPTS</code> la variable de entorno <code>JAVA_OPTS</code> con este valor: </p><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">export</span></span> JAVA_OPTS=-Xlog:class+load=info:file=<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>/class-load.log</code> </pre> <br><p>  Esta opci√≥n se pasar√° a la JVM y le dice que se <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">comprometa la</a> fuente de cada clase. </p><br></li><li><p>  Ejecute una prueba de funcionamiento: </p><br><ol><li>  Ejecute la aplicaci√≥n con el script <code>bin/analog</code> </li><li>  Abra <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">http: // localhost: 8083</a> en el navegador, presione botones y daws </li><li>  Detenga la aplicaci√≥n presionando <code>Ctrl+C</code> en la consola de script <code>bin/analog</code> </li></ol><br></li><li><p>  Tome el resultado (de los archivos en el directorio <code>log/</code> ) </p><br><ul><li><p>  N√∫mero total de clases cargadas (por <code>class-load.log</code> ): </p><br><pre> <code class="bash hljs">cat class-load.log | wc -l 10463</code> </pre> <br></li><li><p>  Cu√°ntos de ellos se descargan de un archivo compartido (de acuerdo con √©l): </p><br><pre> <code class="bash hljs">grep -o <span class="hljs-string"><span class="hljs-string">'source: shared'</span></span> - class-load.log 1146</code> </pre> <br></li><li><p>  Tiempo de inicio promedio (despu√©s de una serie de inicios; por <code>analog.log</code> ): </p><br><pre> <code class="bash hljs">grep -oE <span class="hljs-string"><span class="hljs-string">'\(JVM running for .+\)'</span></span> analog.log | grep -oE <span class="hljs-string"><span class="hljs-string">'[0-9]\.[0-9]+'</span></span> | awk <span class="hljs-string"><span class="hljs-string">'{ total += $1; count++ } END { print total/count }'</span></span> 4.5225</code> </pre> <br></li></ul><br></li></ol><br><p>  Entonces, en este paso, el potencial de CDS era <code>1146/10463=0,1095</code> <strong>¬± 11%</strong> .  Si le sorprende de d√≥nde provienen las clases compartidas (despu√©s de todo, todav√≠a no hemos incluido ning√∫n AppCDS), entonces le recuerdo que a partir de la versi√≥n 12, el JDK <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">incluye el</a> archivo CDS terminado <code>$JAVA_HOME/lib/server/classes.jsa</code> , construido por nada menos que lista lista de clases: </p><br><pre> <code class="bash hljs">cat <span class="hljs-variable"><span class="hljs-variable">$JAVA_HOME</span></span>/lib/classlist | wc -l 1170</code> </pre> <br><p>  Ahora, habiendo evaluado el estado inicial de la aplicaci√≥n, podemos aplicarle AppCDS y, en comparaci√≥n, entender lo que esto proporciona. </p><br><h4 id="osnovnoy-opyt">  Experiencia central </h4><br><p>  Como nos dej√≥ la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">documentaci√≥n</a> , para crear un archivo din√°mico AppCDS, debe realizar solo una ejecuci√≥n de prueba de la aplicaci√≥n con la opci√≥n <code>-XX:ArchiveClassesAtExit</code> .  Desde el pr√≥ximo lanzamiento, el archivo se puede usar y recibir ganancias.  Para verificar esto en el mismo conejo experimental (AnaLog), necesita: </p><br><ol><li><p>  Agregue la opci√≥n especificada al comando de ejecuci√≥n: </p><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">export</span></span> JAVA_OPTS=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$JAVA_OPTS</span></span></span><span class="hljs-string"> -XX:ArchiveClassesAtExit=work/classes.jsa"</span></span></code> </pre> <br></li><li><p>  Extender el registro: </p><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">export</span></span> JAVA_OPTS=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$JAVA_OPTS</span></span></span><span class="hljs-string"> -Xlog:cds=debug:file=log/cds.log"</span></span></code> </pre><br><p>  Esta opci√≥n forzar√° el proceso de creaci√≥n de un archivo CDS para que se registre cuando se detenga la aplicaci√≥n. </p><br></li><li><p>  Realice la misma prueba que con el punto de referencia: </p><br><ol><li>  Ejecute la aplicaci√≥n con el script <code>bin/analog</code> </li><li>  Abra <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">http: // localhost: 8083</a> en el navegador, presione botones y daws </li><li>  Detenga la aplicaci√≥n presionando <code>Ctrl+C</code> en la consola de script <code>bin/analog</code> <br>  Despu√©s de eso, una tremenda plantilla con todo tipo de advertencia deber√≠a caer en la consola, y el <code>log/cds.log</code> deber√≠a llenarse de detalles;  Todav√≠a no nos interesan. </li></ol><br></li><li><p>  Cambie el modo de inicio de prueba a √∫til: </p><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">export</span></span> JAVA_OPTS=<span class="hljs-string"><span class="hljs-string">"-XX:SharedArchiveFile=work/classes.jsa -Xlog:class+load=info:file=log/class-load.log -Xlog:class+path=debug:file=log/class-path.log"</span></span></code> </pre><br><p>  Aqu√≠ no complementamos la variable <code>JAVA_OPTS</code> , sino que la <code>JAVA_OPTS</code> a borrar con nuevos valores que incluyen (1) usar un archivo compartido, (2) registrar fuentes de clase y (3) registrar comprobaciones de ruta de clase. </p><br></li><li><p>  Realice un lanzamiento √∫til de la aplicaci√≥n de acuerdo con el esquema del p√°rrafo 3. </p><br></li><li><p>  Tome el resultado (de los archivos en el directorio <code>log/</code> ) </p><br><ul><li><p>  Verificando que AppCDS realmente se aplica (por el <code>class-path.log</code> ): </p><br><pre> <code class="plaintext hljs">[0.011s][info][class,path] type=BOOT [0.011s][info][class,path] Expecting BOOT path=/home/upc/tools/jdk-13/lib/modules [0.011s][info][class,path] ok [0.011s][info][class,path] type=APP [0.011s][info][class,path] Expecting -Djava.class.path=/home/upc/tmp/analog/lib/analog.jar [0.011s][info][class,path] ok</code> </pre><br><p>  Las marcas <code>ok</code> despu√©s de las l√≠neas <code>type=BOOT</code> y <code>type=APP</code> indican la apertura, verificaci√≥n y carga exitosas de los archivos CDS incorporados y aplicados, respectivamente. </p><br></li><li><p>  N√∫mero total de clases cargadas (por <code>class-load.log</code> ): </p><br><pre> <code class="bash hljs">cat class-load.log | wc -l 10403</code> </pre><br></li><li><p>  Cu√°ntos de ellos se descargan de un archivo compartido (de acuerdo con √©l): </p><br><pre> <code class="bash hljs">grep -o <span class="hljs-string"><span class="hljs-string">'source: shared'</span></span> -c class-load.log 6910</code> </pre><br></li><li><p>  Tiempo promedio de inicio (despu√©s de una serie de inicios; por archivo <code>analog.log</code> ): </p><br><pre> <code class="bash hljs">grep -oE <span class="hljs-string"><span class="hljs-string">'\(JVM running for .+\)'</span></span> analog.log | grep -oE <span class="hljs-string"><span class="hljs-string">'[0-9]\.[0-9]+'</span></span> | awk <span class="hljs-string"><span class="hljs-string">'{ total += $1; count++ } END { print total/count }'</span></span> 4.04167</code> </pre><br></li></ul><br></li></ol><br><p>  Pero en este paso, el potencial de CDS ya era <code>6910/10403‚âà0,66</code> <strong>= 66%</strong> , es decir, aument√≥ <strong>en un 55% en</strong> comparaci√≥n con el punto de referencia.  Al mismo tiempo, el tiempo de lanzamiento promedio se redujo en <code>(4,5225-4,04167)=0,48</code> segundos, es decir  El inicio es m√°s r√°pido en un <strong>¬± 10,6%</strong> del valor inicial. </p><br><h4 id="analiz-rezultatov">  An√°lisis de resultados </h4><br><p>  <em>El t√≠tulo de trabajo del art√≠culo es: "¬øPor qu√© tan poco?"</em> </p><br><p>  Nosotros, como, hicimos todo de acuerdo con las instrucciones, pero no todas las clases estaban en el archivo.  Su n√∫mero afecta el tiempo de lanzamiento no menos que la potencia de c√°lculo de la m√°quina del experimentador, por lo que nos concentraremos en este n√∫mero. </p><br><p>  Si recuerdas, ignoramos el archivo <code>log/cds.log</code> creado durante la detenci√≥n de la aplicaci√≥n experimental despu√©s de la ejecuci√≥n de prueba.  En este archivo HotSpot, la JVM se√±al√≥ amablemente las clases de advertencia para cada clase que no aparec√≠an en el archivo CDS.  Aqu√≠ est√° el n√∫mero total de tales marcas: </p><br><pre> <code class="bash hljs">grep -o <span class="hljs-string"><span class="hljs-string">'[warning]'</span></span> cds.log -c 3591</code> </pre><br><p>  Teniendo en cuenta que solo se mencionan 10K + clases en el registro <code>class-load.log</code> y el 66% de ellas se cargan desde el archivo comprimido, no es dif√≠cil entender que las 3600 clases enumeradas en <code>cds.log</code> son el 44% "perdido" del potencial CDS.  Ahora debe averiguar por qu√© se omitieron. </p><br><p>  Si observa el registro de cds.log, resulta que solo hay 4 razones √∫nicas para omitir clases.  Aqu√≠ hay ejemplos de cada uno de ellos: </p><br><pre> <code class="plaintext hljs">Skipping org/springframework/web/client/HttpClientErrorException: Not linked Pre JDK 6 class not supported by CDS: 49.0 org/jrobin/core/RrdUpdater Skipping java/util/stream/Collectors$$Lambda$554: Unsafe anonymous class Skipping ch/qos/logback/classic/LoggerContext: interface org/slf4j/ILoggerFactory is excluded</code> </pre><br><p>  Entre las 3591 clases perdidas, estas razones se encuentran aqu√≠ con tanta frecuencia: </p><br><p><img src="https://habrastorage.org/webt/sp/f6/6k/spf66kzmkajvdxki1xdiwjyx9lg.png"></p><br><p>  M√≠ralos m√°s de cerca: </p><br><ul><li><p> <code>Unsafe anonymous class</code> <br>   JVM   ‚Äú‚Äù   ,       -,         . </p><br></li><li><p> <code>Not linked</code> <br>      , ‚Äú‚Äù     ,  ,   .      ,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">StackOverflow </a>    . , ,       ‚Äú‚Äù () JAR-  ,   AppCDS.       ,     (  ). </p><br></li><li><p> <code>Pre JDK 6 class</code> <br>  ,   CDS    Java 5.        class-   ,   CDS    .    ,    ,  6,  Java,       .       -   ,      runtime- (, slf4j). </p><br></li><li><p> <code>Skipping ... : super class/interface ... is excluded</code> <br>   ,  ‚Äú‚Äù     .          CDS',    .  Por ejemplo: </p><br><pre> <code class="plaintext hljs">[warning][cds] Pre JDK 6 class not supported by CDS: 49.0 org/slf4j/spi/MDCAdapter [warning][cds] Skipping ch/qos/logback/classic/util/LogbackMDCAdapter: interface org/slf4j/spi/MDCAdapter is excluded</code> </pre><br></li></ul><br><p>  <strong>Conclusi√≥n</strong> </p><br><blockquote>  CDS       100%. </blockquote><p> ,     ,  ,         ,  ,     .      . </p><br><h3 id="mnozhestvennyy-eksperiment">   </h3><br><p>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">JEP-310</a> , AppCDS                         JDK.   .       ,     .    CDS (, ,     )       . </p><br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para clonar el conejo experimental (ejecutar AnaLog en varios casos), necesitamos cambiar algo en la configuraci√≥n; </font><font style="vertical-align: inherit;">esto permitir√° que los procesos levantados no se "acoplen". </font><font style="vertical-align: inherit;">Gracias a Spring Boot, puede hacer esto sin editar o copiar ning√∫n archivo; </font><font style="vertical-align: inherit;">cualquier configuraci√≥n puede ser anulada por las opciones de JVM. </font><font style="vertical-align: inherit;">El reenv√≠o de estas opciones desde la variable de entorno </font></font><code>ANALOG_OPTS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">proporciona un script de inicio, generosamente generado por Gradle.</font></font></p><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">export</span></span> ANALOG_OPTS=<span class="hljs-string"><span class="hljs-string">"-Djavamelody.enabled=false -Dlogging.config=classpath:logging/logback-console.xml"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> ANALOG_OPTS=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ANALOG_OPTS</span></span></span><span class="hljs-string"> -Dnodes.this.agentPort=7801 -Dserver.port=8091"</span></span></code> </pre><br><p>      JavaMelody,             ,        ,       .     TCP-    ;       . </p><br><p>  ,    ,   JVM      AppCDS    .         <code>JAVA_OPTS</code>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">JVM Unified Logging Framework</a> : </p><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">export</span></span> JAVA_OPTS=<span class="hljs-string"><span class="hljs-string">"-Xlog:class+load=info:file=log/class-load-%p.log -Xlog:class+path=debug:file=log/class-path-%p.log"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> JAVA_OPTS=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$JAVA_OPTS</span></span></span><span class="hljs-string"> -XX:SharedArchiveFile=work/classes.jsa"</span></span></code> </pre><br><p>        <code>%p</code> ,    JVM      (PID).   AppCDS  ,     (         ). </p></div></div><br><h4 id="osnovnoy-opyt-1">   </h4><br><p>  ,          .                  .     : </p><br><ol><li><p>      <code>server.port</code>  <code>nodes.this.agentPort</code> ,      : </p><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">export</span></span> ANALOG_OPTS=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ANALOG_OPTS</span></span></span><span class="hljs-string"> -Dnodes.this.agentPort=7801 -Dserver.port=8091"</span></span></code> </pre><br><p> ,       (    ). </p><br></li><li><p>    <code>bin/analog</code> </p><br><p> <em>()</em>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">http://localhost:8091</a>  ,     </p><br></li><li><p>  PID  (  ), : </p><br><pre> <code class="bash hljs">pgrep -f analog 13792</code> </pre><br></li><li><p>      <code>pmap</code> (    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="> </a> ): </p><br><pre> <code class="bash hljs">pmap -XX 13792 | sed -n -e <span class="hljs-string"><span class="hljs-string">'2p;$p'</span></span> Address Perm Offset Device Inode Size KernelPageSize MMUPageSize Rss Pss Shared_Clean Shared_Dirty Private_Clean Private_Dirty Referenced Anonymous LazyFree AnonHugePages ShmemPmdMapped Shared_Hugetlb Private_Hugetlb Swap SwapPss Locked ProtectionKey VmFlagsMapping 3186952 1548 1548 328132 325183 3256 0 10848 314028 212620 314024 0 0 0 0 0 0 0 325183 0 KB</code> </pre><br><p>           ;   . </p><br></li><li><p>   1-4     (,  ). </p><br></li></ol><br><h4 id="analiz-rezultatov-1">   </h4><br><p>    <code>pmap</code>             .        CDS'    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">   </a> .    ,  ,        PSS: </p><br><blockquote> The "proportional set size" (PSS) of a process is the count of pages it has in memory, where each page is divided by the number of processes sharing it. So if a process has 1000 pages all to itself, and 1000 shared with one other process, its PSS will be 1500. </blockquote><p>  ,   ,  ‚Äú ‚Äù .        ,      . </p><br><p>    PSS       ,    : </p><br><div class="scrollable-table"><table><thead><tr><th> Iteration: </th><th>  1 </th><th>  2 </th><th>  3 </th><th>  4 4 </th><th>  5 5 </th></tr></thead><tbody><tr><td> PSS of inst#1: </td><td> 339 088 </td><td> 313 778 </td><td> 305 517 </td><td> 301 153 </td><td> 298 604 </td></tr><tr><td> PSS of inst#2: </td><td></td><td> 314 904 </td><td> 306 567 </td><td> 302 555 </td><td> 299 919 </td></tr><tr><td> PSS of inst#3: </td><td></td><td></td><td> 314 914 </td><td> 311 008 </td><td> 308 691 </td></tr><tr><td> PSS of inst#4: </td><td></td><td></td><td></td><td> 306 563 </td><td> 304 495 </td></tr><tr><td> PSS of inst#5: </td><td></td><td></td><td></td><td></td><td> 294 686 </td></tr><tr><td> <em>Average:</em> </td><td> 339 088 </td><td> 314 341 </td><td> 308 999 </td><td> 305 320 </td><td> 301 279 </td></tr></tbody></table></div><br><p>         ,      - : </p><br><ul><li>        ‚Äú‚Äù  </li><li>     , PSS   </li><li>  ‚Äú‚Äù ,     PSS      </li></ul><br><p>    ,      .         AppCDS.        ,       <code>-XX:SharedArchiveFile=work/classes.jsa</code>   <code>-Xshare:off</code> ,    CDS .              ,    . </p><br><p><img src="https://habrastorage.org/webt/vq/4s/n6/vq4sn66zppmcyl5aovqj6xpkwyq.png"></p><br><p>       : </p><br><ul><li><p>  PSS  AppCDS      CDS. <br>          <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a> .  ,  ,    HelloWorld- JVM   CDS   2   ,   CDS.      PSS            CDS,     .        : </p><br></li><li><p>    PSS   AppCDS    2-  ; 3-      . <br>        ,      ,    ,     .  ,        AppCDS,   ,   ,      3-    . <br>  :    ,    CDS?      : </p><br></li><li><p>    CDS/AppCDS  JVM      ,  PSS       .  ,    ,      <code>pmap</code> ,   ‚Äú‚Äù   <code>sed</code> '.              : </p><br><pre> <code class="bash hljs">pmap -X `pgrep -f analog` 14981: <span class="hljs-comment"><span class="hljs-comment"># ... Address Perm Offset Device Inode Size Rss Pss ... Mapping # ... ... 7faf5e31a000 r-xp 00000000 08:03 269427 17944 14200 14200 ... libjvm.so # ... ... 7faf5f7f9000 r-xp 00000000 08:03 1447189 1948 1756 25 ... libc-2.27.so</span></span></code> </pre><br><p>       ( <code>Mapping</code> )  , ‚Äú‚Äù      .       JVM  ( <code>libjvm.so</code>   ),     ( <code>libc-2.27.so</code>  ).    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a>        : </p><br><blockquote> For the Java VM, the read-only parts of the loaded shared libraries (ie <code>libjvm.so</code> ) can be shared between all the VM instances running at the same time. This explains why, taking together, the two VM's consume less memory (ie have a smaller memory footprint) than the simple sum of their single resident set sizes when running alone. </blockquote><br></li></ul><br><p>           .     ,  , .  ,          ,         JVM     ,    Java-    .       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">  </a>  GeekOut: </p><br><p><img src="https://habrastorage.org/webt/wp/ia/qo/wpiaqom-2teiw_iegjacskkt3sm.png"></p><br><p> , , ,      AppCDS    , ..     Java-.   ,             JVM,  , -      . </p><br><p>       VisualVM      Metaspace    AppCDS  ,      : </p><br><p> <strong> AppCDS</strong> </p><br><p><img src="https://habrastorage.org/webt/pt/wv/6r/ptwv6rmyk8j7f7yzgxrjkqrsvww.png"></p><br><p> <strong> AppCDS</strong> </p><br><p><img src="https://habrastorage.org/webt/dt/jn/0m/dtjn0mdpcgykbfynjbwdma2vmqm.png"></p><br><p>   ,         128     Metaspace   AppCDS    <code>64.2 MiB / 8.96 MiB</code> <strong>‚âà7,2  </strong> ,   CDS .            (.  )       <code>66.4 MiB / 13.9 MiB</code> <strong>‚âà4,8 </strong> .      ,    AppCDS      ,       Metaspace.            Metaspace,    ,    CDS . </p><br><h2 id="vmesto-zaklyucheniya">  En lugar de una conclusi√≥n </h2><br><p>            Spring Boot  AppCDS ‚Äì  JVM,        . </p><br><ul><li>            JEP-350 Dynamic CDS Archives ‚Äì    JDK 13. </li><li>    Spring Boot  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">√≥</a>          CDS (  ). ,           100%   -   <strong>66%</strong> .      ,      <strong>‚âà11%</strong> (    15%,      ). </li><li>     ,       5-     PSS (      ).  ,  AppCDS     ,   <strong>  </strong>           , <strong> 8%</strong> (PSS).       ,    CDS,     ,     .        AppCDS  <strong> </strong> . </li><li>          Metaspace,  ,         AppCDS  <strong> 5  </strong> ,   CDS. </li></ul><br><p> ,    , AppCDS,  ,    ‚Äúkiller feature‚Äù.           Spring Boot.   ,   ,    AppCDS      .  , ,        AppCDS   <em></em>   Spring Boot.              ,      ‚Ä¶ </p><br><p> <em>  by <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Nick Fewings</a> on <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Unsplash</a></em> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/472638/">https://habr.com/ru/post/472638/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../472620/index.html">Datos del museo Art. Inspecci√≥n del terminal de video Mera CM 7209</a></li>
<li><a href="../472622/index.html">Plan de nivelaci√≥n para la profesi√≥n Ingeniero de datos</a></li>
<li><a href="../472626/index.html">Revisi√≥n de la placa base ASRock Z390 Phantom Gaming 7: preparaci√≥n para 9900KS</a></li>
<li><a href="../472628/index.html">Codificaciones, cifrado de turno, hashes brutas y creaci√≥n de im√°genes con PIL python. Resoluci√≥n de problemas con r0ot-mi Cryto. Parte 1</a></li>
<li><a href="../472636/index.html">Resumen del programa DotNext 2019 Mosc√∫: ¬øqui√©n le dir√° qu√©?</a></li>
<li><a href="../472640/index.html">Lo que aprend√≠ en 6 a√±os ayudando a las startups a crecer</a></li>
<li><a href="../472642/index.html">Webdev independiente: c√≥mo y con qui√©n NO deber√≠a trabajar</a></li>
<li><a href="../472644/index.html">Pasant√≠as en empresas internacionales: c√≥mo no llenar la entrevista y obtener la codiciada oferta</a></li>
<li><a href="../472650/index.html">Miedo, dolor y odio al soporte t√©cnico.</a></li>
<li><a href="../472658/index.html">Casi todo sobre el futuro HolyJS 2019 Mosc√∫</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>