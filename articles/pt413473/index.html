<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üèçÔ∏è ü•ü üëÇüèΩ Desenvolvimento de um interruptor Z-Wave de toque na bateria com bot√µes luminosos üë®‚Äçüè´ üçé üî™</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="No segundo ano, desenvolvi meu switch Z-Wave exclusivo com bot√µes de toque que me satisfar√£o em termos de funcionalidade, design e custo de fabrica√ß√£o...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Desenvolvimento de um interruptor Z-Wave de toque na bateria com bot√µes luminosos</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/413473/"><img src="https://habrastorage.org/webt/8u/uo/9w/8uuo9wx7pyclsobv4bqkxrrokgw.jpeg"><br><br>  No segundo ano, desenvolvi meu switch Z-Wave exclusivo com bot√µes de toque que me satisfar√£o em termos de funcionalidade, design e custo de fabrica√ß√£o. <br><br>  Desde o in√≠cio, o objetivo era tornar a chave de 4 bot√µes de uma bateria com um tamanho de 80x80 mm o mais fina poss√≠vel, os bot√µes de toque devem ser grandes e acender quando tocados, n√£o apenas um pequeno c√≠rculo como todos os outros.  O resultado √© um switch fino e elegante que pode controlar qualquer dispositivo dom√©stico inteligente. <br><br>  Durante o desenvolvimento, resolvi muitas tarefas em circuitos, design de caixas e sele√ß√£o de materiais.  Particularmente interessante √© a cria√ß√£o do pr√≥prio bot√£o de toque, que brilha por inteiro, mas primeiro as primeiras coisas. <br><br><ul><li>  Funcional </li><li>  Design do caso </li><li>  Design de PCB </li><li>  Estudos do difusor de luz </li><li>  Sele√ß√£o de materiais difusores </li><li>  Use </li></ul><br>  V√≠deo da opera√ß√£o do interruptor de toque no final. <br><a name="habracut"></a><br><h3>  Funcional </h3><br>  Os seguintes recursos do disjuntor foram necess√°rios: <br><br><ul><li>  Ligar / desligar a luz </li><li>  Ajustar o brilho da ilumina√ß√£o </li></ul><br>  4 bot√µes controlam 2 grupos de ilumina√ß√£o.  Os bot√µes superiores, enquanto pressionam, aumentam gradualmente o brilho, com um breve toque na luz.  Os bot√µes inferiores, enquanto pressionam, diminuem gradualmente o brilho, pressionando rapidamente a luz. <br><br>  <b>Todo</b> <br><br>  <i>Fa√ßa com que cada bot√£o funcione no modo de comuta√ß√£o, pressione - on, pressione - off.</i>  <i>Isso permitir√° que voc√™ controle 4 grupos de ilumina√ß√£o.</i> <br><br><h3>  Design do caso </h3><br>  Gostei da ideia com 4 bot√µes de toque grandes da Basalte e decidi desenvolv√™-la na minha dire√ß√£o. <br><br><img src="https://habrastorage.org/webt/46/to/au/46toau4idmg_1rgrvhjhelnwxda.jpeg"><br>  <i>Fig.</i>  <i>1 - chave KNX Basalte</i> <br><br>  Queria que o bot√£o fosse iluminado como um todo quando tocado, em vez de um LED separado.  Portanto, o gabinete √© um quadro estreito com recortes para 4 bot√µes de toque.  Bloqueios para prender a tampa traseira e recessos para a instala√ß√£o de √≠m√£s s√£o pensados.  A placa de fixa√ß√£o √© colada √† parede em uma fita adesiva dupla face e o pr√≥prio interruptor j√° est√° preso a ela usando √≠m√£s.  √â conveniente usar o interruptor como um controle remoto port√°til e √© conveniente carregar a bateria. <br><br><img src="https://habrastorage.org/webt/gk/tp/hu/gktphux0nepum4fhx7qhpm2ln2y.jpeg"><br>  <i>Fig.</i>  <i>2 - Caixa do interruptor de toque</i> <br><br>  Todas as partes do corpo s√£o projetadas no Blender e impressas em uma impressora 3D com pl√°stico ABS branco. <br><br><img src="https://habrastorage.org/webt/wd/k0/39/wdk039ulydrgq1ajgrklzvajixw.png"><br>  <i>Fig.</i>  <i>3 - Desenvolvimento da carca√ßa do interruptor de toque no Blender</i> <br><br><h3>  Design de PCB </h3><br>  A placa de circuito foi projetada pela Proteus.  Esta √© a segunda vers√£o, usa um chip sensor TTP224 para 4 canais.  A primeira vers√£o usou 4 pe√ßas.  TTP223 de canal √∫nico, n√£o h√° diferen√ßa na opera√ß√£o, mas ao usar o TTP224, h√° menos componentes de solda. <br><br><img src="https://habrastorage.org/webt/lv/g7/f5/lvg7f5dfflj7omp_jviy39ro-pc.png"><br>  <i>Fig.</i>  <i>4 - Projeto da placa de circuito do interruptor de toque no Proteus</i> <br><br>  Os principais componentes do quadro s√£o: <br><br><ol><li>  Chip de r√°dio Z-Wave </li><li>  Bateria Robiton 800mAh </li><li>  3.3V Regulador de tens√£o Step-Up / Step-Down S7V8F3 </li><li>  Carga da bateria TP4056 </li><li>  Diagrama para alternar energia da bateria para USB </li><li>  Bot√£o de calibra√ß√£o </li><li>  IC do bot√£o de toque TTP224 </li></ol><br>  O chip Z-Wave opera na faixa de 2,7V a 3,6V, a bateria produz at√© 4,7V, ent√£o usei o conversor de impulso Pololu S7V8F3 3.3V.  Para carregar a bateria, usei um chip TP4056 barato e conhecido, configurei a corrente de carga para metade da capacidade da bateria de 400mA.  Quando o carregamento est√° conectado, a energia do dispositivo muda para USB e a bateria est√° carregando silenciosamente, o esquema de comuta√ß√£o de energia √© implementado em um √∫nico transistor e diodo.  O bot√£o, quando pressionado, redefine a energia do regulador e o circuito inteiro √© reiniciado, isso √© necess√°rio para calibrar o TTP224.  Na parte frontal da placa, existem 4 bot√µes de toque de 40 x 40 mm e 4 LEDs.  Produ√ß√£o encomendada pela Seeedstudio, muito satisfeita com a qualidade e o pre√ßo. <br><br><img src="https://habrastorage.org/webt/at/_f/nd/at_fndbfqwwo250irzbq5wcmmhs.jpeg"><br>  <i>Fig.</i>  <i>5 - Placa do interruptor de toque</i> <br><br>  O componente mais importante no comutador de toque √© o controlador do bot√£o de toque.  Eu testei 3 controladores e cada um acabou por ter pr√≥s e contras.  Resultados do teste para 3 controladores de bot√£o de toque: <br><br>  <b>TTP224</b> <br><br>  <b>Pr√≥s:</b> barato, na placa de circuito impresso de um lado pode haver placas de sensor, na parte traseira de outros componentes, mas a sensibilidade √© bastante reduzida.  Configura√ß√£o do sinal de sa√≠da: alta / baixa, configura√ß√£o do modo de bot√£o: ligar / desligar.  4 canais. <br><br>  <b>Contras:</b> Se houver faixas na parte de tr√°s do touch pad, ele n√£o funcionar√° bem em Plexiglas mais de 3 mm e, pior ainda, se o filme for colado ao vidro, ele n√£o responder√° a um leve toque, apenas pressionando com a ponta do dedo inteiro, mesmo com a sensibilidade m√°xima definida (Cs = 1pF, 0-50pF, quanto menor, mais sens√≠vel). <br><br><img src="https://habrastorage.org/webt/tf/st/xe/tfstxe1azi2w6cir_s-wsliguzy.jpeg"><br>  <i>Fig.</i>  <i>6 - TTP224 na placa acabada</i> <br><br>  <b>AT42QT1011</b> <br><br>  <b>Pr√≥s:</b> reage a um pequeno toque atrav√©s de plexiglas de 3 mm (ou mais), se voc√™ ajustar a sensibilidade em um n√≠vel m√©dio (Cs = 22nF, faixa 2-50nF, quanto mais, mais sens√≠vel).  Ajusta-se automaticamente √† espessura do vidro. <br><br>  <b>Contras:</b> sob o touchpad, n√£o deve haver faixas, energia ou solo, caso contr√°rio a sensibilidade diminui.  A sa√≠da √© apenas um n√≠vel alto.  Apenas 1 canal. <br><br><img src="https://habrastorage.org/webt/t6/s9/is/t6s9is4fxztieihcctdlgvatnyw.jpeg"><br>  <i>Fig.</i>  <i>7 - Placa de teste AT42QT1011</i> <br><br>  <b>MTCH105</b> <br><br>  <b>Pr√≥s:</b> reage a um leve toque atrav√©s de plexiglas de 3 mm (ou mais).  Anti-jamming com a ajuda do solo ao redor e sob os sensores, ajusta-se automaticamente √† espessura do vidro.  5 canais. <br><br>  <b>Contras:</b> Ele reage por muito tempo pressionando e por muito tempo percebe que o dedo foi solto, cerca de 0,5 segundos.  Se voc√™ segurar o dedo na plataforma do sensor, depois de 9 segundos o LED se apaga, a calibra√ß√£o ocorre.  √â necess√°rio que o touch pad esteja coberto de terra por todos os lados, inclusive sob o pad, caso contr√°rio, ele funciona em qualquer ponto de contato da PCB. <br><br><img src="https://habrastorage.org/webt/ch/oj/l1/chojl19iuyjiyy0xa8fdq3ze7ni.jpeg"><br>  <i>Fig.</i>  <i>8 - MTCH105 na t√°bua de p√£o</i> <br><br>  Eu escolhi o TTP224 (4 canais), porque em um PCB, por um lado, todos os componentes podem ser colocados e, por outro lado, em sensores.  Ele sacrificou a sensibilidade, depois de 3 mm o plexiglass funciona se voc√™ tocar o todo com a ponta do dedo, embora isso possa ser interpretado como prote√ß√£o contra contato acidental :).  Se n√£o houver faixas sob a √°rea do sensor, ele reage atrav√©s de plexiglas de 4 mm com o menor toque. <br><br>  <b>Todo</b> <br><br>  <i>Para fabricar um switch sens√≠vel ao toque com duas PCBs, a primeira para touch pads e a segunda para todos os componentes.</i>  <i>Adicione motor de vibra√ß√£o e refor√ßo.</i>  <i>Implemente a fun√ß√£o de baixa luz de fundo quando o sensor de movimento embutido √© acionado.</i> <br><br><h3>  Estudos do difusor de luz </h3><br>  A tarefa era iluminar uniformemente uma plataforma de 40x40mm, que toca o dedo.  Devido a restri√ß√µes de tamanho da caixa, foi poss√≠vel empurrar apenas um LED para cada site. <br><br>  Estudei o dispositivo de v√°rios interruptores de toque: Livolo, Vitrum, bot√£o de toque HTTM.  Cada um usou sua pr√≥pria abordagem para espalhar uniformemente a luz. <br><br>  <b>Vitrum</b> <br><br>  Interruptor Z-Wave italiano com vidro decorativo caro.  O refletor-difusor √© implementado da seguinte maneira: em um plexigl√°s transparente, um aro √© pintado com tinta refletiva, iluminado pela lateral com um √∫nico LED.  No lado do LED, menos tinta √© aplicada, obtendo um brilho uniforme em todo o aro.  Um vidro decorativo √© instalado na parte superior. <br><br><img src="https://habrastorage.org/webt/_b/og/i8/_bogi8lb0y03la15h3pgcneyhcy.jpeg"><br>  <i>Fig.</i>  <i>9 - Borda refletora em plexiglass</i> <br><br>  <b>Livolo</b> <br><br>  Or√ßamento interruptor de toque chin√™s.  Existem 2 LEDs na placa: vermelho e azul, os LEDs brilham dentro de um pl√°stico transl√∫cido nublado, devido a freq√ºentes refra√ß√µes de luz no interior, √© obtido um brilho uniforme de toda a superf√≠cie e a tinta reflexiva √© aplicada ao textolito. <br><br><img src="https://habrastorage.org/webt/z-/zx/lq/z-zxlqsxt9w_pgqirlbbdz7p0rs.jpeg"><br>  <i>Fig.</i>  <i>10 - Toque em parte do interruptor Livolo</i> <br><br>  <b>HTTM - Modelo HelTec Touch</b> <br><br>  M√≥dulo de toque pronto com chip Noname.  O refletor-difusor √© composto por 3 partes: textolite com uma almofada de estanho, acr√≠lico para ilumina√ß√£o final com muitos micro-orif√≠cios, um filme branco nublado. <br><br><img src="https://habrastorage.org/webt/wl/es/8e/wles8ecf6zki98-ijs2qmcsnjay.jpeg"><br>  <i>Fig.</i>  <i>10 - M√≥dulo de toque HTTM desmontado</i> <br><br><h3>  Sele√ß√£o de materiais difusores </h3><br>  <b>Difusor em plexigl√°s fosco</b> <br><br>  O usual plexigl√°s transparente de 3 mm foi tratado com uma lixa fina de ambos os lados para torn√°-lo opaco.  Esse plexigl√°s espalha uniformemente a luz por toda a superf√≠cie.  A espessura do material permite trabalhar confortavelmente com qualquer chip sensor.  Mas pequenos arranh√µes s√£o vis√≠veis na superf√≠cie, o que afeta a apar√™ncia est√©tica. <br><br><img src="https://habrastorage.org/webt/oy/1r/_s/oy1r_sgdofrsgu0ez0apiut8kde.jpeg"><br>  <i>Fig.</i>  <i>11 - Plexiglass fosco</i> <br><br>  <b>Difusor de plexigl√°s para ilumina√ß√£o frontal (LGP) e plexigl√°s de leite</b> <br>  Utilizou 2 plexiglas diferentes de 2 mm de espessura, um sandu√≠che de dois elementos que acabou por ser de 4 mm.  O plexigl√°s inferior para ilumina√ß√£o final, gra√ßas aos pontos brancos aplicados, espalha uniformemente a luz por toda a superf√≠cie.  O plexigl√°s superior do leite proporciona um brilho suave e uma apar√™ncia bonita, enquanto o brilho √© visivelmente mais baixo e o peso do interruptor aumenta. <br><br><img src="https://habrastorage.org/webt/4i/tk/5r/4itk5r5llm-ib540ozewsylnrye.jpeg"><br>  <i>Fig.</i>  <i>12 - Plexiglass para ilumina√ß√£o final e plexiglass opala</i> <br><br>  <b>Painel Ledbox Lightbox</b> <br>  A empresa russa Ledison forneceu um painel de caixa de luz composto por 3 componentes para o teste: um substrato refletivo, um Plexiglas especial de 3 mm de dispers√£o da luz (parece transparente, mas uma estrutura granulada √© vis√≠vel no interior), uma pel√≠cula protetora transparente.  Substitu√≠ o filme superior por um Oracal 8500 fosco e obtive uma boa dispers√£o.  Mas, ao trabalhar com o interruptor, o filme n√£o parece s√≥lido, pode ser arranhado e √© dif√≠cil colar sem bolhas. <br><br><img src="https://habrastorage.org/webt/la/zc/_s/lazc_slqs6olk8jbxkat3xmqooi.jpeg"><br>  <i>Fig.</i>  <i>13 - Sandu√≠che de caixa de luz Ledison</i> <br><br>  Depois de todos os testes no switch, usei um substrato refletivo da Ledison, e seu plexiglass ficou fosco.  No momento, esta √© a melhor op√ß√£o para mim, e se dispersa uniformemente, e o brilho n√£o √© reduzido e a espessura √© adequada. <br><br><img src="https://habrastorage.org/webt/kx/vx/th/kxvxthptvnmgjvch7jg-vaaht30.jpeg"><br>  <i>Fig.</i>  <i>14 - Caixa, placa e difusor</i> <br><br><h3>  Use </h3><br>  Eu fiz as primeiras vers√µes de teste dos interruptores h√° 2 anos e j√° tenho experi√™ncia em us√°-los, um √© instalado perto do banheiro a uma altura de 120 cm e √© conveniente para crian√ßas, o segundo fica perto da cama e controla uma l√¢mpada noturna, lustre e luz de fundo LED.  Porque  todos os bot√µes s√£o separados por uma mira; s√£o f√°ceis de encontrar no escuro e pressione o desejado.  O feedback da luz indica exatamente qual bot√£o est√° pressionado.  Em compara√ß√£o com os bot√µes de press√£o, n√£o encontrei nenhum ponto negativo. <br><br><img src="https://habrastorage.org/webt/_7/dy/g9/_7dyg9axf4nwgvs8jv-h5nmzlrs.jpeg"><br>  <i>Fig.</i>  <i>15 - Interruptor de toque da bateria em a√ß√£o</i> <br><br>  Percebi um efeito colateral agrad√°vel, o interruptor perto da cama pode ser usado para iluminar os arm√°rios, se voc√™ pressionar os bot√µes inferiores. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/oHex7dVJEbo" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h3>  PS </h3><br>  No momento, o chip Z-Wave usa firmware do chaveiro 4X x Z-Wave.Me Key Fob, √© conveniente que seja pronto e funcione, √© inconveniente que nem todas as fun√ß√µes estejam l√° que voc√™ deseja.  A √∫nica quest√£o n√£o resolvida foi a ilumina√ß√£o dos cantos no centro, √© necess√°rio cobri-lo com filme de papel alum√≠nio, mas por enquanto acho que √© muito melhor esculpir o papel no estojo interno ou em plexiglass. <br><br>  Al√©m disso, planeja mudar para um m√≥dulo Z-Uno livremente program√°vel para a implementa√ß√£o de toda a lista de desejos de software. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt413473/">https://habr.com/ru/post/pt413473/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt413463/index.html">API REST do Magento 2 usando um m√≥dulo simples como exemplo</a></li>
<li><a href="../pt413465/index.html">AMD anuncia Threadripper 2 de 32 n√∫cleos</a></li>
<li><a href="../pt413467/index.html">Backup de dados r√°pido e confi√°vel na nuvem</a></li>
<li><a href="../pt413469/index.html">Um teste de mem√≥ria matando laptops √© quase uma hist√≥ria de detetive</a></li>
<li><a href="../pt413471/index.html">Retrospectiva de sexta-feira Mini Toy Tomy</a></li>
<li><a href="../pt413479/index.html">Escrevemos nosso protocolo sobre o UDP</a></li>
<li><a href="../pt413481/index.html">Exportar √°rvore de teste do JMeter para texto</a></li>
<li><a href="../pt413485/index.html">Lan√ßamento do GitLab 10.8: espelhamento de push de c√≥digo aberto e implanta√ß√£o incremental</a></li>
<li><a href="../pt413487/index.html">O que um desenvolvedor deve esperar no campo das finan√ßas: condi√ß√µes de trabalho, projetos e habilidades necess√°rias</a></li>
<li><a href="../pt413489/index.html">Como escolher um messenger verdadeiramente seguro e o que a blockchain tem a ver com isso</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>