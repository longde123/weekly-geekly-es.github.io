<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§∏üèº üëáüèΩ ü§πüèΩ Wie ich Zabbix beigebracht habe, meinen Knoten im Auge zu behalten und Probleme zu melden ü§µüèæ ‚úåüèª üåæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo Habr! 

 Ich arbeite derzeit mit einem Team meiner Kollegen an einem Blockchain Messenger-Projekt. Wen k√ºmmert es - sehen Sie die Links im Profi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Wie ich Zabbix beigebracht habe, meinen Knoten im Auge zu behalten und Probleme zu melden</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/440216/">  Hallo Habr! <br><br>  Ich arbeite derzeit mit einem Team meiner Kollegen an einem Blockchain Messenger-Projekt.  Wen k√ºmmert es - sehen Sie die Links im Profil oder fragen Sie in den Kommentaren. <br><br>  Die Blockchain-Entwicklung ist ein neues und unbekanntes Gebiet, daher m√ºssen Sie manchmal sehr ungew√∂hnliche Tools verwenden.  Wo ist das Mikroskop und die N√§gel!  Deshalb habe ich mich entschlossen, diesen Blog zu behalten, um verschiedene interessante F√§lle aus der Praxis zu erz√§hlen.  In dem heutigen Beitrag geht es darum, wie ich sofortige Benachrichtigungen √ºber den Status meines Knotens einrichte, damit ich ihn in diesem Fall schnell wieder zum Leben erwecken kann. <br><br><img src="https://habrastorage.org/webt/qq/tv/7h/qqtv7hpy3x3jiswfyat9zqeg8dc.jpeg"><br><br><h2>  Der Plan, dem ich folgte </h2><br>  Die Aufgabe, die ich mir selbst gestellt habe, war folgende: Jedes Mal, wenn ein Knoten abst√ºrzt oder nicht mehr funktioniert, sollte ich sofort benachrichtigt werden.  Aber wir leben in einem fortschrittlichen Zeitalter und sind es gewohnt, alle wichtigen Informationen sofort zu erhalten, oder? <br><br>  Ich habe beschlossen, dass ich Zabbix an Slack befestigen werde, um diese Aufgabe zu erf√ºllen (wir haben ein funktionierendes Projektwerkzeug).  Dementsprechend √ºberwacht Zabbix den Knoten und sendet mir Fehlermeldungen in Slacks PM. <br><br><h2>  Implementierung: Schritt f√ºr Schritt </h2><br><a name="habracut"></a><h3>  Schritt 1: Zabbix </h3><br>  Nat√ºrlich verf√ºgt Zabbix nicht √ºber vorkonfigurierte Standard√ºberwachungstools f√ºr unseren Knoten.  Daher bestand der erste Wunsch darin, die Verf√ºgbarkeit des Knotenports mithilfe des Schl√ºssels <code>net.tcp.listen[port].</code> zu bestimmen <code>net.tcp.listen[port].</code> <br><br>  Aber es gibt ein "aber": Es kommt vor, dass der Knoten aktiv ist, er √ºberwacht den Port, aber er funktioniert nicht richtig.  Und hier wurde ich mit der Tatsache konfrontiert, dass Sie das Hauptzeichen f√ºr die Leistung eines Knotens bestimmen m√ºssen. <br><br>  Was soll Noda tun?  Richtig, wachsen.  Hier wird Wachstum das Hauptzeichen sein.  Deshalb habe ich mich f√ºr den Schl√ºssel <code>system.run[command, mode]</code> . <br><br>  Zusammen mit <code>curl -s http://127.0.0.1:36666/api/blocks/getHeight</code> . <br><br>  Als Ergebnis haben wir eine Zeichenfolge im JSON-Format des Formulars erhalten <br><br><pre> <code class="java hljs">{<span class="hljs-string"><span class="hljs-string">"success"</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>,<span class="hljs-string"><span class="hljs-string">"nodeTimestamp"</span></span>:XXXXXXX,<span class="hljs-string"><span class="hljs-string">"height"</span></span>:XXXXXXX}</code> </pre> <br>  Das jq-Paket (https://stedolan.github.io/jq/) half bei der L√∂sung des JSON-Parsing-Problems.  Eine einfache Ergebnis√ºbertragung √ºber Pipe <code>curl http://127.0.0.1:36666/api/blocks/getHeight | jq .height</code> {6666 / api / blocks / getHeight <code>curl http://127.0.0.1:36666/api/blocks/getHeight | jq .height</code>  <code>curl http://127.0.0.1:36666/api/blocks/getHeight | jq .height</code> und anstelle der lang erwarteten H√∂he erhielten wir eine Antwort mit Informationen zum Befehl <code>curl</code> . <br><br><img src="https://habrastorage.org/webt/8a/a5/aw/8aa5aw1zpzwkd8sfagshwhxe8di.png"><br><br>  Die redundanten Informationen mussten entfernt werden, und dann kam ein Assistent - der <code>-s</code> , auch bekannt als <code>-silent</code> .  Verwenden Sie daher den Zabbix-Schl√ºssel <code>system.run[curl -s http://127.0.0.1:36666/api/blocks/getHeight | jq .height]</code>  <code>system.run[curl -s http://127.0.0.1:36666/api/blocks/getHeight | jq .height]</code> wir die <code>system.run[curl -s http://127.0.0.1:36666/api/blocks/getHeight | jq .height]</code> der gew√ºnschten und f√ºr die √úberwachung bequemen Ansicht XXXXXXXXX. <br><br><img src="https://habrastorage.org/webt/ug/0u/vh/ug0uvhe-dlzx1xbsndurogpbkyq.png"><br><br>  Ein Ausl√∂ser war auch erforderlich, um die geplante Warnung zu konfigurieren.  Der Plan war folgender: Vergleichen Sie den letzten und den vorherigen Wert, damit der Ausl√∂ser funktioniert, wenn das Wachstum kleiner als eins ist. <br><br> <code>{ADAMANT Node Monitoring:system.run[curl -s http://127.0.0.1:36666/api/blocks/getHeight | jq .height].change()}&lt;1</code> <br> <br><h3>  Schritt 2. Zabbix to Slack </h3><br><img src="https://habrastorage.org/webt/ac/bm/7-/acbm7-ojg-sbdpdyw3gt8k9gk-8.jpeg"><br><br>  Die n√§chste Aufgabe besteht darin, den Ausl√∂ser in Slack zu benachrichtigen.  Als Grundlage habe ich das Material <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://github.com/ericoc/zabbix-slack-alertscript genommen</a> . <br><br>  Die Anweisungen sind klar, aber die Verwendung von Emoticons zur Unterscheidung zwischen Schweregrad ist nicht ernst.  Die Hervorhebung von Farben ist viel interessanter.  Nach der Verarbeitung des Skripts bleibt Folgendes: <br><br><pre> <code class="java hljs"> url=<span class="hljs-string"><span class="hljs-string">'********************************'</span></span> username=<span class="hljs-string"><span class="hljs-string">'Server'</span></span> to=<span class="hljs-string"><span class="hljs-string">"$1"</span></span> subject=<span class="hljs-string"><span class="hljs-string">"$2"</span></span> recoversub=<span class="hljs-string"><span class="hljs-string">'^RECOVER(Y|ED)?$'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [[ <span class="hljs-string"><span class="hljs-string">"$subject"</span></span> == <span class="hljs-string"><span class="hljs-string">'Warning'</span></span> ]]; then color=<span class="hljs-string"><span class="hljs-string">'#EBFF00'</span></span> elif [ <span class="hljs-string"><span class="hljs-string">"$subject"</span></span> == <span class="hljs-string"><span class="hljs-string">'Not classified'</span></span> ]; then color=<span class="hljs-string"><span class="hljs-string">'#D8E3FF'</span></span> elif [ <span class="hljs-string"><span class="hljs-string">"$subject"</span></span> == <span class="hljs-string"><span class="hljs-string">'Information'</span></span> ]; then color=<span class="hljs-string"><span class="hljs-string">'#0049FF'</span></span> elif [ <span class="hljs-string"><span class="hljs-string">"$subject"</span></span> == <span class="hljs-string"><span class="hljs-string">'Average'</span></span> ]; then color=<span class="hljs-string"><span class="hljs-string">'#FFC200'</span></span> elif [ <span class="hljs-string"><span class="hljs-string">"$subject"</span></span> == <span class="hljs-string"><span class="hljs-string">'High'</span></span> ]; then color=<span class="hljs-string"><span class="hljs-string">'#FF5500'</span></span> elif [ <span class="hljs-string"><span class="hljs-string">"$subject"</span></span> == <span class="hljs-string"><span class="hljs-string">'Disaster'</span></span> ]; then color=<span class="hljs-string"><span class="hljs-string">'#FF0000'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> color=<span class="hljs-string"><span class="hljs-string">'#00FF06'</span></span> fi message=<span class="hljs-string"><span class="hljs-string">"${subject} \n $3"</span></span> payload=<span class="hljs-string"><span class="hljs-string">"payload={\"attachments\": [{\"color\": \"${color}\", \"text\": \"${message}\"}]}"</span></span> curl -m <span class="hljs-number"><span class="hljs-number">5</span></span> --data-urlencode <span class="hljs-string"><span class="hljs-string">"${payload}"</span></span> $url</code> </pre> <br><h2>  Schlussfolgerungen </h2><br>  Aus moralischen Gr√ºnden ein paar Worte, warum eine bequeme √úberwachung so wichtig ist.  Je schneller Sie die Situation kennenlernen, desto schneller werden Sie sie korrigieren und desto weniger ausgepr√§gt sind die Folgen.  Wie sie sagen, wird die erh√∂hte Zeit nicht als gesunken angesehen.  In Slack gibt es unter anderem Gruppenchats, damit das Team eine Verbindung herstellen kann, um das Problem zu beheben und Aktionen zu koordinieren.  Unser Projekt hat √ºbrigens Open Source Code und wir respektieren andere Open Source Projekte sehr.  Mein Experiment hat einmal mehr gezeigt, dass Open Source gut ist. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de440216/">https://habr.com/ru/post/de440216/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de440204/index.html">DIY Hobby CNC Fr√§ser. Geisteswissenschaften f√ºr die Geisteswissenschaften</a></li>
<li><a href="../de440206/index.html">Gl√ºhbirnen "das ganze Jahr √ºber"</a></li>
<li><a href="../de440208/index.html">Erkundung der Bandbreitenbeschr√§nkungen von Kafka f√ºr Dropbox</a></li>
<li><a href="../de440210/index.html">Maschinensyn√§sthetischer Ansatz zur Erkennung von Netzwerk-DDoS-Angriffen. Teil 1</a></li>
<li><a href="../de440214/index.html">Spring und JDK 8: Verwenden Sie immer noch @Param und Name / Wert in Spring MVC-Anmerkungen? Dann ist der Artikel f√ºr Sie</a></li>
<li><a href="../de440218/index.html">DoS-Angriff, der nicht abgeschlossen werden kann: Die Beschaffung hat eine eigene Atmosph√§re</a></li>
<li><a href="../de440220/index.html">Das Impostor-Syndrom ist nicht nur sch√§dlich, sondern auch vorteilhaft</a></li>
<li><a href="../de440222/index.html">Unterwasser-Ultraschall-Entfernungsmesser-Modul</a></li>
<li><a href="../de440226/index.html">AudioKit und Audiosynthese unter iOS / OSX</a></li>
<li><a href="../de440230/index.html">Die Staatsduma hat die Diskussion √ºber die Gesetzesvorlage √ºber Nachrichtenaggregatoren verschoben</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>