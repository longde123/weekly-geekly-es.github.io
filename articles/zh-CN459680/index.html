<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👜 ✏️ ⚕️ 遵循Highload ++ Siberia 2019-8个Oracle任务 🎦 👨🏽‍🏭 🧥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="你好 

 6月24日至25日，Highload ++ Siberia 2019会议在新西伯利亚举行，我们的专家们还参加了报告 “ Oracle容器基础（CDB / PDB）及其在软件开发中的实际使用”，我们将在稍后发布文本版本。 太酷了，谢谢olegbunin的组织，以及所有来的人。 


 在本...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>遵循Highload ++ Siberia 2019-8个Oracle任务</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/sportmaster_lab/blog/459680/"> 你好 <br><br>  6月24日至25日，Highload ++ Siberia 2019会议在新西伯利亚举行，我们的专家们还<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">参加了报告</a> “ Oracle容器基础（CDB / PDB）及其在软件开发中的实际使用”，我们将在稍后发布文本版本。 太酷了，谢谢<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link">olegbunin</a>的组织，以及所有来的人。 <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/-7/k4/u1/-7k4u1btcjxquu515qeoyxnxigu.jpeg" width="350"></div><br> 在本文中，我们想与您分享我们展位上的任务，以便您可以测试您在Oracle中的知识。 在削减-8个任务下，回答选项和解释。 <br><a name="habracut"></a><br><h3> 通过以下脚本，我们将看到的序列的最大值是多少？ </h3><br><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sequence</span></span> s <span class="hljs-keyword"><span class="hljs-keyword">start</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> s.currval, s.nextval, s.currval, s.nextval, s.currval <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> dual <span class="hljs-keyword"><span class="hljs-keyword">connect</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> <span class="hljs-keyword"><span class="hljs-keyword">level</span></span> &lt;= <span class="hljs-number"><span class="hljs-number">5</span></span>;</code> </pre> <br><ul><li>  1个 </li><li>  5 </li><li>  10 </li><li>  25 </li><li> 不，会有错误 </li></ul><br><div class="spoiler">  <b class="spoiler_title">答案</b> <div class="spoiler_text"> 根据Oracle文档（引自8.1.6）： <br> 在单个SQL语句中，Oracle每行仅递增一次序列。 如果一个语句对一个序列包含多个对NEXTVAL的引用，则Oracle将序列递增一次，并为所有出现的NEXTVAL返回相同的值。 如果一条语句同时包含对CURRVAL和NEXTVAL的引用，则Oracle会递增该序列，并为CURRVAL和NEXTVAL返回相同的值，而不管它们在语句中的顺序如何。 <br><br> 因此， <b>最大值将对应于行数，即5</b> 。 <br></div></div><br><h3> 由于以下脚本，表中将有多少行？ </h3><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> t(i <span class="hljs-built_in"><span class="hljs-built_in">integer</span></span> <span class="hljs-keyword"><span class="hljs-keyword">check</span></span> (i &lt; <span class="hljs-number"><span class="hljs-number">5</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">procedure</span></span> p(p_from <span class="hljs-built_in"><span class="hljs-built_in">integer</span></span>, p_to <span class="hljs-built_in"><span class="hljs-built_in">integer</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> p_from .. p_to <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span> <span class="hljs-keyword"><span class="hljs-keyword">insert</span></span> <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> t <span class="hljs-keyword"><span class="hljs-keyword">values</span></span> (i); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; / exec p(1, 3); exec p(4, 6); exec p(7, 9);</code> </pre> <br><ul><li>  0 </li><li>  3 </li><li>  4 </li><li>  5 </li><li>  6 </li><li>  9 </li></ul><br><div class="spoiler">  <b class="spoiler_title">答案</b> <div class="spoiler_text"> 根据Oracle文档（引自11.2）： <br><br> 在执行任何SQL语句之前，Oracle会标记一个隐式保存点（您不可用）。 然后，如果该语句失败，Oracle将自动回滚它，并将适用的错误代码返回到SQLCA中的SQLCODE。 例如，如果INSERT语句通过尝试在唯一索引中插入重复值而导致错误，则该语句将回滚。 <br><br> 来自客户端的呼叫也被视为单个语句并进行处理。 因此，对HP的第一次调用通过插入三个记录成功完成。 对HP的第二次调用以错误结束，并回滚了我设法插入的第四条记录； 第三次调用失败， <b>并且表中出现三个条目</b> 。 <br></div></div><br><h3> 由于以下脚本，表中将有多少行？ </h3><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> t(i <span class="hljs-built_in"><span class="hljs-built_in">integer</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">constraint</span></span> i_ch <span class="hljs-keyword"><span class="hljs-keyword">check</span></span> (i &lt; <span class="hljs-number"><span class="hljs-number">3</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">insert</span></span> <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> t <span class="hljs-keyword"><span class="hljs-keyword">values</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">insert</span></span> <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> t <span class="hljs-keyword"><span class="hljs-keyword">values</span></span> (<span class="hljs-literal"><span class="hljs-literal">null</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">insert</span></span> <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> t <span class="hljs-keyword"><span class="hljs-keyword">values</span></span> (<span class="hljs-number"><span class="hljs-number">2</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">insert</span></span> <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> t <span class="hljs-keyword"><span class="hljs-keyword">values</span></span> (<span class="hljs-literal"><span class="hljs-literal">null</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">insert</span></span> <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> t <span class="hljs-keyword"><span class="hljs-keyword">values</span></span> (<span class="hljs-number"><span class="hljs-number">3</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">insert</span></span> <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> t <span class="hljs-keyword"><span class="hljs-keyword">values</span></span> (<span class="hljs-literal"><span class="hljs-literal">null</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">insert</span></span> <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> t <span class="hljs-keyword"><span class="hljs-keyword">values</span></span> (<span class="hljs-number"><span class="hljs-number">4</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">insert</span></span> <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> t <span class="hljs-keyword"><span class="hljs-keyword">values</span></span> (<span class="hljs-literal"><span class="hljs-literal">null</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">insert</span></span> <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> t <span class="hljs-keyword"><span class="hljs-keyword">values</span></span> (<span class="hljs-number"><span class="hljs-number">5</span></span>); exception when others then dbms_output.put_line('Oops!'); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; /</code> </pre> <br><ul><li>  1个 </li><li>  2 </li><li>  3 </li><li>  4 </li><li>  5 </li><li>  6 </li><li>  7 </li></ul><br><div class="spoiler">  <b class="spoiler_title">答案</b> <div class="spoiler_text"> 根据Oracle文档（引自11.2）： <br><br> 检查约束使您可以指定表中每一行必须满足的条件。 为了满足该约束，表中的每一行都必须使条件为TRUE或未知（由于为空）。 当Oracle评估特定行的检查约束条件时，条件中的任何列名称均指该行中的列值。 <br><br> 因此，空值将通过测试，并且匿名块将成功执行，直到尝试插入值3。此后，错误处理块将抛出异常，不会发生回滚，并且<b>该表将再次包含四行</b> ，其值分别为1，null，2和null。 <br></div></div><br><h3> 哪些值对将在块中占据相同的空间量？ </h3><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> t ( a <span class="hljs-built_in"><span class="hljs-built_in">char</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-built_in"><span class="hljs-built_in">char</span></span>), b <span class="hljs-built_in"><span class="hljs-built_in">char</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-built_in"><span class="hljs-built_in">char</span></span>), c <span class="hljs-built_in"><span class="hljs-built_in">char</span></span>(<span class="hljs-number"><span class="hljs-number">100</span></span> <span class="hljs-built_in"><span class="hljs-built_in">char</span></span>), i <span class="hljs-built_in"><span class="hljs-built_in">number</span></span>(<span class="hljs-number"><span class="hljs-number">4</span></span>), j <span class="hljs-built_in"><span class="hljs-built_in">number</span></span>(<span class="hljs-number"><span class="hljs-number">14</span></span>), k <span class="hljs-built_in"><span class="hljs-built_in">number</span></span>(<span class="hljs-number"><span class="hljs-number">24</span></span>), x varchar2(<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-built_in"><span class="hljs-built_in">char</span></span>), y varchar2(<span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-built_in"><span class="hljs-built_in">char</span></span>), z varchar2(<span class="hljs-number"><span class="hljs-number">100</span></span> <span class="hljs-built_in"><span class="hljs-built_in">char</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">insert</span></span> <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> t (a, b, i, j, x, y) <span class="hljs-keyword"><span class="hljs-keyword">values</span></span> (<span class="hljs-string"><span class="hljs-string">'Y'</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>);</code> </pre><br><ul><li>  A和X </li><li>  B和Y </li><li>  C和K </li><li>  C和Z </li><li>  K和Z </li><li> 我和J </li><li>  J和X </li><li> 全部列出 </li></ul><br><div class="spoiler">  <b class="spoiler_title">答案</b> <div class="spoiler_text"> 以下摘录自文档（12.1.0.2），用于在Oracle中存储各种数据类型。 <br><br>  <b>字符数据类型</b> <br>  CHAR数据类型在数据库字符集中指定了固定长度的字符串。 您在创建数据库时指定数据库字符集。  Oracle确保在选定的长度语义中，存储在CHAR列中的所有值的长度均由大小指定。 如果您插入的值短于列长度，则Oracle将值空白填充到列长度。 <br><br>  <b>VARCHAR2数据类型</b> <br>  VARCHAR2数据类型在数据库字符集中指定了可变长度的字符串。 您在创建数据库时指定数据库字符集。  Oracle将字符值完全按照您指定的值存储在VARCHAR2列中，并且不进行任何空白填充，前提是该值不超过该列的长度。 <br><br>  <b>NUMBER数据类型</b> <br>  NUMBER数据类型存储零以及正和负的固定数，其绝对值从1.0 x 10-130到1.0 x 10126（但不包括1.0 x 10126）。如果您指定的算术表达式的绝对值大于或等于1.0 x 10126，然后Oracle返回错误。 每个NUMBER值需要1到22个字节。 考虑到这一点，可以使用以下公式计算特定数值数据值NUMBER（p）的列大小（以字节为单位），其中p是给定值的精度： <i>ROUND（（length（p（p）+ s）/ 2））+ 1</i> ，如果数字为正，则s等于零；如果数字为负，则s等于1。 <br><br> 另外，我们摘录了有关存储Null值的文档。 <br><br>  null是列中没有值。 空值表示缺少，未知或不适用的数据。 如果空值位于带有数据值的列之间，则它们将存储在数据库中。 在这些情况下，它们需要1个字节来存储列的长度（零）。 行尾的空值不需要存储，因为新的行标题表示前一行中的其余列为空。 例如，如果表的最后三列为空，则不会为这些列存储任何数据。 <br><br> 基于这些数据，我们进行推理。 我们认为该数据库使用编码AL32UTF8。 在这种编码中，俄语字母将占据2个字节。 <br><br>  1）A和X，字段“ Y”的值是1个字节，字段X“ D”的值是2个字节 <br>  2）B和Y，b值中的'Vasya'将补充最多10个字符的空格，并将占用14个字节，d中的'Vasya'-将占用8个字节。 <br>  3）C和K。两个字段均为NULL，之后是有效字段，因此它们占用1个字节。 <br>  4）C和Z。两个字段均为NULL，但是Z字段是表中的最后一个字段，因此它不占用空间（0字节）。 字段C占用1个字节。 <br>  5）K和Z。类似于前面的情况。  K字段中的值为1字节，Z-0中。 <br>  6）I和J。根据文档，这两个值各自占用2个字节。 我们根据文档中的公式来考虑长度：舍入（（1 + 0）/ 2）+1 = 1 +1 = 2。 <br>  7）J和X。J字段中的值将占用2个字节，X字段中的值将占用2个字节。 <br><br>  <b>总的来说，正确的选项是：C和K，I和J，J和X。</b> <br></div></div><br><br><h3>  T_I索引的聚类因子大约是多少？ </h3><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> t (i <span class="hljs-built_in"><span class="hljs-built_in">integer</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">insert</span></span> <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> t <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">rownum</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> dual <span class="hljs-keyword"><span class="hljs-keyword">connect</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> <span class="hljs-keyword"><span class="hljs-keyword">level</span></span> &lt;= <span class="hljs-number"><span class="hljs-number">10000</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> t_i <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> t(i);</code> </pre><br><ul><li> 大约几十个 </li><li> 约几百 </li><li> 数以千计 </li><li> 数以万计的 </li></ul><br><div class="spoiler">  <b class="spoiler_title">答案</b> <div class="spoiler_text"> 根据Oracle文档（从12.1引用）： <br><br> 对于B树索引，索引聚类因子测量相对于索引值的行的物理分组。 <br><br> 索引聚类因子可帮助优化程序确定对于某些查询而言，索引扫描还是全表扫描更有效。 低聚类因子表示有效的索引扫描。 <br><br> 接近表中块数的聚类因子表明，索引键在表块中对行进行了物理排序。 如果数据库执行全表扫描，则数据库倾向于检索行，因为它们存储在按索引键排序的磁盘上。 接近行数的聚类因子表明，相对于索引键，行在数据库块中随机散布。 如果数据库执行全表扫描，则数据库将不会通过此索引键以任何排序的顺序检索行。 <br><br> 在这种情况下，数据将进行完美排序，因此聚类因子将等于或接近表中已占用块的数量。 对于8 KB的标准块大小，可以预期一个块中将容纳约一千个窄数字值，因此，块的数量以及因此的聚类因子将<b>约为数十</b> 。 <br></div></div><br><h3> 在N的哪个值下，以下脚本将在具有标准设置的常规数据库中成功执行？ </h3><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> t ( a varchar2(N <span class="hljs-built_in"><span class="hljs-built_in">char</span></span>), b varchar2(N <span class="hljs-built_in"><span class="hljs-built_in">char</span></span>), c varchar2(N <span class="hljs-built_in"><span class="hljs-built_in">char</span></span>), d varchar2(N <span class="hljs-built_in"><span class="hljs-built_in">char</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> t_i <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> t (a, b, c, d);</code> </pre><br><ul><li>  100 </li><li>  200 </li><li>  400 </li><li>  800 </li><li>  1600 </li><li>  3200 </li><li>  6400 </li></ul><br><div class="spoiler">  <b class="spoiler_title">答案</b> <div class="spoiler_text"> 根据Oracle文档（引自11.2）： <br><br> 逻辑数据库限制 <br><br><div class="scrollable-table"><table><thead><tr><td>  <strong>项</strong> </td><td>  <strong>限制类型</strong> </td><td>  <strong>极限值</strong> </td></tr></thead><tbody><tr><td> 指标 </td><td> 索引列的总大小 </td><td> 数据库块大小的75％减去一些开销 </td></tr></tbody></table></div><br> 因此，索引列的总大小不应超过6Kb。 进一步取决于所选的编码基础。 对于AL32UTF8编码，一个字符最多可以占用4个字节，因此在最坏的情况下，6 KB可以容纳大约1,500个字符。 因此，Oracle将禁止在N = 400（最坏情况下的密钥长度为1600个字符* 4字节+行标识符长度<b>）下</b>创建索引，而<b>在N = 200（或更小）下</b>创建索引将正常工作。 <br></div></div><br><h3> 带有APPEND提示的INSERT语句旨在以直接模式加载数据。 如果将其应用于触发器挂起的表会怎样？ </h3><br><ul><li> 数据将以直接模式加载，触发器将按预期工作 </li><li> 数据将以直接模式加载，但不会执行触发器 </li><li> 数据将以常规模式加载，触发器将按预期方式工作 </li><li> 数据将以常规模式加载，但不会执行触发器 </li><li> 数据将不会上传，错误将得到修复 </li></ul><br><div class="spoiler">  <b class="spoiler_title">答案</b> <div class="spoiler_text"> 原则上，这更多是逻辑问题。 为了找到正确的答案，我建议采用以下推理模型： <br><br><ol><li> 直接模式下的插入是通过直接通过SQL引擎来形成数据块来执行的，从而确保了高速。 因此，要确保触发器的执行是非常困难的，如果有可能的话，这是毫无意义的，因为无论如何它都会大大减慢插入的速度。 </li><li> 未能触发将导致以下事实：对于表中的相同数据，整个数据库（其他表）的状态将取决于数据插入的模式。 这显然会破坏数据的完整性，因此不能用作生产解决方案。 </li><li> 通常，无法执行请求的操作被视为错误。 但是这里应该记住，APPEND是一个提示，并且提示的一般逻辑是，如果可能的话，将它们考虑在内，但如果没有考虑，则在不考虑提示的情况下执行操作符。 </li></ol><br> 因此，预期的答案是<b>数据将以正常（SQL）模式加载，触发器将触发。</b> <br><br> 根据Oracle文档（引自8.04）： <br><br> 违反限制将导致该语句使用常规插入路径按顺序执行，而不会发出警告或错误消息。 例外是对语句在事务中多次访问同一表的限制，这可能会导致错误消息。 <br> 例如，如果表上存在触发器或引用完整性，那么当您尝试使用直接加载INSERT（串行或并行）以及PARALLEL提示或子句（如果有）时，APPEND提示将被忽略。 </div></div><br><h3> 执行以下脚本时会发生什么？ </h3><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> t(i <span class="hljs-built_in"><span class="hljs-built_in">integer</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span> primary <span class="hljs-keyword"><span class="hljs-keyword">key</span></span>, j <span class="hljs-built_in"><span class="hljs-built_in">integer</span></span> <span class="hljs-keyword"><span class="hljs-keyword">references</span></span> t); <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">trigger</span></span> t_a_i <span class="hljs-keyword"><span class="hljs-keyword">after</span></span> <span class="hljs-keyword"><span class="hljs-keyword">insert</span></span> <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> t <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-keyword"><span class="hljs-keyword">each</span></span> <span class="hljs-keyword"><span class="hljs-keyword">row</span></span> <span class="hljs-keyword"><span class="hljs-keyword">declare</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pragma</span></span> autonomous_transaction; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">insert</span></span> <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> t <span class="hljs-keyword"><span class="hljs-keyword">values</span></span> (:new.i + <span class="hljs-number"><span class="hljs-number">1</span></span>, :new.i); <span class="hljs-keyword"><span class="hljs-keyword">commit</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; / <span class="hljs-keyword"><span class="hljs-keyword">insert</span></span> <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> t <span class="hljs-keyword"><span class="hljs-keyword">values</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-literal"><span class="hljs-literal">null</span></span>);</code> </pre><br><ul><li> 成功执行 </li><li> 语法错误失败 </li><li> 无效的离线交易错误 </li><li> 与超出最大呼叫嵌套量有关的错误 </li><li> 外键违反错误 </li><li> 锁定错误 </li></ul><br><div class="spoiler">  <b class="spoiler_title">答案</b> <div class="spoiler_text"> 正确创建了表和触发器，此操作不应导致问题。 还允许触发器中的自主事务，否则将是不可能的，例如，日志记录。 <br><br> 插入第一行之后，成功的触发器将导致第二行的插入，与此相关联的触发器将再次起作用，插入第三行，依此类推，直到语句由于超出最大的调用嵌套而下降。 但是，另一个微妙的点被触发。 在执行触发器时，尚未为第一个插入的记录执行提交。 因此，在自主事务中工作的触发器尝试在表中插入由外键引用尚未提交的记录的行。 这导致了等待（自主事务正在等待主提交以了解是否可以插入数据），同时主事务正在等待自主提交在触发器之后继续工作。  <b>发生死锁，结果，由于与锁相关的原因，自治事务将被触发</b> 。 <br></div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN459680/">https://habr.com/ru/post/zh-CN459680/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN459662/index.html">PVS-Studio想要，但在robots.txt中找不到错误</a></li>
<li><a href="../zh-CN459668/index.html">如何从照片中识别文本：视觉框架的新功能</a></li>
<li><a href="../zh-CN459670/index.html">后藤阿姆斯特丹</a></li>
<li><a href="../zh-CN459672/index.html">Python下划线</a></li>
<li><a href="../zh-CN459674/index.html">威胁情报史诗传奇</a></li>
<li><a href="../zh-CN459682/index.html">存储中的数据质量</a></li>
<li><a href="../zh-CN459684/index.html">Android版莫斯科地铁和全世界的地图</a></li>
<li><a href="../zh-CN459688/index.html">中国的城市主义：更少的行家，更多的科学和信息技术</a></li>
<li><a href="../zh-CN459692/index.html">我们如何发现与既定化学原理相抵触的材料修改</a></li>
<li><a href="../zh-CN459694/index.html">博物馆数据艺术。 打开并打开Radio 86RK的包装</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>