<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🏇 🧛🏻 🤰 Sound- und musikbasierte Umgebungsgenerierung in Unity3D. Teil 2. Erstellen einer 2D-Spur aus Musik ㊗️ 👴🏼 🔣</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Anmerkung 


 Hallo an alle. Vor relativ kurzer Zeit schrieb ich einen Artikel über das Generieren einer Umgebung basierend auf Sound und Musik in Uni...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Sound- und musikbasierte Umgebungsgenerierung in Unity3D. Teil 2. Erstellen einer 2D-Spur aus Musik</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/digital-ecosystems/blog/432134/"><h2 id="annotaciya">  Anmerkung </h2><br><p>  Hallo an alle.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Vor</a> relativ kurzer Zeit schrieb ich einen Artikel über das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Generieren einer Umgebung basierend auf Sound und Musik in Unity3D</a> , in dem ich einige Beispiele für Spiele gab, die die Mechanik der Generierung von Inhalten basierend auf Musik verwenden, und sprach auch über die grundlegenden Aspekte solcher Spiele.  Der Artikel enthielt praktisch keinen Code und ich versprach, dass es eine Fortsetzung geben würde.  Und hier ist es vor dir.  Dieses Mal werden wir versuchen, aus Ihrer Musik eine Strecke für ein 2D-Rennen im Stil von Hill Climb zu erstellen.  Mal sehen, was wir bekommen .. </p><br><p><img src="https://habrastorage.org/webt/wp/6y/jk/wp6yjkpyoal7a3bzsg0ugeiuyvs.png"></p><a name="habracut"></a><br><h2 id="vvedenie">  Einführung </h2><br><p>  Ich erinnere Sie daran, dass diese Artikelserie für Anfänger und diejenigen gedacht ist, die gerade erst angefangen haben, mit Sound zu arbeiten.  Wenn Sie eine schnelle Fourier-Transformation in Ihrem Kopf durchführen, werden Sie sich wahrscheinlich langweilen. </p><br><p>  Hier ist unsere Road Map für heute: </p><br><ol><li>  Überlegen Sie, was Diskretisierung ist. </li><li>  Finden Sie heraus, welche Daten wir von Audio Clip Unity erhalten können </li><li>  Verstehen Sie, wie wir mit diesen Daten arbeiten können. </li><li>  Finden Sie heraus, was wir aus diesen Daten generieren können. </li><li>  Erfahren Sie, wie Sie aus all dem ein Spiel machen (na ja, oder etwas Ähnliches wie ein Spiel). </li></ol><br><p>  Also lass uns gehen! </p><br><h2 id="diskretizaciya-analogovogo-singala">  Diskretisierung von analogem Singhalesisch </h2><br><p>  Wie viele Menschen wissen, müssen wir ein Signal konvertieren, um es in digitalen Systemen verwenden zu können.  Einer der Konvertierungsschritte ist die Signalabtastung, bei der das analoge Signal in Teile unterteilt wird (temporäre Berichte), wonach jedem Bericht der Amplitudenwert zugewiesen wird, der zum ausgewählten Zeitpunkt war. <br><img src="https://habrastorage.org/webt/k-/r4/_0/k-r4_0pvvu8sxhcdxaybjnpsn0q.png"></p><br><p>  Der Buchstabe T gibt die Abtastperiode an.  Je kürzer die Periode ist, desto genauer ist die Signalumwandlung.  Meistens sprechen sie jedoch von der Umkehrung: Abtastrate (es ist logisch, dass dies F = 1 / T ist).  8.000 Hz reichen für einen Telefonsingal aus, und beispielsweise erfordert eine der Optionen für das DVD-Audio-Format eine Abtastfrequenz von 192.000 Hz.  Der Standard für digitale Aufnahmen (in Spieleditoren, Musikeditoren) ist 44 100 Hz - dies ist die Frequenz von CD-Audio. </p><br><p>  Die numerischen Werte der Amplitude werden in den sogenannten Samples gespeichert und mit ihnen werden wir arbeiten.  Der Wert der Stichprobe ist float und kann zwischen -1 und 1 liegen. Vereinfacht sieht es so aus. </p><br><p><img src="https://habrastorage.org/webt/sj/rg/r7/sjrgr7njjj7iwmyi6nebdtpfxze.png"></p><br><h2 id="otrisovka-zvukovoy-volny-statichno">  Schallwellenwiedergabe (statisch) </h2><br><h3 id="bazovaya-informaciya">  Grundlegende Informationen </h3><br><p>  Die Wellenform (oder Audioform und bei gewöhnlichen Menschen - „Fisch“) ist eine visuelle Darstellung des Tonsignals über die Zeit.  Die Wellenform kann uns zeigen, an welchem ​​Punkt im Schall die aktive Phase auftritt und wo die Dämpfung auftritt.  Oft wird die Wellenform für jeden Kanal separat dargestellt, zum Beispiel wie folgt: </p><br><p><img src="https://habrastorage.org/webt/hj/xr/vm/hjxrvm-bdrgt-myieappnmqxgb0.png"></p><br><p>  Stellen Sie sich vor, wir haben bereits eine AudioSource und ein Skript, in dem wir arbeiten.  Mal sehen, was uns die Einheit geben kann. </p><br><pre><code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//  AudioSource    AudioSource myAudio = gameObject.GetComponent&lt;AudioSource&gt;(); //     .     44100. int freq = myAudio.clip.frequency;</span></span></code> </pre> <br><h3 id="vybor-kol-va-otchetov">  Wählen Sie Anzahl der Berichte </h3><br><p>  Bevor wir weiter gehen, müssen wir ein wenig über die Rendering-Tiefe unseres Sounds sprechen.  Mit einer Abtastfrequenz von 44100 Hz pro Sekunde können wir 44100 Berichte verarbeiten.  Angenommen, wir müssen einen 10 Sekunden langen Track rendern.  Wir werden jeden Bericht mit einer Pixelbreite zeichnen.  Es stellt sich heraus, dass unsere Wellenform 441.000 Pixel lang sein wird.  Sie erhalten eine sehr lange, langgestreckte und wenig verstandene Schallwelle.  Aber darin können Sie jeden spezifischen Bericht sehen!  Und Sie werden das System schrecklich laden, egal wie Sie es zeichnen. </p><br><p><img src="https://habrastorage.org/webt/qr/yf/j6/qryfj6qyv0v5mrbzjfqz6qcws_y.png"></p><br><p>  Wenn Sie keine professionelle Audiosoftware erstellen, benötigen Sie keine solche Genauigkeit.  Für ein allgemeines Audiobild können wir alle Samples in größere Zeiträume aufteilen und beispielsweise den Durchschnitt von jeweils 100 Samples nehmen.  Dann wird unsere Welle eine ganz bestimmte Form haben: </p><br><p><img src="https://habrastorage.org/webt/2v/yk/kz/2vykkzw2wtewvjzcwsfsz_h1zvq.png"></p><br><p>  Dies ist natürlich nicht ganz korrekt, da Sie die möglicherweise benötigten Lautstärkespitzen überspringen können, sodass Sie nicht den Durchschnittswert, sondern das Maximum aus diesem Segment ausprobieren können.  Dies ergibt ein etwas anderes Bild, aber Ihre Spitzen verschwinden nicht. </p><br><h3 id="podgotovka-k-polucheniyu-audiodannyh">  Vorbereiten des Audioempfangs </h3><br><p>  Definieren wir die Genauigkeit unserer Stichprobe als Qualität und die endgültige Anzahl der Berichte als sampleCount. </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> quality = <span class="hljs-number"><span class="hljs-number">100</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> sampleCount = <span class="hljs-number"><span class="hljs-number">0</span></span>; sampleCount = freq / quality;</code> </pre> <br><p>  Ein Beispiel für die Berechnung aller Zahlen finden Sie unten. </p><br><p>  Als nächstes müssen wir die Proben selbst bekommen.  Dies kann aus einem Audioclip mit der <strong>GetData-</strong> Methode erfolgen. </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetData</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] data, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> offsetSamples</span></span></span><span class="hljs-function">)</span></span>;</code> </pre> <br><p>  Diese Methode verwendet ein Array, in das Samples geschrieben werden.  offsetSamples - Parameter, der für den Startpunkt des Lesens des Datenarrays verantwortlich ist.  Wenn Sie das Array von Anfang an lesen, sollte es Null geben. </p><br><p>  Um Samples aufzunehmen, müssen wir ein Array für sie vorbereiten.  Zum Beispiel so: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] samples; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] waveFormArray; <span class="hljs-comment"><span class="hljs-comment">//      samples = new float[myAudio.clip.samples * myAudio.clip.channels];</span></span></code> </pre> <br><p>  Warum haben wir die Länge mit der Anzahl der Kanäle multipliziert?  Jetzt werde ich erzählen ... </p><br><h3 id="informaciya-ob-audiokanalah-v-unity">  Informationen zum Unity-Audiokanal </h3><br><p>  Viele Leute wissen, dass wir im Sound normalerweise zwei Kanäle verwenden: links und rechts.  Jemand weiß, dass es 2.1-Systeme sowie 5.1, 7.1 gibt, in denen Schallquellen von allen Seiten umgeben sind.  Das Thema der Kanäle ist <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">im Wiki</a> gut beschrieben.  Wie funktioniert das in Unity? </p><br><p>  Beim Herunterladen einer Datei und beim Öffnen eines Clips finden Sie das folgende Bild: </p><br><p><img src="https://habrastorage.org/webt/us/hy/tu/ushytu2q3jhyyl8sbx9tclnaf9i.png"></p><br><p>  Hier wird nur gezeigt, dass wir zwei Kanäle haben, und Sie können sogar feststellen, dass sie sich voneinander unterscheiden.  Unity zeichnet nacheinander Samples dieser Kanäle auf.  Es stellt sich dieses Bild heraus: <br><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>[</mo><msub><mi>L</mi><mn>1</mn></msub><mo>,</mo><msub><mi>R</mi><mn>1</mn></msub><mo>,</mo><msub><mi>L</mi><mn>2</mn></msub><mo>,</mo><msub><mi>R</mi><mn>2</mn></msub><mo>,</mo><msub><mi>L</mi><mn>3</mn></msub><mo>,</mo><msub><mi>R</mi><mn>3</mn></msub><mo>,</mo><msub><mi>L</mi><mn>4</mn></msub><mo>,</mo><msub><mi>R</mi><mn>4</mn></msub><mo>,</mo><msub><mi>L</mi><mn>5</mn></msub><mo>,</mo><msub><mi>R</mi><mn>5</mn></msub><mo>,</mo><msub><mi>L</mi><mn>6</mn></msub><mo>,</mo><msub><mi>R</mi><mn>6</mn></msub><mo>,</mo><msub><mi>L</mi><mn>7</mn></msub><mo>,</mo><msub><mi>R</mi><mn>7</mn></msub><mo>,</mo><msub><mi>L</mi><mn>8</mn></msub><mo>,</mo><msub><mi>R</mi><mn>8</mn></msub><mo>.</mo><mo>.</mo><mo>.</mo><mo stretchy=&quot;false&quot;>]</mo></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="63.547ex" height="2.66ex" viewBox="0 -832 27360.5 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgGnRiTorvSoSd71Mb74V2r_-88ug#MJMAIN-5B" x="0" y="0"></use><g transform="translate(278,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgGnRiTorvSoSd71Mb74V2r_-88ug#MJMATHI-4C" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgGnRiTorvSoSd71Mb74V2r_-88ug#MJMAIN-31" x="963" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgGnRiTorvSoSd71Mb74V2r_-88ug#MJMAIN-2C" x="1413" y="0"></use><g transform="translate(1859,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgGnRiTorvSoSd71Mb74V2r_-88ug#MJMATHI-52" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgGnRiTorvSoSd71Mb74V2r_-88ug#MJMAIN-31" x="1074" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgGnRiTorvSoSd71Mb74V2r_-88ug#MJMAIN-2C" x="3072" y="0"></use><g transform="translate(3517,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgGnRiTorvSoSd71Mb74V2r_-88ug#MJMATHI-4C" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgGnRiTorvSoSd71Mb74V2r_-88ug#MJMAIN-32" x="963" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgGnRiTorvSoSd71Mb74V2r_-88ug#MJMAIN-2C" x="4653" y="0"></use><g transform="translate(5098,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgGnRiTorvSoSd71Mb74V2r_-88ug#MJMATHI-52" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgGnRiTorvSoSd71Mb74V2r_-88ug#MJMAIN-32" x="1074" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgGnRiTorvSoSd71Mb74V2r_-88ug#MJMAIN-2C" x="6311" y="0"></use><g transform="translate(6756,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgGnRiTorvSoSd71Mb74V2r_-88ug#MJMATHI-4C" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgGnRiTorvSoSd71Mb74V2r_-88ug#MJMAIN-33" x="963" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgGnRiTorvSoSd71Mb74V2r_-88ug#MJMAIN-2C" x="7892" y="0"></use><g transform="translate(8337,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgGnRiTorvSoSd71Mb74V2r_-88ug#MJMATHI-52" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgGnRiTorvSoSd71Mb74V2r_-88ug#MJMAIN-33" x="1074" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgGnRiTorvSoSd71Mb74V2r_-88ug#MJMAIN-2C" x="9550" y="0"></use><g transform="translate(9995,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgGnRiTorvSoSd71Mb74V2r_-88ug#MJMATHI-4C" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgGnRiTorvSoSd71Mb74V2r_-88ug#MJMAIN-34" x="963" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgGnRiTorvSoSd71Mb74V2r_-88ug#MJMAIN-2C" x="11131" y="0"></use><g transform="translate(11576,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgGnRiTorvSoSd71Mb74V2r_-88ug#MJMATHI-52" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgGnRiTorvSoSd71Mb74V2r_-88ug#MJMAIN-34" x="1074" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgGnRiTorvSoSd71Mb74V2r_-88ug#MJMAIN-2C" x="12789" y="0"></use><g transform="translate(13235,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgGnRiTorvSoSd71Mb74V2r_-88ug#MJMATHI-4C" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgGnRiTorvSoSd71Mb74V2r_-88ug#MJMAIN-35" x="963" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgGnRiTorvSoSd71Mb74V2r_-88ug#MJMAIN-2C" x="14370" y="0"></use><g transform="translate(14815,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgGnRiTorvSoSd71Mb74V2r_-88ug#MJMATHI-52" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgGnRiTorvSoSd71Mb74V2r_-88ug#MJMAIN-35" x="1074" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgGnRiTorvSoSd71Mb74V2r_-88ug#MJMAIN-2C" x="16029" y="0"></use><g transform="translate(16474,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgGnRiTorvSoSd71Mb74V2r_-88ug#MJMATHI-4C" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgGnRiTorvSoSd71Mb74V2r_-88ug#MJMAIN-36" x="963" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgGnRiTorvSoSd71Mb74V2r_-88ug#MJMAIN-2C" x="17609" y="0"></use><g transform="translate(18054,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgGnRiTorvSoSd71Mb74V2r_-88ug#MJMATHI-52" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgGnRiTorvSoSd71Mb74V2r_-88ug#MJMAIN-36" x="1074" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgGnRiTorvSoSd71Mb74V2r_-88ug#MJMAIN-2C" x="19268" y="0"></use><g transform="translate(19713,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgGnRiTorvSoSd71Mb74V2r_-88ug#MJMATHI-4C" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgGnRiTorvSoSd71Mb74V2r_-88ug#MJMAIN-37" x="963" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgGnRiTorvSoSd71Mb74V2r_-88ug#MJMAIN-2C" x="20848" y="0"></use><g transform="translate(21293,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgGnRiTorvSoSd71Mb74V2r_-88ug#MJMATHI-52" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgGnRiTorvSoSd71Mb74V2r_-88ug#MJMAIN-37" x="1074" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgGnRiTorvSoSd71Mb74V2r_-88ug#MJMAIN-2C" x="22507" y="0"></use><g transform="translate(22952,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgGnRiTorvSoSd71Mb74V2r_-88ug#MJMATHI-4C" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgGnRiTorvSoSd71Mb74V2r_-88ug#MJMAIN-38" x="963" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgGnRiTorvSoSd71Mb74V2r_-88ug#MJMAIN-2C" x="24087" y="0"></use><g transform="translate(24533,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgGnRiTorvSoSd71Mb74V2r_-88ug#MJMATHI-52" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgGnRiTorvSoSd71Mb74V2r_-88ug#MJMAIN-38" x="1074" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgGnRiTorvSoSd71Mb74V2r_-88ug#MJMAIN-2E" x="25746" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgGnRiTorvSoSd71Mb74V2r_-88ug#MJMAIN-2E" x="26191" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgGnRiTorvSoSd71Mb74V2r_-88ug#MJMAIN-2E" x="26636" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgGnRiTorvSoSd71Mb74V2r_-88ug#MJMAIN-5D" x="27082" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">[</mo><msub><mi>L</mi><mn>1</mn></msub><mo>,</mo><msub><mi>R</mi><mn>1</mn></msub><mo>,</mo><msub><mi>L</mi><mn>2</mn></msub><mo>,</mo><msub><mi>R</mi><mn>2</mn></msub><mo>,</mo><msub><mi>L</mi><mn>3</mn></msub><mo>,</mo><msub><mi>R</mi><mn>3</mn></msub><mo>,</mo><msub><mi>L</mi><mn>4</mn></msub><mo>,</mo><msub><mi>R</mi><mn>4</mn></msub><mo>,</mo><msub><mi>L</mi><mn>5</mn></msub><mo>,</mo><msub><mi>R</mi><mn>5</mn></msub><mo>,</mo><msub><mi>L</mi><mn>6</mn></msub><mo>,</mo><msub><mi>R</mi><mn>6</mn></msub><mo>,</mo><msub><mi>L</mi><mn>7</mn></msub><mo>,</mo><msub><mi>R</mi><mn>7</mn></msub><mo>,</mo><msub><mi>L</mi><mn>8</mn></msub><mo>,</mo><msub><mi>R</mi><mn>8</mn></msub><mo>.</mo><mo>.</mo><mo>.</mo><mo stretchy="false">]</mo></math></span></span><script type="math/tex" id="MathJax-Element-1"> [L_1, R_1, L_2, R_2, L_3, R_3, L_4, R_4, L_5, R_5, L_6, R_6, L_7, R_7, L_8, R_8 ...] </script></p><br><p>  Deshalb benötigen wir doppelt so viel Platz im Array als nur für die Anzahl der Samples. </p><br><p>  Wenn Sie die Option Force To Mono-Clip auswählen, ist der Kanal einer und der gesamte Ton befindet sich in der Mitte.  Die Vorschau Ihrer Welle ändert sich sofort. </p><br><p><img src="https://habrastorage.org/webt/fx/pk/-f/fxpk-fvqtdsvhfvfyyvl1mjrjla.png"></p><br><p><img src="https://habrastorage.org/webt/po/62/s8/po62s86xpcbainozvupbpekwdig.png"></p><br><h3 id="poluchenie-audiodannyh">  Audio-Daten empfangen </h3><br><p>  Folgendes bekommen wir: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> quality = <span class="hljs-number"><span class="hljs-number">100</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> sampleCount = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] waveFormArray; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] samples; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> AudioSource myAudio; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { myAudio = gameObject.GetComponent&lt;AudioSource&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> freq = myAudio.clip.frequency; sampleCount = freq / quality; samples = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[myAudio.clip.samples * myAudio.clip.channels]; myAudio.clip.GetData(samples,<span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-comment"><span class="hljs-comment">//  ,    .       waveFormArray = new float[(samples.Length / sampleCount)]; //             for (int i = 0; i &lt; waveFormArray.Length; i++) { waveFormArray[i] = 0; for (int j = 0; j &lt; sampleCount; j++) { //Abs     ""    . .  waveFormArray[i] += Mathf.Abs(samples[(i * sampleCount) + j]); } waveFormArray[i] /= sampleCount; } }</span></span></code> </pre> <br><p>  Insgesamt, wenn der Track 10 Sekunden lang ist und zweikanalig ist, erhalten wir Folgendes: </p><br><ul><li>  Die Anzahl der Samples im Clip (myAudio.clip.sample) = 44100 * 10 = 441000 </li><li>  Das Samples-Array für zwei Kanäle ist lang (Samples.Length) = 441000 * 2 = 882000 </li><li>  Anzahl der Berichte (sampleCount) = 44100/100 = 441 </li><li>  Die Länge des endgültigen Arrays = samples.Length / sampleCount = 2000 </li></ul><br><p>  Infolgedessen werden wir mit 2000 Punkten arbeiten, was ausreicht, um die Welle zu zeichnen.  Jetzt müssen Sie die Vorstellungskraft einbeziehen und darüber nachdenken, wie wir diese Daten verwenden können. </p><br><h3 id="otrisovka-audioinformacii">  Audioinformationen rendern </h3><br><h4 id="sozdanie-prostoy-audiodorozhki-s-pomoschyu-debug-sredstv">  Erstellen Sie mit den Debug-Tools eine einfache Audiospur </h4><br><p>  Wie viele wissen, verfügt Unity über bequeme Mittel zum Anzeigen aller Arten von Debug-Informationen.  Ein intelligenter Entwickler, der auf diesen Tools basiert, kann beispielsweise sehr leistungsfähige Erweiterungen für den Editor vornehmen.  Unser Fall zeigt eine sehr untypische Verwendung von Debug-Methoden. </p><br><p>  Zum Zeichnen brauchen wir eine Linie.  Wir können dies mit Hilfe eines Vektors tun, der aus den Werten unseres Arrays erstellt wird.  Bitte beachten Sie, dass wir die beiden Hälften unserer Visualisierung „kleben“ müssen, um eine schöne Spiegel-Audio-Form zu erstellen. </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; waveFormArray.Length - <span class="hljs-number"><span class="hljs-number">1</span></span>; i++) { <span class="hljs-comment"><span class="hljs-comment">//      Vector3 upLine = new Vector3(i * .01f, waveFormArray[i] * 10, 0); //      Vector3 downLine = new Vector3(i * .01f, -waveFormArray[i] * 10, 0); }</span></span></code> </pre> <br><p>  Verwenden Sie als Nächstes einfach Debug.DrawLine, um unsere Vektoren zu zeichnen.  Jede Farbe kann wählen.  Alle diese Methoden müssen in Update aufgerufen werden, damit wir die Informationen in jedem Frame aktualisieren. </p><br><pre> <code class="cs hljs">Debug.DrawLine(upLine, downLine, Color.green);</code> </pre> <br><p>  Wenn Sie möchten, können Sie einen „Schieberegler“ hinzufügen, der die aktuelle Position des abgespielten Titels anzeigt.  Diese Informationen erhalten Sie im Feld "AudioSource.timeSamples". </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> debugLineWidth = <span class="hljs-number"><span class="hljs-number">5</span></span>; <span class="hljs-comment"><span class="hljs-comment">// ""  .       int currentPosition = (myAudio.timeSamples / quality) * 2; Vector3 drawVector = new Vector3(currentPosition * 0.01f, 0, 0); Debug.DrawLine(drawVector - Vector3.up * debugLineWidth, drawVector + Vector3.up * debugLineWidth, Color.white);</span></span></code> </pre> <br><p>  Insgesamt ist hier unser Skript: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">WaveFormDebug</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> quality = <span class="hljs-number"><span class="hljs-number">100</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> sampleCount = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> freq; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> debugLineWidth = <span class="hljs-number"><span class="hljs-number">5</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] waveFormArray; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] samples; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> AudioSource myAudio; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { myAudio = gameObject.GetComponent&lt;AudioSource&gt;(); <span class="hljs-comment"><span class="hljs-comment">//  freq = myAudio.clip.frequency; sampleCount = freq / quality; //  samples = new float[myAudio.clip.samples * myAudio.clip.channels]; myAudio.clip.GetData(samples, 0); //       waveFormArray = new float[(samples.Length / sampleCount)]; for (int i = 0; i &lt; waveFormArray.Length; i++) { waveFormArray[i] = 0; for (int j = 0; j &lt; sampleCount; j++) { waveFormArray[i] += Mathf.Abs(samples[(i * sampleCount) + j]); } waveFormArray[i] /= sampleCount; } } private void Update() { for (int i = 0; i &lt; waveFormArray.Length - 1; i++) { //      Vector3 upLine = new Vector3(i * 0.01f, waveFormArray[i] * 10, 0); //      Vector3 downLine = new Vector3(i * 0.01f, -waveFormArray[i] * 10, 0); // Debug  Debug.DrawLine(upLine, downLine, Color.green); } // ""  .       int currentPosition = (myAudio.timeSamples / quality) * 2; Vector3 drawVector = new Vector3(currentPosition * 0.01f, 0, 0); Debug.DrawLine(drawVector - Vector3.up * debugLineWidth, drawVector + Vector3.up * debugLineWidth, Color.white); } }</span></span></code> </pre> <br><p>  Und hier ist das Ergebnis: </p><br><p><img src="https://habrastorage.org/webt/gq/ij/fd/gqijfdc9d3b6t1nemd-wqsxqn70.png"></p><br><h4 id="sozdanie-plavnogo-zvukovogo-landshafta-s-pomoschyu-polygoncollider2d">  Erstellen Sie mit PolygonCollider2D eine glatte Klanglandschaft </h4><br><p>  Bevor ich mit diesem Abschnitt fortfahre, möchte ich Folgendes beachten: Natürlich macht es Spaß, auf dem aus Musik erzeugten Track zu fahren, aber aus Sicht des Gameplays ist es praktisch nutzlos.  Und hier ist warum: </p><br><ol><li>  Damit der Track passierbar ist, müssen wir unsere Daten glätten.  Alle Spitzen verschwinden und Sie hören praktisch auf, "Ihre Musik zu fühlen" </li><li>  Normalerweise sind Musiktitel stark komprimiert und stellen einen Soundstein dar, der für ein 2D-Spiel schlecht geeignet ist. </li><li>  Das ungelöste Problem der Geschwindigkeit unseres Transports, das für die Geschwindigkeit der Strecke geeignet sein sollte.  Ich möchte dieses Problem im nächsten Artikel behandeln. </li></ol><br><p>  Daher ist diese Art der Generierung als Experiment ziemlich lustig, aber es ist schwierig, ein echtes Gameplay-Feature darauf basierend zu erstellen.  In jedem Fall fahren wir fort. </p><br><p>  Wir müssen also PolygonCollider2D unter Verwendung unserer Daten erstellen.  Das ist einfach zu machen.  PolygonCollider2D verfügt über ein öffentliches Punktefeld, das Vector2 [] akzeptiert.  Zuerst müssen wir unsere Punkte auf die Vektoren des gewünschten Typs übertragen.  Lassen Sie uns eine Funktion erstellen, um das Array unserer Samples in ein Vektorarray zu übersetzen: </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> Vector2[] </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreatePath</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] src</span></span></span><span class="hljs-function">)</span></span> { Vector2[] result = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2[src.Length]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; size; i++) { result[i] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(i * <span class="hljs-number"><span class="hljs-number">0.01f</span></span>, Mathf.Abs(src[i] * lineScale)); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; }</code> </pre> <br><p>  Übergeben Sie danach einfach unser resultierendes Vektorarray an den Collider: </p><br><pre> <code class="cs hljs">path = CreatePath(waveFormArray); poly.points = path;</code> </pre> <br><p>  Wir schauen uns das Ergebnis an.  Hier ist der Anfang unseres Tracks ... hmm ... er sieht nicht sehr passabel aus (denken Sie noch nicht an die Visualisierung, Kommentare werden später kommen). </p><br><p><img src="https://habrastorage.org/webt/e-/3e/ry/e-3eryzi385zy3f4r-hvnsi0iwc.png"></p><br><p>  Wir haben eine zu scharfe Audioform, daher kommt der Track komisch heraus.  Müssen es glätten.  Hier verwenden wir den gleitenden Durchschnittsalgorithmus.  Weitere Informationen zu Habr finden Sie im Artikel <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Der Algorithmus</a> für den <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">gleitenden Durchschnitt (Simple Moving Average)</a> . </p><br><p>  In Unity wird der Algorithmus wie folgt implementiert: </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function">[] </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MovingAverage</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> frameSize, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] data</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> sum = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] avgPoints = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[data.Length - frameSize + <span class="hljs-number"><span class="hljs-number">1</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> counter = <span class="hljs-number"><span class="hljs-number">0</span></span>; counter &lt;= data.Length - frameSize; counter++) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> innerLoopCounter = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> index = counter; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (innerLoopCounter &lt; frameSize) { sum = sum + data[index]; innerLoopCounter += <span class="hljs-number"><span class="hljs-number">1</span></span>; index += <span class="hljs-number"><span class="hljs-number">1</span></span>; } avgPoints[counter] = sum / frameSize; sum = <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> avgPoints; }</code> </pre> <br><p>  Wir ändern unsere Pfaderstellung: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] avgArray = MovingAverage(frameSize, waveFormArray); path = CreatePath(avgArray); poly.points = path;</code> </pre> <br><p>  Überprüfen ... </p><br><p><img src="https://habrastorage.org/webt/m5/rk/sb/m5rksbekvjfd45482gbgprvnmn0.png"></p><br><p>  Jetzt sieht unsere Strecke ganz normal aus.  Ich habe eine Fensterbreite von 10 verwendet. Sie können diesen Parameter ändern, um die gewünschte Glättung auszuwählen. </p><br><p>  Hier ist das vollständige Skript für diesen Abschnitt: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">WaveFormTest</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> frameSize = <span class="hljs-number"><span class="hljs-number">10</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> size = <span class="hljs-number"><span class="hljs-number">2048</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> PolygonCollider2D poly; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> lineScale = <span class="hljs-number"><span class="hljs-number">5</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> quality = <span class="hljs-number"><span class="hljs-number">100</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> sampleCount = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] waveFormArray; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] samples; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Vector2[] path; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> AudioSource myAudio; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { myAudio = gameObject.GetComponent&lt;AudioSource&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> freq = myAudio.clip.frequency; sampleCount = freq / quality; samples = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[myAudio.clip.samples * myAudio.clip.channels]; myAudio.clip.GetData(samples, <span class="hljs-number"><span class="hljs-number">0</span></span>); waveFormArray = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[(samples.Length / sampleCount)]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; waveFormArray.Length; i++) { waveFormArray[i] = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> j = <span class="hljs-number"><span class="hljs-number">0</span></span>; j &lt; sampleCount; j++) { waveFormArray[i] += Mathf.Abs(samples[(i * sampleCount) + j]); } waveFormArray[i] /= sampleCount * <span class="hljs-number"><span class="hljs-number">2</span></span>; } <span class="hljs-comment"><span class="hljs-comment">//  ,    frameSize float[] avgArray = MovingAverage(frameSize, waveFormArray); path = CreatePath(avgArray); poly.points = path; } private Vector2[] CreatePath(float[] src) { Vector2[] result = new Vector2[src.Length]; for (int i = 0; i &lt; size; i++) { result[i] = new Vector2(i * 0.01f, Mathf.Abs(src[i] * lineScale)); } return result; } private float[] MovingAverage(int frameSize, float[] data) { float sum = 0; float[] avgPoints = new float[data.Length - frameSize + 1]; for (int counter = 0; counter &lt;= data.Length - frameSize; counter++) { int innerLoopCounter = 0; int index = counter; while (innerLoopCounter &lt; frameSize) { sum = sum + data[index]; innerLoopCounter += 1; index += 1; } avgPoints[counter] = sum / frameSize; sum = 0; } return avgPoints; } }</span></span></code> </pre> <br><p>  Wie ich am Anfang des Abschnitts sagte, hören wir mit dieser Glättung auf, den Track zu fühlen, außerdem ist die Geschwindigkeit der Maschine nicht an die Geschwindigkeit der Musik (BPM) gebunden.  Wir werden dieses Problem im nächsten Teil dieser Artikelserie analysieren.  Außerdem werden wir dort auf das Thema Specials eingehen.  Effekte unter dem Takt.  Übrigens habe ich eine Schreibmaschine aus diesem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">kostenlosen Gut genommen</a> . </p><br><p>  Wahrscheinlich haben sich viele von Ihnen beim Betrachten der Screenshots gefragt, wie ich den Track selbst gezeichnet habe.  Collider sind schließlich nicht sichtbar. </p><br><p>  Ich habe die Weisheit des Internets genutzt und einen Weg gefunden, wie Sie einen Polygon-Collider in ein Netz verwandeln können, dem Sie jedes Material zuweisen können, und der Linienrenderer einen stilvollen Umriss erstellt.  Diese Methode wird <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> ausführlich beschrieben.  Triangulator können Sie gegen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Unity Community übernehmen</a> . </p><br><h2 id="zavershenie">  Fertigstellung </h2><br><p>  Was wir in diesem Artikel gelernt haben, ist eine grundlegende Skizze für Musikspiele.  Ja, in dieser Form ist es bisher ein wenig hässlich, aber Sie können mit Sicherheit sagen "Leute, ich habe die Maschine auf der Audiospur laufen lassen!".  Um dies zu einem echten Spiel zu machen, müssen Sie sich viel Mühe geben.  Hier ist eine Liste, was wir hier tun können: </p><br><ol><li>  Binden Sie die Geschwindigkeit der Maschine an die BPM-Spur.  Der Spieler kann nur die Neigung des Autos steuern, nicht aber die Geschwindigkeit.  Dann wird die Musik während des Kurses viel stärker empfunden. </li><li>  Machen Sie einen kleinen Detektor und fügen Sie Specials hinzu.  Effekte, die unter dem Takt funktionieren.  Darüber hinaus können Sie der Karosserie des Autos eine Animation hinzufügen, die im Takt eines Schlags abprallt.  Es hängt alles von Ihrer Vorstellungskraft ab. </li><li>  Anstatt den gleitenden Durchschnitt zu bestimmen, müssen Sie die Spur kompetenter verarbeiten und ein Array von Daten abrufen, damit die Spitzen nicht verschwinden, aber es war einfach, eine Spur zu erstellen. </li><li>  Nun, und natürlich müssen Sie das Gameplay interessant machen.  Sie können bei jedem Treffer ein Münzstück platzieren, Gefahrenzonen hinzufügen usw. </li></ol><br><p>  All dies und noch viel mehr werden wir in den verbleibenden Teilen dieser Artikelserie untersuchen.  Vielen Dank fürs Lesen! </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de432134/">https://habr.com/ru/post/de432134/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de432120/index.html">Lenovo zahlt Laptop-Besitzern eine Entschädigung in Höhe von 8,3 Millionen US-Dollar für die Installation von Superfish-Malware</a></li>
<li><a href="../de432122/index.html">Xcode und erweitertes Debugging in LLDB: Teil 2</a></li>
<li><a href="../de432128/index.html">Crutches, Narnia, Procrustes Ninja: Drei Timlid-Schmerzen in einem Startup</a></li>
<li><a href="../de432130/index.html">Herbstliche Mitaps zur mobilen Entwicklung im Tutu.ru-Büro</a></li>
<li><a href="../de432132/index.html">William Shakespeare: Schwierigkeiten beim Übersetzen von Sonetten ins Russische</a></li>
<li><a href="../de432136/index.html">Kühlen Sie die CPU im Rechenzentrum - 3D-Laserdruck hilft</a></li>
<li><a href="../de432138/index.html">Lassen Sie uns über Metriken sprechen, um die Arbeit eines Programmierers zu bewerten</a></li>
<li><a href="../de432142/index.html">Bienenstocküberwachung und offenes Projekt</a></li>
<li><a href="../de432144/index.html">Wie wir für SAP-Filialen in Europa über 1C Kassen in Russland integriert haben</a></li>
<li><a href="../de432146/index.html">Zimbra Collaboration Suite als würdiger Ersatz für Microsoft Exchange</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>