<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üö™ üïú üï∂Ô∏è GameDev TDD o Rabbit Hell ü§û üë®üèº‚Äç‚öïÔ∏è üë©üèΩ‚Äç‚öñÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="TDD rara vez se usa en el desarrollo de juegos. Por lo general, es m√°s f√°cil contratar a un probador que reservar un desarrollador para que escriba la...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>GameDev TDD o Rabbit Hell</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pixonic/blog/455076/">  TDD rara vez se usa en el desarrollo de juegos.  Por lo general, es m√°s f√°cil contratar a un probador que reservar un desarrollador para que escriba las pruebas; esto ahorra recursos y tiempo.  Por lo tanto, cada uso exitoso de TDD se vuelve m√°s interesante.  Debajo del corte, la traducci√≥n del material, donde se utiliz√≥ esta t√©cnica de desarrollo para crear el movimiento de los personajes en el juego ElemenTerra. <br><br><img src="https://habrastorage.org/webt/6x/yz/5c/6xyz5cjyml6vqmszhh-68zfy3_w.gif"><br><a name="habracut"></a><br>  El desarrollo basado en pruebas o TDD (desarrollo a trav√©s de pruebas) es una t√©cnica de desarrollo de software en la que todo el proceso se divide en muchos ciclos peque√±os.  Las pruebas unitarias se escriben, luego se escribe el c√≥digo que pasa estas pruebas y luego se realiza la refactorizaci√≥n.  Y el algoritmo se repite. <br><br><h3>  Conceptos b√°sicos de TDD </h3><br>  Supongamos que escribimos una funci√≥n que suma dos n√∫meros.  En un flujo de trabajo normal, simplemente lo escribir√≠amos.  Pero para usar TDD, debe comenzar creando una funci√≥n de marcador de posici√≥n y pruebas unitarias: <br><br><pre><code class="plaintext hljs">// Placeholder-,    : int add(int a, int b){ return -1; } // Unit-,   ,  add    : void runTests(){ if (add(1, 1) is not equal to 2) throw error; if (add(2, 2) is not equal to 4) throw error; }</code> </pre> <br>  Al principio, nuestras pruebas unitarias no funcionar√°n, porque la funci√≥n de marcador de posici√≥n devuelve -1 para cada entrada.  Ahora podemos ejecutar <i>add</i> correctamente para devolver <i>a + b</i> .  Se aprobar√°n las pruebas.  Esto puede parecer una soluci√≥n, pero hay varias ventajas: <br><br>  Si escribimos err√≥neamente <i>add</i> como <i>a - b</i> , nuestras pruebas no funcionar√°n e inmediatamente aprenderemos c√≥mo solucionar la funci√≥n.  Sin pruebas, no podemos detectar este error y ver una reacci√≥n no est√°ndar que llevar√° tiempo depurar. <br>  Podemos continuar con las pruebas y ejecutarlas en cualquier momento mientras escribimos el c√≥digo.  Esto significa que si otro programador cambia accidentalmente <i>agregar</i> , reconocer√° inmediatamente el error; las pruebas fallar√°n nuevamente. <br><br><h3>  TDD en desarrollo de juegos </h3><br>  Hay dos problemas con TDD en el desarrollo del juego.  En primer lugar, muchas funciones del juego tienen objetivos subjetivos que no se pueden medir.  Y en segundo lugar, es dif√≠cil escribir pruebas que cubran todas las posibilidades del espacio de mundos que est√°n llenos de objetos interactivos complejos.  Los desarrolladores que desean que los movimientos de sus personajes se "vean bien" o que las simulaciones f√≠sicas "no se vean desiguales" tendr√°n dificultades para expresar estas m√©tricas como condiciones deterministas de "aprobado / no aprobado". <br><br>  Sin embargo, la t√©cnica TDD es aplicable a caracter√≠sticas complejas y subjetivas, por ejemplo, el movimiento del personaje.  Y en el juego ElemenTerra lo hicimos. <br><br><h3>  Pruebas unitarias contra niveles de depuraci√≥n </h3><br>  Antes de comenzar a practicar, quiero distinguir entre una prueba unitaria autom√°tica y un "nivel de depuraci√≥n" tradicional.  Crear ubicaciones ocultas con condiciones artificiales es algo com√∫n en gamedev.  Esto permite a los programadores y QA monitorear eventos individuales. <br><br><img src="https://habrastorage.org/webt/ln/qv/4e/lnqv4efk5tcmb1pzm7x1qz47eqs.png"><br>  <i>Nivel de depuraci√≥n secreto en The Legend of Zelda: The Wind Waker</i> <br><br>  ElemenTerra tiene muchos niveles: un nivel lleno de geometr√≠a problem√°tica para el personaje de un jugador, niveles con interfaces de usuario especiales que activan ciertos estados del juego y otros. <br><br>  Al igual que las pruebas unitarias, estos niveles de depuraci√≥n se pueden usar para reproducir y diagnosticar errores.  Pero en algunos aspectos difieren: <br><br>  Las pruebas unitarias dividen los sistemas en partes y eval√∫an cada uno individualmente, mientras que los niveles de depuraci√≥n llevan a cabo las pruebas de una manera m√°s integral.  Despu√©s de encontrar el error en el nivel de depuraci√≥n, los desarrolladores a√∫n pueden necesitar buscar manualmente el punto de error. <br>  Las pruebas unitarias son autom√°ticas y cada vez deben dar resultados deterministas, mientras que muchos niveles de depuraci√≥n son "controlados" por el jugador.  Esto hace la diferencia en las sesiones. <br><br>  Pero esto no significa que las pruebas unitarias sean mejores que los niveles de depuraci√≥n.  Estos √∫ltimos son a menudo m√°s pr√°cticos.  Sin embargo, las pruebas unitarias pueden incluso usarse en sistemas donde tradicionalmente no ha estado presente. <br><br><h3>  Bienvenido al infierno del conejo </h3><br>  En ElemenTerra, los jugadores usan las fuerzas m√≠sticas de la naturaleza para salvar a las criaturas afectadas por una tormenta espacial.  Una de esas fuerzas es la capacidad de allanar el camino que lleva a las criaturas a la comida y al refugio.  Dado que estos caminos son cuadr√≠culas din√°micas creadas por los jugadores, el movimiento de la criatura debe lidiar con casos geom√©tricos inusuales y un terreno arbitrariamente complejo. <br><br>  El movimiento del personaje es uno de esos sistemas complejos donde "todo afecta a todo lo dem√°s".  Si alguna vez ha hecho esto, sabe que al escribir c√≥digo nuevo, es muy f√°cil romper la funcionalidad existente.  ¬øNecesitas conejos para escalar peque√±as repisas?  Est√° bien, pero ahora est√°n temblando, subiendo las laderas.  ¬øQuieres que los caminos de lagarto no se crucen?  Funcion√≥, pero ahora su comportamiento t√≠pico est√° arruinado. <br><br>  Como la persona responsable de la IA y la mayor√≠a del c√≥digo de juego, sab√≠a que no ten√≠a tiempo para errores sorpresa.  Quer√≠a notar de inmediato la regresi√≥n, por lo que el desarrollo con TDD me pareci√≥ una buena opci√≥n. <br><br>  El siguiente paso fue la creaci√≥n de un sistema en el que pod√≠a identificar f√°cilmente cada caso de movimiento en forma de una prueba de pasa / falla simulada: <br><br><img src="https://habrastorage.org/webt/tb/uf/8q/tbuf8ql64djoz57rkpjjsbdc-sq.gif"><br><br>  Este "infierno del conejo" consiste en 18 corredores aislados.  Cada uno con una criatura y su propia ruta, dise√±ada para moverse solo si una determinada funci√≥n de movimiento funciona.  Las pruebas se consideran exitosas si el conejo puede moverse durante un tiempo infinitamente largo sin atascarse.  De lo contrario, sin √©xito.  Tenga en cuenta que solo probamos el cuerpo de las criaturas (pe√≥n en t√©rminos irreales), no la inteligencia artificial.  En ElemenTerra, las criaturas pueden comer, dormir y reaccionar ante el mundo, pero en el "infierno del conejo" su √∫nica instrucci√≥n es correr entre dos puntos. <br><br>  Aqu√≠ hay algunos ejemplos de tales pruebas: <br><br><img src="https://habrastorage.org/webt/s3/pb/9u/s3pb9ucpk-ezq2sg8ehnwjmpo5s.gif"><br>  <i>1, 2, 3: movimiento libre, obst√°culos est√°ticos y obst√°culos din√°micos</i> <br><br><img src="https://habrastorage.org/webt/5e/co/jh/5ecojh5plbr-lpajkm3ttqvyfdu.gif"><br>  <i>8 y 9: pendientes uniformes y terreno irregular</i> <br><br><img src="https://habrastorage.org/webt/tl/fp/o0/tlfpo0gylqb4k0vcic6lvnklvp4.gif"><br>  <i>10: piso que desaparece</i> <br><br><img src="https://habrastorage.org/webt/t_/et/pd/t_etpdknaotnaxi0ozma56rosos.gif"><br>  <i>13: Reproducci√≥n de un error en el que las criaturas giraban sin cesar alrededor de objetivos cercanos</i> <br><br><img src="https://habrastorage.org/webt/7w/yf/mu/7wyfmuvpvihnaoljhwuvrttqd7c.gif"><br>  <i>14 y 15: capacidad de navegar por salientes planos y complejos</i> <i><br></i> <br>  Hablemos de las similitudes y diferencias entre mi implementaci√≥n y el TDD "limpio". <br><br>  Mi sistema era similar a TDD en esto: <br><br><ul><li>  Comenc√© a trabajar en funciones creando pruebas, y luego escrib√≠ el c√≥digo necesario para ejecutarlas. </li><li>  Continu√© ejecutando pruebas antiguas, agregando nuevas caracter√≠sticas. </li><li>  Cada prueba midi√≥ exactamente una parte del sistema, lo que me permiti√≥ encontrar problemas r√°pidamente. </li><li>  Las pruebas fueron automatizadas y no requirieron la participaci√≥n del jugador. </li></ul><br>  Y difer√≠a en esto: <br><br><ul><li>  Al evaluar las pruebas, hab√≠a un elemento de subjetividad.  Si bien los errores reales de movimiento (el personaje no pas√≥ de A a B) se pudieron detectar mediante programaci√≥n.  Es decir, por ejemplo, una posici√≥n sesgada, problemas de sincronizaci√≥n de animaci√≥n y movimientos de contracci√≥n requirieron una evaluaci√≥n humana. </li><li>  Las pruebas no fueron completamente deterministas.  Factores aleatorios, como las fluctuaciones en la velocidad de fotogramas, causaron peque√±as desviaciones.  Pero, en general, las criaturas suelen seguir los mismos caminos y tienen el mismo √©xito / fracaso entre sesiones. </li></ul><br><h3>  Limitaciones </h3><br>  Usar TDD para mover una criatura ElemenTerra fue una gran ventaja, pero mi enfoque ten√≠a varias limitaciones: <br><br><ul><li>  Las pruebas unitarias evaluaron cada caracter√≠stica del movimiento individualmente, por lo que no se consideraron los errores con combinaciones de varias caracter√≠sticas.  A veces era necesario complementar las pruebas unitarias con los niveles de depuraci√≥n tradicionales. </li><li>  ElemenTerra tiene cuatro tipos de criaturas, pero las pruebas solo contienen conejos.  Esta es una caracter√≠stica de nuestro programa de producci√≥n (los otros tres tipos se agregaron mucho m√°s tarde en el desarrollo).  Afortunadamente, los cuatro tienen la misma movilidad, pero el gran cuerpo de Mossmork caus√≥ varios problemas.  La pr√≥xima vez, las pruebas generar√≠an din√°micamente las especies seleccionadas en lugar de usar conejos pre-colocados. </li></ul><br><img src="https://habrastorage.org/webt/xo/ua/yq/xouayqg87iiyszdn4tfonai7rou.png"><br>  <i>Este Mossmork requiere un poco m√°s de espacio que un conejo.</i> <br><br><h3>  TDD es tu elecci√≥n? </h3><br>  Los desarrolladores pueden gastar demasiado esfuerzo en niveles de prueba de unidad que el jugador nunca apreciar√°.  No lo niego, yo mismo recib√≠ mucho placer al crear el "infierno del conejo".  Dichas funciones internas pueden llevar mucho tiempo y poner en peligro hitos m√°s importantes.  Para evitar que esto suceda, estudie cuidadosamente d√≥nde y cu√°ndo usar las pruebas unitarias.  A continuaci√≥n, he resaltado varios criterios que justifican la TDD para el movimiento de una criatura ElemenTerra. <br><br>  1. ¬øTomar√° mucho tiempo completar manualmente las tareas de prueba? <br><br>  Antes de dedicar tiempo a las pruebas automatizadas, debe verificar si podemos evaluar la funci√≥n utilizando los controles convencionales del juego.  Si quieres asegurarte de que tus llaves abran las puertas, genera la llave y √°breles la puerta.  Crear pruebas unitarias para esta funci√≥n ser√≠a una p√©rdida de tiempo: las pruebas manuales solo demoran unos segundos. <br><br>  2. ¬øEs dif√≠cil crear casos de prueba manualmente? <br><br>  Las pruebas unitarias automatizadas se justifican cuando hay casos conocidos y dif√≠ciles de reproducir.  La prueba n. ¬∞ 7 del "infierno del conejo" verifica c√≥mo caminan a lo largo de las repisas, algo que la IA generalmente trata de evitar.  Tal situaci√≥n puede ser dif√≠cil o imposible de reproducir usando los controles del juego, y las pruebas son f√°ciles. <br><br>  3. ¬øSabes que los resultados deseados no cambiar√°n? <br><br>  El dise√±o del juego se basa completamente en iteraciones, por lo que los objetivos de las caracter√≠sticas pueden cambiar a medida que cambia el juego.  Incluso peque√±os cambios pueden invalidar las m√©tricas mediante las cuales eval√∫a sus caracter√≠sticas y, por lo tanto, cualquier prueba unitaria.  Si el comportamiento de las criaturas durante la comida, el sue√±o y la interacci√≥n con el jugador cambiaron varias veces, la transici√≥n del punto A al punto B se mantuvo sin cambios.  Por lo tanto, el c√≥digo de movimiento y sus pruebas unitarias siguieron siendo relevantes durante todo el desarrollo. <br><br>  4. ¬øEs probable que las regresiones pasen desapercibidas? <br><br>  ¬øTuviste una situaci√≥n cuando completaste una de las √∫ltimas tareas antes de enviar el juego, y de repente encuentras un error que rompe las reglas?  Y en la funci√≥n que terminaste hace muchos a√±os.  Los juegos son sistemas interconectados gigantescos y, por lo tanto, es natural que agregar una nueva funci√≥n B pueda conducir al fallo de la antigua funci√≥n A. <br><br>  No es tan malo cuando una funci√≥n interrumpida se usa en todas partes (por ejemplo, un salto): inmediatamente debe notar una falla en la mec√°nica.  Los errores descubiertos en un desarrollo posterior pueden interrumpir la programaci√≥n y, despu√©s del lanzamiento, pueden da√±ar el juego. <br><br>  5. ¬øLo peor que puede pasar cuando se usan pruebas y sin ellas? <br><br>  Crear pruebas es una forma de gesti√≥n de riesgos.  Imagine que decide si compra un seguro de veh√≠culo.  Necesita responder tres preguntas: <br><br><ul><li>  ¬øCu√°nto cuestan las primas de seguro mensuales? </li><li>  ¬øQu√© posibilidades hay de que se da√±e el autom√≥vil? </li><li>  ¬øQu√© tan costoso ser√≠a el peor de los casos si no estuviera asegurado? </li></ul><br>  Para TDD, podemos imaginar contribuciones mensuales en forma de costos de producci√≥n para el servicio de nuestras pruebas unitarias, la probabilidad de da√±os al autom√≥vil en forma de probabilidad de un error y el costo de un reemplazo completo del autom√≥vil como el peor de los casos para un error de regresi√≥n. <br><br>  Si lleva mucho tiempo crear una prueba de caracter√≠sticas, es simple y es poco probable que se cambie (o se puede solucionar si se rompe en el desarrollo posterior), entonces las pruebas unitarias pueden causar m√°s problemas que beneficios.  Si las pruebas son f√°ciles de realizar, la funci√≥n es inestable e interconectada (o sus errores tomar√°n mucho tiempo), entonces las pruebas ayudar√°n. <br><br><h3>  L√≠mites de automatizaci√≥n </h3><br>  Las pruebas unitarias pueden ser una gran adici√≥n para encontrar y eliminar errores, pero no reemplazan la necesidad de un control de calidad profesional en juegos a gran escala.  QA es un arte que requiere creatividad, juicio subjetivo y excelente comunicaci√≥n t√©cnica. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/455076/">https://habr.com/ru/post/455076/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../455062/index.html">Casos de experimentos exitosos (y no tan) de Yandex.Navigator</a></li>
<li><a href="../455064/index.html">Talento vs. Suerte: el papel del azar en el √©xito y el fracaso</a></li>
<li><a href="../455066/index.html">An√°lisis del sistema MeetUp UPD2 Broadcast y presentaciones</a></li>
<li><a href="../455070/index.html">¬øPor qu√© las entrevistas son tan frecuentes sobre las listas vinculadas?</a></li>
<li><a href="../455072/index.html">Toda la verdad sobre RTOS. Art√≠culo # 28. Temporizadores de software</a></li>
<li><a href="../455078/index.html">D√≥nde hablar sobre Apache Ignite y los sistemas distribuidos en verano</a></li>
<li><a href="../455082/index.html">Estudiamos MITRE ATT & CK. Matrices m√≥viles: acceso a dispositivos. Parte 4</a></li>
<li><a href="../455088/index.html">¬øQu√© prueban las entrevistas y los elementos de prueba?</a></li>
<li><a href="../455094/index.html">C√≥mo proteger 5G en una ciudad inteligente: aplique una nueva arquitectura de seguridad</a></li>
<li><a href="../455096/index.html">Pruebas de competencias con pruebas: por qu√© y c√≥mo</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>