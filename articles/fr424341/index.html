<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üö± ü§∑üèª ü§πüèø Orme. Confortable et maladroit. La composition üõÑ üë®‚Äçüë©‚Äçüëß‚Äçüëß üì†</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Nous continuons de parler de l' orme 0,18 . 


 Orme. Confortable et maladroit 
 Orme. Confortable et maladroit. Json.Encoder et Json.Decoder 
 Orme. ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Orme. Confortable et maladroit. La composition</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/424341/"><p>  Nous continuons de parler de l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">orme 0,18</a> . </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Orme.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Confortable et maladroit</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Orme.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Confortable et maladroit.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Json.Encoder et Json.Decoder</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Orme.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Confortable et maladroit.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Http, Task</a> </p><br><p>  Dans cet article, nous examinerons les probl√®mes d'architecture d'application Elm et les options possibles pour impl√©menter l'approche de d√©veloppement des composants. </p><br><p>  En tant que t√¢che, envisagez la mise en ≈ìuvre d'une fen√™tre d√©roulante qui permet √† un utilisateur enregistr√© d'ajouter une question.  Dans le cas d'un utilisateur anonyme, il sugg√®re d'abord de se connecter ou de s'inscrire. </p><a name="habracut"></a><br><p>  Nous supposons √©galement que par la suite il peut √™tre n√©cessaire de mettre en ≈ìuvre la r√©ception d'autres types de contenu utilisateur, mais la logique de travailler avec des utilisateurs autoris√©s et anonymes restera la m√™me. </p><br><h2 id="nelovkaya-kompoziciya">  Composition maladroite </h2><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Le code source d'une impl√©mentation na√Øve</a> .  Dans le cadre de cette impl√©mentation, nous allons tout stocker dans un mod√®le. </p><br><p>  Toutes les donn√©es n√©cessaires pour l'autorisation et l'interrogation des utilisateurs sont au m√™me niveau dans le mod√®le.  La m√™me situation avec les messages (Msg). </p><br><pre><code class="hljs vbscript">type alias Model = { user: User , ui: Maybe Ui -- Popup <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> open <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> value equals <span class="hljs-literal"><span class="hljs-literal">Nothing</span></span> , login: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span> , password: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span> , question: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span> , message: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span> } type Msg = OpenPopup | LoginTyped <span class="hljs-built_in"><span class="hljs-built_in">String</span></span> | PasswordTyped <span class="hljs-built_in"><span class="hljs-built_in">String</span></span> | Login | QuestionTyped <span class="hljs-built_in"><span class="hljs-built_in">String</span></span> | SendQuestion</code> </pre> <br><p>  Le type d'interface est d√©crit comme le type d'union Ui, qui est utilis√© avec le type Maybe. </p><br><pre> <code class="hljs scala"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Ui</span></span></span><span class="hljs-class"> </span></span>= <span class="hljs-type"><span class="hljs-type">LoginUi</span></span> -- <span class="hljs-type"><span class="hljs-type">Popup</span></span> shown <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> authentication form | <span class="hljs-type"><span class="hljs-type">QuestionUi</span></span> -- <span class="hljs-type"><span class="hljs-type">Popup</span></span> shown <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> textarea to leave user question</code> </pre> <br><p>  Ainsi, ui = Nothing d√©crit l'absence de fen√™tre contextuelle et la fen√™tre contextuelle Just est ouverte avec une interface sp√©cifique. <br></p><p>  Dans la fonction de mise √† jour, la paire est appari√©e, le message et les donn√©es utilisateur.  Diff√©rentes actions sont effectu√©es en fonction de cette paire. </p><br><pre> <code class="hljs sql"><span class="hljs-keyword"><span class="hljs-keyword">update</span></span> : Msg -&gt; <span class="hljs-keyword"><span class="hljs-keyword">Model</span></span> -&gt; ( <span class="hljs-keyword"><span class="hljs-keyword">Model</span></span>, Cmd Msg ) <span class="hljs-keyword"><span class="hljs-keyword">update</span></span> msg <span class="hljs-keyword"><span class="hljs-keyword">model</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> (msg, model.user) <span class="hljs-keyword"><span class="hljs-keyword">of</span></span></code> </pre> <br><p>  Par exemple, lorsque vous cliquez sur le bouton ¬´Ouvrir une popup¬ª, un message OpenPopup est g√©n√©r√©.  Le message OpenPopup dans la fonction de mise √† jour est g√©r√© de diff√©rentes mani√®res.  Pour un utilisateur anonyme, un formulaire d'autorisation est g√©n√©r√©, et pour un utilisateur autoris√©, un formulaire dans lequel vous pouvez laisser une question. </p><br><pre> <code class="hljs sql"><span class="hljs-keyword"><span class="hljs-keyword">update</span></span> : Msg -&gt; <span class="hljs-keyword"><span class="hljs-keyword">Model</span></span> -&gt; ( <span class="hljs-keyword"><span class="hljs-keyword">Model</span></span>, Cmd Msg ) <span class="hljs-keyword"><span class="hljs-keyword">update</span></span> msg <span class="hljs-keyword"><span class="hljs-keyword">model</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> (msg, model.user) <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-comment"><span class="hljs-comment">-- Anonymous user message handling section (OpenPopup, Anonymous) -&gt; ( { model | ui = Just LoginUi, message = "" }, Cmd.none) -- Authenticated user message handling section (OpenPopup, User userName) -&gt; ( { model | ui = Just QuestionUi, message = "" }, Cmd.none)</span></span></code> </pre> <br><p>  De toute √©vidence, cette approche peut avoir des probl√®mes avec la croissance des fonctions d'application: </p><br><ol><li>  Il n'y a pas de regroupement de donn√©es dans le mod√®le et les messages.  Tout se trouve dans un seul avion.  Ainsi, il n'y a pas de limites de composants, un changement dans la logique d'une partie affectera tr√®s probablement le reste; </li><li>  la r√©utilisation du code est possible sur le principe du copier-coller avec toutes les cons√©quences qui en d√©coulent. </li></ol><br><h2 id="udobnaya-kompoziciya">  Composition pratique </h2><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Le code source est une impl√©mentation pratique</a> .  Dans le cadre de cette impl√©mentation, nous essaierons de diviser le projet en composants ind√©pendants.  D√©pendances autoris√©es entre les composants. </p><br><p>  Structure du projet: </p><br><ol><li>  dans le dossier Type, les types personnalis√©s sont d√©clar√©s; </li><li>  les composants personnalis√©s sont d√©clar√©s dans le dossier Component; </li><li>  Point d'entr√©e du projet de fichier Main.elm; </li><li>  Les fichiers login.json et questions.json sont utilis√©s comme donn√©es de test pour la r√©ponse du serveur √† l'autorisation et l'enregistrement d'informations sur la question, respectivement. </li></ol><br><h1 id="polzovatelskie-komponenty">  Composants personnalis√©s </h1><br><p>  Chaque composant, bas√© sur l'architecture du langage, doit contenir: </p><br><ol><li>  Mod√®le </li><li>  Messages (Msg) </li><li>  r√©sultat de l'ex√©cution (retour); </li><li>  fonction d'initialisation (init); </li><li>  fonction de mutation (mise √† jour); </li><li>  fonction d'affichage. </li></ol><br><p>  Chaque composant peut contenir un abonnement si n√©cessaire. </p><br><p><img src="https://habrastorage.org/webt/rh/xg/0q/rhxg0qxlorqpoiyv-sljcbmec68.jpeg" alt="image"><br>  Fig.  1. Diagramme d'activit√© des composants </p><br><h1 id="inicializaciya">  Initialisation </h1><br><p>  Chaque composant doit √™tre d√©clench√©, c'est-√†-dire  doit √™tre re√ßu: </p><br><ol><li>  mod√®le </li><li>  La commande ou la liste des commandes qui doivent initialiser l'√©tat du composant </li><li>  r√©sultat d'ex√©cution.  Le r√©sultat de l'ex√©cution au moment de l'initialisation peut √™tre n√©cessaire pour valider l'autorisation utilisateur, comme dans les exemples de cet article. </li></ol><br><p>  La liste des arguments de la fonction d'initialisation (init) d√©pend de la logique du composant et peut √™tre arbitraire.  Il peut y avoir plusieurs fonctions d'initialisation.  Supposons, pour un composant d'autorisation, deux options d'initialisation peuvent √™tre fournies: avec un jeton de session et avec les donn√©es utilisateur. </p><br><p>  Le code qui utilise le composant, apr√®s l'initialisation, doit transmettre des commandes √† elm runtime √† l'aide de la fonction <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Cmd.map</a> . </p><br><h2 id="mutaciya">  Mutation </h2><br><p>  La fonction de mise √† jour du composant doit √™tre appel√©e pour chaque message de composant.  √Ä la suite de l'ex√©cution, la fonction renvoie un triple: </p><br><ol><li>  nouveau mod√®le ou nouvel √©tat (mod√®le); </li><li>  commande ou liste de commandes pour Elm runtime (Cmd Msg).  Les commandes peuvent √™tre des commandes pour ex√©cuter des requ√™tes HTTP, interagir avec des ports, etc. </li><li>  r√©sultat de l'ex√©cution (peut-√™tre retourner).  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Peut-√™tre que le</a> type a deux √©tats Nothing et Just a.  Dans notre cas, rien - il n'y a pas de r√©sultat, juste un - il y a un r√©sultat.  Par exemple, pour l'autorisation, le r√©sultat peut √™tre Just (Authentified UserData) - l'utilisateur est connect√© avec les donn√©es UserData. </li></ol><br><p>  Apr√®s la mutation, le code utilisant le composant doit mettre √† jour le mod√®le du composant et passer des commandes √† l'ex√©cution Elm √† l'aide de la fonction <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Cmd.map</a> . </p><br><p>  Arguments requis pour la fonction de mise √† jour, selon l'architecture de l'application Elm: </p><br><ol><li>  Message (Msg) </li><li>  mod√®le (mod√®le). </li></ol><br><p>  Si n√©cessaire, la liste des arguments peut √™tre compl√©t√©e. </p><br><h1 id="predstavlenie">  Soumission </h1><br><p>  La fonction de vue est appel√©e lorsqu'il est n√©cessaire d'ins√©rer la vue des composants dans la vue g√©n√©rale de l'application. </p><br><p>  L'argument requis de la fonction de vue doit √™tre le mod√®le de composant.  Si n√©cessaire, la liste des arguments peut √™tre compl√©t√©e. </p><br><p>  Le r√©sultat de l'ex√©cution de la fonction d'affichage doit √™tre transmis √† la fonction <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Html.map</a> . </p><br><h1 id="integraciya-v-prilozhenie">  Int√©gration d'applications </h1><br><p>  L' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">exemple</a> d√©crit deux composants: <a href="">Auth</a> et <a href="">Question</a> .  Composantes des principes d√©crits ci-dessus.  Consid√©rez comment ils peuvent √™tre int√©gr√©s dans l' <a href="">application</a> . </p><br><p>  Tout d'abord, d√©terminons comment notre application devrait fonctionner.  Il y a un bouton sur l'√©cran, lorsque vous cliquez dessus: </p><br><ol><li>  pour un utilisateur non autoris√©, un formulaire d'autorisation s'affiche, apr√®s autorisation - un formulaire de publication de questions; </li><li>  Pour un utilisateur autoris√©, un formulaire de placement de question s'affiche. </li></ol><br><p>  Pour d√©crire l'application dont vous avez besoin: </p><br><ol><li>  Mod√®le </li><li>  Messages (Msg) </li><li>  point de d√©part de l'application (principal); </li><li>  fonction d'initialisation (init); </li><li>  fonction de mutation; </li><li>  fonction de pr√©sentation; </li><li>  fonction d'abonnement. </li></ol><br><h1 id="model">  Mod√®le </h1><br><pre> <code class="hljs haskell"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> alias </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Model</span></span></span><span class="hljs-class"> = { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">user</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">User</span></span></span><span class="hljs-class"> , </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ui</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Maybe</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Ui</span></span></span><span class="hljs-class"> } </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Ui</span></span></span><span class="hljs-class"> = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">AuthUi</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Component</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Auth</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Model</span></span></span><span class="hljs-class"> | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">QuestionUi</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Component</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Question</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Model</span></span></span></span></code> </pre> <br><p>  Le mod√®le contient des informations sur l'utilisateur (utilisateur) et le type de l'interface actuelle (ui).  L'interface peut √™tre dans l'√©tat par d√©faut (Nothing) ou l'un des composants Just a. </p><br><p>  Pour d√©crire les composants, nous utilisons le type Ui, qui associe (balise) chaque mod√®le de composant √† une variante sp√©cifique d'un ensemble de types.  Par exemple, une balise AuthUi associe un mod√®le d'autorisation (Component.Auth.Model) √† un mod√®le d'application. </p><br><h1 id="soobscheniya">  Des messages </h1><br><pre> <code class="hljs vhdl"><span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Msg = OpenPopup | AuthMsg <span class="hljs-keyword"><span class="hljs-keyword">Component</span></span>.Auth.Msg | QuestionMsg <span class="hljs-keyword"><span class="hljs-keyword">Component</span></span>.Question.Msg</code> </pre> <br><p>  Dans les messages, vous devez baliser tous les messages des composants et les inclure dans les messages de l'application.  Les balises AuthMsg et QuestionMsg lient respectivement les messages du composant d'autorisation et la question de l'utilisateur. </p><br><p>  Un message OpenPopup est n√©cessaire pour traiter une demande d'ouverture d'une interface. </p><br><h1 id="funkciya-main">  Fonction principale </h1><br><pre> <code class="hljs pgsql">main : Program Never Model Msg main = Html.program { init = init , <span class="hljs-keyword"><span class="hljs-keyword">update</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">update</span></span> , subscriptions = subscriptions , <span class="hljs-keyword"><span class="hljs-keyword">view</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">view</span></span> }</code> </pre> <br><p>  Le point d'entr√©e de l'application est g√©n√©ralement d√©crit pour une application Elm. </p><br><h1 id="funkciya-inicializacii">  Fonction d'initialisation </h1><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">init</span></span> : ( <span class="hljs-type"><span class="hljs-type">Model</span></span>, <span class="hljs-type"><span class="hljs-type">Cmd</span></span> <span class="hljs-type"><span class="hljs-type">Msg</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">init</span></span> = ( initModel, <span class="hljs-type"><span class="hljs-type">Cmd</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">none</span></span> ) initModel : <span class="hljs-type"><span class="hljs-type">Model</span></span> initModel = { user = <span class="hljs-type"><span class="hljs-type">Anonymous</span></span> , ui = <span class="hljs-type"><span class="hljs-type">Nothing</span></span> }</code> </pre> <br><p>  La fonction d'initialisation cr√©e un mod√®le de d√©part et ne n√©cessite pas l'ex√©cution de commandes. </p><br><h1 id="funkciya-mutacii">  Fonction de mutation </h1><br><div class="spoiler">  <b class="spoiler_title">Code source de la fonction</b> <div class="spoiler_text"><pre> <code class="hljs sql"><span class="hljs-keyword"><span class="hljs-keyword">update</span></span> : Msg -&gt; <span class="hljs-keyword"><span class="hljs-keyword">Model</span></span> -&gt; ( <span class="hljs-keyword"><span class="hljs-keyword">Model</span></span>, Cmd Msg ) <span class="hljs-keyword"><span class="hljs-keyword">update</span></span> msg <span class="hljs-keyword"><span class="hljs-keyword">model</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> (msg, model.ui) <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> (OpenPopup, <span class="hljs-keyword"><span class="hljs-keyword">Nothing</span></span>) -&gt; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Component.Auth.init model.user <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> (authModel, commands, Just (Component.Auth.Authenticated userData)) -&gt; let (questionModel, questionCommands, _) = Component.Question.init userData <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> ( { <span class="hljs-keyword"><span class="hljs-keyword">model</span></span> | ui = Just &lt;| QuestionUi questionModel, <span class="hljs-keyword"><span class="hljs-keyword">user</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">User</span></span> userData }, Cmd.batch [Cmd.map AuthMsg commands, Cmd.map QuestionMsg questionCommands] ) (authModel, commands, _) -&gt; ( { <span class="hljs-keyword"><span class="hljs-keyword">model</span></span> | ui = Just &lt;| AuthUi authModel }, Cmd.map AuthMsg commands ) (AuthMsg authMsg, Just (AuthUi authModel)) -&gt; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Component.Auth.update authMsg authModel <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> (_, commands, Just (Component.Auth.Authenticated userData)) -&gt; let (questionModel, questionCommands, _) = Component.Question.init userData <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> ( { <span class="hljs-keyword"><span class="hljs-keyword">model</span></span> | ui = Just &lt;| QuestionUi questionModel, <span class="hljs-keyword"><span class="hljs-keyword">user</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">User</span></span> userData }, Cmd.batch [Cmd.map AuthMsg commands, Cmd.map QuestionMsg questionCommands] ) (newAuthModel, commands, _) -&gt; ( { <span class="hljs-keyword"><span class="hljs-keyword">model</span></span> | ui = Just &lt;| AuthUi newAuthModel }, Cmd.map AuthMsg commands ) (QuestionMsg questionMsg, Just (QuestionUi questionModel)) -&gt; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Component.Question.update questionMsg questionModel <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> (_, commands, Just (Component.Question.Saved <span class="hljs-built_in"><span class="hljs-built_in">record</span></span>)) -&gt; ( { <span class="hljs-keyword"><span class="hljs-keyword">model</span></span> | ui = <span class="hljs-keyword"><span class="hljs-keyword">Nothing</span></span> }, Cmd.map QuestionMsg commands ) (newQuestionModel, commands, _) -&gt; ( { <span class="hljs-keyword"><span class="hljs-keyword">model</span></span> | ui = Just &lt;| QuestionUi newQuestionModel }, Cmd.map QuestionMsg commands ) _ -&gt; ( <span class="hljs-keyword"><span class="hljs-keyword">model</span></span>, Cmd.none )</code> </pre> </div></div><br><p>  Parce que  le mod√®le et les messages de l'application sont connect√©s, nous traiterons quelques messages (Msg) et le type d'interface (model.ui: Ui). </p><br><pre> <code class="hljs sql"><span class="hljs-keyword"><span class="hljs-keyword">update</span></span> : Msg -&gt; <span class="hljs-keyword"><span class="hljs-keyword">Model</span></span> -&gt; ( <span class="hljs-keyword"><span class="hljs-keyword">Model</span></span>, Cmd Msg ) <span class="hljs-keyword"><span class="hljs-keyword">update</span></span> msg <span class="hljs-keyword"><span class="hljs-keyword">model</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> (msg, model.ui) <span class="hljs-keyword"><span class="hljs-keyword">of</span></span></code> </pre> <br><h1 id="logika-raboty">  Logique de travail </h1><br><p>  Si un message OpenPopup est re√ßu et que l'interface par d√©faut est sp√©cifi√©e dans le mod√®le (model.ui = Nothing), nous initialisons le composant Auth.  Si le composant Auth signale que l'utilisateur est autoris√©, nous initialisons le composant Question et l'enregistrons dans le mod√®le d'application.  Sinon, nous enregistrons le mod√®le de composant dans le mod√®le d'application. </p><br><pre> <code class="hljs swift">(<span class="hljs-type"><span class="hljs-type">OpenPopup</span></span>, <span class="hljs-type"><span class="hljs-type">Nothing</span></span>) -&gt; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-type"><span class="hljs-type">Component</span></span>.<span class="hljs-type"><span class="hljs-type">Auth</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">init</span></span> model.user of (authModel, commands, <span class="hljs-type"><span class="hljs-type">Just</span></span> (<span class="hljs-type"><span class="hljs-type">Component</span></span>.<span class="hljs-type"><span class="hljs-type">Auth</span></span>.<span class="hljs-type"><span class="hljs-type">Authenticated</span></span> userData)) -&gt; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> (questionModel, questionCommands, <span class="hljs-number"><span class="hljs-number">_</span></span>) = <span class="hljs-type"><span class="hljs-type">Component</span></span>.<span class="hljs-type"><span class="hljs-type">Question</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">init</span></span> userData <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> ( { model | ui = <span class="hljs-type"><span class="hljs-type">Just</span></span> &lt;| <span class="hljs-type"><span class="hljs-type">QuestionUi</span></span> questionModel, user = <span class="hljs-type"><span class="hljs-type">User</span></span> userData }, <span class="hljs-type"><span class="hljs-type">Cmd</span></span>.batch [<span class="hljs-type"><span class="hljs-type">Cmd</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">map</span></span> <span class="hljs-type"><span class="hljs-type">AuthMsg</span></span> commands, <span class="hljs-type"><span class="hljs-type">Cmd</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">map</span></span> <span class="hljs-type"><span class="hljs-type">QuestionMsg</span></span> questionCommands] ) (authModel, commands, <span class="hljs-number"><span class="hljs-number">_</span></span>) -&gt; ( { model | ui = <span class="hljs-type"><span class="hljs-type">Just</span></span> &lt;| <span class="hljs-type"><span class="hljs-type">AuthUi</span></span> authModel }, <span class="hljs-type"><span class="hljs-type">Cmd</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">map</span></span> <span class="hljs-type"><span class="hljs-type">AuthMsg</span></span> commands )</code> </pre> <br><p>  Si un message avec la balise AuthMsg est re√ßu et que l'interface d'autorisation est sp√©cifi√©e dans le mod√®le (model.ui = Just (AuthUi authModel)), nous transmettons le message de composant et le mod√®le de composant √† la fonction Auth.update.  En cons√©quence, nous obtenons un nouveau mod√®le de composant, des commandes et un r√©sultat. </p><br><p>  Si l'utilisateur est autoris√©, nous initialisons le composant Question, sinon nous mettons √† jour les donn√©es d'interface dans le mod√®le d'application. </p><br><pre> <code class="hljs powershell">(AuthMsg authMsg, Just (AuthUi authModel)) -&gt; case Component.Auth.update authMsg authModel of (_, commands, Just (Component.Auth.Authenticated userData)) -&gt; let (questionModel, questionCommands, _) = Component.Question.init userData <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> ( { model | ui = Just &lt;| QuestionUi questionModel, user = User userData }, Cmd.batch [<span class="hljs-type"><span class="hljs-type">Cmd.map</span></span> <span class="hljs-type"><span class="hljs-type">AuthMsg</span></span> <span class="hljs-type"><span class="hljs-type">commands</span></span>, <span class="hljs-type"><span class="hljs-type">Cmd.map</span></span> <span class="hljs-type"><span class="hljs-type">QuestionMsg</span></span> <span class="hljs-type"><span class="hljs-type">questionCommands</span></span>] ) (newAuthModel, commands, _) -&gt; ( { model | ui = Just &lt;| AuthUi newAuthModel }, Cmd.map AuthMsg commands )</code> </pre> <br><p>  Comme pour le composant Auth, les messages du composant Question sont trait√©s.  Si la question est publi√©e avec succ√®s, l'interface passe √† la valeur par d√©faut (model.ui = Nothing). </p><br><pre> <code class="hljs pgsql">(QuestionMsg questionMsg, Just (QuestionUi questionModel)) -&gt; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Component.Question.<span class="hljs-keyword"><span class="hljs-keyword">update</span></span> questionMsg questionModel <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> (_, commands, Just (Component.Question.Saved <span class="hljs-type"><span class="hljs-type">record</span></span>)) -&gt; ( { model | ui = <span class="hljs-keyword"><span class="hljs-keyword">Nothing</span></span> }, Cmd.map QuestionMsg commands ) (newQuestionModel, commands, _) -&gt; ( { model | ui = Just &lt;| QuestionUi newQuestionModel }, Cmd.map QuestionMsg commands )</code> </pre> <br><p>  Tous les autres cas sont ignor√©s. </p><br><pre> <code class="hljs lisp"> _ -&gt; ( <span class="hljs-name"><span class="hljs-name">model</span></span>, Cmd.none )</code> </pre> <br><h1 id="funkciya-predstavleniya">  Fonction d'affichage </h1><br><pre> <code class="hljs powershell">view : Model -&gt; Html Msg view model = case model.ui of Nothing -&gt; div <span class="hljs-function"><span class="hljs-function">[] [ </span><span class="hljs-type"><span class="hljs-function"><span class="hljs-type">div</span></span></span><span class="hljs-function"> [] [ </span><span class="hljs-type"><span class="hljs-function"><span class="hljs-type">button</span></span></span><span class="hljs-function"> [ </span><span class="hljs-type"><span class="hljs-function"><span class="hljs-type">Events.onClick</span></span></span><span class="hljs-function"> </span><span class="hljs-type"><span class="hljs-function"><span class="hljs-type">OpenPopup</span></span></span><span class="hljs-function"> ] [ </span><span class="hljs-type"><span class="hljs-function"><span class="hljs-type">text</span></span></span><span class="hljs-function"> </span><span class="hljs-string"><span class="hljs-function"><span class="hljs-string">"Open popup"</span></span></span><span class="hljs-function"> ] ] ] </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Just</span></span></span></span> (AuthUi authModel) -&gt; Component.Auth.view authModel |&gt; Html.map AuthMsg Just (QuestionUi questionModel) -&gt; Component.Question.view questionModel |&gt; Html.map QuestionMsg</code> </pre> <br><p>  Selon le type d'interface (model.ui), la fonction de pr√©sentation g√©n√®re une interface par d√©faut ou appelle la fonction de pr√©sentation du composant et mappe le type de message du composant au type de message d'application (Html.map). </p><br><h1 id="funkciya-podpiski">  Fonction d'abonnement </h1><br><pre> <code class="hljs vbscript">subscriptions : Model -&gt; <span class="hljs-keyword"><span class="hljs-keyword">Sub</span></span> Msg subscriptions model = <span class="hljs-keyword"><span class="hljs-keyword">Sub</span></span>.none</code> </pre> <br><p>  Pas d'abonnement. </p><br><h1 id="dalee">  Suivant </h1><br><p>  Cet exemple, bien qu'un peu plus pratique, mais assez na√Øf.  Ce qui manque: </p><br><ol><li>  bloquer l'interaction avec l'application pendant le processus de t√©l√©chargement; </li><li>  validation des donn√©es.  N√©cessite une conversation s√©par√©e; </li><li>  fen√™tre vraiment pop-up avec la possibilit√© de fermer. </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr424341/">https://habr.com/ru/post/fr424341/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr424331/index.html">Kubernetes 1.12: un aper√ßu des principales innovations</a></li>
<li><a href="../fr424333/index.html">Mon exp√©rience de rencontres et de travail avec Robot Framework</a></li>
<li><a href="../fr424335/index.html">Que la lumi√®re soit</a></li>
<li><a href="../fr424337/index.html">Code de style Ruby: avec comp√©tence, beaut√© et efficacit√©. Exemple pour les d√©butants</a></li>
<li><a href="../fr424339/index.html">Tandem de l'auteur et expert: comment le rendre efficace?</a></li>
<li><a href="../fr424343/index.html">Droits de collaboration et d'acc√®s dans DentalTap</a></li>
<li><a href="../fr424345/index.html">Comment j'ai √©tudi√© la science des donn√©es</a></li>
<li><a href="../fr424349/index.html">"Calendrier des testeurs" pour septembre. Optimiser les tests</a></li>
<li><a href="../fr424353/index.html">Contexte: le moteur de recherche Internet d'√âtat Spoutnik et son histoire complexe</a></li>
<li><a href="../fr424355/index.html">Moulage par injection: comment √ßa marche</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>