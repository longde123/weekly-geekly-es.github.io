<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü•¢ üë©‚Äçüíº üòì Cartera de manzana Qu√© es y c√≥mo integrar su tarjeta en ella üë®üèº‚Äçüè´ ü¶ç üç∂</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En general, se acepta que Wallet no es el servicio m√°s popular en la CEI. Pero ya en el segundo proyecto consecutivo, el cliente establece la tarea "R...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Cartera de manzana Qu√© es y c√≥mo integrar su tarjeta en ella</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/agima/blog/428437/"><p>  En general, se acepta que Wallet no es el servicio m√°s popular en la CEI.  Pero ya en el segundo proyecto consecutivo, el cliente establece la tarea "Realizar integraci√≥n con Wallet".  Por lo tanto, decid√≠ escribir este art√≠culo para hablar sobre el servicio en su conjunto y mostrar c√≥mo integrar mi producto en √©l. </p><br><p>  ¬øQu√© es una billetera?  Le permite mantener varios tipos de tarjetas en su tel√©fono (boletos, tarjetas de descuento, etc.), facilitando la vida de los usuarios del producto.  Adem√°s, es posible actualizar la informaci√≥n sobre el mapa a trav√©s de notificaciones push, pero este es un tema para un art√≠culo separado.  Pero si tiene una tarjeta / boleto / suscripci√≥n que se puede integrar en el tel√©fono, ¬°entonces hay una soluci√≥n!  C√≥mo hacerlo: lea a continuaci√≥n. </p><a name="habracut"></a><br><p> Como regla general, su servidor es responsable de crear el mapa.  La aplicaci√≥n recibe la tarjeta en forma de archivo .pkpass y, a trav√©s de la aplicaci√≥n, el usuario puede agregar la tarjeta a Wallet. </p><br><h2 id="struktura-karty">  Estructura del mapa </h2><br><p>  ¬øCu√°l es el mapa desde el punto de vista del desarrollador?  Un mapa es un archivo con la extensi√≥n .pkpass.  Contiene todos los datos necesarios para la visualizaci√≥n y el funcionamiento de la tarjeta.  El contenido del archivo est√° en la tabla a continuaci√≥n. </p><br><table><tbody><tr><th>  Archivo </th><th>  Cita </th></tr><tr><td>  background.png </td><td>  Imagen de fondo para la tarjeta. </td></tr><tr><td>  footer.png </td><td>  Imagen al lado del c√≥digo de barras </td></tr><tr><td>  icon.png </td><td>  √çcono para notificaciones y cartas </td></tr><tr><td>  logo.png </td><td>  Logotipo de la tarjeta  Se muestra arriba a la izquierda </td></tr><tr><td>  manifest.json </td><td>  Registro de todos los archivos incluidos. </td></tr><tr><td>  firma </td><td>  PKCS7 firma </td></tr><tr><td>  pass.json </td><td>  Apariencia e informaci√≥n del mapa </td></tr><tr><td>  strip.png </td><td>  Imagen ubicada detr√°s de la descripci√≥n principal de la tarjeta </td></tr><tr><td>  thumbnail.png </td><td>  Imagen adicional (especificar) </td></tr></tbody></table><br><p>  Los siguientes tipos de tarjetas est√°n disponibles: </p><br><ul><li>  <b>Boleto de embarque:</b> en avi√≥n o tren.  Por lo general, el cup√≥n funciona para un viaje; </li><li>  <b>Cup√≥n:</b> para cupones y ofertas especiales; </li><li>  <b>Boleto de evento:</b> puede funcionar tanto para un evento como para una temporada completa; </li><li>  <b>Tarjeta de descuento:</b> tarjetas de fidelidad, tarjetas de descuento o regalo; </li><li>  <b>Tarjeta de vista general:</b> si nada de lo anterior se aplica a su caso: por ejemplo, una tarjeta para viajar en metro o un pase al gimnasio. </li></ul><br><p>  Considere esquem√°ticamente la apariencia de diferentes cartas.  Las im√°genes se nombran mejor como se indica en la tabla anterior. </p><br><h3>  Tarjeta de embarque </h3><br><img src="https://habrastorage.org/webt/8m/s6/cy/8ms6cyz55rve1igxt_xfv2e034i.png"><br><h3>  Cup√≥n </h3><br><img src="https://habrastorage.org/webt/-r/l-/dk/-rl-dknkbsqnkuim5-kqog6ceuu.png"><br><h3>  Ticket de evento </h3><br><img src="https://habrastorage.org/webt/rr/r9/jh/rrr9jh2ho29rfmht7xrf0z7pmes.png"><br><h3>  Tarjeta comunitaria </h3><br><img src="https://habrastorage.org/webt/az/zc/hg/azzchgo25cvpj_gcu_oof1vh1k8.png"><br><h3>  Tarjeta de descuento </h3><br><img src="https://habrastorage.org/webt/zl/zt/ft/zlztft7igalmerx8rhabnxorwfc.png"><br><h1 id="struktura-passjson">  Estructura Pass.json </h1><br><p>  Campos obligatorios  Contiene ID de tipo de pase, ID de equipo, nombre de la organizaci√≥n, etc. <br>  Claves para aplicaciones relacionadas.  Necesario para mostrar aplicaciones que necesitan estar "asociadas" con el mapa. <br>  Claves de tarjetas de "fecha de caducidad". <br>  Claves de relevancia.  Por ejemplo, las coordenadas del √°rea donde se puede usar el mapa, o el inicio del evento para el que est√° destinado. <br>  La clave es el estilo.  Al comienzo del art√≠culo, se enumeraron 5 tipos de tarjetas para Wallet.  Cada uno de ellos tiene su propio estilo.  Tal clave debe ser estrictamente una. <br>  Claves para el dise√±o visual de la tarjeta.  Adem√°s de lo obvio, contienen informaci√≥n sobre el c√≥digo de barras que se muestra en el mapa. <br>  Claves de servicio web.  Puede utilizar los servicios web para interactuar con el mapa, por ejemplo, actualizarlo autom√°ticamente. <br>  Llaves NFC  Contiene informaci√≥n adicional para las transacciones de Apple Pay. </p><br><p>  Ahora sobre todo con m√°s detalle. </p><br><h2>  Campos obligatorios </h2><br><table><tbody><tr><th>  <nobr>Clave en JSON</nobr> </th><th>  <nobr>Tipo de datos</nobr> </th><th>  <nobr>Descripci√≥n</nobr> </th></tr><tr><td>  descripci√≥n </td><td>  Cadena <br>  Localizado </td><td>  Una breve descripci√≥n del mapa.  Localizado </td></tr><tr><td>  formatVersion </td><td>  Int </td><td>  Versi√≥n de formato de archivo.  El valor debe ser 1. </td></tr><tr><td>  <nobr>organizationName</nobr> </td><td>  Cadena <br>  Localizado </td><td>  El nombre de la organizaci√≥n que emite las tarjetas. </td></tr><tr><td>  <nobr>passTypeIdentifier</nobr> </td><td>  Cadena </td><td>  Pase ID de tipo y cuenta de desarrollador. </td></tr><tr><td>  <nobr>serialNumber</nobr> </td><td>  Cadena </td><td>  N√∫mero de serie de tarjeta √∫nica </td></tr><tr><td>  <nobr>teamIdentifier</nobr> </td><td>  Cadena </td><td>  ID del equipo del equipo de desarrollo </td></tr></tbody></table><br><h2>  Claves para aplicaciones relacionadas </h2><br><table><tbody><tr><th>  <nobr>Clave en JSON</nobr> </th><th>  <nobr>Tipo de datos</nobr> </th><th>  <nobr>Descripci√≥n</nobr> </th></tr><tr><td>  <nobr>AssociatedStoreIdentifiers</nobr> </td><td>  [Int] </td><td>  Opcionalmente  El ID de las aplicaciones asociadas con la tarjeta.  Siempre se toma el primero que es compatible con el dispositivo actual. </td></tr><tr><td>  <nobr>appLaunchURL</nobr> </td><td>  Cadena </td><td>  URL que se pasa a la aplicaci√≥n al abrir </td></tr></tbody></table><br><h2>  Teclas de estilo </h2><br><table><tbody><tr><th>  <nobr>Clave en JSON</nobr> </th><th>  <nobr>Tipo de datos</nobr> </th><th>  <nobr>Descripci√≥n</nobr> </th></tr><tr><td>  <nobr>campos primarios</nobr> </td><td>  [JSON] </td><td>  Informaci√≥n b√°sica sobre el mapa. </td></tr><tr><td>  <nobr>campos secundarios</nobr> </td><td>  [JSON] </td><td>  Informaci√≥n de antecedentes. </td></tr><tr><td>  <nobr>Campos auxiliares</nobr> </td><td>  [JSON] </td><td>  Campos para informaci√≥n adicional.  Opcional </td></tr><tr><td>  <nobr>headerFields</nobr> </td><td>  [JSON] </td><td>  El t√≠tulo del mapa.  Se muestra incluso cuando las tarjetas son visibles en la lista. </td></tr><tr><td>  <nobr>Campos auxiliares</nobr> </td><td>  [JSON] </td><td>  Informaci√≥n b√°sica sobre el mapa. </td></tr><tr><td>  <nobr>transitType</nobr> </td><td>  Cadena </td><td>  Tipo de transporte para tarjetas de boleto.  Puede tomar los siguientes valores: <br>  PK transitTypeAir, <br>  PK transitTypeBoat, <br>  PK transitTypeBu`, <br>  PK transitTypeGeneric, <br>  `PK transitTypeTrain`. </td></tr><tr><td>  <nobr>backFields</nobr> </td><td>  [JSON] </td><td>  Matriz de campos responsables de la parte posterior del mapa </td></tr></tbody></table><br><p>  JSON en este caso tiene la siguiente forma: </p><br><pre><code class="hljs objectivec"><span class="hljs-string"><span class="hljs-string">"key"</span></span> : <span class="hljs-string"><span class="hljs-string">"value1"</span></span>, <span class="hljs-string"><span class="hljs-string">"label"</span></span> : <span class="hljs-string"><span class="hljs-string">"value2"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : <span class="hljs-string"><span class="hljs-string">"value3"</span></span></code> </pre> <br><p>  El valor de la clave de valor puede ser num√©rico o de cadena.  Sin embargo, currencyCode junto con el valor de cadena no se pueden usar.  En cuanto a los campos auxiliares y los campos secundarios, puede haber varios de ellos, y debe controlar la longitud de las filas que se utilizan en ellos. </p><br><h2>  Claves para el dise√±o visual </h2><br><table><tbody><tr><th>  <nobr>Clave en JSON</nobr> </th><th>  <nobr>Tipo de datos</nobr> </th><th>  <nobr>Descripci√≥n</nobr> </th></tr><tr><td>  <nobr>c√≥digos de barras</nobr> </td><td>  [JSON] </td><td>  Informaci√≥n para el c√≥digo de barras (ver abajo). </td></tr><tr><td>  <nobr>fondoColor</nobr> </td><td>  color como cuerda </td><td>  Color de fondo. (# Fa32e4) </td></tr><tr><td>  <nobr>primer planoColor</nobr> </td><td>  color como cuerda </td><td>  Color de etiqueta con valores </td></tr><tr><td>  <nobr>groupingIdentifier</nobr> </td><td>  Cadena </td><td>  Opcional para boletos de eventos y boletos de transporte.  Las tarjetas con el mismo estilo (passTypeIdentifier y groupingIdentifier) ‚Äã‚Äãse agrupar√°n </td></tr><tr><td>  <nobr>labelColor</nobr> </td><td>  color como cuerda </td><td>  Etiquetar texto con nombres de campo </td></tr><tr><td>  <nobr>logoText</nobr> </td><td>  Cadena localizable </td><td>  Texto que se muestra junto al logo </td></tr></tbody></table><br><h2>  C√≥digo de barras </h2><br><p>  La parte m√°s importante del mapa.  Se le cose un n√∫mero de identificaci√≥n de tarjeta (por ejemplo, un n√∫mero de tarjeta f√≠sica o un n√∫mero de boleto).  Es importante que el esc√°ner o cualquier otra herramienta pueda leer c√≥digos en la codificaci√≥n correcta. </p><br><table><tbody><tr><th>  <nobr>Clave en JSON</nobr> </th><th>  <nobr>Tipo de datos</nobr> </th><th>  <nobr>Descripci√≥n</nobr> </th></tr><tr><td>  <nobr>altText</nobr> </td><td>  Cadena </td><td>  Texto opcional que se muestra al lado del c√≥digo de barras si el c√≥digo de barras no se lee. </td></tr><tr><td>  <nobr>formatear</nobr> </td><td>  Cadena </td><td>  Formato de c√≥digo de barras.  Puede tomar valores: PKBarcodeFormatQR, <br>  PKBarcodeFormatPDF417, <br>  PKBarcodeFormatAztec, <br>  PKBarcodeFormatCode128 </td></tr><tr><td>  <nobr>mensaje</nobr> </td><td>  Cadena </td><td>  C√≥digo o n√∫mero de tarjeta encriptado en c√≥digo de barras. </td></tr><tr><td>  <nobr>mensajeEncoding</nobr> </td><td>  Cadena </td><td>  Codificaci√≥n de mensajes.  Generalmente iso-8859-1 </td></tr></tbody></table><br><h2>  Ubicaci√≥n </h2><br><p>  Estas claves son responsables de la ubicaci√≥n dentro de la cual se puede utilizar la tarjeta. </p><br><table><tbody><tr><th>  <nobr>Clave en JSON</nobr> </th><th>  <nobr>Tipo de datos</nobr> </th><th>  <nobr>Descripci√≥n</nobr> </th></tr><tr><td>  <nobr>altiture</nobr> </td><td>  Cadena </td><td>  Texto opcional que se muestra al lado del c√≥digo de barras si el c√≥digo de barras no se lee. </td></tr><tr><td>  <nobr>latitud</nobr> </td><td>  Longitud </td><td>  Latitud </td></tr><tr><td>  <nobr>longitud</nobr> </td><td>  Doble </td><td>  Latitud </td></tr><tr><td>  <nobr>texto relevante</nobr> </td><td>  Cadena </td><td>  Texto opcional que aparece en la pantalla de bloqueo en el momento en que el usuario ingresa al rango de la tarjeta. </td></tr></tbody></table><br><h2>  Lado trasero </h2><br><p>  Se puede colocar informaci√≥n adicional en la parte de informaci√≥n inversa: t√©rminos de uso, pol√≠tica de actualizaci√≥n autom√°tica, detalles de contacto y un enlace a la aplicaci√≥n a la que pertenece la tarjeta.  La figura muestra la correspondencia de los campos en pass.json y la apariencia del reverso del mapa.  Si hay enlaces, n√∫meros de tel√©fono, etc. en el campo de valor, se resaltar√°n autom√°ticamente. </p><br><p><img src="https://habrastorage.org/webt/er/gx/ow/ergxowmbtn08dmjnv2lkrqlo3ku.png"></p><br><h1 id="sozdanie-karty-chast-2">  Crea un mapa.  Parte 2 </h1><br><p>  Entonces, las im√°genes est√°n listas, se forma pass.json, queda por poner todo junto.  Para hacer esto, complete manifest.json (consulte la tabla 1), donde debe incluir todas las im√°genes y pass.json.  Resulta algo como esto: </p><br><pre> <code class="hljs go">. . . . . . <span class="hljs-string"><span class="hljs-string">"pass.json"</span></span> = <span class="hljs-number"><span class="hljs-number">303</span></span>c753abc39aa732ec74643d6db28348fe8a823; <span class="hljs-string"><span class="hljs-string">"strip.png"</span></span> = <span class="hljs-number"><span class="hljs-number">736d</span></span>01f84cb73d06e8a9932e43076d68f19461ff; <span class="hljs-string"><span class="hljs-string">"strip@2x.png"</span></span> = <span class="hljs-number"><span class="hljs-number">468f</span></span>a7bc93e6b55342b56fda09bdce7c829d7d46; . . . . . .</code> </pre> <br><p>  A partir de este momento, no es necesario cambiar nada, ya que el SHA ser√° incorrecto; en caso de cambios, es necesario regenerar el SHA. </p><br><p>  A continuaci√≥n, debe crear una ID de tipo de pase en la oficina del desarrollador y hacer un certificado para ello.  El procedimiento deber√≠a ser m√°s o menos familiar si cre√≥ anteriormente, por ejemplo, los perfiles de aprovisionamiento. </p><br><img src="https://habrastorage.org/webt/2b/um/hu/2bumhu9wgoawlz1lt-qhieildna.png"><br><p>  A continuaci√≥n, vaya al Llavero y exporte desde all√≠ el Certificado de relaci√≥n de desarrollador mundial de Apple (WWDR) como .pem. </p><br><p><img src="https://habrastorage.org/webt/jg/kk/sl/jgkksl_tfac4e23hz7bk1swxhtq.png"></p><br><p>  A partir de ah√≠, exportamos el ID de tipo de pase creado como .p12.  En este punto, el ama de llaves le pedir√° que ingrese la contrase√±a para el certificado.  En este caso, una contrase√±a es opcional. <br>  Tenga en cuenta que todas las acciones adicionales deben realizarse en una carpeta, donde manifest.json, pass.json y las im√°genes ya deber√≠an estar. </p><br><p>  Ahora necesita generar una firma, que firmaremos en el archivo.  Primero, exporte la ID del tipo de pase y la clave como .pem. </p><br><pre> <code class="hljs powershell">openssl pkcs12 <span class="hljs-operator"><span class="hljs-operator">-in</span></span> certificate.p12 <span class="hljs-literal"><span class="hljs-literal">-clcerts</span></span> <span class="hljs-literal"><span class="hljs-literal">-nokeys</span></span> <span class="hljs-literal"><span class="hljs-literal">-out</span></span> passcertificate.pem <span class="hljs-literal"><span class="hljs-literal">-passin</span></span> pass: your_password</code> </pre> <br><p>  y </p><br><pre> <code class="hljs powershell">openssl pkcs12 <span class="hljs-operator"><span class="hljs-operator">-in</span></span> certificates.p12 <span class="hljs-literal"><span class="hljs-literal">-nocerts</span></span> <span class="hljs-literal"><span class="hljs-literal">-out</span></span> passkey.pem <span class="hljs-literal"><span class="hljs-literal">-passin</span></span> pass: <span class="hljs-literal"><span class="hljs-literal">-passout</span></span> pass:new_password</code> </pre> <br><p>  Ahora estamos listos para generar una firma.  Hag√°moslo un comando: </p><br><pre> <code class="hljs powershell">openssl smime <span class="hljs-literal"><span class="hljs-literal">-binary</span></span> <span class="hljs-literal"><span class="hljs-literal">-sign</span></span> <span class="hljs-literal"><span class="hljs-literal">-certfile</span></span> WWDR.pem <span class="hljs-literal"><span class="hljs-literal">-signer</span></span> passcertificate.pem <span class="hljs-literal"><span class="hljs-literal">-inkey</span></span> passkey.pem <span class="hljs-operator"><span class="hljs-operator">-in</span></span> manifest.json <span class="hljs-literal"><span class="hljs-literal">-out</span></span> signature <span class="hljs-literal"><span class="hljs-literal">-outform</span></span> DER <span class="hljs-literal"><span class="hljs-literal">-passin</span></span> pass:___</code> </pre> <br><p>  Entonces, todo est√° listo para nosotros, solo queda recopilar el archivo, hacemos esto con el comando: </p><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">zip</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-r</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">nameOfPass</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.pkpass</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">manifest</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.json</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">pass</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.json</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">signature</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">logo</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.png</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">logo</span></span>@<span class="hljs-keyword"><span class="hljs-keyword">2x</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">png</span></span> logo@<span class="hljs-number"><span class="hljs-number">3</span></span>x.png icon.png icon@<span class="hljs-number"><span class="hljs-number">2</span></span>x.png icon@<span class="hljs-number"><span class="hljs-number">3</span></span>x.png</code> </pre> <br><p>  Le llamo la atenci√≥n sobre el hecho de que todos los archivos en los que desea incluir el archivo de datos de la tarjeta (.pkpass) deben enumerarse aqu√≠. <br>  Como resultado, obtenemos un archivo .pkpass que se puede abrir en la computadora.  Veremos una vista previa de la tarjeta, cuya apariencia puede diferir de la apariencia en el tel√©fono. <br>  Todo esto se puede hacer un poco m√°s f√°cil.  Apple proporciona la utilidad <code>signpass</code> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">muestrarios de Apple Wallet</a> ), que se encarga de todos los c√°lculos SHA (el archivo <code>manifest.json</code> se puede dejar solo) y el trabajo de crear firmas.  Para usarlo, debe crear un proyecto y colocar el archivo <code>signpass</code> en una carpeta con todos los recursos necesarios. </p><br><img src="https://habrastorage.org/webt/tj/jj/eo/tjjjeoqlhxzjumfr3nrg9ve8yhm.png"><br><p>  En general, la estructura deber√≠a verse as√≠: </p><br><img src="https://habrastorage.org/webt/qc/pb/lr/qcpblrbdaw7piffxdehwa1whlpw.png"><br><p>  A continuaci√≥n, ejecute el comando: </p><br><pre> <code class="hljs powershell">./signpass <span class="hljs-literal"><span class="hljs-literal">-p</span></span> wallet</code> </pre> <br><p>  Wallet es el nombre de la carpeta en la que se encuentran todos los recursos.  La salida es wallet.pkpass.  Su contenido se puede ver descomprimiendo wallet.pkpass. </p><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">unzip</span></span> wallet.pkpass</code> </pre> <br><p>  Es posible que la creaci√≥n de pkpass se env√≠e al backend, en cuyo caso ser√° necesario transferir a los desarrolladores del WWDR un certificado para la ID de tipo de pase en forma de .p12 y una contrase√±a para ello. </p><br><h1 id="integraciya-s-prilozheniem">  Integraci√≥n de aplicaciones </h1><br><p>  Para que la aplicaci√≥n pueda agregar tarjetas a Wallet, debe habilitar esta funci√≥n en la ID de la aplicaci√≥n y tambi√©n habilitar esta funci√≥n en Capacidades en el proyecto. </p><br><img src="https://habrastorage.org/webt/yq/wo/py/yqwopyfu9nhk-_klilrcoczwe3m.png"><br><img src="https://habrastorage.org/webt/o-/se/ek/o-seekf9zbohe4jmwtcvnzfwes4.png"><br><p>  Esto es necesario para el trabajo correcto completo con Wallet.  De lo contrario, no ser√° posible leer tarjetas de Wallet y, por ejemplo, no ser√° posible comprender si nuestra tarjeta est√° agregada o no.  Tambi√©n es importante tener en cuenta que la identificaci√≥n del equipo en pass.json debe coincidir con la identificaci√≥n del equipo, o deber√° agregarlos manualmente a los derechos y esto puede solucionar la situaci√≥n, pero no lo comprob√©. </p><br><p><img src="https://habrastorage.org/webt/82/ow/p9/82owp9rv4gyaldwm0si77b5nn8m.png"></p><br><h2 id="dobavlenie-karty">  Agregar una tarjeta </h2><br><p>  Agregar mapas es muy simple: </p><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> passPath = <span class="hljs-type"><span class="hljs-type">Bundle</span></span>.main.path(forResource: <span class="hljs-string"><span class="hljs-string">"wallet"</span></span>, ofType: <span class="hljs-string"><span class="hljs-string">"pkpass"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> error: <span class="hljs-type"><span class="hljs-type">ErrorPointer</span></span> = <span class="hljs-type"><span class="hljs-type">ErrorPointer</span></span>(nilLiteral: ()) <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> passData = <span class="hljs-type"><span class="hljs-type">NSData</span></span>(contentsOfFile: passPath) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> pass = <span class="hljs-type"><span class="hljs-type">PKPass</span></span>(data: passData <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-type"><span class="hljs-type">Data</span></span>, error: error) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> passLibrary = <span class="hljs-type"><span class="hljs-type">PKPassLibrary</span></span>() passLibrary.addPasses([pass]) { (status) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(passLibrary.containsPass(pass)) }</code> </pre> <br><p>  Sin embargo, una vez m√°s, el archivo .pkpass m√°s a menudo tendr√° que descargarse de su servidor. <br>  Vale la pena se√±alar que PassKit produce errores bastante legibles, por lo que puede comprender f√°cilmente qu√© se hizo exactamente mal. </p><br><h2 id="poluchenie-informacii-o-dobavlennyh-kartah">  Recuperando informaci√≥n sobre tarjetas agregadas </h2><br><p>  Para obtener informaci√≥n sobre las tarjetas disponibles en Wallet y relacionadas con su aplicaci√≥n, debe recurrir al objeto PKPassLibrary. </p><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> passLibrary = <span class="hljs-type"><span class="hljs-type">PKPassLibrary</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> passes = passLibrary.passes()</code> </pre> <br><p>  Por lo tanto, puede comprender si el mapa se agrega o no, as√≠ como actualizar la interfaz.  Adem√°s, a trav√©s de PKPassLibrary, los mapas se pueden actualizar y eliminar.  Los mapas tambi√©n se pueden actualizar a trav√©s de servicios web, pero en este art√≠culo no consideraremos esa opci√≥n. </p><br><h1 id="proverka-na-unikalnost">  Verificaci√≥n de unicidad </h1><br><p>  Como en su servicio, por regla general, la tarjeta est√° vinculada a una cuenta, en la aplicaci√≥n lo m√°s probable es que tenga que determinar de alguna manera si la tarjeta pertenece al usuario actual.  Sugiero hacer esto a trav√©s de <code>serialNumber</code> .  Por ejemplo, establezca la identificaci√≥n de n√∫mero de serie del usuario o n√∫mero de tarjeta. </p><br><h1 id="testirovanie">  Prueba </h1><br><p>  Apple proporciona ejemplos de pkpass para diferentes tipos, puede centrarse en ellos. <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Muestras de billetera de manzana</a> <br>  Para ver c√≥mo se ve el mapa, puede agregar pkpass al proyecto (consulte ‚ÄúAgregar un mapa‚Äù).  El proceso de agregar / quitar ya se discuti√≥ anteriormente, solo resta recordar que la aplicaci√≥n no ver√° las tarjetas ya agregadas si la tarjeta para Wallet se cre√≥ en una cuenta de desarrollador, y el desarrollo en s√≠ se realiz√≥ desde otra cuenta (relevante para las empresas de outsourcing).  En este caso, puede agregar tarjetas sin problemas. <br>  Puede verificar si la informaci√≥n en el c√≥digo de barras est√° codificada correctamente utilizando cualquier esc√°ner de c√≥digo QR.  Y definitivamente es necesario verificar la exactitud del trabajo con este esc√°ner. </p><br><h1 id="zaklyuchenie">  Conclusi√≥n </h1><br><p>  El art√≠culo examin√≥ el proceso de creaci√≥n y dise√±o de un mapa, as√≠ como el proceso de integraci√≥n con la aplicaci√≥n y los problemas que pueden surgir.  Intent√© no abordar problemas de integraci√≥n con servicios web y actualizaciones de mapas, y espero hacerlo en el pr√≥ximo art√≠culo. </p><br><h1 id="ispolzuemye-materialy">  Materiales utilizados </h1><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://developer.apple.com/library/archive/documentation/UserExperience/Conceptual/PassKit_PG/Creating.html</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://developer.apple.com/library/archive/documentation/UserExperience/Reference/PassKit_Bundle/Chapters/TopLevel.html#//apple_ref/doc/uid/TP40012026-CH2-SW3</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://itechroof.wordpress.com/2015/11/30/apple-wallet-part-13/</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://developer.apple.com/library/archive/documentation/UserExperience/Conceptual/PassKit_PG/Updating.html</a> </p><br><p>  Un agradecimiento especial a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link">mehdzor</a> por la cuenta de desarrollador para las pruebas. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es428437/">https://habr.com/ru/post/es428437/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es428423/index.html">C√≥mo un acuerdo de $ 34 mil millones entre IBM y Red Hat cambiar√° el mercado de TI: expertos y analistas</a></li>
<li><a href="../es428429/index.html">GOST R 34.10 firma electr√≥nica de documentos PDF en la suite ofim√°tica LibreOffice</a></li>
<li><a href="../es428431/index.html">M√°s que capas conc√©ntricas</a></li>
<li><a href="../es428433/index.html">Abogados de pruebas privadas</a></li>
<li><a href="../es428435/index.html">¬øQu√© leer en PHP en ruso?</a></li>
<li><a href="../es428439/index.html">Sin conjunto</a></li>
<li><a href="../es428441/index.html">Compra de GitHub completada. ¬øQu√© pasar√° despu√©s?</a></li>
<li><a href="../es428443/index.html">Reconciliaci√≥n: verificar la integridad de los datos en sistemas distribuidos</a></li>
<li><a href="../es428445/index.html">C√≥mo fuimos a un hackathon en Helsinki y perdimos</a></li>
<li><a href="../es428447/index.html">Protecci√≥n de datos en la nube: una gu√≠a para desarrolladores</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>