<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐คฑ ๐ฃ๏ธ ๐ง๐พ ุชุฎุตูุต ุงูุชุจุนูุฉ ุญู ูู ุงูุฑุจูุน ๐จโ๐ผ ๐ ๐ด๐ฟ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ูุฑุญุจุง ุงุณูู Andrey Nevedomsky ูุฃูุง ูุจูุฑ ุงููููุฏุณูู ูู SberTekh. ุฃุนูู ูู ูุฑูู ูููู ุจุชุทููุฑ ุฅุญุฏู ุฎุฏูุงุช ุงููุธุงู ูู ูุธุงู ESF (ูุธุงู ุฃูุงูู ููุญุฏ). ูู ุนูููุง ุ ูุณุช...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ุชุฎุตูุต ุงูุชุจุนูุฉ ุญู ูู ุงูุฑุจูุน</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/sberbank/blog/435364/" style=";text-align:right;direction:rtl">  ูุฑุญุจุง  ุงุณูู Andrey Nevedomsky ูุฃูุง ูุจูุฑ ุงููููุฏุณูู ูู SberTekh.  ุฃุนูู ูู ูุฑูู ูููู ุจุชุทููุฑ ุฅุญุฏู ุฎุฏูุงุช ุงููุธุงู ูู ูุธุงู ESF (ูุธุงู ุฃูุงูู ููุญุฏ).  ูู ุนูููุง ุ ูุณุชุฎุฏู ุจูุดุงุท Spring Framework ุ ูุฎุงุตุฉู DI ุ ููู ููุช ูุขุฎุฑ ููุงุฌู ุญูููุฉ ุฃู ุญู ุงูุชุจุนูุงุช ูู ุงูุฑุจูุน ููุณ ุฐูููุง ุจูุง ููู ุงูููุงูุฉ ุจุงููุณุจุฉ ููุง.  ูุฐู ุงูููุงูุฉ ูู ูุชูุฌุฉ ููุญุงููุงุชู ุฌุนููุง ุฃูุซุฑ ุฐูุงุกู ูููู ููู ุชุนูู ุจุดูู ุนุงู.  ุขูู ุฃู ุชุชููู ูู ุชุนูู ุดูุก ุฌุฏูุฏ ููู ุญูู ุฌูุงุฒ ุงูุฑุจูุน. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0ea/bbf/f4c/0eabbff4c25bb87806837c487f847fcc.png"><br><a name="habracut"></a><br>  ูุจู ูุฑุงุกุฉ ุงูููุงู ุ ุฃูุตู ุจุดุฏุฉ ุฃู ุชูุฑุฃ ุชูุงุฑูุฑ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" class="user_link">ุจูุฑูุณ</a> ููุบููู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" class="user_link">ุฅูุบููู ุจูุฑูุณูู</a> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Spring Ripperุ Part 1</a> ุ  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุฑุจูุน ุงูุฎุงุฑู ุ ุงูุฌุฒุก 2</a> .  ูุง ูุฒุงู ููุงู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุงุฆูุฉ ุชุดุบูู ูููู</a> . <br><br><h2 style=";text-align:right;direction:rtl">  ููุฏูุฉ </h2><br>  ุฏุนูุง ูุชุฎูู ุฃูู ุทููุจ ููุง ุชุทููุฑ ุฎุฏูุฉ ููุชูุจุค ุจุงููุตูุฑ ูุงูุฃุจุฑุงุฌ.  ุชุญุชูู ุฎุฏูุชูุง ุนูู ุงูุนุฏูุฏ ูู ุงูููููุงุช ุ ูููู ุฃูููุง ุจุงููุณุจุฉ ููุง ูู ููููุงู: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  Globa ุ ุงูุชู ุณุชููุฐ ูุงุฌูุฉ FortuneTeller ูุชุชูุจุฃ ุจุงููุตูุฑ ุ <br><br><img src="https://habrastorage.org/getpro/habr/post_images/301/c90/6f1/301c906f1584237b8bab4f8627484ff2.png" width="365" height="450"><br><br></li></ul><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุงูุบุฌุฑ ุ ูุงูุชู ุณุชููุฐ ูุงุฌูุฉ HoroscopeTeller ูุฅูุดุงุก ุงูุฃุจุฑุงุฌ. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d9f/520/3ad/d9f5203ad3b823ea61d5322655d2164d.png" width="365" height="450"><br><br></li></ul><br>  ุฃูุถุง ูู ุฎุฏูุชูุง ุณูููู ููุงู ุงูุนุฏูุฏ ูู ููุงุท ุงูููุงูุฉ (ูุญุฏุงุช ุงูุชุญูู) ุ ูู ุงููุงูุน ุ ููุญุตูู ุนูู ุงูููุงูุฉ ูุงูุฃุจุฑุงุฌ.  ูุณูุชุญูู ุฃูุถูุง ูู ุงููุตูู ุฅูู ุชุทุจูููุง ุนู ุทุฑูู ุจุฑูุชูููู ุงูุฅูุชุฑูุช ุจุงุณุชุฎุฏุงู ุฌุงูุจ ุณูุชู ุชุทุจููู ุนูู ุทุฑู ุงูุชุญูู ูุณูุจุฏู ููุง ููู: <br><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">RestrictionAspect.java</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"><code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Aspect</span></span> <span class="hljs-meta"><span class="hljs-meta">@Component</span></span> <span class="hljs-meta"><span class="hljs-meta">@Slf</span></span>4j <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RestrictionAspect</span></span></span><span class="hljs-class"> </span></span>{    <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Predicate&lt;String&gt; ipIsAllowed;    <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RestrictionAspect</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@NonNull </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Predicate&lt;String&gt; ipIsAllowed)</span></span></span><span class="hljs-function"> </span></span>{        <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.ipIsAllowed = ipIsAllowed;    }    <span class="hljs-meta"><span class="hljs-meta">@Before</span></span>(<span class="hljs-string"><span class="hljs-string">"execution(public * com.github.monosoul.fortuneteller.web.*.*(..))"</span></span>)    <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">checkAccess</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{        val ip = getRequestSourceIp();       log.debug(<span class="hljs-string"><span class="hljs-string">"Source IP: {}"</span></span>, ip);        <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!ipIsAllowed.test(ip)) {            <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AccessDeniedException(format(<span class="hljs-string"><span class="hljs-string">"Access for IP [%s] is denied"</span></span>, ip));        }    }    <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getRequestSourceIp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{        val requestAttributes = currentRequestAttributes();        Assert.state(requestAttributes <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> ServletRequestAttributes,                <span class="hljs-string"><span class="hljs-string">"RequestAttributes needs to be a ServletRequestAttributes"</span></span>);        val request = ((ServletRequestAttributes) requestAttributes).getRequest();        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> request.getRemoteAddr();    } }</code> </pre> <br></div></div><br>  ููุชุญูู ูู ุงูุณูุงุญ ุจุงููุตูู ูู ูุซู ูุฐุง IP ุ ุณูู ูุณุชุฎุฏู ุจุนุถ ุชุทุจูู ุชูููู <code>ipIsAllowed</code> .  ุจุดูู ุนุงู ุ ูู ูููุน ูุฐุง ุงูุฌุงูุจ ุ ูุฏ ูููู ููุงู ุงูุจุนุถ ุงูุขุฎุฑ ุ ุนูู ุณุจูู ุงููุซุงู ุ ุฅุฐู. <br><br>  ูุฐูู ุ ูููุง ุจุชุทููุฑ ุงูุชุทุจูู ููู ุดูุก ูุนูู ุจุดูู ุฑุงุฆุน ุจุงููุณุจุฉ ููุง.  ูููู ุฏุนููุง ูุชุญุฏุซ ุนู ุงูุงุฎุชุจุงุฑ ุงูุขู. <br><br><h2 style=";text-align:right;direction:rtl">  ููููุฉ ุงุฎุชุจุงุฑูุ </h2><br>  ุฏุนูุง ูุชุญุฏุซ ุนู ููู ูููููุง ุงุฎุชุจุงุฑ ุชุทุจูู ุงูุฌูุงูุจ.  ูุฏููุง ุนุฏุฉ ุทุฑู ููููุงู ุจุฐูู. <br><br>  ููููู ูุชุงุจุฉ ุงุฎุชุจุงุฑุงุช ูููุตูุฉ ูุฌุงูุจ ูุฌูุงูุจ ุงูุชุญูู ุ ุฏูู ุฑูุน ุณูุงู ุงูุฑุจูุน (ุงูุฐู ุณูุคุฏู ููุท ุฅูู ุฅูุดุงุก ูููู ูุน ุฌุงูุจ ูุฌูุงุฒ ุงูุชุญูู ุ ููููู ูุฑุงุกุฉ ุงููุฒูุฏ ุญูู ูุฐุง ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงููุซุงุฆู</a> ุงูุฑุณููุฉ) ุ ููู ูู ูุฐู ุงูุญุงูุฉ ูู <u>ูุฎุชุจุฑ ุจุงูุถุจุท ูุง ูุชู ุชุทุจูู ุงูุฌูุงูุจ ุจุดูู ุตุญูุญ ุนูู ุชุญูู ูุชุนูู ุชูุงููุง ููุง ูุชููุน</u> ุ <br><br>  ููููู ูุชุงุจุฉ ุงูุงุฎุชุจุงุฑุงุช ุงูุชู ุณูุฑูุน ูููุง ุงูุณูุงู ุงููุงูู ูุทูุจูุง ุ ูููู ูู ูุฐู ุงูุญุงูุฉ: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุงูุงุฎุชุจุงุฑุงุช ุงูุฌุงุฑูุฉ ุณุชุณุชุบุฑู ููุชุง ุทูููุง ุ ูุฃู  ูู ุงูุตูุงุฏูู ุณุชุฑุชูุน. </li><li style=";text-align:right;direction:rtl">  ุณูุญุชุงุฌ ุฅูู ุฅุนุฏุงุฏ ุจูุงูุงุช ุงุฎุชุจุงุฑ ุตุงูุญุฉ ูููู ุฃู ุชูุฑ ุนุจุฑ ุณูุณูุฉ ุงูููุงููุงุช ุจุฃููููุง ุจูู ุงูุตูุงุฏูู ุฏูู ุฑูู NPE ูู ููุณ ุงูููุช. </li></ul><br>  ููููุง ูุฑูุฏ ุฃู ูุฎุชุจุฑ ุจุงูุถุจุท ูุง ูู ุงูุฌุงูุจ ุงููุทุจู ููููู ุจุนููู.  ูุง ูุฑูุฏ ุงุฎุชุจุงุฑ ุงูุฎุฏูุงุช ุงูุชู ูุทูู ุนูููุง ุฌูุงุฒ ุงูุชุญูู ุ ูุจุงูุชุงูู ูุง ูุฑูุฏ ุฃู ูููู ูู ุญูุฑุฉ ูู ุจูุงูุงุช ุงูุงุฎุชุจุงุฑ ูุงูุชุถุญูุฉ ุจููุช ุจุฏุก ุงูุชุดุบูู.  ูุฐูู ุ ุณูู ููุชุจ ุงูุงุฎุชุจุงุฑุงุช ุงูุชู ุณูุทุฑุญ ูููุง ุฌุฒุกูุง ููุท ูู ุงูุณูุงู.  ุฃู  ูู ุณูุงููุง ุณูููู ููุงู ูุงุตูููุง ุญููููุฉ ูุฌูุงุฒ ุชุญูู ุญูููู ุ ููู ุดูุก ุขุฎุฑ ุณูููู mokami. <br><br><h2 style=";text-align:right;direction:rtl">  ููููุฉ ุฅูุดุงุก ุญุจูุจ ูููุงุ </h2><br>  ููุงู ุนุฏุฉ ุทุฑู ูุฅูุดุงุก ุญุจูุจ ูููุง ูู ุงูุฑุจูุน.  ููุชูุถูุญ ุ ุนูู ุณุจูู ุงููุซุงู ุ ูุฃุฎุฐ ุฅุญุฏู ูุญุฏุงุช ุงูุชุญูู ูู ุฎุฏูุชูุง - <code>PersonalizedHoroscopeTellController</code> ุ ูุจุฏู ุฑูุฒูุง ููุง ููู: <br><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">PersonalizedHoroscopeTellController.java</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Slf</span></span>4j <span class="hljs-meta"><span class="hljs-meta">@RestController</span></span> <span class="hljs-meta"><span class="hljs-meta">@RequestMapping</span></span>( value = <span class="hljs-string"><span class="hljs-string">"/horoscope"</span></span>, produces = APPLICATION_JSON_UTF8_VALUE ) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PersonalizedHoroscopeTellController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> HoroscopeTeller horoscopeTeller; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Function&lt;String, ZodiacSign&gt; zodiacSignConverter; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Function&lt;String, String&gt; nameNormalizer; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PersonalizedHoroscopeTellController</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> HoroscopeTeller horoscopeTeller, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Function&lt;String, ZodiacSign&gt; zodiacSignConverter, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Function&lt;String, String&gt; nameNormalizer )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.horoscopeTeller = horoscopeTeller; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.zodiacSignConverter = zodiacSignConverter; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.nameNormalizer = nameNormalizer; } <span class="hljs-meta"><span class="hljs-meta">@GetMapping</span></span>(value = <span class="hljs-string"><span class="hljs-string">"/tell/personal/{name}/{sign}"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> PersonalizedHoroscope </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tell</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@PathVariable </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> String name, @PathVariable </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> String sign)</span></span></span><span class="hljs-function"> </span></span>{ log.info(<span class="hljs-string"><span class="hljs-string">"Received name: {}; sign: {}"</span></span>, name, sign); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> PersonalizedHoroscope.builder() .name( nameNormalizer.apply(name) ) .horoscope( horoscopeTeller.tell( zodiacSignConverter.apply(sign) ) ) .build(); } }</code> </pre> <br></div></div><br><h3 style=";text-align:right;direction:rtl">  ุชูููู Java ูุน ุงูุชุจุนูุงุช ูู ูู ุงุฎุชุจุงุฑ </h3><br>  ุจุงููุณุจุฉ ููู ุงุฎุชุจุงุฑ ุ ูููููุง ูุชุงุจุฉ Java Config ุงูุฐู ูุตู ููู ููุงู ูู ูุญุฏุฉ ุงูุชุญูู ูุงููุงุตูููุง ุงูุฌุงูุจูุฉ ูุงููุงุตูููุง ุจุงุณุชุฎุฏุงู moks ุงูุชุจุนูุฉ ููุชุญูู.  ุณุชููู ูุฐู ุงูุทุฑููุฉ ููุตู ุงููุงุตูููุง ุถุฑูุฑูุฉ ุ ูุฃููุง ุณูุฎุจุฑ ุงูุฑุจูุน ุจูุถูุญ ููู ูุญุชุงุฌ ุฅูู ุฅูุดุงุก ุงููุงุตูููุง. <br><br>  ูู ูุฐู ุงูุญุงูุฉ ุ ุณูุจุฏู ุงุฎุชุจุงุฑ ุฌูุงุฒ ุงูุชุญูู ุงูุฎุงุต ุจูุง ููุง ููู: <br><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">javaconfig / PersonalizedHoroscopeTellControllerTest.java</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@SpringJUnitConfig</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PersonalizedHoroscopeTellControllerTest</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> LIMIT = <span class="hljs-number"><span class="hljs-number">10</span></span>; <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> PersonalizedHoroscopeTellController controller; <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Predicate&lt;String&gt; ipIsAllowed; <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doNothingWhenAllowed</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ when(ipIsAllowed.test(anyString())).thenReturn(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); controller.tell(randomAlphabetic(LIMIT), randomAlphabetic(LIMIT)); } <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">throwExceptionWhenNotAllowed</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ when(ipIsAllowed.test(anyString())).thenReturn(<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); assertThatThrownBy(() -&gt; controller.tell(randomAlphabetic(LIMIT), randomAlphabetic(LIMIT))) .isInstanceOf(AccessDeniedException.class); } <span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-meta"><span class="hljs-meta">@Import</span></span>(AspectConfiguration.class) <span class="hljs-meta"><span class="hljs-meta">@EnableAspectJAutoProxy</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Config</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> PersonalizedHoroscopeTellController </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">personalizedHoroscopeTellController</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> HoroscopeTeller horoscopeTeller, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Function&lt;String, ZodiacSign&gt; zodiacSignConverter, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Function&lt;String, String&gt; nameNormalizer )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PersonalizedHoroscopeTellController(horoscopeTeller, zodiacSignConverter, nameNormalizer); } <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> HoroscopeTeller </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">horoscopeTeller</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> mock(HoroscopeTeller.class); } <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Function&lt;String, ZodiacSign&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">zodiacSignConverter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> mock(Function.class); } <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Function&lt;String, String&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">nameNormalizer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> mock(Function.class); } } }</code> </pre> <br></div></div><br>  ูุซู ูุฐุง ุงูุงุฎุชุจุงุฑ ูุจุฏู ูุฑููุง ุฅูู ุญุฏ ูุง.  ูู ูุฐู ุงูุญุงูุฉ ุ ุณูุชุนูู ุนูููุง ูุชุงุจุฉ Java Config ููู ูุญุฏุฉ ูู ูุญุฏุงุช ุงูุชุญูู.  ุนูู ุงูุฑุบู ูู ุงุฎุชูุงูู ูู ุงููุญุชูู ุ ุฅูุง ุฃูู ุณูููู ูู ููุณ ุงููุนูู: ุฅูุดุงุก ูุญุฏุฉ ุชุญูู ู moki ุชุจุนูุงุชูุง.  ูุฐูู ูู ุฌููุฑูุง ุณูููู ูู ููุณู ุจุงููุณุจุฉ ูุฌููุน ูุญุฏุงุช ุงูุชุญูู.  ุฃูุง ุ ูุซู ุฃู ูุจุฑูุฌ ุ ุดุฎุต ูุณูู ุ ูุฐูู ุฑูุถุช ุนูู ุงูููุฑ ูุฐุง ุงูุฎูุงุฑ. <br><br><h3 style=";text-align:right;direction:rtl">  ุงูุชุนูููุงุช ุงูุชูุถูุญูุฉMockBean ุนูู ูู ุญูู ูุน ุงูุชุจุนูุฉ </h3><br>  ุธูุฑ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูุชุนููู ุงูุชูุถูุญูMockBean</a> ูู ุฅุตุฏุงุฑ Spring Boot Test 1.4.0.  ุฅูู ูุดุงุจู ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Mock</a> ูู Mockito (ุจู ุฅูู ูู ุงููุงูุน ูุณุชุฎุฏูู ุฏุงุฎูููุง) ุ ูุน ุงูุงุฎุชูุงู ุงููุญูุฏ ุฃูู ุนูุฏ ุงุณุชุฎุฏุงู <code>@MockBean</code> ุ ุณูุชู ูุถุน <code>@MockBean</code> ุชููุงุฆููุง ูู ุณูุงู ุงูุฑุจูุน.  ุณุชููู ูุฐู ุงูุทุฑููุฉ ูุฅุนูุงู mok ุชุนุฑููููุง ุ ูุธุฑูุง ูุฃููุง ูุง ูุถุทุฑ ุฅูู ุฅุฎุจุงุฑ ุงูุฑุจูุน ุจุงูุชุญุฏูุฏ ุนู ููููุฉ ุฅูุดุงุก mok. <br><br>  ูู ูุฐู ุงูุญุงูุฉ ุ ุณูุจุฏู ุงูุงุฎุชุจุงุฑ ููุง ููู: <br><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ูููุจูู / ูุดุฎุตูุฉููุธุงุฑ ุงูุฃุจุฑุงุฌ TellControllerTest.java</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@SpringJUnitConfig</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PersonalizedHoroscopeTellControllerTest</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> LIMIT = <span class="hljs-number"><span class="hljs-number">10</span></span>; <span class="hljs-meta"><span class="hljs-meta">@MockBean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> HoroscopeTeller horoscopeTeller; <span class="hljs-meta"><span class="hljs-meta">@MockBean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Function&lt;String, ZodiacSign&gt; zodiacSignConverter; <span class="hljs-meta"><span class="hljs-meta">@MockBean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Function&lt;String, String&gt; nameNormalizer; <span class="hljs-meta"><span class="hljs-meta">@MockBean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Predicate&lt;String&gt; ipIsAllowed; <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> PersonalizedHoroscopeTellController controller; <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doNothingWhenAllowed</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ when(ipIsAllowed.test(anyString())).thenReturn(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); controller.tell(randomAlphabetic(LIMIT), randomAlphabetic(LIMIT)); } <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">throwExceptionWhenNotAllowed</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ when(ipIsAllowed.test(anyString())).thenReturn(<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); assertThatThrownBy(() -&gt; controller.tell(randomAlphabetic(LIMIT), randomAlphabetic(LIMIT))) .isInstanceOf(AccessDeniedException.class); } <span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-meta"><span class="hljs-meta">@Import</span></span>({PersonalizedHoroscopeTellController.class, RestrictionAspect.class, RequestContextHolderConfigurer.class}) <span class="hljs-meta"><span class="hljs-meta">@EnableAspectJAutoProxy</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Config</span></span></span><span class="hljs-class"> </span></span>{ } }</code> </pre> <br></div></div><br>  ูู ูุฐุง ุงูุฎูุงุฑ ุ ูุง ูุฒุงู ููุงู ุชูููู Java ุ ูููู ูุถุบูุท ุจุฏุฑุฌุฉ ุฃูุจุฑ.  ูู ุจูู ุฃูุฌู ุงููุตูุฑ - ุงุถุทุฑุฑุช ุฅูู ุฅุนูุงู ุงูุญููู ุฐุงุช ุงูุชุจุนูุงุช ูุญุฏุฉ ุงูุชุญูู (ุงูุญููู ูุน ุชุนููู ุชูุถูุญู <code>@MockBean</code> ) ุ ุนูู ุงูุฑุบู ูู ุนุฏู ุงุณุชุฎุฏุงููุง ูู ุงูุงุฎุชุจุงุฑ ุจุดูู ุฃูุจุฑ.  ุญุณููุง ุ ุฅุฐุง ููุช ุชุณุชุฎุฏู ุฅุตุฏุงุฑ Spring Boot ุฃูู ูู 1.4.0 ูุณุจุจ ูุง ุ ููู ุชุชููู ูู ุงุณุชุฎุฏุงู ูุฐุง ุงูุชุนููู ุงูุชูุถูุญู. <br><br>  ูุฐูู ุ ุชูุตูุช ุฅูู ููุฑุฉ ุนู ุฎูุงุฑ ุขุฎุฑ ููุชุทููุฑ.  ุฃูุฏ ุฃู ุชุนูู ุจูุฐู ุงูุทุฑููุฉ ... <br><br><h3 style=";text-align:right;direction:rtl">  @ ุงูุชุนูููุงุช ุงูุชูุถูุญูุฉ ุงูุชููุงุฆูุฉ ุนูู ุงููููู ุงูุชุงุจุน </h3><br>  ุฃูุฏ ุฃู ูููู ูุฏููุง ุชุนููู ุชูุถูุญู <code>@Automocked</code> ุ ูุงูุฐู ูููููู ูุถุนู ููุท ููู ุงูุญูู ูุน ูุญุฏุฉ ุงูุชุญูู ุ ููู ุซู ุณูุชู ุฅูุดุงุก moki ุชููุงุฆููุง ููุญุฏุฉ ุงูุชุญูู ูุฐู ููุถุนูุง ูู ุงูุณูุงู. <br><br>  ูุฏ ูุจุฏู ุงูุงุฎุชุจุงุฑ ูู ูุฐู ุงูุญุงูุฉ ููุง ููู: <br><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุฃูุชูููููุฏ / ุดุฎุตูุฉ ููุฑูุณููุจูููููุชุฑูููุฑุชุฑุณุช.ุฌุงูุง</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@SpringJUnitConfig</span></span> <span class="hljs-meta"><span class="hljs-meta">@ContextConfiguration</span></span>(classes = AspectConfiguration.class) <span class="hljs-meta"><span class="hljs-meta">@TestExecutionListeners</span></span>(listeners = AutomockTestExecutionListener.class, mergeMode = MERGE_WITH_DEFAULTS) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PersonalizedHoroscopeTellControllerTest</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> LIMIT = <span class="hljs-number"><span class="hljs-number">10</span></span>; <span class="hljs-meta"><span class="hljs-meta">@Automocked</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> PersonalizedHoroscopeTellController controller; <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Predicate&lt;String&gt; ipIsAllowed; <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doNothingWhenAllowed</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ when(ipIsAllowed.test(anyString())).thenReturn(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); controller.tell(randomAlphabetic(LIMIT), randomAlphabetic(LIMIT)); } <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">throwExceptionWhenNotAllowed</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ when(ipIsAllowed.test(anyString())).thenReturn(<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); assertThatThrownBy(() -&gt; controller.tell(randomAlphabetic(LIMIT), randomAlphabetic(LIMIT))) .isInstanceOf(AccessDeniedException.class); } }</code> </pre> <br></div></div><br>  ููุง ุชุฑูู ุ ูุฅู ูุฐุง ุงูุฎูุงุฑ ูู ุงูุฃูุซุฑ <code>@Automocked</code> ุงูููุฏูุฉ ุ ูุง ููุฌุฏ ุณูู ูุญุฏุฉ ุชุญูู ูุญุฏุฉ ุงูุชุญูู (ุจุงูุฅุถุงูุฉ ุฅูู ุชูููู ุงูุฌุงูุจ ุงูุฎุงุต ุจุงูุฌุงูุจ) ุ <code>@Automocked</code> ุงูุชุนููู ุงูุชูุถูุญู <code>@Automocked</code> ุ ููู <u>ุณุญุฑ ุฅูุดุงุก ุงูุญุจูุจ ููุถุนูุง ูู ุงูุณูุงู ูุชู ูุชุงุจุชู ูุฑุฉ ูุงุญุฏุฉ</u> ููููู ุงุณุชุฎุฏุงูู ูู ุงููู ุงูุงุฎุชุจุงุฑุงุช. <br><br><h2 style=";text-align:right;direction:rtl">  ููู ูุนููุ </h2><br>  ุฏุนููุง ูุฑู ููู ูุนูู ููุงุฐุง ูุญุชุงุฌ ููุฐุง. <br><br><h3 style=";text-align:right;direction:rtl">  TestExecutionListener </h3><br>  ููุงู ูุซู ูุฐู ุงููุงุฌูุฉ ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูุฑุจูุน</a> - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">TestExecutionListener</a> .  ูููุฑ ูุงุฌูุฉ ุจุฑูุฌุฉ ุงูุชุทุจููุงุช ููุชุถููู ูู ุนูููุฉ ุชูููุฐ ุงูุงุฎุชุจุงุฑ ูู ูุฑุงุญููุง ุงููุฎุชููุฉ ุ ุนูู ุณุจูู ุงููุซุงู ุ ุนูุฏ ุฅูุดุงุก ูุซูู ููุฆุฉ ุงุฎุชุจุงุฑ ุ ูุจู ุฃู ุจุนุฏ ุงุณุชุฏุนุงุก ุทุฑููุฉ ุงุฎุชุจุงุฑ ุ ุฅูุฎ.  ูุฏูู ุงูุนุฏูุฏ ูู ุงูุชุทุจููุงุช ูู ุฎุงุฑุฌ ููุทูุฉ ุงูุฌุฒุงุก.  ุนูู ุณุจูู ุงููุซุงู ุ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">DirtiesContextTestExecutionListener</a> ุ ุงูุฐู ููุธู ุงูุณูุงู ุฅุฐุง ูุถุนุช ุงูุชุนููู ุงูุชูุถูุญู ุงูููุงุณุจ ุ  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">DependencyInjectionTestExecutionListener</a> - ูุคุฏู ุญูู ุงูุชุจุนูุฉ ูู ุงูุงุฎุชุจุงุฑุงุช ุ ุฅูุฎ.  ูุชุทุจูู ุงููุณุชูุน ุงููุฎุตุต ุงูุฎุงุต ุจู ุนูู ุงูุงุฎุชุจุงุฑ ุ ุชุญุชุงุฌ ุฅูู ูุถุน ุงูุชุนููู ุงูุชูุถูุญู <code>@TestExecutionListeners</code> ูููู ูุงูุฅุดุงุฑุฉ ุฅูู ุงูุชุทุจูู ุงูุฎุงุต ุจู. <br><br><h3 style=";text-align:right;direction:rtl">  ุฃูุฑุช </h3><br>  ููุงู ุฃูุถุง ูุงุฌูุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุฃูุฑุช</a> ูู ุงูุฑุจูุน.  ูุชู ุงุณุชุฎุฏุงูู ููุฅุดุงุฑุฉ ุฅูู ุฃูู ูุฌุจ ูุฑุฒ ุงููุงุฆูุงุช ุจุทุฑููุฉ ูุง.  ุนูู ุณุจูู ุงููุซุงู ุ ุนูุฏูุง ูููู ูุฏูู ุนุฏุฉ ุชุทุจููุงุช ูููุณ ุงููุงุฌูุฉ ูุชุฑุบุจ ูู ุถุฎูุง ูู ูุฌููุนุฉ ุ ูุณูุชู ุทูุจูุง ูู ูุฐู ุงููุฌููุนุฉ ููููุง ููุทูุจ.  ูู ุญุงูุฉ TestExecutionListener ุ ูุดูุฑ ูุฐุง ุงูุชุนููู ุงูุชูุถูุญู ุฅูู ุฃู ุชุฑุชูุจ ูุฌุจ ุชุทุจููู. <br><br>  ูุฐูู ุ ุณูููู ุงููุณุชูุน ูุฏููุง ุจุชูููุฐ ูุงุฌูุงุช 2: <b>TestExecutionListener</b> ู <b>Ordered</b> .  ูุญู ูุณูููุง <b>AutomockTestExecutionListener ูุณูุจุฏู</b> ููุง ููู: <br><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">AutomockTestExecutionListener.java</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Slf</span></span>4j <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AutomockTestExecutionListener</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestExecutionListener</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Ordered</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getOrder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1900</span></span>; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">prepareTestInstance</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> TestContext testContext)</span></span></span><span class="hljs-function"> </span></span>{ val beanFactory = ((DefaultListableBeanFactory) testContext.getApplicationContext().getAutowireCapableBeanFactory()); setByNameCandidateResolver(beanFactory); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (val field : testContext.getTestClass().getDeclaredFields()) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (field.getAnnotation(Automocked.class) == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } log.debug(<span class="hljs-string"><span class="hljs-string">"Performing automocking for the field: {}"</span></span>, field.getName()); makeAccessible(field); setField( field, testContext.getTestInstance(), createBeanWithMocks(findConstructorToAutomock(field.getType()), beanFactory) ); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setByNameCandidateResolver</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> DefaultListableBeanFactory beanFactory)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((beanFactory.getAutowireCandidateResolver() <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> AutomockedBeanByNameAutowireCandidateResolver)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } beanFactory.setAutowireCandidateResolver( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AutomockedBeanByNameAutowireCandidateResolver(beanFactory.getAutowireCandidateResolver()) ); } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Constructor&lt;?&gt; findConstructorToAutomock(<span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Class&lt;?&gt; clazz) { log.debug(<span class="hljs-string"><span class="hljs-string">"Looking for suitable constructor of {}"</span></span>, clazz.getCanonicalName()); Constructor&lt;?&gt; fallBackConstructor = clazz.getDeclaredConstructors()[<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (val constructor : clazz.getDeclaredConstructors()) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (constructor.getParameterTypes().length &gt; fallBackConstructor.getParameterTypes().length) { fallBackConstructor = constructor; } val autowired = getAnnotation(constructor, Autowired.class); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (autowired != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> constructor; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> fallBackConstructor; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> &lt;T&gt; <span class="hljs-function"><span class="hljs-function">T </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createBeanWithMocks</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Constructor&lt;T&gt; constructor, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> DefaultListableBeanFactory beanFactory)</span></span></span><span class="hljs-function"> </span></span>{ createMocksForParameters(constructor, beanFactory); val clazz = constructor.getDeclaringClass(); val beanName = forClass(clazz).toString(); log.debug(<span class="hljs-string"><span class="hljs-string">"Creating bean {}"</span></span>, beanName); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!beanFactory.containsBean(beanName)) { val bean = beanFactory.createBean(clazz); beanFactory.registerSingleton(beanName, bean); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> beanFactory.getBean(beanName, clazz); } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> &lt;T&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createMocksForParameters</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Constructor&lt;T&gt; constructor, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> DefaultListableBeanFactory beanFactory)</span></span></span><span class="hljs-function"> </span></span>{ log.debug(<span class="hljs-string"><span class="hljs-string">"{} is going to be used for auto mocking"</span></span>, constructor); val constructorArgsAmount = constructor.getParameterTypes().length; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; constructorArgsAmount; i++) { val parameterType = forConstructorParameter(constructor, i); val beanName = parameterType.toString(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!beanFactory.containsBean(beanName)) { beanFactory.registerSingleton( beanName, mock(parameterType.resolve(), withSettings().stubOnly()) ); } log.debug(<span class="hljs-string"><span class="hljs-string">"Mocked {}"</span></span>, beanName); } } }</code> </pre> <br></div></div><br>  ูุง ุงูุฐู ูุญุฏุซ ููุงุ  ุฃููุงู ุ ูู ุงูุฃุณููุจ <code>prepareTestInstance()</code> ุ ูุฅูู ูุนุซุฑ ุนูู ูุงูุฉ ุงูุญููู ูุน ุงูุชุนููู ุงูุชูุถูุญู <code>@Automocked</code> : <br><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (val field : testContext.getTestClass().getDeclaredFields()) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (field.getAnnotation(Automocked.class) == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; }</code> </pre> <br>  ุซู ูุฌุนู ูุฐู ุงูุญููู ูุงุจูุฉ ูููุชุงุจุฉ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs">makeAccessible(field);</code> </pre> <br>  ุจุนุฏ ุฐูู ุ ูู ุทุฑููุฉ <code>findConstructorToAutomock()</code> ุ ูุฌุฏ ุงูููุดุฆ ุงูููุงุณุจ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs">Constructor&lt;?&gt; fallBackConstructor = clazz.getDeclaredConstructors()[<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (val constructor : clazz.getDeclaredConstructors()) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (constructor.getParameterTypes().length &gt; fallBackConstructor.getParameterTypes().length) { fallBackConstructor = constructor; } val autowired = getAnnotation(constructor, Autowired.class); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (autowired != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> constructor; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> fallBackConstructor;</code> </pre> <br>  ุงูููุดุฆ ุงูููุงุณุจ ูู ุญุงูุชูุง ูู ุฅูุง ุงูููุดุฆ ุงูุฐู ูุญุชูู ุนูู ุชุนููู ุชูุถูุญู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Autowired</a> ุฃู ุงูููุดุฆ ุงูุฐู ูุญุชูู ุนูู ุฃูุจุฑ ุนุฏุฏ ูู ุงููุณุงุฆุท. <br><br>  ุจุนุฏ ุฐูู ุ ูุชู ุชูุฑูุฑ ุงููููุดุฆ ุงูุฐู ุชู ุงูุนุซูุฑ ุนููู ููุณูุทุฉ ุฅูู ุงูุฃุณููุจ <code>createBeanWithMocks()</code> ุ ูุงูุฐู ุจุฏูุฑู ูุณุชุฏุนู ุงูุฃุณููุจ <code>createMocksForParameters()</code> ุ ุญูุซ ูุชู ุฅูุดุงุก mocks <code>createMocksForParameters()</code> ูุชุณุฌููู ูู ุงูุณูุงู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs">val constructorArgsAmount = constructor.getParameterTypes().length; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; constructorArgsAmount; i++) { val parameterType = forConstructorParameter(constructor, i); val beanName = parameterType.toString(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!beanFactory.containsBean(beanName)) { beanFactory.registerSingleton( beanName, mock(parameterType.resolve(), withSettings().stubOnly()) ); } }</code> </pre> <br>  ูู ุงูููู ููุงุญุธุฉ ุฃูู ุณูุชู ุงุณุชุฎุฏุงู ุชูุซูู ุณูุณูุฉ ูููุน ุงููุณูุทุฉ (ุฌูุจูุง ุฅูู ุฌูุจ ูุน ุงูุฃุฏููุฉ ุงูุนุงูุฉ) ูุงุณู ููุญุงููุฉ.  ููุฐุง ูุนูู ุ ุจุงููุณุจุฉ ุฅูู ูุณูุทุฉ ูู <u><code>packages.Function&lt;String, String&gt;</code> ุณูููู ุชูุซูู ุงูุณูุณูุฉ ูู ุงูุณูุณูุฉ <code>"packages.Function&lt;java.lang.String, java.lang.String&gt;"</code></u> .  ูุฐุง ููู ุ ุณูุนูุฏ ุฅูู ูุฐุง. <br><br>  ุจุนุฏ ุฅูุดุงุก ูุณุฎุฑ ูุฌููุน ุงูุญุฌุฌ ูุชุณุฌูููุง ูู ุงูุณูุงู ุ ูุนูุฏ ุฅูู ุฅูุดุงุก ูุงุตูููุง ูููุฆุฉ ุงูุชุงุจุนุฉ (ุนูู ุณุจูู ุงููุซุงู ุ ูุญุฏุฉ ุงูุชุญูู ูู ุญุงูุชูุง): <br><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!beanFactory.containsBean(beanName)) { val bean = beanFactory.createBean(clazz); beanFactory.registerSingleton(beanName, bean); }</code> </pre> <br>  ูุฌุจ ุนููู ุฃูุถูุง ุงูุงูุชุจุงู ุฅูู ุญูููุฉ ุฃููุง ุงุณุชุฎุฏููุง <u>ุงูุฃูุฑ 1900</u> .  ูุนุฏ ุฐูู ุถุฑูุฑููุง ูุฃูู ูุฌุจ ุงุณุชุฏุนุงุก ุงููุณุชูุน ุงูุฎุงุต ุจูุง ุจุนุฏ ูุณุญ ุณูุงู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">DirtiesContextBeforeModesTestExecutionListener</a> 'ุฃูู (ุชุฑุชูุจ = 1500) ููุจู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">DependencyInjectionTestExecutionListener</a> ' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">s</a> ุญูู ุงูุชุจุนูุฉ (ุชุฑุชูุจ = 2000) ุ ูุฃู ุงููุณุชูุน ูุฏููุง ุจุฅูุดุงุก ุตูุงุฏูู ุฌุฏูุฏุฉ. <br><br><h2 style=";text-align:right;direction:rtl">  AutowireCandidateResolver </h2><br>  ูุณุชุฎุฏู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">AutowireCandidateResolver</a> ูุชุญุฏูุฏ ูุง ุฅุฐุง ูุงู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">BeanDefinition ูุทุงุจู</a> ูุตู ุงูุชุจุนูุฉ.  ูุฏูู ุงูุนุฏูุฏ ูู ุงูุชุทุจููุงุช "ุฎุงุฑุฌ ุงูุตูุฏูู" ุ ูู ุจูููุง: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูุญุฏุฏ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">QualifierAnnotationAutowireCandidateResolver</a> - ูุง ุฅุฐุง ูุงูุช ุงูุชุจุนูุฉ ููุงุณุจุฉ ุจูุงุกู ุนูู Qualifier ุ </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">GenericTypeAwareAutowireCandidateResolver</a> - ูุญุฏุฏ ูุง ุฅุฐุง ูุงูุช ุงูุชุจุนูุฉ ููุงุณุจุฉ ุงุณุชูุงุฏูุง ุฅูู ุงูุฃุฏููุฉ ุงูุนุงูุฉ ุ </li><li style=";text-align:right;direction:rtl">  ูุบูุฑูุง. </li></ul><br>  ูู ุงูููุช ููุณู ุ ูุฅู ุชุทุจูู "ุฎุงุฑุฌ ุงูุตูุฏูู" ูู โโุฏููุฉ ุฑูุณูุฉ ูู ุงูููุฑุงุซ ุ ุฃู  ุฃููุง ุชุชูุณุน ุจุนุถูุง ุงูุจุนุถ.  ุณููุชุจ ุฏูููุฑ ุ ูุฃูู  ูู ุฃูุซุฑ ูุฑููุฉ. <br><br>  ูุนูู ูุญูู ุนูู ุงููุญู ุงูุชุงูู: <br><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูุฃุฎุฐ ุงูุฑุจูุน ูุงุตู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูุชุจุนูุฉ</a> - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">DependencyDescriptor</a> ุ <br></li><li style=";text-align:right;direction:rtl">  ุซู ูุฃุฎุฐ ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">BeanDefinition</a> ูู ุงููุฆุฉ ุงูููุงุณุจุฉุ <br></li><li style=";text-align:right;direction:rtl">  ูุชูุฑุฑ ุนุจุฑ BeanDefinitions ุ ุงุณุชุฏุนุงุก ุฃุณููุจ <code>isAutowireCandidate()</code> ูู ูุญูู ุ <br></li><li style=";text-align:right;direction:rtl">  ุงุนุชูุงุฏูุง ุนูู ูุง ุฅุฐุง ูุงู ูุตู ุงูุญุงููุฉ ูุชุทุงุจู ูุน ูุตู ุงูุชุจุนูุฉ ุฃู ูุง ุ ุชูุฑุฌุน ุงูุทุฑููุฉ ุตุญ ุฃู ุฎุทุฃ. <br></li></ol><br><h2 style=";text-align:right;direction:rtl">  ููุงุฐุง ุชุญุชุงุฌ ูุญูู ุงูุฎุงุต ุจูุ </h2><br>  ุงูุขู ุฏุนููุง ูุฑู ููุงุฐุง ูุญู ุจุญุงุฌุฉ ุฅูู ูุญูู ูุฏููุง ุนูู ุณุจูู ุงููุซุงู ูู ูุญุฏุฉ ุชุญูู ูุฏููุง. <br><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PersonalizedHoroscopeTellController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> HoroscopeTeller horoscopeTeller; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Function&lt;String, ZodiacSign&gt; zodiacSignConverter; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Function&lt;String, String&gt; nameNormalizer; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PersonalizedHoroscopeTellController</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> HoroscopeTeller horoscopeTeller, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Function&lt;String, ZodiacSign&gt; zodiacSignConverter, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Function&lt;String, String&gt; nameNormalizer )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.horoscopeTeller = horoscopeTeller; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.zodiacSignConverter = zodiacSignConverter; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.nameNormalizer = nameNormalizer; }</code> </pre> <br>  ููุง ุชุฑูู ุ ููุฏ ุงุซููู ูู ุงูุชุจุนูุงุช ูู ููุณ ุงูููุน - <b>ูุธููุฉ</b> ุ ูููู ูุน ุงูุฃุฏููุฉ ุงูุฌููุณุฉ ูุฎุชููุฉ.  ูู ุญุงูุฉ ูุงุญุฏุฉ ุ <b>String</b> ู <b>ZodiacSign</b> ุ ูู ุงูุญุงูุฉ ุงูุฃุฎุฑู ุ <b>String</b> ู <b>String</b> .  ูุงููุดููุฉ ูู ุฐูู ูู ุฃู <u>ููููุชู ุบูุฑ ูุงุฏุฑ ุนูู ุฅูุดุงุก ูููุณ ูุน ูุฑุงุนุงุฉ ุงูุฃุฏููุฉ ุงูุฌููุณุฉ</u> .  ุฃู  ุฅุฐุง ุฃูุดุฃูุง mokas ููุฐู ุงูุชุจุนูุงุช ููุถุนูุงูุง ูู ุณูุงููุง ุ ููู ูุชููู Spring ูู ุญูููุง ูู ูุฐู ุงููุฆุฉ ุ ูุฃููุง ูู ุชุญุชูู ุนูู ูุนูููุงุช ุญูู ุงูุฃุฏููุฉ ุงูุนุงูุฉ.  ูุณูุฑู ุงุณุชุซูุงุก ุฃูู ูู ุงูุณูุงู ููุฌุฏ ุฃูุซุฑ ูู ุญุจุฉ ูุงุญุฏุฉ ูู ูุฆุฉ <b>ุงูุฏุงูุฉ</b> .  ุฅููุง ุจุงูุถุจุท ูุฐู ุงููุดููุฉ ุงูุชู ุณูุญููุง ุจูุณุงุนุฏุฉ ูุญูููุง.  ุจุนุฏ ูู ุดูุก ุ ููุง ุชุชุฐูุฑ ุ ูู ุชุทุจูููุง ูู ุงููุณุชูุน ุ ุงุณุชุฎุฏููุง ููุนูุง ูู ุงููุฑุงุซุฉ ูุงุณู ููุญุงููุฉ ุ ููุง ูุนูู ุฃู ูู ูุง ูุญุชุงุฌ ุฅููู ูู ุชุนููู ุงูุฑุจูุน ูููุงุฑูุฉ ููุน ุงูุชุจุนูุฉ ูุน ุงุณู ุงูุญุงููุฉ. <br><br><h2 style=";text-align:right;direction:rtl">  AutomockedBeanByNameAutowireCandidateResolver </h2><br>  ูุฐูู ุ ุณูู ูููู <code>isAutowireCandidate()</code> ุจุนูู ูุง ูุชุจุชู ุฃุนูุงู ุชูุงููุง ุ <code>isAutowireCandidate()</code> ุชูููุฐ ุทุฑููุฉ <code>isAutowireCandidate()</code> ููุง ููู: <br><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">AutowireCandidateResolver.isAutowireCandidate ()</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isAutowireCandidate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(BeanDefinitionHolder beanDefinitionHolder, DependencyDescriptor descriptor)</span></span></span><span class="hljs-function"> </span></span>{ val dependencyType = descriptor.getResolvableType().resolve(); val dependencyTypeName = descriptor.getResolvableType().toString(); val candidateBeanDefinition = (AbstractBeanDefinition) beanDefinitionHolder.getBeanDefinition(); val candidateTypeName = beanDefinitionHolder.getBeanName(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (candidateTypeName.equals(dependencyTypeName) &amp;&amp; candidateBeanDefinition.getBeanClass() != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> candidateResolver.isAutowireCandidate(beanDefinitionHolder, descriptor); }</code> </pre> <br></div></div><br>  ููุง ูุญุตู ุนูู ุชูุซูู ุณูุณูุฉ ูููุน ุงูุชุจุนูุฉ ูู ูุตู ุงูุชุจุนูุฉ ุ ููุญุตู ุนูู ุงุณู ุงูุญุจุฉ ูู BeanDefinition (ุงูุฐู ูุญุชูู ุจุงููุนู ุนูู ุชูุซูู ุณูุณูุฉ ูููุน ุงูุญุจุฉ) ุ ุซู ูููู ุจููุงุฑูุชูุง ุ ูุฅุฐุง ูุงู ูุทุงุจููุง ุ ูุณูุชู ุฅุฑุฌุงุนู.  ุฅุฐุง ูู ุชูู ูุชุทุงุจูุฉ ุ ูุณุชููุถ ุฅูู ูุญูู ุฏุงุฎูู. <br><br><h2 style=";text-align:right;direction:rtl">  ุงุฎุชุจุงุฑ ุฎูุงุฑุงุช ุชุฑุทูุจ ุจู </h2><br>  ูู ุงููุฌููุน ุ ูู ุงูุงุฎุชุจุงุฑุงุช ุ ูููููุง ุงุณุชุฎุฏุงู ุงูุฎูุงุฑุงุช ุงูุชุงููุฉ ูุชุฑุทูุจ ุงูุตูุงุฏูู: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุชูููู Java - ุณูููู ุฃูุฑูุง ุถุฑูุฑููุง ุ ุถุฎููุง ุ ูุญุชูู ุนูู ูุงูุจ ูุญุงุณู ุ ูููู ุฑุจูุง ูููู ูููุฏูุง ูุฏุฑ ุงูุฅููุงู ุ <br></li><li style=";text-align:right;direction:rtl">  <code>@MockBean</code> - ุณูููู ุฅุนูุงูููุง ุ ูุฃูู ุชุนููุฏูุง ูู Java Config ุ ูููู ุณูุธู ููุงู ุตููุญุฉ ุตุบูุฑุฉ ูู ุดูู ุญููู ุฐุงุช ุชุจุนูุงุช ุบูุฑ ูุณุชุฎุฏูุฉ ูู ุงูุงุฎุชุจุงุฑ ููุณู ุ <br></li><li style=";text-align:right;direction:rtl">  <code>@Automocked</code> + ูุญูู ูุฎุตุต - ุงูุญุฏ ุงูุฃุฏูู ูู ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ูู ุงูุงุฎุชุจุงุฑุงุช ู boilerplate ุ ูููู ูุญุชูู ุฃู ูููู ูุทุงู ุถูู ููุบุงูุฉ ููุฐุง ูุง ูุฒุงู ูุญุชุงุฌ ุฅูู ูุชุงุจุชูุง.  ูููู ูููู ุฃู ุชููู ูุฑูุญุฉ ููุบุงูุฉ ุญูุซ ุชุฑูุฏ ุงูุชุฃูุฏ ูู ุฃู ุงูุฑุจูุน ุจุดูู ุตุญูุญ ูุฎูู ูููุงุก. <br></li></ul><br><h2 style=";text-align:right;direction:rtl">  ุฅุถุงูุฉ ุงูุฏูููุฑ </h2><br>  ูุฑูููุง <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุญุจ</a> ูุงูุจ ุชุตููู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Decorator</a> ููุฑููุชู.  ูู ุงููุงูุน ุ ูุฅู ุงูุฌูุงูุจ ุชููุฐ ูุฐุง ุงูููุท ุจุงูุฐุงุช.  ูููู ูู ุญุงูุฉ ุชูููู ุณูุงู ุงูุฑุจูุน ูุน ุงูุชุนูููุงุช ุงูุชูุถูุญูุฉ ูุงุณุชุฎุฏุงู ุชูุญุต ุงูุญุฒูุฉ ุ ูุณุชูุงุฌู ูุดููุฉ.  ุฅุฐุง ูุงู ูุฏูู ุงูุนุฏูุฏ ูู ุชุทุจููุงุช ููุณ ุงููุงุฌูุฉ ูู ุงูุณูุงู ุ ูุนูุฏ <b>ุจุฏุก</b> ุชุดุบูู ุงูุชุทุจูู ุ <b>ูุณูู ุชุณูุท NoUniqueBeanDefinitionException</b> ุ ุฃู  ูู ูููู ุงูุฑุจูุน ูุงุฏุฑูุง ุนูู ูุนุฑูุฉ ุฃู ูู ุงูุญุจูุจ ูุฌุจ ุญููู.  ุชุญุชูู ูุฐู ุงููุดููุฉ ุนูู ุงูุนุฏูุฏ ูู ุงูุญููู ุ ูุจุนุฏ ุฐูู ุณููุธุฑ ูููุง ุ ูููู ุฃููุงู ุ ุฏุนููุง ูุชุนุฑู ุนูู ููููุฉ ุชุบูุฑ ุชุทุจูููุง. <br><br>  ุงูุขู ูุฏู ูู ูู ูุงุฌูุงุช <b>FortuneTeller</b> ู <b>HoroscopeTeller</b> ุชุทุจูู ูุงุญุฏ ุ ุณูุถูู <b>ุชุทุจูููู ุฅุถุงูููู</b> ููู ูู ุงููุงุฌูุงุช: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f1b/efb/01b/f1befb01b6356587cfe2c1728c7f2b0f.png"><br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุงูุชุฎุฒูู ุงููุคูุช ... - ุฏูููุฑ ุงูุชุฎุฒูู ุงููุคูุช. <br></li><li style=";text-align:right;direction:rtl">  ุชุณุฌูู ... ูู ุงูุฏูููุฑ ุชุณุฌูู. <br></li></ul><br>  ุฅุฐุง ููู ููููู ุญู ูุดููุฉ ุชุญุฏูุฏ ุชุฑุชูุจ ุงููุงุตูููุงุ <br><br><h2 style=";text-align:right;direction:rtl">  ุฌุงูุง ุงูุชูููู ูุน ุฏูููุฑ ุงููุณุชูู ุงูุฃุนูู </h2><br>  ููููู ุงุณุชุฎุฏุงู Java Config ูุฑุฉ ุฃุฎุฑู.  ูู ูุฐู ุงูุญุงูุฉ ุ ุณูููู ุจูุตู ุงููุงุตูููุง ูุทุฑู ููุฆุฉ ุงูุชูููู ุ ูุณูุชุนูู ุนูููุง ุชุญุฏูุฏ ุงููุณุงุฆุท ุงููุงุฒูุฉ ูุงุณุชุฏุนุงุก ูููุดุฆ ุงููุงุตูููุง ููุณูุทุงุช ููุฐู ุงูุทุฑููุฉ.  ูู ุงูุฐู ูุชุจุน ุฐูู ูู ุญุงูุฉ ุญุฏูุซ ุชุบููุฑ ูู ูููุดุฆ ุณูุฉ ุงูููููุงุช ุ ุณูุชุนูู ุนูููุง ุชุบููุฑ ุงูุชูููู ุ ููู ุฃูุฑ ุบูุฑ ุฑุงุฆุน ุฌุฏูุง.  ูู ูุฒุงูุง ูุฐุง ุงูุฎูุงุฑ: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุณูููู ููุงู ุงุชุตุงู ููุฎูุถุฉ ุจูู ุงูุฏูููุฑ ุ ููุง  ุณูุชู ูุตู ุงูุนูุงูุฉ ุจููููุง ูู ุงูุชููุฆุฉ ุ ุฃู  ูู ูุนุฑููุง ุดูุฆูุง ุนู ุจุนุถูู ุงูุจุนุถ ุ <br></li><li style=";text-align:right;direction:rtl">  ุณูุชู ุชุฑุฌูุฉ ุฌููุน ุงูุชุบููุฑุงุช ูู ุชุฑุชูุจ ุงูุฏูููุฑ ูู ููุงู ูุงุญุฏ - ุงูุชูููู. <br></li></ul><br>  ูู ุญุงูุชูุง ุ ุณูุจุฏู Java Config ุจุงูุดูู ุงูุชุงูู: <br><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">DomainConfig.java</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DomainConfig</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> FortuneTeller </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fortuneTeller</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Map&lt;FortuneRequest, FortuneResponse&gt; cache, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> FortuneResponseRepository fortuneResponseRepository, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Function&lt;FortuneRequest, PersonalData&gt; personalDataExtractor, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> PersonalDataRepository personalDataRepository )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LoggingFortuneTeller( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CachingFortuneTeller( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Globa(fortuneResponseRepository, personalDataExtractor, personalDataRepository), cache ) ); } <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> HoroscopeTeller </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">horoscopeTeller</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Map&lt;ZodiacSign, Horoscope&gt; cache, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> HoroscopeRepository horoscopeRepository )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LoggingHoroscopeTeller( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CachingHoroscopeTeller( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Gypsy(horoscopeRepository), cache ) ); } }</code> </pre> <br></div></div><br>  ููุง ุชุฑูู ุ ูุชู ุงูุฅุนูุงู ุนู ุญุจุฉ ูุงุญุฏุฉ ููุท ููู ูู ุงููุงุฌูุงุช ุ ูุชุชุถูู ุงูุทุฑู ูู ุงููุณูุทุงุช ุชุจุนูุงุช ูู ุงููุงุฆูุงุช ุงูุชู ุชู ุฅูุดุงุคูุง ุฏุงุฎููุง.  ูู ูุฐู ุงูุญุงูุฉ ุ ูููู ููุทู ุฅูุดุงุก ุงููุงุตูููุง ูุงุถุญูุง ุฅูู ุญุฏ ูุง. <br><br><h2 style=";text-align:right;direction:rtl">  ุงูุชุตููุงุช </h2><br>  ููููู ุงุณุชุฎุฏุงู ุงูุชุนูููุงุช ุงูุชูุถูุญูุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Qualifier</a> .  ุณูููู ูุฐุง ุฃูุซุฑ ุชุนุฑูููุง ูู Java Config ุ ูููู ูู ูุฐู ุงูุญุงูุฉ ุ ุณุชุญุชุงุฌ ุฅูู ุชุญุฏูุฏ ุงุณู ุงูุญุจุฉ ุงูุชู ุชุนุชูุฏ ุนูููุง ุงูุญุจุฉ ุงูุญุงููุฉ ุจุดูู ุตุฑูุญ.  ูุง ูุชุถููู ุงูุนูุจ: ุฒูุงุฏุฉ ุงูุงุชุตุงู ุจูู ุงูุตูุงุฏูู.  ููุธุฑูุง ูุฒูุงุฏุฉ ุงูุงุชุตุงู ุ ุญุชู ูู ุญุงูุฉ ุญุฏูุซ ุชุบููุฑ ูู ุชุฑุชูุจ ุงูุฏูููุฑ ุ ุณูุชู ุชูุทูุฎ ุงูุชุบููุฑุงุช ุจุงูุชุณุงูู ุนูู ุงูููุฏ.  ุฃู ุฅุฐุง ุชู ุฅุถุงูุฉ ุฏูููุฑ ุฌุฏูุฏ ุ ุนูู ุณุจูู ุงููุซุงู ุ ูู ููุชุตู ุงูุณูุณูุฉ ุ ุณุชุคุซุฑ ุงูุชุบููุฑุงุช ุนูู ูุฆุชูู ุนูู ุงูุฃูู. <br><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">LoggingFortuneTeller.java</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Primary</span></span> <span class="hljs-meta"><span class="hljs-meta">@Component</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LoggingFortuneTeller</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FortuneTeller</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> FortuneTeller internal; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Logger logger; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LoggingFortuneTeller</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( @Qualifier(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"cachingFortuneTeller"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> @NonNull </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">final</span></span></span><span class="hljs-function"> FortuneTeller internal ) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.internal = internal; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.logger = getLogger(internal.getClass()); }</code> </pre> <br></div></div><br>        , ,       (      ,  <b>FortuneTeller</b> ,   ),      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">@Primary</a> .     <b>internal</b>   <code>@Qualifier</code>    ,     โ <b>cachingFortuneTeller</b> .         . <br><br><h2 style=";text-align:right;direction:rtl"> Custom qualifier </h2><br>    2.5       Qualifier',    .     . <br><br>     enum   : <br><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> DecoratorType { LOGGING, CACHING, NOT_DECORATOR }</code> </pre> <br>    ,    qualifier': <br><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Qualifier</span></span> <span class="hljs-meta"><span class="hljs-meta">@Retention</span></span>(RUNTIME) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-meta"><span class="hljs-meta">@interface</span></span> Decorator { <span class="hljs-function"><span class="hljs-function">DecoratorType </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">value</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">default</span></span></span><span class="hljs-function"> NOT_DECORATOR</span></span>; }</code> </pre> <br>  :    ,       <code>@Qualifier</code> ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">CustomAutowireConfigurer</a> ,        . <br><br>         Qualifier'   : <br><br><div class="spoiler" style=";text-align:right;direction:rtl"> <b class="spoiler_title">CachingFortuneTeller.java</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Decorator</span></span>(CACHING) <span class="hljs-meta"><span class="hljs-meta">@Component</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CachingFortuneTeller</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FortuneTeller</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> FortuneTeller internal; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Map&lt;FortuneRequest, FortuneResponse&gt; cache; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CachingFortuneTeller</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( @Decorator(NOT_DECORATOR)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">final</span></span></span><span class="hljs-function"> FortuneTeller internal, </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">final</span></span></span><span class="hljs-function"> Map&lt;FortuneRequest, FortuneResponse&gt; cache ) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.internal = internal; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.cache = cache; }</code> </pre> <br></div></div><br>   โ    ,      <code>@Decorator</code>   ,   ,     โ      ,      <u> </u> ,     <b>FortuneTeller</b> ',    โ <b>Globa</b> . <br><br>       Qualifier' - , - . ,          ,     . ,      -    โ      ,     ,      . <br><br><h2 style=";text-align:right;direction:rtl"> DecoratorAutowireCandidateResolver </h2><br>   โ   !      ! :)   ,     -     ,   Java Config',        . ,   -    ,     .     : <br><br><div class="spoiler" style=";text-align:right;direction:rtl"> <b class="spoiler_title">DomainConfig.java</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DomainConfig</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> OrderConfig&lt;FortuneTeller&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fortuneTellerOrderConfig</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> () -&gt; asList( LoggingFortuneTeller.class, CachingFortuneTeller.class, Globa.class ); } <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> OrderConfig&lt;HoroscopeTeller&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">horoscopeTellerOrderConfig</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> () -&gt; asList( LoggingHoroscopeTeller.class, CachingHoroscopeTeller.class, Gypsy.class ); } }</code> </pre> <br></div></div><br>     โ    Java Config'       ,       โ . ,     ! <br><br>     -   .   , ,    ,      .    : <br><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@FunctionalInterface</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OrderConfig</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; </span></span>{ List&lt;Class&lt;? extends T&gt;&gt; getClasses(); }</code> </pre> <br><h3 style=";text-align:right;direction:rtl"> BeanDefinitionRegistryPostProcessor </h3><br>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">BeanDefinitionRegistryPostProcessor</a> ,   BeanFactoryPostProcessor,   , ,  ,      BeanDefinition'.  ,      BeanFactoryPostProcessor,    . <br><br>    : <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">   BeanDefinition'; <br></li><li style=";text-align:right;direction:rtl">  BeanDefinition' ,   <b>OrderConfig</b> '.  , ..              BeanDefinition'   ; <br></li><li style=";text-align:right;direction:rtl">   ,   <b>OrderConfig</b> ',  BeanDefinition',    ,     () . <br></li></ul><br><h3 style=";text-align:right;direction:rtl"> BeanFactoryPostProcessor </h3><br>      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">BeanFactoryPostProcessor</a> ,      BeanDefinition'  ,    . ,      ยซ Spring-ยป. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/459/cac/4c5/459cac4c50791a09e9195d53fe51b9e0.png"><br><br> ,      , โ       AutowireCandidateResolver': <br><br><div class="spoiler" style=";text-align:right;direction:rtl"> <b class="spoiler_title">DecoratorAutowireCandidateResolverConfigurer.java</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Component</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DecoratorAutowireCandidateResolverConfigurer</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BeanFactoryPostProcessor</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">postProcessBeanFactory</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ConfigurableListableBeanFactory configurableListableBeanFactory)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> BeansException </span></span>{ Assert.state(configurableListableBeanFactory <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> DefaultListableBeanFactory, <span class="hljs-string"><span class="hljs-string">"BeanFactory needs to be a DefaultListableBeanFactory"</span></span>); val beanFactory = (DefaultListableBeanFactory) configurableListableBeanFactory; beanFactory.setAutowireCandidateResolver( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DecoratorAutowireCandidateResolver(beanFactory.getAutowireCandidateResolver()) ); } }</code> </pre> <br></div></div><br><br><h3 style=";text-align:right;direction:rtl"> DecoratorAutowireCandidateResolver </h3><br>       : <br><div class="spoiler" style=";text-align:right;direction:rtl"> <b class="spoiler_title">DecoratorAutowireCandidateResolver.java</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@RequiredArgsConstructor</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DecoratorAutowireCandidateResolver</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AutowireCandidateResolver</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> AutowireCandidateResolver resolver; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isAutowireCandidate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> BeanDefinitionHolder bdHolder, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> DependencyDescriptor descriptor)</span></span></span><span class="hljs-function"> </span></span>{ val dependentType = descriptor.getMember().getDeclaringClass(); val dependencyType = descriptor.getDependencyType(); val candidateBeanDefinition = (AbstractBeanDefinition) bdHolder.getBeanDefinition(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (dependencyType.isAssignableFrom(dependentType)) { val candidateQualifier = candidateBeanDefinition.getQualifier(OrderQualifier.class.getTypeName()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (candidateQualifier != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> dependentType.getTypeName().equals(candidateQualifier.getAttribute(<span class="hljs-string"><span class="hljs-string">"value"</span></span>)); } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> resolver.isAutowireCandidate(bdHolder, descriptor); }</code> </pre> <br></div></div><br>    descriptor'   (dependencyType)     (dependentType): <br><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs">val dependentType = descriptor.getMember().getDeclaringClass(); val dependencyType = descriptor.getDependencyType();</code> </pre> <br>    bdHolder' BeanDefinition: <br><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs">val candidateBeanDefinition = (AbstractBeanDefinition) bdHolder.getBeanDefinition();</code> </pre> <br>       .    ,     : <br><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs">dependencyType.isAssignableFrom(dependentType)</code> </pre> <br>    ,      , ..      . <br><br>   BeanDefinition'       : <br><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs">val candidateQualifier = candidateBeanDefinition.getQualifier(OrderQualifier.class.getTypeName());</code> </pre> <br>    ,         : <br><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (candidateQualifier != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> dependentType.getTypeName().equals(candidateQualifier.getAttribute(<span class="hljs-string"><span class="hljs-string">"value"</span></span>)); }</code> </pre> <br>    โ     (),   โ  false. <br><br><h3 style=";text-align:right;direction:rtl">    </h3><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"> ,           <a href="">ConfigurationClassBeanDefinitionReader</a> '; <br></li><li style=";text-align:right;direction:rtl">              ,   BeanDefintion'    Qualifier'.                 ,      . <br></li></ul><br><h2 style=";text-align:right;direction:rtl">     </h2><br> ,          : <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"> Java Config โ   ,  ,      ,        ; <br></li><li style=";text-align:right;direction:rtl"> <code>@Qualifier</code> โ  ,      -       ; <br></li><li style=";text-align:right;direction:rtl"> Custom qualifier โ   ,     Qualifier',   ; <br></li><li style=";text-align:right;direction:rtl">     - โ ,  ,     ,     . <br></li></ul><br><h2 style=";text-align:right;direction:rtl">  ุงูุงุณุชูุชุงุฌุงุช </h2><br>  ,          ,     .           โ :   .    ,               , ,  .    โ   ,            JRE.     ,      ,   . <br><br>   ,      โ  ,   ,        - .  ุดูุฑุง ูููุฑุงุกุฉ! <br><br>     : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">https://github.com/monosoul/spring-di-customization</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar435364/">https://habr.com/ru/post/ar435364/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar435352/index.html">ูุคุชูุฑ DEFCON 18. ุงูุชุฌุณุณ ุงูุนููู ุจุงุณุชุฎุฏุงู ุงููุงุชู ุงููุญููู. ุงูุฌุฒุก 2</a></li>
<li><a href="../ar435354/index.html">ูุคุชูุฑ DEFCON 18. ุงูุชุฌุณุณ ุงูุนููู ุจุงุณุชุฎุฏุงู ุงููุงุชู ุงููุญููู. ุงูุฌุฒุก 1</a></li>
<li><a href="../ar435358/index.html">ุงูุขุซุงุฑ: Minidisk ูู ุนุตุฑ ุจูุฏ</a></li>
<li><a href="../ar435360/index.html">Snippets vs Clover - ูุงุฒ ุนูู ูุณุงุจูุฉ ูู ุงูููุช ุงูุญูููู ุงูุฃูุซุฑ ุดุนุจูุฉ</a></li>
<li><a href="../ar435362/index.html">ุชุฌุฒุฆุฉ ุงูุณุฑุนุฉ</a></li>
<li><a href="../ar435368/index.html">ุงูุชุดุฑูุญ ุงููุฑุถู ูู ููุงู ุงูุนูู</a></li>
<li><a href="../ar435372/index.html">ุจุถุน ูููุงุช ุนู FastPath ู FastTrack ูู MikroTik</a></li>
<li><a href="../ar435374/index.html">ุงูุฑูุงุถูุงุช ูู Gamedev ุจุณูุทุฉ. ุงูุชุซููุซ ูุงููุซูุซ. ุงูุตุงูู ูู ุงููุญุฏุฉ</a></li>
<li><a href="../ar435376/index.html">ุงููุถุงุก 2019: ุงูุณูู ุงููุฃูููุฉ ูุงูุตูุงุฑูุฎ ุงูุฌุฏูุฏุฉ ูุชุญูููุงุช ุงูููุฑ</a></li>
<li><a href="../ar435380/index.html">ุณุชููู ุงูุญุณุงุจุงุช ุงููุฌุงููุฉ ุนูู GitHub ูุงุฏุฑุฉ ุนูู [ุชูุฑูุจูุง] ุจุฏูู ูููุฏ ุงูุนูู ูุน ุงููุณุชูุฏุนุงุช ุงูุฎุงุตุฉ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>