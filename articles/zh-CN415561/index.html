<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸŒ— ğŸ‘¨ğŸ¾â€ğŸŒ¾ ğŸ’Œ å¦‚ä½•å°†äº‹ä»¶ä»Veeam Backupï¼†Replicationæ¨é€åˆ°å³æ—¶é€šè®¯ç¨‹åºä¸­ ğŸ˜” ğŸ‘ âºï¸</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="å¤§å®¶å¥½ï¼ åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†è®¨è®ºå¦‚ä½•ä»Veeam Backupï¼†Replication v9.5å‘MS Teamæä¾›æœ‰å…³æ“ä½œç»“æœçš„ä¿¡æ¯ã€‚ å¸–å­ä¸­æè¿°çš„æ–¹æ³•ä¸ä»…å¯ä»¥åœ¨æ­¤æ–¹æ³•ä¸­ä½¿ç”¨ï¼Œè€Œä¸”å¯ä»¥åœ¨ä»»ä½•å…¶ä»–Messengerä¸­ä½¿ç”¨-æ‚¨åªéœ€è¦ä½¿ç”¨é…ç½®æ–‡ä»¶APIæ¥ç»„ç»‡æ¶ˆæ¯ä¼ é€’ã€‚ 



 é¦–å…ˆï¼Œæƒ³è±¡ä¸€ä¸‹æˆ‘ä»¬è¦å®ç°...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>å¦‚ä½•å°†äº‹ä»¶ä»Veeam Backupï¼†Replicationæ¨é€åˆ°å³æ—¶é€šè®¯ç¨‹åºä¸­</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/veeam/blog/415561/"> å¤§å®¶å¥½ï¼ åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†è®¨è®ºå¦‚ä½•ä»Veeam Backupï¼†Replication v9.5å‘MS Teamæä¾›æœ‰å…³æ“ä½œç»“æœçš„ä¿¡æ¯ã€‚ å¸–å­ä¸­æè¿°çš„æ–¹æ³•ä¸ä»…å¯ä»¥åœ¨æ­¤æ–¹æ³•ä¸­ä½¿ç”¨ï¼Œè€Œä¸”å¯ä»¥åœ¨ä»»ä½•å…¶ä»–Messengerä¸­ä½¿ç”¨-æ‚¨åªéœ€è¦ä½¿ç”¨é…ç½®æ–‡ä»¶APIæ¥ç»„ç»‡æ¶ˆæ¯ä¼ é€’ã€‚ <br><br><img src="https://habrastorage.org/getpro/habr/post_images/209/f66/694/209f66694e77ec9771ff67bf1461bde9.png"><br><a name="habracut"></a><br> é¦–å…ˆï¼Œæƒ³è±¡ä¸€ä¸‹æˆ‘ä»¬è¦å®ç°çš„ç›®æ ‡ã€‚ æˆ‘ä»¬å¸Œæœ›åœ¨ä¸€ä¸ªå‘½ä»¤é€šé“ä¸­æ¥æ”¶æœ‰å…³ä¸€ä¸ªå¤‡ä»½è½¯ä»¶å®ä¾‹å‘ç”Ÿçš„æƒ…å†µçš„ä¿¡æ¯ã€‚ è¯¥åŠŸèƒ½å¾ˆæœ‰ç”¨ï¼Œå®ƒå°†å¯¹å„¿ç«¥å’Œæˆäººå‡æœ‰ç”¨ï¼Œå®ƒå°†ä½¿æ‚¨çš„çµé­‚ä¼´ä¾£é«˜å…´ï¼Œå¹¶å°†æˆä¸ºèŠ‚æ—¥é¤æ¡Œçš„ç»ä½³è£…é¥°ã€‚ æ¢å¥è¯è¯´ï¼Œæ‚¨å¯ä»¥è‡ªå·±æå‡ºä¸€ä¸ªç‰¹å®šçš„ç”¨ä¾‹ã€‚ æˆ‘ç»ä¸å¸Œæœ›é™åˆ¶æ‚¨çš„æƒ³è±¡åŠ›-æˆ‘ä»¬å°†è€ƒè™‘ä½¿ç”¨åŸå‹ã€‚ <br><br> æˆ‘ä»¬å°†ä»¥æœ€ç®€å•çš„æ–¹å¼è§£å†³é—®é¢˜ï¼šä»Veeam SQLæ•°æ®åº“ä¸­æŠ¢åŠ«æ•°æ®ï¼Œè§£æä¸€ç‚¹ï¼Œç„¶åä½¿ç”¨ä¼ å…¥çš„WebHookè¿æ¥å™¨å°†å…¶å‘é€åˆ°é€šé“ã€‚ è¿™æ˜¯è¡ŒåŠ¨è®¡åˆ’ï¼š <br><br><ol><li> æˆ‘ä»¬è¿æ¥åˆ°Veeamæ•°æ®åº“ï¼Œå¹¶ä»[dbo]ã€‚[Backup.Model.JobSessions]è·å–ä¿¡æ¯ã€‚ </li><li> æˆ‘ä»¬åœ¨è¦å‘é€æ¶ˆæ¯çš„é€šé“ä¸­åˆ›å»ºâ€œä¼ å…¥WebHookè¿æ¥å™¨â€ã€‚ </li><li> å°†å…¶å…¨éƒ¨ç»“åˆä½¿ç”¨python magicä½¿å…¶æœ‰æ•ˆã€‚ </li><li> å°†ç”Ÿæˆçš„è‰å›¾åŒ…è£…åœ¨Dockerå®¹å™¨ä¸­ã€‚ </li><li> å°±æ˜¯è¿™æ ·ï¼ </li></ol><br><h2> è¿æ¥åˆ°Veeamå¤‡ä»½å’Œå¤åˆ¶æ•°æ®åº“ </h2><br> é¦–å…ˆï¼Œåœ¨MS SQLå®ä¾‹çš„ä¸€ä¾§åˆ›å»ºç”¨æˆ·ã€‚ æˆ‘ä»¬è€ƒè™‘ä½¿ç”¨MS SQLï¼Œå› ä¸ºè¿™æ˜¯æˆ‘ä»¬çš„è½¯ä»¶é¢„å…ˆå®‰è£…çš„é»˜è®¤é€‰é¡¹ã€‚ æˆ‘ä»¬ä¸ºç”¨æˆ·æä¾›æœ€å°çš„æƒé™-ä»…ä»ä¸€ä¸ªè¡¨ä¸­é€‰æ‹©å¹¶ä¸”åªèƒ½ä»ä¸€ä¸ªè¡¨ä¸­è¿›è¡Œé€‰æ‹©ã€‚ <br><br> è¿™å¾ˆå®¹æ˜“åšåˆ°ã€‚ ä»¥æ‚¨å¯èƒ½éœ€è¦çš„ä»»ä½•æ–¹å¼ç™»å½•åˆ°å®ä¾‹ï¼Œå¹¶é¢„å…ˆæäº¤ä»¥ä¸‹è¯·æ±‚ï¼š <br><br><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> LOGIN ms_teams_watcher <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PASSWORD</span></span> = <span class="hljs-string"><span class="hljs-string">'123@qwe'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">USE</span></span> [VeeamBackup] <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">USER</span></span> ms_teams_watcher <span class="hljs-keyword"><span class="hljs-keyword">FOR</span></span> LOGIN ms_teams_watcher <span class="hljs-keyword"><span class="hljs-keyword">GRANT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> [dbo].[Backup.Model.JobSessions] <span class="hljs-keyword"><span class="hljs-keyword">TO</span></span> ms_teams_watcher</code> </pre> <br> ä¸è¦å¿˜è®°æ›¿æ¢<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ•°æ®åº“åç§°</a> ï¼Œå¹¶æä¾›ç”¨æˆ·åå’Œå¯†ç ã€‚ <br><br> å¦‚æœæ‚¨åšçš„ä¸€åˆ‡æ­£ç¡®ï¼Œåˆ™å‡çº§å°è¯•å°†å¤±è´¥ï¼š <br><br><img src="https://habrastorage.org/getpro/habr/post_images/21e/f1d/151/21ef1d151a7df57e1b8b1c4cbd327d42.png"><br><br> ä½†è¯·é€‰æ‹©-è¯·ï¼š <br><br><img src="https://habrastorage.org/getpro/habr/post_images/15f/aad/534/15faad5348b9e4ce4d80962b9813c191.png"><br><br>  GDPRçš„è£è€€-åœ¨æ­¤æ ·æœ¬çš„æ¡†æ¶å†…ï¼Œæ²¡æœ‰ä¸€ä¸ªç”Ÿäº§åŸºåœ°é­å—æŸå¤±ï¼ ç°åœ¨æˆ‘ä»¬æœ‰äº†ç”¨æˆ·ms_teams_watcherï¼Œæˆ‘ä»¬å¯ä»¥å¼€å§‹æ”¶é›†æ•°æ®äº†ã€‚ æˆ‘ä»¬å°†é€šè¿‡<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">pyodbc</a>è¿æ¥-æ²¡æœ‰SQLAlchemyï¼Œåªæœ‰é“æ†ï¼ <br><br> é¦–å…ˆï¼Œæ‰“å¼€è¿æ¥ï¼ˆè¯·å‚é˜…ç±»<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">SQLConnectorVeeamDB</a> ï¼‰ï¼Œå¹¶è·å–æœ‰å…³åœ¨ä¸Šä¸€æ¬¡è„šæœ¬è¿è¡ŒæœŸé—´å®Œæˆçš„æ‰€æœ‰ä¼šè¯çš„ä¿¡æ¯ï¼š <br><br>  sã€‚  SQLConnectorVeeamDB.select_completed_job_sessions_during_latest_hourï¼š <br><br><pre> <code class="sql hljs">query = '<span class="hljs-keyword"><span class="hljs-keyword">select</span></span> job_name,job_type, usn, end_time, <span class="hljs-keyword"><span class="hljs-keyword">result</span></span>, reason <span class="hljs-string"><span class="hljs-string">' \               '</span></span><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> [dbo].[Backup.Model.JobSessions] <span class="hljs-string"><span class="hljs-string">' \               '</span></span><span class="hljs-keyword"><span class="hljs-keyword">where</span></span> state = <span class="hljs-number"><span class="hljs-number">-1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-keyword"><span class="hljs-keyword">result</span></span> != <span class="hljs-number"><span class="hljs-number">-1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-keyword"><span class="hljs-keyword">datediff</span></span>(HH,[end_time],<span class="hljs-keyword"><span class="hljs-keyword">GETDATE</span></span>()) &lt;= <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-string"><span class="hljs-string">' \               '</span></span><span class="hljs-keyword"><span class="hljs-keyword">order</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> usn<span class="hljs-string"><span class="hljs-string">'</span></span></code> </pre><br> å¯¹æˆ‘ä»¬æ¥è¯´ï¼Œæœ€é‡è¦çš„æ˜¯è·å–è¡¨ä¸­çš„æœ€åä¸€ä¸ªusnï¼Œå› æ­¤ä¸‹ä¸€æ¬¡å·²ç»å¯ä»¥å‘ä»–æå‡ºè¯·æ±‚äº†ï¼Œè€Œä¸æ˜¯æŒ‰æ—¶é—´ã€‚ å¦‚æœæ‰¾ä¸åˆ°ä»»ä½•å†…å®¹ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹æŸ¥è¯¢ï¼š <br><br><pre> <code class="sql hljs">query = '<span class="hljs-keyword"><span class="hljs-keyword">select</span></span> top <span class="hljs-number"><span class="hljs-number">1</span></span> [usn] <span class="hljs-string"><span class="hljs-string">' \                   '</span></span><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> [dbo].[Backup.Model.JobSessions] <span class="hljs-string"><span class="hljs-string">' \                   '</span></span><span class="hljs-keyword"><span class="hljs-keyword">order</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> usn <span class="hljs-keyword"><span class="hljs-keyword">desc</span></span><span class="hljs-string"><span class="hljs-string">'</span></span></code> </pre><br> ä»ç»Ÿè®¡ä¸Šè®²ï¼Œæ­¤usnä¼šæ¯”æ‰§è¡Œç¬¬ä¸€ä¸ªè¯·æ±‚æ—¶è¿”å›çš„usné«˜ï¼Œä½†æ˜¯ä¸å±äºç¬¬ä¸€ä¸ªé€‰æ‹©çš„JobSessionsï¼Œæˆ‘ä»¬ä»ç„¶ä¸éœ€è¦ã€‚ å¦‚æœæˆ‘ä»¬æ²¡æœ‰æ‰¾åˆ°å®Œæˆçš„ï¼ˆstate = -1ï¼‰ä¼šè¯ï¼Œç»“æœä¸æ˜¯Noneï¼ˆç»“æœï¼= -1ï¼‰-è¯·è®°ä½usnï¼Œå°†å…¶å†™å…¥iniæ–‡ä»¶å¹¶ä»¥ä¸€å®šçš„é—´éš”é‡å¤è¯·æ±‚ï¼ˆä½†å·²ç»æ˜¯SQLConnectorVeeamDB.select_completed_job_sessions_sessions_after_usnï¼‰ã€‚ <br><br><h2> ä¸ºMSå›¢é˜Ÿåˆ›å»ºä¼ å…¥çš„WebHookè¿æ¥å™¨ </h2><br> è¿™é‡Œçš„ä¸€åˆ‡éƒ½å¾ˆç®€å•ã€‚ è¦æ±‚æ‚¨çš„MS Teamsç®¡ç†å‘˜ï¼ˆè¯·ç¡®è®¤æ˜¯å¦æ˜¯æ‚¨ï¼‰å¯ç”¨æ­¤åŠŸèƒ½ï¼Œå¦‚æ­¤å¤„æ‰€è¿°ã€‚ ç°åœ¨åˆ›å»ºä¸€ä¸ª<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Incoming WebHook</a>ç±»å‹çš„è¿æ¥å™¨ã€‚ å¥æ•ˆäº†å—ï¼Ÿ æ‚¨å¾ˆæ¼‚äº®ï¼Œæ— éœ€æ‰§è¡Œå…¶ä»–æ“ä½œï¼Œå¤åˆ¶urlå¹¶ä¿å­˜ã€‚ <br><br><h2> å…¨éƒ¨æ”¾åœ¨ä¸€èµ· </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åœ¨è¿™é‡Œï¼Œ</a>æ‚¨å¯ä»¥ä¸‹è½½å®Œæˆçš„Dockerfileæˆ–è‰å›¾æœ¬èº«ï¼Œæˆ‘ä»¬å°†è¿›ä¸€æ­¥å¯¹å…¶è¿›è¡Œè€ƒè™‘ã€‚ åªéœ€è®°ä½ä¸‹è½½<a href="">configuration.py_</a> ï¼Œå°†å…¶æ”¾åœ¨Dockerfileæ—è¾¹ï¼Œå¡«å†™å¹¶ä»æ‰©å±•ä¸­åˆ é™¤ä¸‹åˆ’çº¿ã€‚ <br><br> è¿™æ˜¯æ¦‚å¿µè‰å›¾æ–¹æ¡ˆçš„å¤–è§‚ï¼ˆå›¾ç‰‡æ˜¯å¯å•å‡»çš„ï¼‰ï¼š <br><br> <a href=""><img src="https://habrastorage.org/webt/_j/11/lk/_j11lkt0ukmphkthvbhg1rugncc.png"></a> <br><br> ä»å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œæœ€æœ‰è¶£çš„äº‹æƒ…æ˜¯è§£æä»Veeamæ•°æ®åº“æ¥æ”¶çš„æ—¥æœŸï¼ŒåŒæ—¶åˆ›å»ºVeeamEventç±»ï¼ˆåªæ˜¯ä¸€ä¸ªæ•°æ®ä¸­å¿ƒï¼‰çš„å¯¹è±¡å’Œé€šçŸ¥å‘é€è¿‡ç¨‹æœ¬èº«ã€‚ <br><br><h3>  VeeamEventç±»ï¼ˆå¯¹è±¡ï¼‰ </h3><br> åœ¨è®°å½•æ—¥æœŸçš„è¡¨ä¸­ï¼Œè®°å½•äº†Veeamæ‰§è¡Œçš„æ‰€æœ‰ä»»åŠ¡ã€‚ <br> å®ƒä»¬æ¯ä¸ªéƒ½æœ‰å±æ€§job_typeã€‚ å…¶ä¸­æœ‰å¾ˆå¤šï¼Œä½†æ˜¯æˆ‘å¼ºè°ƒäº†å¯¹æˆ‘ä»¬æ¥è¯´æœ€æœ‰è¶£çš„ä¸€ä»¶äº‹-æˆ‘ä»¬æ˜¯å¦ä¸æƒ³å‘é€æŸäººå·²æ‰“å¼€ç¨‹åºæ§åˆ¶å°æˆ–å®Œæˆè¿˜åŸçš„æ¶ˆæ¯ï¼Ÿ <br><br><ul><li>  0-å¤‡ä»½ä½œä¸š <br></li><li>  1-å¤åˆ¶ä½œä¸š <br></li><li>  3-SureBackupä½œä¸š <br></li><li>  24-æ–‡ä»¶åˆ°ç£å¸¦ä½œä¸š <br></li><li>  28-å¤‡ä»½åˆ°ç£å¸¦ä½œä¸š <br></li><li>  51-å¤‡ä»½å¤å°ä½œä¸š <br></li><li>  100-é…ç½®å¤‡ä»½ <br></li></ul><br> åœ¨è¯„è®ºä¸­å†™ï¼Œå¦‚æœæœ‰å…´è¶£ï¼Œæˆ‘å°†æ ¹æ®è¦æ±‚æç¤ºå…¶ä»–ç±»å‹çš„ä»»åŠ¡ã€‚ å®Œæˆçš„ä»»åŠ¡å¯ä»¥æ˜¯æˆåŠŸæˆ–è­¦å‘Šï¼Œæœ‰æ—¶ç”šè‡³æ˜¯å¤±è´¥ã€‚ <br><br> ç»“æœï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªå¯¹è±¡ï¼Œè¯¥å¯¹è±¡æœ¬èº«å­˜å‚¨æ‰€æœ‰è¿™äº›æ•°æ®ä»¥åŠä»»åŠ¡åç§°ï¼Œusnï¼Œå®ŒæˆçŠ¶æ€ï¼ˆå¦‚æœæœ‰ï¼‰çš„æè¿°ä»¥åŠå®Œæˆæ—¶é—´ã€‚ ä¼ è¾“è¯¥å¯¹è±¡æ˜¯ä¸ºäº†å‘Messengerå‘é€æ¶ˆæ¯ã€‚ <br><br><h3>  send_notification_to_web_hookï¼ˆï¼‰ </h3><br> åœ¨è¿™é‡Œï¼Œå®ƒä»ç„¶æ›´ç®€å•-æˆ‘ä»¬ä½¿ç”¨ç°æˆçš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">pymsteams</a>åº“ï¼Œè¯¥åº“ä»…æ ¹æ®<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è§„èŒƒ</a>æ”¶é›†ä¸€æ¡æ¶ˆæ¯ï¼Œç„¶åé€šè¿‡<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">request.post</a>å‘é€è¯¥æ¶ˆæ¯ã€‚ åœ¨æˆ‘çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»€è‡³æ²¡æœ‰ä½¿ç”¨WebHooksä¹Ÿæ”¯æŒçš„O365å¡åŠŸèƒ½ï¼Œè€Œåªæ˜¯æ ¹æ®ä»»åŠ¡çš„ç»“æœåˆ¶ä½œäº†å¤šä¸ªæ¶ˆæ¯æ¨¡æ¿ã€‚ <br><br><pre> <code class="python hljs">team_connection = pymsteams.connectorcard(web_hook_url)   <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> event_object.job_type_name <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>:       <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> event_object.result_text == <span class="hljs-string"><span class="hljs-string">'success'</span></span>:           text = <span class="hljs-string"><span class="hljs-string">'A Veeam '</span></span> + event_object.job_type_name + <span class="hljs-string"><span class="hljs-string">' **"'</span></span> + str(event_object.job_name) + <span class="hljs-string"><span class="hljs-string">'"** has finished **successfully** at '</span></span> + str(event_object.end_time)[:<span class="hljs-number"><span class="hljs-number">-7</span></span>]           team_connection.color(<span class="hljs-string"><span class="hljs-string">'005f4b'</span></span>)  <span class="hljs-comment"><span class="hljs-comment"># it's a brand color named "Veeam Sapphire", btw</span></span></code> </pre> <br> å¹»æƒ³åœ¨è¿™é‡Œå¾ˆæœ‰ç”¨-æ·»åŠ ä»»ä½•æ–‡æœ¬ï¼Œå›¾ç‰‡ï¼ŒæŒ‰é’®ç­‰ã€‚ è¿™æ˜¯æˆ‘æ”¶åˆ°çš„æ¶ˆæ¯ç±»å‹ï¼š <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7f9/f4a/2ec/7f9f4a2ec6de1fb39c5cf75148cf2462.png"><br>  <i>å¯¹äºä¸€åˆ‡é¡ºåˆ©çš„å¤‡ä»½å·¥ä½œ</i> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/95c/bee/5a5/95cbee5a5254d3f8f92c492d1824896c.png"><br>  <i>å¯¹äºå¤±è´¥å’Œè­¦å‘Šä»»åŠ¡</i> <br><br><h2> åˆ›å»ºä¸€ä¸ªDockerå®¹å™¨ </h2><br> å¦‚æœæ‚¨è¿˜æ²¡æœ‰Dockerï¼Œè¯·æŸ¥çœ‹<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Dockerå…¥é—¨æ•™ç¨‹</a> ã€‚ å¦‚æœå­˜åœ¨ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä»¥ä¸‹Dockerfileï¼š <br><br><pre> <code class="hljs kotlin"># Version: <span class="hljs-number"><span class="hljs-number">1.0</span></span> FROM python:<span class="hljs-number"><span class="hljs-number">3.6</span></span>.2 MAINTAINER Dmitry Rozhdestvenskiy &lt;<span class="hljs-symbol"><span class="hljs-symbol">dremsama@</span></span>gmail.com&gt; RUN apt-<span class="hljs-keyword"><span class="hljs-keyword">get</span></span> update &amp;&amp; apt-<span class="hljs-keyword"><span class="hljs-keyword">get</span></span> install -y --no-install-recommends apt-utils RUN apt-<span class="hljs-keyword"><span class="hljs-keyword">get</span></span> -y install locales RUN echo <span class="hljs-string"><span class="hljs-string">"en_US.UTF-8 UTF-8"</span></span> &gt; /etc/locale.gen RUN locale-gen RUN apt-<span class="hljs-keyword"><span class="hljs-keyword">get</span></span> -y install apt-transport-https freetds-dev unixodbc-dev git RUN curl https:<span class="hljs-comment"><span class="hljs-comment">//packages.microsoft.com/keys/microsoft.asc | apt-key add - RUN curl https://packages.microsoft.com/config/debian/8/prod.list &gt; /etc/apt/sources.list.d/mssql-release.list RUN apt-get -y update &amp;&amp; ACCEPT_EULA=Y apt-get install msodbcsql RUN mkdir /veeam_to_msteams RUN git clone https://github.com/daymer/Veeam-to-MS-Teams-notification-sender-app /veeam_to_msteams RUN pip install --upgrade pip RUN pip install -r /veeam_to_msteams/requirements.txt RUN mkdir /var/log/veeam_to_msteams/ ADD configuration.py /veeam_to_msteams/ RUN chmod +x /veeam_to_msteams/launch_veeam_to_msteams.sh CMD ["/bin/bash", "/veeam_to_msteams/launch_veeam_to_msteams.sh"]</span></span></code> </pre><br>  Dockeræœ¬èº«ä»å­˜å‚¨åº“ï¼ˆFROM pythonï¼š3.6.2ï¼‰ï¼ŒGithubï¼ˆRUN git clone ...ï¼‰å’Œpackages.microsoft.comä¸‹è½½æ‰€æœ‰å†…å®¹ã€‚ å°†dockerfileæ”¾ç½®åœ¨<a href="">configuration.py</a>æ—è¾¹çš„ï¼…directory_nameï¼…ä¸­ï¼ˆæ‚¨æ˜¯å¦ä¼šå¿˜è®°ä¸‹è½½å¹¶å¡«å†™å®ƒï¼Ÿï¼‰ã€‚ ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ç»„è£…å›¾åƒï¼š <br><br><pre> <code class="hljs dos">docker build -t veeam_to_msteams:<span class="hljs-number"><span class="hljs-number">1</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span> -f /<span class="hljs-built_in"><span class="hljs-built_in">path</span></span>/<span class="hljs-variable"><span class="hljs-variable">%directory_name%</span></span>/Dockerfile /<span class="hljs-built_in"><span class="hljs-built_in">path</span></span>/<span class="hljs-variable"><span class="hljs-variable">%directory_name%</span></span>/</code> </pre><br> è¿è¡Œå®¹å™¨ï¼š <br><br><pre> <code class="hljs powershell">docker run  -<span class="hljs-literal"><span class="hljs-literal">-restart</span></span>=always  <span class="hljs-literal"><span class="hljs-literal">-it</span></span> -<span class="hljs-literal"><span class="hljs-literal">-name</span></span> veeam_to_msteams <span class="hljs-literal"><span class="hljs-literal">-d</span></span> veeam_to_msteams:<span class="hljs-number"><span class="hljs-number">1.0</span></span>  bin/bash /veeam_to_msteams/launch_veeam_to_msteams.sh</code> </pre><br> å¦‚æœæ‚¨æƒ³åœ¨å…¶ä»–å¹³å°ä¸Šè¿è¡Œè„šæœ¬ï¼Œæˆ–è€…æ ¹æœ¬ä¸æƒ³ä½¿ç”¨è¯¥å®¹å™¨-æ²¡å…³ç³»ï¼Œåªéœ€è¿è¡Œmain.pyæ–‡ä»¶æœ¬èº«ï¼Œä¸å¸¦ä»»ä½•å‚æ•°ã€‚ <br><hr><br> æ˜¯æ—¶å€™ç»™æˆ‘å€’æ¯å’–å•¡äº†ï¼Œå¦‚æœæ‚¨æœ‰å…´è¶£ï¼Œå¯ä»¥æ ¹æ®æ‚¨çš„ç”Ÿäº§éœ€è¦å®Œæˆæˆ‘çš„è‰å›¾ã€‚  â€œæ‚¨åªä¸ºäº¤ä»˜ä»˜è´¹â€ï¼Œæ›´å‡†ç¡®åœ°è¯´ï¼Œæ‚¨åªéœ€å°†äº¤ä»˜å®æ–½åˆ°æ‚¨é¦–é€‰çš„æ¸ é“å³å¯ã€‚ <br><br> æˆ‘å°†æ±‡é›†æœ‰ç”¨çš„é“¾æ¥ï¼š <br><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æˆ‘åœ¨githubä¸Šçš„é¡¹ç›®</a> <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Python SQLé©±åŠ¨ç¨‹åº-Pyodbc</a> <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åˆ›å»ºä¼ å…¥çš„WebHookè¿æ¥å™¨</a> <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å¦‚ä½•ä¸ºMSå›¢é˜Ÿå¯ç”¨ä¼ å…¥WebHookè¿æ¥å™¨</a> <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Pymsteamsåº“</a> <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">é¢å‘åˆå­¦è€…çš„Dockeræ•™ç¨‹</a> <br></li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN415561/">https://habr.com/ru/post/zh-CN415561/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN415551/index.html">VoLTE / ViLTE + Wi-Fié€šè¯éå¸¸å¤æ‚</a></li>
<li><a href="../zh-CN415553/index.html">æ¥è‡ªARæŠ€æœ¯ä¸–ç•Œçš„æ–°é²œææ–™çš„æ‘˜è¦</a></li>
<li><a href="../zh-CN415555/index.html">ç¥ç»å·«å¸ˆçš„åé¢ã€‚ ç¬¬3éƒ¨åˆ†ï¼šå®Œæˆæ¸²æŸ“ï¼Œåˆ¶ä½œæ¸¸æˆ</a></li>
<li><a href="../zh-CN415557/index.html">ç¼–è§£ç å™¨2 +ç¥ç»ç½‘ç»œ=ä¸€å¼ è½¯ç›˜ä¸Šçš„æ•´ä¸ªæ’­å®¢</a></li>
<li><a href="../zh-CN415559/index.html">å‘¼å«ä¸­å¿ƒçš„å‘å±•å†å²ï¼Œæˆ–æŠ€æœ¯å¦‚ä½•æ”¹å˜äº†è¿è¥å•†ä¸å®¢æˆ·ä¹‹é—´çš„å·¥ä½œ</a></li>
<li><a href="../zh-CN415563/index.html">â€œæœºæ¢°â€ Scrumçš„å¤„ç†ã€‚ ç¬¬2éƒ¨åˆ†ã€‚å›¢é˜Ÿ</a></li>
<li><a href="../zh-CN415565/index.html">ä¸ºä»€ä¹ˆï¼ˆä»Šå¤©ï¼‰è¿”å›444å¹¶ä¸æ€»æ˜¯æœ‰ç”¨çš„</a></li>
<li><a href="../zh-CN415567/index.html">å¹¿æ’­h264è§†é¢‘ï¼Œè€Œæ— éœ€ä»Logitech C920æ‘„åƒæœºè¿›è¡Œè½¬ç </a></li>
<li><a href="../zh-CN415569/index.html">å¦‚ä½•è®¾ç½®ubuntu 18.04 sendmail + DKIM + SPF + DMARCæˆ–æˆ‘å¦‚ä½•è®¾æ³•è¿›å…¥Gmailå ¡å’</a></li>
<li><a href="../zh-CN415571/index.html">kaggleï¼šIEEEçš„ç›¸æœºæ¨¡å‹è¯†åˆ«</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>