<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸš£ğŸ¿ ğŸ‘· â™‚ï¸ é‚ªæ¶åŒ…è£¹æ¼æ´åˆ†æ ğŸ© ğŸŒ¯ ğŸ”¥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="å¼•è¨€ 
 4æœˆä¸­æ—¬ï¼Œæˆ‘ä»¬å‘å¸ƒäº†æœ‰å…³Android.InfectionAds.1æœ¨é©¬çš„æ–°é—» ï¼Œè¯¥æœ¨é©¬åˆ©ç”¨äº†Androidä¸­çš„å‡ ä¸ªå…³é”®æ¼æ´ã€‚ å…¶ä¸­ä¹‹ä¸€CVE-2017-13156ï¼ˆä¹Ÿç§°ä¸ºJanus ï¼‰å…è®¸æ¶æ„è½¯ä»¶æ„ŸæŸ“APKæ–‡ä»¶è€Œä¸ä¼šæŸåæ•°å­—ç­¾åã€‚ å¦ä¸€ä¸ªæ˜¯CVE-2017-13315ã€‚ å®ƒèµ‹äºˆæœ¨é©¬æ‰©å±•æƒ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>é‚ªæ¶åŒ…è£¹æ¼æ´åˆ†æ</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/drweb/blog/457610/"><h3> å¼•è¨€ </h3><br>  4æœˆä¸­æ—¬ï¼Œæˆ‘ä»¬<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å‘å¸ƒäº†</a>æœ‰å…³<b>Android.InfectionAds.1</b>æœ¨é©¬çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ–°é—»</a> ï¼Œè¯¥æœ¨é©¬åˆ©ç”¨äº†Androidä¸­çš„å‡ ä¸ªå…³é”®æ¼æ´ã€‚ å…¶ä¸­ä¹‹ä¸€CVE-2017-13156ï¼ˆä¹Ÿç§°ä¸º<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Janus</a> ï¼‰å…è®¸æ¶æ„è½¯ä»¶æ„ŸæŸ“APKæ–‡ä»¶è€Œä¸ä¼šæŸåæ•°å­—ç­¾åã€‚ å¦ä¸€ä¸ªæ˜¯CVE-2017-13315ã€‚ å®ƒèµ‹äºˆæœ¨é©¬æ‰©å±•æƒé™ï¼Œå› æ­¤å®ƒå¯ä»¥ç‹¬ç«‹äºç”¨æˆ·å®‰è£…å’Œå¸è½½åº”ç”¨ç¨‹åºã€‚  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æˆ‘ä»¬çš„ç—…æ¯’åº“ä¸­</a>æä¾›äº†å¯¹<b>Android.InfectionAds.1</b>çš„è¯¦ç»†åˆ†æï¼› åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†ä»‹ç»CVE-2017-13315æ¼æ´å¹¶æŸ¥çœ‹å…¶ä½œç”¨ã€‚ <br><a name="habracut"></a><br>  CVE-2017-13315å±äºè¢«ç§°ä¸ºEvilParcelçš„æ¼æ´ã€‚ å®ƒä»¬å¯ä»¥åœ¨å„ç§Androidç³»ç»Ÿç±»ä¸­æ‰¾åˆ°ã€‚ è¿™äº›ç±»ä¸­çš„é”™è¯¯ä½¿åœ¨åº”ç”¨ç¨‹åºä¸ç³»ç»Ÿä¹‹é—´çš„æ•°æ®äº¤æ¢æœŸé—´æ›¿æ¢ä¿¡æ¯æˆä¸ºå¯èƒ½ã€‚ å› æ­¤ï¼Œåˆ©ç”¨EvilParcelæ¼æ´çš„æ¶æ„è½¯ä»¶è¢«æˆäºˆäº†æ›´é«˜çš„ç‰¹æƒï¼Œå¹¶ä¸”å¯ä»¥æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š <br><br><ul><li> æœªç»ç”¨æˆ·ç¡®è®¤è€Œå®‰è£…å’Œåˆ é™¤å…·æœ‰ä»»ä½•æƒé™çš„åº”ç”¨ç¨‹åºï¼› </li><li> æ„ŸæŸ“è®¾å¤‡ä¸Šå®‰è£…çš„è½¯ä»¶ï¼Œå¹¶ä¸å…¶ä»–æ¼æ´ä¸€èµ·ä½¿ç”¨æ—¶ï¼Œå°†å¹²å‡€çš„åŸä»¶æ›¿æ¢ä¸ºå—æ„ŸæŸ“çš„å‰¯æœ¬ï¼› </li><li> åœ¨Androidè®¾å¤‡ä¸Šé‡ç½®é”å®šå±å¹•PINã€‚ </li></ul><br> æˆªè‡³ç›®å‰ï¼Œæˆ‘ä»¬çŸ¥é“å¤§çº¦7ç§æ­¤ç±»æ¼æ´ï¼š <br><ul><li>  CVE-2017-0806ï¼ˆGateKeeperResponseç±»ä¸­çš„é”™è¯¯ï¼‰ï¼Œäº2017å¹´10æœˆå‘å¸ƒ; </li><li>  CVE-2017-13286ï¼ˆOutputConfigurationç±»é”™è¯¯ï¼Œäº2018å¹´4æœˆå‘å¸ƒ; </li><li>  CVE-2017-13287ï¼ˆVerifyCredentialResponseç±»ä¸­çš„é”™è¯¯ï¼‰ï¼Œäº2018å¹´4æœˆå‘å¸ƒ; </li><li>  CVE-2017-13288ï¼ˆPeriodicAdvertizingReportç±»ä¸­çš„é”™è¯¯ï¼‰ï¼Œäº2018å¹´4æœˆå‘å¸ƒ; </li><li>  CVE-2017-13289ï¼ˆParcelableRttResultsç±»ä¸­çš„é”™è¯¯ï¼‰ï¼Œäº2018å¹´4æœˆå‘å¸ƒ; </li><li>  CVE-2017-13311ï¼ˆSparseMappingTableç±»ä¸­çš„é”™è¯¯ï¼‰ï¼Œäº2018å¹´5æœˆå‘å¸ƒ; </li><li>  CVE-2017-13315ï¼ˆDcParamObjectç±»é”™è¯¯ï¼‰ï¼Œäº2018å¹´5æœˆå‘å¸ƒã€‚ </li></ul><br> æ‰€æœ‰è¿™äº›éƒ½å¯¹æ²¡æœ‰å®‰è£…2018å¹´5æœˆï¼ˆæˆ–æ›´é«˜ç‰ˆæœ¬ï¼‰å®‰å…¨æ›´æ–°çš„è¿è¡ŒAndroid 5.0-8.1çš„è®¾å¤‡æ„æˆå¨èƒã€‚ <br><br><h3>  EvilParcelæ¼æ´çš„å‰ææ¡ä»¶ </h3><br> è®©æˆ‘ä»¬çœ‹çœ‹EvilParcelæ¼æ´å¦‚ä½•å‡ºç°ã€‚ é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ç ”ç©¶Androidåº”ç”¨ç¨‹åºçš„æŸäº›åŠŸèƒ½ã€‚ é€šè¿‡å‘é€å’Œæ¥æ”¶Intentå¯¹è±¡ï¼Œæ‰€æœ‰Androidç¨‹åºä¹‹é—´ä»¥åŠä¸æ“ä½œç³»ç»Ÿä¹‹é—´éƒ½è¿›è¡Œäº¤äº’ã€‚ è¿™äº›å¯¹è±¡å¯ä»¥åœ¨Bundleå¯¹è±¡ä¸­åŒ…å«ä»»æ„æ•°é‡çš„é”®/å€¼å¯¹ã€‚ <br><br> ä¼ è¾“Intentæ—¶ï¼Œå°†Bundleå¯¹è±¡è½¬æ¢ï¼ˆåºåˆ—åŒ–ï¼‰ä¸ºåŒ…è£¹åœ¨Parcelä¸­çš„å­—èŠ‚æ•°ç»„ï¼Œç„¶ååœ¨ä»åºåˆ—åŒ–Bundleä¸­è¯»å–é”®å’Œå€¼åè‡ªåŠ¨å°†å…¶ååºåˆ—åŒ–ã€‚ <br><br> åœ¨Bundleä¸­ï¼Œé”®æ˜¯å­—ç¬¦ä¸²ï¼Œå€¼å‡ ä¹å¯ä»¥æ˜¯ä»»ä½•å€¼ã€‚ ä¾‹å¦‚ï¼Œå®ƒå¯ä»¥æ˜¯åŸå§‹ç±»å‹ï¼Œå­—ç¬¦ä¸²æˆ–å…·æœ‰åŸå§‹ç±»å‹æˆ–å­—ç¬¦ä¸²çš„å®¹å™¨ã€‚ å®ƒä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªParcelableå¯¹è±¡ã€‚ <br><br> å› æ­¤ï¼Œæ†ç»‘åŒ…å¯ä»¥åŒ…å«å®ç°Parcelableæ¥å£çš„ä»»ä½•ç±»å‹çš„å¯¹è±¡ã€‚ ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦å®ç°writeToParcelï¼ˆï¼‰å’ŒcreateFromParcelï¼ˆï¼‰æ–¹æ³•æ¥åºåˆ—åŒ–å’Œååºåˆ—åŒ–å¯¹è±¡ã€‚ <br><br> ä¸ºäº†è¯´æ˜æˆ‘ä»¬çš„è§‚ç‚¹ï¼Œè®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç®€å•çš„åºåˆ—åŒ–åŒ…ã€‚ æˆ‘ä»¬å°†ç¼–å†™ä¸€ä¸ªä»£ç ï¼Œå°†ä¸‰ä¸ªé”®å€¼å¯¹æ”¾å…¥Bundleå¹¶å°†å…¶åºåˆ—åŒ–ï¼š <br><br><img src="https://habrastorage.org/webt/pf/-9/2j/pf-92jsexpyrb7p2dvi8oj3-vbs.png"><br> å›¾1.åºåˆ—åŒ–æ†ç»‘å¯¹è±¡çš„ç»“æ„ <br><br> è¯·æ³¨æ„æ†ç»‘åŒ…åºåˆ—åŒ–çš„ç‰¹å®šåŠŸèƒ½ï¼š <br><br><ul><li> æ‰€æœ‰é”®å€¼å¯¹å‡æŒ‰é¡ºåºå†™å…¥ï¼› </li><li> åœ¨æ¯ä¸ªå€¼ä¹‹å‰æŒ‡ç¤ºå€¼ç±»å‹ï¼ˆ13è¡¨ç¤ºå­—èŠ‚æ•°ç»„ï¼Œ1è¡¨ç¤ºæ•´æ•°ï¼Œ0è¡¨ç¤ºå­—ç¬¦ä¸²ï¼Œç­‰ç­‰ï¼‰ï¼› </li><li> å¯å˜é•¿åº¦çš„æ•°æ®å¤§å°åœ¨æ•°æ®ä¹‹å‰æŒ‡ç¤ºï¼ˆå­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œæ•°ç»„çš„å­—èŠ‚æ•°ï¼‰ï¼› </li><li> æ‰€æœ‰å€¼éƒ½æ˜¯4å­—èŠ‚å¯¹é½çš„ã€‚ </li></ul><br><br> æ‰€æœ‰é”®å’Œå€¼éƒ½æŒ‰é¡ºåºå†™å…¥Bundleï¼Œä»¥ä¾¿åœ¨è®¿é—®åºåˆ—åŒ–Bundleå¯¹è±¡çš„ä»»ä½•é”®æˆ–å€¼æ—¶ï¼Œåè€…å°†å®Œå…¨ååºåˆ—åŒ–ï¼Œè¿˜åˆå§‹åŒ–æ‰€æœ‰åŒ…å«çš„Parcelableå¯¹è±¡ã€‚ <br><br> é‚£ä¹ˆï¼Œå¯èƒ½æ˜¯ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ é—®é¢˜åœ¨äºï¼Œå®ç°Parcelableçš„æŸäº›ç³»ç»Ÿç±»å¯èƒ½åœ¨createFromParcelï¼ˆï¼‰å’ŒwriteToParcelï¼ˆï¼‰æ–¹æ³•ä¸­åŒ…å«é”™è¯¯ã€‚ åœ¨è¿™äº›ç±»ä¸­ï¼Œåœ¨createFromParcelï¼ˆï¼‰ä¸­è¯»å–çš„å­—èŠ‚æ•°å°†ä¸åœ¨writeToParcelï¼ˆï¼‰ä¸­å†™å…¥çš„å­—èŠ‚æ•°ä¸åŒã€‚ å¦‚æœå°†æ­¤ç±»çš„å¯¹è±¡æ”¾ç½®åœ¨Bundleä¸­ï¼Œåˆ™é‡æ–°åºåˆ—åŒ–åï¼ŒBundleä¸­çš„å¯¹è±¡è¾¹ç•Œå°†æ›´æ”¹ã€‚ è¿™ä¸ºåˆ©ç”¨EvilParcelæ¼æ´åˆ›é€ äº†æ¡ä»¶ã€‚ <br><br> è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªåŒ…å«æ­¤é”™è¯¯çš„ç±»çš„ç¤ºä¾‹ï¼š <br><br><pre><code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Demo</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Parcelable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] data; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Demo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.data = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[<span class="hljs-number"><span class="hljs-number">0</span></span>]; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Demo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Parcel in)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> length = in.readInt(); data = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[length]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (length &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { in.readByteArray(data); } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Creator&lt;Demo&gt; CREATOR = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Creator&lt;Demo&gt;() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Demo </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createFromParcel</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Parcel in)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Demo(in); } }; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">writeToParcel</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Parcel parcel, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> i)</span></span></span><span class="hljs-function"> </span></span>{ parcel.writeInt(data.length); parcel.writeByteArray(data); } }</code> </pre> <br> å¦‚æœæ•°æ®æ•°ç»„çš„å¤§å°ä¸º0ï¼Œåˆ™åœ¨åˆ›å»ºå¯¹è±¡æ—¶ï¼Œå°†åœ¨createFromParcelï¼ˆï¼‰ä¸­è¯»å–ä¸€ä¸ªintï¼ˆ4å­—èŠ‚ï¼‰ï¼Œå¹¶åœ¨writeToParcelï¼ˆï¼‰ä¸­å†™å…¥ä¸¤ä¸ªintï¼ˆ8å­—èŠ‚ï¼‰ã€‚ ç¬¬ä¸€ä¸ªintå°†é€šè¿‡æ˜¾å¼è°ƒç”¨writeIntå†™å…¥ã€‚ è°ƒç”¨writeByteArrayï¼ˆï¼‰æ—¶å°†å†™å…¥ç¬¬äºŒä¸ªintï¼Œå› ä¸ºæ•°ç»„é•¿åº¦å§‹ç»ˆå†™åœ¨Parcelä¸­çš„æ•°ç»„ä¹‹å‰ï¼ˆè¯·å‚è§å›¾1ï¼‰ã€‚ <br><br> æ•°æ®æ•°ç»„å¤§å°ç­‰äº0çš„æƒ…å†µéå¸¸å°‘è§ã€‚ ä½†æ˜¯å³ä½¿å‘ç”Ÿè¿™ç§æƒ…å†µï¼Œå¦‚æœä¸€æ¬¡ä»…ä¼ è¾“ä¸€ä¸ªåºåˆ—åŒ–å¯¹è±¡ï¼ˆåœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ä¸ºDemoå¯¹è±¡ï¼‰ï¼Œç¨‹åºä»å°†ç»§ç»­è¿è¡Œã€‚ å› æ­¤ï¼Œè¿™ç§é”™è¯¯å¾€å¾€ä¸ä¼šå¼•èµ·æ³¨æ„ã€‚ <br><br> ç°åœ¨ï¼Œæˆ‘ä»¬å°†å°è¯•åœ¨Bundleä¸­æ”¾ç½®ä¸€ä¸ªæ•°ç»„é•¿åº¦ä¸ºé›¶çš„Demoå¯¹è±¡ï¼š <br><br><img src="https://habrastorage.org/webt/2y/2v/i0/2y2vi0ftdkartg9i01cc-b858g0.png"><br> å›¾2.å°†é›¶é•¿åº¦çš„Demoå¯¹è±¡æ·»åŠ åˆ°Bundleçš„ç»“æœ <br><br> æˆ‘ä»¬åºåˆ—åŒ–å¯¹è±¡ï¼š <br><br><img src="https://habrastorage.org/webt/hv/tw/if/hvtwifj9curkc7ip6jplbdlk-yc.png"><br> å›¾3.åºåˆ—åŒ–åçš„Bundleå¯¹è±¡ <br><br> ç°åœ¨è®©æˆ‘ä»¬å°è¯•ååºåˆ—åŒ–ï¼š <br><br><img src="https://habrastorage.org/webt/_u/a1/k4/_ua1k4hp34wknsvnppv8zla0jei.png"><br> å›¾4.ååºåˆ—åŒ–åçš„Bundleå¯¹è±¡ <br><br> æˆ‘ä»¬å¾—åˆ°ä»€ä¹ˆï¼Ÿ è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹åŒ…è£¹ç‰‡æ®µï¼š <br><br><img src="https://habrastorage.org/webt/tf/qa/fn/tfqafnxzmsfujmq2xyo-kwvbc2g.png"><br> å›¾5. Bundleååºåˆ—åŒ–åçš„åŒ…è£¹ç»“æ„ <br><br> åœ¨å›¾4å’Œ5ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°åœ¨ååºåˆ—åŒ–æœŸé—´åœ¨createFromParcelæ–¹æ³•ä¸­è¯»å–äº†ä¸€ä¸ªintï¼Œè€Œä¸æ˜¯ä¸¤ä¸ªintã€‚ å› æ­¤ï¼Œä»æ†ç»‘ä¸­è¯»å–æ‰€æœ‰åç»­å€¼ä¸æ­£ç¡®ã€‚ è¯»å–0x60å¤„çš„0x0å€¼ä½œä¸ºä¸‹ä¸€ä¸ªé”®çš„é•¿åº¦ã€‚ è¯»å–0x64å¤„çš„0x1å€¼ä½œä¸ºé”®ã€‚ è¯»å–0x68å¤„çš„0x31å€¼ä½œä¸ºå€¼ç±»å‹ã€‚ åŒ…è£¹æ²¡æœ‰ç±»å‹0x31çš„å€¼ï¼Œå› æ­¤readFromParcelï¼ˆï¼‰ç²¾å¿ƒæŠ¥å‘Šå¼‚å¸¸ã€‚ <br><br> å¦‚ä½•åœ¨ç°å®ç”Ÿæ´»ä¸­ä½¿ç”¨å®ƒå¹¶ä½¿å…¶æˆä¸ºæ¼æ´ï¼Ÿ è®©æˆ‘ä»¬æ¥çœ‹çœ‹ï¼  Parcelableç³»ç»Ÿç±»ä¸­çš„ä¸Šè¿°é”™è¯¯ä½¿åˆ›å»ºBundleçš„è¿‡ç¨‹å¯èƒ½åœ¨ç¬¬ä¸€æ¬¡ååºåˆ—åŒ–å’Œé‡å¤ååºåˆ—åŒ–æœŸé—´æœ‰æ‰€ä¸åŒã€‚ ä¸ºäº†è¯´æ˜è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å°†ä¿®æ”¹å‰é¢çš„ç¤ºä¾‹ï¼š <br><br><pre> <code class="java hljs">Parcel data = Parcel.obtain(); data.writeInt(<span class="hljs-number"><span class="hljs-number">3</span></span>); <span class="hljs-comment"><span class="hljs-comment">// 3 entries data.writeString("vuln_class"); data.writeInt(4); // value is Parcelable data.writeString("com.drweb.testbundlemismatch.Demo"); data.writeInt(0); // data.length data.writeInt(1); // key length -&gt; key value data.writeInt(6); // key value -&gt; value is long data.writeInt(0xD); // value is bytearray -&gt; low(long) data.writeInt(-1); // bytearray length dummy -&gt; high(long) int startPos = data.dataPosition(); data.writeString("hidden"); // bytearray data -&gt; hidden key data.writeInt(0); // value is string data.writeString("Hi there"); // hidden value int endPos = data.dataPosition(); int triggerLen = endPos - startPos; data.setDataPosition(startPos - 4); data.writeInt(triggerLen); // overwrite dummy value with the real value data.setDataPosition(endPos); data.writeString("A padding"); data.writeInt(0); // value is string data.writeString("to match pair count"); int length = data.dataSize(); Parcel bndl = Parcel.obtain(); bndl.writeInt(length); bndl.writeInt(0x4C444E42); // bundle magic bndl.appendFrom(data, 0, length); bndl.setDataPosition(0);</span></span></code> </pre> <br> æ­¤ä»£ç åˆ›å»ºä¸€ä¸ªåŒ…å«æ˜“å—æ”»å‡»ç±»çš„åºåˆ—åŒ–Bundleã€‚ ç°åœ¨è®©æˆ‘ä»¬çœ‹çœ‹æ‰§è¡Œä»¥ä¸‹ä»£ç åå¾—åˆ°çš„ç»“æœï¼š <br><br><img src="https://habrastorage.org/webt/tc/ke/wf/tckewffnaop28wllxnrt7pagdvs.png"><br> å›¾6.ç”¨ä¸€ä¸ªæ˜“å—æ”»å‡»çš„ç±»åˆ›å»ºä¸€ä¸ªBundle <br><br> ç¬¬ä¸€æ¬¡ååºåˆ—åŒ–ä¹‹åï¼Œæ­¤æ†ç»‘åŒ…å°†åŒ…å«ä»¥ä¸‹å¯†é’¥ï¼š <br><br><img src="https://habrastorage.org/webt/cj/si/l0/cjsil0--g_jsoew8ht-oxely1u4.png"><br> å›¾7.å…·æœ‰å¼±ç±»çš„Bundleååºåˆ—åŒ–ä¹‹å <br><br> ç°åœ¨ï¼Œæˆ‘ä»¬å°†å†æ¬¡åºåˆ—åŒ–Bundleï¼Œç„¶åå†æ¬¡å¯¹å…¶è¿›è¡Œååºåˆ—åŒ–ï¼Œç„¶åæŸ¥çœ‹å¯†é’¥åˆ—è¡¨ï¼š <br><br><img src="https://habrastorage.org/webt/uw/e1/mj/uwe1mjdtywr59oyshaah2q1gkus.png"><br> å›¾8.å¯¹å…·æœ‰å¼±ç±»çš„Bundleé‡æ–°åºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„ç»“æœ <br><br> æˆ‘ä»¬çœ‹åˆ°äº†ä»€ä¹ˆï¼Ÿ æ†ç»‘åŒ…ç°åœ¨åŒ…å«Hiddené”®ï¼ˆå­—ç¬¦ä¸²å€¼â€œ Hi thereï¼â€ï¼‰ï¼Œè¯¥é”®ä»¥å‰ä¸å­˜åœ¨ã€‚ è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹è¿™ä¸ªBundleçš„Parcelç‰‡æ®µï¼Œçœ‹çœ‹å‘ç”Ÿè¿™ç§æƒ…å†µçš„åŸå› ï¼š <br><br><img src="https://habrastorage.org/webt/i8/up/j1/i8upj1jif-_d41drqii19gw2nce.png"><br> å›¾9.ç»è¿‡ä¸¤ä¸ªåºåˆ—åŒ–å’Œååºåˆ—åŒ–å¾ªç¯åï¼Œå…·æœ‰è„†å¼±ç±»çš„Bundleå¯¹è±¡çš„åŒ…è£¹ç»“æ„ <br><br> è¿™æ˜¯æˆ‘ä»¬å¯ä»¥çœ‹åˆ°EvilParcelæ¼æ´çš„å…¨éƒ¨å†…å®¹çš„åœ°æ–¹ã€‚ æˆ‘ä»¬å¯ä»¥ä¸“é—¨åˆ›å»ºä¸€ä¸ªåŒ…å«æ˜“å—æ”»å‡»çš„ç±»çš„æ†ç»‘åŒ…ã€‚ æ›´æ”¹æ­¤ç±»çš„è¾¹ç•Œå°†å…è®¸åœ¨æ­¤Bundleä¸­æ”¾ç½®ä»»ä½•å¯¹è±¡ï¼› ä¾‹å¦‚ï¼Œä¸€ä¸ªIntentï¼Œå®ƒåªä¼šåœ¨ç¬¬äºŒæ¬¡ååºåˆ—åŒ–ä¹‹åå‡ºç°åœ¨Bundleä¸­ã€‚ è¿™æœ‰åŠ©äºåœ¨OSå®‰å…¨æœºåˆ¶ä¸­éšè—Intentã€‚ <br><br><h3> åˆ©ç”¨EvilParcel </h3><br>  <b>Android.InfectionAds.1</b>åˆ©ç”¨CVE-2017-13315ç‹¬ç«‹äºè®¾å¤‡æ‰€æœ‰è€…å®‰è£…å’Œåˆ é™¤è½¯ä»¶ã€‚ ä½†æ˜¯å¦‚ä½•ï¼Ÿ <br><br> åœ¨2013å¹´ï¼Œå‘ç°<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">é”™è¯¯7699048</a> ï¼Œä¹Ÿç§°ä¸ºLaunch AnyWhereã€‚ å®ƒå…è®¸ç¬¬ä¸‰æ–¹åº”ç”¨ç¨‹åºä»£è¡¨ç‰¹æƒæ›´å¤§çš„ç³»ç»Ÿç”¨æˆ·å¯åŠ¨ä»»æ„æ´»åŠ¨ã€‚ æœ‰å…³åŠ¨ä½œæœºåˆ¶ï¼Œè¯·å‚è§ä¸‹å›¾ï¼š <br><br><img src="https://habrastorage.org/webt/in/d8/-m/ind8-mnyp5urfsndbkycy3l42f8.png"><br> å›¾10.é”™è¯¯7699048çš„æ“ä½œ <br><br> è¢«åˆ©ç”¨çš„åº”ç”¨ç¨‹åºå¯ä»¥åˆ©ç”¨æ­¤æ¼æ´æ¥å®ç°å¸æˆ·èº«ä»½éªŒè¯å™¨æœåŠ¡ï¼Œè¯¥æœåŠ¡æ—¨åœ¨å°†æ–°å¸æˆ·æ·»åŠ åˆ°æ“ä½œç³»ç»Ÿã€‚ é”™è¯¯7699048å¯å¸®åŠ©æ¼æ´åˆ©ç”¨ç¨‹åºå¯åŠ¨æ´»åŠ¨æ¥å®‰è£…ï¼Œåˆ é™¤ï¼Œæ›¿æ¢åº”ç”¨ç¨‹åºï¼Œä»¥åŠé‡ç½®PINæˆ–å›¾æ¡ˆé”ï¼Œä»è€Œé€ æˆæ›´å¤šéº»çƒ¦ã€‚ <br><br>  Google Inc. é€šè¿‡ç¦æ­¢ä»AccountManagerå¯åŠ¨ä»»æ„æ´»åŠ¨æ¥æ¶ˆé™¤æ­¤æ¼æ´ã€‚ ç°åœ¨ï¼ŒAccountManagerä»…å…è®¸å¯åŠ¨æºè‡ªåŒä¸€åº”ç”¨ç¨‹åºçš„æ´»åŠ¨ã€‚ ä¸ºæ­¤ï¼Œå®ƒæ£€æŸ¥å¯åŠ¨æ´»åŠ¨çš„è½¯ä»¶çš„æ•°å­—ç­¾åï¼Œå¹¶å°†å…¶ä¸æ´»åŠ¨æ‰€åœ¨çš„åº”ç”¨ç¨‹åºçš„ç­¾åè¿›è¡ŒåŒ¹é…ã€‚ çœ‹èµ·æ¥åƒè¿™æ ·ï¼š <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (result != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> &amp;&amp; (intent = result.getParcelable(AccountManager.KEY_INTENT)) != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-comment"><span class="hljs-comment">/* * The Authenticator API allows third party authenticators to * supply arbitrary intents to other apps that they can run, * this can be very bad when those apps are in the system like * the System Settings. */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> authenticatorUid = Binder.getCallingUid(); <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> bid = Binder.clearCallingIdentity(); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { PackageManager pm = mContext.getPackageManager(); ResolveInfo resolveInfo = pm.resolveActivityAsUser(intent, <span class="hljs-number"><span class="hljs-number">0</span></span>, mAccounts.userId); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> targetUid = resolveInfo.activityInfo.applicationInfo.uid; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (PackageManager.SIGNATURE_MATCH != pm.checkSignatures(authenticatorUid, targetUid)) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SecurityException( <span class="hljs-string"><span class="hljs-string">"Activity to be started with KEY_INTENT must "</span></span> + <span class="hljs-string"><span class="hljs-string">"share Authenticator's signatures"</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span> { Binder.restoreCallingIdentity(bid); } }</code> </pre><br> çœ‹æ¥é—®é¢˜å·²ç»è§£å†³äº†ï¼Œä½†å¹¶éå¦‚æ­¤ç®€å•ã€‚ äº‹å®è¯æ˜ï¼Œä¼—æ‰€å‘¨çŸ¥çš„æ¼æ´EvilParcel CVE-2017-13315æä¾›äº†ä¸€ç§è§£å†³æ–¹æ³•ï¼ ä¼—æ‰€å‘¨çŸ¥ï¼Œä¿®å¤äº†Launch AnyWhereä¹‹åï¼Œç³»ç»Ÿä¼šéªŒè¯åº”ç”¨ç¨‹åºçš„æ•°å­—ç­¾åã€‚ å¦‚æœéªŒè¯æˆåŠŸï¼Œåˆ™æ†ç»‘åŒ…å°†ä¼ è¾“åˆ°IAccountManagerResponse.onResultï¼ˆï¼‰ã€‚ åŒæ—¶ï¼Œé€šè¿‡IPCæœºåˆ¶è°ƒç”¨onResultï¼ˆï¼‰ï¼Œå› æ­¤Bundleå†æ¬¡è¢«åºåˆ—åŒ–ã€‚ åœ¨å®ç°onResultï¼ˆï¼‰æ—¶ï¼Œä¼šå‘ç”Ÿä»¥ä¸‹æƒ…å†µï¼š <br><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">/** Handles the responses from the AccountManager */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Response</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IAccountManagerResponse</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Stub</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onResult</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Bundle bundle)</span></span></span><span class="hljs-function"> </span></span>{ Intent intent = bundle.getParcelable(KEY_INTENT); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (intent != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> &amp;&amp; mActivity != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-comment"><span class="hljs-comment">// since the user provided an Activity we will silently start intents // that we see mActivity.startActivity(intent); // leave the Future running to wait for the real response to this request } //&lt;.....&gt; } //&lt;.....&gt; }</span></span></code> </pre><br> ç„¶åï¼Œæ†ç»‘è½¯ä»¶æå–æ„å›¾å¯†é’¥ï¼Œå¹¶ä¸”æ— éœ€ä»»ä½•éªŒè¯å³å¯å¯åŠ¨æ´»åŠ¨ã€‚ <br> å› æ­¤ï¼Œè¦å¯åŠ¨å…·æœ‰ç³»ç»Ÿç‰¹æƒçš„ä»»æ„æ´»åŠ¨ï¼Œåªéœ€åˆ›å»ºä¸€ä¸ªBundleï¼Œå…¶Intentå­—æ®µå°†åœ¨ç¬¬ä¸€æ¬¡ååºåˆ—åŒ–æ—¶éšè—ï¼Œå¹¶åœ¨é‡å¤çš„ååºåˆ—åŒ–æœŸé—´å‡ºç°ã€‚ <br> ä¼—æ‰€å‘¨çŸ¥ï¼ŒEvilParcelæ¼æ´å®é™…ä¸Šå¯ä»¥æ‰§è¡Œæ­¤ä»»åŠ¡ã€‚ <br><br> ç›®å‰ï¼Œæ‰€æœ‰æ­¤ç±»å·²çŸ¥æ¼æ´å·²åœ¨æ˜“å—æ”»å‡»çš„Parcelableç±»ä¸­ä¿®å¤ã€‚ ä½†æ˜¯ï¼Œå°†æ¥å¯èƒ½ä¼šå‡ºç°æ–°çš„å¼±åŠ¿ç¾¤ä½“ã€‚ æ†ç»‘è½¯ä»¶çš„å®ç°å’Œæ·»åŠ æ–°å¸æˆ·çš„æœºåˆ¶ä»ä¸ä»¥å‰ç›¸åŒã€‚ å®ƒä»¬ä»ç„¶å…è®¸æˆ‘ä»¬åœ¨æ£€æµ‹æ—§çš„æˆ–æ–°çš„æ˜“å—æ”»å‡»çš„Parcelableç±»æ—¶åˆ›å»ºæ­¤ç²¾ç¡®æ¼æ´åˆ©ç”¨ã€‚ è€Œä¸”ï¼Œè¿™äº›ç±»ä»ç„¶æ˜¯æ‰‹åŠ¨å®ç°çš„ï¼Œç¨‹åºå‘˜å¿…é¡»ç¡®ä¿åºåˆ—åŒ–çš„Parcelableå¯¹è±¡çš„é•¿åº¦ä¿æŒä¸å˜ï¼Œè¿™æ˜¯æ‰€æœ‰éšå«å› ç´ çš„äººä¸ºå› ç´ ã€‚ ä½†æ˜¯ï¼Œæˆ‘ä»¬å¸Œæœ›æ­¤ç±»é”™è¯¯å°½å¯èƒ½å°‘ï¼Œå¹¶ä¸”EvilParcelæ¼æ´ä¸ä¼šå¯¹Androidç”¨æˆ·æ„æˆå¨èƒã€‚ <br><br> æ‚¨å¯ä»¥ä½¿ç”¨æˆ‘ä»¬çš„Android <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Dr.Webå®‰å…¨ç©ºé—´</a>æ¥æ£€æŸ¥æ‚¨çš„ç§»åŠ¨è®¾å¤‡æ˜¯å¦å­˜åœ¨EvilParcelæ¼æ´ã€‚ å†…ç½®çš„å®‰å…¨å®¡æ ¸å‘˜å°†æŠ¥å‘Šæ£€æµ‹åˆ°çš„é—®é¢˜å¹¶å»ºè®®æ¶ˆé™¤é—®é¢˜çš„æ–¹æ³•ã€‚ </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN457610/">https://habr.com/ru/post/zh-CN457610/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN457596/index.html">OSDay 19æˆ–ä¸ºä»€ä¹ˆCè¯­è¨€ä»ç„¶å­˜åœ¨</a></li>
<li><a href="../zh-CN457600/index.html">è€³æœºæ¦‚è¿°Snom A150ï¼ŒSnom A100Må’ŒD</a></li>
<li><a href="../zh-CN457602/index.html">ç ”ç©¶DBMS MS SQL Server Developer 2016å’ŒPostgreSQL 10.5 for 1Cçš„æ€§èƒ½</a></li>
<li><a href="../zh-CN457606/index.html">è‰¾ä¼¦Â·å‡¯ï¼ˆAlan Kayï¼‰ï¼šå¯ä»¥è¯´æ˜¯è®¡ç®—æœºä½¿äººä»¬èƒ½å¤Ÿå®ç°çš„æœ€ç¥å¥‡çš„äº‹æƒ…</a></li>
<li><a href="../zh-CN457608/index.html">å¦‚ä½•å°†æ•°æ®å½¢è±¡åŒ–ä¸ºå¼•äººå…¥èƒœçš„æ•…äº‹</a></li>
<li><a href="../zh-CN457612/index.html">å¦‚ä½•åœ¨ClickHouseä¸­åŠ å¿«LZ4è§£å‹ç¼©ï¼Ÿ</a></li>
<li><a href="../zh-CN457614/index.html">ä»çŒå¤´å…¬å¸åˆ°å›½å¤–æ‰¾å·¥ä½œçš„ç§˜å¯†</a></li>
<li><a href="../zh-CN457616/index.html">æˆ‘çš„â€œå“‡ï¼Œæˆ‘ä¸çŸ¥é“ï¼â€ å¼€ç©ç¬‘çš„æ—¶åˆ»</a></li>
<li><a href="../zh-CN457618/index.html">æˆä¸ºç°ä»£å…¨æ ˆå¼€å‘äººå‘˜</a></li>
<li><a href="../zh-CN457622/index.html">æµ‹é‡Qtæ€§èƒ½</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>