<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚è≤Ô∏è üôéüèª ‚ôêÔ∏è Como automatizar com Jenkins a constru√ß√£o e rolagem de artefatos de artefatos de modelo de metadados para tabelas no reposit√≥rio üìú ü§ß ‚è≥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Tudo come√ßou com o fato de nos depararmos com a necessidade de formar r√°pida e corretamente estruturas EDWEX, JSON, DDL e depois rolar em diferentes c...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Como automatizar com Jenkins a constru√ß√£o e rolagem de artefatos de artefatos de modelo de metadados para tabelas no reposit√≥rio</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/rostelecom/blog/428101/">  Tudo come√ßou com o fato de nos depararmos com a necessidade de formar r√°pida e corretamente estruturas EDWEX, JSON, DDL e depois rolar em diferentes contornos de bancos de dados relacionais.  Por contornos, quero dizer abrevia√ß√µes que todo mundo conhece - DEV, TST, UAT, PRD. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/169/a9a/387/169a9a387c429ecc2c76fa39abb3527f.jpg"><br><br>  Naquela √©poca, fizemos quase tudo manualmente: geramos DDL e coletamos edwex e json com base em metadados do banco de dados Oracle.  Existem muitos par√¢metros de entrada.  Se voc√™ perder um, formar√° uma entidade incorretamente.  E como todo o processo de forma√ß√£o foi consistente e cont√≠nuo, o erro ser√° detectado apenas no final.  Sobre como todos automatizamos e superamos os erros, leia abaixo. <br><a name="habracut"></a><br><h2>  Um pouco sobre infraestrutura </h2><br>  Antes de preenchermos os dados nas tabelas dos bancos de dados relacionais, precisamos aceit√°-los da fonte - em qualquer formato, por exemplo, no Excel.  Os dados da fonte usando o mecanismo interno s√£o transportados para o Hadoop (Data Lake).  O Hive possui o complemento Hive instalado - com sua ajuda, podemos visualizar o conte√∫do dos arquivos usando a sintaxe semelhante ao SQL. <br><br>  Para transferir os dados no Data Lake na forma de tabelas, precisamos do json's, formado com base em metadados.  Para analisar dados no formato Excel, precisamos criar arquivos EDWEX.  Arquivos EDWEX (EDW_EXTRACTOR) s√£o um determinado conjunto de artefatos que cont√™m conjuntos de tabelas com o nome, bem como conjuntos de campos para cada uma dessas tabelas, formados com base em metadados.  Dependendo da vers√£o do modelo e do ID de origem, o conjunto de campos varia.  A forma√ß√£o de DDL √© necess√°ria para criar as pr√≥prias tabelas no banco de dados Hive no n√≠vel dos dados operacionais e no banco de dados Greenplum no n√≠vel dos dados detalhados e agregados.  Ou seja, os dados s√£o inicialmente transferidos para o Hive, se necess√°rio, filtrados e transferidos para o Greenplum para manipula√ß√£o de dados subsequente e cria√ß√£o de fachadas de lojas baseadas nele. <br><br><div class="spoiler">  <b class="spoiler_title">Exemplo de artefato Edwex</b> <div class="spoiler_text">  pack - cont√©m um conjunto de tabelas <br>  data - cont√©m um conjunto de campos <br><br>  pack.edwex: <br><br><pre><code class="sql hljs">1 Table_1 User Table_1 bid between to_char($fromdt,'yyyymm') and to_char($actualdt,'yyyymm') 2 Table_2 User Table_2 curbid between to_char($fromdt,'yyyymm') and to_char($actualdt,'yyyymm') 3 Table_3 User Table_3 bid between to_char($fromdt,'yyyymm') and to_char($actualdt,'yyyymm')</code> </pre> <br><br>  data.edwex: <br><br><pre> <code class="sql hljs">1 1 CHARGE_ID NUMBER 38 0 1 2 SVC_ID NUMBER 38 0 1 3 VND_ID NUMBER 38 0 1 4 PRICE NUMBER 38 5 1 5 QUANTITY NUMBER 38 5 1 6 BASE NUMBER 38 5 1 7 TAX NUMBER 38 5 1 8 TOTAL NUMBER 38 5 1 9 TAX_RATE NUMBER 38 5 1 10 TAX_IN VARCHAR 1 1 11 CHARGE_KIND VARCHAR 3 1 12 PRIVILEGE_ID NUMBER 38 0 1 13 CHARGE_REF_ID NUMBER 38 0 1 14 EBID NUMBER 38 0 1 15 INVOICE_ID NUMBER 38 0 1 16 ZERO_STATE_ID NUMBER 38 0 1 17 USER_ID NUMBER 38 0 1 18 BID NUMBER 38 0 1 19 QUANTITY_REAL NUMBER 38 5 2 1 CURBID NUMBER 38 0 2 2 USER_ID NUMBER 38 0 2 3 VND_ID NUMBER 38 0 2 4 APPBID NUMBER 38 0 2 5 SVC_ID NUMBER 38 0 2 6 DEBT NUMBER 38 5 2 7 INSTDEBT NUMBER 38 5 3 1 INVOICE_ID NUMBER 38 0 3 2 INVOICE_DATE DATE 3 3 INVOICE_NUM VARCHAR 64 3 4 INVOICE_NUM_N NUMBER 38 5 3 5 BASE NUMBER 38 5 3 6 TAX NUMBER 38 5 3 7 TOTAL NUMBER 38 5 3 8 PREPAID VARCHAR 1 3 9 EXPLICIT VARCHAR 1 3 10 VND_ID NUMBER 38 0 3 11 ADV_PAYMENT_ID NUMBER 38 0 3 12 MDBID NUMBER 38 0 3 13 BID NUMBER 38 0 3 14 USER_ID NUMBER 38 0 3 15 ZERO_STATE_ID NUMBER 38 0 3 16 ACTIVE_SUM NUMBER 38 5 3 17 SPLIT_VND NUMBER 38 5 3 18 PRECREATED VARCHAR 1</code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Exemplo de artefato Json</b> <div class="spoiler_text"><pre> <code class="java hljs">Table.json: { <span class="hljs-string"><span class="hljs-string">"metadata"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"colOrder"</span></span>:<span class="hljs-string"><span class="hljs-string">"1"</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">"charge_id"</span></span>, <span class="hljs-string"><span class="hljs-string">"dataType"</span></span>:<span class="hljs-string"><span class="hljs-string">"DECIMAL"</span></span>, <span class="hljs-string"><span class="hljs-string">"precision"</span></span>:<span class="hljs-string"><span class="hljs-string">"0"</span></span>, <span class="hljs-string"><span class="hljs-string">"requied"</span></span>:<span class="hljs-string"><span class="hljs-string">"true"</span></span>, <span class="hljs-string"><span class="hljs-string">"keyFile"</span></span>:<span class="hljs-string"><span class="hljs-string">""</span></span> }, { <span class="hljs-string"><span class="hljs-string">"colOrder"</span></span>:<span class="hljs-string"><span class="hljs-string">"2"</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">"svc_id"</span></span>, <span class="hljs-string"><span class="hljs-string">"dataType"</span></span>:<span class="hljs-string"><span class="hljs-string">"DECIMAL"</span></span>, <span class="hljs-string"><span class="hljs-string">"precision"</span></span>:<span class="hljs-string"><span class="hljs-string">"0"</span></span>, <span class="hljs-string"><span class="hljs-string">"requied"</span></span>:<span class="hljs-string"><span class="hljs-string">"false"</span></span>, <span class="hljs-string"><span class="hljs-string">"keyFile"</span></span>:<span class="hljs-string"><span class="hljs-string">""</span></span> }, { <span class="hljs-string"><span class="hljs-string">"colOrder"</span></span>:<span class="hljs-string"><span class="hljs-string">"3"</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">"vnd_id"</span></span>, <span class="hljs-string"><span class="hljs-string">"dataType"</span></span>:<span class="hljs-string"><span class="hljs-string">"DECIMAL"</span></span>, <span class="hljs-string"><span class="hljs-string">"precision"</span></span>:<span class="hljs-string"><span class="hljs-string">"0"</span></span>, <span class="hljs-string"><span class="hljs-string">"requied"</span></span>:<span class="hljs-string"><span class="hljs-string">"false"</span></span>, <span class="hljs-string"><span class="hljs-string">"keyFile"</span></span>:<span class="hljs-string"><span class="hljs-string">""</span></span> }, { <span class="hljs-string"><span class="hljs-string">"colOrder"</span></span>:<span class="hljs-string"><span class="hljs-string">"4"</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">"price"</span></span>, <span class="hljs-string"><span class="hljs-string">"dataType"</span></span>:<span class="hljs-string"><span class="hljs-string">"DECIMAL"</span></span>, <span class="hljs-string"><span class="hljs-string">"precision"</span></span>:<span class="hljs-string"><span class="hljs-string">"0"</span></span>, <span class="hljs-string"><span class="hljs-string">"requied"</span></span>:<span class="hljs-string"><span class="hljs-string">"false"</span></span>, <span class="hljs-string"><span class="hljs-string">"keyFile"</span></span>:<span class="hljs-string"><span class="hljs-string">""</span></span> }, { <span class="hljs-string"><span class="hljs-string">"colOrder"</span></span>:<span class="hljs-string"><span class="hljs-string">"5"</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">"quantity"</span></span>, <span class="hljs-string"><span class="hljs-string">"dataType"</span></span>:<span class="hljs-string"><span class="hljs-string">"DECIMAL"</span></span>, <span class="hljs-string"><span class="hljs-string">"precision"</span></span>:<span class="hljs-string"><span class="hljs-string">"0"</span></span>, <span class="hljs-string"><span class="hljs-string">"requied"</span></span>:<span class="hljs-string"><span class="hljs-string">"false"</span></span>, <span class="hljs-string"><span class="hljs-string">"keyFile"</span></span>:<span class="hljs-string"><span class="hljs-string">""</span></span> }, { <span class="hljs-string"><span class="hljs-string">"colOrder"</span></span>:<span class="hljs-string"><span class="hljs-string">"6"</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">"base"</span></span>, <span class="hljs-string"><span class="hljs-string">"dataType"</span></span>:<span class="hljs-string"><span class="hljs-string">"DECIMAL"</span></span>, <span class="hljs-string"><span class="hljs-string">"precision"</span></span>:<span class="hljs-string"><span class="hljs-string">"0"</span></span>, <span class="hljs-string"><span class="hljs-string">"requied"</span></span>:<span class="hljs-string"><span class="hljs-string">"false"</span></span>, <span class="hljs-string"><span class="hljs-string">"keyFile"</span></span>:<span class="hljs-string"><span class="hljs-string">""</span></span> }, { <span class="hljs-string"><span class="hljs-string">"colOrder"</span></span>:<span class="hljs-string"><span class="hljs-string">"7"</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">"tax"</span></span>, <span class="hljs-string"><span class="hljs-string">"dataType"</span></span>:<span class="hljs-string"><span class="hljs-string">"DECIMAL"</span></span>, <span class="hljs-string"><span class="hljs-string">"precision"</span></span>:<span class="hljs-string"><span class="hljs-string">"0"</span></span>, <span class="hljs-string"><span class="hljs-string">"requied"</span></span>:<span class="hljs-string"><span class="hljs-string">"false"</span></span>, <span class="hljs-string"><span class="hljs-string">"keyFile"</span></span>:<span class="hljs-string"><span class="hljs-string">""</span></span> }, { <span class="hljs-string"><span class="hljs-string">"colOrder"</span></span>:<span class="hljs-string"><span class="hljs-string">"8"</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">"total"</span></span>, <span class="hljs-string"><span class="hljs-string">"dataType"</span></span>:<span class="hljs-string"><span class="hljs-string">"DECIMAL"</span></span>, <span class="hljs-string"><span class="hljs-string">"precision"</span></span>:<span class="hljs-string"><span class="hljs-string">"0"</span></span>, <span class="hljs-string"><span class="hljs-string">"requied"</span></span>:<span class="hljs-string"><span class="hljs-string">"false"</span></span>, <span class="hljs-string"><span class="hljs-string">"keyFile"</span></span>:<span class="hljs-string"><span class="hljs-string">""</span></span> }, { <span class="hljs-string"><span class="hljs-string">"colOrder"</span></span>:<span class="hljs-string"><span class="hljs-string">"9"</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">"tax_rate"</span></span>, <span class="hljs-string"><span class="hljs-string">"dataType"</span></span>:<span class="hljs-string"><span class="hljs-string">"DECIMAL"</span></span>, <span class="hljs-string"><span class="hljs-string">"precision"</span></span>:<span class="hljs-string"><span class="hljs-string">"0"</span></span>, <span class="hljs-string"><span class="hljs-string">"requied"</span></span>:<span class="hljs-string"><span class="hljs-string">"false"</span></span>, <span class="hljs-string"><span class="hljs-string">"keyFile"</span></span>:<span class="hljs-string"><span class="hljs-string">""</span></span> }, { <span class="hljs-string"><span class="hljs-string">"colOrder"</span></span>:<span class="hljs-string"><span class="hljs-string">"10"</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">"tax_in"</span></span>, <span class="hljs-string"><span class="hljs-string">"dataType"</span></span>:<span class="hljs-string"><span class="hljs-string">"STRING"</span></span>, <span class="hljs-string"><span class="hljs-string">"precision"</span></span>:<span class="hljs-string"><span class="hljs-string">"0"</span></span>, <span class="hljs-string"><span class="hljs-string">"requied"</span></span>:<span class="hljs-string"><span class="hljs-string">"false"</span></span>, <span class="hljs-string"><span class="hljs-string">"keyFile"</span></span>:<span class="hljs-string"><span class="hljs-string">""</span></span> }, { <span class="hljs-string"><span class="hljs-string">"colOrder"</span></span>:<span class="hljs-string"><span class="hljs-string">"11"</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">"charge_kind"</span></span>, <span class="hljs-string"><span class="hljs-string">"dataType"</span></span>:<span class="hljs-string"><span class="hljs-string">"STRING"</span></span>, <span class="hljs-string"><span class="hljs-string">"precision"</span></span>:<span class="hljs-string"><span class="hljs-string">"0"</span></span>, <span class="hljs-string"><span class="hljs-string">"requied"</span></span>:<span class="hljs-string"><span class="hljs-string">"false"</span></span>, <span class="hljs-string"><span class="hljs-string">"keyFile"</span></span>:<span class="hljs-string"><span class="hljs-string">""</span></span> }, { <span class="hljs-string"><span class="hljs-string">"colOrder"</span></span>:<span class="hljs-string"><span class="hljs-string">"12"</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">"privilege_id"</span></span>, <span class="hljs-string"><span class="hljs-string">"dataType"</span></span>:<span class="hljs-string"><span class="hljs-string">"DECIMAL"</span></span>, <span class="hljs-string"><span class="hljs-string">"precision"</span></span>:<span class="hljs-string"><span class="hljs-string">"0"</span></span>, <span class="hljs-string"><span class="hljs-string">"requied"</span></span>:<span class="hljs-string"><span class="hljs-string">"false"</span></span>, <span class="hljs-string"><span class="hljs-string">"keyFile"</span></span>:<span class="hljs-string"><span class="hljs-string">""</span></span> }, { <span class="hljs-string"><span class="hljs-string">"colOrder"</span></span>:<span class="hljs-string"><span class="hljs-string">"13"</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">"charge_ref_id"</span></span>, <span class="hljs-string"><span class="hljs-string">"dataType"</span></span>:<span class="hljs-string"><span class="hljs-string">"DECIMAL"</span></span>, <span class="hljs-string"><span class="hljs-string">"precision"</span></span>:<span class="hljs-string"><span class="hljs-string">"0"</span></span>, <span class="hljs-string"><span class="hljs-string">"requied"</span></span>:<span class="hljs-string"><span class="hljs-string">"false"</span></span>, <span class="hljs-string"><span class="hljs-string">"keyFile"</span></span>:<span class="hljs-string"><span class="hljs-string">""</span></span> }, { <span class="hljs-string"><span class="hljs-string">"colOrder"</span></span>:<span class="hljs-string"><span class="hljs-string">"14"</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">"ebid"</span></span>, <span class="hljs-string"><span class="hljs-string">"dataType"</span></span>:<span class="hljs-string"><span class="hljs-string">"DECIMAL"</span></span>, <span class="hljs-string"><span class="hljs-string">"precision"</span></span>:<span class="hljs-string"><span class="hljs-string">"0"</span></span>, <span class="hljs-string"><span class="hljs-string">"requied"</span></span>:<span class="hljs-string"><span class="hljs-string">"false"</span></span>, <span class="hljs-string"><span class="hljs-string">"keyFile"</span></span>:<span class="hljs-string"><span class="hljs-string">""</span></span> }, { <span class="hljs-string"><span class="hljs-string">"colOrder"</span></span>:<span class="hljs-string"><span class="hljs-string">"15"</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">"invoice_id"</span></span>, <span class="hljs-string"><span class="hljs-string">"dataType"</span></span>:<span class="hljs-string"><span class="hljs-string">"DECIMAL"</span></span>, <span class="hljs-string"><span class="hljs-string">"precision"</span></span>:<span class="hljs-string"><span class="hljs-string">"0"</span></span>, <span class="hljs-string"><span class="hljs-string">"requied"</span></span>:<span class="hljs-string"><span class="hljs-string">"false"</span></span>, <span class="hljs-string"><span class="hljs-string">"keyFile"</span></span>:<span class="hljs-string"><span class="hljs-string">""</span></span> }, { <span class="hljs-string"><span class="hljs-string">"colOrder"</span></span>:<span class="hljs-string"><span class="hljs-string">"16"</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">"zero_state_id"</span></span>, <span class="hljs-string"><span class="hljs-string">"dataType"</span></span>:<span class="hljs-string"><span class="hljs-string">"DECIMAL"</span></span>, <span class="hljs-string"><span class="hljs-string">"precision"</span></span>:<span class="hljs-string"><span class="hljs-string">"0"</span></span>, <span class="hljs-string"><span class="hljs-string">"requied"</span></span>:<span class="hljs-string"><span class="hljs-string">"false"</span></span>, <span class="hljs-string"><span class="hljs-string">"keyFile"</span></span>:<span class="hljs-string"><span class="hljs-string">""</span></span> }, { <span class="hljs-string"><span class="hljs-string">"colOrder"</span></span>:<span class="hljs-string"><span class="hljs-string">"17"</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">"user_id"</span></span>, <span class="hljs-string"><span class="hljs-string">"dataType"</span></span>:<span class="hljs-string"><span class="hljs-string">"DECIMAL"</span></span>, <span class="hljs-string"><span class="hljs-string">"precision"</span></span>:<span class="hljs-string"><span class="hljs-string">"0"</span></span>, <span class="hljs-string"><span class="hljs-string">"requied"</span></span>:<span class="hljs-string"><span class="hljs-string">"false"</span></span>, <span class="hljs-string"><span class="hljs-string">"keyFile"</span></span>:<span class="hljs-string"><span class="hljs-string">""</span></span> }, { <span class="hljs-string"><span class="hljs-string">"colOrder"</span></span>:<span class="hljs-string"><span class="hljs-string">"18"</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">"bid"</span></span>, <span class="hljs-string"><span class="hljs-string">"dataType"</span></span>:<span class="hljs-string"><span class="hljs-string">"DECIMAL"</span></span>, <span class="hljs-string"><span class="hljs-string">"precision"</span></span>:<span class="hljs-string"><span class="hljs-string">"0"</span></span>, <span class="hljs-string"><span class="hljs-string">"requied"</span></span>:<span class="hljs-string"><span class="hljs-string">"false"</span></span>, <span class="hljs-string"><span class="hljs-string">"keyFile"</span></span>:<span class="hljs-string"><span class="hljs-string">""</span></span> }, { <span class="hljs-string"><span class="hljs-string">"colOrder"</span></span>:<span class="hljs-string"><span class="hljs-string">"19"</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">"quantity_real"</span></span>, <span class="hljs-string"><span class="hljs-string">"dataType"</span></span>:<span class="hljs-string"><span class="hljs-string">"DECIMAL"</span></span>, <span class="hljs-string"><span class="hljs-string">"precision"</span></span>:<span class="hljs-string"><span class="hljs-string">"0"</span></span>, <span class="hljs-string"><span class="hljs-string">"requied"</span></span>:<span class="hljs-string"><span class="hljs-string">"false"</span></span>, <span class="hljs-string"><span class="hljs-string">"keyFile"</span></span>:<span class="hljs-string"><span class="hljs-string">""</span></span> } ], <span class="hljs-string"><span class="hljs-string">"ctlPath"</span></span>:<span class="hljs-string"><span class="hljs-string">"  ctl"</span></span>, <span class="hljs-string"><span class="hljs-string">"errPath"</span></span>:<span class="hljs-string"><span class="hljs-string">"    "</span></span>, <span class="hljs-string"><span class="hljs-string">"inPath"</span></span>:<span class="hljs-string"><span class="hljs-string">"    hdfs"</span></span>, <span class="hljs-string"><span class="hljs-string">"outSchema"</span></span>:<span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">"outTable"</span></span>:<span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">"isPartitioned"</span></span>:<span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">"sourceId"</span></span>:<span class="hljs-string"><span class="hljs-string">"id  "</span></span> }</code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Artefatos DDL de Exemplo</b> <div class="spoiler_text">  altere o esquema da tabela.GP_000001_TABLE renomeie para Z_GP_000001_TABLE_20180807; <br>  criar esquema de tabela.GP_000001_TABLE <br>  ( <br><br>  `charge_id` DECIMAL (38.0), <br>  `svc_id` DECIMAL (38.0), <br>  `vnd_id` DECIMAL (38.0), <br>  DECIMAL (38.5), <br>  ¬´quantidade¬ª DECIMAL (38.5), <br>  DECIMAL (base) (38.5) <br>  DECIMAL (38.5), <br>  DECIMAL ¬´total¬ª (38,5) <br>  ¬´tax_rate¬ª DECIMAL (38.5), <br>  `tax_in` STRING, <br>  `charge_kind` STRING, <br>  `privil√©gio_id` DECIMAL (38.0), <br>  `charge_ref_id` DECIMAL (38.0), <br>  DECIMAL (38.0) <br>  `invoice_id` DECIMAL (38.0), <br>  `zero_state_id` DECIMAL (38,0), <br>  `user_id` DECIMAL (38.0), <br>  `bid` DECIMAL (38.0), <br>  `Quantity_real` DECIMAL (38.5), <br>  `load_dttm` TIMESTAMP, <br>  `src_id` SMALLINT, <br>  `package_id` BIGINT, <br>  `wf_run_id` BIGINT, <br>  `md5` STRING <br>  ) <br>  CAMPOS DELIMITADOS DE FORMATO DE LINHA TERMINADOS POR '\ t' <br>  ARMAZENADO COMO INPUTFORMAT 'org.apache.hadoop.mapred.TextInputFormat' OUTPUTFORMAT 'org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat' <br>  LOCAL 'maneira de formar em hdfs' <br>  TBLPROPERTIES ('auto.purge' = 'true', 'transient_lastDlastDdlTime' = '1489060201'); <br>  inserir no esquema.GP_000001_TABLE (`charge_id`, <br>  `svc_id`, <br>  `vnd_id`, <br>  `pre√ßo ', <br>  `quantidade ', <br>  `base`, <br>  ¬´imposto¬ª, <br>  ¬´total¬ª, <br>  `tax_rate`, <br>  `tax_in`, <br>  `charge_kind`, <br>  `privilege_id`, <br>  `charge_ref_id`, <br>  `ebid`, <br>  `invoice_id`, <br>  `zero_state_id`, <br>  `user_id`, <br>  licitar <br>  `Quantity_real`, <br>  `load_dttm`, <br>  `src_id`, <br>  package_id <br>  `wf_run_id`, <br>  `md5`) <br><br>  selecione `charge_id`, <br>  `svc_id`, <br>  `vnd_id`, <br>  `pre√ßo ', <br>  `quantidade ', <br>  `base`, <br>  ¬´imposto¬ª, <br>  ¬´total¬ª, <br>  `tax_rate`, <br>  `tax_in`, <br>  `charge_kind`, <br>  `privilege_id`, <br>  `charge_ref_id`, <br>  `ebid`, <br>  `invoice_id`, <br>  `zero_state_id`, <br>  `user_id`, <br>  licitar <br>  `Quantity_real`, <br>  load_dttm, <br>  src_id <br>  package_id, <br>  wf_run_id, <br>  md5 do esquema.Z_GP_000001_TABLE_20180807; <br><br>  altere o esquema da tabela.GP_000001_TABLE renomeie para Z_GP_000001_TABLE_20180807; <br>  criar esquema de tabela.GP_000001_TABLE <br>  ( <br><br>  `charge_id` DECIMAL (38.0), <br>  `svc_id` DECIMAL (38.0), <br>  `vnd_id` DECIMAL (38.0), <br>  DECIMAL (38.5), <br>  ¬´quantidade¬ª DECIMAL (38.5), <br>  DECIMAL (base) (38.5) <br>  DECIMAL (38.5), <br>  DECIMAL ¬´total¬ª (38,5) <br>  ¬´tax_rate¬ª DECIMAL (38.5), <br>  `tax_in` STRING, <br>  `charge_kind` STRING, <br>  `privil√©gio_id` DECIMAL (38.0), <br>  `charge_ref_id` DECIMAL (38.0), <br>  DECIMAL (38.0) <br>  `invoice_id` DECIMAL (38.0), <br>  `zero_state_id` DECIMAL (38,0), <br>  `user_id` DECIMAL (38.0), <br>  `bid` DECIMAL (38.0), <br>  `Quantity_real` DECIMAL (38.5), <br>  `load_dttm` TIMESTAMP, <br>  `src_id` SMALLINT, <br>  `package_id` BIGINT, <br>  `wf_run_id` BIGINT, <br>  `md5` STRING <br>  ) <br>  CAMPOS DELIMITADOS DE FORMATO DE LINHA TERMINADOS POR '\ t' <br>  ARMAZENADO COMO INPUTFORMAT 'org.apache.hadoop.mapred.TextInputFormat' OUTPUTFORMAT 'org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat' <br>  LOCAL 'maneira de formar em hdfs' <br>  TBLPROPERTIES ('auto.purge' = 'true', 'transient_lastDlastDdlTime' = '1489060201'); <br>  inserir no esquema.GP_000001_CPA_CHARGE (`charge_id`, <br>  `svc_id`, <br>  `vnd_id`, <br>  `pre√ßo ', <br>  `quantidade ', <br>  `base`, <br>  ¬´imposto¬ª, <br>  ¬´total¬ª, <br>  `tax_rate`, <br>  `tax_in`, <br>  `charge_kind`, <br>  `privilege_id`, <br>  `charge_ref_id`, <br>  `ebid`, <br>  `invoice_id`, <br>  `zero_state_id`, <br>  `user_id`, <br>  licitar <br>  `Quantity_real`, <br>  `load_dttm`, <br>  `src_id`, <br>  package_id <br>  `wf_run_id`, <br>  `md5`) <br><br>  selecione `charge_id`, <br>  `svc_id`, <br>  `vnd_id`, <br>  `pre√ßo ', <br>  `quantidade ', <br>  `base`, <br>  ¬´imposto¬ª, <br>  ¬´total¬ª, <br>  `tax_rate`, <br>  `tax_in`, <br>  `charge_kind`, <br>  `privilege_id`, <br>  `charge_ref_id`, <br>  `ebid`, <br>  `invoice_id`, <br>  `zero_state_id`, <br>  `user_id`, <br>  licitar <br>  `Quantity_real`, <br>  load_dttm, <br>  src_id <br>  package_id, <br>  wf_run_id, <br>  md5 do esquema.Z_GP_000001_TABLE_20180807; <br></div></div><br><h2>  Como automatizar </h2><br>  Para resolver o problema, usamos: <br><br><ul><li>  Jenkins - como orquestra e ferramenta para implementar o processo de IC. <br></li><li>  Python - implementa testes de funcionalidade e unidade. <br></li><li>  SQL - para acessar o banco de dados de metadados. <br></li><li>  Script de shell - para copiar artefatos entre diret√≥rios e criar scripts em projetos com v√°rios trabalhos em execu√ß√£o no servidor Jenkins. <br></li></ul><br>  Para come√ßar, trabalhamos inicialmente com um grande n√∫mero de fontes; portanto, usando o script Shell como par√¢metro de in√≠cio, passamos os IDs das fontes para as fun√ß√µes SQL para identific√°-las.  As fun√ß√µes SQL resultantes ser√£o posteriormente executadas automaticamente no banco de dados de metadados.  Com base nos metadados dispon√≠veis, essas fun√ß√µes formam um arquivo com uma lista de novas fun√ß√µes SQL para cada uma das tabelas de origem, para que possamos cham√°-las posteriormente no programa execut√°vel.  O resultado da execu√ß√£o das fun√ß√µes geradas √© a transfer√™ncia dos valores DDL, JSON ou EDWEX para o par√¢metro de sa√≠da. <br><br>  √â aqui que o Python se conecta, com todas as funcionalidades execut√°veis ‚Äã‚Äãe testes de unidade gravados.  Antes de iniciar qualquer um dos m√≥dulos para rolar artefatos usando testes de unidade, a transfer√™ncia correta de par√¢metros √© verificada para executar scripts python.  Os testes n√£o apenas verificam a corre√ß√£o dos par√¢metros de entrada, mas tamb√©m a presen√ßa deles no m√≥dulo de metadados, os tamanhos dos arquivos criados e as datas de sua cria√ß√£o.  Os testes tamb√©m monitoram o n√∫mero de novos artefatos criados e o n√∫mero de artefatos existentes.  Portanto, otimizamos o uso dos recursos do servidor, porque pegamos apenas novos arquivos para rolagem e n√£o reinstalamos os modelos existentes novamente. <br><br>  E somente ap√≥s a aprova√ß√£o bem-sucedida de todas as verifica√ß√µes √© executado um programa python que cria os artefatos necess√°rios e decomp√µe o resultado nas pastas de projeto necess√°rias no servidor.  O Python n√£o apenas direciona os arquivos json gerados para os diret√≥rios, mas tamb√©m forma estruturas no Data Lake para que os dados sejam carregados corretamente.  Ao gerar artefatos DDL, eles n√£o s√£o salvos apenas para an√°lise e reutiliza√ß√£o posteriores, mas tamb√©m podem ser instalados imediatamente no banco de dados usando novos modelos e estruturas especificados no m√≥dulo de metadados.  Isso permite criar centenas de tabelas em um curto espa√ßo de tempo sem envolver trabalho manual. <br><br><h2>  E onde est√° Jenkins aqui? </h2><br>  Jenkins entra quando √© necess√°rio gerenciar todos esses processos visualmente usando uma interface. <br><br>  Esta ferramenta foi selecionada porque: <br><br><ul><li>  cobre totalmente as necessidades de automa√ß√£o da montagem e instala√ß√£o <br></li><li>  permite projetar um mecanismo para montar artefatos com a implementa√ß√£o do processo de autoteste <br></li><li>  permite gerenciar facilmente lan√ßamentos de empregos e monitorar a execu√ß√£o de uma pessoa que est√° longe de programar <br></li><li>  permite que voc√™ configure o mecanismo de log de maneira que o resultado da execu√ß√£o seja compreens√≠vel para qualquer pessoa da equipe.  O problema na montagem ser√° indicado explicitamente ou o processo ser√° conclu√≠do com √™xito. <br></li></ul><br>  Para resolver as tarefas, criamos v√°rios projetos com v√°rios empregos.  Esse tipo de projeto foi usado, pois pode funcionar em paralelo com outros trabalhos em uma √∫nica inicializa√ß√£o.  Cada tarefa √© respons√°vel pela implementa√ß√£o de seu bloco de funcionalidades.  Ent√£o, substitu√≠mos o processo seq√ºencial de obter artefatos por paralelos aut√¥nomos.  Tudo come√ßa separadamente: a forma√ß√£o de EDWEX, JSON, DDL, a forma√ß√£o da estrutura no HIVE, a instala√ß√£o de estruturas de tabela no banco de dados.  Analisamos o resultado em diferentes est√°gios da forma√ß√£o de artefatos e procedemos ao lan√ßamento de a√ß√µes subsequentes, se bem-sucedidas. <br><br>  A parte de Jenkins √© implementada sem muitos truques.  <b>Os</b> par√¢metros <b>String</b> ou <b>Run</b> s√£o enviados √† entrada para iniciar o c√≥digo python.  <b>O</b> par√¢metro <b>String</b> √© uma janela para inserir um valor do tipo str antes de iniciar.  <b>O</b> par√¢metro de <b>execu√ß√£o</b> pode ser transferido imediatamente para outro trabalho para execu√ß√£o, bastando apenas indicar de qual projeto √© necess√°rio obter a vari√°vel recebida.  Al√©m disso, um n√≥ √© passado como um par√¢metro separado para execu√ß√£o.  Aqui, o particionamento em tempos de execu√ß√£o no DEV, TST, UAT, PRD √© apenas implementado.  Um trabalho separado foi usado para transferir os arquivos EDWEX recebidos para o SVN com o n√∫mero de revis√£o para poder rastrear vers√µes das estruturas alteradas. <br><br>  Um exemplo de interface no Jenkins: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/00f/250/8c5/00f2508c5c04082a8b753041e471fe14.png"><br><br>  O resultado da execu√ß√£o da tarefa √© a cria√ß√£o e instala√ß√£o dos artefatos necess√°rios, sua transfer√™ncia para o SVN e a forma√ß√£o de um relat√≥rio HTML que mostra o sucesso da aprova√ß√£o nos testes de unidade e os resultados da montagem e instala√ß√£o dos artefatos.  Os trabalhos podem ser executados individualmente com as m√£os, ou no modo autom√°tico, tendo constru√≠do anteriormente uma cadeia de execu√ß√£o. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/324/549/50f/32454950f7eb0476ca4cc753715c4472.png"><br>  <i>Arquitetura de mecanismo de montagem e instala√ß√£o</i> <br><br><h3>  Resumir </h3><br>  Muito trabalho foi feito para automatizar a forma√ß√£o de artefatos.  Anteriormente, era necess√°rio subir manualmente no servidor, executar scripts de shell e, em seguida, estudar e editar os dados por um longo tempo com as m√£os.  Agora basta clicar no bot√£o Iniciar, especifique o ID do sistema de origem, o n√∫mero do modelo e o loop de execu√ß√£o.  Com a ajuda de Jenkins, foi poss√≠vel estruturar e decompor todo o mecanismo de montagem e instala√ß√£o de artefatos em est√°gios independentes.  As verifica√ß√µes necess√°rias foram inclu√≠das antes de iniciar a forma√ß√£o de artefatos e sua integra√ß√£o.  Os artefatos recebidos s√£o transferidos automaticamente para o SVN, o que simplifica o trabalho com equipes relacionadas de analistas de sistema e modeladores de dados.  As verifica√ß√µes s√£o implementadas para evitar lan√ßamentos ociosos da forma√ß√£o de artefatos e confirmar sua corre√ß√£o. <br><br>  Como resultado, reduzimos o processo demorado de montar e instalar artefatos do modelo de v√°rias horas para alguns minutos.  E o mais importante, eles eliminaram a ocorr√™ncia de erros devido ao fator humano, que inevitavelmente surgiu em um complexo processo de rotina. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt428101/">https://habr.com/ru/post/pt428101/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt428089/index.html">"Calend√°rio do testador" para outubro. Feedback: como acontece</a></li>
<li><a href="../pt428091/index.html">Como um aluno interno criou o videogame mais popular do mundo ou o hist√≥rico de jogos do Windows</a></li>
<li><a href="../pt428095/index.html">Pesquisa de mercado para est√∫dios da web e ag√™ncias digitais</a></li>
<li><a href="../pt428097/index.html">Roteamento recursivo no MikroTik atrav√©s de gateways atribu√≠dos pelo DHCP</a></li>
<li><a href="../pt428099/index.html">O que os vestidos comuns e a pr√≥xima era 5G t√™m em comum?</a></li>
<li><a href="../pt428103/index.html">Mitap em S√£o Petersburgo: Engenharia de Dados e mais</a></li>
<li><a href="../pt428105/index.html">O Blogger recomenda: influenciar o marketing</a></li>
<li><a href="../pt428107/index.html">Containeriza√ß√£o de aplicativos Angular 6 SPA Template ASP .NET Core 2.1</a></li>
<li><a href="../pt428109/index.html">Parede corporativa</a></li>
<li><a href="../pt428111/index.html">Aritm√©tica da precis√£o arbitr√°ria em Erlang</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>