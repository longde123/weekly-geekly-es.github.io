<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü•ì ü§≤üèæ ü•© [R√©sum√© administrateur] Comment se faire des amis avec DHCP et ne pas avoir peur d'APIPA üèûÔ∏è üôèüèª üíπ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Le service qui d√©livre des adresses IP aux appareils du r√©seau local semble √™tre l'un des plus simples et des plus familiers. N√©anmoins, mes jeunes co...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>[R√©sum√© administrateur] Comment se faire des amis avec DHCP et ne pas avoir peur d'APIPA</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pc-administrator/blog/467333/"><p><img src="https://habrastorage.org/getpro/habr/post_images/9c9/795/e15/9c9795e155e62808327ad29e2e964e7a.jpg"></p><br><p>  Le service qui d√©livre des adresses IP aux appareils du r√©seau local semble √™tre l'un des plus simples et des plus familiers.  N√©anmoins, mes jeunes coll√®gues ont encore occasionnellement des questions telles que "l'ordinateur re√ßoit une adresse √©trange", et l'apparition d'un deuxi√®me serveur DHCP dans un segment de r√©seau provoque des frissons ou des probl√®mes de r√©seau. </p><br><p>  Pour que ceux qui lisent ce document n'aient pas de telles questions, je voudrais rassembler un tas d'informations de base sur le fonctionnement des m√©canismes d'√©mission d'adresse IP, les fonctionnalit√©s et les exemples de configuration des configurations de s√©curit√© et de s√©curit√©.  Et il sera peut-√™tre int√©ressant pour les sp√©cialistes chevronn√©s de rafra√Æchir les connexions neuronales. </p><br><p>  Un peu de th√©orie et des solutions √† des probl√®mes int√©ressants et peu pratiques - sous la coupe. </p><a name="habracut"></a><br><p>  Dans un r√©seau local moderne, les adresses sont g√©n√©ralement fournies par des services sp√©cialis√©s avec prise en charge de protocole.  Le plus populaire d'entre eux est DHCP (Dynamic Host Configuration Protocol). </p><br><h1 id="zeroconf-ili-zachem-nam-voobsche-kakoy-to-dhcp">  Zeroconf ou pourquoi avons-nous besoin d'une sorte de DHCP </h1><br><p> En principe, une pile technologique appel√©e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Zeroconf a</a> √©t√© cr√©√©e sp√©cifiquement pour les petits r√©seaux.  Il vous permet de vous passer de services et serveurs centralis√©s, y compris, mais sans s'y limiter, la d√©livrance d'adresses IP.  Ils ferment (enfin, ou presque) les questions suivantes: </p><br><p>  <strong>Obtention d'une adresse IP</strong> (Adressage IP priv√© automatique ou APIPA).  Le syst√®me lui-m√™me attribue une IP √† partir du r√©seau 169.254.0.0/16 (√† l'exception des grilles / 24 au d√©but et √† la fin de la plage), en fonction de l'adresse MAC et du g√©n√©rateur de nombres pseudo al√©atoires.  Ce syst√®me vous permet d'√©viter les conflits et l'adresse de ce r√©seau est appel√©e liaison locale - y compris parce que ces adresses ne sont pas rout√©es. </p><br><p>  <strong>Recherche par nom</strong> .  Le syst√®me annonce son nom de r√©seau et chaque ordinateur fonctionne avec lui comme avec DNS, stockant les entr√©es dans son cache.  Apple utilise la technologie mDNS (Multicast DNS) et Microsoft utilise LLMNR (Link-local Multicast Name Resolution), mentionn√© dans l'article ¬´ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Domaines, adresses et Windows: m√©langez, mais ne secouez pas</a> ¬ª. </p><br><p>  <strong>Recherchez les services r√©seau</strong> .  Par exemple, des imprimantes.  Le protocole le plus c√©l√®bre est peut-√™tre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">UPnP</a> , qui, entre autres, peut ouvrir des ports sur les routeurs lui-m√™me.  Le protocole est plut√¥t compliqu√©, il utilise tout un ensemble d'add-ons comme http, contrairement au deuxi√®me protocole bien connu - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">DNS-SD</a> (DNS Service Discovery), qui utilise simplement des enregistrements SRV, y compris lorsque vous travaillez avec mDNS. </p><br><p>  Avec tous les avantages de Zeroconf - sans aucune connaissance sacr√©e, vous pouvez construire un r√©seau fonctionnel en connectant simplement des ordinateurs au niveau physique - il peut m√™me interf√©rer avec les sp√©cialistes informatiques. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/d5b/71d/a7e/d5b71da7ea5fe5493e9881ee71272394.jpg"></p><br><p>  <em>Un peu ennuyeux, non?</em> </p><br><p>  Sur les syst√®mes Windows, pour d√©sactiver le r√©glage automatique sur toutes les cartes r√©seau, vous devez cr√©er un param√®tre DWORD avec le nom <em>IPAutoconfigurationEnabled</em> dans la section <em>HKEY_LOCAL_MACHINE \ SYSTEM \ CurrentControlSet \ Services \ Tcpip \ Parameters</em> et le d√©finir sur 0. </p><br><p>  Bien s√ªr, Zeroconf ne convient que pour les petits r√©seaux isol√©s (par exemple, vous avez rencontr√© un ami avec des ordinateurs portables, les avez connect√©s via Wi-Fi et jouons √† Diablo II, sans perdre de temps sur certains serveurs), et je veux √©galement obtenir un r√©seau local sur Internet .  Afin de ne pas souffrir des param√®tres statiques de chaque ordinateur, des protocoles sp√©ciaux ont √©t√© cr√©√©s, dont le h√©ros du jour - DHCP. </p><br><h1 id="dhcp-i-ego-praroditeli">  DHCP et ses prog√©niteurs </h1><br><p>  L'une des premi√®res impl√©mentations du protocole d'√©mission d'adresses IP est apparue il y a plus de 30 ans et s'appelait <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">RARP</a> (Reverse Address Resolution Protocol).  Si nous simplifions un peu le principe de son fonctionnement, cela ressemblait √† ceci: le client a fait une demande √† l'adresse de diffusion du r√©seau, le serveur l'a accept√©e, a trouv√© la liaison de l'adresse MAC et IP du client dans sa base de donn√©es et a envoy√© une r√©ponse IP. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/e6a/53f/109/e6a53f1099a79a913500b6dea05b1dfd.jpg"></p><br><p>  <em>Sch√©ma du protocole RARP.</em> </p><br><p>  Et tout semblait fonctionner.  Mais le protocole avait ses inconv√©nients: il √©tait n√©cessaire de configurer le serveur dans chaque segment du r√©seau local, d'enregistrer les adresses MAC sur ce serveur, et il n'√©tait pas du tout possible de transmettre des informations suppl√©mentaires au client.  Par cons√©quent, pour le remplacer, le protocole <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">BOOTP</a> (Bootstrap Protocol) a √©t√© cr√©√©. </p><br><p>  Initialement, il √©tait utilis√© pour les postes de travail sans disque, qui devaient non seulement donner une adresse IP, mais √©galement transmettre des informations suppl√©mentaires au client, telles que l'adresse du serveur TFTP et le nom du fichier de t√©l√©chargement.  Contrairement √† RARP, le protocole prend d√©j√† en charge le relais - petits services qui transmettent les demandes au serveur ¬´principal¬ª.  Cela a permis d'utiliser un serveur sur plusieurs r√©seaux simultan√©ment.  Il restait juste le besoin de configurer manuellement les tables et la taille limite pour des informations suppl√©mentaires.  En cons√©quence, le protocole DHCP moderne est entr√© en sc√®ne, qui est une extension compatible de BOOTP (le serveur DHCP prend en charge les clients h√©rit√©s, mais pas l'inverse). </p><br><p>  Une diff√©rence importante par rapport aux protocoles h√©rit√©s est la possibilit√© d'√©mettre temporairement une adresse (bail) et de transf√©rer une grande quantit√© d'informations diff√©rentes au client.  Ceci est r√©alis√© en raison de la proc√©dure moins triviale pour obtenir l'adresse.  Si, dans les anciens protocoles, le sch√©ma √©tait simple, du type demande-r√©ponse, alors le sch√©ma est le suivant: </p><br><ul><li>  Le client recherche le serveur avec une demande de diffusion, demandant √©galement des param√®tres suppl√©mentaires. </li><li>  Le serveur r√©pond au client en lui offrant une adresse IP et d'autres param√®tres. </li><li>  Le client confirme les informations re√ßues par demande de diffusion, en indiquant dans la confirmation l'adresse IP du serveur s√©lectionn√©. </li><li>  Le serveur est d'accord avec le client en lui envoyant une demande, √† la r√©ception de laquelle le client configure d√©j√† l'interface r√©seau ou la rejette. </li></ul><br><p><img src="https://habrastorage.org/getpro/habr/post_images/b55/510/aa5/b55510aa54fa43c6b42e109826ec02a5.jpg"></p><br><p>  <em>Le sch√©ma de communication du client avec le serveur de transfert et le serveur.</em> </p><br><p>  Vous pouvez en savoir plus sur le sch√©ma d'interaction serveur-client et la structure des demandes et des r√©ponses, par exemple, dans le document ¬´ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Structure, format et but des paquets DHCP</a> ¬ª. </p><br><blockquote>  Lors de plusieurs entretiens, ils m'ont demand√©: ¬´Quels transports et quels ports DHCP utilise-t-il?¬ª  Au cas o√π, nous r√©pondons: "Serveur UDP: 67, client UDP: 68". </blockquote><p>  De nombreuses impl√©mentations d'un serveur DHCP ont √©t√© rencontr√©es par beaucoup, m√™me lors de la configuration d'un r√©seau domestique.  En effet, maintenant le serveur est: </p><br><ul><li>  Sur presque tous les routeurs, en particulier SOHO. </li><li>  Sur les syst√®mes Windows Server.  Vous pouvez lire sur le serveur et sa configuration dans la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation</a> officielle. </li><li>  Sur les syst√®mes * nix.  Le logiciel le plus populaire est peut-√™tre le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">serveur DHCP ISC</a> (dhcpd) et la ¬´moissonneuse¬ª <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Dnsmasq</a> . </li></ul><br><p>  Il existe de nombreuses impl√©mentations sp√©cifiques, mais, par exemple, les param√®tres du serveur sont limit√©s sur les routeurs SOHO.  Cela concerne principalement les param√®tres suppl√©mentaires, en plus du classique "adresse IP, masque, passerelle, serveur DNS".  Et ce sont pr√©cis√©ment ces options suppl√©mentaires qui suscitent le plus grand int√©r√™t pour le fonctionnement du protocole.  La liste compl√®te peut √™tre trouv√©e dans le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">RFC</a> correspondant, mais j'analyserai quelques exemples int√©ressants. </p><br><h1 id="udivitelnye-opcii-dhcp">  Options DHCP √©tonnantes </h1><br><p>  Dans cette section, je vais discuter de l'utilisation pratique des options DHCP sur l'√©quipement MikroTik.  J'attirerai imm√©diatement l'attention sur le fait que toutes les options ne sont pas d√©finies de mani√®re √©vidente, le format des param√®tres est d√©crit dans le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">wiki</a> .  Il convient √©galement de noter que le client applique les options uniquement lorsqu'il les demande.  Sur certains serveurs, vous pouvez forcer l'envoi des param√®tres: par exemple, dans le serveur DHCP ISC, la directive <strong><em>dhcp-parameter-request-list</em></strong> est responsable de cela, et dans Dnsmasq - * * <strong><em>--dhcp-option-force</em></strong> .  MikroTik et Windows ne savent pas comment. </p><br><p>  <strong>Option 6</strong> et <strong>option 15.</strong> Commen√ßons par une simple.  Le param√®tre num√©ro 6 correspond aux serveurs DNS attribu√©s aux clients, 15 au suffixe DNS.  L'attribution d'un suffixe DNS peut √™tre utile lorsque vous travaillez avec des ressources de domaine dans un r√©seau hors domaine, comme je l'ai d√©crit dans l'article ¬´ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Comment nous avons r√©duit le personnel via le Wi-Fi</a> ¬ª.  Configurez MikroTik sous le spoiler. </p><br><div class="spoiler">  <b class="spoiler_title">Configuration de MikroTik, option 15</b> <div class="spoiler_text"><pre><code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#  15.  ‚Äî   HEX . /ip dhcp-server option add code=15 name=dns-suffix value=0x57687920616c6c207468697320736869743f #   /ip dhcp-server option sets add name=dns option=dns-suffix #   DHCP-  . /ip dhcp-server network set [find comment="wi-fi client dhcp"] dhcp-option-set=dns</span></span></code> </pre> </div></div><br><p>  Savoir qu'un serveur DNS est √©galement une option est r√©cemment devenu utile lorsque diff√©rents clients ont d√ª √©mettre diff√©rents serveurs DNS.  La d√©cision du formulaire ¬´√©mettre un serveur et cr√©er des r√®gles dst-nat diff√©rentes pour le port 53¬ª ne convenait pas pour un certain nombre de raisons.  Une partie de la configuration est √† nouveau sous le spoiler. </p><br><div class="spoiler">  <b class="spoiler_title">Configuration de MikroTik, option 6</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># ,  ,  ip    /ip dhcp-server option add code=6 name=google value="'8.8.8.8'" add code=6 name=cloudflare value="'1.1.1.1'" #  /ip dhcp-server lease add address=10.0.0.2 dhcp-option=google mac-address=11:11:11:11:11:11 server=dhcp add address=10.0.0.3 dhcp-option=cloudflare mac-address=22:22:22:22:22:22 server=dhcp</span></span></code> </pre></div></div><br><p>  <strong>Option 66</strong> et <strong>option 67</strong> .  Ces param√®tres sont revenus de BOOTP et vous permettent de sp√©cifier le serveur TFTP et l'image pour le d√©marrage r√©seau.  Pour une petite branche, il est assez pratique d'y installer Mikrotik et des postes de travail sans disque et de jeter une image pr√©par√©e d'une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ThinStation sur le routeur</a> .  Exemple de configuration DHCP: </p><br><pre> <code class="bash hljs">/ip dhcp-server option add name=<span class="hljs-string"><span class="hljs-string">"option66"</span></span> code=66 value=<span class="hljs-string"><span class="hljs-string">"s'192.168.88.1'"</span></span> add name=<span class="hljs-string"><span class="hljs-string">"option67"</span></span> code=67 value=<span class="hljs-string"><span class="hljs-string">"'pxelinux.0'"</span></span> /ip dhcp-server option sets add name=<span class="hljs-string"><span class="hljs-string">"set-pxe"</span></span> options=option66,option67</code> </pre><br><p>  <strong>Option 121</strong> et <strong>option 249</strong> .  Ils sont utilis√©s pour transf√©rer des itin√©raires suppl√©mentaires au client, ce qui dans certains cas peut √™tre plus pratique que d'enregistrer des itin√©raires sur la passerelle par d√©faut.  Les param√®tres sont presque identiques, sauf que les clients Windows pr√©f√®rent ce dernier.  Pour configurer le param√®tre, les routes doivent √™tre converties en hexad√©cimal, en collectant le masque de r√©seau de destination, l'adresse r√©seau et la passerelle sur une seule ligne.  En outre, par RFC, vous devez ajouter un itin√©raire par d√©faut.  L'option de r√©glage est sous le spoiler. </p><br><div class="spoiler">  <b class="spoiler_title">Configuration de l'itin√©raire</b> <div class="spoiler_text"><p>  Supposons que nous devons ajouter une route comme dst-address = 10.0.0.0 / 24 gateway = 192.168.88.2 aux clients, et la passerelle principale sera 192.168.88.1.  Apportons tout cela dans HEX: </p><br><div class="scrollable-table"><table><tbody><tr><td>  Param√®tres des donn√©es </td><td>  D√©c </td><td>  Hex </td></tr><tr><td>  Masque </td><td>  24 </td><td>  0x18 </td></tr><tr><td>  R√©seau de destination </td><td>  10.0.0.0 </td><td>  0x0A 00 00 </td></tr><tr><td>  Passerelle </td><td>  192.168.88.2 </td><td>  0xc0 a8 58 02 </td></tr><tr><td>  R√©seau par d√©faut </td><td>  0.0.0.0/0 </td><td>  0x00 </td></tr><tr><td>  Passerelle par d√©faut </td><td>  192.168.88.1 </td><td>  0xc0 a8 58 01 </td></tr></tbody></table></div><br><p>  Collectons tout ce bonheur en une seule ligne et obtenons le r√©glage: </p><br><pre> <code class="bash hljs">/ip dhcp-server option add code=121 name=classless value=0x0A0000c0a8580200c0a85801</code> </pre></div></div><br><p>  Plus d'informations dans l'article ¬´ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Mikrotik, DHCP Classless Route</a> ¬ª. </p><br><p>  <strong>Option 252.</strong> Configuration automatique du serveur proxy.  Si, pour une raison quelconque, l'organisation utilise un proxy opaque, il sera commode de le configurer avec les clients via un fichier wpad (pac) sp√©cial.  Un exemple de configuration d'un tel fichier est d√©crit dans le document <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Proxy Auto Configuration (PAC)</a> .  Malheureusement, MiroTik n'a pas de serveur Web int√©gr√© pour h√©berger ce fichier.  Vous pouvez utiliser le package <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">hotspot</a> ou les fonctionnalit√©s du <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">m√©tarouteur</a> pour cela, mais il est pr√©f√©rable de placer le fichier ailleurs. </p><br><p>  <strong>Option 82</strong> .  L'une des options les plus utiles n'est pas seulement pour le client, mais pour le relais DHCP.  Vous permet de transf√©rer des informations sur le port du commutateur auquel le client est connect√© et l'ID du commutateur lui-m√™me.  Sur la base de ces informations, le serveur, √† son tour, peut d√©j√† √©mettre un certain ensemble de param√®tres pour le client ou simplement l'enregistrer - pour trouver le port de connexion du client, il n'√©tait pas n√©cessaire d'acc√©der √† tous les commutateurs cons√©cutifs (surtout s'ils ne sont pas sur la pile). </p><br><p>  Apr√®s avoir configur√© le relais DHCP sur le routeur, les champs <strong>ID de circuit d'agent</strong> et <strong>ID</strong> <strong>distant d'agent</strong> appara√Ætront dans les informations client, o√π le premier est l'identifiant du port du commutateur et le second est l'identifiant du commutateur. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/9c3/350/fb7/9c3350fb7d11ac6f57f28c21eb58489f.jpg"></p><br><p>  <em>D√©livrance d'adresses avec l'option 82.</em> </p><br><p>  Les informations sont donn√©es au format hexad√©cimal.  Pour plus de commodit√©, vous pouvez utiliser des scripts pour analyser le journal DHCP.  Par exemple, une solution pour une solution de Microsoft est publi√©e dans la galerie de scripts Technet intitul√©e ¬´ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Decorating DHCP Options 82</a> ¬ª. </p><br><p>  <strong>L'option 82 est √©galement</strong> activement utilis√©e dans le syst√®me de facturation des fournisseurs et dans la protection du r√©seau contre les interf√©rences ext√©rieures.  C'est un peu plus d√©taill√©. </p><br><h1 id="dobavim-seti-nadezhnosti-i-bezopasnosti">  Ajoutez des r√©seaux de fiabilit√© et de s√©curit√© </h1><br><p>  En raison de la simplicit√© du protocole et de la pr√©sence de demandes de diffusion, il existe des attaques efficaces sur l'infrastructure - principalement de type MITM (¬´l'homme au milieu¬ª).  Les attaques sont effectu√©es en augmentant votre serveur ou relais DHCP: apr√®s tout, si vous contr√¥lez l'√©mission des param√®tres r√©seau, vous pouvez facilement rediriger le trafic vers une passerelle compromise.  Pour faciliter l'attaque, la famine DHCP est utilis√©e (faisant semblant d'√™tre un client ou un relais, l'attaquant force le serveur DHCP "natif" √† √©puiser ses adresses IP).  Vous pouvez en savoir plus sur la mise en ≈ìuvre de l'attaque dans l'article ¬´ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Attacking DHCP</a> ¬ª, tandis que <strong>DHCP Snooping</strong> est la m√©thode de protection. </p><br><p>  Il s'agit d'une fonction de commutation qui vous permet de ¬´lier¬ª un serveur DHCP √† un port sp√©cifique.  Les r√©ponses DHCP sur les autres ports seront bloqu√©es.  Dans certains commutateurs, vous pouvez configurer le travail avec l'option 82 lorsqu'il est d√©tect√© dans le package (ce qui indique la pr√©sence d'un relais): jeter, remplacer, laisser inchang√©. </p><br><p>  Dans les commutateurs MikroTik, DHCP Snooping est activ√© dans les param√®tres du pont: </p><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># dhcp-snooping  option 82 /interface bridge add name=bridge set [find where name="bridge"] dhcp-snooping=yes add-dhcp-option82=yes #    /interface bridge port add bridge=bridge interface=ether1 add bridge=bridge interface=ether2 trusted=yes</span></span></code> </pre><br><p>  La configuration dans d'autres commutateurs est similaire. </p><br><blockquote>  Il convient de noter que tous les mod√®les MikroTik ne prennent pas en charge le mat√©riel pour DHCP Snooping - seul CRS3xx en dispose. </blockquote><p>  En plus de la protection contre les pirates malveillants, cette fonction soulagera les maux de t√™te lorsqu'un autre serveur DHCP appara√Æt sur le r√©seau - par exemple, lorsqu'un routeur SOHO utilis√© comme commutateur avec un point d'acc√®s r√©initialise ses param√®tres.  Malheureusement, dans les r√©seaux o√π se trouve l'√©quipement SOHO, il n'y a pas toujours une structure de r√©seau c√¢bl√© comp√©tente avec des routeurs g√©r√©s.  Mais c'est une autre question. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/058/801/3c3/0588013c3a7595d350ee0f207dcd7b83.jpg"></p><br><p>  <em>Une belle commutation est la cl√© de la sant√©.</em> </p><br><p>  D'autres m√©thodes de protection incluent la <strong>s√©curit√© des ports</strong> (¬´lier¬ª une adresse MAC sp√©cifique au port du routeur; si le trafic provenant d'autres adresses est d√©tect√©, le port sera bloqu√©), l' <strong>analyse du</strong> trafic pour le nombre de demandes et de r√©ponses DHCP ou la limitation de leur nombre, et, bien s√ªr, divers syst√®mes <strong>IPS \ IDS</strong> . </p><br><p>  Si nous parlons non seulement de protection du r√©seau, mais aussi de fiabilit√©, il ne sera pas hors de propos de mentionner les capacit√©s du DHCP √† s√©curit√© int√©gr√©e.  En effet, avec sa simplicit√©, DHCP est souvent l'un des services cl√©s, et s'il √©choue, le travail de l'organisation peut √™tre paralys√©.  Mais si vous installez simplement deux serveurs avec des param√®tres identiques, rien d'autre qu'un conflit d'adresses IP n'y m√®nera. </p><br><p>  Il semblerait que vous pouvez diviser la zone de distribution entre deux serveurs et laisser l'un donner la moiti√© des adresses et l'autre donner l'autre.  Voici juste une moiti√© paralys√©e de l'infrastructure est l√©g√®rement meilleure que l'ensemble. </p><br><p>  Nous analyserons des options plus pratiques. </p><br><p>  Sur les syst√®mes <strong>Windows Server</strong> √† partir de 2012, le syst√®me de redondance DHCP fonctionne pr√™t √† l'emploi, en mode d'√©quilibrage de charge (actif-actif) ou en mode de tol√©rance aux pannes (actif-passif).  Une description d√©taill√©e de la technologie et des param√®tres se trouve dans la <a href="">documentation</a> officielle.  Je note que la tol√©rance aux pannes est configur√©e au niveau de la zone, de sorte que diff√©rentes zones peuvent fonctionner dans diff√©rents modes. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/ced/b26/26d/cedb2626dd463700eed59152438a6a60.jpg"></p><br><p>  <em>Configuration du basculement du serveur DHCP sous Windows.</em> </p><br><p>  <strong>Le serveur DHCP ISC</strong> utilise la directive de <strong><em>pairage de basculement</em></strong> pour configurer la tol√©rance aux pannes; il est propos√© de synchroniser les donn√©es ind√©pendamment - par exemple, en utilisant rsync.  En savoir plus dans l'article " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Deux serveurs DHCP sur Centos7 ...</a> " </p><br><p>  Si vous cr√©ez une solution tol√©rante aux pannes bas√©e sur MikroTik, vous ne pouvez pas vous passer d'astuces.  L'une des options pour r√©soudre le probl√®me a √©t√© annonc√©e au MUM RU 18, puis publi√©e sur le blog de l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">auteur</a> .  En bref: deux serveurs sont configur√©s, mais avec un param√®tre de seuil de d√©lai diff√©rent (d√©lai de r√©ponse).  Ensuite, le serveur √©mettra l'adresse avec moins de retard et avec un d√©lai plus long - uniquement lorsque la premi√®re √©choue.  La synchronisation des informations doit √† nouveau √™tre effectu√©e avec des scripts. </p><br><p>  Personnellement, √† un moment donn√©, je me suis assez tapot√© les nerfs lorsqu'un routeur est apparu sur le r√©seau ¬´accidentellement¬ª et connect√© au r√©seau local √† la fois aux interfaces WAN et LAN. </p><br><p>  <strong>Dites-moi, avez-vous d√ª faire face √† la l√®pre DHCP?</strong> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr467333/">https://habr.com/ru/post/fr467333/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr467317/index.html">Comment SoftBank a aval√© le monde</a></li>
<li><a href="../fr467323/index.html">Pr√©sentation des fonctionnalit√©s de programmation du microcontr√¥leur Qt Creator 4.10 et QBS 1.14</a></li>
<li><a href="../fr467327/index.html">Comment je suis devenu programmeur √† 35 ans</a></li>
<li><a href="../fr467329/index.html">Les meilleurs produits partent de vrais probl√®mes: Intercom sur les t√¢ches √† faire. partie 1</a></li>
<li><a href="../fr467331/index.html">Vendre + une belle boutique en ligne sur WordPress pour 269 $ "√† partir de z√©ro" - notre exp√©rience</a></li>
<li><a href="../fr467335/index.html">Voici comment mettre √† jour Node.js via Visual Studio, NPM, Windows / Mac</a></li>
<li><a href="../fr467337/index.html">Le jeu mobile le plus populaire: comment le "Serpent" a √©t√© cr√©√© pour les t√©l√©phones Nokia</a></li>
<li><a href="../fr467339/index.html">Et encore une fois, le 256e jour de l'ann√©e</a></li>
<li><a href="../fr467343/index.html">Pourquoi je quitte freelance: impressions du d√©veloppeur backend apr√®s 2 ans de ¬´libert√©¬ª</a></li>
<li><a href="../fr467345/index.html">Blogs sur l'informatique et 4 couches de formation: une interview de Sergei Abdulmanov de Mosigra</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>