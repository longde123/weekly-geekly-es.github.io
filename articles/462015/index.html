<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👕 👥 🎭 Universo de informes de SAP 🚡 🖤 🍷</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hace aproximadamente 4 años, cambiamos nuestro sistema de informes de Oracle a SAP Hana. Hoy, almacena alrededor de 10,000 mesas, 38,000 personas lo u...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Universo de informes de SAP</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/mvideo/blog/462015/"><img src="https://habrastorage.org/webt/nf/96/da/nf96daardoyhax1e_lj6oy2wk9o.jpeg"><br><br>  Hace aproximadamente 4 años, cambiamos nuestro sistema de informes de Oracle a SAP Hana.  Hoy, almacena alrededor de 10,000 mesas, 38,000 personas lo usan y más de 5,000 procesos de descarga ocurren diariamente.  Por el momento, nuestro complejo, en el que funciona el sistema, consta de 8 servidores con 14 TB de memoria.  Todos los días, el sistema de informes procesa 1.5 pb de datos.  Al mismo tiempo, Hana era aproximadamente 20 veces más productiva que Oracle, DB2 y MySQL.  Y hoy quiero decir cómo, en el marco de la integración de M.Video y Eldorado, aumentamos adicionalmente el rendimiento del sistema de informes, qué optimizaciones hicimos. <br><a name="habracut"></a><br><h2>  Carga </h2><br>  Hoy, de varios miles de informes creados por el sistema, solo 10 generan el 70% de la carga total.  El informe más pesado en la base de datos de Hana es la Revisión semanal de negocios.  Funciona durante 30 minutos y consume 4 TB de memoria.  El 90% de todos los informes son generados por el centro de contacto: creamos un servicio que, cuando un cliente llama por su número de teléfono, abre automáticamente un informe y muestra al operador el historial completo de las compras de la persona que llama y su interacción con la empresa. <br><br><h2>  Modelo de datos </h2><br>  El modelo de datos clave en el que se construye la mayor parte de los informes contiene 1.500 tablas.  La mayoría de ellos son tablas de referencia.  Con este modelo, puede analizar cualquier dirección de la empresa.  Un ejemplo es la visualización de un modelo de datos creado con el diseñador de Universe.  Es cierto que refleja solo una décima parte de nuestro sistema. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/054/47a/9d3/05447a9d3d7447a41a4732c49a7b205d.png"><br><br><h2>  Rendimiento </h2><br>  En el momento de la fusión de M.Video y Eldorado, la cantidad de datos en los dos sistemas de informes era de aproximadamente 10 TB: 7 TB en el BW en HANA M.Video system, 2 TB en el BW en HANA Eldorado y 1 TB datos adicionales en HADOOP (datos históricos).  Al combinar los sistemas, teníamos limitaciones de hardware: el complejo M. Video constaba de 6 nodos (2 TB cada uno), incluida una copia de seguridad.  Este sistema podría expandirse a un máximo de 8 nodos, de los cuales un respaldo. <br><br>  En preparación para la fusión, asumimos que la cantidad total de todos los datos alcanzaría 13 TB.  Por lo tanto, según las recomendaciones de SAP, necesitábamos un sistema de 16 nodos de 2 TB cada uno, incluidos dos nodos de respaldo.  Además, un nodo tenía que asignarse como un nodo maestro, que, con tal volumen de información, se haría cargo de las funciones de gestión.  Es decir, para un funcionamiento correcto era necesario desplegar 13 nodos. <br><br>  Como puede ver, los recursos disponibles son categóricamente insuficientes.  Y ese fue el primer desafío. <br><br>  La segunda dificultad principal antes de la fusión fue que la velocidad del sistema a menudo no satisfacía las necesidades del negocio.  La razón principal fue la gran cantidad de llamadas simultáneas a la base de datos.  Desde el punto de vista del sistema, parecía una bola de nieve, lo que podría conducir a la congelación e interrupción de parte de los procesos, o incluso a descargas globales de "falta de memoria" en los nodos. <br><br>  Estaba claro que sin mejoras significativas, un aumento doble en la cantidad de datos en los informes (para dos marcas) conduciría a un empeoramiento aproximadamente doble de la situación. <br><br>  Por lo tanto, decidimos optimizar el sistema en las siguientes áreas: <br><br><ul><li>  <b>Informes</b>  Aceleración de los informes más críticos y más intensivos en recursos y revisión del modelo de datos. <br></li><li>  <b>Repositorio</b> .  Archivado y optimización de almacenamiento. <br></li><li>  <b>Descargas</b>  Agilice el procedimiento y cambie el horario de descarga. <br></li></ul><br>  El enfoque general para la optimización fue este: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1aa/534/20d/1aa53420d809464c7d3f28bd9761e411.png"><br><br>  Primero, realizamos un análisis en todas las direcciones, identificamos las causas de los problemas y luego analizamos las capacidades del sistema con los recursos necesarios.  También intentamos de inmediato automatizar este proceso tanto como sea posible para que en el futuro podamos identificar rápidamente las causas de los problemas y restaurar rápidamente el rendimiento. <br><br>  Que hemos hecho: <br><br><ul><li>  Cambió la configuración de los servidores de aplicaciones ABAP: la cantidad de instancias, el uso efectivo de la tecnología NUMA y la cantidad óptima de flujos de trabajo. <br></li><li>  Aplicamos los parámetros óptimos de HANA y el sistema operativo Linux. <br></li><li>  Analizamos la disminución en el consumo de CPU. <br></li><li>  Analizamos el consumo de RAM en todo el intervalo de tiempo observado. <br></li><li>  Analizamos la aparición de OOM en HANA. <br></li><li>  Analizamos la aparición de bloqueos en el sistema y la disponibilidad de recursos del sistema para las operaciones de espera (espera). <br></li><li>  Analizamos el equilibrio de datos teniendo en cuenta la redistribución y el reparto de datos para la solución SCALE-OUT HANA. <br></li><li>  Analizamos las causas de los volcados de ABAP que afectan el funcionamiento de las cadenas críticas. <br></li></ul><br>  En función de los resultados, se compilaron informes de rendimiento, así como instrucciones para que en el futuro fuera posible determinar de forma independiente los cuellos de botella en el sistema y los intervalos de tiempo pico. <br><br>  Qué resultados se lograron: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/82a/e7e/382/82ae7e3826abf0a8eaf2cafb2c10d27b.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/d5a/b6e/221/d5ab6e221145f19b6f385738f57d9dca.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/a5e/a35/4d2/a5ea354d258baaed8ef8176ad0a0ad45.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/1dc/654/1f7/1dc6541f7d68c70012d8203e92182775.png"><br><br>  Varios informes optimizados SAP BO comenzaron a funcionar <b>muchas veces más rápido</b> y consumieron <b>cientos de veces menos memoria</b> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7fc/ed2/3c7/7fced23c7b586cf2334745b265245447.png"><br><br>  Aquí hay algunos ejemplos sorprendentes de cómo el sistema cumple incorrectamente las condiciones de selección y cómo generar consultas correctamente en HANA. <br><br>  Se revelaron problemas al filtrar por objetos no materializados, especialmente (!) Al usar los indicadores <code>COUNT DISTINCT</code> (se puede escribir un CD tanto a nivel del universo como en una función en CV). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c2c/25c/e8c/c2c25ce8cab11363b6dd1958c9b1c25a.png"><br><br>  Incluso si excluye el CD de la consulta, la primera opción seguirá funcionando 20 veces más lenta que la segunda, y con un CD, la velocidad es más de 500 veces mayor. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1dc/f0b/6a3/1dcf0b6a38e4053829e20a531d67c45a.png"><br><br>  Un caso especial de uso de objetos no materializados en filtros: filtros compuestos de dos o más objetos, por ejemplo, pegar una semana y un año: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cda/a3a/d8e/cdaa3ad8e73905c217346b6b00004dd0.png"><br><br>  Las consultas con filtros pegados no funcionan tan lentamente como la conversión a una fecha, pero aún así ralentizan las consultas (aproximadamente 2-3 veces). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cec/182/9d6/cec1829d65a06d6d73f53b2110cfc4e3.png"><br><br>  Para recopilar estadísticas sobre el funcionamiento del sistema de informes, los procesos de carga y las cadenas, desarrollamos el siguiente esquema: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9fc/3c5/d8a/9fc3c5d8aab834bca29c4988592f25f8.png"><br><br>  Al mismo tiempo, agregamos un comentario especial a los informes con el nombre del informe.  Por lo tanto, podemos comparar la carga de diferentes partes del sistema y comparar el período con el período. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/14e/665/69b/14e66569bb4292fb4e66364fe51de6be.png"><br><br><h2>  <font color="#ec2028">Planes</font> </h2><br>  Tenemos muchos planes para el desarrollo de la funcionalidad empresarial y una revisión sustancial de la herramienta de visualización de datos.  La tendencia global en la que participamos activamente es integrar el sistema de informes en el paradigma de la transformación digital. <br><br>  A que te refieres <br><br>  Cuando nuestro sistema de informes era joven, los usuarios a menudo acudían a nosotros con solicitudes similares: "Automatice la construcción de un informe que muestre cuánto beneficio neto recibió esta o aquella tienda o toda la compañía". <br><br>  Luego comenzaron a llegar a nosotros con solicitudes para elaborar un algoritmo que construiría un plan o pronóstico para una ganancia neta, dependiendo de factores específicos. <br><br>  Y hoy hemos llegado a la conclusión de que los usuarios desean conocer el pronóstico exacto del beneficio neto.  Tenemos todos los datos necesarios para el desarrollo de algoritmos de pronóstico, y hay especialistas en análisis de datos que pueden crear modelos de aprendizaje automático.  Como saben, esto requiere grandes cantidades de datos, por lo que una de las principales tendencias en el desarrollo de nuestro sistema de informes es la transición al análisis y la creación de modelos basados ​​en grandes datos. <br><br><h2>  <font color="#ec2028">Unas palabras sobre nuestro equipo</font> </h2><br>  Hoy en día, las grandes empresas están introduciendo cada vez más sistemas de pronóstico basados ​​en algoritmos de aprendizaje automático desarrollados por el propio sistema.  Hace dos años, creamos un centro de competencias en el campo del análisis de datos del Centro de Ciencia de Datos Minoristas Digitales, y este año tenemos un grupo de ingenieros de datos.  Estamos introduciendo un nuevo sistema para procesar y analizar big data.  Y necesitamos personas en el equipo de los departamentos de soporte, desarrollo y análisis de datos aplicados. <br><br>  Si estás interesado en estas áreas, si sientes la fuerza en ti mismo, ¡bienvenido!  Encontrarás un trabajo interesante y difícil, a veces estresante, pero siempre creativo. <img src="https://habrastorage.org/files/fa7/d16/199/fa7d16199fca4fee89c0b96fa9919513.png"></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/462015/">https://habr.com/ru/post/462015/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../462005/index.html">Características de Google PageSpeed: calificación mejorada del sitio y ranking de búsqueda</a></li>
<li><a href="../462007/index.html">Desarrollando scripts robustos de Python</a></li>
<li><a href="../462009/index.html">Tendencias de programación: ¿qué se puede esperar en 2020?</a></li>
<li><a href="../462011/index.html">Geoservicios web. Resumen de soluciones modernas</a></li>
<li><a href="../462013/index.html">Historial de problemas de migración de Docker Storage (Docker root)</a></li>
<li><a href="../462021/index.html">Cómo dejar de hacer lo mismo</a></li>
<li><a href="../462023/index.html">Cascadeur: el futuro de la animación del juego</a></li>
<li><a href="../462025/index.html">Modelo de datos de red relacional</a></li>
<li><a href="../462027/index.html">Cómo Dark implementa el código de 50 ms</a></li>
<li><a href="../462029/index.html">19 características útiles del archivo .htaccess</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>