<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üö∂üèæ üçû ‚öñÔ∏è Plugin Memcached: NoSQL dans MySQL ü•ê üò≠ üåª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour Je m'appelle Maxim Matyukhin, je suis programmeur PHP chez Badoo . Dans notre travail, nous utilisons activement MySQL. Mais parfois, nous man...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Plugin Memcached: NoSQL dans MySQL</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/badoo/blog/453742/"><img src="https://habrastorage.org/webt/1v/q0/h5/1vq0h5tev1qw1ivnheyxg7jfiqm.jpeg"><br><br>  Bonjour  Je m'appelle Maxim Matyukhin, je suis programmeur PHP chez <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Badoo</a> .  Dans notre travail, nous utilisons activement MySQL.  Mais parfois, nous manquons de performances, nous recherchons donc constamment des moyens d'acc√©l√©rer son travail. <br><br>  En 2010, Yoshinori Matsunobu a introduit le plugin NoSQL MySQL appel√© HandlerSocket.  Il a √©t√© affirm√© que ce plugin vous permet d'effectuer plus de 750 000 requ√™tes par seconde.  Nous sommes devenus curieux et presque imm√©diatement, nous avons commenc√© √† utiliser cette solution.  Nous avons tellement aim√© le r√©sultat que nous avons commenc√© √† faire des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">pr√©sentations</a> et √† r√©diger des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">articles</a> faisant la promotion de HandlerSocket. <br><br>  Apparemment, nous √©tions l'un des rares utilisateurs de ce plugin - depuis MySQL 5.7, il a cess√© de fonctionner.  Mais dans cette version, un autre plugin Oracle est apparu - le plugin InnoDB memcached, qui promettait des fonctionnalit√©s similaires. <br><br>  Malgr√© le fait que le plugin memcached soit r√©apparu dans MySQL 5.6 en 2013, il n'y a pas tellement d'articles √† ce sujet et pour la plupart ils r√©p√®tent la documentation: une simple √©tiquette est cr√©√©e et des requ√™tes lui sont faites via le client memcached. <br><br>  Nous avons une vaste exp√©rience avec Memcached et sommes habitu√©s √† la facilit√© d'interagir avec lui.  Du plugin memcached InnoDB, nous nous attendions √† la m√™me simplicit√©.  Mais en fait, il s'est av√©r√© que si les mod√®les d'utilisation du plug-in sont au moins l√©g√®rement diff√©rents de ceux d√©crits dans la documentation et les articles, de nombreuses nuances et limitations apparaissent, qui valent vraiment la peine d'√™tre consid√©r√©es si vous allez utiliser le plug-in. <br><a name="habracut"></a><br><h1>  MySQL HandlerSocket </h1><br>  Dans cet article, nous comparerons d'une mani√®re ou d'une autre le nouveau plugin memcached avec l'ancien HandlerSocket.  Par cons√©quent, je me souviens que c'√©tait ce dernier. <br><br>  Apr√®s avoir install√© le plugin HandlerSocket, MySQL a commenc√© √† √©couter deux ports suppl√©mentaires: <br><br><ol><li>  Le premier port a re√ßu des demandes des clients pour la lecture des donn√©es. <br></li><li>  Le deuxi√®me port a re√ßu des demandes d'enregistrement de donn√©es du client. <br></li></ol><br>  Le client devait √©tablir une connexion TCP r√©guli√®re sur l'un de ces ports (aucune authentification n'√©tait prise en charge), et apr√®s cela, il √©tait n√©cessaire d'envoyer la commande ¬´open index¬ª (une commande sp√©ciale avec laquelle le client informait quelle table de quel index quels champs nous allions vers lire (ou √©crire)). <br><br>  Si la commande ¬´open index¬ª a fonctionn√© correctement, vous pouvez envoyer des commandes GET ou INSERT / UPDATE / DELETE selon le port sur lequel la connexion a √©t√© √©tablie. <br><br>  HandlerSocket a permis d'effectuer non seulement des GET sur la cl√© primaire, mais √©galement des √©chantillons simples √† partir d'un index non unique, des √©chantillons de plage, des multigets pris en charge et LIMIT.  Dans le m√™me temps, il √©tait possible de travailler avec la table √† la fois √† partir du SQL ordinaire et via le plugin.  Cela, par exemple, vous a permis d'apporter des modifications aux transactions via SQL, puis de lire ces donn√©es via HandlerSocket. <br><br>  Il est important que HandlerSocket g√®re toutes les connexions avec un pool limit√© de threads via epoll, il √©tait donc facile de prendre en charge des dizaines de milliers de connexions, tandis que dans MySQL lui-m√™me, un thread a √©t√© cr√©√© pour chaque connexion et leur nombre √©tait tr√®s limit√©. <br><br>  En m√™me temps, il s'agit toujours d'un serveur MySQL ordinaire - une technologie qui nous est famili√®re.  Nous savons comment le r√©pliquer et le surveiller.  La surveillance de HandlerSocket est difficile car elle ne fournit aucune m√©trique sp√©cifique;  cependant, certaines des m√©triques standard MySQL et InnoDB sont utiles. <br><br>  Il y avait, bien s√ªr, des inconv√©nients, en particulier, ce plugin ne supportait pas de travailler avec le type d'horodatage.  Eh bien, le protocole HandlerSocket est plus difficile √† lire et donc plus difficile √† d√©boguer. <br><br>  En savoir plus sur HandlerSocket <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> .  Vous pouvez √©galement regarder l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">une de nos pr√©sentations</a> . <br><br><h1>  Plugin Memo cach√© InnoDB </h1><br>  Que nous offre le nouveau plugin memcached? <br><br>  Comme son nom l'indique, son id√©e est d'utiliser le client memcached pour travailler avec MySQL et pour recevoir et enregistrer des donn√©es via des commandes memcached. <br><br>  Vous pouvez <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">lire</a> ici les principaux avantages du plugin. <br><br>  Nous sommes particuli√®rement int√©ress√©s par ce qui suit: <br><br><ol><li>  Faible consommation CPU. <br></li><li>  Les donn√©es sont stock√©es dans InnoDB, ce qui donne certaines garanties. <br></li><li>  Vous pouvez travailler avec des donn√©es √† la fois via Memcached et via SQL;  ils peuvent √™tre r√©pliqu√©s √† l'aide des outils int√©gr√©s de MySQL. <br></li></ol><br>  Vous pouvez ajouter des avantages √† cette liste comme: <br><br><ol><li>  Connexion rapide et bon march√©.  Une connexion MySQL r√©guli√®re est trait√©e par un thread, et le nombre de threads est limit√©, et dans le plugin memcached, un thread traite toutes les connexions dans la boucle d'√©v√©nements. <br></li><li>  La possibilit√© de demander plusieurs cl√©s avec une seule demande GET. <br></li><li>  Par rapport √† MySQL HandlerSocket, dans le plugin memcached, vous n'avez pas besoin d'utiliser la commande ¬´Open Table¬ª et toutes les op√©rations de lecture et d'√©criture se produisent sur le m√™me port. <br></li></ol><br><br>  Plus de d√©tails sur le plugin peuvent √™tre trouv√©s dans la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation</a> officielle.  Pour nous, les pages les plus utiles sont: <br><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Architecture memcached InnoDB</a> . <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">InnoDB Memcached Plugin Internals</a> . <br></li></ol><br>  Apr√®s avoir install√© le plugin, MySQL commence √† accepter les connexions sur le port 11211 (port memcached standard).  Une base de donn√©es sp√©ciale (sch√©ma) innodb_memcache appara√Æt √©galement, dans laquelle vous allez configurer l'acc√®s √† vos tables. <br><br><h1>  Exemple simple </h1><br>  Supposons que vous ayez d√©j√† une table avec laquelle vous souhaitez travailler via le protocole memcached: <br><br><pre><code class="plaintext hljs">CREATE TABLE `auth` (  `email` varchar(96) NOT NULL,  `password` varchar(64) NOT NULL,  `type` varchar(32) NOT NULL DEFAULT '',  PRIMARY KEY (`email`) ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci</code> </pre> <br>  et vous souhaitez recevoir et modifier des donn√©es sur la cl√© primaire. <br><br>  Vous devez d'abord d√©crire la correspondance entre la cl√© memcached et la table SQL dans la table innodb_memcache.containers.  Ce tableau ressemble √† ceci (j'ai supprim√© la description de l'encodage pour en faciliter la lecture): <br><br><pre> <code class="plaintext hljs">CREATE TABLE `containers` ( `name` varchar(50) NOT NULL, `db_schema` varchar(250) NOT NULL, `db_table` varchar(250) NOT NULL, `key_columns` varchar(250) NOT NULL, `value_columns` varchar(250) DEFAULT NULL, `flags` varchar(250) NOT NULL DEFAULT '0', `cas_column` varchar(250) DEFAULT NULL, `expire_time_column` varchar(250) DEFAULT NULL, `unique_idx_name_on_key` varchar(250) NOT NULL, PRIMARY KEY (`name`) ) ENGINE=InnoDB DEFAULT</code> </pre> <br>  Les domaines les plus importants: <br><br><ul><li>  nom - pr√©fixe de votre cl√© Memcached; <br></li><li>  db_schema - nom de la base (circuit); <br></li><li>  db_table est votre table; <br></li><li>  colonnes_cl√© - le nom du champ dans la table par lequel nous allons rechercher (g√©n√©ralement c'est votre cl√© primaire); <br></li><li>  value_columns - une liste de champs de la table qui seront disponibles pour le plugin memcached; <br></li><li>  unique_idx_name_on_key est l'index par lequel effectuer la recherche (bien que vous ayez d√©j√† sp√©cifi√© key_columns, ils peuvent se trouver dans diff√©rents index et vous devez sp√©cifier explicitement l'index). <br></li></ul><br>  Les champs restants ne sont pas tr√®s importants pour commencer. <br><br>  Ajoutez une description de notre table √† innodb_memcache.containers: <br><br><pre> <code class="plaintext hljs">INSERT INTO innodb_memcache.containers SET   name='auth',   db_schema='test',   db_table='auth',   key_columns='email',   value_columns='password|type',   flags='0',   cas_column='0',   expire_time_column='0',   unique_idx_name_on_key='PRIMARY';</code> </pre> <br>  Dans cet exemple, name = 'auth' est le pr√©fixe de notre cl√© memcached.  Dans la documentation, il est souvent appel√© table_id, et plus loin dans l'article, j'utiliserai ce terme. <br><br>  Maintenant, TELNET se connecte au plugin memcached et essaie d'enregistrer et d'obtenir les donn√©es: <br><br><pre> <code class="plaintext hljs">[21:26:22] maxm@localhost: ~&gt; telnet memchached-mysql.dev 11211 Trying 127.0.0.1... Connected to memchached-mysql.dev. Escape character is '^]'. get @@auth.max@example.com END set @@auth.max@example.com 0 0 10 1234567|89 STORED get @@auth.max@example.com VALUE @@auth.max@example.com 0 10 1234567|89 END</code> </pre> <br>  Nous avons d'abord envoy√© une demande GET, elle ne nous a rien retourn√©.  Ensuite, nous avons enregistr√© les donn√©es avec une demande SET, apr√®s quoi nous les avons r√©cup√©r√©es avec un GET. <br><br>  GET a renvoy√© la ligne suivante: 1234567 | 89.  Ce sont les valeurs des champs "mot de passe" et "type", s√©par√©es par le symbole "|".  Les champs sont retourn√©s dans l'ordre dans lequel ils ont √©t√© d√©crits dans innodb_memcache.containers.value_columns. <br><br>  Peut-√™tre vous demandez-vous maintenant: "Que se passera-t-il si le symbole" | "appara√Æt dans le" mot de passe "?"  Je vais en parler ci-dessous. <br><br>  Gr√¢ce √† SQL, ces donn√©es sont √©galement disponibles: <br><br><pre> <code class="plaintext hljs">MySQL [(none)]&gt; select * from auth where email='max@example.com'; +-----------------+----------+------+ | email      | password | type | +-----------------+----------+------+ | max@example.com | 1234567  | 89 | +-----------------+----------+------+ 1 row in set (0.00 sec)</code> </pre> <br><h2>  Table_id par d√©faut </h2><br>  Il existe √©galement un tel mode de fonctionnement: <br><br><pre> <code class="plaintext hljs">get @@auth VALUE @@auth 0 21 test/auth END get max@example.com VALUE max@example.com 0 10 1234567|99 END set ivan@example.com 0 0 10 qwerty|xxx STORED get ivan@example.com VALUE ivan@example.com 0 10 qwerty|xxx END</code> </pre> <br>  Dans cet exemple, avec get @@ auth, nous faisons de table_id auth le pr√©fixe par d√©faut pour cette connexion.  Apr√®s cela, toutes les requ√™tes suivantes peuvent √™tre effectu√©es sans sp√©cifier table_id. <br><br>  Jusqu'√† pr√©sent, tout est simple et logique.  Mais si vous commencez √† comprendre, il existe de nombreuses nuances.  Je vais vous dire ce que nous avons trouv√©. <br><br><h1>  Nuances </h1><br><h2>  Mise en cache de la table innodb_memcache.containers </h2><br>  Le plugin memcached lit la table innodb_memcache.containers une fois au d√©marrage.  De plus, si un table_id inconnu arrive via le protocole Memcached, le plugin le recherche dans la table.  Par cons√©quent, vous pouvez facilement ajouter de nouvelles cl√©s (table_id), mais si vous souhaitez modifier les param√®tres d'un table_id existant, vous devez red√©marrer le plugin memcached: <br><br><pre> <code class="plaintext hljs">mysql&gt; UNINSTALL PLUGIN daemon_memcached; mysql&gt; INSTALL PLUGIN daemon_memcached soname "libmemcached.so";</code> </pre> <br>  Entre ces deux requ√™tes, l'interface Memcached ne fonctionnera pas.  Pour cette raison, il est souvent plus facile de cr√©er un nouveau table_id que de changer l'existant et de red√©marrer le plugin. <br><br>  Ce fut une surprise pour nous qu'une telle nuance importante du fonctionnement du plug-in soit d√©crite sur la page <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Adapter une application memcached pour</a> le plug-in <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">InnoDB memcached</a> , qui n'est pas un endroit tr√®s logique pour de telles informations. <br><br><h2>  Drapeaux, cas_column, expire_time_column </h2><br>  Ces champs sont n√©cessaires pour simuler certaines fonctionnalit√©s de Memcached.  La documentation pour eux est incoh√©rente.  La plupart des exemples illustrent l'utilisation de tables dans lesquelles se trouvent ces champs.  Il se peut que vous deviez les ajouter √† vos tables (et ce sont au moins trois champs INT).  Mais non.  Si vous n'avez pas de tels champs dans les tables et que vous n'allez pas utiliser des fonctionnalit√©s Memcached telles que CAS, expiration ou indicateurs, vous n'avez pas besoin d'ajouter ces champs aux tables. <br><br>  Lors de la configuration de la table dans innodb_memcache.containers, vous devez entrer ¬´0¬ª dans ces champs, faire exactement la ligne avec z√©ro: <br><br><pre> <code class="plaintext hljs">INSERT INTO innodb_memcache.containers SET   name='auth',   db_schema='test',   db_table='auth',   key_columns='email',   value_columns='password|type',   flags='0',   cas_column='0',   expire_time_column='0',   unique_idx_name_on_key='PRIMARY';</code> </pre> <br>  Il est ennuyeux que cas_column et expire_time_column aient une valeur par d√©faut NULL, et si vous ex√©cutez INSERT INTO innodb_memcache.containers sans sp√©cifier une valeur de '0' pour ces champs, NULL y sera stock√© et ce pr√©fixe memcache ne fonctionnera tout simplement pas. <br><br><h2>  Types de donn√©es </h2><br>  D'apr√®s la documentation, il n'est pas tr√®s clair quels types de donn√©es peuvent √™tre utilis√©s lorsque vous travaillez avec le plugin.  √Ä plusieurs endroits, il est dit que le plugin ne peut fonctionner qu'avec des champs de texte (CHAR, VARCHAR, BLOB).  Ici: L' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">adaptation d'un sch√©ma MySQL existant pour le plugin Memo cach√© InnoDB</a> propose de stocker des nombres dans des champs de cha√Æne, et si vous devez ensuite travailler avec ces champs num√©riques √† partir de SQL, puis cr√©ez une VUE dans laquelle les champs VARCHAR avec des nombres seront convertis en champs INTEGER : <br><br><pre> <code class="plaintext hljs">CREATE VIEW numbers AS SELECT c1 KEY, CAST(c2 AS UNSIGNED INTEGER) val FROM demo_test WHERE c2 BETWEEN '0' and '9999999999';</code> </pre> <br>  Cependant, √† certains endroits de la documentation, il est toujours √©crit que vous pouvez travailler avec des nombres.  Jusqu'√† pr√©sent, nous n'avons qu'une r√©elle exp√©rience de production avec des champs de texte, mais les r√©sultats exp√©rimentaux montrent que le plugin fonctionne √©galement avec des nombres: <br><br><pre> <code class="plaintext hljs">CREATE TABLE `numbers` ( `id` int(10) unsigned NOT NULL AUTO_INCREMENT, `counter` int(10) unsigned NOT NULL DEFAULT '0', PRIMARY KEY (`id`) ) ENGINE=InnoDB INSERT INTO innodb_memcache.containers SET name='numbers', db_schema='test', db_table='numbers', key_columns='id', value_columns='counter', flags='0', cas_column='0',expire_time_column='0',unique_idx_name_on_key='PRIMARY';</code> </pre> <br>  Apr√®s cela, via le protocole Memcached: <br><br><pre> <code class="plaintext hljs">get @@numbers.1 END set @@numbers.1 0 0 2 12 STORED get @@numbers.1 VALUE @@numbers.1 0 2 12 END</code> </pre> <br>  Nous voyons que le plugin memcached peut renvoyer tous les types de donn√©es.  Mais il les renvoie sous la forme dans laquelle ils se trouvent dans InnoDB, donc, par exemple, dans le cas de timestamp / datetime / float / decimal / JSON, une cha√Æne binaire est retourn√©e.  Mais les entiers sont retourn√©s tels que nous les voyons via SQL. <br><br><h2>  Multiget </h2><br>  Le protocole memcached vous permet de demander plusieurs cl√©s avec une seule demande: <br><br><pre> <code class="plaintext hljs">get @@numbers.2 @@numbers.1 VALUE @@numbers.2 0 2 12 VALUE @@numbers.1 0 2 13 END</code> </pre> <br>  Le fait que le multiget fonctionne est d√©j√† bon.  Mais cela fonctionne dans le cadre d'un table_id: <br><br><pre> <code class="plaintext hljs">get @@auth.ivan@example.com @@numbers.2 VALUE @@auth.ivan@example.com 0 10 qwerty|xxx END</code> </pre> <br>  Ce point est d√©crit dans la documentation ici: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://dev.mysql.com/doc/refman/8.0/en/innodb-memcached-multiple-get-range-query.html</a> .  Il s'av√®re qu'en multiget, vous ne pouvez sp√©cifier table_id que pour la premi√®re cl√©, si toutes les autres cl√©s sont extraites de la table_id par d√©faut (exemple de la documentation): <br><br><pre> <code class="plaintext hljs">get @@aaa.AA BB VALUE @@aaa.AA 8 12 HELLO, HELLO VALUE BB 10 16 GOODBYE, GOODBYE END</code> </pre> <br>  Dans cet exemple, la deuxi√®me cl√© est extraite de la table_id par d√©faut.  Nous pourrions sp√©cifier beaucoup plus de cl√©s √† partir du table_id par d√©faut, et pour la premi√®re cl√©, nous avons sp√©cifi√© un table_id distinct, et cela n'est possible que dans le cas de la premi√®re cl√©. <br><br>  Nous pouvons dire que le multiget fonctionne dans le cadre d'une table, car vous n'avez pas envie de vous fier √† une telle logique dans le code de production: ce n'est pas √©vident, c'est facile de l'oublier, de se tromper. <br><br>  Si on le compare √† HandlerSocket, alors l√† aussi, le multiget fonctionnait dans la m√™me table.  Mais cette restriction semblait naturelle: le client ouvre l'index dans la table et lui demande une ou plusieurs valeurs.  Mais lorsque vous travaillez avec le plugin memcached multiget sur plusieurs cl√©s avec des pr√©fixes diff√©rents, c'est une pratique normale.  Et vous attendez la m√™me chose du plugin MySQL memcached.  Mais non :( <br><br><h2>  INCR, DEL </h2><br>  J'ai d√©j√† donn√© des exemples de requ√™tes GET / SET.  Les requ√™tes INCR et DEL ont une fonctionnalit√©.  Cela r√©side dans le fait qu'ils ne fonctionnent que lors de l'utilisation du table_id par d√©faut: <br><br><pre> <code class="plaintext hljs">DELETE @@numbers.1 ERROR get @@numbers VALUE @@numbers 0 24 test/numbers END delete 1 DELETED</code> </pre> <br><h2>  Limitations du protocole Memcached </h2><br>  Memcached poss√®de un protocole de texte, qui impose certaines limitations.  Par exemple, les cl√©s memcached ne doivent pas contenir de caract√®res d'espace blanc (espace, saut de ligne).  Si vous regardez √† nouveau la description du tableau de notre exemple: <br><br><pre> <code class="plaintext hljs">CREATE TABLE `auth` ( `email` varchar(96) NOT NULL, `password` varchar(64) NOT NULL, `type` varchar(32) NOT NULL DEFAULT '', PRIMARY KEY (`email`) ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci</code> </pre> <br>  cela signifie que dans le champ ¬´e-mail¬ª, il ne devrait pas y avoir de tels caract√®res. <br><br>  En outre, les cl√©s memcached doivent √™tre inf√©rieures √† 250 octets (octets, pas de caract√®res).  Si vous en envoyez plus, vous obtenez une erreur: <br><br><pre> <code class="plaintext hljs">"CLIENT_ERROR bad command line format"</code> </pre> <br>  De plus, il faut tenir compte du fait que le plugin memcached ajoute sa propre syntaxe au protocole memcached.  Par exemple, il utilise le caract√®re "|"  comme s√©parateur de champ dans la r√©ponse.  Vous devez vous assurer que ce symbole n'est pas utilis√© dans votre tableau.  Le s√©parateur peut √™tre configur√©, mais les param√®tres s'appliqueront √† toutes les tables sur l'ensemble du serveur MySQL. <br><br><h2>  D√©limiteur de champ value_columns </h2><br>  Si vous devez renvoyer plusieurs colonnes via le protocole memcached, comme dans notre premier exemple: <br><br><pre> <code class="plaintext hljs">get @@auth.max@example.com VALUE @@auth.max@example.com 0 10 1234567|89 END</code> </pre> <br>  les valeurs des colonnes sont ensuite s√©par√©es par le s√©parateur standard "|".  La question se pose: "Que se passera-t-il si, par exemple, le caract√®re" | "est dans le premier champ de la ligne?"  Le plugin memcached dans ce cas renverra la cha√Æne telle quelle, quelque chose comme ceci: 1234 | 567 | 89.  Dans le cas g√©n√©ral, il est impossible de comprendre o√π se trouve un champ. <br><br>  Par cons√©quent, il est important de choisir tout de suite le bon s√©parateur.  Et comme il sera utilis√© pour toutes les cl√©s de toutes les tables, ce devrait √™tre un symbole universel qui ne sera trouv√© dans aucun champ avec lequel vous travaillerez via le protocole memcached. <br><br><h1>  R√©sum√© </h1><br>  Cela ne veut pas dire que le plugin memcached est mauvais.  Mais on a l'impression qu'il a √©t√© √©crit pour un sch√©ma de travail sp√©cifique: un serveur MySQL avec une table accessible √† l'aide du protocole memcached, et ce table_id devient par d√©faut.  Les clients √©tablissent une connexion persistante avec le plug-in Memcached et font des requ√™tes √† l'ID de table par d√©faut.  Probablement, dans un tel sch√©ma, tout fonctionnera parfaitement.  Si vous vous en √©loignez, vous rencontrez divers inconv√©nients. <br><br>  Vous vous attendiez peut-√™tre √† voir certains rapports sur les performances des plugins.  Mais nous n'avons pas encore d√©cid√© de l'utiliser dans des endroits tr√®s charg√©s.  Nous ne l'avons utilis√© que dans quelques syst√®mes peu charg√©s et l√†, il fonctionne √† peu pr√®s √† la m√™me vitesse que le HandlerSocket, mais nous n'avons pas fait de benchmarks honn√™tes.  Mais n√©anmoins, le plugin fournit une telle interface avec laquelle le programmeur peut facilement faire une erreur - vous devez garder √† l'esprit de nombreuses nuances.  Par cons√©quent, nous ne sommes pas encore pr√™ts √† utiliser ce plugin en vrac. <br><br>  Nous avons fait quelques demandes de fonctionnalit√©s dans le suivi des bogues MySQL: <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://bugs.mysql.com/bug.php?id=95091</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://bugs.mysql.com/bug.php?id=95092</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://bugs.mysql.com/bug.php?id=95093</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://bugs.mysql.com/bug.php?id=95094</a> <br><br>  Esp√©rons que l'√©quipe de d√©veloppement du plugin memcached am√©liorera son produit. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr453742/">https://habr.com/ru/post/fr453742/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr453722/index.html">√Ä propos de la recherche de processus non stationnaires</a></li>
<li><a href="../fr453728/index.html">Bataille des hyperstars</a></li>
<li><a href="../fr453730/index.html">Dentisterie moderne: implantation dentaire simultan√©e et extension de l'os de la m√¢choire √† travers les yeux du directeur technique</a></li>
<li><a href="../fr453732/index.html">Je viens de Moreinis. Vues obliques ou respect?</a></li>
<li><a href="../fr453734/index.html">Pr√©sentation de Helm 3</a></li>
<li><a href="../fr453744/index.html">Nous √©tudions le principe de la pseudo-classe: not () en utilisant l'exemple de la t√¢che "Mise en √©vidence de la ligne active d'une table en CSS pur"</a></li>
<li><a href="../fr453748/index.html">Prototypage d'un jeu mobile, par o√π commencer et comment le faire. Partie 3 (finale)</a></li>
<li><a href="../fr453750/index.html">√Ä propos de la r√©cente cyberattaque de Baltimore</a></li>
<li><a href="../fr453756/index.html">Probl√®mes de la m√©thodologie actuelle pour d√©terminer les menaces actuelles du FSTEC</a></li>
<li><a href="../fr453760/index.html">Camp d'entra√Ænement en circuit pour r√©servoirs et processeurs</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>