<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>💂🏼 🏊 🔦 使用Android版cron并添加Shell脚本以在设备启动时自动运行 📃 🛳️ 👊🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="由于移动设备长期以来具有广泛的功能，因此可以轻松地将自动化任务转移给它们。 而且，cron尽可能地适合执行它们。 但是，如果cron在“普通” Linux系统上花费一些时间，则Android设备需要进行更复杂的配置工作。 

 如果您对自动化主题感兴趣，并且希望在设备启动后立即启动Shell脚本，甚...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>使用Android版cron并添加Shell脚本以在设备启动时自动运行</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/468337/"><img src="https://habrastorage.org/webt/t2/ia/uo/t2iauogb45suwvzulewv9wbktr8.jpeg"><br><br> 由于移动设备长期以来具有广泛的功能，因此可以轻松地将自动化任务转移给它们。 而且，cron尽可能地适合执行它们。 但是，如果cron在“普通” Linux系统上花费一些时间，则Android设备需要进行更复杂的配置工作。 <br><br> 如果您对自动化主题感兴趣，并且希望在设备启动后立即启动Shell脚本，甚至可以通过计时器启动，那么欢迎您！ <br><a name="habracut"></a><br><h2> 前言 </h2><br> 我从事Android移动设备的自动化。 在执行自动脚本的过程中，即使使用相同的设备进行测试，也会发生许多无法预料的情况。 <br><br> 最受欢迎的问题： <br><br>  0.自动化脚本无法满足您的需求。 <br>  1.移动应用程序自动下载 <br>  2.手机自动重启 <br>  3.重新启动后，移动应用程序不会自动启动 <br>  4. Wi-Fi模块随机关闭，找不到网络，未连接到网络 <br>  5.移动网络突然消失 <br>  6.手机进入睡眠模式 <br>  7.代理掉线或服务器本身或服务器返回奇怪的响应 <br><br> 因此，您必须不断监视设备并捕获这些不可预见的情况。 <br><br><img src="https://habrastorage.org/webt/93/fb/-1/93fb-1wjpwjs3tcpvv4jzg9b2zw.png"><br><br> 因此，我得出的结论是，带有“正确”脚本的cron将使您能够跟踪软件故障并还原自动化脚本或再次运行它。 但事实证明，尽管Android包含Linux内核，但我必须处理一些特殊的细微差别。 因此，让我们开始进行设置！ <br><br><h2>  Cron设置 </h2><br><h3> 定制环境 </h3><br><ol><li> 安装<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">adb</a>以使用USB线通过外壳访问设备。 </li><li> 我们打开“面向<b>开发人员</b> ”部分。 为此，请转到“ <b>关于电话”</b>部分，然后单击“ <b>内部版本号”</b>或类似名称。 </li><li> 我们转到面向<b>开发人员</b>的部分，然后将其打开。 我们将设备连接到计算机，并允许在此计算机上访问该设备。 </li><li> 为您的设备添加<b>root</b> 。 最常见的选项是<b>SuperSu</b> ， <b>Magisk</b>和<b>Kingroot</b> 。 转到w3bsit3-dns.com并找到您设备的root选项。 不幸的是，没有普遍的根源。 </li><li> 我们安装了<b>BusyBox</b> （例如，它也在w3bsit3-dns.com上），因为它仅包含一个cron程序。 </li></ol><br><h3> 手动开始设定 </h3><br><ol><li> 我们使用<b>adb shell</b>连接到电话（如果adb未在您的环境变量中注册，请添加完整路径。 </li><li> 使用<b>su</b>命令进入root模式 </li><li> 我们检查cron程序是否存在，并使用<b>crond -h</b>命令查看设置 </li></ol><br><div class="spoiler">  <b class="spoiler_title">执行结果</b> <div class="spoiler_text"><pre><code class="bash hljs">crond: invalid option -- h BusyBox v1.29.2-Stericson (2018-08-12 11:19:12 EDT) multi-call binary. Usage: crond -fbS -l N -d N -L LOGFILE -c DIR -f Foreground -b Background (default) -S Log to syslog (default) -l N Set <span class="hljs-built_in"><span class="hljs-built_in">log</span></span> level. Most verbose 0, default 8 -d N Set <span class="hljs-built_in"><span class="hljs-built_in">log</span></span> level, <span class="hljs-built_in"><span class="hljs-built_in">log</span></span> to stderr -L FILE Log to FILE -c DIR Cron dir. Default:/var/spool/cron/crontabs</code> </pre> <br></div></div><br> 从最后一行可以看到，默认指令应存储在目录<b>/ var / spool / cron / crontabs中</b> ，该目录不会自动创建，并且如果我们运行命令 <pre> <code class="bash hljs">crond -b</code> </pre> 然后检查该过程是否开始 <pre> <code class="bash hljs">ps | grep crond</code> </pre>  ，那么它可能不存在，因为 他没有得到任何指示。 所以我们执行命令 <pre> <code class="bash hljs">crond -b -fd0</code> </pre> 看看是什么原因。 您很可能会遇到类似的错误： <br>  <code>crond: can't change directory to '/var/spool/cron/crontabs': No such file or directory</code> 。 在这种情况下，这是正常的，因为 将来，我们自己将指示crontab可执行文件的路径。 <br><br>  4.创建一个简单的crontab文件： <br><br><pre> <code class="bash hljs">mkdir /data/crontab <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"*/1 * * * * echo 'text' &gt;&gt; /sdcard/test.txt"</span></span> &gt; /data/crontab/root</code> </pre> <br> 现在我们有一个任务，每分钟将单词<i>文本</i>添加到文件<b>/sdcard/test.txt中</b> <br> 我们推出： <pre> <code class="bash hljs">crond -b -fd0 -c /data/crontab</code> </pre> 并获得以下日志： <br><br><pre> <code class="bash hljs">crond: crond (busybox 1.29.2-Stericson) started, <span class="hljs-built_in"><span class="hljs-built_in">log</span></span> level 0 crond: ignoring file <span class="hljs-string"><span class="hljs-string">'root'</span></span> (no such user) ...</code> </pre> <br> 当然，这有点令人惊讶，因为如果我们执行<b>whoami命令，</b>它将作为结果返回<b>root</b> 。 <br><br>  5.添加root用户，因为crond会询问： <br><br><pre> <code class="bash hljs">mount -o remount,rw /system; <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"root:x:0:0::/system/etc/crontabs:/system/bin/sh"</span></span> &gt;&gt; /system/etc/passwd; mount -o remount,ro /system;</code> </pre> <br> 由于缺少此文件，我意识到在Android系统中根本不涉及该文件。 如果您确定将crontab文件存储在何处，则可以用所需的行替换<b>/ system / etc / crontabs</b> 。 再次运行命令 <br><br><pre> <code class="bash hljs">crond -b -fd0 -c /data/crontab</code> </pre> <br> 我们得到以下信息： <br><br><pre> <code class="bash hljs">crond: user:root entry:*/1 * * * * <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'text'</span></span> &gt;&gt; /sdcard/test.txt 111111111111111111111111111111111111111111111111111111111111 111111111111111111111111 11111111111111111111111111111111 111111111111 1111111 crond: wakeup dt=16 crond: file root: crond: line <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'text'</span></span> &gt;&gt; /sdcard/test.txt crond: job: 0 <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'text'</span></span> &gt;&gt; /sdcard/test.txt crond: can<span class="hljs-string"><span class="hljs-string">'t change directory to '</span></span>/system/etc/crontabs<span class="hljs-string"><span class="hljs-string">' crond: can'</span></span>t change directory to <span class="hljs-string"><span class="hljs-string">'/var/spool/cron'</span></span>: No such file or directory crond: USER root pid 12849 cmd <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'text'</span></span> &gt;&gt; /sdcard/test.txt</code> </pre> <br> 尽管根据日志，该任务已在crond中注册，但是在我的情况下，未创建文件。 这个问题可以很简单地解决： <br><br><pre> <code class="bash hljs">mkdir -p /system/etc/crontabs</code> </pre> <br> 好吧，他想要一个目录存在于此，我们该禁止他！ 我们再次开始，看到： <br><br><pre> <code class="bash hljs">crond: user:root entry:*/1 * * * * <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'text'</span></span> &gt;&gt; /sdcard/test.txt 111111111111111111111111111111111111111111111111111111111111 111111111111111111111111 11111111111111111111111111111111 111111111111 1111111 crond: wakeup dt=12 crond: file root: crond: line <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'text'</span></span> &gt;&gt; /sdcard/test.txt crond: job: 0 <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'text'</span></span> &gt;&gt; /sdcard/test.txt crond: child running /system/bin/sh crond: USER root pid 13033 cmd <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'text'</span></span> &gt;&gt; /sdcard/test.txt</code> </pre> <br> 错误消失了，并出现了以下问题<b>：子运行中/ system / bin / sh</b> 。 最后，cron已成功结束，您可以继续进行第二部分！ <br><br><h2> 自动shell脚本下载 </h2><br>  Linux系统有一个<b>init.d</b>目录，该目录负责在系统引导后立即自动启动，所以让我们尝试一下！ <br><br>  1.检查此目录在您的设备上是否存在（这是<b>/etc/init.d</b>或<b>/system/etc/init.d-</b>这是相同的已安装分区等）。 就我而言，事实并非如此。 好吧，然后创建： <br><br><pre> <code class="bash hljs">mount -o remount,rw /system mkdir /system/etc/init.d chmod 0755 /system/etc/init.d mount -o remount,ro /system</code> </pre> <br> 现在在其中添加一些简单的脚本，例如： <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"echo 'Init.d is working !!!' &gt;&gt; /sdcard/init_test.log"</span></span> &gt; /system/etc/init.d/90my_script chmod 777 /system/etc/init.d/90my_script</code> </pre> <br> 我们重新启动设备，看看是否发生了奇迹...不幸的是，我的文件没有出现。 <br><br> 我们将进一步检查系统，并寻找一些可以在启动后运行脚本的初始化文件。 我的设备上的<b>/init.rc中</b>有一个文件。 好吧，让我们尝试更改它并重新启动设备： <br><br><pre> <code class="bash hljs">mount -o remount,rw / <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"echo 'Init.d is working !!!' &gt;&gt; /sdcard/init_test.log"</span></span> &gt;&gt; /init.rc mount -o remount,ro / reboot</code> </pre> <br> 但是没有再次创建该文件。 我们去查看文件<b>/init.rc</b> ，我们的记录消失了，文件似乎没有变化，因为 创建日期非常奇怪（以我为例，70年1月1日，05：00：00）。 <br><br> 我们继续理解，事实证明该文件存储在<b>boot.img中</b> ，并且每次退出该文件时都会存储。 为了更改<b>init.rc</b>文件的功能， <b>您</b>需要做所有<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">这</a>一切。 <br><br> 但是，有一种更简单的方法可以帮助解决此问题。 对于这种方法，我们可以使用以下shell脚本（感谢Ryuinferno）： <br><br><div class="spoiler">  <b class="spoiler_title">Shell脚本</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/system/bin/sh #Script to enable init.d by Ryuinferno @ XDA error_msg(){ echo "You do not need this mod..." sleep 1 echo "If you are reapplying, please delete these files if present:" echo "/system/bin/sysinit" sleep 1 echo "/system/etc/install-recovery.sh" sleep 1 echo "/system/etc/install-recovery-2.sh" sleep 1 echo "And run again..." sleep 1 echo "If init.d is still not working, read the FAQ part in my thread..." sleep 1 echo "Aborting..." mount -o remount,ro -t auto /system echo "" echo "Ryuinferno @ XDA" exit 1 } echo "Init.d Enabler by Ryuinferno @ XDA" echo "" sleep 1 id=`id`; id=`echo ${id#*=}`; id=`echo ${id%%\(*}`; id=`echo ${id%% *}` if [ "$id" != "0" ] &amp;&amp; [ "$id" != "root" ]; then echo "Script NOT running as root!" sleep 1 echo "Superuser access not granted!" sleep 1 echo "Please type 'su' first before running this script..." exit 1 else echo "Hello Supaa User! :P" echo "" sleep 1 fi if [ ! "'which busybox'" ]; then echo "busybox NOT INSTALLED!" sleep 1 echo "Please install busybox first!" exit 1 else echo "busybox found!" sleep 1 fi bbb=0 if [ ! "`which grep`" ]; then bbb=1 echo "grep applet NOT FOUND!" sleep 1 else echo "Awesome! grep found! :D" sleep 1 fi if [ ! "`which run-parts`" ]; then bbb=1 echo "run-parts applet NOT FOUND!" sleep 1 else echo "Good! run-parts found! :)" echo "" sleep 1 fi if [ $bbb -eq 1 ] ; then echo "" echo "Required applets are NOT FOUND!" echo "" sleep 1 echo "Please reinstall busybox!" exit 1 fi echo "Great! Let's proceed..." echo "" sleep 1 echo "Press enter to continue..." read enterKey clear sleep 1 echo "Mounting system as rewritable..." mount -o remount,rw -t auto /system sleep 1 echo "Removing old sysinit file" rm /system/bin/sysinit sleep 1 echo "" echo "Checking for the presence of sysinit in /system/bin..." sleep 1 if [ -e /system/bin/sysinit ]; then echo "sysinit found..." if [ -z "`cat /system/bin/sysinit | grep "init.d"`" ]; then echo "Adding lines to sysinit..." echo "" &gt;&gt; /system/bin/sysinit echo "# init.d support" &gt;&gt; /system/bin/sysinit echo "" &gt;&gt; /system/bin/sysinit echo "export PATH=/sbin:/system/sbin:/system/bin:/system/xbin" &gt;&gt; /system/bin/sysinit echo "run-parts /system/etc/init.d" &gt;&gt; /system/bin/sysinit echo "" &gt;&gt; /system/bin/sysinit else echo "" echo "Your sysinit should already be running the scripts in init.d folder at boot..." error_msg fi else echo "sysinit not found, creating file..." echo "#!/system/bin/sh" &gt; /system/bin/sysinit echo "# init.d support" &gt;&gt; /system/bin/sysinit echo "" &gt;&gt; /system/bin/sysinit echo "export PATH=/sbin:/system/sbin:/system/bin:/system/xbin" &gt;&gt; /system/bin/sysinit echo "run-parts /system/etc/init.d" &gt;&gt; /system/bin/sysinit echo "" &gt;&gt; /system/bin/sysinit fi sleep 1 echo "Setting correct permissions and ownership for sysinit..." chmod 755 /system/bin/sysinit chown 0.2000 /system/bin/sysinit sleep 1 echo "" echo "Checking for the presence of install-recovery.sh..." sleep 1 if [ -f /system/etc/install-recovery.sh ] &amp;&amp; [ -z "`cat /system/etc/install-recovery.sh | grep "daemon"`" ]; then if [ ! -z "`cat /system/etc/install-recovery.sh | grep "init.d"`" ];then echo "Your install-recovery.sh seems to be already modified for init.d..." error_msg fi echo "install-recovery.sh found, renaming it as install-recovery-2.sh..." mv /system/etc/install-recovery.sh /system/etc/install-recovery-2.sh echo "Recreating install-recovery.sh..." echo "#!/system/bin/sh" &gt; /system/etc/install-recovery.sh echo "# init.d support" &gt;&gt; /system/etc/install-recovery.sh echo "" &gt;&gt; /system/etc/install-recovery.sh echo "/system/bin/sysinit" &gt;&gt; /system/etc/install-recovery.sh echo "" &gt;&gt; /system/etc/install-recovery.sh echo "# excecuting extra commands" &gt;&gt; /system/etc/install-recovery.sh echo "/system/etc/install-recovery-2.sh" &gt;&gt; /system/etc/install-recovery.sh echo "" &gt;&gt; /system/etc/install-recovery.sh elif [ -f /system/etc/install-recovery.sh ] &amp;&amp; [ ! -z "`cat /system/etc/install-recovery.sh | grep "daemon"`" ]; then if [ -f /system/etc/install-recovery-2.sh ] &amp;&amp; [ ! -z "`cat /system/etc/install-recovery-2.sh | grep "init.d"`" ];then echo "Your install-recovery-2.sh seems to be already modified for init.d..." error_msg fi echo "install-recovery.sh is used for superuser, using install-recovery-2.sh instead..." if [ -f /system/etc/install-recovery-2.sh ]; then echo "" &gt;&gt; /system/etc/install-recovery-2.sh echo "# init.d support" &gt;&gt; /system/etc/install-recovery-2.sh echo "/system/bin/sysinit" &gt;&gt; /system/etc/install-recovery-2.sh echo "" &gt;&gt; /system/etc/install-recovery-2.sh else echo "#!/system/bin/sh" &gt; /system/etc/install-recovery-2.sh echo "# init.d support" &gt;&gt; /system/etc/install-recovery-2.sh echo "" &gt;&gt; /system/etc/install-recovery-2.sh echo "/system/bin/sysinit" &gt;&gt; /system/etc/install-recovery-2.sh echo "" &gt;&gt; /system/etc/install-recovery-2.sh fi if [ -z "`cat /system/etc/install-recovery.sh | grep "install-recovery-2.sh"`" ]; then echo "" &gt;&gt; /system/etc/install-recovery.sh echo "# extra commands" &gt;&gt; /system/etc/install-recovery.sh echo "/system/etc/install-recovery-2.sh" &gt;&gt; /system/etc/install-recovery.sh echo "" &gt;&gt; /system/etc/install-recovery.sh fi else echo "install-recovery.sh not found, creating it..." echo "#!/system/bin/sh" &gt; /system/etc/install-recovery.sh echo "# init.d support" &gt;&gt; /system/etc/install-recovery.sh echo "" &gt;&gt; /system/etc/install-recovery.sh echo "/system/bin/sysinit" &gt;&gt; /system/etc/install-recovery.sh echo "" &gt;&gt; /system/etc/install-recovery.sh fi sleep 1 echo "Setting the correct permissions and ownership for install-recovery.sh..." echo "Also for install-recovery-2.sh if it exists..." chmod 755 /system/etc/install-recovery.sh chown 0.0 /system/etc/install-recovery.sh if [ -f /system/etc/install-recovery-2.sh ]; then chmod 755 /system/etc/install-recovery-2.sh chown 0.0 /system/etc/install-recovery-2.sh fi sleep 1 echo "" echo "Checking for the presence of the init.d folder..." sleep 1 if [ -d /system/etc/init.d ]; then echo "init.d folder found..." else echo "init.d folder not found, creating the folder..." mkdir /system/etc/init.d fi sleep 1 echo "" echo "Creating basic init.d scripts..." echo "#!/system/bin/sh" &gt; /system/etc/init.d/08setperm echo "#set correct permissions to /system/etc/init.d folder" &gt;&gt; /system/etc/init.d/08setperm echo "" &gt;&gt; /system/etc/init.d/08setperm echo "mount -o remount,rw -t auto /system" &gt;&gt; /system/etc/init.d/08setperm echo "chmod -R 777 /system/etc/init.d" &gt;&gt; /system/etc/init.d/08setperm echo "mount -o remount,ro -t auto /system" &gt;&gt; /system/etc/init.d/08setperm echo "" &gt;&gt; /system/etc/init.d/08setperm echo "#!/system/bin/sh" &gt; /system/etc/init.d/00test echo "#init.d test" &gt;&gt; /system/etc/init.d/00test echo "" &gt;&gt; /system/etc/init.d/00test echo "if [ -f /data/Test.log ]; then" &gt;&gt; /system/etc/init.d/00test echo "rm /data/Test.log" &gt;&gt; /system/etc/init.d/00test echo "fi" &gt;&gt; /system/etc/init.d/00test echo "" &gt;&gt; /system/etc/init.d/00test echo 'echo "Init.d is working !!!" &gt;&gt; /data/Test.log' &gt;&gt; /system/etc/init.d/00test echo 'echo "excecuted on $(date +"%d-%m-%Y %r" )" &gt;&gt; /data/Test.log' &gt;&gt; /system/etc/init.d/00test echo "" &gt;&gt; /system/etc/init.d/00test sleep 1 echo "Creating permissive SELinux script..." sleep 1 echo "#!/system/bin/sh" &gt;&gt; /system/etc/init.d/01permissive echo "#Init.d Permissive SELinux" &gt;&gt; /system/etc/init.d/01permissive echo "" &gt;&gt; /system/etc/init.d/01permissive echo "busybox mount -o remount,rw -t auto /system" &gt;&gt; /system/etc/init.d/01permissive echo "" &gt;&gt; /system/etc/init.d/01permissive echo "setenforce 0" &gt;&gt; /system/etc/init.d/01permissive echo "SELINUX=permissive" &gt;&gt; /system/etc/init.d/01permissive echo "" &gt;&gt; /system/etc/init.d/01permissive sleep 1 echo "Setting correct permissions and ownership for init.d folder and scipts..." chmod 777 /system/etc/init.d chmod 777 /system/etc/init.d/08setperm chmod 777 /system/etc/init.d/00test chmod 777 /system/etc/init.d/01permissive chown 0.0 /system/etc/init.d chown 0.0 /system/etc/init.d/08setperm chown 0.0 /system/etc/init.d/00test chown 0.0 /system/etc/init.d/01permissive sleep 1 echo "" echo "Mounting system as read-only..." mount -o remount,ro -t auto /system sleep 1 echo "" echo "Done!!!" sleep 1 echo "Please reboot at least twice before checking /data..." sleep 1 echo "If init.d is working, you will see a Test.log in /data..." sleep 1 echo "" echo "Enjoy!!! =)" echo "Ryuinferno @ XDA 2013" exit</span></span></code> </pre><br></div></div><br> 脚本入门！ 在我的情况下，它将称为init.sh。 <br>  1.将文件下载到移动设备的SD卡中： <br><pre> <code class="bash hljs">adb push /tmp/init.sh /sdcard</code> </pre> <br>  2.复制到移动设备的内存中并设置必要的权限： <br><pre> <code class="bash hljs">adb shell su cp /sdcard/init.sh /data/init.sh chmod 777 /data/init.sh</code> </pre> <br>  3.运行执行： <br><pre> <code class="bash hljs">/data/init.sh</code> </pre> <br> 并注意显示的日志。 这是我的日志： <br><div class="spoiler">  <b class="spoiler_title">运行日志</b> <div class="spoiler_text"><pre> <code class="bash hljs">Init.d Enabler by Ryuinferno @ XDA Hello Supaa User! :P busybox found! Awesome! grep found! :D Good! run-parts found! :) Great! Let<span class="hljs-string"><span class="hljs-string">'s proceed... Press enter to continue... Mounting system as rewritable... Removing old sysinit file rm: /system/bin/sysinit: No such file or directory Checking for the presence of sysinit in /system/bin... sysinit not found, creating file... Setting correct permissions and ownership for sysinit... Checking for the presence of install-recovery.sh... install-recovery.sh not found, creating it... Setting the correct permissions and ownership for install-recovery.sh... Also for install-recovery-2.sh if it exists... Checking for the presence of the init.d folder... init.d folder found... Creating basic init.d scripts... Creating permissive SELinux script... Setting correct permissions and ownership for init.d folder and scipts... Mounting system as read-only... Done!!! Please reboot at least twice before checking /data... If init.d is working, you will see a Test.log in /data... Enjoy!!! =) Ryuinferno @ XDA 2013</span></span></code> </pre> <br></div></div><br> 从日志中可以看到，没有错误，请随时重新启动设备！ 也许有人已经在工作，您可以找到<b>/data/Test.log</b>文件，但我没有。 使用<b>ls命令</b>检查<b>/system/etc/init.d</b>目录： <br><br><pre> <code class="bash hljs">00test 01permissive 08setperm</code> </pre> <br> 如您所见，任务已成功创建。 您可能仍然需要更改<b>boot.img</b> ，但是让我们在开始时检查一下，其中的<b>install-recovery.sh</b>文件在以下位置： <br><br><pre> <code class="bash hljs">find / -name <span class="hljs-string"><span class="hljs-string">"install-recovery.sh"</span></span> ... /system/bin/install-recovery.sh /system/etc/install-recovery.sh ...</code> </pre> <br> 如我们所见，我们有2个文件位于不同的位置。 在创建日期之前，我们可以注意到该脚本在<b>/system/etc/install-recovery.sh</b>目录中创建了该文件，尽管在某些情况下，它应该在<b>/ system / etc中</b>创建该文件<b>。</b> 让我们将文件重命名为bin并从etc复制文件： <br><br><pre> <code class="bash hljs">mount -o remount,rw /system mv /install-recovery.sh /system/bin/install-recovery2.sh cp /install-recovery.sh /system/bin/</code> </pre> <br><br>  <b>UPD</b> ：请注意，两个文件的安全性上下文必须匹配。 而且，如果您在复制时突然迷路（虽然从理论上讲应该不是），则需要将其还原（例如，通过<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">chcon</a>实用程序）。 使用<b>ls -lZ</b>查看完整的文件信息： <br><pre> <code class="bash hljs">ls -lZ /system/etc/install-recovery.sh <span class="hljs-comment"><span class="hljs-comment"># -rwxr-xr-x root root u:object_r:system_file:s0 install-recovery.sh</span></span></code> </pre><br> 在这里<b>u：object_r：system_file：s0</b>是安全上下文。 <br><br> 再次，我们重新启动设备...现在，终于，期待已久的成功！ 文件<b>/data/Test.log已经</b>出现！ <br><br> 一切正常后，转到<b>/system/etc/init.d</b>并创建一个shell脚本。 然后在其中运行我们的crond以执行： <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"#!/system/bin/sh crond -b -L /sdcard/error.log -c /data/crontab"</span></span> &gt; /system/etc/init.d/99cronstart chmod 777 /system/etc/init.d/99cronstart reboot</code> </pre> <br> 下载后，检查crond是否已启动： <br><br><pre> <code class="bash hljs">ps | grep crond root 414 1 9532 236 hrtimer_na 000dcf90 S crond</code> </pre> <br> 现在可以结束了，但是让我们等待一分钟，看看我们的文件中是否有记录...好了，正如您已经了解的那样，什么也没起作用。 事实是，此过程需要从超级用户运行。 更改<b>99cronstart</b>文件中的脚本： <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"#!/system/bin/sh /su/bin/su -c crond -b -L /sdcard/error.log -c /data/crontab"</span></span> &gt; /system/etc/init.d/99cronstart reboot</code> </pre> <br><br>  <b>UPD</b> ：也许在您的情况下， <b>su</b>将具有不同的路径，然后使用<b>su</b>命令并用您的路径替换该路径。 <br><br> 现在，我们的Android设备支持cron任务，并且可能包含用于自动启动的shell脚本！ <br><br> 最后，将运行我们的应用程序的脚本（如果不在进程中）并在启动我们的应用程序之前保存有关主屏幕上内容的信息： <br><br><pre> <code class="bash hljs">proc=$(ps | grep <span class="hljs-string"><span class="hljs-string">"com.test.app"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$proc</span></span></span><span class="hljs-string">"</span></span> == <span class="hljs-string"><span class="hljs-string">""</span></span> ]; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> dumpsys window | grep CurrentFocus &gt; /sdcard/current_focus.dump sleep 1 am start -n com.test.app/com.test.app.activities.MainActivity <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span></code> </pre></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN468337/">https://habr.com/ru/post/zh-CN468337/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN468323/index.html">什么样的噪音有助于集中精神和放松身心，还可以防止严重事故中的听力损失</a></li>
<li><a href="../zh-CN468327/index.html">差距-Flexbox中缩进的美好前景（如在Grid中）</a></li>
<li><a href="../zh-CN468329/index.html">A / B测试还不够</a></li>
<li><a href="../zh-CN468331/index.html">Stephen Wolfram的生活时刻-Wolfram Mathematica的创建者| Alpha，一种新型的科学等等</a></li>
<li><a href="../zh-CN468333/index.html">如何使用Visual Studio调试和配置文件任何exe文件</a></li>
<li><a href="../zh-CN468339/index.html">为Visual Studio App Center引入深色主题</a></li>
<li><a href="../zh-CN468341/index.html">Windows终端上的Azure Cloud Shell</a></li>
<li><a href="../zh-CN468343/index.html">杰夫·贝索斯（Jeff Bezos）：“为了地球的利益而进入太空”</a></li>
<li><a href="../zh-CN468345/index.html">GitHub在CI / CD和工件管理中启动了触角</a></li>
<li><a href="../zh-CN468347/index.html">MetricKit。 iOS应用程序性能分析</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>