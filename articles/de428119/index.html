<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🆔 👩🏼‍💻 🔲 "Klassenfeld-Vorschlag" oder "Was ist beim tc39-Commit schief gelaufen" 🚶🏿 🏳️ 👨🏼‍🤝‍👨🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Wir alle wollten vor langer Zeit eine normale Kapselung in JS, die ohne unnötige Gesten verwendet werden kann. Wir wollen auch bequeme Konstruktionen ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>"Klassenfeld-Vorschlag" oder "Was ist beim tc39-Commit schief gelaufen"</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/428119/"><p>  Wir alle wollten vor langer Zeit eine normale Kapselung in JS, die ohne unnötige Gesten verwendet werden kann.  Wir wollen auch bequeme Konstruktionen zum Deklarieren von Klasseneigenschaften.  Und schließlich möchten wir, dass all diese Funktionen in der Sprache so angezeigt werden, dass vorhandene Anwendungen nicht beschädigt werden. </p><br><p> Es scheint, dass es hier Glück ist: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Klassenfeld-Vorschlag</a> , der nach vielen Jahren der Qual des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">tc39-Komitees</a> noch <code>stage 3</code> und sogar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">in Chrom umgesetzt wurde</a> . </p><br><p>  Ehrlich gesagt würde ich wirklich gerne einen Artikel darüber schreiben, warum Sie die neue Sprachfunktion verwenden sollten und wie es geht, aber leider wird der Artikel überhaupt nicht darüber handeln. </p><a name="habracut"></a><br><h1 id="opisanie-tekuschego-propozala">  Beschreibung des fehlenden Stroms </h1><br><p>  Ich werde die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ursprüngliche Beschreibung</a> , <a href="">FAQ</a> und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Änderungen in den Spezifikationen hier</a> nicht wiederholen, sondern nur kurz die wichtigsten Punkte skizzieren. </p><br><h2 id="polya-klassa">  Klassenfelder </h2><br><p>  Felder deklarieren und innerhalb einer Klasse verwenden: </p><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">A</span></span></span><span class="hljs-class"> </span></span>{ x = <span class="hljs-number"><span class="hljs-number">1</span></span>; method() { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.x); } }</code> </pre> <br><p>  Zugriff auf Felder außerhalb der Klasse: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> a = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> A(); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(ax);</code> </pre> <br><p>  Alles schien offensichtlich zu sein und seit vielen Jahren verwenden wir diese Syntax mit <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Babel</a> und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">TypeScript</a> . </p><br><p>  Nur gibt es eine Nuance.  Diese neue Syntax verwendet <code>[[Define]]</code> und nicht <code>[[Set]]</code> Semantik, mit der wir die ganze Zeit gelebt haben. </p><br><p>  In der Praxis bedeutet dies, dass der obige Code <strong>nicht dem folgenden entspricht</strong> : </p><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">A</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.x = <span class="hljs-number"><span class="hljs-number">1</span></span>; } method() { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.x); } }</code> </pre> <br><p>  Aber eigentlich ist es <strong>gleichbedeutend</strong> damit: </p><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">A</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>() { <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.defineProperty(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, <span class="hljs-string"><span class="hljs-string">"x"</span></span>, { <span class="hljs-attr"><span class="hljs-attr">configurable</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">enumerable</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">writable</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span> }); } method() { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.x); } }</code> </pre> <br><p>  Und obwohl für das obige Beispiel beide Ansätze im Wesentlichen dasselbe tun, ist dies ein <strong>SEHR ERNSTER</strong> Unterschied, und hier ist der Grund: </p><br><p>  Nehmen wir an, wir haben eine Elternklasse wie diese: </p><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">A</span></span></span><span class="hljs-class"> </span></span>{ x = <span class="hljs-number"><span class="hljs-number">1</span></span>; method() { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.x); } }</code> </pre> <br><p>  Darauf basierend haben wir eine weitere erstellt: </p><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">B</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">A</span></span></span><span class="hljs-class"> </span></span>{ x = <span class="hljs-number"><span class="hljs-number">2</span></span>; }</code> </pre> <br><p>  Und sie haben es benutzt: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> b = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> B(); b.method(); <span class="hljs-comment"><span class="hljs-comment">//   2  </span></span></code> </pre> <br><p>  Dann wurde aus irgendeinem Grund die Klasse <code>A</code> scheinbar abwärtskompatibel geändert: </p><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">A</span></span></span><span class="hljs-class"> </span></span>{ _x = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-comment"><span class="hljs-comment">//  ,   ,        get x() { return this._x; }; set x(val) { return this._x = val; }; method() { console.log(this._x); } }</span></span></code> </pre> <br><p>  Und für die <code>[[Set]]</code> Semantik ist dies wirklich eine abwärtskompatible Änderung, jedoch nicht für <code>[[Define]]</code> .  Jetzt wird der Aufruf von <code>b.method()</code> an Konsole <code>1</code> anstatt an <code>2</code> ausgegeben.  Dies geschieht, weil <code>Object.defineProperty</code> den Eigenschaftsdeskriptor neu definiert und dementsprechend Getter / Setter aus Klasse <code>A</code> nicht aufgerufen wird.  Tatsächlich haben wir in der untergeordneten Klasse <em>die</em> <code>x</code> Eigenschaft des Elternteils <em>verdeckt</em> , ähnlich wie wir dies im lexikalischen Bereich tun können: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> x = <span class="hljs-number"><span class="hljs-number">1</span></span>; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> x = <span class="hljs-number"><span class="hljs-number">2</span></span>; }</code> </pre> <br><p>  In diesem Fall wird uns zwar der Linter mit seinen Regeln für <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><code>no-shadowed-variable</code></a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><code>no-shadow</code></a> retten, aber die Wahrscheinlichkeit, dass jemand ein <code>no-shadowed-class-field</code> für <code>no-shadowed-class-field</code> gegen Null. </p><br><blockquote>  Übrigens werde ich für die erfolgreichere russische Bezeichnung für <code>shadowed</code> dankbar sein. </blockquote><p>  Trotz alledem bin ich kein inakzeptabler Gegner der neuen Semantik (obwohl ich eine andere bevorzugen würde), weil sie ihre eigenen positiven Aspekte hat.  Leider überwiegen diese Pluspunkte nicht das wichtigste Minus - wir verwenden seit vielen Jahren die Semantik <code>[[Set]]</code> , da sie standardmäßig in <code>babel6</code> und <code>TypeScript</code> wird. </p><br><blockquote>  Es <code>babel7</code> , dass in <code>babel7</code> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Standardwert geändert wurde</a> . </blockquote><p>  Weitere originelle Diskussionen zu diesem Thema finden Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> . </p><br><h2 id="privatnye-polya">  Private Felder </h2><br><p>  Und jetzt kommen wir zum umstrittensten Teil dieses Artikels.  So umstritten, dass: </p><br><ol><li>  Trotz der Tatsache, dass es bereits in <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Chrome Canary</a> implementiert ist und öffentliche Felder bereits standardmäßig aktiviert sind, befinden sich private Felder immer noch hinter der Flagge. </li><li>  Trotz der Tatsache, dass das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ursprüngliche Prozal für private Felder</a> mit dem aktuellen zusammengeführt wurde, werden immer noch Anforderungen für die Trennung dieser beiden Merkmale (z. B. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">eins</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">zwei</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">drei</a> und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">vier</a> ) erstellt. </li><li>  Sogar einige Komiteemitglieder (wie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Allen Wirfs-Brock</a> und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Kevin Smith</a> ) sprechen sich aus und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">bieten</a> trotz <strong>Stufe 3</strong> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Alternativen an</a> . </li><li>  Dieser verpasste Rekord stellte einen Rekord für die Anzahl der Ausgaben auf - <strong>129</strong> im <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">aktuellen Repository</a> + <strong>96</strong> im <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Original</a> gegenüber <strong>126</strong> für <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">BigInt</a> , und der Rekordhalter hat überwiegend <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">negative Kommentare</a> . </li><li>  Ich musste einen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">separaten Thread</a> erstellen, um alle Ansprüche dagegen irgendwie zusammenzufassen. </li><li>  Ich musste eine <a href="">separate FAQ</a> schreiben, die diesen Teil abdeckt <br><blockquote>  Aufgrund einer eher schwachen Argumentation erschienen solche Diskussionen jedoch ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">eins</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">zwei</a> ). <br></blockquote></li><li>  Ich persönlich verbrachte meine ganze Freizeit (und manchmal auch meine Arbeit) über einen langen Zeitraum, um alles <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">herauszufinden</a> und sogar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">eine Erklärung</a> dafür zu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">finden,</a> warum er so war, oder eine <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">geeignete Alternative</a> anzubieten. </li><li>  Am Ende habe ich beschlossen, diesen Übersichtsartikel zu schreiben. </li></ol><br><p>  Private Felder werden wie folgt deklariert: </p><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">A</span></span></span><span class="hljs-class"> </span></span>{ #priv; }</code> </pre> <br><p>  Der Zugang zu ihnen ist wie folgt: </p><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">A</span></span></span><span class="hljs-class"> </span></span>{ #priv = <span class="hljs-number"><span class="hljs-number">1</span></span>; method() { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.#priv); } }</code> </pre> <br><p>  Ich werde nicht einmal das Thema ansprechen, dass das mentale Modell dahinter nicht sehr intuitiv ist ( <code>this.#priv !== this['#priv']</code> ), nicht die bereits reservierten <code>private</code> / <code>protected</code> Wörter verwendet (was notwendigerweise zusätzlichen Schmerz verursacht für TypeScript-Entwickler) ist nicht klar, wie es für <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">andere Zugriffsmodifikatoren erweitert werden soll</a> , und die Syntax selbst ist nicht sehr schön.  Obwohl all dies der ursprüngliche Grund war, der mich zu einem tieferen Studium und zur Teilnahme an Diskussionen veranlasste. </p><br><p>  Dies alles bezieht sich auf die Syntax, bei der die subjektiven ästhetischen Präferenzen sehr stark sind.  Und man könnte damit leben und sich mit der Zeit daran gewöhnen.  Wenn nicht für eine Sache: Es gibt ein sehr bedeutendes Problem der Semantik ... </p><br><h3 id="cemantika-weakmap">  Semantik <code>WeakMap</code> </h3><br><p>  Werfen wir einen Blick darauf, was hinter dem bestehenden Vorschlag steckt.  Wir können das obige Beispiel mit Kapselung und ohne Verwendung der neuen Syntax umschreiben, wobei jedoch die Semantik der aktuellen beibehalten wird: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> privatesForA = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">WeakMap</span></span>(); <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">A</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>() { privatesForA.set(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, {}); privatesForA.get(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>).priv = <span class="hljs-number"><span class="hljs-number">1</span></span>; } method() { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(privatesForA.get(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>).priv); } }</code> </pre> <br><blockquote>  Auf der Grundlage dieser Semantik hat eines der Komiteemitglieder übrigens sogar eine kleine <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Utility-Bibliothek erstellt</a> , mit der Sie den privaten Staat jetzt nutzen können, um zu zeigen, dass diese Funktionalität vom Komitee zu überbewertet wird.  Formatierter Code benötigt nur 27 Zeilen. </blockquote><p>  Im Allgemeinen ist alles ziemlich gut, wir werden <code>hard-private</code> , was in keiner Weise von externem Code abgerufen / abgefangen / verfolgt werden kann, und gleichzeitig können wir auf die privaten Felder einer anderen Instanz derselben Klasse zugreifen, zum Beispiel wie folgt: </p><br><pre> <code class="javascript hljs">isEquals(obj) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> privatesForA.get(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>).id === privatesForA.get(obj).id; }</code> </pre> <br><p>  Nun, dies ist sehr praktisch, mit der Ausnahme, dass diese Semantik neben der Kapselung selbst auch die <code>brand-checking</code> umfasst (Sie können nicht googeln, was es ist - es ist unwahrscheinlich, dass Sie relevante Informationen finden). <br>  <code>brand-checking</code> ist das Gegenteil von <code>duck-typing</code> in dem Sinne, dass nicht die öffentliche Schnittstelle des Objekts überprüft wird, sondern die Tatsache, dass das Objekt mit vertrauenswürdigem Code erstellt wurde. <br>  Eine solche Prüfung hat in der Tat einen gewissen Umfang - sie hängt hauptsächlich mit der Sicherheit zusammen, nicht vertrauenswürdigen Code in einem einzigen Adressraum mit einem vertrauenswürdigen aufzurufen, und mit der Fähigkeit, Objekte ohne Serialisierung direkt auszutauschen. </p><br><blockquote>  Obwohl einige Ingenieure dies als einen notwendigen Teil der ordnungsgemäßen Kapselung betrachten. </blockquote><p>  Trotz der Tatsache, dass dies nach meiner Erfahrung eine ziemlich merkwürdige Gelegenheit ist, die eng mit dem <code></code> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">kurze</a> und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">längere</a> Beschreibung), der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><code>Realms</code></a> und der wissenschaftlichen Arbeit auf dem Gebiet der Informatik zusammenhängt, mit der sich <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Mark Samuel Miller</a> beschäftigt (er ist auch Mitglied des Komitees) In der Praxis der meisten Entwickler tritt dies fast nie auf. </p><br><blockquote>  Übrigens bin ich immer noch auf eine Membran <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">gestoßen</a> (obwohl ich damals nicht wusste, was es war), als ich <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">vm2</a> neu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">geschrieben habe,</a> um meinen Anforderungen zu entsprechen. </blockquote><br><h3 id="problema-brand-checking">  Problem bei der <code>brand-checking</code> </h3><br><p>  Wie bereits erwähnt, ist die <code>brand-checking</code> das Gegenteil von <code>duck-typing</code> .  In der Praxis bedeutet dies, dass Sie diesen Code haben: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> brands = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">WeakMap</span></span>(); <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">A</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>() { brands.set(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, {}); } method() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>; } brandCheckedMethod() { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!brands.has(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-string"><span class="hljs-string">'Brand-check failed'</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.method()); } }</code> </pre> <br><p>  <code>brandCheckedMethod</code> kann nur mit einer Instanz der Klasse <code>A</code> aufgerufen werden. Selbst wenn das Ziel ein Objekt ist, das die Invarianten dieser Klasse <code>brandCheckedMethod</code> diese Methode eine Ausnahme aus: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> duckTypedObj = { <span class="hljs-attr"><span class="hljs-attr">method</span></span>: A.prototype.method.bind(duckTypedObj), <span class="hljs-attr"><span class="hljs-attr">brandCheckedMethod</span></span>: A.prototype.brandCheckedMethod.bind(duckTypedObj), }; duckTypedObj.method(); <span class="hljs-comment"><span class="hljs-comment">//        1 duckTypedObj.brandCheckedMethod(); //     </span></span></code> </pre> <br><p>  Offensichtlich ist dieses Beispiel ziemlich synthetisch und die Verwendung von <code>duckTypedObj</code> wie diesem <code>duckTypedObj</code> zweifelhaft, bis wir über <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><code>Proxy</code></a> nachdenken. <br>  Eines der sehr wichtigen Proxy-Nutzungsszenarien ist die Metaprogrammierung.  Damit der Proxy alle erforderlichen nützlichen Arbeiten ausführen kann, müssen die Methoden von Objekten, die mit einem Proxy verpackt werden, im Kontext des Proxys und nicht im Kontext des Ziels ausgeführt werden, d. H.: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> a = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> A(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> proxy = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Proxy</span></span>(a, { get(target, p, receiver) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> property = <span class="hljs-built_in"><span class="hljs-built_in">Reflect</span></span>.get(target, p, receiver); doSomethingUseful(<span class="hljs-string"><span class="hljs-string">'get'</span></span>, retval, target, p, receiver); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> property === <span class="hljs-string"><span class="hljs-string">'function'</span></span>) ? property.bind(proxy) : property; } });</code> </pre> <br><p>  Rufen Sie <code>proxy.method();</code>  führt nützliche Arbeit aus, die im Proxy deklariert ist, und gibt <code>1</code> , während <code>proxy.brandCheckedMethod();</code>  Anstatt zweimal nützliche Arbeit vom Proxy aus zu erledigen, wird eine Ausnahme <code>a !== proxy</code> , da <code>a !== proxy</code> , was bedeutet, dass die <code>brand-check</code> nicht bestanden wurde. </p><br><p>  Ja, wir können Methoden / Funktionen im Kontext eines realen Ziels ausführen, nicht eines Proxys. In einigen Szenarien reicht dies aus (z. B. um das <code></code> zu implementieren), dies reicht jedoch nicht in allen Fällen aus (z. B. um reaktive Eigenschaften zu implementieren: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">MobX 5 verwendet</a> bereits einen Proxy Aus diesem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Grund</a> experimentieren <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Vue.js</a> und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Aurelia</a> mit diesem Ansatz für zukünftige Versionen. </p><br><p>  Solange die <code>brand-check</code> explizit durchgeführt werden muss, ist dies im Allgemeinen kein Problem. Der Entwickler muss nur bewusst entscheiden, welchen Kompromiss er eingeht und ob er sie benötigt. Darüber hinaus können Sie sie bei einer expliziten <code>brand-check</code> so implementieren <code>brand-check</code> Sie sie implementieren können Der Fehler wird nicht auf vertrauenswürdige Proxys übertragen. </p><br><p>  Leider hat uns der aktuelle diese Flexibilität genommen: </p><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">A</span></span></span><span class="hljs-class"> </span></span>{ #priv; method() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.#priv; <span class="hljs-comment"><span class="hljs-comment">//    brand-check   } }</span></span></code> </pre> <br><p>  Eine solche <code>method</code> löst immer eine Ausnahme aus, wenn sie nicht im Kontext eines Objekts aufgerufen wird, das mit dem Konstruktor <code>A</code>  Und das Schlimmste ist, dass die <code>brand-check</code> hier implizit ist und mit einer anderen Funktionalität gemischt wird - der Kapselung. </p><br><p>  Während die <code></code> für jeden Code fast notwendig ist, hat die <code>brand-check</code> einen eher engen Umfang.  Die Kombination zu einer Syntax führt dazu, dass im Benutzercode viele unbeabsichtigte <code>brand-check</code> werden, wenn der Entwickler nur die Implementierungsdetails verbergen wollte. <br>  Und der Slogan, der verwendet wird, um dies zu fördern, war <code># is the new _</code> die Situation nur verschärft. </p><br><blockquote>  Sie können auch eine <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ausführliche Diskussion darüber</a> lesen, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">wie ein vorhandenes Prozal einen Proxy bricht</a> .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Einer der Aurelia-Entwickler</a> und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Autor Vue.js sprach in der Diskussion</a> . <br><br>  Auch <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">mein Kommentar</a> , der den Unterschied zwischen verschiedenen Proxy-Szenarien genauer beschreibt, mag für jemanden interessant erscheinen.  Insgesamt die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">gesamte Diskussion über die Verbindung von privaten Feldern und Membranen</a> . </blockquote><br><h1 id="alternativy">  Alternativen </h1><br><p>  All diese Diskussionen wären wenig sinnvoll, wenn es keine Alternativen gäbe.  Leider hat kein einziger Stellvertreter die <strong>Stufe 1</strong> erreicht und hatte daher nicht einmal die Chance, genug <strong>trainiert</strong> zu werden.  Ich werde hier jedoch Alternativen auflisten, die die oben beschriebenen Probleme irgendwie lösen. </p><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><strong>Symbol.private</strong></a> - ein alternatives prozazil eines der Komiteemitglieder. <br><ol><li>  Es löst alle oben genannten Probleme (obwohl es vielleicht seine eigenen hat, aber angesichts des Mangels an aktiver Arbeit daran ist es schwierig, sie zu finden) </li><li>  Bei der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">letzten Sitzung des Ausschusses wurde es</a> aufgrund des Fehlens eines integrierten <code>brand-check</code> , der Probleme mit dem Membranmuster (obwohl <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">dies</a> eine angemessene Lösung darstellt) und des Mangels an praktischer Syntax erneut zurückgeworfen </li><li>  Wie ich <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> gezeigt habe, kann eine praktische Syntax auf der tatsächlichen aufgebaut <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">werden</a> </li></ol></li><li>  <a href=""><strong>Klassen 1.1</strong></a> - früheres Posozal desselben Autors </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><strong><em>Private</em> als Objekt verwenden</strong></a> </li></ol><br><h1 id="vmesto-zaklyucheniya">  Anstelle einer Schlussfolgerung </h1><br><p>  Nach dem Ton des Artikels scheint es wahrscheinlich, dass ich das Komitee verurteile - das ist nicht so.  Es scheint mir nur, dass sich das Komitee im Laufe der Jahre (je nach Ausgangspunkt könnten es sogar Jahrzehnte sein) mit der Kapselung in JS befasst hat, viel in der Branche hat sich geändert, und das Aussehen könnte verschwommen sein, was zu einer falschen Rangfolge der Prioritäten geführt hat . </p><br><p>  Darüber hinaus <strong>drängen</strong> wir als Community auf <strong>tc39 und</strong> zwingen sie, Features schneller zu veröffentlichen, während wir in den frühen Stadien von prozos äußerst wenig Feedback geben, was unsere Empörung nur zu einem Zeitpunkt verringert, an dem wenig geändert werden kann. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Es wird angenommen,</a> dass in diesem Fall der Prozess einfach fehlgeschlagen ist. </p><br><p>  Nachdem ich es mir in den Kopf gesetzt und mit einigen Vertretern gesprochen hatte, beschloss ich, mein Bestes zu geben, um ein Wiederauftreten einer ähnlichen Situation zu verhindern - aber ich kann ein wenig tun (einen Übersichtsartikel schreiben, die Implementierung von <code>stage1</code> fehlte in <code>babel</code> und das ist alles). </p><br><p>  Das Wichtigste ist jedoch das Feedback. Ich möchte Sie daher bitten, an dieser kleinen Umfrage teilzunehmen.  Und ich werde wiederum versuchen, es dem Ausschuss zu übermitteln. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de428119/">https://habr.com/ru/post/de428119/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de428109/index.html">Unternehmenswand</a></li>
<li><a href="../de428111/index.html">Arithmetik beliebiger Genauigkeit in Erlang</a></li>
<li><a href="../de428113/index.html">Auf die Frage nach Bezier-Kurven, Arduino-Geschwindigkeit und einem interessanten Ort oder wie ich das Wochenende verbracht habe</a></li>
<li><a href="../de428115/index.html">Webentwicklung für E-Commerce: 5 Technologietrends für 2019</a></li>
<li><a href="../de428117/index.html">Kostenlose Tensorprozessoren von Google in der Colaboratory Cloud</a></li>
<li><a href="../de428121/index.html">Stan Drapkin. Hochrangige Kryptografiefallen in .NET</a></li>
<li><a href="../de428123/index.html">Sicherheitswoche 41: Gute Nachrichten</a></li>
<li><a href="../de428125/index.html">Wer sind Produktanalysen und warum werden sie in einem Team benötigt?</a></li>
<li><a href="../de428127/index.html">Nginx-Cache: alles neu - gut vergessen alt</a></li>
<li><a href="../de428129/index.html">Einfache Fuzzy-Logik „für das, was für ein Gasturbinentriebwerk war“</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>