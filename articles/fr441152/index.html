<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üìñ üë∂üèº ‚úäüèæ Comment minimiser les erreurs lors de l'int√©gration avec des services externes: l'exp√©rience d'un courtier en ligne üèÅ üå©Ô∏è üçí</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pendant un an et demi, nous avons int√©gr√© l'API √† vingt services externes. Les cinq premi√®res int√©grations ont travers√© des douleurs et des larmes - n...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comment minimiser les erreurs lors de l'int√©gration avec des services externes: l'exp√©rience d'un courtier en ligne</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/441152/">  Pendant un an et demi, nous avons int√©gr√© l'API √† vingt services externes.  Les cinq premi√®res int√©grations ont travers√© des douleurs et des larmes - nous avons fait toutes les erreurs possibles.  Ils ont r√©√©crit le code plusieurs fois, se sont s√©par√©s avec des partenaires juste avant la sortie, car ils ne pouvaient pas s'entendre sur les am√©liorations.  Perdu temps et argent. <br><br>  Mais √† chaque nouvelle int√©gration, nous avons trouv√© des solutions aux probl√®mes r√©currents.  En cons√©quence, nous avons effectu√© la derni√®re int√©gration quatre fois plus rapidement que la premi√®re.  Ce que nous faisons maintenant diff√©remment - lire l'article. <br><a name="habracut"></a><br>  Afin de mieux comprendre les sp√©cificit√©s de nos int√©grations, nous d√©crirons bri√®vement ce que nous faisons.  Nous d√©veloppons un courtier en ligne.  Principe de travail: l'internaute se rend sur le site, remplit le questionnaire, nous le transmettons √† des organisations de microfinance (IMF) et recevons de leur part un agr√©ment ou un refus de pr√™t.  L'utilisateur s√©lectionne une offre appropri√©e et re√ßoit de l'argent.  Pour que cela fonctionne en ligne, nous nous int√©grons aux IMF via l'API. <br><br><h2>  √âvaluer la pr√©paration des partenaires √† l'int√©gration √† l'aide d'une liste de contr√¥le et de sp√©cifications </h2><br>  Nous analyserons deux sc√©narios: lorsqu'un partenaire potentiel dispose d√©j√† d'une API pour accepter des candidatures, et quand ce n'est pas le cas.  Les deux sc√©narios sugg√®rent que le partenaire souhaite s'int√©grer avec nous et est pr√™t √† y consacrer du temps. <br><br><h3>  Le partenaire n'a pas d'API - nous envoyons la sp√©cification </h3><br>  <b>Auparavant,</b> nous avons expliqu√© au partenaire, verbalement ou par correspondance, ce dont nous avions besoin pour l'int√©gration, et le partenaire, sur la base de ces explications, a cr√©√© une API pour accepter les applications avec Finspin.  Nous ne nous sommes pas mis d'accord sur les exigences pour les mod√®les, les objets, les champs du questionnaire et les r√®gles de leur validation.  D√©crit rapidement l'objectif des m√©thodes et les r√©ponses possibles.  Le r√©sultat s'est av√©r√© √™tre infiniment loin de ce qui √©tait attendu, car notre compr√©hension de l'API √©tait tr√®s diff√©rente de celle du partenariat.  J'ai d√ª tout refaire. <br><br>  <b>Maintenant</b> .  Nous avons √©crit notre sp√©cification - un fichier YAML qui peut √™tre ouvert dans Swagger.  Dans la sp√©cification, nous avons d√©crit l'API la plus appropri√©e pour int√©grer Finspin aux IMF: champs de questionnaire et r√®gles pour leur validation, formats et types de demandes avec r√©ponses, noms de m√©thode, erreurs et statuts possibles.  Nous avons enregistr√© l'√©tat de la demande que nous pr√©voyons de recevoir, par exemple: ¬´accept√© pour traitement¬ª, ¬´notation en cours¬ª, ¬´pr√™t refus√©¬ª, ¬´approbation¬ª, etc. <br><br>  Nous envoyons la sp√©cification au partenaire, et il d√©cide s'il peut fournir une telle API.  Si ce n'est pas le cas, note des points probl√©matiques dans la sp√©cification, par exemple, tous les √©tats de l'application ne sont pas pr√™ts √† √™tre transf√©r√©s vers l'API ou il n'y a pas suffisamment de champs dans le questionnaire.  Et nous discutons d√©j√† de points sp√©cifiques, pas d'entit√©s abstraites.  Le partenaire ne perd pas de temps √† r√©diger sa documentation, mais ajuste la n√¥tre. <br><br>  Nous avons pass√© deux jours √† cr√©er la sp√©cification, mais nous √©conomisons maintenant des dizaines d'heures sur les approbations et les am√©liorations de l'API.  De plus, √† l'aide des sp√©cifications, nous filtrons rapidement les partenaires qui ne sont pas pr√™ts pour l'int√©gration.  Au tout d√©but, il devient clair que nos processus de traitement des demandes en ligne sont tr√®s diff√©rents: il n'est pas rentable de les int√©grer. <br><br><h3>  Le partenaire dispose d'une API - parcourez la liste de contr√¥le </h3><br>  Nous avions l' <b>habitude</b> d'obtenir les sp√©cifications d'un partenaire et de poser des questions en d√©placement.  Souvent, ils ont oubli√© de clarifier quelque chose d'important, puis cet important est apparu aux √©tapes finales du d√©veloppement et des tests, quand il est devenu particuli√®rement co√ªteux de corriger et de r√©√©crire.  D'une mani√®re ou d'une autre, √† la fin de l'int√©gration avec un partenaire, il s'est av√©r√© qu'il transf√®rerait le statut des pr√™ts via l'API avec un retard de plusieurs jours.  Pour nous, c'est inacceptable.  Le partenariat a d√ª √™tre abandonn√©. <br><br>  <b>Maintenant</b> .  Nous avons r√©dig√© une liste de contr√¥le pour √©valuer l'API et les processus qu'elle sert.  La liste de contr√¥le rassemblait des questions auxquelles il fallait r√©pondre.  Tout d'abord, notre responsable recherche des r√©ponses dans le cahier des charges.  S'il n'est pas trouv√©, adresse des questions au partenaire. <br><br>  La liste de contr√¥le vous aide √† trouver les goulots d'√©tranglement avant de commencer le d√©veloppement, et non apr√®s - lorsque vous devez modifier le code et que les clients souffrent d'un mauvais service. <br><br>  Nous remplissons constamment la liste de contr√¥le lorsque nous sommes confront√©s √† de nouvelles situations.  Plus la liste de contr√¥le est d√©taill√©e, plus le risque d'erreurs de d√©veloppement est faible. <br><br><img src="https://habrastorage.org/webt/sa/u7/m4/sau7m4kwc3-mzhxwaq37w1pu1pm.png" width="600"><br>  <i>Fragment de liste de contr√¥le API</i> <br><br><h2>  Glossaire des termes </h2><br>  <b>Auparavant,</b> il nous semblait que dans le domaine du pr√™t en ligne, tout le monde comprend les termes professionnels de la m√™me mani√®re, il ne peut y avoir de divergence.  La pratique a montr√© que nous avions tort. <br><br>  Par exemple, avec une IMF, nous avons interpr√©t√© diff√©remment les clients principaux et les clients r√©currents.  Pour nous, le client principal est le client dont le profil est entr√© pour la premi√®re fois dans la base de donn√©es MFI via Finspin, et le client r√©current √©tait d√©j√† dans la base de donn√©es.  Le partenaire consid√©rait les clients fid√®les par le nombre de pr√™ts accord√©s: les r√©p√©titions ont re√ßu deux pr√™ts et sont venus pour un troisi√®me.  Une telle confusion terminologique pourrait entra√Æner des incoh√©rences dans les rapprochements financiers. <br><br>  Nous utilisons <b>maintenant</b> un petit glossaire de termes par lequel nous v√©rifions avec nos partenaires.  En r√®gle g√©n√©rale, il suffit de clarifier cinq ou six termes de base afin de synchroniser les id√©es d'int√©gration et d'√©valuer les perspectives de collaboration. <br><br>  Une fois qu'un glossaire nous a permis d'√©viter une int√©gration d√©savantageuse.  Notre interpr√©tation de ¬´l'approbation¬ª √©tait tr√®s diff√©rente de celle de l'affili√©.  L‚Äôapprobation du partenaire comprenait de nombreux aspects diff√©rents qui n√©cessitaient un traitement manuel.  Nous visons une automatisation maximale, nous avons donc imm√©diatement refus√© de coop√©rer. <br><br><img src="https://habrastorage.org/webt/zf/8s/8i/zf8s8i52-w3mfjcqncaxcelxlpq.png" width="800"><br>  <i>Clarifier le terme ¬´approbation¬ª</i> <br><br><h2>  Premi√®re entreprise, puis d√©veloppement </h2><br>  <b>Il y avait des</b> cas o√π nous avons commenc√© √† travailler avec un partenaire potentiel avec une sp√©cification.  Notre responsable a re√ßu les sp√©cifications, les a √©tudi√©es attentivement, a pr√©cis√© les d√©tails de l'int√©gration avec le partenaire, discut√© des probl√®mes litigieux avec les d√©veloppeurs.  Et puis un message est venu des dirigeants: "Fin, l'int√©gration est annul√©e, nous ne nous sommes pas mis d'accord sur les conditions".  Les employ√©s ont perdu du temps. <br><br><img src="https://habrastorage.org/webt/1p/at/bg/1patbgwgpcliihybxvmuvj1-uo0.png" width="800"><br>  <i>Lorsque vous changez d'avis et que le travail est termin√©</i> <br><br>  <b>Maintenant,</b> la r√®gle de fer <b>est en</b> vigueur: le gestionnaire commence √† √©tudier le cahier des charges uniquement lorsqu'il re√ßoit une d√©cision claire de l'int√©gration de la part de la direction. <br><br><h2>  Pr√©paration √† l'int√©gration: URL, d√©tails, environnement </h2><br>  <b>Auparavant, le</b> premier appel √† l'API partenaire s'est produit lors des tests de notre application, √† partir des serveurs de d√©veloppement.  Souvent, les premi√®res demandes ont re√ßu des erreurs lors de la configuration de la connexion: impossible de se connecter au serveur ou simplement un d√©lai d'attente.  Raisons les plus populaires: <br><br><ul><li>  Noms de m√©thode incorrects (scell√©s ou confus) </li><li>  Domaine invalide </li><li>  d√©tails de connexion erron√©s, </li><li>  Nous n'avons pas ajout√© l'IP de nos serveurs √† la liste blanche. </li></ul><br>  Il a fallu des heures pour corriger ces erreurs mineures, car elles se sont succ√©d√©: jusqu'√† ce que vous en corrigiez une, vous ne verrez pas la suivante. <br><br>  <b>Maintenant</b> , avant d'int√©grer la t√¢che dans le plan de d√©veloppement, nous clarifions toutes les fonctionnalit√©s d'acc√®s √† l'API avec une petite liste de contr√¥le.  La liste de contr√¥le r√©pertorie les points √† clarifier, par exemple: <br><br><ul><li>  restrictions sur la charge du service, </li><li>  le nombre de demandes par unit√© de temps </li><li>  d√©tails de connexion </li><li>  liste blanche par adresses IP, </li><li>  Validation du certificat SSL </li><li>  exigences de chiffrement du trafic, </li><li>  en-t√™tes sp√©ciaux dans les demandes </li><li>  la pr√©sence d'un serveur de test avec API ou la possibilit√© d'envoyer des requ√™tes de test au serveur de combat </li></ul><br>  S'il existe une API de test, nous d√©couvrirons certainement quelle est la diff√©rence lors de l'acc√®s au serveur de combat et au serveur de test.  Nous prenons en compte les diff√©rences lors de la cr√©ation de demandes depuis notre application vers des partenaires dans des environnements de d√©veloppement et de production.  Ces mesures nous aident √† comprendre si les syst√®mes sont pr√™ts pour nos besoins ou si des ajustements suppl√©mentaires sont n√©cessaires. <br><br><img src="https://habrastorage.org/webt/bw/jz/f1/bwjzf19losfdd62xwajd3ww6ris.png" width="800"><br><br><h2>  Envoi manuel de demandes √† l'API </h2><br>  <b>Avant,</b> nous √©crivions imm√©diatement le code selon les sp√©cifications du partenaire, r√©digions les sp√©cifications, r√©visions, testions.  Et au stade des tests d'int√©gration, il s'est av√©r√© que tout ce qui est √©crit dans le cahier des charges ne correspond pas √† la r√©alit√© - √† partir du format des requ√™tes, pour finir avec le processus de r√©ussite de l'application. <br><br>  Par exemple, selon la sp√©cification, lorsque nous acc√©dons √† une certaine m√©thode, nous attendons une r√©ponse dans un certain format dans la r√©ponse, suspendons le traitement pour la validit√© de la r√©ponse re√ßue, passons aux tests et tout √† coup, nous obtenons un tableau dans la r√©ponse.  Nous d√©couvrons les raisons aupr√®s des d√©veloppeurs du partenaire.  Ils font r√©f√©rence √† une documentation obsol√®te.  Encore une fois, un cercle d'am√©liorations, d'examens et de tests. <br><br>  <b>D√©sormais</b> , d√®s que nous recevons la documentation et les d√©tails de connexion, nous ex√©cutons le processus via le client API.  En r√®gle g√©n√©rale, le testeur t√©l√©charge la sp√©cification sur Postman et simule le processus commercial complet d'envoi d'une demande de pr√™t, v√©rifie les cas les plus courants avec diff√©rents ensembles de donn√©es pour la demande.  Autrement dit, fait manuellement ce que l'application fera ensuite. <br><br>  Au stade d'une ex√©cution manuelle, 80% des inexactitudes dans la documentation sont r√©v√©l√©es.  Nous d√©crivons les erreurs et les transmettons au partenaire.  Le partenaire √©limine les inexactitudes √† la maison ou finalise la sp√©cification.  Par cons√©quent, au moment o√π le travail sur le code commence, les d√©veloppeurs re√ßoivent une documentation de travail. <br><br>  √âcarts les plus courants: <br><br><ul><li>  format de demande incorrect, promesse d'accepter json, il s'est av√©r√© avoir besoin de donn√©es de formulaire; </li><li>  Erreurs dans les noms des champs √† transmettre dans la demande; </li><li>  erreurs dans les formats de champ; </li><li>  les r√®gles de validation des champs ne sont pas sp√©cifi√©es ou sont indiqu√©es de mani√®re incorrecte; </li><li>  certains domaines peuvent √™tre compl√®tement oubli√©s; </li><li>  manquant ou diff√©rent de la description r√©elle du format de r√©ponse de la m√©thode; </li><li>  marques erron√©es sur les champs obligatoires - des ¬´ast√©risques¬ª peuvent appara√Ætre l√† o√π le champ n'est pas obligatoire en fait, et vice versa; </li><li>  souvent pas document√© tous les √©tats et statuts dans lesquels l'objet peut √™tre; </li><li>  des √©carts entre les √©tats attendu et re√ßu des objets.  Par exemple, √† un moment donn√©, nous nous attendons √† ce que l'application soit dans l'√©tat X - et par l'API, en fait, nous obtenons Y. </li></ul><br><h2>  Recette du bonheur: √©viter les erreurs d'int√©gration d'API </h2><br>  √âcrivez une sp√©cification pour l'int√©gration avec votre service.  Nous avons pass√© deux jours √† d√©velopper la sp√©cification en YAML, mais nous √©conomisons maintenant des dizaines d'heures sur les am√©liorations et les approbations. <br><br>  Si le partenaire envoie sa sp√©cification, v√©rifiez-la sur la liste de contr√¥le.  Dans la liste de contr√¥le, recueillez les questions auxquelles vous devez r√©pondre.  Ne comptez pas sur l'exp√©rience et la m√©moire, manquez toujours quelque chose. <br><br>  Ayez un glossaire pour √©viter toute confusion avec votre partenaire.  Notre exp√©rience a montr√© que les diff√©rences peuvent m√™me √™tre en termes √©vidents. <br><br>  Ne prenez pas la t√¢che en d√©veloppement avant d'avoir re√ßu l'approbation de principe de la direction de l'int√©gration avec un partenaire.  L'id√©e est √©vidente, mais elle nous aide √† √©viter les travaux inutiles. <br><br>  Ouvrez une liste de contr√¥le pour clarifier les d√©tails de l'acc√®s √† l'API du partenaire: d√©tails de connexion, liste blanche, validation du certificat SSL, exigences de chiffrement du trafic, etc. Consultez la liste de contr√¥le d√®s que possible pour √©viter tout glissement aux √©tapes finales. <br><br>  Vous avez une sp√©cification - ne vous pr√©cipitez pas pour √©crire du code imm√©diatement.  Tout d'abord, ex√©cutez manuellement le processus via un client API, par exemple, via Postman.  Vous trouverez donc des erreurs dans la sp√©cification √† un stade pr√©coce et avec de petites ressources.  Et ils le seront. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr441152/">https://habr.com/ru/post/fr441152/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr441140/index.html">D√©veloppement WebAssembly: v√©ritable r√¢teau et exemples</a></li>
<li><a href="../fr441142/index.html">12 points de croissance de conversion, ou du contenu qui se vend vraiment</a></li>
<li><a href="../fr441146/index.html">R√©seaux sans fil industriels: lequel choisir?</a></li>
<li><a href="../fr441148/index.html">Comment g√©rer correctement les erreurs: le silence n'est pas toujours bon</a></li>
<li><a href="../fr441150/index.html">Premi√®re introduction au protocole HTTP en √©crivant le serveur Web Java le plus simple</a></li>
<li><a href="../fr441154/index.html">Onze perles cach√©es de Java 11</a></li>
<li><a href="../fr441158/index.html">Comment l'√©thique est devenue le probl√®me le plus cher de la Silicon Valley et la philosophie est devenue sa solution la plus pratique</a></li>
<li><a href="../fr441160/index.html">Comment apprendre √† savoir quand dire non</a></li>
<li><a href="../fr441166/index.html">Nous obtenons le mot de passe principal du gestionnaire de mots de passe verrouill√© 1 Mot de passe 4</a></li>
<li><a href="../fr441168/index.html">QUIC DataChannels: premi√®res √©tapes</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>