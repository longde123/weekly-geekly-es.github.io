<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>📖 👶🏼 ✊🏾 Comment minimiser les erreurs lors de l'intégration avec des services externes: l'expérience d'un courtier en ligne 🏁 🌩️ 🍒</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pendant un an et demi, nous avons intégré l'API à vingt services externes. Les cinq premières intégrations ont traversé des douleurs et des larmes - n...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comment minimiser les erreurs lors de l'intégration avec des services externes: l'expérience d'un courtier en ligne</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/441152/">  Pendant un an et demi, nous avons intégré l'API à vingt services externes.  Les cinq premières intégrations ont traversé des douleurs et des larmes - nous avons fait toutes les erreurs possibles.  Ils ont réécrit le code plusieurs fois, se sont séparés avec des partenaires juste avant la sortie, car ils ne pouvaient pas s'entendre sur les améliorations.  Perdu temps et argent. <br><br>  Mais à chaque nouvelle intégration, nous avons trouvé des solutions aux problèmes récurrents.  En conséquence, nous avons effectué la dernière intégration quatre fois plus rapidement que la première.  Ce que nous faisons maintenant différemment - lire l'article. <br><a name="habracut"></a><br>  Afin de mieux comprendre les spécificités de nos intégrations, nous décrirons brièvement ce que nous faisons.  Nous développons un courtier en ligne.  Principe de travail: l'internaute se rend sur le site, remplit le questionnaire, nous le transmettons à des organisations de microfinance (IMF) et recevons de leur part un agrément ou un refus de prêt.  L'utilisateur sélectionne une offre appropriée et reçoit de l'argent.  Pour que cela fonctionne en ligne, nous nous intégrons aux IMF via l'API. <br><br><h2>  Évaluer la préparation des partenaires à l'intégration à l'aide d'une liste de contrôle et de spécifications </h2><br>  Nous analyserons deux scénarios: lorsqu'un partenaire potentiel dispose déjà d'une API pour accepter des candidatures, et quand ce n'est pas le cas.  Les deux scénarios suggèrent que le partenaire souhaite s'intégrer avec nous et est prêt à y consacrer du temps. <br><br><h3>  Le partenaire n'a pas d'API - nous envoyons la spécification </h3><br>  <b>Auparavant,</b> nous avons expliqué au partenaire, verbalement ou par correspondance, ce dont nous avions besoin pour l'intégration, et le partenaire, sur la base de ces explications, a créé une API pour accepter les applications avec Finspin.  Nous ne nous sommes pas mis d'accord sur les exigences pour les modèles, les objets, les champs du questionnaire et les règles de leur validation.  Décrit rapidement l'objectif des méthodes et les réponses possibles.  Le résultat s'est avéré être infiniment loin de ce qui était attendu, car notre compréhension de l'API était très différente de celle du partenariat.  J'ai dû tout refaire. <br><br>  <b>Maintenant</b> .  Nous avons écrit notre spécification - un fichier YAML qui peut être ouvert dans Swagger.  Dans la spécification, nous avons décrit l'API la plus appropriée pour intégrer Finspin aux IMF: champs de questionnaire et règles pour leur validation, formats et types de demandes avec réponses, noms de méthode, erreurs et statuts possibles.  Nous avons enregistré l'état de la demande que nous prévoyons de recevoir, par exemple: «accepté pour traitement», «notation en cours», «prêt refusé», «approbation», etc. <br><br>  Nous envoyons la spécification au partenaire, et il décide s'il peut fournir une telle API.  Si ce n'est pas le cas, note des points problématiques dans la spécification, par exemple, tous les états de l'application ne sont pas prêts à être transférés vers l'API ou il n'y a pas suffisamment de champs dans le questionnaire.  Et nous discutons déjà de points spécifiques, pas d'entités abstraites.  Le partenaire ne perd pas de temps à rédiger sa documentation, mais ajuste la nôtre. <br><br>  Nous avons passé deux jours à créer la spécification, mais nous économisons maintenant des dizaines d'heures sur les approbations et les améliorations de l'API.  De plus, à l'aide des spécifications, nous filtrons rapidement les partenaires qui ne sont pas prêts pour l'intégration.  Au tout début, il devient clair que nos processus de traitement des demandes en ligne sont très différents: il n'est pas rentable de les intégrer. <br><br><h3>  Le partenaire dispose d'une API - parcourez la liste de contrôle </h3><br>  Nous avions l' <b>habitude</b> d'obtenir les spécifications d'un partenaire et de poser des questions en déplacement.  Souvent, ils ont oublié de clarifier quelque chose d'important, puis cet important est apparu aux étapes finales du développement et des tests, quand il est devenu particulièrement coûteux de corriger et de réécrire.  D'une manière ou d'une autre, à la fin de l'intégration avec un partenaire, il s'est avéré qu'il transfèrerait le statut des prêts via l'API avec un retard de plusieurs jours.  Pour nous, c'est inacceptable.  Le partenariat a dû être abandonné. <br><br>  <b>Maintenant</b> .  Nous avons rédigé une liste de contrôle pour évaluer l'API et les processus qu'elle sert.  La liste de contrôle rassemblait des questions auxquelles il fallait répondre.  Tout d'abord, notre responsable recherche des réponses dans le cahier des charges.  S'il n'est pas trouvé, adresse des questions au partenaire. <br><br>  La liste de contrôle vous aide à trouver les goulots d'étranglement avant de commencer le développement, et non après - lorsque vous devez modifier le code et que les clients souffrent d'un mauvais service. <br><br>  Nous remplissons constamment la liste de contrôle lorsque nous sommes confrontés à de nouvelles situations.  Plus la liste de contrôle est détaillée, plus le risque d'erreurs de développement est faible. <br><br><img src="https://habrastorage.org/webt/sa/u7/m4/sau7m4kwc3-mzhxwaq37w1pu1pm.png" width="600"><br>  <i>Fragment de liste de contrôle API</i> <br><br><h2>  Glossaire des termes </h2><br>  <b>Auparavant,</b> il nous semblait que dans le domaine du prêt en ligne, tout le monde comprend les termes professionnels de la même manière, il ne peut y avoir de divergence.  La pratique a montré que nous avions tort. <br><br>  Par exemple, avec une IMF, nous avons interprété différemment les clients principaux et les clients récurrents.  Pour nous, le client principal est le client dont le profil est entré pour la première fois dans la base de données MFI via Finspin, et le client récurrent était déjà dans la base de données.  Le partenaire considérait les clients fidèles par le nombre de prêts accordés: les répétitions ont reçu deux prêts et sont venus pour un troisième.  Une telle confusion terminologique pourrait entraîner des incohérences dans les rapprochements financiers. <br><br>  Nous utilisons <b>maintenant</b> un petit glossaire de termes par lequel nous vérifions avec nos partenaires.  En règle générale, il suffit de clarifier cinq ou six termes de base afin de synchroniser les idées d'intégration et d'évaluer les perspectives de collaboration. <br><br>  Une fois qu'un glossaire nous a permis d'éviter une intégration désavantageuse.  Notre interprétation de «l'approbation» était très différente de celle de l'affilié.  L’approbation du partenaire comprenait de nombreux aspects différents qui nécessitaient un traitement manuel.  Nous visons une automatisation maximale, nous avons donc immédiatement refusé de coopérer. <br><br><img src="https://habrastorage.org/webt/zf/8s/8i/zf8s8i52-w3mfjcqncaxcelxlpq.png" width="800"><br>  <i>Clarifier le terme «approbation»</i> <br><br><h2>  Première entreprise, puis développement </h2><br>  <b>Il y avait des</b> cas où nous avons commencé à travailler avec un partenaire potentiel avec une spécification.  Notre responsable a reçu les spécifications, les a étudiées attentivement, a précisé les détails de l'intégration avec le partenaire, discuté des problèmes litigieux avec les développeurs.  Et puis un message est venu des dirigeants: "Fin, l'intégration est annulée, nous ne nous sommes pas mis d'accord sur les conditions".  Les employés ont perdu du temps. <br><br><img src="https://habrastorage.org/webt/1p/at/bg/1patbgwgpcliihybxvmuvj1-uo0.png" width="800"><br>  <i>Lorsque vous changez d'avis et que le travail est terminé</i> <br><br>  <b>Maintenant,</b> la règle de fer <b>est en</b> vigueur: le gestionnaire commence à étudier le cahier des charges uniquement lorsqu'il reçoit une décision claire de l'intégration de la part de la direction. <br><br><h2>  Préparation à l'intégration: URL, détails, environnement </h2><br>  <b>Auparavant, le</b> premier appel à l'API partenaire s'est produit lors des tests de notre application, à partir des serveurs de développement.  Souvent, les premières demandes ont reçu des erreurs lors de la configuration de la connexion: impossible de se connecter au serveur ou simplement un délai d'attente.  Raisons les plus populaires: <br><br><ul><li>  Noms de méthode incorrects (scellés ou confus) </li><li>  Domaine invalide </li><li>  détails de connexion erronés, </li><li>  Nous n'avons pas ajouté l'IP de nos serveurs à la liste blanche. </li></ul><br>  Il a fallu des heures pour corriger ces erreurs mineures, car elles se sont succédé: jusqu'à ce que vous en corrigiez une, vous ne verrez pas la suivante. <br><br>  <b>Maintenant</b> , avant d'intégrer la tâche dans le plan de développement, nous clarifions toutes les fonctionnalités d'accès à l'API avec une petite liste de contrôle.  La liste de contrôle répertorie les points à clarifier, par exemple: <br><br><ul><li>  restrictions sur la charge du service, </li><li>  le nombre de demandes par unité de temps </li><li>  détails de connexion </li><li>  liste blanche par adresses IP, </li><li>  Validation du certificat SSL </li><li>  exigences de chiffrement du trafic, </li><li>  en-têtes spéciaux dans les demandes </li><li>  la présence d'un serveur de test avec API ou la possibilité d'envoyer des requêtes de test au serveur de combat </li></ul><br>  S'il existe une API de test, nous découvrirons certainement quelle est la différence lors de l'accès au serveur de combat et au serveur de test.  Nous prenons en compte les différences lors de la création de demandes depuis notre application vers des partenaires dans des environnements de développement et de production.  Ces mesures nous aident à comprendre si les systèmes sont prêts pour nos besoins ou si des ajustements supplémentaires sont nécessaires. <br><br><img src="https://habrastorage.org/webt/bw/jz/f1/bwjzf19losfdd62xwajd3ww6ris.png" width="800"><br><br><h2>  Envoi manuel de demandes à l'API </h2><br>  <b>Avant,</b> nous écrivions immédiatement le code selon les spécifications du partenaire, rédigions les spécifications, révisions, testions.  Et au stade des tests d'intégration, il s'est avéré que tout ce qui est écrit dans le cahier des charges ne correspond pas à la réalité - à partir du format des requêtes, pour finir avec le processus de réussite de l'application. <br><br>  Par exemple, selon la spécification, lorsque nous accédons à une certaine méthode, nous attendons une réponse dans un certain format dans la réponse, suspendons le traitement pour la validité de la réponse reçue, passons aux tests et tout à coup, nous obtenons un tableau dans la réponse.  Nous découvrons les raisons auprès des développeurs du partenaire.  Ils font référence à une documentation obsolète.  Encore une fois, un cercle d'améliorations, d'examens et de tests. <br><br>  <b>Désormais</b> , dès que nous recevons la documentation et les détails de connexion, nous exécutons le processus via le client API.  En règle générale, le testeur télécharge la spécification sur Postman et simule le processus commercial complet d'envoi d'une demande de prêt, vérifie les cas les plus courants avec différents ensembles de données pour la demande.  Autrement dit, fait manuellement ce que l'application fera ensuite. <br><br>  Au stade d'une exécution manuelle, 80% des inexactitudes dans la documentation sont révélées.  Nous décrivons les erreurs et les transmettons au partenaire.  Le partenaire élimine les inexactitudes à la maison ou finalise la spécification.  Par conséquent, au moment où le travail sur le code commence, les développeurs reçoivent une documentation de travail. <br><br>  Écarts les plus courants: <br><br><ul><li>  format de demande incorrect, promesse d'accepter json, il s'est avéré avoir besoin de données de formulaire; </li><li>  Erreurs dans les noms des champs à transmettre dans la demande; </li><li>  erreurs dans les formats de champ; </li><li>  les règles de validation des champs ne sont pas spécifiées ou sont indiquées de manière incorrecte; </li><li>  certains domaines peuvent être complètement oubliés; </li><li>  manquant ou différent de la description réelle du format de réponse de la méthode; </li><li>  marques erronées sur les champs obligatoires - des «astérisques» peuvent apparaître là où le champ n'est pas obligatoire en fait, et vice versa; </li><li>  souvent pas documenté tous les états et statuts dans lesquels l'objet peut être; </li><li>  des écarts entre les états attendu et reçu des objets.  Par exemple, à un moment donné, nous nous attendons à ce que l'application soit dans l'état X - et par l'API, en fait, nous obtenons Y. </li></ul><br><h2>  Recette du bonheur: éviter les erreurs d'intégration d'API </h2><br>  Écrivez une spécification pour l'intégration avec votre service.  Nous avons passé deux jours à développer la spécification en YAML, mais nous économisons maintenant des dizaines d'heures sur les améliorations et les approbations. <br><br>  Si le partenaire envoie sa spécification, vérifiez-la sur la liste de contrôle.  Dans la liste de contrôle, recueillez les questions auxquelles vous devez répondre.  Ne comptez pas sur l'expérience et la mémoire, manquez toujours quelque chose. <br><br>  Ayez un glossaire pour éviter toute confusion avec votre partenaire.  Notre expérience a montré que les différences peuvent même être en termes évidents. <br><br>  Ne prenez pas la tâche en développement avant d'avoir reçu l'approbation de principe de la direction de l'intégration avec un partenaire.  L'idée est évidente, mais elle nous aide à éviter les travaux inutiles. <br><br>  Ouvrez une liste de contrôle pour clarifier les détails de l'accès à l'API du partenaire: détails de connexion, liste blanche, validation du certificat SSL, exigences de chiffrement du trafic, etc. Consultez la liste de contrôle dès que possible pour éviter tout glissement aux étapes finales. <br><br>  Vous avez une spécification - ne vous précipitez pas pour écrire du code immédiatement.  Tout d'abord, exécutez manuellement le processus via un client API, par exemple, via Postman.  Vous trouverez donc des erreurs dans la spécification à un stade précoce et avec de petites ressources.  Et ils le seront. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr441152/">https://habr.com/ru/post/fr441152/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr441140/index.html">Développement WebAssembly: véritable râteau et exemples</a></li>
<li><a href="../fr441142/index.html">12 points de croissance de conversion, ou du contenu qui se vend vraiment</a></li>
<li><a href="../fr441146/index.html">Réseaux sans fil industriels: lequel choisir?</a></li>
<li><a href="../fr441148/index.html">Comment gérer correctement les erreurs: le silence n'est pas toujours bon</a></li>
<li><a href="../fr441150/index.html">Première introduction au protocole HTTP en écrivant le serveur Web Java le plus simple</a></li>
<li><a href="../fr441154/index.html">Onze perles cachées de Java 11</a></li>
<li><a href="../fr441158/index.html">Comment l'éthique est devenue le problème le plus cher de la Silicon Valley et la philosophie est devenue sa solution la plus pratique</a></li>
<li><a href="../fr441160/index.html">Comment apprendre à savoir quand dire non</a></li>
<li><a href="../fr441166/index.html">Nous obtenons le mot de passe principal du gestionnaire de mots de passe verrouillé 1 Mot de passe 4</a></li>
<li><a href="../fr441168/index.html">QUIC DataChannels: premières étapes</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>