<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧑🏽 👂🏽 📝 La tarea de N cuerpos o cómo volar una galaxia sin salir de la cocina 🎨 ☄️ 🕠</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="No hace mucho leí la novela de ciencia ficción "El problema de los tres cuerpos" de Liu Qixin . En él, algunos extraterrestres tenían un problema: no ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>La tarea de N cuerpos o cómo volar una galaxia sin salir de la cocina</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/437014/"><br><img src="https://habrastorage.org/webt/ke/eo/en/keeoenv3rtuxqu19szhk5hzfb7q.png"><br><br>  No hace mucho leí la novela de ciencia ficción <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">"El problema de los tres cuerpos" de Liu Qixin</a> .  En él, algunos extraterrestres tenían un problema: no sabían cómo, con suficiente precisión para ellos, calcular la trayectoria de su planeta de origen.  A diferencia de nosotros, vivían en un sistema de tres estrellas, y el "clima" del planeta dependía en gran medida de su disposición mutua, desde el calor incinerador hasta el frío helado.  Y decidí verificar si podemos resolver tales problemas. <br><a name="habracut"></a><br><h2>  Física del fenómeno. </h2><br>  Para comprender el problema, es necesario tratar con la física del fenómeno.  En el marco de la teoría clásica, la fuerza de atracción de dos cuerpos está determinada por <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">la</a> ley <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">de Newton</a> : <br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-1"><span class="MJXp-mtext" id="MJXp-Span-2">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">v </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c </font></font></span><span class="MJXp-mrow" id="MJXp-Span-6"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-7"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F</font></font></span></span><span class="MJXp-mo" id="MJXp-Span-8" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font></span><font style="vertical-align: inherit;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-10"><font style="vertical-align: inherit;">v </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-11"><font style="vertical-align: inherit;">e </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-12"><font style="vertical-align: inherit;">c </font></span><span class="MJXp-msubsup" id="MJXp-Span-13"><span class="MJXp-mrow" id="MJXp-Span-14" style="margin-right: 0.05em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-15"><font style="vertical-align: inherit;">r</font></span></span></span><span class="MJXp-msubsup" id="MJXp-Span-13"><span class="MJXp-mn MJXp-script" id="MJXp-Span-16" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"> 1</font></span></span><span class="MJXp-mo" id="MJXp-Span-17" style="margin-left: 0em; margin-right: 0.222em;"><font style="vertical-align: inherit;"> , </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-19"><font style="vertical-align: inherit;">v </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-20"><font style="vertical-align: inherit;">e </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-21"><font style="vertical-align: inherit;">c </font></span><span class="MJXp-msubsup" id="MJXp-Span-22"><span class="MJXp-mrow" id="MJXp-Span-23" style="margin-right: 0.05em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-24"><font style="vertical-align: inherit;">r</font></span></span></span><span class="MJXp-msubsup" id="MJXp-Span-22"><span class="MJXp-mn MJXp-script" id="MJXp-Span-25" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"> 2</font></span></span><span class="MJXp-mo" id="MJXp-Span-26" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"> ) </font></span><span class="MJXp-mo" id="MJXp-Span-27" style="margin-left: 0.333em; margin-right: 0.333em;"><font style="vertical-align: inherit;">= </font></span><span class="MJXp-mo" id="MJXp-Span-28" style="margin-left: 0.267em; margin-right: 0.267em;"><font style="vertical-align: inherit;">- </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-29"><font style="vertical-align: inherit;">G </font></span><span class="MJXp-msubsup" id="MJXp-Span-30"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-31" style="margin-right: 0.05em;"><font style="vertical-align: inherit;">m </font></span></span><span class="MJXp-msubsup" id="MJXp-Span-30"><span class="MJXp-mn MJXp-script" id="MJXp-Span-32" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;">1 </font></span></span><span class="MJXp-msubsup" id="MJXp-Span-33"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-34" style="margin-right: 0.05em;"><font style="vertical-align: inherit;">m </font></span></span><span class="MJXp-msubsup" id="MJXp-Span-33"><span class="MJXp-mn MJXp-script" id="MJXp-Span-35" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;">2</font></span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-37"><font style="vertical-align: inherit;"> f </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-38"><font style="vertical-align: inherit;">r </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-39"><font style="vertical-align: inherit;">a </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-40"><font style="vertical-align: inherit;">c </font></span><span class="MJXp-mrow" id="MJXp-Span-41"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-43"><font style="vertical-align: inherit;">v </font></span></span><span class="MJXp-mrow" id="MJXp-Span-41"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-44"><font style="vertical-align: inherit;">e </font></span></span><span class="MJXp-mrow" id="MJXp-Span-41"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-45"><font style="vertical-align: inherit;">c </font></span></span><span class="MJXp-mrow" id="MJXp-Span-41"><span class="MJXp-msubsup" id="MJXp-Span-46"><span class="MJXp-mrow" id="MJXp-Span-47" style="margin-right: 0.05em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-48"><font style="vertical-align: inherit;">r</font></span></span></span></span><span class="MJXp-mrow" id="MJXp-Span-41"><span class="MJXp-msubsup" id="MJXp-Span-46"><span class="MJXp-mn MJXp-script" id="MJXp-Span-49" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"> 1</font></span></span></span><span class="MJXp-mrow" id="MJXp-Span-41"><span class="MJXp-mo" id="MJXp-Span-50" style="margin-left: 0.267em; margin-right: 0.267em;"><font style="vertical-align: inherit;"> - </font></span></span><span class="MJXp-mrow" id="MJXp-Span-41"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-52"><font style="vertical-align: inherit;">v </font></span></span><span class="MJXp-mrow" id="MJXp-Span-41"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-53"><font style="vertical-align: inherit;">e </font></span></span><span class="MJXp-mrow" id="MJXp-Span-41"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-54"><font style="vertical-align: inherit;">c </font></span></span><span class="MJXp-mrow" id="MJXp-Span-41"><span class="MJXp-msubsup" id="MJXp-Span-55"><span class="MJXp-mrow" id="MJXp-Span-56" style="margin-right: 0.05em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-57"><font style="vertical-align: inherit;">r</font></span></span></span></span><span class="MJXp-mrow" id="MJXp-Span-41"><span class="MJXp-msubsup" id="MJXp-Span-55"><span class="MJXp-mn MJXp-script" id="MJXp-Span-58" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"> 2 </font></span></span></span><span class="MJXp-mrow" id="MJXp-Span-59"><span class="MJXp-mrow" id="MJXp-Span-60"><span class="MJXp-mo" id="MJXp-Span-61" style="margin-left: 0.167em; margin-right: 0.167em;"><font style="vertical-align: inherit;">| </font></span></span></span><span class="MJXp-mrow" id="MJXp-Span-59"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-63"><font style="vertical-align: inherit;">v </font></span></span><span class="MJXp-mrow" id="MJXp-Span-59"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-64"><font style="vertical-align: inherit;">e </font></span></span><span class="MJXp-mrow" id="MJXp-Span-59"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-65"><font style="vertical-align: inherit;">c </font></span></span><span class="MJXp-mrow" id="MJXp-Span-59"><span class="MJXp-msubsup" id="MJXp-Span-66"><span class="MJXp-mrow" id="MJXp-Span-67" style="margin-right: 0.05em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-68"><font style="vertical-align: inherit;">r</font></span></span></span></span><span class="MJXp-mrow" id="MJXp-Span-59"><span class="MJXp-msubsup" id="MJXp-Span-66"><span class="MJXp-mn MJXp-script" id="MJXp-Span-69" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"> 1</font></span></span></span><span class="MJXp-mrow" id="MJXp-Span-59"><span class="MJXp-mo" id="MJXp-Span-70" style="margin-left: 0.267em; margin-right: 0.267em;"><font style="vertical-align: inherit;"> - </font></span></span><span class="MJXp-mrow" id="MJXp-Span-59"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-72"><font style="vertical-align: inherit;">v </font></span></span><span class="MJXp-mrow" id="MJXp-Span-59"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-73"><font style="vertical-align: inherit;">e </font></span></span><span class="MJXp-mrow" id="MJXp-Span-59"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-74"><font style="vertical-align: inherit;">c </font></span></span><span class="MJXp-mrow" id="MJXp-Span-59"><span class="MJXp-msubsup" id="MJXp-Span-75"><span class="MJXp-mrow" id="MJXp-Span-76" style="margin-right: 0.05em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-77"><font style="vertical-align: inherit;">r</font></span></span></span></span><span class="MJXp-mrow" id="MJXp-Span-59"><span class="MJXp-msubsup" id="MJXp-Span-75"><span class="MJXp-mn MJXp-script" id="MJXp-Span-78" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"> 2 </font></span></span></span><span class="MJXp-mrow" id="MJXp-Span-59"><span class="MJXp-msubsup" id="MJXp-Span-79"><span class="MJXp-mrow" id="MJXp-Span-80" style="margin-right: 0.05em;"><span class="MJXp-mo" id="MJXp-Span-81" style="margin-left: 0.167em; margin-right: 0.167em;"><font style="vertical-align: inherit;">| </font></span></span></span></span><span class="MJXp-mrow" id="MJXp-Span-59"><span class="MJXp-msubsup" id="MJXp-Span-79"><span class="MJXp-mn MJXp-script" id="MJXp-Span-82" style="vertical-align: 0.5em;"><font style="vertical-align: inherit;">3</font></span></span></span><span class="MJXp-mo" id="MJXp-Span-83" style="margin-left: 0em; margin-right: 0.222em;"><font style="vertical-align: inherit;"> ,</font></span></font><span class="MJXp-mtext" id="MJXp-Span-9">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-10"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-11"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-12"><font style="vertical-align: inherit;"></font></span><span class="MJXp-msubsup" id="MJXp-Span-13"><span class="MJXp-mrow" id="MJXp-Span-14" style="margin-right: 0.05em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-15"><font style="vertical-align: inherit;"></font></span></span><span class="MJXp-mn MJXp-script" id="MJXp-Span-16" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"></font></span></span><span class="MJXp-mo" id="MJXp-Span-17" style="margin-left: 0em; margin-right: 0.222em;"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mtext" id="MJXp-Span-18">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-19"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-20"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-21"><font style="vertical-align: inherit;"></font></span><span class="MJXp-msubsup" id="MJXp-Span-22"><span class="MJXp-mrow" id="MJXp-Span-23" style="margin-right: 0.05em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-24"><font style="vertical-align: inherit;"></font></span></span><span class="MJXp-mn MJXp-script" id="MJXp-Span-25" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"></font></span></span><span class="MJXp-mo" id="MJXp-Span-26" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mo" id="MJXp-Span-27" style="margin-left: 0.333em; margin-right: 0.333em;"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mo" id="MJXp-Span-28" style="margin-left: 0.267em; margin-right: 0.267em;"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-29"><font style="vertical-align: inherit;"></font></span><span class="MJXp-msubsup" id="MJXp-Span-30"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-31" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mn MJXp-script" id="MJXp-Span-32" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"></font></span></span><span class="MJXp-msubsup" id="MJXp-Span-33"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-34" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mn MJXp-script" id="MJXp-Span-35" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"></font></span></span><span class="MJXp-mtext" id="MJXp-Span-36">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-37"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-38"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-39"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-40"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mrow" id="MJXp-Span-41"><span class="MJXp-mtext" id="MJXp-Span-42">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-43"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-44"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-45"><font style="vertical-align: inherit;"></font></span><span class="MJXp-msubsup" id="MJXp-Span-46"><span class="MJXp-mrow" id="MJXp-Span-47" style="margin-right: 0.05em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-48"><font style="vertical-align: inherit;"></font></span></span><span class="MJXp-mn MJXp-script" id="MJXp-Span-49" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"></font></span></span><span class="MJXp-mo" id="MJXp-Span-50" style="margin-left: 0.267em; margin-right: 0.267em;"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mtext" id="MJXp-Span-51">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-52"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-53"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-54"><font style="vertical-align: inherit;"></font></span><span class="MJXp-msubsup" id="MJXp-Span-55"><span class="MJXp-mrow" id="MJXp-Span-56" style="margin-right: 0.05em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-57"><font style="vertical-align: inherit;"></font></span></span><span class="MJXp-mn MJXp-script" id="MJXp-Span-58" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"></font></span></span></span><span class="MJXp-mrow" id="MJXp-Span-59"><span class="MJXp-mrow" id="MJXp-Span-60"><span class="MJXp-mo" id="MJXp-Span-61" style="margin-left: 0.167em; margin-right: 0.167em;"><font style="vertical-align: inherit;"></font></span></span><span class="MJXp-mtext" id="MJXp-Span-62">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-63"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-64"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-65"><font style="vertical-align: inherit;"></font></span><span class="MJXp-msubsup" id="MJXp-Span-66"><span class="MJXp-mrow" id="MJXp-Span-67" style="margin-right: 0.05em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-68"><font style="vertical-align: inherit;"></font></span></span><span class="MJXp-mn MJXp-script" id="MJXp-Span-69" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"></font></span></span><span class="MJXp-mo" id="MJXp-Span-70" style="margin-left: 0.267em; margin-right: 0.267em;"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mtext" id="MJXp-Span-71">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-72"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-73"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-74"><font style="vertical-align: inherit;"></font></span><span class="MJXp-msubsup" id="MJXp-Span-75"><span class="MJXp-mrow" id="MJXp-Span-76" style="margin-right: 0.05em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-77"><font style="vertical-align: inherit;"></font></span></span><span class="MJXp-mn MJXp-script" id="MJXp-Span-78" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"></font></span></span><span class="MJXp-msubsup" id="MJXp-Span-79"><span class="MJXp-mrow" id="MJXp-Span-80" style="margin-right: 0.05em;"><span class="MJXp-mo" id="MJXp-Span-81" style="margin-left: 0.167em; margin-right: 0.167em;"><font style="vertical-align: inherit;"></font></span></span><span class="MJXp-mn MJXp-script" id="MJXp-Span-82" style="vertical-align: 0.5em;"><font style="vertical-align: inherit;"></font></span></span></span><span class="MJXp-mo" id="MJXp-Span-83" style="margin-left: 0em; margin-right: 0.222em;"><font style="vertical-align: inherit;"></font></span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processed" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="70.534ex" height="3.142ex" viewBox="0 -1039.5 30368.8 1352.7" role="img" focusable="false" style="vertical-align: -0.728ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhilJTYmTKuQQjX12kU_BTRmum9Hmw#MJMATHI-76" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhilJTYmTKuQQjX12kU_BTRmum9Hmw#MJMATHI-65" x="735" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhilJTYmTKuQQjX12kU_BTRmum9Hmw#MJMATHI-63" x="1202" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhilJTYmTKuQQjX12kU_BTRmum9Hmw#MJMATHI-46" x="1635" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhilJTYmTKuQQjX12kU_BTRmum9Hmw#MJMAIN-28" x="2385" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhilJTYmTKuQQjX12kU_BTRmum9Hmw#MJMATHI-76" x="3024" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhilJTYmTKuQQjX12kU_BTRmum9Hmw#MJMATHI-65" x="3510" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhilJTYmTKuQQjX12kU_BTRmum9Hmw#MJMATHI-63" x="3976" y="0"></use><g transform="translate(4410,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhilJTYmTKuQQjX12kU_BTRmum9Hmw#MJMATHI-72" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhilJTYmTKuQQjX12kU_BTRmum9Hmw#MJMAIN-31" x="638" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhilJTYmTKuQQjX12kU_BTRmum9Hmw#MJMAIN-2C" x="5315" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhilJTYmTKuQQjX12kU_BTRmum9Hmw#MJMATHI-76" x="6010" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhilJTYmTKuQQjX12kU_BTRmum9Hmw#MJMATHI-65" x="6496" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhilJTYmTKuQQjX12kU_BTRmum9Hmw#MJMATHI-63" x="6962" y="0"></use><g transform="translate(7396,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhilJTYmTKuQQjX12kU_BTRmum9Hmw#MJMATHI-72" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhilJTYmTKuQQjX12kU_BTRmum9Hmw#MJMAIN-32" x="638" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhilJTYmTKuQQjX12kU_BTRmum9Hmw#MJMAIN-29" x="8301" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhilJTYmTKuQQjX12kU_BTRmum9Hmw#MJMAIN-3D" x="8968" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhilJTYmTKuQQjX12kU_BTRmum9Hmw#MJMAIN-2212" x="10025" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhilJTYmTKuQQjX12kU_BTRmum9Hmw#MJMATHI-47" x="10803" y="0"></use><g transform="translate(11590,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhilJTYmTKuQQjX12kU_BTRmum9Hmw#MJMATHI-6D" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhilJTYmTKuQQjX12kU_BTRmum9Hmw#MJMAIN-31" x="1242" y="-213"></use></g><g transform="translate(12922,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhilJTYmTKuQQjX12kU_BTRmum9Hmw#MJMATHI-6D" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhilJTYmTKuQQjX12kU_BTRmum9Hmw#MJMAIN-32" x="1242" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhilJTYmTKuQQjX12kU_BTRmum9Hmw#MJMATHI-66" x="14504" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhilJTYmTKuQQjX12kU_BTRmum9Hmw#MJMATHI-72" x="15055" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhilJTYmTKuQQjX12kU_BTRmum9Hmw#MJMATHI-61" x="15506" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhilJTYmTKuQQjX12kU_BTRmum9Hmw#MJMATHI-63" x="16036" y="0"></use><g transform="translate(16469,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhilJTYmTKuQQjX12kU_BTRmum9Hmw#MJMATHI-76" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhilJTYmTKuQQjX12kU_BTRmum9Hmw#MJMATHI-65" x="735" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhilJTYmTKuQQjX12kU_BTRmum9Hmw#MJMATHI-63" x="1202" y="0"></use><g transform="translate(1635,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhilJTYmTKuQQjX12kU_BTRmum9Hmw#MJMATHI-72" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhilJTYmTKuQQjX12kU_BTRmum9Hmw#MJMAIN-31" x="638" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhilJTYmTKuQQjX12kU_BTRmum9Hmw#MJMAIN-2212" x="2763" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhilJTYmTKuQQjX12kU_BTRmum9Hmw#MJMATHI-76" x="4013" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhilJTYmTKuQQjX12kU_BTRmum9Hmw#MJMATHI-65" x="4499" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhilJTYmTKuQQjX12kU_BTRmum9Hmw#MJMATHI-63" x="4965" y="0"></use><g transform="translate(5399,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhilJTYmTKuQQjX12kU_BTRmum9Hmw#MJMATHI-72" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhilJTYmTKuQQjX12kU_BTRmum9Hmw#MJMAIN-32" x="638" y="-213"></use></g></g><g transform="translate(22774,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhilJTYmTKuQQjX12kU_BTRmum9Hmw#MJMAIN-7C" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhilJTYmTKuQQjX12kU_BTRmum9Hmw#MJMATHI-76" x="528" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhilJTYmTKuQQjX12kU_BTRmum9Hmw#MJMATHI-65" x="1014" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhilJTYmTKuQQjX12kU_BTRmum9Hmw#MJMATHI-63" x="1480" y="0"></use><g transform="translate(1914,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhilJTYmTKuQQjX12kU_BTRmum9Hmw#MJMATHI-72" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhilJTYmTKuQQjX12kU_BTRmum9Hmw#MJMAIN-31" x="638" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhilJTYmTKuQQjX12kU_BTRmum9Hmw#MJMAIN-2212" x="3041" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhilJTYmTKuQQjX12kU_BTRmum9Hmw#MJMATHI-76" x="4292" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhilJTYmTKuQQjX12kU_BTRmum9Hmw#MJMATHI-65" x="4777" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhilJTYmTKuQQjX12kU_BTRmum9Hmw#MJMATHI-63" x="5244" y="0"></use><g transform="translate(5677,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhilJTYmTKuQQjX12kU_BTRmum9Hmw#MJMATHI-72" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhilJTYmTKuQQjX12kU_BTRmum9Hmw#MJMAIN-32" x="638" y="-213"></use></g><g transform="translate(6583,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhilJTYmTKuQQjX12kU_BTRmum9Hmw#MJMAIN-7C" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhilJTYmTKuQQjX12kU_BTRmum9Hmw#MJMAIN-33" x="393" y="675"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhilJTYmTKuQQjX12kU_BTRmum9Hmw#MJMAIN-2C" x="30090" y="0"></use></g></svg></span></div><script type="math/tex;mode=display" id="MathJax-Element-1"> \ vec {F} (\ vec {r} _1, \ vec {r} _2) = - G m_1 m_2 \ frac {\ vec {r} _1 - \ vec {r} _2} {| \ vec {r} _1 - \ vec {r} _2 | ^ 3}, </script></p><br><br>  donde <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-84"><span class="MJXp-mtext" id="MJXp-Span-85">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-86">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-87">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-88">c</span><span class="MJXp-msubsup" id="MJXp-Span-89"><span class="MJXp-mrow" id="MJXp-Span-90" style="margin-right: 0.05em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-91">r</span></span><span class="MJXp-mn MJXp-script" id="MJXp-Span-92" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-93" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mtext" id="MJXp-Span-94">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-95">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-96">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-97">c</span><span class="MJXp-msubsup" id="MJXp-Span-98"><span class="MJXp-mrow" id="MJXp-Span-99" style="margin-right: 0.05em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-100">r</span></span><span class="MJXp-mn MJXp-script" id="MJXp-Span-101" style="vertical-align: -0.4em;">2</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="12.837ex" height="1.817ex" viewBox="0 -520.7 5527 782.1" role="img" focusable="false" style="vertical-align: -0.607ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhilJTYmTKuQQjX12kU_BTRmum9Hmw#MJMATHI-76" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhilJTYmTKuQQjX12kU_BTRmum9Hmw#MJMATHI-65" x="735" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhilJTYmTKuQQjX12kU_BTRmum9Hmw#MJMATHI-63" x="1202" y="0"></use><g transform="translate(1635,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhilJTYmTKuQQjX12kU_BTRmum9Hmw#MJMATHI-72" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhilJTYmTKuQQjX12kU_BTRmum9Hmw#MJMAIN-31" x="638" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhilJTYmTKuQQjX12kU_BTRmum9Hmw#MJMAIN-2C" x="2540" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhilJTYmTKuQQjX12kU_BTRmum9Hmw#MJMATHI-76" x="3236" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhilJTYmTKuQQjX12kU_BTRmum9Hmw#MJMATHI-65" x="3721" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhilJTYmTKuQQjX12kU_BTRmum9Hmw#MJMATHI-63" x="4188" y="0"></use><g transform="translate(4621,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhilJTYmTKuQQjX12kU_BTRmum9Hmw#MJMATHI-72" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhilJTYmTKuQQjX12kU_BTRmum9Hmw#MJMAIN-32" x="638" y="-213"></use></g></g></svg></span><script type="math/tex" id="MathJax-Element-2"> \ vec {r} _1, \ vec {r} _2 </script>  - la posición de los cuerpos en el espacio, <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-102"><span class="MJXp-msubsup" id="MJXp-Span-103"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-104" style="margin-right: 0.05em;">m</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-105" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-106" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-107"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-108" style="margin-right: 0.05em;">m</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-109" style="vertical-align: -0.4em;">2</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="7.223ex" height="1.817ex" viewBox="0 -520.7 3110 782.1" role="img" focusable="false" style="vertical-align: -0.607ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhilJTYmTKuQQjX12kU_BTRmum9Hmw#MJMATHI-6D" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhilJTYmTKuQQjX12kU_BTRmum9Hmw#MJMAIN-31" x="1242" y="-213"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhilJTYmTKuQQjX12kU_BTRmum9Hmw#MJMAIN-2C" x="1332" y="0"></use><g transform="translate(1777,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhilJTYmTKuQQjX12kU_BTRmum9Hmw#MJMATHI-6D" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhilJTYmTKuQQjX12kU_BTRmum9Hmw#MJMAIN-32" x="1242" y="-213"></use></g></g></svg></span><script type="math/tex" id="MathJax-Element-3"> m_1, m_2 </script>  - masas de cuerpos, <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-110"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-111">G</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-4-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.827ex" height="2.057ex" viewBox="0 -780.1 786.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhilJTYmTKuQQjX12kU_BTRmum9Hmw#MJMATHI-47" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-4"> G </script>  - constante gravitacional. <br>  En el sistema de <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-112"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-113">N</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-5-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.064ex" height="2.057ex" viewBox="0 -780.1 888.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhilJTYmTKuQQjX12kU_BTRmum9Hmw#MJMATHI-4E" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-5"> N </script>  Los cuerpos en cada uno de ellos se verán afectados por la fuerza de atracción del resto, que se expresa mediante la ecuación: <br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-114"><span class="MJXp-mtext" id="MJXp-Span-115">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-116">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-117">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-118">c</span><span class="MJXp-msubsup" id="MJXp-Span-119"><span class="MJXp-mrow" id="MJXp-Span-120" style="margin-right: 0.05em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-121">F</span></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-122" style="vertical-align: -0.4em;">n</span></span><span class="MJXp-mo" id="MJXp-Span-123" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mo" id="MJXp-Span-124" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-125">G</span><span class="MJXp-mtext" id="MJXp-Span-126">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-127">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-128">u</span><span class="MJXp-msubsup" id="MJXp-Span-129"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-130" style="margin-right: 0.05em;">m</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-131" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-132">k</span><span class="MJXp-mtext" id="MJXp-Span-133">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-134">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-135">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-136">q</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-137">n</span></span></span><span class="MJXp-msubsup" id="MJXp-Span-138"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-139" style="margin-right: 0.05em;">m</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-140" style="vertical-align: -0.4em;">n</span></span><span class="MJXp-msubsup" id="MJXp-Span-141"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-142" style="margin-right: 0.05em;">m</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-143" style="vertical-align: -0.4em;">k</span></span><span class="MJXp-mtext" id="MJXp-Span-144">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-145">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-146">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-147">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-148">c</span><span class="MJXp-mrow" id="MJXp-Span-149"><span class="MJXp-mtext" id="MJXp-Span-150">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-151">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-152">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-153">c</span><span class="MJXp-msubsup" id="MJXp-Span-154"><span class="MJXp-mrow" id="MJXp-Span-155" style="margin-right: 0.05em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-156">r</span></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-157" style="vertical-align: -0.4em;">n</span></span><span class="MJXp-mo" id="MJXp-Span-158" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mtext" id="MJXp-Span-159">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-160">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-161">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-162">c</span><span class="MJXp-msubsup" id="MJXp-Span-163"><span class="MJXp-mrow" id="MJXp-Span-164" style="margin-right: 0.05em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-165">r</span></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-166" style="vertical-align: -0.4em;">k</span></span></span><span class="MJXp-mrow" id="MJXp-Span-167"><span class="MJXp-mrow" id="MJXp-Span-168"><span class="MJXp-mo" id="MJXp-Span-169" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span><span class="MJXp-mtext" id="MJXp-Span-170">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-171">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-172">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-173">c</span><span class="MJXp-msubsup" id="MJXp-Span-174"><span class="MJXp-mrow" id="MJXp-Span-175" style="margin-right: 0.05em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-176">r</span></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-177" style="vertical-align: -0.4em;">n</span></span><span class="MJXp-mo" id="MJXp-Span-178" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mtext" id="MJXp-Span-179">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-180">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-181">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-182">c</span><span class="MJXp-msubsup" id="MJXp-Span-183"><span class="MJXp-mrow" id="MJXp-Span-184" style="margin-right: 0.05em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-185">r</span></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-186" style="vertical-align: -0.4em;">k</span></span><span class="MJXp-msubsup" id="MJXp-Span-187"><span class="MJXp-mrow" id="MJXp-Span-188" style="margin-right: 0.05em;"><span class="MJXp-mo" id="MJXp-Span-189" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span><span class="MJXp-mn MJXp-script" id="MJXp-Span-190" style="vertical-align: 0.5em;">3</span></span></span><span class="MJXp-mo" id="MJXp-Span-191" style="margin-left: 0em; margin-right: 0.222em;">.</span><span class="MJXp-mrow" id="MJXp-Span-192"><span class="MJXp-mo" id="MJXp-Span-193" style="margin-left: 0em; margin-right: 0em;">$</span></span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-6-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-6"> \ vec {F} _n = -G \ sum_ {k \ neq n} m_n m_k \ frac {\ vec {r} _n - \ vec {r} _k} {| \ vec {r} _n - \ vec {r } _k | ^ 3}. $ </script></p><br><br>  Usando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">la segunda ley de Newton,</a> escribimos la aceleración para cada partícula: <br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-194"><span class="MJXp-mtext" id="MJXp-Span-195">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-196">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-197">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-198">c</span><span class="MJXp-msubsup" id="MJXp-Span-199"><span class="MJXp-mrow" id="MJXp-Span-200" style="margin-right: 0.05em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-201">a</span></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-202" style="vertical-align: -0.4em;">n</span></span><span class="MJXp-mo" id="MJXp-Span-203" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mtext" id="MJXp-Span-204">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-205">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-206">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-207">c</span><span class="MJXp-msubsup" id="MJXp-Span-208"><span class="MJXp-mrow" id="MJXp-Span-209" style="margin-right: 0.05em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-210">F</span></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-211" style="vertical-align: -0.4em;">n</span></span><span class="MJXp-mrow" id="MJXp-Span-212"><span class="MJXp-mo" id="MJXp-Span-213" style="margin-left: 0.111em; margin-right: 0.111em;">/</span></span><span class="MJXp-msubsup" id="MJXp-Span-214"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-215" style="margin-right: 0.05em;">m</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-216" style="vertical-align: -0.4em;">n</span></span><span class="MJXp-mo" id="MJXp-Span-217" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mo" id="MJXp-Span-218" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-219">G</span><span class="MJXp-mtext" id="MJXp-Span-220">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-221">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-222">u</span><span class="MJXp-msubsup" id="MJXp-Span-223"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-224" style="margin-right: 0.05em;">m</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-225" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-226">k</span><span class="MJXp-mtext" id="MJXp-Span-227">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-228">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-229">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-230">q</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-231">n</span></span></span><span class="MJXp-msubsup" id="MJXp-Span-232"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-233" style="margin-right: 0.05em;">m</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-234" style="vertical-align: -0.4em;">k</span></span><span class="MJXp-mtext" id="MJXp-Span-235">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-236">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-237">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-238">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-239">c</span><span class="MJXp-mrow" id="MJXp-Span-240"><span class="MJXp-mtext" id="MJXp-Span-241">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-242">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-243">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-244">c</span><span class="MJXp-msubsup" id="MJXp-Span-245"><span class="MJXp-mrow" id="MJXp-Span-246" style="margin-right: 0.05em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-247">r</span></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-248" style="vertical-align: -0.4em;">n</span></span><span class="MJXp-mo" id="MJXp-Span-249" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mtext" id="MJXp-Span-250">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-251">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-252">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-253">c</span><span class="MJXp-msubsup" id="MJXp-Span-254"><span class="MJXp-mrow" id="MJXp-Span-255" style="margin-right: 0.05em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-256">r</span></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-257" style="vertical-align: -0.4em;">k</span></span></span><span class="MJXp-mrow" id="MJXp-Span-258"><span class="MJXp-mrow" id="MJXp-Span-259"><span class="MJXp-mo" id="MJXp-Span-260" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span><span class="MJXp-mtext" id="MJXp-Span-261">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-262">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-263">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-264">c</span><span class="MJXp-msubsup" id="MJXp-Span-265"><span class="MJXp-mrow" id="MJXp-Span-266" style="margin-right: 0.05em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-267">r</span></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-268" style="vertical-align: -0.4em;">n</span></span><span class="MJXp-mo" id="MJXp-Span-269" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mtext" id="MJXp-Span-270">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-271">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-272">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-273">c</span><span class="MJXp-msubsup" id="MJXp-Span-274"><span class="MJXp-mrow" id="MJXp-Span-275" style="margin-right: 0.05em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-276">r</span></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-277" style="vertical-align: -0.4em;">k</span></span><span class="MJXp-msubsup" id="MJXp-Span-278"><span class="MJXp-mrow" id="MJXp-Span-279" style="margin-right: 0.05em;"><span class="MJXp-mo" id="MJXp-Span-280" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span><span class="MJXp-mn MJXp-script" id="MJXp-Span-281" style="vertical-align: 0.5em;">3</span></span></span><span class="MJXp-mo" id="MJXp-Span-282" style="margin-left: 0em; margin-right: 0.222em;">.</span><span class="MJXp-mrow" id="MJXp-Span-283"><span class="MJXp-mo" id="MJXp-Span-284" style="margin-left: 0em; margin-right: 0em;">$</span></span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-7-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-7"> \ vec {a} _n = \ vec {F} _n / m_n = -G \ sum_ {k \ neq n} m_k \ frac {\ vec {r} _n - \ vec {r} _k} {| \ vec { r} _n - \ vec {r} _k | ^ 3}. $ </script></p><br><br>  Recordando que la aceleración es la segunda derivada del tiempo de la coordenada, obtenemos una ecuación diferencial parcial de segundo orden, que debe resolverse para obtener la trayectoria de cada cuerpo: <br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-285"><span class="MJXp-mtext" id="MJXp-Span-286">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-287">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-288">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-289">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-290">c</span><span class="MJXp-mrow" id="MJXp-Span-291"><span class="MJXp-mtext" id="MJXp-Span-292">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-293">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-294">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-295">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-296">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-297">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-298">a</span><span class="MJXp-msubsup" id="MJXp-Span-299"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-300" style="margin-right: 0.05em;">l</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-301" style="vertical-align: 0.5em;">2</span></span><span class="MJXp-mtext" id="MJXp-Span-302">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-303">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-304">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-305">c</span><span class="MJXp-msubsup" id="MJXp-Span-306"><span class="MJXp-mrow" id="MJXp-Span-307" style="margin-right: 0.05em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-308">r</span></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-309" style="vertical-align: -0.4em;">n</span></span></span><span class="MJXp-mrow" id="MJXp-Span-310"><span class="MJXp-mtext" id="MJXp-Span-311">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-312">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-313">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-314">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-315">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-316">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-317">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-318">l</span><span class="MJXp-msubsup" id="MJXp-Span-319"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-320" style="margin-right: 0.05em;">t</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-321" style="vertical-align: 0.5em;">2</span></span></span><span class="MJXp-mo" id="MJXp-Span-322" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-323"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-324" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-325" style="vertical-align: -0.4em;">n</span></span><span class="MJXp-mo" id="MJXp-Span-326" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mo" id="MJXp-Span-327" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-328">G</span><span class="MJXp-mtext" id="MJXp-Span-329">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-330">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-331">u</span><span class="MJXp-msubsup" id="MJXp-Span-332"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-333" style="margin-right: 0.05em;">m</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-334" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-335">k</span><span class="MJXp-mtext" id="MJXp-Span-336">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-337">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-338">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-339">q</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-340">n</span></span></span><span class="MJXp-msubsup" id="MJXp-Span-341"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-342" style="margin-right: 0.05em;">m</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-343" style="vertical-align: -0.4em;">k</span></span><span class="MJXp-mtext" id="MJXp-Span-344">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-345">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-346">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-347">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-348">c</span><span class="MJXp-mrow" id="MJXp-Span-349"><span class="MJXp-mtext" id="MJXp-Span-350">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-351">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-352">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-353">c</span><span class="MJXp-msubsup" id="MJXp-Span-354"><span class="MJXp-mrow" id="MJXp-Span-355" style="margin-right: 0.05em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-356">r</span></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-357" style="vertical-align: -0.4em;">n</span></span><span class="MJXp-mo" id="MJXp-Span-358" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mtext" id="MJXp-Span-359">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-360">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-361">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-362">c</span><span class="MJXp-msubsup" id="MJXp-Span-363"><span class="MJXp-mrow" id="MJXp-Span-364" style="margin-right: 0.05em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-365">r</span></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-366" style="vertical-align: -0.4em;">k</span></span></span><span class="MJXp-mrow" id="MJXp-Span-367"><span class="MJXp-mrow" id="MJXp-Span-368"><span class="MJXp-mo" id="MJXp-Span-369" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span><span class="MJXp-mtext" id="MJXp-Span-370">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-371">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-372">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-373">c</span><span class="MJXp-msubsup" id="MJXp-Span-374"><span class="MJXp-mrow" id="MJXp-Span-375" style="margin-right: 0.05em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-376">r</span></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-377" style="vertical-align: -0.4em;">n</span></span><span class="MJXp-mo" id="MJXp-Span-378" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mtext" id="MJXp-Span-379">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-380">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-381">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-382">c</span><span class="MJXp-msubsup" id="MJXp-Span-383"><span class="MJXp-mrow" id="MJXp-Span-384" style="margin-right: 0.05em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-385">r</span></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-386" style="vertical-align: -0.4em;">k</span></span><span class="MJXp-msubsup" id="MJXp-Span-387"><span class="MJXp-mrow" id="MJXp-Span-388" style="margin-right: 0.05em;"><span class="MJXp-mo" id="MJXp-Span-389" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span><span class="MJXp-mn MJXp-script" id="MJXp-Span-390" style="vertical-align: 0.5em;">3</span></span></span><span class="MJXp-mo" id="MJXp-Span-391" style="margin-left: 0em; margin-right: 0.222em;">.</span><span class="MJXp-mrow" id="MJXp-Span-392"><span class="MJXp-mo" id="MJXp-Span-393" style="margin-left: 0em; margin-right: 0em;">$</span></span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-8-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-8"> \ frac {\ partial ^ 2 \ vec {r} _n} {\ partial t ^ 2} = f_n = -G \ sum_ {k \ neq n} m_k \ frac {\ vec {r} _n - \ vec {r } _k} {| \ vec {r} _n - \ vec {r} _k | ^ 3}. $ </script></p><br>  Es importante señalar aquí que la complejidad de calcular una función <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-394"><span class="MJXp-msubsup" id="MJXp-Span-395"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-396" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-397" style="vertical-align: -0.4em;">n</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-9-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-9"> f_n </script>  es igual a <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-398"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-399">O</span><span class="MJXp-mo" id="MJXp-Span-400" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-401"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-402" style="margin-right: 0.05em;">N</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-403" style="vertical-align: 0.5em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-404" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-10-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-10"> O (N ^ 2) </script>  y aumenta significativamente con el aumento del número de cuerpos que interactúan. <br><br><h2>  Matemáticas </h2><br>  El primer y más simple método para resolver ecuaciones diferenciales es <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">el método de Euler</a> , que está diseñado para resolver ecuaciones de la forma: <br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-405"><span class="MJXp-mtext" id="MJXp-Span-406">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-407">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-408">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-409">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-410">c</span><span class="MJXp-mrow" id="MJXp-Span-411"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-412">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-413">y</span></span><span class="MJXp-mrow" id="MJXp-Span-414"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-415">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-416">x</span></span><span class="MJXp-mo" id="MJXp-Span-417" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-418">f</span><span class="MJXp-mo" id="MJXp-Span-419" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-420">x</span><span class="MJXp-mo" id="MJXp-Span-421" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-422">y</span><span class="MJXp-mo" id="MJXp-Span-423" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-424" style="margin-left: 0em; margin-right: 0.222em;">.</span><span class="MJXp-mrow" id="MJXp-Span-425"><span class="MJXp-mo" id="MJXp-Span-426" style="margin-left: 0em; margin-right: 0em;">$</span></span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-11-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-11"> \ frac {dy} {dx} = f (x, y). $ </script></p><br>  Tras la transición a la región discreta, obtenemos: <br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-427"><span class="MJXp-msubsup" id="MJXp-Span-428"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-429" style="margin-right: 0.05em;">y</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-430" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-431">i</span></span></span><span class="MJXp-mo" id="MJXp-Span-432" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-433"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-434" style="margin-right: 0.05em;">y</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-435" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-436">i</span><span class="MJXp-mo" id="MJXp-Span-437">−</span><span class="MJXp-mn" id="MJXp-Span-438">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-439" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-440">h</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-441">f</span><span class="MJXp-mo" id="MJXp-Span-442" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-443"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-444" style="margin-right: 0.05em;">x</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-445" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-446">i</span><span class="MJXp-mo" id="MJXp-Span-447">−</span><span class="MJXp-mn" id="MJXp-Span-448">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-449" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-450"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-451" style="margin-right: 0.05em;">y</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-452" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-453">i</span><span class="MJXp-mo" id="MJXp-Span-454">−</span><span class="MJXp-mn" id="MJXp-Span-455">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-456" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-457" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mtext" id="MJXp-Span-458">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-459">q</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-460">u</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-461">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-462">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-463">i</span><span class="MJXp-mo" id="MJXp-Span-464" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-465">1</span><span class="MJXp-mo" id="MJXp-Span-466" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-467">2</span><span class="MJXp-mo" id="MJXp-Span-468" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-469">3</span><span class="MJXp-mo" id="MJXp-Span-470" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mtext" id="MJXp-Span-471">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-472">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-473">u</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-474">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-475">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-476">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-477">s</span><span class="MJXp-mo" id="MJXp-Span-478" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-479">m</span><span class="MJXp-mo" id="MJXp-Span-480" style="margin-left: 0em; margin-right: 0.222em;">,</span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-12-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-12"> y_ {i} = y_ {i-1} + h f (x_ {i-1}, y_ {i-1}), \ quad i = 1,2,3, \ puntos, m, </script></p><br>  donde <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-481"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-482">h</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-13-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-13"> h </script>  Es el paso de integración, y <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-483"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-484">m</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-14-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-14"> m </script>  - el número de pasos de integración.  Por lo tanto, si necesitamos calcular la posición de los cuerpos a la vez <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-485"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-486">T</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-15-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-15"> T </script>  entonces deberíamos hacer <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-487"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-488">m</span><span class="MJXp-mo" id="MJXp-Span-489" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-490">T</span><span class="MJXp-mrow" id="MJXp-Span-491"><span class="MJXp-mo" id="MJXp-Span-492" style="margin-left: 0.111em; margin-right: 0.111em;">/</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-493">h</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-16-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-16"> m = T / h </script>  pasos de integración.  Aquí el primer problema es visible, si <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-494"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-495">T</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-17-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-17"> T </script>  grande, entonces debemos tomar una gran cantidad de pasos de integración. <br><br>  Para aplicar el método de Euler a nuestro problema, debe reducirse a un sistema de primer orden.  Para hacer esto, presentamos una variable adicional: velocidad de partículas: <br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-496"><span class="MJXp-mtext" id="MJXp-Span-497">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-498">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-499">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-500">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-501">c</span><span class="MJXp-mrow" id="MJXp-Span-502"><span class="MJXp-mtext" id="MJXp-Span-503">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-504">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-505">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-506">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-507">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-508">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-509">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-510">l</span><span class="MJXp-mtext" id="MJXp-Span-511">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-512">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-513">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-514">c</span><span class="MJXp-msubsup" id="MJXp-Span-515"><span class="MJXp-mrow" id="MJXp-Span-516" style="margin-right: 0.05em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-517">v</span></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-518" style="vertical-align: -0.4em;">n</span></span></span><span class="MJXp-mrow" id="MJXp-Span-519"><span class="MJXp-mtext" id="MJXp-Span-520">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-521">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-522">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-523">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-524">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-525">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-526">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-527">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-528">t</span></span><span class="MJXp-mo" id="MJXp-Span-529" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-530"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-531" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-532" style="vertical-align: -0.4em;">n</span></span><span class="MJXp-mo" id="MJXp-Span-533" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mspace" id="MJXp-Span-534" style="width: 0em; height: 0em;"></span><span class="MJXp-mtext" id="MJXp-Span-535">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-536">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-537">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-538">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-539">c</span><span class="MJXp-mrow" id="MJXp-Span-540"><span class="MJXp-mtext" id="MJXp-Span-541">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-542">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-543">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-544">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-545">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-546">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-547">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-548">l</span><span class="MJXp-mtext" id="MJXp-Span-549">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-550">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-551">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-552">c</span><span class="MJXp-msubsup" id="MJXp-Span-553"><span class="MJXp-mrow" id="MJXp-Span-554" style="margin-right: 0.05em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-555">r</span></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-556" style="vertical-align: -0.4em;">n</span></span></span><span class="MJXp-mrow" id="MJXp-Span-557"><span class="MJXp-mtext" id="MJXp-Span-558">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-559">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-560">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-561">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-562">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-563">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-564">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-565">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-566">t</span></span><span class="MJXp-mo" id="MJXp-Span-567" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mtext" id="MJXp-Span-568">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-569">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-570">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-571">c</span><span class="MJXp-msubsup" id="MJXp-Span-572"><span class="MJXp-mrow" id="MJXp-Span-573" style="margin-right: 0.05em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-574">v</span></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-575" style="vertical-align: -0.4em;">n</span></span><span class="MJXp-mo" id="MJXp-Span-576" style="margin-left: 0em; margin-right: 0.222em;">.</span><span class="MJXp-mrow" id="MJXp-Span-577"><span class="MJXp-mo" id="MJXp-Span-578" style="margin-left: 0em; margin-right: 0em;">$</span></span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-18-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-18"> \ frac {\ partial \ vec {v} _n} {\ partial t} = f_n, \\ \ frac {\ partial \ vec {r} _n} {\ partial t} = \ vec {v} _n. $ </script></p><br><br>  El segundo problema para resolver sistemas de ecuaciones diferenciales es la precisión de la solución y su control.  La precisión se puede mejorar de dos maneras: disminuyendo el paso de integración y eligiendo un método con un mayor orden de precisión.  Ambos métodos conducen a una mayor complejidad computacional, pero de diferentes maneras.  Por ejemplo, puede usar el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">método</a> clásico <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Runge-Kutta de cuarto orden</a> ; requiere cuatro cálculos de funciones <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-579"><span class="MJXp-msubsup" id="MJXp-Span-580"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-581" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-582" style="vertical-align: -0.4em;">n</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-19-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-19"> f_n </script>  en cada paso, pero tiene un orden de precisión <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-583"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-584">O</span><span class="MJXp-mo" id="MJXp-Span-585" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-586"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-587" style="margin-right: 0.05em;">h</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-588" style="vertical-align: 0.5em;">4</span></span><span class="MJXp-mo" id="MJXp-Span-589" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-20-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-20"> O (h ^ 4) </script>  (a modo de comparación, el método de Euler tiene un orden de precisión <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-590"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-591">O</span><span class="MJXp-mo" id="MJXp-Span-592" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-593">h</span><span class="MJXp-mo" id="MJXp-Span-594" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-21-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-21"> O (h) </script>  y requiere un cálculo <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-595"><span class="MJXp-msubsup" id="MJXp-Span-596"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-597" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-598" style="vertical-align: -0.4em;">n</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-22-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-22"> f_n </script>  )  La precisión de la solución también se puede controlar de varias maneras: compare con la solución analítica, resuelva utilizando diferentes métodos o con diferentes pasos y compare los resultados, controle los parámetros de terceros y las limitaciones que la solución debe cumplir. <br>  Además, cada uno de estos métodos tiene sus inconvenientes.  Las decisiones analíticas pueden estar ausentes o, incluso en la mayoría de los casos, completamente ausentes.  Por ejemplo, para nuestra tarea <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-599"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-600">N</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-23-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-23"> N </script>  la solución analítica de tel es solo para <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-601"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-602">N</span><span class="MJXp-mo" id="MJXp-Span-603" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-604">2</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-24-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-24"> N = 2 </script>  , pero incluso esto es suficiente para probar la precisión de los métodos.  Resolver un problema mediante dos métodos o con diferentes pasos aumenta el tiempo de cálculo, pero este enfoque se puede aplicar a casi cualquier tarea.  No todas las tareas tienen limitaciones, pero las nuestras las tienen: en cada paso de integración podemos controlar la implementación <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">de las leyes de conservación</a> .  Este enfoque también aumenta la complejidad del cálculo, pero hay mucho para elegir; calcular la suma de los momentos momentáneos o angulares de todas las partículas tiene una complejidad del orden <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-605"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-606">O</span><span class="MJXp-mo" id="MJXp-Span-607" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-608">N</span><span class="MJXp-mo" id="MJXp-Span-609" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-25-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-25"> O (N) </script>  , mientras que calcular la energía total de un sistema tiene complejidad de orden <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-610"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-611">O</span><span class="MJXp-mo" id="MJXp-Span-612" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-613"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-614" style="margin-right: 0.05em;">N</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-615" style="vertical-align: 0.5em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-616" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-26-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-26"> O (N ^ 2) </script><br><br><div class="spoiler">  <b class="spoiler_title">Nota sobre el cálculo de la energía total</b> <div class="spoiler_text">  En nuestro caso, la energía total del sistema consta de dos partes: energía cinética y energía potencial.  La energía cinética consiste en la suma de las energías cinéticas de todos los cuerpos.  Para calcular la energía potencial, necesitamos agregar las energías potenciales de cada partícula en el campo gravitacional de las partículas restantes, por lo que debemos agregar <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-617"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-618">O</span><span class="MJXp-mo" id="MJXp-Span-619" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-620"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-621" style="margin-right: 0.05em;">N</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-622" style="vertical-align: 0.5em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-623" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-27"> O (N ^ 2) </script>  términos  La dificultad es que todos los términos son de un orden muy diferente, e incluso con cálculos de doble precisión no es posible calcular este valor con una precisión suficiente para comparar en diferentes pasos.  Para superar este problema, fue necesario aplicar la suma de acuerdo con <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">el algoritmo de Kahan</a> . <br></div></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4d8/270/e1d/4d8270e1d2f39d30e9d2e5beabec6fa0.png" alt="Trayectoria elíptica"></div><br><p>  <b>Fig 1.</b> <i>Un ejemplo de una trayectoria elíptica.</i> </p><br><br><br>  Considere el caso simple de un satélite que se mueve en una órbita elíptica alrededor de la Tierra.  A medida que el satélite se acerca a la Tierra, su velocidad aumenta, y al alejarse de la Tierra disminuye, en consecuencia, surge la posibilidad de disminuir el paso de integración en el tiempo en la parte verde de la órbita, y aumentarlo en rojo y azul sin cambiar la precisión de la solución.  Intentemos comparar con más detalle. <br><br>  <b>Tabla 1.</b> <i>Métodos investigados para resolver ecuaciones diferenciales</i> <br><table><tbody><tr><th>  Marcado </th><th>  Orden </th><th>  Descripción </th></tr><tr><td>  adams </td><td>  1-5 </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Método Adams-Bashfort</a> </td></tr><tr><td>  Euler </td><td>  1 </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Método Euler</a> </td></tr><tr><td>  rk4 </td><td>  4 4 </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Método clásico de Runge-Kutta</a> </td></tr><tr><td>  rkck </td><td>  5 5 </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Método Kash-Karp</a> </td></tr><tr><td>  rkdp </td><td>  5 5 </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Método Dorman-Prince</a> </td></tr><tr><td>  rkdverk </td><td>  6 6 </td><td>  Método Werner <a href="">1)</a> p.  181 </td></tr><tr><td>  rkf </td><td>  7 7 </td><td>  Método Felberg <a href="">1)</a> p.  180 </td></tr><tr><td>  rkgl </td><td>  6 6 </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Método implícito de Gauss-Legendre</a> </td></tr><tr><td>  rklc </td><td>  4 4 </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Método implícito de Lobatto</a> </td></tr><tr><td>  trapecio </td><td>  2 </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Método trapezoidal</a> </td></tr></tbody></table><br>  Para seleccionar el mejor método para nuestra tarea, compararemos varios métodos conocidos.  Para hacer esto, simulamos la colisión de dos sistemas de cuerpos. <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-624"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-625">N</span><span class="MJXp-mo" id="MJXp-Span-626" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-627">512</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-28-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-28"> N = 512 </script>  y mida el cambio relativo en la <a href="">energía total</a> , el <a href="">momento</a> y su <a href="">momento</a> al final de la simulación (tiempo máximo de simulación) <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-628"><span class="MJXp-msubsup" id="MJXp-Span-629"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-630" style="margin-right: 0.05em;">T</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-631" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-632">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-633">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-634">x</span></span></span><span class="MJXp-mo" id="MJXp-Span-635" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-636">2.5</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-29-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-29"> T_ {max} = 2.5 </script>  )  En este caso, variaremos el paso y los parámetros de los métodos de integración y mediremos el número de llamadas a funciones <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-637"><span class="MJXp-msubsup" id="MJXp-Span-638"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-639" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-640" style="vertical-align: -0.4em;">n</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-30-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-30"> f_n </script>  , respectivamente, aquellos métodos que con un menor número de llamadas conducirán a una menor pérdida, consideraremos más aceptables. <br><br><table><tbody><tr><td align="center"> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/c0c/9de/886/c0c9de886418710c403863bc34021d9a.svg"><br></a> <br></td><td align="center"> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/311/f1b/614/311f1b6146bb4b13a4bd1db313ee1372.svg"><br></a> <br></td></tr><tr><td align="center">  a) </td><td align="center">  b) </td></tr><tr><td colspan="2" align="center">  <b>Figura 2.</b> <i>Cambio relativo en energía a), momento b), al final de la simulación del sistema</i> <math> </math><i><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-641"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-642">N</span><span class="MJXp-mo" id="MJXp-Span-643" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-644">512</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-31-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-31"> N = 512 </script></i>   <i>cuerpos por varios métodos dependiendo del número de cálculos de funciones</i> <math> </math><i><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-645"><span class="MJXp-msubsup" id="MJXp-Span-646"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-647" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-648" style="vertical-align: -0.4em;">n</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-32-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-32"> f_n </script></i>   <i>doble precisión</i> </td></tr></tbody></table><br>  De los gráficos de la Figura 2 se puede ver que la mejor relación entre la cantidad de cálculo de la función <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-649"><span class="MJXp-msubsup" id="MJXp-Span-650"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-651" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-652" style="vertical-align: -0.4em;">n</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-33-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-33"> f_n </script>  y el cambio relativo en la energía del sistema de cuerpos en los métodos Adams y Dorman-Prince de quinto orden.  También se ve que para todos los métodos con un aumento en el número de cálculos <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-653"><span class="MJXp-msubsup" id="MJXp-Span-654"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-655" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-656" style="vertical-align: -0.4em;">n</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-34-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-34"> f_n </script>  El cambio relativo en el impulso del sistema aumenta.  Para un cambio relativo en la energía, esto también es notable, pero solo para algunos métodos que podrían alcanzar el umbral <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-657"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-658">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-659">E</span><span class="MJXp-mrow" id="MJXp-Span-660"><span class="MJXp-mo" id="MJXp-Span-661" style="margin-left: 0.111em; margin-right: 0.111em;">/</span></span><span class="MJXp-msubsup" id="MJXp-Span-662"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-663" style="margin-right: 0.05em;">E</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-664" style="vertical-align: -0.4em;">0</span></span><span class="MJXp-mo" id="MJXp-Span-665" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-msubsup" id="MJXp-Span-666"><span class="MJXp-mn" id="MJXp-Span-667" style="margin-right: 0.05em;">10</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-668" style="vertical-align: 0.5em;"><span class="MJXp-mo" id="MJXp-Span-669">−</span><span class="MJXp-mn" id="MJXp-Span-670">12</span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-35-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-35"> dE / E_0 <10 ^ {- 12} </script>  .  Este efecto ya no se puede atribuir al error de los métodos, sino al error de los cálculos, y un aumento adicional en la precisión solo es posible junto con un aumento en la precisión de los cálculos con coma flotante. <br><table><tbody><tr><td align="center"> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/c8e/e99/4ba/c8ee994ba56d3dcbb7c305aad402f0e3.svg"><br></a> <br></td><td align="center"> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/745/6a2/7f4/7456a27f4253ae5ac634dcc2ebf0776d.svg"><br></a> <br></td></tr><tr><td align="center">  a) </td><td align="center">  b) </td></tr><tr><td colspan="2" align="center">  <b>Fig. 3.</b> <i>Cambio relativo en energía a), momento b), al final de la simulación del sistema</i> <math> </math><i><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-671"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-672">N</span><span class="MJXp-mo" id="MJXp-Span-673" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-674">512</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-36-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-36"> N = 512 </script></i>   <i>cuerpos por varios métodos dependiendo del número de cálculos de funciones</i> <math> </math><i><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-675"><span class="MJXp-msubsup" id="MJXp-Span-676"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-677" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-678" style="vertical-align: -0.4em;">n</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-37-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-37"> f_n </script></i>   <i>con precisión cuádruple (__float128)</i> </td></tr></tbody></table><br>  Las Figuras 3a y 3b muestran que el uso de cálculos con precisión cuádruple puede reducir las pérdidas de energía relativas hasta <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-679"><span class="MJXp-msubsup" id="MJXp-Span-680"><span class="MJXp-mn" id="MJXp-Span-681" style="margin-right: 0.05em;">10</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-682" style="vertical-align: 0.5em;"><span class="MJXp-mo" id="MJXp-Span-683">−</span><span class="MJXp-mn" id="MJXp-Span-684">23</span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-38-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-38"> 10 ^ {- 23} </script>  , pero debe comprender que el tiempo de cálculo aumenta en dos órdenes de magnitud en comparación con la precisión doble.  Como en el caso de los cálculos de doble precisión, la mejor relación de precisión y el número de cálculos de funciones <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-685"><span class="MJXp-msubsup" id="MJXp-Span-686"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-687" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-688" style="vertical-align: -0.4em;">n</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-39-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-39"> f_n </script>  poseen métodos de quinto orden Adams y Dorman-Prince. <br><br>  Los <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">métodos</a> Dorman-Prince y Werner pertenecen a la clase de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">métodos anidados</a> y pueden calcular simultáneamente dos soluciones con un orden de precisión alto y bajo (para el método Dorman-Prince, órdenes 5 y 4, y para el método Werner, órdenes 6 y 5).  Si estas dos soluciones son muy diferentes, entonces podemos dividir el paso de integración actual en otras más pequeñas.  Eso nos permite cambiar dinámicamente el paso de integración y reducirlo solo en aquellas áreas donde se requiere. <br><br>  Comparemos los métodos de quinto orden de Dorman-Prince, Werner y Adams con más detalle, durante un intervalo de simulación más largo de nuestro sistema ( <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-689"><span class="MJXp-msubsup" id="MJXp-Span-690"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-691" style="margin-right: 0.05em;">T</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-692" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-693">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-694">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-695">x</span></span></span><span class="MJXp-mo" id="MJXp-Span-696" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-697">300</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-40-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-40"> T_ {max} = 300 </script>  ) <br><table><tbody><tr><td align="center"> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/dcf/431/463/dcf431463350504334895ae590038f54.svg"><br></a> <br></td></tr><tr><td align="center">  <b>a) El</b> <i>cambio relativo en energía, momento y su momento en el proceso de modelado</i> <br></td></tr><tr><td align="center"> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/a2f/039/e55/a2f039e5575a01df083f913ab5cbb6d7.svg"><br></a> <br></td></tr><tr><td align="center">  <b>b)</b> <i>Número de cálculos de funciones</i> <math> </math><i><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-698"><span class="MJXp-msubsup" id="MJXp-Span-699"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-700" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-701" style="vertical-align: -0.4em;">n</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-41-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-41"> f_n </script></i>   <i>en el intervalo de simulación</i> <math> </math><i><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-702"><span class="MJXp-mtext" id="MJXp-Span-703">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-704">D</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-705">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-706">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-707">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-708">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-709">T</span><span class="MJXp-mo" id="MJXp-Span-710" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-711">0.3</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-42-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-42"> \ Delta T = 0.3 </script></i> <br></td></tr><tr><td align="center">  <b>Fig. 4.</b> <i>Dependencias del cambio relativo en los parámetros físicos del sistema y el número de cálculos de funciones.</i> <math> </math><i><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-712"><span class="MJXp-msubsup" id="MJXp-Span-713"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-714" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-715" style="vertical-align: -0.4em;">n</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-43-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-43"> f_n </script></i>   <i>de vez en cuando modelando con el método de paso variable Dorman-Prince</i> <math> </math><i><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-716"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-717">h</span><span class="MJXp-mo" id="MJXp-Span-718" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-719"><span class="MJXp-mn" id="MJXp-Span-720" style="margin-right: 0.05em;">10</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-721" style="vertical-align: 0.5em;"><span class="MJXp-mo" id="MJXp-Span-722">−</span><span class="MJXp-mn" id="MJXp-Span-723">5</span></span></span><span class="MJXp-mtext" id="MJXp-Span-724">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-725">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-726">u</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-727">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-728">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-729">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-730">s</span><span class="MJXp-msubsup" id="MJXp-Span-731"><span class="MJXp-mn" id="MJXp-Span-732" style="margin-right: 0.05em;">10</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-733" style="vertical-align: 0.5em;"><span class="MJXp-mo" id="MJXp-Span-734">−</span><span class="MJXp-mn" id="MJXp-Span-735">9</span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-44-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-44"> h = 10 ^ {- 5} \ puntos 10 ^ {- 9} </script></i> <br></td></tr></tbody></table><br><table><tbody><tr><td align="center"> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/db6/ed7/96b/db6ed796b48734885acac334d62bf74c.svg"><br></a> <br></td></tr><tr><td align="center">  <b>a) El</b> <i>cambio relativo en energía, momento y su momento en el proceso de modelado</i> <br></td></tr><tr><td align="center"> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/1a8/b05/599/1a8b05599c05680aa8501197f70f8d5c.svg"><br></a> <br></td></tr><tr><td align="center">  <b>b)</b> <i>Número de cálculos de funciones</i> <math> </math><i><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-736"><span class="MJXp-msubsup" id="MJXp-Span-737"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-738" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-739" style="vertical-align: -0.4em;">n</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-45-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-45"> f_n </script></i>   <i>en el intervalo de simulación</i> <math> </math><i><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-740"><span class="MJXp-mtext" id="MJXp-Span-741">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-742">D</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-743">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-744">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-745">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-746">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-747">T</span><span class="MJXp-mo" id="MJXp-Span-748" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-749">0.3</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-46-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-46"> \ Delta T = 0.3 </script></i> <br></td></tr><tr><td align="center">  <b>Fig. 5.</b> <i>Dependencias del cambio relativo en los parámetros físicos del sistema y el número de cálculos de funciones.</i> <math> </math><i><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-750"><span class="MJXp-msubsup" id="MJXp-Span-751"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-752" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-753" style="vertical-align: -0.4em;">n</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-47-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-47"> f_n </script></i>   <i>versus modelado de tiempo por el método de Werner con un paso variable</i> <math> </math><i><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-754"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-755">h</span><span class="MJXp-mo" id="MJXp-Span-756" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-757"><span class="MJXp-mn" id="MJXp-Span-758" style="margin-right: 0.05em;">10</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-759" style="vertical-align: 0.5em;"><span class="MJXp-mo" id="MJXp-Span-760">−</span><span class="MJXp-mn" id="MJXp-Span-761">5</span></span></span><span class="MJXp-mtext" id="MJXp-Span-762">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-763">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-764">u</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-765">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-766">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-767">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-768">s</span><span class="MJXp-msubsup" id="MJXp-Span-769"><span class="MJXp-mn" id="MJXp-Span-770" style="margin-right: 0.05em;">10</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-771" style="vertical-align: 0.5em;"><span class="MJXp-mo" id="MJXp-Span-772">−</span><span class="MJXp-mn" id="MJXp-Span-773">9</span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-48-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-48"> h = 10 ^ {- 5} \ puntos 10 ^ {- 9} </script></i> <br></td></tr></tbody></table><br><table><tbody><tr><td align="center"> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/f6b/b1e/832/f6bb1e8323381a14ab438133218fdcc8.svg"><br></a> <br></td></tr><tr><td align="center">  <b>Fig. 6.</b> <i>Cambio relativo en energía, momento y su momento en el proceso de modelado por el método Adams-Bashfort de quinto orden con un paso</i> <math> </math><i><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-774"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-775">h</span><span class="MJXp-mo" id="MJXp-Span-776" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-777"><span class="MJXp-mn" id="MJXp-Span-778" style="margin-right: 0.05em;">10</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-779" style="vertical-align: 0.5em;"><span class="MJXp-mo" id="MJXp-Span-780">−</span><span class="MJXp-mn" id="MJXp-Span-781">6</span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-49-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-49"> h = 10 ^ {- 6} </script></i> <br></td></tr></tbody></table><br><table><tbody><tr><td align="center"> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/fc2/19e/8fa/fc219e8fa8a9bc8dfddc4ebb5a2aeae5.svg"><br></a> <br></td></tr><tr><td align="center">  <b>Fig 7.</b> <i>Dependencias del número de cálculos de funciones.</i> <math> </math><i><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-782"><span class="MJXp-msubsup" id="MJXp-Span-783"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-784" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-785" style="vertical-align: -0.4em;">n</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-50-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-50"> f_n </script></i>   <i>para métodos Adams, Dorman-Prince y Werner de quinto orden a partir del tiempo de simulación</i> <br></td></tr></tbody></table><br>  Se puede ver que en la etapa inicial de la evolución de nuestro sistema ( <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-786"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-787">T</span><span class="MJXp-mo" id="MJXp-Span-788" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-mn" id="MJXp-Span-789">25</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-51-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-51"> T <25 </script>  ) los tres métodos muestran características similares, pero en etapas posteriores se producen algunos eventos en el sistema, como resultado de los cuales los errores en los parámetros principales del sistema (energía total, momento y su momento) saltan bruscamente.  Pero los métodos de Dorman-Prince y Werner hacen frente a estos cambios mucho mejor debido a la capacidad de reducir el paso de integración en secciones "complejas", como resultado de lo cual aumenta el número de cálculos de funciones <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-790"><span class="MJXp-msubsup" id="MJXp-Span-791"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-792" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-793" style="vertical-align: -0.4em;">n</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-52-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-52"> f_n </script>  como se ve en las Figuras 4b y 5b, pero el número total de cálculos <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-794"><span class="MJXp-msubsup" id="MJXp-Span-795"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-796" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-797" style="vertical-align: -0.4em;">n</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-53-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-53"> f_n </script>  Los métodos anidados son más pequeños que el método Adams-Bashfort, como se puede ver en la Figura 7. <br><br><div class="spoiler">  <b class="spoiler_title">Me pregunto qué pasó con el sistema en estos momentos.</b> <div class="spoiler_text"><table><tbody><tr><td align="center"><iframe width="560" height="315" src="https://www.youtube.com/embed/ZPyM6PRXjkY" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br></td></tr><tr><td align="center">  <b>Video 1.</b> <i>Modelado de un sistema de 512 cuerpos.</i>  <i>Método Dorman-Prince.</i>  <i>Paso dinámico</i> <math> </math><i><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-798"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-799">h</span><span class="MJXp-mo" id="MJXp-Span-800" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-801"><span class="MJXp-mn" id="MJXp-Span-802" style="margin-right: 0.05em;">10</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-803" style="vertical-align: 0.5em;"><span class="MJXp-mo" id="MJXp-Span-804">−</span><span class="MJXp-mn" id="MJXp-Span-805">5</span></span></span><span class="MJXp-mtext" id="MJXp-Span-806">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-807">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-808">u</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-809">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-810">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-811">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-812">s</span><span class="MJXp-msubsup" id="MJXp-Span-813"><span class="MJXp-mn" id="MJXp-Span-814" style="margin-right: 0.05em;">10</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-815" style="vertical-align: 0.5em;"><span class="MJXp-mo" id="MJXp-Span-816">−</span><span class="MJXp-mn" id="MJXp-Span-817">9</span></span></span></span></span><script type="math/tex" id="MathJax-Element-54"> h = 10 ^ {- 5} \ puntos 10 ^ {- 9} </script></i> <br></td></tr></tbody></table><br></div></div><br>  El video demuestra eso hasta el momento <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-818"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-819">T</span><span class="MJXp-mo" id="MJXp-Span-820" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-821">25</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-55-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-55"> T = 25 </script>  el movimiento es relativamente tranquilo, y después de una colisión de los centros de las "galaxias", lo que conduce a un cambio brusco en las trayectorias y un fuerte aumento en las velocidades de algunas partículas.  Además, para mantener la precisión de la solución, es necesario reducir el paso de integración.  Los métodos anidados pueden hacer esto automáticamente; los gráficos muestran que en algunas partes de la evolución del sistema, el paso de integración se redujo en casi dos órdenes de magnitud con <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-822"><span class="MJXp-msubsup" id="MJXp-Span-823"><span class="MJXp-mn" id="MJXp-Span-824" style="margin-right: 0.05em;">10</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-825" style="vertical-align: 0.5em;"><span class="MJXp-mo" id="MJXp-Span-826">−</span><span class="MJXp-mn" id="MJXp-Span-827">5</span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-56-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-56"> 10 ^ {- 5} </script>  antes <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-828"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-829">h</span><span class="MJXp-mo" id="MJXp-Span-830" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-831"><span class="MJXp-mn" id="MJXp-Span-832" style="margin-right: 0.05em;">10</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-833" style="vertical-align: 0.5em;"><span class="MJXp-mo" id="MJXp-Span-834">−</span><span class="MJXp-mn" id="MJXp-Span-835">7</span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-57-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-57"> h = 10 ^ {- 7} </script>  .  Al usar el método Adams y tal paso en todo el intervalo de la evolución del sistema, no hubiéramos esperado una solución. <br><br><h4>  Resumen </h4><br>  Para la solución, es mejor utilizar métodos anidados que le permitan controlar dinámicamente el paso de integración y reducirlo solo en secciones "complejas" de la trayectoria. <br><br>  No persiga los métodos de orden superior.  Incluso cuando usan el tipo de datos 'doble', no alcanzan sus capacidades potenciales, el uso de los tipos de datos con mayor precisión aumenta en gran medida el tiempo que lleva resolver el problema. <br><br><h2>  Implementación de la CPU </h2><br>  Ahora que la elección de un método para resolver ecuaciones está definida, intentemos calcular el cálculo de la fuerza de interacción para cada partícula.  Obtenemos un doble ciclo para todas las partículas: <br><br><div class="spoiler">  <b class="spoiler_title">Código de implementación 'simple'</b> <div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> body1 = <span class="hljs-number"><span class="hljs-number">0</span></span>; body1 &lt; count; ++body1) { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> nbvertex_t </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">v1</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(rx[ body1 ], ry[ body1 ], rz[ body1 ])</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">nbvertex_t</span></span> total_force; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> body2 = <span class="hljs-number"><span class="hljs-number">0</span></span>; body2 != count; ++body2) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(body1 == body2) { <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> nbvertex_t </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">v2</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(rx[ body2 ], ry[ body2 ], rz[ body2 ])</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> nbvertex_t </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">force</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(m_data-&gt;force(v1, v2, mass[body1], mass[body2]))</span></span></span></span>; total_force += force; } frx[body1] = vx[body1]; fry[body1] = vy[body1]; frz[body1] = vz[body1]; fvx[body1] = total_force.x / mass[body1]; fvy[body1] = total_force.y / mass[body1]; fvz[body1] = total_force.z / mass[body1]; }</code> </pre> <br></div></div><br>  Las fuerzas gravitacionales para cada cuerpo se calculan de forma independiente, y para usar todos los núcleos del procesador, es suficiente escribir la directiva OpenMP antes del primer ciclo: <br><br><div class="spoiler">  <b class="spoiler_title">Un fragmento de código de la implementación de 'openmp'</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">pragma</span></span></span><span class="hljs-meta"> omp parallel for for(size_t body1 = 0; body1 &lt; count; ++body1)</span></span></code> </pre><br></div></div><br>  Porque  Dado que cada cuerpo interactúa con cada uno, para reducir la cantidad de interacciones del procesador con la RAM y mejorar el uso de la memoria caché, tenemos la capacidad de cargar parte de los datos en la memoria caché y usarla repetidamente: <br><br><div class="spoiler">  <b class="spoiler_title">Código de implementación 'openmp + block'</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">pragma</span></span></span><span class="hljs-meta"> omp parallel for for(size_t n1 = 0; n1 </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt; count; n1 += BLOCK_SIZE) { nbcoord_t x1[BLOCK_SIZE]; nbcoord_t y1[BLOCK_SIZE]; nbcoord_t z1[BLOCK_SIZE]; nbcoord_t m1[BLOCK_SIZE]; nbvertex_t total_force[BLOCK_SIZE]; for(size_t b1 = 0; b1 != BLOCK_SIZE; ++b1) { size_t local_n1 = b1 + n1; x1[b1] = rx[local_n1]; y1[b1] = ry[local_n1]; z1[b1] = rz[local_n1]; m1[b1] = mass[local_n1]; } for(size_t n2 = 0; n2 &lt; count; n2 += BLOCK_SIZE) { nbcoord_t x2[BLOCK_SIZE]; nbcoord_t y2[BLOCK_SIZE]; nbcoord_t z2[BLOCK_SIZE]; nbcoord_t m2[BLOCK_SIZE]; for(size_t b2 = 0; b2 != BLOCK_SIZE; ++b2) { size_t local_n2 = b2 + n2; x2[b2] = rx[local_n2]; y2[b2] = ry[local_n2]; z2[b2] = rz[local_n2]; m2[b2] = mass[n2 + b2]; } for(size_t b1 = 0; b1 != BLOCK_SIZE; ++b1) { const nbvertex_t v1(x1[ b1 ], y1[ b1 ], z1[ b1 ]); for(size_t b2 = 0; b2 != BLOCK_SIZE; ++b2) { const nbvertex_t v2(x2[ b2 ], y2[ b2 ], z2[ b2 ]); const nbvertex_t force(m_data-&gt;force(v1, v2, m1[b1], m2[b2])); total_force[b1] += force; } } } for(size_t b1 = 0; b1 != BLOCK_SIZE; ++b1) { size_t local_n1 = b1 + n1; frx[local_n1] = vx[local_n1]; fry[local_n1] = vy[local_n1]; frz[local_n1] = vz[local_n1]; fvx[local_n1] = total_force[b1].x / m1[b1]; fvy[local_n1] = total_force[b1].y / m1[b1]; fvz[local_n1] = total_force[b1].z / m1[b1]; } }</span></span></span></span></code> </pre><br></div></div><br>  Una optimización adicional consiste en extraer el contenido de la función de calcular la fuerza en el ciclo principal y eliminar la división y multiplicación por la masa corporal m1 [b1].  Además del hecho de que hemos reducido un poco los cálculos, el compilador podrá aplicar instrucciones vectoriales del procesador SSE y AVX en un ciclo tan extendido. <br><br><div class="spoiler">  <b class="spoiler_title">Código de implementación 'openmp + block + optimization'</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">pragma</span></span></span><span class="hljs-meta"> omp parallel for for(size_t n1 = 0; n1 &lt; count; n1 += BLOCK_SIZE) { nbcoord_t x1[BLOCK_SIZE]; nbcoord_t y1[BLOCK_SIZE]; nbcoord_t z1[BLOCK_SIZE]; nbcoord_t total_force_x[BLOCK_SIZE]; nbcoord_t total_force_y[BLOCK_SIZE]; nbcoord_t total_force_z[BLOCK_SIZE]; for(size_t b1 = 0; b1 != BLOCK_SIZE; ++b1) { size_t local_n1 = b1 + n1; x1[b1] = rx[local_n1]; y1[b1] = ry[local_n1]; z1[b1] = rz[local_n1]; total_force_x[b1] = 0; total_force_y[b1] = 0; total_force_z[b1] = 0; } for(size_t n2 = 0; n2 &lt; count; n2 += BLOCK_SIZE) { nbcoord_t x2[BLOCK_SIZE]; nbcoord_t y2[BLOCK_SIZE]; nbcoord_t z2[BLOCK_SIZE]; nbcoord_t m2[BLOCK_SIZE]; for(size_t b2 = 0; b2 != BLOCK_SIZE; ++b2) { size_t local_n2 = b2 + n2; x2[b2] = rx[local_n2]; y2[b2] = ry[local_n2]; z2[b2] = rz[local_n2]; m2[b2] = mass[n2 + b2]; } for(size_t b1 = 0; b1 != BLOCK_SIZE; ++b1) { for(size_t b2 = 0; b2 != BLOCK_SIZE; ++b2) { nbcoord_t dx = x1[b1] - x2[b2]; nbcoord_t dy = y1[b1] - y2[b2]; nbcoord_t dz = z1[b1] - z2[b2]; nbcoord_t r2(dx * dx + dy * dy + dz * dz); </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta">(r2 &lt; NBODY_MIN_R) { r2 = NBODY_MIN_R; } nbcoord_t r = sqrt(r2); nbcoord_t coeff = (m2[b2]) / (r * r2); dx *= coeff; dy *= coeff; dz *= coeff; total_force_x[b1] -= dx; total_force_y[b1] -= dy; total_force_z[b1] -= dz; } } } for(size_t b1 = 0; b1 != BLOCK_SIZE; ++b1) { size_t local_n1 = b1 + n1; frx[local_n1] = vx[local_n1]; fry[local_n1] = vy[local_n1]; frz[local_n1] = vz[local_n1]; fvx[local_n1] = total_force_x[b1]; fvy[local_n1] = total_force_y[b1]; fvz[local_n1] = total_force_z[b1]; } }</span></span></code> </pre><br></div></div><br>  <b>Tabla 2.</b> <i>Dependencia del tiempo de cálculo (en segundos) de la función</i> <math> </math><i><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-836"><span class="MJXp-msubsup" id="MJXp-Span-837"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-838" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-839" style="vertical-align: -0.4em;">n</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-58-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-58"> f_n </script></i>   <i>sobre la cantidad de cuerpos que interactúan</i> <math> </math><i><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-840"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-841">N</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-59-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-59"> N </script></i>   <i>para diversas implementaciones de CPU</i> <br><table><tbody><tr><th><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-842"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-843">N</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-60-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-60"> N </script></th><th>  2048 </th><th>  4096 </th><th>  8192 </th><th>  16384 </th><th>  32768 </th></tr><tr><td>  simple </td><td>  0,0425 </td><td>  0.1651 </td><td>  0.6594 </td><td>  2,65 </td><td>  10,52 </td></tr><tr><td>  Openmp </td><td>  0.0078 </td><td>  0,0260 </td><td>  0,1079 </td><td>  0.417 </td><td>  1.655 </td></tr><tr><td>  openmp + block + optimización </td><td>  0.0037 </td><td>  0,0128 </td><td>  0,0495 </td><td>  0,194 </td><td>  0,774 </td></tr></tbody></table><br><div class="spoiler">  <b class="spoiler_title">Parámetros del sistema:</b> <div class="spoiler_text"><ul><li>  sistema: <i>Debian 9, Intel Core i7-5820K (6 núcleos)</i> </li><li>  compilador: <i>gcc 6.3.0</i> </li></ul><br></div></div><br>  Se ve claramente que la versión con soporte de OpenMP se acelera seis veces, exactamente en términos de la cantidad de núcleos, y la versión optimizada es más rápida un poco más de dos veces.  Entonces, con la optimización, no debe confiar solo en la concurrencia.  Curiosamente, en los cálculos de flujo único, el procesador trabajó a una frecuencia de 3.6 GHz, en la versión paralela (openmp) bajó la frecuencia a 3.4 GHz, y en el paralelo y optimizado (openmp + block + optimización) bajó a 3.3 GHz, pero esto no le impedía trabajar 13,6 veces más rápido.  También se ve que un aumento en el tiempo de cálculo con un aumento en el tamaño del problema es cuadrático, y un aumento adicional <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-844"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-845">N</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-61-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-61"> N </script>  hace que la tarea sea insoluble en un tiempo razonable. <br><br><h2>  Implementación de GPU </h2><br>  Pero existe el deseo de hacer cálculos aún más rápidos.  Hay varias direcciones disponibles para la aceleración: cálculo de GPU, aproximación de funciones <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-846"><span class="MJXp-msubsup" id="MJXp-Span-847"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-848" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-849" style="vertical-align: -0.4em;">n</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-62-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-62"> f_n </script>  .  Primero, para la informática de GPU, elegí la tecnología OpenCL.  Para un trabajo más conveniente, se <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">utilizó la</a> biblioteca <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">CLHPP</a> .  La principal ventaja de OpenCL es que el código se puede ejecutar en el procesador y en la GPU, lo que simplifica la escritura y la depuración, además de expandir la lista de hardware para ejecutar.  La herramienta <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Oclgrind</a> ayuda en la depuración, que en tiempo de ejecución muestra llamadas incorrectas a la API OpenCL y problemas de acceso a la memoria. <br><br><h4>  Opencl </h4><br>  Para comenzar con OpenCL, debe obtener una lista de las plataformas disponibles.  Las plataformas más comunes son AMD, Intel y NVidia. <br><br><div class="spoiler">  <b class="spoiler_title">Código</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;cl::Platform&gt; platforms; cl::Platform::get(&amp;platforms);</code> </pre><br></div></div><br>  Luego, después de elegir una plataforma, debe seleccionar el dispositivo informático que representa esta plataforma: <br><br><div class="spoiler">  <b class="spoiler_title">Código</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> cl::<span class="hljs-function"><span class="hljs-function">Platform&amp; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">platform</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(platforms[platform_n])</span></span></span></span>; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;cl::Device&gt; all_devices; platform.getDevices(CL_DEVICE_TYPE_ALL, &amp;all_devices);</code> </pre><br></div></div><br>  Y al final de la fase preparatoria, es necesario crear un contexto y colas dentro de las cuales se asignará la memoria y se realizarán los cálculos.  Por ejemplo, un contexto que combina todos los dispositivos informáticos de una plataforma seleccionada se crea de la siguiente manera: <br><br><div class="spoiler">  <b class="spoiler_title">Contexto y código de creación de cola</b> <div class="spoiler_text"><pre> <code class="cpp hljs">cl::<span class="hljs-function"><span class="hljs-function">Context </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">context</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(all_devices)</span></span></span></span>; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;cl::CommandQueue&gt; queues; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(cl::Device device: all_devices) queues.push_back(cl::CommandQueue(context, device));</code> </pre><br></div></div><br>  Para descargar el código fuente a un dispositivo informático, debe compilarse, la clase cl :: Program está destinada a esto. <br><br><div class="spoiler">  <b class="spoiler_title">Código de compilación del núcleo</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> &gt; source_data; cl::Program::Sources sources; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i != files.size(); ++i) { source_data.push_back(load_program(files[i]));<span class="hljs-comment"><span class="hljs-comment">//   sources.push_back(std::make_pair(source_data.back().data(), source_data.back().size())); } cl::Program prog(context, sources); devices.push_back(all_devices); prog.build(devices, options);</span></span></code> </pre><br></div></div><br>  Para describir los parámetros de una función (kernel) que se ejecuta en un dispositivo informático, hay una plantilla cl: make_kernel. <br><br><div class="spoiler">  <b class="spoiler_title">Ejemplo de núcleo de cálculo de fuerza de interacción</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> cl::make_kernel&lt; cl_int, cl_int, <span class="hljs-comment"><span class="hljs-comment">//Block offset cl::Buffer, //mass cl::Buffer, //y cl::Buffer, //f cl_int, cl_int, //yoff,foff cl_int, cl_int //points_count,stride &gt; ComputeBlock;</span></span></code> </pre><br></div></div><br>  Además, todo es simple: declaramos una variable con el tipo de núcleo, pasamos el programa compilado y el nombre del núcleo computacional, podemos iniciar el núcleo casi como una función normal. <br><br><div class="spoiler">  <b class="spoiler_title">Código de lanzamiento del kernel</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">ComputeBlock </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fcompute</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(prog, </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"ComputeBlockLocal"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; cl::<span class="hljs-function"><span class="hljs-function">NDRange </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">global_range</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(device_data_size)</span></span></span></span>; cl::<span class="hljs-function"><span class="hljs-function">NDRange </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">local_range</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(block_size)</span></span></span></span>; cl::<span class="hljs-function"><span class="hljs-function">EnqueueArgs </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">eargs</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ctx.m_queue, global_range, local_range)</span></span></span></span>; fcompute(eargs, ...  ); <span class="hljs-comment"><span class="hljs-comment">//,   .</span></span></code> </pre><br></div></div><br>  El núcleo computacional para OpenCL en sí es muy similar a la opción 'openmp + block + optimization' para la CPU, solo que a diferencia de la versión de la CPU, el primer ciclo se controla usando OpenCL (el rango del ciclo está determinado por la variable global_range del código de inicio del kernel, y el número de iteración actual está disponible desde el kernel utilizando la función get_global_id (0)).  Primero, parte de los datos del cuerpo se cargan desde la memoria local y luego se procesan.  La memoria local es común a todos los subprocesos del grupo, por lo que la descarga se produce una vez para el grupo y cada subproceso del grupo la procesa y, dado que  la memoria local es mucho más rápida que la global, los cálculos son mucho más rápidos. <br><br><div class="spoiler">  <b class="spoiler_title">Código del núcleo</b> <div class="spoiler_text"><pre> <code class="cpp hljs">__<span class="hljs-function"><span class="hljs-function">kernel </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ComputeBlockLocal</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> offset_n1, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> offset_n2, __global </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">nbcoord_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* mass, __global </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">nbcoord_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* y, __global </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">nbcoord_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* f, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> yoff, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> foff, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> points_count, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> stride)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> n1 = get_global_id(<span class="hljs-number"><span class="hljs-number">0</span></span>) + offset_n1; __global <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span>* rx = y + yoff; __global <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span>* ry = rx + stride; __global <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span>* rz = rx + <span class="hljs-number"><span class="hljs-number">2</span></span> * stride; __global <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span>* vx = rx + <span class="hljs-number"><span class="hljs-number">3</span></span> * stride; __global <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span>* vy = rx + <span class="hljs-number"><span class="hljs-number">4</span></span> * stride; __global <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span>* vz = rx + <span class="hljs-number"><span class="hljs-number">5</span></span> * stride; __global <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span>* frx = f + foff; __global <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span>* fry = frx + stride; __global <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span>* frz = frx + <span class="hljs-number"><span class="hljs-number">2</span></span> * stride; __global <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span>* fvx = frx + <span class="hljs-number"><span class="hljs-number">3</span></span> * stride; __global <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span>* fvy = frx + <span class="hljs-number"><span class="hljs-number">4</span></span> * stride; __global <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span>* fvz = frx + <span class="hljs-number"><span class="hljs-number">5</span></span> * stride; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> x1 = rx[n1]; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> y1 = ry[n1]; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> z1 = rz[n1]; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> res_x = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> res_y = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> res_z = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; __local <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> x2[NBODY_DATA_BLOCK_SIZE]; __local <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> y2[NBODY_DATA_BLOCK_SIZE]; __local <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> z2[NBODY_DATA_BLOCK_SIZE]; __local <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> m2[NBODY_DATA_BLOCK_SIZE]; <span class="hljs-comment"><span class="hljs-comment">// NB! get_local_size(0) == NBODY_DATA_BLOCK_SIZE for(int b2 = 0; b2 &lt; points_count; b2 += NBODY_DATA_BLOCK_SIZE) { int n2 = b2 + offset_n2 + get_local_id(0); // Copy data block to local memory x2[ get_local_id(0) ] = rx[n2]; y2[ get_local_id(0) ] = ry[n2]; z2[ get_local_id(0) ] = rz[n2]; m2[ get_local_id(0) ] = mass[n2]; // Synchronize local work-items copy operations barrier(CLK_LOCAL_MEM_FENCE); nbcoord_t local_res_x = 0.0; nbcoord_t local_res_y = 0.0; nbcoord_t local_res_z = 0.0; for(int local_n2 = 0; local_n2 != NBODY_DATA_BLOCK_SIZE; ++local_n2) { nbcoord_t dx = x1 - x2[local_n2]; nbcoord_t dy = y1 - y2[local_n2]; nbcoord_t dz = z1 - z2[local_n2]; nbcoord_t r2 = (dx * dx + dy * dy + dz * dz); if(r2 &lt; NBODY_MIN_R) { r2 = NBODY_MIN_R; } nbcoord_t r = sqrt(r2); nbcoord_t coeff = (m2[local_n2]) / (r * r2); dx *= coeff; dy *= coeff; dz *= coeff; local_res_x -= dx; local_res_y -= dy; local_res_z -= dz; } // Synchronize local work-items computations barrier(CLK_LOCAL_MEM_FENCE); res_x += local_res_x; res_y += local_res_y; res_z += local_res_z; } frx[n1] = vx[n1]; fry[n1] = vy[n1]; frz[n1] = vz[n1]; fvx[n1] = res_x; fvy[n1] = res_y; fvz[n1] = res_z; }</span></span></code> </pre><br></div></div><br><h4>  Cuda </h4><br>  La implementación de la plataforma NVidia CUDA es un poco más simple que OpenCL, no necesitamos crear el contexto del dispositivo y administrar la cola de ejecución nosotros mismos (al menos hasta que queramos hacer una implementación multi-GPU).  Como en el caso de OpenCL, necesitamos asignar memoria en la GPU, copiar nuestros datos en ella y luego podemos iniciar el núcleo informático. <br><br>  Puede leer más sobre trabajar con CUDA <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aquí</a> . <br><br><div class="spoiler">  <b class="spoiler_title">Código de lanzamiento del kernel de CUDA</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">dim3 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">grid</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(count / block_size)</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">dim3 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">block</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(block_size)</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> shared_size(<span class="hljs-number"><span class="hljs-number">4</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span>) * block_size); kfcompute &lt;&lt;&lt; grid, block, shared_size &gt;&gt;&gt; (... ...);</code> </pre><br></div></div><br>  A diferencia de OpenCL, CUDA no especifica el rango completo de iteraciones (en la implementación de OpenCL es global_range), pero establece el tamaño de cuadrícula y los tamaños de bloque en la cuadrícula, en consecuencia, el cálculo del número de cuerpo actual cambia ligeramente, de lo contrario, el núcleo es muy similar a OpenCL, con la excepción de otros nombres funciones de sincronización y especificación para memoria compartida.  Otra característica distintiva útil de CUDA es que podemos especificar el tamaño requerido de memoria compartida cuando se inicia el núcleo.  Al igual que en la implementación de OpenCL, al comienzo de cada bloque de iteración copiamos parte de los datos en la memoria compartida y luego trabajamos con esta memoria desde todos los hilos del bloque. <br><br><div class="spoiler">  <b class="spoiler_title">Código del núcleo CUDA</b> <div class="spoiler_text"><pre> <code class="cpp hljs">__<span class="hljs-function"><span class="hljs-function">global__ </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">kfcompute</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> offset_n2, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">nbcoord_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* y, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> yoff, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">nbcoord_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* f, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> foff, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">nbcoord_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* mass, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> points_count, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> stride)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> n1 = blockDim.x * blockIdx.x + threadIdx.x; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span>* rx = y + yoff; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span>* ry = rx + stride; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span>* rz = rx + <span class="hljs-number"><span class="hljs-number">2</span></span> * stride; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> x1 = rx[n1]; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> y1 = ry[n1]; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> z1 = rz[n1]; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> res_x = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> res_y = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> res_z = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">extern</span></span> __shared__ <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> shared_xyzm_buf[]; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span>* x2 = shared_xyzm_buf; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span>* y2 = x2 + blockDim.x; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span>* z2 = y2 + blockDim.x; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span>* m2 = z2 + blockDim.x; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> b2 = <span class="hljs-number"><span class="hljs-number">0</span></span>; b2 &lt; points_count; b2 += blockDim.x) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> n2 = b2 + offset_n2 + threadIdx.x; <span class="hljs-comment"><span class="hljs-comment">// Copy data block to local memory x2[ threadIdx.x ] = rx[n2]; y2[ threadIdx.x ] = ry[n2]; z2[ threadIdx.x ] = rz[n2]; m2[ threadIdx.x ] = mass[n2]; // Synchronize local work-items copy operations __syncthreads(); nbcoord_t local_res_x = 0.0; nbcoord_t local_res_y = 0.0; nbcoord_t local_res_z = 0.0; for(int n2 = 0; n2 != blockDim.x; ++n2) { nbcoord_t dx = x1 - x2[n2]; nbcoord_t dy = y1 - y2[n2]; nbcoord_t dz = z1 - z2[n2]; nbcoord_t r2 = (dx * dx + dy * dy + dz * dz); if(r2 &lt; NBODY_MIN_R) { r2 = NBODY_MIN_R; } nbcoord_t r = sqrt(r2); nbcoord_t coeff = (m2[n2]) / (r * r2); dx *= coeff; dy *= coeff; dz *= coeff; local_res_x -= dx; local_res_y -= dy; local_res_z -= dz; } // Synchronize local work-items computations __syncthreads(); res_x += local_res_x; res_y += local_res_y; res_z += local_res_z; } n1 += foff; f[n1 + 3 * stride] = res_x; f[n1 + 4 * stride] = res_y; f[n1 + 5 * stride] = res_z; }</span></span></code> </pre><br></div></div><br>  <b>Tabla 3.</b> <i>La dependencia de la función de tiempo de cálculo (en segundos)</i> <math> </math><i><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-850"><span class="MJXp-msubsup" id="MJXp-Span-851"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-852" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-853" style="vertical-align: -0.4em;">n</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-63-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-63"> f_n </script></i>   <i>sobre la cantidad de cuerpos que interactúan</i> <math> </math><i><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-854"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-855">N</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-64-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-64"> N </script></i>   <i>para diversas implementaciones de GPU y mejores implementaciones de CPU</i> <br><table><tbody><tr><th><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-856"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-857">N</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-65-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-65"> N </script></th><th>  4096 </th><th>  8192 </th><th>  16384 </th><th>  32768 </th><th>  65536 </th><th>  131072 </th></tr><tr><td>  openmp + block + optimización </td><td>  0,0128 </td><td>  0,0495 </td><td>  0,194 </td><td>  0,774 </td><td>  --- </td><td>  --- </td></tr><tr><td>  OpenCL + half NVidia K80 </td><td>  0.004 </td><td>  0.008 </td><td>  0,026 </td><td>  0,134 </td><td>  0.322 </td><td>  1,18 </td></tr><tr><td>  CUDA + half NVidia K80 </td><td>  0.004 </td><td>  0.008 </td><td>  0,0245 </td><td>  0,115 </td><td>  0.291 </td><td>  1.13 </td></tr></tbody></table><br><div class="spoiler">  <b class="spoiler_title">Donde conseguir NVidia K80</b> <div class="spoiler_text">  Las implementaciones de OpenCL y CUDA se lanzaron en el servicio gratuito <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Colab de</a> Google, que proporciona acceso a las computadoras NVidia K80.  Puede leer más sobre cómo trabajar con este servicio en el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">concentrador</a> <br></div></div><br>  En general, el resultado es decepcionante, solo 5-6 veces más rápido que la implementación de la CPU.  Incluso si realizamos cálculos en todo el K80, obtendremos una aceleración de hasta 12 veces, pero desde  Dado que la complejidad de la tarea es cuadrática, en un tiempo razonable podremos procesar no 32768 cuerpos interactuando, sino 131072, que es solo 4 veces más. <br><br><h2>  Aproximación de funciones <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-858"><span class="MJXp-msubsup" id="MJXp-Span-859"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-860" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-861" style="vertical-align: -0.4em;">n</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-66-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-66"> f_n </script></h2><br>  Si observa de cerca la función, que se establece por la fuerza de atracción de dos cuerpos, está claro que disminuye cuadráticamente con la distancia.  Por lo tanto, podemos calcular con precisión la fuerza de interacción entre cuerpos cercanos, y aproximadamente entre cuerpos distantes.  Un enfoque famoso <br>  es un algoritmo de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">código de árbol</a> propuesto por D. Barnes y P. Hat.  Se construye un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">árbol de octree</a> en el espacio simulado, que contiene en sus hojas las coordenadas y masas de los cuerpos simulados.  Los nodos principales contienen el centro de masa, la masa total de los nodos secundarios y el radio de la esfera descrita alrededor de los cuerpos de los nodos secundarios.  La raíz del árbol contiene el centro de masa de todos los cuerpos, su masa total y el radio de la esfera que se describe a su alrededor.  Al calcular la fuerza de interacción, la distancia a la raíz del árbol se considera primero si la relación de la distancia al nodo a su radio es mayor que alguna constante <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-862"><span class="MJXp-mtext" id="MJXp-Span-863">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-864">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-865">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-866">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-867">b</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-868">d</span><span class="MJXp-msubsup" id="MJXp-Span-869"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-870" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-871" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-872">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-873">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-874">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-875">t</span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-67-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-67"> \ lambda_ {crit} </script>  , entonces la raíz se considera un cuerpo con coordenadas iguales a las coordenadas del centro de masa de los cuerpos incluidos en él, y una masa igual a la suma de las masas de los nodos hijos, si la relación es menor o igual a <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-876"><span class="MJXp-mtext" id="MJXp-Span-877">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-878">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-879">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-880">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-881">b</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-882">d</span><span class="MJXp-msubsup" id="MJXp-Span-883"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-884" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-885" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-886">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-887">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-888">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-889">t</span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-68-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-68"> \ lambda_ {crit} </script>  , el procedimiento se repite recursivamente para cada nodo secundario.  Si se alcanza la hoja de un árbol, la fuerza de interacción se considera de la manera habitual.  Por lo tanto, si un cuerpo está muy alejado del grupo compacto de otros cuerpos, este grupo se le presenta como un cuerpo, y la fuerza de interacción se calcula no hasta cada cuerpo, sino solo hasta un cuerpo.  Debido a esto, la complejidad del algoritmo disminuye con <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-890"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-891">O</span><span class="MJXp-mo" id="MJXp-Span-892" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-893"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-894" style="margin-right: 0.05em;">N</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-895" style="vertical-align: 0.5em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-896" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-69-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-69"> O (N ^ 2) </script>  antes <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-897"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-898">O</span><span class="MJXp-mo" id="MJXp-Span-899" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-900">N</span><span class="MJXp-mtext" id="MJXp-Span-901">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-902">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-903">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-904">g</span><span class="MJXp-mo" id="MJXp-Span-905" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-906">N</span><span class="MJXp-mo" id="MJXp-Span-907" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-908" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-70-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-70"> O (N \ log (N)) </script>  a costa de alguna pérdida de precisión. <br><br>  En mi enfoque, decidí no usar el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">árbol de</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">octree</a> , sino el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">árbol de kd,</a> porque  es más fácil de usar y tiene menos gastos de almacenamiento en comparación con el octree. <br><br>  Volvamos a la implementación en la CPU.  Un nodo de árbol kd se puede representar en forma de una clase que contiene punteros a los descendientes izquierdo y derecho e información sobre las coordenadas y la masa: <br><br><div class="spoiler">  <b class="spoiler_title">Nodo de árbol Kd</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">node</span></span></span><span class="hljs-class"> {</span></span> node* m_left; <span class="hljs-comment"><span class="hljs-comment">//!&lt;   node* m_right; //!&lt;   nbvertex_t m_mass_center; //!&lt;     nbcoord_t m_mass; //!&lt;   nbcoord_t m_radius_sqr; //!&lt;    ,   lambda_crit nbvertex_t m_bmin; //!&lt;     nbvertex_t m_bmax; //!&lt;     size_t m_body_n; //!&lt;  ,    };</span></span></code> </pre><br></div></div><br>  Con este método de almacenamiento del árbol, tenemos dos opciones posibles para atravesar el árbol: usar la recursividad explícita o usar la pila nosotros mismos.  Me decidí por la segunda opción. <br><br><div class="spoiler">  <b class="spoiler_title">Cálculo de la fuerza de interacción atravesando un árbol</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">nbvertex_t</span></span> force_compute(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nbvertex_t</span></span>&amp; v1, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> mass1) { <span class="hljs-keyword"><span class="hljs-keyword">nbvertex_t</span></span> total_force; node* stack_data[MAX_STACK_SIZE] = {}; node** <span class="hljs-built_in"><span class="hljs-built_in">stack</span></span> = stack_data; node** stack_head = <span class="hljs-built_in"><span class="hljs-built_in">stack</span></span>; *<span class="hljs-built_in"><span class="hljs-built_in">stack</span></span>++ = m_root; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">stack</span></span> != stack_head) { node* curr = *--<span class="hljs-built_in"><span class="hljs-built_in">stack</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> nbcoord_t </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">distance_sqr</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">((v1 - curr-&gt;m_mass_center).norm())</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(distance_sqr &gt; curr-&gt;m_radius_sqr) {<span class="hljs-comment"><span class="hljs-comment">//  ,       total_force += force(v1, curr-&gt;m_mass_center, mass1, curr-&gt;m_mass); } else {//   ,      if(curr-&gt;m_right != NULL) { *stack++ = curr-&gt;m_right; } if(curr-&gt;m_left != NULL) { *stack++ = curr-&gt;m_left; } } } return total_force; }</span></span></code> </pre><br></div></div><br>  Como en el caso de la implementación de CPU "exacta", se llama a la función de cálculo de fuerza para cada cuerpo.  El ciclo en todos los cuerpos se puede paralelizar fácilmente con las directivas OpenMP. <br><br>  Pero las iteraciones de bucle vecino en este caso se referirán a partes completamente diferentes del árbol, lo que no permite el uso eficiente de la memoria caché del procesador.  Para superar este problema, todos los cuerpos deben atravesarse no en el orden original, sino en el orden en que se ubican en las hojas del árbol kd, entonces se producirán iteraciones vecinas para los cuerpos que están cerca del espacio, y atravesarán el árbol a lo largo de casi los mismos caminos. <br><br><div class="spoiler">  <b class="spoiler_title">Transversal de la hoja del árbol</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Visitor</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">void</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">traverse</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Visitor</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">visit</span></span></span><span class="hljs-class">) {</span></span> node* stack_data[MAX_STACK_SIZE] = {}; node** <span class="hljs-built_in"><span class="hljs-built_in">stack</span></span> = stack_data; node** stack_head = <span class="hljs-built_in"><span class="hljs-built_in">stack</span></span>; *<span class="hljs-built_in"><span class="hljs-built_in">stack</span></span>++ = m_root; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">stack</span></span> != stack_head) { node* curr = *--<span class="hljs-built_in"><span class="hljs-built_in">stack</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(curr-&gt;m_radius_sqr &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) {<span class="hljs-comment"><span class="hljs-comment">//  .    . if(curr-&gt;m_left != NULL) { *stack++ = curr-&gt;m_left; } if(curr-&gt;m_right != NULL) { *stack++ = curr-&gt;m_right; } } else {//   .  . visit(curr-&gt;m_body_n, curr-&gt;m_mass_center, curr-&gt;m_mass); } } }</span></span></code> </pre><br></div></div><br>  Esta implementación tiene otro problema: no hay una forma universal de paralelizar tal recorrido de árbol.  Pero podemos cambiar completamente la forma en que se almacena el árbol en la memoria: podemos almacenar todos los nodos en una matriz lineal y abandonar por completo el almacenamiento de punteros a los descendientes, por analogía con la construcción de un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">montón binario</a> .  Al comenzar la numeración de nodos con <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-909"><span class="MJXp-mn" id="MJXp-Span-910">1</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-71-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-71"> 1 </script>  si el nodo está en el número de celda <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-911"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-912">i</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-72-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-72"> i </script>  , entonces su hijo izquierdo está en la celda <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-913"><span class="MJXp-mn" id="MJXp-Span-914">2</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-915">i</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-73-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-73"> 2i </script>  , niño derecho en la celda <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-916"><span class="MJXp-mn" id="MJXp-Span-917">2</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-918">i</span><span class="MJXp-mo" id="MJXp-Span-919" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-920">1</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-74-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-74"> 2i + 1 </script>  y el padre en la celda <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-921"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-922">i</span><span class="MJXp-mrow" id="MJXp-Span-923"><span class="MJXp-mo" id="MJXp-Span-924" style="margin-left: 0.111em; margin-right: 0.111em;">/</span></span><span class="MJXp-mn" id="MJXp-Span-925">2</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-75-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-75"> i / 2 </script>  .  El nodo derecho correspondiente a la izquierda con el número <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-926"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-927">i</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-76-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-76"> i </script>  tendrá un número <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-928"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-929">i</span><span class="MJXp-mo" id="MJXp-Span-930" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-931">1</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-77-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-77"> i + 1 </script>  .  La matriz en sí tendrá una longitud <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-932"><span class="MJXp-mn" id="MJXp-Span-933">2</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-934">N</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-78-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-78"> 2N </script>  , y todos los nodos hoja se ubicarán en el último <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-935"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-936">N</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-79-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-79"> N </script>  Además, las celdas, los nodos muy espaciados se ubicarán en celdas cercanas de la matriz.  La función transversal del árbol cambiará un poco, pero el marco sigue siendo el mismo: <br><br><div class="spoiler">  <b class="spoiler_title">Cálculo de la fuerza atravesando un árbol en una matriz</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">nbvertex_t</span></span> force_compute(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nbvertex_t</span></span>&amp; v1, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> mass1) { <span class="hljs-keyword"><span class="hljs-keyword">nbvertex_t</span></span> total_force; <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> stack_data[MAX_STACK_SIZE] = {}; <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span>* <span class="hljs-built_in"><span class="hljs-built_in">stack</span></span> = stack_data; <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span>* stack_head = <span class="hljs-built_in"><span class="hljs-built_in">stack</span></span>; *<span class="hljs-built_in"><span class="hljs-built_in">stack</span></span>++ = NBODY_HEAP_ROOT_INDEX; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">stack</span></span> != stack_head) { <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> curr = *--<span class="hljs-built_in"><span class="hljs-built_in">stack</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> nbcoord_t </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">distance_sqr</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">((v1 - m_mass_center[curr]).norm())</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(distance_sqr &gt; m_radius_sqr[curr]) { total_force += force(v1, m_mass_center[curr], mass1, m_mass[curr]); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> left(left_idx(curr)); <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> rght(rght_idx(curr)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(rght &lt; m_body_n.size()) { *<span class="hljs-built_in"><span class="hljs-built_in">stack</span></span>++ = rght; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(left &lt; m_body_n.size()) { *<span class="hljs-built_in"><span class="hljs-built_in">stack</span></span>++ = left; } } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> total_force; }</code> </pre><br></div></div><br>  Pero estas no son todas las posibilidades que nos abre el almacenamiento de los nodos en la matriz: podemos rechazar la pila al rastrear.  Para hacer esto, en la rama de código en la que vamos a los hijos del nodo, agregamos la función para calcular el siguiente nodo ( <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-937"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-938">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-939">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-940">x</span><span class="MJXp-msubsup" id="MJXp-Span-941"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-942" style="margin-right: 0.05em;">t</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-943" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-944">u</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-945">p</span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-80-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-80"> next_ {up} </script>  ), y en la rama en la que calculamos la fuerza de interacción, agregamos el cálculo del siguiente nodo con el subárbol actual omitido ( <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-946"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-947"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-948"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">k </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-949"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i </font></font></span><span class="MJXp-msubsup" id="MJXp-Span-950"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-951" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p </font></font></span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-952" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-953"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-954"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-955"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">w </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-956"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n</font></font></span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-81-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-81"> skip_ {down} </script>  ) <br><br>  Para omitir el subárbol actual, debemos bajar a la raíz (dirección <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-957"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-958"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-82-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-82"> D </script>  ), mientras estamos en el descendiente derecho, tan pronto como lleguemos a la izquierda, vamos al subárbol derecho correspondiente (dirección <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-959"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-960"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-83-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-83"> R </script>  ), si llegamos a la raíz, se completa el recorrido del árbol. <br><br><div class="spoiler">  <b class="spoiler_title">Código de función de omisión de subárbol</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">index_t</span></span> skip_down(<span class="hljs-keyword"><span class="hljs-keyword">index_t</span></span> idx) { <span class="hljs-comment"><span class="hljs-comment">// While index is 'right' -&gt; go down while(is_right(idx)) { index_t parent = parent_idx(idx); // We at root again. Stop traverse. if(parent == NBODY_HEAP_ROOT_INDEX) { return NBODY_HEAP_ROOT_INDEX; } idx = parent; } return left2right(idx); }</span></span></code> </pre><br></div></div><br><img src="https://habrastorage.org/getpro/habr/post_images/f29/d13/fe4/f29d13fe464d49022665ac28be8912cf.svg"><br>  <b>Figura 8.</b> <i>Saltarse un subárbol</i> <math> </math><i><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-961"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-962"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-963"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">k </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-964"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i </font></font></span><span class="MJXp-msubsup" id="MJXp-Span-965"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-966" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p </font></font></span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-967" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-968"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-969"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-970"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">w </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-971"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n</font></font></span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-84-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-84"> skip_ {down} </script></i>   <i>.</i> <br><br>  Para ir al siguiente nodo, si es posible, vaya al niño izquierdo (dirección <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-972"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-973"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">U</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-85-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-85"> U </script>  ), y si no hay descendiente, vaya al siguiente nodo 'desde abajo' utilizando la función <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-974"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-975"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-976"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">k </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-977"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i </font></font></span><span class="MJXp-msubsup" id="MJXp-Span-978"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-979" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p </font></font></span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-980" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-981"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-982"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-983"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">w </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-984"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n</font></font></span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-86-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-86"> skip_ {down} </script>  . <br><br><div class="spoiler">  <b class="spoiler_title">Ir al siguiente código de función de nodo</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">index_t</span></span> next_up(<span class="hljs-keyword"><span class="hljs-keyword">index_t</span></span> idx, <span class="hljs-keyword"><span class="hljs-keyword">index_t</span></span> tree_size) { <span class="hljs-keyword"><span class="hljs-keyword">index_t</span></span> left = left_idx(idx); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(left &lt; tree_size) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> left; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> skip_down(idx); }</code> </pre><br></div></div><br><img src="https://habrastorage.org/getpro/habr/post_images/26d/909/a33/26d909a33c617b955c256a3f717fa116.svg"><br>  <b>Figura 9.</b> <i>Transiciones al siguiente nodo</i> <math> </math><i><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-985"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-986"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-987"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-988"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x </font></font></span><span class="MJXp-msubsup" id="MJXp-Span-989"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-990" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t </font></font></span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-991" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-992"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">u </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-993"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p</font></font></span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-87-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-87"> next_ {up} </script></i>   <i>.</i> <br><br>  Puede parecer que reemplazamos la recursión con un bucle <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-994"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-995"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">w </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-996"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">h </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-997"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-998"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">l </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-88-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-88"> while </script>  en función <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1000"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1001"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1002"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">k </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1003"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i </font></font></span><span class="MJXp-msubsup" id="MJXp-Span-1004"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1005" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p </font></font></span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1006" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1007"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1008"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1009"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">w </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1010"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n</font></font></span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-89-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-89"> skip_ {down} </script>  , y dicho reemplazo no da nada, pero veamos cómo determinar si un nodo con un número <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1011"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1012"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">yo</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-90-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-90"> i </script>  descendiente derecho  Esto se puede hacer simplemente comprobando su número impar (el elemento secundario correcto está en la celda <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1013"><span class="MJXp-mn" id="MJXp-Span-1014"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1015"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i </font></font></span><span class="MJXp-mo" id="MJXp-Span-1016" style="margin-left: 0.267em; margin-right: 0.267em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+ </font></font></span><span class="MJXp-mn" id="MJXp-Span-1017"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-91-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-91"> 2i + 1 </script>  ), para esto es suficiente calcular <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1018"><span class="noError" id="MJXp-Span-1019" style="display: inline-block;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i \ &amp; 1</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-92-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-92"> i \ & 1 </script>  .  Es decir  dividimos el número <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1020"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1021">i</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-93-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-93"> i </script>  dos si el bit menos significativo se establece en uno.  Pero esto se puede hacer sin un bucle, en muchos procesadores hay una instrucción <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">find first set</a> que devuelve la posición del primer bit set, usándolo convertimos el bucle en cuatro instrucciones de procesador. <br><br><div class="spoiler">  <b class="spoiler_title">Código de función de subárbol omitido optimizado</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">index_t</span></span> skip_down(<span class="hljs-keyword"><span class="hljs-keyword">index_t</span></span> idx) { idx = idx &gt;&gt; (__builtin_ffs(~idx) - <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> left2right(idx); }</code> </pre><br></div></div><br>  Después de eso, podemos excluir la pila de la función transversal del árbol y reemplazarla con un par <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1022"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1023">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1024">k</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1025">i</span><span class="MJXp-msubsup" id="MJXp-Span-1026"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1027" style="margin-right: 0.05em;">p</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1028" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1029">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1030">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1031">w</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1032">n</span></span></span><span class="MJXp-mo" id="MJXp-Span-1033" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1034">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1035">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1036">x</span><span class="MJXp-msubsup" id="MJXp-Span-1037"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1038" style="margin-right: 0.05em;">t</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1039" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1040">u</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1041">p</span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-94-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-94"> skip_ {down} + next_ {up} </script>  , después de eso la función se ve aún más simple: <br><br><div class="spoiler">  <b class="spoiler_title">Cálculo de la fuerza atravesando un árbol en una matriz sin usar una pila</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">nbvertex_t</span></span> force_compute(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nbvertex_t</span></span>&amp; v1, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> mass1) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">nbvertex_t</span></span> total_force; <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> curr = NBODY_HEAP_ROOT_INDEX; <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> tree_size = m_mass_center.size(); <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> nbcoord_t </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">distance_sqr</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">((v1 - m_mass_center[curr]).norm())</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(distance_sqr &gt; m_radius_sqr[curr]) { total_force += force(v1, m_mass_center[curr], mass1, m_mass[curr]); curr = skip_down(curr); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { curr = next_up(curr, tree_size); } } <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(curr != NBODY_HEAP_ROOT_INDEX); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> total_force; }</code> </pre><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En total, obtuvimos seis combinaciones de recorrido de árbol y cálculo de fuerza. </font><font style="vertical-align: inherit;">Compare estos enfoques en términos de tiempo de cálculo y calidad. </font><font style="vertical-align: inherit;">Tomamos como medida de calidad el cambio relativo en la energía total del sistema después de 100 iteraciones. </font><font style="vertical-align: inherit;">Como sistema modelo, tomamos dos "galaxias" interactivas que consisten en</font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1042"><span class="MJXp-mn" id="MJXp-Span-1043">16384</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-95-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-95">16384</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cuerpos cada uno. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tabla 4. </font></font></b> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Combinaciones de método de recorrido de árbol y cálculo de fuerza</font></font></i> <br><table><tbody><tr><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Tipo de cálculo transversal del árbol / fuerza </font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Árbol con pila </font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 'Pila' con una pila </font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 'Montón' sin pila </font></font></th></tr><tr><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Iteraciones por número de cuerpo </font></font></th><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ciclo + árbol </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ciclo + montón </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ciclo + heapstackless </font></font></td></tr><tr><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Desvío de hojas </font></font></th><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> árbol + árbol anidado </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nestedtree + heap </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nestedtree + heapstackless </font></font></td></tr></tbody></table><br><table><tbody><tr><td align="center"> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/dc4/be0/e89/dc4be0e898fd575d0bdf4228a5310884.svg"><br></a> <br></td><td align="center"> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/aa2/ca4/e2d/aa2ca4e2daa0cfa77f59f0e6112a3714.svg"><br></a> <br></td></tr><tr><td> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a) </font></font></b> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dependencia del tiempo de cálculo de la función</font></font></i> <math> </math><i><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1044"><span class="MJXp-msubsup" id="MJXp-Span-1045"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1046" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1047" style="vertical-align: -0.4em;">n</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-96-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-96">f_n</script></i>  <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">desde la relación de la distancia crítica al nodo del árbol a su radio (</font></font></i> <math> </math><i><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1048"><span class="MJXp-msubsup" id="MJXp-Span-1049"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1050" style="margin-right: 0.05em;">λ</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1051" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1052">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1053">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1054">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1055">t</span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-97-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-97">\lambda_{crit}</script></i>  <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></i> </td><td> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">b) </font></font></b> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La dependencia del cambio relativo en energía en el sistema en la relación de la distancia crítica al nodo del árbol a su radio (</font></font></i> <math> </math><i><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1056"><span class="MJXp-msubsup" id="MJXp-Span-1057"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1058" style="margin-right: 0.05em;">λ</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1059" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1060">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1061">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1062">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1063">t</span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-98-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-98">\lambda_{crit}</script></i>  <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></i> </td></tr><tr><td colspan="2" align="center"> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figura 10. </font></font></b> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Resultados del cálculo de funciones</font></font></i> <math> </math><i><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1064"><span class="MJXp-msubsup" id="MJXp-Span-1065"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1066" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1067" style="vertical-align: -0.4em;">n</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-99-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-99">f_n</script></i>  <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de varias maneras en la CPU (número de cuerpos</font></font></i> <math> </math><i><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1068"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1069">N</span><span class="MJXp-mo" id="MJXp-Span-1070" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-1071">32768</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-100-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-100">N=32768</script></i>  <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></i> </td></tr></tbody></table><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se puede ver que la implementación de 'árbol anidado + árbol' está irremediablemente atrasado en velocidad, porque </font><font style="vertical-align: inherit;">Carece de concurrencia. </font><font style="vertical-align: inherit;">Las implementaciones con la ubicación de los nodos de árbol en la matriz y la indexación como en un montón binario están a la cabeza. </font><font style="vertical-align: inherit;">El cambio relativo en la energía es insignificante para todas las variantes con</font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1072"><span class="MJXp-msubsup" id="MJXp-Span-1073"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1074" style="margin-right: 0.05em;">λ</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1075" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1076">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1077">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1078">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1079">t</span></span></span><span class="MJXp-mo" id="MJXp-Span-1080" style="margin-left: 0.333em; margin-right: 0.333em;">&gt;</span><span class="MJXp-mn" id="MJXp-Span-1081">1</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-101-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-101">\lambda_{crit} > 1</script>  .<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">También en la fig. </font><font style="vertical-align: inherit;">10a muestra que para (</font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1082"><span class="MJXp-msubsup" id="MJXp-Span-1083"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1084" style="margin-right: 0.05em;">λ</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1085" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1086">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1087">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1088">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1089">t</span></span></span><span class="MJXp-mo" id="MJXp-Span-1090" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-mn" id="MJXp-Span-1091">10</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-102-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-102">\lambda_{crit} < 10</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) todas las variantes del cálculo de funciones </font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1092"><span class="MJXp-msubsup" id="MJXp-Span-1093"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1094" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1095" style="vertical-align: -0.4em;">n</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-103-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-103">f_n</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adelanta significativamente en velocidad la versión más optimizada del cálculo exacto ('openmp + block + optimization'), con un aumento adicional </font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1096"><span class="MJXp-msubsup" id="MJXp-Span-1097"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1098" style="margin-right: 0.05em;">λ</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1099" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1100">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1101">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1102">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1103">t</span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-104-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-104">\lambda_{crit}</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Las implementaciones con un árbol pierden la versión exacta. </font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Recorrido de árbol de GPU </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Traté de evitar el árbol en la GPU usando la tecnología OpenCL y CUDA. </font><font style="vertical-align: inherit;">La opción de almacenar nodos en forma de árbol se descartó de inmediato, y solo quedaban las opciones para almacenar el árbol en una matriz con indexación como en un montón binario. </font><font style="vertical-align: inherit;">En general, la implementación del núcleo informático no es muy diferente de la versión de la CPU.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kernel OpenCL para calcular la fuerza al atravesar un árbol (transversal en el orden de los cuerpos de numeración)</font></font></b> <div class="spoiler_text"><pre> <code class="cpp hljs">__<span class="hljs-function"><span class="hljs-function">kernel </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ComputeTreeBH</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> offset_n1, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> points_count, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> tree_size, __global </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">nbcoord_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* y, __global </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">nbcoord_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* f, __global </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">nbcoord_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* tree_cmx, __global </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">nbcoord_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* tree_cmy, __global </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">nbcoord_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* tree_cmz, __global </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">nbcoord_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* tree_mass, __global </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">nbcoord_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* tree_crit_r2)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> n1 = get_global_id(<span class="hljs-number"><span class="hljs-number">0</span></span>) + offset_n1; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> stride = points_count; __global <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span>* rx = y; __global <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span>* ry = rx + stride; __global <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span>* rz = rx + <span class="hljs-number"><span class="hljs-number">2</span></span> * stride; __global <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span>* vx = rx + <span class="hljs-number"><span class="hljs-number">3</span></span> * stride; __global <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span>* vy = rx + <span class="hljs-number"><span class="hljs-number">4</span></span> * stride; __global <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span>* vz = rx + <span class="hljs-number"><span class="hljs-number">5</span></span> * stride; __global <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span>* frx = f; __global <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span>* fry = frx + stride; __global <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span>* frz = frx + <span class="hljs-number"><span class="hljs-number">2</span></span> * stride; __global <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span>* fvx = frx + <span class="hljs-number"><span class="hljs-number">3</span></span> * stride; __global <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span>* fvy = frx + <span class="hljs-number"><span class="hljs-number">4</span></span> * stride; __global <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span>* fvz = frx + <span class="hljs-number"><span class="hljs-number">5</span></span> * stride; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> x1 = rx[n1]; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> y1 = ry[n1]; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> z1 = rz[n1]; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> res_x = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> res_y = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> res_z = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> stack_data[MAX_STACK_SIZE] = {}; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-built_in"><span class="hljs-built_in">stack</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> stack_head = <span class="hljs-built_in"><span class="hljs-built_in">stack</span></span>; stack_data[<span class="hljs-built_in"><span class="hljs-built_in">stack</span></span>++] = NBODY_HEAP_ROOT_INDEX; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">stack</span></span> != stack_head) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> curr = stack_data[--<span class="hljs-built_in"><span class="hljs-built_in">stack</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> dx = x1 - tree_cmx[curr]; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> dy = y1 - tree_cmy[curr]; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> dz = z1 - tree_cmz[curr]; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> r2 = (dx * dx + dy * dy + dz * dz); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(r2 &gt; tree_crit_r2[curr]) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(r2 &lt; NBODY_MIN_R) { r2 = NBODY_MIN_R; } <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> r = <span class="hljs-built_in"><span class="hljs-built_in">sqrt</span></span>(r2); <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> coeff = tree_mass[curr] / (r * r2); dx *= coeff; dy *= coeff; dz *= coeff; res_x -= dx; res_y -= dy; res_z -= dz; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> left = left_idx(curr); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> rght = rght_idx(curr); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(left &lt; tree_size) { stack_data[<span class="hljs-built_in"><span class="hljs-built_in">stack</span></span>++] = left; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(rght &lt; tree_size) { stack_data[<span class="hljs-built_in"><span class="hljs-built_in">stack</span></span>++] = rght; } } } frx[n1] = vx[n1]; fry[n1] = vy[n1]; frz[n1] = vz[n1]; fvx[n1] = res_x; fvy[n1] = res_y; fvz[n1] = res_z; }</code> </pre><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En la primera versión, el recorrido del árbol comenzó en el orden de numeración de los cuerpos en la matriz original, por lo que los subprocesos vecinos omitieron partes completamente diferentes del árbol, lo que afectó negativamente el rendimiento de la memoria caché de la GPU. </font><font style="vertical-align: inherit;">Por lo tanto, en la segunda realización, se aplicó un recorrido, comenzando desde la parte superior del árbol, en este caso, los hilos vecinos comienzan a atravesar el árbol a lo largo del mismo camino, porque </font><font style="vertical-align: inherit;">las copas de los árboles vecinos están cerca y en el espacio. </font><font style="vertical-align: inherit;">También es importante que elijamos la numeración en el conjunto de nodos del árbol no desde cero, sino desde uno, en este caso las hojas del árbol se almacenan en la segunda mitad del conjunto, y con el número de cuerpos igual a la potencia de dos, tendremos el mismo acceso a la memoria por el índice tn1.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kernel OpenCL para calcular la fuerza atravesando un árbol (atravesando los nodos de numeración de un árbol)</font></font></b> <div class="spoiler_text"><pre> <code class="cpp hljs">__<span class="hljs-function"><span class="hljs-function">kernel </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ComputeHeapBH</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> offset_n1, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> points_count, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> tree_size, __global </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">nbcoord_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* y, __global </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">nbcoord_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* f, __global </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">nbcoord_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* tree_cmx, __global </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">nbcoord_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* tree_cmy, __global </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">nbcoord_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* tree_cmz, __global </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">nbcoord_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* tree_mass, __global </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">nbcoord_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* tree_crit_r2, __global </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">* body_n)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> tree_offset = points_count - <span class="hljs-number"><span class="hljs-number">1</span></span> + NBODY_HEAP_ROOT_INDEX; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> stride = points_count; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> tn1 = get_global_id(<span class="hljs-number"><span class="hljs-number">0</span></span>) + offset_n1 + tree_offset; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> n1 = body_n[tn1]; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> x1 = tree_cmx[tn1]; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> y1 = tree_cmy[tn1]; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> z1 = tree_cmz[tn1]; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> res_x = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> res_y = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> res_z = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> stack_data[MAX_STACK_SIZE] = {}; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-built_in"><span class="hljs-built_in">stack</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> stack_head = <span class="hljs-built_in"><span class="hljs-built_in">stack</span></span>; stack_data[<span class="hljs-built_in"><span class="hljs-built_in">stack</span></span>++] = NBODY_HEAP_ROOT_INDEX; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">stack</span></span> != stack_head) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> curr = stack_data[--<span class="hljs-built_in"><span class="hljs-built_in">stack</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> dx = x1 - tree_cmx[curr]; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> dy = y1 - tree_cmy[curr]; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> dz = z1 - tree_cmz[curr]; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> r2 = (dx * dx + dy * dy + dz * dz); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(r2 &gt; tree_crit_r2[curr]) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(r2 &lt; NBODY_MIN_R) { r2 = NBODY_MIN_R; } <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> r = <span class="hljs-built_in"><span class="hljs-built_in">sqrt</span></span>(r2); <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> coeff = tree_mass[curr] / (r * r2); dx *= coeff; dy *= coeff; dz *= coeff; res_x -= dx; res_y -= dy; res_z -= dz; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> left = left_idx(curr); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> rght = rght_idx(curr); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(left &lt; tree_size) { stack_data[<span class="hljs-built_in"><span class="hljs-built_in">stack</span></span>++] = left; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(rght &lt; tree_size) { stack_data[<span class="hljs-built_in"><span class="hljs-built_in">stack</span></span>++] = rght; } } } __global <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span>* vx = y + <span class="hljs-number"><span class="hljs-number">3</span></span> * stride; __global <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span>* vy = y + <span class="hljs-number"><span class="hljs-number">4</span></span> * stride; __global <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span>* vz = y + <span class="hljs-number"><span class="hljs-number">5</span></span> * stride; __global <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span>* frx = f; __global <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span>* fry = frx + stride; __global <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span>* frz = frx + <span class="hljs-number"><span class="hljs-number">2</span></span> * stride; __global <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span>* fvx = frx + <span class="hljs-number"><span class="hljs-number">3</span></span> * stride; __global <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span>* fvy = frx + <span class="hljs-number"><span class="hljs-number">4</span></span> * stride; __global <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span>* fvz = frx + <span class="hljs-number"><span class="hljs-number">5</span></span> * stride; frx[n1] = vx[n1]; fry[n1] = vy[n1]; frz[n1] = vz[n1]; fvx[n1] = res_x; fvy[n1] = res_y; fvz[n1] = res_z; }</code> </pre><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Al recorrer el orden de numeración de los nodos del árbol, obtuvimos un aumento en el rendimiento. Pero esta opción también se puede mejorar. La memoria global en la que se encuentran actualmente los nodos del árbol está optimizada para </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">acceso compartido</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , es decir Los hilos de un grupo deben leer palabras ubicadas en un bloque de memoria. En nuestro caso, el recorrido del árbol comienza a lo largo de los mismos caminos, y solicitamos los mismos datos con todos los hilos del grupo, pero cuanto más profundizamos en el árbol, los caminos de los hilos vecinos divergen cada vez más, y tenemos que solicitar datos diferentes, lo que reduce el rendimiento del subsistema varias veces memoria Pero los nodos de cada subárbol que pertenecen al mismo nivel se encuentran en celdas de memoria relativamente cercanas.</font></font> Es decir<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Al atravesar el resto del árbol, los subprocesos vecinos del núcleo informático no acceden a los mismos nodos del árbol, sino que se encuentran en la memoria. </font><font style="vertical-align: inherit;">Para optimizar este acceso a la memoria, se puede utilizar la memoria de textura. </font><font style="vertical-align: inherit;">Pero hay un inconveniente. </font><font style="vertical-align: inherit;">Por el momento, las texturas no admiten trabajar con datos de doble precisión (queremos calcular con precisión). </font><font style="vertical-align: inherit;">Pero en CUDA hay una función </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">__hiloint2double</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que recopila un número de doble precisión de dos enteros.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Código de solicitud de número de precisión doble de una textura que almacena enteros</font></font></b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nb1Dfetch</span></span></span><span class="hljs-class">&lt;double&gt; {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> double4 vec4; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> __<span class="hljs-function"><span class="hljs-function">device__ </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">double</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fetch</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(cudaTextureObject_t tex, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> i)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-function"><span class="hljs-function">int2 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">p</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(tex1Dfetch&lt;int2&gt;(tex, i))</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> __hiloint2double(py, px); } <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> __<span class="hljs-function"><span class="hljs-function">device__ vec4 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fetch4</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(cudaTextureObject_t tex, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> i)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ii</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">2</span></span></span></span><span class="hljs-function"><span class="hljs-params"> * i)</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">int4 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">p1</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(tex1Dfetch&lt;int4&gt;(tex, ii))</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">int4 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">p2</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(tex1Dfetch&lt;int4&gt;(tex, ii + </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span><span class="hljs-function"><span class="hljs-params">))</span></span></span></span>; vec4 d4 = {__hiloint2double(p1.y, p1.x), __hiloint2double(p1.w, p1.z), __hiloint2double(p2.y, p2.x), __hiloint2double(p2.w, p2.z) }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> d4; } };</code> </pre><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En este caso, se realizaron dos implementaciones, en una cada elemento del árbol (x, y, z, tree_crit_r2) se solicitó de forma independiente, y en la segunda implementación se combinaron estas solicitudes. </font><font style="vertical-align: inherit;">La solicitud de la masa del nodo se produce con mucha menos frecuencia, solo si </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se cumple</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> la condición </font><i><font style="vertical-align: inherit;">r2&gt; tree_crit_r2 [curr]</font></i><font style="vertical-align: inherit;"> , por lo que no tiene sentido combinar esta solicitud con las demás. </font><font style="vertical-align: inherit;">Otra característica útil del marco CUDA es la capacidad de controlar la proporción de los tamaños del caché L1 y el tamaño de la memoria compartida ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cudaFuncSetCacheConfig</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">En el caso del recorrido del árbol, no usamos memoria compartida, por lo que podemos aumentar el caché L1 en detrimento de él.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kernel CUDA para calcular la fuerza atravesando un árbol (atravesando el orden de numeración de los nodos del árbol)</font></font></b> <div class="spoiler_text"><pre> <code class="cpp hljs">__<span class="hljs-function"><span class="hljs-function">global__ </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">kfcompute_heap_bh_tex</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> offset_n1, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> points_count, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> tree_size, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">nbcoord_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* f, cudaTextureObject_t tree_xyzr, cudaTextureObject_t tree_mass, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">* body_n)</span></span></span><span class="hljs-function"> </span></span>{ nb1Dfetch&lt;<span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span>&gt; tex; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> tree_offset = points_count - <span class="hljs-number"><span class="hljs-number">1</span></span> + NBODY_HEAP_ROOT_INDEX; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> stride = points_count; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> tn1 = blockDim.x * blockIdx.x + threadIdx.x + offset_n1 + tree_offset; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> n1 = body_n[tn1]; <span class="hljs-keyword"><span class="hljs-keyword">nbvec4_t</span></span> xyzr = tex.fetch4(tree_xyzr, tn1); <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> x1 = xyzr.x; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> y1 = xyzr.y; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> z1 = xyzr.z; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> res_x = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> res_y = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> res_z = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> stack_data[MAX_STACK_SIZE] = {}; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-built_in"><span class="hljs-built_in">stack</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> stack_head = <span class="hljs-built_in"><span class="hljs-built_in">stack</span></span>; stack_data[<span class="hljs-built_in"><span class="hljs-built_in">stack</span></span>++] = NBODY_HEAP_ROOT_INDEX; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">stack</span></span> != stack_head) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> curr = stack_data[--<span class="hljs-built_in"><span class="hljs-built_in">stack</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">nbvec4_t</span></span> xyzr2 = tex.fetch4(tree_xyzr, curr); <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> dx = x1 - xyzr2.x; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> dy = y1 - xyzr2.y; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> dz = z1 - xyzr2.z; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> r2 = (dx * dx + dy * dy + dz * dz); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(r2 &gt; xyzr2.w) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(r2 &lt; NBODY_MIN_R) { r2 = NBODY_MIN_R; } <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> r = <span class="hljs-built_in"><span class="hljs-built_in">sqrt</span></span>(r2); <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> coeff = tex.fetch(tree_mass, curr) / (r * r2); dx *= coeff; dy *= coeff; dz *= coeff; res_x -= dx; res_y -= dy; res_z -= dz; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> left = nbody_heap_func&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;::left_idx(curr); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> rght = nbody_heap_func&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;::rght_idx(curr); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(left &lt; tree_size) { stack_data[<span class="hljs-built_in"><span class="hljs-built_in">stack</span></span>++] = left; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(rght &lt; tree_size) { stack_data[<span class="hljs-built_in"><span class="hljs-built_in">stack</span></span>++] = rght; } } } f[n1 + <span class="hljs-number"><span class="hljs-number">3</span></span> * stride] = res_x; f[n1 + <span class="hljs-number"><span class="hljs-number">4</span></span> * stride] = res_y; f[n1 + <span class="hljs-number"><span class="hljs-number">5</span></span> * stride] = res_z; }</code> </pre><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un análisis del programa en el perfilador nvprof mostró que incluso cuando se usa memoria de textura para almacenar un árbol, todavía hay una carga muy alta en la memoria global. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De hecho, en CUDA, toda la memoria del núcleo que se dirige a direcciones 'calculadas' se almacena en la memoria global y, en consecuencia, la pila que se necesita para atravesar el árbol se encuentra en la memoria global y consume una parte significativa del ancho de banda del chip de memoria, porque la pila tiene cada hilo de ejecución, y hay muchos hilos. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pero, afortunadamente, ya sabemos cómo atravesar un árbol sin usar una pila. </font><font style="vertical-align: inherit;">Complementando el núcleo computacional anterior con las funciones de calcular el siguiente nodo de árbol, obtenemos un nuevo núcleo, además, más compacto.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Núcleo CUDA para la fuerza informática al atravesar un árbol sin usar una pila</font></font></b> <div class="spoiler_text"><pre> <code class="cpp hljs">__<span class="hljs-function"><span class="hljs-function">global__ </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">kfcompute_heap_bh_stackless</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> offset_n1, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> points_count, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> tree_size, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">nbcoord_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* f, cudaTextureObject_t tree_xyzr, cudaTextureObject_t tree_mass, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">* body_n)</span></span></span><span class="hljs-function"> </span></span>{ nb1Dfetch&lt;<span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span>&gt; tex; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> tree_offset = points_count - <span class="hljs-number"><span class="hljs-number">1</span></span> + NBODY_HEAP_ROOT_INDEX; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> stride = points_count; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> tn1 = blockDim.x * blockIdx.x + threadIdx.x + offset_n1 + tree_offset; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> n1 = body_n[tn1]; <span class="hljs-keyword"><span class="hljs-keyword">nbvec4_t</span></span> xyzr = tex.fetch4(tree_xyzr, tn1); <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> x1 = xyzr.x; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> y1 = xyzr.y; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> z1 = xyzr.z; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> res_x = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> res_y = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> res_z = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> curr = NBODY_HEAP_ROOT_INDEX; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">nbvec4_t</span></span> xyzr2 = tex.fetch4(tree_xyzr, curr); <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> dx = x1 - xyzr2.x; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> dy = y1 - xyzr2.y; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> dz = z1 - xyzr2.z; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> r2 = (dx * dx + dy * dy + dz * dz); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(r2 &gt; xyzr2.w) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(r2 &lt; NBODY_MIN_R) { r2 = NBODY_MIN_R; } <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> r = <span class="hljs-built_in"><span class="hljs-built_in">sqrt</span></span>(r2); <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> coeff = tex.fetch(tree_mass, curr) / (r * r2); dx *= coeff; dy *= coeff; dz *= coeff; res_x -= dx; res_y -= dy; res_z -= dz; curr = nbody_heap_func&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;::skip_idx(curr); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { curr = nbody_heap_func&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;::next_up(curr, tree_size); } } <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(curr != NBODY_HEAP_ROOT_INDEX); f[n1 + <span class="hljs-number"><span class="hljs-number">3</span></span> * stride] = res_x; f[n1 + <span class="hljs-number"><span class="hljs-number">4</span></span> * stride] = res_y; f[n1 + <span class="hljs-number"><span class="hljs-number">5</span></span> * stride] = res_z; }</code> </pre><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El rendimiento de los núcleos que se ejecutan en la GPU depende en gran medida del tamaño de los bloques en los que dividimos la tarea. Dependiendo de este tamaño, cuántos registros, memoria local y otros recursos estarán disponibles para cada hilo informático. También debe tener en cuenta que mientras espera el acceso a la memoria en un subproceso, otro subproceso puede realizar cálculos en el procesador del sombreador, por lo tanto, con un número suficiente de subprocesos ejecutados simultáneamente en un procesador, el tiempo de acceso a la memoria estará oculto detrás de los cálculos. Por lo tanto, antes de comparar el rendimiento de nuestros núcleos, necesitamos calcular el tamaño de bloque óptimo para cada uno de ellos. Hagamos una comparación de la mitad disponible de NVidia K80. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tabla 5. </font></font></b> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La dependencia de la función de tiempo de cálculo (en segundos)</font></font></i> <math> </math><i><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1104"><span class="MJXp-msubsup" id="MJXp-Span-1105"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1106" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1107" style="vertical-align: -0.4em;">n</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-105-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-105">f_n</script></i>  <i>     GPU    </i> <math> </math><i><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1108"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1109">N</span><span class="MJXp-mo" id="MJXp-Span-1110" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-1111">131072</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-106-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-106">N=131072</script></i>  <i></i> <math> </math><i><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1112"><span class="MJXp-msubsup" id="MJXp-Span-1113"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1114" style="margin-right: 0.05em;">λ</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1115" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1116">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1117">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1118">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1119">t</span></span></span><span class="MJXp-mo" id="MJXp-Span-1120" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-1121">10</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-107-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-107">\lambda_{crit}=10</script></i> <br><table><tbody><tr><th>  / </th><th>  8 </th><th>  16 </th><th>  32 </th><th>  64 </th><th> 128 </th><th> 256 </th><th> 512 </th><th> 1024 </th></tr><tr><td> opencl+dense </td><td> 5.77 </td><td> 2.84 </td><td> 1.46 </td><td> <b>1.13</b> </td><td> 1.15 </td><td> 1.14 </td><td> 1.14 </td><td> 1.13 </td></tr><tr><td> cuda+dense </td><td> 5.44 </td><td> 2.55 </td><td> 1.27 </td><td> <b>0.96</b> </td><td> 0.97 </td><td> 0.99 </td><td> 0.99 </td><td>  - </td></tr><tr><td> opencl+heap+cycle </td><td> 5.88 </td><td> 5.65 </td><td> 5.74 </td><td> 5.96 </td><td> 5.37 </td><td> 5.38 </td><td> <b>5.35</b> </td><td> 5.38 </td></tr><tr><td> opencl+heap+nested </td><td> 4.54 </td><td> <b>3.68</b> </td><td> 3.98 </td><td> 5.25 </td><td> 5.46 </td><td> 5.41 </td><td> 5.48 </td><td> 5.31 </td></tr><tr><td> cuda+heap+nested </td><td>  3,62 </td><td>  2,81 </td><td> <b>2.68</b> </td><td> 4.26 </td><td> 4.84 </td><td> 4.75 </td><td> 4.8 </td><td> 4.67 </td></tr><tr><td> cuda+heap+nested+tex </td><td> 2.6 </td><td> 1.51 </td><td> 0.912 </td><td> <b>0.7</b> </td><td> 1.85 </td><td> 1.75 </td><td> 1.69 </td><td> 1.61 </td></tr><tr><td> cuda+heap+nested+tex+stackless </td><td> 2.3 </td><td> 1.29 </td><td> 0.773 </td><td> <b>0.5</b> </td><td> 0.51 </td><td> 0.52 </td><td> 0.52 </td><td> 0.52 </td></tr></tbody></table><br><br> <b> 6.</b> <i>   ( ) </i> <math> </math><i><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1122"><span class="MJXp-msubsup" id="MJXp-Span-1123"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1124" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1125" style="vertical-align: -0.4em;">n</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-108-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-108">f_n</script></i>  <i>     GPU    </i> <math> </math><i><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1126"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1127">N</span><span class="MJXp-mo" id="MJXp-Span-1128" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-1129">1</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1130">M</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-109-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-109">N=1M</script></i>  <i></i> <math> </math><i><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1131"><span class="MJXp-msubsup" id="MJXp-Span-1132"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1133" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">λ </font></font></span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1134" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1135"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1136"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1137"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1138"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t</font></font></span></span></span><span class="MJXp-mo" id="MJXp-Span-1139" style="margin-left: 0.333em; margin-right: 0.333em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> = </font></font></span><span class="MJXp-mn" id="MJXp-Span-1140"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-110-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-110">\lambda_{crit}=4</script></i> <br><table><tbody><tr><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Tamaño de bloque / núcleo </font></font></th><th>  8 </th><th>  16 </th><th>  32 </th><th>  64 </th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 128 </font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 256 </font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 512 </font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1024 </font></font></th></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> opencl + denso </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 366 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 179 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 89,9 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 69,3 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 70,3 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 69,1 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 68,9 </font></font></td><td> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">68,0</font></font></b> </td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cuda + denso </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 346 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 162 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 79,6 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 60,8 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 60,8 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 60,7 </font></font></td><td> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">59,6</font></font></b> </td><td>  - </td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> opencl + montón + ciclo </font></font></td><td> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16,2</font></font></b> </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 18,2 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 20,1 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 21,2 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 21,2 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 21,3 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 21,2 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 21,1 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> opencl + montón + anidado </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 10,5 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 7.63 </font></font></td><td> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.38</font></font></b> </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 8.23 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 9,95 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 9,89 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 9.65 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 9.66 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cuda + montón + anidado </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 8.67 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 6.44 </font></font></td><td> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.39</font></font></b> </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 5.93 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 8.65 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 8.61 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 8.41 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 8.27 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cuda + montón + anidado + tex </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 6.38 </font></font></td><td>  3,57 </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 2,13 </font></font></td><td> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1,44</font></font></b> </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 3,56 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 3.46 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 3.30 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 3.29 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cuda + montón + anidado + tex + sin pila </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 5,78 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 3.19 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1,83 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1,21 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1.11 </font></font></td><td> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.10</font></font></b> </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1.11 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1.13 </font></font></td></tr></tbody></table><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Una situación difícil, pero, a diferencia de la versión de CPU del recorrido del árbol, está claro que cada paso de optimización trae resultados tangibles. </font><font style="vertical-align: inherit;">La implementación de 'opencl + heap + cycle' es casi 6 veces más lenta que una solución exacta con cálculo de función completa</font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1141"><span class="MJXp-msubsup" id="MJXp-Span-1142"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1143" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">f </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1144" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n</font></font></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-111-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-111">f_n</script>  .<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Una implementación de 'opencl + heap + nested', en la que un recorrido del árbol comienza desde los nodos vecinos, 1.4 veces más rápido que el anterior, porque La memoria caché se usa mejor. En la implementación de 'cuda + heap + nested', el caché L1 se aumentó en detrimento de la memoria compartida, lo que aumentó la velocidad en 1,4 veces, aunque es posible que en la implementación de cuda el núcleo de compilación se compile de manera más óptima (en las versiones de 'opencl + dense' y 'cuda Los núcleos + densos son idénticos, y el rendimiento de la versión de Cuda es ~ 1.2 veces mayor). El aumento más significativo en la velocidad computacional (3.8 veces) se logra cuando el árbol se encuentra en la memoria de textura y se combinan las consultas a los elementos del nodo del árbol. La implementación con el recorrido del árbol sin usar la pila 'cuda + heap + nested + tex + stackless' es 1.4 veces más rápida también.en él, todo el ancho de banda del bus de memoria se usa solo para acceder a datos sobre nodos de árbol y no se gasta en la pila. Así, con</font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1145"><span class="MJXp-msubsup" id="MJXp-Span-1146"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1147" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">λ </font></font></span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1148" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1149"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1150"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1151"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1152"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t</font></font></span></span></span><span class="MJXp-mo" id="MJXp-Span-1153" style="margin-left: 0.333em; margin-right: 0.333em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> = </font></font></span><span class="MJXp-mn" id="MJXp-Span-1154"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10</font></font></span></span></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fue posible lograr la aceleración dos veces en comparación con el cálculo completo de la función</font></font><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-112-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-112">\lambda_{crit}=10</script><font style="vertical-align: inherit;"></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1155"><span class="MJXp-msubsup" id="MJXp-Span-1156"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1157" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">f </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1158" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n</font></font></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-113-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-113">f_n</script>  .  Pero <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1159"><span class="MJXp-msubsup" id="MJXp-Span-1160"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1161" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">λ </font></font></span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1162" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1163"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1164"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1165"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1166"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t</font></font></span></span></span><span class="MJXp-mo" id="MJXp-Span-1167" style="margin-left: 0.333em; margin-right: 0.333em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> = </font></font></span><span class="MJXp-mn" id="MJXp-Span-1168"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10 es un</font></font></span></span></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> valor excesivamente grande del parámetro; en el gráfico del cambio relativo de energía en el sistema versus la relación de la distancia crítica al nodo del árbol a su radio para la implementación de la CPU, está claro que los valores más bajos</font></font><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-114-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-114">\lambda_{crit}=10</script><font style="vertical-align: inherit;"></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1169"><span class="MJXp-msubsup" id="MJXp-Span-1170"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1171" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">λ </font></font></span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1172" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1173"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1174"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1175"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1176"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t</font></font></span></span></span></span></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sin aparente pérdida de precisión de la solución. </font><font style="vertical-align: inherit;">Intentemos variar</font></font><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-115-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-115">\lambda_{crit}</script><font style="vertical-align: inherit;"></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1177"><span class="MJXp-msubsup" id="MJXp-Span-1178"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1179" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">λ </font></font></span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1180" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1181"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1182"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1183"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1184"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t</font></font></span></span></span></span></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en los tamaños de bloque óptimos, que determinamos en el paso anterior.</font></font><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-116-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-116">\lambda_{crit}</script><font style="vertical-align: inherit;"></font><br><table><tbody><tr><td align="center"> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/ae8/8b7/344/ae88b7344bf6c884545168e2870edeec.svg"><br></a> <br></td><td align="center"> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/85e/073/df6/85e073df6103f00705376ff7deb32ca1.svg"><br></a> <br></td></tr><tr><td align="center"> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a)</font></font></b> <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1185"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1186"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N </font></font></span><span class="MJXp-mo" id="MJXp-Span-1187" style="margin-left: 0.333em; margin-right: 0.333em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font></span><span class="MJXp-mn" id="MJXp-Span-1188"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">128 </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1189"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">K</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-117-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-117">N=128K</script><br></td><td align="center"> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">b)</font></font></b> <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1190"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1191"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N </font></font></span><span class="MJXp-mo" id="MJXp-Span-1192" style="margin-left: 0.333em; margin-right: 0.333em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font></span><span class="MJXp-mn" id="MJXp-Span-1193"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1 </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1194"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-118-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-118">N=1M</script><br></td></tr><tr><td colspan="2" align="center"> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fig. 11. </font></font></b> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dependencia del tiempo de cálculo de la función.</font></font></i> <math> </math><i><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1195"><span class="MJXp-msubsup" id="MJXp-Span-1196"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1197" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">f </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1198" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n</font></font></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-119-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-119">f_n</script></i>  <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> desde la relación de la distancia crítica al nodo del árbol a su radio (</font></font></i> <math> </math><i><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1199"><span class="MJXp-msubsup" id="MJXp-Span-1200"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1201" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">λ </font></font></span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1202" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1203"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1204"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1205"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1206"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t</font></font></span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-120-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-120">\lambda_{crit}</script></i>  <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) para varias implementaciones de GPU Tree Walk</font></font></i> <br></td></tr></tbody></table><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Se puede ver que para pequeños </font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1207"><span class="MJXp-msubsup" id="MJXp-Span-1208"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1209" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">λ </font></font></span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1210" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1211"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1212"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1213"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1214"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t</font></font></span></span></span></span></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> todos los métodos de cálculo de la función</font></font><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-121-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-121">\lambda_{crit}</script><font style="vertical-align: inherit;"></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1215"><span class="MJXp-msubsup" id="MJXp-Span-1216"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1217" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">f </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1218" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n</font></font></span></span></span></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para cerrar valores determinados por el tiempo de construcción del árbol kd y la preparación de datos para la GPU. </font><font style="vertical-align: inherit;">Además, el tiempo de construcción de un árbol contribuye significativamente al tiempo total para</font></font><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-122-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-122">f_n</script><font style="vertical-align: inherit;"></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1219"><span class="MJXp-msubsup" id="MJXp-Span-1220"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1221" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">λ </font></font></span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1222" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1223"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1224"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1225"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1226"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t</font></font></span></span></span><span class="MJXp-mo" id="MJXp-Span-1227" style="margin-left: 0.333em; margin-right: 0.333em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ≤ </font></font></span><span class="MJXp-mn" id="MJXp-Span-1228"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4</font></font></span></span></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , entonces este tiempo puede ser descuidado. </font><font style="vertical-align: inherit;">Es interesante notar que cuando</font></font><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-123-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-123">\lambda_{crit}\leq 4</script><font style="vertical-align: inherit;"></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1229"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1230"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N </font></font></span><span class="MJXp-mo" id="MJXp-Span-1231" style="margin-left: 0.333em; margin-right: 0.333em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font></span><span class="MJXp-mn" id="MJXp-Span-1232"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">128 </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1233"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">K el</font></font></span></span></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> rendimiento mejora nuevamente cuando se alcanza</font></font><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-124-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-124">N=128K</script><font style="vertical-align: inherit;"></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1234"><span class="MJXp-msubsup" id="MJXp-Span-1235"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1236" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">λ </font></font></span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1237" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1238"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1239"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1240"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1241"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t</font></font></span></span></span><span class="MJXp-mo" id="MJXp-Span-1242" style="margin-left: 0.333em; margin-right: 0.333em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> = </font></font></span><span class="MJXp-mn" id="MJXp-Span-1243"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1024</font></font></span></span></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , lo más probable es que esto se deba al hecho de que todos los hilos de la GPU rodean los mismos vértices de árbol al mismo tiempo, lo que mejora el uso de caché L1 y elimina por completo la</font><i><font style="vertical-align: inherit;">'divergencia de ramificación'</font></i><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">También se ve que el mejor rendimiento para una implementación sin una pila (cuda + heap + nested + tex + stackless), supera la versión con la pila aproximadamente</font></font><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-125-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-125">\lambda_{crit}=1024</script><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1244"><span class="MJXp-mn" id="MJXp-Span-1245"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.4 </font></font></span><span class="MJXp-mo" id="MJXp-Span-1246" style="margin-left: 0.267em; margin-right: 0.267em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- </font></font></span><span class="MJXp-mn" id="MJXp-Span-1247"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.5</font></font></span></span></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> veces. </font><font style="vertical-align: inherit;">Otras implementaciones son varias veces más lentas. </font><font style="vertical-align: inherit;">Para consolidar el resultado, calcularemos el tiempo en una GPU con una arquitectura más nueva.</font></font><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-126-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-126">1.4-1.5</script><font style="vertical-align: inherit;"></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Resultados de lanzamiento en GeForce GTX 1080 Ti (precisión única)</font></font></b> <div class="spoiler_text"> <b> 7.</b> <i>   ( ) </i> <math> </math><i><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1248"><span class="MJXp-msubsup" id="MJXp-Span-1249"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1250" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1251" style="vertical-align: -0.4em;">n</span></span></span></span><script type="math/tex" id="MathJax-Element-127">f_n</script></i>  <i>     GPU    </i> <math> </math><i><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1252"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1253">N</span><span class="MJXp-mo" id="MJXp-Span-1254" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-1255">1</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1256">M</span></span></span><script type="math/tex" id="MathJax-Element-128">N=1M</script></i>  <i></i> <math> </math><i><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1257"><span class="MJXp-msubsup" id="MJXp-Span-1258"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1259" style="margin-right: 0.05em;">λ</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1260" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1261">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1262">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1263">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1264">t</span></span></span><span class="MJXp-mo" id="MJXp-Span-1265" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-1266">4</span></span></span><script type="math/tex" id="MathJax-Element-129">\lambda_{crit}=4</script></i> <br><table><tbody><tr><th>  / </th><th>  8 </th><th>  16 </th><th>  32 </th><th>  64 </th><th> 128 </th><th> 256 </th><th> 512 </th><th> 1024 </th></tr><tr><td> opencl+dense </td><td> 47.8 </td><td> 23.4 </td><td> 11.6 </td><td> <b>11.59</b> </td><td> 12.8 </td><td> 12.8 </td><td> 12.8 </td><td> 12.8 </td></tr><tr><td> cuda+dense </td><td> 49.0 </td><td> 23.8 </td><td> 11.9 </td><td> 11.8 </td><td> <b>11.7</b> </td><td> 11.7 </td><td> 11.7 </td><td> 11.7 </td></tr><tr><td> opencl+heap+cycle </td><td> 7.48 </td><td> 8.26 </td><td> 7.73 </td><td> 7.36 </td><td> 7.33 </td><td> <b>7.27</b> </td><td> 7.25 </td><td> 7.26 </td></tr><tr><td> opencl+heap+nested </td><td> 1.33 </td><td> <b>1.20</b> </td><td> 1.41 </td><td> 2.46 </td><td> 2.53 </td><td> 2.49 </td><td> 2.44 </td><td> 2.47 </td></tr><tr><td> cuda+heap+nested </td><td> 1.23 </td><td> <b>1.10</b> </td><td> 1.31 </td><td> 2.28 </td><td> 2.29 </td><td> 2.28 </td><td> 2.23 </td><td> 2.25 </td></tr><tr><td> cuda+heap+nested+tex </td><td> 0.88 </td><td> 0.68 </td><td> <b>0.654</b> </td><td>  1.6 </td><td>  1.6 </td><td>  1.6 </td><td>  1.6 </td><td>  1.6 </td></tr><tr><td> cuda+heap+nested+tex+stackless </td><td> 0.71 </td><td> 0.47 </td><td> 0.45 </td><td> 0.43 </td><td> 0.43 </td><td> 0.42 </td><td> 0.41 </td><td> <b>0.395</b> </td></tr></tbody></table><br><table><tbody><tr><td align="center"> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/b14/d81/e27/b14d81e271e2edf7b1d70faa815e1710.svg"><br></a> <br></td></tr><tr><td align="center"> <b> 12.</b> <i>   </i> <math> </math><i><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1267"><span class="MJXp-msubsup" id="MJXp-Span-1268"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1269" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1270" style="vertical-align: -0.4em;">n</span></span></span></span><script type="math/tex" id="MathJax-Element-130">f_n</script></i>  <i>          (</i> <math> </math><i><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1271"><span class="MJXp-msubsup" id="MJXp-Span-1272"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1273" style="margin-right: 0.05em;">λ</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1274" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1275">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1276">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1277">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1278">t</span></span></span></span></span><script type="math/tex" id="MathJax-Element-131">\lambda_{crit}</script></i>  <i>)   GPU   </i> <br></td></tr></tbody></table><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cuando se usa la GeForce GTX 1080 Ti para el cálculo, la diferencia entre las caminatas de árbol con una pila y sin pila es hasta dos veces, siempre que descuidemos el tiempo que lleva construir el árbol. Este hecho nos empuja a garantizar que en el futuro se transfiera a la GPU y se cree un árbol. Una comparación de las tablas 5-7 muestra que no hay un único tamaño de bloque óptimo para un número diferente de cuerpos, y aún más para diferentes arquitecturas de GPU, además, la diferencia de tiempo de cálculo puede alcanzar varias veces, incluso si no tiene en cuenta los valores límite. Por lo tanto, antes de largos cálculos, tiene sentido determinar el tamaño de bloque óptimo para cada configuración. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lo principal que hemos logrado es la capacidad de modelar la interacción por pares de poco más de un millón de cuerpos (</font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1279"><span class="MJXp-msubsup" id="MJXp-Span-1280"><span class="MJXp-mn" id="MJXp-Span-1281" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 </font></font></span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1282" style="vertical-align: 0.5em;"><span class="MJXp-mn" id="MJXp-Span-1283"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">20</font></font></span></span></span></span></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) por un tiempo razonable en uno, no la GPU más nueva. En las GPU más nuevas (Tesla V100), aparentemente, será posible procesar alrededor de dos millones de cuerpos que interactúan en un tiempo razonable, porque su rendimiento es aproximadamente cuatro veces mayor que la mitad del Tesla K80. Aunque este número también es incomparable con el número de estrellas incluso en galaxias enanas, como la</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;">Pequeña Nube de Magallanes</font></a><font style="vertical-align: inherit;">, pero, en mi opinión, es impresionante.</font></font><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-132-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-132">2^{20}</script><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br><br><h2>  Conclusión </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El uso de métodos integrados para resolver ecuaciones diferenciales permite resolver problemas similares con un alto nivel de precisión a un costo de tiempo relativamente pequeño, y la aplicación de algoritmos para aproximar la función de calcular las fuerzas de atracción por pares nos permite procesar volúmenes colosales de cuerpos que interactúan. </font><font style="vertical-align: inherit;">Por lo tanto, a diferencia de los extraterrestres de las "Tareas de tres cuerpos", podemos resolver el problema</font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1284"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1285"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N</font></font></span></span></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cuerpos, tanto para un pequeño número de cuerpos como para grupos de estrellas enteros, aunque a costa de alguna pérdida de precisión.</font></font><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-133-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-133">N</script><font style="vertical-align: inherit;"></font><br><br><h4>  Visualización </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para aquellos que han leído hasta el final, les daré algunos videos más con visualización de la evolución de los sistemas de los cuerpos. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Simulación de una colisión de dos galaxias. </font><font style="vertical-align: inherit;">El número total de cuerpos es de 60 mil.</font></font><br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/AYzgTC0qqV0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Modelando la evolución de una galaxia que consiste en un millón de estrellas. </font><font style="vertical-align: inherit;">En el centro hay un cuerpo con una masa del 99% del total. </font><font style="vertical-align: inherit;">Las partículas individuales son casi indistinguibles. </font><font style="vertical-align: inherit;">Ya más como una ola en una gota de líquido. </font><font style="vertical-align: inherit;">Coloreado según el módulo de velocidad. </font><font style="vertical-align: inherit;">Baja velocidad - azul, medio - verde, alto - rojo. </font><font style="vertical-align: inherit;">Se ve que en el centro la velocidad es mayor, y disminuye gradualmente hasta los bordes, y la más baja en el plano ecuatorial.</font></font><br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/0_8nZCrVqWI" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Una simulación más 'dinámica' de la evolución de una galaxia de un millón de estrellas. </font><font style="vertical-align: inherit;">En el centro hay un cuerpo con una masa del 10% del total. </font><font style="vertical-align: inherit;">El cuerpo central afecta el resto significativamente menos. </font><font style="vertical-align: inherit;">Primero, las "estrellas" se separan, luego se reúnen en varios grupos y al final nuevamente forman un gran grupo. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En el proceso de modelado, alrededor del 5% de las "estrellas" abandonaron la región inicial de manera irrevocable.</font></font><br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/XLvIPK6m6QI" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En el décimo segundo, se parece mucho a la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">galaxia de volteretas</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> existente </font><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El código del proyecto se puede encontrar en el </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/437014/">https://habr.com/ru/post/437014/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../437002/index.html">ASP.NET Core válido</a></li>
<li><a href="../437004/index.html">¿Los programadores de YML sueñan con pruebas ansibles?</a></li>
<li><a href="../437006/index.html">Reseña de la impresora 3D Wanhao Duplicator 10</a></li>
<li><a href="../437008/index.html">PNL. Lo basico. Técnicas Autodesarrollo. Parte 1</a></li>
<li><a href="../437010/index.html">Ecos del pasado: la experiencia de Young en la base del nuevo método de espectroscopía de rayos X</a></li>
<li><a href="../437018/index.html">Algunas trampas de tipeo estático en Python</a></li>
<li><a href="../437020/index.html">¿Qué tiene de malo el aprendizaje por refuerzo?</a></li>
<li><a href="../437022/index.html">Noise Security Bit 0x22 (Ataques de inyección de falla, 35C3 y Wallet.fail)</a></li>
<li><a href="../437026/index.html">Google en Francia multó 50 millones de euros por GDPR por mal uso de datos personales</a></li>
<li><a href="../437030/index.html">Automatización de la infraestructura de una oficina de lujo: cómo se ve</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>