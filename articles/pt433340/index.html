<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üè¥Û†ÅßÛ†Å¢Û†Å∑Û†Å¨Û†Å≥Û†Åø üòª ‚ìÇÔ∏è Dispositivos sem fio Xiaomi no ioBroker smart home üéΩ üñïüèæ ü§ûüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Sauda√ß√µes a todos os amantes da automa√ß√£o residencial. Decidi compartilhar a experi√™ncia de usar dispositivos sem fio Xiaomi com a interface ZigBee. H...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Dispositivos sem fio Xiaomi no ioBroker smart home</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/iobroker/blog/433340/">  Sauda√ß√µes a todos os amantes da automa√ß√£o residencial.  Decidi compartilhar a experi√™ncia de usar dispositivos sem fio Xiaomi com a interface ZigBee.  Honestamente, sou contra o uso de qualquer dispositivo sem fio em qualquer automa√ß√£o, desde sistemas s√©rios de controle de processos de objetos grandes a pequenas automa√ß√µes, como alarmes de inc√™ndio ou resid√™ncias inteligentes, mas ... As solu√ß√µes Xiaomi subornaram com baixo custo, acessibilidade, excelente design e muitas cr√≠ticas positivas dos usu√°rios, decidi para tentar. <br><br>  Esta publica√ß√£o deve ser tomada como uma instru√ß√£o passo a passo para a integra√ß√£o de dispositivos ZigBee na infraestrutura dom√©stica inteligente.  O descrito aqui n√£o √© de forma alguma um axioma e voc√™ pode encontrar muitas outras maneiras de conectar dispositivos ZigBee.  Se voc√™ ainda pular a descri√ß√£o detalhada, poder√° ter a impress√£o da complexidade ou facilidade de combinar dispositivos de diferentes fabricantes em uma plataforma local usando o exemplo do ZigBee e ioBroker (mais sobre isso mais tarde).  Neste artigo, mostrarei como conectar dispositivos a uma casa inteligente, exibir informa√ß√µes sobre eles em um tablet ou simplesmente em um navegador e enviar mensagens por telegramas sobre a altera√ß√£o do status do dispositivo.  Se sou do seu interesse, pe√ßo um gato. <br><a name="habracut"></a><br>  De acordo com o fabricante da Xiaomi, os usu√°rios devem usar um aplicativo nativo com uma conex√£o em nuvem e um gateway Wi-Fi para dispositivos ZigBee.  No entanto, h√° muito que se conhece um m√©todo para ativar o modo de desenvolvedor em um aplicativo para obter um token de controle.  Assim, dentro da rede local, voc√™ pode se comunicar com o gateway, o que permite <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">executar o</a> driver <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">mihome</a> , que faz parte do ioBroker. <br><br>  O ioBroker √© uma plataforma aberta para a IoT, inclusive para a constru√ß√£o de sistemas dom√©sticos inteligentes.  O que √© o ioBroker pode ser encontrado no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">artigo</a> anterior. <br><br>  Agora, minha casa inteligente est√° "girando" em uma placa ARM Cubietruck com algum "kit de corpo" na forma de um disco r√≠gido de 80 GB, baterias recarreg√°veis ‚Äã‚Äãde 5000 mAh, um mestre USB de 1 fio, um conversor USB-RS485 para pesquisar dispositivos usando o protocolo modbus.  O sistema operacional Armbian √© instalado no disco r√≠gido com a transfer√™ncia da parti√ß√£o raiz, apenas o carregador de inicializa√ß√£o permanece no cart√£o de mem√≥ria microSD. <br><br>  Comecei a conhecer os dispositivos sem fio Xiaomi comprando sensores de temperatura e umidade.  Naquela √©poca, a √∫nica possibilidade de integra√ß√£o era o driver <b>mihome</b> , mencionado acima. <br><br><h4>  Driver Mihome </h4><br>  Adicionar um driver ao sistema √© muito simples; voc√™ precisa clicar no bot√£o ‚Äú+‚Äù na lista de drivers dispon√≠veis e observar o processo de instala√ß√£o. <br><br><img src="https://habrastorage.org/webt/1q/uv/gs/1quvgskqfsscaszi1df_weidl_k.png"><br><br>  N√£o descreverei a instala√ß√£o e a configura√ß√£o inicial do aplicativo nativo do Android Mi Home, voc√™ pode v√™-lo na p√°gina do driver do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">github</a> ou na Internet.  Portanto, o modo de desenvolvedor √© ativado, o token √© recebido, configuramos o adaptador mihome, salvamos e executamos se ele n√£o tiver sido iniciado. <br><br><img src="https://habrastorage.org/webt/hg/gi/uz/hggiuzkuphbirpnjp1xdcwcxy2e.png"><br><br>  O gateway Xiaomi e os dispositivos conectados no aplicativo Mi Home devem aparecer na √°rvore de objetos. <br><br><img src="https://habrastorage.org/webt/tm/wf/gs/tmwfgsbmgvfncvw-gyezzdjhamw.png"><br><br>  Em seguida, voc√™ pode configurar os objetos rec√©m-criados.  Por exemplo, armazenando o hist√≥rico dos sensores de temperatura e umidade.  Eu uso um driver SQL para dados hist√≥ricos configurados em um banco de dados SQLite. <br><br><img src="https://habrastorage.org/webt/wv/op/yk/wvopykrwhlu2pcgdru82m1yv8sg.png"><br><br>  O armazenamento do hist√≥rico da vari√°vel √© configurado na janela de objetos do sistema: na hierarquia de objetos, voc√™ precisa acessar a vari√°vel em si e pressionar o bot√£o com uma chave inglesa √† direita.  Na guia "Configura√ß√µes", tenho o armazenamento de hist√≥rico ativado por sensores - apenas altera√ß√µes na vari√°vel. <br><br>  Outras configura√ß√µes: <br><br><ul><li>  intervalo m√≠nimo de 10 segundos - se a vari√°vel for alterada com mais frequ√™ncia, a entrada no banco de dados ser√° ignorada </li><li>  registrando valores a cada 300 segundos (5 minutos) - se a vari√°vel n√£o for alterada por mais de 5 minutos, o valor atual ainda ser√° gravado no banco de dados </li><li>  tipo de valor - n√∫mero </li><li>  prazo de validade - 1 ano </li></ul><br><img src="https://habrastorage.org/webt/a2/6n/ed/a26nedcztddt2fo4vofcdndkadu.png"><br><br>  A adi√ß√£o de novos dispositivos ocorre atrav√©s do aplicativo nativo.  I.e.  voc√™ precisa emparelhar o novo dispositivo com o gateway de acordo com as instru√ß√µes anexadas e, em seguida, ele aparecer√° automaticamente na lista de objetos do ioBroker. <br><br><h4>  Driver Zigbee </h4><br>  Era inconveniente para mim usar o aplicativo Xiaomi nativo, especialmente porque eu tinha que comprar um gateway com um plug chin√™s, que no meu caso, exceto pela comunica√ß√£o com os dispositivos, n√£o era √∫til para nada.  Sim, pode ser usado como luz noturna ou usar um sensor de luz em alguns cen√°rios.  Na Internet, voc√™ pode encontrar instru√ß√µes sobre como "alimentar" uma lista de reprodu√ß√£o para um gateway para reproduzir suas pr√≥prias esta√ß√µes de r√°dio, mas nada disso ficou comigo.  Al√©m disso, o pensamento de que meus dados estavam vazando em algum lugar, sendo processados ‚Äã‚Äãe armazenados em algum lugar era assustador. <br><br>  Um dos usu√°rios ativos da plataforma ioBroker encontrou na Internet a biblioteca <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">zigbee-shepherd</a> no node.js, na qual havia uma men√ß√£o √† conex√£o de dispositivos Xiaomi.  Um driver para ioBroker foi escrito com base nele, e o autor deste driver n√£o se limitou apenas aos dispositivos Xiaomi, a lista de dispositivos suportados √© constantemente atualizada e est√° dispon√≠vel na p√°gina do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">github</a> do projeto. <br><br>  √â suposto usar dispositivos prontos e baratos com base nos chips <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">CC25xx</a> da TI como coordenador de rede.  Voc√™ pode comprar m√≥dulos ZigBee prontos com conex√£o USB e uma antena embutida, al√©m de modelos mais caros e mais s√©rios: com antena externa, amplificador e conex√£o via UART. <br><br>  Para trabalhar com o driver, voc√™ s√≥ precisa alterar o firmware.  Assim, verifica-se que esse driver n√£o precisa de um gateway caro, n√£o s√£o necess√°rias redes Wi-Fi.  O "ponto de entrada" √© o coordenador - um dispositivo baseado no chip SS25xx com firmware especial.  Por meio do coordenador, h√° comunica√ß√£o direta dos dispositivos zigbee e do sistema Smart Home, al√©m da vincula√ß√£o de novos dispositivos. <br><br>  Como coordenador, uso uma placa-m√£e pronta com base em um chip CC2530 com uma antena externa, que eu conectei ao servidor via UART. <br><br>  Para o firmware do dispositivo, foi adquirido um depurador SmartRF04EB especial, cuja porta microUSB eu conectei ao computador e o m√≥dulo ZigBee conectado usando a fia√ß√£o para depura√ß√£o de acordo com o esquema: <br><table><tbody><tr><th>  SS2530 </th><th>  Placa SmartRF04EB </th></tr><tr><td>  P22 </td><td>  DC </td></tr><tr><td>  P21 </td><td>  DD </td></tr><tr><td>  Rst </td><td>  RESET </td></tr><tr><td>  GND </td><td>  GND </td></tr><tr><td>  Vcc </td><td>  3.3V </td></tr></tbody></table><br><br><img src="https://habrastorage.org/webt/zy/g3/mf/zyg3mfircqqapiz8vz59afyrm5g.jpeg"><br><br>  Na p√°gina <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">github</a> do projeto, baixe o firmware (o arquivo √© chamado CC2530ZNP-Pro-Secure_LinkKeyJoin.hex para este dispositivo) e o programa de firmware (programador flash), ap√≥s o qual os drivers necess√°rios s√£o adicionados ao sistema. <br>  Quando voc√™ conecta a placa depuradora √† porta USB do computador, o programa exibe imediatamente o dispositivo conectado.  Voc√™ s√≥ precisa especificar o caminho para o arquivo de firmware e clicar no bot√£o "Executar a√ß√µes" <br><br><img src="https://habrastorage.org/webt/7z/rd/w8/7zrdw8e3iwpyvisw6dzohkfn3zs.png"><br><br>  As portas do m√≥dulo ZigBee P03 (Rx) e P02 (Tx) s√£o conectadas nas placas de cubietruck UART4 (no SO como ttyS4), alimentadas em 3V3, o GND assumiu o pino vizinho.  Para uma opera√ß√£o est√°vel, voc√™ ainda precisa puxar as portas P20, P4, P5 do coordenador para o ch√£o.  Como escrevi acima, eu uso o sistema operacional Armbian, a porta UART √© ativada de maneira muito simples, usando o comando <b>armbian-config</b> na se√ß√£o <b>Sistema</b> - <b>Hardware</b> , voc√™ precisa ativar a porta desejada e reiniciar o sistema. <br><br><img src="https://habrastorage.org/webt/ic/7l/il/ic7lilxwfsext55fvjnpdyxfiuq.png"><br><br>  O driver zigbee √© adicionado no painel de administra√ß√£o com um clique. <br><br><img src="https://habrastorage.org/webt/uw/-d/zm/uw-dzmkdrsbgnunfmchqtzqq8ta.png"><br><br>  No meu caso, o coordenador est√° conectado √† porta <b>/ dev / ttyS4</b> (como escrevi acima), n√≥s a especificamos nas configura√ß√µes. <br><br><img src="https://habrastorage.org/webt/eu/2i/bo/eu2ibog5mba2paet4ecec7jo7aw.png"><br><br>  Outras configura√ß√µes podem ser deixadas por padr√£o.  Ap√≥s o primeiro lan√ßamento do driver, voc√™ precisa emparelhar (adicionar) dispositivos.  As instru√ß√µes completas no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">github</a> , emparelhar atrav√©s deste driver, s√£o um pouco mais complicadas do que no aplicativo nativo, mas n√£o tive problemas. <br><br>  Portanto, por exemplo, adicione o bot√£o Xiaomi (s√©rie Mijia). Para isso, pressionamos o bot√£o verde nas configura√ß√µes do driver e, seguindo as instru√ß√µes, primeiro segure o bot√£o de emparelhamento na parte traseira com um clipe de papel at√© que o LED comece a piscar e clique nesse bot√£o a cada 2 segundos, veja o progresso do emparelhamento. <br><br><img src="https://habrastorage.org/webt/mm/vq/ok/mmvqokw8ors3oszymkuqv5jsswq.png"><br><br>  Meu apartamento n√£o √© grande, com todos os dispositivos a conex√£o √© est√°vel, mesmo com um sensor de porta aberta no patamar (muro de concreto armado de 100 mm e 5 m em linha reta).  Os problemas come√ßaram quando eu decidi adicionar um sensor de temperatura e umidade ao ar da rua, que eu instalei na parede externa da casa, ao lado da galeria isolada.  O sinal de um sensor fraco, que tamb√©m estava na rua, n√£o chegou ao gabinete de automa√ß√£o.  O problema pode ser resolvido de maneira simples - voc√™ precisa adicionar um roteador √† rede ZigBee e coloc√°-lo mais pr√≥ximo do sensor.  Alguns dispositivos sem fio, por exemplo, o soquete Xiaomi, podem funcionar como roteadores, mas eu n√£o os tinha.  Eu n√£o queria comprar uma tomada cara ou uma luz controlada apenas para "encaminhar" dados de um sensor na rua.  Como se viu, para os mesmos dispositivos terminais baseados no chip SS25xx, existe um firmware especial que permite que eles sejam usados ‚Äã‚Äãcomo roteadores no sistema.  Como resultado, adicionei um roteador baseado no chip CC2531 com uma conex√£o USB.  N√£o vou me concentrar no processo do firmware, o esquema e o arquivo do firmware podem ser encontrados na p√°gina do projeto no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">github</a> . <br><br>  Como, de fato, a comunica√ß√£o com o m√≥dulo via porta USB n√£o ocorre, conectei-o temporariamente ao carregamento com a porta USB e a uma tomada na cozinha.  Em um futuro pr√≥ximo, planejo coloc√°-lo estacion√°rio em um edif√≠cio normal na varanda e com energia normal de um no-break dom√©stico. <br><br><img src="https://habrastorage.org/webt/kh/an/8v/khan8vzw8f5ueqs2n-jf-9kc2e4.jpeg"><br><br>  O processo de adi√ß√£o de um roteador ao sistema √© simples: pressione o bot√£o de emparelhamento no driver e, no roteador ligado, pressione o bot√£o S2 v√°rias vezes at√© que os dispositivos se conectem. <br><br><img src="https://habrastorage.org/webt/6g/x_/gf/6gx_gfpctjiecwfz8mtz3ah8bne.png"><br><br>  Vamos adicionar um exemplo de sensor de temperatura / umidade, localizado na varanda externa e que deve funcionar atrav√©s de um roteador. <br><br>  Voc√™ pode simplesmente fazer o emparelhamento atrav√©s do driver e o sensor deve se conectar atrav√©s do roteador, se estiver mais pr√≥ximo.  Mas voc√™ pode especificar √† for√ßa que o emparelhamento passa por um roteador espec√≠fico. Para isso, na lista de dispositivos no √≠cone do roteador, clique no bot√£o verde de emparelhamento. <br><br><img src="https://habrastorage.org/webt/bz/df/tr/bzdftrouwfsmd3qq0yyztpsfyee.png"><br><br>  Verifique se o sensor est√° conectado corretamente - consulte o mapa da rede. <br><br><img src="https://habrastorage.org/webt/g9/bj/ru/g9bjruowwwdc7tvq03p0vychauo.png"><br><br>  O mapa mostra as linhas de emparelhamento de dispositivos, indicando a qualidade do sinal entre os segmentos de rede.  Como escrevi acima, tenho um pequeno odnushka de 35 m2, portanto o mapa √© bastante modesto.  Com a permiss√£o de outros usu√°rios, publicarei op√ß√µes poss√≠veis com um cart√£o maior. <br><br><img src="https://habrastorage.org/webt/9b/r9/g6/9br9g6psblxtppn56-khinqtf90.png"><br><br><img src="https://habrastorage.org/webt/jo/--/ux/jo--uxxcnxpn_qtlah5yd4awl_g.png"><br><br><img src="https://habrastorage.org/webt/p0/lg/ba/p0lgba6-rpbvnqkcttsabf6wnaa.jpeg"><br><br>  A funcionalidade de alguns dispositivos Xiaomi atrav√©s deste adaptador √© um pouco mais do que atrav√©s do aplicativo nativo e do driver mihome.  No futuro, quero expandir um pouco a rede e experimentar novos dispositivos, em particular, um drive inteligente para cortinas e um cubo de sensor. <br><br><h4>  Driver de material </h4><br>  Temos os dados, os atuadores ligados, o que fazer agora com eles?  Primeiro, vamos exibir em uma interface bonita.  Eu tenho um projeto grande no driver do VIS, que existe em v√°rias vers√µes para permiss√µes diferentes, mas h√° material suficiente para um artigo separado.  Talvez ela seja a pr√≥xima. <br><br>  Para exibi√ß√£o simples e r√°pida de dados e controle de v√°rios dispositivos, eu uso o driver de material.  Instala√ß√£o como de costume em alguns cliques.  Os blocos de interface exibem dados com base nas configura√ß√µes de categoria, adicionadas na janela de administra√ß√£o da interface com o mesmo nome.  A lista de categorias √© limitada apenas pela imagina√ß√£o, eu uso o esquema de "fun√ß√£o da sala" e o agrupamento ocorre de acordo com elas.  Adicionadas todas as salas (cozinha, corredor, sala, varanda, etc.) e fun√ß√µes (ilumina√ß√£o, sensores, sistema, etc.). <br><br><img src="https://habrastorage.org/webt/le/nt/7p/lent7pos1th-k5mzz9yezdmug-m.png"><br><br>  Agora, na janela de configura√ß√µes dos objetos do sistema, √© necess√°rio que as vari√°veis ‚Äã‚Äãque ser√£o exibidas na tela indiquem a sala, fun√ß√£o e atribuam uma fun√ß√£o (para exibi√ß√£o adequada).  Um exemplo √© o sensor de temperatura e umidade da parede interna da Xiaomi, conectado via Bluetooth. <br><br><img src="https://habrastorage.org/webt/by/2u/ws/by2uwskolk1rxomzcm-mvg_rccw.png"><br><br>  Com base nessas configura√ß√µes, o bloco exibir√° dados na tela, o √≠cone ser√° apertado e objetos de um determinado tipo de controle estar√£o dispon√≠veis. <br><br>  <b>Exemplo 1.</b> A sa√≠da de todas as informa√ß√µes em uma categoria - fun√ß√£o.  Ilumina√ß√£o em todo o apartamento. <br><br><img src="https://habrastorage.org/webt/jp/xs/m3/jpxsm3v67xbi7otryix6xqemigu.png"><br><br>  <b>Exemplo 2.</b> A sa√≠da de todas as informa√ß√µes sobre o quarto - Banheiro. <br><br><img src="https://habrastorage.org/webt/5x/ce/2m/5xce2mjrmxjetxojelprdg95chg.png"><br><br>  <b>Exemplo 3. O</b> n√≠vel de tens√£o e descarga da bateria de todos os dispositivos sem fio Xiaomi. <br><br><img src="https://habrastorage.org/webt/40/t4/p3/40t4p3d-ggn71albkiy7aarsylo.png"><br><br>  Esse driver funciona para mim para o controle local do sistema a partir de um telefone celular, um tablet fixo na parede.  √Äs vezes eu me conecto via VPN.  Para controlar e visualizar estados remotamente, para receber notifica√ß√µes, eu uso o driver de telegrama. <br><br><h4>  Driver de telegrama </h4><br>  N√£o vou descrever a instala√ß√£o, basta revisar as configura√ß√µes.  Eu uso o modo de opera√ß√£o atrav√©s de pesquisas peri√≥dicas (300ms por padr√£o) e conex√£o atrav√©s de um servidor proxy.  Para obter o token, voc√™ precisa "conversar" com o criador do bots, o BotFather.  O processo √© simples - encontre uma pesquisa para este bot, d√™ um comando para criar um novo, especifique seu nome exclusivo e sua chave, indique-o nas configura√ß√µes do driver e, por seguran√ßa, especifique a senha de "sauda√ß√£o".  Seu bot perguntar√° a ele quando se comunicar com um novo usu√°rio. <br><br><img src="https://habrastorage.org/webt/du/nw/jt/dunwjtmlt874q5t1hma81lpz0qs.png"><br><br>  Agora voc√™ precisa configurar os casos de comunica√ß√£o atrav√©s do bot.  Voc√™ pode usar o driver text2command ou JavaScript para fazer isso.  Aconteceu historicamente que eu uso JavaScript tanto na forma de texto quanto em blocos Blockly.  A instala√ß√£o do driver JS n√£o deve causar dificuldades; a configura√ß√£o neste caso n√£o √© necess√°ria.  Ap√≥s a instala√ß√£o e o lan√ßamento, voc√™ precisa ativar a exibi√ß√£o do menu para criar e editar scripts. <br><br><img src="https://habrastorage.org/webt/wj/tc/pb/wjtcpbty2ro46bn6a5orrwbvpis.png"><br><br>  <b>Exemplo 1.</b> Alertas. <br><br>  Primeiro, vamos tentar enviar uma notifica√ß√£o sobre a abertura, por exemplo, da porta da frente.  Eu tenho um interruptor de sensor de palheta sem fio Xiaomi na porta da frente.  Monitoro como minha esposa anda com o pequeno enquanto estou no trabalho.  Crie um novo script no grupo comum. <br><br><img src="https://habrastorage.org/webt/cu/l6/5j/cul65jefd-k794nct-cicju7x64.png"><br><br>  Especifique o que ser√° "draw" em bloco e chame-o de "telegram_bot". <br><br><img src="https://habrastorage.org/webt/os/ed/kq/osedkqplopwii7ckmd3eftjliwo.png"><br><br>  No grupo "Eventos", pegamos a unidade de rea√ß√£o para alterar a vari√°vel e a arrastamos para o campo de trabalho. <br><br><img src="https://habrastorage.org/webt/1h/o6/yq/1ho6yq_kluvryjb48bdo9iijn-a.png"><br><br>  Em seguida, selecione o ID do objeto no qual estamos assinando, insira a verifica√ß√£o do objeto atrav√©s de "se" - "caso contr√°rio, se" como verdadeiro / falso.  O resultado deve ser algo como o seguinte. <br><br><img src="https://habrastorage.org/webt/9u/-r/0s/9u-r0sajaneojinyzpgojw2lnoa.png"><br><br>  Ok, agora estamos correndo, abrimos a porta - fechamos a porta e vemos mensagens no telegrama. <br><br><img src="https://habrastorage.org/webt/ae/07/u6/ae07u62jmarzp0nw1hv2a3bhv9y.png"><br><br>  <b>Exemplo 2.</b> Controle de ilumina√ß√£o atrav√©s do menu. <br>  Um exemplo √© mais complicado, vamos fazer o controle de ilumina√ß√£o usando os bot√µes de menu no telegrama.  Aqui voc√™ tem que ficar um pouco, isto √©,  ao criar um script, voc√™ precisa selecionar JS.  A tarefa √© aproximadamente a seguinte: criar bot√µes na forma de um menu com o status dos acess√≥rios exibidos imediatamente no texto da assinatura do bot√£o.  Ainda assim, verifique se, ao pressionar o bot√£o, o status da ilumina√ß√£o √© invertido e o status √© imediatamente atualizado no texto do bot√£o com a apar√™ncia / desaparecimento da l√¢mpada.  Al√©m disso, se o menu j√° estiver em execu√ß√£o e ligar / desligar manualmente a luz com o bot√£o, √© necess√°rio que o menu tamb√©m seja atualizado com o status dos equipamentos. <br>  O c√≥digo cont√©m coment√°rios e √© relativamente simples: <br><div class="oembed"><script type="text/javascript" src="https://gist.github.com/c980b9dd1c2e9d050810b11ed712b0c0.js"></script><link rel="stylesheet" href="https://github.githubassets.com/assets/gist-embed-31007ea0d3bd9f80540adfbc55afc7bd.css"><div id="gist93669305" class="gist">
    <div class="gist-file">
      <div class="gist-data">
        <div class="js-gist-file-update-container js-task-list-container file-box">
  <div id="file-telegram_bot" class="file">
    

  <div itemprop="text" class="Box-body p-0 blob-wrapper data type-text ">
      
<table class="highlight tab-size js-file-line-container" data-tab-size="8" data-paste-markdown-skip="">
      <tbody><tr>
        <td id="file-telegram_bot-L1" class="blob-num js-line-number" data-line-number="1"></td>
        <td id="file-telegram_bot-LC1" class="blob-code blob-code-inner js-file-line">//    ID   </td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L2" class="blob-num js-line-number" data-line-number="2"></td>
        <td id="file-telegram_bot-LC2" class="blob-code blob-code-inner js-file-line">const LIGHT1 = ' ',     CH_LIGHT1 = 'mqtt.0.PLC55_Lighting.lighting.MainRoom_main1';</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L3" class="blob-num js-line-number" data-line-number="3"></td>
        <td id="file-telegram_bot-LC3" class="blob-code blob-code-inner js-file-line">const LIGHT2 = ' ',      CH_LIGHT2 = 'mqtt.0.PLC55_Lighting.lighting.MainRoom_main2';</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L4" class="blob-num js-line-number" data-line-number="4"></td>
        <td id="file-telegram_bot-LC4" class="blob-code blob-code-inner js-file-line">const LIGHT3 = ' ',    CH_LIGHT3 = 'mqtt.0.PLC55_Lighting.lighting.MainRoom_sec';</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L5" class="blob-num js-line-number" data-line-number="5"></td>
        <td id="file-telegram_bot-LC5" class="blob-code blob-code-inner js-file-line">const LIGHT4 = ' ',      CH_LIGHT4 = 'mqtt.0.PLC55_Lighting.lighting.Kitchen_main';</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L6" class="blob-num js-line-number" data-line-number="6"></td>
        <td id="file-telegram_bot-LC6" class="blob-code blob-code-inner js-file-line">const LIGHT5 = ' 1',  	CH_LIGHT5 = 'mqtt.0.PLC55_Lighting.lighting.Kitchen_sec_top';</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L7" class="blob-num js-line-number" data-line-number="7"></td>
        <td id="file-telegram_bot-LC7" class="blob-code blob-code-inner js-file-line">const LIGHT6 = ' 2',    CH_LIGHT6 = 'mqtt.0.PLC55_Lighting.lighting.Kitchen_sec_bottom';</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L8" class="blob-num js-line-number" data-line-number="8"></td>
        <td id="file-telegram_bot-LC8" class="blob-code blob-code-inner js-file-line">const LIGHT7 = ' ',     CH_LIGHT7 = 'mqtt.0.PLC55_Lighting.lighting.BathRoom_main';</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L9" class="blob-num js-line-number" data-line-number="9"></td>
        <td id="file-telegram_bot-LC9" class="blob-code blob-code-inner js-file-line">const LIGHT8 = ' ',       CH_LIGHT8 = 'mqtt.0.PLC55_Lighting.lighting.Hall_main';</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L10" class="blob-num js-line-number" data-line-number="10"></td>
        <td id="file-telegram_bot-LC10" class="blob-code blob-code-inner js-file-line">const LIGHT9 = ' ',    CH_LIGHT9 = 'mqtt.0.PLC55_Lighting.lighting.Balcon_main';</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L11" class="blob-num js-line-number" data-line-number="11"></td>
        <td id="file-telegram_bot-LC11" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L12" class="blob-num js-line-number" data-line-number="12"></td>
        <td id="file-telegram_bot-LC12" class="blob-code blob-code-inner js-file-line">//    </td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L13" class="blob-num js-line-number" data-line-number="13"></td>
        <td id="file-telegram_bot-LC13" class="blob-code blob-code-inner js-file-line">function sendLightMenu(message_text) {</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L14" class="blob-num js-line-number" data-line-number="14"></td>
        <td id="file-telegram_bot-LC14" class="blob-code blob-code-inner js-file-line">	//   </td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L15" class="blob-num js-line-number" data-line-number="15"></td>
        <td id="file-telegram_bot-LC15" class="blob-code blob-code-inner js-file-line">    var l1 = getState(CH_LIGHT1).val ? 'üí°' : '';</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L16" class="blob-num js-line-number" data-line-number="16"></td>
        <td id="file-telegram_bot-LC16" class="blob-code blob-code-inner js-file-line">    var l2 = getState(CH_LIGHT2).val ? 'üí°' : '';</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L17" class="blob-num js-line-number" data-line-number="17"></td>
        <td id="file-telegram_bot-LC17" class="blob-code blob-code-inner js-file-line">    var l3 = getState(CH_LIGHT3).val ? 'üí°' : '';</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L18" class="blob-num js-line-number" data-line-number="18"></td>
        <td id="file-telegram_bot-LC18" class="blob-code blob-code-inner js-file-line">    var l4 = getState(CH_LIGHT4).val ? 'üí°' : '';</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L19" class="blob-num js-line-number" data-line-number="19"></td>
        <td id="file-telegram_bot-LC19" class="blob-code blob-code-inner js-file-line">    var l5 = getState(CH_LIGHT5).val ? 'üí°' : '';</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L20" class="blob-num js-line-number" data-line-number="20"></td>
        <td id="file-telegram_bot-LC20" class="blob-code blob-code-inner js-file-line">    var l6 = getState(CH_LIGHT6).val ? 'üí°' : '';</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L21" class="blob-num js-line-number" data-line-number="21"></td>
        <td id="file-telegram_bot-LC21" class="blob-code blob-code-inner js-file-line">    var l7 = getState(CH_LIGHT7).val ? 'üí°' : '';</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L22" class="blob-num js-line-number" data-line-number="22"></td>
        <td id="file-telegram_bot-LC22" class="blob-code blob-code-inner js-file-line">    var l8 = getState(CH_LIGHT8).val ? 'üí°' : '';</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L23" class="blob-num js-line-number" data-line-number="23"></td>
        <td id="file-telegram_bot-LC23" class="blob-code blob-code-inner js-file-line">    var l9 = getState(CH_LIGHT9).val ? 'üí°' : '';</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L24" class="blob-num js-line-number" data-line-number="24"></td>
        <td id="file-telegram_bot-LC24" class="blob-code blob-code-inner js-file-line">    // </td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L25" class="blob-num js-line-number" data-line-number="25"></td>
        <td id="file-telegram_bot-LC25" class="blob-code blob-code-inner js-file-line">	sendTo('telegram.0', {</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L26" class="blob-num js-line-number" data-line-number="26"></td>
        <td id="file-telegram_bot-LC26" class="blob-code blob-code-inner js-file-line">        text:   message_text,</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L27" class="blob-num js-line-number" data-line-number="27"></td>
        <td id="file-telegram_bot-LC27" class="blob-code blob-code-inner js-file-line">        reply_markup: {</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L28" class="blob-num js-line-number" data-line-number="28"></td>
        <td id="file-telegram_bot-LC28" class="blob-code blob-code-inner js-file-line">            keyboard: [</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L29" class="blob-num js-line-number" data-line-number="29"></td>
        <td id="file-telegram_bot-LC29" class="blob-code blob-code-inner js-file-line">                [LIGHT1+l1, LIGHT2+l2, LIGHT3+l3],</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L30" class="blob-num js-line-number" data-line-number="30"></td>
        <td id="file-telegram_bot-LC30" class="blob-code blob-code-inner js-file-line">                [LIGHT4+l4, LIGHT5+l5, LIGHT6+l6],</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L31" class="blob-num js-line-number" data-line-number="31"></td>
        <td id="file-telegram_bot-LC31" class="blob-code blob-code-inner js-file-line">                [LIGHT7+l7, LIGHT8+l8, LIGHT9+l9]</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L32" class="blob-num js-line-number" data-line-number="32"></td>
        <td id="file-telegram_bot-LC32" class="blob-code blob-code-inner js-file-line">            ],</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L33" class="blob-num js-line-number" data-line-number="33"></td>
        <td id="file-telegram_bot-LC33" class="blob-code blob-code-inner js-file-line">            resize_keyboard:   true,</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L34" class="blob-num js-line-number" data-line-number="34"></td>
        <td id="file-telegram_bot-LC34" class="blob-code blob-code-inner js-file-line">            one_time_keyboard: true</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L35" class="blob-num js-line-number" data-line-number="35"></td>
        <td id="file-telegram_bot-LC35" class="blob-code blob-code-inner js-file-line">        }</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L36" class="blob-num js-line-number" data-line-number="36"></td>
        <td id="file-telegram_bot-LC36" class="blob-code blob-code-inner js-file-line">    });</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L37" class="blob-num js-line-number" data-line-number="37"></td>
        <td id="file-telegram_bot-LC37" class="blob-code blob-code-inner js-file-line">}</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L38" class="blob-num js-line-number" data-line-number="38"></td>
        <td id="file-telegram_bot-LC38" class="blob-code blob-code-inner js-file-line">//  </td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L39" class="blob-num js-line-number" data-line-number="39"></td>
        <td id="file-telegram_bot-LC39" class="blob-code blob-code-inner js-file-line">function changeLight(room, channel) {</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L40" class="blob-num js-line-number" data-line-number="40"></td>
        <td id="file-telegram_bot-LC40" class="blob-code blob-code-inner js-file-line">	//   </td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L41" class="blob-num js-line-number" data-line-number="41"></td>
        <td id="file-telegram_bot-LC41" class="blob-code blob-code-inner js-file-line">    var alive = getState("mqtt.0.info.connection").val;</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L42" class="blob-num js-line-number" data-line-number="42"></td>
        <td id="file-telegram_bot-LC42" class="blob-code blob-code-inner js-file-line">    if (alive.includes("PLC55_Lighting")) {</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L43" class="blob-num js-line-number" data-line-number="43"></td>
        <td id="file-telegram_bot-LC43" class="blob-code blob-code-inner js-file-line">        if (getState(channel).val) {</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L44" class="blob-num js-line-number" data-line-number="44"></td>
        <td id="file-telegram_bot-LC44" class="blob-code blob-code-inner js-file-line">            setState(channel, false, false, function () {</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L45" class="blob-num js-line-number" data-line-number="45"></td>
        <td id="file-telegram_bot-LC45" class="blob-code blob-code-inner js-file-line">                sendLightMenu(room+' ');</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L46" class="blob-num js-line-number" data-line-number="46"></td>
        <td id="file-telegram_bot-LC46" class="blob-code blob-code-inner js-file-line">            });</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L47" class="blob-num js-line-number" data-line-number="47"></td>
        <td id="file-telegram_bot-LC47" class="blob-code blob-code-inner js-file-line">        } else { </td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L48" class="blob-num js-line-number" data-line-number="48"></td>
        <td id="file-telegram_bot-LC48" class="blob-code blob-code-inner js-file-line">            setState(channel, true, false, function () {</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L49" class="blob-num js-line-number" data-line-number="49"></td>
        <td id="file-telegram_bot-LC49" class="blob-code blob-code-inner js-file-line">                sendLightMenu(room+' ');</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L50" class="blob-num js-line-number" data-line-number="50"></td>
        <td id="file-telegram_bot-LC50" class="blob-code blob-code-inner js-file-line">            });</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L51" class="blob-num js-line-number" data-line-number="51"></td>
        <td id="file-telegram_bot-LC51" class="blob-code blob-code-inner js-file-line">        }</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L52" class="blob-num js-line-number" data-line-number="52"></td>
        <td id="file-telegram_bot-LC52" class="blob-code blob-code-inner js-file-line">    } else {</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L53" class="blob-num js-line-number" data-line-number="53"></td>
        <td id="file-telegram_bot-LC53" class="blob-code blob-code-inner js-file-line">        sendLightMenu('  OFFLINE');</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L54" class="blob-num js-line-number" data-line-number="54"></td>
        <td id="file-telegram_bot-LC54" class="blob-code blob-code-inner js-file-line">    }</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L55" class="blob-num js-line-number" data-line-number="55"></td>
        <td id="file-telegram_bot-LC55" class="blob-code blob-code-inner js-file-line">}</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L56" class="blob-num js-line-number" data-line-number="56"></td>
        <td id="file-telegram_bot-LC56" class="blob-code blob-code-inner js-file-line">//   request  ,    </td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L57" class="blob-num js-line-number" data-line-number="57"></td>
        <td id="file-telegram_bot-LC57" class="blob-code blob-code-inner js-file-line">on({id: "telegram.0.communicate.request", ack: false, change: 'any'}, function (obj) {</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L58" class="blob-num js-line-number" data-line-number="58"></td>
        <td id="file-telegram_bot-LC58" class="blob-code blob-code-inner js-file-line">    var msg = obj.state.val;</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L59" class="blob-num js-line-number" data-line-number="59"></td>
        <td id="file-telegram_bot-LC59" class="blob-code blob-code-inner js-file-line">    var command = obj.state.val.substring(obj.state.val.indexOf(']')+1);</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L60" class="blob-num js-line-number" data-line-number="60"></td>
        <td id="file-telegram_bot-LC60" class="blob-code blob-code-inner js-file-line">    var user = obj.state.val.substring(obj.state.val.indexOf('[')+1,obj.state.val.indexOf(']'));</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L61" class="blob-num js-line-number" data-line-number="61"></td>
        <td id="file-telegram_bot-LC61" class="blob-code blob-code-inner js-file-line">    var chat_id = getState("telegram.0.communicate.requestChatId").val;</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L62" class="blob-num js-line-number" data-line-number="62"></td>
        <td id="file-telegram_bot-LC62" class="blob-code blob-code-inner js-file-line">    var message_id = getState("telegram.0.communicate.requestMessageId").val;</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L63" class="blob-num js-line-number" data-line-number="63"></td>
        <td id="file-telegram_bot-LC63" class="blob-code blob-code-inner js-file-line">    var handled = false;</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L64" class="blob-num js-line-number" data-line-number="64"></td>
        <td id="file-telegram_bot-LC64" class="blob-code blob-code-inner js-file-line">    //     </td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L65" class="blob-num js-line-number" data-line-number="65"></td>
        <td id="file-telegram_bot-LC65" class="blob-code blob-code-inner js-file-line">	if (command == '/start' || command == '/menu' || command == '' || command == '') {</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L66" class="blob-num js-line-number" data-line-number="66"></td>
        <td id="file-telegram_bot-LC66" class="blob-code blob-code-inner js-file-line">        sendLightMenu("");</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L67" class="blob-num js-line-number" data-line-number="67"></td>
        <td id="file-telegram_bot-LC67" class="blob-code blob-code-inner js-file-line">        handled = true;</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L68" class="blob-num js-line-number" data-line-number="68"></td>
        <td id="file-telegram_bot-LC68" class="blob-code blob-code-inner js-file-line">    }</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L69" class="blob-num js-line-number" data-line-number="69"></td>
        <td id="file-telegram_bot-LC69" class="blob-code blob-code-inner js-file-line">//######################## Lighting menu and commands ################</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L70" class="blob-num js-line-number" data-line-number="70"></td>
        <td id="file-telegram_bot-LC70" class="blob-code blob-code-inner js-file-line">    if (command == LIGHT1 || command == LIGHT1+'üí°') {</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L71" class="blob-num js-line-number" data-line-number="71"></td>
        <td id="file-telegram_bot-LC71" class="blob-code blob-code-inner js-file-line">        changeLight(LIGHT1, CH_LIGHT1);</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L72" class="blob-num js-line-number" data-line-number="72"></td>
        <td id="file-telegram_bot-LC72" class="blob-code blob-code-inner js-file-line">        handled = true;</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L73" class="blob-num js-line-number" data-line-number="73"></td>
        <td id="file-telegram_bot-LC73" class="blob-code blob-code-inner js-file-line">    }</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L74" class="blob-num js-line-number" data-line-number="74"></td>
        <td id="file-telegram_bot-LC74" class="blob-code blob-code-inner js-file-line">    if (command == LIGHT2 || command == LIGHT2+'üí°') {</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L75" class="blob-num js-line-number" data-line-number="75"></td>
        <td id="file-telegram_bot-LC75" class="blob-code blob-code-inner js-file-line">        changeLight(LIGHT2, CH_LIGHT2);</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L76" class="blob-num js-line-number" data-line-number="76"></td>
        <td id="file-telegram_bot-LC76" class="blob-code blob-code-inner js-file-line">        handled = true;</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L77" class="blob-num js-line-number" data-line-number="77"></td>
        <td id="file-telegram_bot-LC77" class="blob-code blob-code-inner js-file-line">    }</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L78" class="blob-num js-line-number" data-line-number="78"></td>
        <td id="file-telegram_bot-LC78" class="blob-code blob-code-inner js-file-line">    if (command == LIGHT3 || command == LIGHT3+'üí°') {</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L79" class="blob-num js-line-number" data-line-number="79"></td>
        <td id="file-telegram_bot-LC79" class="blob-code blob-code-inner js-file-line">        changeLight(LIGHT3, CH_LIGHT3);</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L80" class="blob-num js-line-number" data-line-number="80"></td>
        <td id="file-telegram_bot-LC80" class="blob-code blob-code-inner js-file-line">        handled = true;</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L81" class="blob-num js-line-number" data-line-number="81"></td>
        <td id="file-telegram_bot-LC81" class="blob-code blob-code-inner js-file-line">    }</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L82" class="blob-num js-line-number" data-line-number="82"></td>
        <td id="file-telegram_bot-LC82" class="blob-code blob-code-inner js-file-line">    if (command == LIGHT4 || command == LIGHT4+'üí°') {</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L83" class="blob-num js-line-number" data-line-number="83"></td>
        <td id="file-telegram_bot-LC83" class="blob-code blob-code-inner js-file-line">        changeLight(LIGHT4, CH_LIHT4);</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L84" class="blob-num js-line-number" data-line-number="84"></td>
        <td id="file-telegram_bot-LC84" class="blob-code blob-code-inner js-file-line">        handled = true;</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L85" class="blob-num js-line-number" data-line-number="85"></td>
        <td id="file-telegram_bot-LC85" class="blob-code blob-code-inner js-file-line">    }</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L86" class="blob-num js-line-number" data-line-number="86"></td>
        <td id="file-telegram_bot-LC86" class="blob-code blob-code-inner js-file-line">    if (command == LIGHT5 || command == LIGHT5+'üí°') {</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L87" class="blob-num js-line-number" data-line-number="87"></td>
        <td id="file-telegram_bot-LC87" class="blob-code blob-code-inner js-file-line">        changeLight(LIGHT5, CH_LIGHT5);</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L88" class="blob-num js-line-number" data-line-number="88"></td>
        <td id="file-telegram_bot-LC88" class="blob-code blob-code-inner js-file-line">        handled = true;</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L89" class="blob-num js-line-number" data-line-number="89"></td>
        <td id="file-telegram_bot-LC89" class="blob-code blob-code-inner js-file-line">    }</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L90" class="blob-num js-line-number" data-line-number="90"></td>
        <td id="file-telegram_bot-LC90" class="blob-code blob-code-inner js-file-line">    if (command == LIGHT6 || command == LIGHT6+'üí°') {</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L91" class="blob-num js-line-number" data-line-number="91"></td>
        <td id="file-telegram_bot-LC91" class="blob-code blob-code-inner js-file-line">        changeLight(LIGHT6, CH_LIGHT6);</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L92" class="blob-num js-line-number" data-line-number="92"></td>
        <td id="file-telegram_bot-LC92" class="blob-code blob-code-inner js-file-line">        handled = true;</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L93" class="blob-num js-line-number" data-line-number="93"></td>
        <td id="file-telegram_bot-LC93" class="blob-code blob-code-inner js-file-line">    }</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L94" class="blob-num js-line-number" data-line-number="94"></td>
        <td id="file-telegram_bot-LC94" class="blob-code blob-code-inner js-file-line">    if (command == LIGHT7 || command == LIGHT7+'üí°') {</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L95" class="blob-num js-line-number" data-line-number="95"></td>
        <td id="file-telegram_bot-LC95" class="blob-code blob-code-inner js-file-line">        changeLight(LIGHT7, CH_LIGHT7);</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L96" class="blob-num js-line-number" data-line-number="96"></td>
        <td id="file-telegram_bot-LC96" class="blob-code blob-code-inner js-file-line">        handled = true;</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L97" class="blob-num js-line-number" data-line-number="97"></td>
        <td id="file-telegram_bot-LC97" class="blob-code blob-code-inner js-file-line">    }</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L98" class="blob-num js-line-number" data-line-number="98"></td>
        <td id="file-telegram_bot-LC98" class="blob-code blob-code-inner js-file-line">    if (command == LIGHT8 || command == LIGHT8+'üí°') {</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L99" class="blob-num js-line-number" data-line-number="99"></td>
        <td id="file-telegram_bot-LC99" class="blob-code blob-code-inner js-file-line">        changeLight(LIGHT8, CH_LIGHT8);</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L100" class="blob-num js-line-number" data-line-number="100"></td>
        <td id="file-telegram_bot-LC100" class="blob-code blob-code-inner js-file-line">        handled = true;</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L101" class="blob-num js-line-number" data-line-number="101"></td>
        <td id="file-telegram_bot-LC101" class="blob-code blob-code-inner js-file-line">    }</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L102" class="blob-num js-line-number" data-line-number="102"></td>
        <td id="file-telegram_bot-LC102" class="blob-code blob-code-inner js-file-line">    if (command == LIGHT9 || command == LIGHT9+'üí°') {</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L103" class="blob-num js-line-number" data-line-number="103"></td>
        <td id="file-telegram_bot-LC103" class="blob-code blob-code-inner js-file-line">        changeLight(LIGHT9, CH_LIGHT9);</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L104" class="blob-num js-line-number" data-line-number="104"></td>
        <td id="file-telegram_bot-LC104" class="blob-code blob-code-inner js-file-line">        handled = true;</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L105" class="blob-num js-line-number" data-line-number="105"></td>
        <td id="file-telegram_bot-LC105" class="blob-code blob-code-inner js-file-line">    }</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L106" class="blob-num js-line-number" data-line-number="106"></td>
        <td id="file-telegram_bot-LC106" class="blob-code blob-code-inner js-file-line">	//       ,      text2command</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L107" class="blob-num js-line-number" data-line-number="107"></td>
        <td id="file-telegram_bot-LC107" class="blob-code blob-code-inner js-file-line">    if (!handled) {</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L108" class="blob-num js-line-number" data-line-number="108"></td>
        <td id="file-telegram_bot-LC108" class="blob-code blob-code-inner js-file-line">        sendTo('text2command.0', {</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L109" class="blob-num js-line-number" data-line-number="109"></td>
        <td id="file-telegram_bot-LC109" class="blob-code blob-code-inner js-file-line">            text: command.replace(/\//g, '#').replace(/_/g, ' '),</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L110" class="blob-num js-line-number" data-line-number="110"></td>
        <td id="file-telegram_bot-LC110" class="blob-code blob-code-inner js-file-line">            id: chat_id,</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L111" class="blob-num js-line-number" data-line-number="111"></td>
        <td id="file-telegram_bot-LC111" class="blob-code blob-code-inner js-file-line">            user: user</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L112" class="blob-num js-line-number" data-line-number="112"></td>
        <td id="file-telegram_bot-LC112" class="blob-code blob-code-inner js-file-line">        }, function (response) {</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L113" class="blob-num js-line-number" data-line-number="113"></td>
        <td id="file-telegram_bot-LC113" class="blob-code blob-code-inner js-file-line">            if (response &amp;&amp; response.response) {</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L114" class="blob-num js-line-number" data-line-number="114"></td>
        <td id="file-telegram_bot-LC114" class="blob-code blob-code-inner js-file-line">                sendTo('telegram.0', {user: user, text: response.response});</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L115" class="blob-num js-line-number" data-line-number="115"></td>
        <td id="file-telegram_bot-LC115" class="blob-code blob-code-inner js-file-line">            }</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L116" class="blob-num js-line-number" data-line-number="116"></td>
        <td id="file-telegram_bot-LC116" class="blob-code blob-code-inner js-file-line">        });</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L117" class="blob-num js-line-number" data-line-number="117"></td>
        <td id="file-telegram_bot-LC117" class="blob-code blob-code-inner js-file-line">    }</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L118" class="blob-num js-line-number" data-line-number="118"></td>
        <td id="file-telegram_bot-LC118" class="blob-code blob-code-inner js-file-line">});</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L119" class="blob-num js-line-number" data-line-number="119"></td>
        <td id="file-telegram_bot-LC119" class="blob-code blob-code-inner js-file-line">//   ,   </td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L120" class="blob-num js-line-number" data-line-number="120"></td>
        <td id="file-telegram_bot-LC120" class="blob-code blob-code-inner js-file-line">on({id: /^mqtt\.0\.PLC55_Lighting\.lighting\..*$/, ack: true, change: 'ne'}, function (obj) {</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L121" class="blob-num js-line-number" data-line-number="121"></td>
        <td id="file-telegram_bot-LC121" class="blob-code blob-code-inner js-file-line">    sendLightMenu(" ");</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L122" class="blob-num js-line-number" data-line-number="122"></td>
        <td id="file-telegram_bot-LC122" class="blob-code blob-code-inner js-file-line">});</td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L123" class="blob-num js-line-number" data-line-number="123"></td>
        <td id="file-telegram_bot-LC123" class="blob-code blob-code-inner js-file-line">//       </td>
      </tr>
      <tr>
        <td id="file-telegram_bot-L124" class="blob-num js-line-number" data-line-number="124"></td>
        <td id="file-telegram_bot-LC124" class="blob-code blob-code-inner js-file-line">sendLightMenu("");</td>
      </tr>
</tbody></table>


  </div>

  </div>
</div>

      </div>
      <div class="gist-meta">
        <a href="" style="float:right">view raw</a>
        <a href="">telegram_bot</a>
        hosted with ‚ù§ by <a href="">GitHub</a>
      </div>
    </div>
</div>
</div><br><br>  O resultado deve ser algo como isto: <br><br><img src="https://habrastorage.org/webt/wm/kw/dj/wmkwdjedebx86h6ujqutsik93sa.png"><br><br><h4>  Conclus√£o </h4><br>  O artigo acabou sendo longo, mas espero que seja √∫til, e talvez facilite a vida de alguns usu√°rios ou incentive algu√©m a criar sua pr√≥pria casa inteligente. <br>  No momento, meu sistema residencial inteligente baseado no ioBroker est√° em funcionamento h√° 4 anos e estou bastante satisfeito com isso.  Al√©m do ZigBee, v√°rios controladores caseiros via MQTT e HTTP tamb√©m est√£o conectados a ele para controlar ilumina√ß√£o, ventila√ß√£o e outros sistemas, uma rede de sensores de temperatura no barramento de 1 fio, um dispositivo de monitoramento de fonte de alimenta√ß√£o no barramento RS485 e no protocolo RTU modbus e muito mais. <br><br>  No meu cofrinho de solu√ß√µes para uma casa inteligente, acumulei muitas id√©ias, embora, provavelmente, elas devam ser percebidas mais como um cofrinho de problemas para uma casa inteligente (aqueles que entendem o t√≥pico sobre o que quero dizer).  Deixe seus desejos nos coment√°rios para me ajudar a decidir sobre o t√≥pico do pr√≥ximo artigo. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt433340/">https://habr.com/ru/post/pt433340/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt433330/index.html">Resolver palavras cruzadas em japon√™s com o SAT Solver</a></li>
<li><a href="../pt433332/index.html">Suporte de Python nas fun√ß√µes do Azure</a></li>
<li><a href="../pt433334/index.html">Comportamentos XAML para WPF agora √© Open Source</a></li>
<li><a href="../pt433336/index.html">A implementa√ß√£o da biblioteca babil√¥nica</a></li>
<li><a href="../pt433338/index.html">Vis√£o geral do fabricante da impressora 3D Creality</a></li>
<li><a href="../pt433342/index.html">Outro processador verilog simples</a></li>
<li><a href="../pt433344/index.html">Dois sucessos de espa√ßo privado</a></li>
<li><a href="../pt433346/index.html">Mudando de Redshift para ClickHouse</a></li>
<li><a href="../pt433348/index.html">DSL digitado no TypeScript de JSX</a></li>
<li><a href="../pt433350/index.html">Eventos digitais em Moscou, de 17 a 23 de dezembro</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>