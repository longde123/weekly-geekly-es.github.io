<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ôÇÔ∏è ü§≥üèª üëâüèΩ Desenvolvimento do ‚Äúfirmware‚Äù mais simples para FPGAs instalados no Redd e depura√ß√£o usando o teste de mem√≥ria como exemplo üòó üßñüèæ üêà</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="De alguma forma, n√£o consigo expressar meus pensamentos brevemente. No outono passado, havia um desejo de contar com mais detalhes sobre a arquitetura...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Desenvolvimento do ‚Äúfirmware‚Äù mais simples para FPGAs instalados no Redd e depura√ß√£o usando o teste de mem√≥ria como exemplo</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/452656/">  De alguma forma, n√£o consigo expressar meus pensamentos brevemente.  No outono passado, havia um desejo de contar com mais detalhes sobre a arquitetura PSoC que eu dominava, o que resultou em uma s√©rie de artigos sobre ela.  Agora estou envolvido na prepara√ß√£o do hardware para o nosso complexo de depura√ß√£o remota Redd, que foi descrito <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> , e quero jogar fora a experi√™ncia acumulada em forma de texto.  Ainda n√£o tenho certeza, mas parece-me que novamente n√£o √© apenas um artigo, mas um ciclo.  Primeiro, √© assim que irei documentar os m√©todos de desenvolvimento desenvolvidos que podem ser √∫teis para algu√©m, tanto ao trabalhar com o complexo quanto, em geral, e em segundo lugar, o conceito ainda √© novo, ainda n√£o estabelecido.  Talvez, no processo de discuss√£o de artigos, alguns coment√°rios apare√ßam, dos quais se possa desenhar algo para expandi-lo (ou at√© mudar).  Portanto, prosseguimos. <br><img src="https://habrastorage.org/webt/lk/xe/c9/lkxec9ijefezvvydvjbmi49ahny.jpeg"><br><a name="habracut"></a><br><br><h2>  Introdu√ß√£o longa </h2><br>  Eu realmente n√£o gosto de teorizar, preferindo apresentar algumas coisas pr√°ticas de uma s√≥ vez.  Mas no come√ßo do primeiro artigo, sem uma longa introdu√ß√£o em qualquer lugar.  Nele, justifico a abordagem atual do desenvolvimento.  E tudo girar√° em torno de uma coisa: a hora de trabalho √© um recurso muito caro.  E o assunto n√£o est√° apenas nos termos alocados para o projeto.  Ele √© fisicamente caro.  Se √© gasto no desenvolvimento do produto final, bem, o que voc√™ pode fazer sem ele em lugar nenhum.  Mas quando √© gasto em trabalho auxiliar, isso, na minha opini√£o, √© ruim.  Lembro que tive uma disputa com um desenvolvedor que disse que, tendo feito prot√≥tipos por conta pr√≥pria, ele economizaria dinheiro para sua empresa nativa.  Argumentei que ele passaria cerca de 3 dias na fabrica√ß√£o.  S√£o 24 horas de trabalho.  Tomamos o sal√°rio dele por esse hor√°rio, acrescentamos o imposto social que "o empregador paga", bem como o aluguel do escrit√≥rio por esse hor√°rio.  E ficamos surpresos ao ver que, ao encomendar placas ao lado, voc√™ pode obter custos mais baixos.  Mas esse sou eu, exagero.  Em geral, se os custos trabalhistas puderem ser evitados, eles dever√£o ser evitados. <br><br>  Qual √© o desenvolvimento de "firmware" para o complexo Redd?  Este √© um trabalho auxiliar.  O projeto principal viver√° feliz para sempre; deve ser feito da maneira mais eficiente poss√≠vel, com excelente otimiza√ß√£o etc.  Mas gastar tempo e energia em coisas auxiliares que ir√£o para o arquivo ap√≥s o desenvolvimento √© um desperd√≠cio.  Foi de olho neste princ√≠pio que o desenvolvimento do equipamento Redd foi realizado.  Todas as fun√ß√µes, se poss√≠vel, s√£o implementadas como itens padr√£o.  Os barramentos SPI, I2C e UART s√£o implementados em microcircuitos FTDI padr√£o e s√£o programados atrav√©s de drivers padr√£o, sem frescuras.  O gerenciamento de bobinas √© implementado no formato de uma porta COM virtual.  Pode ser modificado, mas pelo menos tudo foi feito para que esse desejo n√£o surja.  Em geral, tudo o que √© padr√£o, se poss√≠vel, √© implementado de maneira padr√£o.  De um projeto para outro, os desenvolvedores simplesmente precisam escrever rapidamente um c√≥digo t√≠pico para o PC acessar esses barramentos.  A t√©cnica de desenvolvimento em C ++ deve ser √≥bvia para quem desenvolve programas para microcontroladores (falaremos sobre alguns detalhes t√©cnicos em outro artigo). <br><br>  Mas o FPGA fica sozinho no complexo.  Ele √© adicionado ao sistema nos casos em que √© necess√°rio implementar qualquer protocolo n√£o padr√£o com um requisito de alto desempenho.  Se isso for necess√°rio, voc√™ ter√° que fazer o "firmware" para isso.  Trata-se da programa√ß√£o FPGA e quero falar especificamente, apenas para o mesmo objetivo - reduzir o tempo de desenvolvimento de coisas auxiliares. <br><br>  Para n√£o confundir o leitor, formularei o pensamento em um quadro: <br><blockquote>  N√£o √© necess√°rio conduzir o desenvolvimento de FPGAs em cada projeto.  Se houver controladores de barramento suficientes conectados diretamente ao processador central para funcionar com o dispositivo de destino, voc√™ dever√° us√°-los. <br>  O FPGA foi adicionado ao complexo para a implementa√ß√£o de protocolos n√£o padr√£o. </blockquote><br><br><h2>  Diagrama de blocos do complexo </h2><br>  Vejamos o diagrama de blocos do complexo <br><br><img src="https://habrastorage.org/webt/vf/hv/da/vfhvda1kmsax-zkxaue4xu_ysmk.png"><br><br>  Na parte inferior do circuito √© uma "calculadora".  Na verdade, este √© um PC padr√£o com Linux.  Os desenvolvedores podem escrever programas regulares em C, C ++, Python, etc., que ser√£o executados pelo computador.  Na parte superior direita est√£o as portas padr√£o dos pneus padr√£o.  √Ä esquerda, h√° um comutador para dispositivos padr√£o (SPI Flash, cart√£o SD e v√°rios rel√©s de estado s√≥lido de baixa corrente, que podem, por exemplo, simular o pressionamento de bot√µes).  E no centro est√° exatamente essa parte, cujo trabalho est√° planejado para ser considerado nesta s√©rie de artigos.  Seu cora√ß√£o √© o FPGA da classe FPGA, do qual as linhas retas (podem ser usadas como pares diferenciais ou linhas sem buffer comuns), as linhas GPIO com um n√≠vel l√≥gico configur√°vel e um barramento USB 2.0 implementado atrav√©s do chip ULPI v√£o para o conector. <br><br><h2>  Continua√ß√£o da introdu√ß√£o sobre a abordagem de programa√ß√£o FPGA </h2><br>  Ao desenvolver uma l√≥gica de controle de alto desempenho para FPGAs, geralmente Sua Majestade √© tocada como o primeiro violino por uma m√°quina de estado.  √â nas m√°quinas que √© poss√≠vel implementar l√≥gica de alta velocidade, mas complexa.  Mas, por outro lado, um aut√¥mato √© desenvolvido mais lentamente que um programa para um processador, e sua modifica√ß√£o √© outro processo.  Existem sistemas que simplificam o desenvolvimento e a manuten√ß√£o de m√°quinas.  Um deles foi desenvolvido por nossa empresa, mas ainda assim, o processo de design para qualquer tipo de l√≥gica complexa n√£o √© r√°pido.  Quando o sistema desenvolvido √© o produto final, faz sentido preparar, projetar uma boa m√°quina de controle e gastar tempo em sua implementa√ß√£o.  Mas, como j√° observado, o desenvolvimento do Redd √© um trabalho auxiliar.  Ele foi projetado para facilitar o processo, n√£o para complic√°-lo.  Portanto, foi decidido que o desenvolvimento n√£o ser√° autom√°tico, mas sim sistemas de processador. <br><br>  Mas, por outro lado, ao desenvolver o hardware, a op√ß√£o mais elegante at√© hoje, o FPGA com o n√∫cleo ARM, foi rejeitada.  Em primeiro lugar, por raz√µes de pre√ßo.  Uma placa de prot√≥tipo baseada no SoC do Cyclone V √© moderadamente cara, mas, curiosamente, um FPGA separado √© muito mais caro.  Muito provavelmente, o pre√ßo das placas de prototipagem √© reduzido para atrair os desenvolvedores a usar dados FPGA, e as placas s√£o vendidas individualmente.  A s√©rie ter√° que levar fichas individuais.  Mas, al√©m disso, h√° tamb√©m um "segundo".  Em segundo lugar, quando eu estava experimentando o Cyclone V SoC, descobriu-se que esse sistema de processador n√£o √© assim e √© produtivo quando se trata de acesso √∫nico √†s portas.  Lote - sim, o trabalho √© r√°pido.  E no caso de acessos √∫nicos com uma freq√º√™ncia de clock do n√∫cleo do processador de 925 MHz, voc√™ pode obter acesso √†s portas com uma frequ√™ncia de alguns megahertz.  Para todos, proponho chamar a fun√ß√£o padr√£o de inserir dados no FIFO do bloco UART, que verifica o estouro da fila, mas cham√°-lo quando a fila est√° obviamente vazia, ou seja, nada interfere nas opera√ß√µes.  Minha produtividade passou de um milh√£o para quinhentas mil chamadas por segundo (√© claro, trabalhar com a mem√≥ria foi na velocidade normal, todos os caches foram ajustados, at√© a variante de fun√ß√£o que n√£o verificou se o estouro do FIFO funcionava mais r√°pido, apenas a fun√ß√£o em discuss√£o misturou-se abundantemente escrever e ler de portas).  Este √© FIFO!  De fato, o FIFO foi inventado para deixar os dados l√° e esquecer!  Desistir rapidamente!  E n√£o com desempenho, menos de uma megaopera√ß√£o por segundo a uma frequ√™ncia de processador de 925 MHz ... <br><br>  A lat√™ncia √© a culpa.  Entre o n√∫cleo do processador e o equipamento est√° localizado a partir de tr√™s pontes ou mais.  Al√©m disso, a velocidade de acesso √†s portas depende do contexto (v√°rios registros em uma linha ir√£o rapidamente, mas a primeira leitura interromper√° o processo at√© que os dados em cache sejam completamente descarregados, muitos registros em uma linha tamb√©m desacelerar√£o, pois os buffers de grava√ß√£o est√£o esgotados).  Finalmente, o exame dos rastreamentos acumulados no buffer de depura√ß√£o mostrou que a arquitetura <b>Cortex A</b> pode executar a mesma parte para um n√∫mero diferente de ciclos de clock devido ao complexo sistema de cache.  Em resumo, considerando todos esses fatores (pre√ßo, redu√ß√£o de desempenho ao trabalhar com o equipamento, instabilidade da velocidade de acesso ao equipamento, depend√™ncia geral do contexto), foi decidido n√£o colocar esse chip no complexo. <br><br>  Experimentos com o PSoC da Cypress mostraram que o <b>n√∫cleo</b> do <b>Cortex M</b> fornece resultados mais previs√≠veis e repet√≠veis, mas a capacidade l√≥gica e a frequ√™ncia m√°xima de opera√ß√£o desses controladores n√£o correspondiam √†s especifica√ß√µes t√©cnicas, portanto tamb√©m foram descartadas. <br><br>  Foi decidido instalar um FPGA t√≠pico do Cyclone IV de baixo custo e recomendar o uso de um n√∫cleo de processador NIOS II sintetizado.  Bem, e se necess√°rio - para conduzir o desenvolvimento usando quaisquer outros m√©todos (m√°quinas autom√°ticas, l√≥gica r√≠gida, etc.). <br><br><blockquote>  Mencionarei separadamente (e at√© destacarei este par√°grafo) que o processador principal do complexo √© x86 (x64).  √â ele quem √© o processador central do sistema.  √â nele que a l√≥gica principal do complexo √© executada.  O sistema do processador, que ser√° discutido abaixo, foi projetado para simplesmente fornecer a l√≥gica da opera√ß√£o do equipamento "flashed" no FPGA.  Al√©m disso, este equipamento √© vendido apenas se os desenvolvedores n√£o tiverem m√≥dulos de tempo integral suficientes conectados diretamente ao processador central. </blockquote><br><br><h2>  O processo de desenvolvimento e depura√ß√£o de "firmware" </h2><br>  Se o complexo Redd estiver executando o Linux, isso n√£o significa que o desenvolvimento deve ser realizado neste SO.  Redd √© um executor remoto, e o desenvolvimento deve ser realizado no seu computador, independentemente do sistema operacional.  Quem tem Linux √© mais f√°cil, mas quem est√° acostumado com o Windows (eu costumava gostar muito do WIN 3.1, mas fui for√ßado a trabalhar, mas em algum momento do WIN95 OSR2 eu me acostumei e agora √© in√∫til combat√™-lo, √© mais f√°cil aceitar) , eles podem continuar a liderar o desenvolvimento. <br><br>  Como minha amizade com o Linux n√£o deu certo, n√£o darei instru√ß√µes passo a passo para configurar o ambiente, mas me limitarei a palavras gerais.  Quem trabalha com este sistema operacional ser√° suficiente para isso e para o resto ... Acredite, √© mais f√°cil entrar em contato com os administradores do sistema.  No final, eu fiz exatamente isso.  Mas mesmo assim. <br><br>  Voc√™ deve baixar e instalar o Quartus Prime Programmer and Tools da mesma vers√£o do seu ambiente de desenvolvimento.  Se as vers√µes n√£o corresponderem, pode haver surpresas.  Passei a noite inteira para compreender esse fato.  Portanto, basta baixar a ferramenta da mesma vers√£o que o ambiente de desenvolvimento. <br><br>  Ap√≥s a instala√ß√£o, insira o diret√≥rio em que o programa foi instalado, o subdiret√≥rio bin.  Em geral, o arquivo mais importante deve ser jtagconfig.  Se voc√™ execut√°-lo sem argumentos (a prop√≥sito, solicitei persistentemente inserir ./jtagconfig e somente isso), uma lista de programadores dispon√≠veis no sistema e FPGAs conectados a eles ser√° exibida.  Deve haver um USB Blaster.  E o primeiro problema que o sistema apresenta n√£o √© o direito de acesso suficiente para funcionar com USB.  Como resolv√™-lo sem recorrer ao sudo √© descrito aqui: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">radiotech.kz/threads/nastrojka-altera-usb-blaster-v-ubuntu-16-04.1244</a> <br><br>  Mas aqui est√° uma lista de dispositivos exibidos.  Agora voc√™ deve escrever: <br><pre><code class="plaintext hljs">./jtagconfig --enableremote &lt;password&gt;</code> </pre> <br>  ap√≥s o qual o servidor √© iniciado, acess√≠vel de qualquer lugar da rede. <br><br>  Tudo ficaria bem, mas o firewall do sistema n√£o permitir√° que ningu√©m veja este servidor.  Uma verifica√ß√£o no Google mostrou que, para cada tipo de Linux (dos quais existem muitos), as portas do firewall se abrem √† sua maneira, e tantos feiti√ßos devem ser lan√ßados que prefiro entrar em contato com os administradores. <br>  Tamb√©m vale a pena considerar que, se o jtagd n√£o estiver registrado na execu√ß√£o autom√°tica, quando voc√™ abrir o acesso remoto, ser√° informado que √© imposs√≠vel definir uma senha.  Para impedir que isso aconte√ßa, o jtagd deve ser iniciado n√£o por meio do pr√≥prio jtagconfig, mas antes dele. <br><br>  Em geral, o xamanismo est√° no xamanismo.  Deixe-me apenas corrigir a tese: <br><ul><li>  a porta de entrada 1309 deve estar aberta no sistema.Que protocolo, eu n√£o entendi completamente, para garantir a confiabilidade, voc√™ pode abrir o tcp e o udp; </li><li>  ao iniciar o jtagconfig sem argumentos, o USB Blaster e o FPGA conectado a ele devem ser exibidos, e n√£o uma mensagem de erro; </li><li>  Antes de abrir um trabalho remoto, o jtagd com direitos suficientes deve estar em execu√ß√£o.  Se o jtagd com direitos insuficientes j√° tiver sido iniciado, seu processo dever√° ser conclu√≠do antes de uma nova inicializa√ß√£o, caso contr√°rio, uma nova inicializa√ß√£o n√£o ocorrer√°; </li><li>  na verdade, o acesso remoto √© aberto com a linha <pre> <code class="plaintext hljs">jtagconfig --enableremote &lt;password&gt;</code> </pre> </li></ul><br>  Obviamente, existe um caminho semelhante que percorre a interface da GUI, mas √© mais l√≥gico fazer tudo em lote.  Portanto, descrevi uma vers√£o em lote.  Quando todas essas teses foram conclu√≠das (e os administradores do sistema as conclu√≠ram), lan√ßamos o programador em nossa m√°quina, vemos uma mensagem sobre a falta de equipamento.  Clique em Configura√ß√£o de hardware: <br><img src="https://habrastorage.org/webt/cj/bq/jh/cjbqjhzydanq__godqnyhq8_ah8.png"><br><br>  V√° para a guia JTAG Settings e clique em Add Server: <br><img src="https://habrastorage.org/webt/xn/36/8a/xn368ajq_d5kjx-nxyyvculmpus.png"><br><br>  N√≥s inserimos o endere√ßo de rede de Redd (para mim √© 192.168.1.100) e a senha: <br><img src="https://habrastorage.org/webt/kd/ro/7y/kdro7ya9kr8od0uwvcv6hycn0eu.png"><br><br>  Garantimos que a conex√£o foi bem-sucedida. <br><br>  Passei tr√™s f√©rias em maio para conseguir isso e, em seguida, os administradores decidiram tudo. <br><img src="https://habrastorage.org/webt/8h/gp/x0/8hgpx0r19klfwbp7fqd0atfesvq.png"><br><br>  Alterne para a guia Configura√ß√µes de hardware, abra a lista suspensa e selecione o programador remoto: <br><img src="https://habrastorage.org/webt/-2/cf/te/-2cfteubqycs6lr1h8bniz92epi.png"><br><br>  Tudo, agora pode ser usado.  O bot√£o Iniciar est√° desbloqueado. <br><img src="https://habrastorage.org/webt/a_/9m/t9/a_9mt9509lhs8muotyfcxh9wwtw.png"><br><br><h2>  O primeiro "firmware" </h2><br>  Bem ent√£o.  Para que o artigo tenha um valor pr√°tico real, vamos analisar o "firmware" mais simples feito usando os m√©todos acima.  A coisa mais simples que realmente consegui implementar para o complexo √© um teste do chip SDRAM.  Aqui neste exemplo e pr√°tica. <br><br>  Existem v√°rios n√∫cleos amadores para oferecer suporte √† SDRAM, mas todos eles s√£o de alguma forma complicados.  E explicar todos os truques √© trabalho.  Vamos tentar usar solu√ß√µes prontas que podem ser inseridas no sistema de computa√ß√£o do NIOS II; portanto, usaremos o SDRAM Controller Core padr√£o.  O n√∫cleo em si √© descrito no documento <b>Embedded Peripherals IP User Guide</b> , e muito espa√ßo na descri√ß√£o √© dedicado ao turno do clock da SDRAM em rela√ß√£o ao core clock.  S√£o apresentados c√°lculos e f√≥rmulas te√≥ricas complexas, mas o que fazer n√£o √© particularmente relatado.  O que fazer pode ser encontrado no documento <b>Usando a SDRAM na placa DE0 da Altera com desenhos da Verilog</b> .  No curso da an√°lise, aplicarei o conhecimento deste documento. <br><br>  Eu estarei desenvolvendo a vers√£o gratuita do Quartus Prime 17.0.  Eu me concentro nisso, pois durante a montagem, eles me dizem que, no futuro, o n√∫cleo do <b>SDRAM Controller</b> ser√° expulso da vers√£o gratuita.  Se isso j√° aconteceu no seu ambiente de desenvolvimento, ningu√©m se preocupa em baixar a 17¬™ vers√£o gratuita e instal√°-la em uma m√°quina virtual.  O trabalho principal √© feito onde quer que voc√™ esteja acostumado, e o firmware do Redd com SDRAM est√° na 17¬™ vers√£o.  Bem, se voc√™ usar as op√ß√µes gratuitas.  Ningu√©m amea√ßou jog√°-lo fora dos pagos ainda.  Mas eu estava distra√≠do.  Crie um novo projeto: <br><img src="https://habrastorage.org/webt/qv/sw/eq/qvsweqv-lktrkcs5keaxu8q_5se.png"><br><br>  Vamos cham√°-lo de SDRAM_DEMO.  O nome deve ser lembrado: vou realizar um desenvolvimento super r√°pido, para que o sistema do processador esteja no n√≠vel superior, sem nenhuma camada Verilog.  E para que isso aconte√ßa, o nome do sistema do processador deve corresponder ao nome do projeto.  Ent√£o lembre-se disso. <br><img src="https://habrastorage.org/webt/fv/yf/-p/fvyf-p3vwrjspjlvvd5tqdm2ndi.png"><br><br>  Concordando com os valores padr√£o em algumas etapas, chegamos √† escolha de um cristal.  Selecionamos o EP4CE10E22C7 usado no complexo. <br><img src="https://habrastorage.org/webt/n6/du/8e/n6du8ejpw_xysdx7dui4f_rc2qi.png"><br><br>  Na pr√≥xima etapa, por h√°bito, escolho modelar no ModelSim-Altera.  Hoje n√£o modelamos nada, mas tudo pode ser √∫til.  √â melhor desenvolver esse h√°bito e segui-lo: <br><img src="https://habrastorage.org/webt/ym/on/v2/ymonv28mmot9o4frulumjznujk8.png"><br><br>  O projeto √© criado.  V√° imediatamente para a cria√ß√£o do sistema do processador (Ferramentas-&gt; Platform Designer): <br><img src="https://habrastorage.org/webt/qv/tb/t8/qvtbt8vbulg78qybfcpdb1jqaja.png"><br><br>  Criamos um sistema que cont√©m um rel√≥gio e um m√≥dulo de redefini√ß√£o: <br><img src="https://habrastorage.org/webt/xg/bz/o3/xgbzo3yoi-jrtmaiqhd_fz1vp_q.png"><br><br>  Mas, como eu j√° mencionei, √© necess√°rio um rel√≥gio especial para o n√∫cleo da SDRAM.  Portanto, o m√≥dulo padr√£o √© impiedosamente jogado fora <br><img src="https://habrastorage.org/webt/2e/yv/_0/2eyv_0ufhrwtnap8vdyryftspus.png"><br><br>  Em vez disso, adicione o bloco University Program-&gt; System e SDRAM Clock for DE-series: <br><img src="https://habrastorage.org/webt/ho/tf/nd/hotfndwnreutxuoycv3rh-lhz_m.png"><br><br>  Nas propriedades, selecione DE0-Nano, pois a inspira√ß√£o para o circuito de comuta√ß√£o SDRAM foi extra√≠da desta placa de ensaio: <br><img src="https://habrastorage.org/webt/lc/0f/tl/lc0ftl82cyh0yjpj4baklxmyddc.png"><br><br>  Come√ßamos a encher nosso sistema de processador.  Obviamente, a primeira coisa a acrescentar √© o pr√≥prio n√∫cleo do processador.  Que seja Processador E Perif√©ricos-&gt; Processadores Incorporados-&gt; Processador NIOS II. <br><img src="https://habrastorage.org/webt/28/sl/n4/28sln4t0khej0gnfh9v9honohu4.png"><br><br>  Para ele, ainda n√£o preenchemos nenhuma propriedade.  Basta clicar em Concluir, mesmo que tenhamos formado uma s√©rie de mensagens de erro.  At√© o momento, n√£o h√° equipamentos que eliminem esses erros. <br><br>  Agora adicione a SDRAM real.  Interfaces e controladores de mem√≥ria-&gt; SDRAM-&gt; Controlador SDRAM. <br><img src="https://habrastorage.org/webt/ov/ro/fk/ovrofkityrsnw3vcttpjnwcwhzw.png"><br><br>  Aqui temos que nos apegar ao preenchimento das propriedades.  Selecione o microcircuito mais pr√≥ximo, similar na organiza√ß√£o, na lista e clique em Apppy.  Suas propriedades se enquadram nos campos Perfil da mem√≥ria: <br><img src="https://habrastorage.org/webt/de/hv/e_/dehve_t_smpdsm3ailji3mhf0u8.png"><br><br>  Agora, alteramos a largura do barramento de dados para 16, o n√∫mero de linhas de endere√ßo para 13 e as colunas para 9. <br><img src="https://habrastorage.org/webt/2m/7h/0o/2m7h0otrg1pjp_jchcdmfa1uzvg.png"><br><br>  Ainda n√£o estou corrigindo os hor√°rios, talvez no futuro essa recomenda√ß√£o seja alterada. <br>  O sistema do processador implica um programa.  O programa deve ser armazenado em algum lugar.  Vamos testar o chip SDRAM.  No momento, n√£o podemos confiar nela.  Portanto, para armazenar o programa, adicione mem√≥ria com base no bloco RAM FPGA.  Fun√ß√µes b√°sicas-&gt; Mem√≥ria no chip-&gt; Mem√≥ria no chip (RAM ou ROM): <br><img src="https://habrastorage.org/webt/ry/ot/-e/ryot-emahnalpamwnkyn1xwcihc.png"><br><br>  Volume ... Bem, sejam 32 kilobytes. <br><img src="https://habrastorage.org/webt/mk/jc/gb/mkjcgbjb57ibhy0xeob8mg84nfo.png"><br><br>  Essa mem√≥ria deve estar carregando de algum lugar.  Para que isso ocorra, marque a caixa Ativar arquivo de inicializa√ß√£o n√£o padr√£o e insira um nome de arquivo significativo.  Digamos firmware.hex: <br><img src="https://habrastorage.org/webt/bh/mf/7a/bhmf7ajkwxp8gixms4bgvy9cp08.png"><br><br>  O artigo j√° √© complicado, por isso n√£o o sobrecarregaremos.  N√≥s simplesmente produziremos o resultado f√≠sico do teste na forma de linhas PASS / FAIL (e veremos o resultado l√≥gico com minha depura√ß√£o JTAG favorita).  Para fazer isso, adicione a porta GPIO.  Processadores e perif√©ricos-&gt; Perif√©ricos-&gt; PIO (IO paralelo): <br><img src="https://habrastorage.org/webt/_p/qn/tw/_pqntwmv-ivkyl3zkrwnxcb5wum.png"><br><br>  Nas propriedades que definimos 2 bits, tamb√©m gosto de marcar a caixa para controle individual dos bits.  Tamb√©m apenas um h√°bito. <br><img src="https://habrastorage.org/webt/a7/bk/j4/a7bkj4ophwwlkeog2laba81emds.png"><br><br>  Temos um sistema com v√°rios erros: <br><img src="https://habrastorage.org/webt/w_/4p/o2/w_4po2omowqkf35ge_6-ygmdpl4.png"><br><br>  Come√ßamos a elimin√°-los.  Para come√ßar, vamos quebrar o rel√≥gio e redefinir.  No rel√≥gio e na unidade de redefini√ß√£o, as entradas devem ser descartadas.  Para fazer isso, existem campos que dizem "Clique duas vezes para exportar": <br><img src="https://habrastorage.org/webt/bw/gx/w1/bwgxw1cczmqvwzfy3iruazvzzn8.png"><br><br>  Clicamos, mas fornecemos nomes mais ou menos abreviados. <br><img src="https://habrastorage.org/webt/be/xc/id/bexcidwci8wqdctpttm_uqnsgwo.png"><br><br>  Voc√™ tamb√©m precisa jogar fora a sa√≠da do rel√≥gio SDRAM: <br><img src="https://habrastorage.org/webt/bs/bp/6j/bsbp6j_uz7vlmsnpwvg17cbcqko.png"><br><br>  Agora dividimos sys_clk em todas as entradas de clock e reset_source em todas as linhas de redefini√ß√£o.  Voc√™ pode acertar suavemente os pontos que conectam as linhas correspondentes com o ‚Äúmouse‚Äù ou pode ir para a sa√≠da correspondente, clicar com o bot√£o direito do mouse e depois acessar o submenu Conex√µes no menu suspenso e selecionar as conex√µes. <br><img src="https://habrastorage.org/webt/8t/2q/v4/8t2qv4btxo3ygqw6q3bjqa23hae.png"><br><br><img src="https://habrastorage.org/webt/ag/as/sz/agasszsc45aobhbaephagupfwja.png"><br><br>  Ent√£o conectamos os pneus.  Conectamos o Data Master a todos os barramentos de todos os dispositivos e o Inctruction Master - a quase todos.  N√£o √© necess√°rio conect√°-lo ao barramento PIO_0.  A partir da√≠, as instru√ß√µes definitivamente n√£o ser√£o lidas. <br><img src="https://habrastorage.org/webt/rb/fl/av/rbflavgwws5gsdpmtqrrqlp-v0s.png"><br><br>  Agora voc√™ pode resolver conflitos de endere√ßo.  Para fazer isso, selecione o item de menu Sistema-&gt; Atribuir endere√ßos base: <br><img src="https://habrastorage.org/webt/ri/pk/te/ripkteta-ftnbrdgjtyj8cabtq8.png"><br><br>  E quando temos endere√ßos, tamb√©m podemos atribuir vetores.  Para fazer isso, v√° para as propriedades do n√∫cleo do processador (aponte para ele, pressione o bot√£o direito do mouse e selecione o item de menu Editar) e configure os vetores na mem√≥ria Onchip.  Basta selecionar esse tipo de mem√≥ria nas listas suspensas, os n√∫meros ser√£o substitu√≠dos por eles mesmos. <br><img src="https://habrastorage.org/webt/aj/om/nn/ajomnnjye5kuskwbtquacdxqbkw.png"><br><br>  N√£o h√° mais erros.  Mas dois avisos permanecem.  Esqueci de exportar as linhas SDRAM e PIO. <br><img src="https://habrastorage.org/webt/gn/ux/2m/gnux2mk6ikcgsuzin6xbpmyoiwe.png"><br><br>  Como j√° fizemos no bloco de redefini√ß√£o e rel√≥gio, clique duas vezes nas pernas necess√°rias e forne√ßa os nomes mais curtos (mas compreens√≠veis): <br><img src="https://habrastorage.org/webt/ea/bp/pq/eabppqnnarmd3fqbtytqbfoxteg.png"><br><br>  Tudo, n√£o h√° mais erros ou avisos.  Salve o sistema.  Al√©m disso, o nome deve coincidir com o nome do projeto, para que o sistema do processador se torne um elemento de n√≠vel superior no projeto.  N√£o se esqueceu do que chamamos? <br><img src="https://habrastorage.org/webt/hc/gh/7v/hcgh7vmhtfvsziy7idu7pdgbbuo.png"><br><br><img src="https://habrastorage.org/webt/3w/pl/rr/3wplrrqclfbkfquzndakoonrmdw.png"><br><br>  Bem, pressionamos o bot√£o mais importante - gerar HDL. <br><img src="https://habrastorage.org/webt/1t/hm/im/1thmimhmf_xc3taykvi8ct1t6ae.png"><br><br>  Tudo, a parte do processador √© criada.  Clique em Finish.  Lembramos que seria bom adicionar este sistema de processador ao projeto: <br><img src="https://habrastorage.org/webt/d1/cf/lv/d1cflvqskri1-jrh1ybgflbmglg.png"><br><br>  Adicionar: <br><img src="https://habrastorage.org/webt/3n/yj/gl/3nyjglrcg5dxdngcghpufpgmot8.png"><br><br>  E a√≠, usando o bot√£o Adicionar, obtemos a seguinte imagem: <br><img src="https://habrastorage.org/webt/wm/jl/p8/wmjlp82jua7ilcvlosa65g98iqy.png"><br><br>  O arquivo SIP ainda n√£o foi criado.  Sim, e n√£o precisamos disso na estrutura deste artigo. <br><br>  Uhhhh  O primeiro passo foi dado.  Esbo√ßamos o projeto para que o sistema descubra a hierarquia do projeto e as etapas usadas.  Erros de compila√ß√£o n√£o s√£o assustadores.  Apenas na vers√£o gratuita do ambiente, foram criados kernels que funcionam apenas enquanto o adaptador JTAG est√° conectado.  Mas no complexo Redd, ele est√° sempre conectado, pois √© divorciado em um quadro comum, ou seja, n√£o temos nada a temer.  Portanto, ignoramos esses erros. <br><img src="https://habrastorage.org/webt/0b/hk/jo/0bhkjo904iqlqnjcpaf-iinssba.png"><br><br>  Agora, de volta √† descri√ß√£o do kernel da SDRAM.  Diz que a linha CKE n√£o √© usada e est√° sempre conectada √† unidade.  De fato, dentro da estrutura do complexo, as pernas FPGA n√£o s√£o apenas caras, mas um recurso precioso.  E seria tolice estender a perna, que est√° sempre na unidade (e no quadro DE0-NANO tamb√©m n√£o √© divorciado).  Haveria uma camada Verilog, a cadeia correspondente poderia ser cortada l√°, mas eu economizo tempo (risos nervosos, olhando o volume do documento j√° obtido, mas sem salvar, o resultado seria ainda mais).  Portanto, n√£o h√° camada.  Como ser  V√° para o Editor de atribui√ß√£o.  Est√° nele, pois no Pin Planner, a julgar pelas descri√ß√µes, n√£o h√° funcionalidade semelhante. <br><img src="https://habrastorage.org/webt/wa/mn/li/wamnlimpfzqz8n4xguihx3jciwe.png"><br><br>  Ainda n√£o h√° linha.  Bom  Crie um novo <br><img src="https://habrastorage.org/webt/nd/hr/b_/ndhrb_1xgzvlhllnqj2zjrrq50i.png"><br><br>  Selecionamos o seguinte √≠cone: <br><img src="https://habrastorage.org/webt/_c/mg/o5/_cmgo53jkcsq4z4i5lzfdvn_s-a.png"><br><br>  No sistema de pesquisa que definimos, clique em Lista e, nos resultados da pesquisa, encontramos nossa CKE: <br><img src="https://habrastorage.org/webt/s2/r8/9t/s2r89tiymksz4ohpxv_6mudnqoy.png"><br><br>  Adicione-o √† coluna da direita, clique em OK. <br><img src="https://habrastorage.org/webt/xv/fd/jy/xvfdjyxtnasndf8a_xara0wzpom.png"><br><br>  Temos a seguinte lista: <br><img src="https://habrastorage.org/webt/g7/qn/-k/g7qn-kbokf172_5s4o0gvyjk2fk.png"><br><br>  No campo amarelo, clique na lista suspensa e localize o PIN virtual.  N√≥s escolhemos.  O amarelo mudou-se para outra c√©lula: <br><img src="https://habrastorage.org/webt/x0/1h/4a/x01h4aaksdrgol8_wyoe3cnwaji.png"><br><br>  L√°, selecionamos Ativado: <br><img src="https://habrastorage.org/webt/qw/5b/bl/qw5bblpjq2fswujalhmvlcgpew0.png"><br><br>  Todo o amarelo se foi.  E a cadeia agora est√° marcada como virtual, o que significa que n√£o requer uma perna f√≠sica.  Portanto, n√£o podemos atribu√≠-lo √† conclus√£o f√≠sica do FPGA.  Feche o Editor de atribui√ß√£o, abra o Planejador de pinos.  Voc√™ pode atribuir as pernas, consultando a figura, ou pode obter a lista do arquivo * .qsf, que faz parte do projeto, que anexarei ao artigo. <br><br><img src="https://habrastorage.org/webt/wn/aj/kc/wnajkcjd97ko1cd7hmasi67ifq0.png"><br><br>  √â isso a√≠, feche o Pin Planner, realizamos a compila√ß√£o final do projeto.  O hardware est√° pronto, prosseguimos com o desenvolvimento do software para o sistema de processador resultante.  Mas o artigo ficou t√£o grande que vamos faz√™-lo na <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">pr√≥xima vez</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt452656/">https://habr.com/ru/post/pt452656/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt452642/index.html">A for√ßa da multid√£o. Como Chicago desenvolveu um rob√¥ de lixo - um limpador de rio</a></li>
<li><a href="../pt452644/index.html">Confer√™ncia DevConf X Web Developer - 21 de junho</a></li>
<li><a href="../pt452646/index.html">O que a rede neural viu na primeira fotografia de um buraco negro</a></li>
<li><a href="../pt452648/index.html">PHP: Como analisar um arquivo XML complexo e n√£o se afogar no c√≥digo nativo</a></li>
<li><a href="../pt452652/index.html">Semana da Seguran√ßa 21: um buraco no Whatsapp, uma nova vulnerabilidade nos processadores Intel, Zero-Day no Windows</a></li>
<li><a href="../pt452662/index.html">Servidores HPE em Selectel</a></li>
<li><a href="../pt452664/index.html">Faturei 18.000 d√≥lares por uma p√°gina est√°tica da Web ... e me livrei dela</a></li>
<li><a href="../pt452666/index.html">Como possibilitar micropagamentos em seu aplicativo</a></li>
<li><a href="../pt452668/index.html">Como verificar os cookies quanto √† conformidade com o GDPR - nova ferramenta aberta ajudar√°</a></li>
<li><a href="../pt452670/index.html">Quem s√£o os engenheiros de dados e como eles se tornam?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>