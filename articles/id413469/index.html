<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🏸 🙆🏽 👨🏻‍🏫 Tes memori membunuh laptop hampir merupakan cerita detektif 👨🏼‍⚕️ 🥀 ⬜️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="(UPD: selain skema, foto board ditambahkan) 
 (UPD2: informasi dari saluran IRC libreboot) 


- RINKAN memiliki perlindungan saat ini sebesar 55mA, fu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Tes memori membunuh laptop hampir merupakan cerita detektif</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/413469/"><p>  <strong>(UPD: selain skema, foto board ditambahkan)</strong> <br>  <strong>(UPD2: informasi dari saluran IRC libreboot)</strong> </p><br><ul><li>  RINKAN memiliki perlindungan saat ini sebesar 55mA, fungsionalitas dapat ditemukan dalam deskripsi di TB62501F. </li><li>  PMH7 adalah susunan gerbang ("hal yang sama seperti FPGA yang baru saja diprogram dengan 3 lapisan logam, agak seperti maskrom"), untuk Toshiba disebut TC-200G </li><li>  PMH7 terhubung tidak hanya ke EC, tetapi juga ke ICH melalui LPC bus dan terlihat dari sudut pandang tuan rumah sebagai extender GPIO. </li><li>  Mereka yakin bahwa pin PMH yang tidak digunakan benar-benar menggantung di udara, dan penutupan pin cenderung hanya membakar output PMH, tetapi tidak LDO </li><li>  Mereka menyarankan kegagalan spontan dari dua RINKAN untuk alasan yang tidak tergantung satu sama lain (kemungkinan dipicu oleh pemanasan motherboard selama memtest) </li><li>  Mereka merekomendasikan untuk mengubah RINKAN ke chip yang sama dari ROHM: BD4175KVT-BD4176KVT-BD41760KVT, harganya sekitar $ 2 </li><li>  Kami setuju bahwa Anda perlu melakukan percobaan untuk menjalankan memtest dengan batas saat ini </li></ul><br><p>  Baru-baru ini kami memiliki kisah yang memilukan - dua laptop Lenovo T500 meninggal dalam satu pagi.  Seseorang akan mati - tidak ada yang mulai mengerti.  Tapi dua dalam satu pagi - itu terlalu banyak!  Selain itu, setidaknya satu dari mereka (dan ini dikonfirmasi oleh tiga pengguna!) Bekerja normal sampai menit terakhir, dimatikan oleh tombol power, dipindahkan 100 meter ke ruang bicara dan ... tidak menyala. </p><br><p>  Secara alami, pertama-tama, semua metode resusitasi artisanal telah diuji: ganti baterai, ganti adaptor daya ... Lepaskan baterai dan putuskan daya, setel ulang CMOS dan sebagainya ... Hasil?  Persis nol - laptop terus berada dalam keadaan sulit. </p><br><p>  Mereka mulai merekonstruksi gambar peristiwa untuk menemukan setidaknya beberapa petunjuk.  Ternyata yang berikut ini: </p><a name="habracut"></a><br><ul><li>  Pada D-1, memori ditambahkan ke kedua laptop.  Setelah mengganti bilah memori, keduanya dihidupkan dan bekerja dengan benar hingga malam hari </li><li>  Pada malam D-Day, memtest diluncurkan di kedua komputer (lebih tepatnya, memtest86 + 5.01-3 dari distribusi Debian) </li><li>  Di pagi hari pada hari "D", kedua komputer dimatikan oleh tombol power, dan tidak menyala </li><li>  Selain itu, mereka terhubung secara singkat melalui konektor VGA ke proyektor yang sama, dan ke adaptor daya yang sama di dalam ruangan </li></ul><br><p>  Jelas, kematian laptop harus dikaitkan dengan satu dari tiga hal: adaptor daya, proyektor, atau memtest.  Tapi dengan apa tepatnya? </p><br><p>  Pertama-tama, kami memeriksa proyektor.  Mereka tidak menemukan kejahatan, tetapi juga menemukan bahwa pada hari itu (tetapi kemudian) laptop lain terhubung, yang tetap hidup dan sehat.  Di tempat kedua, kami memeriksa adaptor daya - sepertinya meremehkan voltase, dan itu dikarantina. </p><br><p>  Laptop diberikan kepada layanan, yang mengembalikan mereka kembali dengan hasil sebagai berikut: "kegagalan motherboard, suku cadang hilang!".  Saya harus membuka bangkai sendiri (manfaat pada jaringan dapat ditemukan baik skema dan manual layanan untuk seri Thinkpad lama). </p><br><p>  Pada titik ini, semua orang mulai (dengan pengecualian) untuk mencurigai kematian laptop memtest.  Tapi itu sama sekali tidak jelas - bagaimana tepatnya?  Pada akhirnya, ada kemungkinan bahwa kematian laptop adalah hal yang langka, tidak menyenangkan, tetapi masih merupakan kebetulan.  Tapi tidak!  Atau ya ... Secara umum, kami belum tahu persis. </p><br><p>  Di sini Anda harus melakukan penyimpangan pada pembangunan sistem manajemen daya pada beech IBM / Lenovo (setidaknya seri yang lebih lama).  Dalam perangkat yang lebih sederhana, manajemen daya diberikan baik ke prosesor / chipset, atau ke pengontrol motherboard khusus (Pengontrol sistem, alias Pengontrol tertanam).  Secara relatif, benda ini bertanggung jawab atas fungsi refleks dan tulang belakang laptop: mengalihkan sumber arus, daya baterai, identifikasi baterai / penguncian vendor, dan sejenisnya.  Tetapi tidak di IBM / Lenovo! </p><br><p>  Insinyur IBM, tampaknya, berpikir bahwa firmware EC mungkin mengandung kesalahan atau controller itu sendiri tiba-tiba akan membeku.  Tentu saja, EC memiliki pengawas sendiri, tetapi juga bukan obat mujarab.  Oleh karena itu, tanggung jawab EC hanya untuk menghasilkan sinyal kontrol daya tingkat tinggi.  Tombol daya membuka dan mengunci dua sirkuit mikro khusus (dan tidak sembarangan, tetapi dengan membandingkan keinginan EC dengan pembacaan sensor suhu, keberadaan tegangan yang diperlukan untuk langkah selanjutnya pada ban, dll.).  Chip ini adalah: RINKAN (dekripsi tidak diketahui) dan PMH_7 (Power Management Hub rev7) </p><br><div class="spoiler">  <b class="spoiler_title">RINKAN di bagian interior</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/nu/bg/ox/nubgoxpbrihy0iguhtguefcnu44.png" alt="gambar"></p></div></div><br><p>  Harap dicatat bahwa RINKAN tidak memiliki output ke bus CPU - pada prinsipnya, itu tidak dapat dicapai oleh prosesor.  Salah satu fungsi penting (dan tidak jelas) dari RINKAN adalah menghasilkan tegangan 3.3V yang stabil ke bus VCC3SW (sebut saja bus start).  Karena tidak ada choke di dekatnya - dapat diasumsikan bahwa regulator ini dibangun dalam skema linier sederhana.  Yaitu, di suatu tempat di dalam sana duduk transistor dengan tegap dan dengan resistensi aktif itu menanamkan daya, hanya menyisakan 3.3V.  Regulator ini ditenagai oleh kaki VREGIN20, di mana semua sumber daya laptop (stasiun dok, adaptor daya, baterai utama, dan baterai ultrabay) terhubung melalui dioda.  Artinya, ia selalu bekerja secara umum (oleh karena itu, berdaya rendah - Anda membutuhkan arus konsumsi Anda sendiri yang sangat kecil!) </p><br><div class="spoiler">  <b class="spoiler_title">PMH_7 di lingkungan kerja</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/ne/rz/03/nerz03znxcvwq7q6fvmhm7ig5qm.png" alt="gambar"></p></div></div><br><p>  PMH adalah chip yang lebih cerdas.  Minimal, ia memiliki koneksi ke EC melalui bus SPI.  Selain itu, ini menghidupkan atau mematikan sejumlah besar tegangan dan sinyal jam pada motherboard laptop.  Kedua chip dibuat khusus, tanpa lembar data.  Karena Lenovo / IBM menggunakan chip khusus yang sama untuk lini produk yang berbeda, beberapa kaki PMH tidak digunakan di T500.  Namun, mereka tidak mungkin dibiarkan menggantung di udara.  Rekomendasi umum menyarankan menarik timah yang tidak digunakan baik ke sirkuit daya atau ke tanah.  Ingat ini. </p><br><p>  Meskipun kurangnya dokumentasi, tim proyek Coreboot (membandingkan sirkuit notebook dari seri T60, T40 dan laptop yang lebih tua - di mana fungsi RINKAN / PMH masih terbagi antara microcircuits dengan tingkat integrasi yang lebih rendah) mengumpulkan sesuatu yang menarik.  PMH tersedia di ruang alamat CPU. <del>  Tidak secara langsung, tentu saja, tetapi melalui EC - tetapi masih tersedia! </del>  <strong>UPD: terhubung ke ICH melalui bus LPC (Jumlah pin rendah - analog dari ISA).</strong>  Untuk menaikkan atau menurunkan kaki PMH, mereka menggunakan urutan operasi berikut ( <a href="">pmh7.c</a> ): </p><br><pre><code class="cpp hljs">outb(reg, EC_LENOVO_PMH7_ADDR); val = inb(EC_LENOVO_PMH7_DATA); outb(reg, EC_LENOVO_PMH7_ADDR); outb(val | (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; bit), EC_LENOVO_PMH7_DATA);</code> </pre> <br><p>  Artinya, kita pertama-tama menulis kode register PMH ke register EC (dipetakan ke ruang alamat CPU), dan kemudian kita dapat membaca atau menulis isinya.  Sebagai contoh, kami ingin menyalakan lampu latar (kaki 55 PMH): kami menulis di register 0x55 bit 2 - semuanya sederhana. </p><br><p>  <strong>UPD: kolega dari proyek Libreboot menganggap skenario hubungan pendek yang dijelaskan melalui PMH tidak mungkin, di samping itu - perlindungan saat ini di RINKAN seharusnya bekerja di 55mA</strong> </p><br><p>  Sayangnya, memtest melakukan hal yang kurang lebih sama - memtest dan menulis nilai yang berbeda untuk area memori yang berbeda.  Secara teoritis, BIOS harus menggambarkan area memori yang disediakan untuk perangkat I / O.  Dan memtest seharusnya tidak menulis apa pun di sana - tapi ... tulis!  Dan, tampaknya, pada titik tertentu, ia mengangkat atau menurunkan kaki PMH yang tidak berhasil.  Dengan demikian, melalui transistor kaki output PMH, VCC3SW power bus disingkat ke ground ... </p><br><p>  Apa yang terjadi selanjutnya?  Kemudian RINKAN mulai berjemur.  Karena arus tumbuh, PMH dalam mode kunci menyeretnya tanpa masalah, dan transistor setengah terbuka di LDO RINKAN semakin memburuk.  Namun secara lahiriah, ini tidak memanifestasikan dirinya dengan cara apa pun: dalam laptop yang dihidupkan, tidak ada yang makan dari sumber daya rendah 3.3V, dan daya dipasok oleh DC / DC kuat khusus yang masing-masing memasok bus utama 3,3 dan 5 volt. </p><br><p>  Nah, ketika tombol power ditekan, bus-bus utama mati energi.  Tidak ada lagi daya pada bus awal 3.3V!  Dan laptopnya berubah menjadi <del>  labu </del>  batu bata. </p><br><p>  <strong>UPD: teori alternatif (omz + libreboot)</strong> </p><br><p>  Di pusat layanan, kecenderungan tabrakan RINKAN diketahui.  Kolega dari Libreboot lebih lanjut berpendapat bahwa ini terutama berlaku untuk pengontrol Toshiba (dan ROHM akan lebih baik).  Karenanya, memtest tidak bersalah sama sekali, dan terjadi kegagalan hampir dua laptop secara simultan: </p><br><ul><li><p>  Atau karena alasan yang tidak tergantung satu sama lain (kemungkinan dipicu oleh pemanasan motherboard di bawah memtest panjang) </p><br></li><li>  Atau kerusakan (noise) pada output daya adaptor, yang (meskipun untuk waktu singkat) kedua laptop terhubung. </li></ul><br><p>  Hasil diagnostik: </p><br><p>  Laptop pertama adalah papan dual-grafis COR5SOPV3.  Di bus VCC3SW alih-alih 3,3, hanya 1,2 volt.  Ketahanan terhadap bumi adalah sekitar 400 ohm.  Disolder dengan lembut dan naikkan output konverter tegangan RINKAN.  Hambatan bus segera meningkat menjadi ratusan kilo-ohm.  Mereka menerapkan tegangan 3.3V dari sumber eksternal - beech menjadi hidup. </p><br><div class="spoiler">  <b class="spoiler_title">Papan dalam proses perbaikan</b> <div class="spoiler_text"><p>  Chip dengan stiker putih adalah pengontrol Tertanam, di tengah dengan kabel - RINKAN, yang terakhir tanpa stiker - PMH. </p><br><p><img src="https://habrastorage.org/webt/1e/pl/j8/1eplj83_3g7qj5diwndcnm4hawq.jpeg" alt="gambar"></p></div></div><br><p>  Sebagai hasilnya, kami memilih LDO daya rendah eksternal (LP2930-3.3), yang mengumpankan bus awal alih-alih RINKAN.  Menurut hasil tes, ditemukan bahwa kematian klinis yang tertunda meninggalkan jejak pada sifat perangkat - laptop menolak untuk menyala jika baterai dimasukkan ke dalamnya tetapi adaptor tidak dimasukkan.  Jika Anda ingin menyalakannya - lepas baterai, hidupkan adaptor daya, dan setelah itu baterai dapat dimasukkan kembali.  Semua fungsi lain (pengisian daya, masa pakai baterai, tidur, dll.) Tidak masalah, dan itu satu-satunya cara untuk menghidupkan.  Mereka tidak repot-repot - mereka memutuskan pertanyaan secara administratif: gunakan sleep atau reboot alih-alih mematikan.  Penderita pertama beruntung! </p><br><p>  Dan yang kedua - tidak ... Ada papan C5ISOVP dengan grafik terintegrasi - tidak ada tegangan pada bus sama sekali, dan hambatan untuk mendarat adalah puluhan ohm.  Setelah merobek kaki, VCC3SW tidak menjadi lebih baik - resistansi rendah yang sama menurut VREGIN20.  Mereka juga merobeknya, menyalakan daya eksternal ke bus mulai - mereka melihat 3,3 dan 5 volt pada yang utama.  Namun, meskipun awal yang menggembirakan, sinyal Power-good tidak muncul pada output PMH / RINKAN dan sistem tidak dapat memulai.  Rupanya, logika internal dari sirkuit mikro rusak, dan ini tidak dirawat ... </p><br><p><del>  Sangat mungkin memtest dapat membunuh laptop dengan cara ini mulai dari seri T6x hingga seri T420 / 520 inklusif.  Mulai dari T430 / 530, cara komunikasi dengan Komisi Eropa telah diubah, dan menulis pada register PMH pada prinsipnya tidak mungkin.  Mungkin hanya versi BIOS atau EC firmware tertentu yang terpengaruh.  Laporan bug ditulis untuk pengelola paket-debian, mungkin mereka dapat menemukan sesuatu dengan hulu ... </del></p><br><p>  Alasan pasti kegagalan kedua laptop setelah memulai memtest tidak diketahui.  Eksperimen yang dapat menentukan apakah memtest menyebabkan konsumsi arus off-design dari bus pembangkit mulai direncanakan, tetapi tanggalnya belum ditentukan.  Kami akan melaporkan hasil tambahan. </p><br><p>  Saat meluncurkan memtest pada laptop Lenovo T6x series hingga dan termasuk T420 / 520, Anda harus mempertimbangkan potensi risiko dan manfaat dari acara ini.  Jika Anda menjalankan tes dan itu tidak (atau memang) menyebabkan laptop menjadi bata atau menutup telepon - silakan tulis komentar di komentar yang menunjukkan model laptop dan waktu uji berjalan. </p><br><p>  Itu saja - semoga berhasil! </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id413469/">https://habr.com/ru/post/id413469/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id413459/index.html">Bakat seorang perekrut TI - bagaimana perbedaan pencipta dari pengrajin?</a></li>
<li><a href="../id413461/index.html">ReactOS menjadi swasembada pada tahun ulang tahunnya yang ke-21</a></li>
<li><a href="../id413463/index.html">API Magento 2 REST menggunakan modul sederhana sebagai contoh</a></li>
<li><a href="../id413465/index.html">AMD mengumumkan Threadripper 2 32-core</a></li>
<li><a href="../id413467/index.html">Backup data yang cepat dan andal ke cloud</a></li>
<li><a href="../id413471/index.html">Friday Mini Tomy Fancy Toy Retrospective</a></li>
<li><a href="../id413473/index.html">Pengembangan saklar sentuh Z-Wave pada baterai dengan tombol bercahaya</a></li>
<li><a href="../id413479/index.html">Kami menulis protokol kami di atas UDP</a></li>
<li><a href="../id413481/index.html">Ekspor pohon uji dari JMeter ke teks</a></li>
<li><a href="../id413485/index.html">GitLab 10.8 dirilis: mirroring open-source push dan penyebaran tambahan</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>