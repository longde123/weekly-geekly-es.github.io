<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>  锔 Spacewalk para Navidad   </title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola Habr! 

 Poco antes de Navidad, se decidi贸 estudiar Spacewalk en el departamento de TI: este es el sistema Red Hat, un an谩logo gratuito de Satell...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Spacewalk para Navidad</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/435578/"> Hola Habr! <br><br>  Poco antes de Navidad, se decidi贸 estudiar Spacewalk en el departamento de TI: este es el sistema Red Hat, un an谩logo gratuito de Satellite, para la gesti贸n de configuraci贸n centralizada, actualizaciones del sistema y soporte conveniente para todo el parque de servidores. <br><br>  Debido al hecho de que la documentaci贸n disponible en el sitio web oficial es bastante escasa para comentarios adicionales de varios tipos de soluci贸n de problemas, la tarea consist铆a en estudiar el producto para su introducci贸n gradual primero a los servidores de prueba, y luego a los productos. <br><br>  La idea principal de introducir Spacewalk no era solo la centralizaci贸n y la simplificaci贸n del control, sino tambi茅n para que nadie jugara actualizaciones en los servidores del nuevo proyecto con bol铆grafos juguetones, ya que los precedentes ya ocurrieron. <br><br>  Despu茅s de dos semanas de trabajo, todo el conocimiento que recib铆 se ingres贸 en el an谩logo interno de Confluence, y un d铆a libre me llev贸 a escribir un art铆culo sobre Habr. <br><a name="habracut"></a><br>  Antes de comenzar, me gustar铆a resaltar brevemente lo que fue y no fue afectado, para no calificar para el manual completo para trabajar con Spacewalk: <br><br>  + Instalaci贸n y configuraci贸n del servidor / cliente <br>  + Configuraci贸n del sistema en GUI <br>  + Solucione problemas de paquetes de instalaci贸n / actualizaci贸n, trabaje con configuraciones <br>  + Errata (recopilaci贸n de informaci贸n sobre actualizaciones cr铆ticas, vulnerabilidades, etc.) <br><br>  - Proxy (la necesidad desapareci贸, despu茅s de abandonar HA) <br>  - zapatero / kickstart <br>  - OpenSCAP <br><br><h3>  Requisitos del sistema </h3><br>  Debido al hecho de que toda la infraestructura se ejecuta en VMWare, el trabajo se realiz贸 en una VM que ejecuta CentOS 7. Los requisitos de sistema recomendados por el desarrollador son: <br><br><ul><li>  4 GB de RAM </li><li>  6GB de espacio libre para / var / sat茅lite / </li><li>  12GB para DB </li></ul><br>  Yo us茅: <br><br><ul><li>  6 GB de RAM </li><li>  4 CPU (s) </li><li>  HDD de 40 GB </li></ul><br>  Tambi茅n te aconsejo que deshabilites SELinux y, si no lo est谩s usando, firewalld.  O agregue el servicio http a las excepciones. <br><br>  Nota: al final del art铆culo habr谩 playbooks para Ansible, tanto para las partes del cliente como del servidor, as铆 como scripts de bash.  Con su ayuda, ser谩 posible implementar toda la infraestructura en un par de minutos. <br><br><h3>  Instalaci贸n </h3><br>  La instalaci贸n en s铆 se describe tanto en la documentaci贸n oficial como en varios sitios, sin embargo, por la integridad del art铆culo, perm铆tanme mencionar este punto aqu铆. <br><br>  Spacewalk funciona con dos DBMS: PostgreSQL y Oracle RDBMS.  Tengo experiencia con el primero, y lo usar茅 ahora. <br><br>  Hay dos opciones de instalaci贸n: ambas a trav茅s del instalador autom谩tico de Spacewalk, que se instalar谩 y configurar谩 a s铆 mismo y a la base de datos, sin embargo, en el mismo servidor, e instalaci贸n manual, donde puede colocar la base de datos y la aplicaci贸n en diferentes servidores.  Considerar茅 ambas opciones, comenzar茅 con una instalaci贸n separada. <br><br><h4>  PostgreSQL </h4><br><pre><code class="bash hljs">yum install -y postgresql-server</code> </pre> <br>  Tambi茅n es necesario conectar m贸dulos PL / Tcl para PG: <br><br><pre> <code class="bash hljs">yum install -y postgresql-pltcl postgresql-setup initdb systemctl start postgresql</code> </pre> <br>  Cree una base de datos, un usuario y conecte el m贸dulo: <br><br><pre> <code class="bash hljs">su - postgres -c <span class="hljs-string"><span class="hljs-string">'PGPASSWORD=verystrong; createdb spcwlkdb ; createlang plpgsql spcwlkdb ; createlang pltclu spcwlkdb ; yes $PGPASSWORD | createuser -P -sDR spcwlkuser'</span></span></code> </pre> <br>  Para evitar problemas de conexi贸n, vale la pena cambiar <i>/var/lib/pgsql/data/pg_hba.conf</i> , agregando las l铆neas ANTES de la l铆nea: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">local</span></span> spcwlkdb spcwlkuser md5 host spcwlkdb spcwlkuser 127.0.0.1/8 md5 <span class="hljs-built_in"><span class="hljs-built_in">local</span></span> spcwlkdb postgres ident</code> </pre> <br>  Reiniciar todo: <br><br><pre> <code class="bash hljs">systemctl restart postgresql</code> </pre> <br>  Si tiene la intenci贸n de instalar la aplicaci贸n y la base de datos en diferentes servidores, aseg煤rese de que el paquete <i>postgresql-contrib</i> est茅 instalado en el servidor de la base de datos. <br><br><h4>  Caminata espacial </h4><br>  Conectamos repositorios: <br><br><pre> <code class="bash hljs">rpm -Uvh https://copr-be.cloud.fedoraproject.org/results/@spacewalkproject/spacewalk-2.8/epel-7-x86_64/00736372-spacewalk-repo/spacewalk-repo-2.8-11.el7.centos.noarch.rpm</code> </pre> <br>  Tambi茅n conecte epel: <br><br><pre> <code class="bash hljs">rpm -Uvh https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm</code> </pre> <br>  Java: <br><br><pre> <code class="bash hljs">(<span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /etc/yum.repos.d &amp;&amp; curl -O https://copr.fedorainfracloud.org/coprs/g/spacewalkproject/java-packages/repo/epel-7/group_spacewalkproject-java-packages-epel-7.repo)</code> </pre> <br>  Ahora directamente el instalador para Spacewalk-postgres: <br><br><pre> <code class="bash hljs">yum -y install spacewalk-setup-postgresql</code> </pre> <br>  Con茅ctese a nuestra base de datos: <br><br><pre> <code class="bash hljs">spacewalk-setup-postgresql create --db spcwlkdb --user spcwlkuser --password verystrong</code> </pre> <br>  En el caso de que est茅 utilizando un m茅todo de base de datos / aplicaci贸n por separado, deber谩 agregar el indicador <i>--standalone</i> y especificar la direcci贸n IP del servidor de la base de datos; no olvide abrir el puerto 5432. <br><br>  <i>Nota: Aconsejo ajustar la base de datos de acuerdo con su hardware para una operaci贸n m谩s productiva de todo el sistema.</i> <br><br>  Ahora instale Spacewalk y ejecute la instalaci贸n: <br><br><pre> <code class="bash hljs">yum -y install spacewalk-postgresql spacewalk-setup --external-postgresql</code> </pre> <br>  A continuaci贸n, se formular谩n varias preguntas, tanto sobre el certificado SSL como sobre la base de datos.  Puede ingresar todos los valores manualmente, o puede usar el <i>marcador --answer-file</i> y especificar la ruta al archivo con respuestas para automatizar la instalaci贸n en el futuro: <br><br><pre> <code class="bash hljs">admin-email = root@localhost ssl-set-cnames = spcwlkserver ssl-set-org = Unicorn ssl-set-org-unit = EOH ssl-set-city = Prague ssl-set-state = HMP ssl-set-country = CZ ssl-password = verystrong ssl-set-email = root@localhost ssl-config-sslvhost = Y db-backend=postgresql db-name=spcwlkdb db-user=spcwlkuser db-password=verystrong db-host=localhost db-port=5432 <span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>-tftp=Y</code> </pre> <br>  Para controlar la aplicaci贸n directamente, debe usar: <br><br><pre> <code class="bash hljs">/usr/sbin/spacewalk-service [stop|start|restart]</code> </pre> <br>  Para mostrar todos los servicios de terceros que contribuyen a la aplicaci贸n: <br><br><pre> <code class="bash hljs">spacewalk-service status</code> </pre> <br><h4>  Opci贸n dos, instalaci贸n autom谩tica </h4><br>  Despu茅s de conectar los repositorios, configure y ejecute: <br><br><pre> <code class="bash hljs">yum -y install spacewalk-setup-postgresql yum -y install spacewalk-postgresql spacewalk-setup</code> </pre> <br>  Nuevamente, se har谩n preguntas sobre la base de datos y SSL, utilizamos la clave <i>--answer-file</i> y la ruta al archivo con las respuestas. <br><br><h3>  Canales base e hijos, repos </h3><br>  Para administrar las estaciones del cliente, Spacewalk utiliza un sistema de los llamados canales, que pueden ser main (child) o child (child), un repositorio que necesita est谩 conectado a cada canal, as铆 como una clave, con la cual el cliente est谩 emparejado servidor <br><br>  Como resultado, los repositorios se sincronizan con canales que, a su vez, est谩n conectados con clientes, y Spacewalk funciona de manera general.  La errata, que puede estar vinculada a los canales, tambi茅n vale la pena mencionar, lo que simplifica la actualizaci贸n y el control del paquete. <br><br>  Todos los clientes se pueden agrupar de acuerdo con varios criterios, tanto con los mismos canales como con diferentes canales o repositorios. Es posible trabajar con una gran cantidad de clientes a la vez, lo que ayuda a realizar actualizaciones en m谩s de 100 servidores. <br><br>  Una lista de todos los paquetes instalados est谩 disponible, y despu茅s de la sincronizaci贸n de los repositorios y posible instalaci贸n.  Algunos puntos son intuitivos y no tiene sentido considerar cada elemento l铆nea por l铆nea. <br><br>  Todas las acciones en Spacewalk tienen lugar en un horario (Schedule), casi cualquier acci贸n se puede configurar para el momento que sea m谩s conveniente para usted. <br><br>  Despu茅s de la instalaci贸n, ser谩 posible ir a la direcci贸n de su servidor, realizar m谩s configuraciones a trav茅s de la interfaz gr谩fica: <br><br><img src="https://habrastorage.org/webt/bb/iq/co/bbiqcow_kswo_i91vsqceeg6g0s.png"><br><br>  Ingrese la contrase帽a, el nombre del administrador, el nombre de la organizaci贸n (que tambi茅n es una de las formas de administrar clientes) y vaya al panel de inicio. <br><br>  Por ahora, puede explorar las opciones disponibles usted mismo o pasar a crear canales. <br><br>  <i>Canales - Administrar canales de software - Crear canal:</i> <br><br><img src="https://habrastorage.org/webt/5m/6o/f9/5m6of99m6ey7yq0rxbdmenvhcuw.png"><br><br>  Recomiendo configurar los nombres de los canales de acuerdo con los tipos y el tipo de sistema operativo que se vincular谩 a este canal, por ejemplo, <i>CentOS_7_x86_64</i> , puede elegir con seguridad sha256 como comprobaciones, el campo Resumen de Channell est谩 destinado a una peque帽a descripci贸n del canal.  Adem谩s, opcionalmente puede proporcionar informaci贸n adicional. <br><br>  Ahora cree un canal secundario y vinc煤lelo al principal.  Vamos de la misma manera que al crear el canal principal, solo en el campo Canal principal indicaremos el canal creado previamente. <br><br>  Vincula los repositorios a los canales principales y subsidiarios. <br>  <i>Canales - Administrar repositorios</i> <br><br><img src="https://habrastorage.org/webt/a3/gq/ok/a3gqokxrwd10mlfq4geiw0f1nqy.png"><br><br>  Para los canales principales, uso los Recursos base, para los canales subsidiarios - Actualizaciones. <br><br>  Despu茅s de crear los repositorios, debe conectarlos a los canales. <br>  <i>Canales: administre canales de software</i> , abra su canal principal, abra la secci贸n Repositorios. <br><br><img src="https://habrastorage.org/webt/hw/ro/og/hwroogjvybx0p1z2mslzxf8nunq.png"><br><br>  Habr谩 todos los repositorios creados, seleccione el que necesita, m谩rquelo y haga clic en Actualizar recursos. <br><br>  A continuaci贸n, abra la subclave Sync: <br><br><img src="https://habrastorage.org/webt/ho/j7/4m/hoj74mhjkorduvftwkwbteuxzk4.png"><br><br>  Donde puede sincronizar el repositorio y el canal, configure la programaci贸n para la sincronizaci贸n. <br><br>  <i>Nota: en mi caso de bol铆grafos juguetones, tuve que eliminar el repositorio est谩ndar del sistema cliente.</i> <br><br><h4>  Instalaci贸n del cliente, emparejamiento del cliente con el servidor, administraci贸n de claves, configuraci贸n del canal de configuraci贸n </h4><br>  Como mencion茅 anteriormente, Spacewalk usa un sistema clave de Red Hat Network, que se usa para emparejar y administrar. <br><br>  Para crear una clave, vaya a <i>Sistemas - Claves de activaci贸n - Crear clave:</i> <br><br><img src="https://habrastorage.org/webt/ea/df/vf/eadfvfezxpeh1s_lt9blgfox3j8.png"><br><br>  Aqu铆 todo es extremadamente simple, vale la pena mencionar que puede configurar la clave usted mismo, su formato siempre ser谩 <i>1-XXXXXX</i> y, adem谩s, cada clave est谩 conectada al canal.  El indicador Universal Default obliga a los nuevos sistemas a elegir par谩metros clave. <br><br>  <b>Instalaci贸n del cliente</b> <br><br>  Conecte el repositorio del cliente e instale los paquetes necesarios: <br><br><pre> <code class="bash hljs">rpm -Uvh https://copr-be.cloud.fedoraproject.org/results/@spacewalkproject/spacewalk-2.8-client/epel-7-x86_64/00742644-spacewalk-repo/spacewalk-client-repo-2.8-11.el7.centos.noarch.rpm yum -y install rhn-client-tools rhn-check rhn-setup rhnsd m2crypto yum-rhn-plugin rhncfg-actions deltarpm</code> </pre> <br><br>  <i>Nota: rhncfg-actions y deltarpm son necesarios para que las configuraciones y el control remoto funcionen correctamente.</i> <br><br>  Spacewalk usa rhn_check para sincronizar el servidor del cliente, que se ejecuta cada 4 horas.  Este valor se puede reducir a 60 minutos, pero para m铆 ninguna de las opciones era 贸ptima, por lo tanto, hay dos opciones: usar osad, que viene con Spacewalk, o simplemente agregar un cronjob para rhn_check, por ejemplo, por cada minuto mientras pruebe el sistema, entonces el valor puede cambiarse como desee. <br><br><pre> <code class="bash hljs">crontab -e * * * * * /usr/sbin/rhn_check</code> </pre> <br>  Tampoco ser谩 incorrecto agregar / usr / bin / rhn-actions-control --enable-all a Cron tambi茅n, se usa para implementar configuraciones y, a veces, se vuelve est煤pido. <br><br>  Volvemos a la gesti贸n de claves, copiamos la ID de clave que creamos y ejecutamos: <br><br><pre> <code class="bash hljs">rhnreg_ks --serverUrl=http://your-server-ip/XMLRPC --activationkey=1-YOURKEY --force</code> </pre> <br>  Simplemente no olvide cambiar la IP y los valores clave a los suyos.  Nuevamente, le aconsejo que use la bandera <i>--force</i> , ya que not茅 problemas sin usar esta bandera. <br><br>  Regresamos a <i>Sistemas - Todos</i> , nos complace notar nuestro sistema.  Ahora puede abrirlo y explorar qu茅 y c贸mo, pero por ahora recomiendo crear un grupo para una administraci贸n del sistema m谩s conveniente. <br><br>  <i>Sistemas - Grupos de sistemas - Crear grupo</i> , complete el nombre y la descripci贸n, guarde, abra el grupo reci茅n creado, vaya a la secci贸n <i>Sistemas</i> y agregue el sistema al grupo. <br><br>  Ahora suscriba el sistema al canal, <i>Sistemas - Su sistema - Carpeta de software - Subcarpeta Canales de software:</i> <br><br><img src="https://habrastorage.org/webt/7f/hp/lu/7fhplurd2imupn4cio2n7ymcz1y.png"><br><br>  Elige tu canal y haz clic en confirmaci贸n.  Por diversi贸n, puede intentar instalar el paquete, <i>Software - Paquetes - Instalar</i> . <br><br>  <b>Canal de configuraci贸n</b> <br><br>  Para administrar las configuraciones entre el servidor del cliente / m谩quina local, as铆 como el control remoto, vale la pena configurar el canal de configuraci贸n y vincular el sistema a 茅l. <br>  Vamos a <i>Configuraci贸n - Canales de configuraci贸n - Crear canal de configuraci贸n</i> , establecer el nombre, descripci贸n, guardar, luego en <i>Configuraci贸n - Administrar canales de configuraci贸n - Suscribirse a canales</i> y firmar el canal de configuraci贸n al canal de software y al sistema. <br><br><img src="https://habrastorage.org/webt/jy/ki/wt/jykiwtrdmame71pab7yyzr40lay.png"><br><br>  Ahora podemos implementar configuraciones desde el servidor y las m谩quinas locales, y crear particiones. <br><br>  <i>Configuraci贸n - Agregar archivos - Crear archivo / Cargar archivo:</i> <br><br><img src="https://habrastorage.org/webt/cf/js/ie/cfjsieqwp21zlmem7goijg7cqui.png"><br><br>  Adem谩s, podemos enviar comandos remotos en forma de script bash: <br><br><img src="https://habrastorage.org/webt/hy/xw/d-/hyxwd-znezglfc-glf5yhn44wsq.png"><br><br>  Les recuerdo que todas las acciones pasan por un Programa, se puede encontrar una lista de todas las acciones aplicadas a este sistema en la secci贸n Eventos: <br><br><img src="https://habrastorage.org/webt/9m/fp/hj/9mfphjmglxmqpxfd_cdqpsf8g2s.png"><br><br>  <b>Erratas</b> <br><br>  Una de las caracter铆sticas m谩s importantes de Spacewalk es el soporte de erratas, que se une convenientemente a los canales y le permite controlar el nivel de importancia de las 煤ltimas actualizaciones.  Esto se configura directamente en el servidor, adem谩s de los scripts, debe descargar los paquetes necesarios para Pearl: <br><br><pre> <code class="bash hljs">yum -y install perl-Frontier-RPC perl-Text-Unidecode wget https://raw.githubusercontent.com/stevemeier/cefs/master/errata-import.pl chmod +x errata-import.pl</code> </pre> <br>  Luego cree la actualizaci贸n principal y la errata del script de colecci贸n, que se almacenar谩 en <i>/ etc / rhn /:</i> <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash cd /etc/rhn/ wget -N http://cefs.steve-meier.de/errata.latest.xml wget -N https://www.redhat.com/security/data/oval/com.redhat.rhsa-all.xml export SPACEWALK_USER='root' export SPACEWALK_PASS='verystrong' ./errata-import.pl --server YourServerIPAddress --errata errata.latest.xml --rhsa-oval com.redhat.rhsa-all.xml --publish unset SPACEWALK_USER unset SPACEWALK_PASS</span></span></code> </pre> <br>  En la exportaci贸n, especifique el nombre y la contrase帽a del administrador de Spacewalk, que especific贸 al principio. <br><br>  Hagamos que el script sea ejecutable y agr茅guelo a Cron: <br><br><pre> <code class="bash hljs">chmod +x spcwlk_errata.sh crontab -e 0 2 * * 7 /usr/bin/sh /etc/rhn/spcwlk_errata.sh</code> </pre> <br>  Ejec煤telo ahora mismo para ver los cambios en la interfaz gr谩fica.  La ejecuci贸n llevar谩 alg煤n tiempo. <br><br><img src="https://habrastorage.org/webt/5v/yy/v9/5vyyv9a4xpmq7c2lqqglozhdrsk.png"><br><br><h4>  Resumen </h4><br>  Un punto importante, en mi opini贸n, que personalmente extra帽茅, es configurar e instalar un proxy, as铆 como elevar todo el sistema como HA.  Tuve una idea para configurar la aplicaci贸n a trav茅s de marcapasos y sincronizar en la base de datos.  Como resultado, se decidi贸 abandonar esta idea, en vista de la flota no muy grande de servidores de estaciones de clientes.  Sin embargo, si el sistema resulta extremadamente 煤til en los pr贸ximos seis meses, es posible que deba expandir el servidor original. <br><br><h4>  Automatizaci贸n </h4><br>  <b>Servidor:</b> <br><br><div class="spoiler">  <b class="spoiler_title">Script Bash para la implementaci贸n del servidor (DISABLES firewalld):</b> <div class="spoiler_text"><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh # rpm -Uvh https://copr-be.cloud.fedoraproject.org/results/@spacewalkproject/spacewalk-2.8/epel-7-x86_64/00736372-spacewalk-repo/spacewalk-repo-2.8-11.el7.centos.noarch.rpm rpm -Uvh https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm (cd /etc/yum.repos.d &amp;&amp; curl -O https://copr.fedorainfracloud.org/coprs/g/spacewalkproject/java-packages/repo/epel-7/group_spacewalkproject-java-packages-epel-7.repo) yum -y install spacewalk-setup-postgresql spacewalk-postgresql wget perl-Frontier-RPC perl-Text-Unidecode perl-XML-Simple # mkdir /usr/share/spcwlk-tmp/ echo 'admin-email = root@localhost ssl-set-cnames = spcwlkserver ssl-set-org = Unicorn ssl-set-org-unit = EOH ssl-set-city = Prague ssl-set-state = SCK ssl-set-country = CZ ssl-password = verystrong ssl-set-email = root@localhost ssl-config-sslvhost = Y db-backend=postgresql db-name=spcwlkdb db-user=spcwlkuser db-password=verystrong db-host=localhost db-port=5432 enable-tftp=Y' &gt; /usr/share/spcwlk-tmp/spcwlk_answer spacewalk-setup --answer-file=/usr/share/spcwlk-tmp/spcwlk_answer # systemctl stop firewalld systemctl disable firewalld #</span></span></code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Script de Bash para instalar erratas (primero configure el nombre y la contrase帽a para el administrador de Spacewalk):</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh # wget https://raw.githubusercontent.com/stevemeier/cefs/master/errata-import.pl -P /etc/rhn/ echo '#!/bin/bash cd /etc/rhn/ wget -N http://cefs.steve-meier.de/errata.latest.xml wget -N https://www.redhat.com/security/data/oval/com.redhat.rhsa-all.xml export SPACEWALK_USER='gui username' export SPACEWALK_PASS='Password to your gui account' ./errata-import.pl --server YourServerIPAddress --errata errata.latest.xml --rhsa-oval com.redhat.rhsa-all.xml --publish unset SPACEWALK_USER unset SPACEWALK_PASS' &gt; /etc/rhn/spcwlk_errata.sh # chmod +x /etc/rhn/errata-import.pl chmod +x /etc/rhn/spcwlk_errata.sh # echo '#!/bin/bash # /etc/rhn/./spcwlk_errata.sh' &gt; /etc/rhn/spcwlk_errata_cron.sh chmod +x /etc/rhn/spcwlk_errata_cron.sh echo '0 2 * * 7 /usr/bin/sh /etc/rhn/spcwlk_errata_cron.sh' &gt;&gt; /var/spool/cron/root /etc/rhn/./spcwlk_errata.sh #</span></span></code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Libro de jugadas de Ansible para la implementaci贸n del servidor (no olvide agregar el archivo de respuesta):</b> <div class="spoiler_text"><pre> <code class="bash hljs">- hosts: spcwlk-server tasks: - name: Install Spacewalk repo yum: name: https://copr-be.cloud.fedoraproject.org/results/@spacewalkproject/spacewalk-2.8/epel-7-x86_64/00736372-spacewalk-repo/spacewalk-repo-2.8-11.el7.centos.noarch.rpm state: present - name: Install epel repo yum: name: https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm state: present - name: Install PostgreSQL packages yum: name: - spacewalk-setup-postgresql - spacewalk-postgresql - wget - perl-Frontier-RPC - perl-Text-Unidecode - perl-XML-Simple - name: Creates directory <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> Spacewalk answer file file: path: /usr/share/spcwlk-tmp/ state: directory mode: 0755 - name: Deploy answer file copy: src: /etc/ansible/spcwlk_answer dest: /usr/share/spcwlk-tmp/spcwlk_answer - name: Spacewalk Server Deploy shell: spacewalk-setup --answer-file=/usr/share/spcwlk-tmp/spcwlk_answer - name: Stop firewalld systemd: name: firewalld state: stopped enabled: no</code> </pre> <br></div></div><br>  <b>Cliente:</b> <br><br><div class="spoiler">  <b class="spoiler_title">Script Bash para la implementaci贸n del cliente (no se olvide de la IP y la clave):</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh # rpm -Uvh https://copr-be.cloud.fedoraproject.org/results/@spacewalkproject/spacewalk-2.8-client/epel-7-x86_64/00742644-spacewalk-repo/spacewalk-client-repo-2.8-11.el7.centos.noarch.rpm yum -y install rhn-client-tools rhn-check rhn-setup rhnsd m2crypto yum-rhn-plugin rhncfg-actions deltarpm wget echo '#!/bin/bash # /usr/sbin/rhn_check' &gt; rhn_check.sh mv rhn_check.sh /etc/cron.hourly/ chmod +x /etc/cron.hourly/rhn_check.sh echo '* * * * * /usr/bin/sh /etc/cron.hourly/rhn_check.sh' &gt;&gt; /var/spool/cron/root /usr/bin/rhn-actions-control --enable-all cd /usr/share/rhn/ wget http://YourServerIPAddress/pub/RHN-ORG-TRUSTED-SSL-CERT rhnreg_ks --serverUrl=http://172.22.64.41/XMLRPC --activationkey=1-xxxxxxxxxxxxxxxxxxxxxxxxxxxx --force</span></span></code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Libro de jugadas anisble para la implementaci贸n del cliente:</b> <div class="spoiler_text"><pre> <code class="bash hljs">- hosts: spcwlk-clients tasks: - name: Install spacewalk repo yum: name: https://copr-be.cloud.fedoraproject.org/results/@spacewalkproject/spacewalk-2.8-client/epel-7-x86_64/00742644-spacewalk-repo/spacewalk-client-repo-2.8-11.el7.centos.noarch.rpm state: present - name: Install client packages yum: name: - rhn-client-tools - rhn-check - rhn-setup - rhnsd - m2crypto - yum-rhn-plugin - rhncfg-actions - deltarpm - wget - name: Create cronjob <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> rhn_check cron: name: <span class="hljs-string"><span class="hljs-string">"rhn_check"</span></span> minute: <span class="hljs-string"><span class="hljs-string">"*"</span></span> hour: <span class="hljs-string"><span class="hljs-string">"*"</span></span> day: <span class="hljs-string"><span class="hljs-string">"*"</span></span> month: <span class="hljs-string"><span class="hljs-string">"*"</span></span> weekday: <span class="hljs-string"><span class="hljs-string">"*"</span></span> job: <span class="hljs-string"><span class="hljs-string">"/usr/sbin/rhn_check"</span></span> - name: Enable controls <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> config and remote control deployment shell: /usr/bin/rhn-actions-control --<span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>-all - name: Get certificate from server to client get_url: url: http://YourServerIPAddress/pub/RHN-ORG-TRUSTED-SSL-CERT dest: /usr/share/rhn/ - name: Register client to server rhn_register: state: present server_url: http://YourServerIPAddress/XMLRPC activationkey: <span class="hljs-string"><span class="hljs-string">"{{ activation_key }}"</span></span></code> </pre> <br></div></div><br>  Gracias a todos por leer el art铆culo.  Buena suerte </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es435578/">https://habr.com/ru/post/es435578/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es435564/index.html">Usando GtkApplication. Funciones de representaci贸n de Librsvg</a></li>
<li><a href="../es435568/index.html">Enrutador VyOS OpenSource</a></li>
<li><a href="../es435572/index.html">Anycubic i3 Mega: remake de calidad de Prusa i3</a></li>
<li><a href="../es435574/index.html">驴C贸mo funciona zig?</a></li>
<li><a href="../es435576/index.html">1C, sin dolor</a></li>
<li><a href="../es435580/index.html">Servicios Java, Spring, Kurento y Media</a></li>
<li><a href="../es435582/index.html">驴C贸mo agregar un 铆ndice en un sistema cargado 24/7 sin tiempo de inactividad?</a></li>
<li><a href="../es435584/index.html">Slush 2018. D铆a uno, D铆a dos</a></li>
<li><a href="../es435586/index.html">El arte del chamanismo o firmware personalizado para Olinuxino. Kernel y Ubuntu Parte 3</a></li>
<li><a href="../es435588/index.html">Promoci贸n de una aplicaci贸n m贸vil con experiencia real en n煤meros.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>