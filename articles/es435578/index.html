<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🔐 💯 ♌️ Spacewalk para Navidad 👀 🧔🏻 👴</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola Habr! 

 Poco antes de Navidad, se decidió estudiar Spacewalk en el departamento de TI: este es el sistema Red Hat, un análogo gratuito de Satell...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Spacewalk para Navidad</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/435578/"> Hola Habr! <br><br>  Poco antes de Navidad, se decidió estudiar Spacewalk en el departamento de TI: este es el sistema Red Hat, un análogo gratuito de Satellite, para la gestión de configuración centralizada, actualizaciones del sistema y soporte conveniente para todo el parque de servidores. <br><br>  Debido al hecho de que la documentación disponible en el sitio web oficial es bastante escasa para comentarios adicionales de varios tipos de solución de problemas, la tarea consistía en estudiar el producto para su introducción gradual primero a los servidores de prueba, y luego a los productos. <br><br>  La idea principal de introducir Spacewalk no era solo la centralización y la simplificación del control, sino también para que nadie jugara actualizaciones en los servidores del nuevo proyecto con bolígrafos juguetones, ya que los precedentes ya ocurrieron. <br><br>  Después de dos semanas de trabajo, todo el conocimiento que recibí se ingresó en el análogo interno de Confluence, y un día libre me llevó a escribir un artículo sobre Habr. <br><a name="habracut"></a><br>  Antes de comenzar, me gustaría resaltar brevemente lo que fue y no fue afectado, para no calificar para el manual completo para trabajar con Spacewalk: <br><br>  + Instalación y configuración del servidor / cliente <br>  + Configuración del sistema en GUI <br>  + Solucione problemas de paquetes de instalación / actualización, trabaje con configuraciones <br>  + Errata (recopilación de información sobre actualizaciones críticas, vulnerabilidades, etc.) <br><br>  - Proxy (la necesidad desapareció, después de abandonar HA) <br>  - zapatero / kickstart <br>  - OpenSCAP <br><br><h3>  Requisitos del sistema </h3><br>  Debido al hecho de que toda la infraestructura se ejecuta en VMWare, el trabajo se realizó en una VM que ejecuta CentOS 7. Los requisitos de sistema recomendados por el desarrollador son: <br><br><ul><li>  4 GB de RAM </li><li>  6GB de espacio libre para / var / satélite / </li><li>  12GB para DB </li></ul><br>  Yo usé: <br><br><ul><li>  6 GB de RAM </li><li>  4 CPU (s) </li><li>  HDD de 40 GB </li></ul><br>  También te aconsejo que deshabilites SELinux y, si no lo estás usando, firewalld.  O agregue el servicio http a las excepciones. <br><br>  Nota: al final del artículo habrá playbooks para Ansible, tanto para las partes del cliente como del servidor, así como scripts de bash.  Con su ayuda, será posible implementar toda la infraestructura en un par de minutos. <br><br><h3>  Instalación </h3><br>  La instalación en sí se describe tanto en la documentación oficial como en varios sitios, sin embargo, por la integridad del artículo, permítanme mencionar este punto aquí. <br><br>  Spacewalk funciona con dos DBMS: PostgreSQL y Oracle RDBMS.  Tengo experiencia con el primero, y lo usaré ahora. <br><br>  Hay dos opciones de instalación: ambas a través del instalador automático de Spacewalk, que se instalará y configurará a sí mismo y a la base de datos, sin embargo, en el mismo servidor, e instalación manual, donde puede colocar la base de datos y la aplicación en diferentes servidores.  Consideraré ambas opciones, comenzaré con una instalación separada. <br><br><h4>  PostgreSQL </h4><br><pre><code class="bash hljs">yum install -y postgresql-server</code> </pre> <br>  También es necesario conectar módulos PL / Tcl para PG: <br><br><pre> <code class="bash hljs">yum install -y postgresql-pltcl postgresql-setup initdb systemctl start postgresql</code> </pre> <br>  Cree una base de datos, un usuario y conecte el módulo: <br><br><pre> <code class="bash hljs">su - postgres -c <span class="hljs-string"><span class="hljs-string">'PGPASSWORD=verystrong; createdb spcwlkdb ; createlang plpgsql spcwlkdb ; createlang pltclu spcwlkdb ; yes $PGPASSWORD | createuser -P -sDR spcwlkuser'</span></span></code> </pre> <br>  Para evitar problemas de conexión, vale la pena cambiar <i>/var/lib/pgsql/data/pg_hba.conf</i> , agregando las líneas ANTES de la línea: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">local</span></span> spcwlkdb spcwlkuser md5 host spcwlkdb spcwlkuser 127.0.0.1/8 md5 <span class="hljs-built_in"><span class="hljs-built_in">local</span></span> spcwlkdb postgres ident</code> </pre> <br>  Reiniciar todo: <br><br><pre> <code class="bash hljs">systemctl restart postgresql</code> </pre> <br>  Si tiene la intención de instalar la aplicación y la base de datos en diferentes servidores, asegúrese de que el paquete <i>postgresql-contrib</i> esté instalado en el servidor de la base de datos. <br><br><h4>  Caminata espacial </h4><br>  Conectamos repositorios: <br><br><pre> <code class="bash hljs">rpm -Uvh https://copr-be.cloud.fedoraproject.org/results/@spacewalkproject/spacewalk-2.8/epel-7-x86_64/00736372-spacewalk-repo/spacewalk-repo-2.8-11.el7.centos.noarch.rpm</code> </pre> <br>  También conecte epel: <br><br><pre> <code class="bash hljs">rpm -Uvh https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm</code> </pre> <br>  Java: <br><br><pre> <code class="bash hljs">(<span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /etc/yum.repos.d &amp;&amp; curl -O https://copr.fedorainfracloud.org/coprs/g/spacewalkproject/java-packages/repo/epel-7/group_spacewalkproject-java-packages-epel-7.repo)</code> </pre> <br>  Ahora directamente el instalador para Spacewalk-postgres: <br><br><pre> <code class="bash hljs">yum -y install spacewalk-setup-postgresql</code> </pre> <br>  Conéctese a nuestra base de datos: <br><br><pre> <code class="bash hljs">spacewalk-setup-postgresql create --db spcwlkdb --user spcwlkuser --password verystrong</code> </pre> <br>  En el caso de que esté utilizando un método de base de datos / aplicación por separado, deberá agregar el indicador <i>--standalone</i> y especificar la dirección IP del servidor de la base de datos; no olvide abrir el puerto 5432. <br><br>  <i>Nota: Aconsejo ajustar la base de datos de acuerdo con su hardware para una operación más productiva de todo el sistema.</i> <br><br>  Ahora instale Spacewalk y ejecute la instalación: <br><br><pre> <code class="bash hljs">yum -y install spacewalk-postgresql spacewalk-setup --external-postgresql</code> </pre> <br>  A continuación, se formularán varias preguntas, tanto sobre el certificado SSL como sobre la base de datos.  Puede ingresar todos los valores manualmente, o puede usar el <i>marcador --answer-file</i> y especificar la ruta al archivo con respuestas para automatizar la instalación en el futuro: <br><br><pre> <code class="bash hljs">admin-email = root@localhost ssl-set-cnames = spcwlkserver ssl-set-org = Unicorn ssl-set-org-unit = EOH ssl-set-city = Prague ssl-set-state = HMP ssl-set-country = CZ ssl-password = verystrong ssl-set-email = root@localhost ssl-config-sslvhost = Y db-backend=postgresql db-name=spcwlkdb db-user=spcwlkuser db-password=verystrong db-host=localhost db-port=5432 <span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>-tftp=Y</code> </pre> <br>  Para controlar la aplicación directamente, debe usar: <br><br><pre> <code class="bash hljs">/usr/sbin/spacewalk-service [stop|start|restart]</code> </pre> <br>  Para mostrar todos los servicios de terceros que contribuyen a la aplicación: <br><br><pre> <code class="bash hljs">spacewalk-service status</code> </pre> <br><h4>  Opción dos, instalación automática </h4><br>  Después de conectar los repositorios, configure y ejecute: <br><br><pre> <code class="bash hljs">yum -y install spacewalk-setup-postgresql yum -y install spacewalk-postgresql spacewalk-setup</code> </pre> <br>  Nuevamente, se harán preguntas sobre la base de datos y SSL, utilizamos la clave <i>--answer-file</i> y la ruta al archivo con las respuestas. <br><br><h3>  Canales base e hijos, repos </h3><br>  Para administrar las estaciones del cliente, Spacewalk utiliza un sistema de los llamados canales, que pueden ser main (child) o child (child), un repositorio que necesita está conectado a cada canal, así como una clave, con la cual el cliente está emparejado servidor <br><br>  Como resultado, los repositorios se sincronizan con canales que, a su vez, están conectados con clientes, y Spacewalk funciona de manera general.  La errata, que puede estar vinculada a los canales, también vale la pena mencionar, lo que simplifica la actualización y el control del paquete. <br><br>  Todos los clientes se pueden agrupar de acuerdo con varios criterios, tanto con los mismos canales como con diferentes canales o repositorios. Es posible trabajar con una gran cantidad de clientes a la vez, lo que ayuda a realizar actualizaciones en más de 100 servidores. <br><br>  Una lista de todos los paquetes instalados está disponible, y después de la sincronización de los repositorios y posible instalación.  Algunos puntos son intuitivos y no tiene sentido considerar cada elemento línea por línea. <br><br>  Todas las acciones en Spacewalk tienen lugar en un horario (Schedule), casi cualquier acción se puede configurar para el momento que sea más conveniente para usted. <br><br>  Después de la instalación, será posible ir a la dirección de su servidor, realizar más configuraciones a través de la interfaz gráfica: <br><br><img src="https://habrastorage.org/webt/bb/iq/co/bbiqcow_kswo_i91vsqceeg6g0s.png"><br><br>  Ingrese la contraseña, el nombre del administrador, el nombre de la organización (que también es una de las formas de administrar clientes) y vaya al panel de inicio. <br><br>  Por ahora, puede explorar las opciones disponibles usted mismo o pasar a crear canales. <br><br>  <i>Canales - Administrar canales de software - Crear canal:</i> <br><br><img src="https://habrastorage.org/webt/5m/6o/f9/5m6of99m6ey7yq0rxbdmenvhcuw.png"><br><br>  Recomiendo configurar los nombres de los canales de acuerdo con los tipos y el tipo de sistema operativo que se vinculará a este canal, por ejemplo, <i>CentOS_7_x86_64</i> , puede elegir con seguridad sha256 como comprobaciones, el campo Resumen de Channell está destinado a una pequeña descripción del canal.  Además, opcionalmente puede proporcionar información adicional. <br><br>  Ahora cree un canal secundario y vincúlelo al principal.  Vamos de la misma manera que al crear el canal principal, solo en el campo Canal principal indicaremos el canal creado previamente. <br><br>  Vincula los repositorios a los canales principales y subsidiarios. <br>  <i>Canales - Administrar repositorios</i> <br><br><img src="https://habrastorage.org/webt/a3/gq/ok/a3gqokxrwd10mlfq4geiw0f1nqy.png"><br><br>  Para los canales principales, uso los Recursos base, para los canales subsidiarios - Actualizaciones. <br><br>  Después de crear los repositorios, debe conectarlos a los canales. <br>  <i>Canales: administre canales de software</i> , abra su canal principal, abra la sección Repositorios. <br><br><img src="https://habrastorage.org/webt/hw/ro/og/hwroogjvybx0p1z2mslzxf8nunq.png"><br><br>  Habrá todos los repositorios creados, seleccione el que necesita, márquelo y haga clic en Actualizar recursos. <br><br>  A continuación, abra la subclave Sync: <br><br><img src="https://habrastorage.org/webt/ho/j7/4m/hoj74mhjkorduvftwkwbteuxzk4.png"><br><br>  Donde puede sincronizar el repositorio y el canal, configure la programación para la sincronización. <br><br>  <i>Nota: en mi caso de bolígrafos juguetones, tuve que eliminar el repositorio estándar del sistema cliente.</i> <br><br><h4>  Instalación del cliente, emparejamiento del cliente con el servidor, administración de claves, configuración del canal de configuración </h4><br>  Como mencioné anteriormente, Spacewalk usa un sistema clave de Red Hat Network, que se usa para emparejar y administrar. <br><br>  Para crear una clave, vaya a <i>Sistemas - Claves de activación - Crear clave:</i> <br><br><img src="https://habrastorage.org/webt/ea/df/vf/eadfvfezxpeh1s_lt9blgfox3j8.png"><br><br>  Aquí todo es extremadamente simple, vale la pena mencionar que puede configurar la clave usted mismo, su formato siempre será <i>1-XXXXXX</i> y, además, cada clave está conectada al canal.  El indicador Universal Default obliga a los nuevos sistemas a elegir parámetros clave. <br><br>  <b>Instalación del cliente</b> <br><br>  Conecte el repositorio del cliente e instale los paquetes necesarios: <br><br><pre> <code class="bash hljs">rpm -Uvh https://copr-be.cloud.fedoraproject.org/results/@spacewalkproject/spacewalk-2.8-client/epel-7-x86_64/00742644-spacewalk-repo/spacewalk-client-repo-2.8-11.el7.centos.noarch.rpm yum -y install rhn-client-tools rhn-check rhn-setup rhnsd m2crypto yum-rhn-plugin rhncfg-actions deltarpm</code> </pre> <br><br>  <i>Nota: rhncfg-actions y deltarpm son necesarios para que las configuraciones y el control remoto funcionen correctamente.</i> <br><br>  Spacewalk usa rhn_check para sincronizar el servidor del cliente, que se ejecuta cada 4 horas.  Este valor se puede reducir a 60 minutos, pero para mí ninguna de las opciones era óptima, por lo tanto, hay dos opciones: usar osad, que viene con Spacewalk, o simplemente agregar un cronjob para rhn_check, por ejemplo, por cada minuto mientras pruebe el sistema, entonces el valor puede cambiarse como desee. <br><br><pre> <code class="bash hljs">crontab -e * * * * * /usr/sbin/rhn_check</code> </pre> <br>  Tampoco será incorrecto agregar / usr / bin / rhn-actions-control --enable-all a Cron también, se usa para implementar configuraciones y, a veces, se vuelve estúpido. <br><br>  Volvemos a la gestión de claves, copiamos la ID de clave que creamos y ejecutamos: <br><br><pre> <code class="bash hljs">rhnreg_ks --serverUrl=http://your-server-ip/XMLRPC --activationkey=1-YOURKEY --force</code> </pre> <br>  Simplemente no olvide cambiar la IP y los valores clave a los suyos.  Nuevamente, le aconsejo que use la bandera <i>--force</i> , ya que noté problemas sin usar esta bandera. <br><br>  Regresamos a <i>Sistemas - Todos</i> , nos complace notar nuestro sistema.  Ahora puede abrirlo y explorar qué y cómo, pero por ahora recomiendo crear un grupo para una administración del sistema más conveniente. <br><br>  <i>Sistemas - Grupos de sistemas - Crear grupo</i> , complete el nombre y la descripción, guarde, abra el grupo recién creado, vaya a la sección <i>Sistemas</i> y agregue el sistema al grupo. <br><br>  Ahora suscriba el sistema al canal, <i>Sistemas - Su sistema - Carpeta de software - Subcarpeta Canales de software:</i> <br><br><img src="https://habrastorage.org/webt/7f/hp/lu/7fhplurd2imupn4cio2n7ymcz1y.png"><br><br>  Elige tu canal y haz clic en confirmación.  Por diversión, puede intentar instalar el paquete, <i>Software - Paquetes - Instalar</i> . <br><br>  <b>Canal de configuración</b> <br><br>  Para administrar las configuraciones entre el servidor del cliente / máquina local, así como el control remoto, vale la pena configurar el canal de configuración y vincular el sistema a él. <br>  Vamos a <i>Configuración - Canales de configuración - Crear canal de configuración</i> , establecer el nombre, descripción, guardar, luego en <i>Configuración - Administrar canales de configuración - Suscribirse a canales</i> y firmar el canal de configuración al canal de software y al sistema. <br><br><img src="https://habrastorage.org/webt/jy/ki/wt/jykiwtrdmame71pab7yyzr40lay.png"><br><br>  Ahora podemos implementar configuraciones desde el servidor y las máquinas locales, y crear particiones. <br><br>  <i>Configuración - Agregar archivos - Crear archivo / Cargar archivo:</i> <br><br><img src="https://habrastorage.org/webt/cf/js/ie/cfjsieqwp21zlmem7goijg7cqui.png"><br><br>  Además, podemos enviar comandos remotos en forma de script bash: <br><br><img src="https://habrastorage.org/webt/hy/xw/d-/hyxwd-znezglfc-glf5yhn44wsq.png"><br><br>  Les recuerdo que todas las acciones pasan por un Programa, se puede encontrar una lista de todas las acciones aplicadas a este sistema en la sección Eventos: <br><br><img src="https://habrastorage.org/webt/9m/fp/hj/9mfphjmglxmqpxfd_cdqpsf8g2s.png"><br><br>  <b>Erratas</b> <br><br>  Una de las características más importantes de Spacewalk es el soporte de erratas, que se une convenientemente a los canales y le permite controlar el nivel de importancia de las últimas actualizaciones.  Esto se configura directamente en el servidor, además de los scripts, debe descargar los paquetes necesarios para Pearl: <br><br><pre> <code class="bash hljs">yum -y install perl-Frontier-RPC perl-Text-Unidecode wget https://raw.githubusercontent.com/stevemeier/cefs/master/errata-import.pl chmod +x errata-import.pl</code> </pre> <br>  Luego cree la actualización principal y la errata del script de colección, que se almacenará en <i>/ etc / rhn /:</i> <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash cd /etc/rhn/ wget -N http://cefs.steve-meier.de/errata.latest.xml wget -N https://www.redhat.com/security/data/oval/com.redhat.rhsa-all.xml export SPACEWALK_USER='root' export SPACEWALK_PASS='verystrong' ./errata-import.pl --server YourServerIPAddress --errata errata.latest.xml --rhsa-oval com.redhat.rhsa-all.xml --publish unset SPACEWALK_USER unset SPACEWALK_PASS</span></span></code> </pre> <br>  En la exportación, especifique el nombre y la contraseña del administrador de Spacewalk, que especificó al principio. <br><br>  Hagamos que el script sea ejecutable y agréguelo a Cron: <br><br><pre> <code class="bash hljs">chmod +x spcwlk_errata.sh crontab -e 0 2 * * 7 /usr/bin/sh /etc/rhn/spcwlk_errata.sh</code> </pre> <br>  Ejecútelo ahora mismo para ver los cambios en la interfaz gráfica.  La ejecución llevará algún tiempo. <br><br><img src="https://habrastorage.org/webt/5v/yy/v9/5vyyv9a4xpmq7c2lqqglozhdrsk.png"><br><br><h4>  Resumen </h4><br>  Un punto importante, en mi opinión, que personalmente extrañé, es configurar e instalar un proxy, así como elevar todo el sistema como HA.  Tuve una idea para configurar la aplicación a través de marcapasos y sincronizar en la base de datos.  Como resultado, se decidió abandonar esta idea, en vista de la flota no muy grande de servidores de estaciones de clientes.  Sin embargo, si el sistema resulta extremadamente útil en los próximos seis meses, es posible que deba expandir el servidor original. <br><br><h4>  Automatización </h4><br>  <b>Servidor:</b> <br><br><div class="spoiler">  <b class="spoiler_title">Script Bash para la implementación del servidor (DISABLES firewalld):</b> <div class="spoiler_text"><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh # rpm -Uvh https://copr-be.cloud.fedoraproject.org/results/@spacewalkproject/spacewalk-2.8/epel-7-x86_64/00736372-spacewalk-repo/spacewalk-repo-2.8-11.el7.centos.noarch.rpm rpm -Uvh https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm (cd /etc/yum.repos.d &amp;&amp; curl -O https://copr.fedorainfracloud.org/coprs/g/spacewalkproject/java-packages/repo/epel-7/group_spacewalkproject-java-packages-epel-7.repo) yum -y install spacewalk-setup-postgresql spacewalk-postgresql wget perl-Frontier-RPC perl-Text-Unidecode perl-XML-Simple # mkdir /usr/share/spcwlk-tmp/ echo 'admin-email = root@localhost ssl-set-cnames = spcwlkserver ssl-set-org = Unicorn ssl-set-org-unit = EOH ssl-set-city = Prague ssl-set-state = SCK ssl-set-country = CZ ssl-password = verystrong ssl-set-email = root@localhost ssl-config-sslvhost = Y db-backend=postgresql db-name=spcwlkdb db-user=spcwlkuser db-password=verystrong db-host=localhost db-port=5432 enable-tftp=Y' &gt; /usr/share/spcwlk-tmp/spcwlk_answer spacewalk-setup --answer-file=/usr/share/spcwlk-tmp/spcwlk_answer # systemctl stop firewalld systemctl disable firewalld #</span></span></code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Script de Bash para instalar erratas (primero configure el nombre y la contraseña para el administrador de Spacewalk):</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh # wget https://raw.githubusercontent.com/stevemeier/cefs/master/errata-import.pl -P /etc/rhn/ echo '#!/bin/bash cd /etc/rhn/ wget -N http://cefs.steve-meier.de/errata.latest.xml wget -N https://www.redhat.com/security/data/oval/com.redhat.rhsa-all.xml export SPACEWALK_USER='gui username' export SPACEWALK_PASS='Password to your gui account' ./errata-import.pl --server YourServerIPAddress --errata errata.latest.xml --rhsa-oval com.redhat.rhsa-all.xml --publish unset SPACEWALK_USER unset SPACEWALK_PASS' &gt; /etc/rhn/spcwlk_errata.sh # chmod +x /etc/rhn/errata-import.pl chmod +x /etc/rhn/spcwlk_errata.sh # echo '#!/bin/bash # /etc/rhn/./spcwlk_errata.sh' &gt; /etc/rhn/spcwlk_errata_cron.sh chmod +x /etc/rhn/spcwlk_errata_cron.sh echo '0 2 * * 7 /usr/bin/sh /etc/rhn/spcwlk_errata_cron.sh' &gt;&gt; /var/spool/cron/root /etc/rhn/./spcwlk_errata.sh #</span></span></code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Libro de jugadas de Ansible para la implementación del servidor (no olvide agregar el archivo de respuesta):</b> <div class="spoiler_text"><pre> <code class="bash hljs">- hosts: spcwlk-server tasks: - name: Install Spacewalk repo yum: name: https://copr-be.cloud.fedoraproject.org/results/@spacewalkproject/spacewalk-2.8/epel-7-x86_64/00736372-spacewalk-repo/spacewalk-repo-2.8-11.el7.centos.noarch.rpm state: present - name: Install epel repo yum: name: https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm state: present - name: Install PostgreSQL packages yum: name: - spacewalk-setup-postgresql - spacewalk-postgresql - wget - perl-Frontier-RPC - perl-Text-Unidecode - perl-XML-Simple - name: Creates directory <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> Spacewalk answer file file: path: /usr/share/spcwlk-tmp/ state: directory mode: 0755 - name: Deploy answer file copy: src: /etc/ansible/spcwlk_answer dest: /usr/share/spcwlk-tmp/spcwlk_answer - name: Spacewalk Server Deploy shell: spacewalk-setup --answer-file=/usr/share/spcwlk-tmp/spcwlk_answer - name: Stop firewalld systemd: name: firewalld state: stopped enabled: no</code> </pre> <br></div></div><br>  <b>Cliente:</b> <br><br><div class="spoiler">  <b class="spoiler_title">Script Bash para la implementación del cliente (no se olvide de la IP y la clave):</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh # rpm -Uvh https://copr-be.cloud.fedoraproject.org/results/@spacewalkproject/spacewalk-2.8-client/epel-7-x86_64/00742644-spacewalk-repo/spacewalk-client-repo-2.8-11.el7.centos.noarch.rpm yum -y install rhn-client-tools rhn-check rhn-setup rhnsd m2crypto yum-rhn-plugin rhncfg-actions deltarpm wget echo '#!/bin/bash # /usr/sbin/rhn_check' &gt; rhn_check.sh mv rhn_check.sh /etc/cron.hourly/ chmod +x /etc/cron.hourly/rhn_check.sh echo '* * * * * /usr/bin/sh /etc/cron.hourly/rhn_check.sh' &gt;&gt; /var/spool/cron/root /usr/bin/rhn-actions-control --enable-all cd /usr/share/rhn/ wget http://YourServerIPAddress/pub/RHN-ORG-TRUSTED-SSL-CERT rhnreg_ks --serverUrl=http://172.22.64.41/XMLRPC --activationkey=1-xxxxxxxxxxxxxxxxxxxxxxxxxxxx --force</span></span></code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Libro de jugadas anisble para la implementación del cliente:</b> <div class="spoiler_text"><pre> <code class="bash hljs">- hosts: spcwlk-clients tasks: - name: Install spacewalk repo yum: name: https://copr-be.cloud.fedoraproject.org/results/@spacewalkproject/spacewalk-2.8-client/epel-7-x86_64/00742644-spacewalk-repo/spacewalk-client-repo-2.8-11.el7.centos.noarch.rpm state: present - name: Install client packages yum: name: - rhn-client-tools - rhn-check - rhn-setup - rhnsd - m2crypto - yum-rhn-plugin - rhncfg-actions - deltarpm - wget - name: Create cronjob <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> rhn_check cron: name: <span class="hljs-string"><span class="hljs-string">"rhn_check"</span></span> minute: <span class="hljs-string"><span class="hljs-string">"*"</span></span> hour: <span class="hljs-string"><span class="hljs-string">"*"</span></span> day: <span class="hljs-string"><span class="hljs-string">"*"</span></span> month: <span class="hljs-string"><span class="hljs-string">"*"</span></span> weekday: <span class="hljs-string"><span class="hljs-string">"*"</span></span> job: <span class="hljs-string"><span class="hljs-string">"/usr/sbin/rhn_check"</span></span> - name: Enable controls <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> config and remote control deployment shell: /usr/bin/rhn-actions-control --<span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>-all - name: Get certificate from server to client get_url: url: http://YourServerIPAddress/pub/RHN-ORG-TRUSTED-SSL-CERT dest: /usr/share/rhn/ - name: Register client to server rhn_register: state: present server_url: http://YourServerIPAddress/XMLRPC activationkey: <span class="hljs-string"><span class="hljs-string">"{{ activation_key }}"</span></span></code> </pre> <br></div></div><br>  Gracias a todos por leer el artículo.  Buena suerte </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es435578/">https://habr.com/ru/post/es435578/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es435564/index.html">Usando GtkApplication. Funciones de representación de Librsvg</a></li>
<li><a href="../es435568/index.html">Enrutador VyOS OpenSource</a></li>
<li><a href="../es435572/index.html">Anycubic i3 Mega: remake de calidad de Prusa i3</a></li>
<li><a href="../es435574/index.html">¿Cómo funciona zig?</a></li>
<li><a href="../es435576/index.html">1C, sin dolor</a></li>
<li><a href="../es435580/index.html">Servicios Java, Spring, Kurento y Media</a></li>
<li><a href="../es435582/index.html">¿Cómo agregar un índice en un sistema cargado 24/7 sin tiempo de inactividad?</a></li>
<li><a href="../es435584/index.html">Slush 2018. Día uno, Día dos</a></li>
<li><a href="../es435586/index.html">El arte del chamanismo o firmware personalizado para Olinuxino. Kernel y Ubuntu Parte 3</a></li>
<li><a href="../es435588/index.html">Promoción de una aplicación móvil con experiencia real en números.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>