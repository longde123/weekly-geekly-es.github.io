<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§¥üèæ üí† üëçüèæ Escalonamento autom√°tico DIY com AWX, Ansible, haproxy e CROC Cloud üë©üèø‚Äçüè´ üñïüèæ üß°</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="H√° algum tempo, realizamos monitoramento e alarmes sem agente. Este √© um an√°logo do CloudWatch na AWS com uma API compat√≠vel. Agora estamos trabalhand...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Escalonamento autom√°tico DIY com AWX, Ansible, haproxy e CROC Cloud</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/croccloudteam/blog/456826/"><p><img src="https://habrastorage.org/webt/6f/nt/tj/6fnttjgdk8vat9bbsahsnck_rfa.jpeg" alt="imagem"></p><br><p>  H√° algum tempo, realizamos monitoramento e alarmes sem agente.  Este √© um an√°logo do CloudWatch na AWS com uma API compat√≠vel.  Agora estamos trabalhando em balanceadores e dimensionamento autom√°tico.  Mas, embora n√£o forne√ßamos esse servi√ßo - oferecemos aos nossos clientes que eles mesmos o fazem, usando nosso monitoramento e tags (API da AWS Resource Tagging) como uma simples descoberta de servi√ßo como fonte de dados.  Vamos mostrar como fazer isso neste post. </p><a name="habracut"></a><br><p>  Um exemplo de uma infraestrutura m√≠nima de um servi√ßo da web simples: DNS -&gt; 2 balanceadores -&gt; 2 back-end.  Essa infraestrutura pode ser considerada o m√≠nimo necess√°rio para opera√ß√£o e manuten√ß√£o tolerantes a falhas.  Por esse motivo, n√£o compactaremos ainda mais essa infraestrutura, deixando, por exemplo, apenas um back-end.  Mas eu gostaria de aumentar o n√∫mero de servidores back-end e reduzir novamente para dois.  Esta ser√° a nossa tarefa.  Todos os exemplos est√£o dispon√≠veis no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">reposit√≥rio</a> . </p><br><h3 id="bazovaya-infrastruktura">  Infraestrutura b√°sica </h3><br><p>  N√£o vamos nos deter em detalhes sobre a configura√ß√£o da infraestrutura acima, apenas mostraremos como cri√°-la.  Preferimos implantar infraestrutura usando o Terraform.  Ajuda a criar rapidamente tudo o que voc√™ precisa (VPC, Sub-rede, Grupo de Seguran√ßa, VMs) e repita esse procedimento repetidamente. </p><br><p>  Script para aumentar a infraestrutura b√°sica: </p><br><div class="spoiler">  <b class="spoiler_title">main.tf</b> <div class="spoiler_text"><pre><code class="bash hljs">variable <span class="hljs-string"><span class="hljs-string">"ec2_url"</span></span> {} variable <span class="hljs-string"><span class="hljs-string">"access_key"</span></span> {} variable <span class="hljs-string"><span class="hljs-string">"secret_key"</span></span> {} variable <span class="hljs-string"><span class="hljs-string">"region"</span></span> {} variable <span class="hljs-string"><span class="hljs-string">"vpc_cidr_block"</span></span> {} variable <span class="hljs-string"><span class="hljs-string">"instance_type"</span></span> {} variable <span class="hljs-string"><span class="hljs-string">"big_instance_type"</span></span> {} variable <span class="hljs-string"><span class="hljs-string">"az"</span></span> {} variable <span class="hljs-string"><span class="hljs-string">"ami"</span></span> {} variable <span class="hljs-string"><span class="hljs-string">"client_ip"</span></span> {} variable <span class="hljs-string"><span class="hljs-string">"material"</span></span> {} provider <span class="hljs-string"><span class="hljs-string">"aws"</span></span> { endpoints { ec2 = <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${var.ec2_url}</span></span></span><span class="hljs-string">"</span></span> } skip_credentials_validation = <span class="hljs-literal"><span class="hljs-literal">true</span></span> skip_requesting_account_id = <span class="hljs-literal"><span class="hljs-literal">true</span></span> skip_region_validation = <span class="hljs-literal"><span class="hljs-literal">true</span></span> access_key = <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${var.access_key}</span></span></span><span class="hljs-string">"</span></span> secret_key = <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${var.secret_key}</span></span></span><span class="hljs-string">"</span></span> region = <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${var.region}</span></span></span><span class="hljs-string">"</span></span> } resource <span class="hljs-string"><span class="hljs-string">"aws_vpc"</span></span> <span class="hljs-string"><span class="hljs-string">"vpc"</span></span> { cidr_block = <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${var.vpc_cidr_block}</span></span></span><span class="hljs-string">"</span></span> } resource <span class="hljs-string"><span class="hljs-string">"aws_subnet"</span></span> <span class="hljs-string"><span class="hljs-string">"subnet"</span></span> { availability_zone = <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${var.az}</span></span></span><span class="hljs-string">"</span></span> vpc_id = <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${aws_vpc.vpc.id}</span></span></span><span class="hljs-string">"</span></span> cidr_block = <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${cidrsubnet(aws_vpc.vpc.cidr_block, 8, 0)}</span></span></span><span class="hljs-string">"</span></span> } resource <span class="hljs-string"><span class="hljs-string">"aws_security_group"</span></span> <span class="hljs-string"><span class="hljs-string">"sg"</span></span> { name = <span class="hljs-string"><span class="hljs-string">"auto-scaling"</span></span> vpc_id = <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${aws_vpc.vpc.id}</span></span></span><span class="hljs-string">"</span></span> ingress { from_port = 22 to_port = 22 protocol = <span class="hljs-string"><span class="hljs-string">"tcp"</span></span> cidr_blocks = [<span class="hljs-string"><span class="hljs-string">"0.0.0.0/0"</span></span>] } ingress { from_port = 80 to_port = 80 protocol = <span class="hljs-string"><span class="hljs-string">"tcp"</span></span> cidr_blocks = [<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${cidrsubnet(aws_vpc.vpc.cidr_block, 8, 0)}</span></span></span><span class="hljs-string">"</span></span>] } ingress { from_port = 8080 to_port = 8080 protocol = <span class="hljs-string"><span class="hljs-string">"tcp"</span></span> cidr_blocks = [<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${cidrsubnet(aws_vpc.vpc.cidr_block, 8, 0)}</span></span></span><span class="hljs-string">"</span></span>] } egress { from_port = 0 to_port = 0 protocol = <span class="hljs-string"><span class="hljs-string">"-1"</span></span> cidr_blocks = [<span class="hljs-string"><span class="hljs-string">"0.0.0.0/0"</span></span>] } } resource <span class="hljs-string"><span class="hljs-string">"aws_key_pair"</span></span> <span class="hljs-string"><span class="hljs-string">"key"</span></span> { key_name = <span class="hljs-string"><span class="hljs-string">"auto-scaling-new"</span></span> public_key = <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${var.material}</span></span></span><span class="hljs-string">"</span></span> } resource <span class="hljs-string"><span class="hljs-string">"aws_instance"</span></span> <span class="hljs-string"><span class="hljs-string">"compute"</span></span> { count = 5 ami = <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${var.ami}</span></span></span><span class="hljs-string">"</span></span> instance_type = <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${count.index == 0 ? var.big_instance_type : var.instance_type}</span></span></span><span class="hljs-string">"</span></span> key_name = <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${aws_key_pair.key.key_name}</span></span></span><span class="hljs-string">"</span></span> subnet_id = <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${aws_subnet.subnet.id}</span></span></span><span class="hljs-string">"</span></span> availability_zone = <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${var.az}</span></span></span><span class="hljs-string">"</span></span> security_groups = [<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${aws_security_group.sg.id}</span></span></span><span class="hljs-string">"</span></span>] } resource <span class="hljs-string"><span class="hljs-string">"aws_eip"</span></span> <span class="hljs-string"><span class="hljs-string">"pub_ip"</span></span> { instance = <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${aws_instance.compute.0.id}</span></span></span><span class="hljs-string">"</span></span> vpc = <span class="hljs-literal"><span class="hljs-literal">true</span></span> } output <span class="hljs-string"><span class="hljs-string">"awx"</span></span> { value = <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${aws_eip.pub_ip.public_ip}</span></span></span><span class="hljs-string">"</span></span> } output <span class="hljs-string"><span class="hljs-string">"haproxy_id"</span></span> { value = [<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${slice(aws_instance.compute.*.id, 1, 3)}</span></span></span><span class="hljs-string">"</span></span>] } output <span class="hljs-string"><span class="hljs-string">"awx_id"</span></span> { value = <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${aws_instance.compute.0.id}</span></span></span><span class="hljs-string">"</span></span> } output <span class="hljs-string"><span class="hljs-string">"backend_id"</span></span> { value = [<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${slice(aws_instance.compute.*.id, 3, 5)}</span></span></span><span class="hljs-string">"</span></span>] }</code> </pre> </div></div><br><p>  Todas as entidades descritas nesta configura√ß√£o, ao que parece, devem ser entendidas pelo usu√°rio m√©dio das nuvens modernas.  Vari√°veis ‚Äã‚Äãespec√≠ficas para nossa nuvem e para uma tarefa espec√≠fica s√£o movidas para um arquivo separado - terraform.tfvars: </p><br><div class="spoiler">  <b class="spoiler_title">terraform.tfvars</b> <div class="spoiler_text"><pre> <code class="bash hljs">ec2_url = <span class="hljs-string"><span class="hljs-string">"https://api.cloud.croc.ru"</span></span> access_key = <span class="hljs-string"><span class="hljs-string">"project:user@customer"</span></span> secret_key = <span class="hljs-string"><span class="hljs-string">"secret-key"</span></span> region = <span class="hljs-string"><span class="hljs-string">"croc"</span></span> az = <span class="hljs-string"><span class="hljs-string">"ru-msk-vol51"</span></span> instance_type = <span class="hljs-string"><span class="hljs-string">"m1.2small"</span></span> big_instance_type = <span class="hljs-string"><span class="hljs-string">"m1.large"</span></span> vpc_cidr_block = <span class="hljs-string"><span class="hljs-string">"10.10.0.0/16"</span></span> ami = <span class="hljs-string"><span class="hljs-string">"cmi-3F5B011E"</span></span></code> </pre> </div></div><br><p>  Lan√ßamento Terraform: </p><br><div class="spoiler">  <b class="spoiler_title">aplicar terraform</b> <div class="spoiler_text"><pre> <code class="bash hljs">yes yes | terraform apply -var client_ip=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$(curl -s ipinfo.io/ip)</span></span></span><span class="hljs-string">/32"</span></span> -var material=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$(cat &lt;ssh_publick_key_path&gt;)</span></span></span><span class="hljs-string">"</span></span></code> </pre> </div></div><br><h3 id="nastroyka-monitoringa">  Configura√ß√£o de monitoramento </h3><br><p>  As VMs lan√ßadas acima s√£o monitoradas automaticamente por nossa nuvem.  Esses dados de monitoramento ser√£o a fonte de informa√ß√µes para futuros dimensionamentos autom√°ticos.  Contando com determinadas m√©tricas, podemos aumentar ou diminuir a pot√™ncia. </p><br><p>  O monitoramento em nossa nuvem permite configurar alarmes de acordo com diferentes condi√ß√µes para diferentes m√©tricas.  √â muito conveniente  N√£o precisamos analisar as m√©tricas a qualquer momento e tomar uma decis√£o - isso ser√° feito pelo monitoramento da nuvem.  Neste exemplo, usaremos alarmes para m√©tricas da CPU, mas em nosso monitoramento eles tamb√©m podem ser configurados para m√©tricas como: utiliza√ß√£o da rede (velocidade / pps), utiliza√ß√£o do disco (velocidade / iops). </p><br><div class="spoiler">  <b class="spoiler_title">cloudwatch put-metric-alarm</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">export</span></span> CLOUDWATCH_URL=https://monitoring.cloud.croc.ru <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> instance_id <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> &lt;backend_instance_ids&gt;; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> \ aws --profile &lt;aws_cli_profile&gt; --endpoint-url <span class="hljs-variable"><span class="hljs-variable">$CLOUDWATCH_URL</span></span> \ cloudwatch put-metric-alarm \ --alarm-name <span class="hljs-string"><span class="hljs-string">"scaling-low_</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$instance_id</span></span></span><span class="hljs-string">"</span></span> \ --dimensions Name=InstanceId,Value=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$instance_id</span></span></span><span class="hljs-string">"</span></span> \ --namespace <span class="hljs-string"><span class="hljs-string">"AWS/EC2"</span></span> --metric-name CPUUtilization --statistic Average \ --period 60 --evaluation-periods 3 --threshold 15 --comparison-operator LessThanOrEqualToThreshold; <span class="hljs-keyword"><span class="hljs-keyword">done</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> instance_id <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> &lt;backend_instance_ids&gt;; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> \ aws --profile &lt;aws_cli_profile&gt; --endpoint-url <span class="hljs-variable"><span class="hljs-variable">$CLOUDWATCH_URL</span></span> \ cloudwatch put-metric-alarm\ --alarm-name <span class="hljs-string"><span class="hljs-string">"scaling-high_</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$instance_id</span></span></span><span class="hljs-string">"</span></span> \ --dimensions Name=InstanceId,Value=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$instance_id</span></span></span><span class="hljs-string">"</span></span> \ --namespace <span class="hljs-string"><span class="hljs-string">"AWS/EC2"</span></span> --metric-name CPUUtilization --statistic Average\ --period 60 --evaluation-periods 3 --threshold 80 --comparison-operator GreaterThanOrEqualToThreshold; <span class="hljs-keyword"><span class="hljs-keyword">done</span></span></code> </pre> <br><p>  Descri√ß√£o de alguns par√¢metros que podem ser incompreens√≠veis: </p><br><p>  --profile - perfil de configura√ß√µes do aws-cli, descrito em ~ / .aws / config.  Normalmente, diferentes chaves de acesso s√£o definidas em perfis diferentes. </p><br><p>  --dimensions - o par√¢metro determina para qual recurso o alarme ser√° criado, no exemplo acima - para a inst√¢ncia com o identificador da vari√°vel $ instance_id. </p><br><p>  --namespace - namespace a partir do qual a m√©trica de monitoramento ser√° selecionada. </p><br><p>  --metric-name - o nome da m√©trica de monitoramento. </p><br><p>  --statistic - o nome do m√©todo de agrega√ß√£o de valor da m√©trica. </p><br><p>  --period - intervalo de tempo entre o monitoramento de eventos de coleta de valor. </p><br><p>  --avaluation-period - o n√∫mero de intervalos necess√°rios para acionar um alarme. </p><br><p>  --threshold - valor do limiar m√©trico para avaliar o estado do alarme. </p><br><p>  --comparison-operator - um m√©todo usado para avaliar o valor de uma m√©trica em rela√ß√£o a um valor limite. </p></div></div><br><p>  No exemplo acima, dois alarmes s√£o criados para cada inst√¢ncia de back-end.  Escalonar-baixo- &lt;ID da inst√¢ncia&gt; entrar√° no estado Alarme quando a CPU carregar menos de 15% por 3 minutos.  Escalar alto &lt;ID da inst√¢ncia&gt; entrar√° no estado Alarme quando a CPU carregar mais de 80% por 3 minutos. </p><br><h3 id="nastroyka-tegov">  Personaliza√ß√£o de tags </h3><br><p>  Ap√≥s a configura√ß√£o do monitoramento, somos confrontados com a seguinte tarefa - a descoberta de inst√¢ncias e seus nomes (descoberta de servi√ßo).  De alguma forma, precisamos entender quantas inst√¢ncias de back-end lan√ßamos agora e tamb√©m precisamos saber seus nomes.  Em um mundo fora da nuvem, por exemplo, o c√¥nsul e o modelo do c√¥nsul seriam uma boa op√ß√£o para gerar uma configura√ß√£o do balanceador.  Mas h√° tags em nossa nuvem.  As tags nos ajudar√£o a categorizar os recursos.  Ao solicitar informa√ß√µes para uma tag espec√≠fica (descreva-tags), podemos entender quantas inst√¢ncias temos atualmente no pool e qual ID elas possuem.  Por padr√£o, um ID de inst√¢ncia exclusivo √© usado como nome do host.  Gra√ßas ao DNS interno que trabalha dentro da VPC, esses nomes de ID / host s√£o resolvidos para as inst√¢ncias IP internas. </p><br><p>  Definimos tags para inst√¢ncias de back-end e balanceadores: </p><br><div class="spoiler">  <b class="spoiler_title">tags de cria√ß√£o ec2</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">export</span></span> EC2_URL=<span class="hljs-string"><span class="hljs-string">"https://api.cloud.croc.ru"</span></span> aws --profile &lt;aws_cli_profile&gt; --endpoint-url <span class="hljs-variable"><span class="hljs-variable">$EC2_URL</span></span> \ ec2 create-tags --resources <span class="hljs-string"><span class="hljs-string">"&lt;awx_instance_id&gt;"</span></span> \ --tags Key=env,Value=auto-scaling Key=role,Value=awx <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> &lt;backend_instance_ids&gt;; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> \ aws --profile &lt;aws_cli_profile&gt; --endpoint-url <span class="hljs-variable"><span class="hljs-variable">$EC2_URL</span></span> \ ec2 create-tags --resources <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$i</span></span></span><span class="hljs-string">"</span></span> \ --tags Key=env,Value=auto-scaling Key=role,Value=backend ; <span class="hljs-keyword"><span class="hljs-keyword">done</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> &lt;haproxy_instance_ids&gt;; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> \ aws --profile &lt;aws_cli_profile&gt; --endpoint-url <span class="hljs-variable"><span class="hljs-variable">$EC2_URL</span></span> \ ec2 create-tags --resources <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$i</span></span></span><span class="hljs-string">"</span></span> \ --tags Key=env,Value=auto-scaling Key=role,Value=haproxy; <span class="hljs-keyword"><span class="hljs-keyword">done</span></span>;</code> </pre> <br><p>  Onde: </p><br><p>  --resources - uma lista de identificadores de recursos nos quais as tags ser√£o definidas. </p><br><p>  --tags √© uma lista de pares de valores-chave. </p></div></div><br><p>  Um exemplo de descri√ß√£o de tags est√° dispon√≠vel na <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">documenta√ß√£o</a> do CROC Cloud. </p><br><h3 id="nastroyka-avtoskeylinga">  Configura√ß√£o de dimensionamento autom√°tico </h3><br><p>  Agora que a nuvem est√° monitorando e sabemos como trabalhar com tags, s√≥ podemos pesquisar o estado dos alarmes configurados para o acionamento.  Aqui precisamos de uma entidade que participe do monitoramento peri√≥dico de monitoramento e inicie tarefas para criar / excluir inst√¢ncias.  V√°rias ferramentas de automa√ß√£o podem ser aplicadas aqui.  Vamos usar o AWX.  O AWX √© uma vers√£o de c√≥digo aberto da <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Ansible Tower</a> comercial, um produto para gerenciar centralmente a infraestrutura da Ansible.  A principal tarefa √© lan√ßar periodicamente nosso manual de instru√ß√µes. </p><br><p>  Um exemplo de implanta√ß√£o do AWX est√° dispon√≠vel na p√°gina <a href="">wiki</a> no reposit√≥rio oficial.  A configura√ß√£o do AWX tamb√©m √© descrita na documenta√ß√£o da Ansible Tower.  Para que o AWX comece a executar playbooks personalizados, voc√™ deve configur√°-lo criando as seguintes entidades: </p><br><ul><li>  Segredos de tr√™s tipos: <br>  <em>- Credenciais da AWS - para autorizar opera√ß√µes relacionadas √† nuvem CROC.</em> <em><br></em>  - Credenciais da m√°quina - chaves ssh para acessar inst√¢ncias rec√©m-criadas. <br>  - Credenciais SCM - para autoriza√ß√£o no sistema de controle de vers√£o. </li><li>  Projeto √© uma entidade que enviar√° o reposit√≥rio git do manual. </li><li>  Scripts - script de invent√°rio din√¢mico para ansible. </li><li>  Invent√°rio √© uma entidade que chamar√° o script de invent√°rio din√¢mico antes de iniciar o manual. </li><li>  Modelo - a configura√ß√£o de uma chamada espec√≠fica do manual, consiste em um conjunto de credenciais, invent√°rio e manual do Project. </li><li>  Fluxo de trabalho - uma sequ√™ncia de chamadas para playbooks. </li></ul><br><p>  O processo de dimensionamento autom√°tico pode ser dividido em duas partes: </p><br><ul><li>  scale_up - cria uma inst√¢ncia quando pelo menos um alarme alto √© acionado; </li><li>  scale_down - finaliza√ß√£o de uma inst√¢ncia se um alarme baixo funcionar para isso. </li></ul><br><p>  Dentro do escopo da parte scale_up, voc√™ precisar√° de: </p><br><ul><li>  Interrogar o servi√ßo de monitoramento em nuvem sobre a presen√ßa de alarmes altos no estado "Alarme"; </li><li>  pare scale_up antes do previsto se todos os alarmes altos estiverem no estado "OK"; </li><li>  crie uma nova inst√¢ncia com os atributos necess√°rios (tag, sub-rede, security_group, etc.); </li><li>  crie alarmes altos e baixos para uma inst√¢ncia em execu√ß√£o; </li><li>  configure nosso aplicativo dentro de uma nova inst√¢ncia (no nosso caso, ser√° apenas nginx com uma p√°gina de teste); </li><li>  atualize a configura√ß√£o haproxy, fa√ßa um recarregamento para que os pedidos comecem a ir para a nova inst√¢ncia. </li></ul><br><div class="spoiler">  <b class="spoiler_title">create-instance.yaml</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">--- - name: get alarm statuses describe_alarms: region: "croc" alarm_name_prefix: "scaling-high" alarm_state: "alarm" register: describe_alarms_query - name: stop if no alarms fired fail: msg: zero high alarms in alarm state when: describe_alarms_query.meta | length == 0 - name: create instance ec2: region: "croc" wait: yes state: present count: 1 key_name: "{{ hostvars[groups['tag_role_backend'][0]].ec2_key_name }}" instance_type: "{{ hostvars[groups['tag_role_backend'][0]].ec2_instance_type }}" image: "{{ hostvars[groups['tag_role_backend'][0]].ec2_image_id }}" group_id: "{{ hostvars[groups['tag_role_backend'][0]].ec2_security_group_ids }}" vpc_subnet_id: "{{ hostvars[groups['tag_role_backend'][0]].ec2_subnet_id }}" user_data: | #!/bin/sh sudo yum install epel-release -y sudo yum install nginx -y cat &lt;&lt;EOF &gt; /etc/nginx/conf.d/dummy.conf server { listen 8080; location / { return 200 '{"message": "$HOSTNAME is up"}'; } } EOF sudo systemctl restart nginx loop: "{{ hostvars[groups['tag_role_backend'][0]] }}" register: new - name: create tag entry ec2_tag: ec2_url: "https://api.cloud.croc.ru" region: croc state: present resource: "{{ item.id }}" tags: role: backend loop: "{{ new.instances }}" - name: create low alarms ec2_metric_alarm: state: present region: croc name: "scaling-low_{ item.id }}" metric: "CPUUtilization" namespace: "AWS/EC2" statistic: Average comparison: "&lt;=" threshold: 15 period: 300 evaluation_periods: 3 unit: "Percent" dimensions: {'InstanceId':"{{ item.id }}"} loop: "{{ new.instances }}" - name: create high alarms ec2_metric_alarm: state: present region: croc name: "scaling-high_{{ item.id }}" metric: "CPUUtilization" namespace: "AWS/EC2" statistic: Average comparison: "&gt;=" threshold: 80.0 period: 300 evaluation_periods: 3 unit: "Percent" dimensions: {'InstanceId':"{{ item.id }}"} loop: "{{ new.instances }}"</code> </pre> </div></div><br><p>  No create-instance.yaml, o que acontece √©: criar uma inst√¢ncia com os par√¢metros corretos, marcar essa inst√¢ncia e criar os alarmes necess√°rios.  O script de instala√ß√£o e configura√ß√£o do nginx tamb√©m √© passado pelos dados do usu√°rio.  Os dados do usu√°rio s√£o processados ‚Äã‚Äãpelo servi√ßo cloud-init, que permite a configura√ß√£o flex√≠vel da inst√¢ncia durante a inicializa√ß√£o sem recorrer a outras ferramentas de automa√ß√£o. </p><br><p>  No update-lb.yaml, o arquivo /etc/haproxy/haproxy.cfg √© recriado na inst√¢ncia haproxy e no servi√ßo de recarga haproxy: </p><br><div class="spoiler">  <b class="spoiler_title">update-lb.yaml</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">- name: update haproxy configs template: src: haproxy.cfg.j2 dest: /etc/haproxy/haproxy.cfg - name: add new backend host to haproxy systemd: name: haproxy state: restarted</code> </pre> </div></div><br><p>  Onde haproxy.cfg.j2 √© o modelo de arquivo de configura√ß√£o do servi√ßo haproxy: </p><br><div class="spoiler">  <b class="spoiler_title">haproxy.cfg.j2</b> <div class="spoiler_text"><pre> <code class="plaintext hljs"># {{ ansible_managed }} global log /dev/log local0 log /dev/log local1 notice chroot /var/lib/haproxy stats timeout 30s user haproxy group haproxy daemon defaults log global mode http option httplog option dontlognull timeout connect 5000 timeout client 50000 timeout server 50000 frontend loadbalancing bind *:80 mode http default_backend backendnodes backend backendnodes balance roundrobin option httpchk HEAD / {% for host in groups['tag_role_backend'] %} server {{hostvars[host]['ec2_id']}} {{hostvars[host]['ec2_private_ip_address']}}:8080 check {% endfor %}</code> </pre> </div></div><br><p>  Como a op√ß√£o httpchk est√° definida na se√ß√£o de back-end da configura√ß√£o do haproxy, o servi√ßo haproxy pesquisar√° independentemente os estados das inst√¢ncias de back-end e equilibrar√° o tr√°fego apenas entre verifica√ß√µes de integridade anteriores. </p><br><p>  Na parte scale_down voc√™ precisa: </p><br><ul><li>  verifique o estado de alarme baixo; </li><li>  encerre prematuramente a reprodu√ß√£o se n√£o houver alarmes baixos no estado "Alarme"; </li><li>  encerre todas as inst√¢ncias para as quais o alarme baixo esteja na classe Alarme; </li><li>  proibir a finaliza√ß√£o do √∫ltimo par de inst√¢ncias, mesmo que seus alarmes estejam no estado Alarme; </li><li>  remova as inst√¢ncias que removemos da configura√ß√£o do balanceador de carga. </li></ul><br><div class="spoiler">  <b class="spoiler_title">destroy-instance.yaml</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">- name: look for alarm status describe_alarms: region: "croc" alarm_name_prefix: "scaling-low" alarm_state: "alarm" register: describe_alarms_query - name: count alarmed instances set_fact: alarmed_count: "{{ describe_alarms_query.meta | length }}" alarmed_ids: "{{ describe_alarms_query.meta }}" - name: stop if no alarms fail: msg: no alarms fired when: alarmed_count | int == 0 - name: count all described instances set_fact: all_count: "{{ groups['tag_role_backend'] | length }}" - name: fail if last two instance remaining fail: msg: cant destroy last two instances when: all_count | int == 2 - name: destroy tags for marked instances ec2_tag: ec2_url: "https://api.cloud.croc.ru" region: croc resource: "{{ alarmed_ids[0].split('_')[1] }}" state: absent tags: role: backend - name: destroy instances ec2: region: croc state: absent instance_ids: "{{ alarmed_ids[0].split('_')[1] }}" - name: destroy low alarms ec2_metric_alarm: state: absent region: croc name: "scaling-low_{{ alarmed_ids[0].split('_')[1] }}" - name: destroy high alarms ec2_metric_alarm: state: absent region: croc name: "scaling-high_{{ alarmed_ids[0].split('_')[1] }}"</code> </pre> </div></div><br><p>  Em destroy-instance.yaml, os alarmes s√£o exclu√≠dos, a inst√¢ncia e sua tag s√£o encerradas e as condi√ß√µes que pro√≠bem o encerramento de inst√¢ncias recentes s√£o verificadas. </p><br><p>  Exclu√≠mos explicitamente as tags ap√≥s excluir inst√¢ncias devido ao fato de que, ap√≥s a exclus√£o de uma inst√¢ncia, as tags associadas a ela s√£o exclu√≠das adiadas e ficam dispon√≠veis por mais um minuto. <br>  AWX </p><br><h3 id="nastroyka-zadach-shablonov">  Definindo tarefas, modelos </h3><br><p>  O seguinte conjunto de tarefas criar√° as entidades necess√°rias no AWX: </p><br><div class="spoiler">  <b class="spoiler_title">awx-configure.yaml</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">--- - name: Create tower organization tower_organization: name: "scaling-org" description: "scaling-org organization" state: present - name: Add tower cloud credential tower_credential: name: cloud description: croc cloud api creds organization: scaling-org kind: aws state: present username: "{{ croc_user }}" password: "{{ croc_password }}" - name: Add tower github credential tower_credential: name: ghe organization: scaling-org kind: scm state: present username: "{{ ghe_user }}" password: "{{ ghe_password }}" - name: Add tower ssh credential tower_credential: name: ssh description: ssh creds organization: scaling-org kind: ssh state: present username: "ec2-user" ssh_key_data: "{{ lookup('file', 'private.key') }}" - name: Add tower project tower_project: name: "auto-scaling" scm_type: git scm_credential: ghe scm_url: &lt;repo-name&gt; organization: "scaling-org" scm_branch: master state: present - name: create inventory tower_inventory: name: dynamic-inventory organization: "scaling-org" state: present - name: copy inventory script to awx copy: src: "{{ role_path }}/files/ec2.py" dest: /root/ec2.py - name: create inventory source shell: | export SCRIPT=$(tower-cli inventory_script create -n "ec2-script" --organization "scaling-org" --script @/root/ec2.py | grep ec2 | awk '{print $1}') tower-cli inventory_source create --update-on-launch True --credential cloud --source custom --inventory dynamic-inventory -n "ec2-source" --source-script $SCRIPT --source-vars '{"EC2_URL":"api.cloud.croc.ru","AWS_REGION": "croc"}' --overwrite True - name: Create create-instance template tower_job_template: name: "create-instance" job_type: "run" inventory: "dynamic-inventory" credential: "cloud" project: "auto-scaling" playbook: "create-instance.yaml" state: "present" register: create_instance - name: Create update-lb template tower_job_template: name: "update-lb" job_type: "run" inventory: "dynamic-inventory" credential: "ssh" project: "auto-scaling" playbook: "update-lb.yaml" credential: "ssh" state: "present" register: update_lb - name: Create destroy-instance template tower_job_template: name: "destroy-instance" job_type: "run" inventory: "dynamic-inventory" project: "auto-scaling" credential: "cloud" playbook: "destroy-instance.yaml" credential: "ssh" state: "present" register: destroy_instance - name: create workflow tower_workflow_template: name: auto_scaling organization: scaling-org schema: "{{ lookup('template', 'schema.j2')}}" - name: set scheduling shell: | tower-cli schedule create -n "3min" --workflow "auto_scaling" --rrule "DTSTART:$(date +%Y%m%dT%H%M%SZ) RRULE:FREQ=MINUTELY;INTERVAL=3"</code> </pre> </div></div><br><p>  O snippet anterior criar√° um modelo para cada um dos playbooks ansible usados.  Cada modelo configura o lan√ßamento de um manual com um conjunto de credenciais e invent√°rio definidos. </p><br><p>  Criar um canal para chamadas para playbooks permitir√° o modelo de fluxo de trabalho.  A configura√ß√£o do fluxo de trabalho para dimensionamento autom√°tico √© apresentada abaixo: </p><br><div class="spoiler">  <b class="spoiler_title">schema.j2</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">- failure_nodes: - id: 101 job_template: {{ destroy_instance.id }} success_nodes: - id: 102 job_template: {{ update_lb.id }} id: 103 job_template: {{ create_instance.id }} success_nodes: - id: 104 job_template: {{ update_lb.id }}</code> </pre> </div></div><br><p>  O modelo anterior mostra o diagrama do fluxo de trabalho, ou seja,  sequ√™ncia de execu√ß√£o do modelo.  Neste fluxo de trabalho, cada pr√≥xima etapa (success_nodes) ser√° executada apenas se a anterior for conclu√≠da com √™xito.  Uma representa√ß√£o gr√°fica do fluxo de trabalho √© mostrada na figura: <br><img src="https://habrastorage.org/webt/po/l-/vb/pol-vbfpulv4hoimk99mvbtig-u.png" alt="fluxo de trabalho"></p><br><p>  Como resultado, foi criado um fluxo de trabalho generalizado que executa o manual de cria√ß√£o de inst√¢ncias e, dependendo do status de execu√ß√£o, os manuais de inst√¢ncia de destrui√ß√£o e / ou atualiza√ß√£o-lb.  O fluxo de trabalho integrado √© conveniente para executar em um determinado agendamento.  O processo de dimensionamento autom√°tico ser√° iniciado a cada tr√™s minutos, iniciando e encerrando inst√¢ncias, dependendo do estado do alarme. </p><br><h3 id="testirovanie-raboty">  Teste de trabalho </h3><br><p>  Agora verifique a opera√ß√£o do sistema configurado.  Primeiro, instale o utilit√°rio wrk para compara√ß√µes http. </p><br><div class="spoiler">  <b class="spoiler_title">instala√ß√£o do wrk</b> <div class="spoiler_text"><pre> <code class="bash hljs">ssh -A ec2-user@&lt;aws_instance_ip&gt; sudo su - <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /opt yum groupinstall <span class="hljs-string"><span class="hljs-string">'Development Tools'</span></span> yum install -y openssl-devel git git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/wg/wrk.git wrk <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> wrk make install wrk /usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/bin <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span></code> </pre> </div></div><br><p>  Usaremos o monitoramento em nuvem para monitorar o uso dos recursos da inst√¢ncia durante o carregamento: </p><br><div class="spoiler">  <b class="spoiler_title">monitoramento</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">function CPUUtilizationMonitoring() { local AWS_CLI_PROFILE="&lt;aws_cli_profile&gt;" local CLOUDWATCH_URL="https://monitoring.cloud.croc.ru" local API_URL="https://api.cloud.croc.ru" local STATS="" local ALARM_STATUS="" local IDS=$(aws --profile $AWS_CLI_PROFILE --endpoint-url $API_URL ec2 describe-instances --filter Name=tag:role,Values=backend | grep -i instanceid | grep -oE 'i-[a-zA-Z0-9]*' | tr '\n' ' ') for instance_id in $IDS; do STATS="$STATS$(aws --profile $AWS_CLI_PROFILE --endpoint-url $CLOUDWATCH_URL cloudwatch get-metric-statistics --dimensions Name=InstanceId,Value=$instance_id --namespace "AWS/EC2" --metric CPUUtilization --end-time $(date --iso-8601=minutes) --start-time $(date -d "$(date --iso-8601=minutes) - 1 min" --iso-8601=minutes) --period 60 --statistics Average | grep -i average)"; ALARMS_STATUS="$ALARMS_STATUS$(aws --profile $AWS_CLI_PROFILE --endpoint-url $CLOUDWATCH_URL cloudwatch describe-alarms --alarm-names scaling-high-$instance_id | grep -i statevalue)" done echo $STATS | column -s ',' -o '|' -N $(echo $IDS | tr ' ' ',') -t echo $ALARMS_STATUS | column -s ',' -o '|' -N $(echo $IDS | tr ' ' ',') -t } export -f CPUUtilizationMonitoring watch -n 60 bash -c CPUUtilizationMonitoring</code> </pre> </div></div><br><p>  O script anterior, uma vez a cada 60 segundos, obt√©m informa√ß√µes sobre o valor m√©dio da m√©trica CPUUtilization do √∫ltimo minuto e consulta o status dos alarmes para inst√¢ncias de back-end. </p><br><p>  Agora voc√™ pode executar o wrk e verificar a utiliza√ß√£o dos recursos das inst√¢ncias de back-end sob carga: </p><br><div class="spoiler">  <b class="spoiler_title">wrk run</b> <div class="spoiler_text"><pre> <code class="bash hljs">ssh -A ec2-user@&lt;awx_instance_ip&gt; wrk -t12 -c100 -d500s http://&lt;haproxy_instance_id&gt; <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span></code> </pre> </div></div><br><p>  O √∫ltimo comando iniciar√° o benchmark por 500 segundos, usando 12 threads e abrindo 100 conex√µes http. </p><br><p>  Com o tempo, o script de monitoramento deve mostrar que, durante o benchmark, o valor estat√≠stico da m√©trica CPUUtilization aumenta at√© atingir 300%.  180 segundos ap√≥s o in√≠cio do benchmark, o sinalizador StateValue deve mudar para o estado de alarme.  A cada dois minutos, o fluxo de trabalho de dimensionamento autom√°tico √© iniciado.  Por padr√£o, a execu√ß√£o paralela do mesmo fluxo de trabalho √© proibida.  Ou seja, a cada dois minutos, uma tarefa para executar um fluxo de trabalho ser√° adicionada √† fila e ser√° iniciada somente ap√≥s a conclus√£o do anterior.  Portanto, durante o trabalho do wrk, haver√° um aumento constante nos recursos at√© que os altos alarmes de todas as inst√¢ncias de back-end entrem no estado OK.  Ap√≥s a conclus√£o, o fluxo de trabalho wrk scale_down finaliza todas as inst√¢ncias, exceto duas. </p><br><p>  Exemplo de sa√≠da de um script de monitoramento: </p><br><div class="spoiler">  <b class="spoiler_title">resultados de monitoramento</b> <div class="spoiler_text"><pre> <code class="plaintext hljs"># start test i-43477460 |i-AC5D9EE0 "Average": 0.0 | "Average": 0.0 i-43477460 |i-AC5D9EE0 "StateValue": "ok"| "StateValue": "ok" # start http load i-43477460 |i-AC5D9EE0 "Average": 267.0 | "Average": 111.0 i-43477460 |i-AC5D9EE0 "StateValue": "ok"| "StateValue": "ok" # alarm state i-43477460 |i-AC5D9EE0 "Average": 267.0 | "Average": 282.0 i-43477460 |i-AC5D9EE0 "StateValue": "alarm"| "StateValue": "alarm" # two new instances created i-1E399860 |i-F307FB00 |i-43477460 |i-AC5D9EE0 "Average": 185.0 | "Average": 215.0 | "Average": 245.0 | i-1E399860 |i-F307FB00 |i-43477460 |i-AC5D9EE0 "StateValue": "insufficient_data"| "StateValue": "insufficient_data"| "StateValue": "alarm"| "StateValue": "alarm" # only two instances left after load has been stopped i-935BAB40 |i-AC5D9EE0 "Average": 0.0 | "Average": 0.0 i-935BAB40 |i-AC5D9EE0 "StateValue": "ok"| "StateValue": "ok"</code> </pre> </div></div><br><p>  Tamb√©m na CROC Cloud, √© poss√≠vel visualizar os gr√°ficos usados ‚Äã‚Äãna postagem de monitoramento na p√°gina da inst√¢ncia na guia correspondente. </p><br><p>  Exibir alarmes est√° dispon√≠vel na p√°gina de monitoramento na guia Alarmes. </p><br><h3 id="zaklyuchenie">  Conclus√£o </h3><br><p>  O dimensionamento autom√°tico √© um cen√°rio bastante popular, mas, infelizmente, ainda n√£o est√° em nossa nuvem (mas apenas por enquanto).  No entanto, temos muitas APIs poderosas para fazer coisas semelhantes e muitas outras coisas, usando ferramentas populares, quase padr√£o, como Terraform, ansible, aws-cli e outras. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt456826/">https://habr.com/ru/post/pt456826/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt456812/index.html">O que h√° na Universidade ITMO - festivais de TI, hackers, confer√™ncias e semin√°rios abertos</a></li>
<li><a href="../pt456814/index.html">Aprenda programa√ß√£o funcional em Python em 10 minutos</a></li>
<li><a href="../pt456818/index.html">O administrador do sistema em uma empresa inacess√≠vel. O fardo insuport√°vel do ser?</a></li>
<li><a href="../pt456820/index.html">Argila ‚Üí Tijolo ‚Üí Fog√£o</a></li>
<li><a href="../pt456824/index.html">O que √© probabilidade e como calcul√°-lo</a></li>
<li><a href="../pt456828/index.html">Vias de ajuste para placas de circuito impresso</a></li>
<li><a href="../pt456830/index.html">Vivaldi 2.6 - Divers√£o de Ver√£o</a></li>
<li><a href="../pt456838/index.html">Introdu√ß√£o √† pontua√ß√£o do ICE para prioriza√ß√£o de recursos do produto</a></li>
<li><a href="../pt456840/index.html">Li√ß√µes do SDL 2: Li√ß√£o 6 - Primitivas</a></li>
<li><a href="../pt456842/index.html">Emulador PS2 / PSP + streaming de jogo (YouTube, Facebook, Twitch) = nova vers√£o do Omega Red</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>