<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩‍👩‍👧 📤 🏑 JVM内部，第1部分-类加载器 🔸 🔝 🔸</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="本文的翻译是专门为Java Developer课程的学生准备的。 



 在本系列文章中，我将讨论Java虚拟机的工作方式。 今天，我们来看一下在JVM中加载类的机制。 

 Java虚拟机是Java技术生态系统的核心。 Java程序可以实现“编写一次到处运行”的原则。 与其他虚拟机一样，JVM是...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>JVM内部，第1部分-类加载器</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/468193/">  <i>本文的翻译是专门为<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Java Developer</a>课程的学生准备的。</i> <br><br><img src="https://habrastorage.org/webt/77/f2/h9/77f2h9u5_t1kz85hy6tnqkhak8k.png"><br><hr><br> 在本系列文章中，我将讨论Java虚拟机的工作方式。 今天，我们来看一下在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">JVM中</a>加载类的机制。 <a name="habracut"></a><br><br>  Java虚拟机是Java技术生态系统的核心。  Java程序可以实现“编写一次到处运行”的原则。 与其他虚拟机一样，JVM是抽象计算机。  JVM的主要任务是加载<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">类文件</a>并执行其中包含的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">字节码</a> 。 <br><br>  JVM包括各种组件，例如<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">类加载器</a> ， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">垃圾收集器</a> （自动内存管理），解释器， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">JIT</a>编译器和流控制组件。 在本文中，我们将研究类加载器。 <br><br> 类加载器为您的应用程序和Java API加载类文件。 仅将运行程序时真正需要的Java API类文件加载到虚拟机中。 <br><br> 字节码由执行引擎执行。 <br><br><img src="https://habrastorage.org/webt/eu/ju/xj/eujuxjvw92kl2ul2uoydeyioici.jpeg"><br><br><h3> 什么是类加载？ </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">类加载</a>是在程序执行期间动态搜索和加载类型（类和接口）。 类型数据在二进制类文件中。 <br><br><h3> 类加载步骤 </h3><br> 类加载器子系统不仅负责查找和导入二进制类数据。 它还对导入的类执行验证，为类变量分配和初始化内存，并帮助解析符号链接。 这些操作按以下顺序执行： <br><br><ul><li>  <b>加载</b> -按名称搜索和导入类型的二进制数据，然后根据此二进制表示形式创建类或接口。 </li><li>  <b>链接（链接）</b> -验证，准备和许可（可选）： <br><ul><li>  <b>验证</b> -验证导入类型的正确性。 </li><li>  <b>准备工作</b> —为静态类变量分配内存，并使用默认值初始化内存。 </li><li>  <b>解决方案</b> -将符号类型链接转换为直接链接。 </li></ul></li><li>  <b>初始化</b>是对Java代码的调用，该代码使用正确的初始值初始化类变量。 </li></ul><br><blockquote> 注意-除了加载类，类加载器还负责查找资源。 资源是某些数据（例如，“。class”文件，配置数据，图像），这些数据使用由“ /”字符分隔的抽象路径来标识。 资源通常与应用程序或库打包在一起，以便可以在应用程序或库代码中使用它们。 </blockquote><h3>  Java中的类加载机制 </h3><br>  <i>译者注-本节描述了Java &lt;9的行为，在Java 9+中进行了一些小的更改，下面对此进行了描述。</i> <br><br>  Java使用类加载委托模型。 基本思想是每个类加载器都有一个“父”加载器。  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">加载类时</a> ，加载器在单独搜索该类之前将其搜索“委派”给其父级。 <br><br> 类加载器委托模型是将加载请求彼此传递的加载器图。 该图的根是引导引导程序。 类加载器是由一个父级创建的，可以将它们委托给其父级，并在以下位置搜索类： <br><br><ul><li> 快取 </li><li> 父母 </li><li> 引导加载程序本身 </li></ul><br> 类加载器首先检查是否之前已经加载了该类。 如果是这样，则返回上次返回的相同类（存储在缓存中的类）。 如果没有，父级将有机会加载该类。 递归地重复这两个步骤。 如果父级返回null（或引发<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ClassNotFoundException</a> ），则加载器将自行搜索该类。 <br><br> 该类由最接近根的加载器加载，因为首次加载该类的权利始终授予父加载器。 这使加载程序只能查看其父级或祖先独立加载的类。 它看不到子加载器加载的类。 <br><br>  Java SE Platform API历史上定义了两个类加载器： <br><br>  <b>Bootstrap类加载器（基本，主加载器）</b> -从引导类路径加载类。 <br><br>  <b>系统类加载器（</b>父<b>加载器）</b> -新类加载<b>器</b>的父类，通常是用于加载和运行应用程序的类加载器。 <br><br><h3>  JDK 9+类加载器 </h3><br>  <b>应用程序类加载器</b> -通常用于从类路径加载应用程序类。 对于某些包含实用程序或导出实用程序API的JDK模块，它也是默认的引导加载程序。  （ <i>译者注：例如<code>jdk.jconsole</code> ， <code>jdk.jshell</code>等。</i> ） <br><br>  <b>平台类加载器</b> -加载选定的（基于安全性/权限）Java SE和JDK模块。 例如，java.sql。 <br><br>  <b>Bootstrap类加载器</b> -加载核心Java SE和JDK模块。 <br><br> 这三个内置类加载器可以按以下方式协同工作： <br><br><ul><li>  <i>应用程序类加载器</i>首先查找为所有内置<i>加载器</i>定义的命名模块。 如果为这些加载程序之一定义了合适的模块，则此加载程序将加载该类。 如果在为这些加载程序之一定义的命名模块中找不到该类，则应用程序类加载程序会将其委托给父级。 如果父类未找到该类，则应用程序类加载器会在类路径中查找它。 在类路径中找到的类将作为此加载器的未命名模块的成员加载。 </li><li>  <i>平台类加载器</i>搜索为所有内置<i>加载器</i>定义的命名模块。 如果为这些加载程序之一定义了合适的模块，则此加载程序将加载该类。 如果在为这些加载程序之一定义的命名模块中找不到该类，则平台类加载程序将其委托给父级。 </li><li>  <i>引导类加载器</i>搜索为其定义的命名模块。 如果在为引导程序引导程序定义的命名模块中找不到该类，则引导程序引导程序使用-Xbootclasspath /参数搜索添加到引导程序路径的文件和目录（允许您将文件和目录添加到引导程序路径）。 在引导程序类路径中找到的类将作为此加载器的未命名模块的成员加载。 </li></ul><br> 要查看内置的类加载器，可以使用以下代码： <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> ru.deft.homework; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.sql.Date; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BuiltInClassLoadersDemo</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ BuiltInClassLoadersDemo demoObject = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BuiltInClassLoadersDemo(); ClassLoader applicationClassLoader = demoObject.getClass().getClassLoader(); printClassLoaderDetails(applicationClassLoader); <span class="hljs-comment"><span class="hljs-comment">// java.sql classes are loaded by platform classloader java.sql.Date now = new Date(System.currentTimeMillis()); ClassLoader platformClassLoder = now.getClass().getClassLoader(); printClassLoaderDetails(platformClassLoder); // java.lang classes are loaded by bootstrap classloader ClassLoader bootstrapClassLoder = args.getClass().getClassLoader(); printClassLoaderDetails(bootstrapClassLoder); } private static void printClassLoaderDetails(ClassLoader classLoader) { // bootstrap classloader is represented by null in JVM if (classLoader != null) { System.out.println("ClassLoader name : " + classLoader.getName()); System.out.println("ClassLoader class : " + classLoader.getClass().getName()); } else { System.out.println("Bootstrap classloader"); } } }</span></span></code> </pre> <br> 通过在我安装的Amazon Corretto 11.0.3上运行此代码，我们得到以下结果： <br><br><pre> <code class="java hljs">ClassLoader name : app ClassLoader <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">jdk</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">internal</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">loader</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ClassLoaders</span></span></span><span class="hljs-class">$</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AppClassLoader</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ClassLoader</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">name</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">platform</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ClassLoader</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">jdk</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">internal</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">loader</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ClassLoaders</span></span></span><span class="hljs-class">$</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PlatformClassLoader</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Bootstrap</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">classloader</span></span></span></span></code> </pre> <br> 您可以<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">在此处（JDK 11）</a>了解更多有关ClassLoader API的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">信息</a> 。 </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN468193/">https://habr.com/ru/post/zh-CN468193/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN468179/index.html">分析：俄罗斯证券市场的基础设施如何运作</a></li>
<li><a href="../zh-CN468181/index.html">沉默的三位一体：探索后开发框架的新版本</a></li>
<li><a href="../zh-CN468185/index.html">AWS EC2服务并与其一起使用</a></li>
<li><a href="../zh-CN468189/index.html">使用控制台技巧提高JavaScript调试技能</a></li>
<li><a href="../zh-CN468191/index.html">RubyRussia 2019：Nikolay Sverchkov关于无服务器</a></li>
<li><a href="../zh-CN468195/index.html">为什么我的财务依赖Beeline？</a></li>
<li><a href="../zh-CN468197/index.html">我们如何进行大型传统网络的自动化</a></li>
<li><a href="../zh-CN468203/index.html">寻求完美机会的谜语</a></li>
<li><a href="../zh-CN468205/index.html">内部GIT：简介（翻译）</a></li>
<li><a href="../zh-CN468207/index.html">我们如何更新Zabbix</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>