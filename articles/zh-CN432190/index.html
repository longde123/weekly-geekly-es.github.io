<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸŒ âœŒğŸ½ ğŸ™ˆ Unityä¸­çš„å®¢æˆ·ç«¯ç‰©ç†é¢„æµ‹ ğŸ§€ ğŸ³ ğŸ‘©ğŸ¼â€ğŸ¤â€ğŸ‘¨ğŸ½</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="TL; DR 
 æˆ‘åˆ›å»ºäº†ä¸€ä¸ªæ¼”ç¤ºï¼Œæ¼”ç¤ºå¦‚ä½•åœ¨Unity- GitHubä¸­å®ç°ç©å®¶å¯¹ç©å®¶èº«ä½“è¿åŠ¨çš„å®¢æˆ·ç«¯é¢„æµ‹ã€‚ 

 å¼•è¨€ 
 2012å¹´åˆï¼Œæˆ‘å†™äº†ä¸€ç¯‡å…³äºUnityç©å®¶èº«ä½“è¿åŠ¨çš„å®¢æˆ·ç«¯å¦‚ä½•å®ç°é¢„æµ‹çš„æ–‡ç« ã€‚ æ„Ÿè°¢Physics.Simulateï¼ˆï¼‰ï¼Œä¸å†éœ€è¦æˆ‘æè¿°çš„ç¬¨æ‹™çš„è§£å†³æ–¹æ³•ã€‚ æ—§å¸–å­ä»ç„¶æ˜¯æˆ‘åš...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Unityä¸­çš„å®¢æˆ·ç«¯ç‰©ç†é¢„æµ‹</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/432190/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a59/4f5/561/a594f5561a9452567464c512df8171e5.jpg" alt="å›¾ç‰‡"></div><br><h3>  TL; DR </h3><br> æˆ‘åˆ›å»ºäº†ä¸€ä¸ªæ¼”ç¤ºï¼Œæ¼”ç¤ºå¦‚ä½•åœ¨Unity- <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">GitHub</a>ä¸­å®ç°ç©å®¶å¯¹ç©å®¶èº«ä½“è¿åŠ¨çš„å®¢æˆ·ç«¯é¢„æµ‹ã€‚ <br><br><h3> å¼•è¨€ </h3><br>  2012å¹´åˆï¼Œæˆ‘å†™äº†ä¸€ç¯‡å…³äºUnityç©å®¶èº«ä½“è¿åŠ¨çš„å®¢æˆ·ç«¯å¦‚ä½•å®ç°é¢„æµ‹çš„æ–‡ç« ã€‚ æ„Ÿè°¢<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Physics.Simulateï¼ˆï¼‰ï¼Œ</a>ä¸å†éœ€è¦æˆ‘æè¿°çš„ç¬¨æ‹™çš„è§£å†³æ–¹æ³•ã€‚ æ—§å¸–å­ä»ç„¶æ˜¯æˆ‘åšå®¢ä¸Šæœ€å—æ¬¢è¿çš„å¸–å­ä¹‹ä¸€ï¼Œä½†æ˜¯å¯¹äºç°ä»£Unityè€Œè¨€ï¼Œæ­¤ä¿¡æ¯å·²ä¸æ­£ç¡®ã€‚ å› æ­¤ï¼Œæˆ‘è¦å‘å¸ƒ2018ç‰ˆæœ¬ã€‚ <br><br><h3> å®¢æˆ·ç«¯æ˜¯ä»€ä¹ˆï¼Ÿ </h3><br> åœ¨ç«äº‰æ€§å¤šäººæ¸¸æˆä¸­ï¼Œåº”å°½å¯èƒ½é¿å…ä½œå¼Šã€‚ é€šå¸¸ï¼Œè¿™æ„å‘³ç€ä½¿ç”¨å¸¦æœ‰ä¸“åˆ¶æœåŠ¡å™¨çš„ç½‘ç»œæ¨¡å‹ï¼šå®¢æˆ·ç«¯å°†è¾“å…¥çš„ä¿¡æ¯å‘é€åˆ°æœåŠ¡å™¨ï¼Œç„¶åæœåŠ¡å™¨å°†è¯¥ä¿¡æ¯è½¬æ¢ä¸ºç©å®¶çš„åŠ¨ä½œï¼Œç„¶åå°†ç©å®¶çš„çŠ¶æ€å¿«ç…§å‘é€ç»™å®¢æˆ·ç«¯ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒæŒ‰é”®å’Œæ˜¾ç¤ºç»“æœä¹‹é—´ä¼šæœ‰å»¶è¿Ÿï¼Œè¿™å¯¹äºä»»ä½•æ´»åŠ¨çš„æ¸¸æˆéƒ½æ˜¯ä¸å¯æ¥å—çš„ã€‚ åœ¨å®¢æˆ·ç«¯è¿›è¡Œé¢„æµ‹æ˜¯ä¸€ç§éå¸¸æµè¡Œçš„æŠ€æœ¯ï¼Œå®ƒå¯ä»¥éšè—å»¶è¿Ÿï¼Œé¢„æµ‹æœ€ç»ˆäº§ç”Ÿçš„ç§»åŠ¨å¹¶å°†å…¶ç«‹å³æ˜¾ç¤ºç»™ç©å®¶ã€‚ å½“å®¢æˆ·ä»æœåŠ¡å™¨æ”¶åˆ°ç»“æœæ—¶ï¼Œä»–ä¼šå°†å…¶ä¸å®¢æˆ·é¢„æµ‹çš„ç»“æœè¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœç»“æœä¸åŒï¼Œåˆ™é¢„æµ‹æ˜¯é”™è¯¯çš„ï¼Œéœ€è¦è¿›è¡Œæ›´æ­£ã€‚ <br><a name="habracut"></a><br> ä»æœåŠ¡å™¨æ¥æ”¶åˆ°çš„å¿«ç…§æ€»æ˜¯ç›¸å¯¹äºå®¢æˆ·ç«¯çš„é¢„æµ‹çŠ¶æ€æ¥è‡ªè¿‡å»ï¼ˆä¾‹å¦‚ï¼Œå¦‚æœå°†æ•°æ®ä»å®¢æˆ·ç«¯ä¼ è¾“åˆ°æœåŠ¡å™¨å¹¶è¿”å›éœ€è¦150æ¯«ç§’ï¼Œåˆ™æ¯ä¸ªå¿«ç…§å°†è‡³å°‘å»¶è¿Ÿ150æ¯«ç§’ï¼‰ã€‚ ç»“æœï¼Œå½“å®¢æˆ·éœ€è¦çº æ­£é”™è¯¯çš„é¢„æµ‹æ—¶ï¼Œä»–å¿…é¡»å›æ»šåˆ°è¿‡å»çš„è¿™ä¸€ç‚¹ï¼Œç„¶åå†ç°åœ¨é—´éš™ä¸­è¾“å…¥çš„æ‰€æœ‰ä¿¡æ¯ä»¥è¿”å›åˆ°ä»–æ‰€åœ¨çš„ä½ç½®ã€‚ å¦‚æœç©å®¶åœ¨æ¸¸æˆä¸­çš„ç§»åŠ¨åŸºäºç‰©ç†åŸç†ï¼Œåˆ™éœ€è¦Physics.Simulateï¼ˆï¼‰æ¥åœ¨ä¸€å¸§ä¸­æ¨¡æ‹Ÿå¤šä¸ªå¾ªç¯ã€‚ å¦‚æœåœ¨ç§»åŠ¨æ’­æ”¾å™¨æ—¶ä»…ä½¿ç”¨è§’è‰²æ§åˆ¶å™¨ï¼ˆæˆ–èƒ¶å›Šé“¸ä»¶ç­‰ï¼‰ï¼Œåˆ™å¯ä»¥ä¸ç”¨Physics.Simulateï¼ˆï¼‰-å¹¶ä¸”æˆ‘è®¤ä¸ºæ€§èƒ½ä¼šæ›´å¥½ã€‚ <br><br> æˆ‘å°†ä½¿ç”¨Unityé‡æ–°åˆ›å»ºä¸€ä¸ªæˆ‘å¾ˆå–œæ¬¢çš„ç½‘ç»œæ¼”ç¤ºï¼Œè¯¥æ¼”ç¤ºæ˜¯<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">â€œ</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Glenn Fiedler</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">çš„ç½‘ç»œç‰©ç†å­¦ä¹‹ç¦…â€</a> ã€‚ ç©å®¶æ‹¥æœ‰ä¸€ä¸ªå¯ä»¥å‘å…¶æ–½åŠ åŠ›é‡çš„ç‰©ç†ç«‹æ–¹ä½“ï¼Œå°†å…¶æ¨å…¥åœºæ™¯ã€‚ è¯¥æ¼”ç¤ºæ¨¡æ‹Ÿäº†å„ç§ç½‘ç»œçŠ¶å†µï¼ŒåŒ…æ‹¬å»¶è¿Ÿå’Œä¸¢åŒ…ã€‚ <br><br><h3> å¼€å§‹å·¥ä½œ </h3><br> é¦–å…ˆè¦åšçš„æ˜¯å…³é—­è‡ªåŠ¨ç‰©ç†æ¨¡æ‹Ÿã€‚ å°½ç®¡Physics.Simulateï¼ˆï¼‰å…è®¸æˆ‘ä»¬å‘Šè¯‰ç‰©ç†ç³»ç»Ÿä½•æ—¶å¼€å§‹ä»¿çœŸï¼Œä½†æ˜¯é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒä¼šåŸºäºå›ºå®šçš„é¡¹ç›®æ—¶é—´å¢é‡è‡ªåŠ¨æ‰§è¡Œä»¿çœŸã€‚ å› æ­¤ï¼Œæˆ‘ä»¬å°†é€šè¿‡å–æ¶ˆé€‰ä¸­â€œ <strong>è‡ªåŠ¨æ¨¡æ‹Ÿ</strong> â€æ¡†ï¼Œåœ¨â€œ <strong>ç¼–è¾‘â€-&gt;â€œé¡¹ç›®è®¾ç½®â€-&gt;â€œç‰©ç†</strong> â€ä¸­å°†å…¶ç¦ç”¨ã€‚ <br><br> é¦–å…ˆï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªç®€å•çš„å•ç”¨æˆ·å®ç°ã€‚ è¾“å…¥è¢«é‡‡æ ·ï¼ˆwï¼Œaï¼Œsï¼Œdç”¨äºç§»åŠ¨ï¼Œç©ºé—´ç”¨äºè·³è·ƒï¼‰ï¼Œæ‰€æœ‰è¿™äº›éƒ½å½’ç»“ä¸ºä½¿ç”¨AddForceï¼ˆï¼‰æ–½åŠ åˆ°åˆšä½“çš„ç®€å•åŠ›ã€‚ <br><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Logic</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> GameObject player; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> timer; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.timer = <span class="hljs-number"><span class="hljs-number">0.0f</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Update</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.timer += Time.deltaTime; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.timer &gt;= Time.fixedDeltaTime) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.timer -= Time.fixedDeltaTime; Inputs inputs; inputs.up = Input.GetKey(KeyCode.W); inputs.down = Input.GetKey(KeyCode.S); inputs.left = Input.GetKey(KeyCode.A); inputs.right = Input.GetKey(KeyCode.D); inputs.jump = Input.GetKey(KeyCode.Space); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.AddForcesToPlayer(player.GetComponent&lt;Rigidbody&gt;(), inputs); Physics.Simulate(Time.fixedDeltaTime); } } }</code> </pre> <br><iframe width="560" height="315" src="https://www.youtube.com/embed/BbC-MQX08KE" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <i>ä¸ä½¿ç”¨ç½‘ç»œæ—¶æ’­æ”¾å™¨ç§»åŠ¨</i> <br><br><h3> å°†è¾“å…¥å‘é€åˆ°æœåŠ¡å™¨ </h3><br> ç°åœ¨æˆ‘ä»¬éœ€è¦å°†è¾“å…¥å‘é€åˆ°æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨è¿˜å°†æ‰§è¡Œæ­¤è¿åŠ¨ä»£ç ï¼Œåˆ¶ä½œå¤šç»´æ•°æ®é›†çŠ¶æ€çš„å¿«ç…§ï¼Œç„¶åå°†å…¶å‘é€å›å®¢æˆ·ç«¯ã€‚ <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// client private void Update() { this.timer += Time.deltaTime; while (this.timer &gt;= Time.fixedDeltaTime) { this.timer -= Time.fixedDeltaTime; Inputs inputs = this.SampleInputs(); InputMessage input_msg; input_msg.inputs = inputs; input_msg.tick_number = this.tick_number; this.SendToServer(input_msg); this.AddForcesToPlayer(player.GetComponent&lt;Rigidbody&gt;(), inputs); Physics.Simulate(Time.fixedDeltaTime); ++this.tick_number; } }</span></span></code> </pre> <br> åˆ°ç›®å‰ä¸ºæ­¢ï¼Œè¿™é‡Œæ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«çš„ï¼Œæˆ‘å”¯ä¸€è¦æ³¨æ„çš„æ˜¯æ·»åŠ tick_numberå˜é‡ã€‚ éœ€è¦è¿™æ ·ï¼Œå½“æœåŠ¡å™¨å°†å¤šç»´æ•°æ®é›†çŠ¶æ€çš„å¿«ç…§å‘é€å›å®¢æˆ·ç«¯æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾å‡ºå¯¹åº”äºè¯¥çŠ¶æ€çš„å®¢æˆ·ç«¯çš„é—´æ­‡æ–¹å¼ï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥å°†è¯¥çŠ¶æ€ä¸é¢„æµ‹çš„å®¢æˆ·ç«¯è¿›è¡Œæ¯”è¾ƒï¼ˆç¨åå°†å¯¹å…¶è¿›è¡Œæ·»åŠ ï¼‰ã€‚ <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// server private void Update() { while (this.HasAvailableInputMessages()) { InputMessage input_msg = this.GetInputMessage(); Rigidbody rigidbody = player.GetComponent&lt;Rigidbody&gt;(); this.AddForcesToPlayer(rigidbody, input_msg.inputs); Physics.Simulate(Time.fixedDeltaTime); StateMessage state_msg; state_msg.position = rigidbody.position; state_msg.rotation = rigidbody.rotation; state_msg.velocity = rigidbody.velocity; state_msg.angular_velocity = rigidbody.angularVelocity; state_msg.tick_number = input_msg.tick_number + 1; this.SendToClient(state_msg); } }</span></span></code> </pre> <br> ä¸€åˆ‡éƒ½å¾ˆç®€å•-æœåŠ¡å™¨ç­‰å¾…è¾“å…¥æ¶ˆæ¯ï¼Œå½“å®ƒæ”¶åˆ°æ¶ˆæ¯æ—¶ï¼Œå®ƒä¼šæ¨¡æ‹Ÿä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸã€‚ ç„¶åï¼Œä»–æ‹æ‘„å¤šç»´æ•°æ®é›†çš„ç»“æœçŠ¶æ€å¿«ç…§ï¼Œå¹¶å°†å…¶å‘é€å›å®¢æˆ·ç«¯ã€‚ æ‚¨å¯èƒ½ä¼šæ³¨æ„åˆ°çŠ¶æ€æ¶ˆæ¯ä¸­çš„tick_numberæ¯”è¾“å…¥æ¶ˆæ¯ä¸­çš„tick_numberå¤§1ã€‚ è¿™æ ·åšçš„åŸå› æ˜¯ï¼Œä»æˆ‘ä¸ªäººçš„è§’åº¦æ¥çœ‹ï¼Œæˆ‘æ›´æ–¹ä¾¿åœ°å°†â€œé—´æ­‡çŠ¶æ€100çš„ç©å®¶çŠ¶æ€â€è§†ä¸ºâ€œé—´æ­‡çŠ¶æ€100çš„ç©å®¶çŠ¶æ€â€ã€‚ å› æ­¤ï¼Œæµ‹é‡ä¸­çš„ç©å®¶100çš„çŠ¶æ€ä¸æµ‹é‡ä¸­çš„ç©å®¶100çš„è¾“å…¥ç›¸ç»“åˆï¼Œä¸ºæµ‹é‡ä¸­çš„ç©å®¶101åˆ›å»ºäº†æ–°çš„çŠ¶æ€ã€‚ <br><br><h1> çŠ¶æ€<sub>n</sub> +è¾“å…¥<sub>n</sub> =çŠ¶æ€<sub>n + 1</sub> </h1><br> æˆ‘å¹¶ä¸æ˜¯è¯´æ‚¨åº”è¯¥é‡‡ç”¨ç›¸åŒçš„æ–¹å¼ï¼Œä¸»è¦æ˜¯æ–¹æ³•çš„ç¨³å®šæ€§ã€‚ <br><br> è¿˜å¿…é¡»è¯´ï¼Œæˆ‘ä¸æ˜¯é€šè¿‡çœŸå®çš„å¥—æ¥å­—<em>å‘é€</em>è¿™äº›æ¶ˆæ¯ï¼Œè€Œæ˜¯é€šè¿‡å°†å®ƒä»¬å†™å…¥é˜Ÿåˆ—ï¼Œæ¨¡æ‹Ÿæ•°æ®åŒ…å»¶è¿Ÿå’Œä¸¢å¤±æ¥æ¨¡ä»¿å®ƒä»¬ã€‚ è¯¥åœºæ™¯åŒ…å«ä¸¤ä¸ªç‰©ç†å¤šç»´æ•°æ®é›†-ä¸€ä¸ªç”¨äºå®¢æˆ·ç«¯ï¼Œå¦ä¸€ä¸ªç”¨äºæœåŠ¡å™¨ã€‚ æ›´æ–°å®¢æˆ·ç«¯å¤šç»´æ•°æ®é›†æ—¶ï¼Œæˆ‘ç¦ç”¨äº†æœåŠ¡å™¨å¤šç»´æ•°æ®é›†çš„GameObjectï¼Œåä¹‹äº¦ç„¶ã€‚ <br><br> ä½†æ˜¯ï¼Œæˆ‘ä¸ä¼šä»¥é”™è¯¯çš„é¡ºåºæ¨¡æ‹Ÿç½‘ç»œåå¼¹å’Œæ•°æ®åŒ…ä¼ é€’ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘å‡è®¾æ¯ä¸ªæ¥æ”¶åˆ°çš„è¾“å…¥æ¶ˆæ¯éƒ½æ¯”å‰ä¸€ä¸ªæ¶ˆæ¯æ–°çš„åŸå› ã€‚ ä¸ºäº†éå¸¸ç®€å•åœ°åœ¨ä¸€ä¸ªUnityå®ä¾‹ä¸­æ‰§è¡Œâ€œå®¢æˆ·ç«¯â€å’Œâ€œæœåŠ¡å™¨â€ï¼Œéœ€è¦è¿›è¡Œæ­¤æ¨¡ä»¿ï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥åœ¨ä¸€ä¸ªåœºæ™¯ä¸­ç»„åˆæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯å¤šç»´æ•°æ®é›†ã€‚ <br><br> æ‚¨è¿˜å¯ä»¥æ³¨æ„åˆ°ï¼Œå¦‚æœè¾“å…¥æ¶ˆæ¯è¢«ä¸¢å¼ƒå¹¶ä¸”æ²¡æœ‰åˆ°è¾¾æœåŠ¡å™¨ï¼Œåˆ™æœåŠ¡å™¨æ¨¡æ‹Ÿçš„æ—¶é’Ÿå‘¨æœŸæ¯”å®¢æˆ·æœºå°‘ï¼Œå› æ­¤å°†åˆ›å»ºä¸åŒçš„çŠ¶æ€ã€‚ çš„ç¡®å¦‚æ­¤ï¼Œä½†æ˜¯å³ä½¿æˆ‘ä»¬æ¨¡æ‹Ÿäº†è¿™äº›çœç•¥ï¼Œè¾“å…¥ä»ç„¶å¯èƒ½æ˜¯ä¸æ­£ç¡®çš„ï¼Œè¿™ä¹Ÿå°†å¯¼è‡´ä¸åŒçš„çŠ¶æ€ã€‚ æˆ‘ä»¬ç¨åå°†å¤„ç†æ­¤é—®é¢˜ã€‚ <br><br> è¿˜åº”è¯¥è¡¥å……ä¸€ç‚¹ï¼Œåœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œåªæœ‰ä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œä»è€Œç®€åŒ–äº†å·¥ä½œã€‚ å¦‚æœæˆ‘ä»¬æœ‰å¤šä¸ªå®¢æˆ·ç«¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°†éœ€è¦aï¼‰è°ƒç”¨Physics.Simulateï¼ˆï¼‰æ—¶ï¼Œæ£€æŸ¥æœåŠ¡å™¨ä¸Šæ˜¯å¦ä»…å¯ç”¨äº†ä¸€ä¸ªç©å®¶çš„å¤šç»´æ•°æ®é›†ï¼Œæˆ–è€…bï¼‰å¦‚æœæœåŠ¡å™¨ä»å¤šä¸ªå¤šç»´æ•°æ®é›†æ¥æ”¶åˆ°è¾“å…¥ï¼Œè¯·ä¸€èµ·æ¨¡æ‹Ÿå®ƒä»¬ã€‚ <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/OUwWzUxZao0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <i>å»¶è¿Ÿ75æ¯«ç§’ï¼ˆå¾€è¿”150æ¯«ç§’ï¼‰</i> <i><br></i>  <i>0ï¼…ä¸¢å¤±åŒ…è£¹</i> <i><br></i>  <i>é»„è‰²ç«‹æ–¹ä½“-æœåŠ¡å™¨æ’­æ”¾å™¨</i> <i><br></i>  <i>è“è‰²ç«‹æ–¹ä½“-å®¢æˆ·ç«¯æ”¶åˆ°çš„æœ€åä¸€ä¸ªå¿«ç…§</i> <br><br> åˆ°ç›®å‰ä¸ºæ­¢ï¼Œä¸€åˆ‡çœ‹èµ·æ¥éƒ½ä¸é”™ï¼Œä½†æ˜¯æˆ‘å¯¹è§†é¢‘ä¸­å½•åˆ¶çš„å†…å®¹æœ‰äº›æŒ‘å‰”ï¼Œä»¥éšè—ä¸€ä¸ªç›¸å½“ä¸¥é‡çš„é—®é¢˜ã€‚ <br><br><h3> åˆ¤å®šå¤±è´¥ </h3><br> ç°åœ¨æ¥çœ‹ä¸€ä¸‹ï¼š <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/7jbKgyUwnd4" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <i>çœŸæ˜¯çš„</i> <br><br> å½•åˆ¶è¯¥è§†é¢‘æ—¶ä¸ä¼šä¸¢å¤±ä»»ä½•åŒ…ï¼Œä½†æ˜¯ï¼Œåœ¨è¾“å…¥å®Œå…¨ç›¸åŒçš„æƒ…å†µä¸‹ï¼Œæ¨¡æ‹Ÿä»ç„¶ä¼šæœ‰æ‰€ä¸åŒã€‚ æˆ‘ä¸å¤ªäº†è§£ä¸ºä»€ä¹ˆä¼šå‘ç”Ÿè¿™ç§æƒ…å†µ-PhysXåº”è¯¥å…·æœ‰ç¡®å®šæ€§ï¼Œå› æ­¤æˆ‘å‘ç°ä»¤äººæƒŠè®¶çš„æ˜¯ï¼Œä»¿çœŸç»å¸¸ä¼šå‘ç”Ÿåˆ†æ­§ã€‚ è¿™å¯èƒ½æ˜¯ç”±äºæˆ‘ç»å¸¸å¯ç”¨å’Œç¦ç”¨GameObjectå¤šç»´æ•°æ®é›†ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä½¿ç”¨ä¸¤ä¸ªä¸åŒçš„Unityå®ä¾‹æ—¶ï¼Œé—®é¢˜å¯èƒ½ä¼šå‡å°‘ã€‚ è¿™å¯èƒ½æ˜¯ä¸€ä¸ªé”™è¯¯ï¼Œå¦‚æœæ‚¨åœ¨GitHubçš„ä»£ç ä¸­çœ‹åˆ°å®ƒï¼Œè¯·å‘Šè¯‰æˆ‘ã€‚ <br><br> ä¸ç®¡æ€æ ·ï¼Œä¸æ­£ç¡®çš„é¢„æµ‹æ˜¯å®¢æˆ·ç«¯é¢„æµ‹ä¸­å¿…ä¸å¯å°‘çš„äº‹å®ï¼Œå› æ­¤è®©æˆ‘ä»¬å¯¹å…¶è¿›è¡Œå¤„ç†ã€‚ <br><br><h3> æˆ‘å¯ä»¥å€’å¸¦å—ï¼Ÿ </h3><br> è¯¥è¿‡ç¨‹éå¸¸ç®€å•-å½“å®¢æˆ·é¢„æµ‹ç§»åŠ¨æ—¶ï¼Œä»–ä¿å­˜çŠ¶æ€ç¼“å†²åŒºï¼ˆä½ç½®å’Œæ—‹è½¬ï¼‰å’Œè¾“å…¥ã€‚ ä»æœåŠ¡å™¨æ”¶åˆ°çŠ¶æ€æ¶ˆæ¯åï¼Œå®ƒå°†æ¥æ”¶åˆ°çš„çŠ¶æ€ä¸ç¼“å†²åŒºä¸­çš„é¢„æµ‹çŠ¶æ€è¿›è¡Œæ¯”è¾ƒã€‚ å¦‚æœå®ƒä»¬ä¹‹é—´çš„å·®å€¼å¤ªå¤§ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°†é‡æ–°å®šä¹‰å®¢æˆ·ç«¯å¤šç»´æ•°æ®é›†çš„çŠ¶æ€ï¼Œç„¶åå†æ¬¡æ¨¡æ‹Ÿæ‰€æœ‰ä¸­é—´åº¦é‡ã€‚ <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// client private ClientState[] client_state_buffer = new ClientState[1024]; private Inputs[] client_input_buffer = new Inputs[1024]; private void Update() { this.timer += Time.deltaTime; while (this.timer &gt;= Time.fixedDeltaTime) { this.timer -= Time.fixedDeltaTime; Inputs inputs = this.SampleInputs(); InputMessage input_msg; input_msg.inputs = inputs; input_msg.tick_number = this.tick_number; this.SendToServer(input_msg); uint buffer_slot = this.tick_number % 1024; this.client_input_buffer[buffer_slot] = inputs; this.client_state_buffer[buffer_slot].position = rigidbody.position; this.client_state_buffer[buffer_slot].rotation = rigidbody.rotation; this.AddForcesToPlayer(player.GetComponent&lt;Rigidbody&gt;(), inputs); Physics.Simulate(Time.fixedDeltaTime); ++this.tick_number; } while (this.HasAvailableStateMessage()) { StateMessage state_msg = this.GetStateMessage(); uint buffer_slot = state_msg.tick_number % c_client_buffer_size; Vector3 position_error = state_msg.position - this.client_state_buffer[buffer_slot].position; if (position_error.sqrMagnitude &gt; 0.0000001f) { // rewind &amp; replay Rigidbody player_rigidbody = player.GetComponent&lt;Rigidbody&gt;(); player_rigidbody.position = state_msg.position; player_rigidbody.rotation = state_msg.rotation; player_rigidbody.velocity = state_msg.velocity; player_rigidbody.angularVelocity = state_msg.angular_velocity; uint rewind_tick_number = state_msg.tick_number; while (rewind_tick_number &lt; this.tick_number) { buffer_slot = rewind_tick_number % c_client_buffer_size; this.client_input_buffer[buffer_slot] = inputs; this.client_state_buffer[buffer_slot].position = player_rigidbody.position; this.client_state_buffer[buffer_slot].rotation = player_rigidbody.rotation; this.AddForcesToPlayer(player_rigidbody, inputs); Physics.Simulate(Time.fixedDeltaTime); ++rewind_tick_number; } } } }</span></span></code> </pre> <br> ç¼“å†²çš„è¾“å…¥å’ŒçŠ¶æ€æ•°æ®å­˜å‚¨åœ¨ä¸€ä¸ªéå¸¸ç®€å•çš„å¾ªç¯ç¼“å†²åŒºä¸­ï¼Œå…¶ä¸­é‡åº¦æ ‡è¯†ç¬¦ç”¨ä½œç´¢å¼•ã€‚ æˆ‘ä¸ºç‰©ç†æ—¶é’Ÿé¢‘ç‡é€‰æ‹©äº†64 Hzçš„å€¼ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ª1024ä¸ªå…ƒç´ çš„ç¼“å†²åŒºä¸ºæˆ‘ä»¬æä¾›äº†16ç§’çš„ç©ºé—´ï¼Œè¿™è¿œè¿œè¶…å‡ºäº†æˆ‘ä»¬çš„éœ€è¦ã€‚ <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/_ZBOSycfANA" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <i>æ ¡æ­£å·²å¼€å§‹ï¼</i> <br><br><h3> å†—ä½™è¾“å…¥ä¼ è¾“ </h3><br> è¾“å…¥æ¶ˆæ¯é€šå¸¸å¾ˆå°-æŒ‰ä¸‹çš„æŒ‰é’®å¯ä»¥ç»„åˆæˆä»…å ç”¨å‡ ä¸ªå­—èŠ‚çš„ä½å­—æ®µã€‚ æˆ‘ä»¬çš„æ¶ˆæ¯ä¸­ä»ç„¶æœ‰ä¸€ä¸ªå°èŠ‚ç¼–å·ï¼Œå ç”¨4ä¸ªå­—èŠ‚ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥è½»æ¾åœ°ä½¿ç”¨å¸¦æœ‰è¿›ä½çš„8ä½å€¼æ¥å‹ç¼©å®ƒä»¬ï¼ˆä¹Ÿè®¸0-255çš„é—´éš”å¤ªå°ï¼Œæˆ‘ä»¬å¯ä»¥æ”¾å¿ƒåœ°å°†å…¶å¢åŠ åˆ°9æˆ–10ä½ï¼‰ã€‚ å°½ç®¡å¦‚æ­¤ï¼Œè¿™äº›æ¶ˆæ¯è¿˜æ˜¯å¾ˆå°çš„ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥åœ¨æ¯æ¡æ¶ˆæ¯ä¸­å‘é€å¾ˆå¤šè¾“å…¥æ•°æ®ï¼ˆä»¥é˜²å…ˆå‰çš„è¾“å…¥æ•°æ®ä¸¢å¤±ï¼‰ã€‚ æˆ‘ä»¬åº”è¯¥å›åˆ°å¤šè¿œï¼Ÿ å—¯ï¼Œå®¢æˆ·ç«¯çŸ¥é“ä»–ä»æœåŠ¡å™¨æ”¶åˆ°çš„æœ€åä¸€ä¸ªçŠ¶æ€æ¶ˆæ¯çš„åº¦é‡ç¼–å·ï¼Œå› æ­¤å†å›æº¯æ­¤åº¦é‡æ²¡æœ‰ä»»ä½•æ„ä¹‰ã€‚ æˆ‘ä»¬è¿˜éœ€è¦å¯¹å®¢æˆ·ç«¯å‘é€çš„å†—ä½™è¾“å…¥æ•°æ®é‡æ–½åŠ é™åˆ¶ã€‚ æˆ‘æ²¡æœ‰åœ¨æ¼”ç¤ºä¸­è¿›è¡Œæ­¤æ“ä½œï¼Œä½†åº”åœ¨å®Œæˆçš„ä»£ç ä¸­å®ç°ã€‚ <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.HasAvailableStateMessage()) { StateMessage state_msg = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.GetStateMessage(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.client_last_received_state_tick = state_msg.tick_number;</code> </pre> <br> è¿™æ˜¯ä¸€ä¸ªç®€å•çš„æ›´æ”¹ï¼Œå®¢æˆ·ç«¯åªéœ€å†™å…¥æœ€åæ”¶åˆ°çš„çŠ¶æ€æ¶ˆæ¯çš„åº¦é‡ç¼–å·ã€‚ <br><br><pre> <code class="cs hljs">Inputs inputs = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.SampleInputs(); InputMessage input_msg; input_msg.start_tick_number = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.client_last_received_state_tick; input_msg.inputs = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;Inputs&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">uint</span></span> tick = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.client_last_received_state_tick; tick &lt;= <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.tick_number; ++tick) { input_msg.inputs.Add(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.client_input_buffer[tick % <span class="hljs-number"><span class="hljs-number">1024</span></span>]); } <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.SendToServer(input_msg);</code> </pre> <br> å®¢æˆ·ç«¯å‘é€çš„è¾“å…¥æ¶ˆæ¯ç°åœ¨åŒ…å«è¾“å…¥æ•°æ®åˆ—è¡¨ï¼Œè€Œä¸ä»…ä»…æ˜¯ä¸€é¡¹ã€‚ å¸¦æœ‰å°èŠ‚ç¼–å·çš„éƒ¨ä»¶å°†è·å¾—ä¸€ä¸ªæ–°å€¼-ç°åœ¨ï¼Œè¿™æ˜¯æ­¤åˆ—è¡¨ä¸­ç¬¬ä¸€ä¸ªè¾“å…¥çš„å°èŠ‚ç¼–å·ã€‚ <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.HasAvailableInputMessages()) { InputMessage input_msg = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.GetInputMessage(); <span class="hljs-comment"><span class="hljs-comment">// message contains an array of inputs, calculate what tick the final one is uint max_tick = input_msg.start_tick_number + (uint)input_msg.inputs.Count - 1; // if that tick is greater than or equal to the current tick we're on, then it // has inputs which are new if (max_tick &gt;= server_tick_number) { // there may be some inputs in the array that we've already had, // so figure out where to start uint start_i = server_tick_number &gt; input_msg.start_tick_number ? (server_tick_number - input_msg.start_tick_number) : 0; // run through all relevant inputs, and step player forward Rigidbody rigidbody = player.GetComponent&lt;Rigidbody&gt;(); for (int i = (int)start_i; i &lt; input_msg.inputs.Count; ++i) { this.AddForcesToPlayer(rigidbody, input_msg.inputs[i]); Physics.Simulate(Time.fixedDeltaTime); } server_tick_number = max_tick + 1; } }</span></span></code> </pre> <br> å½“æœåŠ¡å™¨æ¥æ”¶åˆ°è¾“å…¥æ¶ˆæ¯æ—¶ï¼Œå®ƒå°†çŸ¥é“è¯¥æ¶ˆæ¯ä¸­ç¬¬ä¸€ä¸ªè¾“å…¥çš„åº¦é‡ç¼–å·å’Œè¾“å…¥æ•°æ®é‡ã€‚ å› æ­¤ï¼Œå®ƒå¯ä»¥è®¡ç®—æ¶ˆæ¯ä¸­æœ€åè¾“å…¥çš„åº¦é‡ã€‚ å¦‚æœæ­¤æœ€åä¸€ä¸ªåº¦é‡å¤§äºæˆ–ç­‰äºæœåŠ¡å™¨åº¦é‡ç¼–å·ï¼Œåˆ™å®ƒçŸ¥é“æ¶ˆæ¯åŒ…å«è‡³å°‘ä¸€ä¸ªæœåŠ¡å™¨å°šæœªçœ‹åˆ°çš„è¾“å…¥ã€‚ å¦‚æœæ˜¯è¿™æ ·ï¼Œé‚£ä¹ˆå®ƒå°†æ¨¡æ‹Ÿæ‰€æœ‰æ–°çš„è¾“å…¥æ•°æ®ã€‚ <br><br> æ‚¨å¯èƒ½å·²ç»æ³¨æ„åˆ°ï¼Œ <em>å¦‚æœ</em>æˆ‘ä»¬é™åˆ¶è¾“å…¥æ¶ˆæ¯ä¸­çš„å†—ä½™è¾“å…¥æ•°æ®é‡ï¼Œé‚£ä¹ˆåœ¨ä¸¢å¤±è¶³å¤Ÿå¤šçš„è¾“å…¥æ¶ˆæ¯çš„æƒ…å†µä¸‹ï¼ŒæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¹‹é—´å°†å­˜åœ¨æ¨¡æ‹Ÿç¼ºå£ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼ŒæœåŠ¡å™¨å¯ä»¥æ¨¡æ‹Ÿåº¦é‡100ï¼Œå‘é€çŠ¶æ€æ¶ˆæ¯ä»¥å¼€å§‹åº¦é‡101ï¼Œç„¶åæ¥æ”¶ä»¥åº¦é‡105å¼€å§‹çš„è¾“å…¥æ¶ˆæ¯ã€‚åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼ŒæœåŠ¡å™¨å°†è½¬åˆ°105ï¼Œå®ƒå°†ä¸ä¼šå°è¯•åŸºäºæœ€æ–°çš„å·²çŸ¥è¾“å…¥æ•°æ®æ¥æ¨¡æ‹Ÿä¸­é—´åº¦é‡ã€‚ æ˜¯å¦éœ€è¦å®ƒå–å†³äºæ‚¨çš„å†³å®šä»¥åŠæ¸¸æˆçš„å†…å®¹ã€‚ å°±ä¸ªäººè€Œè¨€ï¼Œç”±äºç½‘ç»œçŠ¶å†µä¸ä½³ï¼Œæˆ‘ä¸ä¼šå¼ºè¿«æœåŠ¡å™¨æ¨æµ‹å¹¶åœ¨åœ°å›¾ä¸Šç§»åŠ¨ç©å®¶ã€‚ æˆ‘è®¤ä¸ºæœ€å¥½å°†æ’­æ”¾å™¨ç•™åœ¨åŸå¤„ï¼Œç›´åˆ°è¿æ¥æ¢å¤ã€‚ <br><br> åœ¨Zend of Networked Physicsæ¼”ç¤ºä¸­ï¼Œå®¢æˆ·ç«¯å…·æœ‰å‘é€â€œé‡è¦åŠ¨ä½œâ€çš„åŠŸèƒ½ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®¢æˆ·ç«¯ä»…åœ¨ä¸å…ˆå‰ä¼ è¾“çš„è¾“å…¥ä¸åŒæ—¶æ‰å‘é€å†—ä½™è¾“å…¥æ•°æ®ã€‚ è¿™å¯ä»¥ç§°ä¸ºè¾“å…¥å¢é‡å‹ç¼©ï¼Œå¹¶å¯ä»¥è¿›ä¸€æ­¥å‡å°è¾“å…¥æ¶ˆæ¯çš„å¤§å°ã€‚ ä½†æ˜¯åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘è¿˜æ²¡æœ‰åšåˆ°è¿™ä¸€ç‚¹ï¼Œå› ä¸ºåœ¨æ­¤æ¼”ç¤ºä¸­ï¼Œæ²¡æœ‰ä¼˜åŒ–ç½‘ç»œè´Ÿè½½ã€‚ <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/XWUsdlNUG5Y" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <i>åœ¨å‘é€å†—ä½™è¾“å…¥æ•°æ®ä¹‹å‰ï¼šå½“25ï¼…çš„æ•°æ®åŒ…ä¸¢å¤±æ—¶ï¼Œå¤šç»´æ•°æ®é›†çš„ç§»åŠ¨é€Ÿåº¦ç¼“æ…¢ä¸”æŠ½æï¼Œå®ƒä¼šç»§ç»­è¢«æŠ›å›å»ã€‚</i> <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/ETFdFAB3s9c" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <i>å‘é€å†—ä½™è¾“å…¥æ•°æ®åï¼šä¸¢å¤±25ï¼…çš„æ•°æ®åŒ…åï¼Œä»ä¼šè¿›è¡ŒæŠ½åŠ¨æ ¡æ­£ï¼Œä½†å¤šç»´æ•°æ®é›†ä»¥å¯æ¥å—çš„é€Ÿåº¦ç§»åŠ¨ã€‚</i> <br><br><h3> å¯å˜å¿«ç…§é¢‘ç‡ </h3><br> åœ¨æ­¤æ¼”ç¤ºä¸­ï¼ŒæœåŠ¡å™¨å‘å®¢æˆ·ç«¯å‘é€å¿«ç…§çš„é¢‘ç‡æœ‰æ‰€ä¸åŒã€‚ é™ä½é¢‘ç‡åï¼Œå®¢æˆ·ç«¯å°†éœ€è¦æ›´å¤šæ—¶é—´ä»æœåŠ¡å™¨æ¥æ”¶æ›´æ­£ã€‚ å› æ­¤ï¼Œå¦‚æœå®¢æˆ·åœ¨é¢„æµ‹ä¸­è¯¯å…¥æ­§é€”ï¼Œåˆ™åœ¨æ”¶åˆ°çŠ¶æ€æ¶ˆæ¯ä¹‹å‰ï¼Œä»–å¯èƒ½ä¼šåç¦»å¾—æ›´å¤šï¼Œè¿™å°†å¯¼è‡´æ›´æ˜æ˜¾çš„æ›´æ­£ã€‚ ç”±äºå¿«ç…§çš„é¢‘ç‡å¾ˆé«˜ï¼Œå› æ­¤ä¸¢åŒ…çš„é‡è¦æ€§ä¸é‚£ä¹ˆé‡è¦ï¼Œå› æ­¤å®¢æˆ·ç«¯ä¸å¿…ç­‰å¾…å¾ˆé•¿æ—¶é—´å³å¯æ¥æ”¶ä¸‹ä¸€ä¸ªå¿«ç…§ã€‚ <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/ukyFYNfvyDQ" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <i>å¿«ç…§é¢‘ç‡64 Hz</i> <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/yQdriQIUnkU" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <i>å¿«ç…§é¢‘ç‡16 Hz</i> <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/RJPah4ucpF0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <i>å¿«ç…§é¢‘ç‡2 Hz</i> <br><br> æ˜¾ç„¶ï¼Œå¿«ç…§çš„é¢‘ç‡è¶Šé«˜ï¼Œå¿«ç…§è¶Šå¥½ï¼Œå› æ­¤åº”å°½å¯èƒ½é¢‘ç¹åœ°å‘é€å¿«ç…§ã€‚ ä½†è¿™è¿˜å–å†³äºé™„åŠ æµé‡çš„æ•°é‡ï¼Œå…¶æˆæœ¬ï¼Œä¸“ç”¨æœåŠ¡å™¨çš„å¯ç”¨æ€§ï¼ŒæœåŠ¡å™¨çš„è®¡ç®—æˆæœ¬ç­‰ã€‚ <br><br><h3> å¹³æ»‘æ ¡æ­£ </h3><br> æˆ‘ä»¬åˆ›å»ºä¸æ­£ç¡®çš„é¢„æµ‹ï¼Œå¹¶ä¸”æ¯”æˆ‘ä»¬å¸Œæœ›çš„æ›´é¢‘ç¹åœ°å¾—åˆ°æŠ–åŠ¨æ ¡æ­£ã€‚ å¦‚æœæ— æ³•æ­£ç¡®è®¿é—®Unity / PhysXé›†æˆï¼Œæˆ‘å‡ ä¹æ— æ³•è°ƒè¯•è¿™äº›é”™è¯¯çš„é¢„æµ‹ã€‚ æˆ‘ä¹‹å‰å·²ç»è¯´è¿‡ï¼Œä½†æ˜¯æˆ‘å†é‡å¤ä¸€é-å¦‚æœæ‚¨å‘ç°ä¸ç‰©ç†å­¦æœ‰å…³çš„æŸäº›ä¸œè¥¿ï¼Œè€Œæˆ‘é”™äº†ï¼Œé‚£ä¹ˆè¯·å‘Šè¯‰æˆ‘ã€‚ <br><br> æˆ‘é€šè¿‡ä½¿ç”¨è‰¯å¥½çš„æ—§å¹³æ»‘åº¦å¯¹è£‚ç¼è¿›è¡Œä¸Šå…‰æ¥è§„é¿äº†è¯¥é—®é¢˜çš„è§£å†³æ–¹æ¡ˆï¼ è¿›è¡Œæ ¡æ­£æ—¶ï¼Œå®¢æˆ·åªéœ€å°†æ’­æ”¾å™¨åœ¨æ­£ç¡®çŠ¶æ€æ–¹å‘ä¸Šçš„ä½ç½®å’Œæ—‹è½¬å¹³æ»‘å‡ å¸§å³å¯ã€‚ ç‰©ç†ç«‹æ–¹ä½“æœ¬èº«ä¼šç«‹å³å¾—åˆ°çº æ­£ï¼ˆå®ƒæ˜¯ä¸å¯è§çš„ï¼‰ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜æœ‰ç¬¬äºŒä¸ªç«‹æ–¹ä½“ä»…ç”¨äºæ˜¾ç¤ºï¼Œä»è€Œå¯ä»¥è¿›è¡Œå¹³æ»‘å¤„ç†ã€‚ <br><br><pre> <code class="cs hljs">Vector3 position_error = state_msg.position - predicted_state.position; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> rotation_error = <span class="hljs-number"><span class="hljs-number">1.f</span></span> - Quaternion.Dot(state_msg.rotation, predicted_state.rotation); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (position_error.sqrMagnitude &gt; <span class="hljs-number"><span class="hljs-number">0.0000001f</span></span> || rotation_error &gt; <span class="hljs-number"><span class="hljs-number">0.00001f</span></span>) { Rigidbody player_rigidbody = player.GetComponent&lt;Rigidbody&gt;(); <span class="hljs-comment"><span class="hljs-comment">// capture the current predicted pos for smoothing Vector3 prev_pos = player_rigidbody.position + this.client_pos_error; Quaternion prev_rot = player_rigidbody.rotation * this.client_rot_error; // rewind &amp; replay player_rigidbody.position = state_msg.position; player_rigidbody.rotation = state_msg.rotation; player_rigidbody.velocity = state_msg.velocity; player_rigidbody.angularVelocity = state_msg.angular_velocity; uint rewind_tick_number = state_msg.tick_number; while (rewind_tick_number &lt; this.tick_number) { buffer_slot = rewind_tick_number % c_client_buffer_size; this.client_input_buffer[buffer_slot] = inputs; this.client_state_buffer[buffer_slot].position = player_rigidbody.position; this.client_state_buffer[buffer_slot].rotation = player_rigidbody.rotation; this.AddForcesToPlayer(player_rigidbody, inputs); Physics.Simulate(Time.fixedDeltaTime); ++rewind_tick_number; } // if more than 2ms apart, just snap if ((prev_pos - player_rigidbody.position).sqrMagnitude &gt;= 4.0f) { this.client_pos_error = Vector3.zero; this.client_rot_error = Quaternion.identity; } else { this.client_pos_error = prev_pos - player_rigidbody.position; this.client_rot_error = Quaternion.Inverse(player_rigidbody.rotation) * prev_rot; } }</span></span></code> </pre> <br> å½“å‘ç”Ÿé”™è¯¯çš„é¢„æµ‹æ—¶ï¼Œå®¢æˆ·ä¼šåœ¨æ›´æ­£åè·Ÿè¸ªä½ç½®/æ—‹è½¬å·®å¼‚ã€‚ å¦‚æœä½ç½®æ ¡æ­£çš„æ€»è·ç¦»è¶…è¿‡2ç±³ï¼Œåˆ™å¤šç»´æ•°æ®é›†ä»…ä¼šçªç„¶ç§»åŠ¨-å¹³æ»‘æ•ˆæœä»ç„¶çœ‹èµ·æ¥å¾ˆå·®ï¼Œå› æ­¤è‡³å°‘åº”ä½¿å…¶å°½å¿«è¿”å›åˆ°æ­£ç¡®çš„çŠ¶æ€ã€‚ <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.client_pos_error *= <span class="hljs-number"><span class="hljs-number">0.9f</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.client_rot_error = Quaternion.Slerp(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.client_rot_error, Quaternion.identity, <span class="hljs-number"><span class="hljs-number">0.1f</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.smoothed_client_player.transform.position = player_rigidbody.position + <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.client_pos_error; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.smoothed_client_player.transform.rotation = player_rigidbody.rotation * <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.client_rot_error;</code> </pre> <br> åœ¨æ¯ä¸ªå¸§ä¸­ï¼Œå®¢æˆ·å‘æ­£ç¡®çš„ä½ç½®/æ—‹è½¬æ–¹å‘æ‰§è¡Œlerp / slerpåŠ¨ä½œ10ï¼…ï¼Œè¿™æ˜¯å¹³å‡è¿åŠ¨çš„æ ‡å‡†å¹‚å¾‹æ³•ã€‚ å®ƒå–å†³äºå¸§é€Ÿç‡ï¼Œä½†æ˜¯å¯¹äºæˆ‘ä»¬çš„æ¼”ç¤ºè€Œè¨€ï¼Œè¿™å·²ç»è¶³å¤Ÿäº†ã€‚ <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/AQ3bMh0OQig" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <i>å»¶è¿Ÿ250æ¯«ç§’</i> <i><br></i>  <i>ä¸¢å¤±10ï¼…çš„åŒ…è£¹</i> <i><br></i>  <i>å¦‚æœä¸è¿›è¡Œå¹³æ»‘å¤„ç†ï¼Œåˆ™æ ¡æ­£éå¸¸æ˜æ˜¾</i> <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/2jhg8OJdqXY" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <i>å»¶è¿Ÿ250æ¯«ç§’</i> <i><br></i>  <i>ä¸¢å¤±10ï¼…çš„åŒ…è£¹</i> <i><br></i>  <i>é€šè¿‡å¹³æ»‘å¤„ç†ï¼Œå¾ˆéš¾æ³¨æ„åˆ°æ ¡æ­£ã€‚</i> <br><br> æœ€ç»ˆç»“æœæ•ˆæœå¾ˆå¥½ï¼Œæˆ‘æƒ³åˆ›å»ºä¸€ä¸ªçœŸæ­£å‘é€æ•°æ®åŒ…çš„ç‰ˆæœ¬ï¼Œè€Œä¸æ˜¯æ¨¡ä»¿å®ƒä»¬ã€‚ ä½†è¿™è‡³å°‘æ˜¯å¯¹äºåœ¨Unityä¸­å…·æœ‰å®é™…ç‰©ç†å¯¹è±¡çš„å®¢æˆ·ç«¯é¢„æµ‹ç³»ç»Ÿçš„æ¦‚å¿µè¯æ˜ï¼Œè€Œæ— éœ€ç‰©ç†æ’ä»¶ç­‰ã€‚ </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN432190/">https://habr.com/ru/post/zh-CN432190/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN432180/index.html">å¦‚ä½•é€šè¿‡GitHubä¿ƒè¿›èŒä¸šå‘å±•</a></li>
<li><a href="../zh-CN432182/index.html">æˆ‘ä»¬æ²¡æœ‰é‚®ä»¶å’Œæ³¨å†Œå³å¯é¢†å–é‚®ä»¶</a></li>
<li><a href="../zh-CN432184/index.html">æµ‹è¯•äººå‘˜ä¹‹é—´çš„é—®é¢˜èº«ä»½</a></li>
<li><a href="../zh-CN432186/index.html">ä½¿ç”¨STPåˆ›å»ºp2pé€šé“</a></li>
<li><a href="../zh-CN432188/index.html">APT28é»‘å®¢æ”»å‡»äº†æ•°ç™¾åæ·å…‹æ”¿åºœéƒ¨é—¨å‘˜å·¥çš„ç”µå­é‚®ä»¶ç®±</a></li>
<li><a href="../zh-CN432192/index.html">4ä¸ªè¿¹è±¡è¡¨æ˜æ‚¨å°šæœªå‡†å¤‡å¥½å®æ–½é¡¹ç›®ç®¡ç†è§£å†³æ–¹æ¡ˆ</a></li>
<li><a href="../zh-CN432196/index.html">å…³äºJavaScriptä¸­çš„å‡½æ•°ç»„æˆ</a></li>
<li><a href="../zh-CN432198/index.html">äº¤ä»˜ç»ç†-æ•æ·ä¸–ç•Œä¸­çš„æ–°è§’è‰²</a></li>
<li><a href="../zh-CN432200/index.html">Ivanå¦‚ä½•è°ƒæŸ¥æ—åˆ†è½¬æ¢</a></li>
<li><a href="../zh-CN432202/index.html">åŠ¨æ€ç”Ÿæˆå­—ç¬¦ç±»å‹ï¼ˆæˆ–å¯¹Rustç–¯ç‹‚ï¼‰</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>