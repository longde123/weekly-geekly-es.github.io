<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë≤üèø ‚òùüèø üë®‚Äçüëß‚Äçüë¶ √âditeur de logique visuelle pour Unity3d. 2e partie üí´ ‚úîÔ∏è ü§≠</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pr√©sentation 
 Bonjour chers lecteurs, dans l'article d'aujourd'hui, je voudrais souligner le th√®me de l'architecture du noyau de l'√©diteur de logique...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>√âditeur de logique visuelle pour Unity3d. 2e partie</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/466187/"><h2>  Pr√©sentation </h2><br>  Bonjour chers lecteurs, dans l'article d'aujourd'hui, je voudrais souligner le th√®me de l'architecture du noyau de l'√©diteur de logique visuelle pour <b>Unity3d</b> .  Ceci est la deuxi√®me partie de la s√©rie.  Vous pouvez lire le pr√©c√©dent <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> .  Alors de quoi parlerons-nous?  L'√©diteur visuel est bas√© sur le noyau principal, ce qui vous permet de d√©marrer, de charger et de stocker des donn√©es logiques.  √Ä son tour, le noyau utilise, comme cela a √©t√© mentionn√© dans l'article pr√©c√©dent, <b>ScriptableObject</b> , comme classe de base pour travailler avec des composants logiques.  Examinons plus en d√©tail tous ces aspects. <br><br>  Articles de la s√©rie: <br><br>  ‚Üí <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">√âditeur de logique visuelle pour Unity3d.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 1</a> <br><a name="habracut"></a><br><h2>  Pourquoi ScriptableObject? </h2><br>  Avant de commencer le d√©veloppement, j'ai longuement r√©fl√©chi √† la structure du syst√®me.  Dans la toute premi√®re forme - c'√©tait <b>MonoBehaviour</b> , mais j'ai d√ª abandonner cette id√©e, car ces scripts devraient se bloquer sur <b>GameObject</b> , en tant que composants.  L'√©tape suivante a √©t√© l'id√©e d'utiliser votre propre classe, qui n'est pas un descendant de <b>UnityEngine.Object</b> .  Mais cette option n'a pas pris racine, m√™me si elle fonctionnait assez bien, mais elle a tra√Æn√©, √©crivant son s√©rialiseur, son inspecteur, son garbage collector, etc. En cons√©quence, la seule fa√ßon raisonnable √©tait d'utiliser <b>ScriptableObject</b> , dont le cycle de vie est similaire √† <b>MonoBehaviour</b> , si la cr√©ation se produit <b>lorsque l'</b> application s'ex√©cute via <b>ScriptableObject.CreateInstance</b> .  De plus, ce probl√®me a √©t√© r√©solu automatiquement √† l'aide de <b>JsonUtility</b> (bien que ce ne soit plus un probl√®me) et de l'inspecteur <b>Unity</b> . <br><br><h2>  L'architecture </h2><br>  Vous trouverez ci-dessous un diagramme g√©n√©ralis√© de la <b>composition du</b> noyau <b>uViLEd</b> . <br><br><img src="https://habrastorage.org/webt/xd/o-/kp/xdo-kp-skmrrvbfw0jy33l3r02o.png" alt="image"><br><br>  Examinons chaque √©l√©ment plus en d√©tail. <br><br><h3>  Contr√¥leur </h3><br>  Le contr√¥leur est l'√©l√©ment principal du noyau, qui est un script <b>MonoBehavior</b> (le seul de tout le syst√®me).  La classe de contr√¥leur est un singleton et est accessible √† tous les composants de la logique.  Ce que fait cette classe: <br><br><ol><li>  Stocke les liens d'objet <b>Unity</b> </li><li>  D√©marre la logique au d√©but de la sc√®ne </li><li>  Repr√©sente l'acc√®s aux m√©thodes pour ex√©cuter la logique √† partir de sources externes </li><li>  Fournit le travail des m√©thodes <b>Mono</b> dans les composants </li></ol><br><div class="spoiler">  <b class="spoiler_title">Code de base de la classe du contr√¥leur</b> <div class="spoiler_text"><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">uViLEd.Core</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">partial</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">LogicController</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> LogicController _instance; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> LogicController Instance { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { _instance = _instance ?? FindObjectOfType&lt;LogicController&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _instance; } } [Serializable] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">SceneLogicData</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Name; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> TextAsset BinaryData =&gt; _data; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Id =&gt; _id; [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> _id; [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> TextAsset _data; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SceneLogicData</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> name, TextAsset binaryData</span></span></span><span class="hljs-function">)</span></span> { _id = id; _data = binaryData; Name = name; } } [HideInInspector] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> List&lt;SceneLogicData&gt; SceneLogicList = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;SceneLogicData&gt;(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Awake</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { _instance = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> sceneLogic <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> SceneLogicList) { RunLogicInternal(LogicStorage.Load(sceneLogic.BinaryData)); } } } }</code> </pre> <br></div></div><br>  <b>Remarque</b> : chaque sc√®ne a son propre contr√¥leur et son propre ensemble de logique. <br>  <b>Remarque</b> : plus de d√©tails sur le chargement des donn√©es logiques et leur lancement seront discut√©s s√©par√©ment. <br><br><h3>  √âl√©ments de base du noyau uViLEd </h3><br><h4>  Composant </h4><br>  Dans la premi√®re partie, j'ai d√©j√† dit que le composant est un <b>ScriptableObject</b> .  Tous les composants sont des descendants de la classe <b>LogicComponent</b> , qui √† son tour est simple. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">uViLEd.Core</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">LogicComponent</span></span> : <span class="hljs-title"><span class="hljs-title">ScriptableObject</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> MonoBehaviour coroutineHost =&gt; _logicHost; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> MonoBehaviour _logicHost; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Constructor</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { } } }</code> </pre><br>  Ici, <b>coroutineHost</b> est un lien vers un contr√¥leur logique, qui a √©t√© introduit juste pour plus de commodit√© et est utilis√©, comme son nom l'indique, pour travailler avec des coroutines.  L'utilisation de cette abstraction est n√©cessaire afin de s√©parer les composants des autres codes pr√©sents dans le projet <b>Unity</b> . <br><br><h4>  Variables </h4><br>  Les variables, comme mentionn√© dans un article pr√©c√©dent, sont des composants sp√©cialis√©s pour le stockage de donn√©es, leur code est pr√©sent√© ci-dessous. <br><br><div class="spoiler">  <b class="spoiler_title">Code de mise en ≈ìuvre variable</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">uViLEd.Core</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Variable</span></span> : <span class="hljs-title"><span class="hljs-title">LogicComponent</span></span> { } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Variable</span></span>&lt;<span class="hljs-title"><span class="hljs-title">T</span></span>&gt; : <span class="hljs-title"><span class="hljs-title">Variable</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">delegate</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Changed</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">delegate</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Set</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">T newValue</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> Changed OnChanged; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> Set OnSet; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> T Value { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _value; }<span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> changed = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_value == <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> != <span class="hljs-literal"><span class="hljs-literal">null</span></span> || (_value != <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; !_value.Equals(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>))) { changed = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } _value = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (changed) { OnChanged?.Invoke(); } OnSet?.Invoke(_value); } } [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> T _value; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnDestroy</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(OnSet != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> eventHandler <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> OnSet.GetInvocationList()) { OnSet -= (Set)eventHandler; } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(OnChanged != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> eventHandler <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> OnChanged.GetInvocationList()) { OnChanged -= (Changed)eventHandler; } } } } }</code> </pre><br></div></div><br>  Ici, <b>Variable</b> est une classe abstraite de base pour toutes les variables, elle est n√©cessaire pour les s√©parer des composants ordinaires.  La classe principale est <b>g√©n√©rique</b> , qui stocke les donn√©es elles-m√™mes et fournit des √©v√©nements pour d√©finir la valeur et la modifier. <br><br><h4>  Les communications </h4><br>  Quelles sont les connexions, j'ai dit dans un pr√©c√©dent article.  En bref, il s'agit d'une entit√© virtuelle qui permet aux composants d'utiliser les m√©thodes les uns des autres et de faire √©galement r√©f√©rence aux variables logiques.  Pour le programmeur, cette connexion est douce et non visible dans le code.  Toutes les communications sont form√©es pendant le processus d'initialisation (lisez-le ci-dessous).  Consid√©rez les classes qui vous permettent de former des relations. <br><br><div class="spoiler">  <b class="spoiler_title">Point d'entr√©e</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">uViLEd.Core</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">INPUT_POINT</span></span>&lt;<span class="hljs-title"><span class="hljs-title">T</span></span>&gt; { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Action&lt;T&gt; Handler; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">INPUT_POINT</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Action Handler; } }</code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Point de sortie</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">uViLEd.Core</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">OUTPUT_POINT</span></span>&lt;<span class="hljs-title"><span class="hljs-title">T</span></span>&gt; { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> List&lt;Action&lt;T&gt;&gt; _linkedInputPoints = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;Action&lt;T&gt;&gt;(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Execute</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">T param</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> handler <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> _linkedInputPoints) { handler(param); } } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">OUTPUT_POINT</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> List&lt;Action&gt; _linkedInputPoints = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;Action&gt;(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Execute</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> handler <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> _linkedInputPoints) { handler(); } } } }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">R√©f√©rence variable</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">uViLEd.Core</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">VARIABLE_LINK</span></span>&lt;<span class="hljs-title"><span class="hljs-title">T</span></span>&gt; { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> T Value { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> =&gt; _variable.Value; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> =&gt; _variable.Value = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Variable&lt;T&gt; _variableProperty { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> =&gt; _variable; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { _variable = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; VariableWasSet = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; InitializeEventHandlers(); } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> VariableWasSet { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Variable&lt;T&gt; _variable; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Variable&lt;T&gt;.Set _automaticSetHandler; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Variable&lt;T&gt;.Changed _automaticChangedHandler; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddSetEventHandler</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Variable&lt;T&gt;.Set handler</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (VariableWasSet) { _variable.OnSet += handler; }<span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { _automaticSetHandler = handler; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RemoveSetEventHandler</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Variable&lt;T&gt;.Set handler</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (VariableWasSet) { _variable.OnSet -= handler; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddChangedEventHandler</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Variable&lt;T&gt;.Changed handler</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (VariableWasSet) { _variable.OnChanged += handler; }<span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { _automaticChangedHandler = handler; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RemoveChangedEventHandler</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Variable&lt;T&gt;.Changed handler</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (VariableWasSet) { _variable.OnChanged -= handler; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">InitializeEventHandlers</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_automaticSetHandler != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { _variable.OnSet += _automaticSetHandler; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_automaticChangedHandler != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { _variable.OnChanged += _automaticChangedHandler; } } } }</code> </pre><br></div></div><br>  <b>Remarque</b> : ici, il convient d'expliquer un point, les gestionnaires automatiques pour d√©finir des √©v√©nements et modifier la valeur d'une variable ne sont utilis√©s que lorsqu'ils sont d√©finis dans la m√©thode <b>Constructor</b> , car √† ce moment-l√†, les r√©f√©rences aux variables n'ont pas encore √©t√© d√©finies. <br><br><h3>  Travailler avec la logique </h3><br><h4>  Stockage </h4><br>  Dans le premier article sur l'√©diteur de logique visuelle, il a √©t√© mentionn√© que la logique est un ensemble de variables, de composants et des relations entre eux: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">uViLEd.Core</span></span> { [Serializable] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">partial</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">LogicStorage</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Id = <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Empty; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Name = <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Empty; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> SceneName = <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Empty; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ComponentsStorage Components = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ComponentsStorage(); <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> LinksStorage Links = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LinksStorage(); } }</code> </pre><br>  Cette classe est apparemment s√©rialisable, mais <b>JsonUtility</b> <b>d'</b> <b>Unity</b> n'est pas utilis√© pour la s√©rialisation.  Au lieu de cela, une option binaire est utilis√©e, dont le r√©sultat est enregistr√© en tant que fichier avec l'extension d' <b>octets</b> .  Pourquoi est-ce fait?  En g√©n√©ral, la principale raison est la s√©curit√©, c'est-√†-dire que pour l'option de chargement de la logique √† partir d'une source externe, il est possible de chiffrer les donn√©es et, en g√©n√©ral, la d√©s√©rialisation d'un tableau d'octets est plus difficile que d'ouvrir <b>json</b> . <br><br>  Examinons de plus <b>pr√®s les classes</b> <b>ComponentsStrorage</b> et <b>LinksStorage</b> .  Le syst√®me utilise un <b>GUID</b> pour l'identification globale des donn√©es.  Ci-dessous se trouve le code de classe, qui est la base des conteneurs de donn√©es. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">uViLEd.Core</span></span> { [Serializable] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Identifier</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Id { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Identifier</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.IsNullOrEmpty(Id)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; Id = System.Guid.NewGuid().ToString(); } } }</code> </pre><br>  Consid√©rons maintenant le code de la classe <b>ComponentsStorage</b> , qui, comme son nom l'indique, stocke des donn√©es sur les composants de la logique: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">uViLEd.Core</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">partial</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">LogicStorage</span></span> { [Serializable] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ComponentsStorage</span></span> { [Serializable] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ComponentData</span></span> : <span class="hljs-title"><span class="hljs-title">Identifier</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Type = <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Empty; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Assembly = <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Empty; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> JsonData = <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Empty; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IsActive = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> List&lt;ComponentData&gt; Items = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;ComponentData&gt;(); } }</code> </pre><br>  La classe est assez simple.  Les informations suivantes sont stock√©es pour chaque composant: <br><br><ol><li>  Identifiant unique (cha√Æne <b>GUID</b> ) trouv√© dans l' <b>identifiant</b> </li><li>  Tapez le nom </li><li>  Le nom de l'assemblage dans lequel se trouve le type de composant </li><li>  Cha√Æne Json avec donn√©es de s√©rialisation (r√©sultat de <b>JsonUtility.ToJson</b> ) </li><li>  Indicateur d'activit√© (√©tat) du composant </li></ol><br>  Examinons maintenant la classe <b>LinksStorage</b> .  Cette classe stocke des informations sur les relations entre les composants, ainsi que sur les r√©f√©rences aux variables. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">uViLEd.Core</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">partial</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">LogicStorage</span></span> { [Serializable] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">LinksStorage</span></span> { [Serializable] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">LinkData</span></span> : <span class="hljs-title"><span class="hljs-title">Identifier</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IsVariable; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IsActive = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> SourceComponent = <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Empty; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> TargetComponent = <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Empty; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> OutputPoint = <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Empty; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> InputPoint = <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Empty; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> VariableName = <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Empty; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> CallOrder = <span class="hljs-number"><span class="hljs-number">-1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> List&lt;LinkData&gt; Items = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;LinkData&gt;(); } }</code> </pre><br>  En principe, il n'y a rien de compliqu√© non plus dans cette classe.  Chaque lien contient les informations suivantes: <br><br><ol><li>  Indicateur signalant que ce lien fait r√©f√©rence √† une variable </li><li>  Indicateur d'activit√© de lien </li><li>  L'identifiant (cha√Æne <b>GUID</b> ) du composant avec le point de sortie </li><li>  L'identifiant (cha√Æne <b>GUID</b> ) du composant point d'entr√©e </li><li>  Le nom du point de sortie du composant source de communication </li><li>  Nom du point d'entr√©e du composant de communication cible </li><li>  Nom de champ de classe pour d√©finir une r√©f√©rence de variable </li><li>  Ordre d'appel de communication </li></ol><br><h4>  Ex√©cuter √† partir du r√©f√©rentiel </h4><br>  Avant d'entrer dans les d√©tails du code, je veux d'abord m'attarder sur la description de la s√©quence de d√©marrage de la logique par le contr√¥leur: <br><br><ol><li>  L'initialisation d√©marre dans la m√©thode Awake du contr√¥leur </li><li>  La liste des logiques de sc√®ne charge et d√©s√©rialise les donn√©es logiques d'un fichier binaire ( <b>TextAsset</b> ) </li><li>  Pour chaque logique se produit: <br><ul><li>  Cr√©ation de composants </li><li>  Tri des liens par <b>CallOrder</b> </li><li>  D√©finition de liens et de r√©f√©rences de variables </li><li>  Tri des <b>m√©thodes de</b> composant <b>mono</b> par <b>ExecuteOrder</b> </li></ul><br></li></ol><br>  Examinons plus en d√©tail chaque aspect de cette cha√Æne. <br><br><div class="spoiler">  <b class="spoiler_title">S√©rialisation et d√©s√©rialisation binaires</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">uViLEd</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Serialization</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Serialize</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> data, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> path, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> fileName</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> binaryFormatter = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BinaryFormatter(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!Directory.Exists(path)) { Directory.CreateDirectory(path); } <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> fs = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileStream(Path.Combine(path, fileName), FileMode.OpenOrCreate)) { binaryFormatter.Serialize(fs, data); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">object</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Deserialize</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">TextAsset textAsset</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> binaryFormatter = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BinaryFormatter(); <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> memoryStream = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MemoryStream(textAsset.bytes)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> binaryFormatter.Deserialize(memoryStream); } } } }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Chargement de donn√©es logiques √† partir d'un √©l√©ment texte (fichier binaire)</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">uViLEd.Core</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">partial</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">LogicStorage</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> LogicStorage </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Load</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">TextAsset textAsset</span></span></span><span class="hljs-function">)</span></span> =&gt; Serialization.Deserialize(textAsset) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> LogicStorage; } }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Lancement logique</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RunLogicInternal</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">LogicStorage logicStorage</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> instances = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Dictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, LogicComponent&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> componentData <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> logicStorage.Components.Items) { CreateComponent(componentData, instances); } logicStorage.Links.Items.Sort(SortingLinks); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> linkData <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> logicStorage.Links.Items) { CreateLink(linkData, instances); } <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> monoMethods <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> _monoBehaviourMethods.Values) { monoMethods.Sort(SortingMonoMethods); } }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Cr√©ation de composants</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateComponent</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">LogicStorage.ComponentsStorage.ComponentData componentData, IDictionary&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">, LogicComponent&gt; instances, IList&lt;IDisposable&gt; disposableInstance, IDictionary&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">, List&lt;MonoMethodData&gt;&gt; monoMethods</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!componentData.IsActive) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> componentType = AssemblyHelper.GetAssemblyType(componentData.Assembly, componentData.Type); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> componentInstance = ScriptableObject.CreateInstance(componentType) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> LogicComponent; JsonUtility.FromJsonOverwrite(componentData.JsonData, componentInstance); componentInstance.name = componentData.InstanceName; componentType.GetFieldRecursive(_LOGIC_HOST_STR).SetValue(componentInstance, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> MonoBehaviour); componentInstance.Constructor(); instances.Add(componentData.Id, componentInstance); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(componentInstance <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> IDisposable) { disposableInstance.Add((IDisposable)componentInstance); } SearchMonoBehaviourMethod(componentInstance, monoMethods); }</code> </pre><br>  Alors, que se passe-t-il dans cette fonction: <br><br><ol><li>  L'indicateur d'activit√© du composant est v√©rifi√© </li><li>  Obtention du type de composant √† partir de l'assemblage </li><li>  Une instance de composant est cr√©√©e par type </li><li>  D√©s√©rialisation des param√®tres des composants de <b>json</b> </li><li>  Le lien est d√©fini dans <b>coroutineHost</b> </li><li>  M√©thode <b>constructeur</b> appel√©e </li><li>  Une copie temporaire est enregistr√©e dans l'instance de composant </li><li>  Si le composant impl√©mente l'interface IDisposable, le lien vers celui-ci est stock√© dans la liste correspondante </li><li>  Recherche de m√©thodes <b>Mono</b> dans le composant </li></ol><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Cr√©ation de liens</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateLink</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">LogicStorage.LinksStorage.LinkData linkData, Dictionary&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">, LogicComponent&gt; instances</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!linkData.IsActive) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> sourceComponent = instances.ContainsKey(linkData.SourceComponent) ? instances[linkData.SourceComponent] : <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (sourceComponent == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> targetComponent = instances.ContainsKey(linkData.TargetComponent) ? instances[linkData.TargetComponent] : <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (targetComponent == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (linkData.IsVariable) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> variableLinkFieldInfo = sourceComponent.GetType().GetField(linkData.variableName); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (variableLinkFieldInfo != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> variableLinkFieldValue = variableLinkFieldInfo.GetValue(sourceComponent); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> variableLinkVariablePropertyInfo = variableLinkFieldInfo.FieldType.GetProperty(_VARIABLE_PROPERTY_STR, BindingFlags.NonPublic | BindingFlags.Instance); variableLinkVariablePropertyInfo.SetValue(variableLinkFieldValue, targetComponent, <span class="hljs-literal"><span class="hljs-literal">null</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> handlerValue; MethodInfo methodListAdd; <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> linkedInputPointsFieldValue; Type outputPointType; <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> outputPoint; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> outputPointParse = sourceComponent <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> IOutputPointParse; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> inputPointParse = targetComponent <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> IInputPointParse; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (outputPointParse != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> outputPoints = outputPointParse.GetOutputPoints(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (outputPoints.ContainsKey(linkData.OutputPoint)) { outputPoint = outputPoints[linkData.OutputPoint]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (outputPoint <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> FieldInfo) { outputPoint = sourceComponent.GetType().GetField(linkData.OutputPoint).GetValue(sourceComponent); } outputPointType = outputPoint.GetType(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> linkedInputPointsFieldInfo = outputPointType.GetField(_LINKED_INPUT_POINTS_STR, BindingFlags.NonPublic | BindingFlags.Instance); linkedInputPointsFieldValue = linkedInputPointsFieldInfo.GetValue(outputPoint); methodListAdd = linkedInputPointsFieldInfo.FieldType.GetMethod(_ADD_STR); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> outputPointFieldInfo = sourceComponent.GetType().GetField(linkData.OutputPoint); outputPoint = outputPointFieldInfo.GetValue(sourceComponent); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (outputPoint != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { outputPointType = outputPoint.GetType(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> linkedInputPointsFieldInfo = outputPointFieldInfo.FieldType.GetField(_LINKED_INPUT_POINTS_STR, BindingFlags.NonPublic | BindingFlags.Instance); linkedInputPointsFieldValue = linkedInputPointsFieldInfo.GetValue(outputPoint); methodListAdd = linkedInputPointsFieldInfo.FieldType.GetMethod(_ADD_STR); } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (inputPointParse != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> inputPoints = inputPointParse.GetInputPoints(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (inputPoints.ContainsKey(linkData.InputPoint)) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> inputPoint = inputPoints[linkData.InputPoint]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (inputPoint <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> FieldInfo) { inputPoint = targetComponent.GetType().GetField(linkData.InputPoint).GetValue(targetComponent); } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> inputPointType = inputPoint.GetType(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> inputPointHandlerFieldInfo = inputPointType.GetField(_HANDLER_STR); handlerValue = inputPointHandlerFieldInfo.GetValue(inputPoint); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> inputPointFieldInfo = targetComponent.GetType().GetField(linkData.InputPoint); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> inputPointFieldValue = inputPointFieldInfo.GetValue(targetComponent); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (inputPointFieldValue != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> inputPointHandlerFieldInfo = inputPointFieldInfo.FieldType.GetField(_HANDLER_STR); handlerValue = inputPointHandlerFieldInfo.GetValue(inputPointFieldValue); } } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> handlerParsedAction = GetParsedHandler(handlerValue, outputPoint); methodListAdd.Invoke(linkedInputPointsFieldValue, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>[] { handlerParsedAction }); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">object</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetParsedHandler</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> handlerValue, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> outputPoint</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> inputPointType = handlerValue.GetType(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> outputPointType = outputPoint.GetType(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (inputPointType.IsGenericType) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> paramType = inputPointType.GetGenericArguments()[<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (paramType == <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">object</span></span>) &amp;&amp; outputPointType.IsGenericType) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> parsingActionMethod = outputPointType.GetMethod(_PARSING_ACTION_OBJECT_STR, BindingFlags.NonPublic | BindingFlags.Instance); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> parsingActionMethod.Invoke(outputPoint, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>[] { handlerValue }); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> handlerValue; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (outputPointType.IsGenericType) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> parsingActionMethod = outputPointType.GetMethod(_PARSING_ACTION_EMPTY_STR, BindingFlags.NonPublic | BindingFlags.Instance); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> parsingActionMethod.Invoke(outputPoint, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>[] { handlerValue }); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> handlerValue; } } }</code> </pre> <br>  La cr√©ation d'une connexion, l'un des moments les plus intrins√®quement difficiles de tout le syst√®me, consid√®re chaque √©tape: <br><br><ol><li>  V√©rifie l'indicateur d'activit√© de communication </li><li>  Dans la liste temporaire des composants cr√©√©s sont recherch√©s, le composant source de la connexion et la cible </li><li>  V√©rifie le type de connexion: <br><ul><li>  Si le type de connexion est une r√©f√©rence √† une variable, les valeurs n√©cessaires sont d√©finies √† l'aide de la r√©flexion </li><li>  Si la connexion est normale, la r√©flexion est √©galement utilis√©e pour d√©finir les valeurs n√©cessaires pour les m√©thodes des points de sortie et d'entr√©e </li></ul><br></li><li>  Pour les communications normales, v√©rifiez d'abord si le composant h√©rite des <b>interfaces</b> <b>IInputPointParse</b> et <b>IOutputPointParse</b> . </li><li>  En fonction des r√©sultats du paragraphe pr√©c√©dent, le champ <b>LinkedInputPoints</b> dans le composant source et la m√©thode du gestionnaire dans le composant cible sont obtenus par r√©flexion. </li><li>  Les gestionnaires de m√©thodes sont <b>obtenus</b> en convertissant l'appel de m√©thode en contournant <b>MethodInfo.Invoke</b> en un appel <code>Action&lt;T&gt;</code> simple.  Cependant, l'obtention d'un tel lien par r√©flexion est trop compliqu√©e, par cons√©quent, des m√©thodes sp√©ciales ont √©t√© <code>OUTPUT_POINT&lt;T&gt;</code> dans la <code>OUTPUT_POINT&lt;T&gt;</code> qui permettent cela.  Pour une version non <b>g√©n√©rique</b> de cette classe, aucune action de ce type n'est requise. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> Action&lt;T&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ParsingActionEmpty</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Action action</span></span></span><span class="hljs-function">)</span></span> { Action&lt;T&gt; parsedAction = (<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>) =&gt; action(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> parsedAction; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> Action&lt;T&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ParsingActionObject</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Action&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; action</span></span></span><span class="hljs-function">)</span></span> { Action&lt;T&gt; parsedAction = (<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>) =&gt; action(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> parsedAction; } }</code> </pre> <br>  La premi√®re m√©thode est utilis√©e lorsque le point d'entr√©e n'accepte aucun param√®tre.  La deuxi√®me m√©thode, respectivement, pour le point d'entr√©e avec un param√®tre. <br><br></li><li>  Par r√©flexion, un lien vers le gestionnaire d' <b>actions</b> est ajout√© au champ <b>LinkedInputPoints</b> (qui, comme illustr√© ci-dessus, est une liste) </li></ol><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Travailler avec des m√©thodes mono</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SearchMonoBehaviourMethod</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">LogicComponent component, IDictionary&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">, List&lt;MonoMethodData&gt;&gt; monoBehaviourMethods</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> type = component.GetType(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> methods = type.GetMethods(BindingFlags.Public | BindingFlags.Static | BindingFlags.NonPublic | BindingFlags.Instance); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> method <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> methods) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_monoMethods.Keys.Contains(method.Name)) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> priorityAttributes = method.GetCustomAttributes(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(ExecuteOrderAttribute), <span class="hljs-literal"><span class="hljs-literal">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> priority = (priorityAttributes.Length &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) ? ((ExecuteOrderAttribute)priorityAttributes[<span class="hljs-number"><span class="hljs-number">0</span></span>]).Order : <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>.MaxValue; monoBehaviourMethods[method.Name].Add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MonoMethodData(method, component, priority, _monoMethods[method.Name])); } } }</code> </pre> <br>  Chaque m√©thode est stock√©e dans le dictionnaire via un lien vers une classe sp√©ciale √† travers laquelle l'appel est effectu√©.  Cette classe convertit automatiquement la m√©thode en r√©f√©rence √† <b>Action</b> .  Ainsi, il y a une acc√©l√©ration significative des appels aux m√©thodes <b>Mono</b> par rapport √† la <b>m√©thode MethodInfo.Invoke</b> habituelle. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MonoMethodData</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Order { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Action _monoMethodWrapper; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Action&lt;<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>&gt; _monoMethodParamWrapper; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MonoMethodData</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">MethodInfo method, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> target, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> order, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> withParam</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!withParam) { _monoMethodWrapper = (Action)Delegate.CreateDelegate(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(Action), target, method.Name); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { _monoMethodParamWrapper = (Action&lt;<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>&gt;)Delegate.CreateDelegate(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(Action&lt;<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>&gt;), target, method.Name); } Order = order; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Call</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> =&gt;_monoMethodWrapper(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Call</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> param</span></span></span><span class="hljs-function">)</span></span> =&gt; _monoMethodParamWrapper(param); }</code> </pre> <br>  <b>Remarque</b> : la surcharge de la m√©thode <b>Call</b> avec le param√®tre <b>bool</b> est utilis√©e pour les m√©thodes <b>Mono</b> comme <b>ApplicationPause</b> , etc. <br></div></div><br><h4>  Logique de d√©clenchement externe </h4><br>  Un lancement externe de logique est un lancement pendant le fonctionnement de l'application, une telle logique n'est pas d√©finie dans la sc√®ne et il n'y a aucun lien avec celle-ci.  Il peut √™tre t√©l√©charg√© √† partir du bundle ou des ressources.  En g√©n√©ral, partir de l'ext√©rieur n'est pas tr√®s diff√©rent de commencer au d√©but de la sc√®ne, √† l'exception du travail avec les m√©thodes <b>Mono</b> . <br><br><div class="spoiler">  <b class="spoiler_title">Code de m√©thode pour l'ex√©cution logique externe (diff√©r√©e)</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RunLogicExternal</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">LogicStorage logicStorage</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> instances = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Dictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, LogicComponent&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> runMonoMethods = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Dictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, List&lt;MonoMethodData&gt;&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> monoMethodName <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> _monoMethods.Keys) { runMonoMethods.Add(monoMethodName, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;MonoMethodData&gt;()); } <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> componentData <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> logicStorage.Components.Items) { CreateComponent(componentData, instances, _disposableInstances, runMonoMethods); } logicStorage.Links.Items.Sort(SortingLinks); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> linkData <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> logicStorage.Links.Items) { CreateLink(linkData, instances); } <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> monoMethods <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> runMonoMethods.Values) { monoMethods.Sort(SortingMonoMethods); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (runMonoMethods.ContainsKey(_START_STR)) { CallMonoBehaviourMethod(_START_STR, runMonoMethods, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> monoMethodName <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> runMonoMethods.Keys) { _monoBehaviourMethods[monoMethodName].AddRange(runMonoMethods[monoMethodName]); } <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> monoMethods <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> _monoBehaviourMethods.Values) { monoMethods.Sort(SortingMonoMethods); } }</code> </pre> <br></div></div><br>  Comme vous pouvez le voir, toutes les r√©f√©rences aux m√©thodes <b>Mono</b> sont enregistr√©es dans le dictionnaire local, apr√®s quoi les m√©thodes Start sont lanc√©es, puis toutes les autres m√©thodes sont ajout√©es au dictionnaire g√©n√©ral. <br><br><h4>  Ex√©cution de la logique en tant qu'instance </h4><br>  Pendant le fonctionnement de l'application, il peut √™tre n√©cessaire d'ex√©cuter une certaine logique pendant un certain temps ou jusqu'√† ce qu'elle ex√©cute sa t√¢che.  Les options de d√©clenchement logique pr√©c√©dentes ne sont pas autoris√©es √† le faire, car la logique est d√©clench√©e tout au long de la vie de la sc√®ne. <br><br>  Pour ex√©cuter la logique en tant qu'instance, les liens vers toutes les instances de composants et similaires sont enregistr√©s, qui, une fois le travail termin√©, peuvent √™tre supprim√©s, ce qui efface la m√©moire. <br><br>  Code de classe d'entrep√¥t de donn√©es d'instance logique: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">InstanceLogicData</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> IList&lt;LogicComponent&gt; ComponentInstances = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;LogicComponent&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> IDictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, List&lt;MonoMethodData&gt;&gt; MonoBehaviourMethods = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Dictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, List&lt;MonoMethodData&gt;&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> IList&lt;IDisposable&gt; DisposableInstances = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;IDisposable&gt;(); }</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Le lancement logique lui-m√™me est similaire au lancement externe d√©crit pr√©c√©demment.</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RunLogicInstance</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">LogicStorage logicStorage, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> data</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> id = Guid.NewGuid().ToString(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> logicInstanceData = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InstanceLogicData(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> instances = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Dictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, LogicComponent&gt;(); _logicInstances.Add(id, logicInstanceData); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> componentData <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> logicStorage.Components.Items) { CreateComponent(componentData, instances, logicInstanceData.DisposableInstances, logicInstanceData.MonoBehaviourMethods); } logicStorage.Links.Items.Sort(SortingLinks); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> linkData <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> logicStorage.Links.Items) { CreateLink(linkData, instances); } <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> monoMethods <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> logicInstanceData.MonoBehaviourMethods.Values) { monoMethods.Sort(SortingMonoMethods); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> id; }</code> </pre> <br></div></div><br>  On peut voir d'apr√®s le code qu'apr√®s avoir cr√©√© la logique, les donn√©es √† son sujet sont stock√©es dans une instance d'une classe sp√©cialis√©e, et apr√®s le d√©marrage, un identifiant unique pour l'instance de logique est renvoy√©. <br><br><div class="spoiler">  <b class="spoiler_title">Cet identifiant est n√©cessaire pour appeler la fonction d'arr√™t et d'effacement de la m√©moire.</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">StopLogicInstance</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> instanceId</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!_logicInstances.ContainsKey(instanceId)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> logicInstance = _logicInstances[instanceId]; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> disposableInstance <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> logicInstance.DisposableInstances) { disposableInstance.Dispose(); } <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> componentInstance <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> logicInstance.ComponentInstances) { Destroy(componentInstance); } logicInstance.ComponentInstances.Clear(); logicInstance.DisposableInstances.Clear(); logicInstance.MonoBehaviourMethods.Clear(); _logicInstances.Remove(instanceId); }</code> </pre> <br></div></div><br><h4>  Arr√™ter la sc√®ne et vider la m√©moire </h4><br>  Lors de la cr√©ation d'un <b>ScriptableObject</b> dans une sc√®ne en cours d'ex√©cution via <b>ScriptableObject.CreateInstance</b> , l'instance se comporte de la m√™me mani√®re que <b>MonoBehaviour</b> , c'est-√†-dire que lors du d√©chargement de la sc√®ne, <b>OnDestroy</b> sera appel√© pour chacun et il sera supprim√© de la m√©moire.  Cependant, comme cela a √©t√© dit dans un article pr√©c√©dent, un composant peut h√©riter d' <b>IDisposable</b> , donc je le nettoie dans la m√©thode <b>OnDisable</b> : <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnDisable</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> disposable <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> _disposableInstances) { disposable.Dispose(); } _disposableInstances.Clear(); _monoBehaviourMethods.Clear(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> logicInstance <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> _logicInstances.Values) { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> disposableInstance <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> logicInstance.DisposableInstances) { disposableInstance.Dispose(); } logicInstance.DisposableInstances.Clear(); logicInstance.ComponentInstances.Clear(); logicInstance.MonoBehaviourMethods.Clear(); } _logicInstances.Clear(); _instance = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; }</code> </pre> <br>  <b>Remarque</b> : comme vous pouvez le voir, si des instances de logique existent au moment du d√©chargement de la sc√®ne, un nettoyage y a lieu. <br><br><h3>  Probl√®me et solution avec les objets Unity </h3><br>  Dans la premi√®re partie de l'article sur l'√©diteur visuel, j'ai mentionn√© le probl√®me de la maintenance des liens vers les objets de sc√®ne, qui est li√© √† l'impossibilit√© de restaurer les donn√©es s√©rialis√©es.  Cela est d√ª au fait que l'identifiant unique des objets de sc√®ne est diff√©rent √† chaque lancement de la sc√®ne.  La solution √† ce probl√®me est la seule option - il s'agit de transf√©rer le stockage des liens dans la sc√®ne.  √Ä cet effet, un r√©f√©rentiel sp√©cialis√© et une classe wrapper ont √©t√© ajout√©s au contr√¥leur logique √† travers lequel les composants logiques re√ßoivent des r√©f√©rences aux objets <b>Unity</b> , y compris les ressources, les pr√©fabriqu√©s et d'autres actifs. <br><br><div class="spoiler">  <b class="spoiler_title">Code de stockage</b> <div class="spoiler_text"><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">Serializable</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ObjectLinkData</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Id =&gt; _id; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> UnityEngine.Object Obj =&gt; _obj; [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> _id = <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Empty; [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> UnityEngine.Object _obj; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ObjectLinkData</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id, UnityEngine.Object obj</span></span></span><span class="hljs-function">)</span></span> { _id = id; _obj = obj; } } [SerializeField] [HideInInspector] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> List&lt;ObjectLinkData&gt; _objectLinks = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;ObjectLinkData&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> UnityEngine.<span class="hljs-function"><span class="hljs-function">Object </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetObject</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> linkData = _objectLinks.Find(link =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Compare(link.Id, id, StringComparison.Ordinal) == <span class="hljs-number"><span class="hljs-number">0</span></span>; }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> linkData?.Obj; }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ici: </font></font><br><br><ol><li> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Id</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - identifiant unique de l'actif ou de l'objet de sc√®ne</font></font></li><li> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Obj</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - lien vers des objets d'actif ou de sc√®ne</font></font></li></ol><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Comme vous pouvez le voir dans le code, rien de super compliqu√©. </font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Consid√©rons maintenant une classe wrapper pour les objets Unity</font></font></b> <div class="spoiler_text"><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">Serializable</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">VLObject</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Id =&gt; _id; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> UnityEngine.Object Obj { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_obj == <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; !_objNotFound) { _obj = Core.LogicController.Instance.GetObject(Id); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_obj == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { _objNotFound = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _obj; } } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> UnityEngine.Object _obj; [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> _id; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> _objNotFound; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">VLObject</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">VLObject</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">UnityEngine.Object obj</span></span></span><span class="hljs-function">)</span></span> { _obj = obj; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> T Get&lt;T&gt;() <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> T : UnityEngine.Object { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Obj <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> T; } }</code> </pre><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Remarque</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : l'indicateur </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_objNotFound est</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> n√©cessaire afin de ne pas rechercher le r√©f√©rentiel √† chaque fois s'il n'y a pas d'objet dedans.</font></font><br></div></div><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Performances </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Maintenant, je pense qu'il vaut la peine de s'attarder sur une question telle que la productivit√©. </font><font style="vertical-align: inherit;">Si vous regardez attentivement l'int√©gralit√© du code ci-dessus, vous pouvez comprendre que dans une application d√©j√† en cours d'ex√©cution, le syst√®me n'affecte pas la vitesse, c'est-√†-dire </font><font style="vertical-align: inherit;">tout fonctionnera comme </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">l'</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> application </font><b><font style="vertical-align: inherit;">Unity</font></b><font style="vertical-align: inherit;"> habituelle </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">J'ai compar√© la </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mise √† jour du </font></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MonoBehaviour</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> habituel </font><font style="vertical-align: inherit;">et via </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">uViLEd</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et je </font><b><font style="vertical-align: inherit;">n'ai</font></b><font style="vertical-align: inherit;"> pas pu obtenir au moins la diff√©rence qui pourrait √™tre indiqu√©e ici, tous les nombres sont en parit√© jusqu'√† 1000 appels par trame. </font><font style="vertical-align: inherit;">Le seul goulot d'√©tranglement est la vitesse de chargement de la sc√®ne, mais m√™me ici, je n'ai pas pu obtenir de chiffres significatifs, bien qu'entre les plates-formes (j'ai v√©rifi√© </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Android</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iOS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) la diff√©rence est grande. </font><font style="vertical-align: inherit;">Dans la logique de 70 composants et environ 150 connexions (y compris les r√©f√©rences aux variables), les chiffres √©taient les suivants:</font></font><br><br><ol><li> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Android</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (MediaTek 8 c≈ìurs tr√®s m√©diocre) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Au d√©marrage de l'application - ~ 750 ms </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Ex√©cution de la sc√®ne dans l'application en cours d'ex√©cution ~ 250 ms</font></font><br></li><li> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iOS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (iPhone 5s) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Au d√©marrage de l'application - ~ 100 ms </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Ex√©cution de la sc√®ne dans l'application en cours d'ex√©cution ~ 50 ms</font></font><br></li></ol><br><h2>  Conclusion </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'architecture du noyau du syst√®me </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">uViLEd est</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> assez simple et directe, il n'est pas conseill√© de l'utiliser indirectement depuis l'√©diteur visuel, bien que je n'exclue pas que certaines solutions s'av√®rent utiles √† quelqu'un. </font><font style="vertical-align: inherit;">N√©anmoins, cet article est important pour une compr√©hension g√©n√©rale du fonctionnement du syst√®me, dont la derni√®re partie importante est l'√©diteur lui-m√™me. </font><font style="vertical-align: inherit;">Et la derni√®re partie finale de la s√©rie, qui sera la plus mouvement√©e, y sera consacr√©e. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS: la r√©daction de l'article a √©t√© tr√®s longue, ce dont je m'excuse. </font><font style="vertical-align: inherit;">Initialement, j'avais pr√©vu de sortir toutes les parties restantes en m√™me temps, mais la sortie de nouvelles versions de Unity 3d, ainsi que des chocs vitaux (agr√©ables et pas si), ont chang√© de plan. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚Üí </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√âditeur de logique visuelle pour Unity3d.</font></font></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 1</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr466187/">https://habr.com/ru/post/fr466187/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr466169/index.html">Offre sp√©ciale pour les √©tudiants actifs de JetBrains</a></li>
<li><a href="../fr466171/index.html">Cinq raisons d'opter pour JUG.EKB</a></li>
<li><a href="../fr466179/index.html">fform: React & JSONSchema - flexibilit√© maximale</a></li>
<li><a href="../fr466181/index.html">Python de C (API C)</a></li>
<li><a href="../fr466183/index.html">Algorithmes de traitement de cha√Æne intelligents dans ClickHouse</a></li>
<li><a href="../fr466191/index.html">L'essentiel de la bataille pour la neutralit√© du r√©seau aux √âtats-Unis est la chronologie des √©v√©nements et l'√©tat actuel des choses</a></li>
<li><a href="../fr466193/index.html">Alimentation automatique MailChimp personnalis√©e √† partir du flux RSS</a></li>
<li><a href="../fr466195/index.html">PVS-Studio 7.04</a></li>
<li><a href="../fr466197/index.html">PVS-Studio 7.04</a></li>
<li><a href="../fr466199/index.html">Verrous dans PostgreSQL: 4. Verrous en m√©moire</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>