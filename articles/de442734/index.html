<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🛀🏿 🍼 💂🏼 Wie man eine Krücke für Tinkoff Investments mit eigenen Händen oder Benachrichtigungen über Maßnahmen herstellt, die für Gewinnmitnahmen / Stop-Loss erforderlich sind 👩🏾‍🤝‍👩🏼 🤹🏽 🤖</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Es gibt einen solchen Makler - die Tinkoff Bank. Und es gibt ein Problem in der Tatsache, dass dieser Broker derzeit keine Gewinn- / Stop-Loss-Aufträg...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Wie man eine Krücke für Tinkoff Investments mit eigenen Händen oder Benachrichtigungen über Maßnahmen herstellt, die für Gewinnmitnahmen / Stop-Loss erforderlich sind</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/442734/"> Es gibt einen solchen Makler - die Tinkoff Bank.  Und es gibt ein Problem in der Tatsache, dass dieser Broker derzeit keine Gewinn- / Stop-Loss-Aufträge hat.  Wenn Sie also aktiver handeln möchten, müssen Sie eine vorübergehende Lösung finden, während Programmierer in den Tiefen von Tinkoff eine Killer-Funktion entwickeln, die Gewinn / Stop-Loss mit sich bringt, und unter der Kürzung ist eine davon. <br>  <b>Update:</b> 22.03.2019, Der Broker hat die Hauptversion 3.0.0 auf Google Play eingeführt, in der immer noch Gewinnmitnahmen / Stop-Loss angezeigt werden. <br><a name="habracut"></a><br>  Warum habe ich beschlossen, diesen Artikel hier zu schreiben?  Es schien mir, dass die Tinkoff Bank und ihre Produkte bei IT-Mitarbeitern sehr beliebt sind, und vielleicht hat jemand das gleiche Bedürfnis, aber es gibt keinen Wunsch oder keine Zeit, ein Fahrrad anzulegen.  Deshalb teile ich meine. <br><br>  Zunächst - über die alternativen Möglichkeiten, die der Broker selbst bietet. <br>  Erstens hat Tinkoff Limit Orders, die im Februar 2019 erschienen sind (sie haben zwei Jahre gewartet, keine Witze!), Aber sie arbeiten innerhalb eines Tages und, schlimmer noch, in einem kleinen Geldintervall, was zu Unannehmlichkeiten auf dem volatilen Markt führt.  Es ist einfach unmöglich, Werte festzulegen, die kleiner (mehr) als ein bestimmter Schwellenwert sind, der aus aktuellen Anführungszeichen berechnet wird.  Nun, es ist wahrscheinlich unmöglich, mehr als eine Limit-Bestellung anzufordern (wenn ich versuche, die erste Bestellung zu speichern, stürzt die mobile Anwendung immer ab, aber die Website verfügt nicht über solche Funktionen). <br>  Zweitens können Sie in ihrer mobilen Anwendung eine Preisänderung abonnieren, indem Sie einen absoluten Schwellenwert oder Schwellenwert für eine prozentuale Änderung (Erhöhung oder Verringerung) festlegen. Sie können jedoch nur einen Schwellenwert pro Asset festlegen. <br><br>  Die Logik meines Fahrrads ist einfach: <br>  1) Wir haben Schwellenwerte (im Folgenden - Schwellenwerte) für unser Wertpapier (Vermögenswert), für die wir eine manuelle Gewinn- / Stop-Loss-Aktion durchführen müssen.  Schwellenwerte werden unabhängig vom Kaufpreis des Vermögenswerts berechnet. <br>  2) Wir müssen die Daten des aktuellen Preises des Vermögenswerts von irgendwoher analysieren. <br>  3) Senden Sie sich eine Benachrichtigung, wenn einer der Schwellenwerte erreicht wurde. <br>  Trotz der einfachen Beschreibung gibt es Nuancen in der Implementierung :) <br><br>  1) Während mein Portfolio aus einem Asset bestand, habe ich Schwellenwerte direkt im Hauptteil des Skripts festgelegt, und die Papiersuche wurde nicht einmal als Variable, sondern lediglich als magische Linie durchgeführt.  Schlechte Entscheidung, aber genug, um die Idee zu testen.  Als sich das Portfolio diversifizierte, erstellte ich eine Datei, in der die Wertpapiere geladen wurden, an den Börsen, an denen sie gehandelt werden, und Schwellenwerte. <br><br>  2) Da es sich bei meinem Vermögenswert um ein ausländisches Wertpapier handelt, das an der St. Petersburg Exchange gehandelt wird, habe ich mich zunächst entschlossen, Daten von der St. Petersburg Exchange-Website auf der folgenden Seite zu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">analysieren</a> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">spbexchange.ru/ru/market-data/Default.aspx</a> <br>  Die Sortierung an der St. Petersburg Stock Exchange erfolgt nach dem Handelsvolumen, und meine Sicherheit war immer auf der ersten Seite.  Es hat super funktioniert, aber am 8. März ist alles kaputt gegangen.  Aus irgendeinem Grund befand sich TSLA bereits auf Seite 25, und der Paginator lädt die Daten dynamisch über JS.  Dieses Problem kann "frontal" gelöst werden: Analysieren Sie alle Seiten, bis wir unser Asset gefunden haben.  Dieser Ansatz ist jedoch nicht sehr effektiv, wenn wir die Ausführungszeit der Skriptschleife berücksichtigen.  Stattdessen habe ich beschlossen, das Parsen von tradeview.com hinzuzufügen.  Es ist nicht erforderlich, lange Listen auf mehr Seiten zu schaufeln.  Dort hat jedes Asset so etwas wie diesen Link: <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">www.tradingview.com/symbols/NASDAQ-TSLA</a> <br>  Es schien mir, dass alles schnell und einfach beginnen sollte, aber es gab ein Problem - die für mich interessanten Daten werden über JS geladen und die üblichen Anfragen konnten damit nicht fertig werden. <br>  Dieses Problem hat drei mir bekannte Lösungen: <br>  PyQT, Selen (Webdriver) und die Requests-HTML-Erweiterung.  Da ich bereits Anfragen im Projekt hatte, wurde beschlossen, eine eigene Erweiterung zu verwenden. <br>  Leider funktionierte diese Lösung nicht sehr stabil, ich musste nach Lösungen suchen. <br><pre><code class="python hljs">session = HTMLSession() r = session.get(url) my = r.html.render(timeout=<span class="hljs-number"><span class="hljs-number">30</span></span>) selector = <span class="hljs-string"><span class="hljs-string">'span.tv-symbol-header-quote__value.tv-symbol-header-quote__value--large.js-symbol-last'</span></span> price = r.html.find(selector)[<span class="hljs-number"><span class="hljs-number">0</span></span>].text r.close() session.close()</code> </pre> <br>  Beachten Sie das Timeout sowie die Aufrufe der Methode close ().  Sie sind nicht in allen Beispielen zu finden, aber es funktioniert besser mit ihnen als ohne sie. <br><br>  3) Wir registrieren uns bei einem Dienst, der SMS (sms.ru) senden, deren API übernehmen und einen Schlüssel erstellen kann.  Bis zu 5 SMS pro Tag - kostenlos.  Genug für mich. <br>  Der Schlüssel sieht so aus: <br>  24A41EA5-EEEE-Priv-5555-094143C2EDDD <br>  Das Senden von SMS in den ersten Versionen wurde folgendermaßen implementiert: <br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">send_message</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mymessage)</span></span></span><span class="hljs-function">:</span></span> sms_url = <span class="hljs-string"><span class="hljs-string">'https://sms.ru/sms/send?api_id=key&amp;to=number&amp;msg=message&amp;json=1'</span></span> sms_url = sms_url.replace(<span class="hljs-string"><span class="hljs-string">'key'</span></span>, mykey) sms_url = sms_url.replace(<span class="hljs-string"><span class="hljs-string">'number'</span></span>, mynumber) sms_url = sms_url.replace(<span class="hljs-string"><span class="hljs-string">'message'</span></span>, mymessage) sms_response = requests.get(sms_url)</code> </pre> <br><br>  Während der Entwicklung stellte sich folgende Frage: Was tun, wenn wir dem Benutzer bereits eine SMS über das Überschreiten des Schwellenwerts gesendet haben?  Es gab zwar keine Schecks, aber es wurde erneut eine SMS gesendet.  Jedes Mal.  Ziemlich schnell „aß“ man das freie Limit und begann zu überlegen, was man damit anfangen sollte.  Ich musste einen Zähler für gesendete SMS (sms_counter) hinzufügen, den wir überprüfen, bevor wir send_message aufrufen. <br><br><pre> <code class="python hljs"> <span class="hljs-keyword"><span class="hljs-keyword">global</span></span> sms_counter sms_counter = sms_counter + <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> <br><br>  Eine weitere Frage wird gestellt: Hervorragend, während der Handelssitzung verarbeiten wir eine Schwellenüberschreitung mit einem bestimmten Vermögenswert, und dies passt zu uns.  Was tun für die nächste Handelssitzung?  Es wurde beschlossen, den Zähler der gesendeten SMS zurückzusetzen.  Es gab drei Möglichkeiten: Daten in der Datenbank zu speichern (aber ich habe derzeit eine zustandslose Anwendung), Zeit / Datum zu analysieren oder das Skript neu zu starten.  Bisher mache ich die dritte Option, aber in Zukunft werde ich zur zweiten oder ersten Option übergehen. <br><br>  Jetzt ist die Lösung bereits betriebsbereit und kann von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Github</a> heruntergeladen werden <br>  Für Benutzer, die nicht verstehen, was Python ist und wie es konfiguriert wird, empfehle ich, eine Paketlösung <a href="">für Windows</a> zu starten <br><br>  Pläne für die weitere Entwicklung: <br>  1) Datum / Uhrzeit analysieren, um den SMS-Zähler zurückzusetzen (anstatt das Skript neu zu starten); <br>  2) Jetzt ist es eine zustandslose Anwendung, aber ich beabsichtige, die Datenbank zu verschrauben. <br>  3) Nach Punkt 2 möchte ich die Verfolgung starker Sprünge bei Preiserhöhungen / -senkungen im Vergleich zum Schlusskurs des Vortages hinzufügen. <br>  4) Erweitern Sie die Kommunikationsmöglichkeiten: mehr Pfade (Telegramm, Viber, Sprachanrufe, andere Optionen) und Anbieter (ich beabsichtige, smsc.ru hinzuzufügen, da sms.ru manchmal die Reaktionsfähigkeit verliert und zwar SMS sendet, das Skript jedoch nicht ausgeführt wird weiter bis wir sms_response bekommen). </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de442734/">https://habr.com/ru/post/de442734/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de442722/index.html">Stoppen Sie das Herunterladen und Speichern von Nullen</a></li>
<li><a href="../de442724/index.html">Der Film „Office Space“ ist 20 Jahre alt: Wie er unsere Jobs verändert hat</a></li>
<li><a href="../de442726/index.html">Der MIT-Gepardenroboter kann Backflips ausführen und schnell laufen</a></li>
<li><a href="../de442730/index.html">Microsoft: Russland ist den USA und Europa bei der Implementierung künstlicher Intelligenz voraus</a></li>
<li><a href="../de442732/index.html">Meine kleinen Staffeln: Triple Brainfuck oder What Is Madness</a></li>
<li><a href="../de442736/index.html">6 Brettspiele zum Leveln von Englisch</a></li>
<li><a href="../de442738/index.html">Profiling und Tracing mit perf</a></li>
<li><a href="../de442740/index.html">Reverse Engineering im Binärformat am Beispiel von Korg SNG-Dateien. Teil 2</a></li>
<li><a href="../de442742/index.html">Compaq LTE 5000 Notebook, Teil zweieinhalb - Bonus</a></li>
<li><a href="../de442744/index.html">RIPE-Lösung und ihre Folgen für den Ausschluss von zwei russischen LIRs (Netup, gcxc.net)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>