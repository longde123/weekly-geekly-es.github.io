<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>✊ 🍔 👧🏾 Bereaksi, JSX, impor modul ES (termasuk dinamis) di browser tanpa Webpack 🤙 🌥️ 📥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Artikel ini adalah upaya untuk menyatukan alat yang tersedia saat ini dan mencari tahu apakah mungkin untuk membuat aplikasi siap produksi di Bereaksi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Bereaksi, JSX, impor modul ES (termasuk dinamis) di browser tanpa Webpack</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/474672/"><p>  Artikel ini adalah upaya untuk menyatukan alat yang tersedia saat ini dan mencari tahu apakah mungkin untuk membuat aplikasi siap produksi di Bereaksi tanpa kompilasi awal oleh kolektor seperti Webpack, atau setidaknya meminimalkan kompilasi tersebut. </p><br><p>  Semuanya dijelaskan sangat eksperimental dan saya sengaja mengambil jalan pintas.  Dalam hal apapun saya tidak merekomendasikan melakukan sesuatu seperti ini pada produksi nyata. </p><br><p> Kemampuan untuk menggunakan modul ECMAScript ( <code>&lt;script type="module"/&gt;</code> dengan impor formulir <code>import Foo from './foo';</code> dan <code>import('./Foo')</code> ) secara langsung di peramban bukan hal yang baru dalam waktu yang lama, fungsi yang didukung dengan baik: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">https: //caniuse.com/#feat=es6-module</a> . </p><br><p>  Namun pada kenyataannya, kami mengimpor tidak hanya modul kami, tetapi juga perpustakaan.  Ada artikel yang bagus tentang topik ini: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">https://salomvary.com/es6-modules-in-browsers.html</a> .  Dan artikel lain yang juga layak disebut adalah <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">https://github.com/stken2050/esm-bundlerless</a> . </p><br><p>  Di antara hal-hal penting lainnya dari artikel ini, poin-poin ini paling penting untuk membuat aplikasi Bereaksi: </p><br><ul><li>  Dukungan untuk impor penentu paket (atau impor peta): ketika kami menulis <code>import React from 'react'</code> sebenarnya kami harus mengimpor sesuatu seperti ini <code>https://cdn.com/react/react.production.js</code> </li><li>  Dukungan untuk UMD: React masih didistribusikan sebagai UMD dan saat ini penulis belum sepakat tentang bagaimana mendistribusikan perpustakaan sebagai modul </li><li>  Jsx </li><li>  Impor CSS </li></ul><br><p>  Mari kita lihat semua poin pada gilirannya. </p><a name="habracut"></a><br><h1 id="struktura-proekta">  Struktur proyek </h1><br><p>  Pertama-tama, kami akan menentukan struktur proyek: </p><br><ul><li>  <code>node_modules</code> jelas di sinilah dependensi akan diletakkan </li><li>  direktori <code>src</code> dengan <code>index*.html</code> dan skrip layanan <br><ul><li>  kode aplikasi langsung aplikasi pada Bereaksi </li></ul></li></ul><br><h1 id="podderzhka-package-specifier-imports">  Dukungan impor specifier paket </h1><br><p>  Untuk menggunakan Bereaksi melalui <code>import React from 'react';</code>  kita harus memberi tahu browser tempat mencari sumber yang sebenarnya, karena  <code>react</code> bukan file nyata, tetapi penunjuk ke perpustakaan.  Ada tulisan rintisan untuk <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">https://github.com/guybedford/es-module-shims</a> ini. </p><br><p>  Mari kita mengatur rintisan dan Bereaksi: </p><br><pre> <code class="bash hljs">$ npm i es-module-shims react react-dom --save</code> </pre> <br><p>  Kami akan memulai aplikasi dari file <code>public/index-dev.html</code> : </p><br><pre> <code class="html hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"root"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">defer</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"../node_modules/es-module-shims/dist/es-module-shims.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"importmap-shim"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="actionscript"><span class="actionscript"> { </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">"imports"</span></span></span><span class="actionscript">: { </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">"react"</span></span></span><span class="actionscript">: </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">"../node_modules/react/umd/react.development.js"</span></span></span><span class="actionscript">, </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">"react-dom"</span></span></span><span class="actionscript">: </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">"../node_modules/react-dom/umd/react-dom.development.js"</span></span></span><span class="actionscript"> } } </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"module-shim"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="actionscript"><span class="actionscript"> </span><span class="hljs-meta"><span class="hljs-meta-keyword"><span class="actionscript"><span class="hljs-meta"><span class="hljs-meta-keyword">import</span></span></span></span><span class="actionscript"><span class="hljs-meta"> './app/index.jsx';</span></span></span><span class="actionscript"> </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Di mana <code>src/app/index.jsx</code> terlihat seperti ini: </p><br><pre> <code class="plaintext hljs">import React from 'react'; import ReactDOM from 'react-dom'; import './index.css'; (async () =&gt; { const {Button} = await import('./Button.jsx'); const root = document.getElementById('root'); ReactDOM.render(( &lt;div&gt; &lt;Button&gt;Direct&lt;/Button&gt; &lt;/div&gt; ), root); })();</code> </pre> <br><p>  Dan <code>src/app/Button.jsx</code> menyukai ini: </p><br><pre> <code class="plaintext hljs">import React from 'react'; export const Button = ({children}) =&gt; &lt;button&gt;{children}&lt;/button&gt;;</code> </pre> <br><p>  Akankah ini berhasil?  Tentu saja tidak.  Bahkan terlepas dari kenyataan bahwa semuanya berhasil diimpor dari mana diperlukan. </p><br><p>  Mari kita beralih ke masalah selanjutnya. </p><br><h1 id="podderzhka-umd">  Dukungan UMD </h1><br><h2 id="dinamicheskiy-sposob">  Cara yang dinamis </h2><br><p>  Berdasarkan fakta bahwa Bereaksi didistribusikan sebagai UMD, itu tidak dapat diimpor secara langsung, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">bahkan melalui rintisan</a> (jika tiket ditutup karena diperbaiki, Anda dapat melewati langkah).  Kita perlu menambal sumbernya agar menjadi kompatibel. </p><br><p>  Artikel di atas mendorong saya untuk menggunakan Pekerja Layanan untuk ini, yang dapat mencegat dan memodifikasi permintaan dan respons jaringan.  Mari kita buat entry point utama <code>src/index.js</code> , di mana kita akan mengkonfigurasi SW dan App dan menggunakannya daripada langsung memanggil aplikasi ( <code>src/app/index.jsx</code> ): </p><br><pre> <code class="plaintext hljs">(async () =&gt; { try { const registration = await navigator.serviceWorker.register('sw.js'); await navigator.serviceWorker.ready; const launch = async () =&gt; import("./app/index.jsx"); //   SW       // https://developers.google.com/web/fundamentals/primers/service-workers/lifecycle#clientsclaim if (navigator.serviceWorker.controller) { await launch(); } else { navigator.serviceWorker.addEventListener('controllerchange', launch); } } catch (error) { console.error('Service worker registration failed', error); } })();</code> </pre> <br><p>  Buat Pekerja Layanan ( <code>src/sw.js</code> ): </p><br><pre> <code class="plaintext hljs">//         //@see https://developers.google.com/web/fundamentals/primers/service-workers/lifecycle#clientsclaim self.addEventListener('activate', event =&gt; event.waitUntil(clients.claim())); const globalMap = { 'react': 'React', 'react-dom': 'ReactDOM' }; const getGlobalByUrl = (url) =&gt; Object.keys(globalMap).reduce((res, key) =&gt; { if (res) return res; if (matchUrl(url, key)) return globalMap[key]; return res; }, null); const matchUrl = (url, key) =&gt; url.includes(`/${key}/`); self.addEventListener('fetch', (event) =&gt; { const {request: {url}} = event; console.log('Req', url); const fileName = url.split('/').pop(); const ext = fileName.includes('.') ? url.split('.').pop() : ''; if (!ext &amp;&amp; !url.endsWith('/')) { url = url + '.jsx'; } if (globalMap &amp;&amp; Object.keys(globalMap).some(key =&gt; matchUrl(url, key))) { event.respondWith( fetch(url) .then(response =&gt; response.text()) .then(body =&gt; new Response(` const head = document.getElementsByTagName('head')[0]; const script = document.createElement('script'); script.setAttribute('type', 'text/javascript'); script.appendChild(document.createTextNode( ${JSON.stringify(body)} )); head.appendChild(script); export default window.${getGlobalByUrl(url)}; `, { headers: new Headers({ 'Content-Type': 'application/javascript' }) }) ) ) } else if (url.endsWith('.js')) { // rewrite for import('./Panel') with no extension event.respondWith( fetch(url) .then(response =&gt; response.text()) .then(body =&gt; new Response( body, { headers: new Headers({ 'Content-Type': 'application/javascript' }) }) ) ) } });</code> </pre> <br><p>  Untuk meringkas apa yang telah dilakukan: </p><br><ol><li>  Kami membuat peta ekspor yang mengaitkan nama paket dengan variabel global </li><li>  Buat tag skrip di <code>head</code> dengan isi skrip yang dibungkus dengan UMD </li><li>  Variabel global yang diekspor sebagai ekspor default </li></ol><br><p>  Untuk demo, tambalan brutal seperti itu sudah cukup, tetapi ini mungkin tidak berfungsi dengan semua pembungkus UMD.  Sebagai gantinya, <a href="">sesuatu yang lebih</a> dapat <a href="">diandalkan</a> dapat digunakan. </p><br><p>  Sekarang ubah <code>src/index-dev.html</code> untuk menggunakan skrip konfigurasi: </p><br><pre> <code class="html hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"root"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">defer</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"../node_modules/es-module-shims/dist/es-module-shims.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"importmap-shim"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"><span class="undefined">...    </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--  app/index.jsx  index.js --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"module-shim"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"index.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Sekarang kita dapat mengimpor Bereaksi dan Bereaksi DOM. </p><br><h2 id="staticheskiy-put">  Jalur statis </h2><br><p>  Perlu dicatat bahwa ada cara lain.  Ada membangun ES tidak resmi dari React: </p><br><pre> <code class="bash hljs">npm install esm-react --save</code> </pre> <br><p>  Peta impor akan terlihat seperti ini: </p><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"imports"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"react"</span></span>: <span class="hljs-string"><span class="hljs-string">"../node_modules/esm-react/src/react.js"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"react-dom"</span></span>: <span class="hljs-string"><span class="hljs-string">"../node_modules/esm-react/src/react-dom.js"</span></span> } }</code> </pre> <br><p>  Namun sayangnya proyek ini sangat jauh ketinggalan, versi terbaru adalah <code>16.8.3</code> sedangkan React sudah <code>16.10.2</code> . </p><br><h1 id="jsx">  Jsx </h1><br><p>  Ada dua cara untuk mengkompilasi JSX.  Kita dapat pra-merakit Babel tradisional dari konsol, atau ini bisa dilakukan di browser runtime.  Untuk produksi itu sendiri, pra-kompilasi lebih disukai, tetapi dalam mode pengembangan dimungkinkan dalam runtime.  Karena kami sudah memiliki Pekerja Layanan, kami akan menggunakannya. </p><br><p>  Instal paket khusus dengan Babel: </p><br><pre> <code class="bash hljs">$ npm install @babel/standalone --save-dev</code> </pre> <br><p>  Sekarang tambahkan berikut ini ke Pekerja Layanan ( <code>src/sw.js</code> ): </p><br><pre> <code class="plaintext hljs"># src/sw.js //     importScripts('../node_modules/@babel/standalone/babel.js'); //     self.addEventListener('fetch', (event) =&gt; { //       } else if (url.endsWith('.jsx')) { event.respondWith( fetch(url) .then(response =&gt; response.text()) .then(body =&gt; new Response( //TODO  Babel.transform(body, { presets: [ 'react', ], plugins: [ 'syntax-dynamic-import' ], sourceMaps: true }).code, { headers: new Headers({ 'Content-Type': 'application/javascript' }) }) ) ) } });</code> </pre> <br><p>  Di sini kami menggunakan pendekatan yang sama dengan memotong permintaan jaringan dan menulis ulang, kami menggunakan Babel untuk mengubah kode sumber asli.  Harap dicatat bahwa plugin untuk impor dinamis disebut <code>syntax-dynamic-import</code> , tidak seperti biasa <code>@babel/plugin-syntax-dynamic-import</code> karena ini adalah versi Standalone. </p><br><h1 id="css">  CSS </h1><br><p>  Dalam artikel yang disebutkan, penulis menggunakan transformasi teks, kami akan melangkah lebih jauh dan menanamkan CSS pada halaman.  Untuk melakukan ini, kami akan kembali menggunakan Pekerja Layanan ( <code>src/sw.js</code> ): </p><br><pre> <code class="plaintext hljs">//     self.addEventListener('fetch', (event) =&gt; { //      +  } else if (url.endsWith('.css')) { event.respondWith( fetch(url) .then(response =&gt; response.text()) .then(body =&gt; new Response( ` const head = document.getElementsByTagName('head')[0]; const style = document.createElement('style'); style.setAttribute('type', 'text/css'); style.appendChild(document.createTextNode( ${JSON.stringify(body)} )); head.appendChild(style); export default null; `, { headers: new Headers({ 'Content-Type': 'application/javascript' }) }) ) ); } });</code> </pre> <br><p>  Voila!  Jika sekarang kita membuka <code>src/index-dev.html</code> di browser, kita akan melihat tombol.  Pastikan bahwa Pekerja Servis yang diperlukan telah diinstal dan tidak bertentangan dengan apa pun.  Jika Anda tidak yakin, maka untuk berjaga-jaga, Anda dapat membuka Alat Dev, masuk ke <code>Application</code> , di sana di <code>Service Workers</code> , dan klik <code>Unregister</code> untuk semua pekerja terdaftar, lalu muat ulang halaman. </p><br><h1 id="prodakshen">  Produksi </h1><br><p>  Kode di atas berfungsi sebagaimana mestinya dalam mode pengembangan, tetapi dengan sendirinya kami tidak ingin memaksa pengguna situs untuk mengkompilasi kode di browser mereka, ini sama sekali tidak praktis.  Mari kita membuat semacam mode produksi minimalis. </p><br><p>  Buat titik masuk <code>src/index.html</code> terpisah: </p><br><pre> <code class="html hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"root"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"module"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"index.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Seperti yang Anda lihat, tidak ada stubs di sini, kami akan menggunakan metode lain untuk menulis ulang nama paket.  Karena kita membutuhkan Babel untuk mengkompilasi JSX lagi, kita akan menggunakannya untuk <code>importMap.json</code> path daripada <code>importMap.json</code> untuk rintisan.  Instal paket yang diperlukan: </p><br><pre> <code class="bash hljs">$ npm install @babel/cli @babel/core @babel/preset-react @babel/plugin-syntax-dynamic-import babel-plugin-module-resolver --save-dev</code> </pre> <br><p>  Tambahkan bagian dengan skrip ke <code>package.json</code> : </p><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"scripts"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"start"</span></span>: <span class="hljs-string"><span class="hljs-string">"npm run build -- --watch"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"build"</span></span>: <span class="hljs-string"><span class="hljs-string">"babel src/app --out-dir build/app --source-maps --copy-files"</span></span> } }</code> </pre> <br><p>  Tambahkan file <code>.babelrc.js</code> : </p><br><pre> <code class="plaintext hljs">module.exports = { presets: [ '@babel/preset-react' ], plugins: [ '@babel/plugin-syntax-dynamic-import', [ 'babel-plugin-module-resolver', { alias: { 'react': './node_modules/react/umd/react.development.js', 'react-dom': './node_modules/react-dom/umd/react-dom.development.js' }, //       build resolvePath: (sourcePath, currentFile, opts) =&gt; resolvePath(sourcePath, currentFile, opts).replace('../../', '../') } ] ] }</code> </pre> <br><p>  Harus diingat bahwa file ini hanya akan digunakan untuk produksi, dalam mode pengembangan kami mengkonfigurasi Babel di Pekerja Layanan. </p><br><p>  Tambahkan mode tempur ke Pekerja Servis: </p><br><pre> <code class="plaintext hljs">// src/index.js if ('serviceWorker' in navigator) { (async () =&gt; { try { //   const production = !window.location.toString().includes('index-dev.html'); const config = { globalMap: { 'react': 'React', 'react-dom': 'ReactDOM' }, production }; const registration = await navigator.serviceWorker.register('sw.js?' + JSON.stringify(config)); await navigator.serviceWorker.ready; const launch = async () =&gt; { if (production) { await import("./app/index.js"); } else { await import("./app/index.jsx"); } }; // https://developers.google.com/web/fundamentals/primers/service-workers/lifecycle#clientsclaim if (navigator.serviceWorker.controller) { await launch(); } else { navigator.serviceWorker.addEventListener('controllerchange', launch); } } catch (error) { console.error('Service worker registration failed', error); } })(); } else { alert('Service Worker is not supported'); }</code> </pre> <br><p>  Tambahkan ketentuan ke <code>src/sw.js</code> : </p><br><pre> <code class="plaintext hljs">// src/sw.js const {globalMap, production} = JSON.parse((decodeURIComponent(self.location.search) || '?{}').substr(1)); if (!production) importScripts('../node_modules/@babel/standalone/babel.js');</code> </pre> <br><p>  Ganti </p><br><pre> <code class="plaintext hljs">// src/sw.js if (!ext &amp;&amp; !url.endsWith('/')) { url = url + '.jsx' with }</code> </pre> <br><p>  Aktif </p><br><pre> <code class="plaintext hljs">// src/sw.js if (!ext &amp;&amp; !url.endsWith('/')) { url = url + '.' + (production ? 'js' : 'jsx'); }</code> </pre> <br><p>  Mari kita membuat skrip konsol <code>build.sh</code> (orang-orang dengan Windows dapat membuat yang sama untuk Windows dalam gambar dan rupa) yang akan mengumpulkan semua yang Anda butuhkan ke direktori <code>build</code> : </p><br><pre> <code class="plaintext hljs">#  rm -rf build #   mkdir -p build/scripts mkdir -p build/node_modules #   cp -r ./node_modules/react ./build/node_modules/react cp -r ./node_modules/react-dom ./build/node_modules/react-dom #  ,      cp ./src/*.js ./build cp ./src/index.html ./build/index.html #  npm run build</code> </pre> <br><p>  Kita pergi dengan cara ini sehingga direktori <code>node_modules</code> tidak membengkak pada produksi dari dependensi yang dibutuhkan hanya dalam fase pembangunan dan dalam mode pengembangan. </p><br><p>  Gudang final: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">http://github.com/kirill-konshin/pure-react-with-dynamic-imports</a> </p><br><p>  Jika sekarang kita buka <code>build/index.html</code> maka kita akan melihat output yang sama seperti di <code>src/index-dev.html</code> tetapi kali ini browser tidak akan mengumpulkan apa-apa, itu akan menggunakan file yang sebelumnya dikumpulkan oleh Babel. </p><br><p>  Seperti yang Anda lihat, ada duplikasi dalam solusinya: <code>importMap.json</code> , <code>alias</code> bagian dari file <code>.babelrc.js</code> dan daftar file yang akan disalin ke <code>build.sh</code> .  Ini akan berfungsi untuk demo, tetapi secara umum itu harus otomatis. </p><br><p>  Majelis tersedia di: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">https://kirill-konshin.github.io/pure-react-with-dynamic-imports/index.html</a> </p><br><h1 id="zaklyuchenie">  Kesimpulan </h1><br><p>  Secara umum, produk yang benar-benar layak diperoleh, meskipun sangat mentah. </p><br><p>  HTTP2 seharusnya menangani banyak file kecil yang dikirim melalui jaringan. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Repositori tempat Anda dapat melihat kode</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id474672/">https://habr.com/ru/post/id474672/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id474658/index.html">Nyeri pergelangan tangan dan mouse komputer</a></li>
<li><a href="../id474662/index.html">Beta Test: Devdiction for Developers - sebuah platform untuk belajar bahasa Inggris</a></li>
<li><a href="../id474664/index.html">Untuk meningkatkan perhatian, otak kita tidak meningkatkan konsentrasi, tetapi menggunakan filter informasi</a></li>
<li><a href="../id474666/index.html">Bagaimana tidak menulis ulang proyek di Rust</a></li>
<li><a href="../id474668/index.html">GitHub Berfungsi sebagai CI / CD untuk situs pada generator statis dan GitHub Pages</a></li>
<li><a href="../id474674/index.html">Visi mesin dan obat-obatan</a></li>
<li><a href="../id474676/index.html">Algoritma interaksi ratusan ribu partikel unik pada GPU, dalam GLES3 dan WebGL2</a></li>
<li><a href="../id474678/index.html">Khronos Group telah membuat repositori terpadu dengan contoh-contoh Vulkan</a></li>
<li><a href="../id474680/index.html">AI dan 2048. Bagian 2: Minimax + alpha beta clipping</a></li>
<li><a href="../id474686/index.html">Kisah fantastis "Keselamatan" (10 mnt)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>