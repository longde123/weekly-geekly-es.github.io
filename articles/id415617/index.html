<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©‚Äç‚öñÔ∏è üêû üï∫üèΩ Menggunakan Perpustakaan FPC InternetPCools di Delphi üë®üèø‚Äçüç≥ ‚ù£Ô∏è üÖ±Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bahkan, artikelnya agak lebih luas - itu menggambarkan cara untuk menggunakan banyak perpustakaan lain secara transparan (dan tidak hanya dari dunia F...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Menggunakan Perpustakaan FPC InternetPCools di Delphi</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/415617/">  Bahkan, artikelnya agak lebih luas - itu menggambarkan cara untuk menggunakan banyak perpustakaan lain secara <i>transparan</i> (dan tidak hanya dari dunia <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Free Pascal</a> ), dan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">InternetTools</a> dipilih karena propertinya yang luar biasa - inilah kasus ketika (secara mengejutkan) tidak ada Versi delphi dengan fitur dan kegunaan yang sama. <br><br>  Perpustakaan ini dirancang untuk mengekstraksi informasi (parsing) dari dokumen web (XML dan HTML), memungkinkan Anda untuk menggunakan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">bahasa permintaan tingkat tinggi</a> seperti <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">XPath</a> dan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">XQuery</a> untuk menunjukkan data yang diperlukan, dan, sebagai opsi, menyediakan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">akses langsung</a> ke elemen pohon yang dibangun di atas dokumen. <br><a name="habracut"></a><br><h2>  Pengantar InternetTools </h2><br>  Materi lebih lanjut akan diilustrasikan berdasarkan tugas yang agak sederhana, yang menyiratkan mendapatkan elemen-elemen dari daftar berpoin dan bernomor dari artikel ini yang berisi tautan, yang, jika Anda melihat pada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">dokumentasi</a> , kode sekecil itu sudah cukup (dibangun atas dasar contoh kedua dari belakang dengan perubahan kecil tanpa prinsip) ): <br><br><a name="FirstTask"></a><pre><code class="delphi hljs"><span class="hljs-keyword"><span class="hljs-keyword">uses</span></span> xquery; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ArticleURL = <span class="hljs-string"><span class="hljs-string">'https://habr.com/post/415617'</span></span>; ListXPath = <span class="hljs-string"><span class="hljs-string">'//div[@class="post__body post__body_full"]//li[a]'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ListValue: IXQValue; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ListValue <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> xqvalue(ArticleURL).retrieve.map(ListXPath) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> Writeln(ListValue.toString); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>.</code> </pre> <br>  Namun, sekarang kode yang ringkas dan berorientasi objek ini hanya dapat ditulis dalam Free Pascal, tetapi kita harus dapat menggunakan segala yang disediakan oleh perpustakaan ini dalam aplikasi Delphi, dan lebih disukai dalam gaya yang sama, dengan fasilitas yang sama;  Penting juga untuk dicatat bahwa InternetTools <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">aman dari utas</a> (mengaksesnya diizinkan dari banyak utas pada saat yang bersamaan), jadi opsi kami harus menyediakan ini. <br><br><h2>  Metode implementasi </h2><br>  Jika Anda mendekati tugas sejauh mungkin, maka ada beberapa cara untuk menggunakan sesuatu yang ditulis dalam <abbr title="Bahasa Pemrograman">bahasa</abbr> lain - mereka akan membentuk 3 kelompok besar: <br><br><ol><li>  Menempatkan pustaka dalam <b>proses terpisah</b> yang file yang dapat dieksekusi dibuat secara paksa, dalam hal ini, <abbr title="Kompilator pascal gratis">FPC</abbr> .  Metode ini juga dapat dibagi menjadi dua kategori untuk kemungkinan komunikasi jaringan: <br><ul><li>  Area <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">komunikasi antar proses hanya</a> terbatas pada satu komputer.  Cara yang paling produktif (tingkat rendah bersyarat), yang dimaksudkan untuk jenis pertukaran ini, termasuk <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">memori bersama</a> dan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">saluran yang tidak disebutkan namanya</a> . </li><li>  Proses dapat diakses melalui jaringan - ini disediakan oleh <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">pipa bernama</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">RPC</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">DCOM</a> , dll. </li></ul></li><li>  Mengenkapsulasi pustaka dalam <b>DLL</b> (selanjutnya disebut sebagai "pustaka dinamis"), bekerja, menurut definisi, dalam kerangka proses tunggal.  Meskipun objek COM <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">dapat ditempatkan</a> dalam DLL, artikel ini akan mempertimbangkan metode yang lebih sederhana dan tidak terlalu memakan waktu, yang memberikan, dengan semua ini, kenyamanan yang sama ketika memanggil fungsi perpustakaan. </li><li>  <b>Porting</b>  Seperti dalam kasus-kasus sebelumnya, kesesuaian pendekatan ini - menulis ulang kode ke dalam bahasa lain - ditentukan oleh keseimbangan antara pro dan kontra, tetapi dalam situasi dengan InternetTools, kerugian porting jauh lebih besar, yaitu: karena banyaknya kode perpustakaan, Anda perlu melakukan pekerjaan yang sangat serius (bahkan dengan mempertimbangkan kesamaan bahasa pemrograman), dan juga secara berkala, karena <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">pengembangan yang portabel</a> , tugas mentransfer koreksi dan fitur baru ke Delphi akan muncul. </li></ol><br><h2>  Dll </h2><br>  Lebih lanjut, untuk memberi pembaca kesempatan merasakan perbedaan, ada 2 opsi yang dibedakan berdasarkan kemudahan penggunaannya. <br><br><h3>  Implementasi "Klasik" </h3><br>  Mari kita mulai menggunakan InternetTools dengan gaya prosedural yang ditentukan oleh sifat perpustakaan dinamis yang hanya dapat mengekspor fungsi dan prosedur;  kami akan membuat cara berkomunikasi dengan DLL mirip dengan WinAPI, ketika pegangan sumber daya tertentu pertama kali diminta, setelah itu pekerjaan yang bermanfaat dilakukan, dan kemudian pegangan yang dihasilkan dihancurkan (ditutup).  Tidak perlu mempertimbangkan opsi ini sebagai panutan dalam segala hal - ia hanya dipilih untuk demonstrasi dan perbandingan selanjutnya dengan yang kedua - semacam kerabat yang miskin. <br><br>  Komposisi dan kepemilikan file dari solusi yang diusulkan akan terlihat seperti ini (panah menunjukkan dependensi): <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/dt/uv/8p/dtuv8pkm7bwa0_rvgnkhxouoc5i.png" alt="Komposisi file implementasi &quot;klasik&quot;" width="600"></div><br><br><h4>  Modul InternetTools.Types </h4><br>  Karena kedua bahasa - Delphi dan Free Pascal - sangat mirip dalam kasus ini, sangat masuk akal untuk memilih modul umum yang berisi jenis yang digunakan dalam daftar ekspor DLL, agar tidak menggandakan definisi mereka dalam aplikasi <code>InternetToolsUsage</code> , yang mencakup prototipe fungsi dari perpustakaan dinamis: <br><br><pre> <code class="delphi hljs"><span class="hljs-keyword"><span class="hljs-keyword">unit</span></span> InternetTools.Types; <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> TXQHandle = Integer; <span class="hljs-keyword"><span class="hljs-keyword">implementation</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>.</code> </pre> <br>  Dalam implementasi ini, hanya satu tipe bashful didefinisikan, tetapi di masa depan, modul akan "matang" dan kegunaannya akan menjadi tak terbantahkan. <br><br><h4>  Perpustakaan Dinamis InternetTools </h4><br>  Komposisi prosedur dan fungsi DLL dipilih minimal, tetapi cukup untuk implementasi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">tugas di</a> atas: <br><br><a name="ClassicLibrary"></a><pre> <code class="delphi hljs"><span class="hljs-keyword"><span class="hljs-keyword">library</span></span> InternetTools; <span class="hljs-keyword"><span class="hljs-keyword">uses</span></span> InternetTools.Types; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OpenDocument</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> URL: WideString)</span></span></span><span class="hljs-function">:</span></span> TXQHandle; <span class="hljs-keyword"><span class="hljs-keyword">stdcall</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> ... <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CloseHandle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Handle: TXQHandle)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">stdcall</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> ... <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Map</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Handle: TXQHandle; </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> XQuery: WideString)</span></span></span><span class="hljs-function">:</span></span> TXQHandle; <span class="hljs-keyword"><span class="hljs-keyword">stdcall</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> ... <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Count</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Handle: TXQHandle)</span></span></span><span class="hljs-function">:</span></span> Integer; <span class="hljs-keyword"><span class="hljs-keyword">stdcall</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> ... <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ValueByIndex</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Handle: TXQHandle; </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">Index</span></span></span></span><span class="hljs-function"><span class="hljs-params">: Integer)</span></span></span><span class="hljs-function">:</span></span> WideString; <span class="hljs-keyword"><span class="hljs-keyword">stdcall</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> ... <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">exports</span></span> OpenDocument, CloseHandle, Map, Count, ValueByIndex; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>.</code> </pre> <br>  Karena sifat demo dari implementasi saat ini, kode lengkap tidak diberikan - jauh lebih penting adalah bagaimana API paling sederhana ini akan digunakan nanti.  Di sini Anda tidak perlu melupakan persyaratan keamanan benang, yang, meskipun akan membutuhkan sedikit usaha, tetapi itu tidak akan menjadi sesuatu yang rumit. <br><br><h4>  Aplikasi InternetToolsUsage </h4><br>  Berkat persiapan sebelumnya, menjadi mungkin untuk menulis ulang <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">contoh daftar</a> di Delphi: <br><br><pre> <code class="delphi hljs"><span class="hljs-keyword"><span class="hljs-keyword">program</span></span> InternetToolsUsage; ... <span class="hljs-keyword"><span class="hljs-keyword">uses</span></span> InternetTools.Types; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> DLLName = <span class="hljs-string"><span class="hljs-string">'InternetTools.dll'</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OpenDocument</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> URL: WideString)</span></span></span><span class="hljs-function">:</span></span> TXQHandle; <span class="hljs-keyword"><span class="hljs-keyword">stdcall</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">external</span></span> DLLName; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CloseHandle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Handle: TXQHandle)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">stdcall</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">external</span></span> DLLName; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Map</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Handle: TXQHandle; </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> XQuery: WideString)</span></span></span><span class="hljs-function">:</span></span> TXQHandle; <span class="hljs-keyword"><span class="hljs-keyword">stdcall</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">external</span></span> DLLName; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Count</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Handle: TXQHandle)</span></span></span><span class="hljs-function">:</span></span> Integer; <span class="hljs-keyword"><span class="hljs-keyword">stdcall</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">external</span></span> DLLName; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ValueByIndex</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Handle: TXQHandle; </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">Index</span></span></span></span><span class="hljs-function"><span class="hljs-params">: Integer)</span></span></span><span class="hljs-function">:</span></span> WideString; <span class="hljs-keyword"><span class="hljs-keyword">stdcall</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">external</span></span> DLLName; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ArticleURL = <span class="hljs-string"><span class="hljs-string">'https://habr.com/post/415617'</span></span>; ListXPath = <span class="hljs-string"><span class="hljs-string">'//div[@class="post__body post__body_full"]//li[a]'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> RootHandle, ListHandle: TXQHandle; I: Integer; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> RootHandle := OpenDocument(ArticleURL); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> ListHandle := Map(RootHandle, ListXPath); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> I := <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> Count(ListHandle) - <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> Writeln( ValueByIndex(ListHandle, I) ); <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span> CloseHandle(ListHandle); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span> CloseHandle(RootHandle); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; ReadLn; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>.</code> </pre> <br>  Jika Anda tidak mempertimbangkan prototipe fungsi dan prosedur dari pustaka dinamis, maka Anda tidak dapat mengatakan bahwa kodenya lebih berat dibandingkan dengan versi pada Free Pascal, tetapi jika kami sedikit menyulitkan tugas dan mencoba memfilter beberapa elemen dan menampilkan alamat tautan yang terkandung dalam tersisa: <br><br><a name="SecondTask"></a><pre> <code class="delphi hljs"><span class="hljs-keyword"><span class="hljs-keyword">uses</span></span> xquery; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ArticleURL = <span class="hljs-string"><span class="hljs-string">'https://habr.com/post/415617'</span></span>; ListXPath = <span class="hljs-string"><span class="hljs-string">'//div[@class="post__body post__body_full"]//li[a]'</span></span>; HrefXPath = <span class="hljs-string"><span class="hljs-string">'./a/@href'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ListValue, HrefValue: IXQValue; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ListValue <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> xqvalue(ArticleURL).retrieve.map(ListXPath) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-comment"><span class="hljs-comment">{   }</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> HrefValue <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> ListValue.map(HrefXPath) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> Writeln(HrefValue.toString); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>.</code> </pre> <br>  Dimungkinkan untuk melakukan ini dengan API DLL saat ini, tetapi verbositas dari hasilnya sudah sangat tinggi, yang tidak hanya sangat mengurangi keterbacaan kode, tetapi juga (dan yang tidak kalah penting) memindahkannya dari yang di atas: <br><br><pre> <code class="delphi hljs"><span class="hljs-keyword"><span class="hljs-keyword">program</span></span> InternetToolsUsage; ... <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ArticleURL = <span class="hljs-string"><span class="hljs-string">'https://habr.com/post/415617'</span></span>; ListXPath = <span class="hljs-string"><span class="hljs-string">'//div[@class="post__body post__body_full"]//li[a]'</span></span>; HrefXPath = <span class="hljs-string"><span class="hljs-string">'./a/@href'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> RootHandle, ListHandle, HrefHandle: TXQHandle; I, J: Integer; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> RootHandle := OpenDocument(ArticleURL); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> ListHandle := Map(RootHandle, ListXPath); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> I := <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> Count(ListHandle) - <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-comment"><span class="hljs-comment">{   }</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> HrefHandle := Map(ListHandle, HrefXPath); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> J := <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> Count(HrefHandle) - <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> Writeln( ValueByIndex(HrefHandle, J) ); <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span> CloseHandle(HrefHandle); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span> CloseHandle(ListHandle); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span> CloseHandle(RootHandle); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; ReadLn; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>.</code> </pre> <br>  Jelas - dalam kasus nyata dan lebih kompleks, volume penulisan hanya akan tumbuh dengan cepat, dan oleh karena itu kami akan beralih ke solusi yang bebas dari masalah seperti itu. <br><br><h3>  Implementasi antarmuka </h3><br>  Gaya prosedural bekerja dengan perpustakaan, seperti yang baru saja ditunjukkan, adalah mungkin, tetapi memiliki kelemahan signifikan.  Karena fakta bahwa DLL mendukung penggunaan antarmuka (seperti tipe data yang diterima dan dikembalikan), Anda dapat mengatur kerja dengan InternetTools dengan cara yang sama nyamannya seperti ketika menggunakannya dengan Free Pascal.  Dalam hal ini, diinginkan untuk sedikit mengubah komposisi file untuk mendistribusikan deklarasi dan implementasi antarmuka menjadi modul terpisah: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ik/48/ki/ik48kioqk2f51pxpdscpsid-auo.png" alt="Komposisi file implementasi antarmuka" width="600"></div><br>  Seperti sebelumnya, kita akan memeriksa setiap file secara berurutan. <br><br><h4>  Modul InternetTools.Types </h4><br>  Mendeklarasikan antarmuka yang akan diterapkan di DLL: <br><br><a name="InternetTools_Types"></a><pre> <code class="delphi hljs"><span class="hljs-keyword"><span class="hljs-keyword">unit</span></span> InternetTools.Types; <span class="hljs-meta"><span class="hljs-meta">{$IFDEF FPC}</span></span> <span class="hljs-meta"><span class="hljs-meta">{$MODE Delphi}</span></span> <span class="hljs-meta"><span class="hljs-meta">{$ENDIF}</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> IXQValue = <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span>; IXQValueEnumerator = <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> [<span class="hljs-string"><span class="hljs-string">'{781B23DC-E8E8-4490-97EE-2332B3736466}'</span></span>] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MoveNext</span></span></span><span class="hljs-function">:</span></span> Boolean; <span class="hljs-keyword"><span class="hljs-keyword">safecall</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetCurrent</span></span></span><span class="hljs-function">:</span></span> IXQValue; <span class="hljs-keyword"><span class="hljs-keyword">safecall</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">property</span></span> Current: IXQValue <span class="hljs-keyword"><span class="hljs-keyword">read</span></span> GetCurrent; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; IXQValue = <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> [<span class="hljs-string"><span class="hljs-string">'{DCE33144-A75F-4C53-8D25-6D9BD78B91E4}'</span></span>] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetEnumerator</span></span></span><span class="hljs-function">:</span></span> IXQValueEnumerator; <span class="hljs-keyword"><span class="hljs-keyword">safecall</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OpenURL</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> URL: WideString)</span></span></span><span class="hljs-function">:</span></span> IXQValue; <span class="hljs-keyword"><span class="hljs-keyword">safecall</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Map</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> XQuery: WideString)</span></span></span><span class="hljs-function">:</span></span> IXQValue; <span class="hljs-keyword"><span class="hljs-keyword">safecall</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ToString</span></span></span><span class="hljs-function">:</span></span> WideString; <span class="hljs-keyword"><span class="hljs-keyword">safecall</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">implementation</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>.</code> </pre> <br>  Arahan kompilasi bersyarat diperlukan karena penggunaan modul tidak berubah di kedua proyek Delphi- dan FPC. <br><br>  Antarmuka <code>IXQValueEnumerator</code> pada prinsipnya opsional, namun, untuk dapat menggunakan loop dari bentuk " <code>for ... in ...</code> " sebagai <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">contoh</a> , Anda tidak dapat melakukannya tanpa itu;  antarmuka kedua adalah yang utama dan merupakan pembungkus analog lebih dari <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><code>IXQValue</code></a> dari InternetTools (itu dibuat khusus dengan nama yang sama untuk membuatnya lebih mudah untuk mengkorelasikan kode Delphi masa depan dengan dokumentasi perpustakaan pada Free Pascal).  Jika kita mempertimbangkan modul dalam hal pola desain, maka antarmuka yang dideklarasikan di dalamnya adalah <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">adaptor</a> , meskipun dengan fitur kecil - implementasinya terletak di perpustakaan yang dinamis. <br><br>  Kebutuhan untuk mengatur jenis panggilan panggilan masuk untuk semua metode dijelaskan dengan baik di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> .  Kewajiban untuk menggunakan <code>WideString</code> sebagai ganti string "asli" juga tidak akan dibuktikan, karena topik pertukaran struktur data dinamis dengan DLL berada di luar ruang lingkup artikel ini. <br><br><h4>  Modul InternetTools.Realization </h4><br>  Yang pertama dalam hal kepentingan dan volume - dialah yang, sebagaimana tercermin dalam judul, akan berisi implementasi antarmuka dari yang sebelumnya: untuk keduanya, satu-satunya kelas <code>TXQValue</code> , metode yang sangat sederhana sehingga hampir semua terdiri dari satu baris kode (ini cukup diharapkan, karena semua fungsi yang diperlukan sudah ada di perpustakaan - di sini Anda hanya perlu mengaksesnya): <br><br><pre> <code class="delphi hljs"><span class="hljs-keyword"><span class="hljs-keyword">unit</span></span> InternetTools.Realization; <span class="hljs-meta"><span class="hljs-meta">{$MODE Delphi}</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uses</span></span> xquery, InternetTools.Types; <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> IOriginalXQValue = xquery.IXQValue; <span class="hljs-title"><span class="hljs-title">TXQValue</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>(TInterfacedObject, IXQValue, IXQValueEnumerator) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> FOriginalXQValue: IOriginalXQValue; FEnumerator: TXQValueEnumerator; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MoveNext</span></span></span><span class="hljs-function">:</span></span> Boolean; <span class="hljs-keyword"><span class="hljs-keyword">safecall</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetCurrent</span></span></span><span class="hljs-function">:</span></span> IXQValue; <span class="hljs-keyword"><span class="hljs-keyword">safecall</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetEnumerator</span></span></span><span class="hljs-function">:</span></span> IXQValueEnumerator; <span class="hljs-keyword"><span class="hljs-keyword">safecall</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OpenURL</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> URL: WideString)</span></span></span><span class="hljs-function">:</span></span> IXQValue; <span class="hljs-keyword"><span class="hljs-keyword">safecall</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Map</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> XQuery: WideString)</span></span></span><span class="hljs-function">:</span></span> IXQValue; <span class="hljs-keyword"><span class="hljs-keyword">safecall</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ToString</span></span></span><span class="hljs-function">:</span></span> WideString; <span class="hljs-keyword"><span class="hljs-keyword">safecall</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">reintroduce</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">constructor</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Create</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> OriginalXQValue: IOriginalXQValue)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">overload</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SafeCallException</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ExceptObject: TObject; ExceptAddr: CodePointer)</span></span></span><span class="hljs-function">:</span></span> HResult; <span class="hljs-keyword"><span class="hljs-keyword">override</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">implementation</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uses</span></span> sysutils, comobj, w32internetaccess; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TXQValue</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MoveNext</span></span></span><span class="hljs-function">:</span></span> Boolean; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> Result := FEnumerator.MoveNext; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TXQValue</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetCurrent</span></span></span><span class="hljs-function">:</span></span> IXQValue; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> Result := TXQValue.Create(FEnumerator.Current); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TXQValue</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetEnumerator</span></span></span><span class="hljs-function">:</span></span> IXQValueEnumerator; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> FEnumerator := FOriginalXQValue.GetEnumerator; Result := Self; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TXQValue</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OpenURL</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> URL: WideString)</span></span></span><span class="hljs-function">:</span></span> IXQValue; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> FOriginalXQValue := xqvalue(URL).retrieve; Result := Self; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TXQValue</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Map</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> XQuery: WideString)</span></span></span><span class="hljs-function">:</span></span> IXQValue; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> Result := TXQValue.Create( FOriginalXQValue.map(XQuery) ); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TXQValue</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ToString</span></span></span><span class="hljs-function">:</span></span> WideString; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> Result := FOriginalXQValue.toJoinedString(LineEnding); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">constructor</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TXQValue</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Create</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> OriginalXQValue: IOriginalXQValue)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> FOriginalXQValue := OriginalXQValue; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TXQValue</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SafeCallException</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ExceptObject: TObject; ExceptAddr: CodePointer)</span></span></span><span class="hljs-function">:</span></span> HResult; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> Result := HandleSafeCallException(ExceptObject, ExceptAddr, GUID_NULL, ExceptObject.ClassName, <span class="hljs-string"><span class="hljs-string">''</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>.</code> </pre> <br>  Layak berhenti di metode <code>SafeCallException</code> - pemblokirannya, pada umumnya, tidak penting (kinerja <code>TXQValue</code> tidak <code>TXQValue</code> menderita tanpanya), namun, kode yang diberikan di sini memungkinkan Anda untuk mengirim teks pengecualian ke sisi Delphi yang akan muncul dalam metode safecall (detail, lagi, dapat ditemukan di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">artikel</a> terbaru). <br><br>  Solusi ini, selain yang lainnya, aman untuk thread - asalkan <code>IXQValue</code> diterima, misalnya, melalui <code>OpenURL</code> , tidak ditransmisikan antar thread.  Ini disebabkan oleh kenyataan bahwa implementasi antarmuka hanya mengalihkan panggilan ke InternetTools yang sudah aman. <br><br><h4>  Perpustakaan Dinamis InternetTools </h4><br>  Karena pekerjaan yang dilakukan dalam modul di atas, cukup bagi DLL untuk mengekspor fungsi tunggal (bandingkan dengan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">opsi di</a> mana gaya prosedural digunakan): <br><br><pre> <code class="delphi hljs"><span class="hljs-keyword"><span class="hljs-keyword">library</span></span> InternetTools; <span class="hljs-keyword"><span class="hljs-keyword">uses</span></span> InternetTools.Types, InternetTools.Realization; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetXQValue</span></span></span><span class="hljs-function">:</span></span> IXQValue; <span class="hljs-keyword"><span class="hljs-keyword">stdcall</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> Result := TXQValue.Create; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">exports</span></span> GetXQValue; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> SetMultiByteConversionCodePage(CP_UTF8); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>.</code> </pre> <br>  Panggilan ke prosedur <code>SetMultiByteConversionCodePage</code> dirancang untuk bekerja dengan string Unicode dengan benar. <br><br><h4>  Aplikasi InternetToolsUsage </h4><br>  Jika kita sekarang memformalkan solusi Delphi dari <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">contoh awal</a> berdasarkan antarmuka yang diusulkan, maka itu akan sangat berbeda dari yang ada pada Free Pascal, yang berarti tugas yang diatur pada awal artikel dapat dianggap selesai: <br><br><pre> <code class="delphi hljs"><span class="hljs-keyword"><span class="hljs-keyword">program</span></span> InternetToolsUsage; ... <span class="hljs-keyword"><span class="hljs-keyword">uses</span></span> System.Win.ComObj, InternetTools.Types; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> DLLName = <span class="hljs-string"><span class="hljs-string">'InternetTools.dll'</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetXQValue</span></span></span><span class="hljs-function">:</span></span> IXQValue; <span class="hljs-keyword"><span class="hljs-keyword">stdcall</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">external</span></span> DLLName; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ArticleURL = <span class="hljs-string"><span class="hljs-string">'https://habr.com/post/415617'</span></span>; ListXPath = <span class="hljs-string"><span class="hljs-string">'//div[@class="post__body post__body_full"]//li[a]'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ListValue: IXQValue; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ListValue <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> GetXQValue.OpenURL(ArticleURL).Map(ListXPath) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> Writeln(ListValue.ToString); ReadLn; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>.</code> </pre> <br>  Modul <code>System.Win.ComObj</code> tidak terkoneksi secara tidak sengaja - tanpanya, teks dari semua pengecualian safecall akan menjadi ‚ÄúException in safecall method‚Äù tanpa wajah, dan dengannya nilai asli yang dihasilkan dalam DLL. <br><br>  Contoh yang sedikit <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">rumit</a> juga memiliki perbedaan minimal pada Delphi: <br><br><pre> <code class="delphi hljs">... <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ArticleURL = <span class="hljs-string"><span class="hljs-string">'https://habr.com/post/415617'</span></span>; ListXPath = <span class="hljs-string"><span class="hljs-string">'//div[@class="post__body post__body_full"]//li[a]'</span></span>; HrefXPath = <span class="hljs-string"><span class="hljs-string">'./a/@href'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ListValue, HrefValue: IXQValue; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ListValue <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> GetXQValue.OpenURL(ArticleURL).Map(ListXPath) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-comment"><span class="hljs-comment">{   }</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> HrefValue <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> ListValue.Map(HrefXPath) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> Writeln(HrefValue.ToString); ReadLn; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>.</code> </pre> <br><h4>  Fungsi perpustakaan yang tersisa </h4><br>  Jika Anda melihat kemampuan penuh antarmuka <a href="">IXQValue</a> dari InternetTools, Anda akan melihat bahwa <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">antarmuka yang sesuai</a> dari <code>InternetTools.Types</code> hanya mendefinisikan 2 metode ( <code>Map</code> dan <code>ToString</code> ) dari seluruh rangkaian kaya;  menambahkan sisanya yang dianggap perlu oleh pembaca dalam kasus khususnya dilakukan dengan cara yang persis sama dan sederhana: metode yang diperlukan ditulis dalam <code>InternetTools.Types</code> , setelah itu mereka dibangun di <code>InternetTools.Realization</code> modul dengan kode (paling sering sebagai satu baris). <br><br>  Jika Anda perlu menggunakan fungsionalitas yang sedikit berbeda, misalnya, manajemen cookie, urutan langkah-langkahnya sangat mirip: <br><br><ol><li>  Antarmuka baru <code>InternetTools.Types</code> di <code>InternetTools.Types</code> : <br><br><pre> <code class="delphi hljs">... ICookies = <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> [<span class="hljs-string"><span class="hljs-string">'{21D0CC9A-204D-44D2-AF00-98E9E04412CD}'</span></span>] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Add</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> URL, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">Name</span></span></span></span><span class="hljs-function"><span class="hljs-params">, Value: WideString)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">safecall</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Clear</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">safecall</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; ...</code> </pre> </li><li>  Kemudian diimplementasikan dalam modul <code>InternetTools.Realization</code> : <br><br><pre> <code class="delphi hljs">... <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> <span class="hljs-title"><span class="hljs-title">TCookies</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>(TInterfacedObject, ICookies) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Add</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> URL, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">Name</span></span></span></span><span class="hljs-function"><span class="hljs-params">, Value: WideString)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">safecall</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Clear</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">safecall</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SafeCallException</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ExceptObject: TObject; ExceptAddr: CodePointer)</span></span></span><span class="hljs-function">:</span></span> HResult; <span class="hljs-keyword"><span class="hljs-keyword">override</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; ... <span class="hljs-keyword"><span class="hljs-keyword">implementation</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uses</span></span> ..., internetaccess; ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TCookies</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Add</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> URL, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">Name</span></span></span></span><span class="hljs-function"><span class="hljs-params">, Value: WideString)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> defaultInternet.cookies.setCookie( decodeURL(URL).host, decodeURL(URL).path, <span class="hljs-keyword"><span class="hljs-keyword">Name</span></span>, Value, [] ); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TCookies</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Clear</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> defaultInternet.cookies.clear; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; ...</code> </pre> </li><li>  Setelah itu, fungsi yang diekspor baru dikembalikan ke DLL yang mengembalikan antarmuka ini: <br><br><pre> <code class="delphi hljs">... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetCookies</span></span></span><span class="hljs-function">:</span></span> ICookies; <span class="hljs-keyword"><span class="hljs-keyword">stdcall</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> Result := TCookies.Create; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">exports</span></span> ..., GetCookies; ...</code> </pre> </li></ol><br><h4>  Pelepasan sumber daya </h4><br>  Meskipun pustaka InternetTools didasarkan pada antarmuka yang secara otomatis mengontrol masa pakai, ada satu nuansa yang tidak jelas yang kelihatannya menyebabkan kebocoran memori - jika Anda menjalankan aplikasi konsol berikutnya (dibuat pada Delphi, tidak ada yang akan berubah dalam kasus FPC), maka setiap kali Anda menekan tombol enter, memori yang dikonsumsi oleh proses akan tumbuh: <br><br><pre> <code class="delphi hljs">... <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ArticleURL = <span class="hljs-string"><span class="hljs-string">'https://habr.com/post/415617'</span></span>; TitleXPath = <span class="hljs-string"><span class="hljs-string">'//head/title'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> I: Integer; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> I := <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-number"><span class="hljs-number">100</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> Writeln( GetXQValue.OpenURL(ArticleURL).Map(TitleXPath).ToString ); Readln; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>.</code> </pre> <br>  Tidak ada kesalahan dengan penggunaan antarmuka di sini.  Masalahnya adalah bahwa InternetTools tidak merilis sumber daya internalnya yang dialokasikan selama analisis dokumen (dalam metode <code>OpenURL</code> ) - ini harus dilakukan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">secara eksplisit</a> setelah pekerjaan dengan itu selesai;  untuk tujuan ini, modul perpustakaan <code>xquery</code> menyediakan prosedur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><code>freeThreadVars</code></a> , panggilan yang dari aplikasi Delphi logis untuk memastikan dengan memperluas daftar ekspor DLL: <br><br><pre> <code class="delphi hljs">... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FreeResources</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">stdcall</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> freeThreadVars; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">exports</span></span> ..., FreeResources; ...</code> </pre> <br>  Setelah penggunaannya, hilangnya sumber daya akan berhenti: <br><br><pre> <code class="delphi hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> I := <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-number"><span class="hljs-number">100</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> Writeln( GetXQValue.OpenURL(ArticleURL).Map(TitleXPath).ToString ); FreeResources; Readln; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre> <br>  Penting untuk memahami yang berikut - panggilan ke <code>FreeResources</code> mengarah pada kenyataan bahwa semua antarmuka yang sebelumnya diterima menjadi tidak berarti dan segala upaya untuk menggunakannya tidak dapat diterima. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id415617/">https://habr.com/ru/post/id415617/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id415601/index.html">Kubernetes HA cluster dengan contenterd. Atau adakah kehidupan tanpa buruh pelabuhan?</a></li>
<li><a href="../id415605/index.html">Bagaimana kami menyimpan pemrosesan kartu dengan Exadata</a></li>
<li><a href="../id415611/index.html">PKI: Perpustakaan GCrypt dan KSBA sebagai alternatif untuk OpenSSL dengan dukungan untuk kriptografi Rusia. Lanjutan</a></li>
<li><a href="../id415613/index.html">Mengapa Anda tidak membeli lampu LED</a></li>
<li><a href="../id415615/index.html">Interaksi dengan server melalui API di iOS pada Swift 3. Bagian 2</a></li>
<li><a href="../id415619/index.html">Apple dan Samsung menyelesaikan perang paten 7 tahun</a></li>
<li><a href="../id415621/index.html">Sistem pemantauan penambangan</a></li>
<li><a href="../id415623/index.html">Dinamika penerbangan vertikal pesawat lebih ringan dari udara</a></li>
<li><a href="../id415625/index.html">Kubernetes: webinar (4 Juli pukul 19:30) dan intensif (3-5 Agustus)</a></li>
<li><a href="../id415627/index.html">Bagaimana (tidak) Anda harus menjadi seorang brengsek: kisah seorang direktur teknis</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>