<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üññüèª ü¶è ü§¶üèø Cachoeira da complexidade e arquitetura sob demanda üë©üèø ü•• üïò</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Quando se fala em "c√≥digo incorreto", as pessoas quase certamente querem dizer "c√≥digo complexo", entre outros problemas populares. A quest√£o da compl...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Cachoeira da complexidade e arquitetura sob demanda</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/472876/"><p><img src="https://habrastorage.org/webt/g9/_9/wk/g9_9wkgu4h6i8xyelaq9p5nwmjy.png" alt="Logomarca"></p><br><p>  Quando se fala em "c√≥digo incorreto", as pessoas quase certamente querem dizer "c√≥digo complexo", entre outros problemas populares.  A quest√£o da complexidade √© que ela surge do nada.  Um dia voc√™ inicia seu projeto bastante simples, outro dia voc√™ o encontra em ru√≠nas.  E ningu√©m sabe como e quando isso aconteceu. </p><br><p>  Mas, isso finalmente acontece por uma raz√£o!  A complexidade do c√≥digo entra na sua base de c√≥digo de duas maneiras poss√≠veis: com grandes partes e adi√ß√µes incrementais.  E as pessoas s√£o ruins em revisar e encontrar os dois. </p><a name="habracut"></a><br><p>  Quando um grande peda√ßo de c√≥digo entra, o revisor ser√° desafiado a encontrar o local exato em que o c√≥digo √© complexo e o que fazer a respeito.  Ent√£o, a revis√£o ter√° que provar o ponto: por que esse c√≥digo √© complexo em primeiro lugar.  E outros desenvolvedores podem discordar.  Todos n√≥s conhecemos esse tipo de revis√£o de c√≥digo! </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/198/8ff/e0e/1988ffe0e3d5dc3b29b4743630b52e06.png" alt="N√∫mero de linhas para revis√£o e propor√ß√£o de coment√°rios"></p><br><p> A segunda maneira de complexidade que entra no seu c√≥digo √© a adi√ß√£o incremental: quando voc√™ envia uma ou duas linhas √† fun√ß√£o existente.  E √© extremamente dif√≠cil perceber que sua fun√ß√£o estava correta h√° um commit atr√°s, mas agora √© muito complexa.  √â preciso uma boa parte da concentra√ß√£o, revis√£o de habilidades e boas pr√°ticas de navega√ß√£o de c√≥digo para realmente identific√°-lo.  A maioria das pessoas (como eu!) N√£o tem essas habilidades e permite que a complexidade entre regularmente na base de c√≥digo. </p><br><p>  Ent√£o, o que pode ser feito para impedir que seu c√≥digo fique complexo?  Precisamos usar a automa√ß√£o!  Vamos aprofundar a complexidade do c√≥digo e as maneiras de encontr√°-lo e finalmente resolv√™-lo. </p><br><p>  Neste artigo, vou gui√°-lo por lugares onde a complexidade vive e como combat√™-la l√°.  Em seguida, discutiremos o qu√£o bem o c√≥digo e a automa√ß√£o simples escritos possibilitam uma oportunidade dos estilos de desenvolvimento "Refatora√ß√£o cont√≠nua" e "Arquitetura sob demanda". </p><br><h2 id="complexity-explained">  Complexidade explicada </h2><br><p>  Algu√©m pode perguntar: o que exatamente √© "complexidade de c√≥digo"?  E embora pare√ßa familiar, existem obst√°culos ocultos na compreens√£o da localiza√ß√£o exata da complexidade.  Vamos come√ßar com as partes mais primitivas e depois passar para entidades de n√≠vel superior. </p><br><p>  Lembre-se, que este artigo se chama "Cachoeira da Complexidade"?  Mostrarei como a complexidade das primitivas mais simples transborda para as abstra√ß√µes mais altas. </p><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>wemake-python-styleguide</code></a> <code>python</code> como a linguagem principal dos meus exemplos e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>wemake-python-styleguide</code></a> como a principal ferramenta de aprendizado para encontrar as viola√ß√µes no meu c√≥digo e ilustrar meu argumento. </p><br><h3 id="expressions">  Express√µes </h3><br><p>  Todo o seu c√≥digo consiste em express√µes simples como <code>a + 1</code> e <code>print(x)</code> .  Embora as express√µes sejam simples, elas podem transbordar seu c√≥digo com complexidade em algum momento.  Exemplo: imagine que voc√™ tenha um dicion√°rio que represente algum modelo de <code>User</code> e use-o assim: </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">format_username</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(user)</span></span></span><span class="hljs-function"> -&gt; str:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> user[<span class="hljs-string"><span class="hljs-string">'username'</span></span>]: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> user[<span class="hljs-string"><span class="hljs-string">'email'</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> len(user[<span class="hljs-string"><span class="hljs-string">'username'</span></span>]) &gt; <span class="hljs-number"><span class="hljs-number">12</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> user[<span class="hljs-string"><span class="hljs-string">'username'</span></span>][:<span class="hljs-number"><span class="hljs-number">12</span></span>] + <span class="hljs-string"><span class="hljs-string">'...'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'@'</span></span> + user[<span class="hljs-string"><span class="hljs-string">'username'</span></span>]</code> </pre> <br><p>  Parece bem simples, n√£o √©?  De fato, ele cont√©m dois problemas de complexidade baseados em express√µes.  Ele usa a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">string <code>overuses 'username'</code></a> e usa o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">n√∫mero m√°gico</a> <code>12</code> (por que usamos esse n√∫mero em primeiro lugar, por que n√£o <code>13</code> ou <code>10</code> ?).  √â dif√≠cil encontrar esse tipo de coisa sozinho.  Veja como seria a vers√£o melhor: </p><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#: That's how many chars fit in the preview box. LENGTH_LIMIT: Final = 12 def format_username(user) -&gt; str: username = user['username'] if not username: return user['email'] elif len(username) &gt; LENGTH_LIMIT: # See? It is now documented return username[:LENGTH_LIMIT] + '...' return '@' + username</span></span></code> </pre> <br><p>  Existem diferentes problemas com a express√£o tamb√©m.  Tamb√©m podemos ter <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">express√µes</a> <code>some_object.some_attr</code> : quando voc√™ usa o atributo <code>some_object.some_attr</code> qualquer lugar, em vez de criar uma nova vari√°vel local.  Tamb√©m podemos ter <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">condi√ß√µes l√≥gicas muito complexas</a> ou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">acesso a pontos muito profundo</a> . </p><br><p>  <strong>Solu√ß√£o</strong> : crie novas vari√°veis, argumentos ou constantes.  Crie e use novas fun√ß√µes ou m√©todos utilit√°rios, se necess√°rio. </p><br><h3 id="lines">  Linhas </h3><br><p>  Express√µes formam linhas de c√≥digo (por favor, n√£o confunda linhas com instru√ß√µes: uma √∫nica instru√ß√£o pode ter v√°rias linhas e v√°rias instru√ß√µes podem estar localizadas em uma √∫nica linha). </p><br><p>  A primeira e a m√©trica de complexidade mais √≥bvia para uma linha √© o seu comprimento.  Sim, voc√™ ouviu corretamente.  √â por isso que n√≥s (programadores) preferimos manter a regra de <code>80</code> caracteres por linha e n√£o porque ela era <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">usada anteriormente</a> nas m√°quinas de escrever teletipagem.  Ultimamente, existem muitos rumores sobre isso, dizendo que n√£o faz sentido usar <code>80</code> caracteres para o seu c√≥digo em 2k19.  Mas, obviamente, isso n√£o √© verdade. </p><br><p>  A ideia √© simples.  Voc√™ pode ter o dobro de l√≥gica em uma linha com <code>160</code> caracteres do que em apenas <code>80</code> caracteres.  √â por isso que esse limite deve ser definido e imposto.  Lembre-se, essa <em>n√£o</em> √© <em>uma escolha estil√≠stica</em> .  √â uma m√©trica de complexidade! </p><br><p>  A segunda m√©trica de complexidade da linha principal √© menos conhecida e menos utilizada.  Chama-se <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Jones Complexity</a> .  A id√©ia por tr√°s disso √© simples: contamos n√≥s de c√≥digo (ou <code>ast</code> ) em uma √∫nica linha para obter sua complexidade.  Vamos dar uma olhada no exemplo.  Essas duas linhas s√£o fundamentalmente diferentes em termos de complexidade, mas t√™m exatamente a mesma largura em caracteres: </p><br><pre> <code class="python hljs">print(first_long_name_with_meaning, second_very_long_name_with_meaning, third) print(first * <span class="hljs-number"><span class="hljs-number">5</span></span> + math.pi * <span class="hljs-number"><span class="hljs-number">2</span></span>, matrix.trans(*matrix), display.show(matrix, <span class="hljs-number"><span class="hljs-number">2</span></span>))</code> </pre> <br><p>  Vamos contar os n√≥s no primeiro: uma chamada, tr√™s nomes.  Quatro n√≥s totalmente.  O segundo tem vinte e um n√≥s <code>ast</code> .  Bem, a diferen√ßa √© clara.  √â por isso que usamos a m√©trica Jones Complexity para permitir a primeira linha longa e proibir a segunda com base em uma complexidade interna, n√£o apenas no comprimento bruto. </p><br><p>  O que fazer com linhas com uma pontua√ß√£o alta na Jones Complexity? </p><br><p>  <strong>Solu√ß√£o</strong> : divida-as em v√°rias linhas ou crie novas vari√°veis ‚Äã‚Äãintermedi√°rias, fun√ß√µes utilit√°rias, novas classes etc. </p><br><pre> <code class="python hljs">print( first * <span class="hljs-number"><span class="hljs-number">5</span></span> + math.pi * <span class="hljs-number"><span class="hljs-number">2</span></span>, matrix.trans(*matrix), display.show(matrix, <span class="hljs-number"><span class="hljs-number">2</span></span>), )</code> </pre> <br><p>  Agora √© muito mais leg√≠vel! </p><br><h3 id="structures">  Estruturas </h3><br><p>  O pr√≥ximo passo √© analisar as estruturas de linguagem, como <code>if</code> , <code>for</code> , <code>with</code> , etc, formadas a partir de linhas e express√µes.  Eu tenho que dizer que este ponto √© muito espec√≠fico da linguagem.  Vou mostrar v√°rias regras dessa categoria usando <code>python</code> tamb√©m. </p><br><p>  Vamos come√ßar com <code>if</code> .  O que pode ser mais f√°cil do que um bom <code>if</code> ?  Na verdade, <code>if</code> come√ßar a ficar complicado muito r√°pido.  Aqui est√° um exemplo de como se pode <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>reimplement switch</code></a> <code>if</code> : </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> isinstance(some, int): ... <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> isinstance(some, float): ... <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> isinstance(some, complex): ... <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> isinstance(some, str): ... <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> isinstance(some, bytes): ... <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> isinstance(some, list): ...</code> </pre> <br><p>  Qual √© o problema com este c√≥digo?  Bem, imagine que temos dezenas de tipos de dados que devem ser cobertos, incluindo os costumes dos quais ainda n√£o temos conhecimento.  Ent√£o esse c√≥digo complexo √© um indicador de que estamos escolhendo um padr√£o errado aqui.  Precisamos refatorar nosso c√≥digo para corrigir esse problema.  Por exemplo, pode-se usar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>typeclass</code> es</a> ou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>singledispatch</code></a> .  Eles fazem o mesmo trabalho, mas melhor. </p><br><p>  <code>python</code> nunca para para nos divertir.  Por exemplo, voc√™ pode escrever <code>with</code> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">um n√∫mero arbitr√°rio de casos</a> , o que √© muito complexo mentalmente e confuso: </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span> first(), second(), third(), fourth(): ...</code> </pre> <br><p>  Voc√™ tamb√©m pode escrever compreens√µes com qualquer n√∫mero de express√µes <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>if</code></a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>for</code></a> , o que pode levar a c√≥digos complexos e ileg√≠veis: </p><br><pre> <code class="python hljs">[ (x, y, z) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> x <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> x_coords <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> y <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> y_coords <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> z <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> z_coords <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> x &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> y &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> z &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> x + y &lt;= z <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> x + z &lt;= y <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> y + z &lt;= x ]</code> </pre> <br><p>  Compare-o com a vers√£o simples e leg√≠vel: </p><br><pre> <code class="python hljs">[ (x, y, z) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> x, y, x <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> itertools.product(x_coords, y_coords, z_coords) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> valid_coordinates(x, y, z) ]</code> </pre> <br><p>  Voc√™ tamb√©m pode incluir acidentalmente <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>multiple statements inside a try</code></a> caso de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>multiple statements inside a try</code></a> , o que n√£o √© seguro, pois pode gerar e manipular uma exce√ß√£o em um local esperado: </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: user = fetch_user() <span class="hljs-comment"><span class="hljs-comment"># Can also fail, but don't expect that log.save_user_operation(user.email) # Can fail, and we know it except MyCustomException as exc: ...</span></span></code> </pre> <br><p>  E isso n√£o √© nem 10% dos casos que podem e v√£o dar errado com seu c√≥digo <code>python</code> .  Existem muitos, muitos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">outros casos extremos</a> que devem ser rastreados e analisados. </p><br><p>  <strong>Solu√ß√£o</strong> : A √∫nica solu√ß√£o poss√≠vel √© usar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">um bom ponteiro</a> para o idioma de sua escolha.  E refatorar lugares complexos que esse linter destaca.  Caso contr√°rio, voc√™ precisar√° reinventar a roda e definir pol√≠ticas personalizadas para exatamente os mesmos problemas. </p><br><h3 id="functions">  Fun√ß√µes </h3><br><p>  Express√µes, instru√ß√µes e estruturas formam fun√ß√µes.  A complexidade dessas entidades flui para fun√ß√µes.  E √© a√≠ que as coisas come√ßam a ficar intrigantes.  Porque as fun√ß√µes t√™m literalmente dezenas de m√©tricas de complexidade: boas e ruins. </p><br><p>  Come√ßaremos com os mais conhecidos: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">complexidade ciclom√°tica</a> e comprimento da fun√ß√£o medidos em linhas de c√≥digo.  A complexidade ciclom√°tica indica quantas voltas seu fluxo de execu√ß√£o pode levar: √© quase igual ao n√∫mero de testes de unidade necess√°rios para cobrir completamente o c√≥digo-fonte.  √â uma boa m√©trica, porque respeita a sem√¢ntica e ajuda o desenvolvedor a refatorar.  Por outro lado, o comprimento de uma fun√ß√£o √© uma m√©trica ruim.  N√£o combina com a m√©trica Jones Complexity explicada anteriormente, j√° que j√° sabemos: v√°rias linhas s√£o mais f√°ceis de ler do que uma grande linha com tudo o que est√° dentro.  Vamos nos concentrar apenas nas boas m√©tricas e ignorar as ruins. </p><br><p>  Com base na minha experi√™ncia, v√°rias m√©tricas √∫teis de complexidade devem ser contadas em vez do tamanho da fun√ß√£o regular: </p><br><ul><li>  N√∫mero de decoradores de fun√ß√µes;  menor √© melhor </li><li>  N√∫mero de argumentos;  menor √© melhor </li><li>  N√∫mero de anota√ß√µes;  maior √© melhor </li><li>  N√∫mero de vari√°veis ‚Äã‚Äãlocais;  menor √© melhor </li><li>  N√∫mero de retornos, rendimentos, aguarda;  menor √© melhor </li><li>  N√∫mero de declara√ß√µes e express√µes;  menor √© melhor </li></ul><br><p>  A combina√ß√£o de todas essas verifica√ß√µes permite realmente escrever fun√ß√µes simples (todas as regras tamb√©m s√£o aplicadas aos m√©todos). </p><br><p>  Quando voc√™ tentar fazer algumas coisas desagrad√°veis ‚Äã‚Äãcom sua fun√ß√£o, certamente quebrar√° pelo menos uma m√©trica.  E isso ir√° decepcionar o nosso linter e explodir sua constru√ß√£o.  Como resultado, sua fun√ß√£o ser√° salva. </p><br><p>  <strong>Solu√ß√£o</strong> : quando uma fun√ß√£o √© muito complexa, a √∫nica solu√ß√£o que voc√™ tem √© dividir essa fun√ß√£o em v√°rias. </p><br><h3 id="classes">  Aulas </h3><br><p>  O pr√≥ximo n√≠vel de abstra√ß√£o ap√≥s as fun√ß√µes s√£o classes.  E como voc√™ j√° adivinhou, eles s√£o ainda mais complexos e fluidos do que fun√ß√µes.  Como as classes podem conter v√°rias fun√ß√µes internas (chamadas m√©todo) e ter outros recursos exclusivos, como heran√ßa e mixins, atributos no n√≠vel da classe e decoradores no n√≠vel da classe.  Portanto, temos que verificar todos os m√©todos como fun√ß√µes e o pr√≥prio corpo da classe. </p><br><p>  Para as aulas, precisamos medir as seguintes m√©tricas: </p><br><ul><li>  N√∫mero de decoradores em n√≠vel de classe;  menor √© melhor </li><li>  N√∫mero de classes base;  menor √© melhor </li><li>  N√∫mero de atributos p√∫blicos em n√≠vel de classe;  menor √© melhor </li><li>  N√∫mero de atributos p√∫blicos no n√≠vel da inst√¢ncia;  menor √© melhor </li><li>  N√∫mero de m√©todos;  menor √© melhor </li></ul><br><p>  Quando qualquer uma dessas situa√ß√µes √© excessivamente complicada - precisamos tocar o alarme e falhar na constru√ß√£o! </p><br><p>  <strong>Solu√ß√£o</strong> : refatorar sua classe com falha!  Divida uma classe complexa existente em v√°rias simples ou crie novas fun√ß√µes utilit√°rias e use a composi√ß√£o. </p><br><p>  Men√ß√£o not√°vel: tamb√©m √© poss√≠vel rastrear <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">m√©tricas de</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">coes√£o</a> e acoplamento para validar a complexidade do seu projeto de POO. </p><br><h3 id="modules">  M√≥dulos </h3><br><p>  Os m√≥dulos cont√™m v√°rias instru√ß√µes, fun√ß√µes e classes.  E como voc√™ j√° mencionou, geralmente aconselhamos dividir fun√ß√µes e classes em novas.  √â por isso que temos que ficar de olho na complexidade do m√≥dulo: ele literalmente flui para m√≥dulos de classes e fun√ß√µes. </p><br><p>  Para analisar a complexidade do m√≥dulo, precisamos verificar: </p><br><ul><li>  O n√∫mero de importa√ß√µes e nomes importados;  menor √© melhor </li><li>  O n√∫mero de classes e fun√ß√µes;  menor √© melhor </li><li>  A complexidade m√©dia de fun√ß√µes e classes dentro;  menor √© melhor </li></ul><br><p>  O que fazemos no caso de um m√≥dulo complexo? </p><br><p>  <strong>Solu√ß√£o</strong> : sim, voc√™ acertou.  Dividimos um m√≥dulo em v√°rios. </p><br><h3 id="packages">  Pacotes </h3><br><p>  Pacotes cont√™m v√°rios m√≥dulos.  Felizmente, isso √© tudo o que eles fazem. </p><br><p>  Portanto, o n√∫mero de m√≥dulos em um pacote pode em breve come√ßar a ser muito grande, ent√£o voc√™ acabar√° com muitos deles.  E √© a √∫nica complexidade que pode ser encontrada com os pacotes. </p><br><p>  <strong>Solu√ß√£o</strong> : voc√™ precisa dividir pacotes em subpacotes e pacotes de diferentes n√≠veis. </p><br><h2 id="complexity-waterfall-effect">  Efeito cascata complexidade </h2><br><p>  Agora, cobrimos quase todos os tipos poss√≠veis de abstra√ß√£o em sua base de c√≥digo.  O que aprendemos com isso?  O principal argumento, por enquanto, √© que a maioria dos problemas pode ser resolvida com a eje√ß√£o da complexidade para o mesmo n√≠vel ou para o n√≠vel de abstra√ß√£o superior. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/9b6/8ad/453/9b68ad45340cdf61f51a8deb2c07930d.png" alt="Cachoeira da complexidade"></p><br><p>  Isso nos leva √† id√©ia mais importante deste artigo: n√£o deixe seu c√≥digo exceder a complexidade.  Vou dar v√°rios exemplos de como isso geralmente acontece. </p><br><p>  Imagine que voc√™ est√° implementando um novo recurso.  E essa √© a √∫nica altera√ß√£o que voc√™ faz: </p><br><pre> <code class="diff hljs"><span class="hljs-comment"><span class="hljs-comment">+++ if user.is_active and user.has_sub() and sub.is_due(tz.now() + delta): --- if user.is_active and user.has_sub():</span></span></code> </pre> <br><p>  Parece ok, eu passaria esse c√≥digo na revis√£o.  E nada de ruim aconteceria.  Mas o ponto que estou perdendo √© que a complexidade ultrapassou essa linha!  √â isso que o <code>wemake-python-styleguide</code> relatar√°: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/c87/b9e/0e5/c87b9e0e584a8cd01235e0ae7695a6c0.png" alt="wemake-python-styleguide-output"></p><br><p>  Ok, agora temos que resolver essa complexidade.  Vamos fazer uma nova vari√°vel: </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Product</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(object)</span></span></span><span class="hljs-class">:</span></span> ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">can_be_purchased</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, user_id)</span></span></span><span class="hljs-function"> -&gt; bool:</span></span> ... is_sub_paid = sub.is_due(tz.now() + delta) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> user.is_active <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> user.has_sub() <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> is_sub_paid: ... ... ...</code> </pre> <br><p>  Agora, a complexidade da linha est√° resolvida.  Mas espere um pouco.  E se a nossa fun√ß√£o tiver muitas vari√°veis ‚Äã‚Äãagora?  Porque criamos uma nova vari√°vel sem verificar seu n√∫mero dentro da fun√ß√£o primeiro.  Nesse caso, teremos que dividir esse m√©todo em v√°rios como este: </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Product</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(object)</span></span></span><span class="hljs-class">:</span></span> ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">can_be_purchased</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, user_id)</span></span></span><span class="hljs-function"> -&gt; bool:</span></span> ... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self._has_paid_sub(user, sub, delta): ... ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_has_paid_sub</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, user, sub, delta)</span></span></span><span class="hljs-function"> -&gt; bool:</span></span> is_sub_paid = sub.is_due(tz.now() + delta) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> user.is_active <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> user.has_sub() <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> is_sub_paid ...</code> </pre> <br><p>  Agora terminamos!  Certo?  N√£o, porque agora precisamos verificar a complexidade da classe <code>Product</code> .  Imagine que agora ele possui muitos m√©todos, pois criamos um novo <code>_has_paid_sub</code> . </p><br><p>  Ok, executamos nosso linter para verificar a complexidade novamente.  Acontece que nossa classe de <code>Product</code> √© realmente muito complexa no momento.  Nossas a√ß√µes?  Dividimos em v√°rias classes! </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Policy</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(object)</span></span></span><span class="hljs-class">:</span></span> ... <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SubcsriptionPolicy</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Policy)</span></span></span><span class="hljs-class">:</span></span> ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">can_be_purchased</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, user_id)</span></span></span><span class="hljs-function"> -&gt; bool:</span></span> ... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self._has_paid_sub(user, sub, delta): ... ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_has_paid_sub</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, user, sub, delta)</span></span></span><span class="hljs-function"> -&gt; bool:</span></span> is_sub_paid = sub.is_due(tz.now() + delta) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> user.is_active <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> user.has_sub() <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> is_sub_paid <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Product</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(object)</span></span></span><span class="hljs-class">:</span></span> _purchasing_policy: Policy ... ...</code> </pre> <br><p>  Por favor, diga-me que √© a √∫ltima itera√ß√£o!  Sinto muito, mas agora temos que verificar a complexidade do m√≥dulo.  E adivinhe?  Agora temos muitos membros do m√≥dulo.  Ent√£o, temos que dividir os m√≥dulos em outros!  Em seguida, verificamos a complexidade do pacote.  E tamb√©m possivelmente dividi-lo em v√°rios subpacotes. </p><br><p>  Voc√™ viu isso?  Devido √†s regras de complexidade bem definidas, nossa modifica√ß√£o de linha √∫nica acabou sendo uma enorme sess√£o de refatora√ß√£o com v√°rios novos m√≥dulos e classes.  E n√£o tomamos uma √∫nica decis√£o: todos os nossos objetivos de refatora√ß√£o foram conduzidos pela complexidade interna e pelo prazo que a revela. </p><br><p>  √â o que chamo de processo de "refatora√ß√£o cont√≠nua".  Voc√™ √© for√ßado a fazer a refatora√ß√£o.  Sempre. </p><br><p>  Esse processo tamb√©m tem uma consequ√™ncia interessante.  Ele permite que voc√™ tenha "Architecture on Demand".  Deixe-me explicar.  Com a filosofia "Architecture on Demand", voc√™ sempre come√ßa pequeno.  Por exemplo, com um √∫nico arquivo <code>logic/domains/user.py</code>  E voc√™ come√ßa a colocar tudo relacionado ao <code>User</code> l√°.  Porque neste momento voc√™ provavelmente n√£o sabe como ser√° sua arquitetura.  E voc√™ n√£o se importa.  Voc√™ tem apenas tr√™s fun√ß√µes. </p><br><p>  Algumas pessoas caem na armadilha da arquitetura versus a complexidade do c√≥digo.  Eles podem complicar demais sua arquitetura desde o in√≠cio com as camadas completas de reposit√≥rio / servi√ßo / dom√≠nio.  Ou eles podem complicar demais o c√≥digo-fonte sem uma separa√ß√£o clara.  Lute e viva assim por anos (se eles conseguirem viver por anos com o c√≥digo assim!). </p><br><p>  O conceito "Arquitetura sob demanda" resolve esses problemas.  Voc√™ come√ßa pequeno, quando chega a hora - voc√™ divide e refatora as coisas: </p><br><ol><li>  Voc√™ come√ßa com <code>logic/domains/user.py</code> e coloca tudo l√° </li><li>  Mais tarde, voc√™ cria <code>logic/domains/user/repository.py</code> quando tiver coisas relacionadas ao banco de dados suficientes </li><li>  Em seguida, divida-o em <code>logic/domains/user/repository/queries.py</code> e <code>logic/domains/user/repository/commands.py</code> quando a complexidade solicitar que voc√™ fa√ßa isso </li><li>  Ent√£o voc√™ cria <code>logic/domains/user/services.py</code> com coisas relacionadas ao <code>http</code> </li><li>  Em seguida, voc√™ cria um novo m√≥dulo chamado <code>logic/domains/order.py</code> </li><li>  E assim por diante </li></ol><br><p>  √â isso.  √â uma ferramenta perfeita para equilibrar sua arquitetura e complexidade de c√≥digo.  E obtenha a arquitetura que voc√™ realmente precisa no momento. </p><br><h2 id="conclusion">  Conclus√£o </h2><br><p>  O linter bom faz muito mais do que encontrar v√≠rgulas ausentes e aspas ruins.  Um bom linter permite confiar nele nas decis√µes de arquitetura e ajud√°-lo no processo de refatora√ß√£o. </p><br><p>  Por exemplo, <code>wemake-python-styleguide</code> pode ajud√°-lo com a complexidade do c√≥digo-fonte <code>python</code> , permitindo: </p><br><ul><li>  Lute com sucesso contra a complexidade em todos os n√≠veis </li><li>  Aplique a enorme quantidade de padr√µes de nomes, pr√°ticas recomendadas e verifica√ß√µes de consist√™ncia </li><li>  Integre-o facilmente a uma base de c√≥digo herdada com a ajuda da <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">op√ß√£o <code>diff</code></a> ou da ferramenta <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>flakehell</code></a> , para que as antigas viola√ß√µes sejam perdoadas, mas novas n√£o ser√£o permitidas </li><li>  Ative-o no seu [CI] (), mesmo como uma <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">a√ß√£o do Github</a> </li></ul><br><p>  N√£o deixe a complexidade estourar seu c√≥digo, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">use um bom linter</a> ! </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt472876/">https://habr.com/ru/post/pt472876/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt472864/index.html">Check Point: otimiza√ß√£o de CPU e RAM</a></li>
<li><a href="../pt472866/index.html">Talism√£ para comunica√ß√£o est√°vel</a></li>
<li><a href="../pt472870/index.html">Por que o Agile fica parado sem transformar as ferramentas de arquitetura e desenvolvimento - apresenta√ß√£o da confer√™ncia</a></li>
<li><a href="../pt472872/index.html">Como aumentar a inicializa√ß√£o para 50 funcion√°rios sem perder a cultura</a></li>
<li><a href="../pt472874/index.html">Hist√≥ria da nave estelar: atrav√©s de torres de √°gua para as estrelas</a></li>
<li><a href="../pt472884/index.html">Como os estere√≥tipos de um desenvolvedor iniciante colapsam no in√≠cio do jogo</a></li>
<li><a href="../pt472886/index.html">Como implementar um analisador est√°tico no desenvolvimento para que todos fiquem felizes?</a></li>
<li><a href="../pt472890/index.html">DeepPavlov para desenvolvedores: # 1 ferramentas de PNL e crie chatbots</a></li>
<li><a href="../pt472892/index.html">Por que antiv√≠rus tradicionais n√£o s√£o adequados para nuvens p√∫blicas. E o que fazer?</a></li>
<li><a href="../pt472894/index.html">DartUP 2019: confer√™ncia sobre Dart and Flutter em S√£o Petersburgo em 23 de novembro</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>