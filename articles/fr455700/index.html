<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü¶ì ‚õàÔ∏è üßü 4 astuces qui nous ont aid√©s √† optimiser le frontend ü§∑üèº üóª üåÑ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Les belles animations sont depuis longtemps install√©es dans les tendances du design. Les concepteurs d'interface utilisateur cr√©ent des carrousels √©la...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>4 astuces qui nous ont aid√©s √† optimiser le frontend</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/epayments/blog/455700/"><p>  Les belles animations sont depuis longtemps install√©es dans les tendances du design.  Les concepteurs d'interface utilisateur cr√©ent des carrousels √©labor√©s, des t√©l√©chargements, des animations de menu et d'autres d√©corations, tandis que les d√©veloppeurs frontaux les traduisent en code.  Mais le site ne doit pas seulement √™tre beau, mais aussi fonctionner rapidement. </p><br><p>  Un frontend moderne devrait optimiser son code.  Cela est particuli√®rement vrai pour les produits dans lesquels la majorit√© de l'audience se rend sur le site √† partir d'appareils mobiles.  Certaines m√©thodes d'animation sont en retard m√™me dans Chrome sur les ordinateurs les plus performants, mais devraient fonctionner sans probl√®me sur un smartphone moyen. </p><br><p>  Nos d√©veloppeurs ont utilis√© un grand nombre de techniques qui ont permis d'optimiser le site et d'acc√©l√©rer son travail.  J'ai rassembl√© 4 des plus int√©ressants d'entre eux.  Nous partageons des connaissances qui seront utiles aux d√©butants et aux professionnels, ainsi que des liens vers des tutoriels utiles. </p><br><p><img src="https://habrastorage.org/webt/1e/2e/ic/1e2eic7lnnlwnm22gy1y2ah8zto.jpeg"></p><a name="habracut"></a><br><h2 id="1-animaciya-na-scss">  1. Animation sur SCSS </h2><br><p>  <strong>Le site a beaucoup d'animation.</strong>  <strong>Nous avons besoin du navigateur pour le lire avec une fr√©quence d'images stable de 60 ips.</strong>  <strong>En CSS pur, c'est difficile √† faire, nous utilisons donc SCSS.</strong> </p><br><p>  Pour cr√©er les curseurs, nous avons utilis√© la biblioth√®que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Swiper</a> .  Pour un curseur horizontal, l'utilisation de cette biblioth√®que est justifi√©e, car nous devions fournir un support pour svayp de l'utilisateur.  Mais pour un carrousel sans fin vertical, Swiper n'est pas n√©cessaire, il n'y a pas d'interaction avec l'utilisateur.  Par cons√©quent, nous voulions r√©p√©ter la m√™me fonctionnalit√© en utilisant uniquement des fonctionnalit√©s CSS. </p><br><p>  La premi√®re condition et la plus importante lorsque vous travaillez avec une animation CSS est de n'utiliser que les propri√©t√©s de transformation et d'opacit√©.  Les navigateurs sont capables d'optimiser ind√©pendamment l'animation de ces propri√©t√©s et de produire 60 fps stables.  Cependant, l'utilisation de @keyframes seule n'est pas possible d'√©crire diff√©rentes animations pour diff√©rents √©l√©ments, et animer chaque √©l√©ment individuellement en CSS pur prend trop de temps.  Comment √©crire rapidement l'animation dont nous avons besoin?  Nous avons choisi SCSS, le dialecte SASS - une extension CSS plus fonctionnelle. </p><br><p>  Analysons l'utilisation de SCSS en utilisant l'exemple de notre curseur vertical. </p><br><p><img src="https://habrastorage.org/webt/bt/si/ia/btsiiagvb3utwdiuf4hasoszp7a.gif"></p><br><p>  √Ä notre disposition, il y a un conteneur dont la hauteur est √©gale √† la hauteur des trois √©l√©ments du carrousel.  √Ä l'int√©rieur, il y a un autre conteneur contenant tous les √©l√©ments du carrousel. </p><br><pre><code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"b-vertical-carousel-slider"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"vertical-carousel-slider-wrapper slider-items"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"vertical-carousel-slider-item"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"vertical-carousel-slider-item"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"vertical-carousel-slider-item"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"vertical-carousel-slider-item"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"vertical-carousel-slider-item"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Nous supprimons la visibilit√© des √©l√©ments du conteneur qui vont le d√©passer et d√©finissons la hauteur des blocs. </p><br><pre> <code class="plaintext hljs">.b-vertical-carousel-slider { position: relative; overflow: hidden; height: $itemHeight * 3; .vertical-carousel-slider-item { height: $itemHeight; } }</code> </pre> <br><p>  Le calcul de l'animation ne change que si le nombre d'√©l√©ments du carrousel change.  Ensuite, nous √©crivons un mixin qui prend un param√®tre d'entr√©e - <code>$itemCount</code> </p><br><pre> <code class="plaintext hljs">@mixin verticalSlideAnimation($itemCount) { }</code> </pre> <br><p>  Dans le mixage, g√©n√©rez une image cl√© pour chaque √©l√©ment, d√©finissez son √©tat initial et utilisez <code>:nth-child</code> d√©terminer l'animation de l'√©l√©ment. </p><br><pre> <code class="plaintext hljs">for $i from * 1 through $itemCount { $animationName: carousel-item-#{$itemCount}-#{$i}; @keyframes #{$animationName} { 0% { transform: translate3d(0, 0, 0) scale(.95); } } .vertical-carousel-slider-item:nchild(#{$i}) { animation: $stepDuration * $itemCount $animation ease infinite; } }</code> </pre> <br><p>  De plus, pendant l'animation, nous d√©placerons uniquement les √©l√©ments le long de l'axe y et changerons l'√©chelle de l'√©l√©ment au centre. </p><br><p>  L'√©l√©ment carrousel indique: </p><br><ol><li>  La paix </li><li>  D√©calage Y </li><li>  D√©calage Y </li><li>  D√©calage Y avec d√©croissance </li></ol><br><p>  Chaque √©l√©ment montera <code>$itemCount</code> fois, augmentera une fois et diminuera une fois pendant le mouvement.  Par cons√©quent, nous allons g√©n√©rer et calculer l'animation pour chacun des mouvements ascendants. </p><br><pre> <code class="plaintext hljs">@keyframes #{$animationName} { 0% { transform: translate3d(0, 0, 0) scale(.95); } @for $j from 0 through $itemCount { $isFocusedStep: $i == $j + 2; $isNotPrevStep: $i != $j + 1; $offset: 100% / $itemCount * ($animationTime / $stepDuration); @if ($isFocusedStep) { #{getPercentForStep($j, $itemCount, $offset)} { transform: getTranslate($j - 1) scale(.95); } #{getPercentForStep($j, $itemCount)} { transform: getTranslate($j) scale(1); } #{getPercentForStep($j + 1, $itemCount, $offset)} { transform: getTranslate($j) scale(1); } #{getPercentForStep($j + 1, $itemCount)} { transform: getTranslate($j + 1) scale(.95); } } @else if ($isNotPrevStep) { #{getPercentForStep($j, $itemCount, $offset)} { transform: getTranslate($j - 1) scale(.95); } #{getPercentForStep($j, $itemCount)} { transform: getTranslate($j) scale(.95); } } } }</code> </pre> <br><p>  Reste √† d√©finir quelques variables et fonctions: </p><br><ul><li>  <code>$animationTime</code> - temps d'interpolation de mouvement </li><li>  <code>$stepDuration</code> - temps total d'ex√©cution d'une √©tape d'animation ( <code>$animationTime</code> + temps de repos du carrousel) </li><li>  <code>getPercentForStep($step, $itemCount, $offset)</code> - une fonction qui renvoie en pourcentage le point extr√™me de l'un des √©tats. </li><li>  <code>getTranslate($step)</code> - renvoie la traduction en fonction de l'√©tape d'animation </li></ul><br><p>  Exemples d'impl√©mentations de fonctions: </p><br><pre> <code class="plaintext hljs">@function getPercentForStep($step, $count, $offset: 0) { @return 100% * $step / $count - $offset; } @function getTranslate($step) { @return translate3d(0, -100% * $step, 0); }</code> </pre> <br><p>  Nous avons un carrousel de travail avec un √©l√©ment croissant au milieu.  Reste √† faire de l'ombre sous les √©l√©ments croissants.  Initialement, chaque √©l√©ment du carrousel avait un pseudo-√©l√©ment: apr√®s, qui √† son tour avait une ombre.  Afin de ne pas animer la propri√©t√© shadow, nous avons utilis√© la propri√©t√© opacity pour elle, c'est-√†-dire  juste montr√© et cach√© l'ombre. </p><br><p>  Mais dans la nouvelle impl√©mentation d'une telle solution, vous devez g√©n√©rer de nombreuses images cl√©s suppl√©mentaires pour chaque pseudo-√©l√©ment.  Nous avons d√©cid√© de le faire plus facilement: il y aura un bloc avec une ombre et il occupera l'espace exactement sous l'√©l√©ment central du carrousel. </p><br><p>  Ajoutez un div responsable de l'ombre. </p><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"b-vertical-carousel-slider"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"vertical-carousel-slider-wrapper"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"vertical-carousel-slider-item"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"vertical-carousel-slider-item"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"vertical-carousel-slider-item"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"vertical-carousel-slider-item"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"vertical-carousel-slider-item"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"vertical-carousel-slider-shadow"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Nous le stylisons et ajoutons des animations. </p><br><pre> <code class="plaintext hljs">@keyframes shadowAnimation { 0% { opacity: 1; } 80% { opacity: 1; } 90% { opacity: 0; } 100% { opacity: 1; } } .vertical-carousel-slider-shadow { top: $itemHeight; left: 0; right: 0; height: $itemHeight; animation: $stepDuration shadowAnimation ease infinite; }</code> </pre> <br><p>  Dans ce cas, vous n'avez pas besoin de g√©n√©rer et de penser √† un moyen d'animer les ombres sous chaque √©l√©ment, nous n'animons qu'un bloc, il a deux √©tats - il est visible et cach√© </p><br><p>  En cons√©quence, nous avons un carrousel CSS pur qui anime avec uniquement des propri√©t√©s bien optimis√©es.  Cela permet au navigateur d'utiliser l'acc√©l√©ration mat√©rielle pour le rendu.  D'o√π le profit tangible par rapport √† l'animation JS: </p><br><ol><li>  Lors du d√©filement des pages avec des animations sur des appareils faibles, les cadres √©taient clairement ignor√©s dans les animations JS, laissant tomber FPS √† 15-20.  Les animations CSS ont clairement am√©lior√© les choses.  Sur ces appareils, ce chiffre √©tait d'au moins 50-55 FPS. </li><li>  Nous nous sommes d√©barrass√©s du travail d'un module tiers o√π il n'√©tait pas n√©cessaire. </li><li>  L'animation sera jou√©e m√™me lorsque JS est d√©sactiv√© </li></ol><br><p>  L'animation JS doit √™tre utilis√©e si un contr√¥le strict de chaque image est n√©cessaire: pause, lecture invers√©e, rembobinage, r√©action aux actions de l'utilisateur.  Dans d'autres cas, nous vous recommandons d'utiliser du CSS pur. </p><br><p>  <strong>Liens utiles</strong> </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Guide d'animation de flou</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Guide des propri√©t√©s CSS et des t√¢ches du navigateur</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Guide d'animation d'ombres</a> </li></ul><br><h2 id="2-ispolzovanie-intersection-observer-api">  2. Utilisation de l'API Intersection Observer </h2><br><p>  <strong>L'animation que le visiteur du site ne voit pas est jou√©e hors de vue et charge le CPU.</strong>  <strong>√Ä l'aide de l'intersection Observer, nous d√©terminons quel type d'animation est visible √† l'√©cran en ce moment, et nous ne la lisons que.</strong> </p><br><p>  Toutes les astuces du dernier paragraphe peuvent √™tre combin√©es avec l'observateur d'intersection.  Cet outil permet de ne pas charger le navigateur avec une animation que le visiteur du site ne voit pas.  Auparavant, des ¬´auditeurs¬ª d'√©v√©nements gourmands en ressources √©taient utilis√©s pour comprendre si un visiteur regardait un √©l√©ment anim√© et cela ne produisait pas un ¬´√©puisement¬ª fort.  La diff√©rence entre l'utilisation d'une animation en dehors de la fen√™tre et l'utilisation d'√©couteurs √©tait minime.  L'API Intersection Observer n√©cessite moins de ressources et permet de lire uniquement l'animation visible par le visiteur. </p><br><p>  Sur notre site, l'animation n'est activ√©e que lorsqu'un √©l√©ment appara√Æt dans la fen√™tre.  Si nous ne faisions pas cela, alors les pages seraient surcharg√©es avec une ex√©cution constante d'animations en boucle qui restaient hors de vue.  L'API Intersection Observer vous permet de surveiller l'intersection de l'√©l√©ment avec le parent ou la port√©e du document. </p><br><p>  <strong>Exemple d'impl√©mentation</strong> </p><br><p>  √Ä titre d'exemple, nous montrons comment optimiser l'animation sur JS.  L'id√©e est simple - l'animation est jou√©e pendant que l'√©l√©ment anim√© est dans la fen√™tre.  Pour l'impl√©mentation, nous utilisons l'API Intersection Observer. </p><br><p>  Ajouter <code>is-paused</code> gestion de classe <code>is-paused</code> aux styles </p><br><pre> <code class="plaintext hljs">.b-vertical-carousel-slider.is-paused { .vertical-carousel-slider-wrapper { .vertical-carousel-slider-item { animation-play-state: paused; } } .vertical-carousel-slider-shadow { animation-play-state: paused; } }</code> </pre> <br><p>  C'est-√†-dire  lorsque cette classe appara√Æt, l'animation est suspendue. </p><br><p>  Nous d√©crivons maintenant la logique de l'ajout et de la suppression de cette classe </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.IntersectionObserver) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> el = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.querySelector(<span class="hljs-string"><span class="hljs-string">'.b-vertical-carousel-slider'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> observer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IntersectionObserver(intersectionObserverCallback); observer.observe(el); }</code> </pre> <br><p>  Ici, nous avons cr√©√© une instance de IntersectionObserver, sp√©cifi√© la fonction <code>intersectionObserverCallback</code> , qui fonctionnera lorsque la visibilit√© changera. </p><br><p>  D√©finissez maintenant <code>intersectionObserverCallback</code> </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">intersectionObserverCallback</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">entries</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (entries[<span class="hljs-number"><span class="hljs-number">0</span></span>].intersectionRatio === <span class="hljs-literal"><span class="hljs-literal">undefined</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } helperDOM.toggleClass(el, <span class="hljs-string"><span class="hljs-string">'is-paused'</span></span>, entries[<span class="hljs-number"><span class="hljs-number">0</span></span>].intersectionRatio &lt;= <span class="hljs-number"><span class="hljs-number">0</span></span>); };</code> </pre> <br><p>  Maintenant, l'animation n'est jou√©e que sur les √©l√©ments visibles.  D√®s que l'√©l√©ment a disparu du champ de vision, l'animation est suspendue.  Lorsque le visiteur revient vers lui, la lecture continue. </p><br><p>  <strong>Liens utiles</strong> </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Navigateurs prenant en charge Intersection Observer</a> </li><li>  Pour les navigateurs qui ne le prennent pas en charge, vous devez utiliser <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">polyfil</a> </li></ul><br><h2 id="3-rendering-svg">  3. Rendu SVG </h2><br><p>  <strong>Un grand nombre d'images ou l'utilisation de sprites provoque des frises et des retards dans les premi√®res secondes apr√®s le chargement.</strong>  <strong>L'int√©gration de SVG dans le code de la page aide √† rendre visuellement le chargement plus fluide.</strong> </p><br><p>  Lorsque nous avons s√©lectionn√© des m√©thodes pour travailler avec des images, nous avions 2 options d'optimisation: int√©grer SVG en HTML ou utiliser des sprites.  Nous nous sommes install√©s sur l'int√©gration.  Nous int√©grons le code XML de chaque image directement dans le code HTML des pages.  Cela augmente l√©g√®rement leur taille, mais SVG est servi en ligne imm√©diatement avec le document. </p><br><p>  De nombreux d√©veloppeurs continuent d'utiliser des sprites SVG.  Quelle est l'essence de la m√©thode: un tableau d'images (par exemple, des ic√¥nes) est collect√© dans une grande toile d'image, qui est appel√©e un sprite.  Lorsque vous devez afficher une ic√¥ne sp√©cifique, un sprite est appel√©, apr√®s quoi les coordonn√©es de la pi√®ce sp√©cifique sur laquelle il se trouve sont donn√©es.  Cela a √©t√© fait depuis longtemps, m√™me sur la premi√®re version de HTTP.  Les sprites ont aid√© √† mettre en cache le fichier de mani√®re agressive et √† r√©duire le nombre de demandes de serveur.  C'√©tait important car de nombreuses demandes simultan√©es ralentissaient le navigateur.  L'utilisation des sprites SVG est une b√©quille typique avec laquelle vous n√©gligez la logique de travailler pour √©conomiser des ressources.  Maintenant, le nombre de demandes n'est pas si important, nous recommandons donc l'incorporation. </p><br><p>  Tout d'abord, elle affecte positivement les performances du point de vue du visiteur.  Il voit comment les ic√¥nes se chargent instantan√©ment et ne souffre pas les premi√®res secondes apr√®s le chargement de la page.  Lorsque vous utilisez des images sprite ou PNG, la page en cours de chargement ralentit un peu.  Cela est particuli√®rement ressenti si le visiteur fait imm√©diatement d√©filer la page charg√©e - FPS passera √† 5-15 sur les appareils non top.  L'incorporation de SVG dans HTML permet de r√©duire la latence de chargement des pages (subjective, du point de vue du client) et de se d√©barrasser des frises et des chutes de trames pendant le chargement. </p><br><h2 id="4-keshirovanie-s-ispolzovaniem-service-worker-i-http-cache">  4. Mise en cache √† l'aide de Service Worker et du cache HTTP </h2><br><p>  <strong>Cela n'a aucun sens de recharger une page qui n'a pas chang√© et d'utiliser le trafic des visiteurs.</strong>  <strong>Il existe de nombreuses strat√©gies de mise en cache, nous avons opt√© pour la combinaison la plus efficace.</strong> </p><br><p>  Il vaut la peine d'optimiser l'utilisation non seulement du CPU / GPU, mais aussi du r√©seau.  Les appareils mobiles sont une limitation non seulement en termes de ressources, mais aussi en termes de vitesse et de trafic Internet.  La mise en cache nous a aid√©s ici.  Il vous permet d'enregistrer les r√©ponses aux requ√™tes HTTP et de les utiliser sans recevoir √† nouveau de r√©ponse du serveur. </p><br><p>  Lorsque nous avons envisag√© une strat√©gie de mise en cache, nous avons choisi d'utiliser Service Worker et HTTP Cache en m√™me temps.  Commen√ßons par le premier et le plus avanc√©.  Service Worker est un fichier js qui peut contr√¥ler sa page ou son fichier, intercepter et modifier les demandes, ainsi que les demandes de cache par programme.  Il agit comme un proxy entre le site et le serveur et d√©termine leur comportement hors ligne.  Tout cela se fait sur le ¬´front¬ª, sans connecter de ¬´backend¬ª. </p><br><p>  Le travailleur de service a une √©norme variabilit√©.  Nous pouvons programmer le comportement √† notre guise.  Par exemple, nous savons qu'un visiteur qui est all√© √† la page num√©ro 1, avec une probabilit√© de 90%, ira √† la page num√©ro 2.  Nous demandons √† SW de charger la deuxi√®me page avec l'arri√®re-plan lorsque le visiteur est toujours sur la premi√®re.  Lorsqu'il y acc√®de, la page se charge instantan√©ment.  Il peut √™tre utilis√© pour diff√©rentes t√¢ches: </p><br><ul><li>  Synchronisation des donn√©es d'arri√®re-plan </li><li>  Calculatrices hors ligne </li><li>  Mod√®les personnalis√©s </li><li>  R√©action √† une heure et une date sp√©cifiques. </li></ul><br><p>  Les fichiers Service Worker peuvent √™tre cr√©√©s dans diff√©rents services.  Nous recommandons <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Workbox</a> .  Il est assez simple et vous permet de cr√©er un ensemble de r√®gles par lesquelles la mise en cache est effectu√©e, par exemple, la mise en cache pr√©alable. </p><br><p>  Les techniciens de service ne prennent pas en charge tous les navigateurs, tels que IE, Safari ou Chrome avant la version 40.0.  Si le p√©riph√©rique ne peut pas fonctionner avec lui, il suit les r√®gles de mise en cache du cache HTTP.  Nous avons ajout√© les en-t√™tes HTTP suivants aux pages: </p><br><pre> <code class="plaintext hljs">cache-control: no-cache last-modified: Mon, 06 May 2019 04:26:29 GMT</code> </pre> <br><p>  Dans ce cas, le navigateur ajoute des r√©ponses aux demandes au r√©f√©rentiel, mais √† chaque demande suivante, il envoie un en-t√™te pour v√©rifier les modifications. </p><br><pre> <code class="plaintext hljs">if-modified-since: Mon, 06 May 2019 04:26:29 GMT</code> </pre> <br><p>  Dans le cas o√π aucun changement ne s'est produit, le navigateur re√ßoit une r√©ponse avec le code 304 Non modifi√© et utilise le contenu stock√© dans le cache.  Si des modifications sont apport√©es au document, la r√©ponse est renvoy√©e avec le code 200 et une nouvelle r√©ponse est √©crite dans la m√©moire du navigateur. </p><br><p>  Un peu plus tard, nous avons chang√© la m√©thode de mise en cache et v√©rifi√© la quantit√© de hachage dans le nom du fichier.  Il garantit que la ressource restera unique.  Par cons√©quent, nous pourrions mettre en cache de mani√®re agressive le contenu.  L'en-t√™te suivant a √©t√© ajout√© en r√©ponse: </p><br><pre> <code class="plaintext hljs">Cache-control:max-age=31536000, immutable</code> </pre> <br><p>  Max-age indique la dur√©e maximale de mise en cache, dans notre cas, elle est de 1 an.  Une valeur immuable signifie qu'une telle r√©ponse n'a pas besoin d'√™tre v√©rifi√©e pour les changements. </p><br><p>  <strong>Liens utiles</strong> </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://developers.google.com/web/fundamentals/performance/optimizing-content-efficiency/">Manuel de mise en cache HTTP</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Guide d'utilisation de l'API Service Worker</a> </li></ul><br><p>  Ce ne sont pas tous des moyens d'optimiser le site.  Cela pourrait ajouter un rejet de bootstrap, r√©duisant le nombre d'√©l√©ments et d'√©v√©nements DOM, et bien plus encore.  Mais ce sont les conseils qui nous ont aid√©s √† rendre le site rapide et r√©actif, malgr√© la grande quantit√© d'animation. </p><br><h3 id="priglashaem-v-nashu-komandu">  Nous vous invitons √† notre √©quipe </h3><br><p>  Nous recherchons toujours des sp√©cialistes sympas dans notre bureau de Saint-P√©tersbourg pour nos t√¢ches ambitieuses: d√©veloppeurs, testeurs, designers.  Ci-dessous, il y a des postes vacants - rejoignez-nous. </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">D√©veloppeur frontend</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Ing√©nieur QA</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Ing√©nieur d√©veloppement logiciel en test</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr455700/">https://habr.com/ru/post/fr455700/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr455686/index.html">Comment choisir le meilleur outil de gestion de projet si vous √™tes un mill√©naire?</a></li>
<li><a href="../fr455692/index.html">ASZP: le restyling ou le th√©√¢tre commence par un cintre</a></li>
<li><a href="../fr455694/index.html">Architecture de facturation de nouvelle g√©n√©ration: transition vers Tarantool</a></li>
<li><a href="../fr455696/index.html">L'√©tat √©lectronique du futur. 2e partie</a></li>
<li><a href="../fr455698/index.html">Le livre "Comment JavaScript fonctionne"</a></li>
<li><a href="../fr455702/index.html">G√©n√©ration efficace de nombres dans un intervalle donn√©</a></li>
<li><a href="../fr455710/index.html">Pourquoi chez Leroy Merlin, avons-nous besoin de notre propre service de d√©veloppement russe pour 200 personnes</a></li>
<li><a href="../fr455714/index.html">Exportez automatiquement Google Forms vers Notion √† l'aide d'IFTTT et de Django</a></li>
<li><a href="../fr455716/index.html">15 meilleures pratiques pour le d√©ploiement de logiciels de Business Intelligence</a></li>
<li><a href="../fr455720/index.html">Comment nous construisons l'interface utilisateur pour les syst√®mes publicitaires</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>