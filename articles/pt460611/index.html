<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üì• üëéüèº üôÜüèª Failover: o perfeccionismo nos destr√≥i e ... pregui√ßa üê± üßëüèø‚Äçü§ù‚ÄçüßëüèΩ üîö</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="No ver√£o, tanto a atividade de compra quanto a intensidade das mudan√ßas na infraestrutura dos projetos da web diminuem tradicionalmente, diz o Capit√£o...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Failover: o perfeccionismo nos destr√≥i e ... pregui√ßa</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/itsumma/blog/460611/"> <i>No ver√£o, tanto a atividade de compra quanto a intensidade das mudan√ßas na infraestrutura dos projetos da web diminuem tradicionalmente, diz o Capit√£o Evidence.</i>  <i>S√≥ porque mesmo as pessoas de TI saem de f√©rias.</i>  <i>E CTO tamb√©m.</i>  <i>√â ainda mais dif√≠cil para os que permanecem no posto, mas n√£o sobre isso agora: talvez seja por isso que o ver√£o seja o melhor momento para se apressar no esquema de reservas existente e planejar um aprimoramento.</i>  <i>E nisso voc√™ se beneficiar√° da experi√™ncia de Yegor Andreev da <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">AdminDivision</a> , sobre a qual ele falou na confer√™ncia do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">dia</a> da <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">atividade</a> .</i> <br><br>  Durante a constru√ß√£o dos locais de reserva, durante a reserva, existem v√°rias armadilhas nas quais voc√™ pode cair.  E cair neles √© absolutamente imposs√≠vel.  E nos arruinando em tudo isso, assim como em muitas outras coisas, perfeccionismo e ... pregui√ßa.  Estamos tentando fazer tudo, tudo, tudo √© perfeito, mas voc√™ n√£o precisa fazer isso perfeitamente!  S√≥ √© necess√°rio fazer certas coisas, mas faz√™-las corretamente, traz√™-las ao fim, para que funcionem normalmente. <br><br>  O failover n√£o √© um tipo de coisa divertida de se divertir;  √© algo que deve fazer exatamente uma coisa - reduzir o tempo de inatividade para que o servi√ßo, empresa, perca menos dinheiro.  E em todos os m√©todos de reserva, sugiro pensar no seguinte contexto: onde est√° o dinheiro? <br><br><img src="https://habrastorage.org/webt/jz/ia/-7/jzia-79mf2emmdcqetbiatuuqfo.jpeg"><br><a name="habracut"></a><br>  <b>A primeira armadilha</b> : quando constru√≠mos grandes sistemas confi√°veis ‚Äã‚Äãe fazemos backups, reduzimos o n√∫mero de acidentes.  Esta √© uma fal√°cia terr√≠vel.  Quando fazemos backups, provavelmente aumentamos o n√∫mero de acidentes.  E se fizermos tudo certo, juntos reduziremos o tempo de inatividade.  Haver√° mais acidentes, mas eles ocorrer√£o a um custo menor.  Afinal, o que √© redund√¢ncia?  √â uma complica√ß√£o do sistema.  Qualquer complica√ß√£o √© ruim: temos mais engrenagens, mais engrenagens, em uma palavra, mais elementos - e, portanto, uma maior chance de avaria.  E eles realmente quebram.  E eles v√£o quebrar com mais frequ√™ncia.  Um exemplo simples: digamos que temos um site com PHP, MySQL.  E ele precisa urgentemente de ser reservado. <br><br>  Shtosh (c) Pegamos o segundo site, constru√≠mos um sistema id√™ntico ... A complexidade se torna duas vezes maior - temos duas entidades.  E tamb√©m rolamos certa l√≥gica de transfer√™ncia de dados de uma plataforma para outra de cima - ou seja, replica√ß√£o de dados, est√°tica de c√≥pia e assim por diante.  Portanto, a l√≥gica da replica√ß√£o geralmente √© muito complexa e, portanto, a complexidade total do sistema pode n√£o ser 2, mas 3, 5, 10 vezes mais. <br><br>  <b>A segunda armadilha</b> : quando constru√≠mos sistemas complexos realmente grandes, fantasiamos o que queremos obter no final.  Voila: queremos obter um sistema super confi√°vel que funcione sem nenhum tempo de inatividade, alterne em meio segundo (ou melhor em geral instantaneamente) e comece a transformar sonhos em realidade.  Mas h√° tamb√©m uma nuance: quanto menor o tempo de comuta√ß√£o desejado, mais complexa √© a l√≥gica do sistema.  Quanto mais dif√≠cil for fazer essa l√≥gica, mais frequentemente o sistema ir√° quebrar.  E voc√™ pode entrar em uma situa√ß√£o muito desagrad√°vel: estamos fazendo o poss√≠vel para reduzir o tempo de inatividade, mas na verdade complicamos as coisas e, quando algo der errado, o tempo de inatividade ser√° mais longo.  Aqui, muitas vezes, voc√™ se v√™ pensando: aqui ... seria melhor se eles n√£o tivessem sido reservados.  Seria melhor se funcionasse sozinho com um tempo de inatividade compreens√≠vel. <br><br>  Como lidar com isso?  Devemos parar de mentir para n√≥s mesmos, parar de nos gabar de que vamos construir uma nave espacial aqui, mas para entender adequadamente o quanto o projeto pode se desenvolver.  E, por esse tempo m√°ximo, escolheremos com quais m√©todos, de fato, aumentaremos a confiabilidade do nosso sistema. <br><br><img src="https://habrastorage.org/webt/iv/s3/fl/ivs3flng1tmpqnfqym23_-dhjms.jpeg"><br><br>  √â hora de "hist√≥rias de w" ... da vida, √© claro. <br><br><h4>  Exemplo n√∫mero um </h4><br>  Imagine o cart√£o do local da usina de lamina√ß√£o de tubos n¬∫ 1 da cidade N. Est√° escrito em grandes letras - PIPELINE PLANT No. 1.  Um pouco mais baixo - o slogan: "Nossos tubos s√£o os mais redondos em N".  E abaixo do n√∫mero de telefone do CEO e seu nome.  Entendemos que voc√™ precisa reservar - isso √© uma coisa muito importante!  Come√ßamos a entender em que consiste.  Html-static - ou seja, algumas fotos em que o general, de fato, √† mesa no banho com seu parceiro est√° discutindo um pr√≥ximo acordo.  Come√ßamos a pensar em tempo de inatividade.  Lembra-se: voc√™ precisa ficar l√° por cinco minutos, n√£o mais.  E ent√£o a pergunta √©: quantas vendas deste site foram em geral?  Quanto custa?  O que significa zero?  E isso significa: porque o general fez todas as quatro transa√ß√µes no ano passado na mesma mesa, com as mesmas pessoas com quem eles v√£o ao balne√°rio sentam √† mesa.  E entendemos que, mesmo que o site fique parado por um dia, n√£o haver√° nada de terr√≠vel. <br><br>  Com base na introdu√ß√£o, h√° um dia para levantar essa hist√≥ria.  Come√ßamos a pensar no esquema de backup.  E n√≥s selecionamos o esquema de backup mais ideal para este exemplo: n√£o usamos redund√¢ncia.  Todo esse problema surge por qualquer administrador por meia hora com intervalos para fumar.  Colocar um servidor web, colocar arquivos √© tudo.  Isso vai funcionar.  Voc√™ n√£o precisa seguir nada, n√£o precisa prestar aten√ß√£o especial a nada.  Ou seja, a conclus√£o do exemplo n√∫mero um √© bastante √≥bvia: servi√ßos que voc√™ n√£o precisa reservar n√£o s√£o necess√°rios. <br><br><img src="https://habrastorage.org/webt/em/ho/dj/emhodjmsvznkfjdzlc2chs4goow.jpeg"><br><br><h4>  Exemplo n√∫mero dois </h4><br>  Blog da empresa: os especialmente treinados escrevem not√≠cias por l√°, por isso participamos de uma exposi√ß√£o dessas, mas aqui lan√ßamos outro novo produto e assim por diante.  Digamos que esse seja o PHP padr√£o do WordPress, um pequeno banco de dados e um pouco de est√°tica.  √â claro que me ocorre novamente que voc√™ nunca deve mentir - "n√£o mais do que cinco minutos!", Isso √© tudo.  Mas vamos pensar mais.  O que este blog est√° fazendo?  Eles v√™m do Yandex, do Google, em alguns pedidos, de org√¢nicos.  Uau.  E as vendas est√£o de alguma forma relacionadas a ele?  Introspec√ß√£o: n√£o realmente.  O tr√°fego de publicidade vai para o site principal, que est√° em outra m√°quina.  Come√ßamos a pensar no esquema de reserva de folhetos.  De uma maneira boa, ele precisa ser levantado em algumas horas e seria bom se preparar para isso.  Seria razo√°vel pegar uma m√°quina em outro data center, direcionar o ambiente para ela, ou seja, um servidor web, PHP, WordPress, MySQL, e deix√°-la deitada.  No momento em que entendemos que tudo est√° quebrado, duas coisas precisam ser feitas - role o despejo mysql para 50 metros, ele voar√° para l√° em um minuto e tire algumas fotos do backup l√°.  Isso tamb√©m n√£o √© uma boa not√≠cia por l√°.  Assim, em meia hora, tudo isso aumenta.  Sem r√©plicas, ou Deus me perdoe, failover autom√°tico.  Conclus√£o: o que podemos implementar rapidamente do backup n√£o √© necess√°rio reservar. <br><br><img src="https://habrastorage.org/webt/hd/h-/s6/hdh-s6csoog6vc1peorwrxkwaw0.jpeg"><br><br><h4>  Exemplo n√∫mero tr√™s, mais complicado </h4><br>  Loja online.  PhP com cora√ß√£o aberto √© um pouco arquivado, mysql com uma base s√≥lida.  Muita est√°tica (afinal, a loja on-line tem belas imagens em HD e todo esse jazz), Redis para a sess√£o e Elasticsearch para a pesquisa.  Come√ßamos a pensar em tempo de inatividade.  E aqui, √© claro, √© √≥bvio que uma loja on-line n√£o pode passar o dia sem dor.  Afinal, quanto mais tempo estiver, mais dinheiro perdemos.  Vale a pena acelerar.  Quanto?  Acredito que, se nos deitarmos por uma hora, ningu√©m ficar√° louco.  Sim, vamos perder alguma coisa, mas se come√ßarmos a zelar, isso s√≥ piorar√°.  Determinamos o tempo ocioso permitido por hora. <br><br>  Como tudo isso pode ser reservado?  De qualquer forma, √© necess√°rio um carro: uma hora √© bastante.  Mysql: replica√ß√£o, replica√ß√£o ao vivo j√° √© necess√°ria aqui, porque em uma hora 100 GB em um despejo, provavelmente, n√£o ser√£o derramados.  Est√°tica, imagens: novamente, em uma hora, 500 GB talvez n√£o tenham tempo para mesclar.  Portanto, √© melhor copiar fotos imediatamente.  Redis: mais interessante aqui.  As sess√µes s√£o em Redis - simplesmente n√£o podemos peg√°-lo e enterr√°-lo.  Porque n√£o ser√° muito bom: todos os usu√°rios ser√£o desconectados, cestas vazias e assim por diante.  As pessoas ser√£o for√ßadas a digitar novamente seu nome de usu√°rio e senha, e muitas pessoas poder√£o se separar e n√£o concluir a compra.  Mais uma vez, a convers√£o cair√°.  Por outro lado, o Redis √© diretamente um a um relevante, com os √∫ltimos usu√°rios conectados, provavelmente, tamb√©m n√£o √© necess√°rio.  E um bom compromisso √© pegar o Redis e restaur√°-lo do backup ontem, ou, se voc√™ fizer isso a cada hora, - uma hora atr√°s.  O benef√≠cio de restaur√°-lo do backup √© copiar um arquivo.  E a hist√≥ria mais interessante √© a Elasticsearch.  Quem j√° levantou a replica√ß√£o do MySQL?  Quem j√° criou a replica√ß√£o do Elasticsearch?  E quem ela trabalhou normalmente depois?  O que estou fazendo: vemos uma certa entidade em nosso sistema.  Parece ser √∫til - mas √© complicado. <br>  Complexo no sentido de que nossos colegas engenheiros n√£o t√™m experi√™ncia em trabalhar com ele.  Ou h√° uma experi√™ncia negativa.  Ou entendemos que at√© agora essa √© uma tecnologia relativamente nova, com nuances ou umidade.  N√≥s pensamos ... Porra, el√°stico tamb√©m √© saud√°vel, tamb√©m leva muito tempo para restaur√°-lo do backup, o que devo fazer?  Entendemos que o el√°stico no nosso caso √© usado para pesquisa.  E como a nossa loja online vende?  Vamos aos profissionais de marketing, perguntamos, de onde as pessoas v√™m.  Eles respondem: "90% do mercado Yandex vem diretamente para o cart√£o do produto".  E compre ou n√£o.  Portanto, 10% dos usu√°rios precisam de uma pesquisa.  E para manter el√°stica a replica√ß√£o, especialmente entre diferentes datacenters em zonas diferentes, existem muitas nuances.  Qual √© a sa√≠da?  Tomamos el√°stico em um site reservado e n√£o fazemos nada com ele.  Se o caso persistir, um dia provavelmente o aumentaremos, mas isso n√£o √© certo.  Na verdade, a conclus√£o mais ou menos √© a mesma: n√≥s, novamente, n√£o reservamos servi√ßos que n√£o afetam o dinheiro.  Para manter o circuito mais simples. <br><br><img src="https://habrastorage.org/webt/xo/eu/z8/xoeuz8bhw_hpg4lwinkn1zjorhy.jpeg"><br><br><h4>  Exemplo n√∫mero quatro, ainda mais dif√≠cil </h4><br>  Integrador: vender flores, chamar um t√°xi, vender mercadorias, em geral, qualquer coisa.  Uma coisa s√©ria que funciona 24/7 para um grande n√∫mero de usu√°rios.  Com uma pilha interessante de pleno direito, onde existem bases, solu√ß√µes interessantes, uma carga alta e, o mais importante, machuca-o ficar mais de 5 minutos.  N√£o apenas e nem tanto, porque as pessoas n√£o compram, mas porque as pessoas ver√£o que essa coisa n√£o est√° funcionando, elas ficar√£o chateadas e poder√£o n√£o voltar pela segunda vez. <br><br>  Ok  Cinco minutos  O que faremos com isso?  Nesse caso, estamos de uma maneira adulta, com todo o dinheiro que estamos construindo em um site de backup real, com replica√ß√£o de tudo e de tudo e talvez at√© automatizar a troca m√°xima para este site.  Al√©m disso, n√£o se deve esquecer de fazer uma coisa importante: de fato, escreva a programa√ß√£o da troca.  Os regulamentos, mesmo que voc√™ tenha tudo automatizado, podem ser muito simples.  Na s√©rie ‚Äúexecute tal e tal script ans√≠vel‚Äù, ‚Äúclique em tal e assim naw na rota 53‚Äù e assim por diante - mas essa deve ser uma lista exata de a√ß√µes. <br><br>  E tudo parece estar claro.  A troca de replica√ß√£o √© uma tarefa trivial ou ser√° alterada automaticamente.  Reescreva um nome de dom√≠nio em DNS - da mesma s√©rie.  O problema √© que, quando um projeto semelhante falha, o p√¢nico come√ßa e at√© os administradores mais poderosos e barbudos podem ser propensos a ele.  Sem uma instru√ß√£o clara "abra um terminal, v√° aqui, o endere√ßo em nosso servidor ainda √© assim", o prazo de 5 minutos alocado para reanima√ß√£o √© dif√≠cil de sustentar.  Al√©m disso, quando usamos esses regulamentos, √© f√°cil corrigir algumas altera√ß√µes na infraestrutura, por exemplo, e alter√°-los de acordo. <br>  Bem, se o sistema de backup √© muito complexo e, em algum momento, cometemos um erro, tamb√©m podemos colocar nosso site de reserva e, al√©m disso, transformar os dados em uma ab√≥bora nos dois sites - ser√° muito triste. <br><br><img src="https://habrastorage.org/webt/xa/3t/zr/xa3tzr7mykypd7fsmkvtyumf1o4.jpeg"><br><br><h4>  Exemplo n√∫mero cinco, hardcore completo </h4><br>  Um servi√ßo internacional com centenas de milh√µes de usu√°rios em todo o mundo.  Todos os fusos hor√°rios, que existem apenas, carregam alta velocidade m√°xima, voc√™ n√£o deve mentir.  Um minuto - e ser√° triste.  O que fazer  Reserve, novamente, na √≠ntegra.  Eles fizeram tudo o que foi mencionado no exemplo anterior e um pouco mais.  Um mundo ideal e nossa infraestrutura - √© de acordo com todos os conceitos da devopa IaaC.  Ou seja, tudo em geral no git, e apenas clique no bot√£o. <br><br>  O que est√° faltando?  Um s√£o os ensinamentos.  Voc√™ n√£o pode prescindir deles.  Parece que tudo est√° perfeito conosco, tudo est√° sob controle em geral.  Pressionamos o bot√£o, tudo acontece.  Mesmo que seja assim - e entendemos que isso n√£o acontece - nosso sistema interage com outros sistemas.  Por exemplo, esses s√£o DNS da rota 53, armazenamento s3, integra√ß√£o com algumas APIs.  N√£o seremos capazes de prever tudo nesse experimento especulativo.  E at√© realmente pressionarmos o interruptor, n√£o saberemos se funcionar√° ou n√£o. <br><br><img src="https://habrastorage.org/webt/6q/v-/jk/6qv-jkxmxhmvzrwuocwtx6gfhu8.jpeg"><br><br>  Provavelmente √© tudo.  N√£o seja pregui√ßoso e n√£o exagere.  E que o tempo de atividade esteja com voc√™! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt460611/">https://habr.com/ru/post/pt460611/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt460597/index.html">Como diagnosticar problemas de integra√ß√£o do SDK. A experi√™ncia da equipe de desenvolvimento do Yandex Mobile Ads SDK</a></li>
<li><a href="../pt460599/index.html">Not√≠cias do mundo do OpenStreetMap no 468 (02/07/2019 - 08.07.2019)</a></li>
<li><a href="../pt460603/index.html">V2G. Carros el√©tricos ajudar√£o a equilibrar a produ√ß√£o e o consumo de eletricidade</a></li>
<li><a href="../pt460605/index.html">Est√∫dio Fotogr√°fico Autom√°tico, Parte 1</a></li>
<li><a href="../pt460607/index.html">Loja de aplicativos de seguran√ßa ofensiva com ferramentas de hackers do Android</a></li>
<li><a href="../pt460615/index.html">Na sequ√™ncia do Industrial Ninja: como o PLC foi hackeado no Positive Hack Days 9</a></li>
<li><a href="../pt460617/index.html">Toda a verdade sobre o RTOS. Artigo 30. Procedimentos de inicializa√ß√£o e inicializa√ß√£o do N√∫cleo SE</a></li>
<li><a href="../pt460621/index.html">Tic Tac Toe Parte 4: Interagindo com o back-end do frasco usando HTTP</a></li>
<li><a href="../pt460623/index.html">Sobre a tortura de Julian Assange</a></li>
<li><a href="../pt460625/index.html">Como n√£o consegui o primeiro lugar na competi√ß√£o para desenvolvedores de JavaScript do Telegram</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>