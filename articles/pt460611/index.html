<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>📥 👎🏼 🙆🏻 Failover: o perfeccionismo nos destrói e ... preguiça 🐱 🧑🏿‍🤝‍🧑🏽 🔚</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="No verão, tanto a atividade de compra quanto a intensidade das mudanças na infraestrutura dos projetos da web diminuem tradicionalmente, diz o Capitão...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Failover: o perfeccionismo nos destrói e ... preguiça</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/itsumma/blog/460611/"> <i>No verão, tanto a atividade de compra quanto a intensidade das mudanças na infraestrutura dos projetos da web diminuem tradicionalmente, diz o Capitão Evidence.</i>  <i>Só porque mesmo as pessoas de TI saem de férias.</i>  <i>E CTO também.</i>  <i>É ainda mais difícil para os que permanecem no posto, mas não sobre isso agora: talvez seja por isso que o verão seja o melhor momento para se apressar no esquema de reservas existente e planejar um aprimoramento.</i>  <i>E nisso você se beneficiará da experiência de Yegor Andreev da <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">AdminDivision</a> , sobre a qual ele falou na conferência do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">dia</a> da <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">atividade</a> .</i> <br><br>  Durante a construção dos locais de reserva, durante a reserva, existem várias armadilhas nas quais você pode cair.  E cair neles é absolutamente impossível.  E nos arruinando em tudo isso, assim como em muitas outras coisas, perfeccionismo e ... preguiça.  Estamos tentando fazer tudo, tudo, tudo é perfeito, mas você não precisa fazer isso perfeitamente!  Só é necessário fazer certas coisas, mas fazê-las corretamente, trazê-las ao fim, para que funcionem normalmente. <br><br>  O failover não é um tipo de coisa divertida de se divertir;  é algo que deve fazer exatamente uma coisa - reduzir o tempo de inatividade para que o serviço, empresa, perca menos dinheiro.  E em todos os métodos de reserva, sugiro pensar no seguinte contexto: onde está o dinheiro? <br><br><img src="https://habrastorage.org/webt/jz/ia/-7/jzia-79mf2emmdcqetbiatuuqfo.jpeg"><br><a name="habracut"></a><br>  <b>A primeira armadilha</b> : quando construímos grandes sistemas confiáveis ​​e fazemos backups, reduzimos o número de acidentes.  Esta é uma falácia terrível.  Quando fazemos backups, provavelmente aumentamos o número de acidentes.  E se fizermos tudo certo, juntos reduziremos o tempo de inatividade.  Haverá mais acidentes, mas eles ocorrerão a um custo menor.  Afinal, o que é redundância?  É uma complicação do sistema.  Qualquer complicação é ruim: temos mais engrenagens, mais engrenagens, em uma palavra, mais elementos - e, portanto, uma maior chance de avaria.  E eles realmente quebram.  E eles vão quebrar com mais frequência.  Um exemplo simples: digamos que temos um site com PHP, MySQL.  E ele precisa urgentemente de ser reservado. <br><br>  Shtosh (c) Pegamos o segundo site, construímos um sistema idêntico ... A complexidade se torna duas vezes maior - temos duas entidades.  E também rolamos certa lógica de transferência de dados de uma plataforma para outra de cima - ou seja, replicação de dados, estática de cópia e assim por diante.  Portanto, a lógica da replicação geralmente é muito complexa e, portanto, a complexidade total do sistema pode não ser 2, mas 3, 5, 10 vezes mais. <br><br>  <b>A segunda armadilha</b> : quando construímos sistemas complexos realmente grandes, fantasiamos o que queremos obter no final.  Voila: queremos obter um sistema super confiável que funcione sem nenhum tempo de inatividade, alterne em meio segundo (ou melhor em geral instantaneamente) e comece a transformar sonhos em realidade.  Mas há também uma nuance: quanto menor o tempo de comutação desejado, mais complexa é a lógica do sistema.  Quanto mais difícil for fazer essa lógica, mais frequentemente o sistema irá quebrar.  E você pode entrar em uma situação muito desagradável: estamos fazendo o possível para reduzir o tempo de inatividade, mas na verdade complicamos as coisas e, quando algo der errado, o tempo de inatividade será mais longo.  Aqui, muitas vezes, você se vê pensando: aqui ... seria melhor se eles não tivessem sido reservados.  Seria melhor se funcionasse sozinho com um tempo de inatividade compreensível. <br><br>  Como lidar com isso?  Devemos parar de mentir para nós mesmos, parar de nos gabar de que vamos construir uma nave espacial aqui, mas para entender adequadamente o quanto o projeto pode se desenvolver.  E, por esse tempo máximo, escolheremos com quais métodos, de fato, aumentaremos a confiabilidade do nosso sistema. <br><br><img src="https://habrastorage.org/webt/iv/s3/fl/ivs3flng1tmpqnfqym23_-dhjms.jpeg"><br><br>  É hora de "histórias de w" ... da vida, é claro. <br><br><h4>  Exemplo número um </h4><br>  Imagine o cartão do local da usina de laminação de tubos nº 1 da cidade N. Está escrito em grandes letras - PIPELINE PLANT No. 1.  Um pouco mais baixo - o slogan: "Nossos tubos são os mais redondos em N".  E abaixo do número de telefone do CEO e seu nome.  Entendemos que você precisa reservar - isso é uma coisa muito importante!  Começamos a entender em que consiste.  Html-static - ou seja, algumas fotos em que o general, de fato, à mesa no banho com seu parceiro está discutindo um próximo acordo.  Começamos a pensar em tempo de inatividade.  Lembra-se: você precisa ficar lá por cinco minutos, não mais.  E então a pergunta é: quantas vendas deste site foram em geral?  Quanto custa?  O que significa zero?  E isso significa: porque o general fez todas as quatro transações no ano passado na mesma mesa, com as mesmas pessoas com quem eles vão ao balneário sentam à mesa.  E entendemos que, mesmo que o site fique parado por um dia, não haverá nada de terrível. <br><br>  Com base na introdução, há um dia para levantar essa história.  Começamos a pensar no esquema de backup.  E nós selecionamos o esquema de backup mais ideal para este exemplo: não usamos redundância.  Todo esse problema surge por qualquer administrador por meia hora com intervalos para fumar.  Colocar um servidor web, colocar arquivos é tudo.  Isso vai funcionar.  Você não precisa seguir nada, não precisa prestar atenção especial a nada.  Ou seja, a conclusão do exemplo número um é bastante óbvia: serviços que você não precisa reservar não são necessários. <br><br><img src="https://habrastorage.org/webt/em/ho/dj/emhodjmsvznkfjdzlc2chs4goow.jpeg"><br><br><h4>  Exemplo número dois </h4><br>  Blog da empresa: os especialmente treinados escrevem notícias por lá, por isso participamos de uma exposição dessas, mas aqui lançamos outro novo produto e assim por diante.  Digamos que esse seja o PHP padrão do WordPress, um pequeno banco de dados e um pouco de estática.  É claro que me ocorre novamente que você nunca deve mentir - "não mais do que cinco minutos!", Isso é tudo.  Mas vamos pensar mais.  O que este blog está fazendo?  Eles vêm do Yandex, do Google, em alguns pedidos, de orgânicos.  Uau.  E as vendas estão de alguma forma relacionadas a ele?  Introspecção: não realmente.  O tráfego de publicidade vai para o site principal, que está em outra máquina.  Começamos a pensar no esquema de reserva de folhetos.  De uma maneira boa, ele precisa ser levantado em algumas horas e seria bom se preparar para isso.  Seria razoável pegar uma máquina em outro data center, direcionar o ambiente para ela, ou seja, um servidor web, PHP, WordPress, MySQL, e deixá-la deitada.  No momento em que entendemos que tudo está quebrado, duas coisas precisam ser feitas - role o despejo mysql para 50 metros, ele voará para lá em um minuto e tire algumas fotos do backup lá.  Isso também não é uma boa notícia por lá.  Assim, em meia hora, tudo isso aumenta.  Sem réplicas, ou Deus me perdoe, failover automático.  Conclusão: o que podemos implementar rapidamente do backup não é necessário reservar. <br><br><img src="https://habrastorage.org/webt/hd/h-/s6/hdh-s6csoog6vc1peorwrxkwaw0.jpeg"><br><br><h4>  Exemplo número três, mais complicado </h4><br>  Loja online.  PhP com coração aberto é um pouco arquivado, mysql com uma base sólida.  Muita estática (afinal, a loja on-line tem belas imagens em HD e todo esse jazz), Redis para a sessão e Elasticsearch para a pesquisa.  Começamos a pensar em tempo de inatividade.  E aqui, é claro, é óbvio que uma loja on-line não pode passar o dia sem dor.  Afinal, quanto mais tempo estiver, mais dinheiro perdemos.  Vale a pena acelerar.  Quanto?  Acredito que, se nos deitarmos por uma hora, ninguém ficará louco.  Sim, vamos perder alguma coisa, mas se começarmos a zelar, isso só piorará.  Determinamos o tempo ocioso permitido por hora. <br><br>  Como tudo isso pode ser reservado?  De qualquer forma, é necessário um carro: uma hora é bastante.  Mysql: replicação, replicação ao vivo já é necessária aqui, porque em uma hora 100 GB em um despejo, provavelmente, não serão derramados.  Estática, imagens: novamente, em uma hora, 500 GB talvez não tenham tempo para mesclar.  Portanto, é melhor copiar fotos imediatamente.  Redis: mais interessante aqui.  As sessões são em Redis - simplesmente não podemos pegá-lo e enterrá-lo.  Porque não será muito bom: todos os usuários serão desconectados, cestas vazias e assim por diante.  As pessoas serão forçadas a digitar novamente seu nome de usuário e senha, e muitas pessoas poderão se separar e não concluir a compra.  Mais uma vez, a conversão cairá.  Por outro lado, o Redis é diretamente um a um relevante, com os últimos usuários conectados, provavelmente, também não é necessário.  E um bom compromisso é pegar o Redis e restaurá-lo do backup ontem, ou, se você fizer isso a cada hora, - uma hora atrás.  O benefício de restaurá-lo do backup é copiar um arquivo.  E a história mais interessante é a Elasticsearch.  Quem já levantou a replicação do MySQL?  Quem já criou a replicação do Elasticsearch?  E quem ela trabalhou normalmente depois?  O que estou fazendo: vemos uma certa entidade em nosso sistema.  Parece ser útil - mas é complicado. <br>  Complexo no sentido de que nossos colegas engenheiros não têm experiência em trabalhar com ele.  Ou há uma experiência negativa.  Ou entendemos que até agora essa é uma tecnologia relativamente nova, com nuances ou umidade.  Nós pensamos ... Porra, elástico também é saudável, também leva muito tempo para restaurá-lo do backup, o que devo fazer?  Entendemos que o elástico no nosso caso é usado para pesquisa.  E como a nossa loja online vende?  Vamos aos profissionais de marketing, perguntamos, de onde as pessoas vêm.  Eles respondem: "90% do mercado Yandex vem diretamente para o cartão do produto".  E compre ou não.  Portanto, 10% dos usuários precisam de uma pesquisa.  E para manter elástica a replicação, especialmente entre diferentes datacenters em zonas diferentes, existem muitas nuances.  Qual é a saída?  Tomamos elástico em um site reservado e não fazemos nada com ele.  Se o caso persistir, um dia provavelmente o aumentaremos, mas isso não é certo.  Na verdade, a conclusão mais ou menos é a mesma: nós, novamente, não reservamos serviços que não afetam o dinheiro.  Para manter o circuito mais simples. <br><br><img src="https://habrastorage.org/webt/xo/eu/z8/xoeuz8bhw_hpg4lwinkn1zjorhy.jpeg"><br><br><h4>  Exemplo número quatro, ainda mais difícil </h4><br>  Integrador: vender flores, chamar um táxi, vender mercadorias, em geral, qualquer coisa.  Uma coisa séria que funciona 24/7 para um grande número de usuários.  Com uma pilha interessante de pleno direito, onde existem bases, soluções interessantes, uma carga alta e, o mais importante, machuca-o ficar mais de 5 minutos.  Não apenas e nem tanto, porque as pessoas não compram, mas porque as pessoas verão que essa coisa não está funcionando, elas ficarão chateadas e poderão não voltar pela segunda vez. <br><br>  Ok  Cinco minutos  O que faremos com isso?  Nesse caso, estamos de uma maneira adulta, com todo o dinheiro que estamos construindo em um site de backup real, com replicação de tudo e de tudo e talvez até automatizar a troca máxima para este site.  Além disso, não se deve esquecer de fazer uma coisa importante: de fato, escreva a programação da troca.  Os regulamentos, mesmo que você tenha tudo automatizado, podem ser muito simples.  Na série “execute tal e tal script ansível”, “clique em tal e assim naw na rota 53” e assim por diante - mas essa deve ser uma lista exata de ações. <br><br>  E tudo parece estar claro.  A troca de replicação é uma tarefa trivial ou será alterada automaticamente.  Reescreva um nome de domínio em DNS - da mesma série.  O problema é que, quando um projeto semelhante falha, o pânico começa e até os administradores mais poderosos e barbudos podem ser propensos a ele.  Sem uma instrução clara "abra um terminal, vá aqui, o endereço em nosso servidor ainda é assim", o prazo de 5 minutos alocado para reanimação é difícil de sustentar.  Além disso, quando usamos esses regulamentos, é fácil corrigir algumas alterações na infraestrutura, por exemplo, e alterá-los de acordo. <br>  Bem, se o sistema de backup é muito complexo e, em algum momento, cometemos um erro, também podemos colocar nosso site de reserva e, além disso, transformar os dados em uma abóbora nos dois sites - será muito triste. <br><br><img src="https://habrastorage.org/webt/xa/3t/zr/xa3tzr7mykypd7fsmkvtyumf1o4.jpeg"><br><br><h4>  Exemplo número cinco, hardcore completo </h4><br>  Um serviço internacional com centenas de milhões de usuários em todo o mundo.  Todos os fusos horários, que existem apenas, carregam alta velocidade máxima, você não deve mentir.  Um minuto - e será triste.  O que fazer  Reserve, novamente, na íntegra.  Eles fizeram tudo o que foi mencionado no exemplo anterior e um pouco mais.  Um mundo ideal e nossa infraestrutura - é de acordo com todos os conceitos da devopa IaaC.  Ou seja, tudo em geral no git, e apenas clique no botão. <br><br>  O que está faltando?  Um são os ensinamentos.  Você não pode prescindir deles.  Parece que tudo está perfeito conosco, tudo está sob controle em geral.  Pressionamos o botão, tudo acontece.  Mesmo que seja assim - e entendemos que isso não acontece - nosso sistema interage com outros sistemas.  Por exemplo, esses são DNS da rota 53, armazenamento s3, integração com algumas APIs.  Não seremos capazes de prever tudo nesse experimento especulativo.  E até realmente pressionarmos o interruptor, não saberemos se funcionará ou não. <br><br><img src="https://habrastorage.org/webt/6q/v-/jk/6qv-jkxmxhmvzrwuocwtx6gfhu8.jpeg"><br><br>  Provavelmente é tudo.  Não seja preguiçoso e não exagere.  E que o tempo de atividade esteja com você! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt460611/">https://habr.com/ru/post/pt460611/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt460597/index.html">Como diagnosticar problemas de integração do SDK. A experiência da equipe de desenvolvimento do Yandex Mobile Ads SDK</a></li>
<li><a href="../pt460599/index.html">Notícias do mundo do OpenStreetMap no 468 (02/07/2019 - 08.07.2019)</a></li>
<li><a href="../pt460603/index.html">V2G. Carros elétricos ajudarão a equilibrar a produção e o consumo de eletricidade</a></li>
<li><a href="../pt460605/index.html">Estúdio Fotográfico Automático, Parte 1</a></li>
<li><a href="../pt460607/index.html">Loja de aplicativos de segurança ofensiva com ferramentas de hackers do Android</a></li>
<li><a href="../pt460615/index.html">Na sequência do Industrial Ninja: como o PLC foi hackeado no Positive Hack Days 9</a></li>
<li><a href="../pt460617/index.html">Toda a verdade sobre o RTOS. Artigo 30. Procedimentos de inicialização e inicialização do Núcleo SE</a></li>
<li><a href="../pt460621/index.html">Tic Tac Toe Parte 4: Interagindo com o back-end do frasco usando HTTP</a></li>
<li><a href="../pt460623/index.html">Sobre a tortura de Julian Assange</a></li>
<li><a href="../pt460625/index.html">Como não consegui o primeiro lugar na competição para desenvolvedores de JavaScript do Telegram</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>