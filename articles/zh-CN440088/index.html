<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🐓 🙆🏽 🕊️ bobaflu-颤振编程配件 😎 👲🏽 👨🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="本文将重点介绍Flutter移动客户端的实现。 


 哪个移动客户端？ 


 先前的出版物描述了软件附件的系统： 
 bobaoskit-附件，dnssd和WebSocket 。 


软件附件的类似物是真实的对象。 灯泡，开关，CD /盒带播放器，收音机播放器，恒温器，温度传感器，运动传感器等...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>bobaflu-颤振编程配件</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/440088/"><p><img src="https://habrastorage.org/webt/-n/0y/sv/-n0ysvv41yt_uwk8hh-fa1ui79e.png"></p><br><p> 本文将重点介绍Flutter移动客户端的实现。 </p><br><p> 哪个移动客户端？ </p><br><p> 先前的出版物描述了软件附件的系统： <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">bobaoskit-附件，dnssd和WebSocket</a> 。 </p><br><p>软件附件的类似物是真实的对象。 灯泡，开关，CD /盒带播放器，收音机播放器，恒温器，温度传感器，运动传感器等。...一组配件取决于想象力和程序代码。 您可以至少实现一个棋盘。 对于这样的板，您需要有一个控制字段（ <code>control</code> ） <code>move</code> ，它带有一个对象<code>{ from: "e2", to: "e4" }</code> ，以及用于重置图形的服务字段等。...附件脚本将处理控制<code>move</code>字段的请求，接受决定是否可以移动图形，并将在整个字段中返回（或不返回）图形位置的状态。 </p><br><p> 当前支持的功能最少的附件类型如下：“开关”，“温度传感器”，“恒温器”，“无线电播放器”。 </p><br><p> 关于国际象棋，将不再进一步讨论。 如果很有趣，在这种情况下，欢迎光临。 </p><a name="habracut"></a><br><p> 因此， <code>bobaoskit.worker</code>正在运行。 附件对象存在于计算机的内存中，您可以阅读有关它们的信息，可以将<code>JSON</code>请求手动发送到<code>WebSocket</code>端口，并查看传入的事件。 </p><br><p> 为了管理，我制作了最简单的移动应用程序。 </p><br><h2 id="pochemu-flutter"> 为什么扑扑？ </h2><br><p> 在过去的几年中，一个想法一直浮在脑海中，以研究移动设备的编程。 自从我用<code>JavaScript</code>编写以来，我研究了一些解决方案，这些解决方案使您无法学习新的编程语言。 </p><br><p>  <code>Appcelerator</code> 他和他一起开始学习。 如果内存没有更改，则打开SDK，但是IDE具有各种收费标准。 <br>  <code>NativeScript</code> 在这里，我已经创建了一个简单的应用程序，其中显示了带有图片的列表。 并没有进一步。 <br>  <code>ReactNative</code> 迄今为止列出的框架中最长的攻击。 最大的挑战是入门。 我看着课程。 最初，结果很明显很有趣。 但是<code>redux</code>和过载后失败了。 然后，他定期尝试开始写作，但顽固地使<code>redux</code>不能压倒一切。 </p><br><p> 结果，那时（2016年底）我没有任何决定。 也许是因为没有特定的任务，或者是由于其他原因。 </p><br><p> 接近过去的秋天（2018年），软件配件SDK已在进行中。 自然，您需要一个移动应用程序。 一切始于mdns。 在业余时间，我更新了ReactNative，找到了react-native-zeroconf插件，创建了应用程序。 根据说明，安装完毕，做了一个<code>link</code> ，启动了。 启动了Expo调试应用程序，该应用程序不支持本机模块，因此mdns插件不起作用。 在这一点上，没有足够的空闲时间来创建干净的（没有expo）反应本地应用程序并对其进行测试。 这项工作被推迟了几个月。 </p><br><p> 同时，关于网络<code>flutter</code>材料越来越多。 我自己安装了。 安装很简单： <code>git clone</code>并添加到<code>PATH</code> 。 其余的已经设置了Android SDK / Xcode（就我而言，Android SDK已经配置了很长时间。由于我不是macOS用户，所以我无法为iOS开发）和Dart SDK（您可以单独安装，但不一定安装，因为它是flutter的一部分）。 </p><br><h2 id="principshema-raboty"> 工作原理/方案 </h2><br><ul><li> 启动后，该应用程序使用<a href="">flutter_mdns</a>插件在本地网络上搜索<code>_bobaoskit._tcp</code>服务。 此插件有多种版本，它们均源于已<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">发布的</a>版本，但分别与Dart SDK的新版本不兼容，许多分支和添加的兼容性。 我之所以选择此版本，是因为其他版本无法一次解析多个发现的服务的主机。 <br> 根据检测和确定（onResolve），将主机添加到列表中。 <br> 包含发现的服务列表的页面分别是<code>StatefulWidget</code> ，当它检测到/服务丢失时，将调用<code>setState() {...}</code> </li><li> 从列表中选择主机时，将创建一个新页面（也称为<code>StatefulWidget</code> ），所选服务的<code>host</code>和<code>port</code>将发送到该页面。 <br> 创建负责通讯的<code>BobaosKit</code>对象。 响应通过回调进行处理，如下 虽然我没有研究太多异步飞镖。 但是从扫描的文档来看， <code>Futures</code>是JS中<code>Promise</code>的类似物。 <br> 记录传入事件的功能（无响应）。 在<code>EventEmitter</code>寻找Dart的<code>EventEmitter</code> 。 我写的很简单。 </li></ul><br><pre> <code class="plaintext hljs"> void registerListener(String name, Function cb) { this._events.add(new BobaosKitCallback(name, cb)); } void removeAllListeners() { this._events = []; } void emitEvent(String name, dynamic params) { // call all listeners List&lt;BobaosKitCallback&gt; foundCallbacks = this._events.where((t) =&gt; t.name == name).toList(); foundCallbacks.forEach((f) =&gt; f.cb(params)); } ... ... void listen() { this.ws.listen((text) { var json = jsonDecode(text); if (json.containsKey('response_id')) { .... } else { //   response_id -  this.emitEvent(json['method'], json['payload']); } }); }</code> </pre> <br><p> 传入事件-如果附件已卸下，添加，更新状态。 或者如果所有附件都已卸下（ <code>clear accessories</code> ）。 </p><br><p> 注册功能-用于更新列表，这些事件的小部件。 </p><br><ul><li> 发送请求以获取有关所有附件的信息。 </li></ul><br><p> 为每个附件创建一个AccessoryInfo对象： </p><br><pre> <code class="plaintext hljs">import 'package:scoped_model/scoped_model.dart'; // AccessoryInfo extends Model // so, when accessory value is updated it descends down to // all widgets inside ScopedModelDescendant class AccessoryInfo extends Model { dynamic id; dynamic type; String name; String job_channel; List control; List status; bool selected; Map&lt;dynamic, dynamic&gt; currentState; AccessoryInfo(Map&lt;dynamic, dynamic&gt; obj) { this.id = obj['id']; this.type = obj['type']; this.name = obj['name']; this.job_channel = obj['job_channel']; this.control = obj['control']; this.status = obj['status']; this.currentState = {}; } void updateCurrentState(key, value) { currentState[key] = value; notifyListeners(); } void notify() { notifyListeners(); } }</code> </pre> <br><p> 该对象已经是模型。 最初，我到处都写了<code>StatefulWidget</code>和<code>setState() {}</code> ，但是<code>setState() {}</code>仅适用于在其中注册了侦听器的小部件。 但是为了进行详细的附件管理，我最初创建了新的<code>Stateful</code>页面，并注意到状态没有更新。 作为解决方案，使用了<code>ScopedModel</code> 。 </p><br><p> 收到附件列表后，我们将为每个附件发送状态请求，并将其添加到列表<code>List &lt;AccessoryInfo&gt;</code> 。 调用<code>setState() {}</code> ，从而将支持的附件添加到接口。 受支持的附件类型在<code>ListView.builder</code>和<code>./lib/widgets/*.dart</code>中定义。 当前支持的<code>switch/temperature sensor/radio player/thermostat</code> 。 未来的主要工作是添加新的和改进现有的小部件。 </p><br><ul><li> 现在介绍如何为每个附件创建单独的元素。 例如，考虑一个开关。 </li></ul><br><pre> <code class="plaintext hljs"> @override Widget build(BuildContext context) { return new ScopedModel&lt;AccessoryInfo&gt;( model: info, child: ScopedModelDescendant&lt;AccessoryInfo&gt;( builder: (context, child, model) { var cardColor = Theme.of(context).cardColor; dynamic switchState = model.currentState['state']; if (switchState is bool) { if (switchState) { cardColor = Colors.deepPurple; } else { cardColor = Theme.of(context).cardColor; } } return Card( color: cardColor, child: ListTile( selected: false, leading: new Icon(Icons.lightbulb_outline), title: new Text("${model.name}"), onTap: () { // to control accessory value // get status value at first bobaos.getStatusValue( model.id, "state", (bool err, Object payload) { if (err) { return print('error ocurred $payload'); } if (payload is Map) { dynamic currentValue = payload['status']['value']; bool newValue; if (currentValue is bool) { // invert newValue = !currentValue; } else { newValue = false; } // then send new value bobaos.controlAccessoryValue( model.id, {"state": newValue}, (bool err, Object payload) { if (err) { return print('error ocurred $payload'); } }); } }); }, onLongPress: () { // TODO: dialog with additional funcs }, )); })); }</code> </pre> <br><p> 对于<code>switch</code>类型的附件，将在附件的常规列表中创建一个元素，当与之交互时（onTap），将发送一个请求以获取当前值，然后切换该值。  <code>ScopedModel</code>允许<code>ScopedModel</code>重新绘制窗口小部件以进行传入状态更新。 </p><br><p> 没有为此配件实现长按处理程序。 </p><br><p> 对于广播播放器，如下所示： </p><br><pre> <code class="plaintext hljs"> onLongPress: () { Navigator.of(context).push(MaterialPageRoute( builder: (context) =&gt; AccRadioPlayerControl( info: info, bobaos: bobaos, ))); },</code> </pre> <br><p> 将<code>AccRadioPlayerControl</code>页面，该页面还使用<code>ScopedModel</code>来管理状态。 </p><br><p> 在此，对程序操作算法的整个描述都用尽了。 没有实现其他功能，例如记住最后一个主机，将配件分类到类别/房间中。 目前，一切都很简单。 </p><br><h2 id="problemy"> 问题所在 </h2><br><p> 我将描述现在的主要问题。 我仍然不明白如何检测断开的<code>WebSocket</code>连接。 </p><br><p> 我使用： <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">WebSocket类</a> 。 </p><br><p> 当应用程序/设备长时间处于睡眠模式时，连接断开。 您必须返回到第一页并重新打开发现的服务。 </p><br><h2 id="posleslovie"> 后记 </h2><br><p> 一方面，Flutter学习和发展非常快。 事实证明，ScopedModel比redux更易于理解。 <br> 事实证明，Dart与熟悉的JavaScript类似。 键入+动态类型将使每个人都能方便地编写代码。 </p><br><p> 编写代码的困难：小部件的大量嵌套。 扑朔迷离后，众所周知的回调地狱看起来有所不同。  Vim模式和<code>%</code>将很有用。 </p><br><p> 现在有关物联网的一些想法。 最近，越来越多的需要在云中注册的智能设备/服务。 需要安装应用程序才能使用的中国网点，请创建一个帐户，然后您才能使用它。 </p><br><p> 语音助手。  Yandex的Alice要求将识别的文本发送到她的云中。 亚马逊的Alexa的工作方式与此类似。 </p><br><p> 在我看来，最成功的是Apple HomeKit与Siri一起制造的。 云用于文本识别。 与设备的交互-在局域网中。 </p><br><p> 我的观点是，云必须出于其目的而存在：远程控制，更新等。。。如果可以在本地网络上控制设备，则需要这样做。 </p><br><h2 id="ssylki"> 参考文献 </h2><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">应用程序存储库</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Bobaoskit文档</a> -描述如何安装bobaoskit.worker并启动<code>radio player</code>附件。 </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN440088/">https://habr.com/ru/post/zh-CN440088/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN440074/index.html">Roskomos认为比较猛禽发动机Ilona Mask和RD-180是不正确的</a></li>
<li><a href="../zh-CN440076/index.html">广告从英语到俄语的翻译和口译</a></li>
<li><a href="../zh-CN440078/index.html">Swift编译器设备。 第4部分</a></li>
<li><a href="../zh-CN440084/index.html">100亿软件出口可忽略不计</a></li>
<li><a href="../zh-CN440086/index.html">MS-DOS病毒世界</a></li>
<li><a href="../zh-CN440090/index.html">股市技术指标实际上如何运作？</a></li>
<li><a href="../zh-CN440092/index.html">关于2018年9月16日滨海边疆区伪造州长选举的数学调查</a></li>
<li><a href="../zh-CN440094/index.html">火星上盛开的花园仍然是一个梦想：火星一号项目破产</a></li>
<li><a href="../zh-CN440096/index.html">影响Kubernetes，Docker和容器化的RunC漏洞</a></li>
<li><a href="../zh-CN440098/index.html">月光仍然是全自动的。 第2部分。分隔符。 冰箱 立方体 演算法</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>