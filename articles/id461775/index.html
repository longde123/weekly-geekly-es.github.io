<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸš’ ğŸ“† ğŸ§ 3 kasus untuk menggunakan Seledri dalam aplikasi Django ğŸšˆ ğŸ‘¨ğŸ¼â€âš–ï¸ ğŸ––ğŸ½</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Saya membuat aplikasi web di Django. Pada dasarnya, ini adalah layanan SaaS untuk bisnis. Semua aplikasi ini memerlukan tugas yang tidak sinkron. Untu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>3 kasus untuk menggunakan Seledri dalam aplikasi Django</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/461775/"><img src="https://habrastorage.org/webt/4w/u0/gt/4wu0gtw9jsubehn772rd2ezlouo.jpeg" alt="gambar"><br><br>  Saya membuat aplikasi web di Django.  Pada dasarnya, ini adalah layanan SaaS untuk bisnis.  Semua aplikasi ini memerlukan tugas yang tidak sinkron.  Untuk implementasi mereka saya menggunakan Seledri.  Dalam artikel ini saya akan menceritakan tentang situasi di mana saya menggunakan Seledri, dengan contoh kode. <br><a name="habracut"></a><br>  Seledri adalah sistem untuk mengelola antrian tugas.  Secara fundamental mampu 2 hal: mengambil tugas dari antrian dan melakukan tugas sesuai jadwal.  Pialang antrian biasanya RabbitMQ atau Redis.  Tugas-tugas dimasukkan dalam antrian, dan kemudian pekerja Seledri mengambilnya dari sana dan melaksanakannya. <br><br>  Untuk Celery, Anda dapat memikirkan sebuah aplikasi di hampir semua aplikasi, tetapi kemudian saya akan menjelaskan hanya kasus-kasus di mana saya menggunakannya sendiri. <br><br><h3>  1. Tugas Terjadwal </h3><br>  Seringkali ada tugas yang perlu diselesaikan pada tanggal dan waktu tertentu: mengirim pengingat kepada pengguna, mengakhiri masa percobaan akun, menerbitkan posting di jejaring sosial. <br><br>  Di Seledri, dimungkinkan untuk menentukan parameter <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">ETA</a> saat memanggil tugas - waktu di mana tugas harus diluncurkan.  Tetapi jika Anda merencanakan tugas dengan cara ini, maka itu ternyata sangat tidak dapat diandalkan: mereka mungkin tidak memulai dan mereka dapat merasa tidak nyaman untuk membatalkan. <br><br>  Cara yang lebih dapat diandalkan adalah dengan menggunakan jadwal celerybeat.  Artinya, buat jadwal di mana akan ada tugas yang dimulai pada frekuensi tertentu atau pada waktu tertentu.  Misalnya, jika Anda perlu menerbitkan posting di jejaring sosial sesuai jadwal, maka tugas untuk ini diluncurkan satu menit sekali.  Jika Anda harus menyelesaikan periode uji coba untuk akun Anda, Anda dapat menjalankan tugas sekali sehari. <br><br><pre><code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># schedule.py from datetime import timedelta from celery.schedules import crontab CELERYBEAT_SCHEDULE = { 'publish_post_starter': { 'task': 'publish_post_starter', 'schedule': timedelta(minutes=1), }, 'end_trial_starter': { 'task': 'end_trial_starter', 'schedule': crontab(hour=10, minute=21), }, }</span></span></code> </pre> <br>  Di starter tugas, kita mendapatkan semua instance yang waktu yang direncanakan sudah tiba.  Kami melalui contoh dan untuk masing-masing kami memanggil tugas utama.  Sebagai argumen, kami hanya mengirimkan id instance agar tidak menyumbat antrian dengan data yang tidak perlu.  Kita dapat segera melalui semua instance dan melakukan tindakan, tetapi paling sering lebih baik memanggil tugas terpisah untuk setiap instance.  Jadi kami akan mempercepat eksekusi, dan jika terjadi kesalahan, itu hanya akan mempengaruhi salah satu tugas. <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># tasks.py @app.task(name='publish_post') def publish_post(post_id): ... @app.task(name='publish_post_starter') def publish_post_starter(): post_ids = list( Post.objects.filter( publish_dt__lte=timezone.now(), is_published=False ).values_list('id', flat=True) ) for post_id in post_ids: publish_post.delay(post_id)</span></span></code> </pre><br><h3>  2. Komputasi panjang dan panggilan API dari WSGI </h3><br>  WSGI mengacu pada konteks di mana permintaan dari pengguna diproses (Siklus Permintaan-Respons).  Berbeda dengan konteks tugas asinkron - Seledri. <br><br>  Untuk membuat antarmuka responsif, semua tombol harus merespons secara instan dan tidak boleh memblokir antarmuka lainnya.  Untuk melakukan ini, setelah menekan tombol diblokir, pemintal ditempatkan di atasnya dan permintaan ajax dikirim ke server.  Jika memproses permintaan membutuhkan waktu lebih dari beberapa detik, maka Anda dapat memindahkan perhitungan ke tugas Seledri. <br><br>  Di WSGI, kami memanggil tugas dan mengembalikan respons.  Di bagian depan, buka kunci tombol dan lepaskan pemintal.  Kami menunjukkan kepada pengguna pesan bahwa tindakan sedang berjalan.  Secara paralel, tugas Seledri dijalankan, yang, setelah selesai, mengembalikan respons pada soket web.  Setelah menerima hasil di depan, kami menunjukkannya kepada pengguna. <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># rest_views.py from rest_framework import status from rest_framework.views import APIView from rest_framework.response import Response from tasks import send_emails class SendEmailView(APIView): def post(self, request): # this id will be used to send response with websocket request_uuid = request.data.get('request_uuid') if not request_uuid: return Response(status=status.HTTP_400_BAD_REQUEST) send_emails.delay(request.user.id, request_uuid) return Response(status=status.HTTP_200_OK)</span></span></code> </pre><br>  Secara terpisah, Anda dapat membedakan panggilan API eksternal dari WSGI.  Dalam hal ini, semua panggilan, terlepas dari durasi eksekusi, diluncurkan melalui tugas Seledri.  Ini adalah perlindungan dari si bodoh.  Seharusnya tidak ada situasi di mana, karena tidak dapat diaksesnya beberapa API eksternal, antarmuka pengguna membeku. <br><br><h3>  3. Tantangan dari Tornado </h3><br>  Saat berintegrasi dengan jejaring sosial, Telegram atau layanan pembayaran, Anda memerlukan url webhook yang akan menerima notifikasi.  Jumlah permintaan tidak selalu dapat dihitung sebelumnya, tetapi kemungkinan besar jumlah mereka akan melebihi permintaan dari pengguna.  Permintaan ini akan diterima sampai mereka menerima tanggapan dengan kode 200. <br><br>  Untuk memproses permintaan semacam itu, kerangka kerja asinkron Tornado cocok.  Agar tidak mengubah pemrosesan menjadi sinkron di Tornado, tidak boleh ada operasi pemblokiran.  Di sinilah diperlukan Seledri.  Pawang Tornado menerima permintaan, memvalidasi data, memanggil tugas Seledri, dan mengembalikan respons yang berhasil. <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># tornado_handlers.py from tornado import gen, escape from tornado.web import RequestHandler from tasks import handle_vk_callback class VkCallbackHandler(RequestHandler): @gen.coroutine def post(self, *args, **kwargs): try: data = escape.json_decode(self.request.body) except ValueError: self.set_status(status_code=400, reason='Invalid data') return handle_vk_callback.delay(data) self.write('ok') return</span></span></code> </pre></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id461775/">https://habr.com/ru/post/id461775/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id461765/index.html">Kami melintasi k8 dengan Kafka, menyimpan kontainer, melarikan diri dari sampah di Ansible: 10 laporan teratas dari DevOops 2018</a></li>
<li><a href="../id461767/index.html">Algoritma Mesin Pencari SVLAB</a></li>
<li><a href="../id461769/index.html">Bagaimana saya membuat (hampir) streaming webcam Javascript yang tidak berguna</a></li>
<li><a href="../id461771/index.html">Katakan tidak untuk diam: dari kamar bayi ke kantor</a></li>
<li><a href="../id461773/index.html">Airtest IDE - cara baru dalam pengujian otomatisasi game mobile?</a></li>
<li><a href="../id461779/index.html">80% dari data perusahaan Anda tidak tersedia untuk Anda. Apa yang harus dilakukan?</a></li>
<li><a href="../id461781/index.html">"Ycombinator Startup School 2019." Video tiga minggu pertama</a></li>
<li><a href="../id461785/index.html">Kerugian RISC-V</a></li>
<li><a href="../id461787/index.html">Tampilan teks Android</a></li>
<li><a href="../id461793/index.html">Ivan Ponomarev tentang Kafka Streams API di pertemuan jug.msk.ru</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>