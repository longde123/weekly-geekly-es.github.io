<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üçÇ ‚ôæ üçÉ Hist√≥rico de patches da Apple ‚úãüèº üë∂üèæ üëäüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Este ano, a1exdandy e eu conversamos nas confer√™ncias VolgaCTF e KazHackStan com uma palestra sobre os programas Patch Diffing escritos no Objective-C...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Hist√≥rico de patches da Apple</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dsec/blog/479972/"><p><img src="https://habrastorage.org/webt/wh/kp/c3/whkpc3ybatnoasln45yfqbbvrkc.jpeg" alt="imagem"></p><br><p>  Este ano, <a href="https://habr.com/ru/users/a1exdandy/" class="user_link">a1exdandy</a> e <a href="https://habr.com/ru/users/a1exdandy/" class="user_link">eu</a> conversamos nas confer√™ncias VolgaCTF e KazHackStan com uma palestra sobre os programas Patch Diffing escritos no Objective-C, e como us√°-lo para pesquisar e encontrar vulnerabilidades de 0 e 1 dia nos produtos da Apple.  Voc√™ pode assistir ao v√≠deo da apresenta√ß√£o <a href="https://youtu.be/G1p0CVNxK28%3Ft%3D5191">aqui</a> e, para ler o artigo, seja bem-vindo ao gato. </p><a name="habracut"></a><br><p>  Difus√£o bin√°ria √© o processo de comparar dois arquivos execut√°veis ‚Äã‚Äãpara encontrar semelhan√ßas e diferen√ßas entre eles.  A corre√ß√£o de patches √© um caso especial da corre√ß√£o de bin√°rios quando um arquivo com vulnerabilidade √© comparado com um arquivo fixo (arquivo com um patch).  Assim, voc√™ pode descobrir quais corre√ß√µes o desenvolvedor fez e entender qual era a vulnerabilidade. </p><br><p>  Alguns anos atr√°s (em 2013), foi <a href="https://xakep.ru/issues/xa/169/">publicado um artigo</a> sobre os programas Patch Diffing for Windows, aos quais tamb√©m t√≠nhamos uma m√£o.  Recomendamos que voc√™ se familiarize com ele, se estiver interessado neste t√≥pico em conex√£o com o sistema operacional Windows.  No mesmo artigo, falaremos sobre a an√°lise de programas para o Apple OS. </p><br><h2 id="chem-mogut-byt-polezny-binary-diffing-i-patch-diffing">  Como a difus√£o bin√°ria e a difus√£o de patches podem ser √∫teis? </h2><br><p>  A principal tarefa da difus√£o bin√°ria √© rastrear quais altera√ß√µes foram feitas no aplicativo.  Para fazer isso, voc√™ precisa pegar a vers√£o antiga e compar√°-la com a nova para ver quais altera√ß√µes o desenvolvedor adicionou e como elas s√£o implementadas. </p><br><p>  Vejamos situa√ß√µes em que isso pode ser √∫til: </p><br><ul><li>  <strong>An√°lise do desenvolvimento do programa</strong> : Comparando as vers√µes novas e antigas, √© poss√≠vel entender como o aplicativo est√° se desenvolvendo, quais novas funcionalidades s√£o adicionadas, quais s√£o removidas e quais altera√ß√µes o c√≥digo existente foi submetido. </li><li>  <strong>Importando o conhecimento existente</strong> : em programas que n√£o usam informa√ß√µes simb√≥licas, os engenheiros reversos precisam gastar muito mais tempo estudando a l√≥gica e procurando vulnerabilidades.  Mas acontece que em alguma vers√£o do software, os desenvolvedores acidentalmente ou deliberadamente deixam informa√ß√µes simb√≥licas.  Esta informa√ß√£o pode ser portada de l√° para a vers√£o do software que voc√™ precisa.  <a href="https://googleprojectzero.blogspot.com/2019/10/the-story-of-adobe-reader-symbols.html">Por exemplo</a> , os funcion√°rios do Google Project Zero que usam Biff Diffing conseguiram obter caracteres para as vers√µes mais recentes do Adobe Reader para Windows, de vers√µes mais antigas para outros sistemas operacionais, o que os ajudou a encontrar vulnerabilidades; </li><li> <strong>Treinamento em software real</strong> : em nossa opini√£o, o Patch Diffing √© uma √≥tima maneira de passar sem problemas do estudo de pequenos problemas de CTF para a pesquisa de software real.  Explorando o patch, voc√™ pode observar a vulnerabilidade real em um grande produto de software com todos os seus recursos (embora tenha certeza de que a vulnerabilidade est√° presente no c√≥digo).  Ao explorar erros em um produto, voc√™ pode gradualmente avan√ßar para encontrar as mesmas vulnerabilidades.  Como b√¥nus, voc√™ pode tentar escrever explora√ß√µes para eles; </li><li>  <strong>Criando explora√ß√µes de 1 dia</strong> : Quando um desenvolvedor j√° lan√ßou um patch, voc√™ pode analis√°-lo rapidamente, escrever uma explora√ß√£o para esta vulnerabilidade e obter uma explora√ß√£o de 1 dia.  Ao mesmo tempo, existe o chamado Patch Gapping - o tempo entre o lan√ßamento do patch e sua instala√ß√£o direta pelos clientes.  Durante esse per√≠odo, uma explora√ß√£o de 1 dia pode funcionar com √™xito e beneficiar seu autor (instalar atualiza√ß√µes em tempo h√°bil!) At√© que todos instalem o patch lan√ßado pelos desenvolvedores.  H√° situa√ß√µes em que uma vulnerabilidade √© corrigida em uma biblioteca, mas os programas ainda usam uma vers√£o desatualizada da biblioteca.  Aqui est√£o alguns exemplos interessantes de Patch Gapping for <a href="https://blog.exodusintel.com/2019/09/09/patch-gapping-chrome/">Chrome</a> e <a href="https://googleprojectzero.blogspot.com/2019/08/jsc-exploits.html">WebKit</a> ; </li><li>  <strong>Pesquise vulnerabilidades de 0 dia</strong> : n√£o importa o qu√£o estranho possa parecer, mas analisando as corre√ß√µes, voc√™ pode encontrar vulnerabilidades anteriormente desconhecidas (vulnerabilidades de 0 dia).  Os desenvolvedores tamb√©m est√£o enganados e, portanto, no processo de cria√ß√£o de um patch, a vulnerabilidade pode n√£o estar fechada corretamente.  Assim, analisando um patch, voc√™ pode encontrar uma maneira de contorn√°-lo.  Por exemplo, os desenvolvedores do Apache Struts corrigiram uma vulnerabilidade cinco vezes, mas o patch funcionou apenas em sua sexta vers√£o!  Al√©m disso, muitas vezes um desenvolvedor, cumprindo claramente a tarefa definida para corrigir uma certa vulnerabilidade, pode n√£o perceber o que est√° acontecendo nas se√ß√µes vizinhas do c√≥digo.  Pode haver exatamente a mesma vulnerabilidade nas proximidades e, em caso de detec√ß√£o, ser√° de 0 dias.  √â importante estudar o padr√£o de um erro de desenvolvedor detectado e tentar encontrar algo semelhante no mesmo programa.  Se o desenvolvedor cometeu um erro em um lugar, a probabilidade de repetir o mesmo erro em outro lugar √© alta. </li></ul><br><p>  Existe um mito de que ocultar informa√ß√µes sobre patches de vulnerabilidade aumenta a seguran√ßa.  No entanto, os invasores, por via de regra, j√° desenvolveram infraestrutura para analisar patches, para encontrar rapidamente os dados nos quais est√£o interessados.  Ocultar vulnerabilidades complica o trabalho dos respons√°veis ‚Äã‚Äãpela prote√ß√£o do sistema, porque, sem acesso total √†s informa√ß√µes, √© imposs√≠vel entender a import√¢ncia desse patch para a empresa.  Sobre esta quest√£o, √© altamente recomend√°vel que voc√™ leia o artigo <a href="http://addxorrol.blogspot.com/2019/08/rashomon-of-disclosure.html">"Rashomon of disclosure"</a> do pesquisador Halvar Flake, onde a situa√ß√£o √© vista sob diferentes √¢ngulos. </p><br><p>  Nem sempre as vulnerabilidades descobertas s√£o ocultadas intencionalmente.  Os desenvolvedores podem n√£o atribuir import√¢ncia especial a algumas das defici√™ncias de seus produtos e corrigi-las sem publicidade, como um bug comum. </p><br><p>  Temos certeza de que n√£o s√£o todas as situa√ß√µes em que voc√™ pode usar difus√£o bin√°ria e difus√£o de patches e, nos coment√°rios, pode escrever seus pr√≥prios scripts. </p><br><h2 id="instrumentariy">  Toolkit </h2><br><p>  A partir da teoria, passamos a praticar gradualmente.  Naturalmente, fazer Diffing bin√°rio manualmente √© uma tarefa louca.  Um extenso kit de ferramentas foi desenvolvido h√° muito tempo, consistindo em programas e plug-ins independentes para analisadores bin√°rios populares: Diaphora, BinDiff, DarunGrim, YaDiff, rizzo, Realyze, Turbodiff, patchdiff2, revanche e outros. </p><br><p><img src="https://habrastorage.org/webt/ek/ou/r0/ekour0t64vi9hsrnpnvpaqzra6e.png" alt="imagem"><br>  <em>Interface BinDiff.</em> </p><br><p><img src="https://habrastorage.org/webt/g_/q_/k1/g_q_k1bg4g_x858ps6k24ywuonk.png" alt="imagem"><br>  <em>Interface Diaphora</em> </p><br><p>  Na pr√°tica, usamos principalmente apenas os dois primeiros (eles s√£o apresentados nas capturas de tela acima).  Infelizmente, a maioria das ferramentas atuais n√£o √© animadora com a qualidade do trabalho ou √© completamente abandonada.  Agora, existem novas ferramentas usando o ML, mas sua qualidade deixa muito a desejar, embora tenham id√©ias interessantes para comparar arquivos bin√°rios de diferentes arquiteturas. </p><br><p>  Eu tamb√©m gostaria de observar separadamente as ferramentas recentemente exibidas para comparar o c√≥digo-fonte aberto em arquivos bin√°rios: Pigaios e Karta.  Esta √© uma dire√ß√£o muito interessante e √∫til.  Eles coletam m√©tricas do c√≥digo-fonte e as usam para comparar fun√ß√µes em arquivos bin√°rios.  Isso √© muito √∫til na aus√™ncia de caracteres e vincula√ß√£o est√°tica.  A tarefa dessas ferramentas √© mapear fun√ß√µes em um arquivo para fun√ß√µes em outro. </p><br><h2 id="sravnenie-patchey-dlya-operacionnyh-sistem-apple">  Compara√ß√£o de corre√ß√µes para sistemas operacionais Apple </h2><br><p>  Como regra, os aplicativos para o Apple OS gravam no Objective-C.  Esta √© uma extens√£o orientada a objetos para C, baseada em paradigmas da linguagem Smalltalk com seu pr√≥prio tempo de execu√ß√£o. </p><br><p>  Se abrirmos o programa Objective-C em algum analisador bin√°rio (no nosso caso, √© um IDA), veremos algo assim: as fun√ß√µes em C / C ++ ter√£o nomes abstratos e as fun√ß√µes em Objective-C ser√£o chamadas muito bem.  (Diremos imediatamente que n√£o consideramos situa√ß√µes com ofusca√ß√£o de c√≥digo - essa √© uma hist√≥ria separada.) Isso facilita a engenharia reversa: √© f√°cil ver qual objeto √© chamado, qual m√©todo √© usado e quais argumentos ele possui.  Al√©m disso, essas informa√ß√µes simb√≥licas simplificam bastante o trabalho com ferramentas para comparar arquivos bin√°rios.  Ele permite que voc√™ rapidamente e com um n√∫mero m√≠nimo de erros mapeie fun√ß√µes. </p><br><p><img src="https://habrastorage.org/webt/nc/dc/ri/ncdcrissgbl_y_deb3fx9qaqd9a.png" alt="imagem"></p><br><p>  Quando n√£o h√° s√≠mbolos, as ferramentas precisam usar algoritmos internos para an√°lise, heur√≠stica etc.  Naturalmente, eles nem sempre funcionam corretamente. </p><br><h2 id="use-cases-gde-patch-diffing-byl-ochen-polezen">  Casos de uso em que a corre√ß√£o de patches foi muito √∫til </h2><br><p>  Provavelmente, esta apresenta√ß√£o (no formato de 45 minutos) e este artigo n√£o teriam nascido se recentemente, a Apple n√£o tivesse surpreendido a comunidade mundial de pesquisas v√°rias vezes.  Vamos olhar para esses casos. </p><br><h3 id="case-1-cve-2019-8606">  Caso 1: CVE-2019-8606 </h3><br><p>  Em maio de 2019, foi lan√ßado o iOS 12.3 para iPhone, onde a vulnerabilidade com a qual era poss√≠vel instalar o jailbreak foi corrigida.  Em julho daquele ano, a Apple lan√ßou a vers√£o 12.4, onde o jailbreak voltou a funcionar: os funcion√°rios removeram acidentalmente o adesivo protetor.  A vers√£o corrigida foi lan√ßada apenas ap√≥s um m√™s: todo esse tempo, qualquer dispositivo da vers√£o mais recente poderia ser facilmente sujeito a opera√ß√µes de jailbreak.  Tudo isso foi descoberto gra√ßas ao patch diffing. </p><br><p><img src="https://habrastorage.org/webt/97/ri/gn/97rign6v9ubqzhnwlo3zgc0shre.png" alt="imagem"></p><br><h3 id="case-2-cve-2019-7278-i-cve-2019-7286">  Caso 2: CVE-2019-7278 e CVE-2019-7286 </h3><br><p>  A experi√™ncia pessoal com Patch difere na confer√™ncia Hack in the Box em seu relat√≥rio <a href="https://gsec.hitb.org/materials/sg2019/D2%2520-%2520Recreating%2520an%2520iOS%25200day%2520Jailbreak%2520Out%2520of%2520Apple%25E2%2580%2599s%2520Security%2520Updates%2520-%2520Stefan%2520Esser.pdf">Recriando um jailbreak do iOS de 0 dia com os patches de seguran√ßa da Apple foi</a> descrito pelo pesquisador de seguran√ßa Stefan Esser.  Ele falou sobre o CVE-2019-7278 e o CVE-2019-7286 - eles s√£o not√°veis ‚Äã‚Äãpelos que foram descobertos gra√ßas ao Grupo de An√°lise de Amea√ßas do Google durante o uso real por invasores (ITW, na natureza).  A Apple recebeu informa√ß√µes sobre eles, mas nem eles nem os caras do Google revelaram detalhes t√©cnicos.  Ent√£o Stefan se perguntou o que os atacantes estavam usando.  √â altamente recomend√°vel que voc√™ leia o relat√≥rio, pois ele tamb√©m fala sobre o processo de compara√ß√£o de componentes do kernel e do espa√ßo do usu√°rio. <br>  Fato interessante: um ou dois dias antes do discurso de Stefan, o Projeto Zero Ian Beer publicou uma s√©rie de artigos <a href="https://googleprojectzero.blogspot.com/2019/08/a-very-deep-dive-into-ios-exploit.html">"Um mergulho profundo nas cadeias de explora√ß√£o iOS encontradas na natureza"</a> , o que confundiu um pouco os mapas para o pesquisador;) </p><br><h3 id="case-3-checkm8">  Caso 3: checkm8 </h3><br><p>  Os dispositivos Apple usam dois gerenciadores de inicializa√ß√£o: Bootrom e Iboot.  O primeiro come√ßa a funcionar assim que o dispositivo √© ligado.  Est√° na mem√≥ria somente leitura e n√£o pode ser atualizado.  O Iboot √© um carregador de inicializa√ß√£o de segundo n√≠vel que aprimora a autentica√ß√£o executada na cadeia de inicializa√ß√£o. <br>  A peculiaridade dos carregadores √© que eles compartilham o c√≥digo.  No in√≠cio do ano passado, os especialistas compararam as atualiza√ß√µes do Iboot e descobriram que a Apple corrigia uma vulnerabilidade na pilha USB.  Sabendo que o mesmo c√≥digo √© usado na parte n√£o atualizada do Bootrom, eles perceberam que essa vulnerabilidade tamb√©m existe.  Em seguida, o desenvolvimento da explora√ß√£o checkm8 come√ßou.  Agora, todos os dispositivos baseados em chips de A5 a A11 (do iPhone 4s ao iPhone X) est√£o completamente vulner√°veis ‚Äã‚Äãe √© poss√≠vel executar seu pr√≥prio c√≥digo neles.  Ao mesmo tempo, em dispositivos das vers√µes XR e 11, essa vulnerabilidade j√° est√° fechada e n√£o houve relatos disso da Apple. <br>  Assim, sabendo onde foi corrigido e como o c√≥digo √© dividido, voc√™ pode encontrar algumas coisas muito legais! </p><br><h2 id="nasha-istoriya-cve-2019-8574">  Nossa hist√≥ria: CVE-2019-8574 </h2><br><p><img src="https://habrastorage.org/webt/sb/4a/hj/sb4ahjfaar4slhvzgdhshhe6qye.png" alt="imagem"><br>  Em maio, a Apple lan√ßou uma nova atualiza√ß√£o para seus dispositivos.  Examinamos a lista de vulnerabilidades corrigidas e encontramos o utilit√°rio sysdiagnose.  Este programa coleta informa√ß√µes de diagn√≥stico de v√°rias fontes e as transfere para o usu√°rio na forma de um arquivo para an√°lises adicionais, suporte ou um centro de servi√ßo.  Parecia que era imposs√≠vel influenciar a maneira como ela coleta informa√ß√µes.  A descri√ß√£o do patch afirmou que a vulnerabilidade poderia ser usada para aumentar privil√©gios e √© um erro de corrup√ß√£o de mem√≥ria, o que nos intrigou ainda mais.  E o pr√≥prio autor da descoberta n√£o publicou nenhuma descri√ß√£o de si mesmo ... </p><br><p><img src="https://habrastorage.org/webt/ss/qj/xs/ssqjxs3dnufltlr6qvqkakimzbw.png" alt="imagem"></p><br><p>  Voc√™ pode chamar sysdiagnose no macOS pressionando Ctrl + Option + Shift +., Ou usando o comando sudo sysdiagnose.  Nos dispositivos iOS, √© necess√°rio manter pressionada a tecla liga / desliga e as teclas de volume para cima e para baixo. </p><br><h3 id="patch-diffing-apple-na-praktike">  Patch Diffing Apple na pr√°tica </h3><br><p>  Se voc√™ deseja corrigir os dispositivos Apple com diferen√ßas, √© necess√°rio obter duas vers√µes da atualiza√ß√£o (antiga e nova).  No macOS, voc√™ pode analisar arquivos no Cat√°logo de Atualiza√ß√£o de Software.  Esse m√©todo nem sempre ajuda, pois a Apple remove algumas atualiza√ß√µes.  As atualiza√ß√µes tamb√©m podem ser encontradas no diret√≥rio / Library / Updates.  Voc√™ pode encontrar o firmware para dispositivos iOS no site <a href="https://ipsw.me/">ipsw.me.</a> <br>  Para o macOS, voc√™ precisa extrair arquivos execut√°veis, arquivos de biblioteca, estruturas e o kernel usando o utilit√°rio Suspicious Package. <br>  Para dispositivos iOS, as coisas s√£o um pouco mais complicadas.  A atualiza√ß√£o em si √© um arquivo ZIP.  Neste arquivo, voc√™ precisa encontrar o arquivo kernelcache: inside √© o kernel e sua extens√£o.  No entanto, antes da an√°lise, voc√™ precisa converter o arquivo para o formato Mach-O.  Isso pode ser feito usando os utilit√°rios img4tool, joker, jtool2 e outros. <br>  O firmware do componente terrestre do usu√°rio pode ser encontrado na maior imagem DMG: cont√©m o sistema raiz e os arquivos execut√°veis.  No entanto, se voc√™ olhar para bibliotecas e estruturas compartilhadas, elas n√£o estar√£o l√°.  O fato √© que, para otimizar o espa√ßo, eles s√£o colocados em dyld_shared_cache.  Este arquivo cont√©m todas as bibliotecas do iPhone e ocupa mais de 1 gigabyte, o que complica sua an√°lise.  Se voc√™ precisar baixar uma parte separada do arquivo ipsw, use o utilit√°rio ipsw ( <a href="https://github.com/blacktop/ipsw">https://github.com/blacktop/ipsw</a> ). </p><br><h3 id="patchdifing-cve-2019-8574">  Patchdifting CVE-2019-8574 </h3><br><p>  Para estudar o patch CVE-2019-8574, obtemos um arquivo da Library / Updates e extra√≠mos dois arquivos execut√°veis ‚Äã‚Äãde diagn√≥stico por sysdia (antigos e novos) usando o Pacote Suspeito e, em seguida, procuramos atualiza√ß√µes nos utilit√°rios para comparar c√≥digos bin√°rios, por exemplo, Diaphora ou BinDiff (eles s√£o muito melhor que o editor hexadecimal). </p><br><h3 id="kak-rabotaet-patch">  Como o patch funciona </h3><br><p>  Para a arquitetura x86_64, encontramos apenas uma fun√ß√£o alterada.  H√° mais mudan√ßas no ARM, mas s√£o insignificantes. </p><br><p><img src="https://habrastorage.org/webt/lz/-r/kw/lz-rkw3czadbapcb5bkywgenypo.png" alt="imagem"></p><br><p>  O problema estava no m√©todo [SDTask start]: ele adicionou uma nova verifica√ß√£o.  Na figura, voc√™ pode ver como √© chamada uma chamada para alguma fun√ß√£o isAppleInternal e a presen√ßa da substring / usr / local em algum caminho √© verificada. </p><br><p><img src="https://habrastorage.org/webt/hd/8u/vc/hd8uvcvbusgs1m52yx0xn8ka4ie.png" alt="imagem"></p><br><p>  Como afirmado anteriormente, o sysdiagnose coleta informa√ß√µes de v√°rias fontes.  As fontes podem ser arquivos (por exemplo, um log de eventos) ou a sa√≠da de alguns comandos de informa√ß√µes (por exemplo, listando processos ou threads usando ps) - essas tarefas s√£o armazenadas no sysdiagnose como objetos SDTask.  O m√©todo [SDTask start] inicia a execu√ß√£o das tarefas.  Na figura abaixo, voc√™ pode ver o c√≥digo no qual todas as tarefas s√£o formadas.  Todos os caminhos dos arquivos execut√°veis ‚Äã‚Äãe seus argumentos s√£o gravados diretamente no programa e existem tarefas de v√°rios diret√≥rios, incluindo / usr / local. </p><br><p><img src="https://habrastorage.org/webt/5y/kj/uc/5ykjuc8umbymhffj-xo01ohw2oi.png" alt="image! [] (./ assets / 8.png)"></p><br><p>  Portanto, antes de instalar o patch, qualquer tarefa pode ser executada independentemente de onde o arquivo execut√°vel est√° localizado.  Ap√≥s a instala√ß√£o do patch, √© chamada a fun√ß√£o isAppleInternal, que verifica se o dispositivo √© um dispositivo de teste interno da Apple.  Se este for um dispositivo interno, a tarefa ser√° executada de maneira padr√£o e, se for do lado do cliente, a presen√ßa da substring / usr / local / no caminho do arquivo execut√°vel da tarefa ser√° verificada.  Se uma substring for encontrada, a tarefa n√£o ser√° conclu√≠da. </p><br><p>  Lembre-se de que, na descri√ß√£o da vulnerabilidade, foi dito que se trata de um erro de corrup√ß√£o de mem√≥ria, mas no patch n√£o notamos nada parecido ... Em nossa opini√£o, essa √© uma vulnerabilidade l√≥gica bem e estavelmente explorada. </p><br><h3 id="kak-eto-ekspluatirovat">  Como explor√°-lo </h3><br><p>  Para explorar a vulnerabilidade, voc√™ deve executar as seguintes etapas: <br>  Crie qualquer arquivo execut√°vel (script bin√°rio ou shell) que o sysdiagnose seja iniciado a partir de / usr / local / bin e coloque nossa carga √∫til l√°.  A lista de arquivos v√°lidos √© fornecida abaixo.  √â importante que o gerenciador de pacotes brew esteja instalado no sistema: permite ao usu√°rio criar arquivos em / usr / local / sem elevar privil√©gios. </p><br><p>  √â necess√°rio chamar sysdiagnose.  Ao mesmo tempo, nossa carga √∫til ser√° executada com direitos de usu√°rio root e sua sa√≠da ser√° colocada no arquivo que sysdiagnosticar formul√°rios.  Assim, obtemos escala√ß√£o de privil√©gios.  No entanto, a execu√ß√£o do sysdiagnose exige privil√©gios elevados.  Mas, como mencionado acima, o sysdiagnose tamb√©m pode ser iniciado usando o atalho de teclado, e isso funciona mesmo na tela de bloqueio do macOS. <br>  Essa vulnerabilidade pode ser usada para criar v√°rios programas maliciosos. </p><br><pre><code class="plaintext hljs">/usr/local/bin/airplayutil /usr/local/bin/amstool /usr/local/bin/apsclient /usr/local/bin/audioDeviceDump /usr/local/bin/cdcontexttool /usr/local/bin/cddebug /usr/local/bin/cdknowledgetool /usr/local/bin/dastool /usr/local/bin/idstool /usr/local/bin/imtool /usr/local/bin/keystorectl /usr/local/bin/pmtool /usr/local/bin/xcpm /usr/local/efi/bin/efi-perf</code> </pre> <br><p>  Curiosamente, outras vulnerabilidades podem estar associadas ao gerenciador de pacotes de distribui√ß√£o, ou melhor, √† capacidade de gravar em / usr / local / sem privil√©gios. </p><br><h2 id="vyvod">  Conclus√£o </h2><br><p>  Com este estudo, gostar√≠amos de mostrar a import√¢ncia e a criticidade da corre√ß√£o de patches n√£o apenas para invasores, mas tamb√©m para aumentar a seguran√ßa dos produtos de software.  Infelizmente, o patch n√£o pode apenas fechar a vulnerabilidade, mas tamb√©m jogar nas m√£os do atacante. </p><br><p>  No entanto, essa abordagem permite n√£o apenas estudar vulnerabilidades conhecidas, mas tamb√©m procurar novas como elas.  Portanto, acreditamos que a corre√ß√£o de patches √© essencial para todo pesquisador. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt479972/">https://habr.com/ru/post/pt479972/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt479958/index.html">Vulnerabilidades de firmware e processador</a></li>
<li><a href="../pt479960/index.html">O modelo da efic√°cia da publicidade na m√≠dia para lojas online</a></li>
<li><a href="../pt479966/index.html">Playrix CI / CD: como constru√≠mos e testamos nossos jogos</a></li>
<li><a href="../pt479968/index.html">O escrit√≥rio da Nginx est√° sendo revistado devido ao processo do Rambler Group. O servi√ßo de imprensa reclamante confirmou o processo</a></li>
<li><a href="../pt479970/index.html">Mil e uma erros de interface do usu√°rio ou como ajudar um desenvolvedor a evitar erros comuns da interface do usu√°rio</a></li>
<li><a href="../pt479974/index.html">Ataques com clique zero: quando sua seguran√ßa n√£o depende de voc√™</a></li>
<li><a href="../pt479978/index.html">Como sem dor, sem captcha e gratuitamente para trazer extratos do Fundo Federal de Propriedade do Registro Federal dos Direitos Humanos do Estado para um leg√≠vel por humanos</a></li>
<li><a href="../pt479982/index.html">Vidos e insetos</a></li>
<li><a href="../pt479988/index.html">Competi√ß√µes tecnol√≥gicas Radiofest-2019. Sum√°rio</a></li>
<li><a href="../pt479992/index.html">Como ensinar o UITextView a se destacar maravilhosamente</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>