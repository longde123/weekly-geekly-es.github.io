<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐จ๐พโ๐ค ๐๐ผ ๐ฃ ูุฑุญุจุง ุงูุนุงูู! ุงูุงูุบูุงุณ ุงูุนููู ูู ุงููุญุทุงุช ๐ ๐ฅ ๐ฉ๐ผโ๐ค</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ุงุณุชูููุช ูู ูุชุงุจุฉ ูุฐุง ุงูููุงู ุจููุงู ุญูู ุชุญููู Sishny printf . ููุน ุฐูู ุ ููุฏ ุถุงุนุช ูุญุธุฉ ุญูู ุงูุทุฑููุฉ ุงูุชู ุชุชุจุนูุง ุงูุจูุงูุงุช ุจุนุฏ ุฃู ุชุฏุฎู ุงูุฌูุงุฒ ุงูุทุฑูู. ูู ูุฐู...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ูุฑุญุจุง ุงูุนุงูู! ุงูุงูุบูุงุณ ุงูุนููู ูู ุงููุญุทุงุช</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/460257/" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><img src="https://habrastorage.org/webt/ha/5f/0v/ha5f0vjiijc9c92bnnt56z7jcpg.jpeg"></a> </p><br><p style=";text-align:right;direction:rtl">  ุงุณุชูููุช ูู ูุชุงุจุฉ ูุฐุง ุงูููุงู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุจููุงู ุญูู ุชุญููู Sishny printf</a> .  ููุน ุฐูู ุ ููุฏ ุถุงุนุช ูุญุธุฉ ุญูู ุงูุทุฑููุฉ ุงูุชู ุชุชุจุนูุง ุงูุจูุงูุงุช ุจุนุฏ ุฃู ุชุฏุฎู ุงูุฌูุงุฒ ุงูุทุฑูู.  ูู ูุฐู ุงูููุงูุฉ ุ ุฃุฑูุฏ ุชุตุญูุญ ูุฐุง ุงูุนูุจ ูุชุญููู ูุณุงุฑ ุงูุจูุงูุงุช ูู ุงูุฌูุงุฒ.  ุณููุชุดู ุฃูุถูุง ููู ุชุฎุชูู ุงููุญุทุฉ ุงูุทุฑููุฉ ุนู ุดุฑูุฉ ุดู ุ ููุง ูู ุงูุฒุงููุฉ ุงููุฒููุฉ ุ ูููู ุชุนูู ุฃุฌูุฒุฉ ูุญุงูุงุฉ ุงูุฃุทุฑุงู ุงูุทุฑููุฉ ุ ูุฃูุซุฑ ูู ุฐูู ุจูุซูุฑ. </p><a name="habracut"></a><br><h2 id="osnovy" style=";text-align:right;direction:rtl">  ุงูุฃุณุงุณูุงุช </h2><br><p style=";text-align:right;direction:rtl">  ุฏุนููุง ุฃููุงู ูููู ูุงููุฉ ุงููุญุทุฉ ุงูุทุฑููุฉ ุ ู Shell ุ ู Console ุ ูููู ูุฎุชูู ุงููุญุงูู ุงูุทุฑูู ุนู ุงููุญุทุฉ ุงูุทุฑููุฉ ุงูุนุงุฏูุฉ ุ ูููุงุฐุง ุณููุช ุจูุฐุง ุงูุงุณู.  ููุฏ ุชู ุจุงููุนู ูุชุงุจุฉ ุงููุซูุฑ ูู ุงููุนูููุงุช ุญูู ูุฐุง ุงูุฃูุฑ ุ ูุฐูู ูู ุชุณูุน ุฃู ุดูุก ุฌุฏูุฏ ููุง.  ุชูุฑูุจุง ุฌููุน ุงููุนูููุงุช ููุง ูุฃุฎูุฐุฉ ูู ุงูุฅูุชุฑูุช ุ ูุณุฃูุฏู ุฑูุงุจุท ูู ููุงูุฉ ุงูููุงู.  ูู ูุนุฑู ุจุงููุนู ูุงุฐุง ุชุนูู ูู ูุฐู ุงูุฃุดูุงุก ุ ููููู ุชุฎุทู ูุฐุง ุงููุณู ุจุฃูุงู. </p><br><hr><br><h3 id="terminal" style=";text-align:right;direction:rtl">  ูุญุทุฉ </h3><br><p style=";text-align:right;direction:rtl">  <strong>ุงูุฌูุงุฒ ุงูุทุฑูู</strong> ุนุจุงุฑุฉ ุนู ูุฒูุฌ ูู ุดุงุดุฉ ูููุญุฉ ููุงุชูุญ ุ ุฃู ุฌูุงุฒ ูุนูู.  ูุจู ุฃู ุชุตุจุญ ุงูุฃุฌูุฒุฉ ุงูุทุฑููุฉ ูุฐู ุงููุฌููุนุฉ ุงูุฎุงุตุฉ ุ ูุงูุช ููุนูุง ูู ุงูุฃุฌูุฒุฉ ุชุณูู teleprinter (teletype ุ teletypewriter ุฃู TTY ููุชุฑุฉ ูุตูุฑุฉ) ุ ุฃู ูุฌููุนุฉ ูู ุงูุทุงุจุนุฉ ูููุญุฉ ุงูููุงุชูุญ.  ุนุงุฏุฉู ูุง ูุชู ุชูุตูู ูุญุทุงุช ูุชุนุฏุฏุฉ ุฅูู ููุณ ุงูููุจููุชุฑ.  ูุจุงูุชุงูู ุ ูุงู ูู ุงููููู ุงูุนูู ูุนุฏุฉ ูุณุชุฎุฏููู ุนูู ููุณ ุงูููุจููุชุฑ ุ ููุงู ููู ูููู ุฌูุณุฉ ุฎุงุตุฉ ุจู ุ ูุณุชููุฉ ุนู ุงูุขุฎุฑูู.  ุชูุช ุชุณููุฉ ุงููุญุทุฉ ุงูุทุฑููุฉ ูุฃููุง ูุงูุช ููุฌูุฏุฉ ูู ููุงูุฉ ูุจู ุงููุญุทุฉ ุงูุทุฑููุฉ. </p><br><p style=";text-align:right;direction:rtl">  ูุฐุง ูู <strong>Teletype</strong> : </p><br><img src="https://habrastorage.org/webt/m3/_3/yt/m3_3ytmmoofzwgpr3dpu78w8m7i.jpeg" alt="Teletype" title="ุงููุจุฑูุฉ ุงููุงุชุจุฉ" width="430" height="370"><br><br><p style=";text-align:right;direction:rtl">  ููุฐุง ูู <strong>ุงููุญุทุฉ</strong> : </p><br><img src="https://habrastorage.org/webt/pz/lj/eu/pzljeumccjvqmrunt-pqolnyx-c.jpeg" alt="Terminal" title="ูุญุทุฉ" width="430" height="370"><br><br><hr><br><h3 id="console" style=";text-align:right;direction:rtl">  ูุญุฏุฉ ุงูุชุญูู </h3><br><p style=";text-align:right;direction:rtl">  <strong>ูุญุฏุฉ ุงูุชุญูู (ูุญุฏุฉ ุงูุชุญูู)</strong> - ูุญุทุฉ ูุชุตูุฉ ูุจุงุดุฑุฉ ุจุงูููุจููุชุฑ.  ูุงูุญูููุฉ ูู ุฃู ูุนุธู ุงููุญุทุงุช ุงูุทุฑููุฉ ุชู ุชูุตูููุง ุถููููุง ุ ูููู ุชู ุชูุตูู ูุงุญุฏ ุนูู ุงูุฃูู ูุจุงุดุฑุฉ ุจุงูููุจููุชุฑ.  ุชู ุงูุณูุงุญ ููุญุฏุฉ ุงูุชุญูู ุจุงุณุชุฎุฏุงู ุฏุงุฆุฑุฉ ูุญุฏุฏุฉ ุจุฏูุฉ ูู ุงูุฃุดุฎุงุต ุ ูุฃููุง ุณูุญุช ูู ุจุชูููู ุงูููุจููุชุฑ. </p><br><hr><br><h3 id="shell" style=";text-align:right;direction:rtl">  ูุฐููุฉ </h3><br><p style=";text-align:right;direction:rtl">  ุฅุฐุง ูุงู ุงูุฌูุงุฒุงู ุงูุณุงุจูุงู ุนุจุงุฑุฉ ุนู ุฃุฌูุฒุฉ ูุนููุฉ ุ ูุฅู ูุฐุง ุงูุชุนุฑูู ูุดูุฑ ุญุตุฑููุง ุฅูู ุงูุจุฑูุงูุฌ. </p><br><p style=";text-align:right;direction:rtl">  <strong>ุดู</strong> ูู ูุชุฑุฌู ุณุทุฑ ุงูุฃูุงูุฑ.  ุงูุบุฑุถ ุงูุฑุฆูุณู ูู ุชุดุบูู ุจุฑุงูุฌ ุฃุฎุฑู.  ููุงู ุนุฏุฏ ูุจูุฑ ูู ุงูุฃุตุฏุงู ุงููุฎุชููุฉ.  ุงูุฃูุซุฑ ุดููุนูุง ูู Bash (ูู English Bourne Again Shell ุ ูุงูุชู ุ ููุง ุชูุชุฑุญ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููููุจูุฏูุง</a> ุ ูู ูุนุจุฉ ุชูููุฉ ูุดุฑูุฉ ุดู "Born again" ุ ุฃู ุดุฑูุฉ ุดู "ุงูุชู ุชู ุฅุญูุงุคูุง").  ุฃูุซูุฉ ุฃุฎุฑู: ุงูุฏูุงุนุฉ (ูุฐููุฉ ุฎูููุฉ ุงููุฒู ุ ูุชููุฑุฉ ุฅุฐุง ููุช ุจุชุดุบูู ุซูุงุฆู ูู / bin / sh) ุ Zsh. </p><br><hr><br><p style=";text-align:right;direction:rtl">  ุจุงูุทุจุน ุ ูู ุชุณุชุทุน ูู ูู ุงููุญุทุงุช ุงูุทุฑููุฉ ููุญุฏุงุช ุงูุชุญูู ุงูุนุซูุฑ ุนูู ุงูุนูุงุณุงุชูุง ูู ุงูุนุตุฑ ุงูุญุฏูุซ.  ูุฐูู ุ ุณูู ูุฃุฎุฐ ูู ุงูุงุนุชุจุงุฑ ุฃุดูุงุก ูุซู <em>Emulator ุงูุทุฑููุฉ</em> ู <em>Virtual Console</em> . </p><br><h3 id="terminal-emulator" style=";text-align:right;direction:rtl">  ุงููุญุงูู ุงูุทุฑูู </h3><br><p style=";text-align:right;direction:rtl">  <strong>ุงููุญุงูู ุงูุทุฑููุฉ</strong> - ูุญุงูู ูููุญุทุฉ ุงููุฏููุฉ ุงูุฌูุฏุฉ.  ูุทููุจ ุงููุญุงูู ุงูุทุฑูู ููุจุฑุงูุฌ ุงูุชู ูุง ูููู ุฃู ุชุชูุงุนู ูุจุงุดุฑุฉ ูุน ูุธุงู X Window - Bash ู Vim ูุบูุฑูุง. </p><br><p style=";text-align:right;direction:rtl">  ุฏุนููุง ุฃููุง ุชุญุฏูุฏ ูุณุคูููุงุช ุงููุญุทุฉ: </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ููู ุฅุฏุฎุงู ุงููุณุชุฎุฏู ุฅูู ุฌูุงุฒ ููุจููุชุฑ </li><li style=";text-align:right;direction:rtl">  ุชุณููู ุฅุฎุฑุงุฌ ุงูููุจููุชุฑ ุฅูู ุงูุดุงุดุฉ </li></ol><br><p style=";text-align:right;direction:rtl">  ูุฐุง ูุฅู ุฌูุงุฒ ุงููุญุงูุงุฉ ุงูุทุฑููุฉ ุงูุฎุงุต ุจูุง ูููู ุจููุณ ุงูุดูุก ุชูุงููุง: ููู ููุฏู ูุฏุฎูุงุช ุงููุณุชุฎุฏู ุฅูู ุงูุจุฑูุงูุฌ ููุฏ ุงูุชุดุบูู ุ ููุง ูุนุฑุถ ุฅุฎุฑุงุฌ ุงูุจุฑูุงูุฌ ุนูู ุงูุดุงุดุฉ.  ูู ุฃู ุญุงู ุ ูุจูู ุงููุนูู - ุจูู ุงููุณุชุฎุฏู ูุงูุจุฑูุงูุฌ ููุฏ ุงูุชุดุบูู ุ ููุงู ููุน ูู ุงูุทุจูุฉ ุงููุณุคููุฉ ุนู ุงูุฅุฏุฎุงู / ุงูุฅุฎุฑุงุฌ.  ุฃูุซูุฉ ุนูู ุงููุญุงูู ุงูุทุฑูู: gnome-terminal ุ xterm ุ konsole. </p><br><p style=";text-align:right;direction:rtl">  <strong>ูู ูุถูู ูุง ุชุฎูุท ุจูู ุดู ููุญุทุฉ ุงูุทุฑููุฉ!</strong> <br>  ุงููุญุงูู ุงูุทุฑูู ูู ุชุทุจูู ูุงุฌูุฉ ุงููุณุชุฎุฏู ุงูุฑุณูููุฉ ุ ุฃู ูุงูุฐุฉ ูู ูุธุงู X Window System.  Shell ุนุจุงุฑุฉ ุนู ูุชุฑุฌู ูุณุทุฑ ุงูุฃูุงูุฑ ุ ุฃู ูุฌุฑุฏ ููููุฐ ุฃูุงูุฑ ุ ูููุณ ูู ุบูุงู ุฑุณููู.  ุนูุฏ ุงูุชุญุฏุซ ุจุดูู ุตุญูุญ ุ <strong>ูุง</strong> ุชููู <strong>ุจุชุดุบูู Bash</strong> ุ ุจู ุชููู <strong>ุจุชุดุบูู Terminal Emulator ุ ุงูุฐู ูููู ุจุชุดุบูู Bash ุฏุงุฎู ููุณู</strong> .  ุงููุญุงูู ุงูุทุฑูู ูุจุงุด ููุง ุจุฑูุงูุฌุงู ูุฎุชููุงู ุชูุงููุง.  ุงูุฃูู ูู ุงููุณุคูู ุงููุญูุฏ ุนู ุงูุฅุฏุฎุงู / ุงูุฅุฎุฑุงุฌ ุ ูุงูุซุงูู - ุนู ุฃูุงูุฑ ุงููุนุงูุฌุฉ. </p><br><p style=";text-align:right;direction:rtl">  ุนูุงูุฉ ุนูู ุฐูู ุ ุณุชุดูุฑ ุฌููุน ุงูุฅุดุงุฑุงุช ุฅูู ุงูุฌูุงุฒ ุฅูู ุงููุญุงูู ุงูุทุฑูู. </p><br><hr><br><h3 id="virtual-console-virtual-terminal" style=";text-align:right;direction:rtl">  ูุญุฏุฉ ุงูุชุญูู ุงูุงูุชุฑุงุถูุฉ (ุงููุญุทุฉ ุงูุงูุชุฑุงุถูุฉ) </h3><br><p style=";text-align:right;direction:rtl">  ุงุถุบุท ุนูู Ctrl + Alt + FN ุ ุญูุซ ุชุญุชูู N ุนุงุฏุฉ ุนูู ููู ูู 1 ุฅูู 6. ูุง ุฑุฃูุชู ููุชู ูุณูู Virtual Console (ูุญุฏุฉ ุงูุชุฑุงุถูุฉ) ุฃู Virtual Terminal (Virtual terminal).  ุชุฐูุฑ ูุง ููุชู ุณุงุจููุง ุนู ุงููุญุทุงุชุ  ุชู ุชูุตูู ุงูุนุฏูุฏ ูู ุงููุญุทุงุช ุงูุทุฑููุฉ ุจุฌูุงุฒ ููุจููุชุฑ ูุงุญุฏ ููุงู ูู ูุญุทุฉ ุฌูุณุฉ ูููุตูุฉ ุ ูุณุชููุฉ ุนู ุงูุขุฎุฑูู.  ุชูุฑุฑ Virtual Console ูุฐู ุงูููุฑุฉ: ูุฏ ุชููู ููุงู ุนุฏุฉ ุฌูุณุงุช ูุณุชููุฉ ุฏุงุฎู ุฌูุงุฒ ุงูููุจููุชุฑ ุงูุฎุงุต ุจู (ููุน ุฐูู ุ ููู ุงููุงุถุญ ุฃู ููุงุฑุฏ ุงูููุจููุชุฑ ูุง ุชุฒุงู ูุดุชุฑูุฉ). </p><br><p style=";text-align:right;direction:rtl">  ููููู ุชุณููุฉ ูุฐุง ุงูููุงู ููุงู ูู Virtual Console ู Virtual Terminal ุ ูุฃูู ุจุญูู ุงูุชุนุฑูู ุ ูุฅู ูุญุฏุฉ ุงูุชุญูู ูู ูุญุทุฉ ูุชุตูุฉ ูุจุงุดุฑุฉ ุจุฌูุงุฒ ููุจููุชุฑ ุ ูููู ุฌููุน ุงููุญุทุงุช ุงูุงูุชุฑุงุถูุฉ ูุชุตูุฉ ุ ุจุดูู ูุง ุ ูุจุงุดุฑุฉ ุจุฌูุงุฒ ุงูููุจููุชุฑ. </p><br><hr><br><h3 id="tty-ustroystva" style=";text-align:right;direction:rtl">  ุฃุฌูุฒุฉ TTY </h3><br><p style=";text-align:right;direction:rtl">  ูุชู ุชุนููู ูู ูุญุทุฉ <em>ุฌูุงุฒ TTY</em> ุงูุฎุงุต ุจู (ุงูุฌูุงุฒ ุงูุทุฑูู) ุ ูุงูุฐู ูููุฑ ูุญุฏุฉ ุงูุชุญูู.  ุนูู ุงูุฑุบู ูู ุฃู teletypes ูู ุบูุฑ ุงููุฑุฌุญ ุฃู ุชุฌุฏู ุ ุฅูุง ุฃู ุงูุงูุฎูุงุถ ูู TTY ูุฏ ุจูู ุญุชู ููููุง ูุฐุง. </p><br><p style=";text-align:right;direction:rtl">  ูุชููู ุฌูุงุฒ TTY ูู ุนูุตุฑูู ุฃุณุงุณููู: </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <strong>ุจุฑูุงูุฌ ุชุดุบูู ุงูุฌูุงุฒ</strong>  ููู ูุณุคูู ุนู ุชูุฏูู ูุฏุฎูุงุช ููุญุฉ ุงูููุงุชูุญ ููุจุฑูุงูุฌ ูุนุฑุถ ุฅุฎุฑุงุฌ ุงูุจุฑูุงูุฌ ุนูู ุงูุดุงุดุฉ. </li><li style=";text-align:right;direction:rtl">  <strong>ุงูุงูุถุจุงุท ุงูุฎุท TTY</strong> ( <strong>ุงูุงูุถุจุงุท</strong> ุงูุฑูุณู ุงูุฎุท).  ุงูุฎุท ุงูุงูุถุจุงุท ูู ูุงุฌูุฉ ูุตูู ุงูุณุงุฆู ุ ูุงูุชู ุ ูุน ุฐูู ุ ุชุฌูุจ ุงููุซูุฑ ูู ุงูููุทู ูุฌูุงุฒ TTY.  ูููููุง ุฃู ูููู ุฃู ูููุงุก ุงูุฎุท ุงูุงูุถุจุงุท ูุฏุนู ููุณุงุฆู.  ูุง ูู ูุฌุงู ูุณุคูููุฉ ูุฐุง ุงููููู ุ ูุณูู ููุชุดู ุฐูู ุฎูุงู ุงูููุงู. </li></ol><br><p style=";text-align:right;direction:rtl">  ุจูุงุก ุฌูุงุฒ TTY: </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/zn/zw/dy/znzwdyjadyeidyogqoap8kfvgng.jpeg" title="ุจูุงุก ุฌูุงุฒ TTY"></p><br><p style=";text-align:right;direction:rtl">  ููุงู 3 ุฃููุงุน ูู ุฃุฌูุฒุฉ TTY: </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <em>ุฌูุงุฒ ุงูุชุญูู</em> - ูููุฑ ุชุดุบูู ูุญุฏุฉ ุงูุชุญูู ุงูุงูุชุฑุงุถูุฉ.  ูุชู ุงูุชุญูู ูู ุฅุฏุฎุงู ูุฅุฎุฑุงุฌ ูุฐุง ุงูุฌูุงุฒ ุจุงููุงูู ุจูุงุณุทุฉ ุงูููุงุฉ. </li><li style=";text-align:right;direction:rtl">  <em>ุฌูุงุฒ PTY</em> (ุงูุทุฑู ุงูุฒุงุฆู) - ุชูููุฑ ุงูุชุดุบูู ุงูุทุฑูู ูู ูุงุฌูุฉ ุงููุงูุฐุฉ.  ูุชู ุงูุชุญูู ูู ูุฏุฎูุงุช ููุฎุฑุฌุงุช ูุฐุง ุงูุฌูุงุฒ ุจูุงุณุทุฉ ูุญุงูู ุทุฑููุฉ ูุนูู ูู ูุณุงุญุฉ ุงููุณุชุฎุฏู. </li><li style=";text-align:right;direction:rtl">  <em>ุฌูุงุฒ ุชุณูุณูู</em> - ูุชุตู ูุจุงุดุฑุฉ ูุน ุงูุฃุฌูุฒุฉ.  ูุง ูุณุชุฎุฏู ุนุงุฏุฉู ุจุดูู ูุจุงุดุฑ ุ ููููู ููุฌูุฏ ูุฃุฏูู ูุณุชูู ูู ุชูุธูู ุจููุฉ ุงูุฌูุงุฒ ุงูุทุฑูู. </li></ol><br><p style=";text-align:right;direction:rtl">  ูู ูุฐู ุงูููุงูุฉ ุ ุณูุชุญุฏุซ ุนูู ูุฌู ุงูุชุญุฏูุฏ ุนู ุงูููุน ุงูุซุงูู ูู ุฃุฌูุฒุฉ TTY - ุงููุญุทุงุช ุงูุฒุงุฆูุฉ. </p><br><hr><br><h2 id="tty-line-discipline" style=";text-align:right;direction:rtl">  TTY ุฎุท ุงูุงูุถุจุงุท </h2><br><p style=";text-align:right;direction:rtl">  ูุจุฏุฃ ูู ูุญุต ุงูุงูุถุจุงุท ูุฎุท ุงูุฌูุงุฒ TTY. </p><br><p style=";text-align:right;direction:rtl">  ุงูููุฒุฉ ุงูุฃููู ุงููููุฉ ูุฎุท ุงูุงูุถุจุงุท ูู ุฃููุง ูุณุคููุฉ ุนู ูุนุงูุฌุฉ I / O.  ูุชุถูู ุฐูู ุ ุนูู ุณุจูู ุงููุซุงู ุ ูุนุงูุฌุฉ ุฃุญุฑู ุงูุชุญูู (ุงูุธุฑ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" title="ุฃุญุฑู ุงูุชุญูู">ุฃุญุฑู ุงูุชุญูู</a> ) ูุชูุณูู ุงูุฅุฎุฑุงุฌ.  ุนูู ุณุจูู ุงููุซุงู ุ ุชููู ุจุฅุฏุฎุงู ุฃู ูุต ุ ูููู ุชุฏุฑู ูุฌุฃุฉ ุฃูู ููุช ูุฎุทุฆูุง ูู ูุชุงุจุฉ ุดูุก ูุง ูุชุฑูุฏ ูุณุญู - ูุฐุง ูู ุงูููุงู ุงูุฐู ููุนุจ ููู ุงูุงูุถุจุงุท ุงููุจุงุดุฑ. </p><br><p style=";text-align:right;direction:rtl">  ุณูุญูู ุจุงูุชูุตูู ูุง ูุญุฏุซ ุจุงูุถุจุท ุนูุฏูุง ูุนูู ูู Bash ูุนูู ูู ุงููุญุทุฉ ุงูุทุฑููุฉ.  ุจุดูู ุงูุชุฑุงุถู ุ ูุนูู ุฌูุงุฒ TTY ูู ุงููุถุน ุงูุฃุณุงุณู ูุน <em>ุชูููู ุงูุตุฏู</em> .  ุงูุตุฏู ูู ุนุฑุถ ููุฃุญุฑู ุงูุชู ุฃุฏุฎูุชูุง ุนูู ุงูุดุงุดุฉ. </p><br><p style=";text-align:right;direction:rtl"> ุนูุฏูุง ูุฏุฎู ุ ุนูู ุณุจูู ุงููุซุงู ุ ูุชู ุฅุฑุณุงู ุงูุญุฑู <code>a</code> ุ ูุชู ุฅุฑุณุงู ูุฐุง ุงูุญุฑู ุฅูู ุฌูุงุฒ TTY ุ ูููู ูุชู ุงุนุชุฑุงุถู ูู ุฎูุงู ูุธุงู ุณุทุฑ TTY ุงูุฎุงุต ุจุงูุฌูุงุฒ.  ุฅููุง ุชูุฑุฃ ุญุฑููุง ูู ุงููุฎุฒู ุงููุคูุช ุงูุฏุงุฎูู ููุง ุ ูุชุฑู ุฃู ูุถุน <code>echo</code> ูุถุน ุงูุชุดุบูู ุ ูุชุนุฑุถ ุงูุดุฎุตูุฉ ุนูู ุงูุดุงุดุฉ.  ูู ูุฐุง ุงูููุช ุ ูุง ููุฌุฏ ุดูุก ูุชุงุญ ูููุฑุงุกุฉ ูู ุงูุจุฑูุงูุฌ ุงููุชุตู ุจู ุงูุฌูุงุฒ ุงูุทุฑูู.  ุฏุนูุง ูุถุบุท <code>backspace</code> ุนูู ููุญุฉ ุงูููุงุชูุญ.  ุงูุฑูุฒ <code>^?</code>  ูุฑุฉ ุฃุฎุฑู ุชู ุงุนุชุฑุงุถูุง ุจูุงุณุทุฉ ุงูุงูุถุจุงุท ุงูุฎุทู ุ ูุงูุฃุฎูุฑ ุ ูุฏุฑู ุฃู ุงููุณุชุฎุฏู ูุฑูุฏ ูุญู ุขุฎุฑ ุญุฑู ุชู ุฅุฏุฎุงูู ุ ููุฒูู ูุฐู ุงูุดุฎุตูุฉ ูู ุงููุฎุฒู ุงููุคูุช ุงูุฏุงุฎูู ูู ูููุญู ูุฐู ุงูุดุฎุตูุฉ ุฃูุถูุง ูู ุงูุดุงุดุฉ.  ุงูุขู ุ ุฅุฐุง ุถุบุทูุง ุนูู Enter ุ ูููู ุฎุท TTY Line Discipline ุฃุฎูุฑูุง ุจุฅุฑุณุงู ูู ูุง ุชูุช ูุชุงุจุชู ูุณุจููุง ุฅูู ุงููุฎุฒู ุงููุคูุช ูููุฑุงุกุฉ ูู ุงูุฌูุงุฒ ุงูุทุฑูู ุ ุจูุง ูู ุฐูู LF.  ูู ุงูููุช ููุณู ุ ูุชู ุนุฑุถ ุงูุฃุญุฑู CR ู LF ุนูู ุงูุดุงุดุฉ ูู ุฃุฌู ุชุญุฑูู ุงููุคุดุฑ ุฅูู ุณุทุฑ ุฌุฏูุฏ - ูุฐุง ูู ุชูุณูู ุงูุฅุฎุฑุงุฌ. </p><br><p style=";text-align:right;direction:rtl">  ูุฐู ูู ุงูุทุฑููุฉ ุงูุชู ูุนูู ุจูุง ุงููุถุน ุงููุชุนุงุฑู ุนููู - ุญูุซ ูููู ุจููู ุฌููุน ุงูุฃุญุฑู ุงูุชู ุชู ุฅุฏุฎุงููุง ุฅูู ุงูุฌูุงุฒ ููุท ุจุนุฏ ุงูุถุบุท ุนูู <code>Enter</code> ุ ููุนุงูุฌุฉ ุฃุญุฑู ุงูุชุญูู ูุชูุณูู ุงูุฅุฎุฑุงุฌ. </p><br><h3 id="tty-line-editing" style=";text-align:right;direction:rtl">  ุชุญุฑูุฑ ุฎุท TTY </h3><br><p style=";text-align:right;direction:rtl">  <strong>ุชุญุฑูุฑ ุฎุท TTY</strong> ูู ุงููููู ุงููุณุคูู ุนู ูุนุงูุฌุฉ ุงููุฏุฎูุงุช ูู ูุฌุงู ุงูุงูุถุจุงุท.  ูุฌุจ ุงูููู ุฃู <em>ุชุญุฑูุฑ ุงูุฎุท</em> ููููู ุนุงู ููุชุนูู ุจูุนุงูุฌุฉ ุงููุฏุฎูุงุช.  ุนูู ุณุจูู ุงููุซุงู ุ ูุฏู Bash ู Vim ุชุญุฑูุฑ ุฎุท ุฎุงุต ุจููุง. </p><br><p style=";text-align:right;direction:rtl">  ูููููุง ุงูุชุญูู ูู ุฅุนุฏุงุฏุงุช ุงูุงูุถุจุงุท ูู ุฎุท ุฌูุงุฒ TTY ุงูุญุงูู ุจุงุณุชุฎุฏุงู ุงูุจุฑูุงูุฌ <strong>stty</strong> .  ุฏุนูุง ูุฌุฑุจ ููููุง. </p><br><p style=";text-align:right;direction:rtl">  ุงูุชุญ Bash ุฃู ุฃู ูุฐููุฉ ุฃุฎุฑู ูุงูุชุจ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">stty icanon -echo</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุญุงูู ุงูุขู ูุชุงุจุฉ ุดูุก ูุง ููู ุชุฑู ูุฏุฎูุงุชู (ูุง ุชููู ุ ูุง ูุฒุงู ุจุฅููุงูู ุชูุฑูุฑ ุงููุฏุฎูุงุช ุฅูู ุงูุจุฑูุงูุฌ).  ููุฏ ููุช ููุท ุจุชุนุทูู ุงูุตุฏู - ุฃู ุนุฑุถ ุงูุฃุญุฑู ุงูุชู ุชู ุฅุฏุฎุงููุง ุนูู ุงูุดุงุดุฉ.  ุฃุฏุฎู ุงูุขู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">stty raw echo</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุญุงูู ูุชุงุจุฉ ุดูุก ูุง.  ุชุฑู ููู ูุชู ูุณุฑ ุงูุงุณุชูุชุงุฌ.  ูููู ููุฒูุฏ ูู ุงูุชุฃุซูุฑ ุ ุฏุนูุง ูุฐูุจ ุฅูู Dash - type <code>/bin/sh</code> .  ุญุงูู ุงูุขู ุฅุฏุฎุงู ุฃุญุฑู ุฎุงุตุฉ ( <code>Ctrl</code> + ุฃู ุญุฑู ุนูู ููุญุฉ ุงูููุงุชูุญ) ุฃู ููุท ุงุถุบุท ุนูู <code>Enter</code> .  ุฃูุช ูู ุญูุฑุฉ - ูุง ูู ูุฐู ุงูุดุฎุตูุงุช ุงูุบุฑูุจุฉ ุงูุชู ุชุธูุฑ ุนูู ุงูุดุงุดุฉุ  ูุงูุญูููุฉ ูู ุฃูู ุ ุจุนุฏ ุฏุฎูููุง ุฅูู ุฃุจุณุท Shell ุ ุจุงูุฅุถุงูุฉ ุฅูู Line Editing ูู ุงูุงูุถุจุงุท ููุณู ุ ูููุง ุฃูุถูุง ุจุชุนุทูู Line Editing Bash ุ ูุงูุขู ูููููุง ุฃู ููุงุญุธ ูุน ุงูููุฉ ูุฃูู ุชุฃุซูุฑ ุฅุฏุฑุงุฌ ุงูููุท <em>ุงูุฎุงู</em> ููุงูุถุจุงุท ููุฎุท.  ูุฐุง ุงููุถุน ูุง ูุนุงูุฌ ุงููุฏุฎูุงุช ุนูู ุงูุฅุทูุงู ููุง ููุณู ุงูุฅุฎุฑุงุฌ.  ููุงุฐุง ููุงู ุญุงุฌุฉ ููุถุน ุงูุฎุงูุ  ุนูู ุณุจูู ุงููุซุงู ุ ุจุงููุณุจุฉ ูู <em>Vim</em> : ูุชู ูุชุญู ูู ุฅุทุงุฑ ุงููุญุทุฉ ุงูุทุฑููุฉ ุจุงููุงูู ููููู ุจูุนุงูุฌุฉ ุงูุฅุฏุฎุงู ููุณู ุ ุนูู ุงูุฃูู ุจุญูุซ ูุง ุชุชูุงุทุน ุงูุฑููุฒ ุงูุฎุงุตุฉ ูุงูุถุจุงุท ุงูุฎุท ูุน ุงูุฑููุฒ ุงูุฎุงุตุฉ ูู Vim ููุณูุง. </p><br><p style=";text-align:right;direction:rtl">  ููุฒูุฏ ูู ุงูููู ุ ุฏุนููุง ูููู ูุธุฑุฉ ุนูู ุชุฎุตูุต ุฃุญุฑู ุงูุชุญูู.  <code>stty &lt;control-character&gt; &lt;string&gt;</code> ุงูุฃูุฑ. <br>  ุฃุฏุฎู ูู ุจุงุด: </p><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">stty erase 0</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงูุขู ุณูุชู ุชุนููู ุญุฑู ุงูุชุญูู ูู <code>erase</code> ุฅูู ุงูุญุฑู <code>0</code> .  ุฒุฑ <code>backspace</code> ุนุงุฏุฉ ูุง ููู <code>^?</code>  ูููู ุงูุขู ุณูุชู ุฅุฑุณุงู ูุฐู ุงูุดุฎุตูุฉ ุงูุฎุงุตุฉ ุฅูู PTS ูุฑุงุกุฉ ุงููุฎุฒู ุงููุคูุช ุญุฑูููุง - ุฌุฑุจู ุจููุณู.  ููููู ุงูุขู ูุญู ุงูุฃุญุฑู ุจุงุณุชุฎุฏุงู ุฒุฑ <code>0</code> ุนูู ููุญุฉ ุงูููุงุชูุญ ุ ูุฃูู ุทูุจุช ูู ุงูุงูุถุจุงุท tty line ุฃู ุชุชุนุฑู ุนูู ุงูุญุฑู ุงูุฐู ุชู ุฅุฏุฎุงูู ูุญุฑู ุชุญูู ูู <code>erase</code> .  ููููู ุฅุฑุฌุงุน ุงูุฅุนุฏุงุฏ ุจุงุณุชุฎุฏุงู ุงูุฃูุฑ <code>stty erase ^\?</code>  ุฃู ูุฌุฑุฏ ุฅุบูุงู ุงููุญุทุฉ ุ ูุฃููุง ุฃุซุฑูุง ููุท ุนูู ุงูุฌูุงุฒ tty ุงูุญุงูู. </p><br><p style=";text-align:right;direction:rtl">  ููููู ุงูุนุซูุฑ ุนูู ูุฒูุฏ ูู ุงููุนูููุงุช ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" title="ุฑุฌู stty">ุงูุฑุฌู stty</a> . </p><br><hr><br><h2 id="terminal-emulator-i-pseudoterminal" style=";text-align:right;direction:rtl">  ุงููุญุงูู ุงูุทุฑูู ู Pseudoterminal </h2><br><p style=";text-align:right;direction:rtl">  ูู ูู ูุฑุฉ ููุชุญ ูููุง ูุญุทุฉ ุทุฑููุฉ ุฌุฏูุฏุฉ ูู ูุธุงู X Window ุ ููุฑุฒ GNOME Terminal Server ุนูููุฉ ุฌุฏูุฏุฉ ููุทูู ุงูุจุฑูุงูุฌ ุงูุงูุชุฑุงุถู ูููุง.  ุนุงุฏุฉ ุ ูุฐุง ููุน ูู ุฃููุงุน Shell (ุนูู ุณุจูู ุงููุซุงู ุ Bash). </p><br><p style=";text-align:right;direction:rtl">  ูุญุฏุซ ุงูุชูุงุตู ูุน ุจุฑูุงูุฌ ุงูุชุดุบูู ูู ุฎูุงู ูุง ูุณูู <strong>Pseudoterminal</strong> ( <strong>pseudoterminal</strong> ( <strong>pseudoterminal</strong> ุ PTY).  ุชูุฌุฏ ุงููุญุทุฉ ุงูุฒุงุฆูุฉ ููุณูุง ูู ุงูููุงุฉ ุ ููุน ุฐูู ุ ูุฅููุง ุชุชููู ูุฏุฎูุงุช ูู ูุณุงุญุฉ ุงููุณุชุฎุฏู - ูู ูุญุงูู ุงูุฌูุงุฒ ุงูุทุฑูู. </p><br><p style=";text-align:right;direction:rtl">  ุชุชููู ุงููุญุทุฉ ุงูุฒุงุฆูุฉ ูู ุงูุฌูุงุฒูู <em>ุงูุธุงูุฑููู</em> ุงูุชุงูููู: <br>  1) <strong>PTY ุงูุฑุฆูุณู (PTM)</strong> - ุงูุฌุฒุก ุงูุฑุฆูุณู ูู ูุญุทุฉ ุงูุฒุงุฆูุฉ.  ูุณุชุฎุฏูู GNOME Terminal Server ูููู ุฅุฏุฎุงู ููุญุฉ ุงูููุงุชูุญ ุฅูู ุจุฑูุงูุฌ ูุชู ุชุดุบููู ุฏุงุฎู ุงูุฌูุงุฒ ุ ููุฐูู ูุฑุงุกุฉ ุฅุฎุฑุงุฌ ุงูุจุฑูุงูุฌ ูุนุฑุถ ุงูุฅุฎุฑุงุฌ.  ูุชุตู ุฎุงุฏู ุฌููู ุงูุทุฑูู ุจุฏูุฑู ุจูุธุงู X Window System ุนุจุฑ ุจุฑูุชูููู X. <br>  2) <strong>PTY ุงูุนุจุฏ (PTS)</strong> - ุฌุฒุก ุงูุนุจุฏ ูู ูุญุทุฉ ุงูุฒุงุฆูุฉ.  ูุณุชุฎุฏูู ุจุฑูุงูุฌ ูุนูู ุฏุงุฎู ุงูุฌูุงุฒ ููุฑุงุกุฉ ูุฏุฎูุงุช ููุญุฉ ุงูููุงุชูุญ ูุฅุฎุฑุงุฌ ุงูุดุงุดุฉ ุนูู ุงูุดุงุดุฉ.  ุนูู ุงูุฃูู ุ ุงูุจุฑูุงูุฌ ููุณู ูุนุชูุฏ ุฐูู (ุณุฃุดุฑุญ ูุง ูุนููู ูุฐุง ุ ุฃุจุนุฏ ูู ุฐูู ุจูููู). </p><br><p style=";text-align:right;direction:rtl">  ุฃู ุจูุงูุงุช ูุณุฌูุฉ ูู ุฌูุงุฒ PTS ูู ูุฏุฎูุงุช ุฌูุงุฒ PTM ุ ุฃู ุ ุชุตุจุญ ูุงุจูุฉ ูููุฑุงุกุฉ ุนูู ุฌูุงุฒ PTM.  ูุงูุนูุณ ุตุญูุญ: ุฃู ุจูุงูุงุช ูุณุฌูุฉ ูู ุฌูุงุฒ PTM ูู ูุฏุฎูุงุช ุฌูุงุฒ PTS.  ูุฐู ูู ุงูุทุฑููุฉ ุงูุชู ูุชูุงุตู ุจูุง GNOME Terminal Server ูุงูุจุฑูุงูุฌ ุงูุฐู ูุนูู ุฏุงุฎู ุงูุฌูุงุฒ.  ูุฑุชุจุท ูู ุฌูุงุฒ PTM ุจุฌูุงุฒ PTS ุงูุฎุงุต ุจู. </p><br><p style=";text-align:right;direction:rtl">  ุชุจุฏู ุนูููุฉ ุฅุทูุงู ูุญุทุฉ ุฌุฏูุฏุฉ ูุซู ูุฐุง: <br>  1) ููุดุฆ GNOME Terminal Server ุฃุฌูุฒุฉ ุฑุฆูุณูุฉ <strong>ูุนุจูุฏูุฉ</strong> ุนู ุทุฑูู ุงุณุชุฏุนุงุก ูุธููุฉ open () ุนูู ุฌูุงุฒ ุฎุงุต <strong>/ dev / ptmx</strong> .  ุฅุฑุฌุงุน ุงูููุงููุฉ open () ูุงุตู ุงูููู ูุฌูุงุฒ PTM ุงูุฐู ุชู ุฅูุดุงุคู - <em>master_fd</em> . <br>  2) ููุดุฆ GNOME Terminal Server ุนูููุฉ ุฌุฏูุฏุฉ ุนู ุทุฑูู ุงุณุชุฏุนุงุก <code>fork()</code> .  ูุฐู ุงูุนูููุฉ ุณุชููู ุงููุญุทุฉ ุงูุฌุฏูุฏุฉ. <br>  3) ูู ูุญุทุฉ PTS ุ ููุชุญ ุงูุฌูุงุฒ ุนูู ูุงุตูุงุช ุงููููุงุช 0 ุ 1 ุ 2 (stdin ุ stdout ู stderr ุ ุนูู ุงูุชูุงูู).  ุงูุขู ุ ูุชุฏูู ุงูุฅุฏุฎุงู / ุงูุฅุฎุฑุงุฌ ุงูุทุฑูู ุงูููุงุณู ุฅูู ูุฐุง ุงูุฌูุงุฒ. <br>  4) ูุชู ุฅุทูุงู ุงูุจุฑูุงูุฌ ุงููุทููุจ ูู ุงููุญุทุฉ ุงูุทุฑููุฉ ุนู ุทุฑูู ุงุณุชุฏุนุงุก ูุธููุฉ <code>exec()</code> .  ุชุจุฏุฃ ุจุนุถ ุฃุนูุงู ุดู ุนุงุฏุฉู (ุนูู ุณุจูู ุงููุซุงู ุ ุจุงุด).  ุฃู ุจุฑูุงูุฌ ูุชู ุชุดุบููู ูุงุญููุง ูู Bash ุณูููู ูู ููุณ ูุงุตูุงุช ุงูููู ูุซู Bash ุ ุฃู ุณูุชู ุชูุฌูู ุชุฏููุงุช ุงูุจุฑูุงูุฌ ุฅูู ุฌูุงุฒ PTS. </p><br><p style=";text-align:right;direction:rtl">  ููููู ุฃู ุชุฑู ุจููุณู ุฃูู ูุชู ุชูุฌูู ุชุฏููุงุช ุฎุฑุฌ ุงููุญุทุฉ ุงูุทุฑููุฉ ุงูููุงุณูุฉ ุจุงุณุชุฎุฏุงู ุงูุฃูุฑ <code>ls -la /proc/self/fd</code> : <br><img src="https://habrastorage.org/webt/nr/dx/97/nrdx97wllflvapnt76p3qqki3fw.jpeg"></p><br><p style=";text-align:right;direction:rtl">  ููุน ุฌูุงุฒ PTS ุนูู ุงููุณุงุฑ <strong>/ dev / pts / N</strong> ุ ูุงููุณุงุฑ ุฅูู ุฌูุงุฒ PTM ูุง ููููุง ุนูู ุงูุฅุทูุงู.  ุงูุญูููุฉ ูู ุฃู GNOME Terminal Server ูุญุชูู ุจุงููุนู ุนูู ูุงุตู ููู ูุฌูุงุฒ PTM ุงูููุชูุญ ููุง ูุญุชุงุฌ ุฅูู ูุณุงุฑ ุฅููู ุ ููุน ุฐูู ุ ูู ุงูุนูููุฉ ุงููุฑุนูุฉ ุ ูุฌุจ ุฃู ููุชุญ ุฌูุงุฒ PTS ุนูู ุชุฏููุงุช ุงูุฅุฎุฑุงุฌ ุงูููุงุณูุฉ ุนู ุทุฑูู ุงุณุชุฏุนุงุก ูุธููุฉ <code>open()</code> ุ ูุงูุชู ุชุชุทูุจ ูุณุงุฑ ุงูููู. </p><br><p style=";text-align:right;direction:rtl">  ุชุฐูุฑ ุ ููุช ุฃู ุงูุจุฑูุงูุฌ ุงูุฐู ูุณุชุฎุฏู ุฌูุงุฒ PTS ูุนุชูุฏ ููุท ุฃูู ูุชุตู ูุจุงุดุฑุฉ ูุน ุงูุฌูุงุฒุ  ุงูุญูููุฉ ูู ุฃู PTS ูู ุฃูุถูุง <em>ุฌูุงุฒ ุทุฑูู</em> ( <em>ุฌูุงุฒ</em> TTY) ุ ูููู ุงููุฑู ุจูู ุฌูุงุฒ PTS ูุฌูุงุฒ TTY ุงููุนูู ูู ุฃู ุฌูุงุฒ PTS ูุชููู ุงูุฅุฏุฎุงู ููุณ ูู ููุญุฉ ุงูููุงุชูุญ ุ ูููู ูู ุงูุฌูุงุฒ ุงูุฑุฆูุณู ุ ูุงูุฅุฎุฑุงุฌ ูุง ููุชูู ุฅูู ุงูุดุงุดุฉ ุ ูููู ุณูุฏ ุงูุฌูุงุฒ.  ูุฐุง ูู ุงูุณุจุจ ูู ุฃู ูุญุทุฉ ุงูุฒุงุฆูุฉ ุณููุช ุจูุฐุง ุงูุดูู - ุงููุญุทุฉ ุงูุฒุงุฆูุฉ ุชุดุจู ููุท (ูุฑุฉ ุฃุฎุฑูุ) ุงููุญุทุฉ.  ุงููุฑู ุจูู ุงููุญุงูู ุงูุทุฑูู ูุงููุญุทุฉ ุงูุฒุงุฆูุฉ ูู ุฃู ุงููุญุงูู ุงูุทุฑูู ูู ูุฌุฑุฏ ุจุฑูุงูุฌ ุฑุณููู ูุชูุญ ูู ุชุดุบูู ุงูุฌูุงุฒ ูุจุงุดุฑุฉ ุฏุงุฎู ูุงุฌูุฉ ุงููุงูุฐุฉ ุ ูููู ูุชู ุชูููุฐ ูุฐู ุงูููุฒุฉ ุจุงุณุชุฎุฏุงู ุงูุทุฑู ุงูุฒุงุฆู. </p><br><p style=";text-align:right;direction:rtl">  ุญูููุฉ ุฃู <em>ุงูุฌูุงุฒ PTS ูู ุฌูุงุฒ TTY</em> ููู ุฌุฏุง.  ุฅููู ุงูุณุจุจ: </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูุญุชูู ุงูุจุฑูุงูุฌ ุงูุฐู ูุชุตู ุจู ุงูุฌูุงุฒ ุงูุทุฑูู ุนูู ูุงูุฉ ุฅููุงููุงุช ุงูุฌูุงุฒ ุงูุทุฑูู ุงูุชูููุฏู.  ุนูู ุณุจูู ุงููุซุงู: ุชุนุทูู ุงูุตุฏู ุ ุชุนุทูู / ุชูููู ุงูุนุฑุถ ุงูููุณู. </li><li style=";text-align:right;direction:rtl">  ุงูุจุฑูุงูุฌ ุ ูุน ุงูุนูู ุฃู ุงูุฌูุงุฒ ุงูุทุฑูู ูุชุตู ุจู (ููุงู ุฃู ุงูุจุฑูุงูุฌ ูุญุชูู ุนูู ูุญุทุฉ ุชุญูู) ุ ูููู ุฃู ูุนูู ุจุดูู ุชูุงุนูู ููุทูุจ ูู ุงููุณุชุฎุฏู ุฅุฏุฎุงูู.  ุนูู ุณุจูู ุงููุซุงู ุ ุงุทูุจ ุงุณู ูุณุชุฎุฏู ููููุฉ ูุฑูุฑ. </li><li style=";text-align:right;direction:rtl">  ููุฌุฏ ุฃูุถูุง ูุธุงู TTY Line Discipline ุ ูุฐูู ูุฏููุง ุงููุฏุฑุฉ ุนูู ูุนุงูุฌุฉ ุฃุญุฑู ุงูุชุญูู ูุจู ุฃู ุชุตู ุฅูู ุงูุจุฑูุงูุฌ ุ ุจุงูุฅุถุงูุฉ ุฅูู ุชูุณูู ุฅุฎุฑุงุฌ ุงูุจุฑูุงูุฌ. </li></ol><br><p style=";text-align:right;direction:rtl">  ุฌูุงุฒ PTM ูู ุฃูุถูุง ุฌูุงุฒ TTY ุ ููู ูุฐุง ูุง ููุนุจ ุฃู ุฏูุฑ ุ ูุฃูู ูุง ูุณุชุฎุฏู ูุฌูุงุฒ ุชุญูู.  ุนูุงูุฉ ุนูู ุฐูู ุ ูุชู ุถุจุท ุงูุงูุถุจุงุท ุงูุฎุทู ูุฌูุงุฒ PTM ุนูู ุงููุถุน ุงูุฃููู ุ ูุจุงูุชุงูู ุ ูุง ุชุชู ุงููุนุงูุฌุฉ ุนูุฏ ููู ุงูุจูุงูุงุช ูู PTS ุฅูู ุฌูุงุฒ PTM.  ููุน ุฐูู ุ ูุง ูุฒุงู ูุชู ุชูุฏูู ุงูููุงููุงุช ุฅูู <code>read()</code> <code>write()</code> ูู ูุณุงุญุฉ ุงููุณุชุฎุฏู ุฃููุงู ุนู ุทุฑูู ุงูุงูุถุจุงุท ุนูู ุงูุฌูุงุฒูู.  ุณุชูุนุจ ูุฐู ุงููุญุธุฉ ุฏูุฑูุง ุฃูุจุฑ ุ ููุง ุณูุฑู ูุงุญููุง. </p><br><p style=";text-align:right;direction:rtl">  ูููุง ููู ุนูููุฉ ุงูุงุชุตุงู ุจูู ุฎุงุฏู ุฌููู ุงูุทุฑูู ูุงูุจุฑูุงูุฌ ุงูุฐู ูุนูู ุฏุงุฎู ุงูุฌูุงุฒ: </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/jz/y0/sg/jzy0sg0zjcceaflg6wyg7d5lkti.jpeg" title="ุนูููุฉ ุชูุตูู ุฎุงุฏู ุฌููู ุงูุทุฑูู ูุจุฑูุงูุฌ ูุนูู ุฏุงุฎู ุงูุฌูุงุฒ"></p><br><p style=";text-align:right;direction:rtl">  ูุฌุฏุฑ ุจูุง ุฃู ููุญุต ุจูุฒูุฏ ูู ุงูุชูุตูู ุงูุฏูุฑ ุงูุฐู ููุนุจู ุงูุงูุถุจุงุท ุงูุฎุทู ูู ุงูุชูุงุตู ุจูู ููุง ุงูุฌุฒุฃูู ูู ูุญุทุฉ ุฒุงุฆูุฉ.  ููุง ุ ูููู ุงูุฎุท ุงูุงูุถุจุงุท ูุณุคููุงู ุนู ูุนุงูุฌุฉ ุงูุจูุงูุงุช ุงูุชู <em>ุชูุฑ ูู PTM ุฅูู ุฌูุงุฒ PTS</em> ุ ููุฐูู ุนู ุชุณููู ุงูุจูุงูุงุช ูู ุฌุฒุก ูู ูุญุทุฉ ุงูุฒุงุฆูุฉ ุฅูู ุขุฎุฑ.  ุนูุฏูุง ูููู ูู ุจุฑูุงูุฌ ุชุดุบูู ุงูุฌูุงุฒ PTS ุ ูุฅููุง ูุดุงุฑู ุงูุงูุถุจุงุท ุงูุฎุท ูุฌูุงุฒ PTM ุ ูุงูุนูุณ ุจุงูุนูุณ. </p><br><hr><br><h2 id="virtualnye-ustroystva" style=";text-align:right;direction:rtl">  ุงูุฃุฌูุฒุฉ ุงูุงูุชุฑุงุถูุฉ </h2><br><p style=";text-align:right;direction:rtl">  ุฑุจูุง ููุช ุชุนุชูุฏ ุฃูู ููููู ูุชุญ ุงูููู ุนูู ุทูู ุงููุณุงุฑ <em>/ dev / pts / N</em> ููุชุงุจุฉ ุฃู ูุฑุงุกุฉ ุงูุจูุงูุงุช ููู ุ ูู ููู ูุตู ุนุงุฏูุ  ูุนู ุ ูู ุงูุฃุฌูุฒุฉ ุงูููุฌูุฏุฉ ุนูู ุงูุฃูุธูุฉ ุงููุดุงุจูุฉ ููุธุงู Unix ูู ูููุงุช ุ ูุฐูู ุจูุถู ุงููุจุฏุฃ ุงูุฃุณุงุณู ููุธุงู Unix ุ ูุงูุฐู ููุต ุนูู ุฃู ูู ุดูุก ููู.  ููุน ุฐูู ุ ูุง ุชูุฌุฏ ูููุงุช ุฎุงุตุฉ ุจุงูุฃุฌูุฒุฉ (ุงูุฅูุฌููุฒูุฉ - ููู ุงูุฌูุงุฒ) ูู ูููุงุช ูุตูุฉ.  ุชุณูู ูุฐู ุงูุฃุฌูุฒุฉ ุงูุฃุฌูุฒุฉ <strong>ุงูุงูุชุฑุงุถูุฉ</strong> - ุฃู ุฃููุง ููุฌูุฏุฉ ุญุตุฑููุง ูู ุงูุฐุงูุฑุฉ ูููุณ ุนูู ุงููุฑุต. </p><br><p style=";text-align:right;direction:rtl">  ูุง ุชุญุงูู ูุชุญ ูุฐู ุงููููุงุช ููููุงุช ูุตูุฉ ุนุงุฏูุฉ.  ููุน ุฐูู ุ ููููู ุงุณุชุฎุฏุงู ูุฐู ุงูุฃุฌูุฒุฉ ูู ุฎูุงู ุนูููุงุช <code>write()</code> ู <code>read()</code> ุ ูุงูุชู ุณูุชู ุชุดุบูู ุงูุงุชุตุงู ุจูุง ุจูุงุณุทุฉ ุจุฑูุงูุฌ ุชุดุบูู ุงูุฌูุงุฒ.  ุฏุนูุง ูุญุงูู ุงูููุงู ุจุฐูู. </p><br><p style=";text-align:right;direction:rtl">  ุงูุชุญ ูุงูุฐุชูู ุทุฑููุชูู ูุฃุฏุฎู <code>tty</code> ูู ูู ุฃูุฑ.  ุณููุธูุฑ ูุฐุง ุงูุฃูุฑ ุฃู ุฌูุงุฒ TTY ูุฎุฏู ุงูุฌูุงุฒ ุงููุดุท ุญุงูููุง.  ุงูุขู ุฃุฏุฎู <code>echo "Hello, World!" &gt; /dev/pts/N</code>  <code>echo "Hello, World!" &gt; /dev/pts/N</code> ูู ุงููุงูุฐุฉ ุงูุทุฑููุฉ ุงูุฃููู ุ ุญูุซ N ูู ูุคุดุฑ PTS ูุฌูุงุฒ ุงููุงูุฐุฉ ุงูุซุงููุฉ ุ ูู ุจุงูุชุจุฏูู ุฅูู ุงููุงูุฐุฉ ุงูุซุงููุฉ ูุณุชุฑู ุงููุฏุฎูุงุช ุงูุฎุงุตุฉ ุจู ูู ุงููุงูุฐุฉ ุงูุฃููู.  ููุฏ ููุช ุงูุขู ุจูุชุงุจุฉ ุงูุจูุงูุงุช ุฅูู ุฌูุงุฒ PTS ุงูุฎุงุต ุจุงูุฅุทุงุฑ ุงูุซุงูู <em>ููุง ูู ูุงูุช ูุฏ ุชู ุฅุฌุฑุงุคูุง ุจูุงุณุทุฉ ุจุฑูุงูุฌ ูุนูู ูู ุชูู ุงููุญุทุฉ</em> . </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/nj/3s/rp/nj3srpuzyahyvukzicfr0b5wnja.png"></p><br><hr><br><h2 id="ustroystvo-psevdoterminala" style=";text-align:right;direction:rtl">  ุงูุฌูุงุฒ ุงูุทุฑูู ุงูุฒุงุฆู </h2><br><p style=";text-align:right;direction:rtl">  ุฅููุง ููุชุฑุจ ุฃูุซุฑ ูุฃูุซุฑ ูู ุงูุฌุฒุก ุงูุฃุฎูุฑ ูู ุงูููุงูุฉ ุ ููู ูุจู ุฐูู ูููู ูุธุฑุฉ "ุชุญุช ุบุทุงุก" ูุธุงู Linux - ููุฑ ูู ุฌูุงุฒ ุงูุทุฑู ุงูุฒุงุฆู ุนูู ูุณุชูู ุงูููุงุฉ.  ุณูููู ููุงู ุงููุซูุฑ ูู ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ุ ููููู ุณุฃุญุงูู ุดุฑุญ ูู ูุฌููุนุฉ ูู ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ุงููุนููุฉ ุจุฃูุจุฑ ูุฏุฑ ูููู ูู ุงูุชูุงุตูู ุ ูุชูููู ุงูุชูุงุตูู ุบูุฑ ุงููููุฉ ูุงูุงูุชูุงู ุจุงูุชุณูุณู. </p><br><p style=";text-align:right;direction:rtl">  ูุจู ุงูุจุฏุก ุ ููุฏู ูุง ูุณูู "ุณูุฉ ุงูููููุงุช".  ุจูููุง ูุชุญุฑู ุนูู ุทูู ุงูููุจ ุ ุณูุถูู ุงููุฒูุฏ ูุงููุฒูุฏ ูู ุงูููููุงุช ุฅููู ููุฌุฏ ุตูุฉ ุจููููุง.  ุขูู ุฃู ูููู ูุฐุง ูุณุงุนุฏู ุนูู ููู ุฃูุถู ููุฌูุงุฒ ุงูุฒุงุฆู.  ููุจุฏุฃ. </p><br><p style=";text-align:right;direction:rtl">  ุนูุฏ ุจุฏุก ุชุดุบูู Linux ุ ูููู ุจุชุญููู ุจุฑุงูุฌ ุชุดุบูู ุงูุฃุฌูุฒุฉ ุงูุถุฑูุฑูุฉ.  ูุฏููุง ูุญุทุฉ ุงูุฒุงุฆูุฉ ูุฏููุง ุฃูุถุง ูุซู ูุฐุง ุงูุณุงุฆู.  ูุจุฏุฃ ุชุณุฌูููุง ุจุฏุนูุฉ ููุฐู ุงููุธููุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="objectivec hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> __init pty_init(<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>) { legacy_pty_init(); unix98_pty_init(); <span class="hljs-comment"><span class="hljs-comment">// &lt;- ,    return 0; } device_initcall(pty_init); // ,      </span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ุจุงููุณุจุฉ ุฅูู ุฌููุน ุงูุฃูุธูุฉ ุงูุญุฏูุซุฉ ุ ุณูุชู ุงุณุชุฏุนุงุก ุงูุฏุงูุฉ <code>unix98_pty_init()</code> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="objectivec hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> __init unix98_pty_init(<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>) { ptm_driver = tty_alloc_driver(NR_UNIX98_PTY_MAX, TTY_DRIVER_RESET_TERMIOS | TTY_DRIVER_REAL_RAW | TTY_DRIVER_DYNAMIC_DEV | TTY_DRIVER_DEVPTS_MEM | TTY_DRIVER_DYNAMIC_ALLOC); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (IS_ERR(ptm_driver)) panic(<span class="hljs-string"><span class="hljs-string">"Couldn't allocate Unix98 ptm driver"</span></span>); pts_driver = tty_alloc_driver(NR_UNIX98_PTY_MAX, TTY_DRIVER_RESET_TERMIOS | TTY_DRIVER_REAL_RAW | TTY_DRIVER_DYNAMIC_DEV | TTY_DRIVER_DEVPTS_MEM | TTY_DRIVER_DYNAMIC_ALLOC); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (IS_ERR(pts_driver)) panic(<span class="hljs-string"><span class="hljs-string">"Couldn't allocate Unix98 pts driver"</span></span>); ptm_driver-&gt;driver_name = <span class="hljs-string"><span class="hljs-string">"pty_master"</span></span>; ptm_driver-&gt;name = <span class="hljs-string"><span class="hljs-string">"ptm"</span></span>; ptm_driver-&gt;major = UNIX98_PTY_MASTER_MAJOR; ptm_driver-&gt;minor_start = <span class="hljs-number"><span class="hljs-number">0</span></span>; ptm_driver-&gt;type = TTY_DRIVER_TYPE_PTY; ptm_driver-&gt;subtype = PTY_TYPE_MASTER; ptm_driver-&gt;init_termios = tty_std_termios; ptm_driver-&gt;init_termios.c_iflag = <span class="hljs-number"><span class="hljs-number">0</span></span>; ptm_driver-&gt;init_termios.c_oflag = <span class="hljs-number"><span class="hljs-number">0</span></span>; ptm_driver-&gt;init_termios.c_cflag = B38400 | CS8 | CREAD; ptm_driver-&gt;init_termios.c_lflag = <span class="hljs-number"><span class="hljs-number">0</span></span>; ptm_driver-&gt;init_termios.c_ispeed = <span class="hljs-number"><span class="hljs-number">38400</span></span>; ptm_driver-&gt;init_termios.c_ospeed = <span class="hljs-number"><span class="hljs-number">38400</span></span>; ptm_driver-&gt;other = pts_driver; tty_set_operations(ptm_driver, &amp;ptm_unix98_ops); pts_driver-&gt;driver_name = <span class="hljs-string"><span class="hljs-string">"pty_slave"</span></span>; pts_driver-&gt;name = <span class="hljs-string"><span class="hljs-string">"pts"</span></span>; pts_driver-&gt;major = UNIX98_PTY_SLAVE_MAJOR; pts_driver-&gt;minor_start = <span class="hljs-number"><span class="hljs-number">0</span></span>; pts_driver-&gt;type = TTY_DRIVER_TYPE_PTY; pts_driver-&gt;subtype = PTY_TYPE_SLAVE; pts_driver-&gt;init_termios = tty_std_termios; pts_driver-&gt;init_termios.c_cflag = B38400 | CS8 | CREAD; pts_driver-&gt;init_termios.c_ispeed = <span class="hljs-number"><span class="hljs-number">38400</span></span>; pts_driver-&gt;init_termios.c_ospeed = <span class="hljs-number"><span class="hljs-number">38400</span></span>; pts_driver-&gt;other = ptm_driver; tty_set_operations(pts_driver, &amp;pty_unix98_ops); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (tty_register_driver(ptm_driver)) panic(<span class="hljs-string"><span class="hljs-string">"Couldn't register Unix98 ptm driver"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (tty_register_driver(pts_driver)) panic(<span class="hljs-string"><span class="hljs-string">"Couldn't register Unix98 pts driver"</span></span>); <span class="hljs-comment"><span class="hljs-comment">/* Now create the /dev/ptmx special device */</span></span> tty_default_fops(&amp;ptmx_fops); ptmx_fops.open = ptmx_open; cdev_init(&amp;ptmx_cdev, &amp;ptmx_fops); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cdev_add(&amp;ptmx_cdev, <span class="hljs-built_in"><span class="hljs-built_in">MKDEV</span></span>(TTYAUX_MAJOR, <span class="hljs-number"><span class="hljs-number">2</span></span>), <span class="hljs-number"><span class="hljs-number">1</span></span>) || register_chrdev_region(<span class="hljs-built_in"><span class="hljs-built_in">MKDEV</span></span>(TTYAUX_MAJOR, <span class="hljs-number"><span class="hljs-number">2</span></span>), <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"/dev/ptmx"</span></span>) &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) panic(<span class="hljs-string"><span class="hljs-string">"Couldn't register /dev/ptmx driver"</span></span>); device_create(tty_class, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">MKDEV</span></span>(TTYAUX_MAJOR, <span class="hljs-number"><span class="hljs-number">2</span></span>), <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">"ptmx"</span></span>);</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุญู ููุชููู ููุง ุจุซูุงุซุฉ ุฃุดูุงุก: </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูุณุชุฏุนู <code>tty_set_operatons</code> ูุจุฑูุงูุฌ ุชุดุบูู pty master ูุฃุฌูุฒุฉ ุงูุฑููู pty. </li><li style=";text-align:right;direction:rtl">  ูุธููุฉ <code>ptmx_open</code> ุ ุงููุณุคููุฉ ุนู ุฅูุดุงุก ููุง ุงูุฌุฒุฃูู ูู ุงูุฌูุงุฒ ุงูุทุฑูู ุงููุฒูู ุนูุฏ ูุชุญ ุงูุฌูุงุฒ <em>/ dev / ptmx ุงูุฎุงุต</em> .  ูุงู: / dev / ptmx ููุณ ุฌูุงุฒ PTM ุ ููููู ูุฌุฑุฏ ูุงุฌูุฉ ูุฅูุดุงุก ูุญุทุฉ ุฒุงุฆูุฉ ุฌุฏูุฏุฉ. </li><li style=";text-align:right;direction:rtl">  ุชุณุฌูู ุจุฑุงูุฌ ุชุดุบูู ุงูุฌูุงุฒ PTM ู PTS. </li></ol><br><p style=";text-align:right;direction:rtl">  ุฏุนูุง ูุฐูุจ ุจุงูุชุฑุชูุจ: </p><br><h4 id="1-tty_set_operations" style=";text-align:right;direction:rtl">  1. tty_set_operations </h4><br><p style=";text-align:right;direction:rtl">  ุชููู <strong>ุงูุฏุงูุฉ tty_set_operations ()</strong> ููุท ุจุชุนููู ุฌุฏูู ุฏุงูุฉ ูุจุฑูุงูุฌ ุงูุชุดุบูู ุงูุญุงูู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="objectivec hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> tty_set_operations(<span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> tty_driver *driver, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> tty_operations *op) { driver-&gt;ops = op; };</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูููู <strong>tty_operations</strong> ูู ุฌุฏูู ุงููุธุงุฆู ุงูุฐู ูุณุชุฎุฏู ูููุตูู ุฅูู ูุธุงุฆู ุจุฑูุงูุฌ ุชุดุบูู ุงูุฌูุงุฒ TTY. </p><br><p style=";text-align:right;direction:rtl">  <code>pty_unix98_ops</code> ุฃูู ุดูุก ูู ุงูููุงูู <code>pty_unix98_ops</code> ู <code>ptm_unix98_ops</code> ุ ูุงูุชู ูู ุฌุฏูู ูุธุงุฆู ุงูุฃุฌุฒุงุก ุงูููุงุจูุฉ ูู ุงููุญุทุฉ ุงูุฒุงุฆูุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="objectivec hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> tty_operations ptm_unix98_ops = { .install = pty_unix98_install, .remove = pty_unix98_remove, .open = pty_open, .close = pty_close, .write = pty_write, <span class="hljs-comment"><span class="hljs-comment">// ... }; static const struct tty_operations pty_unix98_ops = { .install = pty_unix98_install, .remove = pty_unix98_remove, .open = pty_open, .close = pty_close, .write = pty_write, // ... };</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ููุง ููููู ูุฑุงูุจุฉ ูุธููุฉ pty_write ุ <code>pty_write</code> ูุฃูููุฉ ุจุงููุนู ูู ููุงูุฉ Sishny printf - ุณูุนูุฏ ุฅูููุง ูุงุญููุง. </p><br><p style=";text-align:right;direction:rtl">  ุฏุนูุง ูุถูู ูุฐุง ุงููููู ุฅูู ุณูุฉ ุงูููููุงุช ูุฏููุง: <br><img src="https://habrastorage.org/webt/o8/e-/kc/o8e-kcpqestn7f481gcx38qmzuo.jpeg"></p><br><p style=";text-align:right;direction:rtl">  ููุง ุชุฑูู ุ ุงูุทุฑู ุงูุฑุฆูุณูุฉ ูููุง ุงูุณุงุฆููู ููุณุช ูุฎุชููุฉ ุนูู ุงูุฅุทูุงู.  ุจุงูููุงุณุจุฉ ุ ูุงุญุธ ุฃูู ูุง ุชูุฌุฏ ูุธููุฉ ูุนูููุฉ read () - ูุง ููุฌุฏ ุดูุก ูุซู <code>pty_read()</code> .  ุงูุญูููุฉ ูู ุฃู ุงููุฑุงุกุฉ ุณุชุฎุฏู ููุท ุนู ุทุฑูู ุงูุงูุถุจุงุท ุงูุฎุทู.  ูุจุงูุชุงูู ุ ูุฅููุง ูุชุนุฑู ุนูู ุงูููุฒุฉ ุงููุงูุฉ ุงูุซุงููุฉ ูุฎุท ุงูุงูุถุจุงุท - ูุฑุงุกุฉ ุงูุจูุงูุงุช ูู ุฌูุงุฒ TTY. </p><br><hr><br><h4 id="2-ptmx_open" style=";text-align:right;direction:rtl">  2. ptmx_open </h4><br><p style=";text-align:right;direction:rtl">  ุงูุขู ุฏุนูุง ููุชูู ุฅูู <strong>ptmx_open ()</strong> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="objectivec hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> ptmx_open(<span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> inode *inode, <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> file *filp) { <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> tty_struct *tty; <span class="hljs-comment"><span class="hljs-comment">//    -   ! fsi = devpts_acquire(filp); //     devpts index = devpts_new_index(fsi); //       /dev/pts // ... tty = tty_init_dev(ptm_driver, index); // ... devpts_pty_new(fsi, index, tty-&gt;link); //     /dev/pts retval = ptm_driver-&gt;ops-&gt;open(tty, filp); //  PTM ,   }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุญู ููุชููู <code>tty_init_dev()</code> ุ ุญูุซ ุงููุณูุทุฉ ุงูุฃููู ูู ุจุฑูุงูุฌ ุชุดุบูู ุฌูุงุฒ PTM ุ ูุงูุซุงูู ูู ููุฑุณ ุงูุฌูุงุฒ.  ููุง ูุชุฑู ููุทูุฉ ูุณุคูููุฉ ุจุฑูุงูุฌ ุชุดุบูู PTY ูููุชูู ุฅูู ุงูููู ุ ุงููุณุคูู ููุท ุนู ุงูุฃุฌูุฒุฉ TTY ุงูุนุงูุฉ ููุง ูุนุฑู ุฃู ุดูุก ุนู ูุญุทุฉ ุงูุฒุงุฆูุฉ ูุฏููุง. </p><br><pre style=";text-align:right;direction:rtl"> <code class="objectivec hljs"><span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> tty_struct *tty_init_dev(<span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> tty_driver *driver, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> idx) { <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> tty_struct *tty; tty = alloc_tty_struct(driver, idx); retval = tty_driver_install_tty(driver, tty); <span class="hljs-comment"><span class="hljs-comment">/* * Structures all installed ... call the ldisc open routines. */</span></span> retval = tty_ldisc_setup(tty, tty-&gt;link); <span class="hljs-comment"><span class="hljs-comment">//  ,       return tty; }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ุฃููุงู ุ ุณูุนูู ุนูู <code>alloc_tty_struct()</code> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="objectivec hljs"><span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> tty_struct *alloc_tty_struct(<span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> tty_driver *driver, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> idx) { <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> tty_struct *tty; tty = kzalloc(<span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(*tty), GFP_KERNEL); <span class="hljs-comment"><span class="hljs-comment">//  tty_struct tty_ldisc_init(tty) //      tty_struct tty-&gt;driver = driver; //       tty_struct tty-&gt;ops = driver-&gt;ops; //        tty_struct.     tty-&gt;index = idx; //   tty  return tty; }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงูุดูุก ุงููุญูุฏ ุงูุฐู ูุซูุฑ ุงูุชูุงููุง ููุง ูู ูุธููุฉ <code>tty_ldisc_init()</code> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="objectivec hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> tty_ldisc_init(<span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> tty_struct *tty) { <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> tty_ldisc *ld = tty_ldisc_get(tty, N_TTY); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (IS_ERR(ld)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> PTR_ERR(ld); tty-&gt;ldisc = ld; <span class="hljs-comment"><span class="hljs-comment">//        tty_struct return 0; }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงูุฐู ูุฏุนู <code>tty_ldisc_get()</code> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="objectivec hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> tty_ldisc *tty_ldisc_get(<span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> tty_struct *tty, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> disc) { <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> tty_ldisc *ld; <span class="hljs-comment"><span class="hljs-comment">//    struct tty_ldisc_ops *ldops; //     ldops = get_ldops(disc); //      .   ,       .   - N_TTY ld = kmalloc(sizeof(struct tty_ldisc), GFP_KERNEL | __GFP_NOFAIL); ld-&gt;ops = ldops; //       ld-&gt;tty = tty; //    tty_struct   .          return ld; }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุฐูู ุ ูููุง ุจูุญุต ุงุณุชุฏุนุงุก ุงูุฏุงูุฉ <code>alloc_tty_struct()</code> ุ ุงูุชู ุชูุดุฆ ุจููุฉ <em>tty_struct</em> ุฌูุจูุง ุฅูู ุฌูุจ ูุน ุฎุท ุงูุงูุถุจุงุท - ุจููุฉ <em>tty_ldisc</em> .  ูู ูู ุงูููุงูู ููุง ุฑูุงุจุท ูุจุนุถูุง ุงูุจุนุถ.  ุฏุนููุง ูููู ูุธุฑุฉ ูุงุญุตุฉ ุนูู ูุฐู ุงูููุงูู. </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <strong>tty_struct</strong> ุนุจุงุฑุฉ ุนู ุจููุฉ ูููุตูู ุฅูู ุจุฑูุงูุฌ ุชุดุบูู ุฌูุงุฒ TTY ูุจุนุถ ุงูุญููู ุงูุฃุฎุฑู.  ูุจุฏู ูุซู ูุฐุง: </li></ul><br><pre style=";text-align:right;direction:rtl"> <code class="objectivec hljs"><span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> tty_struct { <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> tty_driver *driver; <span class="hljs-comment"><span class="hljs-comment">//  TTY  const struct tty_operations *ops; //  .    ,   driver-&gt;ops,       int index; //   struct tty_ldisc *ldisc; //     struct tty_struct *link; //     PTY // ... }</span></span></code> </pre> <br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <strong>tty_ldisc</strong> ูู ูููู ุงูุงูุถุจุงุท ูุฎุท TTY ููุฌูุงุฒ.  ูุชููู ูู ุญูููู ููุท ููุจุฏู ููุง ููู: </li></ul><br><pre style=";text-align:right;direction:rtl"> <code class="objectivec hljs"><span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> tty_ldisc { <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> tty_ldisc_ops *ops; <span class="hljs-comment"><span class="hljs-comment">//    struct tty_struct *tty; //   tty_struct  .       };</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุจุฏู ุฃู ูุง ุดูุก ูุนูุฏุ  ูููู ุจุฅุถุงูุฉ ุฌููุน ุงูููุงูู ุงูุชู ุชู ุงุนุชุจุงุฑูุง ุญุชู ูุฐู ุงูููุทุฉ ุฅูู ุณูุชูุง ูุฑุจุทูุง ุจุงูุทุฑููุฉ ููุณูุง ุงููุฑุชุจุทุฉ ูู ุงูููุฏ: <br><img src="https://habrastorage.org/webt/1d/bt/n4/1dbtn4m_6c6i4n7oaohoguci2m0.jpeg" alt=" tty_struct" title="ุจูุงุก tty_struct"></p><br><p style=";text-align:right;direction:rtl">  ููููุง ุฃูุดุฃูุง tty_struct ููุท ูุฌูุงุฒ PTM.  ูุงุฐุง ุนู ุงูุฌูุงุฒ PTSุ  ููููุงู ุจุฐูู ุ ูุนูุฏ ุฅูู ูุธููุฉ <code>tty_init_dev()</code> ููุชุฐูุฑ ุฃูู ูู ุงููุชููุน ุฃู ูุฏุนู ุจุนุฏ ุฐูู ุฅูู ูุธููุฉ <code>tty_driver_install_tty()</code> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="objectivec hljs"><span class="hljs-comment"><span class="hljs-comment">/** * This method is responsible * for ensuring any need additional structures are allocated and configured. */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> tty_driver_install_tty(<span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> tty_driver *driver, <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> tty_struct *tty) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> driver-&gt;ops-&gt;install ? driver-&gt;ops-&gt;install(driver, tty) : tty_standard_install(driver, tty); }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุฎุจุฑูุง ุงูุชุนููู ุฃู ูุฐู ุงูุทุฑููุฉ ูุณุคููุฉ ุนู ุฅูุดุงุก ููุงูู ุฅุถุงููุฉ ูุชููุนุฉ.  ุงูุฌูุงุฒ PTS ูุณูู ูููู ูุฏููุง ูููู ุฅุถุงูู.  ุฃุนุชุฑู ุ ูุงู ุงูุฃูุฑ ููุงุฌุฆูุง ููุบุงูุฉ ุจุงููุณุจุฉ ูู ุ ูุฃูู ุ ุงูุฌุญูู ุ ุงูุฌูุงุฒ ุจุงููุงูู ุ ูููุณ ูุฌุฑุฏ ููุน ูู ุงูุจููุฉ ุงูุฅุถุงููุฉ!  ููููุง ูุฏุฑู ุฌููุนูุง ุฃู ุฌููุน ุงูุฃุฌูุฒุฉ ููุณุช ุณูู ููุน ูู ุงูุจููุฉ ุ ูุฐูู ุชุงุจุน.  ุญุณููุง ุ ูุง ูู <em>driver-&gt; ops-&gt; ุงูุชุซุจูุช ููุง</em> ุ  ููููุงู ุจุฐูู ุ ุงูุธุฑ ุฌุฏูู ุงููุธุงุฆู ูุจุฑูุงูุฌ ุชุดุบูู PTM ูุฑุฉ ุฃุฎุฑู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="objectivec hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> tty_operations ptm_unix98_ops = { .install = pty_unix98_install, <span class="hljs-comment"><span class="hljs-comment">// ...</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ููููู ุฃููุง ููุชููู <code>pty_unix98_install()</code> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="objectivec hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> pty_unix98_install(<span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> tty_driver *driver, <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> tty_struct *tty) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> pty_common_install(driver, tty, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงูุฐู ูุณุชุฏุนู ูุธููุฉ <code>pty_common_install()</code> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="objectivec hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> pty_common_install(<span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> tty_driver *driver, <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> tty_struct *tty, <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> legacy) { <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> tty_struct *o_tty; <span class="hljs-comment"><span class="hljs-comment">// tty_struct    PTY -    PTS  //    ,       install.   ,   PTM     tty_struct,        if (driver-&gt;subtype != PTY_TYPE_MASTER) return -EIO; o_tty = alloc_tty_struct(driver-&gt;other, idx); tty-&gt;link = o_tty; o_tty-&gt;link = tty; }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ,   PTS       <em>tty_struct</em>   ,       PTS .           .  tty_struct  PTS    . </p><br><hr><br><h4 id="registraciya-drayvera" style=";text-align:right;direction:rtl">   </h4><br><p style=";text-align:right;direction:rtl">        ,           TTY  (   -         ?). <br>  โ  ,       PTM,   PTS : </p><br><pre style=";text-align:right;direction:rtl"> <code class="objectivec hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> file_operations tty_fops = { .llseek = no_llseek, .read = tty_read, .write = tty_write, .poll = tty_poll, .unlocked_ioctl = tty_ioctl, .compat_ioctl = tty_compat_ioctl, .open = tty_open, .release = tty_release, .fasync = tty_fasync, .show_fdinfo = tty_show_fdinfo, };</code> </pre> <br><p style=";text-align:right;direction:rtl">         ,                  TTY . </p><br><hr><br><p style=";text-align:right;direction:rtl"> .      ,       <em>/dev/ptmx</em> .  ,   PTS ,      ,   PTM ,      : </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/5w/aw/rg/5wawrgbqqw1_llmi1r8g2kbwrzc.jpeg" title=" PTY"></p><br><hr><br><h2 id="hello-world" style=";text-align:right;direction:rtl">  ูุฑุญุจุง ุงูุนุงูู! </h2><br><p style=";text-align:right;direction:rtl">        .          "Hello, World!",        . </p><br><pre style=";text-align:right;direction:rtl"> <code class="objectivec hljs"><span class="hljs-meta"><span class="hljs-meta">#include </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdio.h&gt;</span></span></span><span class="hljs-meta"> void main() { printf(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Hello, World!\n"</span></span></span><span class="hljs-meta">); }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl"> ,   "Hello, World!"    .   ,    ,  ,       .    ,    .  stdout  <em>/dev/null</em> โ       .          ,       Linux. </p><br><p style=";text-align:right;direction:rtl">      Unix        <em>write()</em> , <em>read()</em> , <em>close()</em>  ,    write()  /dev/pts/0         <code>__vfs_write()</code> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="objectivec hljs">ssize_t __vfs_write(<span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> file *file, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> __user *buf, size_t count, loff_t *pos) { ssize_t ret; <span class="hljs-comment"><span class="hljs-comment">//... ret = file-&gt;f_op-&gt;write(file, buf, count, pos); //... return ret; }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">     write()      .   ,            : </p><br><pre style=";text-align:right;direction:rtl"> <code class="objectivec hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> file_operations tty_fops = { <span class="hljs-comment"><span class="hljs-comment">// ... .write = tty_write, // ...</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  <code>tty_write()</code> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="objectivec hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> ssize_t tty_write(<span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> file *file, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> __user *buf, size_t count, loff_t *ppos) { <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> tty_struct *tty = file_tty(file); <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> tty_ldisc *ld; ssize_t ret; ld = tty_ldisc_ref_wait(tty); ret = do_tty_write(ld-&gt;ops-&gt;write, tty, file, buf, count); tty_ldisc_deref(ld); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ret; }</code> </pre> <br><p style=";text-align:right;direction:rtl">     <em>tty_struct</em>    TTY ,           write()  .       : </p><br><pre style=";text-align:right;direction:rtl"> <code class="objectivec hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> tty_ldisc_ops n_tty_ops = { .write = n_tty_write, <span class="hljs-comment"><span class="hljs-comment">// ... };</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">    <code>n_tty_write()</code> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="objectivec hljs"><span class="hljs-comment"><span class="hljs-comment">/** * n_tty_write - write function for tty * @tty: tty device * @file: file object * @buf: userspace buffer pointer * @nr: size of I/O */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> ssize_t n_tty_write(<span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> tty_struct *tty, <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> file *file, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *buf, size_t nr) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *b = buf; <span class="hljs-comment"><span class="hljs-comment">// b - ,       "Hello, World!".          int c; //    //     PTS ,  write()    0,  ,     while (nr &gt; 0) { c = tty-&gt;ops-&gt;write(tty, b, nr); //  write()       TTY  if (!c) break; b += c; //     nr -= c; //      :  -  -  -  } }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl"> ,  "Hello, World!"    write()   PTS .       : </p><br><pre style=";text-align:right;direction:rtl"> <code class="objectivec hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> tty_operations pty_unix98_ops = { .write = pty_write, <span class="hljs-comment"><span class="hljs-comment">// ... }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  <code>pty_write()</code> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="objectivec hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> pty_write(<span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> tty_struct *tty, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *buf, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> c) { <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> tty_struct *to = tty-&gt;link; <span class="hljs-comment"><span class="hljs-comment">//      PTY.    -  PTM  if (c &gt; 0) { //    PTM  c = tty_insert_flip_string(to-&gt;port, buf, c); //     ,       if (c) { tty_flip_buffer_push(to-&gt;port); tty_wakeup(tty); } } return c; }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">          : </p><br><pre style=";text-align:right;direction:rtl"> <code class="objectivec hljs"> __vfs_write() -&gt; <span class="hljs-comment"><span class="hljs-comment">// 1- :   tty_write() -&gt; do_tty_write() -&gt; n_tty_write() -&gt; // 2- :   pty_write() // 3- : </span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">     . ,       PTM . ,    . </p><br><p style=";text-align:right;direction:rtl">  ,          <em>flip buffer</em> . <strong>Flip buffer</strong> โ   ,    .  tty driver   ,      .   ,              .      ,        ,       .     ,      ,            .  -        flip buffer โ       (,    -  ,         flip). </p><br><p style=";text-align:right;direction:rtl">          ,       .  <code>tty_insert_flip_string()</code>         <code>tty_insert_flip_string_fixed_flag()</code> ,           PTM : </p><br><pre style=";text-align:right;direction:rtl"> <code class="objectivec hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> tty_insert_flip_string_fixed_flag(<span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> tty_port *port, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *chars, <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> flag, size_t size) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> copied = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> goal = min_t(size_t, size - copied, TTY_BUFFER_PAGE); <span class="hljs-comment"><span class="hljs-comment">//      int space = __tty_buffer_request_room(port, goal, flags); //     struct tty_buffer *tb = port-&gt;buf.tail; //       if (unlikely(space == 0)) break; memcpy(char_buf_ptr(tb, tb-&gt;used), chars, space); //      tb-&gt;used += space; copied += space; chars += space; /* There is a small chance that we need to split the data over several buffers. If this is the case we must loop */ } while (unlikely(size &gt; copied)); return copied; }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">   , flip buffer        ,       ,         .        ,   โ        PTM ,             . </p><br><p style=";text-align:right;direction:rtl"> ,   "Hello, World!"   PTM .    GNOME Terminal Server    <em>poll()</em> (  I/O)        master .  ,         ?  ูุง ููู ููู.      ,     ,      โ        . </p><br><p style=";text-align:right;direction:rtl">            <code>tty_flip_buffer_push()</code> (   pty_write): </p><br><pre style=";text-align:right;direction:rtl"> <code class="objectivec hljs"><span class="hljs-comment"><span class="hljs-comment">/** * tty_flip_buffer_push - terminal * @port: tty port to push * * Queue a push of the terminal flip buffers to the line discipline. * Can be called from IRQ/atomic context. * * In the event of the queue being busy for flipping the work will be * held off and retried later. */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> tty_flip_buffer_push(<span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> tty_port *port) { tty_schedule_flip(port); }</code> </pre> <br><p style=";text-align:right;direction:rtl">  <code>tty_schedule_flip()</code> ,   ,        : </p><br><pre style=";text-align:right;direction:rtl"> <code class="objectivec hljs"><span class="hljs-comment"><span class="hljs-comment">/** * tty_schedule_flip - push characters to ldisc * @port: tty port to push from * * Takes any pending buffers and transfers their ownership to the * ldisc side of the queue. It then schedules those characters for * processing by the line discipline. */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> tty_schedule_flip(<span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> tty_port *port) { <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> tty_bufhead *buf = &amp;port-&gt;buf; <span class="hljs-comment"><span class="hljs-comment">/* paired w/ acquire in flush_to_ldisc(); ensures * flush_to_ldisc() sees buffer data. */</span></span> smp_store_release(&amp;buf-&gt;tail-&gt;commit, buf-&gt;tail-&gt;used); queue_work(system_unbound_wq, &amp;buf-&gt;work); }</code> </pre> <br><p style=";text-align:right;direction:rtl">   ,     <em>work</em> (,   -       )       ,      โ    ,    <code>flush_to_ldisc()</code> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="objectivec hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> flush_to_ldisc(<span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> work_struct *work) { <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> tty_port *port = container_of(work, <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> tty_port, buf.work); <span class="hljs-comment"><span class="hljs-comment">//   tty_port PTM . tty_port -       TTY  struct tty_bufhead *buf = &amp;port-&gt;buf; struct tty_buffer *head = buf-&gt;head; // ... receive_buf(port, head); // ... }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  <code>receive_buf()</code>          <code>__receive_buf()</code> ,      : </p><br><pre style=";text-align:right;direction:rtl"> <code class="objectivec hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> __receive_buf(<span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> tty_struct *tty, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *cp, <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *fp, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> count) { <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> n_tty_data *ldata = tty-&gt;disc_data; <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> preops = I_ISTRIP(tty) || (I_IUCLC(tty) &amp;&amp; L_IEXTEN(tty)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ldata-&gt;real_raw) n_tty_receive_buf_real_raw(tty, cp, fp, count); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ldata-&gt;raw || (L_EXTPROC(tty) &amp;&amp; !preops)) n_tty_receive_buf_raw(tty, cp, fp, count); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (tty-&gt;closing &amp;&amp; !L_EXTPROC(tty)) n_tty_receive_buf_closing(tty, cp, fp, count); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ldata-&gt;lnext) { <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> flag = TTY_NORMAL; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fp) flag = *fp++; n_tty_receive_char_lnext(tty, *cp++, flag); count--; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!preops &amp;&amp; !I_PARMRK(tty)) n_tty_receive_buf_fast(tty, cp, fp, count); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> n_tty_receive_buf_standard(tty, cp, fp, count); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (read_cnt(ldata)) { kill_fasync(&amp;tty-&gt;fasync, SIGIO, POLL_IN); wake_up_interruptible_poll(&amp;tty-&gt;read_wait, EPOLLIN); } }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ,   <em>n_tty_receive_buf</em> ( ,    _raw)           <strong>read_buf</strong> ,         TTY .      PTM    raw ,           read_buf. ,        PTM  PTS ,     . </p><br><p style=";text-align:right;direction:rtl">       ,   : </p><br><pre style=";text-align:right;direction:rtl"> <code class="objectivec hljs"> ... pty_write() -&gt; <span class="hljs-comment"><span class="hljs-comment">// 3- :  PTS  tty_insert_flip_string + tty_flip_buffer_push() -&gt; tty_schedule_flip() -&gt; --- //    PTM  flush_to_ldisc() -&gt; // 2- :   PTM  receive_buf() -&gt; n_tty_receive_buf -&gt; n_tty_receive_buf_common -&gt; __receive_buf()</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl"> ,   PTM        โ         PTS . </p><br><p style=";text-align:right;direction:rtl">  :       PTM .  GNOME Terminal Server      "Hello, World!",  read()  PTM .  read()    write()    โ  <code>n_tty_read()</code> .      ,  ,          โ <em>read_buf</em> โ   .  GNOME Terminal Server    X Server,     . </p><br><p style=";text-align:right;direction:rtl">  ,   "Hello, World!"   : </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> -&gt; PTY slave -&gt; PTY master -&gt; GNOME-TERMINAl-SERVER -&gt; X Server -&gt; -&gt; </code> </pre> <br><hr><br><h2 id="zaklyuchenie" style=";text-align:right;direction:rtl">  ุงุณุชูุชุงุฌ </h2><br><p style=";text-align:right;direction:rtl">  .     : </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">     </li><li style=";text-align:right;direction:rtl">     </li><li style=";text-align:right;direction:rtl">   TTY  </li><li style=";text-align:right;direction:rtl">    </li><li style=";text-align:right;direction:rtl">    ,         </li></ol><br><p style=";text-align:right;direction:rtl">   ,   !     -  โ     ,   ! </p><br><h3 id="istochniki" style=";text-align:right;direction:rtl">  ูุตุงุฏุฑ </h3><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"> Linux man pages </li><li style=";text-align:right;direction:rtl"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">https://unix.stackexchange.com/q/96694/346664</a> </li><li style=";text-align:right;direction:rtl"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">https://unix.stackexchange.com/q/93531/346664</a> </li><li style=";text-align:right;direction:rtl"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">https://unix.stackexchange.com/q/117981/346664</a> </li><li style=";text-align:right;direction:rtl"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">https://askubuntu.com/q/506510</a> </li><li style=";text-align:right;direction:rtl"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">www.linusakesson.net/programming/tty/</a> </li><li style=";text-align:right;direction:rtl"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">https://spin0r.wordpress.com/2012/12/28/terminally-confused-part-seven/</a> </li><li style=";text-align:right;direction:rtl"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">https://habr.com/ru/company/neobit/blog/330764/</a> </li><li style=";text-align:right;direction:rtl">  Advanced Programming in the UNIX Environment, 3rd Edition </li></ul><cut></cut></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar460257/">https://habr.com/ru/post/ar460257/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar460247/index.html">ูุตูุงุช ELFs</a></li>
<li><a href="../ar460249/index.html">ุญู ุงููููุฉ ูุน pwnable.kr 07 - ุงููุฏุฎูุงุช. ููู pwntools</a></li>
<li><a href="../ar460251/index.html">ุงูุบุจุงุก ุงูุงุตุทูุงุนู: ุฑูุจูุช ูู ูุณุงุนุฏูู</a></li>
<li><a href="../ar460253/index.html">10 ุฃุณุจุงุจ ูุฌุนู ุงูููุงุฑุงุช ุงูุฎุงุตุฉ ุจู ููุณุงุนุฏ ุงูุตูุช</a></li>
<li><a href="../ar460255/index.html">ูุณุชุชุฑ ุนูู Node.js: ููุงุฐุง ุ ููุงุฐุง ูููู ูุนูู</a></li>
<li><a href="../ar460259/index.html">ูุง ูู ุชุตููู UI ู UXุ ูุง ูู ุดุงุฆุน ููุฎุชููุ</a></li>
<li><a href="../ar460261/index.html">ุฃูุงุฒูู: 25 ุนุงููุง ูู ุงููุฌุงุญ ูู ุงูุชุฌุงุฑุฉ ุงูุฅููุชุฑูููุฉ</a></li>
<li><a href="../ar460263/index.html">ุฅุฌุฑุงุก ุจุญุซ ุฐูู ุญููุง: ุฏููู ุฎุทูุฉ ุจุฎุทูุฉ</a></li>
<li><a href="../ar460265/index.html">ุฅูุดุงุก ูุงูุจ ูุดุฑูุน Xcode</a></li>
<li><a href="../ar460273/index.html">ุฅุฐู ูู Apple Pay ูุฃุตุบุฑ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>