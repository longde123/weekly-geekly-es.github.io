<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👌🏾 🐏 ✏️ Kompilasi silang di buruh pelabuhan. Kenapa tidak 💆 🎅 🈯️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Apakah kompilasi silang itu? Apa alat untuk membangun file biner untuk Windows di Linux ? Bagaimana cara mengkonfigurasi wadah buruh pelabuhan untuk s...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Kompilasi silang di buruh pelabuhan. Kenapa tidak</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/456916/"><p>  Apakah kompilasi silang itu?  Apa alat untuk membangun file biner untuk <strong>Windows</strong> di <strong>Linux</strong> ?  Bagaimana cara mengkonfigurasi wadah <strong>buruh pelabuhan</strong> untuk semua ini?  Berikut adalah beberapa masalah yang akan dibahas di bawah ini. </p><a name="habracut"></a><br><h2 id="instrumenty">  Alat-alatnya </h2><br><p>  Kompilasi silang memungkinkan Anda mendapatkan kode yang dapat dieksekusi untuk platform selain dari yang digunakan untuk menjalankan proses ini. </p><br><p>  Dalam artikel ini, kita akan melihat kompilasi silang untuk platform <strong>Windows</strong> di <strong>Linux</strong> . </p><br><p>  Contoh kompilator silang adalah <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Mingw-w64</a> .  Bahkan, ini hanya menyediakan alat untuk membangun aplikasi, tetapi jika Anda membutuhkan perpustakaan pihak ketiga yang bukan bagian dari <strong>STL</strong> , Anda harus mengumpulkannya dan dependensi.  Anda juga dapat menggunakan file biner yang sudah jadi, seperti yang dijelaskan dalam <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">artikel ini</a> . </p><br><p>  Proyek <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">mxe</a> , yang tidak hanya menyediakan alat, tetapi juga pustaka, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">menyederhanakan</a> pengaturan perakitan.  Daftar mereka dapat ditemukan di situs web resmi.  Saat memasang pustaka, kontrol dependensi digunakan, mis.  paket yang diperlukan dan semua yang diperlukan untuk operasinya akan diinstal.  Alat-alat disampaikan dalam konfigurasi pra-konfigurasi, misalnya, untuk perakitan statis aplikasi 64-bit.  Ini sangat memudahkan perakitan. </p><br><p>  Lingkungan <strong>mxe</strong> digunakan untuk folder lokal pengguna.  Untuk melakukan ini, cukup instal dependensi melalui manajer paket dan klon repositori.  Di root repositori adalah <strong>Makefile</strong> , yang melakukan instalasi perpustakaan yang ditetapkan untuk tujuan tersebut, menambahkan alat untuk perakitan, dll. </p><br><p>  Penting untuk dicatat bahwa lingkungan build dilokalkan dalam foldernya, ini memungkinkan Anda untuk mengonfigurasi lingkungan individu untuk setiap aplikasi. </p><br><h2 id="konteyneriziruy-eto">  Wadah itu </h2><br><p>  Katakanlah build rilis untuk <strong>Windows</strong> dikonfigurasikan pada mesin lokal.  Rilis keluar cukup sering, dalam beberapa versi perpustakaan baru ditambahkan, dan beberapa, misalnya, dihapus.  Suatu hari, bos menuntut untuk <em>membuang</em> rilis untuk pemula.  Bagaimana cara mengkonfigurasi lingkungan build-nya?  Pustaka apa yang harus diambil dari repositori <strong>mxe</strong> , dan untuk yang mana dibangun dari sumber? </p><br><p>  Dalam hal ini, Anda bisa mendapatkan skrip <strong>bash</strong> yang akan menyebarkan seluruh lingkungan dalam folder yang diberikan.  Dan setelah <em>mencoba</em> memperbarui skrip ini.  Tetapi, seperti dokumentasi untuk proyek, pada satu saat kritis, itu bisa menjadi usang. </p><br><p>  Solusi yang baik adalah dengan mengisolasi lingkungan build kami di dalam wadah <strong>buruh pelabuhan</strong> .  File <strong>buruh pelabuhan</strong> itu sendiri akan berisi serangkaian instruksi mandiri untuk menyebarkan lingkungan, dan keberadaan kontainer akan membantu untuk menghindari mengacaukan sistem rumah dengan perpustakaan yang tidak perlu. </p><br><h2 id="sobiraem-vse-vmeste">  Menyatukan semuanya </h2><br><p>  Untuk demonstrasi, mari ambil proyek <strong>Qt</strong> sederhana - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">SimpleQtProject</a> .  Proyek ini dibangun oleh utilitas <strong>qmake</strong> , dan terdiri dari satu bentuk tunggal.  Ini, tentu saja, dilakukan untuk kesederhanaan.  Juga di folder <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">buruh pelabuhan</a> adalah file untuk membangun wadah. </p><br><p>  Pertimbangkan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">file</a> proyek <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">buruh pelabuhan</a> .  Bahkan, itu terdiri dari beberapa bagian utama: </p><br><ul><li>  menginstal dependensi untuk sistem build </li><li>  instalasi dan konfigurasi sistem perakitan </li><li>  mengkompilasi proyek dan menyalin artefak ke sistem host </li></ul><br><blockquote>  Hanya perintah dasar dari file yang dipertimbangkan di bawah ini, untuk pengenalan lengkap disarankan untuk berkonsultasi dengan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">repositori</a> . </blockquote><p>  Kami melewatkan titik pertama dan melanjutkan langsung ke instalasi <strong>mxe</strong> . <br>  Kloning repositori: </p><br><pre><code class="plaintext hljs">RUN mkdir /cross \ &amp;&amp; cd /cross \ &amp;&amp; git clone https://github.com/mxe/mxe.git \ &amp;&amp; cd mxe \ &amp;&amp; git checkout build-2019-06-02</code> </pre> <br><p>  Pada saat penulisan, rilis terbaru adalah <strong>build-2019-06-02</strong> .  Cabang master tidak digunakan di sini karena alasan sederhana: pengulangan perakitan diperlukan.  Kalau tidak, saat menambahkan komit baru ke master, majelis mungkin pecah. </p><br><p>  Selanjutnya, kami mengkonfigurasi sistem build: </p><br><pre> <code class="plaintext hljs">RUN make MXE_TARGETS=x86_64-w64-mingw32.static qtbase -j4 JOBS=4</code> </pre> <br><p>  Perintah ini akan menambahkan alat (contoh <strong>cmake</strong> dan <strong>Mingw-w64</strong> , dll.) Untuk perakitan statis proyek di bawah arsitektur 64-bit, dan kemudian mengumpulkan <strong>Qt</strong> menggunakannya. </p><br><p>  Langkah selanjutnya adalah menambahkan path ke file <strong>mxe yang</strong> dapat dieksekusi di <strong>PATH</strong> : </p><br><pre> <code class="plaintext hljs">ENV PATH="/cross/mxe/usr/bin:${PATH}"</code> </pre> <br><p>  Setelah lingkungan build dikonfigurasikan, Anda dapat langsung menuju ke item terakhir: </p><br><pre> <code class="plaintext hljs">ENTRYPOINT x86_64-w64-mingw32.static-qmake-qt5 /app/src/SimpleQtProject.pro \ &amp;&amp; make release \ &amp;&amp; cp release/SimpleQtProject.exe /app/res/</code> </pre> <br><p>  Berikut adalah beberapa hal untuk diklarifikasi.  Diasumsikan bahwa ketika wadah mulai, folder sumber yang berisi file <strong>* .pro</strong> akan dipasang di folder <strong>/ app / src /</strong> , dan tempat di mana hasil perakitan harus ditambahkan akan dipasang di direktori <strong>/ app / res /</strong> . </p><br><p>  Berikut ini adalah contoh dari perintah untuk membuat <strong>docker-image</strong> , itu harus dijalankan di folder <strong>docker</strong> dari proyek yang bersangkutan: </p><br><pre> <code class="plaintext hljs">docker build -t simple-qt-build --file windows.docker .</code> </pre> <br><p>  Majelis dimulai di sana: </p><br><pre> <code class="plaintext hljs">docker run --mount type=bind,source=$(pwd)/result/,target=/app/res --mount type=bind,source=$(pwd)/../,target=/app/src simple-qt-build</code> </pre> <br><p>  Sebelum menjalankan perintah, Anda harus membuat folder <strong>hasil</strong> di direktori <strong>buruh pelabuhan</strong> untuk menyalin hasilnya. </p><br><h2 id="kastomizaciya-sborki">  Kustomisasi perakitan </h2><br><p>  Secara default, <strong>mxe</strong> menyediakan <strong>MinGW</strong> versi <strong>5.5.0</strong> (setidaknya ini berlaku untuk <strong>build-2019-06-02</strong> ). </p><br><p>  Jika proyek menggunakan fitur baru <strong>C ++ 17</strong> , maka versi kompiler seperti itu tidak memuaskan.  Untungnya, lingkungan build menyediakan versi yang lebih baru sebagai plugin terpisah.  Untuk mengatasi masalah kami, kami perlu menambahkan instruksi untuk menggunakan plugin yang sesuai untuk tim pembuat perpustakaan: </p><br><pre> <code class="plaintext hljs">make MXE_TARGETS=x86_64-w64-mingw32.static MXE_PLUGIN_DIRS=plugins/gcc7 qtbase -j4 JOBS=4</code> </pre> <br><p>  Perintah ini akan membuat kit untuk rakitan statis aplikasi 64-bit menggunakan kompiler dari versi ketujuh ( <strong>7.4.0</strong> ).  Jika kit <strong>semacam itu sudah ada</strong> , maka itu <strong>tidak akan</strong> berubah. </p><br><p>  Daftar semua plugin yang tersedia dapat ditemukan di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">halaman</a> . </p><br><p>  Direktori <strong>mxe / src</strong> berisi file <strong>* .mk</strong> yang menjelaskan parameter perakitan dari paket tertentu.  Jika perlu, Anda dapat melakukan penyesuaian yang diperlukan untuk paket yang ada atau menambahkan paket Anda sendiri.  Struktur file dijelaskan di sini - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">https://github.com/mxe/mxe/wiki/Add-a-New-Package:-Full-Version</a> . </p><br><p>  Untuk menyalin dependensi, proyek mxe menyediakan utilitas <a href="">copydlldeps.sh</a> .  Tapi ini bukan satu-satunya alat yang berguna, daftar lengkapnya dapat ditemukan di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">halaman</a> . </p><br><h2 id="cmake-i-staticheskaya-linkovka-qt">  CMake dan tautan statis Qt </h2><br><p>  Kebetulan di proyek saya, saya menggunakan sistem <strong>Qt</strong> dan <strong>CMake</strong> build.  Ketika diputuskan untuk membangun proyek untuk <strong>Windows</strong> , solusi terbaik adalah membangun semuanya menggunakan tautan statis untuk memberikan pengguna satu binar, tanpa ketergantungan apa pun. </p><br><p>  Mem-parsing segunung kesalahan linker, adalah mungkin untuk mengetahui bahwa perakitan seperti itu di luar kotak tidak berfungsi, di tempat lain.  Faktanya adalah bahwa ketika menggunakan tautan statis, <strong>qmake</strong> menghasilkan file <strong>* .cpp</strong> , yang berisi instruksi untuk mengimpor plugin, tentang jenis ini: </p><br><pre> <code class="plaintext hljs">// This file is autogenerated by qmake. It imports static plugin classes for // static plugins specified using QTPLUGIN and QT_PLUGIN_CLASS.&lt;plugin&gt; variables. #include &lt;QtPlugin&gt; Q_IMPORT_PLUGIN(QWindowsVistaStylePlugin) Q_IMPORT_PLUGIN(QWindowsIntegrationPlugin) Q_IMPORT_PLUGIN(QGifPlugin) Q_IMPORT_PLUGIN(QICOPlugin) Q_IMPORT_PLUGIN(QJpegPlugin)</code> </pre> <br><p>  Bendera dan pustaka untuk tahap penautan di <strong>Makefile</strong> juga ditambahkan. </p><br><p>  Anda dapat mencoba bereksperimen dengan desain ini di <strong>CMakeLists.txt</strong> : </p><br><pre> <code class="plaintext hljs">foreach(plugin ${Qt5Gui_PLUGINS}) get_target_property(_loc ${plugin} LOCATION) message("Plugin ${plugin} is at location ${_loc}") set(plugin_libs ${plugin_libs} ${_loc}) endforeach()</code> </pre> <br><p>  Dan kemudian tambahkan penggunaan <code>plugin_libs</code> .  Tetapi bagi saya, pendekatan ini tidak membuahkan hasil. </p><br><p>  Pada akhirnya, saya sampai pada keputusan untuk menautkan secara dinamis (jika mungkin) semua pustaka eksternal dan menyalin, bersama dengan file yang dapat dieksekusi, <a href="">dll yang</a> diperlukan menggunakan <a href="">copydlldeps.sh</a> .  Lebih detail tentang penyebaran di bawah <strong>Qt</strong> di <strong>Windows itu</strong> dijelaskan dalam <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">artikel</a> . </p><br><h2 id="v-zaklyuchenii">  Kesimpulannya </h2><br><p>  Itu ditunjukkan di atas bagaimana, dalam beberapa langkah sederhana, Anda dapat mengkonfigurasi lingkungan untuk kompilasi silang proyek.  Tapi, sayangnya, dalam kondisi nyata, semuanya tidak begitu cerah. </p><br><p>  Meskipun proyek <strong>mxe</strong> menyediakan daftar pustaka yang mengesankan, mungkin masih belum termasuk yang Anda butuhkan atau menyertakan versi yang terlalu baru.  Ya, ada peluang untuk membuat paket sendiri atau, paling buruk, membangun perpustakaan dari sumber.  Tetapi tidak semuanya dapat dibangun dengan cross-compiler, jadi saya tidak dapat melakukannya dengan proyek <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">cpprestsdk</a> , karena itu membutuhkan <strong>vcpkg yang</strong> diinstal. </p><br><p>  Banyak masalah yang mungkin timbul ketika membangun proyek dengan cross-compiler adalah tipikal untuk pengembangan lintas platform secara umum.  Sebagai contoh, saya memiliki kesalahan aneh karena elemen enumerasi <code>ERROR</code> .  Ternyata di salah satu file header <strong>Windows</strong> ada makro dengan nama yang sama.  Substitusi ini memecahkan semua kode. </p><br><p>  Adalah urusan semua orang untuk menggunakan kompilasi silang atau tidak.  Ini memberi saya keuntungan yang baik.  Saya mengkonfigurasi perakitan untuk beberapa distribusi <strong>Linux</strong> dan <strong>Windows</strong> dalam wadah <strong>buruh pelabuhan</strong> terpisah untuk proyek <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">SecureDialogues</a> saya, menambahkan satu file <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">makefile</a> untuk memulai proses satu per satu untuk setiap kontainer.  Selanjutnya, jalankan <strong>make</strong> dan setelah beberapa saat saya mendapatkan file biner untuk OS yang diperlukan di folder lokal. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id456916/">https://habr.com/ru/post/id456916/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id456898/index.html">Perkalian integer cepat menggunakan tabel</a></li>
<li><a href="../id456902/index.html">Pemberitahuan push aman: dari teori ke praktik</a></li>
<li><a href="../id456904/index.html">Muat pengujian proyek web - tanpa uang tunai</a></li>
<li><a href="../id456908/index.html">Bagaimana Telegram menggabungkan Anda ke Rostelecom</a></li>
<li><a href="../id456912/index.html">Cara membuat situs di 2019</a></li>
<li><a href="../id456920/index.html">Sony Xperia 1 di Rusia - bonus harga dan pre-order</a></li>
<li><a href="../id456922/index.html">Bagaimana prosesor dirancang dan diproduksi: dasar-dasar arsitektur komputer</a></li>
<li><a href="../id456926/index.html">Bagaimana kami melakukan Sportmaster</a></li>
<li><a href="../id456928/index.html">JMeter - Swiss Tester Knife (Bagian 1)</a></li>
<li><a href="../id456932/index.html">OpenGL Ultramodern. Bagian 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>