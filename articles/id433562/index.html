<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👎🏻 🤘🏽 👨🏻‍🎨 Verifikasi proyek LibrePCB menggunakan PVS-Studio di dalam wadah Docker 📨 🤼 ➗</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ini adalah artikel klasik tentang bagaimana tim kami menguji proyek LibrePCB terbuka menggunakan penganalisis kode statis PVS-Studio. Namun, artikel i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Verifikasi proyek LibrePCB menggunakan PVS-Studio di dalam wadah Docker</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/433562/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9cf/0ad/c99/9cf0adc990a16a5f4b3589254d6d1ecf.png" alt="PVS-Studio dan Docker Container"></div><br>  Ini adalah artikel klasik tentang bagaimana tim kami menguji proyek LibrePCB terbuka menggunakan penganalisis kode statis PVS-Studio.  Namun, artikel ini menarik karena verifikasi dilakukan di dalam wadah Docker.  Jika Anda menggunakan wadah, kami berharap artikel tersebut akan menunjukkan cara sederhana lain untuk mengintegrasikan alat analisis ke dalam proses pengembangan. <br><a name="habracut"></a><br><h2>  LibrePCB </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">LibrePCB</a> adalah perangkat lunak gratis untuk mendesain sirkuit elektronik dan papan sirkuit cetak.  Kode program ditulis dalam C ++, dan Qt5 digunakan untuk membangun antarmuka grafis.  Baru-baru ini, rilis resmi pertama dari aplikasi ini terjadi, yang menandai stabilisasi format file sendiri (* .lp, * .lplib).  Paket biner disiapkan untuk Linux, macOS dan Windows. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/eca/fd3/b3e/ecafd3b3e956a20f10f53fa20ae1e93e.png" alt="LibrePCB"></div><br><br>  LibrePCB adalah proyek kecil yang hanya berisi sekitar 300.000 baris kode tidak kosong dalam C dan C ++.  Pada saat yang sama, 25% dari baris yang tidak kosong adalah komentar.  Omong-omong, ini adalah persentase yang besar untuk komentar.  Kemungkinan besar, ini disebabkan oleh fakta bahwa proyek memiliki banyak file kecil, yang sebagian besar ditempati oleh komentar komentar dan informasi proyek.  Kode situs GitHub: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">LibrePCB</a> . <br><br>  Proyek itu tampak menarik bagi kami, dan kami memutuskan untuk memeriksanya.  Tetapi hasil tes tidak lagi begitu menarik.  Ya, ada kesalahan nyata.  Tetapi tidak ada yang istimewa tentang hal itu yang tentunya harus kami sampaikan kepada pembaca artikel kami.  Mungkin kami tidak akan menulis artikel dan membatasi diri untuk mengirim kesalahan kepada pengembang proyek.  Namun, hal yang menarik adalah bahwa proyek tersebut diuji di dalam gambar Docker, dan oleh karena itu kami memutuskan bahwa masih layak untuk menulis artikel. <br><br><h2>  Docker </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Docker</a> - perangkat lunak untuk mengotomatiskan penyebaran dan pengelolaan aplikasi dalam lingkungan virtualisasi di tingkat sistem operasi.  Ini memungkinkan Anda untuk "mengemas" aplikasi dengan semua lingkungan dan dependensinya ke dalam wadah.  Meskipun teknologi ini berumur sekitar lima tahun dan banyak perusahaan telah lama mengimplementasikan Docker dalam infrastruktur proyek mereka, di dunia open source ini tidak terlalu terlihat sampai saat ini. <br><br>  Perusahaan kami bekerja sangat erat dengan proyek sumber terbuka, memeriksa kode sumber menggunakan penganalisa statis PVS-Studio kami sendiri.  Saat ini, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">lebih dari 300 proyek</a> telah diverifikasi.  Hal yang paling sulit dalam kegiatan ini adalah selalu kompilasi proyek orang lain, tetapi pengenalan wadah Docker sangat menyederhanakan proses ini. <br><br>  Pengalaman pertama menguji proyek sumber terbuka di Docker adalah dengan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Azure Service Fabric</a> .  Di sana, pengembang membuat instalasi direktori file sumber ke wadah dan integrasi penganalisa terbatas untuk mengedit salah satu skrip yang berjalan dalam wadah: <br><br><pre><code class="cpp hljs">diff --git a/src/build.sh b/src/build.sh index <span class="hljs-number"><span class="hljs-number">290</span></span>c57d.<span class="hljs-number"><span class="hljs-number">.2</span></span>a286dc <span class="hljs-number"><span class="hljs-number">100755</span></span> --- a/src/build.sh +++ b/src/build.sh @@ <span class="hljs-number"><span class="hljs-number">-193</span></span>,<span class="hljs-number"><span class="hljs-number">6</span></span> +<span class="hljs-number"><span class="hljs-number">193</span></span>,<span class="hljs-number"><span class="hljs-number">9</span></span> @@ BuildDir() cd ${ProjBinRoot}/build.${DirName} + pvs-studio-analyzer analyze --cfg /src/PVS-Studio.cfg \ + -o ./service-fabric-pvs.<span class="hljs-built_in"><span class="hljs-built_in">log</span></span> -j4 + <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ <span class="hljs-string"><span class="hljs-string">"false"</span></span> = ${SkipBuild} ]; <span class="hljs-function"><span class="hljs-function">then </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(( $NumProc &lt;= </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ))</span></span></span></span>; then NumProc=$(($(getconf _NPROCESSORS_ONLN)+<span class="hljs-number"><span class="hljs-number">0</span></span>))</code> </pre> <br>  Perbedaan antara proyek LibrePCB adalah bahwa mereka segera menyediakan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Dockerfile</a> untuk membangun gambar dan proyek di dalamnya.  Ternyata menjadi lebih nyaman bagi kami.  Inilah bagian dari file Docker yang kami minati: <br><br><pre> <code class="cpp hljs">FROM ubuntu:<span class="hljs-number"><span class="hljs-number">14.04</span></span> <span class="hljs-meta"><span class="hljs-meta"># install packages RUN DEBIAN_FRONTEND=noninteractive \ apt-get -q update \ &amp;&amp; apt-get -qy upgrade \ &amp;&amp; apt-get -qy install git g++ qt5-default qttools5-dev-tools qt5-doc \ qtcreator libglu1-mesa-dev dia \ &amp;&amp; apt-get clean # checkout librepcb RUN git clone --recursive https:</span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//..../LibrePCB.git /opt/LibrePCB \ &amp;&amp; cd /opt/LibrePCB .... # build and install librepcb RUN /opt/LibrePCB/dev/docker/make_librepcb.sh ....</span></span></span></span></code> </pre> <br>  Kami tidak akan melakukan kompilasi dan instalasi proyek ketika merakit gambar.  Dengan demikian, kami mengumpulkan gambar di mana penulis proyek menjamin keberhasilan perakitan proyek. <br><br>  Setelah memulai wadah, penganalisis diinstal dan perintah berikut dijalankan untuk membangun dan menganalisis proyek: <br><br><pre> <code class="cpp hljs">cd /opt/LibrePCB mkdir build &amp;&amp; cd build qmake -r ../librepcb.pro pvs-studio-analyzer trace -- make -j2 pvs-studio-analyzer analyze -l /mnt/Share/PVS-Studio.lic -r /opt/LibrePCB \ -o /opt/LibrePCB/LibrePCB.<span class="hljs-built_in"><span class="hljs-built_in">log</span></span> -v -j4 cp -R -L -a /opt/LibrePCB /mnt/Share</code> </pre> <br>  Omong-omong, semua tindakan dilakukan di Windows 10. Sangat menyenangkan bahwa pengembang semua sistem operasi populer juga berkembang ke arah ini.  Sayangnya, wadah dengan Windows tidak begitu nyaman.  Terutama karena ketidakmungkinan untuk menginstal perangkat lunak dengan mudah. <br><br><h2>  Ditemukan bug </h2><br>  Sekarang bagian klasik yang berisi deskripsi kesalahan yang kami temukan menggunakan penganalisis kode statis PVS-Studio.  Ngomong-ngomong, dengan mengambil kesempatan ini, saya ingin mengingatkan Anda bahwa baru-baru ini kami sedang mengembangkan alat analisis ke arah analisis kode pendukung untuk sistem tertanam.  Berikut adalah beberapa artikel yang mungkin dilewati oleh beberapa pembaca kami: <br><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">PVS-Studio mencakup dukungan untuk GNU Arm Embedded Toolchain</a> ; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">PVS-Studio: dukungan untuk standar pengkodean MISRA C dan MISRA C ++</a> . </li></ol><br><h3>  Salah ketik </h3><br><pre> <code class="cpp hljs">SymbolPreviewGraphicsItem::SymbolPreviewGraphicsItem( <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> IF_GraphicsLayerProvider&amp; layerProvider, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> QStringList&amp; localeOrder, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Symbol&amp; symbol, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Component* cmp, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> tl::optional&lt;Uuid&gt;&amp; symbVarUuid, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> tl::optional&lt;Uuid&gt;&amp; symbVarItemUuid) <span class="hljs-keyword"><span class="hljs-keyword">noexcept</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mComponent &amp;&amp; symbVarUuid &amp;&amp; symbVarItemUuid) .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mComponent &amp;&amp; symbVarItemUuid &amp;&amp; symbVarItemUuid) <span class="hljs-comment"><span class="hljs-comment">// &lt;= .... }</span></span></code> </pre> <br>  Peringatan PVS-Studio: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V501</a> CWE-571 Ada sub-ekspresi identik 'symbVarItemUuid' di sebelah kiri dan di sebelah kanan operator '&amp;&amp;'.  symbolpreviewgraphicsitem.cpp 74 <br><br>  Kesalahan ketik <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">klasik</a> : <i>symbVarItemUuid</i> variabel diperiksa dua kali berturut-turut.  Ada pemeriksaan serupa di atas, dan melihatnya, menjadi jelas bahwa variabel kedua yang akan diperiksa harus <i>symbVarUuid</i> . <br><br>  Cuplikan kode ketik berikut: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Clipper::DoMaxima(TEdge *e) { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (e-&gt;OutIdx &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) { AddOutPt(e, e-&gt;Top); e-&gt;OutIdx = Unassigned; } DeleteFromAEL(e); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (eMaxPair-&gt;OutIdx &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) { AddOutPt(eMaxPair, e-&gt;Top); <span class="hljs-comment"><span class="hljs-comment">// &lt;= eMaxPair-&gt;OutIdx = Unassigned; } DeleteFromAEL(eMaxPair); .... }</span></span></code> </pre> <br>  Peringatan PVS-Studio: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V778</a> CWE-682 <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Ditemukan</a> dua fragmen kode yang serupa.  Mungkin, ini adalah kesalahan ketik dan variabel 'eMaxPair' harus digunakan alih-alih 'e'.  clipper.cpp 2999 <br><br>  Kemungkinan besar, kode itu ditulis menggunakan Copy-Paste.  Karena kesalahan pada blok teks kedua, mereka lupa untuk mengganti <i>e-&gt; Top</i> dengan <i>eMaxPair-&gt; Top</i> . <br><br><h3>  Pemeriksaan ekstra </h3><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rndr_emphasis</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(hoedown_buffer *ob, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> hoedown_buffer *content, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> hoedown_renderer_data *data)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!content || !content-&gt;size) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; HOEDOWN_BUFPUTSL(ob, <span class="hljs-string"><span class="hljs-string">"&lt;em&gt;"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (content) hoedown_buffer_put(ob, content-&gt;data, content-&gt;size); HOEDOWN_BUFPUTSL(ob, <span class="hljs-string"><span class="hljs-string">"&lt;/em&gt;"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>; }</code> </pre> <br>  Peringatan PVS-Studio: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V547</a> CWE-571 'Konten' ekspresi selalu benar.  html.c 162 <br><br>  Ini mungkin masih bukan kesalahan, tetapi hanya kode yang berlebihan.  Tidak perlu memeriksa ulang pointer <i>konten</i> .  Jika nol, maka fungsi segera menyelesaikan pekerjaannya. <br><br>  Situasi serupa: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Clipper::DoMaxima(TEdge *e) { .... <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( e-&gt;OutIdx &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; eMaxPair-&gt;OutIdx &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span> ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (e-&gt;OutIdx &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) AddLocalMaxPoly(e, eMaxPair, e-&gt;Top); DeleteFromAEL(e); DeleteFromAEL(eMaxPair); } .... }</code> </pre> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Peringatan</a> PVS-Studio: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V547</a> CWE-571 Ekspresi 'e-&gt; OutIdx&gt; = 0' selalu benar.  clipper.cpp 2983 <br><br>  <i>Memeriksa ulang (e-&gt; OutIdx&gt; = 0)</i> tidak masuk akal.  Namun, mungkin ini kesalahan.  Sebagai contoh, kita dapat mengasumsikan bahwa variabel <i>e-&gt; Top</i> harus diperiksa.  Namun, ini hanya dugaan.  Kami tidak terbiasa dengan kode proyek dan tidak dapat membedakan kesalahan dari kode redundan :). <br><br>  Dan kasus lain: <br><br><pre> <code class="cpp hljs">QString SExpression::toString(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> indent) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (child.isLineBreak() &amp;&amp; nextChildIsLineBreak) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (child.isLineBreak() &amp;&amp; (i &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) &amp;&amp; mChildren.at(i - <span class="hljs-number"><span class="hljs-number">1</span></span>).isLineBreak()) { <span class="hljs-comment"><span class="hljs-comment">// too many line breaks ;) } else { str += '\n'; } } .... }</span></span></code> </pre> <br>  Peringatan PVS-Studio: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V571</a> CWE-571 Pemeriksaan berulang.  Kondisi 'child.isLineBreak ()' sudah diverifikasi di baris 208. sexpression.cpp 209 <br><br><h3>  Kesalahan dalam logika </h3><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> FootprintPreviewGraphicsItem::paint(....) <span class="hljs-keyword"><span class="hljs-keyword">noexcept</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Circle&amp; circle : mFootprint.getCircles()) { layer = mLayerProvider.getLayer(*circle.getLayerName()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!layer) <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; <span class="hljs-comment"><span class="hljs-comment">// &lt;= if (layer) { // &lt;= pen = QPen(....); painter-&gt;setPen(pen); } else painter-&gt;setPen(Qt::NoPen); .... } .... }</span></span></code> </pre> <br>  Peringatan PVS-Studio: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V547</a> CWE-571 Ekspresi 'lapisan' selalu benar.  footprintpreviewgraphicsitem.cpp 177 <br><br>  Karena kondisi di kedua <i>jika pernyataan</i> selalu benar, cabang <i>lain</i> tidak pernah puas. <br><br><h3>  Periksa pointer yang terlupakan </h3><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">extern</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> ZEXPORT </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">unzGetGlobalComment</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( unzFile file, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> * szComment, uLong uSizeBuf)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (uReadThis&gt;<span class="hljs-number"><span class="hljs-number">0</span></span>) { *szComment=<span class="hljs-string"><span class="hljs-string">'\0'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ZREAD64(s-&gt;z_filefunc,s-&gt;filestream,szComment,uReadThis)!=uReadThis) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> UNZ_ERRNO; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((szComment != <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) &amp;&amp; (uSizeBuf &gt; s-&gt;gi.size_comment)) *(szComment+s-&gt;gi.size_comment)=<span class="hljs-string"><span class="hljs-string">'\0'</span></span>; .... }</code> </pre> <br>  Peringatan PVS-Studio: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V595</a> CWE-476 Pointer 'szComment' digunakan sebelum diverifikasi terhadap nullptr.  Periksa baris: 2068, 2073. unzip.c 2068 <br><br>  Jika <i>uReadThis&gt; 0</i> , maka pointer <i>szComment</i> mengalami <i>penurunan</i> nilai.  Ini berbahaya karena pointer ini mungkin nol.  Penganalisa membuat kesimpulan berdasarkan fakta bahwa lebih lanjut pointer ini diperiksa untuk <i>NULL</i> kesetaraan. <br><br><h3>  Anggota kelas yang tidak diinisialisasi </h3><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Edge</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> VertexType = Vector2&lt;T&gt;; Edge(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> VertexType &amp;p1, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> VertexType &amp;p2, T w=<span class="hljs-number"><span class="hljs-number">-1</span></span>) : p1(p1), p2(p2), weight(w) {}; <span class="hljs-comment"><span class="hljs-comment">// &lt;= Edge(const Edge &amp;e) : p1(e.p1), p2(e.p2), weight(e.weight), isBad(false) {}; Edge() : p1(0,0), p2(0,0), weight(0), isBad(false) {} VertexType p1; VertexType p2; T weight=0; bool isBad; };</span></span></code> </pre> <br>  Peringatan PVS-Studio: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V730</a> CWE-457 Tidak semua anggota kelas diinisialisasi di dalam konstruktor.  Pertimbangkan untuk memeriksa: isBad.  edge.h 14 <br><br>  Semua konstruktor, kecuali yang pertama, menginisialisasi bidang kelas <i>isBad</i> .  Kemungkinan besar, konstruktor pertama secara tidak sengaja lupa melakukan inisialisasi ini.  Akibatnya, konstruktor pertama membuat objek diinisialisasi tidak lengkap, yang dapat menyebabkan perilaku program yang tidak ditentukan. <br><br>  Ada 11 <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">pemicu</a> diagnostik <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V730</a> lainnya.  Namun, karena kita tidak terbiasa dengan kode, sulit untuk mengatakan apakah peringatan ini menunjukkan masalah nyata.  Saya pikir peringatan ini paling baik dipelajari oleh penulis proyek. <br><br><h3>  Kebocoran memori </h3><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> ElementType&gt; <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> ProjectLibrary::loadElements(....) { .... ElementType* element = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ElementType(elementDir, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); <span class="hljs-comment"><span class="hljs-comment">// can throw if (elementList.contains(element-&gt;getUuid())) { throw RuntimeError( __FILE__, __LINE__, QString(tr("There are multiple library elements with the same " "UUID in the directory \"%1\"")) .arg(subdirPath.toNative())); } .... }</span></span></code> </pre> <br>  Peringatan PVS-Studio: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V773</a> CWE-401 Pengecualian dilemparkan tanpa melepaskan penunjuk 'elemen'.  Kebocoran memori dimungkinkan.  projectlibrary.cpp 245 <br><br>  Jika elemen sudah ada dalam daftar, pengecualian akan dilempar.  Tapi ini tidak menghancurkan objek yang dibuat sebelumnya, penunjuk yang disimpan dalam variabel <i>elemen</i> . <br><br><h3>  Jenis pengecualian tidak valid </h3><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> CmdRemoveSelectedSchematicItems::performExecute() { .... <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LogicError(__FILE__, __LINE__); .... }</code> </pre> <br>  Peringatan PVS-Studio: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V1022</a> CWE-755 Pengecualian dilemparkan oleh pointer.  Pertimbangkan untuk melemparkannya dengan nilai saja.  cmdremoveselectedschematicitems.cpp 143 <br><br>  Penganalisa mendeteksi pengecualian yang dilemparkan oleh pointer.  Paling sering adalah kebiasaan untuk melempar pengecualian dengan nilai, dan menangkap dengan referensi.  Melempar pointer dapat menyebabkan pengecualian tidak ditangkap, karena akan ditangkap oleh referensi.  Juga, menggunakan pointer memaksa pencegat untuk memanggil operator <i>hapus</i> untuk menghancurkan objek yang dibuat sehingga kebocoran memori tidak terjadi. <br><br>  Secara umum, operator <i>baru</i> ditulis di sini secara tidak sengaja dan harus dihapus.  Bahwa ini adalah kesalahan dikonfirmasi oleh fakta bahwa di semua tempat lain dikatakan: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> LogicError(__FILE__, __LINE__);</code> </pre> <br><h3>  Penggunaan dynamic_cast berbahaya </h3><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> GraphicsView::handleMouseWheelEvent( QGraphicsSceneWheelEvent* event) <span class="hljs-keyword"><span class="hljs-keyword">noexcept</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (event-&gt;modifiers().testFlag(Qt::ShiftModifier)) .... } <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> GraphicsView::eventFilter(QObject* obj, QEvent* event) { .... handleMouseWheelEvent(<span class="hljs-keyword"><span class="hljs-keyword">dynamic_cast</span></span>&lt;QGraphicsSceneWheelEvent*&gt;(event)); .... }</code> </pre> <br>  Peringatan PVS-Studio: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V522</a> CWE-628 Dereferencing dari 'pointer' null pointer mungkin terjadi.  Pointer null potensial dilewatkan ke fungsi 'handleMouseWheelEvent'.  Periksa argumen pertama.  Periksa baris: 143, 252. graphicsview.cpp 143 <br><br>  Pointer yang dihasilkan dari operator <i>dynamic_cast</i> dilewatkan ke fungsi <i>handleMouseWheelEvent</i> .  Di dalamnya, penunjuk ini dereferensi tanpa verifikasi sebelumnya. <br><br>  Ini berbahaya karena operator <i>dynamic_cast</i> dapat mengembalikan <i>nullptr</i> .  Ternyata kode ini tidak lebih baik daripada hanya menggunakan <i>static_cast yang</i> lebih cepat. <br><br>  Pemeriksaan penunjuk eksplisit harus ditambahkan ke kode ini sebelum digunakan. <br><br>  Juga, kode semacam ini sangat umum: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> GraphicsView::eventFilter(QObject* obj, QEvent* event) { .... QGraphicsSceneMouseEvent* e = <span class="hljs-keyword"><span class="hljs-keyword">dynamic_cast</span></span>&lt;QGraphicsSceneMouseEvent*&gt;(event); Q_ASSERT(e); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (e-&gt;button() == Qt::MiddleButton) .... }</code> </pre> <br>  Peringatan PVS-Studio: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V522</a> CWE-690 Mungkin ada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">referensi negatif</a> tentang penunjuk nol potensial 'e'.  graphicsview.cpp 206 <br><br>  Pointer diperiksa menggunakan makro <i>Q_ASSERT</i> .  Berikut ini uraiannya: <br><table><tbody><tr><td>  Mencetak pesan peringatan yang berisi nama file kode sumber dan nomor baris jika pengujian salah. <br><br>  Q_ASSERT () berguna untuk menguji pra dan pasca kondisi selama pengembangan.  Tidak ada artinya jika QT_NO_DEBUG ditentukan saat kompilasi. <br></td></tr></tbody></table><br>  <i>Q_ASSERT adalah</i> cara yang buruk untuk memeriksa pointer sebelum digunakan.  Sebagai aturan, dalam versi Rilis <i>QT_NO_DEBUG</i> tidak ditentukan.  Saya tidak tahu bagaimana keadaan di proyek LibrePCB.  Namun, jika <i>QT_NO_DEBUG</i> didefinisikan dalam Rilis, maka ini adalah solusi yang aneh dan tidak standar. <br><br>  Jika makro berkembang menjadi void, ternyata tidak ada verifikasi.  Dan kemudian tidak jelas mengapa menggunakan <i>dynamic_cast</i> sama sekali.  Mengapa tidak menggunakan <i>static_cast</i> ? <br><br>  Secara umum, kode ini tidak berbau dan layak ditinjau dari semua fragmen kode yang serupa.  Dan ada banyak dari mereka.  <b>Saya menghitung 82 kasus serupa!</b> <br><br><h2>  Kesimpulan </h2><br>  Secara umum, proyek LibrePCB menurut kami berkualitas tinggi.  Namun demikian, kami merekomendasikan bahwa penulis proyek mempersenjatai diri dengan alat PVS-Studio dan secara independen melakukan Peninjauan Kode pada bagian kode yang ditunjukkan oleh penganalisa.  Kami siap memberi mereka lisensi gratis selama sebulan untuk analisis penuh proyek.  Selain itu, mereka dapat menggunakan opsi lisensi penganalisis gratis, karena kode proyek terbuka dan diposting di situs web GitHub.  Kami akan segera menulis tentang opsi lisensi ini. <br><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><img src="https://habrastorage.org/webt/ts/z9/km/tsz9kmyjtteajhd4x1au60rsrvq.png" align="left"></a> </p><br><br>  Jika Anda ingin berbagi artikel ini dengan audiens yang berbahasa Inggris, silakan gunakan tautan ke terjemahan: Andrey Karpov, Svyatoslav Razmyslov.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Memeriksa LibrePCB dengan PVS-Studio Inside a Docker Container</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id433562/">https://habr.com/ru/post/id433562/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id433552/index.html">Kerentanan Blockchain EOS di ZeroNights 2018</a></li>
<li><a href="../id433554/index.html">Kami memperbaiki kesalahan ketik dalam permintaan pencarian</a></li>
<li><a href="../id433556/index.html">The Economist: Bagaimana Perusahaan Investasi Swasta 0,001% dari Orang Terkaya di Dunia Mengubah Sektor Keuangan Dunia</a></li>
<li><a href="../id433558/index.html">TeamCity 2018.2: dukungan untuk GitHub Pull Requests, server sekunder, pemasangan plugins dari repositori, screenshot dalam tes</a></li>
<li><a href="../id433560/index.html">Memperoleh izin kerja di Republik Ceko: berganti majikan jika kartu kerja ganda</a></li>
<li><a href="../id433564/index.html">Perilaku Prediktif UI Web</a></li>
<li><a href="../id433566/index.html">Pelajari Taktik Adversarial, Teknik & Pengetahuan Umum (ATT @ CK). Taktik Perusahaan. Bagian 6</a></li>
<li><a href="../id433568/index.html">Bagaimana Amerika Melawan Pencuri Bingkisan</a></li>
<li><a href="../id433570/index.html">Rahasia ritual "pemanasan" atau mengapa headphone "hangat" terdengar "lebih baik"</a></li>
<li><a href="../id433572/index.html">Memperkenalkan Pengujian dengan Python. Bagian 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>