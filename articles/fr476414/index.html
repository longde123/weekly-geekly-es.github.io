<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üòΩ üïâÔ∏è üß¢ Identifier l'activit√© du disque Linux üç£ üîí üî¶</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="TL; DR : l'article parle d'un moyen pratique, rapide et fiable d'identifier les programmes bas√©s sur Linux qui √©crivent des donn√©es sur le disque, ce ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Identifier l'activit√© du disque Linux</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/476414/">  <b>TL; DR</b> : l'article parle d'un moyen pratique, rapide et fiable d'identifier les programmes bas√©s sur Linux qui √©crivent des donn√©es sur le disque, ce qui permet d'identifier une charge importante ou anormalement fr√©quente sur le sous-syst√®me de disque, et vous permet √©galement d'estimer la surcharge du syst√®me de fichiers.  Cela est particuli√®rement vrai pour les SSD sur PC, EMMC et la m√©moire Flash sur les ordinateurs √† carte unique. <br>  Lors de la r√©daction de l'article, il a √©t√© constat√© que l'√©criture de plusieurs kilo-octets de donn√©es dans le syst√®me de fichiers BTRFS entra√Ænait l'√©criture de 3 m√©gaoctets de donn√©es r√©elles sur le disque. <br><br><h3>  Pr√©sentation </h3> "Oh, non-sens, les cellules de m√©moire sur les SSD modernes cesseront de fonctionner apr√®s des dizaines d'ann√©es d'utilisation normale, ne vous inqui√©tez pas √† ce sujet, et plus encore transf√©rez le swap, les machines virtuelles et le dossier de profil du navigateur vers le disque dur" - une r√©ponse typique √† la question sur la fiabilit√© des SSD avec garantie ‚âà150 <abbr title="Le nombre de t√©raoctets enregistr√©s au-dessus desquels la garantie est perdue, m√™me si le disque ne quitte pas la p√©riode de garantie dans le temps.">TBW</abbr> .  Si vous estimez combien de logiciels typiques peuvent √©crire des donn√©es, il semble que 10 √† 20 Go par jour soit d√©j√† un chiffre important, qu'il y ait un maximum de 40 Go, bien plus.  Avec de tels nombres, la r√©ponse est tout √† fait raisonnable - il faut 10 ans pour atteindre des valeurs <i>garanties</i> pour le nombre de cellules d'√©crasement, avec 40 Go de donn√©es enregistr√©es quotidiennement. <br>  Cependant, depuis 6 ans, j'utilise le troisi√®me SSD: le premier avait un contr√¥leur hors service, et le second a commenc√© √† d√©placer les donn√©es entre les cellules plusieurs fois par jour, ce qui a entra√Æn√© un retard de 30 secondes dans l'enregistrement de la maintenance. <br><br>  Apr√®s 7 mois d'utilisation du nouveau SSD, j'ai d√©cid√© de v√©rifier la quantit√© de donn√©es enregistr√©es, comme le disque lui-m√™me le signale via SMART. <br>  <b>19,7 To.</b> <br>  En seulement 7 mois, j'ai utilis√© 13% de la quantit√© garantie de donn√©es enregistr√©es, malgr√© le fait qu'elle soit configur√©e conform√©ment aux recommandations d'alignement des partitions et de configuration du FS, je n'utilise presque pas de swap, les disques des machines virtuelles sont situ√©s sur le disque dur! <a name="habracut"></a><br>  Il s'agit d'un chiffre anormalement √©lev√©; √† un tel rythme, la garantie TBW sera d√©pass√©e avant que la p√©riode de garantie de 5 ans du lecteur ne soit atteinte.  Et mon ordinateur ne peut pas √©crire 93 gigaoctets par jour!  Vous devez v√©rifier la quantit√© de donn√©es √©crites sur le disque en 10 minutes ... <blockquote><code>Total: <br> Writes Queued: 24,712, 2,237MiB <br> <b>Writes Completed: 25,507, 2,237MiB</b> <br> Write Merges: 58, 5,472KiB</code> </blockquote>  2,2 Gio, wow! <br><br><h3>  D√©termination de la quantit√© de donn√©es √©crites sur un p√©riph√©rique de disque </h3>  Si votre appareil prend en charge <abbr title="de l'anglais technologie d'autosurveillance, d'analyse et de rapport">SMART</abbr> (SSD, EMMC, certains MicroSD industriels), la premi√®re chose √† faire est de demander des donn√©es au lecteur √† l' <code>smartctl</code> , <code>skdump</code> ou <code>mmc</code> (√† partir de mmc-utils). <br><br><div class="spoiler">  <b class="spoiler_title">Exemple de sortie Smartctl</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">$ sudo smartctl -a /dev/sdb smartctl 7.0 2019-03-31 r4903 [x86_64-linux-5.3.11-200.fc30.x86_64] (local build) Copyright (C) 2002-18, Bruce Allen, Christian Franke, www.smartmontools.org === START OF INFORMATION SECTION === Model Family: Samsung based SSDs Device Model: Samsung SSD 860 EVO mSATA 250GB Serial Number: S41MNC0KA13477K LU WWN Device Id: 5 002538 e700fa64b Firmware Version: RVT41B6Q User Capacity: 250 059 350 016 bytes [250 GB] Sector Size: 512 bytes logical/physical Rotation Rate: Solid State Device Form Factor: mSATA Device is: In smartctl database [for details use: -P show] ATA Version is: ACS-4 T13/BSR INCITS 529 revision 5 SATA Version is: SATA 3.1, 6.0 Gb/s (current: 3.0 Gb/s) Local Time is: Tue Nov 19 01:48:50 2019 MSK SMART support is: Available - device has SMART capability. SMART support is: Enabled === START OF READ SMART DATA SECTION === SMART overall-health self-assessment test result: PASSED General SMART Values: Offline data collection status: (0x00) Offline data collection activity was never started. Auto Offline Data Collection: Disabled. Self-test execution status: ( 0) The previous self-test routine completed without error or no self-test has ever been run. Total time to complete Offline data collection: ( 0) seconds. Offline data collection capabilities: (0x53) SMART execute Offline immediate. Auto Offline data collection on/off support. Suspend Offline collection upon new command. No Offline surface scan supported. Self-test supported. No Conveyance Self-test supported. Selective Self-test supported. SMART capabilities: (0x0003) Saves SMART data before entering power-saving mode. Supports SMART auto save timer. Error logging capability: (0x01) Error logging supported. General Purpose Logging supported. Short self-test routine recommended polling time: ( 2) minutes. Extended self-test routine recommended polling time: ( 85) minutes. SCT capabilities: (0x003d) SCT Status supported. SCT Error Recovery Control supported. SCT Feature Control supported. SCT Data Table supported. SMART Attributes Data Structure revision number: 1 Vendor Specific SMART Attributes with Thresholds: ID# ATTRIBUTE_NAME FLAG VALUE WORST THRESH TYPE UPDATED WHEN_FAILED RAW_VALUE 5 Reallocated_Sector_Ct 0x0033 100 100 010 Pre-fail Always - 0 9 Power_On_Hours 0x0032 098 098 000 Old_age Always - 5171 12 Power_Cycle_Count 0x0032 099 099 000 Old_age Always - 459 177 Wear_Leveling_Count 0x0013 096 096 000 Pre-fail Always - 62 179 Used_Rsvd_Blk_Cnt_Tot 0x0013 100 100 010 Pre-fail Always - 0 181 Program_Fail_Cnt_Total 0x0032 100 100 010 Old_age Always - 0 182 Erase_Fail_Count_Total 0x0032 100 100 010 Old_age Always - 0 183 Runtime_Bad_Block 0x0013 100 100 010 Pre-fail Always - 0 187 Uncorrectable_Error_Cnt 0x0032 100 100 000 Old_age Always - 0 190 Airflow_Temperature_Cel 0x0032 058 039 000 Old_age Always - 42 195 ECC_Error_Rate 0x001a 200 200 000 Old_age Always - 0 199 CRC_Error_Count 0x003e 100 100 000 Old_age Always - 0 235 POR_Recovery_Count 0x0012 099 099 000 Old_age Always - 29 241 Total_LBAs_Written 0x0032 099 099 000 Old_age Always - 38615215765 SMART Error Log Version: 1 No Errors Logged SMART Self-test log structure revision number 1 No self-tests have been logged. [To run self-tests, use: smartctl -t] SMART Selective self-test log data structure revision number 1 SPAN MIN_LBA MAX_LBA CURRENT_TEST_STATUS 1 0 0 Not_testing 2 0 0 Not_testing 3 0 0 Not_testing 4 0 0 Not_testing 5 0 0 Not_testing Selective self-test flags (0x0): After scanning selected spans, do NOT read-scan remainder of disk. If Selective self-test is pending on power-up, resume after 0 minute delay.</code> </pre> </div></div><br>  Mon SSD stocke la quantit√© de donn√©es √©crites dans le param√®tre 241 Total_LBAs_Written, en unit√©s logiques (LBA) et non en octets.  La taille du bloc logique dans mon cas est de 512 octets (on peut le voir dans la sortie de smartctl, dans Sector Size).  Pour obtenir des octets, vous devez multiplier la valeur du param√®tre par 512. <br><pre> <code class="plaintext hljs">38615215765 √ó 512 √∑ 1000 √∑ 1000 √∑ 1000 √∑ 1000 = 19,770  38615215765 √ó 512 √∑ 1024 √∑ 1024 √∑ 1024 √∑ 1024 = 17,981 </code> </pre> <br><br>  Le programme <code>skdump</code> sur mon SSD essaie d'interpr√©ter la valeur de Total_LBAs_Written d'une mani√®re ou d'une autre √† sa mani√®re, √† cause de laquelle il <code>1296217.695 TB</code> , ce qui est √©videmment incorrect. <br><br>  Pour conna√Ætre la quantit√© d'informations enregistr√©es au niveau de l'appareil, nous utiliserons le programme <code>blktrace</code> paquet <code>blktrace</code> .  Il affiche √† la fois les statistiques g√©n√©rales pour toute la dur√©e du programme et les processus et threads individuels (y compris les noyaux) qui ont effectu√© l'enregistrement. <br><br>  Ex√©cutez la commande suivante pour collecter des informations en 10 minutes, o√π / dev / sdb est votre disque: <br><pre> <code class="plaintext hljs"># btrace -w 600 -a write /dev/sdb</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Sortie de commande typique</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">‚Ä¶ 8,16 0 3253 50.085433192 0 C WS 125424240 + 64 [0] 8,16 0 3254 50.085550024 0 C WS 193577744 + 64 [0] 8,16 0 3255 50.085685165 0 C WS 197246976 + 64 [0] 8,16 0 3256 50.085936852 0 C WS 125736264 + 128 [0] 8,16 0 3257 50.086060780 0 C WS 96261752 + 64 [0] 8,16 0 3258 50.086195031 0 C WS 94948640 + 64 [0] 8,16 0 3259 50.086327355 0 C WS 124656144 + 64 [0] 8,16 0 3260 50.086843733 15368 C WSM 310218496 + 32 [0] 8,16 0 3261 50.086975238 753 A WSM 310218368 + 32 &lt;- (8,20) 291339904 8,16 0 3262 50.086975560 753 Q WSM 310218368 + 32 [dmcrypt_write/2] 8,16 0 3263 50.086977345 753 G WSM 310218368 + 32 [dmcrypt_write/2] 8,16 0 3264 50.086978072 753 I WSM 310218368 + 32 [dmcrypt_write/2] 8,16 0 3265 50.086979159 753 D WSM 310218368 + 32 [dmcrypt_write/2] 8,16 0 3266 50.087055685 0 C WSM 310218368 + 32 [0] 8,16 0 3267 50.087060168 753 A WSM 310218592 + 160 &lt;- (8,20) 291340128 8,16 0 3268 50.087060367 753 Q WSM 310218592 + 160 [dmcrypt_write/2] 8,16 0 3269 50.087061242 753 G WSM 310218592 + 160 [dmcrypt_write/2] 8,16 0 3270 50.087061698 753 I WSM 310218592 + 160 [dmcrypt_write/2] 8,16 0 3271 50.087062361 753 D WSM 310218592 + 160 [dmcrypt_write/2] 8,16 0 3272 50.087386179 0 C WSM 310218592 + 160 [0] 8,16 0 3273 50.087436417 15368 A FWS 0 + 0 &lt;- (253,1) 0 8,16 0 3274 50.087437471 15368 Q FWS [LS Thread] 8,16 0 3275 50.087440862 15368 G FWS [LS Thread] 8,16 0 3276 50.088300047 0 C WS 0 [0] 8,16 0 3277 50.088470917 753 A WFSM 18882688 + 8 &lt;- (8,20) 4224 8,16 0 3278 50.088471091 753 Q WFSM 18882688 + 8 [dmcrypt_write/2] 8,16 0 3279 50.088471688 753 G WFSM 18882688 + 8 [dmcrypt_write/2] 8,16 0 3280 50.088474334 32254 D WSM 18882688 + 8 [kworker/0:2H] 8,16 0 3281 50.088515572 0 C WSM 18882688 + 8 [0] 8,16 0 3282 50.089229069 0 C WSM 18882688 [0] CPU0 (8,16): Reads Queued: 0, 0KiB Writes Queued: 345, 25,932KiB Read Dispatches: 0, 0KiB Write Dispatches: 331, 25,788KiB Reads Requeued: 0 Writes Requeued: 0 Reads Completed: 0, 0KiB Writes Completed: 1,597, 117,112KiB Read Merges: 0, 0KiB Write Merges: 1, 16KiB Read depth: 0 Write depth: 177 IO unplugs: 0 Timer unplugs: 0 CPU1 (8,16): Reads Queued: 0, 0KiB Writes Queued: 502, 39,948KiB Read Dispatches: 0, 0KiB Write Dispatches: 495, 40,076KiB Reads Requeued: 0 Writes Requeued: 0 Reads Completed: 0, 0KiB Writes Completed: 0, 0KiB Read Merges: 0, 0KiB Write Merges: 0, 0KiB Read depth: 0 Write depth: 177 IO unplugs: 0 Timer unplugs: 0 CPU2 (8,16): Reads Queued: 0, 0KiB Writes Queued: 297, 26,800KiB Read Dispatches: 0, 0KiB Write Dispatches: 287, 26,800KiB Reads Requeued: 0 Writes Requeued: 0 Reads Completed: 0, 0KiB Writes Completed: 0, 0KiB Read Merges: 0, 0KiB Write Merges: 0, 0KiB Read depth: 0 Write depth: 177 IO unplugs: 0 Timer unplugs: 0 CPU3 (8,16): Reads Queued: 0, 0KiB Writes Queued: 418, 24,432KiB Read Dispatches: 0, 0KiB Write Dispatches: 408, 24,448KiB Reads Requeued: 0 Writes Requeued: 0 Reads Completed: 0, 0KiB Writes Completed: 0, 0KiB Read Merges: 0, 0KiB Write Merges: 2, 272KiB Read depth: 0 Write depth: 177 IO unplugs: 0 Timer unplugs: 0 Total (8,16): Reads Queued: 0, 0KiB Writes Queued: 1,562, 117,112KiB Read Dispatches: 0, 0KiB Write Dispatches: 1,521, 117,112KiB Reads Requeued: 0 Writes Requeued: 0 Reads Completed: 0, 0KiB Writes Completed: 1,597, 117,112KiB Read Merges: 0, 0KiB Write Merges: 3, 288KiB IO unplugs: 0 Timer unplugs: 0 Throughput (R/W): 0KiB/s / 2,338KiB/s Events (8,16): 9,287 entries Skips: 0 forward (0 - 0.0%)</code> </pre> </div></div><br>  <code>btrace</code> permet de voir visuellement la quantit√© r√©elle de donn√©es enregistr√©es, mais il est difficile de comprendre quels programmes enregistrent. <br><br><h3>  D√©finition des programmes qui enregistrent sur le disque </h3>  <code>iotop</code> affichera les processus qui sont √©crits sur le disque et la taille des donn√©es enregistr√©es. <br>  La sortie la plus pratique est fournie par les param√®tres suivants: <br><pre> <code class="plaintext hljs"># iotop -obPat</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Exemple de sortie de programme</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">02:55:47 Total DISK READ : 0.00 B/s | Total DISK WRITE : 30.65 K/s 02:55:47 Actual DISK READ: 0.00 B/s | Actual DISK WRITE: 0.00 B/s TIME PID PRIO USER DISK READ DISK WRITE SWAPIN IO COMMAND b'02:55:47 753 be/4 root 0.00 B 0.00 B 0.00 % 0.04 % [dmcrypt_write/2]' b'02:55:47 788 be/4 root 72.00 K 18.27 M 0.00 % 0.02 % [btrfs-transacti]' b'02:55:47 15057 be/4 valdikss 216.00 K 283.05 M 0.00 % 0.01 % firefox' b'02:55:47 1588 ?dif root 0.00 B 0.00 B 0.00 % 0.00 % Xorg -nolisten tcp -auth /var/run/sddm/{398f030f-9667-4dff-b371-81eaae48dfdf} -background none -noreset -displayfd 18 -seat seat0 vt1' b'02:55:47 15692 be/4 valdikss 988.00 K 9.41 M 0.00 % 0.00 % python3 /usr/bin/gajim' b'02:55:47 15730 ?dif valdikss 9.07 M 0.00 B 0.00 % 0.00 % telegram-desktop --' b'02:55:47 2174 ?dif valdikss 1840.00 K 2.47 M 0.00 % 0.00 % yakuake' b'02:55:47 19827 be/4 root 16.00 K 896.00 K 0.00 % 0.00 % [kworker/u16:7-events_unbound]' b'02:55:47 19074 be/4 root 16.00 K 480.00 K 0.00 % 0.00 % [kworker/u16:4-btrfs-endio-write]' b'02:55:47 19006 be/4 root 16.00 K 1872.00 K 0.00 % 0.00 % [kworker/u16:1-events_unbound]' b'02:55:47 1429 be/4 root 484.00 K 0.00 B 0.00 % 0.00 % accounts-daemon' b'02:55:47 15820 be/4 valdikss 312.00 K 0.00 B 0.00 % 0.00 % firefox -contentproc -childID 6 -isForBrowser -prefsLen 7894 -prefMapSize 223880 -parentBuildID 20191022164834 -greomni /usr/lib64/firefox/omni.ja -appomni /usr/lib64/firefox/browser/omni.ja -appdir /usr/lib64/firefox/browser 15057 tab' b'02:55:47 2125 ?dif valdikss 0.00 B 92.00 K 0.00 % 0.00 % plasmashell' b'02:55:47 1268 be/3 root 0.00 B 4.00 K 0.00 % 0.00 % auditd' b'02:55:47 1414 be/4 root 0.00 B 4.00 K 0.00 % 0.00 % sssd_nss --uid 0 --gid 0 --logger=files' b'02:55:47 15238 be/4 valdikss 0.00 B 4.00 K 0.00 % 0.00 % thunderbird' b'02:55:47 18605 be/4 root 0.00 B 3.19 M 0.00 % 0.00 % [kworker/u16:0-btrfs-endio-write]' b'02:55:47 18867 be/4 root 0.00 B 96.00 K 0.00 % 0.00 % [kworker/u16:5-btrfs-endio-meta]' b'02:55:47 19070 be/4 root 0.00 B 160.00 K 0.00 % 0.00 % [kworker/u16:2-btrfs-freespace-write]' b'02:55:47 19645 be/4 root 0.00 B 2.17 M 0.00 % 0.00 % [kworker/u16:3-events_unbound]' b'02:55:47 19982 be/4 root 0.00 B 496.00 K 0.00 % 0.00 % [kworker/u16:6-btrfs-endio-write]'</code> </pre> </div></div><br><br>  Firefox attire votre attention, ayant enregistr√© 283 m√©gaoctets en quelques minutes d'iotop. <br><br><h3>  D√©finition des fichiers √† enregistrer </h3>  Les informations sur le processus qui viole le disque sont bonnes et les fa√ßons dont il est enregistr√© sont encore meilleures. <br><br>  Nous utilisons le programme <code>fatrace</code> , qui suit les modifications apport√©es au syst√®me de fichiers. <br><pre> <code class="plaintext hljs"># fatrace -f W</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Exemple de sortie de programme</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">firefox(15057): CW /home/valdikss/.mozilla/firefox/xyf4vqh2.default/storage/default/moz-extension+++e5c304fb-af40-498a-9ba8-47eb0416e933^userContextId=4294967295/idb/3647222921wleabcEoxlt-eengsairo.sqlite-wal firefox(15057): CW /home/valdikss/.mozilla/firefox/xyf4vqh2.default/storage/default/moz-extension+++e5c304fb-af40-498a-9ba8-47eb0416e933^userContextId=4294967295/idb/3647222921wleabcEoxlt-eengsairo.sqlite firefox(15057): W /home/valdikss/.mozilla/firefox/xyf4vqh2.default/storage/default/https+++habr.com/ls/data.sqlite-journal firefox(15057): W /home/valdikss/.mozilla/firefox/xyf4vqh2.default/storage/default/https+++habr.com/ls/data.sqlite-journal firefox(15057): W /home/valdikss/.mozilla/firefox/xyf4vqh2.default/storage/default/https+++habr.com/ls/data.sqlite-journal firefox(15057): W /home/valdikss/.mozilla/firefox/xyf4vqh2.default/storage/default/https+++habr.com/ls/data.sqlite-journal firefox(15057): W /home/valdikss/.mozilla/firefox/xyf4vqh2.default/storage/default/https+++habr.com/ls/data.sqlite-journal firefox(15057): W /home/valdikss/.mozilla/firefox/xyf4vqh2.default/storage/default/https+++habr.com/ls/data.sqlite-journal firefox(15057): W /home/valdikss/.mozilla/firefox/xyf4vqh2.default/storage/default/https+++habr.com/ls/data.sqlite-journal firefox(15057): CW /home/valdikss/.mozilla/firefox/xyf4vqh2.default/storage/default/https+++habr.com/ls/usage-journal firefox(15057): W /home/valdikss/.mozilla/firefox/xyf4vqh2.default/storage/default/https+++habr.com/ls/usage firefox(15057): CW /home/valdikss/.mozilla/firefox/xyf4vqh2.default/storage/default/https+++habr.com/ls/usage firefox(15057): W /home/valdikss/.mozilla/firefox/xyf4vqh2.default/storage/default/https+++habr.com/ls/data.sqlite-journal firefox(15057): W /home/valdikss/.mozilla/firefox/xyf4vqh2.default/storage/default/https+++habr.com/ls/data.sqlite firefox(15057): W /home/valdikss/.mozilla/firefox/xyf4vqh2.default/storage/default/https+++habr.com/ls/data.sqlite firefox(15057): W /home/valdikss/.mozilla/firefox/xyf4vqh2.default/storage/default/https+++habr.com/ls/data.sqlite firefox(15057): W /home/valdikss/.mozilla/firefox/xyf4vqh2.default/webappsstore.sqlite-wal firefox(15057): W /home/valdikss/.mozilla/firefox/xyf4vqh2.default/webappsstore.sqlite-wal firefox(15057): W /home/valdikss/.mozilla/firefox/xyf4vqh2.default/webappsstore.sqlite-wal firefox(15057): W /home/valdikss/.mozilla/firefox/xyf4vqh2.default/webappsstore.sqlite-wal firefox(15057): W /home/valdikss/.mozilla/firefox/xyf4vqh2.default/webappsstore.sqlite-wal firefox(15057): W /home/valdikss/.mozilla/firefox/xyf4vqh2.default/webappsstore.sqlite-wal firefox(15057): W /home/valdikss/.mozilla/firefox/xyf4vqh2.default/webappsstore.sqlite-wal firefox(15057): CW /home/valdikss/.mozilla/firefox/xyf4vqh2.default/storage/default/https+++habr.com/ls/data.sqlite-journal firefox(15057): W /home/valdikss/.mozilla/firefox/xyf4vqh2.default/webappsstore.sqlite firefox(15057): W /home/valdikss/.mozilla/firefox/xyf4vqh2.default/webappsstore.sqlite firefox(15057): W /home/valdikss/.mozilla/firefox/xyf4vqh2.default/webappsstore.sqlite</code> </pre> </div></div><br><br>  Fatrace n'est pas en mesure d'afficher la quantit√© de donn√©es enregistr√©es en raison de l'utilisation d'un suivi assez simple du fait d'acc√©der aux fichiers via inotify. <br><br>  La sortie montre comment Habr enregistre mon article dans le stockage local du navigateur pendant que je l'√©cris, ainsi que l'extension de composition abr√©g√©e de groupe, qui, comme il a √©t√© d√©couvert √† l'aide de fatrace, lit ses donn√©es toutes les 30 secondes.  Il lit, pas √©crit: le <b>CW</b> devant le fichier indique que le fichier est ouvert pour la lecture et l'√©criture, tout en cr√©ant le fichier s'il est manquant (openat est appel√© avec l'indicateur O_RDWR | O_CREAT), mais ne dit pas quel fichier a √©t√© r√©ellement √©crit toute information. <br><br>  Au cas o√π, pour nous en assurer, nous utiliserons strace, avec un filtre pour les appels du syst√®me de fichiers: <br><pre> <code class="plaintext hljs">strace -yy -e trace=open,openat,close,write -f -p 15057 2&gt;&amp;1 | grep extension</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Sortie d'√©quipe</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">[pid 20352] openat(AT_FDCWD, "/home/valdikss/.mozilla/firefox/xyf4vqh2.default/storage/default/moz-extension+++e5c304fb-af40-498a-9ba8-47eb0416e933^userContextId=4294967295/idb/3647222921wleabcEoxlt-eengsairo.sqlite", O_RDWR|O_CREAT|O_CLOEXEC, 0644) = 153&lt;/home/valdikss/.mozilla/firefox/xyf4vqh2.default/storage/default/moz-extension+++e5c304fb-af40-498a-9ba8-47eb0416e933^userContextId=4294967295/idb/3647222921wleabcEoxlt-eengsairo.sqlite&gt; [pid 20352] read(153&lt;/home/valdikss/.mozilla/firefox/xyf4vqh2.default/storage/default/moz-extension+++e5c304fb-af40-498a-9ba8-47eb0416e933^userContextId=4294967295/idb/3647222921wleabcEoxlt-eengsairo.sqlite&gt;, "SQLite format 3\0\20\0\2\2\0@ \0\0\0d\0\0\0\23"..., 100) = 100 [pid 20352] read(153&lt;/home/valdikss/.mozilla/firefox/xyf4vqh2.default/storage/default/moz-extension+++e5c304fb-af40-498a-9ba8-47eb0416e933^userContextId=4294967295/idb/3647222921wleabcEoxlt-eengsairo.sqlite&gt;, "SQLite format 3\0\20\0\2\2\0@ \0\0\0d\0\0\0\23"..., 4096) = 4096 [pid 20352] openat(AT_FDCWD, "/home/valdikss/.mozilla/firefox/xyf4vqh2.default/storage/default/moz-extension+++e5c304fb-af40-498a-9ba8-47eb0416e933^userContextId=4294967295/idb/3647222921wleabcEoxlt-eengsairo.sqlite-wal", O_RDWR|O_CREAT|O_CLOEXEC, 0644) = 166&lt;/home/valdikss/.mozilla/firefox/xyf4vqh2.default/storage/default/moz-extension+++e5c304fb-af40-498a-9ba8-47eb0416e933^userContextId=4294967295/idb/3647222921wleabcEoxlt-eengsairo.sqlite-wal&gt; ‚Ä¶ [pid 20352] read(54&lt;/home/valdikss/.mozilla/firefox/xyf4vqh2.default/storage/default/moz-extension+++e5c304fb-af40-498a-9ba8-47eb0416e933^userContextId=4294967295/idb/3647222921wleabcEoxlt-eengsairo.sqlite&gt;, "\0\0\0\r\4\30\4\36\4\35\4\35\4\36\4-\0 \4\20\4!\4'\4\1\4\"\0250 &amp;"..., 4096) = 4096 [pid 20352] read(54&lt;/home/valdikss/.mozilla/firefox/xyf4vqh2.default/storage/default/moz-extension+++e5c304fb-af40-498a-9ba8-47eb0416e933^userContextId=4294967295/idb/3647222921wleabcEoxlt-eengsairo.sqlite&gt;, "\0\0\0\0\1\36P\t\226\250\4\0O\245\320\16:\"\16.\27\0r\245\306&gt;\246\1\t\1q\370"..., 4096) = 4096 [pid 20352] close(77&lt;/home/valdikss/.mozilla/firefox/xyf4vqh2.default/storage/default/moz-extension+++e5c304fb-af40-498a-9ba8-47eb0416e933^userContextId=4294967295/idb/3647222921wleabcEoxlt-eengsairo.sqlite-wal&gt;) = 0 [pid 20352] close(54&lt;/home/valdikss/.mozilla/firefox/xyf4vqh2.default/storage/default/moz-extension+++e5c304fb-af40-498a-9ba8-47eb0416e933^userContextId=4294967295/idb/3647222921wleabcEoxlt-eengsairo.sqlite&gt;) = 0</code> </pre> </div></div><br>  Il n'y a pas un seul appel √† <code>write()</code> , ce qui indique qu'il n'y a pas d'√©criture dans le fichier. <br><br><h3>  D√©termination de la surcharge du syst√®me de fichiers </h3>  La grande diff√©rence <code>btrace</code> <code>iotop</code> et <code>btrace</code> incit√© l'id√©e de tester le syst√®me de fichiers en √©crivant manuellement les donn√©es dans un fichier et en suivant les lectures de btrace. <br><br>  Si vous excluez compl√®tement l'√©criture sur le disque en chargeant en mode d'urgence systemd et en √©crivant manuellement <b>quelques octets de</b> donn√©es dans un fichier existant, btrace sur un SSD avec <b>btrfs</b> rapporte <b>3 m√©gaoctets de</b> donn√©es r√©elles √©crites.  Le syst√®me de fichiers fra√Æchement cr√©√© d'un lecteur flash de 8 Go √©crit au moins 264 Ko lors de l'enregistrement d'un octet. <br>  √Ä titre de comparaison, l'√©criture d'une paire d'octets dans un fichier sur ext4 se termine par l'√©criture de 24 kilo-octets de donn√©es sur le disque. <br><br>  En 2017, Jayashree Mohan, Rohan Kadekodi et Vijay Chidambaram ont <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">men√© une √©tude sur l'amplification en √©criture de diff√©rents syst√®mes de fichiers</a> , leurs r√©sultats pour btrfs et ext4 lors de l'√©criture de 4 Ko sont similaires aux miens. <br><br><img src="https://habrastorage.org/webt/s2/o1/pa/s2o1parvcsurvjl5rkpiijc1fgo.png"><br><br><h3>  Conclusion et conclusion </h3>  Par les manipulations d√©crites, il a √©t√© d√©couvert: <br><ol><li>  Enregistrement fr√©quent de l'√©tat des travaux pour l'imprimante par le d√©mon d'impression CUPS dans / var / <u>cache</u> / cups toutes les minutes.  Le probl√®me a √©t√© r√©solu par le nettoyage / var / <u>spool</u> / cups (bien qu'il n'y ait pas eu de travaux d'impression); </li><li>  Le fait de lire la base de donn√©es toutes les 30 secondes par le groupe de num√©rotation abr√©g√©e pour Firefox; </li><li>  Journalisation p√©riodique par divers services de suivi des performances dans Fedora, ce qui a conduit √† l'enregistrement de plusieurs m√©gaoctets de donn√©es sur btrfs: pmcd.service, pmie.service, pmlogger.service; </li><li>  Amplification √©norme lors de l'enregistrement d'une petite quantit√© de donn√©es lors de l'utilisation de btrfs. </li></ol><br>  Conclusion: vous ne devez pas utiliser btrfs si les programmes √©crivent souvent une petite quantit√© de donn√©es (plusieurs kilo-octets), sinon cela se transformera en m√©gaoctets de donn√©es enregistr√©es.  Particuli√®rement vrai pour les ordinateurs √† carte unique avec OS sur MicroSD. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr476414/">https://habr.com/ru/post/fr476414/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr476398/index.html">Redux est comme des conteneurs d'√©tat dans SwiftUI. Les bases</a></li>
<li><a href="../fr476404/index.html">Semaine de la s√©curit√© 47: vuln√©rabilit√©s non triviales</a></li>
<li><a href="../fr476406/index.html">R√©seaux de neurones dans la datation</a></li>
<li><a href="../fr476408/index.html">Retrait de livre</a></li>
<li><a href="../fr476412/index.html">Hannes Lindemann c. Alain Bombard: d√©mystifier un mythe?</a></li>
<li><a href="../fr476416/index.html">Gestion de Windows Server √† partir du Centre d'administration Windows</a></li>
<li><a href="../fr476418/index.html">Startups: 10 plats √† emporter de 20 le√ßons √† l'Universit√© de Stanford</a></li>
<li><a href="../fr476420/index.html">Commencez √† utiliser ReactiveX dans dart et Flutter depuis le d√©but</a></li>
<li><a href="../fr476424/index.html">Cadres - plus d'inconv√©nients que d'avantages</a></li>
<li><a href="../fr476428/index.html">Statistiques Nginx VTS, Mockify - Comparaison de l'API fictive, de Wiremock et de Mockify</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>