<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©‚Äçüëß‚Äçüëß üé≤ üõÇ Hypercube. Comment nous avons fourni aux d√©veloppeurs des appareils de test et ne les avons pas perdus üí´ üéä üåø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Il est impossible de tester et de d√©boguer compl√®tement des applications mobiles sans appareils de test. Il devrait y avoir de nombreux appareils de c...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Hypercube. Comment nous avons fourni aux d√©veloppeurs des appareils de test et ne les avons pas perdus</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yandex/blog/485050/"><p>  Il est impossible de tester et de d√©boguer compl√®tement des applications mobiles sans appareils de test.  Il devrait y avoir de nombreux appareils de ce type, car le m√™me code sur diff√©rents mod√®les se comporte diff√©remment.  Mais comment organiser la comptabilit√© des appareils?  Comment faire pour que les d√©veloppeurs et les testeurs rapidement et sans formalit√©s administratives obtiennent un smartphone sp√©cifique dans la configuration n√©cessaire? </p><br><p>  Je m'appelle Alexey Lavrenyuk.  Vous pouvez me conna√Ætre comme l'un des auteurs de <a href="https://github.com/yandex/yandex-tank">Yandex.Tank</a> et un conf√©rencier sur le sujet des <a href="https://www.youtube.com/watch%3Fv%3Dgws7L3EaeC0">tests</a> de <a href="https://www.youtube.com/watch%3Fv%3Dgws7L3EaeC0">charge</a> .  J'ai ensuite mesur√© la consommation √©lectrique des t√©l√©phones portables.  Maintenant, je fais Yandex.Rover dans une √©quipe de v√©hicules sans pilote (et parfois au clair de lune comme le <a href="https://www.youtube.com/watch%3Fv%3DBZgpMC5ORW0">P√®re No√´l</a> ).  Et entre les t√©l√©phones et le Rover se trouvait Hypercube. </p><br><p>  Il y a quelques ann√©es, le responsable du d√©veloppement mobile est venu dans notre service de test de charge et s'est plaint de la situation avec les appareils de test.  Les t√©l√©phones se promenaient de main en main, choisir et trouver rapidement un t√©l√©phone √©tait un probl√®me.  Nous avions d√©j√† de l'exp√©rience avec les appareils mobiles: nous avons construit un amp√®rem√®tre num√©rique pour mesurer leur consommation d'√©nergie.  Par cons√©quent, nous avons d√©cid√© d'aider nos coll√®gues et de faire rapidement une chose cool: cela semblait fonctionner pendant seulement trois mois.  Je me moque de moi, na√Øf, √† partir de 2020 et raconte ce qui nous attendait vraiment. </p><br><img src="https://habrastorage.org/webt/-k/hz/b2/-khzb2ut0-y7ljuehz1f_8virf0.jpeg"><br><br><a name="habracut"></a><h2>  Concept de service et premi√®res id√©es </h2><br><p>  Nous √©tions l'un des rares √† Yandex √† assembler des appareils en fer.  De plus, nous connaissions le mobile.  Pour moi, l'id√©e du service √©tait apparente: vous devez connecter les t√©l√©phones au concentrateur et suivre leur disponibilit√© et leurs d√©placements dans le bureau via USB.  La conception tient dans une armoire de serveur. </p><br><p>  Voici comment j'ai imagin√© le processus: </p><br><ol><li> <b>Nous conservons les enregistrements des t√©l√©phones via USB.</b>  Tous les t√©l√©phones de l'armoire sont connect√©s via USB.  Le t√©l√©phone est en charge, et nous voyons des informations √† ce sujet, y compris l'ID de l'appareil - un identifiant unique (en fait, pour certains appareils chinois, il n'est pas toujours unique), gr√¢ce auquel vous pouvez distinguer un t√©l√©phone d'un autre.  Soit dit en passant, gr√¢ce √† l'identifiant - que n'importe quel p√©riph√©rique USB en g√©n√©ral - vous pouvez garder une trace de tout: connectez une cl√© USB standard √† vos cl√©s de voiture, par exemple, et conservez un enregistrement automatique des cl√©s. </li><li>  <b>Nous lisons les utilisateurs sur un badge.</b>  Nous identifions tous ceux qui sortent le t√©l√©phone du placard √† l'aide d'un badge (un laissez-passer permettant de reconna√Ætre n'importe quel employ√© de Yandex).  Apr√®s qu'un employ√© a ouvert l'armoire, on pense qu'il a fait tous les mouvements des t√©l√©phones dans l'armoire. </li><li>  <b>Toutes les informations de mouvement sont stock√©es de mani√®re centralis√©e dans le service.</b>  Nous voyons o√π et avec qui se trouve chaque t√©l√©phone mobile.  Nous pouvons suivre les statistiques: quels mod√®les sont les plus populaires, quels t√©l√©phones manquent. </li></ol><br><p>  Il peut y avoir de nombreuses armoires de ce type, mais les informations sur tous les appareils mobiles qu'elles contiennent se trouvent au m√™me endroit.  Tous les cubes (armoires) sont combin√©s et connect√©s logiquement, et ensemble ils forment un grand Hypercube (d'o√π le nom interne du service). </p><br><p>  Tout le monde a aim√© l'id√©e, nous avons commenc√© √† travailler. </p><br><h2>  Hypercube.  Commencer </h2><br><p>  Nous avons pris un helpdesk le lecteur RFID et mini-ordinateur Intel NUC.  Nous avons achet√© un Arduino, une serrure √©lectrique, une armoire pour les √©quipements r√©seau (elle √©tait plus petite qu'une armoire serveur, mais avec les m√™mes ¬´rails¬ª pour fixer l'√©quipement). </p><br><img width="600" src="https://habrastorage.org/webt/gf/d4/i8/gfd4i8d6nytgx9c7efxnotiiynk.jpeg"><br><br><p>  Bien s√ªr, nous n'avons pas re√ßu les savoirs traditionnels et la liste de courses.  Nous ne savions pas exactement quel mod√®le d'armoire conviendrait, combien de boulons et de m√®tres de fil sont n√©cessaires.  Les exigences pour le cabinet ont chang√© en fonction des souhaits des √©quipes.  Nous avons convenu, par exemple, que nous allons stocker 40 t√©l√©phones portables dans une armoire, et nous allons mettre l'armoire sur la table de chevet, car il est petit et peu pratique de s'y pencher. </p><br><img src="https://habrastorage.org/webt/xm/pp/b5/xmppb5zuu2hmopkmxjagfwmsaxy.jpeg"><br><br><h3>  √âtag√®res pour t√©l√©phones </h3><br><p>  Nous avons longtemps pens√© comment rendre les √©tag√®res confortables.  Yandex avait des racks pour d√©montrer les t√©l√©phones ou tester les interfaces.  Nous avons pens√© r√©utiliser les racks, mais ils ne nous convenaient pas beaucoup: les t√©l√©phones l√†-bas mettaient l‚Äô√©cran √† l‚Äôutilisateur, comme dans une vitrine - nous n‚Äôen avons pas besoin.  Nous voulions optimiser l'espace dans le placard, nous avons donc d√©cid√© de fabriquer nous-m√™mes des √©tag√®res. </p><br><p>  Il y avait une id√©e de mettre les t√©l√©phones √† l'int√©rieur, comme des livres.  Pour ce faire, nous avons cherch√© des s√©parateurs dans les papeteries, essay√© d'utiliser des supports de CD-ROM, des √©tag√®res de magasin - tout √ßa.  De mani√®re exp√©rimentale, les coins en plastique d'un s√©parateur √† coupure d'un conduit de c√¢ble ont √©t√© coll√©s sur une √©tag√®re avec un adh√©sif thermofusible.  La ¬´mise en page du livre¬ª s'est av√©r√©e tr√®s r√©ussie et nous l'avons aim√©. </p><br><img src="https://habrastorage.org/webt/uy/f6/se/uyf6sey2q9tpuwgv-wlfxtrkpfw.jpeg"><br><br><h3>  Peu d'endroits et de nombreux hubs </h3><br><p>  Au bas de l'armoire, il y avait peu d'espace pour quatre concentrateurs √† 10 ports et Intel NUC - nous √©tions loin de la premi√®re tentative pour les y pousser.  La porte de l'armoire n'√©tait pas destin√©e √† fixer la serrure - nous avons utilis√© beaucoup de colle chaude, des blocs de bois et une scie √† m√©taux.  Permettez-moi de vous rappeler: le projet a √©t√© r√©alis√© par un groupe de test de charge, aucun de nous n'avait d'exp√©rience avec un broyeur √† un point de caf√©. </p><br><img src="https://habrastorage.org/webt/uv/yy/oc/uvyyoc8ilf6w6apxjmoxfc26kys.jpeg"><br><br><h3>  Prototype de service </h3><br><p>  Nous avons rapidement r√©gl√© ce probl√®me: nous avons cr√©√© une page indiquant l'emplacement des t√©l√©phones et l'avons plac√©e directement dans notre service de test de charge.  Tout simplement parce que cela vous a permis d'essayer rapidement et presque sans effort ce qui s'est pass√©. </p><br><h2>  Le premier prototype fonctionnel </h2><br><p>  Nous avons r√©cup√©r√© le premier Hypercube en trois semaines.  Il ressemblait √† ceci: </p><br><img src="https://habrastorage.org/webt/0s/3j/10/0s3j10s6n8gk4ryxw4tyxrq3xte.jpeg"><br><br><p>  Dans un premier temps, nous avons d√©cid√© de tester le prototype dans notre bureau Yandex √† Moscou (le client √©tait √† Ekaterinbourg).  Il s'est rendu dans l'√©quipe mobile de Yandex.Browser - nous la connaissions d√©j√† du projet <a href="https://habr.com/ru/company/yandex/blog/311046/">Yandex Volta</a> (une version plus r√©cente du rapport est <a href="https://www.youtube.com/watch%3Fv%3DFRWvJpwyYrU">ici</a> ).  Ces gars connaissent bien la consommation d'√©nergie. </p><br><h2>  Premier test </h2><br><h3>  Etag√®res √† nouveau </h3><br><p>  Il s'est av√©r√© que la colle chaude ne tient pas bien les coins en plastique sur les √©tag√®res en m√©tal.  Nous revenons √† l'id√©e des postes t√©l√©phoniques.  J'ai longuement r√©fl√©chi √† l'apparence de l'√©tag√®re id√©ale dans le placard.  Il semble maintenant qu'il √©tait possible de le dessiner en 15 minutes.  Au final, cela s'est av√©r√© pas tout √† fait comme dans le premier croquis, mais voici ce que j'ai ensuite dessin√©: </p><br><img src="https://habrastorage.org/webt/60/it/1c/60it1cg57quzpzegy-wshqqwb9o.jpeg"><br><br><p>  Nous avons pris les √©tag√®res achet√©es pour les armoires de serveurs, et en plus nous avons mis les s√©parateurs frais√©s en feuille de plastique, que nous avons fabriqu√©s sur commande.  Cette conception a surv√©cu √† ce jour. </p><br><img src="https://habrastorage.org/webt/wo/gp/r9/wogpr9zec43uihz89v1icn6wrnu.jpeg"><br><br><h3>  Concentrateurs peu pratiques </h3><br><p>  Les hubs des premi√®res armoires √©taient avec un interrupteur d'alimentation, des boutons sans verrouillage, √©teints par d√©faut.  Par cons√©quent, apr√®s chaque red√©marrage, j'ai d√ª allumer les quatre concentrateurs avec mes mains.  Nous avons connect√© Yandex SpeechKit pour que le cube prononce si les concentrateurs volent: "Je ne vais pas bien, veuillez appeler la personne responsable."  Quand une personne entre, la voix vous dit de v√©rifier les hubs.  Et l'assistant vocal a commenc√© √† appeler les employ√©s par leur nom et leur voix, qui ont pris combien de t√©l√©phones. </p><br><h3>  Probl√®me de verrouillage </h3><br><p>  Il y a eu plusieurs it√©rations avec le ch√¢teau.  Lorsque je cherchais des serrures pour le prototype au tout d√©but, j'ai trouv√© la seule option qui me convenait - "Sheriff": petite, solide et tr√®s spirituelle (je n'ai pas encore vu d'analogues).  Il se fermait parfaitement, mais pour ouvrir le placard, il fallait appuyer l√©g√®rement sur la porte.  Tous les utilisateurs ne l'ont pas compris, nous avons donc d√©cid√© de changer le verrou. </p><br><p>  Ils ont pris le ¬´sh√©rif¬ª avec un ressort qui a pouss√© la porte.  Le cabinet s'est parfaitement ouvert - mais il a commenc√© √† se fermer mal et est rest√© ouvert (et s'est consid√©r√© ferm√©).  En effet, le capteur de fermeture √©tait install√© s√©par√©ment de la serrure, la porte avait un jeu et le capteur fonctionnait parfois jusqu'√† la fermeture de la porte.  Son installation √©tait irr√©aliste. </p><br><p>  Une fois de plus, nous avons chang√© la serrure pour le prochain ¬´sh√©rif¬ª, qui n'√©tait plus d'une telle conception pleine d'esprit, mais d'un autre c√¥t√©, un capteur de fermeture a √©t√© int√©gr√© directement dedans.  La serrure a fonctionn√© sur le prototype, mais apr√®s l'avoir mis en service dans le tout premier coffret, elle a commenc√© √† se saisir.  J'ai d√ª danser avec un tambourin: d√©monter, lubrifier, limer avec une lime.  Avec un chagrin de moiti√©, il s'est retrouv√©. </p><br><p>  Apr√®s les premiers tests, c'est devenu clair: les d√©veloppeurs et les testeurs comme le cabinet, ils l'utilisent activement.  C'est pratique: vous pouvez surveiller les appareils et rechercher le bon dans le service Web, plut√¥t que de demander √† vos coll√®gues: ¬´Qui a ce t√©l√©phone maintenant?¬ª.  Nous avons identifi√© les probl√®mes les plus importants: des concentrateurs USB g√™nants que vous devez allumer avec vos mains, de longs c√¢bles USB de mauvaise qualit√© (les connecteurs se sont cass√©s et les fils se sont emm√™l√©s), un mauvais verrou et des s√©parateurs d'√©tag√®re peu fiables qui sont tomb√©s tout le temps.  Le travail a continu√©. </p><br><h2>  Expansion de l'hyperespace </h2><br><p>  Le responsable du d√©partement de gestion de projet - il nous a √©galement aid√© √† organiser l'externalisation pour les √©tag√®res - √©tait activement engag√© dans les relations publiques internes √† Yandex: il est all√© dans diff√©rentes √©quipes et a parl√© de notre merveilleux service.  Nous avons rencontr√© des repr√©sentants d'autres d√©partements et, de fa√ßon inattendue, nous avons commenc√© √† recevoir des commandes internes pour plusieurs dizaines d'armoires.  Une image sombre a √©merg√©: des testeurs de charge pendant des semaines avec toute l'√©quipe assemblent manuellement les armoires √† partir de ce qui est √† port√©e de main. </p><br><p>  Nous avons r√©alis√© que nous avions besoin d'aide pour l'assemblage.  Avant cela, il √©tait n√©cessaire d'optimiser le co√ªt d'une instance de l'armoire et sa conception pour une production √† petite √©chelle. </p><br><h3>  Stagiaire </h3><br><p>  Pendant un mois et demi d'√©t√©, nous avons r√©ussi √† trouver un stagiaire qui savait souder, percer et coder un peu.  Avec lui, nous avons refait l'ancienne armoire sur le Raspberry Pi (pour se d√©barrasser du processeur Intel NUC cher et inutile) et assembl√© une autre armoire pour une installation dans les services d'assistance √† Moscou et √† Saint-P√©tersbourg (il y a des gars intelligents qui aideront nos utilisateurs √† faire face au prototype et donner commentaires utiles). </p><br><h3>  Alternatives budg√©taires </h3><br><p>  Pour optimiser le co√ªt, nous avons remplac√© les composants les plus d√©raisonnablement chers du prototype: le mini-ordinateur Intel NUC (25 000 roubles) et le lecteur RFID (5 000).  Ils ont trouv√© un lecteur alternatif sur Ali Express pour 150 roubles, et √† partir d'un mini-ordinateur, ils ont d√©m√©nag√© vers Raspberry Pi pour 3,5 mille roubles. </p><br><p>  Sur la nouvelle plateforme, nous avons rencontr√© plusieurs probl√®mes.  Au d√©but, il s'est av√©r√© que le relais pour les serrures ne commutait pas, car RPi donne 3,3 V, et les relais m√©caniques sont con√ßus pour 5 V. J'ai d√ª passer √† l'√©tat solide.  Ensuite, nous avons d√©couvert qu'il n'y a pas d'horloge sur la carte, et vous ne pourrez pas prendre de temps en utilisant NTP: vous ne pouvez pas vous authentifier dans le r√©seau du bureau sans l'heure correcte (nous avons trouv√© une carte d'extension sp√©ciale avec une horloge pour RPi). </p><br><p>  Le probl√®me le plus enchanteur √©tait avec les iPhones.  D√®s que le sixi√®me iPhone a √©t√© ins√©r√© dans le RPi, il est devenu indisponible sur le r√©seau.  Un gestionnaire de projet de passage (et dans le pass√© un administrateur s√©v√®re) nous a aid√©s √† comprendre cela.  Il s'est av√©r√© que la carte r√©seau du RPi √©tait divorc√©e via USB, et les iPhones ont provoqu√© un service de buggy pour terminer le bus USB.  Ce probl√®me est apparu pour la premi√®re fois au bureau de Minsk, les gars ont pu le reproduire rapidement et donner leur avis, ce qui nous a beaucoup aid√©s.  Ils ont r√©solu le probl√®me en d√©molissant l'interface graphique (si je me souviens bien), car le service y √©tait int√©gr√©. </p><br><h3>  Les armoires grandissent </h3><br><p>  Il y a eu un d√©bat sur la taille du cabinet.  Quelqu'un a pens√© qu'il √©tait n√©cessaire de mettre deux fois plus de t√©l√©phones dans un placard, quelqu'un - que les grandes armoires n'√©taient pas pratiques √† utiliser au bureau.  Et puis nous avons constat√© que nous avions d√©j√† achet√© toutes les petites armoires dans les magasins de Moscou, et la prochaine livraison ne serait que dans trois mois.  Le d√©bat s'est termin√© seul. </p><br><p>  Ils ont d√©cid√© d'agrandir toutes les armoires suivantes.  Pour l‚Äôavenir, je dirai: ce fut la bonne d√©cision.  Sur la base d'une grande armoire, il est devenu plus facile de placer des appareils √©lectroniques; 80 t√©l√©phones n'y √©taient plus plac√©s.  Entre les rails se trouvait un serveur standard de 19 pouces.  Dans une petite armoire, la distance entre les rails n'√©tait pas suffisante. </p><br><img src="https://habrastorage.org/webt/yr/zt/x4/yrztx4px9jzm3937az12pj0yjli.jpeg"><br><br><h3>  D√©veloppement Web et UX </h3><br><p>  Nous avons pouss√© notre baguette sur l'un des cadres de d√©veloppement Web internes, nous avons r√©alis√© qu'il √©tait bon et avons d√©plac√© la plaque t√©l√©phonique de Django vers React.  Mais il √©tait clair que juste une tablette ne conviendrait √† personne.  Le d√©partement des g√©o-services a pens√© et nous a fait comprendre la t√¢che sur plusieurs √©crans. </p><br><p>  J'ai d√ª brancher une √©quipe de d√©veloppement Web.  On nous a confi√© un concepteur de produit qui a enti√®rement pens√© √† l'interaction des utilisateurs avec le service.  Il a fait des autocollants pratiques sur les armoires, a plac√© les armoires sur le plan du bureau, a √©tudi√© le chat de support afin de mieux comprendre ce que les utilisateurs veulent.  Bref, j'ai pris le projet sous mon aile en termes d'exp√©rience utilisateur. </p><br><p>  Les d√©veloppeurs Web ont pris les devants et ont rapidement mis en ≈ìuvre des dispositions de conception.  Nous avons quelque chose de similaire √† Yandex.Market sur une plus petite √©chelle: vous entrez, choisissez un t√©l√©phone, vous allez le chercher dans un placard.  Le r√™ve est simple. </p><br><img src="https://habrastorage.org/webt/ve/ip/7s/veip7sfanydchkpd_jmd4su5fe8.png"><br><br><p>  Quelque part ici, nous avons r√©alis√© que le projet devrait √™tre d√©ploy√© sur l'ensemble du Yandex.  Nous nous sommes mis d'accord sur les d√©penses afin de corriger les erreurs et d'am√©liorer s√©rieusement la qualit√© de service: il y avait un budget g√©n√©ral pour l'achat d'armoires, de pi√®ces d√©tach√©es et d'outils.  Avec l'aide de Pasha Melnikov, le chef du groupe des projets de fer RnD (√† l'√©poque, et maintenant il est engag√© dans Yandex.Station), nous avons r√©ussi √† convenir avec une entreprise externe de la production d'armoires s√©rie en tenant compte de nos besoins. </p><br><h3>  Nouvelle version des hubs </h3><br><p>  Nous avons achet√© une autre version des hubs, sans boutons d'alimentation.  Maintenant, il n'√©tait plus n√©cessaire de monter √† l'int√©rieur de l'armoire et d'allumer les moyeux apr√®s un red√©marrage.  Nous avons assembl√© un prototype manuellement - cela fonctionnait parfaitement.  Mais lorsque nous l'avons envoy√© √† Ekaterinbourg, nous avons imm√©diatement commenc√© √† recevoir des plaintes selon lesquelles le cabinet ne voyait pas de t√©l√©phones.  Je n'ai compris cela que sur place.  Il s'est av√©r√© que les nouveaux concentrateurs ont une topologie diff√©rente (m√™me pour le m√™me mod√®le de concentrateur dans diff√©rentes s√©ries, la topologie peut varier). </p><br><p>  L'ancien et le nouveau concentrateur √† 10 ports √† l'int√©rieur se composent de trois puces USB avec quatre ports.  Mais dans l'ancien hub avec le bouton d'alimentation, deux puces sont coinc√©es en une, et dans la nouvelle elles sont reli√©es par une "guirlande".  Le nombre de ports est le m√™me, mais la profondeur d'imbrication est diff√©rente.  Les anciens t√©l√©phones n'ont pas √©t√© d√©tect√©s dans les ports avec une grande profondeur d'imbrication.  C'est bien qu'ils soient vieux et pas tr√®s n√©cessaires.  Nous avons r√©solu le probl√®me d'une t√™te douloureuse en coupant la t√™te: nous venons de prendre des mod√®les de t√©l√©phone plus r√©cents pour l'armoire, eh bien, nous attendions la mise en ≈ìuvre de nos propres concentrateurs.  Certes, le logiciel devait permettre de d√©finir diff√©rentes configurations de topologie USB pour diff√©rentes armoires. </p><br><h2>  Propres hubs </h2><br><p>  En collaboration avec Pasha, nous avons commenc√© √† d√©velopper notre propre concentrateur USB externe.  Il √©tait n√©cessaire de r√©soudre le probl√®me des concentrateurs achet√©s, mais aussi de mettre en √©vidence les appareils pour lesquels l'utilisateur est venu et d'acc√©l√©rer la charge des t√©l√©phones modernes: pour cela, nous avons pris des alimentations puissantes et respect√© les derni√®res normes.  Les concentrateurs avaient la capacit√© de connecter des capteurs de temp√©rature externes - afin que nous puissions le contr√¥ler sur chaque √©tag√®re.  Les tailles ont √©t√© choisies de mani√®re √† ce que deux cartes concentrateurs install√©es dans un seul bo√Ætier s'ins√®rent exactement dans le rack de serveur 19 pouces.  Les moyeux ont un profil bas pour √©conomiser de l'espace entre les √©tag√®res - en g√©n√©ral, ils se sont av√©r√©s cool et modernes.  Pacha parlera plus en d√©tail de ce projet sur Habr√©. </p><br><img src="https://habrastorage.org/webt/fr/ou/uh/frouuhq7yr0jweypbpumfd0tpqq.jpeg"><br><br><h2>  Assemblage </h2><br><p>  L'assemblage de composants sur la base d'armoires achet√©es a √©galement √©t√© externalis√©.  Selon nos calculs, l'√©quipe de montage √©tait cens√©e faire face √† quelques soir√©es, mais en raison de l'abondance du travail manuel, cela a dur√© quelques semaines.  Des fils qui sont connect√©s de mani√®re non standard selon les sch√©mas dessin√©s avec un stylo sur un d√©pliant, une soudure manuelle, un manque de si√®ges pr√™ts √† l'emploi pour les composants et des composants finis eux-m√™mes ... Les armoires ont √©t√© finies au sens litt√©ral du mot: des trous ont √©t√© perc√©s pour les serrures et figur√©s ont √©t√© d√©coup√©s par un broyeur pour d'autres composants. </p><br><h2>  Plus proche de la production </h2><br><p>  Nous avons d√©j√† r√™v√© de donner des armoires √† la production.  Nous avons d√©cid√© que pour acc√©l√©rer, il fallait simplifier la production et augmenter la part de l'externalisation. </p><br><h3>  Carte p√©riph√©rique </h3><br><p>  Conception de la carte p√©riph√©rique et mise √† jour des composants.  Maintenant, il est connect√© au Raspberry Pi avec un seul c√¢ble et √† tous les autres composants avec des connecteurs standard. </p><br>  Nous avons install√© une horloge pour RPi sur la carte: auparavant, nous avons coll√© un composant pr√™t √† l'emploi s√©par√©, achet√© dans un magasin.  Nous avons √©galement plac√© un convertisseur DC / DC (il y avait autrefois une alimentation s√©par√©e) et une interface RS-485: cela nous a permis de nous d√©barrasser de la nappe de fils.  Auparavant, nous les connections manuellement d'un point √† un autre en les soudant ou en les collant dans l'une des broches RPi.  Nous avons v√©rifi√© le diagramme, regard√© le point d'entr√©e du fil, cherch√© le trou souhait√© - et donc avec chaque fil tour √† tour.  Cela prenait beaucoup de temps et provoquait des erreurs d'assemblage.  La nouvelle carte utilisait des prises t√©l√©phoniques. <br><br><img src="https://habrastorage.org/webt/bu/u5/11/buu5119817wci7cc-9mk2vderl8.jpeg"><br><br><p>  Il s'est av√©r√© plus tard: lors du c√¢blage, je n'ai pas pris en compte que vous devez connecter la puce RS-485 √† des pattes RPi bien d√©finies.  J'ai d√ª mettre √† jour la version de la carte.  Lorsque j'ai dessin√© le composant de d√©couplage de puissance RS-485, je n'ai pas fait attention au fait que la fiche technique montre la puce √† partir du bas, pas du haut, et quand je l'ai allum√©e pour la premi√®re fois, elle a fait un "Bang!" Avec une odeur caract√©ristique.  J'ai d√ª ressouder la puce √† l'arri√®re de la carte pour toute la premi√®re s√©rie de cartes. </p><br><img src="https://habrastorage.org/webt/ob/7g/vf/ob7gvfrtpjy-iqvwg9dttukakwg.png"><br><br><h3>  Nouvelle version d'armoire </h3><br><p>  Les armoires achet√©es ont cess√© de nous convenir.  Ils avaient l'air √©tranges, car ils √©taient destin√©s au serveur, et non au bureau, et ils devaient √©galement √™tre modifi√©s √† la main.  Cela a pris beaucoup de temps et le r√©sultat a √©t√© artisanal.  Nous avons d√©cid√© de fabriquer nos propres armoires √† l'usine d'Arzamas. </p><br><p>  Nous avons demand√© √† l'usine de monter une armoire modifi√©e sur la base de leur armoire serveur standard: changer la taille, installer la serrure, sortir les connecteurs n√©cessaires, faire des trous pour fixer les √©l√©ments.  Ils ont dessin√© des croquis des √©tag√®res, fait un bo√Ætier pour l'unit√© √©lectronique (RPi et ses amis), un bo√Ætier pour le hub.  En ce qui concerne le ch√¢teau, l'ing√©nieur concepteur de l'usine a l√©g√®rement modifi√© l'option achet√©e et cela a commenc√© √† mieux fonctionner.  Un rapport de bug avec une demande de retrait pour finaliser le fer a √©t√© envoy√© aux auteurs du sh√©rif. </p><br><p>  Il est tr√®s pratique que tous les composants √©lectroniques de commande de l'armoire soient d√©sormais concentr√©s dans un seul bo√Ætier, qui est mont√© sur quatre boulons.  Il peut √™tre assembl√© s√©par√©ment de l'armoire, il est facile √† retirer et √† remplacer le tout lorsqu'il est cass√©. </p><br><img src="https://habrastorage.org/webt/2o/1c/48/2o1c48-sruzbyqc-w-flwjh9x_w.png"><br><img src="https://habrastorage.org/webt/h9/az/i7/h9azi7um8ew9v8pj1buv2aqnd8g.png"><br><img src="https://habrastorage.org/webt/6_/yu/vb/6_yuvbuqop_0bxooqjwithyojie.png"><br><br><p>  Dans les armoires d'essai, les fils √©taient confus, les connecteurs ont vol√© hors du moyeu et se sont cass√©s, et parfois les employ√©s ont emport√© les fils avec eux.  Nous avons d√©cid√© de fixer fermement les fils aux √©tag√®res, tout en laissant la possibilit√© de changer les fils.  J'ai dessin√© un croquis - et l'usine nous l'a vendu en fer. </p><br><img src="https://habrastorage.org/webt/be/qs/80/beqs80_1wvnvkexl2sjwadxrads.jpeg"><br><img src="https://habrastorage.org/webt/uu/gx/zj/uugxzj-rzbqpjeh5rhlrj0dso0c.jpeg"><br><br><p>  Bien s√ªr, nous sommes all√©s plusieurs fois √† Arzamas: n√©gocier, √©tablir la production, accepter le r√©sultat.  En cons√©quence, nous avons obtenu les armoires presque compl√®tement pr√™tes, il restait √† les mettre en service.  Mais c'est une autre histoire. </p><br><img src="https://habrastorage.org/webt/y_/fb/lj/y_fbljom5cnrcjj9e2gn218rjwq.jpeg"><br><br><p>  Au fait, si vous visitez Arzamas, allez au burger du centre: c'est cool. </p><br><h2>  Dans la prochaine s√©rie </h2><br><p>  Maintenant, nos cubes sont activement utilis√©s dans l'entreprise.  Nous avons m√™me trouv√© des noms pour eux: Stanley Cube, Maggi Cube, Arnie Cube (Arnold Schwarzenegger, six pi√®ces), etc. </p><br><p>  Dans un avenir proche, des coll√®gues partageront avec vous des histoires sur le sort du service.  Par exemple, sur la fa√ßon dont Yandex.Hub a √©t√© d√©velopp√©.  Ou comment certains ports des concentrateurs ont commenc√© √† "devenir engourdis".  Sur le port "engourdi", vous ne pouvez pas voir la d√©connexion des p√©riph√©riques USB, m√™me dans les messages du noyau, il n'y a rien.  Mais tout se normalise si vous retirez le t√©l√©phone du port et le restaurez.  En attendant, les gars √©crivent des articles pour vous - essayez de deviner par vous-m√™me pourquoi cela pourrait √™tre. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr485050/">https://habr.com/ru/post/fr485050/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr485034/index.html">Automatisation de la construction d'un projet Qt sous Windows dans Travis CI</a></li>
<li><a href="../fr485036/index.html">Pourquoi ai-je besoin d'un support instrumental pour la pagination des cl√©s</a></li>
<li><a href="../fr485042/index.html">En raison du support 5G obligatoire, les smartphones avec Snapdragon 865 seront pires en 2020</a></li>
<li><a href="../fr485044/index.html">Nous d√©montons l'horloge num√©rique du vaisseau spatial Soyouz</a></li>
<li><a href="../fr485046/index.html">Comment planifier une strat√©gie de produit gagnante</a></li>
<li><a href="../fr485052/index.html">Qui est un bon AQ?</a></li>
<li><a href="../fr485056/index.html">Diviser et conqu√©rir</a></li>
<li><a href="../fr485058/index.html">"V√©rifier l'horloge": ce que l'on sait du nouveau protocole de synchronisation de l'heure du serveur</a></li>
<li><a href="../fr485068/index.html">Code propre pour TypeScript - Partie 2</a></li>
<li><a href="../fr485070/index.html">Andrew Eun "Passion pour l'apprentissage automatique." Traduction des chapitres 36-46</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>