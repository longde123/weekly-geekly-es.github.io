<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🍧 😇 🛌🏽 使用WI-FI扩展可编程继电器的网络功能 👩🏾 🍩 🏳️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="一切如何开始 
 一切都始于PR200可编程继电器算法的开发，通常需要可视化或从计算机输入信息，为此必须使用操作员面板或SCADA系统，但这并不总是很方便，并且对于简单系统而言是必需的。 解决方案很快就找到了，随着时间的流逝，我尝试着尽可能地朝着这个方向改进和促进我的工作，其中的内容得到了继续阅读。...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>使用WI-FI扩展可编程继电器的网络功能</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/424791/"><h2> 一切如何开始 </h2><br> 一切都始于PR200可编程继电器算法的开发，通常需要可视化或从计算机输入信息，为此必须使用操作员面板或SCADA系统，但这并不总是很方便，并且对于简单系统而言是必需的。 解决方案很快就找到了，随着时间的流逝，我尝试着尽可能地朝着这个方向改进和促进我的工作，其中的内容得到了继续阅读。 <br> 我们将讨论WI-FI网卡及其功能。 <br><br><img src="https://habrastorage.org/webt/z7/0j/nn/z70jnnmuwed2qwcdyhbqjhni0-w.jpeg" alt="图片"><br><a name="habracut"></a><br> 由于该板用于调试各种项目，因此不断修改交互界面，以更加方便，快捷地进行设置。 第一个修改是一个简单的RS-485到TCP转换器，带有输出到WEB，具有ESP8266社区中已知的现成固件。 从那时起已经过去了2年多的时间，并且需要存档来分析耗时的过程，并且由于我想将所有这些都整合到一个设备中而无需额外的设备，因此决定集成microSD支持，这极大地促进了对过程的分析，并具有快速访问的能力。档案。 板子的第二个修改有一个插槽，可以卸下microSD卡以将记录的文件保存在计算机上。 在我看来，这不是很方便，并且出现了一个可以通过WI-FI下载文件的版本。 有时下载未完成，需要重复进行下载操作，但是考虑到此时设备仍在运行并且归档也可以工作，我认为这不是一个很大的问题。 也是经过测试的版本，带有16 mB的存储芯片而不是microSD卡。 下载速度更快，但是无法保存许多文件，录制是按顺序进行的，直到所有内存已满。 <br><br><h2> 接口板的用途和功能 </h2><br> 该评估板旨在扩展对可编程继电器PR200逻辑内部变量的访问，并提供对读取和写入变量的访问。 <br><br> 借助无线WI-FI接口，无需连接其他设备即可访问设备。 首先，该解决方案侧重于具有WI-FI网络的地方的简单家庭自动化项目。 这些解决方案包括用于室内和室外照明自动化，泵站，温室等的控制和监视的解决方案。由于板上装有内置的WEB服务器，因此在需要访问系统的情况下，无需购买其他设备。不经常。 基本输入输出使用同一网络上的智能手机/平板电脑或PC进行。 <br><br> 接口板可以在多种模式下运行。 当连接到具有Internet访问权限的路由器时，它允许您远程监视PR200逻辑中变量的状态，以及通过从变量模式下PR200支持的格式的网络变量来控制算法。 <br><br> 通过网络变量与设备中已编程的算法进行通信，而接口板可以充当主机或从机。 支持PR200网络接口的标准速度和设置。 支持通过Modbus TCP协议进行交换；为此，分配了100个单元的存储区，既可以从WEB界面访问，也可以从PR200侧通过Modbus RTU协议访问。 <br><br> 网卡模式的选择类似于使用图形面板时的选择;在主模式下工作使您可以更灵活地控制变量的交换，对于寄存器，其值需要比其他值更频繁地获得，可以设置更少的轮询周期。 以下命令可用于Modbus协议： <br><br>  03（0x03）读取保持寄存器读取。 <br><br>  04（0x04）读取输入寄存器读取 <br><br>  06（0x06）预设单寄存器记录 <br><br>  16（0x10）预设多个寄存器记录 <br><br> 从继电器接收到的变量可用于写入文件（存档），该文件位于micro SD卡上，以文本格式记录。 下载后，您可以在计算机上使用简单的文本编辑器进行查看。 文件中记录的值可以显示在历史图表上。 使用用于在时间线上缩放和选择特定时间段以及分别显示/隐藏图形线的选项，可以执行归档数据的分析。 <br><br> 在存档器运行期间创建的文件保留在microSD卡上，并且可以下载到计算机上，任何时候都只能使用一个文件，它可以记录存档数据，读取信息以建立历史图表或读取信息以保存到PC 。 <br><br> 为了进行归档，可以从网络板的地址空间中获取变量，必须在其中将通过PR200的Modbus RTU接收的数据或从主模式下支持Modbus TCP协议的其他设备的Modbus TCP接收的数据写入其中。 <br><br> 既可以在接入点模式（Access Point）中，又可以在客户端模式-工作站（Station）中，也可以同时在两种模式下，配置接口板。 多数情况下，访问点可以访问Internet，并充当设备与网络之间的桥梁。 <br><br> 无线连接可以用密码保护，也可以隐藏接入点。 <br><br> 通过从PR200的RS485接口获得的变量可以通过以图形形式显示来进行分析，在这种模式下，这些值将以〜1秒的时间实时显示。 <br><br>  10个变量可用于以整数，浮点数或16/32位表示形式进行绘制。 数量，类型，变量地址和输出格式取自归档设置。 <br><br> 为了快速方便地操作，决定重复使用该设备的“本机”网卡的形式。 <br><br><img src="https://habrastorage.org/webt/qv/vg/4j/qvvg4jbi6kbwq0i700vlhi9ftne.jpeg" alt="图片"><br>  <i>评估板已安装在设备中。</i> <br><br><div class="spoiler">  <b class="spoiler_title">网卡可以安装在第一个或第二个插槽中</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/j_/qy/pq/j_qypqdkzcf7j3a9jujeeqq5fza.jpeg" alt="图片"><br></div></div><br> 该板有两个开关，一个用于重置网络板（不影响PR200中的程序），第二个开关可以进行编程以启用存档（通过板的WEB界面中的设置选择）。 还有2个信息LED： <br><br> 通过与PR200的RS-485接口进行数据交换时，1-blue短暂点亮 <br> 在将数据写入Micro SD卡时，2红色短暂亮起，如果没有卡或无法读取卡上的数据，则2红色常亮。 <br><br> 以下是在各种模式下工作时的主菜单： <br><br><img src="https://habrastorage.org/webt/to/ny/-9/tony-98orqrhf1luvbjsjgunzum.png" alt="图片"><br>  <i>通过WEB连接的基本网络设置。</i> <br><br><img src="https://habrastorage.org/webt/mh/cm/f8/mhcmf8an5ct55x2o3xaoaatw6ps.png" alt="图片"><br>  <i>PR200网络接口的连接设置和通过WIFI的Modbus TCP的连接设置</i> <br><br><img src="https://habrastorage.org/webt/_6/xm/cz/_6xmcznmcjb3mtvepazjeqwh75c.png" alt="图片"><br>  <i>Web，Modbus RTU和Modbus TCP通用的内部寄存器映射</i> <br><br><div class="spoiler">  <b class="spoiler_title">测试WEB页面，用于通过连接的PRM-1扩展模块控制和监视PR200 I / O的状态。</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/nd/tu/fk/ndtufkepntezf8hbwxjdaxozxdi.png" alt="图片"><br><br><img src="https://habrastorage.org/webt/qp/td/yx/qptdyx2xpp1ttfzucdh6iprrac4.png" alt="图片"><br></div></div><br><div class="spoiler">  <b class="spoiler_title">用于输入/输出PR200的值以及将数据传输到设备的控制输出的页面。</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/sw/c8/yb/swc8ybmb1radp2jcf027mi_be0s.png" alt="图片"></div></div><br> 将网络板连接到具有Internet访问和端口转发功能的路由器时，可以通过浏览器远程操作该板。 <br><br><h2> 如何运作 </h2><br> 以下是在带有数据归档的实际项目上运行PR200时的屏幕截图。  PR200中加载了一个项目，该项目读取NTC传感器连接的4个模拟通道的值并将这些值转换为温度，并使用在主模式下配置的第二个网络接口，PR200轮询连接2个Pt1000 DTC的MV110-8A模块。 因此，将收集来自PR200模拟输入的4个电阻值，使用NTC宏获得的4个温度值以及通过RS-485从MV110-8A模块接收的2个温度值的数据。 读取在主模式下配置的第一个网络接口上的所有10个浮点格式的寄存器，以写入存档和WEB可视化。 <br><br><img src="https://habrastorage.org/webt/ov/kb/ue/ovkbuegmxtn4pkqkubbbkmfnxxs.png" alt="图片"><br>  <i>当存档关闭时，用于SD卡的菜单会显示卡上的文件列表；当存档打开时，则会显示卡上记录的日志。</i> <i><br></i> <br><br><div class="spoiler">  <b class="spoiler_title">存档管理菜单。</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/mx/jq/7y/mxjq7y7yqfezmgaflitikmg2qrg.png" alt="图片"></div></div><br><img src="https://habrastorage.org/webt/w4/45/1j/w4451jdprj0bwuvdt6ytzfem27c.png" alt="图片"><br> 从PR200实时时钟寄存器中读取用于归档的时间戳；在此示例中，时钟不与实时同步。 <br><br><div class="spoiler">  <b class="spoiler_title">通过WI-FI下载的存档文件，板上装有micro SD，并使用文本编辑器打开。</b>  <b class="spoiler_title">准备绘图。</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/vd/r8/zo/vdr8zoxuhegu_i0nu1cnqkepln4.png" alt="图片"></div></div><br><div class="spoiler">  <b class="spoiler_title">在浏览器中打开的页面用来从下载的文件生成图形。</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/9z/8z/s6/9z8zs6cxqt_ogdniz-qwc6evtqq.png" alt="图片"></div></div><br><img src="https://habrastorage.org/webt/ml/84/2m/ml842mxpwvm1xnth6o54qhbbntq.png" alt="图片"><br>  <i>根据存档文件中的数据生成时间表。</i> <br><br><img src="https://habrastorage.org/webt/vt/of/t3/vtoft3tx0zwvwgzzz3gzituvhhk.png" alt="图片"><br>  <i>通过图例管理图表可见性</i> <br><br><img src="https://habrastorage.org/webt/gm/wz/9f/gmwz9fhbq3b8d7nqirlqsqaka2u.png" alt="图片"><br>  <i>详细说明图表上的必要部分。</i> <br><br><h2> 通过Modbus TCP（WIFI）注册访问 </h2><br> 如果WEB功能不足以构建可视化，则可以使用通过Modbus TCP进行的访问，您可以组织与SCADA系统的通信，并从现成的模块中快速创建必要的可视化。 使用各种网络监视器，可以监视网卡的内部寄存器和PR200的内置寄存器的状态。 使用Modbus Poll软件进行的示例轮询。 <br><br><img src="https://habrastorage.org/webt/jn/vl/es/jnvlesf0u-zjwdw7ykpea0vlgn0.png" alt="图片"><br>  <i>使用Modbus Poll软件通过ModBus TCP协议进行连接。</i> <br><br><img src="https://habrastorage.org/webt/vj/h1/nv/vjh1nvjwlnxmo8mxpzfmdf8d6n8.png" alt="图片"><br>  <i>读取寄存器，并以各种格式显示它们。</i> <br><br><h2> 结论 </h2><br> 在设备中安装网卡后，使用PR200可编程继电器会出现其他功能和工具。 单独使用和组合使用都可以使用各种使用方案。 <br><br> 例如，在PR200中记录已存档的事件，目前已经创建了各种宏来在设备中记录已存档的事件，但是它们占用了设备中的大量资源，并且使用外部驱动器在输出信息和存档深度方面的能力有限。更加灵活地配置和记录必要的事件。 为了便于分析，增加了一种以位模式写入寄存器的模式，因此将分解为位的16或32位数字存入存档。 通过板上的开关，WEB接口和ModBus寄存器，支持各种开始​​归档的模式。 使用ModBus寄存器，设备本身通过将非0的数字写入单元格来确定记录时刻，超过设置，我们写入寄存器“ 1”，并写入日志，直到将值写入寄存器“ 0”，这与输入信号的操作类似。 另外，您可以选择一个记录，该记录具有一定时期的温度，压力，湿度等各种数据，以图形方式进行后续分析。 为了将数据转换为图形视图，在设备中内置了一个网页。 <br><br> 第二种情况是远程控制，或监视内部变量的状态，更改操作模式。 此选项可以分为内部网络，内部网络和Internet。 <br><br> 其余选项为辅助，调试，在当前可视化文件上显示感兴趣的变量，查看网络变量等。 <br><br> 听到社区对此主题的看法很有趣，谁以何种方式解决了类似的问题？ </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN424791/">https://habr.com/ru/post/zh-CN424791/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN424777/index.html">使用领事扩展有状态服务</a></li>
<li><a href="../zh-CN424779/index.html">Python中的多页SPA</a></li>
<li><a href="../zh-CN424781/index.html">使用Ignite在PyTorch上教学和测试神经网络</a></li>
<li><a href="../zh-CN424787/index.html">2018 RubyRussia会议发言人Aaron Patterson访谈</a></li>
<li><a href="../zh-CN424789/index.html">如何使用HAProxy Ingress，unicorn / puma和Web套接字部署Ruby on Rails应用程序</a></li>
<li><a href="../zh-CN424793/index.html">如何打印电动机</a></li>
<li><a href="../zh-CN424795/index.html">太阳能无人机有多大？</a></li>
<li><a href="../zh-CN424799/index.html">使用Google跟踪代码管理器对联属iframe小部件进行双向分析</a></li>
<li><a href="../zh-CN424801/index.html">Zeppelin OS-迈向安全智能合约的又一步</a></li>
<li><a href="../zh-CN424803/index.html">台湾黑客原本打算在网上黑客马克·扎克伯格（Mark Zuckerberg）的Facebook页面，但后来放弃了他的威胁</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>