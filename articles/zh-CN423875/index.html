<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ™ƒ ğŸ’…ğŸ¿ ğŸ“ å­˜å‚¨å¤§é‡æ–‡ä»¶ ğŸ˜° ğŸ‘¨ğŸ¼â€ğŸ³ ğŸ‘©ğŸ¾â€ğŸ«</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="èº«ä½“å¥åº·ï¼Œå°è´©ä»¬ï¼ åœ¨å¤„ç†çº¦ä¼šç½‘ç«™é¡¹ç›®çš„è¿‡ç¨‹ä¸­ï¼Œå¿…é¡»ç»„ç»‡ç”¨æˆ·ç…§ç‰‡çš„å­˜å‚¨ã€‚ æ ¹æ®èŒæƒèŒƒå›´ï¼Œæ¯ä½ç”¨æˆ·çš„ç…§ç‰‡æ•°é‡é™åˆ¶ä¸º10ä¸ªæ–‡ä»¶ã€‚ ä½†æ˜¯å¯èƒ½æœ‰æˆåƒä¸Šä¸‡çš„ç”¨æˆ·ã€‚ ç‰¹åˆ«è¦è€ƒè™‘åˆ°å½“å‰å½¢å¼çš„é¡¹ç›®ä»â€œé›¶â€å¼€å§‹å°±å·²ç»å­˜åœ¨ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œæ•°æ®åº“ä¸­å·²ç»æœ‰æˆåƒä¸Šä¸‡çš„ç”¨æˆ·ã€‚ æ®æˆ‘æ‰€çŸ¥ï¼Œå‡ ä¹æ‰€æœ‰æ–‡ä»¶ç³»ç»Ÿéƒ½ä¼šå¯¹æ–‡ä»¶å¤¹ä¸­çš„å¤§é‡å­èŠ‚ç‚¹...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>å­˜å‚¨å¤§é‡æ–‡ä»¶</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/423875/"><img src="https://habrastorage.org/webt/ti/up/px/tiuppxliueu75a1ycliw537yw-k.jpeg" alt="å›¾ç‰‡"><br><br> èº«ä½“å¥åº·ï¼Œå°è´©ä»¬ï¼ åœ¨å¤„ç†çº¦ä¼šç½‘ç«™é¡¹ç›®çš„è¿‡ç¨‹ä¸­ï¼Œå¿…é¡»ç»„ç»‡ç”¨æˆ·ç…§ç‰‡çš„å­˜å‚¨ã€‚ æ ¹æ®èŒæƒèŒƒå›´ï¼Œæ¯ä½ç”¨æˆ·çš„ç…§ç‰‡æ•°é‡é™åˆ¶ä¸º10ä¸ªæ–‡ä»¶ã€‚ ä½†æ˜¯å¯èƒ½æœ‰æˆåƒä¸Šä¸‡çš„ç”¨æˆ·ã€‚ ç‰¹åˆ«è¦è€ƒè™‘åˆ°å½“å‰å½¢å¼çš„é¡¹ç›®ä»â€œé›¶â€å¼€å§‹å°±å·²ç»å­˜åœ¨ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œæ•°æ®åº“ä¸­å·²ç»æœ‰æˆåƒä¸Šä¸‡çš„ç”¨æˆ·ã€‚ æ®æˆ‘æ‰€çŸ¥ï¼Œå‡ ä¹æ‰€æœ‰æ–‡ä»¶ç³»ç»Ÿéƒ½ä¼šå¯¹æ–‡ä»¶å¤¹ä¸­çš„å¤§é‡å­èŠ‚ç‚¹åšå‡ºéå¸¸è´Ÿé¢çš„ååº”ã€‚ ä»ç»éªŒæ¥çœ‹ï¼Œæˆ‘å¯ä»¥è¯´é—®é¢˜æ˜¯åœ¨çˆ¶æ–‡ä»¶å¤¹ä¸­çš„1000-1500ä¸ªæ–‡ä»¶/æ–‡ä»¶å¤¹ä¹‹åå¼€å§‹çš„ã€‚ <br><a name="habracut"></a><br>  <i>å…è´£å£°æ˜</i>  <i>åœ¨æ’°å†™æœ¬æ–‡ä¹‹å‰ï¼Œæˆ‘åœ¨Googleä¸Šè¿›è¡Œäº†æœç´¢ï¼Œå¹¶æ‰¾åˆ°äº†æ­£åœ¨è®¨è®ºçš„é—®é¢˜çš„å‡ ç§è§£å†³æ–¹æ¡ˆï¼ˆä¾‹å¦‚ï¼Œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">here</a>æˆ–<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">here</a> ï¼‰ã€‚</i>  <i>ä½†æ˜¯æˆ‘æ²¡æœ‰æ‰¾åˆ°ä¸€ä¸ªå®Œå…¨ç¬¦åˆæˆ‘çš„è§£å†³æ–¹æ¡ˆã€‚</i>  <i>å¦å¤–ï¼Œåœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»…åˆ†äº«æˆ‘è‡ªå·±è§£å†³é—®é¢˜çš„ç»éªŒã€‚</i> <br><br>
<h3> ç†è®º </h3><br> é™¤äº†è¿™æ ·çš„å­˜å‚¨ä»»åŠ¡ä¹‹å¤–ï¼Œå·¥ä½œé™ˆè¿°ä¸­è¿˜å­˜åœ¨ä¸€ä¸ªæ¡ä»¶ï¼Œæ ¹æ®è¯¥æ¡ä»¶ï¼Œæœ‰å¿…è¦ä¸ºç…§ç‰‡ä¿ç•™æ ‡é¢˜å’Œæ ‡é¢˜ã€‚ å½“ç„¶ï¼Œç¦»ä¸å¼€æ•°æ®åº“ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬è¦åšçš„ç¬¬ä¸€ä»¶äº‹æ˜¯åˆ›å»ºä¸€ä¸ªè¡¨ï¼Œåœ¨å…¶ä¸­å†™å…¥å¸¦æœ‰ç£ç›˜ä¸Šæ–‡ä»¶çš„å…ƒæ•°æ®æ˜ å°„ï¼ˆç­¾åï¼Œæ ‡é¢˜ç­‰ï¼‰ã€‚ æ¯ä¸ªæ–‡ä»¶å¯¹åº”äºæ•°æ®åº“ä¸­çš„ä¸€è¡Œã€‚ å› æ­¤ï¼Œæ¯ä¸ªæ–‡ä»¶éƒ½æœ‰ä¸€ä¸ªæ ‡è¯†ç¬¦ã€‚ <br><br> ä¸€ä¸ªå°é¢˜å¤–è¯ã€‚ è®©æˆ‘ä»¬è°ˆè°ˆè‡ªåŠ¨å¢é‡ã€‚ çº¦ä¼šç½‘ç«™å¯èƒ½æœ‰12æˆ–2000ä¸ªç”¨æˆ·ã€‚ é—®é¢˜æ˜¯åœ¨é¡¹ç›®å­˜åœ¨çš„æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œé€šå¸¸æœ‰å¤šå°‘ç”¨æˆ·æµè§ˆè¯¥é¡¹ç›®ã€‚ ä¾‹å¦‚ï¼Œçº¦ä¼šçº¦ä¼šçš„æ´»è·ƒè§‚ä¼—æ˜¯å‡ åä¸‡ã€‚ ä½†æ˜¯ï¼Œè¯•æƒ³ä¸€ä¸‹ï¼Œåœ¨è¿™ä¸ªé¡¹ç›®çš„ç”Ÿå‘½å‘¨æœŸä¸­è¿˜å‰©ä¸‹å¤šå°‘ç”¨æˆ·ï¼Ÿ åˆ°ç›®å‰ä¸ºæ­¢å°šæœªæ¿€æ´»å¤šå°‘ç”¨æˆ·ã€‚ ç°åœ¨æ·»åŠ æˆ‘ä»¬çš„æ³•å¾‹ï¼Œè¯¥æ³•å¾‹ä½¿æˆ‘ä»¬æœ‰ä¹‰åŠ¡å°†æœ‰å…³ç”¨æˆ·çš„ä¿¡æ¯å­˜å‚¨è‡³å°‘å…­ä¸ªæœˆã€‚è¿Ÿæ—©ä¼šæœ‰4å­—é’±çš„<b>UNSIGNED INT</b>ç»ˆæ­¢ã€‚ å› æ­¤ï¼Œæœ€å¥½å°†<b>BIGINT</b>ç”¨ä½œä¸»é”®ã€‚ <br><br> ç°åœ¨ï¼Œè®©æˆ‘ä»¬æƒ³è±¡ä¸€ä¸‹<b>BIGINT</b>ç±»å‹çš„æ•°é‡ã€‚ è¿™æ˜¯8ä¸ªå­—èŠ‚ã€‚ æ¯ä¸ªå­—èŠ‚ä»0åˆ°255ã€‚255ä¸ªå­èŠ‚ç‚¹å¯¹äºä»»ä½•æ–‡ä»¶ç³»ç»Ÿéƒ½æ˜¯å¾ˆæ­£å¸¸çš„ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬é‡‡ç”¨åå…­è¿›åˆ¶è¡¨ç¤ºå½¢å¼çš„æ–‡ä»¶æ ‡è¯†ç¬¦ï¼Œå°†å…¶åˆ†æˆä¸¤ä¸ªå­—ç¬¦çš„å—ã€‚ æˆ‘ä»¬å°†è¿™äº›å—ç”¨ä½œæ–‡ä»¶å¤¹åç§°ï¼Œå°†åè€…ç”¨ä½œç‰©ç†æ–‡ä»¶çš„åç§°ã€‚ èµ¢åˆ©ï¼ <br><br> <code>0f/65/84/10/67/68/19/ff.file</code> <br> <br> ä¼˜é›…è€Œç®€å•ã€‚ æ–‡ä»¶æ‰©å±•ååœ¨è¿™é‡Œå¹¶ä¸é‡è¦ã€‚ æ— è®ºå¦‚ä½•ï¼Œè¯¥æ–‡ä»¶å°†ç”±è„šæœ¬ç»™å®šï¼Œè¯¥è„šæœ¬å°†ä¸ºæµè§ˆå™¨æä¾›ç‰¹å®šçš„MIMEç±»å‹ï¼Œæˆ‘ä»¬è¿˜å°†å…¶å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ã€‚ æ­¤å¤–ï¼Œå°†æœ‰å…³æ–‡ä»¶çš„ä¿¡æ¯å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ä½¿æ‚¨å¯ä»¥ä¸ºæµè§ˆå™¨é‡æ–°å®šä¹‰æ–‡ä»¶çš„è·¯å¾„ã€‚ å‡è®¾æˆ‘ä»¬æ‹¥æœ‰çš„æ–‡ä»¶å®é™…ä¸Šä½äº<code>/content/files/0f/65/84/10/67/68/19/ff.file</code>è·¯å¾„<code>/content/files/0f/65/84/10/67/68/19/ff.file</code>å¯¹äºé¡¹ç›®ç›®å½•çš„<code>/content/files/0f/65/84/10/67/68/19/ff.file</code> ã€‚ å¹¶ä¸”ï¼Œæ‚¨å¯ä»¥åœ¨æ•°æ®åº“ä¸­å†™å…¥URLï¼Œä¾‹å¦‚<code>/content/users/678/files/somefile</code> ã€‚  SEOç°åœ¨å¯èƒ½å·²ç»è¢«æ¼‚äº®åœ°ç¬‘äº†ã€‚ æ‰€æœ‰è¿™äº›ä½¿æˆ‘ä»¬ä¸å†æ‹…å¿ƒæ–‡ä»¶å®é™…æ”¾ç½®çš„ä½ç½®ã€‚ <br><br><h3> æ•°æ®åº“ä¸­çš„è¡¨ </h3><br> é™¤äº†æ ‡è¯†ç¬¦ï¼ŒMIMEç±»å‹ï¼ŒURLå’Œç‰©ç†ä½ç½®ï¼Œæˆ‘ä»¬è¿˜å°†åœ¨è¡¨ä¸­å­˜å‚¨md5å’Œsha1æ–‡ä»¶ï¼Œä»¥åœ¨å¿…è¦æ—¶è¿‡æ»¤æ‰ç›¸åŒçš„æ–‡ä»¶ã€‚ å½“ç„¶ï¼Œæˆ‘ä»¬è¿˜éœ€è¦åœ¨æ­¤è¡¨ä¸­å­˜å‚¨å®ä½“å…³ç³»ã€‚ å‡è®¾æ–‡ä»¶æ‰€å±çš„ç”¨æˆ·æ ‡è¯†ã€‚ å¦‚æœé¡¹ç›®ä¸æ˜¯å¾ˆå¤§ï¼Œé‚£ä¹ˆåœ¨åŒä¸€ä¸ªç³»ç»Ÿä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å­˜å‚¨å•†å“ç…§ç‰‡ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬è¿˜å°†å­˜å‚¨è®°å½•æ‰€å±çš„å®ä½“ç±»çš„åç§°ã€‚ <br><br> è¯´èµ·é¸Ÿã€‚ å¦‚æœä½¿ç”¨.htaccessè¿›è¡Œå¤–éƒ¨è®¿é—®å…³é—­æ–‡ä»¶å¤¹ï¼Œåˆ™åªèƒ½é€šè¿‡è„šæœ¬è·å–æ–‡ä»¶ã€‚ å¹¶ä¸”å¯ä»¥åœ¨è„šæœ¬ä¸­ç¡®å®šå¯¹æ–‡ä»¶çš„è®¿é—®ã€‚ å±•æœ›æœªæ¥ï¼Œæˆ‘è¦è¯´çš„æ˜¯ï¼Œåœ¨CMSï¼ˆç°åœ¨æ­£åœ¨æŸ¥çœ‹ä¸Šè¿°é¡¹ç›®çš„åœ°æ–¹ï¼‰ä¸­ï¼Œè®¿é—®æƒé™æ˜¯ç”±åŸºæœ¬ç”¨æˆ·ç»„ç¡®å®šçš„ï¼Œæˆ‘æœ‰8ä½ç”¨æˆ·-æ¥å®¾ï¼Œç”¨æˆ·ï¼Œç®¡ç†å‘˜ï¼Œç®¡ç†å‘˜ï¼Œä¸æ´»åŠ¨ï¼Œå·²é˜»æ­¢ï¼Œå·²åˆ é™¤å’Œè¶…çº§ç®¡ç†å‘˜ã€‚ è¶…çº§ç®¡ç†å‘˜å¯ä»¥åšæ‰€æœ‰äº‹æƒ…ï¼Œå› æ­¤å®ƒä¸å‚ä¸ç¡®å®šè®¿é—®æƒé™ã€‚ å¦‚æœç”¨æˆ·å…·æœ‰è¶…çº§ç®¡ç†å‘˜æ ‡å¿—ï¼Œåˆ™ä»–æ˜¯è¶…çº§ç®¡ç†å‘˜ã€‚ ä¸€åˆ‡éƒ½å¾ˆç®€å•ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å°†ç¡®å®šå¯¹å…¶ä½™ä¸ƒä¸ªç»„çš„è®¿é—®æƒé™ã€‚ è®¿é—®å¾ˆç®€å•-æä¾›æ–‡ä»¶æˆ–ä¸æä¾›æ–‡ä»¶ã€‚ æ€»çš„æ¥è¯´ï¼Œæ‚¨å¯ä»¥è¾“å…¥<b>TINYINT</b>ç±»å‹çš„å­—æ®µã€‚ <br><br> è¿˜æœ‰ä¸€ä»¶äº‹ã€‚ æ ¹æ®æˆ‘ä»¬çš„æ³•å¾‹ï¼Œæˆ‘ä»¬å°†å¿…é¡»ç‰©ç†å­˜å‚¨è‡ªå®šä¹‰å›¾åƒã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬éœ€è¦ä»¥æŸç§æ–¹å¼å°†å›¾ç‰‡æ ‡è®°ä¸ºå·²åˆ é™¤ï¼Œè€Œä¸æ˜¯ç‰©ç†åˆ é™¤ã€‚ ä¸ºæ­¤ç›®çš„ä½¿ç”¨ä½å­—æ®µæ˜¯æœ€æ–¹ä¾¿çš„ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘é€šå¸¸ä½¿ç”¨<b>INT</b>ç±»å‹çš„å­—æ®µã€‚ å¯ä»¥ä¿ç•™ï¼Œå¯ä»¥è¿™ä¹ˆè¯´ã€‚ æ­¤å¤–ï¼Œæˆ‘å·²ç»å»ºç«‹äº†å°†<b>DELETED</b>æ ‡å¿—æ”¾åœ¨æœ«å°¾ç¬¬5ä½çš„ä¼ ç»Ÿã€‚ ä½†è¿™åˆæ²¡æœ‰å…³ç³»ã€‚ <br><br> ç»“æœæ˜¯ï¼š <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> <span class="hljs-string"><span class="hljs-string">`files`</span></span> ( <span class="hljs-string"><span class="hljs-string">`id`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">bigint</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span> auto_increment, <span class="hljs-comment"><span class="hljs-comment">--   `entity_type` char(32) not null default '', --   `entity` bigint null, -- ID  `mime` char(32) not null default '', -- MIME- `md5` char(32) not null default '', -- MD5 `sha1` char(40) not null default '', -- SHA1 `file` char(64) not null default '', --   `url` varchar(250) not null default '', -- URL `meta` text null, -- -   JSON    `size` bigint not null default '0', --  `created` datetime not null, --   `updated` datetime null, --   `access` tinyint not null default '0', --   `flags` int not null default '0', --  primary key (`id`), index (`entity_type`), index (`entity`), index (`mime`), index (`md5`), index (`sha1`), index (`url`) ) engine = InnoDB;</span></span></code> </pre> <br><h3> è°ƒåº¦å‘˜ç­ </h3><br> ç°åœ¨ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªç”¨äºä¸Šä¼ æ–‡ä»¶çš„ç±»ã€‚ è¯¥ç±»åº”å…·æœ‰åˆ›å»ºæ–‡ä»¶ï¼Œæ›¿æ¢/ä¿®æ”¹æ–‡ä»¶ï¼Œåˆ é™¤æ–‡ä»¶çš„èƒ½åŠ›ã€‚ å¦å¤–ï¼Œå€¼å¾—è€ƒè™‘ä¸¤ç‚¹ã€‚ é¦–å…ˆï¼Œé¡¹ç›®å¯ä»¥åœ¨æœåŠ¡å™¨ä¹‹é—´ä¼ è¾“ã€‚ å› æ­¤ï¼Œåœ¨è¯¥ç±»ä¸­ï¼Œæ‚¨éœ€è¦å®šä¹‰ä¸€ä¸ªåŒ…å«æ–‡ä»¶æ ¹ç›®å½•çš„å±æ€§ã€‚ å…¶æ¬¡ï¼Œå¦‚æœæœ‰äººåœ¨æ•°æ®åº“ä¸­æ•²ä¸€ä¸ªè¡¨å°†æ˜¯éå¸¸ä¸æ„‰å¿«çš„ã€‚ å› æ­¤ï¼Œæ‚¨éœ€è¦æä¾›æ•°æ®æ¢å¤çš„å¯èƒ½æ€§ã€‚ é¦–å…ˆï¼Œä¸€åˆ‡éƒ½åŸºæœ¬æ¸…æ¥šã€‚ è‡³äºæ•°æ®å¤‡ä»½ï¼Œæˆ‘ä»¬å°†åªä¿ç•™æ— æ³•æ¢å¤çš„å†…å®¹ã€‚ <br><br>  <b>ID-</b>ä»æ–‡ä»¶çš„ç‰©ç†ä½ç½®è¿˜åŸ <br>  <b>entity_type-</b>æœªè¿˜åŸ <br>  <b>å®ä½“</b> -æœªè¿˜åŸ <br>  MIME-ä½¿ç”¨finfoæ‰©å±•åè¿˜åŸ <br>  <b>md5-</b>ä»æ–‡ä»¶æœ¬èº«è¿˜åŸ <br>  <b>sha1-</b>ä»æ–‡ä»¶æœ¬èº«è¿˜åŸ <br>  <b>æ–‡ä»¶</b> -ä»<b>æ–‡ä»¶</b>çš„ç‰©ç†ä½ç½®è¿˜åŸ <br>  <b>ç½‘å€</b> -æœªè¿˜åŸ <br>  <b>å…ƒ</b> -æœªè¿˜åŸ <br>  <b>å¤§å°</b> -ä»æ–‡ä»¶æœ¬èº«è¿˜åŸ <br>  <b>å·²åˆ›å»º</b> -æ‚¨å¯ä»¥ä»æ–‡ä»¶ä¸­è·å–ä¿¡æ¯ <br>  <b>å·²æ›´æ–°</b> -æ‚¨å¯ä»¥ä»æ–‡ä»¶ä¸­è·å–ä¿¡æ¯ <br>  <b>è®¿é—®</b> -æœªè¿˜åŸ <br>  <b>æ ‡å¿—</b> -æœªè¿˜åŸ <br><br> æ‚¨å¯ä»¥ç«‹å³ä¸¢å¼ƒå…ƒä¿¡æ¯ã€‚ è¿™å¯¹ç³»ç»Ÿçš„åŠŸèƒ½å¹¶ä¸é‡è¦ã€‚ ä¸ºäº†æ›´å¿«åœ°æ¢å¤ï¼Œæ‚¨ä»ç„¶éœ€è¦ä¿å­˜MIMEç±»å‹ã€‚ æ€»è®¡ï¼šå®ä½“ç±»å‹ï¼Œå®ä½“IDï¼ŒMIMEï¼ŒURLï¼Œè®¿é—®å’Œæ ‡å¿—ã€‚ ä¸ºäº†æé«˜ç³»ç»Ÿçš„å¯é æ€§ï¼Œæˆ‘ä»¬å°†æ¯ä¸ªç›®æ ‡æ–‡ä»¶å¤¹çš„å¤‡ä»½ä¿¡æ¯åˆ†åˆ«å­˜å‚¨åœ¨æ–‡ä»¶å¤¹æœ¬èº«ä¸­ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">ç±»ä»£ç </b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BigFiles</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> FLAG_DELETED = <span class="hljs-number"><span class="hljs-number">0x08000000</span></span>; <span class="hljs-comment"><span class="hljs-comment">//    "" /** @var mysqli $_db */ protected $_db = null; protected $_webRoot = ''; protected $_realRoot = ''; function __construct(mysqli $db = null) { $this-&gt;_db = $db; } /** * /   URL- * @param string $v  * @return string */ public function webRoot($v = null) { if (!is_null($v)) { $this-&gt;_webRoot = $v; } return $this-&gt;_webRoot; } /** * /    * @param string $v  * @return string */ public function realRoot($v = null) { if (!is_null($v)) { $this-&gt;_realRoot = $v; } return $this-&gt;_realRoot; } /** *   * @param array $data   * @param string $url URL   * @param string $eType   * @param int $eID ID  * @param mixed $meta - * @param int $access  * @param int $flags  * @param int $fileID ID   * @return bool * @throws Exception */ public function upload(array $data, $url, $eType = '', $eID = null, $meta = null, $access = 127, $flags = 0, $fileID = 0) { $meta = is_array($meta) ? serialize($meta) : $meta; if (empty($data['tmp_name']) || empty($data['name'])) { $fid = intval($fileID); if (empty($fid)) { return false; } $meta = empty($meta) ? 'null' : "'" . $this-&gt;_db-&gt;real_escape_string($meta) . "'"; $q = "`meta`={$meta},`updated`=now()"; $this-&gt;_db-&gt;query("UPDATE `files` SET {$q} WHERE (`id` = {$fid}) AND (`entity_type` = '{$eType}')"); return $fid; } // File data $meta = empty($meta) ? 'null' : "'" . $this-&gt;_db-&gt;real_escape_string($meta) . "'"; $finfo = finfo_open(FILEINFO_MIME_TYPE); $mime = finfo_file($finfo , $data['tmp_name']); finfo_close($finfo); // FID, file name if (empty($fileID)) { $eID = empty($eID) ? 'null' : intval($eID); $q = &lt;&lt;&lt;sql insert into `files` set `mime` = '{$mime}', `entity` = {$eID}, `entityType` = '{$eType}', `created` = now(), `access` = {$access}, `flags` = {$flags} sql; $this-&gt;_db-&gt;query($q); $fid = $this-&gt;_db-&gt;insert_id; list($ffs, $fhn) = self::fid($fid); $url = $this-&gt;_webRoot . $url . '/' . $fid; $fdir = $this-&gt;_realRoot . $ffs; self::validateDir($fdir); $index = self::getIndex($fdir); $index[$fhn] = array($fhn, $mime, $url, ($eID == 'null' ? 0 : $eID), $access, $flags); self::setIndex($fdir, $index); $fname = $ffs . '/' . $fhn . '.file'; } else { $fid = intval($fileID); $fname = $this-&gt;fileName($fid); } // Move file $fdir = $this-&gt;_realRoot . $fname; if (!move_uploaded_file($data['tmp_name'], $fdir)) { throw new Exception('Upload error'); } $q = '`md5`=\'' . md5_file($fdir) . '\',`sha1`=\'' . sha1_file($fdir) . '\',' . '`size`=' . filesize($fdir) . ',`meta`=' . $meta . ',' . (empty($fileID) ? "`url`='{$url}',`file`='{$fname}'" : '`updated`=now()'); $this-&gt;_db-&gt;query("UPDATE `files` SET {$q} WHERE (`id` = {$fid}) AND (`entity_type` = '{$eType}')"); return $fid; } /** *   * @param string $url URL * @param string $basicGroup    * @throws Exception */ public function read($url, $basicGroup = 'anonimous') { if (!ctype_alnum(str_replace(array('/', '.', '-', '_'), '', $url))) { header('HTTP/1.1 400 Bad Request'); exit; } $url = $this-&gt;_db-&gt;real_escape_string($url); $q = "SELECT * FROM `files` WHERE `url` = '{$url}' ORDER BY `created` ASC"; if ($result = $this-&gt;_db-&gt;query($q)) { $vars = array(); $ints = array('id', 'entity', 'size', 'access', 'flags'); while ($row = $result-&gt;fetch_assoc()) { foreach ($ints as $i) { $row[$i] = intval($row[$i]); } $fid = $row['id']; $vars[$fid] = $row; } if (empty($vars)) { header('HTTP/1.1 404 Not Found'); exit; } $deleted = false; $access = true; $found = ''; $mime = ''; foreach ($vars as $fdata) { $flags = intval($fdata['flags']); $deleted = ($flags &amp; self::FLAG_DELETED) != 0; $access = self::granted($basicGroup, $fdata['access']); if (!$access || $deleted) { continue; } $found = $fdata['file']; $mime = $fdata['mime']; } if (empty($found)) { if ($deleted) { header('HTTP/1.1 410 Gone'); exit; } elseif (!$access) { header('HTTP/1.1 403 Forbidden'); exit; } } else { header('Content-type: ' . $mime . '; charset=utf-8'); readfile($this-&gt;_realRoot . $found); exit; } } header('HTTP/1.1 404 Not Found'); exit; } /** *   ()   * @param mixed $fid () * @return bool * @throws Exception */ public function delete($fid) { $fid = is_array($fid) ? implode(',', $fid) : $fid; $q = "delete from `table` where `id` in ({$fid})"; $this-&gt;_db-&gt;query($q); $result = true; foreach ($fid as $fid_i) { list($ffs, $fhn) = self::fid($fid_i); $fdir = $this-&gt;_realRoot . $ffs; $index = self::getIndex($fdir); unset($index[$fhn]); self::setIndex($fdir, $index); $result &amp;= unlink($fdir . '/'. $fhn . '.file'); } return $result; } /** *  ()  "" * @param int $fid () * @param bool $value   * @return bool */ public function setDeleted($fid, $value=true) { $fid = is_array($fid) ? implode(',', $fid) : $fid; $o = $value ? ' | ' . self::FLAG_DELETED : ' &amp; ' . (~self::FLAG_DELETED); $this-&gt;_db-&gt;query("update `files` set `flags` = `flags` {$o} where `id` in ({$fid})"); return true; } /** *   * @param int $fid  * @return string * @throws Exception */ public function fileName($fid) { list($ffs, $fhn) = self::fid($fid); self::validateDir($this-&gt;_realRoot . $ffs); return $ffs . '/' . $fhn . '.file'; } /** *   . *           . * @param int $fid   * @return array */ public static function fid($fid) { $ffs = str_split(str_pad(dechex($fid), 16, '0', STR_PAD_LEFT), 2); $fhn = array_pop($ffs); $ffs = implode('/', $ffs); return array($ffs, $fhn); } /** *    * @param string $f     * @return bool * @throws Exception */ public static function validateDir($f) { if (!is_dir($f)) { if (!mkdir($f, 0700, true)) { throw new Exception('cannot make dir: ' . $f); } } return true; } /** *    * @param string $f       * @return array */ public static function getIndex($f) { $index = array(); if (file_exists($f . '/.index')) { $_ = file($f . '/.index'); foreach ($_ as $_i) { $row = trim($_i); $row = explode('|', $row); array_walk($row, 'trim'); $rid = $row[0]; $index[$rid] = $row; } } return $index; } /** *    * @param string $f       * @param array $index    * @return bool */ public static function setIndex($f, array $index) { $_ = array(); foreach ($index as $row) { $_[] = implode('|', $row); } return file_put_contents($f . '/.index', implode("\r\n", $_)); } /** *   * @param string $group   (. ) * @param int $value   * @return bool */ public static function granted($group, $value=0) { $groups = array('anonimous', 'user', 'manager', 'admin', 'inactive', 'blocked', 'deleted'); if ($group == 'root') { return true; } foreach ($groups as $groupID =&gt; $groupName) { if ($groupName == $group) { return (((1 &lt;&lt; $groupID) &amp; $value) != 0); } } return false; } }</span></span></code> </pre> <br></div></div><br> è€ƒè™‘ä¸€äº›è¦ç‚¹ï¼š <br><br>  <b>-realRoot-</b>æ–‡ä»¶ç³»ç»Ÿä»¥æ–œæ ç»“å°¾çš„æ–‡ä»¶å¤¹çš„å®Œæ•´è·¯å¾„ã€‚ <br>  <b>-webRoot-</b>ä»ç«™ç‚¹æ ¹å¼€å§‹çš„è·¯å¾„ï¼Œä¸å¸¦æ–œæ ï¼ˆåŸå› è¯·å‚è§ä¸‹æ–‡ï¼‰ã€‚ <br>  -ä½œä¸ºDBMSï¼Œæˆ‘ä½¿ç”¨<b>MySQLi</b>æ‰©å±•ã€‚ <br>  -å®é™…ä¸Šï¼Œæ¥è‡ª<b>$ _FILES</b>æ•°ç»„çš„ä¿¡æ¯ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ä¼ é€’ç»™ä¸Š<b>è½½</b>æ–¹æ³•ã€‚ <br>  -å¦‚æœè°ƒç”¨<b>update</b>æ–¹æ³•ä¼ é€’ç°æœ‰æ–‡ä»¶çš„IDï¼Œåˆ™å¦‚æœ<b>tmp_nameä¸­</b>çš„è¾“å…¥æ•°ç»„ä¸ä¸ºç©ºï¼Œå®ƒå°†è¢«æ›¿æ¢ã€‚ <br>  -æ‚¨å¯ä»¥ä¸€æ¬¡åˆ é™¤å’Œæ›´æ”¹å¤šä¸ªæ–‡ä»¶çš„æ ‡å¿—ã€‚ ä¸ºæ­¤ï¼Œæ‚¨å¿…é¡»ä¼ é€’å¸¦æœ‰æ ‡è¯†ç¬¦çš„æ•°ç»„æˆ–åŒ…å«æ ‡è¯†ç¬¦çš„å­—ç¬¦ä¸²ï¼Œå¹¶ç”¨é€—å·åˆ†éš”ï¼Œè€Œä¸æ˜¯ä¼ é€’æ–‡ä»¶æ ‡è¯†ç¬¦ã€‚ <br><br><h3> è·¯ç”±é€‰æ‹© </h3><br> å®é™…ä¸Šï¼Œå®ƒå¯ä»¥å½’ç»“ä¸ºç«™ç‚¹æ ¹ç›®å½•ä¸‹htaccessä¸­çš„å‡ è¡Œï¼ˆå‡å®šå·²å¯ç”¨mod_rewriteï¼‰ï¼š <br><br><pre> <code class="apache hljs"><span class="hljs-attribute"><span class="hljs-nomarkup"><span class="hljs-attribute"><span class="hljs-nomarkup">RewriteCond</span></span></span></span> <span class="hljs-variable"><span class="hljs-variable">%{REQUEST_URI}</span></span> ^/content/(.*)$ RewriteCond <span class="hljs-variable"><span class="hljs-variable">%{REQUEST_FILENAME}</span></span> !-f RewriteRule ^(.+)$ content/index.php?file=<span class="hljs-number"><span class="hljs-number">$1</span></span><span class="hljs-meta"><span class="hljs-meta"> [L,QSA]</span></span></code> </pre> <br> å°±æˆ‘è€Œè¨€ï¼Œâ€œå†…å®¹â€æ˜¯ç½‘ç«™æ ¹ç›®å½•ä¸­çš„æ–‡ä»¶å¤¹ã€‚ å½“ç„¶ï¼Œæ‚¨å¯ä»¥ä¸ºæ–‡ä»¶å¤¹å‘½åä¸åŒã€‚ å½“ç„¶è¿˜æœ‰index.phpæœ¬èº«ï¼Œä»¥æˆ‘çš„æƒ…å†µå­˜å‚¨åœ¨å†…å®¹æ–‡ä»¶å¤¹ä¸­ï¼š <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> $dbHost = <span class="hljs-string"><span class="hljs-string">'127.0.0.1'</span></span>; $dbUser = <span class="hljs-string"><span class="hljs-string">'user'</span></span>; $dbPass = <span class="hljs-string"><span class="hljs-string">'****'</span></span>; $dbName = <span class="hljs-string"><span class="hljs-string">'database'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>($_REQUEST[<span class="hljs-string"><span class="hljs-string">'file'</span></span>])) { header(<span class="hljs-string"><span class="hljs-string">'HTTP/1.1 400 Bad Request'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span>; } $userG = <span class="hljs-string"><span class="hljs-string">'anonimous'</span></span>; <span class="hljs-comment"><span class="hljs-comment">//      ;      $files = new BigFiles(new mysqli($dbHost,$dbUser,$dbPass,$dbName)); $files-&gt;realRoot(dirname(__FILE__).'/files/'); $files-&gt;read($_REQUEST['file'],$userG); } catch (Exception $e) { header('HTTP/1.1 500 Internal Error'); header('Content-Type: text/plain; charset=utf-8'); echo $e-&gt;getMessage(); exit; }</span></span></code> </pre><br> å¥½å§ï¼Œå°±å…¶æœ¬èº«è€Œè¨€ï¼Œæˆ‘ä»¬ä»å¤–éƒ¨è®¿é—®ä¸­å…³é—­æ–‡ä»¶ç³»ç»Ÿæœ¬èº«ã€‚ å°†<code>.htaccess</code>æ–‡ä»¶æ”¾åœ¨<code>content/files</code>å¤¹çš„æ ¹ç›®å½•ä¸­ï¼Œåªéœ€ä¸€è¡Œï¼š <br><br><pre> <code class="apache hljs"><span class="hljs-attribute"><span class="hljs-nomarkup"><span class="hljs-attribute"><span class="hljs-nomarkup">Deny</span></span></span></span> from <span class="hljs-literal"><span class="hljs-literal">all</span></span></code> </pre> <br><h3> æ€»ç»“ </h3><br> é€šè¿‡æ­¤è§£å†³æ–¹æ¡ˆï¼Œå¯ä»¥é¿å…ç”±äºæ–‡ä»¶æ•°é‡å¢åŠ è€Œå¯¼è‡´æ–‡ä»¶ç³»ç»Ÿæ€§èƒ½ä¸‹é™ã€‚ è‡³å°‘å¯ä»¥è‚¯å®šåœ°é¿å…ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸­æˆåƒä¸Šä¸‡ä¸ªæ–‡ä»¶å½¢å¼çš„éº»çƒ¦ã€‚ åŒæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ç»„ç»‡å’Œæ§åˆ¶å¯¹äººç±»å¯è¯»åœ°å€æ–‡ä»¶çš„è®¿é—®ã€‚ è¿˜è¦éµå®ˆæˆ‘ä»¬ä»¤äººæ²®ä¸§çš„æ³•å¾‹ã€‚ ç«‹å³é¢„è®¢ï¼Œæ­¤è§£å†³æ–¹æ¡ˆä¸æ˜¯ä¿æŠ¤å†…å®¹çš„å®Œæ•´æ–¹æ³•ã€‚ è¯·è®°ä½ï¼šå¦‚æœæµè§ˆå™¨ä¸­æ’­æ”¾äº†æŸäº›å†…å®¹ï¼Œåˆ™å¯ä»¥å…è´¹ä¸‹è½½ã€‚ </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN423875/">https://habr.com/ru/post/zh-CN423875/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN423865/index.html">Roskomnadzorå…¬å¼€æŠ¥é“</a></li>
<li><a href="../zh-CN423867/index.html">3Dæ‰“å°å·¥ä½œå®¤çš„åˆ›å§‹äºº-å…³äºä»–çš„å·¥ä½œ</a></li>
<li><a href="../zh-CN423869/index.html">å·¥ä½œçš„æœªæ¥ã€‚ ä¸–ç•Œç»æµè®ºå›æŠ¥å‘Šçš„ä¸»è¦å†…å®¹</a></li>
<li><a href="../zh-CN423871/index.html">æˆ‘ä»¬ç”¨SQLè§£å†³å­¦ç”Ÿçš„é€»è¾‘é—®é¢˜</a></li>
<li><a href="../zh-CN423873/index.html">PICASO 3D Designer X 3Dæ‰“å°æœºæ¦‚è¿°</a></li>
<li><a href="../zh-CN423877/index.html">10æœˆ29æ—¥è‡³31æ—¥ï¼šåˆ›å»ºå¯æŠ•å…¥ç”Ÿäº§çš„Kubernetesé›†ç¾¤</a></li>
<li><a href="../zh-CN423879/index.html">å‘æ—§æ¡†æ¶æ·»åŠ æ–°åŠŸèƒ½æ˜¯å¦å®¹æ˜“ï¼Ÿ é¢ç²‰çš„é€‰æ‹©ï¼Œä»¥SObjectizerå¼€å‘ä¸ºä¾‹</a></li>
<li><a href="../zh-CN423881/index.html">ä»€ä¹ˆæ˜¯å…‰å­¦ç„Šæœºï¼ˆç¬¬äºŒéƒ¨åˆ†ï¼‰</a></li>
<li><a href="../zh-CN423885/index.html">é‚€è¯·å‚åŠ ä¸€åœºç¯å…‰ç§€å’Œè«æ–¯ç§‘æœªæ¥çš„Circle of Lightå¹³å°çš„ä¸€äº›å†…éƒ¨äººå£«</a></li>
<li><a href="../zh-CN423889/index.html">æˆ‘å¯¹è½¯ä»¶çš„å¤±æœ›</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>