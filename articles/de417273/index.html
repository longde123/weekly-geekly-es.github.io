<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë¥üèª üë©üèª‚Äçüéì üßëüèª Realisierung eines Voice Guides basierend auf YandexSpeechKit ‚õπüèΩ üèöÔ∏è üõãÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Verschiedene Implementierungen werden im Internet vorgestellt, aber meiner Meinung nach sind sie alle recht einfach. Ich m√∂chte meine Version des Spra...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Realisierung eines Voice Guides basierend auf YandexSpeechKit</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/417273/"><p>  Verschiedene Implementierungen werden im Internet vorgestellt, aber meiner Meinung nach sind sie alle recht einfach.  Ich m√∂chte meine Version des Sprachf√ºhrers als Sternchen pr√§sentieren. </p><br><p>  <em>Hinweis:</em> Ich bin kein professioneller Programmierer, und vielleicht erscheinen Ihnen einige L√∂sungen wild.  Einige Tricks sind m√∂glicherweise veraltet.  Ich bin bereit, Kritik anzunehmen und das System zum Besseren zu reparieren. </p><br><p>  <strong>Kurze Beschreibung der Funktionen:</strong> </p><br><p>  Der Benutzer gibt den IVR ein, stellt seine Anfrage und gelangt in den meisten F√§llen dorthin, wo er ben√∂tigt wird.  Statistiken werden auch mit einem Eintrag in der MySQL-Tabelle an das System angeschraubt. <br>  Kurz √ºber das Unternehmen und das Netzwerk, in dem dieses System bereitgestellt wird: <br>  ~ 1000 Telefone, ungef√§hr 50 Abteilungen </p><a name="habracut"></a><br><p>  <strong>Vom System verwendete Softwareprodukte:</strong> </p><br><ul><li>  Sternchen 13.10 </li><li>  YandexSpeechKit </li><li>  Python 2.6.6 </li><li>  MySQL, MSSQL </li><li>  sox 14.2.0 </li><li>  Locken 7.19.7 </li><li>  lahm 3.99.5 </li></ul><br><p>  <strong>Beschreibung des W√§hlplans in einem Sternchen.</strong> </p><br><pre><code class="hljs php">[officevoicerec] exten =&gt; s,<span class="hljs-number"><span class="hljs-number">1</span></span>,Answer() same =&gt; n,Macro(hangercheck,${CALLERID(num)}) same =&gt; n,Set(ITERATIONS=<span class="hljs-number"><span class="hljs-number">1</span></span>) same =&gt; n,Set(HANGFLAG=<span class="hljs-keyword"><span class="hljs-keyword">TRUE</span></span>) same =&gt; n,Background(/<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>/lib/asterisk/sounds/ru/speechrec/zdravstvuite)</code> </pre> <br><p>  In diesem Fragment wird ein Makro gestartet, um zu √ºberpr√ºfen, ob der Anrufer unmittelbar nach dem H√∂ren einer Begr√º√üungsnachricht aufgelegt hat.  Als n√§chstes wird der Wert der Variablen festgelegt: <br>  ITERATIONEN - erforderlich, um den Erkennungsprozess f√ºr eine bestimmte Anzahl von Malen zu wiederholen.  HANGFLAG - Diese Variable wird vom Hangercheck-Makro verwendet. </p><br><pre> <code class="hljs ruby">same =&gt; n(rec),Set(RECFILE=<span class="hljs-regexp"><span class="hljs-regexp">/tmp/</span></span>${UNIQUEID}.wav) same =&gt; n,Playback(<span class="hljs-regexp"><span class="hljs-regexp">/var/lib</span></span><span class="hljs-regexp"><span class="hljs-regexp">/asterisk/sounds</span></span><span class="hljs-regexp"><span class="hljs-regexp">/en/beep</span></span>) same =&gt; n,Record(${RECFILE},<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">8</span></span>) same =&gt; n,AGI(pyreq8.py,${RECFILE}) same =&gt; n,GotoIf($[<span class="hljs-string"><span class="hljs-string">"${NUMTOCALL}"</span></span> = <span class="hljs-string"><span class="hljs-string">"repeat"</span></span>]?repeat) same =&gt; n,Set(HANGFLAG=FALSE)</code> </pre> <br><p>  Legen Sie die Variable f√ºr die Aufzeichnungsdatei fest und schreiben Sie die Datei.  Wir f√ºhren ein agi-Skript aus, das f√ºr das Senden der Datei zur Erkennung und Nummernsuche verantwortlich ist (das Skript wird sp√§ter beschrieben), √ºberpr√ºfen die Variable NUMTOCALL (der Wert wird vom Skript festgelegt) und setzen das Zeichen HANGFLAG, was bedeutet, dass die Person nicht vorzeitig aufgelegt hat. </p><br><pre> <code class="hljs powershell">same =&gt; n,Macro(VRstat,<span class="hljs-variable"><span class="hljs-variable">$</span></span>{CALLERID(num)},<span class="hljs-variable"><span class="hljs-variable">$</span></span>{NUMTOCALL},<span class="hljs-variable"><span class="hljs-variable">$</span></span>{RSTATUS},<span class="hljs-variable"><span class="hljs-variable">$</span></span>{CHANNEL},<span class="hljs-variable"><span class="hljs-variable">$</span></span>{RECREZ}) same =&gt; n,GotoIf(<span class="hljs-variable"><span class="hljs-variable">$</span></span>[[<span class="hljs-variable"><span class="hljs-variable">$</span></span>{<span class="hljs-type"><span class="hljs-type">EXISTS</span></span>(<span class="hljs-variable"><span class="hljs-variable">$</span></span>{<span class="hljs-type"><span class="hljs-type">FNAME</span></span>})}]]?foundName:havenodescr) same =&gt; n(foundName),Set(FILE_FNAME=<span class="hljs-variable"><span class="hljs-variable">$</span></span>{STRREPLACE(FNAME, ,)}) same =&gt; n,GotoIf(<span class="hljs-variable"><span class="hljs-variable">$</span></span>[<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$</span></span></span><span class="hljs-string">{STAT(f,/var/lib/asterisk/sounds/ru/cache/</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$</span></span></span><span class="hljs-string">{FILE_FNAME}.mp3)}"</span></span>=<span class="hljs-string"><span class="hljs-string">"1"</span></span>]?havecache:nocache)</code> </pre> <br><p>  In diesem Fragment wird ein Makro ausgef√ºhrt, um zu √ºberpr√ºfen, ob der Anrufer aufgelegt hat, nachdem er die Begr√º√üungsnachricht geh√∂rt hat. Anschlie√üend werden die Variablen festgelegt. ITERATIONS ist erforderlich, um den Erkennungsprozess eine bestimmte Anzahl von Malen zu wiederholen.  HANGFLAG - Diese Variable wird vom Hangercheck-Makro verwendet. </p><br><pre> <code class="hljs ruby">same =&gt; n(rec),Set(RECFILE=<span class="hljs-regexp"><span class="hljs-regexp">/tmp/</span></span>${UNIQUEID}.wav) same =&gt; n,Playback(<span class="hljs-regexp"><span class="hljs-regexp">/var/lib</span></span><span class="hljs-regexp"><span class="hljs-regexp">/asterisk/sounds</span></span><span class="hljs-regexp"><span class="hljs-regexp">/en/beep</span></span>) same =&gt; n,Record(${RECFILE},<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">8</span></span>) same =&gt; n,AGI(pyreq8.py,${RECFILE}) same =&gt; n,GotoIf($[<span class="hljs-string"><span class="hljs-string">"${NUMTOCALL}"</span></span> = <span class="hljs-string"><span class="hljs-string">"repeat"</span></span>]?repeat) same =&gt; n,Set(HANGFLAG=FALSE)</code> </pre> <br><p>  Legen Sie die Variable f√ºr die Aufzeichnungsdatei fest und schreiben Sie die Datei.  Wir starten das Skript, das f√ºr das Senden der Datei zur Erkennung verantwortlich ist, und suchen nach der Nummer (die Beschreibung des Skripts finden Sie unten), √ºberpr√ºfen die Variable NUMTOCALL (der Wert wird vom Skript festgelegt) und setzen das Zeichen HANGFLAG, dass die Person nicht vorzeitig aufgelegt hat. </p><br><pre> <code class="hljs powershell">same =&gt; n,Macro(VRstat,<span class="hljs-variable"><span class="hljs-variable">$</span></span>{CALLERID(num)},<span class="hljs-variable"><span class="hljs-variable">$</span></span>{NUMTOCALL},<span class="hljs-variable"><span class="hljs-variable">$</span></span>{RSTATUS},<span class="hljs-variable"><span class="hljs-variable">$</span></span>{CHANNEL},<span class="hljs-variable"><span class="hljs-variable">$</span></span>{RECREZ}) same =&gt; n,GotoIf(<span class="hljs-variable"><span class="hljs-variable">$</span></span>[[<span class="hljs-variable"><span class="hljs-variable">$</span></span>{<span class="hljs-type"><span class="hljs-type">EXISTS</span></span>(<span class="hljs-variable"><span class="hljs-variable">$</span></span>{<span class="hljs-type"><span class="hljs-type">FNAME</span></span>})}]]?foundName:havenodescr) same =&gt; n(foundName),Set(FILE_FNAME=<span class="hljs-variable"><span class="hljs-variable">$</span></span>{STRREPLACE(FNAME, ,)}) same =&gt; n,GotoIf(<span class="hljs-variable"><span class="hljs-variable">$</span></span>[<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$</span></span></span><span class="hljs-string">{STAT(f,/var/lib/asterisk/sounds/ru/cache/</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$</span></span></span><span class="hljs-string">{FILE_FNAME}.mp3)}"</span></span>=<span class="hljs-string"><span class="hljs-string">"1"</span></span>]?havecache:nocache) same =&gt; n(nocache),System(curl <span class="hljs-string"><span class="hljs-string">"https://tts.voicetech.yandex.net/generate?format=mp3&amp;lang=ru-RU&amp;speaker=zahar&amp;emotion=neutral&amp;speed=0.8&amp;key="</span></span> <span class="hljs-literal"><span class="hljs-literal">-G</span></span> -<span class="hljs-literal"><span class="hljs-literal">-data</span></span><span class="hljs-literal"><span class="hljs-literal">-urlencode</span></span> <span class="hljs-string"><span class="hljs-string">"text= </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$</span></span></span><span class="hljs-string">{FNAME}."</span></span> &gt; /tmp/speech-<span class="hljs-variable"><span class="hljs-variable">$</span></span>{UNIQUEID}.mp3) same =&gt; n,System(/usr/local/bin/lame <span class="hljs-literal"><span class="hljs-literal">-S</span></span> -<span class="hljs-literal"><span class="hljs-literal">-scale</span></span> <span class="hljs-number"><span class="hljs-number">30</span></span> /tmp/speech-<span class="hljs-variable"><span class="hljs-variable">$</span></span>{UNIQUEID}.mp3 /var/lib/asterisk/sounds/ru/cache/<span class="hljs-variable"><span class="hljs-variable">$</span></span>{FILE_FNAME}.mp3) same =&gt; n(havecache),Playback(/var/lib/asterisk/sounds/ru/cache/<span class="hljs-variable"><span class="hljs-variable">$</span></span>{FILE_FNAME}) same =&gt; n,Dial(Local/<span class="hljs-variable"><span class="hljs-variable">$</span></span>{NUMTOCALL}@common<span class="hljs-literal"><span class="hljs-literal">-context</span></span>)</code> </pre> <br><p>  Das Ausf√ºhren des vrstat-Makros (verantwortlich f√ºr Statistiken, wird aufgrund seiner Trivialit√§t nicht beschrieben).  √úberpr√ºfen Sie, ob die FNAME-Beschreibung (die Variable wird von pyreq8.py festgelegt) der Anforderung vorhanden ist.  Wenn eine Beschreibung vorhanden ist, legen Sie den Namen der Cache-Datei in der Variablen fest und √ºberpr√ºfen Sie deren Vorhandensein.  Wenn die Datei nicht vorhanden ist, synthetisieren wir sie, konvertieren sie in MP3, erh√∂hen die Lautst√§rke und spielen sie dann (oder wenn der Cache vorhanden ist) ab und rufen den Abonnenten an. </p><br><pre> <code class="hljs powershell">same =&gt; n(repeat),GotoIf(<span class="hljs-variable"><span class="hljs-variable">$</span></span>[<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$</span></span></span><span class="hljs-string">{ITERATIONS}"</span></span>=<span class="hljs-string"><span class="hljs-string">"1"</span></span>]?secretary) same =&gt; n,Background(/var/lib/asterisk/sounds/ru/speechrec/<span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-literal"><span class="hljs-literal">-wav</span></span>) same =&gt; n,Set(ITERATIONS=<span class="hljs-variable"><span class="hljs-variable">$</span></span>[<span class="hljs-variable"><span class="hljs-variable">$</span></span>{<span class="hljs-type"><span class="hljs-type">ITERATIONS</span></span>}+<span class="hljs-number"><span class="hljs-number">1</span></span>]) same =&gt; n,Goto(rec)</code> </pre> <br><p>  Wiederholen Sie die Erkennung.  Wenn die Anzahl der Iterationen die angegebene √ºberschreitet, √ºbersetzen wir in Sekret√§re. </p><br><pre> <code class="hljs cmake"> same =&gt; n(secretary),<span class="hljs-keyword"><span class="hljs-keyword">Macro</span></span>(VRstat,<span class="hljs-variable"><span class="hljs-variable">${CALLERID(num)}</span></span>,<span class="hljs-variable"><span class="hljs-variable">${NUMTOCALL}</span></span>,<span class="hljs-variable"><span class="hljs-variable">${RSTATUS}</span></span>,<span class="hljs-variable"><span class="hljs-variable">${CHANNEL}</span></span>,<span class="hljs-variable"><span class="hljs-variable">${RECREZ}</span></span>) same =&gt; n,<span class="hljs-keyword"><span class="hljs-keyword">Set</span></span>(HANGFLAG=<span class="hljs-keyword"><span class="hljs-keyword">FALSE</span></span>) same =&gt; n,Dial(Local/<span class="hljs-number"><span class="hljs-number">1000</span></span>@common-context)</code> </pre> <br><p>  √úbergabe an Sekret√§re.  Wir geben in die Statistik ein, setzen das Flag, dass sie nicht aufgelegt haben.  Wir rufen die Sekret√§rin an. </p><br><pre> <code class="hljs ruby">same =&gt; n(havenodescr),Playback(<span class="hljs-regexp"><span class="hljs-regexp">/var/lib</span></span><span class="hljs-regexp"><span class="hljs-regexp">/asterisk/sounds</span></span><span class="hljs-regexp"><span class="hljs-regexp">/ru/speechrec</span></span><span class="hljs-regexp"><span class="hljs-regexp">/wait2);thanks-wait) same =&gt; n,Noop('no description') same =&gt; n,Dial(Local/</span></span>${NUMTOCALL}@common-context) same =&gt; n,Hangup()</code> </pre> <br><p>  Rufen Sie einen Teilnehmer an, der keine Beschreibung im Verzeichnis hat.  Wir verlieren die Nachricht, geben sie in die Statistik ein und rufen sie an. </p><br><pre> <code class="hljs bash">exten =&gt; h,1,Gotoif($[<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${HANGFLAG}</span></span></span><span class="hljs-string">"</span></span>=<span class="hljs-string"><span class="hljs-string">"TRUE"</span></span>]?<span class="hljs-built_in"><span class="hljs-built_in">exec</span></span>:noop) same =&gt; n(<span class="hljs-built_in"><span class="hljs-built_in">exec</span></span>),Macro(VRstat,<span class="hljs-variable"><span class="hljs-variable">${CALLERID(num)}</span></span>,x,HANGER,<span class="hljs-variable"><span class="hljs-variable">${CHANNEL}</span></span>) same =&gt; n(noop),Noop(<span class="hljs-string"><span class="hljs-string">'exiting'</span></span>)</code> </pre> <br><p>  Anrufbeendigungsverarbeitung f√ºr die Hangercheck-Makrooperation. </p><br><p>  <strong>W√§hlplan Beschreibung.</strong>  <strong>Makros.</strong> </p><br><pre> <code class="hljs powershell">[<span class="hljs-type"><span class="hljs-type">macro</span></span>-<span class="hljs-type"><span class="hljs-type">hangercheck</span></span>] ;<span class="hljs-variable"><span class="hljs-variable">$</span></span>{ARG1} <span class="hljs-literal"><span class="hljs-literal">-clid</span></span> exten =&gt; s,<span class="hljs-number"><span class="hljs-number">1</span></span>,GotoIf(<span class="hljs-variable"><span class="hljs-variable">$</span></span>[<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$</span></span></span><span class="hljs-string">{ARG1}"</span></span>=<span class="hljs-string"><span class="hljs-string">"anonymous"</span></span>]?<span class="hljs-keyword"><span class="hljs-keyword">end</span></span>) exten =&gt; s,n,MYSQL(Connect connid SRV user password db utf8) exten =&gt; s,n,MYSQL(SET NAMES utf8) exten =&gt; s,n,MYSQL(Query resultid <span class="hljs-variable"><span class="hljs-variable">$</span></span>{connid} SELECT IFNULL((SELECT clid from ivr_stat where rstatus=<span class="hljs-string"><span class="hljs-string">"HANGER"</span></span> and calldate &gt;=ADDDATE(NOW(),INTERVAL <span class="hljs-literal"><span class="hljs-literal">-48</span></span> HOUR) and clid=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$</span></span></span><span class="hljs-string">{ARG1}"</span></span> order by calldate desc limit <span class="hljs-number"><span class="hljs-number">1</span></span>),<span class="hljs-string"><span class="hljs-string">"NF"</span></span>)) exten =&gt; s,n,MYSQL(Fetch fetchid <span class="hljs-variable"><span class="hljs-variable">$</span></span>{resultid} VAR) exten =&gt; s,n,MYSQL(Clear <span class="hljs-variable"><span class="hljs-variable">$</span></span>{resultid}) exten =&gt; s,n,MYSQL(Disconnect <span class="hljs-variable"><span class="hljs-variable">$</span></span>{connid}) exten =&gt; s,n,GotoIf(<span class="hljs-variable"><span class="hljs-variable">$</span></span>[<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$</span></span></span><span class="hljs-string">{VAR}"</span></span>=<span class="hljs-string"><span class="hljs-string">"NF"</span></span>]?<span class="hljs-keyword"><span class="hljs-keyword">end</span></span>) exten =&gt; s,n,Macro(VRstat,<span class="hljs-variable"><span class="hljs-variable">$</span></span>{ARG1},x,H_RECALL,<span class="hljs-variable"><span class="hljs-variable">$</span></span>{CHANNEL}) exten =&gt; s,n,Dial(Local/<span class="hljs-number"><span class="hljs-number">1000</span></span>@common<span class="hljs-literal"><span class="hljs-literal">-context</span></span>) exten =&gt; s,n,Hangup() exten =&gt; s,n(<span class="hljs-keyword"><span class="hljs-keyword">end</span></span>),Noop(Hanger check failed)</code> </pre> <br><p>  Wir √ºberpr√ºfen in der Statistikdatenbank, ob die angegebene Nummer die letzten 48 Stunden angerufen hat. Wenn er aufgelegt hat, ohne auf die Erkennung zu warten, geben wir sie in die Statistik ein und verbinden sie mit der Sekret√§rin. </p><br><p>  <strong>Kurze Beschreibung der verwendeten SQL- und MySQL-Tabellen.</strong> </p><br><p>  SQL-Tabelle dbo.phrases. </p><br><p> <code>id(PK, int), phrase (text), number(varchar(50))</code> </p> <br><p>  F√ºr diese Tabelle wurde eine Volltextsuche gestartet, mit der beim Empfang einer langen Phrase nach Schl√ºsselw√∂rtern gewechselt wird.  Beispiel: "Bitte verbinden Sie mich mit einem Vertreter der Werbeabteilung". Wenn in der Datenbank ein Eintrag mit dem Satz "Werbeabteilung" vorhanden ist, wird der Anrufer mit der entsprechenden Nummer verbunden. </p><br><p>  MySQL-Tabelle recogStats. </p><br><p> <code>id(PK, int), date (datetime), ctime(float), rtime(float),stime(float), phrase(varchar(60))</code> </p> <br><p>  In dieser Tabelle werden Erkennungsergebnisse gespeichert und Statistiken zur Erkennungszeit erfasst.  ctime - Zeit f√ºr das Konvertieren der Audiodatei, rtime - Zeit f√ºr das Herunterladen und Erkennen, stime - Zeit f√ºr die Suche </p><br><p>  MySQL-Tabelle ivr_stat. </p><br><p> <code>id(PK, int), calldate (datetime),clid(varchar(15)),duration(int(20)),callednum(varchar(10)),rstatus(varchar(20)),channame(varchar30)),RECREZ(varchar(200))</code> </p> <br><p>  Diese Tabelle wird verwendet, um die Erkennungsergebnisse (RECREZ, rstatus) zu verfolgen, zu denen der Anrufer gem√§√ü den Suchergebnissen f√ºr die erkannte Phrase (callnum) gegangen ist, um zu verfolgen, wie viel Zeit eine Person im Erkennungsmen√º verbracht hat (Dauer) und um Fehler zu beheben (Kanalname). </p><br><p>  MySQL CustomRequests Tabelle. </p><br><p> <code>id(PK, int), nomer(int(10)), request(varchar(100))</code> <br>  Ein Hilfsverzeichnis mit zus√§tzlichen Gruppen und Abteilungen. </p><br><p>  MySQL-Nummernbeschreibungstabelle. </p><br><p> <code>Num(text), name(text)</code> </p> <br><p>  Verzeichnis mit der Beschreibung der eingegebenen Nummer f√ºr die Sprachausgabe. </p><br><p>  MySQL-Tabellen spravochnik_rus und spravochnik_rus_name_num_no_tops </p><br><p> <code>nomer(varchar(11)), fio(varchar(100))</code> </p> <br><p>  Referenzpersonen mit Nummern.  Die erste ist f√ºr den internen Gebrauch vollst√§ndig.  Die zweite, f√ºr den externen Gebrauch, ist die Anzahl der Direktoren und Manager in einem Sekretariat zusammengefasst. </p><br><p>  <strong>AGI-Skript, das erkannte Phrasen konvertiert, sendet und nach ihnen sucht.</strong> </p><br><p>  Verwendete Bibliotheken: </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> difflib <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> sys <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> exit <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> uuid <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> time <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> os <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> subprocess <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> xml.etree.ElementTree <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> MySQLdb <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pymssql <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> string <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> re <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> itertools <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> permutations <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> os <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> remove <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> timeit</code> </pre> <br><p>  Und auch die <strong>asterisk.agi-</strong> Bibliothek, die wir je nach Debugging importieren (das Debuggen erfolgt auf einem Windows-Computer). </p><br><p>  <strong>Beschreibung der Variablen.</strong> </p><br><pre> <code class="python hljs">WINDEBUG = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span></code> </pre> <br><p>  Debug-Flag </p><br><pre> <code class="python hljs">_digits = re.compile(<span class="hljs-string"><span class="hljs-string">'\d'</span></span>)</code> </pre> <br><p>  Variable f√ºr regul√§re Ausdr√ºcke in Zahlen kompiliert. </p><br><pre> <code class="python hljs">uniqid = str(uuid.uuid1()).replace(<span class="hljs-string"><span class="hljs-string">'-'</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>)</code> </pre> <br><p>  Eindeutige Bezeichnungsvariable. </p><br><pre> <code class="python hljs">dkey = <span class="hljs-string"><span class="hljs-string">'12345678-9101-1121-3141-51617181920'</span></span></code> </pre> <br><p>  Yandex Speech Kit API-Schl√ºssel. </p><br><pre> <code class="python hljs">lang = <span class="hljs-string"><span class="hljs-string">'ru-RU'</span></span></code> </pre> <br><p>  Sprachoption f√ºr Yandex Speechkit. </p><br><pre> <code class="python hljs">topic = <span class="hljs-string"><span class="hljs-string">'queries'</span></span></code> </pre> <br><p>  Option f√ºr das Erkennungsthema f√ºr das Yandex-Sprachkit. </p><br><pre> <code class="python hljs">callnumber = <span class="hljs-string"><span class="hljs-string">'222'</span></span></code> </pre> <br><p>  Die Standardanrufnummer. </p><br><pre> <code class="python hljs">setVar(<span class="hljs-string"><span class="hljs-string">'NUMTOCALL'</span></span>, callnumber)</code> </pre> <br><p>  Festlegen der Standard-Rufnummer f√ºr den Fall, dass etwas schief geht. </p><br><pre> <code class="python hljs">persondic = dict()</code> </pre> <br><p>  W√∂rterbuchname - Nummer. </p><br><pre> <code class="python hljs">persondicFI=dict()</code> </pre> <br><p>  FI Dictionary - Nummer. </p><br><pre> <code class="python hljs">persondicF=dict()</code> </pre> <br><p>  W√∂rterbuch Nachname - Nummer. </p><br><pre> <code class="python hljs">otherdic = dict()</code> </pre> <br><p>  Ein W√∂rterbuch mit anderen Eintr√§gen der Form Datensatznummer. </p><br><pre> <code class="python hljs">descriptions = dict()</code> </pre> <br><p>  W√∂rterbuch mit Beschreibungen zur Erzeugung von Sprachausgabe, Typ Datensatznummer. </p><br><pre> <code class="python hljs">duplicates = list()</code> </pre> <br><p>  Serviceliste zum Filtern dauert. </p><br><pre> <code class="python hljs">nums = list()</code> </pre> <br><p>  Liste mit allen Erweiterungen. </p><br><pre> <code class="python hljs">outfile = <span class="hljs-string"><span class="hljs-string">'/tmp/'</span></span> + uniqid + <span class="hljs-string"><span class="hljs-string">'-pcm.wav'</span></span></code> </pre> <br><p>  Variable Audiodatei mit tempor√§rer Ausgabe. </p><br><pre> <code class="python hljs">mysqlhost=<span class="hljs-string"><span class="hljs-string">'myhost'</span></span> mysqlpass=<span class="hljs-string"><span class="hljs-string">'mypass'</span></span> mysqluser=<span class="hljs-string"><span class="hljs-string">'myuser'</span></span> mysqldb=<span class="hljs-string"><span class="hljs-string">'mydb'</span></span> mssqlhost=<span class="hljs-string"><span class="hljs-string">'mshost'</span></span> mssqlpass=<span class="hljs-string"><span class="hljs-string">'mspass'</span></span> mssqluser=<span class="hljs-string"><span class="hljs-string">'msuser'</span></span> mssqldb=<span class="hljs-string"><span class="hljs-string">'msdb'</span></span></code> </pre> <br><p>  Details zum Herstellen einer Verbindung zu MySQL und MSSQL. </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> WINDEBUG: <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> asterisk.agi <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * agi = AGI() infile = agi.env[<span class="hljs-string"><span class="hljs-string">'agi_arg_1'</span></span>] caller = agi.get_variable(<span class="hljs-string"><span class="hljs-string">'CALLERID(num)'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: caller = <span class="hljs-string"><span class="hljs-string">'1064'</span></span> infile = <span class="hljs-string"><span class="hljs-string">''</span></span></code> </pre><br><p>  Importieren Sie die Bibliothek, legen Sie je nach Debugging eine Variable f√ºr den Namen der eingegebenen Audiodatei und die Nummer des Anrufers fest. </p><br><p>  <strong>Funktionsbeschreibung</strong> </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">verb</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(s)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> WINDEBUG: agi.verbose(s) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> s</code> </pre> <br><p>  Abh√§ngig vom Wert der Debugging-Variablen werden Meldungen in der Sternchenkonsole oder in stdout angezeigt. </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setVar</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(varname, varval)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> WINDEBUG: agi.set_variable(varname, varval) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">"setting var "</span></span> + varname + <span class="hljs-string"><span class="hljs-string">" with value "</span></span> + varval</code> </pre> <br><p>  Abh√§ngig vom Wert der Debugging-Variablen weisen wir den Wert der Dialplan-Variablen einem Sternchen zu oder zeigen ihn in stdout an. </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">contains_digits</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(s)</span></span></span><span class="hljs-function">:</span></span> verb(<span class="hljs-string"><span class="hljs-string">'enter contains_digits'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> bool(_digits.search(s))</code> </pre> <br><p>  √úberpr√ºfen Sie, ob s Ziffern enth√§lt. </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">return_digits</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(s)</span></span></span><span class="hljs-function">:</span></span> verb(<span class="hljs-string"><span class="hljs-string">'return digits'</span></span>) pstr = s.encode(<span class="hljs-string"><span class="hljs-string">"utf-8"</span></span>) all = string.maketrans(<span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>) nodigs = all.translate(all, string.digits) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> unicode(pstr.translate(all, nodigs), <span class="hljs-string"><span class="hljs-string">"utf-8"</span></span>)</code> </pre> <br><p>  Wir geben nur Zahlen von s zur√ºck. </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">check_dob</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(num)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> int(num) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> nums: verb(<span class="hljs-string"><span class="hljs-string">'checkdob success'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: verb(<span class="hljs-string"><span class="hljs-string">'checkdob fail'</span></span> + num) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">False</span></span></code> </pre> <br><p>  √úberpr√ºfen Sie, ob in der Nummernliste eine Erweiterung vorhanden ist. </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">set_dob</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(strnum)</span></span></span><span class="hljs-function">:</span></span> buf = return_digits(strnum) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> contains_digits(strnum): <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> check_dob(buf): verb(<span class="hljs-string"><span class="hljs-string">'setting var '</span></span> + buf) setVar(<span class="hljs-string"><span class="hljs-string">'RSTATUS'</span></span>, <span class="hljs-string"><span class="hljs-string">'SAYDIAL'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> buf <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"repeat"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"repeat"</span></span></code> </pre> <br><p>  Erweiterungseinstellungsfunktion. </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">checkSize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(infile)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> int(os.stat(infile).st_size) &lt;= <span class="hljs-number"><span class="hljs-number">26364</span></span>: setVar(<span class="hljs-string"><span class="hljs-string">'NUMTOCALL'</span></span>, <span class="hljs-string"><span class="hljs-string">'repeat'</span></span>) setVar(<span class="hljs-string"><span class="hljs-string">'RSTATUS'</span></span>, <span class="hljs-string"><span class="hljs-string">'SILENCE'</span></span>) verb(<span class="hljs-string"><span class="hljs-string">'empty file received'</span></span>) remove(infile) exit(<span class="hljs-number"><span class="hljs-number">9</span></span>)</code> </pre> <br><p>  Wenn die empfangene Audioaufzeichnungsdatei auf Erkennung √ºberpr√ºft wird und die Gr√∂√üe zu klein ist, wird davon ausgegangen, dass sie im Mobilteil stumm geschaltet sind. </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addSessionStat</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ctime, rtime, stime, phrase)</span></span></span><span class="hljs-function">:</span></span> cdate = time.strftime(<span class="hljs-string"><span class="hljs-string">"%Y-%m-%d %H:%M:%S"</span></span>) db = MySQLdb.connect(host=mysqlhost, user=mysqluser, passwd=mysqluser, db=mysqldb, charset=<span class="hljs-string"><span class="hljs-string">'utf8'</span></span>) cur = db.cursor() cur.execute( <span class="hljs-string"><span class="hljs-string">"INSERT INTO recogStats(date,ctime,rtime,stime,phrase) VALUES ('"</span></span> + cdate + <span class="hljs-string"><span class="hljs-string">"','"</span></span> + str(ctime) + <span class="hljs-string"><span class="hljs-string">"','"</span></span> + str( rtime) + <span class="hljs-string"><span class="hljs-string">"','"</span></span> + str(stime) + <span class="hljs-string"><span class="hljs-string">"','"</span></span> + phrase + <span class="hljs-string"><span class="hljs-string">"')"</span></span>) db.commit() db.close()</code> </pre> <br><p>  Aufzeichnungsstatistik-Erkennungsfunktion. </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fillDics</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> db = MySQLdb.connect(host=mysqlhost, user=mysqluser, passwd=mysqlpass, db=<span class="hljs-string"><span class="hljs-string">"central_cdr"</span></span>, charset=<span class="hljs-string"><span class="hljs-string">'utf8'</span></span>) cur = db.cursor() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(caller) != <span class="hljs-number"><span class="hljs-number">4</span></span>: tbname = <span class="hljs-string"><span class="hljs-string">'spravochnik_rus_name_num_no_tops'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: tbname = <span class="hljs-string"><span class="hljs-string">'svravochnik_rus_persons'</span></span> cur.execute(<span class="hljs-string"><span class="hljs-string">"""SELECT nomer,fio from """</span></span> + tbname) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> row <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> cur.fetchall(): fullfio=row[<span class="hljs-number"><span class="hljs-number">1</span></span>].lower() f=<span class="hljs-string"><span class="hljs-string">" "</span></span>.join(fullfio.split(<span class="hljs-string"><span class="hljs-string">' '</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>]) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> f <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> persondicF.keys():<span class="hljs-comment"><span class="hljs-comment"># and f not in duplicates : persondicF[f] = int(row[0]) elif fullfio in persondic.keys(): pass else: duplicates.append(f) if not fullfio in persondic.keys(): persondic[fullfio] = int(row[0]) fi=" ".join(fullfio.split(' ')[0:2]) if not fi in persondicFI.keys(): persondicFI[fi] = int(row[0]) elif fullfio in persondic.keys(): pass else: persondicFI.pop(fi) uniquedups=[x for x in list(set(duplicates)) if x != ''] for item in uniquedups: for key in persondicF.keys(): if item in key: persondicF.pop(key) cur.execute("""SELECT nomer,request from CustomRequests """) for row in cur.fetchall(): otherdic[row[1].lower()] = row[0] cur.execute("""SELECT num,name from numdescriptions """) for row in cur.fetchall(): descriptions[str(row[0])] = row[1] cur.execute("""SELECT nomer from spravochnik_rus """) for row in cur.fetchall(): nums.append(int(row[0])) db.close()</span></span></code> </pre> <br><p>  Diese Funktion f√ºllt die W√∂rterb√ºcher Nachname (persondicF), Nachname (persondicFI), Name (persondic), Abteilungsnamen (otherdic), Beschreibungen f√ºr die Sprachsynthese (Beschreibungen) und alle Firmennummern (nums) aus. <br>  Abh√§ngig von der L√§nge der Anrufernummer wird eine Tabelle erstellt, die die Anzahl der Direktoren (interner Anrufer) oder nicht (externer Anrufer) enth√§lt. <br>  Das Verzeichnis der Nachnamen wird auf Eindeutigkeit gepr√ºft, um die Anwesenheit von zwei Ivanovs mit unterschiedlichen Nummern auszuschlie√üen. </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">convert</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(infile, outfile)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment">#convert file verb("Converting WAV " + infile) soxconvert = subprocess.Popen(['sox', infile, '-r', '16000', '-b', '16', '-c', '1', outfile], stdout=subprocess.PIPE) (out, err) = soxconvert.communicate() # remove(infile) if soxconvert.returncode != 0: setVar('NUMTOCALL', callnumber) # return "" exit(9)</span></span></code> </pre> <br><p>  Die Funktion zum Konvertieren der im Sternchen aufgezeichneten Datei, falls sox einen Fehler ausgibt, legen Sie die Standardnummer fest und beenden Sie das Skript. </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sendRecog</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(file)</span></span></span><span class="hljs-function">:</span></span> verb(<span class="hljs-string"><span class="hljs-string">"Sending file to yandex: "</span></span> + outfile) proc = subprocess.Popen([<span class="hljs-string"><span class="hljs-string">'curl'</span></span>, <span class="hljs-string"><span class="hljs-string">'--max-time'</span></span>, <span class="hljs-string"><span class="hljs-string">'5'</span></span>, <span class="hljs-string"><span class="hljs-string">'--silent'</span></span>, <span class="hljs-string"><span class="hljs-string">'asr.yandex.net/asr_xml?key='</span></span> + dkey + <span class="hljs-string"><span class="hljs-string">'&amp;uuid='</span></span> + uniqid + <span class="hljs-string"><span class="hljs-string">'&amp;topic='</span></span> + topic + <span class="hljs-string"><span class="hljs-string">'&amp;lang=ru-RU'</span></span>, <span class="hljs-string"><span class="hljs-string">'-F'</span></span>, <span class="hljs-string"><span class="hljs-string">'Content-Type=audio/x-pcm;bit=16;rate=16000'</span></span>, <span class="hljs-string"><span class="hljs-string">'-F'</span></span>, <span class="hljs-string"><span class="hljs-string">'audio=@'</span></span> + outfile], stdout=subprocess.PIPE) (out, err) = proc.communicate() verb(<span class="hljs-string"><span class="hljs-string">"return code is: "</span></span> + str(proc.returncode)) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> proc.returncode != <span class="hljs-number"><span class="hljs-number">0</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span> remove(file) e = xml.etree.ElementTree.fromstring(out) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> e.attrib[<span class="hljs-string"><span class="hljs-string">'success'</span></span>] == <span class="hljs-string"><span class="hljs-string">'1'</span></span>: verb(e._children[<span class="hljs-number"><span class="hljs-number">0</span></span>].text) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> e._children[<span class="hljs-number"><span class="hljs-number">0</span></span>].text <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span></code> </pre> <br><p>  Die Funktion zum Senden einer Datei zur Erkennung und zum Empfangen einer Antwort von Yandex.  Wenn die Erkennung erfolgreich ist, nehmen wir die erste Antwort.  Ich konnte dies mit der Curl-Bibliothek nicht tun, aus diesem Grund wird diese Option verwendet. </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">searchfiobyf</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(f)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(f.split(<span class="hljs-string"><span class="hljs-string">" "</span></span>))==<span class="hljs-number"><span class="hljs-number">2</span></span>: limit=<span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> len(f.split(<span class="hljs-string"><span class="hljs-string">" "</span></span>))&gt;=<span class="hljs-number"><span class="hljs-number">3</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> f <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: limit=<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> fio,num <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> persondic.iteritems(): cutfio=<span class="hljs-string"><span class="hljs-string">" "</span></span>.join(fio.split(<span class="hljs-string"><span class="hljs-string">' '</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>:limit]) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> f == cutfio: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> fio</code> </pre> <br><p>  Die Funktion der Suche nach einem vollst√§ndigen Namen, abh√§ngig davon, ob nur der Nachname oder der Nachname und der Vorname zur Eingabe kamen. </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">combinationSearcher</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(phrase,pdic,quality)</span></span></span><span class="hljs-function">:</span></span> verb(<span class="hljs-string"><span class="hljs-string">u'searching in persons'</span></span>) result = difflib.get_close_matches(phrase, pdic.keys(), <span class="hljs-number"><span class="hljs-number">1</span></span>, quality) <span class="hljs-comment"><span class="hljs-comment">#verb(" ".join(result)) if len(result) &gt; 0: fullfio=searchfiobyf(result[0]) verb(u'found ' + str(pdic[result[0]])) setVar('RSTATUS', 'NAMESUCCESS') setVar('FNAME', fullfio) return pdic[result[0]] else: return ""</span></span></code> </pre> <br><p>  Kombinationssuchfunktion, Beispiel: Phrase = "Alexey Petr", pdic enth√§lt den Eintrag "Alexeyev Peter", die Funktion get_close_matches gibt "Alexeyev Peter" zur√ºck.  Die Funktion kann zu falschen Ergebnissen f√ºhren, aber wie die Praxis gezeigt hat, gibt es viel korrektere Antworten.  Mit dem Qualit√§tsparameter k√∂nnen Sie die Genauigkeit der Suche nach √§hnlichen Phrasen festlegen. </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getNumByName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(recognizedString)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-string"><span class="hljs-string">u''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> recognizedString: verb(<span class="hljs-string"><span class="hljs-string">'enter dobavochn'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> set_dob(recognizedString) <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> len(recognizedString.replace(<span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>)) == <span class="hljs-number"><span class="hljs-number">4</span></span>: verb(<span class="hljs-string"><span class="hljs-string">'enter num say'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> set_dob(recognizedString) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(recognizedString) &lt;= <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> recognizedString.lower() <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> [<span class="hljs-string"><span class="hljs-string">u""</span></span>,<span class="hljs-string"><span class="hljs-string">u""</span></span>,<span class="hljs-string"><span class="hljs-string">u""</span></span>]: setVar(<span class="hljs-string"><span class="hljs-string">'RSTATUS'</span></span>, <span class="hljs-string"><span class="hljs-string">'SHORT'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"repeat"</span></span> verb(<span class="hljs-string"><span class="hljs-string">u'start searching'</span></span>) <span class="hljs-comment"><span class="hljs-comment">#  split = list(set(recognizedString.split(" "))) parts = len(split) fixedstring=" ".join(split) if parts &gt;= 5: verb('Phrase is long. Using FTDB') buf = mssqlwrapper(fixedstring) if buf != '': buf = mssqlwrapper(fixedstring)[0] if str(buf) in descriptions.keys(): setVar('FNAME', descriptions[str(buf)]) setVar('RSTATUS', 'DEPTSUCCESS') return buf else: setVar('RSTATUS', 'REQUESTNOTFOUND') return "repeat" result="" if parts == 1: mssqlcheck=mssqlwrapper(fixedstring) if mssqlcheck!='': if mssqlcheck[2]&gt;=80: buf=str(mssqlcheck[0]) if buf in descriptions.keys(): setVar('FNAME', descriptions[str(buf)]) setVar('RSTATUS', 'DEPTSUCCESS') result=buf else: result=combinationSearcher(fixedstring,persondicF,0.7) elif parts ==2: combs = list(permutations(split, parts)) # (  ,   ,   .....) for item in combs: element = " ".join(item) result=combinationSearcher(element,persondicFI,0.7) if result!="": break elif parts ==3: combs = list(permutations(split, parts)) for item in combs: element = " ".join(item) result=combinationSearcher(element,persondic,0.8) if result!="": break if result!="": return result verb('Low ftdbsearch') buf = mssqlwrapper(recognizedString) if buf != '': buf = mssqlwrapper(recognizedString)[0] if str(buf) in descriptions.keys(): verb('it is') setVar('FNAME', descriptions[str(buf)]) setVar('RSTATUS', 'DEPTSUCCESS') return buf else: verb(u'item not found ' + recognizedString) #    setVar('RSTATUS', 'REQUESTNOTFOUND') return callnumber</span></span></code> </pre> <br><p>  <strong>Die Hauptfunktion beim Finden von Zahlen nach Phrasen.</strong> </p><br><p>  Lassen Sie uns diese Funktion in Teilen analysieren. </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-string"><span class="hljs-string">u''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> recognizedString: verb(<span class="hljs-string"><span class="hljs-string">'enter dobavochn'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> set_dob(recognizedString)</code> </pre> <br><p>  Beispiel: Der Ausdruck "Bitte, Nebenstelle 1234" gibt die Nebenstellennummer (falls vorhanden) zur√ºck. </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> len(recognizedString.replace(<span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>)) == <span class="hljs-number"><span class="hljs-number">4</span></span>: verb(<span class="hljs-string"><span class="hljs-string">'enter num say'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> set_dob(recognizedString)</code> </pre> <br><p>  Wenn der Benutzer eine vierstellige Nummer ausgesprochen hat, geben Sie die entsprechende Nebenstelle zur√ºck (falls vorhanden). </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(recognizedString) &lt;= <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> recognizedString.lower() <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> [<span class="hljs-string"><span class="hljs-string">u""</span></span>,<span class="hljs-string"><span class="hljs-string">u""</span></span>,<span class="hljs-string"><span class="hljs-string">u""</span></span>]: setVar(<span class="hljs-string"><span class="hljs-string">'RSTATUS'</span></span>, <span class="hljs-string"><span class="hljs-string">'SHORT'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"repeat"</span></span></code> </pre> <br><p>  Um das Programm nicht in kurzen S√§tzen unn√∂tig auszuf√ºhren (dies kann passieren, wenn Yandex einen Teil des Gespr√§chs geh√∂rt und erkannt hat, wenn der Anrufer die Erkennungsnachricht nicht abgeh√∂rt hat). </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> parts &gt;= <span class="hljs-number"><span class="hljs-number">5</span></span>: verb(<span class="hljs-string"><span class="hljs-string">'Phrase is long. Using FTDB'</span></span>) buf = mssqlwrapper(fixedstring) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> buf != <span class="hljs-string"><span class="hljs-string">''</span></span>: buf = mssqlwrapper(fixedstring)[<span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> str(buf) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> descriptions.keys(): setVar(<span class="hljs-string"><span class="hljs-string">'FNAME'</span></span>, descriptions[str(buf)]) setVar(<span class="hljs-string"><span class="hljs-string">'RSTATUS'</span></span>, <span class="hljs-string"><span class="hljs-string">'DEPTSUCCESS'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> buf <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: setVar(<span class="hljs-string"><span class="hljs-string">'RSTATUS'</span></span>, <span class="hljs-string"><span class="hljs-string">'REQUESTNOTFOUND'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"repeat"</span></span> result=<span class="hljs-string"><span class="hljs-string">""</span></span></code> </pre><br><p>  Bei langen Phrasen (mehr als f√ºnf W√∂rter) wenden wir uns sofort der FT-Basis von mssql zu. </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> parts == <span class="hljs-number"><span class="hljs-number">1</span></span>: mssqlcheck=mssqlwrapper(fixedstring) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> mssqlcheck!=<span class="hljs-string"><span class="hljs-string">''</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> mssqlcheck[<span class="hljs-number"><span class="hljs-number">2</span></span>]&gt;=<span class="hljs-number"><span class="hljs-number">80</span></span>: buf=str(mssqlcheck[<span class="hljs-number"><span class="hljs-number">0</span></span>]) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> buf <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> descriptions.keys(): setVar(<span class="hljs-string"><span class="hljs-string">'FNAME'</span></span>, descriptions[str(buf)]) setVar(<span class="hljs-string"><span class="hljs-string">'RSTATUS'</span></span>, <span class="hljs-string"><span class="hljs-string">'DEPTSUCCESS'</span></span>) result=buf <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: result=combinationSearcher(fixedstring,persondicF,<span class="hljs-number"><span class="hljs-number">0.7</span></span>)</code> </pre> <br><p>  Wenn die erkannte Phrase aus einem Wort besteht, schauen wir uns zuerst die FT-Datenbank mit einer Genauigkeit von 80% an, suchen nach einer Beschreibung der erkannten Nummer, setzen die Ergebnisvariable und die Statusplan-Nummernplanvariable, andernfalls suchen wir im W√∂rterbuch der Nachnamen nach √§hnlichen W√∂rtern. </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> parts ==<span class="hljs-number"><span class="hljs-number">2</span></span>: combs = list(permutations(split, parts)) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> item <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> combs: element = <span class="hljs-string"><span class="hljs-string">" "</span></span>.join(item) result=combinationSearcher(element,persondicFI,<span class="hljs-number"><span class="hljs-number">0.7</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> result!=<span class="hljs-string"><span class="hljs-string">""</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">break</span></span></code> </pre> <br><p>  Wenn die Phrase aus zwei W√∂rtern besteht, nehmen wir an, dass es sich um einen Nachnamen und einen Namen handelt. <br>  Wir machen eine Liste von Kombinationen (Ivan Ivan, Ivan Ivan) und suchen nach √§hnlichen √úbereinstimmungen. </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> parts ==<span class="hljs-number"><span class="hljs-number">3</span></span>: combs = list(permutations(split, parts)) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> item <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> combs: element = <span class="hljs-string"><span class="hljs-string">" "</span></span>.join(item) result=combinationSearcher(element,persondic,<span class="hljs-number"><span class="hljs-number">0.8</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> result!=<span class="hljs-string"><span class="hljs-string">""</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">break</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> result!=<span class="hljs-string"><span class="hljs-string">""</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result</code> </pre> <br><p>  Bei einer Phrase mit drei W√∂rtern nehmen wir an, dass es sich um einen vollst√§ndigen Namen handelt, erstellen eine Liste mit Kombinationen und suchen im W√∂rterbuch nach einem vollst√§ndigen Namen.  Wir geben das Ergebnis zur√ºck, wenn die Variable nicht leer ist. </p><br><pre> <code class="python hljs">buf = mssqlwrapper(recognizedString) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> buf != <span class="hljs-string"><span class="hljs-string">''</span></span>: buf = mssqlwrapper(recognizedString)[<span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> str(buf) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> descriptions.keys(): verb(<span class="hljs-string"><span class="hljs-string">'it is'</span></span>) setVar(<span class="hljs-string"><span class="hljs-string">'FNAME'</span></span>, descriptions[str(buf)]) setVar(<span class="hljs-string"><span class="hljs-string">'RSTATUS'</span></span>, <span class="hljs-string"><span class="hljs-string">'DEPTSUCCESS'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> buf <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: verb(<span class="hljs-string"><span class="hljs-string">u'item not found '</span></span> + recognizedString) <span class="hljs-comment"><span class="hljs-comment">#    setVar('RSTATUS', 'REQUESTNOTFOUND') return callnumber</span></span></code> </pre> <br><p>  Falls wir keine √úbereinstimmungen gefunden haben, f√ºhren wir eine Suche in der FT-Datenbank durch. Wenn wir eine √úbereinstimmung finden, geben wir das Ergebnis und die Beschreibung zur√ºck. Andernfalls geben wir die Standardnummer zur√ºck und legen den Status fest, dass die Phrase nicht gefunden wurde. </p><br><p>  <strong>Der Hauptteil des Programms.</strong> </p><br><pre> <code class="python hljs">fillDics() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> WINDEBUG: checkSize(infile) start_time = timeit.default_timer() convert(infile, outfile) convert_elapsed = timeit.default_timer() - start_time start_time = timeit.default_timer() checkstring = sendRecog(outfile).lower() recog_elapsed = timeit.default_timer() - start_time verb(<span class="hljs-string"><span class="hljs-string">'convert_elapsed = '</span></span> + str(recog_elapsed)) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> checkstring == <span class="hljs-string"><span class="hljs-string">""</span></span>: verb(<span class="hljs-string"><span class="hljs-string">'not recognized. using default.'</span></span>) setVar(<span class="hljs-string"><span class="hljs-string">'NUMTOCALL'</span></span>, <span class="hljs-string"><span class="hljs-string">'repeat'</span></span>) setVar(<span class="hljs-string"><span class="hljs-string">'RSTATUS'</span></span>, <span class="hljs-string"><span class="hljs-string">'SILENCE'</span></span>) exit(<span class="hljs-number"><span class="hljs-number">9</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: setVar(<span class="hljs-string"><span class="hljs-string">'RECREZ'</span></span>, checkstring) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: checkstring = <span class="hljs-string"><span class="hljs-string">u""</span></span> start_time = timeit.default_timer() callnumber = getNumByName(checkstring) search_elapsed = timeit.default_timer() - start_time <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> WINDEBUG: setVar(<span class="hljs-string"><span class="hljs-string">'NUMTOCALL'</span></span>, str(callnumber)) addSessionStat(convert_elapsed, recog_elapsed, search_elapsed, checkstring.lower())</code> </pre> <br><p>  Die Funktion zum Ausf√ºllen von W√∂rterb√ºchern wird gestartet, wenn wir nicht im Debugging-Programm sind - wir f√ºllen die Timer-Variablen aus, √ºberpr√ºfen die Dateigr√∂√üe, konvertieren, senden sie zur Erkennung, andernfalls - f√ºllen Sie die Checkstring-Variable mit einem Pr√ºfsatz. <br>  Als n√§chstes f√ºllen wir die Variablen der Timer zur Erkennung aus und suchen nach Phrasen in unserer Struktur.  Und im Falle einer Kampffunktion setzen wir eine Variable f√ºr den Nummerierungsplan und geben Statistiken ein. </p><br><p>  <strong>Einige Statistiken.</strong> </p><br><p>  <em>Juni 2018:</em> <br>  erfolgreiche Anerkennung - 1010 <br>  schwiegen in einer R√∂hre - 78 <br>  Erkennung fehlgeschlagen (keine √úbereinstimmung gefunden) - 79 <br>  kurze Anfrage - 4 <br>  anerkannte Abteilung - 7 <br>  durchschnittliche Erkennungszeit (durchschnittliche Yandex-Antwortzeit) - 2,6 Sek </p><br><p>  <em>Juni 2017:</em> <br>  erfolgreiche Anerkennung - 1271 <br>  anerkannte Abteilung - 18 <br>  Erkennung fehlgeschlagen (keine √úbereinstimmung gefunden) - 127 <br>  kurze Anfrage - 9 <br>  schwiegen in einer R√∂hre - 71 <br>  durchschnittliche Erkennungszeit (durchschnittliche Yandex-Reaktionszeit) - 1,5 Sek </p><br><p>  Dieser Service wird in der Firma, in der ich arbeite, erfolgreich eingesetzt.  Ich hoffe, dass meine Erfolge anderen Menschen bei der Umsetzung ihrer Ideen oder √§hnlichen Funktionen helfen werden.  Bereit, alle Fragen zu beantworten. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de417273/">https://habr.com/ru/post/de417273/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de417257/index.html">C-Zeiger als sprachliches Paradoxon</a></li>
<li><a href="../de417261/index.html">Uber entschied sich nach einem Unfall mit seinem Roboterauto, das Personal der Betreiber intelligenter Maschinen in Pittsburgh zu reduzieren</a></li>
<li><a href="../de417265/index.html">Top 10: die besten Berichte von DotNext 2017 Moskau</a></li>
<li><a href="../de417269/index.html">Wohin f√ºr einen Designer: renommierte internationale Auszeichnungen</a></li>
<li><a href="../de417271/index.html">Kann ein Hacker den √Ñrmelkanal blockieren?</a></li>
<li><a href="../de417275/index.html">7 F√§higkeiten effektiver Designer. Leistungsstarke Tools zur Karriereentwicklung</a></li>
<li><a href="../de417277/index.html">Kostenlose Bibliotheken zum Erstellen und Bearbeiten von PDF-Dateien</a></li>
<li><a href="../de417283/index.html">Disney stellte sein eigenes HairControl-Haaranimationssystem vor</a></li>
<li><a href="../de417285/index.html">Wo in IPv6 ein Anf√ºhrungszeichen eingef√ºgt werden soll</a></li>
<li><a href="../de417287/index.html">"Testerkalender" f√ºr Juli. Analytics-Tests</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>