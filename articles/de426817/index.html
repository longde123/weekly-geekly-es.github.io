<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🐔 💅🏼 🧑🏾‍🤝‍🧑🏼 CommuniGate Pro Private Keys und Web-API 🧑🏾‍🤝‍🧑🏼 👩🏻‍⚕️ 👨🏽‍✈️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Aufgrund verschiedener Prozesse hat mittlerweile fast jeder von einer Importsubstitution gehört. Insbesondere wird das importierte MS Exchange-Produkt...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>CommuniGate Pro Private Keys und Web-API</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/426817/"> Aufgrund verschiedener Prozesse hat mittlerweile fast jeder von einer Importsubstitution gehört.  Insbesondere wird das importierte MS Exchange-Produkt jetzt aktiv durch Russisch ohne einen einzigen Nagel ersetzt * Communigate Pro.  Wenn meine Kollegen die Zeit finden, können sie meiner Meinung nach viel über Cluster, Laden und Migration erzählen, aber ich möchte Ihnen ein erschreckendes Blut erzählen, aber eine viel weniger ausführliche Geschichte über die nationalen Merkmale der Erneuerung von Zertifikaten in diesem wunderbaren Produkt. <br><a name="habracut"></a><br>  Eigentlich ein kurzer Hintergrund.  Ich habe einen kleinen Laptop in einem Schrank, auf dem bis vor kurzem der Mailserver in einer Reihe von Windows + hMailServer summte.  Natürlich wollte ich Communigate Pro aufgrund der Importsubstitution näher kennenlernen, zum Glück sind die Anforderungen sehr bescheiden und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">in einigen Maßstäben</a> kostenlos: <br><blockquote>  Wir stellen die Vollversion von CommuniGate Pro für fünf Benutzer kostenlos zu Testzwecken und zur Verwendung in kleinen Projekten (Unternehmen) zur Verfügung. </blockquote>  Die Bekanntschaft kann <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">im Abschnitt Über uns</a> gestartet werden.  Dort ist sehr deutlich zu erkennen, dass 1997 der Meilenstein „First Reliase“ erreicht wurde, die Vermarkter Stalker, Inc erst 2004 gelernt haben, das Wort „Release“ zu schreiben, und dass sie noch immer keine russischsprachigen Marketingmaterialien für die russische Website erstellen konnten. <br><br><img src="https://habrastorage.org/webt/np/es/m2/npesm2lxdxre5j-xl5kmnbudrku.png"><br><br>  Die Installation des Produkts (ich habe es unter CentOS 7 installiert) verursachte keine Schwierigkeiten. Bei dieser Gelegenheit habe ich CertBot dort abgelegt, Zertifikate von Let's Encrypt verschraubt und im Allgemeinen alles gestartet. <br>  Nach 3 Monaten liefen die Zertifikate wie geplant ab und es war Zeit, sie zu ändern. <br><br>  Dann entdeckte ich, dass Windows einen sehr unerwarteten Ersatz für den Telnet-Client brachte: <br><br><img src="https://habrastorage.org/webt/_d/2m/qv/_d2mqvtmomfo4uiwtgzqugcsare.png"><br><br>  Die Schlüsselregenerierung mit CertBot-Tools war langweilig. Ich war vielleicht zufrieden mit dem Server dns1.yandex.ru, der eine Stunde lang entweder die veraltete oder die aktualisierte tac-record _acme-Herausforderung ausgab, aufgrund derer ich erst beim dritten Versuch Zertifikate generieren konnte . <br>  Und dann begann die Magie. <br><br>  Der Communigate-Server kann das Schlüsselpaar über die Schnittstelle nicht durch ein neues ersetzen. Sie müssen zuerst das alte Schlüsselpaar löschen: <br><br><img src="https://habrastorage.org/webt/qe/fd/6y/qefd6yugaikvsejgwrxuxtxxpr8.png"><br><br>  Als bewusster localhost-Hostadministrator habe ich die Authentifizierung nur über ssl aktiviert und sie sicher vergessen. Nach dem Löschen des Schlüsselpaars weigerte sich der Server, mit mir zu kommunizieren: <br><br><img src="https://habrastorage.org/webt/xc/xl/ip/xcxlip__veye4m7djvoslyq4oxa.png"><br><br>  Ich habe den paranoiden Server gelöscht, indem ich diese Zeile zur Datei /var/CommuniGate/Accounts/postmaster.macnt/account.settings hinzugefügt habe: <br> <code>RequireAPOP = NO;</code> <br>  aber Sediment blieb natürlich zurück.  Natürlich wollte ich mir selbst eine <s>Schaltfläche für</s> das Skript erstellen, um das Schlüsselpaar durch eine Ausführung dieses Skripts selbst zu ersetzen und nicht gemäß den Benutzereinstellungen im Kreis zu laufen. <br><br>  Die Automatisierungstools in Communigate sind in bis zu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">vier Schnittstellen vorhanden</a> : Textkommunikation über TCP-Verbindung (PWD), CLI.pm-Perlenmodul (CG / PL), einfache Webanforderungen und XIMSS. <br><br>  Aus verschiedenen Gründen (natürlich meistens Faulheit) habe ich mich für Webanfragen entschieden. <br><br>  Von Anfang an ging etwas schief: <br><br><pre> <code class="hljs powershell">[<span class="hljs-type"><span class="hljs-type">root</span></span>@<span class="hljs-type"><span class="hljs-type">mx</span></span> ~]<span class="hljs-comment"><span class="hljs-comment"># curl -u postmaster:password -k 'https://127.0.0.1:9100/cli/getdomainsettings' [root@mx ~]#</span></span></code> </pre> <br>  Wie sich herausstellte, las ich die Dokumentation unaufmerksam, ich musste es so machen: <br><br><pre> <code class="hljs 1c">[root@mx <span class="hljs-symbol"><span class="hljs-symbol">~]# curl -u postmaster</span></span>:password -k 'https://127.0.0.1:<span class="hljs-number"><span class="hljs-number">9100</span></span>/cli/?command=getdomainsettings' {CAChain=[---];CertificateType=YES;ClientCertCA=<span class="hljs-string"><span class="hljs-string">"Let's Encrypt Authority X3"</span></span>;ClientIPs=<span class="hljs-string"><span class="hljs-string">""</span></span>;DKIMenabled=YES;DKIMkey=[---DKIM];DKIMselector=dkim;DomainComment=<span class="hljs-string"><span class="hljs-string">""</span></span>;IPMode=<span class="hljs-string"><span class="hljs-string">"All Available"</span></span>;PrivateSecureKey=[---];SecureCertificate=[--];TrustedCertificates=();}</code> </pre> <br>  Dann ging wieder etwas schief: <br><br><pre> <code class="hljs 1c">[root@mx <span class="hljs-symbol"><span class="hljs-symbol">~]# curl -u postmaster</span></span>:password -k 'https://127.0.0.1:<span class="hljs-number"><span class="hljs-number">9100</span></span>/cli/?command=getdomainsettings&amp;domainName=test' {CAChain=[---];CertificateType=YES;ClientCertCA=<span class="hljs-string"><span class="hljs-string">"Let's Encrypt Authority X3"</span></span>;ClientIPs=<span class="hljs-string"><span class="hljs-string">""</span></span>;DKIMenabled=YES;DKIMkey=[---DKIM];DKIMselector=dkim;DomainComment=<span class="hljs-string"><span class="hljs-string">""</span></span>;IPMode=<span class="hljs-string"><span class="hljs-string">"All Available"</span></span>;PrivateSecureKey=[---];SecureCertificate=[--];TrustedCertificates=();}</code> </pre> <br>  Ich war verwirrt über diese Wendung der Ereignisse und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">unterstützte den Verkäufer</a> . <br><blockquote>  Als Werbung. <br><br>  Ja, sie haben einen Chatraum.  Und Experten antworten sogar darauf.  Auch ohne Firmenabonnement. </blockquote>  Wie sich herausstellte, versteht die http-Anfrage die genannten Parameter nicht.  Nur positionell, nur hardcore: <br><br><pre> <code class="hljs powershell">[<span class="hljs-type"><span class="hljs-type">root</span></span>@<span class="hljs-type"><span class="hljs-type">mx</span></span> ~]<span class="hljs-comment"><span class="hljs-comment"># curl -u postmaster:password -k 'https://127.0.0.1:9100/cli/?command=getdomainsettings%20test' {} [root@mx ~]#</span></span></code> </pre> <br>  Die Testdomäne ist in voller Übereinstimmung mit ihrem Namen eine Testdomäne, daher sind keine Einstellungen darin enthalten. <br>  Dann stellte ich vor, wie ich ein Zertifikat in die URL einbetten werde, und entschied, dass ich etwas dagegen tun muss.  Verwenden Sie beispielsweise die POST-Anforderung einer gesunden Person anstelle der GET-Anforderung des Rauchers zur Datenübertragung: <br><br><pre> <code class="hljs kotlin">[<span class="hljs-symbol"><span class="hljs-symbol">root@</span></span>mx ~]# curl -u postmaster:password -k <span class="hljs-string"><span class="hljs-string">'https://127.0.0.1:9100/cli/'</span></span> --<span class="hljs-keyword"><span class="hljs-keyword">data</span></span>-urlencode <span class="hljs-string"><span class="hljs-string">'command=getdomainsettings test'</span></span> {} [<span class="hljs-symbol"><span class="hljs-symbol">root@</span></span>mx ~]#</code> </pre> <br>  Bisher läuft alles nach Plan. <br><br>  Let's Encrypt bewahrt seine Schätze von dort im Verzeichnis /etc/letsencrypt/live/domain.my/ auf und wir werden sie erhalten. <br><br>  Etwas höher in der Anforderung getdomainsettings habe ich gesehen, dass der private Schlüssel im Feld PrivateSecureKey liegt, und außerdem liegt er dort mit gebissener Kopf- und Fußzeile, und alles andere wird in einer Zeile zusammengeführt.  Versuchen wir es zu importieren. <br><br><pre> <code class="hljs xml">[root@mx ~]# curl -u postmaster:password -k 'https://127.0.0.1:9100/cli/' --data-urlencode "command=updatedomainsettings test {PrivateSecureKey=[`grep -v '\-\-' /etc/letsencrypt/live/domain.my/privkey.pem | tr -d '\n'`];}" <span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.w3.org/1999/xhtml"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xml:lang</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ru"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">lang</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ru"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dir</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ltr"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">http-equiv</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Content-Type"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/html; charset=utf-8"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> domain.my<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stylesheet"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/SkinFiles/domain.my/Pronto/style.css"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/css"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">http-equiv</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"x-dns-prefetch-control"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"off"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"referrer"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"no-referrer"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">background</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/SkinFiles/domain.my/Pronto/bodybgcolor.gif"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">method</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"post"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">enctype</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"multipart/form-data"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"hidden"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"FormCharset"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"utf-8"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"100%"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">border</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">cellspacing</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">cellpadding</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"25"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">valign</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"middle"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">align</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"center"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">bgcolor</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"#ffcccc"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"externalError"</span></span></span><span class="hljs-tag">&gt;</span></span>private key data is corrupted<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> [root@mx ~]#</code> </pre> <br>  Äh ... Nun ... das habe ich nicht erwartet. <br><br>  Ich dachte, es sei ein Certbot, statt eines privaten Schlüssels habe ich etwas Seltsames herausgerutscht und den Inhalt der Datei herausgezogen: <br><br><pre> <code class="hljs delphi">[root@mx ~]# cat /etc/letsencrypt/live/domain.my/privkey.pem -----<span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PRIVATE</span></span> KEY-----     -----<span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PRIVATE</span></span> KEY----- [root@mx ~]#</code> </pre> <br>  und über das Webinterface eingefügt: <br><br><img src="https://habrastorage.org/webt/ie/km/rh/iekmrhlgfgslqh-ahhyi3_c6xoc.png"><br><br>  Plötzlich ging alles gut: <br><br><img src="https://habrastorage.org/webt/tl/v1/by/tlv1byenkger-3wjctjwcc_i06c.png"><br><br>  Ich habe den Schlüssel gelöscht und versucht, ihn mit einer HTTP-Anfrage erneut zu importieren.  Es geschah kein Wunder, <b>private Schlüsseldaten</b> erwiesen sich immer noch als <b>beschädigt</b> . <br><br>  Verblüfft besuchte ich erneut das <s>Kaninchen</s> des technischen Supports.  Der technische Support sagte, dass Sie die Kopf- und Fußzeile aus der privaten Schlüsseldatei beißen und das Ergebnis in einer Zeile kombinieren müssen.  Als ich fragte, ob ich mit diesem Befehl alles richtig gemacht habe: <br><br><pre> <code class="hljs perl"><span class="hljs-keyword"><span class="hljs-keyword">grep</span></span> -v <span class="hljs-string"><span class="hljs-string">'\-\-'</span></span> /etc/letsencrypt/live/domain.my/privkey.pem | <span class="hljs-keyword"><span class="hljs-keyword">tr</span></span> -d <span class="hljs-string"><span class="hljs-string">'\n'</span></span></code> </pre> <br>  Der Support-Mitarbeiter antwortete, dass er kein Experte für Grep sei und es nicht wisse. <br><br>  Während des Dialogs stellte ich fest, dass, wenn ich den alten Schlüssel mit der Anforderung getdomainsettings herausziehe, die HTTP-Anforderung ihn normal importiert, ich entschied, dass mein grep |  tr beißt etwas Überflüssiges heraus und verabschiedet sich von Stalkers Chatroom. <br><br>  Es war jedoch nicht so einfach.  Nachdem ich den privaten Schlüssel manuell bereinigt hatte, stellte ich fest, dass er sowieso nicht importiert wurde. <br><br>  Hier bin ich in eine letzte Sackgasse geraten. <br><br>  Nachdem ich unter diesem Phänomen gelitten hatte, entschied ich mich, alles manuell zu spucken und zu tun, importierte den privaten Schlüssel über die Weboberfläche ... Und schließlich stellte ich eine Anfrage für getdomainsettings.  Plötzlich stellte sich heraus, dass Communigate nicht zu mir zurückkehrte, was ich ihm gefüttert hatte.  Darüber hinaus war der private Schlüssel "Let's Encrypt" nach der Bereinigung 1624 Zeichen lang, und Communigate zeigte mir, dass er nur 1592 Zeichen lang war. <br><br>  Ich war nicht bereit für eine solche Wende und stieg in openssl.  Der erste Schuss traf das Ziel: <br><br><pre> <code class="hljs delphi">[root@mx ~]# openssl rsa -<span class="hljs-keyword"><span class="hljs-keyword">in</span></span> /etc/letsencrypt/live/domain.my/privkey.pem writing RSA key -----<span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> RSA <span class="hljs-keyword"><span class="hljs-keyword">PRIVATE</span></span> KEY-----   ,  ,     -----<span class="hljs-keyword"><span class="hljs-keyword">END</span></span> RSA <span class="hljs-keyword"><span class="hljs-keyword">PRIVATE</span></span> KEY----- [root@mx ~]#</code> </pre> <br>  Hurra, Mission erfüllt. <br><br>  Wir brauchten keine Tänze mit Zertifikaten, sie beißen nur eine Kopfzeile mit einer Fußzeile und die Reste werden in einer Zeile zusammengefasst. <br><br>  Insgesamt sieht das Endergebnis für mich so aus: <br><br><pre> <code class="hljs powershell">curl -<span class="hljs-literal"><span class="hljs-literal">-user</span></span> postmaster:password <span class="hljs-literal"><span class="hljs-literal">-k</span></span> <span class="hljs-string"><span class="hljs-string">'https://127.0.0.1:9100/cli/'</span></span> -<span class="hljs-literal"><span class="hljs-literal">-data</span></span><span class="hljs-literal"><span class="hljs-literal">-urlencode</span></span> <span class="hljs-string"><span class="hljs-string">"command=updatedomainsettings domain.my {SecureCertificate=[`grep -v '\-\-' /etc/letsencrypt/live/domain.my/cert.pem | tr -d '\n'`];PrivateSecureKey=[`openssl rsa -in /etc/letsencrypt/live/domain.my/privkey.pem 2&gt; /dev/null | grep -v '\-\-' | tr -d '\n'`];CAChain=[`grep -v '\-\-' /etc/letsencrypt/live/domain.my/chain.pem | tr -d '\n'`];}"</span></span></code> </pre> <br>  Da Unix-Shell nicht meine native Umgebung ist, werde ich die Optimierungen sehr schätzen. <br><br>  Nun, und Sie wissen nie, plötzlich wird mich jemand brauchen, ich konnte das nicht googeln. <br><br>  * Nägel in Communigate Pro wurden wirklich nicht gefunden </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de426817/">https://habr.com/ru/post/de426817/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de426807/index.html">OS-Schreiben: Multitasking</a></li>
<li><a href="../de426809/index.html">Zeev Surasky: Die Zukunft der Zend Engine und des Zend Frameworks</a></li>
<li><a href="../de426811/index.html">Parkour-, Tanz- und Bauarbeiten von Boston Dynamics</a></li>
<li><a href="../de426813/index.html">? Skype ist zu einem langweiligen Anschein geworden ... und zu einem Produkt, mit dem Sie vollen Zugriff auf Ihr System erhalten? Gibt es Hoffnung?</a></li>
<li><a href="../de426815/index.html">Wie bekomme ich ein Projektentwicklungsstipendium, wenn Sie ein armer Student sind? Und ist es das wert?</a></li>
<li><a href="../de426819/index.html">Reaktive Anwendung ohne Redux / NgRx</a></li>
<li><a href="../de426821/index.html">So organisieren Sie CI / CD in einem Projekt: vom Festlegen von Aufgaben bis zum Einrichten der Bereitstellungspipeline</a></li>
<li><a href="../de426825/index.html">Ein paar Tipps für Freiberufler</a></li>
<li><a href="../de426831/index.html">Unangenehmes Gespräch, Herpetologe und völlige Überraschung</a></li>
<li><a href="../de426835/index.html">Vergleichende und detaillierte Analyse von Caching-Plugins für WordPress</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>