<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üçû üßíüèø üë®üèΩ‚Äçüè≠ In-App-Updates: Beschleunigen von Android-Anwendungsupdates ü¶ñ üôãüèø ‚ôæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Unter den verschiedenen Tools, die auf dem Android Dev Summit angek√ºndigt wurden, m√∂chte ich dem Mechanismus zur Aktualisierung von In-App-Updates (IA...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>In-App-Updates: Beschleunigen von Android-Anwendungsupdates</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/mailru/blog/452092/"><img src="https://habrastorage.org/getpro/habr/post_images/3f4/39f/9a5/3f439f9a5f713ab2863a509a872b5aa8.png"><br><br>  Unter den verschiedenen Tools, die auf dem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Android Dev Summit</a> angek√ºndigt wurden, m√∂chte ich dem Mechanismus zur Aktualisierung von In-App-Updates (IAUs) besondere Aufmerksamkeit widmen, mit dem Entwickler das Hinzuf√ºgen neuer Funktionen, Fehlerkorrekturen und Leistungsverbesserungen beschleunigen k√∂nnen.  Da diese Funktionalit√§t nach Google I / O 2019 ver√∂ffentlicht wurde, werde ich in diesem Artikel ausf√ºhrlich √ºber IAUs sprechen, die empfohlenen Implementierungsschemata beschreiben und einige Codebeispiele geben.  Ich werde auch √ºber unsere Erfahrungen bei der Integration von IAUs in <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Pandao sprechen</a> , eine Anwendung zur Bestellung von Waren aus China. <br><a name="habracut"></a><br>  Mit der neuen API k√∂nnen Entwickler ein Anwendungsupdate auf die neueste Version von Google Play initiieren.  Auf diese Weise erg√§nzen IAUs den vorhandenen automatischen Aktualisierungsmechanismus von Google Play.  IAUs enthalten mehrere Implementierungsschemata, die sich in Bezug auf die Benutzerinteraktion grundlegend unterscheiden. <br><br><ol><li>  <b>Flexible Flow</b> bietet Benutzern die M√∂glichkeit, das Update im Hintergrund herunterzuladen und zu einem f√ºr den Benutzer geeigneten Zeitpunkt zu installieren.  Es ist f√ºr F√§lle vorgesehen, in denen Benutzer die alte Version weiterhin verwenden k√∂nnen, eine neue jedoch bereits verf√ºgbar ist. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1f8/067/c9f/1f8067c9ffa01e7a0a9b9a6631beabe3.png"><br></li><li>  <b>F√ºr den sofortigen Ablauf</b> m√ºssen Benutzer das Update herunterladen und installieren, bevor sie die Anwendung weiter verwenden k√∂nnen.  Es ist f√ºr F√§lle gedacht, in denen es f√ºr Entwickler wichtig ist, die Anwendung zu aktualisieren. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/026/409/ac2/026409ac2b2b1c7df62614ee1576ff64.png"><br></li></ol><br>  Da die zweite Option f√ºr die Pandao-Anwendung nicht so wichtig und weniger geeignet ist, werden wir das Flexible Flow-Szenario genauer analysieren. <br><br><h1>  IAUs Flexible Flow Integration </h1><br><h3>  Anwendungsf√§lle </h3><br>  Der Upgrade-Prozess mit IAUs besteht aus mehreren Schritten. <br><br><ol><li>  Eine Anwendung, die die Play Core-Bibliothek verwendet und bei Google Play pr√ºft, ob Updates verf√ºgbar sind. <br></li><li>  Wenn dies der Fall ist, fordert die Anwendung Google Play auf, den IAU-Dialog anzuzeigen.  Google Play zeigt dem Nutzer einen Dialog mit einem Aktualisierungsvorschlag. <br></li><li>  Wenn der Nutzer zustimmt, l√§dt Google Play im Hintergrund das Update herunter und zeigt dem Nutzer in der Statusleiste den Download-Fortschritt an. <br></li><li>  Wenn der Download abgeschlossen ist, w√§hrend die Anwendung im Hintergrund ausgef√ºhrt wird, schlie√üt Google Play die Installation automatisch ab.  Wenn die Anwendung zu diesem Zeitpunkt aktiv ist, m√ºssen Sie in solchen F√§llen Ihre eigene Logik f√ºr den Abschluss der Installation festlegen.  Betrachten Sie die folgenden Szenarien. <br><ol><li>  Die Anwendung startet den Installationsprozess, indem sie dem Nutzer ein Google Play-Dialogfeld mit einer Fortschrittsanzeige anzeigt.  Nach Abschluss der Installation wird eine aktualisierte Version der Anwendung gestartet.  In diesem Fall wird empfohlen, ein zus√§tzliches Dialogfeld anzuzeigen, in dem der Benutzer best√§tigen kann, dass er bereit ist, die Anwendung jetzt neu zu starten.  <b>Dies ist das empfohlene Implementierungsschema</b> . <br></li><li>  Die Anwendung wartet, bis sie sich im Hintergrund befindet, und schlie√üt dann die Aktualisierung ab.  Einerseits ist dies aus Sicht von UX ein weniger aufdringliches Verhalten, da die Benutzerinteraktion mit der Anwendung nicht unterbrochen wird.  Andererseits muss der Entwickler die Logik implementieren, um festzustellen, ob sich die Anwendung im Hintergrund befindet. <br></li></ol></li></ol><br>  Wenn die Installation des heruntergeladenen Updates nicht abgeschlossen wurde, kann Google Play die Installation im Hintergrund abschlie√üen.  Diese Option sollte besser nicht explizit verwendet werden, da sie die Installation des Updates nicht garantiert. <br><br><h3>  Grundlegende Testanforderungen </h3><br>  Um den gesamten Aktualisierungsvorgang auf einem Testger√§t manuell abzuschlie√üen, ben√∂tigen Sie mindestens zwei Versionen der Anwendung mit unterschiedlichen Baugruppennummern: <b>Quelle</b> und <b>Ziel</b> . <br><br><ul><li>  Die Originalversion mit einer h√∂heren Nummer muss auf Google Play ver√∂ffentlicht werden. Sie wird von Google Play als verf√ºgbares Update identifiziert.  Die Zielversion mit einer niedrigeren Build-Nummer und integrierten IAUs muss auf dem Ger√§t installiert sein. Wir werden sie aktualisieren.  Unter dem Strich vergleicht die Anwendung, wenn sie Google Play auffordert, nach einem Update zu suchen, die Baugruppennummern der installierten und verf√ºgbaren Version.  Daher werden IAUs nur gestartet, wenn die Build-Nummer bei Google Play h√∂her ist als die aktuelle Version auf dem Ger√§t. <br></li><li>  Die Quell- und Zielversion m√ºssen <b>denselben Paketnamen haben</b> und mit <b>demselben</b> Versionszertifikat signiert sein. <br></li><li>  Android 5.0 (API Level 21) oder h√∂her. <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Spielen Sie Core</a> Library 1.5.0 oder h√∂her. <br></li></ul><br><h3>  Codebeispiel </h3><br>  Hier sehen wir uns einen Beispielcode f√ºr die Verwendung von IAUs Flexible Flow an, der auch in der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">offiziellen Dokumentation enthalten ist</a> .  Zuerst m√ºssen Sie die Play Core-Bibliothek der Datei build.gradle auf Modulebene hinzuf√ºgen. <br><br><pre><code class="plaintext hljs">dependencies { ... implementation "com.google.android.play:core:1.5.0" }</code> </pre> <br>  Erstellen Sie dann eine Instanz von <code>AppUpdateManager</code> und f√ºgen Sie <code>AppUpdateManager</code> eine R√ºckruffunktion <code>AppUpdateInfo</code> , die Informationen √ºber die Verf√ºgbarkeit des Updates, das Objekt zum Starten des Updates (falls verf√ºgbar) und den aktuellen Download-Fortschritt <code>AppUpdateInfo</code> , falls es bereits begonnen hat. <br><br><pre> <code class="kotlin hljs"><span class="hljs-comment"><span class="hljs-comment">// Create instance of the IAUs manager. val appUpdateManager = AppUpdateManagerFactory.create(context) // Add state listener to app update info task. appUpdateManager.appUpdateInfo.addOnSuccessListener { appUpdateInfo -&gt; // If there is an update available, prepare to promote it. if (appUpdateInfo.updateAvailability() == UpdateAvailability.UPDATE_AVAILABLE) { // ... } // If the process of downloading is finished, start the completion flow. if (appUpdateInfo.installStatus() == InstallStatus.DOWNLOADED) { // ... } } .addOnFailureListener { e -&gt; // Handle the error. }</span></span></code> </pre> <br>  Um das Dialogfeld zum Anfordern von Updates von Google Play <code>AppUpdateInfo</code> , m√ºssen Sie das empfangene <code>AppUpdateInfo</code> Objekt an die Methode <code>AppUpdateInfo</code> . <br><br><pre> <code class="kotlin hljs"> appUpdateManager.startUpdateFlowForResult( <span class="hljs-comment"><span class="hljs-comment">// Pass the intent that is returned by 'getAppUpdateInfo()'. appUpdateInfo, // Or 'AppUpdateType.IMMEDIATE for immediate updates. AppUpdateType.FLEXIBLE, // The current activity. activity, REQUEST_CODE )</span></span></code> </pre> <br>  Um den Status des Updates zu √ºberwachen, k√∂nnen Sie dem IAUs-Manager den Ereignis-Listener <code>InstallStateUpdatedListener</code> hinzuf√ºgen. <br><br><pre> <code class="kotlin hljs"><span class="hljs-comment"><span class="hljs-comment">// Create a listener to track downloading state updates. val listener = InstallStateUpdatedListener { state -&gt; // Update progress indicator, request user to approve app reload, etc. } // At some point before starting an update, register a listener for updates. appUpdateManager.registerListener(listener) // ... // At some point when status updates are no longer needed, unregister the listener. appUpdateManager.unregisterListener(listener)</span></span></code> </pre> <br>  Sobald das Update heruntergeladen wurde (Status <code>DOWNLOADED</code> ), m√ºssen Sie die Anwendung neu starten, um das Update abzuschlie√üen.  Der Neustart kann durch Aufrufen von <code>appUpdateManager.completeUpdate()</code> eingeleitet werden. <code>appUpdateManager.completeUpdate()</code> wird jedoch empfohlen, ein Dialogfeld <code>appUpdateManager.completeUpdate()</code> , damit der Benutzer seine Bereitschaft zum Neustart der Anwendung ausdr√ºcklich best√§tigt. <br><br><pre> <code class="kotlin hljs">Snackbar.make( rootView, <span class="hljs-string"><span class="hljs-string">"An update has just been downloaded from Google Play"</span></span>, Snackbar.LENGTH_INDEFINITE ).apply { setAction(<span class="hljs-string"><span class="hljs-string">"RELOAD"</span></span>) { appUpdateManager.completeUpdate() } show() }</code> </pre><br><h3>  Fehler "Update ist nicht verf√ºgbar" </h3><br>  √úberpr√ºfen Sie zun√§chst erneut, ob die im Abschnitt Grundlegende Implementierungsanforderungen aufgef√ºhrten Anforderungen erf√ºllt sind.  Wenn Sie alles getan haben, die Aktualisierung gem√§√ü dem <code>onSuccess</code> Aufruf jedoch immer noch nicht verf√ºgbar ist, liegt das Problem m√∂glicherweise im Caching.  Es ist wahrscheinlich, dass die Google Play-Anwendung das verf√ºgbare Update aufgrund des internen Caching-Mechanismus nicht kennt.  Um dies beim manuellen Testen zu vermeiden, k√∂nnen Sie einen Cache-Reset erzwingen, indem Sie bei Google Play auf die Seite "Meine Apps und Spiele" gehen.  Oder Sie k√∂nnen den Cache einfach in den Einstellungen der Google Play-Anwendung leeren.  Bitte beachten Sie, dass dieses Problem nur w√§hrend des Testens auftritt und keine Auswirkungen auf Endbenutzer haben sollte, da deren Cache weiterhin t√§glich aktualisiert wird. <br><br><h1>  IAUs flexibler Fluss in der Pandao-App </h1><br>  Wir haben an einem Early-Access-Programm teilgenommen und IAUs Flexible Flow (empfohlene Implementierung) in die Pandao-Anwendung integriert, eine Plattform, auf der Hersteller und Anbieter chinesische Waren handeln k√∂nnen.  Das IAUs-Dialogfeld wurde auf dem Hauptbildschirm angezeigt, damit die maximale Anzahl von Benutzern damit interagieren kann.  Zun√§chst wollten wir den Dialog nur einmal am Tag zeigen, um die Benutzer nicht von der Interaktion mit der Anwendung abzulenken. <br><br>  Da A / B-Tests eine Schl√ºsselrolle im Lebenszyklus neuer Funktionen spielen, haben wir beschlossen, die Auswirkungen von IAUs in unserer Anwendung zu bewerten.  Wir haben Benutzer zuf√§llig in zwei nicht zusammenh√§ngende Gruppen aufgeteilt.  Die erste Gruppe war eine Kontrollgruppe ohne Verwendung von IAUs, und die zweite Gruppe war eine Testgruppe. Wir haben diesen Benutzern den IAU-Dialog gezeigt. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3e6/281/d67/3e6281d67cb24f8f9018861697c62230.png"><br>  <i>IAUs Flexible Flow A / B-Test in der Pandao-App.</i> <br><br>  In den letzten Versionen haben wir den Prozentsatz der aktiven Benutzer jeder Version der Anwendung gemessen.  Es stellte sich heraus, dass unter den aktiven Benutzern mit der neuesten Version, die zu diesem Zeitpunkt verf√ºgbar war, der Hauptteil aus Teilnehmern der Gruppe B bestand, dh mit der IAU-Funktion.  Die violette Linie in der Grafik zeigt, dass in den ersten Tagen nach der Ver√∂ffentlichung von Version 1.29.1 die Anzahl der aktiven Benutzer mit IAUs die Anzahl der Benutzer ohne diese Funktion √ºberschritten hat.  Daher kann argumentiert werden, dass Benutzer mit IAUs die Anwendung schneller aktualisieren. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/535/1cb/3a9/5351cb3a9b15cd49e59d543463cbb283.jpg"><br>  <i>Das IAUs Flexible Flow-Dialogfeld in der Pandao-App.</i> <br><br>  Gem√§√ü unseren Daten (siehe Grafik oben) klicken Benutzer in den ersten Tagen nach der Ver√∂ffentlichung am h√§ufigsten auf die Best√§tigungsschaltfl√§che im IAU-Dialogfeld. Anschlie√üend wird die Konvertierung bis zur Ver√∂ffentlichung der n√§chsten Version der Anwendung st√§ndig reduziert.  Dasselbe gilt f√ºr die Schaltfl√§che "Installieren" im Dialogfeld, mit der die Installation des heruntergeladenen Updates gestartet wird.  Daher k√∂nnen wir sagen, dass der durchschnittliche Conversion-Wert in beiden F√§llen direkt proportional zur H√§ufigkeit der Ver√∂ffentlichungen ist.  In Pandao erreicht die durchschnittliche Conversion innerhalb eines Monats 35% f√ºr einen Klick auf die Best√§tigungsschaltfl√§che und 7% f√ºr einen Klick auf die Installationsschaltfl√§che. <br><br>  Wir gehen davon aus, dass eine Verringerung des Prozentsatzes der Best√§tigungen im Laufe der Zeit nur ein Problem der Benutzererfahrung darstellt, da Personen, die an der neuen Version interessiert sind, recht schnell aktualisiert werden und diejenigen, die nicht an einer Aktualisierung interessiert sind, nicht interessiert sind.  Basierend auf dieser Annahme haben wir beschlossen, diejenigen, die nicht an einer Aktualisierung interessiert sind, nicht zu st√∂ren und sie nicht jeden Tag zu fragen.  Es wird empfohlen, eine andere Abfragelogik zu verwenden, die auf "Veralterung" basiert. Um die Benutzer nicht zu st√∂ren, bewerten wir, wie alt die Versionen sind und wie oft wir bereits vorgeschlagen haben, sie zu aktualisieren. <br><br>  Im Allgemeinen zeigten IAUs gute Ergebnisse bei A / B-Tests, daher haben wir IAUs f√ºr alle Benutzer eingef√ºhrt. <br><br><h1>  Danksagung </h1><br>  Vielen Dank f√ºr Ihre Hilfe beim Schreiben dieses Artikels. Marina Pleshkova <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">Maryna_Pliashkova</a> , Alexander Cherny <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">alexchernyy</a> , Ilya Nazarov <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">RolaRko</a> , Gleb Bodyachevsky, Daniil Polozov <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">Jokerdab</a> , Anastasia Kulik, Vladislav Breus und Vladislav Goldin <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">Vladiskus</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de452092/">https://habr.com/ru/post/de452092/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de452078/index.html">Kubernetes Reservierung: Es besteht</a></li>
<li><a href="../de452082/index.html">Flexibler Ablauf von In-App-Updates: Beschleunigen Sie den App-Update-Prozess unter Android</a></li>
<li><a href="../de452086/index.html">Was ist in meinem Pixel f√ºr Sie: Erstellen von Nanopixeln mit Plasmon-Metaoberfl√§chen</a></li>
<li><a href="../de452088/index.html">Stra√üenerkennung durch semantische Segmentierung</a></li>
<li><a href="../de452090/index.html">Erstellen eines prozeduralen Puzzle-Generators</a></li>
<li><a href="../de452094/index.html">.NET: Tools zum Arbeiten mit Multithreading und Asynchronit√§t. Teil 1</a></li>
<li><a href="../de452098/index.html">Protokolle des Frontend-Entwicklers Habr: Refactor und Reflex</a></li>
<li><a href="../de452102/index.html">Fotospiel f√ºr Drohnenliebhaber: kurz √ºber AirSelfie 2</a></li>
<li><a href="../de452106/index.html">Wir laden Redner zum Sommer-DIY-Meeting am 16. Juni 2019 ein</a></li>
<li><a href="../de452108/index.html">Docker: harmloser Rat</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>