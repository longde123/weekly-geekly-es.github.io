<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🍂 🧑🏽 🐪 Kebingungan Data untuk Tes Kinerja 💍 👨‍👦 👩🏽‍🤝‍👨🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pengguna ClickHouse tahu bahwa keunggulan utamanya adalah kecepatan tinggi memproses kueri analitik. Tetapi bagaimana kita bisa membuat pernyataan sep...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Kebingungan Data untuk Tes Kinerja</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yandex/blog/457354/">  Pengguna ClickHouse tahu bahwa keunggulan utamanya adalah kecepatan tinggi memproses kueri analitik.  Tetapi bagaimana kita bisa membuat pernyataan seperti itu?  Ini harus didukung oleh tes kinerja tepercaya.  Kami akan membicarakannya hari ini. <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><img src="https://habrastorage.org/webt/ds/2m/sd/ds2msd5-4zeahpzlzptlqz8wgs8.png"></a> <br><br>  Kami mulai melakukan tes tersebut pada tahun 2013, jauh sebelum produk menjadi tersedia dalam sumber terbuka.  Seperti sekarang, maka kami paling tertarik dengan kecepatan layanan data Yandex.Metrica.  Kami sudah menyimpan data di ClickHouse sejak Januari 2009.  Sebagian dari data telah ditulis ke database sejak 2012, dan sebagian - telah <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">dikonversi</a> dari <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">OLAPServer dan Metrage</a> - struktur data yang digunakan di Yandex.Metrica sebelumnya.  Karenanya, untuk pengujian, kami mengambil subset pertama yang tersedia dari 1 miliar data tampilan halaman.  Tidak ada pertanyaan di Metric, dan kami sendiri mengajukan pertanyaan yang paling menarik bagi kami (semua jenis penyaringan, agregasi, dan penyortiran). <br><br>  ClickHouse diuji dibandingkan dengan sistem serupa, misalnya, Vertica dan MonetDB.  Sejujurnya, ini dilakukan oleh seorang karyawan yang sebelumnya tidak pernah menjadi pengembang ClickHouse, dan kasus-kasus tertentu dalam kode tidak dioptimalkan sampai hasilnya diperoleh.  Demikian pula, kami mendapat set data untuk tes fungsional. <br><br>  Setelah ClickHouse bergabung dengan open source pada tahun 2016, ada lebih banyak pertanyaan untuk pengujian. <br><br><a name="habracut"></a><h2>  Kerugian tes pada data hak milik </h2><br>  Tes kinerja: <br><br><ol><li> Mereka tidak dapat direproduksi dari luar, karena mereka membutuhkan data pribadi yang tidak dapat dipublikasikan.  Untuk alasan yang sama, beberapa tes fungsional tidak tersedia untuk pengguna eksternal. </li><li>  Jangan berkembang.  Ada kebutuhan untuk ekspansi yang signifikan dari set mereka, sehingga dimungkinkan untuk memverifikasi secara terpisah perubahan kecepatan masing-masing bagian sistem. </li><li>  Mereka tidak menjalankan komitmen untuk permintaan kumpulan, pengembang eksternal tidak dapat memeriksa kode mereka untuk regresi kinerja. </li></ol><br>  Anda dapat memecahkan masalah ini - membuang tes lama dan membuat yang baru berdasarkan data terbuka.  Di antara data terbuka, Anda dapat mengambil <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">data tentang penerbangan ke AS</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">naik taksi di New York,</a> atau menggunakan tolok ukur siap pakai TPC-H, TPC-DS, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Star Schema Benchmark</a> .  Ketidaknyamanannya adalah bahwa data ini jauh dari data Yandex.Metrica, dan saya ingin menyimpan permintaan pengujian. <br><br><h2>  Penting untuk menggunakan data nyata. </h2><br>  Anda perlu menguji kinerja layanan hanya pada data nyata dari produksi.  Mari kita lihat beberapa contoh. <br><br>  <strong>Contoh 1</strong> <br><br>  Misalkan Anda mengisi basis data dengan nomor pseudorandom yang didistribusikan secara merata.  Dalam hal ini, kompresi data tidak akan berfungsi.  Tetapi kompresi data adalah properti penting untuk DBMS analitik.  Memilih algoritma kompresi yang tepat dan cara yang tepat untuk mengintegrasikannya ke dalam sistem adalah tugas non-sepele di mana tidak ada satu solusi yang benar, karena kompresi data memerlukan kompromi antara kecepatan kompresi dan dekompresi dan rasio kompresi potensial.  Sistem yang tidak tahu cara kompres kehilangan data dijamin.  Tetapi jika kita menggunakan nomor pseudorandom yang didistribusikan secara seragam untuk pengujian, faktor ini tidak dipertimbangkan, dan semua hasil lainnya akan terdistorsi. <br><br>  Kesimpulan: data uji harus memiliki rasio kompresi yang realistis. <br><br>  Tentang optimasi algoritma kompresi data di ClickHouse yang saya bicarakan di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">posting sebelumnya</a> . <br><br>  <strong>Contoh 2</strong> <br><br>  Mari kita tertarik pada kecepatan query SQL: <br><br><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> RegionID, uniq(UserID) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> visitors     <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> test.hits     <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> RegionID     <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> visitors <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span>     <span class="hljs-keyword"><span class="hljs-keyword">LIMIT</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span></code> </pre> <br>  Ini adalah permintaan khas untuk Yandex.Metrica.  Apa yang penting untuk kecepatannya? <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Bagaimana GROUP BY dilakukan</a> ? </li><li>  Struktur data apa yang digunakan untuk menghitung fungsi agregat uniq. </li><li>  Berapa banyak RegionID yang berbeda dan berapa banyak RAM yang dibutuhkan oleh setiap negara bagian dari fungsi uniq. </li></ul><br>  Tetapi juga sangat penting bahwa jumlah data untuk berbagai daerah didistribusikan secara tidak merata.  (Mungkin, ini didistribusikan sesuai dengan undang-undang kekuasaan. Saya membuat grafik dalam skala log-log, tapi saya tidak yakin.) Dan jika demikian, penting bagi kita bahwa keadaan fungsi agregat uniq dengan sejumlah kecil nilai menggunakan sedikit memori.  Ketika ada banyak kunci agregasi yang berbeda, hitungannya pergi ke unit byte.  Bagaimana cara mendapatkan data yang dihasilkan yang memiliki semua properti ini?  Tentu saja, lebih baik menggunakan data nyata. <br><br>  Banyak DBMS menerapkan struktur data HyperLogLog untuk perkiraan perhitungan COUNT (DISTINCT), tetapi mereka semua bekerja relatif buruk karena struktur data ini menggunakan jumlah memori yang tetap.  Dan ClickHouse memiliki fungsi yang menggunakan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">kombinasi dari tiga struktur data yang berbeda</a> , tergantung pada ukuran set. <br><br>  Kesimpulan: data uji harus mewakili sifat-sifat distribusi nilai dalam data - kardinalitas (jumlah nilai dalam kolom) dan kardinalitas timbal balik dari beberapa kolom yang berbeda. <br><br>  <strong>Contoh 3</strong> <br><br>  Baiklah, mari kita uji kinerja bukan dari DBMS analitik ClickHouse, tetapi sesuatu yang lebih sederhana, misalnya, tabel hash.  Untuk tabel hash, memilih fungsi hash yang tepat sangat penting.  Untuk std :: unordered_map, ini sedikit kurang penting, karena ini adalah tabel hash berbasis rantai, dan bilangan prima digunakan sebagai ukuran array.  Dalam implementasi pustaka standar dalam gcc dan dentang, fungsi hash sepele digunakan sebagai fungsi hash default untuk tipe numerik.  Tetapi std :: unordered_map bukanlah pilihan terbaik ketika kita ingin mendapatkan kecepatan maksimum.  Saat menggunakan tabel hash pengalamatan terbuka, pilihan fungsi hash yang tepat menjadi faktor penentu, dan kita tidak bisa menggunakan fungsi hash trivial. <br><br>  Sangat mudah untuk menemukan tes kinerja tabel hash pada data acak, tanpa mempertimbangkan fungsi hash yang digunakan.  Juga mudah untuk menemukan tes fungsi hash dengan penekanan pada kecepatan perhitungan dan beberapa kriteria kualitas, bagaimanapun, terpisah dari struktur data yang digunakan.  Tetapi kenyataannya adalah bahwa tabel hash dan HyperLogLog memerlukan kriteria kualitas yang berbeda untuk fungsi hash. <br><br><img src="https://habrastorage.org/webt/bp/3h/32/bp3h320eztrirqzhm-lexeuhmbq.png"><br><br>  Baca lebih lanjut tentang ini di laporan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">"Bagaimana Hash Tabel di ClickHouse Diatur"</a> .  Agak ketinggalan jaman karena tidak mempertimbangkan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">tabel swiss</a> . <br><br><h2>  Tantangan </h2><br>  Kami ingin mendapatkan data untuk pengujian kinerja pada struktur yang sama dengan data Yandex.Metrica, yang menyimpan semua properti penting untuk tolok ukur, tetapi agar tidak ada jejak pengunjung situs nyata yang tertinggal dalam data ini.  Artinya, data harus dianonimkan, dan yang berikut harus disimpan: <br><br><ul><li>  rasio kompresi </li><li>  kardinalitas (jumlah nilai yang berbeda), </li><li>  kardinalitas timbal balik dari beberapa kolom yang berbeda, </li><li>  sifat-sifat distribusi probabilistik dengan mana data dapat dimodelkan (misalnya, jika kami percaya bahwa wilayah didistribusikan menurut hukum daya, maka eksponen - parameter distribusi - untuk data buatan harus kira-kira sama dengan yang asli). </li></ul><br>  Dan apa yang dibutuhkan agar data memiliki rasio kompresi yang sama?  Misalnya, jika LZ4 digunakan, maka substring dalam data biner harus diulangi pada jarak yang kira-kira sama dan pengulangan harus kira-kira sama panjangnya.  Untuk ZSTD, kecocokan entropi byte ditambahkan. <br><br>  Sasaran maksimum: untuk menyediakan alat bagi orang luar, yang dengannya setiap orang dapat menganonimkan kumpulan data mereka untuk publikasi.  Sehingga kami melakukan debug dan menguji kinerja pada data orang lain yang mirip dengan data dari produksi.  Dan saya ingin menarik untuk menonton data yang dihasilkan. <br><br>  Ini adalah pernyataan tidak resmi dari masalahnya.  Namun, tidak ada yang akan memberikan pernyataan formal. <br><br><h2>  Upaya untuk dipecahkan </h2><br>  Pentingnya tugas ini tidak boleh berlebihan bagi kita.  Sebenarnya, itu tidak pernah ada dalam rencana dan bahkan tidak ada yang akan melakukannya.  Saya hanya tidak menyerah berharap bahwa sesuatu akan muncul dengan sendirinya, dan tiba-tiba saya akan memiliki suasana hati yang baik dan banyak hal yang dapat ditunda sampai nanti. <br><br><h2>  Model Probabilistik Eksplisit </h2><br>  Gagasan pertama adalah memilih keluarga distribusi probabilitas yang memodelkannya untuk setiap kolom tabel.  Kemudian, berdasarkan statistik data, pilih parameter pemasangan model dan hasilkan data baru menggunakan distribusi yang dipilih.  Anda dapat menggunakan generator angka pseudo-acak dengan seed yang telah ditentukan untuk mendapatkan hasil yang dapat direproduksi. <br><br>  Untuk bidang teks, Anda dapat menggunakan rantai Markov - model yang dapat dipahami yang dapat digunakan untuk membuat implementasi yang efektif. <br><br>  Benar, beberapa trik diperlukan: <br><br><ul><li>  Kami ingin menjaga kontinuitas deret waktu - yang berarti bahwa untuk beberapa tipe data perlu dimodelkan bukan nilai itu sendiri, tetapi perbedaan antara yang bertetangga. </li><li>  Untuk mensimulasikan kardinalitas bersyarat dari kolom (misalnya, bahwa biasanya ada beberapa alamat IP per pengunjung pengenal), Anda juga perlu menuliskan dependensi antara kolom secara eksplisit (misalnya, untuk menghasilkan alamat IP, hash dari pengenal pengunjung digunakan, tetapi juga beberapa data pseudo-acak lainnya ditambahkan). </li><li>  Tidak jelas cara mengekspresikan ketergantungan yang satu pengunjung pada waktu yang sama sering mengunjungi URL dengan domain yang cocok. </li></ul><br>  Semua ini disajikan dalam bentuk program di mana semua distribusi dan dependensi adalah kode keras - yang disebut "skrip C ++".  Namun, model Markov masih dihitung dari jumlah statistik, smoothing dan roughening menggunakan noise.  Saya mulai menulis skrip ini, tetapi karena suatu alasan, setelah saya secara eksplisit menulis model untuk sepuluh kolom, tiba-tiba menjadi membosankan tak tertahankan.  Dan di tabel hits di Yandex.Metrica kembali pada tahun 2012 ada lebih dari 100 kolom. <br><br><pre> <code class="cpp hljs">EventTime.day(<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::discrete_distribution&lt;&gt;({    <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span>, <span class="hljs-number"><span class="hljs-number">30</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">14</span></span>, <span class="hljs-number"><span class="hljs-number">42</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">31</span></span>, <span class="hljs-number"><span class="hljs-number">17</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">23</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, ...})(random)); EventTime.hour(<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::discrete_distribution&lt;&gt;({    <span class="hljs-number"><span class="hljs-number">13</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">16</span></span>, <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-number"><span class="hljs-number">23</span></span>, <span class="hljs-number"><span class="hljs-number">24</span></span>, <span class="hljs-number"><span class="hljs-number">23</span></span>, <span class="hljs-number"><span class="hljs-number">18</span></span>, <span class="hljs-number"><span class="hljs-number">19</span></span>, <span class="hljs-number"><span class="hljs-number">19</span></span>, ...})(random)); EventTime.minute(<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::uniform_int_distribution&lt;UInt8&gt;(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">59</span></span>)(random)); EventTime.second(<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::uniform_int_distribution&lt;UInt8&gt;(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">59</span></span>)(random)); UInt64 UserID = hash(<span class="hljs-number"><span class="hljs-number">4</span></span>, powerLaw(<span class="hljs-number"><span class="hljs-number">5000</span></span>, <span class="hljs-number"><span class="hljs-number">1.1</span></span>)); UserID = UserID / <span class="hljs-number"><span class="hljs-number">10000000000U</span></span>LL * <span class="hljs-number"><span class="hljs-number">10000000000U</span></span>LL    + <span class="hljs-keyword"><span class="hljs-keyword">static_cast</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">time_t</span></span>&gt;(EventTime) + UserID % <span class="hljs-number"><span class="hljs-number">1000000</span></span>; random_with_seed.seed(powerLaw(<span class="hljs-number"><span class="hljs-number">5000</span></span>, <span class="hljs-number"><span class="hljs-number">1.1</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> get_random_with_seed = [&amp;]{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> random_with_seed(); };</code> </pre><br>  Pendekatan terhadap tugas ini gagal.  Jika saya mendekatinya lebih rajin, pasti naskahnya sudah ditulis. <br><br>  Keuntungan: <br><br><ul><li>  kesederhanaan ideologis. </li></ul><br>  Kekurangan: <br><br><ul><li>  kompleksitas implementasi, </li><li>  solusi yang diterapkan hanya cocok untuk satu jenis data. </li></ul><br>  Dan saya ingin solusi yang lebih umum - sehingga dapat diterapkan tidak hanya untuk data Yandex.Metrica, tetapi juga untuk mengaburkan data lainnya. <br><br>  Namun, perbaikan mungkin dilakukan di sini.  Anda tidak dapat memilih model secara manual, tetapi menerapkan katalog model dan memilih yang terbaik di antara mereka (paling cocok + semacam regularisasi).  Atau mungkin Anda dapat menggunakan model Markov untuk semua jenis bidang, dan bukan hanya untuk teks.  Ketergantungan antar data juga dapat dipahami secara otomatis.  Untuk melakukan ini, Anda perlu menghitung <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">entropi relatif</a> (jumlah relatif informasi) antara kolom, atau lebih sederhana, kardinalitas relatif (seperti "berapa banyak nilai A yang berbeda rata-rata untuk nilai tetap B") untuk setiap pasangan kolom.  Ini akan memperjelas, misalnya, bahwa URLDomain sepenuhnya bergantung pada URL, dan bukan sebaliknya. <br><br>  Tetapi saya juga menolak ide ini, karena ada terlalu banyak pilihan untuk apa yang perlu diperhitungkan, dan akan membutuhkan waktu lama untuk menulis. <br><br><h2>  Jaringan saraf </h2><br>  Saya sudah mengatakan betapa pentingnya tugas ini bagi kita.  Tidak ada yang bahkan berpikir untuk membuat creep ke implementasinya.  Untungnya, kolega Ivan Puzyrevsky kemudian bekerja sebagai guru di HSE dan pada saat yang sama mengembangkan inti YT.  Dia bertanya apakah saya memiliki tugas menarik yang dapat ditawarkan kepada siswa sebagai topik diploma.  Saya menawarkan kepadanya yang ini dan dia meyakinkan saya bahwa itu cocok.  Jadi saya memberikan tugas ini kepada orang baik "dari jalan" - Sharif Anvardinov (NDA ditandatangani untuk bekerja dengan data). <br><br>  Dia bercerita tentang semua idenya, tetapi yang paling penting, dia menjelaskan bahwa masalahnya bisa diselesaikan dengan cara apa pun.  Dan pilihan yang bagus adalah menggunakan pendekatan yang sama sekali tidak saya mengerti: misalnya, menghasilkan dump data teks menggunakan LSTM.  Itu tampak menggembirakan berkat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">artikel Efektivitas Yang Tidak Beralasan dari Jaringan Syaraf Berulang</a> , yang kemudian menarik perhatian saya. <br><br>  Fitur pertama dari tugas ini adalah Anda harus menghasilkan data terstruktur, bukan hanya teks.  Tidak jelas apakah jaringan saraf berulang akan dapat menghasilkan data dengan struktur yang diinginkan.  Ada dua cara untuk menyelesaikan ini.  Yang pertama adalah menggunakan model terpisah untuk menghasilkan struktur dan untuk "pengisi": jaringan saraf seharusnya hanya menghasilkan nilai.  Tetapi opsi ini ditunda sampai nanti, setelah itu mereka tidak pernah melakukannya.  Cara kedua adalah dengan hanya menghasilkan dump TSV sebagai teks.  Praktek telah menunjukkan bahwa di bagian teks dari baris tidak akan sesuai dengan struktur, tetapi baris ini dapat dibuang saat memuat. <br><br>  Fitur kedua - jaringan saraf berulang menghasilkan urutan data, dan dependensi dalam data hanya dapat mengikuti urutan urutan ini.  Namun dalam data kami, mungkin urutan kolom dibalik sehubungan dengan dependensi di antara mereka.  Kami tidak melakukan apa pun dengan fitur ini. <br><br>  Menjelang musim panas, skrip Python yang berfungsi pertama kali muncul yang menghasilkan data.  Pada pandangan pertama, kualitas data layak: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6f4/816/f70/6f4816f70912c3fb348f505d3073eded.jpg"><br><br>  Benar, kesulitan terungkap: <br><br><ol><li>  Ukuran model ini sekitar satu gigabyte.  Dan kami mencoba membuat model untuk data yang ukurannya di urutan beberapa gigabyte (untuk pemula).  Fakta bahwa model yang dihasilkan sangat besar menimbulkan kekhawatiran: tiba-tiba akan mungkin untuk mendapatkan data nyata dari tempat ia dilatih.  Kemungkinan besar tidak.  Tapi saya tidak mengerti pembelajaran mesin dan jaringan saraf dan saya belum membaca kode Python dari orang ini, jadi bagaimana saya bisa yakin?  Lalu ada artikel tentang cara mengompres jaringan saraf tanpa kehilangan kualitas, tetapi ini dibiarkan tanpa implementasi.  Di satu sisi, ini tidak terlihat seperti masalah - Anda dapat menolak untuk menerbitkan model dan hanya mempublikasikan data yang dihasilkan.  Di sisi lain, dalam kasus pelatihan ulang, data yang dihasilkan dapat berisi beberapa bagian dari data sumber. </li><li>  Pada mesin tunggal dengan CPU, laju pembuatan data sekitar 100 baris per detik.  Kami memiliki tugas - untuk menghasilkan setidaknya satu miliar baris.  Perhitungan menunjukkan bahwa ini tidak dapat dilakukan sebelum pembelaan ijazah.  Dan menggunakan perangkat keras lain tidak praktis, karena saya memiliki tujuan - untuk membuat alat pembuatan data tersedia untuk digunakan secara luas. </li></ol><br>  Sharif mencoba mempelajari kualitas data dengan membandingkan statistik.  Sebagai contoh, saya menghitung frekuensi dengan simbol yang berbeda muncul di sumber dan dalam data yang dihasilkan.  Hasilnya menakjubkan - karakter yang paling umum adalah Ð dan Ñ. <br><br>  Jangan khawatir - dia mempertahankan diploma dengan sempurna, setelah itu kita dengan aman melupakan pekerjaan ini. <br><br><h2>  Mutasi Data Terkompresi </h2><br>  Misalkan pernyataan masalah dikurangi menjadi satu titik: Anda perlu menghasilkan data yang rasio kompresinya akan persis sama dengan data asli, sedangkan data harus dikompresi pada kecepatan yang persis sama.  Bagaimana cara melakukannya?  Perlu mengedit byte data terkompresi secara langsung!  Maka ukuran data yang dikompresi tidak akan berubah, tetapi data itu sendiri akan berubah.  Ya, dan semuanya akan bekerja dengan cepat.  Ketika ide ini muncul, saya langsung ingin mengimplementasikannya, meskipun fakta bahwa itu memecahkan beberapa masalah lain, bukan yang asli.  Itu selalu terjadi. <br><br>  Bagaimana cara mengedit file terkompresi secara langsung?  Misalkan kita hanya tertarik pada LZ4.  Data yang dikompres menggunakan LZ4 terdiri dari dua jenis instruksi: <br><br><ol><li>  Literal: salin N byte berikutnya apa adanya. </li><li>  Cocok (cocok, cocok, panjang pengulangan minimum adalah 4): ulangi N byte yang ada di file pada jarak M. </li></ol><br>  Sumber data: <br>  <code>Hello world Hello</code> . <br><br>  Data terkompresi (bersyarat): <br>  <code>literals 12 "Hello world " match 5 12</code> . <br><br>  Dalam file terkompresi, biarkan cocok apa adanya, dan dalam literal kami akan mengubah nilai byte.  Akibatnya, setelah dekompresi, kami memperoleh file di mana semua urutan berulang setidaknya 4 juga diulang, dan diulang pada jarak yang sama, tetapi pada saat yang sama terdiri dari serangkaian byte yang berbeda (secara kiasan, tidak satu byte diambil dari file asli dalam file yang dimodifikasi) ) <br><br>  Tetapi bagaimana cara mengubah byte?  Ini tidak jelas karena, selain jenis kolom, data juga memiliki struktur internal, implisit sendiri, yang ingin kami pertahankan.  Misalnya, teks sering disimpan dalam pengkodean UTF-8 - dan kami ingin UTF-8 juga valid dalam data yang dihasilkan.  Saya membuat heuristik sederhana untuk memenuhi beberapa kondisi: <br><br><ul><li>  null byte dan karakter kontrol ASCII disimpan apa adanya, </li><li>  beberapa tanda baca tetap ada, </li><li>  ASCII diterjemahkan ke dalam ASCII, dan sisanya, bit yang paling signifikan disimpan (atau Anda dapat secara eksplisit menulis jika diset untuk panjang UTF-8 yang berbeda).  Di antara satu kelas byte, nilai baru dipilih secara acak; </li><li>  dan juga untuk menyimpan fragmen <code>https://</code> dan sejenisnya, jika tidak semuanya terlihat konyol. </li></ul><br>  Keunikan dari pendekatan ini adalah bahwa data awal itu sendiri bertindak sebagai model untuk data, yang berarti bahwa model tersebut tidak dapat dipublikasikan.  Ini memungkinkan Anda untuk menghasilkan jumlah data tidak lebih dari yang asli.  Sebagai perbandingan, dalam pendekatan sebelumnya dimungkinkan untuk membuat model dan menghasilkan data dalam jumlah yang tidak terbatas. <br><br>  Contoh untuk URL: <br><br> <code>http://ljc.she/kdoqdqwpgafe/klwlpm&amp;qw=962788775I0E7bs7OXeAyAx <br> http://ljc.she/kdoqdqwdffhant.am/wcpoyodjit/cbytjgeoocvdtclac <br> http://ljc.she/kdoqdqwpgafe/klwlpm&amp;qw=962788775I0E7bs7OXe <br> http://ljc.she/kdoqdqwdffhant.am/wcpoyodjit/cbytjgeoocvdtclac <br> http://ljc.she/kdoqdqwdbknvj.s/hmqhpsavon.yf#aortxqdvjja <br> http://ljc.she/kdoqdqw-bknvj.s/hmqhpsavon.yf#aortxqdvjja <br> http://ljc.she/kdoqdqwpdtu-Unu-Rjanjna-bbcohu_qxht <br> http://ljc.she/kdoqdqw-bknvj.s/hmqhpsavon.yf#aortxqdvjja <br> http://ljc.she/kdoqdqwpdtu-Unu-Rjanjna-bbcohu_qxht <br> http://ljc.she/kdoqdqw-bknvj.s/hmqhpsavon.yf#aortxqdvjja <br> http://ljc.she/kdoqdqwpdtu-Unu-Rjanjna-bbcohu-702130 <br></code> <br>  Hasilnya menyenangkan saya - itu menarik untuk melihat data.  Tapi tetap saja, ada sesuatu yang salah.  URL masih terstruktur, tetapi di beberapa tempat terlalu mudah untuk menebak yandex atau avito.  Membuat heuristik yang terkadang mengatur ulang beberapa byte di beberapa tempat. <br><br>  Pertimbangan lainnya mengkhawatirkan.  Misalnya, informasi sensitif dapat direpresentasikan dalam kolom tipe FixedString dalam bentuk biner dan untuk beberapa alasan terdiri dari karakter kontrol ASCII dan tanda baca, yang saya putuskan untuk disimpan.  Dan saya tidak mempertimbangkan tipe data. <br><br>  Masalah lain: jika data tipe "panjang, nilai" disimpan dalam satu kolom (ini adalah bagaimana kolom tipe String disimpan), lalu bagaimana memastikan panjangnya tetap benar setelah mutasi?  Ketika saya mencoba memperbaikinya, tugas itu segera menjadi tidak menarik. <br><br><h2>  Permutasi acak </h2><br>  Tetapi masalahnya tidak terpecahkan.  Kami melakukan beberapa percobaan, dan itu semakin memburuk.  Tetap hanya melakukan apa-apa dan membaca halaman acak di Internet, karena suasana hatinya sudah rusak.  Untungnya, pada salah satu halaman ini adalah <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">penguraian algoritma untuk</a> menampilkan adegan kematian protagonis di game Wolfenstein 3D. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a5d/8a2/291/a5d8a229119786bc45f48fb74cfb956d.gif" width="640" height="480"><br><br>  Animasi yang indah - layar dipenuhi dengan darah.  Artikel ini menjelaskan bahwa ini sebenarnya permutasi pseudo-acak.  Permutasi acak - transformasi satu-ke-satu yang dipilih secara acak dari suatu set.  Yaitu, tampilan seluruh rangkaian di mana hasil untuk argumen yang berbeda tidak diulang.  Dengan kata lain, ini adalah cara untuk mengulangi semua elemen dari set secara acak.  Ini adalah proses yang ditunjukkan pada gambar - kami mengecat setiap piksel, dipilih secara acak dari semua, tanpa pengulangan.  Jika kita hanya memilih piksel acak pada setiap langkah, maka akan butuh waktu lama untuk melukiskan yang terakhir. <br><br>  Gim ini menggunakan algoritma yang sangat sederhana untuk permutasi pseudo-acak - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">LFSR</a> (register umpan balik linier).  Seperti generator bilangan pseudo-acak, permutasi acak, atau lebih tepatnya keluarga mereka, yang diparameterisasi oleh kunci, dapat kuat secara kriptografis - inilah yang kita perlukan untuk mengonversi data.  Meskipun mungkin ada detail yang tidak jelas.  Sebagai contoh, enkripsi kriptografis yang kuat dari N byte ke N byte dengan kunci pra-tetap dan vektor inisialisasi, tampaknya, dapat digunakan sebagai permutasi pseudo-acak dari banyak string N-byte.  Memang, transformasi semacam itu adalah satu-ke-satu dan terlihat acak.  Tetapi jika kita menggunakan transformasi yang sama untuk semua data kita, maka hasilnya dapat dianalisis, karena vektor inisialisasi dan nilai-nilai kunci yang sama digunakan beberapa kali.  Ini mirip dengan mode cipher blok <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Codebook Elektronik</a> . <br><br>  Apa cara untuk mendapatkan permutasi pseudo-acak?  Anda dapat mengambil transformasi sederhana, satu-ke-satu dan merakit fungsi yang cukup kompleks dari mereka yang akan terlihat acak.  Biarkan saya memberi Anda contoh dari beberapa transformasi satu-ke-satu favorit saya: <br><br><ul><li>  perkalian dengan angka ganjil (mis. prime besar) dalam aritmatika komplemen dua, </li><li>  xor-shift: <code>x ^= x &gt;&gt; N</code> , </li><li>  CRC-N, di mana N adalah jumlah bit argumen. </li></ul><br>  Jadi, misalnya, dari tiga operasi perkalian dan dua operasi xor-shift, finalizer <a href="">murmurhash dirakit</a> .  Operasi ini adalah permutasi pseudo-acak.  Tapi untuk jaga-jaga, saya perhatikan bahwa fungsi hash, bahkan N bit dalam N bit, tidak harus saling unik. <br><br>  Atau inilah <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">contoh</a> lain yang menarik <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">dari teori bilangan dasar</a> dari situs Jeff Preshing. <br><br>  Bagaimana kita bisa menggunakan permutasi pseudo-acak untuk tugas kita?  Anda dapat mengonversi semua bidang angka menggunakan mereka.  Maka akan dimungkinkan untuk mempertahankan semua kardinalitas dan kardinalitas timbal balik dari semua kombinasi bidang.  Yaitu, COUNT (DISTINCT) akan mengembalikan nilai yang sama seperti sebelum konversi, dan dengan GROUP BY. <br><br>  Perlu dicatat bahwa pelestarian semua kardinalitas sedikit bertentangan dengan pernyataan masalah anonimisasi data. ,  ,         ,      10  ,        .           10   —   ,    .    ,    ,     ,         — ,    ,    .       . ,    ,         ,     Google,       ,  -          Google.       — ,      ,          ( )     ( ).  ,        ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="></a> . <br><br>           ,      . ,       10,        .   ? <br><br> ,       size classes         (  ).       size class        ,    .  0  1    .  2  3   1/2        1/2      .   1024..2047     1024! () .  Dan sebagainya.        . <br><br>  ,     . ,      -.    ,      . <br><br>       ,     ,      ,             . <br><br>    —             ,       .   .            .   Fabien Sanglard   c <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Hackers News</a> ,      .      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">    Redis</a> —  .    ,            <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="> </a> . <br><br>     .   —  ,        . ,   . <br><br><ol><li>      : <br> <code>arg: xxxxyyyy <br> <font color="#0fc000">arg_l</font> : xxxx <br> <font color="#0000ff">arg_r</font> : yyyy</code> </li> <li>      .      xor        : <br> <code>res: yyyyzzzz <br> <font color="#0000ff">res_l</font> = yyyy = <font color="#0000ff">arg_r</font> <br> <font color="#FF6600">res_r</font> = zzzz = <font color="#0fc000">arg_l</font> ^ F( <font color="#0000ff">arg_r</font> )</code> </li> </ol><br>   ,     F            4 ,      . <br><br>   :  ,       ,      —      ,       ,     ! <br><br>         .  ,    ,      ,    .     : <br><br><ul><li>     ,  ,  Electronic Codebook mode of operation; </li><li>        (  )   ,     ,      . </li></ul><br>           . ,     LZ4     ,             ,        . <br><br><h2>   </h2><br>    ,  ,  ,         .   —     .  , ,      ,    .                ( ,    ).          ? <br><br> -,         : ,  256^10     10 ,      ,          . -,      ,     . <br><br>        ,      . ,    ,       .    ,       .    ,   -   . <br><br>             ,       —  ,     N   . N —   . , N = 5,       «»   «».       Order-N. <br><br> <code>P( <font color="#ff0000"></font> | ) = 0.9 <br> P( <font color="#ff0000"></font> | ) = 0.05 <br> P( <font color="#ff0000"></font> | ) = 0.01 <br> ...</code> <br> <br>         <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">.</a> ( vesna.yandex.ru).      LSTM,           N,    ,  .          —           ,    .  :      ,  ,      . <br><br>   Title: <br><br><blockquote>   — . —     ,   .   ,   ,      — .@Mail.Ru —   — -    . ) — AUTO.ria.ua        </blockquote><br> ,       ,          .       () ,           —   .        0  N,         N    N − 1). <br><br>       . ,      123456   URL,          .                    .      -.       .      ,    . <br><br>   :         URL,        ,   -. : <code>https://www.yandex.ru/images/cats/?id=xxxxxx</code> .  ,      URL,      ,   . : <code>http://ftp.google.kz/cgi-bin/index.phtml?item=xxxxxx</code> .                  -     ,      8    . <br><br> <code>https://www.yandex.ru/ <font color="#0fc000">images/c</font> ats/?id=12345 <br> ^^^^^^^^ <br> <br> distribution: [aaaa][b][cc][dddd][e][ff][g <font color="#ff0000">g</font> ggg][h]... <br> hash(" <font color="#0fc000">images/c</font> ") % total_count:           ^ <br> <br></code> <code>http://ftp.google.kz/c <font color="#ff0000">g</font> ...</code> <br> <br>    ,  .     : <br><br><blockquote><pre> -        | . -    <font></font>
-  — .:      Lore - dfghf — . -   )  473682  -  <font></font>
- !   »  -  —      <font></font>
- !   » , <font></font>
-  .  c      @Mail.Ru - <font></font>
-     ,  2010 |  . <font></font>
- !    : 820 0000 .,    -<font></font>
-   - DoramaTv.ru -   . -  ..    <font></font>
-  .  2013 ,       -&gt;  80 .<font></font>
-  -    (.    , ,  <font></font>
-   . 5, 69,  W* - ., ,      World of Tanks<font></font>
- ,     . 2     @Mail.Ru<font></font>
-      ,  .   <font></font>
</pre></blockquote><br><h2>  Hasil </h2><br>        ,     - ,        -   .          ,  .      clickhouse obfuscator,     :          (, CSV, JSONEachRow),        (   )    ( ,       ).         . <br><br>     clickhouse-client,         Linux.        ,   ClickHouse. ,         MySQL  PostgreSQL ,        . <br><br> <code>clickhouse obfuscator \ <br> --seed "$(head -c16 /dev/urandom | base64)" \ <br> --input-format TSV --output-format TSV \ <br> --structure 'CounterID UInt32, URLDomain String, \ <br> URL String, SearchPhrase String, Title String' \ <br> &lt; table.tsv &gt; result.tsv <br> <br> clickhouse obfuscator --help <br></code> <br>    ,        .     ,   ?      ,        ,    .        ,    ,      .   ,     (  <code>--help</code> )   . <br><br>     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">   </a> ,        . <br><br> <a href="">clickhouse-datasets.s3.yandex.net/hits/tsv/hits_v1.tsv.xz</a> <br> <a href="">clickhouse-datasets.s3.yandex.net/visits/tsv/visits_v1.tsv.xz</a> <br><br>                ClickHouse.          ,       ClickHouse  . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id457354/">https://habr.com/ru/post/id457354/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id457340/index.html">10 plugin PostCSS yang akan menghemat waktu tata letak Anda</a></li>
<li><a href="../id457342/index.html">Tanda dari Atas: Bagaimana Kami Menyelamatkan Kartografer dari Pekerjaan yang Tidak Perlu dan Mata Merah</a></li>
<li><a href="../id457348/index.html">Penempatan di PythonAnywhere dari GitHub</a></li>
<li><a href="../id457350/index.html">Mengapa osiloskop memerlukan dukungan kriptografi?</a></li>
<li><a href="../id457352/index.html">Kesimpulan informasi pada tampilan pembeli</a></li>
<li><a href="../id457362/index.html">Promosi dari RUVDS: siapkan server di musim panas</a></li>
<li><a href="../id457366/index.html">Seorang fanatik, sepotong besi atau penonton - gamer seperti apa Anda?</a></li>
<li><a href="../id457374/index.html">Kurangi waktu pembangunan proyek Android Anda</a></li>
<li><a href="../id457378/index.html">Bagaimana id Software menciptakan Wolfenstein 3D berdasarkan teknologi dari Commander Keen</a></li>
<li><a href="../id457380/index.html">OpenGL Ultramodern. Bagian 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>