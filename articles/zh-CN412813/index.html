<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤴🏿 🏕️ 🤱🏽 不必要的HTTP标头 🗒️ 🎷 👩🏽‍🏭</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="HTTP标头对于控制缓存和浏览器如何处理您的内容很重要。 但是其中许多使用不正确或毫无意义，在页面加载的关键时刻花费了额外的资源，并且它们可能无法按照您的想法工作。 在一系列有关最佳做法的文章中，我们将首先介绍不必要的标题。 

 大多数开发人员都知道重要且有用的HTTP标头。 最著名的是Conte...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>不必要的HTTP标头</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/412813/"> HTTP标头对于控制缓存和浏览器如何处理您的内容很重要。 但是其中许多使用不正确或毫无意义，在页面加载的关键时刻花费了额外的资源，并且它们可能无法按照您的想法工作。 在一系列有关最佳做法的文章中，我们将首先介绍不必要的标题。 <br><br> 大多数开发人员都知道重要且有用的HTTP标头。 最著名的是<code>Content-Type</code>和<code>Content-Length</code> ，它们几乎是通用标头。 但是最近，诸如<code>Content-Security-Policy</code>和<code>Strict-Transport-Security</code>类的标头已用于提高<code>Strict-Transport-Security</code> ，而<code>Link rel=preload</code>可提高性能。 尽管浏览器广泛支持，但只有少数浏览器使用它们。 <br><br> 同时，有许多非常受欢迎的头条通常不是新手，也不是很有用。 我们可以借助<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=http://">HTTP归档</a>来证明这一点， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=http://">HTTP归档</a>是由Google运行并由Fastly赞助的项目，该项目每月使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">WebPageTest</a>下载500,000个站点并将结果上传到<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">BigQuery</a> 。 <br><a name="habracut"></a><br> 根据HTTP存档，这是30个最流行的响应标头（基于每个标头显示的存档中的域数），并大致估算了它们的有用性： <br><br><table><tbody><tr><th> 标题 </th><th> 咨询处 </th><th> 域 </th><th> 现况 </th></tr><tr><td> 日期 </td><td>  48779277 </td><td>  535621 </td><td> 需要协议 </td></tr><tr><td> 内容类型 </td><td>  47185627 </td><td>  533636 </td><td> 浏览器通常需要 </td></tr><tr><td>  <strong>伺服器</strong> </td><td>  <strong>43057807</strong> </td><td>  <strong>519663</strong> </td><td>  <strong>选配</strong> </td></tr><tr><td> 内容长度 </td><td>  42388435 </td><td>  519118 </td><td> 有用的 </td></tr><tr><td> 最后修改 </td><td>  34424562 </td><td>  480294 </td><td> 有用的 </td></tr><tr><td> 缓存控制 </td><td>  36490878 </td><td>  412943 </td><td> 有用的 </td></tr><tr><td> 标签 </td><td>  23620444 </td><td>  412370 </td><td> 有用的 </td></tr><tr><td> 内容编码 </td><td>  16194121 </td><td>  409159 </td><td> 压缩内容必需 </td></tr><tr><td>  <strong>过期</strong> </td><td>  <strong>29869228</strong> </td><td>  <strong>360311</strong> </td><td>  <strong>选配</strong> </td></tr><tr><td>  <strong>由x供电</strong> </td><td>  <strong>4883204</strong> </td><td>  <strong>211409</strong> </td><td>  <strong>选配</strong> </td></tr><tr><td>  <strong>语用</strong> </td><td>  <strong>7641647</strong> </td><td>  <strong>188784</strong> </td><td>  <strong>选配</strong> </td></tr><tr><td>  <strong>X帧选项</strong> </td><td>  <strong>3670032</strong> </td><td>  <strong>105846</strong> </td><td>  <strong>选配</strong> </td></tr><tr><td> 访问控制允许来源 </td><td>  11335681 </td><td>  103596 </td><td> 有用的 </td></tr><tr><td>  x内容类型选项 </td><td>  11071560 </td><td>  94590 </td><td> 有用的 </td></tr><tr><td> 连结 </td><td>  1212329 </td><td>  87475 </td><td> 有用的 </td></tr><tr><td> 年龄 </td><td>  7401415 </td><td>  59242 </td><td> 有用的 </td></tr><tr><td>  <strong>X缓存</strong> </td><td>  <strong>5275343</strong> </td><td>  <strong>56889</strong> </td><td>  <strong>选配</strong> </td></tr><tr><td>  x-xss保护 </td><td>  9773906 </td><td>  51810 </td><td> 有用的 </td></tr><tr><td> 严格运输安全 </td><td>  4259121 </td><td>  51283 </td><td> 有用的 </td></tr><tr><td>  <strong>通过</strong> </td><td>  <strong>4020117</strong> </td><td>  <strong>47102</strong> </td><td>  <strong>选配</strong> </td></tr><tr><td>  <strong>3</strong> </td><td>  <strong>8282840</strong> </td><td>  <strong>44308</strong> </td><td>  <strong>选配</strong> </td></tr><tr><td> 期望值 </td><td>  2685280 </td><td>  40465 </td><td> 有用的 </td></tr><tr><td> 内容语言 </td><td>  334081 </td><td>  37927 </td><td> 有争议的 </td></tr><tr><td>  <strong>x-aspnet版本</strong> </td><td>  <strong>676128</strong> </td><td>  <strong>33473</strong> </td><td>  <strong>选配</strong> </td></tr><tr><td> 访问控制允许凭证 </td><td>  2804382 </td><td>  30346 </td><td> 有用的 </td></tr><tr><td>  X机器人标签 </td><td>  179177 </td><td>  24911 </td><td> 对浏览器无关紧要 </td></tr><tr><td>  <strong>x-ua兼容</strong> </td><td>  <strong>489056</strong> </td><td>  <strong>24811</strong> </td><td>  <strong>选配</strong> </td></tr><tr><td> 访问控制允许方法 </td><td>  1626129 </td><td>  20791 </td><td> 有用的 </td></tr><tr><td> 访问控制允许标题 </td><td>  1205735 </td><td>  19120 </td><td> 有用的 </td></tr></tbody></table><br> 让我们看一下可选的标头，为什么不需要它们以及如何处理。 <br><br><h2> 虚荣（服务器，x-by-by，通过） </h2><br> 您可以为服务器软件的选择感到骄傲，但是大多数人对此并不满意。 在最坏的情况下，这些标头可能会泄露敏感数据，从而更容易攻击您的网站。 <br><br> <code>Server: apache <br> X-Powered-By: PHP/5.1.1 <br> Via: 1.1 varnish, 1.1 squid</code> <br> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://">RFC7231</a>允许您在服务器响应中包括Server标头，指示服务器上用于传递内容的特定软件。 通常，这是一个字符串，例如“ apache”或“ nginx”。 尽管标题是允许的，但标题是可选的，对开发人员或最终用户而言并不是特别有价值。 但是，今天它是Internet上第三大最受欢迎的HTTP服务器标头。 <br><br>  <code>X-Powered-By</code>是最流行的标题，没有任何标准定义，并且具有类似的用途：它通常表示服务器在其上运行的应用程序平台。 最受欢迎的答案包括“ ASP.net”，“ PHP”和“ Express”。 同样，这并没有带来任何实际的利益，只是发生了。 <br><br> 也许可以通过<code>Via</code>考虑更多争议。 要求（ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://">根据RFC7230</a> ）将<i>请求</i>通过的每个代理添加到请求中-标识代理。 这可能是代理主机名，但更常见的是通用标识符，例如“ vegur”，“ varnish”或“ squid”。 删除（或不添加）此类标头可能导致<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">代理转发周期</a> 。 但有趣的是，它也响应浏览器的返回路径而添加-在这里，它仅执行信息功能：没有浏览器对其执行任何操作，因此可以安全地将其删除。 <br><br><h2> 不推荐使用的标准（P3P，过期，X框架选项，X-UA兼容） </h2><br> 标题的另一类是实际上在浏览器中引起影响的标题，但是（已经）不是达到这种效果的最佳方法。 <br><br> <code>P3P: cp="this is not a p3p policy" <br> Expires: Thu, 01 Dec 1994 16:00:00 GMT <br> X-Frame-Options: SAMEORIGIN <br> X-UA-Compatible: IE=edge</code> <br> <br>  <code>P3P</code>是一件有趣的小事。 我不知道那是什么。 更有趣的是，P3P标头最常见的内容之一是“这不是P3P规则”。 好吧，是不是？ <br><br> 在这里，故事可以追溯到对<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">机器可读隐私规则进行标准化的尝试</a> 。 关于如何在浏览器中显示数据存在分歧，只有一种浏览器实现了对该标头的支持-Internet Explorer。 但是即使在其中，P3P对用户也没有视觉效果。 他只需要在场即可允许访问框架中的第三方Cookie。 如上例所示，有些站点甚至设置了P3P不合规规则，尽管这样做存在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">很大的问题</a> 。 <br><br> 不用说，读取第三方cookie通常不是一个好主意，因此，如果您不这样做，则无需设置<code>P3P</code>标头！ <br><br> 考虑到<code>Cache-Control</code>在20多年来一直优于<code>Expires</code> ， <code>Expires</code>简直<code>Expires</code>难以置信的受欢迎。 如果<code>Cache-Control</code>标头包含<code>max-age</code>指令，则将忽略同一响应中的所有<code>Expires</code>标头。 但是大量站点都设置了这两个标头，并且<code>Expires</code>最经常设置日期<code>Thu, 01 Dec 1994 16: 00: 00 GMT</code> ，以便不缓存内容。 当然， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">从规格中</a>复制日期是最容易<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">的</a> 。 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/08b/cab/34b/08bcab34b2210548e77cbe708ffdd17e.png"><br><br> 但是根本没有必要这样做。 如果您有一个带有过去日期的<code>Expires</code>标头，只需将其替换为： <br><br> <code>Cache-Control: no-store, private</code> <br> <br>  （ <code>no-store</code>是一个过于严格的指令，不能将内容写入持久性存储，因此您可能更喜欢使用<code>no-cache</code>以获得更好的性能，例如，在浏览器中向后/向前导航或恢复睡眠选项卡） <br><br> 一些站点验证工具会建议您添加一个值为“ SAMEORIGIN”的<code>X-Frame-Options</code>标头。 它告诉浏览器您拒绝将内容发送到另一个站点上的框架：通常，这是防止<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">clickjacking</a>的很好的防御措施。 但是，使用具有更一致的支持和更可靠行为的另一个标头可以实现相同的效果： <br><br> <code>Content-Security-Policy: frame-ancestors 'self'</code> <br> <br> 这里还有一个额外的好处，因为由于其他原因您仍然必须提供CSP标头（稍后会详细介绍）。 也许在我们这个时代，您可以不使用<code>X-Frame-Options</code> 。 <br><br> 最后，回到IE9，Microsoft引入了一种“兼容模式”，该模式使用IE8或IE7引擎呈现页面。 即使在普通模式下，浏览器也认为可能需要较旧版本的引擎才能正确渲染。 这些试探法并不总是能正常工作，开发人员可以使用<code>X-UA-Compatible</code>标头或元标记来覆盖它们。 实际上，这已成为许多框架（如Bootstrap）的标准部分。 现在，该标题实际上是无用的：了解该标题的浏览器的比例很小。 而且，如果您积极支持该站点，那么它不太可能使用会启动兼容模式的技术。 <br><br><h2> 调试数据（X-ASPNet版本，X缓存） </h2><br> 在某些方面，令人惊讶的是，在任何标准中都根本没有提到某些最受欢迎的标题。 本质上，这意味着成千上万的网站以某种方式同意以某种方式使用某种标题。 <br><br> <code>X-Cache: HIT <br> X-Request-ID: 45a336c7-1bd5-4a06-9647-c5aab6d5facf <br> X-ASPNet-Version: 3.2.32 <br> X-AMZN-RequestID: 0d6e39e2-4ecb-11e8-9c2d-fa7ae01bbebc</code> <br> <br> 实际上，这些“未知”标题不是开发人员发明的。 通常，这些是使用特定供应商的某些服务器框架，软件或服务的构件（例如，最后一个标头是AWS的典型代表）。 <br><br>  <code>X-Cache</code>标头与其他特定标头（例如<code>X-Cache-Hits</code>和<code>X-Served-By</code> ）一起快速添加（和其他CDN）。 启用调试后，会添加更多内容，例如<code>Fastly-Debug-Path</code>和<code>Fastly-Debug-TTL</code> 。 <br><br> 这些标题不能被任何浏览器识别，并且删除它们根本不会影响页面的显示。 但是，由于它们可以为开发人员提供有用的信息，因此您可以保存它们。 <br><br><h2> 误会（语用） </h2><br> 我没想到在2018年我会提到<code>Pragma</code>标头，但是根据HTTP Archive的数据，它仍然排在首位（第11位）。 它不仅在1997年被宣布作废，而且从未被认为是响应头，而只是作为请求的一部分。 <br><br> <code>Pragma: no-cache</code> <br> <br> 但是，它被广泛用作响应头，以至于某些浏览器甚至在这种情况下也可以识别它。 但是，今天，在答案的背景下有人了解<code>Pragma</code>却不了解<code>Cache-Control</code>可能性几乎为零。 如果要禁用缓存，则只需要<code>Cache-Control: no-store, private</code> 。 <br><br><h2> 非浏览器（X机器人代码） </h2><br> 前30名中的一个标题不是浏览器的标题。  <code>X-Robots-Tag</code>为爬虫（例如Google bot或Bing）设计的。 由于它对浏览器没有用，因此您只能为来自搜寻器的请求设置这样的答案。 或者您认为这使测试变得困难或违反了搜索引擎的使用条款。 <br><br><h2> 虫子 </h2><br> 最后，值得一提的是对简单错误的光荣提及。  <code>Host</code>标头在<i>请求中</i>很有意义，但是如果它出现在响应中，则可能是您的服务器配置不正确（我想知道如何）。 但是，HTTP存档中的68个域在其响应中返回一个<code>Host</code>标头。 <br><br><h2> 删除边缘CDN服务器上的标头 </h2><br> 幸运的是，如果您的网站与我们一起快速运行，那么使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">VCL</a>删除标头非常简单。 如果您想让开发团队对调试确实很有用，但对公众隐藏了它，那么可以使用Cookie或传入的HTTP标头轻松完成此操作： <br><br> <code>unset resp.http.Server; <br> unset resp.http.X-Powered-By; <br> unset resp.http.X-Generator; <br> <br> if (!req.http.Cookie:debug &amp;&amp; !req.http.Debug) { <br> unset resp.http.X-Amzn-RequestID; <br> unset resp.http.X-Cache; <br> }</code> <br> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">在下一篇文章中，</a>我将讨论真正需要的标题的最佳做法以及如何在CDN边缘服务器上激活它们。 </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN412813/">https://habr.com/ru/post/zh-CN412813/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN412803/index.html">深入了解各种智能合约平台</a></li>
<li><a href="../zh-CN412805/index.html">以电报中的游戏机器人为例，我在游戏开发人员世界中的步骤，成功和错误</a></li>
<li><a href="../zh-CN412807/index.html">物联网提供商的说明。 专有权</a></li>
<li><a href="../zh-CN412809/index.html">使用USB令牌在站点上进行两因素身份验证。 如何确保对服务门户的访问安全？</a></li>
<li><a href="../zh-CN412811/index.html">Elbrus上的C DevTools：HolyJS 2018 Piter的生动报道</a></li>
<li><a href="../zh-CN412815/index.html">Web Manager OpenVPN客户端密钥VPNFace Lite</a></li>
<li><a href="../zh-CN412819/index.html">周五为心灵热身：哈布拉哈伯的完美因果报应</a></li>
<li><a href="../zh-CN412821/index.html">看，看，看：有什么区别？</a></li>
<li><a href="../zh-CN412823/index.html">英语面试：如何做到不比母亲儿子的朋友更糟</a></li>
<li><a href="../zh-CN412825/index.html">QEMU块设备</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>