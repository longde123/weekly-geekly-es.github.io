<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>#‚É£ üé¥ ‚õΩÔ∏è Veeam Backup y prueba de carga de replicaci√≥n üë®‚Äçüíª üéä üë®üèæ‚Äç‚úàÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En la primavera de 2018, Selectel lanz√≥ un servicio de respaldo para VMware Cloud a trav√©s de Veeam¬Æ Backup & Replication ‚Ñ¢ (en adelante VBR). Abordam...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Veeam Backup y prueba de carga de replicaci√≥n</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/selectel/blog/431596/"><img src="https://habrastorage.org/webt/b4/zh/jj/b4zhjj50y8pexmomkjgovcahmvk.png"><br><br>  En la primavera de 2018, Selectel lanz√≥ un servicio de respaldo para <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">VMware Cloud a</a> trav√©s de Veeam¬Æ Backup &amp; Replication ‚Ñ¢ (en adelante VBR).  Abordamos el proyecto a fondo, planificamos y realizamos la siguiente lista de trabajos: <br><br><ul><li>  Explorando la documentaci√≥n del producto Veeam y las mejores pr√°cticas </li><li>  Dise√±o de una arquitectura VBR de nivel de proveedor de servicios </li><li>  Implementar infraestructura VBR </li><li>  Probar la soluci√≥n, determinar la configuraci√≥n √≥ptima y los modos operativos </li><li>  Lanzamiento de la soluci√≥n en operaci√≥n industrial (comercial) </li></ul><br>  Al final result√≥ que no en vano.  El servicio es estable, los clientes pueden hacer una copia de seguridad de sus m√°quinas virtuales y tenemos una cierta experiencia que queremos compartir. <br><br>  En este art√≠culo queremos hablar sobre los resultados de las pruebas de carga VBR para los dos modos operativos de proxy de respaldo m√°s populares, teniendo en cuenta la variaci√≥n en el n√∫mero de tareas paralelas. <br><a name="habracut"></a><br>  Aqu√≠ puedes ver: <br><br><ul><li>  Descripci√≥n de la infraestructura de producci√≥n de Selectel utilizada para las pruebas. </li><li>  Caracter√≠sticas del proxy de respaldo (proxy de respaldo) en varios modos de transporte </li><li>  Descripci√≥n del programa de prueba y configuraciones de componentes VBR para su implementaci√≥n </li><li>  Indicadores cuantitativos, su comparaci√≥n y conclusiones. </li></ul><br><h2>  Probar la configuraci√≥n de la infraestructura </h2><br><h3>  Infraestructura de origen </h3><br>  Como plataforma para probar el rendimiento de VBR, se cre√≥ uno de los grupos de producci√≥n de la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">nube</a> p√∫blica <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">basada en VMware</a> . <br><br><ul><li>  La configuraci√≥n de hardware de los hosts en este cl√∫ster: </li><li>  Procesadores Intel¬Æ Xeon¬Æ Gold 6140 </li><li>  Intel¬Æ DC NVMe P4600 y P3520 </li><li>  4 puertos de 10 GbE por host </li></ul><br>  El cl√∫ster se basa en las siguientes soluciones: <br><br><ul><li>  Red f√≠sica: f√°brica de Ethernet en conmutadores Brocade VDX, arquitectura Leaf-Spine (puertos de 10 GbE - hosts de conexi√≥n, enlaces ascendentes de 40 GbE a Spine) </li><li>  Entorno de virtualizaci√≥n: VMware vSphere¬Æ 6.5 </li><li>  Almacenamiento de VM: VMware vSAN ‚Ñ¢ 6.6 (cl√∫ster All-Flash vSAN) </li><li>  Virtualizaci√≥n de red: VMware NSX¬Æ 6.4 </li></ul><br>  El rendimiento de la plataforma de prueba es m√°s que suficiente y no hay dudas.  Por supuesto, para un rendimiento de alta velocidad, todo esto debe configurarse correctamente, pero como se trata de producci√≥n, con clientes vivos y satisfechos, puede estar seguro de que todo est√° bien en este sentido. <br><br>  Junto con la nube basada en VMware, Selectel lanz√≥ un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">servicio</a> para su copia de seguridad en la plataforma VBR.  Los clientes reciben un portal web de autoservicio donde pueden hacer copias de seguridad y restaurar vApp y m√°quinas virtuales desde su VDC (centro de datos virtual). <br><br>  Los clientes tienen acceso a este portal (portal de autoservicio Veeam¬Æ Enterprise Manager) con los mismos derechos que vCloud Director¬Æ (vCD).  Esto es posible debido a la integraci√≥n de Veeam¬Æ Backup Enterprise Manager (EM) y vCD, mientras que cada cliente, cuando est√° conectado a EM, est√° limitado por los recursos de su VDC, no ver√° otras m√°quinas virtuales. <br><br>  El cliente no necesita implementar su propio VBR y la infraestructura de respaldo asociada, lo que implica el costo de los recursos inform√°ticos y de red, el almacenamiento, las licencias Veeam y MS, y la administraci√≥n.  Es largo, costoso y complicado.  Selectel proporciona las capacidades b√°sicas de VBR como un servicio BaaS (Backup-as-a-Service): de forma instant√°nea, simple, conveniente y econ√≥mica. <br><br>  Para proporcionar este servicio, Selectel implement√≥ una infraestructura de proveedor VBR que cubre todos los cl√∫steres vSphere y VDC de clientes de nube VMware, incluido el cl√∫ster en el que se realiz√≥ esta prueba.  Por lo tanto, los resultados de la prueba nos permitir√°n juzgar la velocidad m√°xima con la que los clientes pueden respaldar sus m√°quinas virtuales. <br><br><h3>  Prueba de m√°quinas virtuales </h3><br>  Para probar el rendimiento de la copia de seguridad, se implementaron 6 m√°quinas virtuales id√©nticas en el cl√∫ster de vSphere en la siguiente configuraci√≥n: <br><br><ul><li>  SO Windows Server 2016, 2 vCPU, 4 GB de RAM </li><li>  Disco virtual de 200 GB </li></ul><br>  El disco est√° casi lleno: 193 GB.  Adem√°s de los archivos del sistema operativo, se cre√≥ una carpeta con distribuciones de varios sistemas operativos y DBMS con una capacidad de 60 GB (datos √∫nicos).  En la misma unidad, se crearon 3 copias de esta carpeta, un total de 180 GB de datos que no son del sistema. <br><br>  No se instalaron aplicaciones en estas m√°quinas virtuales, solo un sistema operativo "limpio" y datos "fr√≠os".  Sin carga, computacional o de red, comenz√≥.  Para esta prueba, esto no fue requerido. <br><br>  DRS est√° habilitado en el cl√∫ster de vSphere, por lo que las m√°quinas virtuales de prueba se distribuyen autom√°ticamente de manera √≥ptima entre los hosts VMware ESXi ‚Ñ¢ para el equilibrio de carga. <br><br><h3>  Proxy de respaldo </h3><br>  Una VM con proxy de respaldo se implementa directamente en el cl√∫ster de vSphere descrito anteriormente (la infraestructura de origen, en adelante denominada el cl√∫ster de vSphere), esta es una condici√≥n necesaria para realizar pruebas en el modo de dispositivo virtual. <br><br>  Configuraci√≥n de VM: <br><br><ul><li>  8 vCPU </li><li>  8 GB de RAM </li><li>  Disco virtual de 40 GB </li><li>  10GbE vNIC vmxnet3 </li><li>  SO Windows Server 2016 </li></ul><br>  El par√°metro "Tareas simult√°neas m√°ximas" para el proxy de respaldo en el nivel VBR se establece en 6. Esto significa que el proxy de respaldo puede procesar simult√°neamente (en paralelo) hasta 6 tareas de respaldo.  Una tarea es una copia de seguridad de un disco VM virtual. <br><br><h3>  Dep√≥sito de respaldo </h3><br>  El servidor f√≠sico que act√∫a como un repositorio de respaldo de VBR act√∫a como una interfaz del almacenamiento de respaldo.  Configuraci√≥n del servidor: <br><br><ul><li>  CPU E5-1650v3 </li><li>  32 GB de RAM </li><li>  2 puertos de 10 GbE </li></ul><br>  Backend de almacenamiento: cl√∫ster CephFS con cach√© NVMe. <br><br>  El repositorio de respaldo y los nodos Ceph se comunican a trav√©s de una red de 10 GbE, cada uno de ellos est√° conectado a los conmutadores por dos puertos. <br><br>  Una descripci√≥n detallada de la configuraci√≥n del cl√∫ster Ceph est√° m√°s all√° del alcance de este art√≠culo.  Tenga en cuenta que para la fiabilidad y la tolerancia a fallos, los datos se almacenan en tres copias.  El rendimiento del cl√∫ster no es satisfactorio y, con un margen, los resultados de la prueba mostraron que en ninguno de ellos el almacenamiento de respaldo era un cuello de botella. <br><br>  El par√°metro "Limitar las tareas simult√°neas m√°ximas" para el repositorio de respaldo en el nivel VBR se establece en 6. Esto significa que el repositorio de respaldo podr√° procesar simult√°neamente (hasta 6) tareas de respaldo. <br><br><h3>  Red de respaldo </h3><br>  La red f√≠sica de la infraestructura descrita anteriormente est√° limitada por un ancho de banda de 10 Gbit / s, los conmutadores y los puertos de 10 GbE se utilizan en todas partes.  Esto es cierto no solo para vSAN, sino tambi√©n para las interfaces de administraci√≥n de hosts ESXi. <br><br>  Para alojar un proxy de respaldo en el nivel VMware NSX, se ha creado una subred dedicada con su propio conmutador l√≥gico.  Por su conectividad con la f√≠sica y el enrutamiento, se ha implementado el NSX-edge, un tama√±o X-grande. <br><br>  Mirando hacia el futuro, de acuerdo con los resultados de la prueba, est√° claro que la red puede soportar una carga de hasta 8 Gb / s.  Este es un ancho de banda muy s√≥lido, que es suficiente en esta etapa, si es necesario, se puede aumentar. <br><br><h3>  Diagrama de interacci√≥n de componentes </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/cu/jh/cj/cujhcj5n4pch_msn8z03xdxvfdc.jpeg"></div><br>  Los servidores proxy de respaldo y las m√°quinas virtuales de prueba se implementan en el mismo cl√∫ster VMware vSAN.  Despu√©s de iniciar el trabajo de respaldo (trabajo de respaldo), dependiendo del modo de transporte seleccionado, cuyas caracter√≠sticas se analizan a continuaci√≥n, un proxy de respaldo: <br><br><ul><li>  Recupera datos de m√°quinas virtuales de respaldo a trav√©s de vSAN (HotAdd) o red de control (NBD) </li><li>  Transfiere datos procesados ‚Äã‚Äãal repositorio de respaldo en la subred asignada para este prop√≥sito </li></ul><br><h2>  Modos de transporte de proxy de respaldo </h2><br>  El proxy de respaldo es un componente de la infraestructura VBR que realiza directamente el procesamiento del trabajo de respaldo.  Extrae datos de la VM, los procesa (comprime, deduplica, encripta) y los env√≠a al repositorio, donde se guardan en los archivos de respaldo. <br><br>  El proxy de respaldo le permite trabajar en tres modos de transporte: <br><br><ul><li>  Acceso directo al almacenamiento </li><li>  Dispositivo virtual </li><li>  Red </li></ul><br>  La nube basada en VMware Selectel <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">utiliza vSAN</a> como almacenamiento, en esta configuraci√≥n no se admite el acceso directo al almacenamiento, por lo tanto, este modo no se considera y no se ha probado.  Los dos modos restantes funcionan maravillosamente en cada uno de nuestros cl√∫steres de vSphere. Consideremos con m√°s detalle. <br><br><h3>  Modo de dispositivo virtual (HotAdd) </h3><br>  El dispositivo virtual es el modo recomendado al implementar proxies de respaldo como m√°quinas virtuales.  Los hosts ESXi en los que se implementan proxies de respaldo deben tener acceso a todos los almacenes de datos del cl√∫ster de vSphere que almacena las m√°quinas virtuales de respaldo.  La esencia del modo es que el proxy monta los discos de la VM de respaldo (VMware SCSI HotAdd) y toma datos de ellos como si fueran propios.  La extracci√≥n de datos se produce con Datastore a trav√©s de una red de almacenamiento. <br><br>  En nuestro caso, la m√°quina virtual de proxy de respaldo debe ubicarse en uno de los hosts ESXi del cl√∫ster vSAN, del cual respaldamos.  La extracci√≥n de datos se realiza a trav√©s de vSAN.  Por lo tanto, para trabajar en modo de dispositivo virtual, se debe implementar al menos un proxy de respaldo en cada cl√∫ster de vSAN.  Expanda un par de servidores proxy de copia de seguridad (por ejemplo, en un cl√∫ster de administraci√≥n) y haga una copia de seguridad de todos los cl√∫steres de vSAN con ellos fallar√°n. <br><table><tbody><tr><td align="center">  <strong>Pros</strong> </td><td align="center">  <strong>Contras</strong> </td></tr><tr><td>  R√°pido, como regla, es mucho m√°s r√°pido que NBD, especialmente en el caso de una copia de seguridad completa o grandes incrementos.  Solo el acceso directo al almacenamiento puede ser inferior en velocidad. </td><td>  La operaci√≥n de montar discos (HotAdd) en un proxy puede tomar hasta 2 minutos por disco.  Con copias de seguridad incrementales de peque√±os fragmentos de datos, NBD puede ser m√°s r√°pido. </td></tr><tr><td>  Elimina la red de almacenamiento.  No carga la interfaz de administraci√≥n y el hipervisor. </td><td>  Proxy VM consume parte de los recursos del host.  A veces puede haber problemas con la eliminaci√≥n de instant√°neas. </td></tr></tbody></table><h3>  Modo de red (NBD) </h3><br>  Es el modo m√°s simple y universal, adecuado tanto para servidores proxy de respaldo f√≠sicos como virtuales.  La extracci√≥n de datos, a diferencia de los dos modos anteriores, no se produce a trav√©s de la red de almacenamiento.  Un proxy de respaldo toma datos de VM conect√°ndose a la interfaz de administraci√≥n de los hosts ESXi en los que se est√°n ejecutando. <br><br>  Este enfoque tiene las siguientes desventajas: <br><br><ul><li>  A menudo, las interfaces de administraci√≥n de ESXi no se cuelgan en los enlaces ascendentes m√°s r√°pidos, como regla, esto es 1GbE </li><li>  Incluso si la interfaz de administraci√≥n tendr√° puertos de 10 GbE, ESXi no renunciar√° a todo el proxy de la banda de proxy: lo limita artificialmente y asigna solo una parte del ancho de banda de la interfaz para las copias de seguridad </li></ul><table><tbody><tr><td align="center">  <strong>Pros</strong> </td><td align="center">  <strong>Contras</strong> </td></tr><tr><td>  Simple y vers√°til.  Los proxies pueden ser f√≠sicos y virtuales. </td><td>  Como regla, es mucho m√°s lento que HotAdd, especialmente en grandes vol√∫menes de respaldo y una peque√±a cantidad de tareas paralelas. </td></tr><tr><td>  Inicio r√°pido, sin demora en el montaje de unidades.  No hay problema con las instant√°neas. </td><td>  Crea una carga (peque√±a) en la interfaz de administraci√≥n y el hipervisor. </td></tr></tbody></table>  Al mismo tiempo, muchas fuentes afirman que NBD es muy lento a 1 GbE, pero a 10 GbE puede ser bastante r√°pido.  Definitivamente comprobaremos esto. <br><br><h2>  Programa de prueba </h2><br>  En la infraestructura descrita anteriormente, es necesario hacer una copia de seguridad de las m√°quinas virtuales de prueba y registrar los siguientes indicadores: <br><br><ul><li>  Carga de la CPU,% </li><li>  Consumo de RAM, GB </li><li>  Carga de red, Gbps </li><li>  Rendimiento de respaldo, MB / s </li><li>  Tiempo de respaldo, mm: ss </li></ul><br>  Los indicadores deben repararse para la copia de seguridad de una m√°quina virtual de prueba y para la copia de seguridad paralela de dos, cuatro y seis m√°quinas virtuales de prueba. <br><br>  Los indicadores deben registrarse para los modos de funcionamiento del dispositivo virtual y el proxy de respaldo de red.  Cada vez que se debe realizar una copia de seguridad completa, no hay incrementos. <br><br>  Por lo tanto, es necesario crear 4 trabajos de copia de seguridad: <br><br><ul><li>  Para una prueba de VM </li><li>  Para dos m√°quinas virtuales de prueba </li><li>  Para cuatro m√°quinas virtuales de prueba </li><li>  Para seis m√°quinas virtuales de prueba </li></ul><br>  Como parte de la prueba, es necesario: <br><br><ol><li>  Ejecuta secuencialmente todas las tareas en un modo </li><li>  Eliminar las copias de seguridad creadas para que no haya incrementos </li><li>  Repita las ejecuciones en el segundo modo, cada vez que fija los indicadores </li></ol><br>  En la configuraci√≥n de cada tarea, debe seleccionar manualmente un proxy de respaldo preparado para la prueba, ya que no es el √∫nico en la infraestructura general de VBR, y por defecto el proxy se selecciona autom√°ticamente. <br><br>  El modo proxy de respaldo predeterminado tambi√©n se selecciona autom√°ticamente.  Por lo tanto, en la configuraci√≥n del proxy de respaldo, antes de cada ejecuci√≥n, configure manualmente el modo de transporte deseado. <br><br>  El indicador m√°s interesante es la velocidad promedio o el rendimiento de la copia de seguridad.  Se puede ver en los resultados del trabajo en la consola VBR.  Tambi√©n mostrar√° el tiempo de ejecuci√≥n de la copia de seguridad. <br><br>  Adem√°s, debe evaluar la carga en el proxy de respaldo en cada una de las pruebas.  La CPU, la memoria y la congesti√≥n de la red se pueden monitorear utilizando las herramientas del sistema operativo invitado (Windows 2016) y a nivel de VMware. <br><br>  En el proxy de respaldo y los repositorios de respaldo, el par√°metro para el n√∫mero m√°ximo de tareas simult√°neas se establece en 6. Esto significa que durante la prueba, todas las m√°quinas virtuales en cada tarea se procesar√°n en paralelo, ninguna de ellas esperar√° en la cola, el rendimiento ser√° m√°ximo. <br><br>  Veeam¬Æ recomienda que la cantidad de tareas paralelas no debe exceder la cantidad de n√∫cleos de procesador en servidores proxy y repositorios.  La cantidad recomendada de RAM en el repositorio es de 2 GB por n√∫cleo, un total de 12 GB.  La configuraci√≥n de la infraestructura muestra que se siguen todas las recomendaciones. <br><br><h2>  Velocidad de respaldo y carga en modo Virtual Appliance (Hot Add) </h2><br><h3>  Copia de seguridad 1 VM </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/xp/ez/bd/xpezbdpsxcufmtsdpprpvv_nm9w.jpeg"></div><br><div class="spoiler">  <b class="spoiler_title">Carga de proxy de respaldo</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Indicador</strong> </td><td align="center">  <strong>Valor</strong> </td></tr><tr><td>  Carga de la CPU,% </td><td align="center">  55-95 </td></tr><tr><td>  Consumo de RAM, GB </td><td align="center">  2-2,2 </td></tr><tr><td>  Carga de red, Gbps </td><td align="center">  4.7-6.4 </td></tr></tbody></table><br></div></div><div class="spoiler">  <b class="spoiler_title">Velocidad de respaldo</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Indicador</strong> </td><td align="center">  <strong>Valor</strong> </td></tr><tr><td>  Rendimiento de respaldo, MB / s </td><td align="center">  709 </td></tr><tr><td>  Tiempo de respaldo, mm: ss </td><td align="center">  06:35 </td></tr></tbody></table><br></div></div><br><h3>  Backup 2 VM </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/qw/pj/qw/qwpjqwyr9vleuslvegj4wdzzudg.jpeg"></div><br><div class="spoiler">  <b class="spoiler_title">Carga de proxy de respaldo</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Indicador</strong> </td><td align="center">  <strong>Valor</strong> </td></tr><tr><td>  Carga de la CPU,% </td><td align="center">  70-100 (estante 100% con ca√≠das cortas y agudas al 70%) </td></tr><tr><td>  Consumo de RAM, GB </td><td align="center">  2.3-2.5 </td></tr><tr><td>  Carga de red, Gbps </td><td align="center">  5-7.7 </td></tr></tbody></table><br></div></div><div class="spoiler">  <b class="spoiler_title">Velocidad de respaldo</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Indicador</strong> </td><td align="center">  <strong>Valor</strong> </td></tr><tr><td>  Rendimiento de respaldo, MB / s </td><td align="center">  816 </td></tr><tr><td>  Tiempo de respaldo, mm: ss </td><td align="center">  10:03 </td></tr></tbody></table><br></div></div><br><h3>  Backup 4 VM </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/7n/om/ii/7nomiiyognj8gswhpcwx2yoi5cs.jpeg"></div><br><div class="spoiler">  <b class="spoiler_title">Carga de proxy de respaldo</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Indicador</strong> </td><td align="center">  <strong>Valor</strong> </td></tr><tr><td>  Carga de la CPU,% </td><td align="center">  100 (estante 100% con peque√±as gotas raras) </td></tr><tr><td>  Consumo de RAM, GB </td><td align="center">  3-3.5 </td></tr><tr><td>  Carga de red, Gbps </td><td align="center">  5-8,2 </td></tr></tbody></table><br></div></div><div class="spoiler">  <b class="spoiler_title">Velocidad de respaldo</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Indicador</strong> </td><td align="center">  <strong>Valor</strong> </td></tr><tr><td>  Rendimiento de respaldo, MB / s </td><td align="center">  885 </td></tr><tr><td>  Tiempo de respaldo, mm: ss </td><td align="center">  17:10 </td></tr></tbody></table><br></div></div><br><h3>  Backup 6 VM </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/qt/wx/ey/qtwxeyomib4z4zywrck_j_mmqbg.jpeg"></div><br><div class="spoiler">  <b class="spoiler_title">Carga de proxy de respaldo</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Indicador</strong> </td><td align="center">  <strong>Valor</strong> </td></tr><tr><td>  Carga de la CPU,% </td><td align="center">  100 (estante 100% con peque√±as gotas raras) </td></tr><tr><td>  Consumo de RAM, GB </td><td align="center">  4-4,2 </td></tr><tr><td>  Carga de red, Gbps </td><td align="center">  5-8,2 </td></tr></tbody></table><br></div></div><div class="spoiler">  <b class="spoiler_title">Velocidad de respaldo</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Indicador</strong> </td><td align="center">  <strong>Valor</strong> </td></tr><tr><td>  Rendimiento de respaldo, MB / s </td><td align="center">  888 </td></tr><tr><td>  Tiempo de respaldo, mm: ss </td><td align="center">  24:42 </td></tr></tbody></table><br></div></div><br><h2>  Velocidad de respaldo y carga de modo de red (NBD) </h2><br><h3>  Copia de seguridad 1 VM </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/vf/1j/jk/vf1jjkuom98hsgw9v2mnfqs6wjg.jpeg"></div><br><div class="spoiler">  <b class="spoiler_title">Carga de proxy de respaldo</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Indicador</strong> </td><td align="center">  <strong>Valor</strong> </td></tr><tr><td>  Carga de la CPU,% </td><td align="center">  18-24 </td></tr><tr><td>  Consumo de RAM, GB </td><td align="center">  1.9-2.1 </td></tr><tr><td>  Carga de red, Gbps </td><td align="center">  1.2-1.8 </td></tr></tbody></table><br></div></div><div class="spoiler">  <b class="spoiler_title">Velocidad de respaldo</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Indicador</strong> </td><td align="center">  <strong>Valor</strong> </td></tr><tr><td>  Rendimiento de respaldo, MB / s </td><td align="center">  192 </td></tr><tr><td>  Tiempo de respaldo, mm: ss </td><td align="center">  18:30 </td></tr></tbody></table><br></div></div><br><h3>  Backup 2 VM </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/v4/7n/ho/v47nhooellqc7pkgkjayv0e2d64.jpeg"></div><br><div class="spoiler">  <b class="spoiler_title">Carga de proxy de respaldo</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Indicador</strong> </td><td align="center">  <strong>Valor</strong> </td></tr><tr><td>  Carga de la CPU,% </td><td align="center">  25-33 </td></tr><tr><td>  Consumo de RAM, GB </td><td align="center">  2.2-2.4 </td></tr><tr><td>  Carga de red, Gbps </td><td align="center">  1.5-2.5 </td></tr></tbody></table><br></div></div><div class="spoiler">  <b class="spoiler_title">Velocidad de respaldo</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Indicador</strong> </td><td align="center">  <strong>Valor</strong> </td></tr><tr><td>  Rendimiento de respaldo, MB / s </td><td align="center">  269 </td></tr><tr><td>  Tiempo de respaldo, mm: ss </td><td align="center">  25:50 </td></tr></tbody></table><br></div></div><br><h3>  Backup 4 VM </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ah/nf/ng/ahnfngh4urqwfdwkubfzaatesa8.jpeg"></div><br><div class="spoiler">  <b class="spoiler_title">Carga de proxy de respaldo</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Indicador</strong> </td><td align="center">  <strong>Valor</strong> </td></tr><tr><td>  Carga de la CPU,% </td><td align="center">  45-55 </td></tr><tr><td>  Consumo de RAM, GB </td><td align="center">  2.8-3.5 </td></tr><tr><td>  Carga de red, Gbps </td><td align="center">  2.8-4.5 </td></tr></tbody></table><br></div></div><div class="spoiler">  <b class="spoiler_title">Velocidad de respaldo</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Indicador</strong> </td><td align="center">  <strong>Valor</strong> </td></tr><tr><td>  Rendimiento de respaldo, MB / s </td><td align="center">  446 </td></tr><tr><td>  Tiempo de respaldo, mm: ss </td><td align="center">  31:14 </td></tr></tbody></table><br></div></div><br><h3>  Backup 6 VM </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/f8/ah/90/f8ah90h6s77rwwywul_likwvln4.jpeg"></div><br><div class="spoiler">  <b class="spoiler_title">Carga de proxy de respaldo</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Indicador</strong> </td><td align="center">  <strong>Valor</strong> </td></tr><tr><td>  Carga de la CPU,% </td><td align="center">  50-70 </td></tr><tr><td>  Consumo de RAM, GB </td><td align="center">  3,5-4 </td></tr><tr><td>  Carga de red, Gbps </td><td align="center">  3,5-5 </td></tr></tbody></table><br></div></div><div class="spoiler">  <b class="spoiler_title">Velocidad de respaldo</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Indicador</strong> </td><td align="center">  <strong>Valor</strong> </td></tr><tr><td>  Rendimiento de respaldo, MB / s </td><td align="center">  517 </td></tr><tr><td>  Tiempo de respaldo, mm: ss </td><td align="center">  40:02 </td></tr></tbody></table><br></div></div><br><h2>  Comparaci√≥n de rendimiento y carga en el dispositivo virtual (HotAdd) y el modo de red (NBD) </h2><table><tbody><tr><td align="center">  <strong>Recuento de VM</strong> </td><td align="center">  <strong>Velocidad - HotAdd, MB / s</strong> </td><td align="center">  <strong>Velocidad - NBD, MB / s</strong> </td><td align="center">  <strong>HotAdd / NBD</strong> </td></tr><tr><td align="center">  1 </td><td align="center">  709 </td><td align="center">  192 </td><td align="center">  3,69 </td></tr><tr><td align="center">  2 </td><td align="center">  816 </td><td align="center">  269 </td><td align="center">  3,03 </td></tr><tr><td align="center">  4 4 </td><td align="center">  885 </td><td align="center">  446 </td><td align="center">  1,98 </td></tr><tr><td align="center">  6 6 </td><td align="center">  888 </td><td align="center">  517 </td><td align="center">  1,72 </td></tr></tbody></table><table><tbody><tr><td align="center">  <strong>Recuento de VM</strong> </td><td align="center">  <strong>Carga de CPU: HotAdd,%</strong> </td><td align="center">  <strong>Carga de CPU - NBD,%</strong> </td><td align="center">  <strong>HotAdd / NBD</strong> </td></tr><tr><td align="center">  1 </td><td align="center">  55-95 </td><td align="center">  18-24 </td><td align="center">  3.06-3.96 </td></tr><tr><td align="center">  2 </td><td align="center">  70-100 </td><td align="center">  25-33 </td><td align="center">  2.8-3.03 </td></tr><tr><td align="center">  4 4 </td><td align="center">  100 </td><td align="center">  45-55 </td><td align="center">  1.82-2.22 </td></tr><tr><td align="center">  6 6 </td><td align="center">  100 </td><td align="center">  50-70 </td><td align="center">  1.43-2 </td></tr></tbody></table><table><tbody><tr><td align="center">  <strong>Recuento de VM</strong> </td><td align="center">  <strong>Descargar RAM. HotAdd, GB</strong> </td><td align="center">  <strong>Carga de RAM - NBD, GB</strong> </td><td align="center">  <strong>HotAdd / NBD</strong> </td></tr><tr><td align="center">  1 </td><td align="center">  2-2,2 </td><td align="center">  1.9-2.1 </td><td align="center">  1.05 </td></tr><tr><td align="center">  2 </td><td align="center">  2.3-2.5 </td><td align="center">  2.2-2.4 </td><td align="center">  1,04-1,05 </td></tr><tr><td align="center">  4 4 </td><td align="center">  3-3.5 </td><td align="center">  2.8-3.5 </td><td align="center">  1-1.07 </td></tr><tr><td align="center">  6 6 </td><td align="center">  4-4,2 </td><td align="center">  3,5-4 </td><td align="center">  1.14-1.05 </td></tr></tbody></table><table><tbody><tr><td align="center">  <strong>Recuento de VM</strong> </td><td align="center">  <strong>Descarga de red - HotAdd, Gb / s</strong> </td><td align="center">  <strong>Descarga de red - NBD, Gb / s</strong> </td><td align="center">  <strong>HotAdd / NBD</strong> </td></tr><tr><td align="center">  1 </td><td align="center">  4.7-6.4 </td><td align="center">  1.2-1.8 </td><td align="center">  3.56-3.92 </td></tr><tr><td align="center">  2 </td><td align="center">  5-7.7 </td><td align="center">  1.5-2.5 </td><td align="center">  3.08-3.33 </td></tr><tr><td align="center">  4 4 </td><td align="center">  5-8,2 </td><td align="center">  2.8-4.5 </td><td align="center">  1.79-1.82 </td></tr><tr><td align="center">  6 6 </td><td align="center">  5-8,2 </td><td align="center">  3,5-5 </td><td align="center">  1.43-1.64 </td></tr></tbody></table><h2>  Resultados de prueba </h2><br>  Los indicadores de rendimiento de la copia de seguridad obtenidos como resultado de las pruebas confirman inequ√≠vocamente el hecho de que el modo de dispositivo virtual es significativamente superior en velocidad en comparaci√≥n con el modo de red, especialmente en un peque√±o n√∫mero de tareas paralelas. <br><br>  Perm√≠tame recordarle que las pruebas para ambos modos se ejecutaron bajo condiciones absolutamente id√©nticas en la misma plataforma.  El ancho de banda de la red tambi√©n era el mismo: las interfaces de control a trav√©s de las cuales el proxy recopila datos en modo NBD proporcionan 10 Gbit / s, como la red vSAN para el modo HotAdd, no establecimos ning√∫n l√≠mite de ancho de banda. <br><br>  Obviamente, ESXi realmente ralentiza Veeam¬Æ y le da solo una parte de la banda en modo Red, de ah√≠ las diferencias en la velocidad de respaldo.  Sin embargo, con el aumento en el n√∫mero de subprocesos (tareas de copia de seguridad simult√°neas), el modo de red reduce significativamente la acumulaci√≥n. <br><br>  Vemos que en el modo de dispositivo virtual, ya en 4 VM, el proxy de respaldo descansa en el procesador, no puede funcionar m√°s r√°pido, para 6 VM la velocidad de respaldo no ha cambiado mucho.  Al mismo tiempo, la velocidad de respaldo de 1-2 m√°quinas virtuales en este modo est√° ligeramente por detr√°s, las capacidades de los servidores proxy y las plataformas de respaldo se utilizan al m√°ximo incluso en un peque√±o n√∫mero de subprocesos. <br><br>  En el modo Red, por el contrario, hay un aumento significativo en la productividad con un aumento en el n√∫mero de tareas simult√°neas.  Al mismo tiempo, la carga en el procesador proxy de respaldo es significativamente menor que en el modo HotAdd, incluso en 6 subprocesos no supera el 70%. <br><br>  El consumo de memoria del proxy de respaldo es peque√±o y aproximadamente el mismo en ambos modos. <br><br>  La carga en la red de proxy de respaldo se correlaciona con la velocidad de respaldo, excedi√©ndola en ~ 10-17%.  Aparentemente, el proxy toma los datos de las fuentes de VM un poco m√°s r√°pido de lo que carga en el repositorio, ya que necesitan ser procesados. <br><br>  Es interesante observar la carga de la l√≠nea en las im√°genes con los resultados de la ejecuci√≥n del trabajo.  Muestra el nivel de carga en varios elementos de la infraestructura de respaldo: fuente, proxy, red, repositorio. <br><br>  En el modo de dispositivo virtual, vemos que el rendimiento de la copia de seguridad se basa en el proxy y la red, siempre son aproximadamente la misma carga.  La fuente y el repositorio no son un cuello de botella. <br><br>  En el modo de red, el cuello de botella es siempre la fuente, incluso para una sola secuencia.  Se puede ver que el resto de la infraestructura puede dar m√°s, pero ESXi no les da. <br><br><h2>  Resumen </h2><br>  ,  -          ,    . <br><br>  Veeam¬Æ    : <br><br><ul><li>   HotAdd         </li><li>   NBD   ,     Veeam¬Æ,     ESXi </li></ul><br>       ,            . <br><br>         ,          . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es431596/">https://habr.com/ru/post/es431596/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es431582/index.html">Historia de la protecci√≥n de datos personales: ¬øc√≥mo surgi√≥ el RGPD?</a></li>
<li><a href="../es431584/index.html">Espacio y pruebas: mezclar, pero no agitar</a></li>
<li><a href="../es431586/index.html">C√≥mo manejar los errores en la JVM m√°s r√°pido</a></li>
<li><a href="../es431588/index.html">Ley de autoempleo. Informaci√≥n para consideraci√≥n</a></li>
<li><a href="../es431590/index.html">La modernizaci√≥n de los parques e√≥licos obsoletos del Reino Unido aumentar√° la generaci√≥n de energ√≠a en un 171%</a></li>
<li><a href="../es431598/index.html">Traemos a Internet una m√°quina virtual QEMU p√∫blica sin una tarjeta de red e intentamos extraer</a></li>
<li><a href="../es431600/index.html">Elevar IDS / NMS: Mikrotik y Suricata con una interfaz web</a></li>
<li><a href="../es431602/index.html">Desarrolladores rusos presentaron en Londres un sistema de rehabilitaci√≥n virtual</a></li>
<li><a href="../es431604/index.html">Localizaci√≥n en Go con paquetes b√°sicos</a></li>
<li><a href="../es431608/index.html">La empresa estadounidense DriveSavers es la primera en el mundo en lanzar el servicio de pirateo de iPhone para particulares</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>