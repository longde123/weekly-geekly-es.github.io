<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üíÜüèæ üíé üë¥üèΩ Java Script! = JavaScript. Cinco javas en una clase. Escribimos para recordar siempre ü§ò ü¶Å ‚ôªÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Esta semana, es probable que el Grupo JUG.ru publique un anuncio. Hasta que yo diga qu√©. La participaci√≥n en proyectos secretos despierta la creativid...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Java Script! = JavaScript. Cinco javas en una clase. Escribimos para recordar siempre</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jugru/blog/429670/"><iframe width="560" height="315" src="https://www.youtube.com/embed/7SCwk02RPA0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Esta semana, es probable que el Grupo JUG.ru publique un anuncio.  Hasta que yo diga qu√©.  La participaci√≥n en proyectos secretos despierta la creatividad, as√≠ que aqu√≠ hay otro video nocturno sobre Java. <br><br>  Noticias incre√≠bles: ahora no dura una hora y media, sino unos 20 minutos, e incluso hay algo que ver.  Un poco menos que completamente, consiste en un screencast.  Aquellos que no pueden soportar esta basura de video y les gusta consumir descifrado de texto, tuvieron que cortar mucho texto despu√©s del corte.  Welkam, y que Java est√© contigo. <br><a name="habracut"></a><br>  Pronto se lanzar√°n 12 Java, y muchos todav√≠a est√°n sentados en Semerochka y creen que en el caso de una actualizaci√≥n no ver√°n nada particularmente nuevo o interesante.  En este n√∫mero s√∫per corto, aprenderemos c√≥mo convertir la vida de nuestros colegas en un infierno con la ayuda de Java con guiones, y en un par de lugares voy a atornillar nuevos dispositivos.  Bueno, los oscurantistas, por supuesto, no ser√°n salvados del progreso. <br><br>  Dime, ¬øpor qu√© est√°s actualizando tu idea?  All√≠ aparecen constantemente nuevas funciones, algunos atajos nuevos, lo que aumenta diez veces su productividad como desarrollador.  Pero no sabes sobre ellos.  ¬øDe verdad est√°s leyendo esta noticia?  Si eres un usuario promedio, entonces probablemente no.  A ti, en principio, no te importa la mayor parte del tiempo.  Est√°s actualizando la Idea simplemente porque ... puedes.  Debido a que las m√°scaras son hermosas, el tema oscuro, la barra t√°ctil en el MacBook.  Pero tal explicaci√≥n no falla ante las autoridades como la respuesta "por qu√© comprar la Idea". <br><br>  En cambio, podemos decir que el 29 de octubre, m√°s recientemente, JetBrains fij√≥ el soporte para <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">l√≠neas sin procesar</a> en la versi√≥n beta de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Idea</a> .  La idea est√° en beta, las l√≠neas est√°n en la vista previa, pero esto ya no es importante para nadie.  Si eres tan terco que pones 12 java, entonces tienes problemas m√°s serios.  Lo s√© por mi mismo. <br><br>  Veamos c√≥mo se ve en la pr√°ctica.  Para hacer esto, intente resolver alg√∫n tipo de problema de demostraci√≥n.  Muy a menudo existe el problema de escribir algo.  Por ejemplo, en los juegos de computadora son misiones, en jenkins son scripts de compilaci√≥n, etc.  Por lo general, Python o Groove se usan para esto, ¬°y tomemos y usemos Java desnudo!  Por qu√©  Porque podemos, en tres l√≠neas, e incluso sin hacks.  Suena como una gran idea :-) <br><br><h1>  Donde mirar </h1><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Todo est√° en el github</a> . <br><br><h1>  Alcance </h1><br>  Imagine que tenemos un archivo como este: <br><br><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> io.javawatch; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HelloHabrPrototype</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Hello Habr!"</span></span>; } };</code> </pre> <br>  Queremos que se ejecute no al compilar toda la aplicaci√≥n, sino como una cadena, despu√©s del lanzamiento.  Como un gui√≥n, eso es. <br><br><h1>  Manualmente </h1><br>  Primero debes adelantar todo en una cadena. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String SOURCE = <span class="hljs-string"><span class="hljs-string">"\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" package io.javawatch;\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" public class HelloHabr {\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" public String get() {\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" return \"Hello Habr!\";\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" }\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" };"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String CNAME = <span class="hljs-string"><span class="hljs-string">"io.javawatch.HelloHabr"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> String CODE_CACHE_DIR = <span class="hljs-string"><span class="hljs-string">"C:/temp/codeCache"</span></span>;</code> </pre><br>  Todas estas ventajas y sangr√≠as "\ n" se ven extremadamente miserables. <br><br>  Anteriormente, todo lo que pod√≠amos hacer era poner el c√≥digo en un archivo y leerlo.  Probablemente sea una buena soluci√≥n, pero no siempre es adecuada.  Por ejemplo, usted es un orador en una conferencia y demuestra el c√≥digo de las diapositivas.  Incluso la construcci√≥n anterior es mucho mejor que una simple referencia sin fundamento de que tiene un c√≥digo en alg√∫n lugar que hace algo all√≠.  Cambiar diapositivas consume tiempo y atenci√≥n de la audiencia.  Bueno y as√≠ sucesivamente.  En resumen, en los casos en que necesita el c√≥digo exactamente en l√≠nea, puede encontrarlo. <br><br>  Ahora tenemos la oportunidad de deshacernos de la basura utilizando cadenas sin procesar.  Nos levantamos con el cursor en el c√≥digo, presionamos Alt + Enter (o lo que sea que se ejecute en su sistema operativo Quck Fix en la Idea).  Seleccione "convertir a cadena literal literal" y obtenga esta nyashka: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String SOURCE = ` <span class="hljs-keyword"><span class="hljs-keyword">package</span></span> io.javawatch; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HelloHabr</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Hello Habr!"</span></span>; } };`; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String CNAME = <span class="hljs-string"><span class="hljs-string">"io.javawatch.HelloHabr"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> String CODE_CACHE_DIR = <span class="hljs-string"><span class="hljs-string">"C:/temp/codeCache"</span></span>;</code> </pre><br>  En mi opini√≥n, por el bien de esta caracter√≠stica ya vale la pena ejecutar para instalar JDK 12. <br><br>  Por cierto, para que la caracter√≠stica funcione, deber√° hacer varias cosas: <br><br><ul><li>  Descargue JDK 12 y reg√≠strese en la configuraci√≥n del proyecto </li><li>  En la configuraci√≥n global de javac, establezca el indicador <code>--release</code> , bytecode versi√≥n 12, indicadores adicionales <code>--enable-preview</code> <code>-Xlint:preview</code> </li><li>  Ahora, en cualquier configuraci√≥n de ejecuci√≥n / depuraci√≥n, debe agregar el indicador VM <code>--enable-preview</code> </li></ul><br>  Si no lo entiendes, c√≥mo se hace, mira mi screencast desde el encabezado de la publicaci√≥n, todo est√° bastante claro all√≠. <br><br>  Ahora, para comenzar, debe realizar tres pasos simples: convertir la cadena en una representaci√≥n interna conveniente de la fuente, compilarla y ejecutarla: <br><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* 1 */</span></span> RuntimeSource file = RuntimeSource.create(); <span class="hljs-comment"><span class="hljs-comment">//SimpleJavaFileObject /* 2 */ compile(Collections.singletonList(file)); /* 3 */ String result = run(); /* 4 */ /* ??? */ /* 5 */ /* PROFIT! */ System.out.println(result); }</span></span></code> </pre><br>  Hay una clase <code>SimpleJavaFileObject</code> para "representaci√≥n conveniente", pero tiene una caracter√≠stica interesante.  Es crucialmente abstracto.  Es decir, su m√©todo clave, que la fuente compilada deber√≠a devolver, siempre lanza una ejecuci√≥n con la esperanza de que la subclasemos: <br><br><pre> <code class="java hljs"> <span class="hljs-comment"><span class="hljs-comment">/** * This implementation always throws {</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@linkplain</span></span></span><span class="hljs-comment"> * UnsupportedOperationException}. Subclasses can change this * behavior as long as the contract of {</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@link</span></span></span><span class="hljs-comment"> FileObject} is * obeyed. */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> CharSequence </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCharContent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ignoreEncodingErrors)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UnsupportedOperationException(); }</code> </pre><br>  Entonces tienes que escribir algo de tu heredero.  Tenga en cuenta que el constructor original <code>SimpleJavaFileObject</code> quiere un URI para la clase compilada, pero ¬ød√≥nde lo obtenemos?  Por lo tanto, sugiero simplemente <code>buildURI</code> la manera m√°s obvia, como aqu√≠ en la funci√≥n <code>buildURI</code> : <br><br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RuntimeSource</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SimpleJavaFileObject</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String contents = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> CharSequence </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCharContent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ignoreEncodingErrors)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> contents; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> RuntimeSource </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">create</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RuntimeSource(CNAME, SOURCE); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RuntimeSource</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String className, String contents)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(buildURI(className), Kind.SOURCE); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.contents = contents; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> URI </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">buildURI</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String className)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// io.javawatch.HelloHabr -&gt; // string:///io/javawatch/HelloHabr.java URI uri = URI.create("string:///" + className.replace('.', '/') + Kind.SOURCE.extension); System.out.println(uri); return uri; }</span></span></code> </pre><br>  Ahora pasemos a la compilaci√≥n: <br><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">compile</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(List&lt;RuntimeSource&gt; files)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException </span></span>{ File ccDir = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> File(CODE_CACHE_DIR); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ccDir.exists()) { FileUtils.deleteDirectory(ccDir); FileUtils.forceMkdir(ccDir); } JavaCompiler compiler = ToolProvider.getSystemJavaCompiler(); Logger c = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Logger(); StandardJavaFileManager fileManager = compiler.getStandardFileManager(c, Locale.ENGLISH, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); Iterable options = Arrays.asList(<span class="hljs-string"><span class="hljs-string">"-d"</span></span>, CODE_CACHE_DIR, <span class="hljs-string"><span class="hljs-string">"--release=12"</span></span>, <span class="hljs-string"><span class="hljs-string">"--enable-preview"</span></span>, <span class="hljs-string"><span class="hljs-string">"-Xlint:preview"</span></span>); JavaCompiler.CompilationTask task = compiler.getTask(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, fileManager, c, options, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, files); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (task.call()) { System.out.println(<span class="hljs-string"><span class="hljs-string">"compilation ok"</span></span>); } }</code> </pre><br>  Tenga en cuenta: pasamos cuatro banderas para el ensamblaje, tres de las cuales son responsables de prescribir exactamente las mismas opciones que hicimos con el mouse en la configuraci√≥n de javac en la Idea. <br><br>  Y finalmente, ejecuta nuestra clase temporal: <br><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> ClassNotFoundException, IllegalAccessException, InstantiationException, NoSuchMethodException, InvocationTargetException, MalformedURLException </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//   File ccDir = new File(CODE_CACHE_DIR); ClassLoader loader = new URLClassLoader(new URL[]{ccDir.toURL()}); var clss = loader.loadClass("io.javawatch.HelloHabr"); // Java 10 //    Object instance = clss.getConstructor().newInstance(); // Java 9 // Object instance = clss.newInstance(); Method thisMethod = clss.getDeclaredMethod("get"); Object result = thisMethod.invoke(instance); return (String) result; }</span></span></code> </pre><br>  Tenga en cuenta que <code>var clss = loader.loadClass</code> de escribir que <code>Class&lt;?&gt; clss = loader.loadClass</code> , y no introduce nuevos vorings.  La palabra clave <code>var</code> apareci√≥ en el Top Ten. <br><br>  Tambi√©n tenga en cuenta que <code>clss.newInstance()</code> propone cortar <code>clss.newInstance()</code> a partir de Nine.  Se traga las excepciones, lo cual es malo.  The Nine sugiere primero llamar a <code>getConstructor</code> , que est√° parametrizado y arroja las excepciones correctas. <br><br>  Tenga en cuenta tambi√©n que llam√© a la variable la <code>class</code> palabra, pero Java no jur√≥.  Tarea: puede hacer esto de varias maneras, necesita comprender cu√°l es la m√°s interesante y por qu√©. <br><br>  Bueno, en general, eso es todo.  Funciona <br><br><h1>  Automatizaci√≥n </h1><br>  Aqu√≠ el cr√≠tico exclamar√°, todo est√° en negro aqu√≠, porque hay bibliotecas en el mundo de Java que compilan todo para usted en una l√≠nea. <br><br>  OK, echemos un vistazo.  Aqu√≠ est√° el c√≥digo en la biblioteca JOOR, ubicada en la parte superior de Google: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> io.javawatch; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.joor.Reflect; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.function.Supplier; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Automatic</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ Supplier&lt;String&gt; supplier = Reflect.compile( <span class="hljs-string"><span class="hljs-string">"io.javawatch.HelloHabr"</span></span>, ` <span class="hljs-keyword"><span class="hljs-keyword">package</span></span> io.javawatch; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HelloHabr</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">util</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">function</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Supplier</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">String</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Hello Habr!"</span></span>; } };` ).create().get(); System.out.println(supplier.get()); } }</code> </pre><br>  Como si todo estuviera bien.  De hecho, en una l√≠nea, excepto que tuve que arrastrar el saplayer. <br><br>  Pero hay un matiz.  Intenta devolver "¬°Hola Habr!"  como cadena literal literal: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ``Hello Habr!``; }</code> </pre><br>  Todo se bloquear√° instant√°neamente con el error "(use --able-preview para habilitar los literales de cadena sin formato)".  ¬øPero ya lo hemos encendido?  S√≠, al diablo con dos.  ¬°Lo incluimos en la Idea, y JOOR lo construye con un compilador del sistema!  Echemos un vistazo a lo que hay dentro: <br><br><pre> <code class="java hljs">JavaCompiler compiler = ToolProvider.getSystemJavaCompiler(); ompiler.getTask(out, fileManager, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, files).call();</code> </pre><br>  ¬øY qu√© hay de nosotros cuando nosotros mismos llamamos al mismo JavaCompiler? <br><br><pre> <code class="java hljs"> Iterable options = Arrays.asList(<span class="hljs-string"><span class="hljs-string">"-d"</span></span>, CODE_CACHE_DIR, <span class="hljs-string"><span class="hljs-string">"--release=12"</span></span>, <span class="hljs-string"><span class="hljs-string">"--enable-preview"</span></span>, <span class="hljs-string"><span class="hljs-string">"-Xlint:preview"</span></span>); JavaCompiler.CompilationTask task = compiler.getTask(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, fileManager, c, options, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, files);</code> </pre><br>  Y en JOOR solo hay un nulo en lugar de opciones.  ¬°Ni siquiera se pueden pasar adentro! <br><br>  Probablemente sea una buena idea enviarles una solicitud de extracci√≥n a Github en JOOR.  Si no voy a hacerlo yo mismo, lo haces, ¬øeh? <br><br>  Y la moraleja es simple, tenga miedo de los regalos de c√≥digo abierto.  A veces es m√°s f√°cil escribir un peque√±o muro de texto, pero tener control sobre √©l. <br><br><h1>  La manera m√°s f√°cil </h1><br>  Hay una manera de no escribir un muro de texto y de no usar bibliotecas sospechosas.  Comenzando con Java 9, tenemos un shell interactivo (similar al de Python, Ruby y otros lenguajes de secuencias de comandos) que puede ejecutar comandos Java.  Y, por supuesto, est√° escrito en Java y est√° disponible como una clase Java.  Puede crear una instancia y simplemente realizar la asignaci√≥n necesaria directamente: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Shell</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> jShell = JShell.create(); <span class="hljs-comment"><span class="hljs-comment">//Java 9 jShell.eval("String result;"); jShell.eval(`result = "Hello Habr!";`); //Java 12 var result = jShell.variables() //Streams: Java 8, var: Java 10 .filter((@Nullable var v) -&gt; v.name().equals("result")) //var+lambda: Java 11 .findAny() .get(); System.out.println(jShell.varValue(result)); } }</span></span></code> </pre><br>  Las secuencias aparecieron en Java 8, y ahora se usan en todas partes, y ni siquiera necesita llamar a <code>stream()</code> usted mismo, otros lo llamar√°n por usted.  En este caso, las <code>variables()</code> llamada <code>variables()</code> devuelven exactamente la secuencia, no la ArrayList, como habr√≠a hecho alguien de una infancia dif√≠cil.  El resultado de la corriente se puede verter inmediatamente en la <code>var</code> . <br><br>  Tenga en cuenta que ahora puede escribir <code>var</code> tambi√©n en los par√°metros lambda.  Esta caracter√≠stica ha estado con nosotros desde Java 11. <br><br>  En general, esta es una clase muy significativa.  Utiliza un mont√≥n de caracter√≠sticas de diferentes generaciones de Java, y todo esto se ve de manera integral y armoniosa.  Estoy seguro de que tales cosas ser√°n utilizadas por todos y en todas partes, por lo que el c√≥digo en Java 12 ser√° visualmente diferente de lo que ten√≠amos en Java 7. <br><br><h1>  Para resumir </h1><br>  Observamos algunas caracter√≠sticas: <br><br><ul><li>  8: Stream (para aquellos en el tanque) </li><li>  9: JShell y nuevos m√©todos obsoletos </li><li>  10: palabra clave var </li><li>  11: desarrollo de Var para par√°metros lambda </li><li>  12: Raw String Literals y su soporte en IntelliJ IDEA </li></ul><br>  Una peque√±a advertencia para principiantes.  Si constantemente haces esto en aplicaciones reales sin ning√∫n significado especial, tus colegas se volver√°n locos al principio, tratando de entender lo que escribiste, y luego pueden golpearte muy dolorosamente.  Y no estoy hablando de nuevas caracter√≠sticas de Java ahora, sino de la compilaci√≥n en tiempo de ejecuci√≥n, por supuesto. <br><br>  Si desea obtener m√°s informaci√≥n sobre Java como lenguaje, deber√≠a, por ejemplo, consultar los informes de Tagir Valeev.  Lo conoces como un tipo desde la parte superior del centro de Java en Habr√©, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link">lany</a> .  En Joker habl√≥ sobre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Amber</a> , y en JPoint, sus famosos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">acertijos</a> , y as√≠ sucesivamente.  All√≠, y sobre el lenguaje Java, y sobre IntelliJ IDEA, todo est√° ah√≠.  Todo esto se puede <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">encontrar en YouTube</a> .  En realidad, por celos de Tagir, que puede decir algo sobre el lenguaje en s√≠, pero yo no, y esta publicaci√≥n ha resultado.  Tambi√©n habr√° nuevos comodines y JPoint, pero discutiremos esto m√°s adelante. <br><br>  Cumpl√≠ mi deber moral, un deber con Java.  De mi lado, las balas salieron volando.  Y usted all√≠, en el siete, que no tiene el duod√©cimo Java, qu√©dese aqu√≠, todo lo mejor, buen humor y salud.  Gracias </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es429670/">https://habr.com/ru/post/es429670/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es429654/index.html">Mejora de la gesti√≥n de proyectos</a></li>
<li><a href="../es429656/index.html">La inteligencia artificial tambi√©n est√° equivocada. A medida que Amazon Go nos acorta en los EE. UU., Una tienda del futuro sin cajeros ni vendedores</a></li>
<li><a href="../es429658/index.html">Internet satelital SpaceX Starlink - "Licencia de dinero impreso"</a></li>
<li><a href="../es429662/index.html">Rompemos la protecci√≥n de los bots</a></li>
<li><a href="../es429668/index.html">Google PageSpeed ‚Äã‚ÄãInsights se ha actualizado dr√°sticamente, ¬øqu√© cambiar√°?</a></li>
<li><a href="../es429676/index.html">Copia de seguridad en cinta</a></li>
<li><a href="../es429678/index.html">C√≥mo tradujimos 10 millones de l√≠neas de c√≥digo C ++ al est√°ndar C ++ 14 (y luego a C ++ 17)</a></li>
<li><a href="../es429680/index.html">Curso MIT "Seguridad de sistemas inform√°ticos". Lecci√≥n 17: Autenticaci√≥n de usuario, Parte 1</a></li>
<li><a href="../es429682/index.html">Curso MIT "Seguridad de sistemas inform√°ticos". Lecci√≥n 17: Autenticaci√≥n de usuario, Parte 2</a></li>
<li><a href="../es429684/index.html">Firebase Summit 2018: brevemente sobre lo principal</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>