<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üõ¢Ô∏è üéÖüèª üë®üèæ‚Äçüî¨ Como eu tentei consertar uma pesquisa no mapa por drivers. Parte 2 üïß üßî üíñ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A primeira coisa que quero dizer √© que foi dif√≠cil. Muito mais dif√≠cil do que eu pensava. Eu j√° tive essa experi√™ncia muito dif√≠cil de trazer produtos...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Como eu tentei consertar uma pesquisa no mapa por drivers. Parte 2</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/440958/">  A primeira coisa que quero dizer √© que foi dif√≠cil.  Muito mais dif√≠cil do que eu pensava.  Eu j√° tive essa experi√™ncia muito dif√≠cil de trazer produtos para lan√ßamento no trabalho, mas nunca alcancei projetos pessoais.  Todos eles terminaram com prot√≥tipos de diferentes graus de nojo, mas este parecia sobreviver.  No momento, ele foi lan√ßado para mais de 80 pa√≠ses (toda a Europa, √Åsia e Am√©rica do Norte), em ambas as plataformas m√≥veis, e no final do artigo haver√° links para download - por isso, convido todos os interessados ‚Äã‚Äãa tentar, quebrar e repreender. <br><img src="https://habrastorage.org/webt/bf/sb/yn/bfsbyn-oz8mgre0bdzet4a_k33c.png"><br>  Aqui est√° uma breve reflex√£o com a qual tudo come√ßou: <i>Na minha opini√£o, √© feita uma pesquisa nos mapas m√≥veis existentes para pedestres e n√£o funciona para os motoristas.</i>  <i>Voc√™ precisa parar, mergulhar nos mapas repletos de informa√ß√µes e publicidade em excesso, cutucar pequenos √≠cones.</i>  <i>√â inconveniente, n√£o o ajudar√° em um lugar desconhecido; no final, √© apenas perigoso.</i>  <i>√â necess√°ria uma solu√ß√£o intuitiva e limpa, que n√£o distraia e n√£o fa√ßa voc√™ diminuir a velocidade.</i> <i><br></i> <br>  Na <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">primeira parte,</a> descrevi meu caminho desse pensamento simples para uma solu√ß√£o funcional e depois descreverei como arrastei essa solu√ß√£o para o lan√ßamento. <br><a name="habracut"></a><br>  Para economizar seu tempo, come√ßarei com uma breve recontagem da parte anterior: l√° escrevo que, em vez de pesquisar, decidi usar a digitaliza√ß√£o em movimento, e a interface do aplicativo foi simplificada o m√°ximo poss√≠vel.  Em vez de uma linha de entrada absurda para o motorista, ele adicionou v√°rios bot√µes grandes para coisas que podem ser √∫teis na estrada: posto de gasolina, cobran√ßa, caixa eletr√¥nico, estacionamento, farm√°cia.  Em vez de um mapa, fiz uma lista e, quando seleciono um resultado, a navega√ß√£o pelo Apple / Google Maps √© aberta.  Para o aplicativo, decidi usar o Flutter (ao mesmo tempo em que soube que tipo de animal √©), peguei os dados do OpenStreetMap.  Terminei minha hist√≥ria com o fato de que um prot√≥tipo mais ou menos sadio estava pronto. <br><br>  Depois, tudo levou cerca de 4-5 meses, depois as mudan√ßas na vida come√ßaram e o projeto foi esquecido - e eu comecei a me cansar disso.  Um m√™s depois, limpei o p√≥, refresquei-o na cabe√ßa, escrevendo um artigo em um hub e decidi: vamos terminar.  Quem sabe a diferen√ßa entre um prot√≥tipo e um produto sorrir√° tristemente para este lugar. <br><br>  O que aconteceu depois levou mais quatro meses.  Eu consegui um rastreador de tarefas, em termos gerais, formou uma lista de problemas, coletou dispositivos para teste.  √Ä noite e nos fins de semana, me sentava no trabalho e avan√ßava o projeto.  Em que momentos parecia que a lista estava apenas crescendo, e eu estava me afogando em infinitas nuances e retoques finais.  Ele se pegou na m√£o, jogou algo fora, em algum lugar levou ao perfeccionismo.  A seguir, tentarei falar sobre os pontos mais interessantes no desenvolvimento de um projeto aparentemente t√£o simples. <br><br><h2>  Tecnologia </h2><br><h4>  Arquitetura geral </h4><br>  Em algum lugar no meio do trabalho, come√ßou a parecer que a arquitetura estava se espalhando fora de controle.  Muitos componentes e conex√µes foram encerrados; v√°rios gargalos foram agarrados.  Felizmente, o projeto √© pequeno, e senti-o a tempo, portanto, colocar as coisas em ordem n√£o foi dif√≠cil.  No n√≠vel de componentes individuais, isso se resumia √† refatora√ß√£o e elimina√ß√£o de bibliotecas desnecess√°rias; no n√≠vel global, eu espalhei a funcionalidade para tr√™s pequenos servidores iniciados no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">DigitalOcean</a> . <br><br><ol><li>  <i>Servidor API</i> (Python) - a principal configura√ß√£o de servidor, nos voltamos para ele.  N√£o h√° muita l√≥gica, principalmente a forma√ß√£o de resultados para sa√≠da.  O mais econ√¥mico em termos de recursos. </li><li>  <i>Servidor el√°stico</i> (Java) - O Elasticsearch e o Photon (geocoder de c√≥digo aberto) est√£o girando nele.  Eles usam o mesmo √≠ndice para o qual todo o planeta √© importado do OpenStreetMap.  Fun√ß√µes do servidor: procure locais por aterro e geocoder.  Por sua natureza, o el√°stico √© muito r√°pido e leve, portanto o servidor tamb√©m n√£o √© muito oleoso. <br></li><li>  <i>Um servidor geogr√°fico</i> (N√≥) √© o mais dif√≠cil de todos.  Com base na Open Source Routing Machine, escrevi uma pequena API, e suas tarefas incluem todos os c√°lculos geogr√°ficos: definir rotas, calcular is√≥crones e gerar blocos.  Cada opera√ß√£o individual n√£o √© muito engenhosa, mas s√£o necess√°rias dezenas para qualquer pesquisa, e isso se torna um gargalo.  No momento, neste servidor, 16 GB de RAM e, em geral, tudo funciona em uma fra√ß√£o de segundo - exceto para gerar blocos.  Quando houver muitos deles na fila, voc√™ poder√° esperar por fotos com cart√µes em alguns segundos.  Felizmente, eles aparecem no cliente de forma ass√≠ncrona, e isso n√£o estraga muito a imagem geral (espero). <br></li></ol><br>  Al√©m disso, decidi alimentar extratos do OpenStreetMap para geo-c√°lculos separadamente por pa√≠s.  Funciona assim: fazemos a primeira solicita√ß√£o com coordenadas para o nosso geocoder, determina o pa√≠s e, em seguida, pegamos os arquivos baixados somente deste pa√≠s para as manipula√ß√µes de que precisamos.  Isso √© necess√°rio, porque mesmo o meu servidor bastante poderoso n√£o √© capaz de converter a extra√ß√£o maior que dois gigabytes de tamanho - o processo consome rapidamente toda a mem√≥ria e engasga.  Felizmente, quase todos os pa√≠ses se enquadram nesse limite, exceto os Estados Unidos: esse monstro teve que ser dividido em estados.  Por fim, para manter uma centena e meia de extratos, decidi escrever v√°rios scripts que verificam sua sa√∫de, reparo e atualiza√ß√£o. <br><br><img src="https://habrastorage.org/webt/a4/p1/q5/a4p1q5quwoshyq34ptpfyoxllia.png"><br><br>  Em geral, tudo isso parece mais complicado do que na pr√°tica.  Em princ√≠pio, estou satisfeito com a solu√ß√£o resultante - ela tem uma boa reserva para escalar pelo n√∫mero de territ√≥rios suportados e pelo n√≠vel de carga. <br><br><h4>  Is√≥crono din√¢mico </h4><br>  Durante muito tempo, um dos principais problemas para mim foi a densidade heterog√™nea dos resultados.  A raz√£o √© bastante compreens√≠vel - essa √© a densidade heterog√™nea da pr√≥pria rede de estradas e dos pr√©dios nela.  Em uma cidade de tamanho m√©dio, dentro de um raio de 5 minutos, pode haver de 2 a 3 caixas eletr√¥nicos, e agora vamos para o centro da metr√≥pole - e pelos mesmos 5 minutos, pode haver 20 ou 30 resultados.  Finalmente, pulamos no campo e observamos quase 0 resultados garantidos at√© nos aproximarmos da cidade e o raio de busca capturar alguma coisa. <br><br>  Esse problema fornece uma carga n√£o linear e imprevis√≠vel no servidor, e o mais importante - uma experi√™ncia bastante ruim para o usu√°rio.  Adicionar um filtro √†s op√ß√µes (5 minutos, 10 minutos, 30 minutos) basicamente n√£o resolve nada.  Na vila, mesmo um raio de 30 minutos pode n√£o retornar nada, mas em uma megal√≥pole, mesmo 5 minutos ir√£o sobrecarreg√°-lo com resultados.  Al√©m disso, adicionamos funcionalidade extra aos bot√µes nos quais o driver deve estar em movimento.  Em geral, bobagem, voc√™ precisa de uma solu√ß√£o fundamentalmente diferente. <br><br>  Quando uma solu√ß√£o foi encontrada, ela se mostrou muito simples.  Em vez de seguir o oposto e solicitar ao usu√°rio que selecione um raio de pesquisa, podemos torn√°-lo autom√°tico.  A l√≥gica √© realmente elementar: <br><br><ol><li>  Voc√™ define limites para os resultados - por exemplo, pelo menos 1 e n√£o mais que 20 - e come√ßa com 10 minutos <br></li><li>  Fa√ßa uma pesquisa por local.  At√© agora, n√£o precisamos obter instru√ß√µes para eles, portanto, apenas precisamos calcular a is√≥crona e filtrar por pol√≠gono no el√°stico - ambas as opera√ß√µes s√£o muito baratas <br></li><li>  Se o n√∫mero de resultados subir em uma dire√ß√£o a partir dos limites (no nosso caso, 0 ou 20+), divida ou multiplique o tempo por 2 e fa√ßa a pesquisa novamente.  Se estiver inclu√≠do no limite, j√° constru√≠mos rotas, classificamos por tempo, etc. <br></li></ol><br>  De fato, isso √© um pouco mais complicado e existem algumas nuances, por exemplo, uma grade de cidade ultra-densa, quando j√° reduzimos o tempo ao m√≠nimo e ainda h√° muitos resultados.  Aqui j√° √© necess√°rio classificar e, portanto, estabelecer rotas, o que √© um pouco caro.  No entanto, esses s√£o casos extremos e n√£o s√£o muito impressionantes. <br><br>  Na realidade, √© improv√°vel que uma pessoa role a lista abaixo de 5 a 6 posi√ß√µes, portanto, em 95% dos cen√°rios, o is√≥crono din√¢mico resolveu o problema.  Removemos o gargalo - uma quantidade imprevis√≠vel de resultados - e reduzimos a carga no servidor geogr√°fico para qualquer solicita√ß√£o.  Verificar isso √© muito f√°cil: <br><br>  <i>Caminho antigo: pegue um raio de 10 minutos e 30 resultados</i> <i><br></i>  <i>Resultado: 1 pedido de is√≥crono + 30 pedidos de rotas = <b>31</b></i> <i><br><br></i>  <i>Nova maneira: verifique, 30 resultados s√£o muitos, divida o raio ao meio, agora obtemos 10 resultados</i> <i><br></i>  <i>Resultado: 2 solicita√ß√µes de is√≥crona + 10 solicita√ß√µes de rotas = <b>12</b></i> <br><br><img src="https://habrastorage.org/webt/ta/ry/bs/tarybsvzvwhjow7ak13dgmcda60.png"><br><br><h4>  Nova l√≥gica de mapa </h4><br>  Na √∫ltima parte, descrevi o mecanismo para gerar cart√µes com rotas definidas.  Acabou sendo bastante complicado e caro em termos de computa√ß√£o, mas eu gostei tanto deles que decidi deix√°-los.  Ao mesmo tempo, entendi que, na forma atual, eles tinham poucos benef√≠cios pr√°ticos - n√£o estava claro para eles para onde voc√™ estava indo, e todos estavam virados para o norte.  Era necess√°rio refinar. <br><br>  A primeira coisa que decidi fazer foi implantar os mapas em tempo real usando uma b√∫ssola.  No flutter, isso foi descrito pela l√≥gica microsc√≥pica e funcionou muito rapidamente, no entanto, com mais de 10 resultados que giram constantemente, o desempenho come√ßou a diminuir.  Al√©m disso, parecia absolutamente doentio: de fato, as imagens est√°ticas estavam girando, e isso foi mais confuso durante a viagem do que de alguma forma ajudou. <br><br>  A id√©ia seguinte foi indicar nos mapas a dire√ß√£o do movimento da seta.  Era muito simples - eu j√° tinha um vetor calculado e s√≥ precisava gerar uma forma geom√©trica da seta.  Ao mesmo tempo, em uma posi√ß√£o est√°tica, os cart√µes continuavam mostrando a posi√ß√£o do motorista com um marcador redondo.  Havia uma ressalva - era necess√°rio normalizar os tamanhos dos marcadores e setas para diferentes n√≠veis de zoom.  Esta parece ser uma tarefa simples, mas fiquei presa por um longo tempo.  A quest√£o era a seguinte: gerei todos os s√≠mbolos no mapa em metros e tomei como base a fra√ß√£o da altura do mapa inteiro em metros.  Descobriu-se que durante a cria√ß√£o de mapas - determinando caixas delimitadoras quadradas, colando e aparando pe√ßas sobre elas, etc. - erros acumulados, e esses pequenos erros acabaram levando a tamanhos muito diferentes de marcadores.  Especialmente infernal foi a situa√ß√£o com cart√µes de pequena escala.  N√£o vou entrar em detalhes da solu√ß√£o, no entanto, por causa desses erros, a l√≥gica da gera√ß√£o de cart√µes precisou ser completamente redesenhada.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">O Turf</a> ajudou muito com isso - um √≥timo conjunto de ferramentas para manipular dados geogr√°ficos. <br><br>  Com as flechas, as cartas j√° eram mais √∫teis, mas ainda faltava alguma coisa.  Ap√≥s os testes ao vivo, ficou claro que todas as cartas foram viradas para o norte.  Na estat√≠stica, isso n√£o era impressionante, mas imediatamente se tornou aparente quando voc√™ fica atr√°s do volante.  O motorista espera subconscientemente que a seta esteja sempre apontando para cima ao dirigir.  Tendo descoberto isso, sentei-me novamente para trabalhar.  Essa foi novamente uma daquelas tarefas que parecem muito simples, mas voc√™ passar√° alguns dias depois.  Parece - calcule o azimute e gire o GeoJSON final antes da rasteriza√ß√£o.  Mas havia novamente uma nuance - esse GeoJSON final foi gerado por uma caixa delimitadora direta e, sendo girado e recortado nela, ele detecta lugares vazios. <br><br><img src="https://habrastorage.org/webt/e8/ru/m-/e8rum-k8gxclkhpgtsk95sdd2sw.png"><br><br>  No diagrama acima, dei aproximadamente a minha solu√ß√£o.  Como resultado, acabou n√£o sendo muito caro em termos de recursos e cobrindo 99% dos cen√°rios (acho que os erros subir√£o em algum lugar perto dos polos).  Em geral, o servidor de geo-computa√ß√£o ainda √© a parte que consome mais recursos do projeto, mas agora suas cartas de rota, al√©m da est√©tica, tamb√©m s√£o muito pr√°ticas.  At√© tentei chegar ao local usando esses cart√µes exclusivamente, sem incluir a navega√ß√£o.  E chegou mesmo. <br><br><img src="https://habrastorage.org/webt/43/t1/0b/43t10bq_ahbbeizyykpfd4jwl9a.png" width="600"><br><br><h4>  Qualidade dos dados </h4><br>  Peguei todos os meus dados de maneiras diferentes do OpenStreetMap.  Como voc√™ sabe, esse recurso √© 100% sem fins lucrativos e √© suportado por uma mente coletiva.  Isso √© um plus (√© gratuito e com uma estrutura clara), tamb√©m √© um sinal de menos - os dados s√£o muito heterog√™neos. <br><br>  Em um n√≠vel alto, isso significa uma cobertura desigual do globo como um todo: em pa√≠ses e cidades com um grande n√∫mero de entusiastas, cada gramado e caminho s√£o descritos e em outros lugares existem zonas quase vazias com objetos b√°sicos de esbo√ßo.  Os dados s√£o atualizados com exatamente a mesma irregularidade.  Ao testar meu aplicativo, me deparei com algumas vezes novos postos de gasolina, caf√©s e, √†s vezes, estradas inteiras que ainda n√£o consegui colocar nos mapas.  Reclamar √© est√∫pido: o mesmo Google gasta or√ßamentos astron√¥micos e cont√©m toda uma equipe de carros respons√°veis ‚Äã‚Äãpela relev√¢ncia de seus dados.  Portanto, aqui o melhor que podemos fazer √© sincronizar com mais frequ√™ncia com as extra√ß√µes do OpenStreetMap.  Bem, deseje boa sorte √† sua comunidade. <br><br>  Por√©m, em um n√≠vel mais baixo, devido √† edi√ß√£o ca√≥tica de mapas, h√° v√°rios outros problemas que podem ser completamente resolvidos.  Isso diz respeito principalmente a dados indesejados e duplicatas.  A variedade dessa bagun√ßa √© impressionante: o mesmo local pode ser descrito tr√™s vezes de maneiras diferentes, as institui√ß√µes n√£o t√™m nomes, os tipos e as tags s√£o colocados incorretamente e assim por diante.  Tudo isso n√£o possui uma solu√ß√£o unificada; √© necess√°rio um complexo de medidas para sistematizar o conte√∫do.  Por exemplo, eu tenho as seguintes condi√ß√µes: <br><br>  <i>Existem v√°rios sin√¥nimos e varia√ß√µes da mesma tag -&gt; descrevemos dicion√°rios de alias (por exemplo, parking, parking_space, parking_entrance, etc.).</i> <i><br><br></i>  <i>Existem v√°rios lugares com o mesmo tipo e as mesmas coordenadas:</i> <i><br><br></i> <ul><li>  se todo mundo n√£o tem nome -&gt; o tipo de lugar se torna o nome </li><li>  apenas um tem um nome -&gt; aceite </li><li>  todo mundo tem um nome e eles s√£o diferentes -&gt; pegue o sobrenome cronologicamente </li></ul><br>  Existem v√°rios lugares com o mesmo tipo e quase as mesmas coordenadas: <br><br><ul><li>  se todo mundo n√£o tiver nome -&gt; provavelmente duplicados, n√£o complicaremos.  Mesclar em um ponto com coordenadas m√©dias, em que o tipo de lugar se torna o nome.  Um homem vir√° e entender√° </li><li>  apenas um tem um nome -&gt; a mesma coisa, s√≥ que agora j√° temos um nome </li><li>  todo mundo tem um nome e eles s√£o diferentes -&gt; mas este √© um cluster </li></ul><br>  O cluster, no nosso caso, √© uma placa no cabe√ßalho da qual v√°rios locais s√£o descritos.  Na maioria das vezes, existem grupos de lojas ou postos de gasolina nas proximidades.  Ou, por exemplo, um caixa eletr√¥nico est√° localizado dentro do pr√©dio do banco e o outro fora.  Eles n√£o representam nenhuma dificuldade para n√≥s: calculamos as coordenadas m√©dias e tra√ßamos o caminho at√© elas.  Na interface, mostramos isso de forma limpa e simples: <br><br><img src="https://habrastorage.org/webt/ix/ru/jk/ixrujkqilkdxu34qjdsgt8e_pwo.png" width="300"><br><br><h2>  Interface e Design </h2><br>  Ent√£o aconteceu comigo que, antes do in√≠cio do desenvolvimento, eu j√° imagino a imagem final.  Ao mesmo tempo, n√£o gosto de desenhar diagramas e conceitos, preferindo formar um design em paralelo com fun√ß√µes (se esse for o meu projeto, √© claro).  Essa abordagem iterativa √© muito legal, por um lado, porque permite alternar entre recursos visuais e c√≥digo, por outro lado - √†s vezes voc√™ precisa refazer tudo com muita frequ√™ncia.  O mesmo aconteceu aqui: pare√ßo ter escavado a interface mais simples cem vezes.  Come√ßando com ninharias como √≠cones e recuos, terminando com a composi√ß√£o de cart√µes, menus, etc.  N√£o vou descrever tudo, vou passar rapidamente por quest√µes-chave.  Se voc√™ n√£o est√° interessado em design, fique √† vontade para ignor√°-lo. <br><br><h4>  Paleta de cores </h4><br>  Durante muito tempo, n√£o entendi o que fazer com a paleta.  Eu realmente queria designar as categorias de lugares em cores diferentes, com exce√ß√£o do verde - decidi salv√°-lo como um sotaque.  Eu escolhi cores facilmente distingu√≠veis e ricas, tudo parece estar bem.  Depois de algum tempo, descobri que o azul do posto de gasolina ecoa o azul, o que no mapa indica a posi√ß√£o do motorista.  Ele n√£o fez nada com isso, deixou como est√° - mas o perfeccionista interno est√° insatisfeito. <br><br><img src="https://habrastorage.org/webt/ya/dj/l8/yadjl8ri55axqz9pyzumcah0dfc.png" width="200"><br><br><h4>  "A caminho" e "Voc√™ est√° perto" </h4><br>  Depois que surgiu a l√≥gica que determina a dire√ß√£o do movimento do motorista, tornou-se poss√≠vel dividir as rotas em "ao longo do caminho" e no resto.  Como eu j√° disse, isso √© determinado pelo primeiro segmento da rota estabelecida no local: coincide com o √∫ltimo segmento da rota do motorista.  Se sim, ent√£o j√° estamos indo para este lugar.  Surgiu ent√£o a quest√£o de como mostrar isso na interface.  Al√©m das mudan√ßas no mapa que descrevi acima, surgiu a id√©ia da placa ‚ÄúA caminho‚Äù (ou ‚ÄúA caminho‚Äù em ingl√™s - parece que eles significam a mesma coisa).  Eu reuso o mesmo dado para outro cen√°rio: quando a dist√¢ncia at√© o local encontrado √© inferior a 25 metros.  Ent√£o n√£o faz sentido obter instru√ß√µes, oculto o mapa e escrevo que voc√™ j√° est√° perto ("Voc√™ est√° perto" / "Olhe ao seu redor"). <br><br><img src="https://habrastorage.org/webt/g6/1v/u9/g61vu93sak9y6igur-xaeigyc30.png" width="300"><br><br><h4>  Cart√£o comunit√°rio </h4><br>  No in√≠cio do desenvolvimento para depura√ß√£o, usei um mapa est√°tico do Google para ver o is√≥crono e os resultados.  Ent√£o ele correu com ela por um longo tempo, sem saber onde ficar: parece que o mapa √© uma coisa interessante, mas parece que n√£o deve ocupar um lugar.  Al√©m disso, dolorosamente nem queria depender do Google dessa maneira.  Ent√£o, no final, removi o mapa, mas depois de algum tempo comecei a gerar cart√µes de rota e percebi que eu havia tecnologicamente ‚Äúcrescido‚Äù para o grande mapa.  Verificou-se que n√£o era t√£o dif√≠cil fazer isso, embora at√© agora o mapa comum continue sendo a parte que mais consome recursos em todo o projeto.  E, para n√£o ocupar espa√ßo na interface, coloquei o cart√£o em uma p√°gina separada (eles o puxam com menos frequ√™ncia). <br><br><img src="https://habrastorage.org/webt/9k/ks/na/9kksnaanyjsobkxxc1mjmhny25c.png" width="300"><br><br><h4>  Localiza√ß√£o </h4><br>  Para uma sa√≠da normal na produ√ß√£o, a localiza√ß√£o √© necess√°ria.  √â sempre, por um lado, um trabalho muito direto e simples, por outro - quando voc√™ come√ßa a faz√™-lo, multid√µes de baratas se arrastam de todos os lugares.  No meu caso, o conte√∫do principal do OSM j√° estava localizado, de modo que apenas os tipos de lugar e os elementos da interface permaneciam.  Com exce√ß√£o de alguns plugues (por um longo tempo, n√£o pude formular um dado ‚Äúao longo do caminho‚Äù) tudo foi f√°cil.  Vale ressaltar que os nomes dos locais podem ocupar 2 e 3 linhas e podem n√£o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">caber</a> em telas de largura pequena - portanto, o widget <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">auto_size_text</a> ajudou aqui, eu o recomendo dentro de limites razo√°veis. <br><br><img src="https://habrastorage.org/webt/7z/yx/k3/7zyxk3gbrw0bamnfjf4fmgmysxe.png"><br><br>  Mas no lado t√©cnico n√£o foi t√£o tranquilo.           ‚Äî  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Intl_translation</a> ,  ‚Ä¶ . ,                 .         ,      (!)   -  ,    ‚Ä¶      ,     ,        . <br><br> ,  ,        ‚Äî   -       .        ,   ,      . <br><br><h2>  </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Na verdade, n√£o h√° nada interessante a dizer sobre o lan√ßamento em si. Havia suspeitas vagas de que a Apple se recusaria a usar o aplicativo, mas elas n√£o se concretizaram - tudo correu bem. Redesenhei o √≠cone e desenhei uma p√°gina de introdu√ß√£o que atende ao usu√°rio pela primeira vez. Eu tive que mexer um pouco com desenhos, mas parece que nada aconteceu. Nenhuma armadilha com permishens e sua localiza√ß√£o tamb√©m surgiram.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No √∫ltimo momento, a compila√ß√£o da vers√£o para Android foi interrompida devido √† transi√ß√£o do suporte para o androidx: algumas bibliotecas que eu usei n√£o o suportaram imediatamente. </font><font style="vertical-align: inherit;">Como resultado, esperei apenas alguns dias, mas devemos prestar homenagem aos autores dessas bibliotecas - eles os consertaram muito rapidamente. </font><font style="vertical-align: inherit;">No entanto, esse incidente me convenceu mais uma vez: ainda n√£o vou iniciar um grande projeto comercial. </font><font style="vertical-align: inherit;">Apesar de gostar dele, a hist√≥ria toda ainda √© muito, muito crua. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bem, como prometido, baixe os links:</font></font><br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/e1/3u/p8/e13up8j3vvrxjqwlpo2n6sfzauy.png" width="150"></a> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/k3/oc/vm/k3ocvm5auzce0x4lwl7p57l5qqe.png" width="150"></a> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Planos </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E algumas palavras no final sobre planos. </font><font style="vertical-align: inherit;">Se isso for √∫til para algu√©m que n√£o seja eu e houver downloads, tenho muitas id√©ias para um maior desenvolvimento. </font><font style="vertical-align: inherit;">Aqui est√° uma lista de amostra do que eu gostaria de incluir no release No. 2:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mais dados sobre locais (por exemplo, pre√ßos da gasolina ou tipos de cobran√ßas para carros el√©tricos) </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tema escuro para motoristas noturnos </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> modo compacto para ver mais resultados sem rolar (por exemplo, desative o minimapa, se desejar) </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> acelera√ß√£o da cartografia (voc√™ realmente precisa pensar nesse gargalo - otimizar de alguma forma complicada ou transferir para a virtualiza√ß√£o de cont√™iner) </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gostaria de apoiar ainda mais o Android Auto e o Apple CarPlay. </font><font style="vertical-align: inherit;">Eu nunca fiz solicita√ß√µes para eles, por isso estou curioso para tentar sozinho. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√â tudo, obrigado a todos pela aten√ß√£o.</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt440958/">https://habr.com/ru/post/pt440958/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt440946/index.html">Rollup: voc√™ j√° pode criar aplicativos</a></li>
<li><a href="../pt440948/index.html">N√£o fique esperto com formul√°rios de login</a></li>
<li><a href="../pt440950/index.html">Auditoria do Chrome 500: Parte 1. Aterragem</a></li>
<li><a href="../pt440954/index.html">Ciclo de vida de um artigo sobre Habr√©: escrevemos um habraparser. Parte dois</a></li>
<li><a href="../pt440956/index.html">Orquestrador n√¥made alternativo na √°rea de trabalho</a></li>
<li><a href="../pt440960/index.html">Orange Pi 2G-IOT: mapa do campo minado</a></li>
<li><a href="../pt440962/index.html">Os provedores de comunica√ß√£o ser√£o obrigados a concluir contratos para a conex√£o de edif√≠cios residenciais</a></li>
<li><a href="../pt440966/index.html">Conex√£o dos sensores KELLER ao MATLAB</a></li>
<li><a href="../pt440972/index.html">Universidade de Innopolis realizar√° a primeira escola internacional de design de ve√≠culos aut√¥nomos da R√∫ssia</a></li>
<li><a href="../pt440974/index.html">Kotlin puzzlers, vol. 2: um novo lote de quebra-cabe√ßas</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>