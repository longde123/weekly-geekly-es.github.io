<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚è™ üôÉ ü¶í NKRO a USB. Problemas y muletas en sus soluciones. üëÅ‚Äçüó® üèâ üóùÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola GT En una de mis publicaciones anteriores (en particular, sobre el teclado SteelSeries Apex M800) usuario monah_tukhizo una pregunta interesante ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>NKRO a USB. Problemas y muletas en sus soluciones.</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ulmart/blog/384797/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hola GT </font><font style="vertical-align: inherit;">En una de mis </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">publicaciones</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> anteriores </font><font style="vertical-align: inherit;">(en particular, sobre el teclado SteelSeries Apex M800) usuario  </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">monah_tuk</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hizo una pregunta interesante en los comentarios: ¬øc√≥mo se implementa NKRO (rollover de n teclas, sujeci√≥n simult√°nea de varias teclas) en teclados USB? </font><font style="vertical-align: inherit;">Esta pregunta me interes√≥, y cuando profundic√© un poco m√°s ... En general, hay tales establos de Augean que hubo suficiente informaci√≥n para toda una publicaci√≥n, aunque sea un poco. </font><font style="vertical-align: inherit;">
Parece que USB 2.0, incluso en modo de baja velocidad, proporciona transmisi√≥n de hasta 1500 Kbps (aproximadamente 185 KB / s), ¬øcu√°l es el problema de transmitir pulsaciones de teclas? </font><font style="vertical-align: inherit;">Pero no tan simple.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><img src="https://habrastorage.org/files/880/ae3/53b/880ae353bc054764b5b00e78560f2c91.jpg"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para descubrir qu√© problemas tiene la conexi√≥n USB, tendremos que profundizar en la historia y un poco en el dise√±o del teclado. </font></font><br>
<br>
<h2><font color="#e40136"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Problemas de vuelco: efecto fantasma</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Digamos que tiene un teclado con teclas est√°ndar 104/105. En el caso ideal, para obtener informaci√≥n 100% precisa sobre qu√© teclas est√°n sujetas, necesitar√° 1 "cableado" m√°s que botones: 104/105 cables de los botones y una "conexi√≥n a tierra" com√∫n. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por supuesto, dicho cableado ser√° dif√≠cil y costoso, por lo que se utilizan muchos teclados de bajo costo dentro del llamado. "Matriz": un conjunto de contactos horizontales y verticales que se cruzan. El controlador escanea cada columna, detecta una se√±al, comienza a escanear las "filas" y calcula la tecla presionada.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/geektimes/post_images/8a9/db0/9a9/8a9db09a960c7e2381df3ba06addc245.png"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si presiona, digamos, S y G y desea agregar una tercera tecla en una fila diferente, el controlador ya no puede decir cu√°l de las l√≠neas estaba cerrada: en el mejor de los casos, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> detectar√° una de las tres, en el peor de los casos, desde para las caracter√≠sticas de cableado, dibujar√© otro cuarto en el que no hizo clic. Esto se llama fantasma. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este comportamiento se trata con varios trucos en el campo del cableado: las combinaciones m√°s populares se cuelgan en diferentes "l√≠neas", a las l√≠neas de funci√≥n, que a menudo son elementos de teclas de acceso r√°pido, se les asignan l√≠neas separadas. El dise√±o sigue siendo lo suficientemente simple, pero </font><font style="vertical-align: inherit;">los teclados </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> caros son raros 5 + KRO, generalmente se limita a 3-4 mientras se presiona la tecla.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Adem√°s, el controlador puede bloquear a los "vecinos" en el bloque para eliminar la operaci√≥n "extra". Es decir, formalmente el teclado puede admitir 6KRO y, honestamente, dejar presionar CTRL + AWFBNM al mismo tiempo, pero no dejar que AWSD se mantenga, limitado a activar un tipo WAS o WDS. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puede verificar su teclado con este tipo de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cosas</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Tiene algunas limitaciones, pero se deben al hecho de que el sistema interceptar√° la presi√≥n de un bot√≥n antes que el navegador. Por ejemplo, Imprimir pantalla o Alt + Tab funcionar√° antes de que la p√°gina pueda "atraparlos".</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora, este terrible sistema "barato" (desde el punto de vista del trabajo) es reemplazado casi por completo por una matriz "abierta" un poco m√°s compleja, sin embargo, todav√≠a se encuentran instancias, especialmente a menudo en todo tipo de teclados completos de "un d√≥lar" que van a la computadora "desde afuera" cajas ". </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Los m√°s caros (a menudo teclados de juegos o de negocios) usan circuitos m√°s complejos, varios controladores, conexiones individuales, placas de circuitos impresos multicapa, en general, varios enfoques que reducen o eliminan por completo el efecto fantasma, pero conducen a un aumento en el precio del dispositivo. </font><font style="vertical-align: inherit;">Descubrimos los posibles problemas de hardware de NKRO, pasamos a los de software.</font></font><br>
<br>
<h2><font color="#e40136"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Teclados hasta USB</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El conector com√∫n principal para conectar un teclado y un mouse a USB fue PS / 2. Aqu√≠ hay uno muy ordenado: </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/f5b/7a6/e90/f5b7a6e905986a83ea8ad3fac4e5b6b2.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
su encanto era que, sujeto a todos los est√°ndares, era posible trabajar con un mouse y un teclado desde un conector y un divisor, y los dispositivos de entrada generaron una interrupci√≥n y enviaron informaci√≥n sobre los botones presionados / movimiento del cursor. All√≠, al menos ponga la cara en el teclado, si todo est√° correctamente separado, y el rollover no descansa en las capacidades de hardware del teclado: el teclado enviar√° todo lo que el controlador "lee".</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Desafortunadamente, PS / 2 ten√≠a sus inconvenientes (como problemas con Plug'n'Play y un conector inconveniente), y la ubicuidad de los dispositivos USB hizo que los perif√©ricos PS / 2 fueran eliminados casi por completo del mercado. </font><font style="vertical-align: inherit;">Sin embargo, hay placas base bastante modernas con USB 3.0 y dos (!) PS / 2: </font></font><br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/110/db6/de3/110db6de3dee099c328da97f5ced88cb.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
los puertos combinados, por cierto, debido a las caracter√≠sticas de pinout (fuente de alimentaci√≥n general, diferentes pines para datos + / datos- en el mouse y el teclado), tambi√©n le permiten conectarse ambos dispositivos a trav√©s de un puerto usando un adaptador:</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/dbd/c58/009/dbdc5800929686000cda4c2b39a268ed.jpg"><br>
<br>
<h2><font color="#e40136"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NKRO USB cuestiones: USB HID es el culpable </font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para que los teclados USB funcionen antes de cargar el sistema (es decir, en BIOS / UEFI), se utiliza el controlador HID est√°ndar, que fue desarrollado para el soporte m√°s amplio posible para teclados y hosts USB. La clase USB HID describe dispositivos para que la implementaci√≥n est√°ndar del host USB y los dispositivos USB puedan comunicarse sin instalar controladores especiales. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un teclado est√°ndar (dise√±ado con soporte para el est√°ndar USB HID) usa el flujo de datos de salida (salida del host USB) (punto final de la pila USB) para obtener informaci√≥n sobre el estado de los indicadores (Num / Caps / Scroll Lock) y el flujo de entrada (proveniente del teclado, "Entrante" para el host USB) para enviar informaci√≥n sobre las teclas presionadas.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si sigue la especificaci√≥n USB HID v1.11 m√°s estricta, que admite el modo de arranque USB (y le permite usar un teclado USB para ingresar al BIOS y trabajar en √©l), el teclado enviar√° interrupciones a la CPU cada vez que el host USB lo sondee , independientemente de si su condici√≥n ha cambiado o no. Por lo tanto, el trabajo de los teclados PS / 2 se "emula" con una sobrecarga m√≠nima. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En este caso, el teclado funciona de acuerdo con el est√°ndar USB 1.1 (a veces 2.0) de baja velocidad, y la velocidad de sondeo del puerto es de 100 Hz. En este modo, la longitud m√°xima del paquete en USB es de 8 bytes y se env√≠an cada 10 ms. Uno de los bytes est√° reservado, de modo que quedan 7 bytes para que el teclado funcione, es decir. la cantidad es suficiente para codificar la pulsaci√≥n de cualquier tecla modificadora y otras seis.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Resulta qui√©n trabaja el teclado en modo 6-KRO, y es est√°ndar para la mayor√≠a de los teclados USB. </font><font style="vertical-align: inherit;">Hacer menos es posible (a veces de manera consciente, a veces no, debido al efecto fantasma y al bloqueo de teclas), m√°s, solo en violaci√≥n de la especificaci√≥n HID USB. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despu√©s de cargar, el sistema puede aumentar la frecuencia de sondeo de un puerto USB, cargar un controlador especial que permita, por ejemplo, teclas multimedia y macros.</font></font><br>
<br>
<h2><font color="#e40136"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Implementaciones NKRO USB</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Omitir restricciones USB HID, de hecho, hay dos tipos. </font><font style="vertical-align: inherit;">En el primer caso, el software patentado detecta el teclado, lo transfiere a alg√∫n modo especial y env√≠a datos desde el controlador directamente al controlador, y ya se comunica con el sistema. </font><font style="vertical-align: inherit;">La desventaja de tal decisi√≥n es el aumento de la llamada </font><font style="vertical-align: inherit;">retraso de entrada: retraso de entrada. </font><font style="vertical-align: inherit;">Al entrevistar a conocidos, encontr√© solo un teclado que me permit√≠a presionar 10 teclas cuando estaba conectado a trav√©s de USB: un sustantivo chino con un zakos debajo del "juego". </font><font style="vertical-align: inherit;">El propietario ya vive en Irkutsk, por lo que no sorprende que solo haya encontrado algo as√≠. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La segunda soluci√≥n cautiva con su simplicidad e ingenio, pero de hecho es una muleta: </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/244/ecd/20d/244ecd20d056e4d0475d82b8a9a9bc68.png"><br>
<sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gracias por la captura de pantalla  </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Myfeargear</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, tal cosa se not√≥ para Logitech G710 + El</font></font></sup><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
teclado simplemente se presenta al sistema por varios dispositivos HID, cada uno de los cuales tiene su propio 6KRO. </font><font style="vertical-align: inherit;">Una encuesta r√°pida de conocidos que les pidi√≥ que especificaran un modelo de teclado y enviaran una captura de pantalla de este tipo mostr√≥ que </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Logitech</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A4tech</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cougar</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SteelSeries</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> usan este truco </font><font style="vertical-align: inherit;">, en general, todos los que encontraron NKRO en la descripci√≥n de los teclados USB. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬°Atenci√≥n! </font><font style="vertical-align: inherit;">Antes de revisar su teclado, aseg√∫rese de no tener conectado ning√∫n sofisticado mouse USB de varios botones (incluso de forma inal√°mbrica). </font><font style="vertical-align: inherit;">Dado que toda la magnificencia de varios botones de la misma manera puede pretender ser teclados "extra".</font></font><br>
<br>
<h2><font color="#e40136"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusi√≥n</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En realidad, eso es todo. </font><font style="vertical-align: inherit;">Casi todos los fabricantes han elegido un m√©todo de "muleta", pero uno que funciona y no crea ning√∫n problema especial para el usuario, y es posible el NKRO honesto (bueno, relativamente honesto) en USB.</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es384797/">https://habr.com/ru/post/es384797/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es384783/index.html">Las empresas suecas se est√°n mudando gradualmente a una jornada laboral de 6 horas.</a></li>
<li><a href="../es384785/index.html">C√≥mo reprogramar el c√°ncer</a></li>
<li><a href="../es384789/index.html">Snowden olvid√≥ desactivar las notificaciones de Twitter y recibi√≥ 47 GB de correos electr√≥nicos</a></li>
<li><a href="../es384791/index.html">Qu√© ver en Igromir 2015</a></li>
<li><a href="../es384793/index.html">Es solo espacio, beb√©: New Horizons envi√≥ fotos de alta resoluci√≥n de Charon</a></li>
<li><a href="../es384799/index.html">Legado de Cipherpunk: la evoluci√≥n de las ideas</a></li>
<li><a href="../es384801/index.html">√öltimo d√≠a de Pompeya: cient√≠ficos italianos escanearon los restos de v√≠ctimas del desastre</a></li>
<li><a href="../es384803/index.html">Paul Graham: Ideas para una startup org√°nica</a></li>
<li><a href="../es384805/index.html">–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—ã iFixit —Ä–∞–∑–æ–±—Ä–∞–ª–∏ AppleTV, –∞ Apple —É–¥–∞–ª–∏–ª–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ iFixit –∏–∑ AppStore</a></li>
<li><a href="../es384809/index.html">¬øPapel o "n√∫mero"? Ambos: revisi√≥n del bol√≠grafo inteligente NeoLAB Convergence Neo smartpen N2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>