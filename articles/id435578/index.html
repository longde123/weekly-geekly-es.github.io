<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🐡 ✊🏻 🚣🏾 Spacewalk untuk Natal 🦕 👨🏿‍⚕️ 🍙</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Halo, Habr! 

 Sesaat sebelum Natal, diputuskan untuk mempelajari Spacewalk di departemen TI - ini adalah sistem Red Hat, analog satelit gratis, untuk...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Spacewalk untuk Natal</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/435578/"> Halo, Habr! <br><br>  Sesaat sebelum Natal, diputuskan untuk mempelajari Spacewalk di departemen TI - ini adalah sistem Red Hat, analog satelit gratis, untuk manajemen konfigurasi terpusat, pembaruan sistem, dan dukungan mudah untuk seluruh taman server. <br><br>  Karena fakta bahwa dokumentasi yang tersedia di situs web resmi agak langka untuk komentar tambahan dari berbagai jenis pemecahan masalah, tugasnya adalah mempelajari produk untuk pengenalan bertahap pertama kali untuk menguji server, dan kemudian ke produk. <br><br>  Gagasan utama untuk memperkenalkan Spacewalk bukan hanya sentralisasi dan penyederhanaan kontrol, tetapi juga agar tidak ada yang bisa memutakhirkan server server proyek baru dengan pena lucu, karena preseden sudah terjadi. <br><br>  Setelah dua minggu bekerja, semua pengetahuan yang saya terima dimasukkan ke dalam analog internal Confluence, dan hari libur mendorong saya untuk menulis artikel tentang Habr. <br><a name="habracut"></a><br>  Sebelum saya mulai, saya ingin menyoroti secara singkat apa yang dulu dan yang tidak terpengaruh, agar tidak berpura-pura menjadi manual lengkap untuk bekerja dengan Spacewalk: <br><br>  + Instalasi dan konfigurasi server / klien <br>  + Pengaturan sistem dalam GUI <br>  + Memecahkan masalah instalasi / memperbarui paket, bekerja dengan konfigurasi <br>  + Errata (mengumpulkan informasi tentang pembaruan kritis, kerentanan, dll.) <br><br>  - Proxy (kebutuhan menghilang, setelah menyerah HA) <br>  - tukang sepatu / kickstart <br>  - OpenSCAP <br><br><h3>  Persyaratan sistem </h3><br>  Karena fakta bahwa seluruh infrastruktur berjalan pada VMWare, pekerjaan dilakukan pada VM yang menjalankan CentOS 7. Persyaratan sistem yang disarankan dari pengembang adalah: <br><br><ul><li>  RAM 4GB </li><li>  6GB ruang kosong untuk / var / satelit / </li><li>  12GB untuk DB </li></ul><br>  Saya menggunakan: <br><br><ul><li>  RAM 6GB </li><li>  4 CPU </li><li>  HDD 40GB </li></ul><br>  Saya juga menyarankan Anda untuk menonaktifkan SELinux dan, jika tidak menggunakan, firewalld.  Atau tambahkan layanan http ke pengecualian. <br><br>  Catatan: di akhir artikel akan ada buku pedoman untuk Ansible, baik untuk bagian klien dan server, serta skrip bash.  Dengan bantuan mereka, akan mungkin untuk mengerahkan seluruh infrastruktur dalam beberapa menit. <br><br><h3>  Instalasi </h3><br>  Instalasi itu sendiri dijelaskan dalam dokumentasi resmi dan di beberapa situs, namun, untuk integritas artikel, izinkan saya menyebutkan poin ini di sini. <br><br>  Spacewalk bekerja dengan dua DBMS: PostgreSQL dan Oracle RDBMS.  Saya memiliki pengalaman dengan yang pertama, dan saya akan menggunakannya sekarang. <br><br>  Ada dua opsi instalasi: baik melalui penginstal otomatis dari Spacewalk, yang akan menginstal dan mengkonfigurasi sendiri dan database, namun, pada server yang sama, dan instalasi manual, di mana Anda dapat menempatkan DB dan aplikasi pada server yang berbeda.  Saya akan mempertimbangkan kedua opsi, saya akan mulai dengan instalasi yang terpisah. <br><br><h4>  PostgreSQL </h4><br><pre><code class="bash hljs">yum install -y postgresql-server</code> </pre> <br>  Juga diperlukan untuk menghubungkan modul PL / Tcl untuk PG: <br><br><pre> <code class="bash hljs">yum install -y postgresql-pltcl postgresql-setup initdb systemctl start postgresql</code> </pre> <br>  Buat database, pengguna, dan hubungkan modul: <br><br><pre> <code class="bash hljs">su - postgres -c <span class="hljs-string"><span class="hljs-string">'PGPASSWORD=verystrong; createdb spcwlkdb ; createlang plpgsql spcwlkdb ; createlang pltclu spcwlkdb ; yes $PGPASSWORD | createuser -P -sDR spcwlkuser'</span></span></code> </pre> <br>  Untuk menghindari masalah koneksi, ada baiknya mengubah <i>/var/lib/pgsql/data/pg_hba.conf</i> , menambahkan baris SEBELUM baris semua: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">local</span></span> spcwlkdb spcwlkuser md5 host spcwlkdb spcwlkuser 127.0.0.1/8 md5 <span class="hljs-built_in"><span class="hljs-built_in">local</span></span> spcwlkdb postgres ident</code> </pre> <br>  Mulai ulang semuanya: <br><br><pre> <code class="bash hljs">systemctl restart postgresql</code> </pre> <br>  Jika Anda bermaksud untuk menginstal aplikasi dan database pada server yang berbeda, pastikan bahwa paket <i>postgresql-contrib</i> diinstal pada server database. <br><br><h4>  Spacewalk </h4><br>  Kami menghubungkan repositori: <br><br><pre> <code class="bash hljs">rpm -Uvh https://copr-be.cloud.fedoraproject.org/results/@spacewalkproject/spacewalk-2.8/epel-7-x86_64/00736372-spacewalk-repo/spacewalk-repo-2.8-11.el7.centos.noarch.rpm</code> </pre> <br>  Juga sambungkan epel: <br><br><pre> <code class="bash hljs">rpm -Uvh https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm</code> </pre> <br>  Jawa: <br><br><pre> <code class="bash hljs">(<span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /etc/yum.repos.d &amp;&amp; curl -O https://copr.fedorainfracloud.org/coprs/g/spacewalkproject/java-packages/repo/epel-7/group_spacewalkproject-java-packages-epel-7.repo)</code> </pre> <br>  Sekarang secara langsung installer untuk Spacewalk-postgres: <br><br><pre> <code class="bash hljs">yum -y install spacewalk-setup-postgresql</code> </pre> <br>  Terhubung ke basis data kami: <br><br><pre> <code class="bash hljs">spacewalk-setup-postgresql create --db spcwlkdb --user spcwlkuser --password verystrong</code> </pre> <br>  Jika Anda menggunakan metode database / aplikasi yang terpisah, Anda harus menambahkan flag <i>--standalone</i> dan menentukan alamat IP dari server database, juga jangan lupa untuk membuka port 5432. <br><br>  <i>Catatan: Saya menyarankan menyetel basis data sesuai dengan perangkat keras Anda untuk operasi yang lebih produktif dari keseluruhan sistem.</i> <br><br>  Sekarang instal Spacewalk sendiri dan jalankan instalasi: <br><br><pre> <code class="bash hljs">yum -y install spacewalk-postgresql spacewalk-setup --external-postgresql</code> </pre> <br>  Berikutnya, beberapa pertanyaan akan diajukan, baik mengenai sertifikat SSL dan database.  Anda dapat memasukkan semua nilai secara manual, atau Anda dapat menggunakan <i>flag --answer-file</i> dan menentukan path ke file dengan jawaban untuk mengotomatisasi instalasi di masa depan: <br><br><pre> <code class="bash hljs">admin-email = root@localhost ssl-set-cnames = spcwlkserver ssl-set-org = Unicorn ssl-set-org-unit = EOH ssl-set-city = Prague ssl-set-state = HMP ssl-set-country = CZ ssl-password = verystrong ssl-set-email = root@localhost ssl-config-sslvhost = Y db-backend=postgresql db-name=spcwlkdb db-user=spcwlkuser db-password=verystrong db-host=localhost db-port=5432 <span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>-tftp=Y</code> </pre> <br>  Untuk mengontrol aplikasi secara langsung, Anda harus menggunakan: <br><br><pre> <code class="bash hljs">/usr/sbin/spacewalk-service [stop|start|restart]</code> </pre> <br>  Untuk menampilkan semua layanan pihak ketiga yang berkontribusi pada aplikasi: <br><br><pre> <code class="bash hljs">spacewalk-service status</code> </pre> <br><h4>  Opsi Dua, instalasi otomatis </h4><br>  Setelah menghubungkan repositori, atur dan jalankan: <br><br><pre> <code class="bash hljs">yum -y install spacewalk-setup-postgresql yum -y install spacewalk-postgresql spacewalk-setup</code> </pre> <br>  Sekali lagi, pertanyaan akan ditanyakan mengenai database dan SSL, kami menggunakan kunci <i>--answer-file</i> dan path ke file dengan jawabannya. <br><br><h3>  Saluran Pangkalan &amp; Anak, Repos </h3><br>  Untuk mengelola stasiun klien, Spacewalk menggunakan sistem saluran yang disebut, yang dapat berupa main (child) atau child (child), repositori yang Anda perlukan dilampirkan ke setiap saluran, serta kunci - dengan klien yang dipasangkan dengan server. <br><br>  Akibatnya, repositori disinkronkan dengan saluran, yang, pada gilirannya, terhubung dengan klien, dan Spacewalk berfungsi secara umum.  Errata, yang dapat dikaitkan dengan saluran, juga layak disebut, yang menyederhanakan pembaruan dan kontrol paket. <br><br>  Semua klien dapat dikelompokkan berdasarkan berbagai kriteria, baik dengan saluran yang sama dan dengan saluran atau repositori yang berbeda. Hal ini dimungkinkan untuk bekerja dengan sejumlah besar klien sekaligus, yang membantu untuk membuat pembaruan di 100+ server. <br><br>  Daftar semua paket yang diinstal tersedia, dan setelah sinkronisasi repositori dan mungkin untuk instalasi.  Beberapa poin intuitif, dan tidak masuk akal untuk mempertimbangkan setiap item baris demi baris. <br><br>  Semua tindakan di Spacewalk berlangsung sesuai jadwal (Jadwal), hampir semua tindakan dapat dikonfigurasi untuk waktu yang paling nyaman bagi Anda. <br><br>  Setelah instalasi, akan mungkin untuk pergi ke alamat server Anda, melakukan konfigurasi lebih lanjut melalui antarmuka grafis: <br><br><img src="https://habrastorage.org/webt/bb/iq/co/bbiqcow_kswo_i91vsqceeg6g0s.png"><br><br>  Masukkan kata sandi, nama administrator, nama organisasi (yang juga merupakan salah satu cara untuk mengelola klien), dan buka panel mulai. <br><br>  Untuk saat ini, Anda dapat menjelajahi sendiri opsi yang tersedia, atau beralih ke membuat saluran. <br><br>  <i>Channels - Kelola Saluran Software - Buat Saluran:</i> <br><br><img src="https://habrastorage.org/webt/5m/6o/f9/5m6of99m6ey7yq0rxbdmenvhcuw.png"><br><br>  Saya merekomendasikan pengaturan nama saluran sesuai dengan jenis dan tipe OS yang akan terikat ke saluran ini, misalnya, <i>CentOS_7_x86_64</i> , Anda dapat memilih sha256 dengan aman sebagai cek, bidang Ringkasan Channell dimaksudkan untuk deskripsi kecil saluran.  Anda juga dapat secara opsional memberikan informasi tambahan. <br><br>  Sekarang buat saluran anak dan ikat ke saluran utama.  Kami menggunakan cara yang sama seperti membuat saluran utama, hanya di bidang Saluran Induk kami akan menunjukkan saluran yang sebelumnya dibuat. <br><br>  Ikat repositori ke saluran utama dan anak perusahaan. <br>  <i>Channels - Kelola Gudang</i> <br><br><img src="https://habrastorage.org/webt/a3/gq/ok/a3gqokxrwd10mlfq4geiw0f1nqy.png"><br><br>  Untuk saluran utama, saya menggunakan Sumber Daya Basis, untuk saluran tambahan - Pembaruan. <br><br>  Setelah membuat repositori, Anda harus menghubungkannya ke saluran. <br>  <i>Channels - Kelola Saluran Software</i> , buka saluran utama Anda, buka bagian Repositori. <br><br><img src="https://habrastorage.org/webt/hw/ro/og/hwroogjvybx0p1z2mslzxf8nunq.png"><br><br>  Akan ada semua repositori yang dibuat, pilih yang Anda butuhkan, tandai, dan klik Perbarui Sumber Daya. <br><br>  Selanjutnya, buka subkunci Sinkronisasi: <br><br><img src="https://habrastorage.org/webt/ho/j7/4m/hoj74mhjkorduvftwkwbteuxzk4.png"><br><br>  Di mana Anda dapat menyinkronkan repositori dan saluran, konfigurasikan jadwal untuk sinkronisasi. <br><br>  <i>Catatan: dalam kasus pena lucu saya, saya harus menghapus repositori standar dari sistem klien.</i> <br><br><h4>  Instalasi klien, memasangkan klien dengan server, manajemen kunci, mengatur saluran konfigurasi </h4><br>  Seperti yang saya sebutkan sebelumnya, Spacewalk menggunakan sistem kunci dari Red Hat Network, yang digunakan untuk pemasangan dan manajemen. <br><br>  Untuk membuat kunci, pergi ke <i>Sistem - Kunci Aktivasi - Buat Kunci:</i> <br><br><img src="https://habrastorage.org/webt/ea/df/vf/eadfvfezxpeh1s_lt9blgfox3j8.png"><br><br>  Semuanya sangat sederhana di sini, apakah perlu menyebutkan bahwa Anda dapat mengatur sendiri kunci Anda sendiri, formatnya akan selalu <i>1-XXXXXX</i> , dan juga, setiap tombol terpasang ke saluran.  Bendera Universal Default memaksa sistem baru untuk mengambil parameter kunci. <br><br>  <b>Instalasi Klien</b> <br><br>  Hubungkan repositori klien dan instal paket yang diperlukan: <br><br><pre> <code class="bash hljs">rpm -Uvh https://copr-be.cloud.fedoraproject.org/results/@spacewalkproject/spacewalk-2.8-client/epel-7-x86_64/00742644-spacewalk-repo/spacewalk-client-repo-2.8-11.el7.centos.noarch.rpm yum -y install rhn-client-tools rhn-check rhn-setup rhnsd m2crypto yum-rhn-plugin rhncfg-actions deltarpm</code> </pre> <br><br>  <i>Catatan: rhncfg-aksi dan deltarpm diperlukan agar konfigurasi dan kendali jarak jauh berfungsi dengan benar.</i> <br><br>  Spacewalk menggunakan rhn_check untuk menyinkronkan server klien, yang berjalan setiap 4 jam.  Nilai ini dapat dikurangi menjadi 60 menit, tetapi bagi saya tidak ada opsi yang optimal, oleh karena itu ada dua opsi: gunakan osad, yang datang dengan Spacewalk, atau cukup tambahkan cronjob untuk rhn_check, misalnya, untuk setiap menit saat kami uji sistem, maka nilainya dapat diubah sesuka Anda. <br><br><pre> <code class="bash hljs">crontab -e * * * * * /usr/sbin/rhn_check</code> </pre> <br>  Ini juga tidak akan salah untuk menambahkan / usr / bin / rhn-action-control --enable-all ke Cron juga, ini digunakan untuk menyebarkan konfigurasi, dan kadang-kadang menjadi bodoh. <br><br>  Kami kembali ke manajemen kunci, dan menyalin ID kunci yang kami buat, dan mengeksekusi: <br><br><pre> <code class="bash hljs">rhnreg_ks --serverUrl=http://your-server-ip/XMLRPC --activationkey=1-YOURKEY --force</code> </pre> <br>  Hanya saja, jangan lupa untuk mengubah IP dan nilai-nilai kunci untuk Anda sendiri.  Sekali lagi, saya menyarankan Anda untuk menggunakan flag <i>--force</i> , karena saya melihat ada masalah tanpa menggunakan flag ini. <br><br>  Kami kembali ke <i>Sistem - Semua</i> , kami senang melihat sistem kami.  Anda sekarang dapat membukanya dan menjelajahi apa dan bagaimana di sana, tetapi untuk sekarang saya sangat merekomendasikan membuat grup untuk manajemen sistem yang lebih nyaman. <br><br>  <i>Sistem - System Goups - Buat Grup</i> , isi nama dan deskripsi, simpan, buka grup yang baru dibuat, buka bagian <i>Sistem</i> dan tambahkan sistem ke grup. <br><br>  Sekarang berlangganan sistem ke saluran, <i>Sistem - Sistem Anda - Folder Perangkat Lunak - Subfolder Saluran Perangkat Lunak:</i> <br><br><img src="https://habrastorage.org/webt/7f/hp/lu/7fhplurd2imupn4cio2n7ymcz1y.png"><br><br>  Pilih saluran Anda dan klik konfirmasi.  Untuk bersenang-senang, Anda dapat mencoba menginstal paket, <i>Perangkat Lunak - Paket - Instal</i> . <br><br>  <b>Saluran konfigurasi</b> <br><br>  Untuk mengelola konfigurasi antara server klien / mesin lokal, serta remote control, ada baiknya mengatur saluran konfigurasi dan menghubungkan sistem ke sana. <br>  Kita pergi ke <i>Konfigurasi - Saluran Konfigurasi - Buat Saluran Konfigurasi</i> , atur nama, deskripsi, simpan, lalu di <i>Konfigurasi - Kelola Saluran Konfigurasi - Berlangganan Saluran</i> dan tandatangani saluran konfigurasi ke saluran perangkat lunak, dan ke sistem. <br><br><img src="https://habrastorage.org/webt/jy/ki/wt/jykiwtrdmame71pab7yyzr40lay.png"><br><br>  Sekarang kita dapat menggunakan konfigurasi dari server dan mesin lokal, dan membuat partisi. <br><br>  <i>Konfigurasi - Tambah File - Buat File / Unggah File:</i> <br><br><img src="https://habrastorage.org/webt/cf/js/ie/cfjsieqwp21zlmem7goijg7cqui.png"><br><br>  Selain itu, kami dapat mengirim perintah jarak jauh dalam bentuk skrip bash: <br><br><img src="https://habrastorage.org/webt/hy/xw/d-/hyxwd-znezglfc-glf5yhn44wsq.png"><br><br>  Saya mengingatkan Anda bahwa semua tindakan melalui Jadwal, daftar semua tindakan yang diterapkan pada sistem ini dapat ditemukan di bagian Acara: <br><br><img src="https://habrastorage.org/webt/9m/fp/hj/9mfphjmglxmqpxfd_cdqpsf8g2s.png"><br><br>  <b>Kesalahan</b> <br><br>  Salah satu fitur terpenting dalam Spacewalk adalah dukungan errata, yang dengan mudah mengikat ke saluran dan memungkinkan Anda untuk memantau tingkat pentingnya pembaruan terbaru.  Ini dikonfigurasi secara langsung di server, selain skrip, Anda perlu mengunduh paket yang diperlukan untuk Pearl: <br><br><pre> <code class="bash hljs">yum -y install perl-Frontier-RPC perl-Text-Unidecode wget https://raw.githubusercontent.com/stevemeier/cefs/master/errata-import.pl chmod +x errata-import.pl</code> </pre> <br>  Kemudian buat pembaruan utama dan skrip koleksi errata, yang akan disimpan di <i>/ etc / rhn /:</i> <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash cd /etc/rhn/ wget -N http://cefs.steve-meier.de/errata.latest.xml wget -N https://www.redhat.com/security/data/oval/com.redhat.rhsa-all.xml export SPACEWALK_USER='root' export SPACEWALK_PASS='verystrong' ./errata-import.pl --server YourServerIPAddress --errata errata.latest.xml --rhsa-oval com.redhat.rhsa-all.xml --publish unset SPACEWALK_USER unset SPACEWALK_PASS</span></span></code> </pre> <br>  Dalam ekspor, tentukan nama dan kata sandi administrator Spacewalk, yang Anda tentukan di awal. <br><br>  Mari kita membuat skrip dapat dieksekusi dan menambahkannya ke Cron: <br><br><pre> <code class="bash hljs">chmod +x spcwlk_errata.sh crontab -e 0 2 * * 7 /usr/bin/sh /etc/rhn/spcwlk_errata.sh</code> </pre> <br>  Mari kita jalankan sekarang untuk melihat perubahan pada antarmuka grafis.  Eksekusi akan memakan waktu. <br><br><img src="https://habrastorage.org/webt/5v/yy/v9/5vyyv9a4xpmq7c2lqqglozhdrsk.png"><br><br><h4>  Ringkasan </h4><br>  Poin penting, menurut pendapat saya, yang secara pribadi saya lewatkan, adalah menyiapkan dan menginstal proxy, serta meningkatkan seluruh sistem sebagai HA.  Saya punya ide untuk mengkonfigurasi aplikasi melalui alat pacu jantung, dan melakukan sinkronisasi pada database.  Akibatnya, diputuskan untuk meninggalkan ide ini, mengingat armada server stasiun klien yang tidak terlalu besar.  Namun, jika sistem terbukti sangat berguna dalam enam bulan ke depan, Anda mungkin harus memperluas server asli. <br><br><h4>  Otomasi </h4><br>  <b>Server:</b> <br><br><div class="spoiler">  <b class="spoiler_title">Skrip Bash untuk penyebaran server (DISABLES firewalld):</b> <div class="spoiler_text"><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh # rpm -Uvh https://copr-be.cloud.fedoraproject.org/results/@spacewalkproject/spacewalk-2.8/epel-7-x86_64/00736372-spacewalk-repo/spacewalk-repo-2.8-11.el7.centos.noarch.rpm rpm -Uvh https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm (cd /etc/yum.repos.d &amp;&amp; curl -O https://copr.fedorainfracloud.org/coprs/g/spacewalkproject/java-packages/repo/epel-7/group_spacewalkproject-java-packages-epel-7.repo) yum -y install spacewalk-setup-postgresql spacewalk-postgresql wget perl-Frontier-RPC perl-Text-Unidecode perl-XML-Simple # mkdir /usr/share/spcwlk-tmp/ echo 'admin-email = root@localhost ssl-set-cnames = spcwlkserver ssl-set-org = Unicorn ssl-set-org-unit = EOH ssl-set-city = Prague ssl-set-state = SCK ssl-set-country = CZ ssl-password = verystrong ssl-set-email = root@localhost ssl-config-sslvhost = Y db-backend=postgresql db-name=spcwlkdb db-user=spcwlkuser db-password=verystrong db-host=localhost db-port=5432 enable-tftp=Y' &gt; /usr/share/spcwlk-tmp/spcwlk_answer spacewalk-setup --answer-file=/usr/share/spcwlk-tmp/spcwlk_answer # systemctl stop firewalld systemctl disable firewalld #</span></span></code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Script Bash untuk menginstal errata (pertama-tama atur nama dan kata sandi untuk administrator Spacewalk):</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh # wget https://raw.githubusercontent.com/stevemeier/cefs/master/errata-import.pl -P /etc/rhn/ echo '#!/bin/bash cd /etc/rhn/ wget -N http://cefs.steve-meier.de/errata.latest.xml wget -N https://www.redhat.com/security/data/oval/com.redhat.rhsa-all.xml export SPACEWALK_USER='gui username' export SPACEWALK_PASS='Password to your gui account' ./errata-import.pl --server YourServerIPAddress --errata errata.latest.xml --rhsa-oval com.redhat.rhsa-all.xml --publish unset SPACEWALK_USER unset SPACEWALK_PASS' &gt; /etc/rhn/spcwlk_errata.sh # chmod +x /etc/rhn/errata-import.pl chmod +x /etc/rhn/spcwlk_errata.sh # echo '#!/bin/bash # /etc/rhn/./spcwlk_errata.sh' &gt; /etc/rhn/spcwlk_errata_cron.sh chmod +x /etc/rhn/spcwlk_errata_cron.sh echo '0 2 * * 7 /usr/bin/sh /etc/rhn/spcwlk_errata_cron.sh' &gt;&gt; /var/spool/cron/root /etc/rhn/./spcwlk_errata.sh #</span></span></code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Playbook yang memungkinkan untuk penyebaran server (jangan lupa untuk menambahkan file jawaban):</b> <div class="spoiler_text"><pre> <code class="bash hljs">- hosts: spcwlk-server tasks: - name: Install Spacewalk repo yum: name: https://copr-be.cloud.fedoraproject.org/results/@spacewalkproject/spacewalk-2.8/epel-7-x86_64/00736372-spacewalk-repo/spacewalk-repo-2.8-11.el7.centos.noarch.rpm state: present - name: Install epel repo yum: name: https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm state: present - name: Install PostgreSQL packages yum: name: - spacewalk-setup-postgresql - spacewalk-postgresql - wget - perl-Frontier-RPC - perl-Text-Unidecode - perl-XML-Simple - name: Creates directory <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> Spacewalk answer file file: path: /usr/share/spcwlk-tmp/ state: directory mode: 0755 - name: Deploy answer file copy: src: /etc/ansible/spcwlk_answer dest: /usr/share/spcwlk-tmp/spcwlk_answer - name: Spacewalk Server Deploy shell: spacewalk-setup --answer-file=/usr/share/spcwlk-tmp/spcwlk_answer - name: Stop firewalld systemd: name: firewalld state: stopped enabled: no</code> </pre> <br></div></div><br>  <b>Pelanggan:</b> <br><br><div class="spoiler">  <b class="spoiler_title">Skrip Bash untuk penerapan klien (jangan lupa tentang IP dan kunci):</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh # rpm -Uvh https://copr-be.cloud.fedoraproject.org/results/@spacewalkproject/spacewalk-2.8-client/epel-7-x86_64/00742644-spacewalk-repo/spacewalk-client-repo-2.8-11.el7.centos.noarch.rpm yum -y install rhn-client-tools rhn-check rhn-setup rhnsd m2crypto yum-rhn-plugin rhncfg-actions deltarpm wget echo '#!/bin/bash # /usr/sbin/rhn_check' &gt; rhn_check.sh mv rhn_check.sh /etc/cron.hourly/ chmod +x /etc/cron.hourly/rhn_check.sh echo '* * * * * /usr/bin/sh /etc/cron.hourly/rhn_check.sh' &gt;&gt; /var/spool/cron/root /usr/bin/rhn-actions-control --enable-all cd /usr/share/rhn/ wget http://YourServerIPAddress/pub/RHN-ORG-TRUSTED-SSL-CERT rhnreg_ks --serverUrl=http://172.22.64.41/XMLRPC --activationkey=1-xxxxxxxxxxxxxxxxxxxxxxxxxxxx --force</span></span></code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Playbook anisble untuk penyebaran klien:</b> <div class="spoiler_text"><pre> <code class="bash hljs">- hosts: spcwlk-clients tasks: - name: Install spacewalk repo yum: name: https://copr-be.cloud.fedoraproject.org/results/@spacewalkproject/spacewalk-2.8-client/epel-7-x86_64/00742644-spacewalk-repo/spacewalk-client-repo-2.8-11.el7.centos.noarch.rpm state: present - name: Install client packages yum: name: - rhn-client-tools - rhn-check - rhn-setup - rhnsd - m2crypto - yum-rhn-plugin - rhncfg-actions - deltarpm - wget - name: Create cronjob <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> rhn_check cron: name: <span class="hljs-string"><span class="hljs-string">"rhn_check"</span></span> minute: <span class="hljs-string"><span class="hljs-string">"*"</span></span> hour: <span class="hljs-string"><span class="hljs-string">"*"</span></span> day: <span class="hljs-string"><span class="hljs-string">"*"</span></span> month: <span class="hljs-string"><span class="hljs-string">"*"</span></span> weekday: <span class="hljs-string"><span class="hljs-string">"*"</span></span> job: <span class="hljs-string"><span class="hljs-string">"/usr/sbin/rhn_check"</span></span> - name: Enable controls <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> config and remote control deployment shell: /usr/bin/rhn-actions-control --<span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>-all - name: Get certificate from server to client get_url: url: http://YourServerIPAddress/pub/RHN-ORG-TRUSTED-SSL-CERT dest: /usr/share/rhn/ - name: Register client to server rhn_register: state: present server_url: http://YourServerIPAddress/XMLRPC activationkey: <span class="hljs-string"><span class="hljs-string">"{{ activation_key }}"</span></span></code> </pre> <br></div></div><br>  Terima kasih semua sudah membaca artikelnya.  Semoga beruntung </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id435578/">https://habr.com/ru/post/id435578/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id435564/index.html">Menggunakan GtkApplication. Fitur rendering Librsvg</a></li>
<li><a href="../id435568/index.html">Router OpenSource VyOS</a></li>
<li><a href="../id435572/index.html">Anycubic i3 Mega: pembuatan ulang kualitas Prusa i3</a></li>
<li><a href="../id435574/index.html">Bagaimana cara kerja zig?</a></li>
<li><a href="../id435576/index.html">1C, tidak sakit</a></li>
<li><a href="../id435580/index.html">Layanan Java, Spring, Kurento dan Media</a></li>
<li><a href="../id435582/index.html">Bagaimana cara menambahkan indeks pada sistem yang dimuat 24/7 tanpa downtime?</a></li>
<li><a href="../id435584/index.html">Slush 2018. Hari Pertama, Hari Kedua</a></li>
<li><a href="../id435586/index.html">Seni perdukunan atau firmware khusus untuk Olinuxino. Kernel dan Ubuntu Bagian 3</a></li>
<li><a href="../id435588/index.html">Promosi aplikasi seluler dengan pengalaman nyata dalam jumlah</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>