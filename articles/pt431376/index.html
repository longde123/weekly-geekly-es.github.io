<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üôã ü§∂üèø ‚ôíÔ∏è Migra√ß√£o de dados na empresa sangrenta: o que analisar, para n√£o sobrecarregar o projeto üèÇüèª ‚ùóÔ∏è üì™</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Um projeto t√≠pico de integra√ß√£o de sistemas para n√≥s se parece com isso: o cliente possui um transporte de sistemas para clientes de contabilidade, a ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Migra√ß√£o de dados na empresa sangrenta: o que analisar, para n√£o sobrecarregar o projeto</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/hflabs/blog/431376/"><img src="https://habrastorage.org/webt/yk/_w/ry/yk_wry8j7irc6ma2zn65mdw0ulq.jpeg"><br><br>  Um projeto t√≠pico de integra√ß√£o de sistemas para n√≥s se parece com isso: o cliente possui um transporte de sistemas para clientes de contabilidade, a tarefa √© coletar cart√µes de clientes em um √∫nico banco de dados.  E n√£o apenas para coletar, mas tamb√©m para limpar duplicatas e lixo.  Para obter cart√µes de cliente limpos, estruturados e completos. <br><br>  Para iniciantes, explicarei que a migra√ß√£o ocorre de acordo com este esquema: <i>fontes ‚Üí convers√£o de dados (respostas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ETL</a> ou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">bus</a> ) ‚Üí receptor</i> . <br><br>  Em um projeto, perdemos tr√™s meses simplesmente porque uma equipe de integradores de terceiros n√£o estudou os dados nos sistemas de origem.  A coisa mais irritante era que isso poderia ter sido evitado. <br><a name="habracut"></a><br>  Eles trabalharam assim: <br><br><ol><li>  Os integradores de sistemas personalizam o processo ETL. </li><li>  O ETL transforma os dados de origem e os fornece para mim. </li><li>  Estudo descarga e envio erros aos integradores. </li><li>  Os integradores corrigem ETLs e iniciam a migra√ß√£o novamente. </li></ol><br>  No artigo, mostrarei como analisar dados durante a integra√ß√£o do sistema.  Estudei uploads de ETL, foi muito √∫til.  Mas nos dados de origem, as mesmas t√©cnicas acelerariam o trabalho duas vezes. <br><br>  As dicas ser√£o √∫teis para testadores, implementadores de produtos corporativos, integradores de sistemas e analistas.  As recep√ß√µes s√£o universais para bancos de dados relacionais e s√£o totalmente divulgadas em volumes de um milh√£o de clientes. <br><br>  Mas primeiro, sobre um dos principais mitos da integra√ß√£o de sistemas. <br><br><h2>  A documenta√ß√£o e o arquiteto ajudar√£o (na verdade n√£o) </h2><br>  Os integradores geralmente n√£o estudam dados antes da migra√ß√£o - eles economizam tempo.  Eles leem a documenta√ß√£o, examinam a estrutura, conversam com o arquiteto - e isso √© o suficiente.  Depois disso, eles j√° est√£o planejando a integra√ß√£o. <br><br>  Acontece ruim.  Somente a an√°lise mostrar√° o que realmente est√° acontecendo no banco de dados.  Se voc√™ n√£o acessar os dados com mangas arrega√ßadas e uma lupa, a migra√ß√£o ser√° incorreta. <br><br>  <b>A documenta√ß√£o est√° mentindo.</b>  Um sistema corporativo t√≠pico dura de 5 a 20 anos.  Todos esses anos, as mudan√ßas foram documentadas por v√°rios departamentos e contratados.  Cada um com sua pr√≥pria torre sineira.  Portanto, n√£o h√° integridade na documenta√ß√£o, ningu√©m entende completamente a l√≥gica e a estrutura do armazenamento de dados.  Sem mencionar que os prazos est√£o sempre ativos e n√£o h√° tempo suficiente para a documenta√ß√£o. <br><br>  Uma hist√≥ria comum: na tabela de clientes, h√° um campo "SNILS", no papel √© muito importante.  Mas quando olho para os dados, vejo - o campo est√° vazio.  Como resultado, o cliente concorda que a base de destino ficar√° sem um campo para SNILS, pois ainda n√£o h√° dados. <br><br>  Um caso especial de documenta√ß√£o s√£o regulamentos e descri√ß√µes de processos de neg√≥cios: como os dados entram no banco de dados, sob quais circunst√¢ncias e em que formato.  Tudo isso tamb√©m n√£o ajudar√°. <br><br>  <b>Os processos de neg√≥cios s√£o perfeitos apenas no papel.</b>  De manh√£ cedo, a sonolenta operadora Anatoly entra no escrit√≥rio do banco nos arredores de Vyksa.  Debaixo da janela, eles gritaram a noite toda, e pela manh√£ Anatoly brigou com a garota.  Ele odeia o mundo inteiro. <br><br>  Os nervos ainda n√£o foram colocados em ordem e o Anatoly direciona inteiramente o nome do novo cliente para o campo de sobrenome.  Ele se esquece completamente de seu anivers√°rio - o padr√£o "01.01.1900 g" permanece no formul√°rio.  Eu n√£o dou a m√≠nima para as regras quando tudo ao redor √© t√£o enfurecedor !!! <br><br>  O caos conquista processos de neg√≥cios, muito bem proporcionados no papel. <br><br>  <b>Um arquiteto de sistema n√£o sabe tudo.</b>  Trata-se novamente da vener√°vel vida √∫til dos sistemas corporativos.  Ao longo dos anos em que trabalham, os arquitetos mudaram.  Mesmo se voc√™ conversar com o atual, as decis√µes das anteriores ser√£o surpreendentes durante o projeto. <br><br>  E lembre-se: mesmo um arquiteto agrad√°vel, em todos os aspectos, manter√° em segredo suas fraudes e muletas do sistema. <br><br>  A integra√ß√£o "por instrumentos" sem an√°lise de dados √© um erro.  Mostrarei como n√≥s da HFLabs aprendemos os dados atrav√©s da integra√ß√£o do sistema.  No √∫ltimo projeto, analisei apenas os uploads de ETL.  Mas quando o cliente d√° acesso aos dados de origem, eu definitivamente os verifico de acordo com os mesmos princ√≠pios. <br><br><h2>  Campos preenchidos e valores nulos </h2><br>  As verifica√ß√µes mais simples est√£o na integridade das tabelas como um todo e na integridade de campos individuais.  Estou come√ßando com eles. <br><br>  <b>Quantas linhas totais est√£o na tabela.</b>  A solicita√ß√£o mais simples poss√≠vel. <br><br><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COUNT</span></span>(*) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> &lt;table_name&gt;;</code> </pre> <br>  Eu recebo o primeiro resultado. <br><div class="scrollable-table"><table><tbody><tr><th>  Indiv√≠duos </th><th>  Quantidade </th></tr><tr><td>  Total </td><td>  99 966 324 </td></tr></tbody></table></div>  Aqui eu olho para a adequa√ß√£o dos dados.  Se apenas dois milh√µes de clientes chegaram √† descarga de um grande banco, ent√£o algo est√° claramente errado.  Mas enquanto tudo parece como o esperado, seguindo em frente. <br><br>  <b>Quantas linhas s√£o preenchidas para cada campo separadamente.</b>  Verifico todas as colunas da tabela. <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> &lt;column_name&gt;, <span class="hljs-keyword"><span class="hljs-keyword">COUNT</span></span>(*) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> &lt;column_name&gt; cnt <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> &lt;table_name&gt; <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> &lt;column_name&gt; <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>;</code> </pre> <br>  O primeiro se deparou com um campo de feliz anivers√°rio e imediatamente curioso: por algum motivo, os dados n√£o chegaram a todos. <br><div class="scrollable-table"><table><tbody><tr><th>  Indiv√≠duos </th><th>  Quantidade </th></tr><tr><td>  Total </td><td>  99 966 324 </td></tr><tr><td>  DR </td><td>  0 0 </td></tr></tbody></table></div>  Se todos os valores no campo s√£o "NULL" no upload, a primeira coisa que vejo √© o sistema de origem.  Talvez os dados sejam armazenados l√° corretamente, mas eles foram perdidos durante a migra√ß√£o. <br><br>  Vejo que no sistema de origem existem anivers√°rios.  Eu vou para os integradores: pessoal, erro.  Verificou-se que, no processo ETL, a fun√ß√£o de decodifica√ß√£o funcionava incorretamente.  O c√≥digo foi corrigido. No pr√≥ximo upload, verificaremos as altera√ß√µes. <br><br>  Eu vou mais longe no campo com o TIN. <br><div class="scrollable-table"><table><tbody><tr><th>  Indiv√≠duos </th><th>  Quantidade </th></tr><tr><td>  Total </td><td>  99 966 324 </td></tr><tr><td>  DR </td><td>  0 0 </td></tr><tr><td>  TIN </td><td>  65 136 </td></tr></tbody></table></div>  Existem 100 milh√µes de pessoas no banco de dados e apenas 65 mil s√£o preenchidas com NIFs - ou seja, 0,07%.  Uma ocupa√ß√£o t√£o fraca √© um sinal de que o campo na base do receptor pode n√£o ser necess√°rio. <br><br>  Verifico o sistema de origem, est√° tudo correto: os NIFs s√£o semelhantes aos atuais, mas quase n√£o existem.  Portanto, n√£o se trata de migra√ß√£o.  Resta descobrir se o cliente precisa de um campo quase vazio sob o NIF no banco de dados de destino. <br><br>  Cheguei ao sinalizador de remo√ß√£o do cliente. <br><div class="scrollable-table"><table><tbody><tr><th>  Indiv√≠duos </th><th>  Quantidade </th></tr><tr><td>  Total </td><td>  99 966 324 </td></tr><tr><td>  DR </td><td>  0 0 </td></tr><tr><td>  TIN </td><td>  65 136 </td></tr><tr><td>  Excluir sinalizador </td><td>  0 0 </td></tr></tbody></table></div>  Os sinalizadores est√£o vazios.  Mas o que, a empresa n√£o remove clientes?  Eu olho para o sistema de origem, converso com o cliente.  Acontece que sim: a bandeira √© formal, em vez de excluir clientes, suas contas s√£o exclu√≠das.  Nenhuma conta - como se o cliente tivesse sido exclu√≠do. <br><br>  No sistema de destino, √© necess√°rio o sinalizador de cliente remoto, esse √© um recurso da arquitetura.  Portanto, se o cliente tiver zero contas no sistema receptor, ele precisar√° ser fechado por meio de l√≥gica adicional ou nem importado.  Ent√£o, como o cliente decide. <br><br>  Em seguida √© a placa de endere√ßo.  Geralmente, algo est√° errado com essas tabelas, porque os endere√ßos s√£o complicados, eles s√£o inseridos de maneiras diferentes. <br><br>  Verifico a integridade dos componentes do endere√ßo. <br><div class="scrollable-table"><table><tbody><tr><th>  Endere√ßos </th><th>  Quantidade </th></tr><tr><td>  Total </td><td>  254 803 976 </td></tr><tr><td>  Pa√≠s de origem </td><td>  229 256 090 </td></tr><tr><td>  √çndice </td><td>  46 834 777 </td></tr><tr><td>  Cidade </td><td>  6 474 841 </td></tr><tr><td>  Rua </td><td>  894.040 </td></tr><tr><td>  Casa </td><td>  20 903 </td></tr></tbody></table></div>  Os endere√ßos n√£o s√£o preenchidos de maneira uniforme, mas √© muito cedo para tirar conclus√µes: primeiro perguntarei ao cliente para que ele serve.  Se a segmenta√ß√£o por pa√≠s estiver correta, h√° dados suficientes.  Se para listas de discuss√£o, o problema √©: as casas est√£o quase vazias, n√£o h√° apartamentos. <br><br>  Como resultado, o cliente viu que o ETL estava recebendo endere√ßos de um tablet antigo e irrelevante.  Ela est√° na base como um monumento.  Mas h√° outra tabela, nova e boa, os dados devem ser retirados dela. <br><br>  Durante a an√°lise, preencheu os campos vinculados aos diret√≥rios com particularidade.  A condi√ß√£o "IS NOT NULL" n√£o funciona com eles: em vez de "NULL", a c√©lula geralmente √© "0".  Portanto, verifique os campos de refer√™ncia separadamente. <br><br>  <b>Mudan√ßas no preenchimento de campos.</b>  Portanto, verifiquei a ocupa√ß√£o geral e a ocupa√ß√£o de cada campo.  Problemas encontrados, integradores corrigiram o processo ETL e iniciaram a migra√ß√£o novamente. <br><br>  Executo o segundo descarregamento para todas as etapas listadas acima.  Eu escrevo estat√≠sticas no mesmo arquivo para ver as altera√ß√µes. <br><br>  Completude de todos os campos. <br><div class="scrollable-table"><table><tbody><tr><th>  Indiv√≠duos </th><th>  Descarregar 1 </th><th>  Descarregando 2 </th><th>  Delta </th></tr><tr><td>  Total </td><td>  99 966 324 </td><td>  94 847 160 </td><td>  -5 119 164 </td></tr></tbody></table></div>  Entre os envios, 5 milh√µes de registros desapareceram.  Vou aos integradores, fa√ßo perguntas t√≠picas: <br><br><ul><li>  ‚ÄúPor que os registros foram perdidos?‚Äù; </li><li>  "Quais dados foram rastreados?"; </li><li>  "Quais dados voc√™ deixou?" </li></ul><br>  Acontece que n√£o h√° problema: eles simplesmente removeram os clientes "t√©cnicos" da nova descarga.  Eles est√£o no banco de dados para testes, n√£o s√£o pessoas vivas.  Mas com a mesma probabilidade, os dados podem ser perdidos por engano, isso acontece. <br><br>  Mas os anivers√°rios da nova descarga apareceram, como eu esperava. <br><div class="scrollable-table"><table><tbody><tr><th>  Indiv√≠duos </th><th>  Descarregar 1 </th><th>  Descarregando 2 </th><th>  Delta </th></tr><tr><td>  Total </td><td>  99 966 324 </td><td>  94 847 160 </td><td>  -5 119 164 </td></tr><tr><td>  DR </td><td>  0 0 </td><td>  77 046 780 </td><td>  77 046 780 </td></tr></tbody></table></div>  Mas!  N√£o √© necessariamente bom quando dados ausentes anteriormente apareceram repentinamente em um novo upload.  Por exemplo, os anivers√°rios podem ser preenchidos com datas padr√£o - n√£o h√° nada para se alegrar.  Portanto, eu sempre verifico quais dados vieram. <br><br>  <i>O que verificar, em poucas palavras.</i> <i><br><br></i> <ol><li>  <i>O n√∫mero total de entradas nas tabelas.</i>  <i>Essa quantidade √© adequada √†s expectativas?</i> </li><li>  <i>O n√∫mero de linhas preenchidas em cada campo.</i> </li><li>  <i>A propor√ß√£o do n√∫mero de linhas preenchidas em cada campo para o n√∫mero de linhas na tabela.</i>  <i>Se for muito pequeno, √© uma ocasi√£o para pensar em arrastar o campo para a base de destino.</i> </li></ol> <i><br></i>  <i>Repita as tr√™s primeiras etapas para cada upload.</i>  <i>Siga a din√¢mica: onde e por que aumentou ou diminuiu.</i> <br><br><h2>  Comprimento dos valores nos campos de sequ√™ncia </h2><br>  Sigo uma das regras b√°sicas de teste - verifico os valores dos limites. <br><br>  <b>Quais valores s√£o muito curtos.</b>  Entre os valores mais curtos est√° o lixo, por isso √© interessante cavar aqui. <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> &lt;table_name&gt; <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LENGTH</span></span>(&lt;column_name&gt;) &lt; <span class="hljs-number"><span class="hljs-number">3</span></span>;</code> </pre> <br>  Dessa forma, verifico o nome, n√∫mero de telefone, TIN, OKVED, endere√ßos de sites.  Um absurdo aparece como "A * 1", "0", "11", "-" e "...". <br><br>  <b>Est√° tudo bem com os valores m√°ximos.</b>  O campo Fechar √© um marcador do fato de que os dados n√£o se ajustaram durante a transfer√™ncia e foram cortados automaticamente.  O MySQL resolve isso de maneira famosa sem aviso pr√©vio.  Ao mesmo tempo, parece que a migra√ß√£o ocorreu sem problemas. <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> &lt;table_name&gt; <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LENGTH</span></span>(&lt;column_name&gt;) = <span class="hljs-number"><span class="hljs-number">65</span></span>;</code> </pre> <br>  Dessa forma, encontrei no campo com o tipo de documento a linha "Certificado de registro do pedido de reconhecimento do imigrante".  Ela disse aos integradores que o comprimento do campo foi corrigido. <br><br>  <b>Como os valores s√£o distribu√≠dos ao longo do comprimento.</b>  Nos HFLabs, chamamos a tabela de distribui√ß√£o de comprimento para as linhas. <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LENGTH</span></span>(&lt;column_name&gt;), <span class="hljs-keyword"><span class="hljs-keyword">COUNT</span></span>(&lt;column_name&gt;) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> &lt;table_name&gt; <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LENGTH</span></span>(&lt;column_name&gt;);</code> </pre> <br>  Aqui, procuro anomalias na distribui√ß√£o ao longo do comprimento.  Por exemplo, aqui est√° uma frequ√™ncia para uma tabela com endere√ßos para correspond√™ncia. <br><div class="scrollable-table"><table><tbody><tr><th>  Comprimento </th><th>  Quantidade </th></tr><tr><td>  122 </td><td>  120 </td></tr><tr><td>  123 </td><td>  90 </td></tr><tr><td>  124 </td><td>  130 </td></tr><tr><td>  125 </td><td>  1100 </td></tr><tr><td>  126 </td><td>  70 </td></tr></tbody></table></div>  Valores com um comprimento de 125 s√£o muitos.  Olho para o banco de dados de origem e acho que, por algum motivo, alguns dos endere√ßos foram cortados para 125 caracteres h√° tr√™s anos.  Em outros anos, est√° tudo bem.  Eu vou com esse problema para o cliente e integradores, entendemos. <br><br>  <i>O que verificar, em poucas palavras.</i> <i><br><br></i> <ol><li>  <i>Os valores mais curtos nos campos de sequ√™ncia.</i>  <i>Muitas vezes, linhas com menos de tr√™s caracteres s√£o lixo.</i> </li><li>  <i>Valores que se limitam ao longo da largura do campo.</i>  <i>Muitas vezes eles s√£o circuncidados.</i> </li><li>  <i>Anomalias na distribui√ß√£o de linhas ao longo do comprimento.</i> </li></ol><br><h2>  Valores Populares </h2><br>  Divido em tr√™s categorias os valores que se enquadram no top popular: <br><br><ul><li>  <i>muito comum</i> , como o nome "Tatyana" ou o nome do meio "Vladimirovich".  Aqui deve ser lembrado que, no caso geral, Tatyana n√£o deve ser 100 vezes mais popular que Anna e Ismail dificilmente pode ser mais popular que Egor; </li><li>  <i>lixo</i> , como ".", "1", "-" e similares; </li><li>  <i>Padr√£o</i> no formul√°rio de entrada, como "01/01/1900" para datas. </li></ul><br>  Dois em cada tr√™s casos s√£o marcadores do problema, √© √∫til procur√°-los. <br><br>  Eu procuro valores populares em tr√™s tipos de campos: <br><br><ol><li>  Campos de string comuns. </li><li>  Campos da string de refer√™ncia.  Esses s√£o campos de string comuns, mas √© claro que o n√∫mero de valores diferentes neles √© regulado.  Esses campos armazenam pa√≠ses, cidades, meses, tipos de telefone. </li><li>  Campos do classificador - eles cont√™m um link para uma entrada em uma tabela do classificador de terceiros. </li></ol><br>  Estudo os campos de cada um desses tipos de maneira um pouco diferente. <br><br>  <b>Para campos de sequ√™ncia - quais s√£o os 100 principais valores populares.</b>  Se voc√™ quiser, pode pegar mais, mas nos primeiros cem valores todas as anomalias s√£o geralmente colocadas. <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> &lt;column_name&gt;, <span class="hljs-keyword"><span class="hljs-keyword">COUNT</span></span>(*) cnt <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> &lt;table_name&gt; <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> &lt;column_name&gt; <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ROWNUM</span></span> &lt;= <span class="hljs-number"><span class="hljs-number">100</span></span>;</code> </pre> <br>  Verifico os campos desta maneira: <br><br><ul><li>  Nome completo, bem como sobrenomes, nomes e patron√≠micos separados; </li><li>  datas de nascimento e geralmente quaisquer datas; </li><li>  endere√ßos  O endere√ßo completo e seus componentes individuais, se eles estiverem armazenados no banco de dados; </li><li>  Telefones </li><li>  s√©rie, n√∫mero, tipo, local de emiss√£o dos documentos. </li></ul><br>  Quase sempre entre os populares - valores padr√£o e de teste, alguns stubs. <br><br><img src="https://habrastorage.org/webt/hl/sg/cr/hlsgcrpcy9y1i-gpyfoead8byzg.png"><br><br>  Acontece que o problema encontrado n√£o √© um problema.  Certa vez, encontrei um n√∫mero de telefone suspeito e popular no banco de dados.  Os clientes indicaram esse n√∫mero como trabalhador e, no banco de dados, havia simplesmente muitos funcion√°rios de uma organiza√ß√£o. <br><br>  Ao longo do caminho, essa an√°lise mostrar√° campos de refer√™ncia ocultos.  Logicamente, esses campos n√£o devem ser diret√≥rios, mas na verdade eles est√£o no banco de dados.  Por exemplo, seleciono valores populares no campo "Posi√ß√£o" e existem apenas cinco deles. <br><div class="scrollable-table"><table><tbody><tr><th>  Cargo </th></tr><tr><td>  Diretor </td></tr><tr><td>  Contador </td></tr><tr><td>  Especialista </td></tr><tr><td>  Secret√°ria </td></tr><tr><td>  Administrador do sistema </td></tr></tbody></table></div>  Talvez a empresa atenda apenas cinco profiss√µes.  N√£o √© muito verdade, certo?  Em vez disso, no formul√°rio para os operadores, em vez de uma linha, eles criaram um diret√≥rio e esqueceram de despejar valores.  A quest√£o importante aqui √©: √© aconselh√°vel preencher posts atrav√©s do diret√≥rio?  Assim, atrav√©s da an√°lise de dados, resolvo poss√≠veis problemas com o software do operador. <br><br>  <b>Para campos de refer√™ncia e classificadores, verifico a popularidade de todos os valores.</b>  Para come√ßar, descubro quais campos s√£o diret√≥rios.  Voc√™ n√£o pode se dar bem com scripts, eu pego a documenta√ß√£o e finjo que sou.  Normalmente, os diret√≥rios s√£o criados para valores, cujo n√∫mero √© claro e relativamente pequeno: <br><br><ul><li>  pa√≠ses </li><li>  l√≠nguas </li><li>  moedas </li><li>  meses </li><li>  a cidade </li></ul><br>  Em um mundo ideal, o conte√∫do dos campos de refer√™ncia √© claro e consistente.  Mas nosso mundo n√£o √© assim, ent√£o eu verifico com um pedido. <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> &lt;column_name&gt;, <span class="hljs-keyword"><span class="hljs-keyword">COUNT</span></span>(*) cnt <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> &lt;table_name&gt; <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> &lt;column_name&gt; <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span>;</code> </pre> <br>  Geralmente, nos campos de string dos diret√≥rios, fica isso. <br><div class="scrollable-table"><table><tbody><tr><th>  Local de nascimento </th><th>  Quantidade </th></tr><tr><td>  tajiquist√£o </td><td>  467 599 </td></tr><tr><td>  Tajiquist√£o </td><td>  410 484 </td></tr><tr><td>  R√∫ssia </td><td>  292.585 </td></tr><tr><td>  TAJIQUIST√ÉO </td><td>  234.465 </td></tr><tr><td>  R√∫ssia </td><td>  158 163 </td></tr><tr><td>  R√öSSIA </td><td>  76 367 </td></tr></tbody></table></div>  Problemas comuns: <br><br><ul><li>  erros de digita√ß√£o; </li><li>  espa√ßos </li><li>  caso diferente. </li></ul><br>  Tendo encontrado uma bagun√ßa, vou aos integradores com exemplos √† m√£o.  Deixe-os deixar lixo na fonte e elimine as discrep√¢ncias.  Ent√£o, no banco de dados de destino, por rigor, ser√° poss√≠vel transformar as linhas de refer√™ncia em classificadores. <br><br>  Verifico os valores populares nos campos do classificador para detectar a falta de op√ß√µes.  Diante de tais casos. <br><div class="scrollable-table"><table><tbody><tr><th>  Sexo </th><th>  Tipo de telefone </th></tr><tr><td><ol><li>  Feminino </li><li>  N√£o definido </li></ol></td><td><ol><li>  P√°gina inicial </li></ol></td></tr></tbody></table></div>  Esses classificadores parecem muito estranhos, devem ser mostrados ao cliente.  Toda vez que havia um erro por tr√°s desses casos: algo estava errado no banco de dados ou os dados foram baixados do local errado. <br><br>  <i>O que verificar, em poucas palavras.</i> <i><br><br></i> <ol><li>  <i>Quais campos de sequ√™ncia s√£o refer√™ncia e quais n√£o s√£o.</i> </li><li>  <i>Para campos de sequ√™ncia simples, os principais valores populares.</i>  <i>Geralmente no lixo superior e nos dados padr√£o.</i> </li><li>  <i>Para campos de refer√™ncia de cadeia, a distribui√ß√£o de todos os valores por popularidade.</i>  <i>A sele√ß√£o mostrar√° discrep√¢ncias nos valores de refer√™ncia.</i> </li><li>  <i>Para classificadores - existem op√ß√µes suficientes no banco de dados.</i> </li></ol><br><h2>  Consist√™ncia e reconcilia√ß√£o cruzada </h2><br>  A partir da an√°lise de dados dentro de tabelas, recorro √† an√°lise de relacionamentos. <br><br>  <b>Se os dados devem estar relacionados.</b>  Chamamos esse par√¢metro de "consist√™ncia".  Pego a mesa subordinada, por exemplo, com telefones.  Para ele em um par - a tabela pai de clientes.  E vejo quantos clientes na tabela subordinada s√£o identificadores que n√£o est√£o no pai. <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COUNT</span></span>(*) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> ((<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> &lt;ID1&gt; <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> &lt;table_name_1&gt;) <span class="hljs-keyword"><span class="hljs-keyword">MINUS</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> &lt;ID2&gt; <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> &lt;table_name_2&gt;));</code> </pre> <br>  Se a solicita√ß√£o deu um delta, isso significa que n√£o h√° sorte - h√° dados n√£o relacionados no upload.  Ent√£o eu checo as tabelas com telefones, contratos, endere√ßos, contas e assim por diante.  Uma vez, durante um projeto, ela encontrou 23 milh√µes de n√∫meros que simplesmente pairavam no ar. <br><br>  Tamb√©m funciona na dire√ß√£o oposta - procuro clientes que, por algum motivo, n√£o tenham um √∫nico contrato, endere√ßo e n√∫mero de telefone.  √Äs vezes, tudo bem - bem, o cliente n√£o tem um endere√ßo.  Aqui voc√™ precisa descobrir com o cliente, a documenta√ß√£o enganar√° facilmente. <br><br>  <b>Existem duplica√ß√µes de chaves prim√°rias em tabelas diferentes.</b>  √Äs vezes, entidades id√™nticas s√£o armazenadas em tabelas diferentes.  Por exemplo, clientes heterossexuais.  (Ningu√©m sabe o motivo, porque Brezhnev ainda reivindicou a estrutura.) Mas a tabela no receptor √© √∫nica e, ao migrar, os identificadores de clientes entram em conflito. <br><br>  Viro a cabe√ßa e olho para a estrutura da base: onde √© poss√≠vel a fragmenta√ß√£o de entidades semelhantes.  Pode ser tabelas de clientes, telefones de contato, passaportes e assim por diante. <br><br>  Se houver v√°rias tabelas com entidades semelhantes, fa√ßo uma verifica√ß√£o cruzada: verifico a interse√ß√£o de identificadores.  Interse√ß√£o - cole um adesivo.  Por exemplo, coletamos identificadores para uma √∫nica tabela de acordo com o esquema "nome da tabela de origem + ID". <br><br>  <i>O que verificar, em poucas palavras.</i> <i><br><br></i> <ol><li>  <i>Quantos dados n√£o relacionados existem em tabelas vinculadas.</i> </li><li>  <i>Existem poss√≠veis conflitos de chave prim√°ria?</i> </li></ol><br><h2>  O que mais para verificar </h2><br>  <b>Existem caracteres latinos nos quais eles n√£o pertencem.</b>  Por exemplo, sobrenomes. <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> &lt;column_name&gt; <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> &lt;table_name&gt; <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">REGEXP_LIKE</span></span>(&lt;column_name&gt;, <span class="hljs-string"><span class="hljs-string">'[AZ]'</span></span>, <span class="hljs-string"><span class="hljs-string">'i'</span></span>);</code> </pre> <br>  Ent√£o eu pego a maravilhosa letra latina "C", que coincide com a cir√≠lica.  O erro √© desagrad√°vel, porque de acordo com o nome com o latim "C" o operador nunca encontrar√° um cliente. <br><br>  <b>Existem caracteres estranhos nos campos de string destinados a n√∫meros?</b> <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> &lt;column_name&gt; <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> &lt;table_name&gt; <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">REGEXP_LIKE</span></span>(&lt;column_name&gt;, <span class="hljs-string"><span class="hljs-string">'[^0-9]'</span></span>);</code> </pre> <br>  Os problemas aparecem nos campos com o n√∫mero do passaporte da Federa√ß√£o Russa ou TIN.  Os telefones s√£o os mesmos, mas eu permito mais, colchetes e h√≠fens.  A solicita√ß√£o tamb√©m revelar√° a letra "O", que foi definida em vez de zero. <br><br>  <b>Qu√£o adequados s√£o os dados.</b>  Voc√™ nunca sabe onde o problema surgir√°, por isso estou sempre em guarda.  Eu conheci esses casos: <br><br><ul><li>  <i>Sofya Vladimirovna √© um cliente com 50.000 telefones - isso √© normal?</i>  Resposta: n√£o normal.  O cliente √© t√©cnico, eles colocam n√∫meros de telefone "sem dono" nele para enviar mensagens sms.  N√£o √© necess√°rio puxar o cliente para uma nova base; </li><li>  <i>O n√∫mero de identifica√ß√£o do contribuinte √© preenchido; na verdade, a coluna cont√©m "79853617764", "89109462345", "4956780966" e assim por diante.</i>  Que tipo de telefone, okuda?  Cad√™ a pousada?  Resposta: que tipo de n√∫meros - n√£o se sabe quem os colocou - n√£o √© claro.  Ningu√©m os usa.  O TIN atual √© armazenado em outro campo de outra tabela, retirado de l√°; </li><li>  <i>o campo "endere√ßo em uma linha" n√£o corresponde aos campos em que o endere√ßo est√° armazenado em partes.</i>  Por que os endere√ßos s√£o diferentes?  Resposta: quando os operadores preencherem os endere√ßos com uma linha e o sistema externo classificar os endere√ßos em campos separados.  Para segmenta√ß√£o.  Com o passar do tempo, as pessoas mudaram de endere√ßo.  Os operadores os atualizavam regularmente, mas apenas como uma sequ√™ncia: o endere√ßo permanecia antigo em partes. </li></ul><br><h2>  Tudo que voc√™ precisa √© SQL e Excel </h2><br>  Para analisar dados, n√£o √© necess√°rio um software caro.  Excel suficiente e antigo e conhecimento de SQL. <br><br>  Excel que eu uso para compilar uma consulta longa.  Por exemplo, verifico se os campos est√£o completos e h√° 140. Na tabela, escreverei com as m√£os antes da conspira√ß√£o da cenoura, para coletar a solicita√ß√£o com as f√≥rmulas no excel-plate. <br><br><img src="https://habrastorage.org/webt/ww/m3/br/wwm3br0qxpp7gudattxhkxnx1fm.png"><br>  <sub>Na coluna ‚ÄúA‚Äù, insiro os nomes dos campos, os levo na documenta√ß√£o ou nas tabelas de servi√ßo.</sub>  <sub>Na coluna "B" - uma f√≥rmula para colar uma solicita√ß√£o</sub> <br><br>  Eu insiro os nomes dos campos, escrevo a primeira f√≥rmula na coluna "B", puxo a esquina - e pronto. <br><br><img src="https://habrastorage.org/webt/1r/ld/ct/1rldctxhypv2xw3era05-lkixhu.gif"><br>  <sub>Funciona no Excel, no Google Docs e no Excel Online (dispon√≠vel no Yandex.Disk)</sub> <br><br>  A an√°lise de dados economiza o tempo e os nervos dos gerentes.  Com isso, √© mais f√°cil cumprir o prazo.  Se o projeto for grande, a an√°lise economizar√° milh√µes de rublos e uma reputa√ß√£o. <br><br><h2>  N√£o n√∫meros, mas conclus√µes </h2><br>  Ela formulou uma regra para si mesma: para n√£o mostrar n√∫meros simples para o cliente, voc√™ ainda n√£o ter√° o efeito.  Minha tarefa √© analisar os dados e tirar conclus√µes e anexar os n√∫meros como evid√™ncia.  As conclus√µes s√£o prim√°rias, os n√∫meros s√£o secund√°rios. <br><br>  O que eu coleciono para o relat√≥rio: <br><br><ul><li>  <i>a reda√ß√£o dos problemas na forma de uma hip√≥tese ou pergunta</i> : ‚ÄúO NTI √© preenchido em 0,07%.  Como voc√™ usa esses dados, qual √© a relev√¢ncia, como interpret√°-los?  Existe apenas um DCI em uma tabela? ‚Äù  Voc√™ n√£o pode culpar: "O seu NIF n√£o est√° cheio."  Em resposta, voc√™ receber√° apenas agress√£o; </li><li>  <i>exemplos de problemas.</i>  Essas s√£o as t√°buas das quais existem tantas no artigo; </li><li>  <i>Op√ß√µes de como faz√™-lo:</i> "Pode valer a pena remover o NIF da base de destino para n√£o produzir campos vazios". </li></ul><br>  N√£o tenho o direito de decidir o que exatamente escolher no banco de dados de origem e como alterar os dados durante a migra√ß√£o.  Portanto, com o relat√≥rio, vou ao cliente ou aos integradores e descobrimos como proceder. <br><br>  √Äs vezes, o cliente, vendo o problema, responde: ‚ÄúN√£o se preocupe, n√£o preste aten√ß√£o.  Compraremos um terabyte extra de mem√≥ria, s√≥ isso.  √â mais barato do que otimizar. "  Voc√™ n√£o pode concordar com isso: se voc√™ pegar tudo em sequ√™ncia, n√£o haver√° qualidade no receptor.  Todos os mesmos dados redundantes de lixo est√£o sendo migrados. <br><br>  Portanto, pedimos gentilmente, mas com firmeza: "Diga-nos como voc√™ usar√° esses dados espec√≠ficos no sistema de destino".  N√£o "por que voc√™ precisa", ou seja, "como voc√™ usar√°".  As respostas "ent√£o apresentaremos" ou "apenas no caso" n√£o s√£o adequadas.  Cedo ou tarde, o cliente entende quais dados podem ser dispensados. <br><br>  O principal √© encontrar e resolver todos os problemas at√© que o sistema seja lan√ßado no prod.  Para mudar a arquitetura e o modelo de dados em tempo real, voc√™ ficar√° louco. <br><br>  Isso √© tudo com verifica√ß√µes b√°sicas, estude os dados! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt431376/">https://habr.com/ru/post/pt431376/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt431360/index.html">Explicar a backdoor no fluxo de eventos</a></li>
<li><a href="../pt431362/index.html">Como um designer pode se livrar da rotina e manter o interesse em seu trabalho?</a></li>
<li><a href="../pt431370/index.html">Os relat√≥rios mais r√°pidos no oeste selvagem. E um punhado de bugs al√©m disso ...</a></li>
<li><a href="../pt431372/index.html">Interrompe dispositivos externos em um sistema x86. Parte 2. Op√ß√µes de inicializa√ß√£o do kernel do Linux</a></li>
<li><a href="../pt431374/index.html">√öltimo julgamento: an√°lise dos indicadores financeiros do jogo no acesso antecipado</a></li>
<li><a href="../pt431378/index.html">Toda a verdade sobre o RTOS. Artigo 23. Filas: introdu√ß√£o e servi√ßos b√°sicos</a></li>
<li><a href="../pt431380/index.html">Mitap Netologiya e Skyeng sobre soft skills ‚ÄúO que um desenvolvedor precisa saber, exceto c√≥digo‚Äù</a></li>
<li><a href="../pt431382/index.html">Resultados da Pesquisa de Ecossistemas da JVM</a></li>
<li><a href="../pt431388/index.html">O mundo atrav√©s dos olhos de um carro. Como os drones o veem?</a></li>
<li><a href="../pt431390/index.html">Tend√™ncias digitais de 2019 e seu impacto na mudan√ßa de comportamento do consumidor</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>