<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§¥üèΩ üë≤üèæ ü§© Identifica√ß√£o de endere√ßos IP reais dos usu√°rios da rede Tor atrav√©s de um cache distorcido üì∂ üë©üèø‚Äçü§ù‚Äçüë®üèº ü§πüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Este artigo descreve um exemplo da aplica√ß√£o pr√°tica do ataque "distor√ß√£o de cache atrav√©s do redirecionamento 301", que pode ser usado pelo n√≥ de sa√≠...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Identifica√ß√£o de endere√ßos IP reais dos usu√°rios da rede Tor atrav√©s de um cache distorcido</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/vds/blog/456896/"><img src="https://habrastorage.org/getpro/habr/post_images/e0e/20c/130/e0e20c13066a38bd4c0c81d1d60de6db.jpg" alt="imagem"><br><br>  Este artigo descreve um exemplo da aplica√ß√£o pr√°tica do ataque "distor√ß√£o de cache atrav√©s do redirecionamento 301", que pode ser usado pelo n√≥ de sa√≠da da rede Tor com c√≥digo malicioso para identificar os endere√ßos IP reais dos usu√°rios selecionados. <br><a name="habracut"></a><br><h4>  Cen√°rio de ataque </h4><br>  O cen√°rio de ataque √© o seguinte: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://player.vimeo.com/video/337756409" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><ul><li>  Cliente: Chrome Canary (76.0.3796.0) </li><li>  IP do cliente real: 5.60.164.177 </li><li>  Par√¢metro de rastreamento do cliente: 6b48c94a-cf58-452c-bc50-96bace981b27 </li><li>  Endere√ßo IP do n√≥ de sa√≠da da rede Tor: 51.38.150.126 </li><li>  Proxy Reverso Transparente: tor.modlishka.io (Modlishka - c√≥digo atualizado a ser lan√ßado.) </li></ul><br>  Nota: Nesse cen√°rio, o navegador Chrome foi configurado atrav√©s do protocolo de rede SOCKS5 para usar a rede Tor.  O canal Tor foi sintonizado para um n√≥ de sa√≠da de teste espec√≠fico: '51 .38.150.126 '.  √â tamb√©m uma valida√ß√£o do conceito e muitas configura√ß√µes podem ser otimizadas no futuro ... <br><br>  No caso de um n√≥ de sa√≠da malicioso da rede Tor, todo o tr√°fego √© redirecionado atrav√©s do servidor proxy Modlishka: <br><br><pre><code class="bash hljs">iptables -A OUTPUT -p tcp -m tcp --dport 80 -j DNAT --to-destination ip_address:80 iptables -A FORWARD -j ACCEPT</code> </pre> <br><iframe width="560" height="315" src="https://www.youtube.com/embed/.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://player.vimeo.com/video/339586722" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h4>  Descri√ß√£o do cen√°rio de ataque </h4><br>  Pressupostos: <br><br><ul><li>  Um aplicativo de navegador (neste caso, um navegador padr√£o) que usar√° a conex√£o de rede ‚ÄúTor‚Äù e, finalmente, a conex√£o passar√° por um n√≥ de sa√≠da malicioso. </li><li>  O n√≥ de sa√≠da malicioso da rede Tor, que intercepta e distorce o cache de todo o tr√°fego HTTP (c√≥digo de resposta "HTTP 301"), que n√£o possui um protocolo criptogr√°fico de seguran√ßa da camada de transporte ("TLS"). </li></ul><br><img src="https://habrastorage.org/webt/4b/kl/6d/4bkl6damygrn1rnfce9fxujbeny.png"><br><br>  Vejamos as seguintes etapas de um cen√°rio de ataque: <br><br><ol><li>  O usu√°rio se conecta √† Internet atrav√©s da rede Tor configurando o navegador para usar o protocolo de rede SOCKS5 do sistema Tor ou configurando para que todo o tr√°fego do sistema operacional seja redirecionado atrav√©s da rede Tor. </li><li>  O usu√°rio inicia sua sess√£o normal de acesso √† Internet usando seu navegador favorito, onde geralmente muito tr√°fego HTTP sem o protocolo de seguran√ßa TLS √© enviado atrav√©s do t√∫nel da rede Tor. </li><li>  O n√≥ de sa√≠da malicioso da rede Tor intercepta solicita√ß√µes e responde encaminhando cada uma delas usando o c√≥digo de resposta HTTP 301.  Esses redirecionamentos ser√£o constantemente armazenados em cache pelo navegador e ser√£o enviados para o URL de rastreamento com o identificador de cliente Tor atribu√≠do.  O URL de rastreamento pode ser criado da seguinte maneira: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">user-identifier.evil.tld</a> , em que 'evil.tld' coletar√° todas as informa√ß√µes sobre o endere√ßo IP de origem e redirecionar√° os usu√°rios para os hosts solicitados originalmente ... ou, alternativamente, para o reverso transparente um servidor proxy que tentar√° interceptar todo o fluxo subsequente do tr√°fego do cliente HTTP.  Al√©m disso, como √© poss√≠vel distorcer automaticamente o cache da maioria dos dom√≠nios mais populares (como descrito em um artigo anterior), por exemplo,  100 melhores sites de acordo com as estat√≠sticas da empresa ¬´Alexa¬ª, o invasor maximiza suas chances de identificar endere√ßos IP reais. </li><li>  Depois de sair da sess√£o de rede Tor, o usu√°rio passar√° para a rede normal. </li><li>  Assim que o usu√°rio digita o endere√ßo de um dos dom√≠nios distorcidos anteriores na barra de endere√ßos (por exemplo, "google.com"), o navegador usa o cache para redirecionamento interno para a URL de rastreamento com o identificador de contexto do n√≥ de sa√≠da. </li><li>  O host de sa√≠da poder√° corresponder a solicita√ß√£o HTTP interceptada anteriormente com o endere√ßo IP real do usu√°rio usando as informa√ß√µes recebidas de um host externo que usou a URL de rastreamento com o ID do usu√°rio.  O host evil.tld ter√° informa√ß√µes sobre todos os endere√ßos IP que foram usados ‚Äã‚Äãpara acessar o URL de rastreamento. </li></ol><br>  Obviamente, esse m√©todo permite combinar com efici√™ncia solicita√ß√µes HTTP selecionadas com endere√ßos IP do cliente usando o n√≥ de sa√≠da da rede Tor.  Isso acontece porque a URL de rastreamento gerada anteriormente ser√° solicitada pelo cliente atrav√©s do t√∫nel de rede ‚ÄúTor‚Äù e, novamente, assim que a conex√£o for feita atrav√©s da conex√£o padr√£o do provedor de Internet.  √â tudo por causa do c√≥digo ileg√≠vel no cache. <br><br>  Outra abordagem pode ser baseada na introdu√ß√£o de c√≥digo JavaScript modificado com URLs incorporados para rastreamento nas respostas correspondentes que n√£o possuem o protocolo de seguran√ßa TLS e altera√ß√£o dos cabe√ßalhos de cache de controle necess√°rios (por exemplo, 'Cache-Control: max-age = 31536000') .  No entanto, essa abordagem n√£o √© muito eficaz. <br><br>  Tamb√©m √© poss√≠vel rastrear usu√°rios atrav√©s dos cookies padr√£o de v√°rios aplicativos da Web, mas √© muito dif√≠cil for√ßar o cliente a visitar o dom√≠nio que est√° sob o controle do invasor duas vezes: primeiro, ao conectar-se atrav√©s do n√≥ de sa√≠da da rede Tor e depois novamente ap√≥s alternar para a conex√£o de Internet padr√£o fornecedor. <br><br><h4>  Conclus√µes </h4><br>  O fato √© que um invasor tem a capacidade de obter certas altera√ß√µes no cache do navegador injetando c√≥digo malformado atrav√©s de n√≥s de sa√≠da maliciosos e detectando os endere√ßos IP reais dos usu√°rios do Tor que enviam tr√°fego HTTP sem o protocolo de seguran√ßa TLS. <br><br>  Al√©m disso, a distor√ß√£o de um n√∫mero significativo de nomes de dom√≠nio populares aumentar√° a probabilidade de receber uma resposta inversa de uma solicita√ß√£o HTTP (com um ID de usu√°rio atribu√≠do), que determinar√° o endere√ßo IP real do usu√°rio.  Voc√™ pode tentar interceptar o dom√≠nio de alguns clientes do navegador e esperar que um erro de digita√ß√£o no nome do dom√≠nio n√£o seja notado pelo usu√°rio ou n√£o seja exibido (por exemplo, o aplicativo m√≥vel WebViews). <br><br>  Maneiras de reduzir o risco: <br><br><ul><li>  Ao conectar-se √† Internet pela rede Tor, verifique se todo o tr√°fego que n√£o usa o protocolo de seguran√ßa TLS est√° desabilitado.  Um exemplo de plugins de navegador que podem ser usados: para navegadores Firefox ‚Äùe‚Äú Chrome ‚Äù. </li><li>  Al√©m disso, sempre use o modo de navegador ‚Äúprivado‚Äù ao conectar-se √† Internet atrav√©s da rede Tor. </li><li>  N√£o redirecione o tr√°fego para todo o sistema operacional atrav√©s da rede Tor at√© ter certeza de que todo o tr√°fego de sa√≠da usa o protocolo de seguran√ßa TLS ... </li><li>  Sempre que poss√≠vel, use a vers√£o mais recente do navegador Tor para navegar na web. </li></ul><br><hr><br>  As configura√ß√µes mais recentes de dois processadores de servidores dedicados com os processadores Intel Scalable 2019 est√£o dispon√≠veis no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><b>DEDIC.SH</b></a> : <br><br><ul><li>  2x Xeon Silver 4214 - um total de 24 n√∫cleos </li><li>  2x Xeon Gold 5218 - um total de 32 n√∫cleos </li><li>  2x Xeon Gold 6240 - configura√ß√£o com 36 n√∫cleos. </li></ul><br>  O custo de um servidor com dois Xeon Silver 4214 - a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><b>partir de 15210 rublos / m√™s</b></a> <br>  Tamb√©m estamos prontos para coletar <b>qualquer configura√ß√£o</b> para voc√™ - <b><a href="">escreva-nos</a></b> ! <br><br>  Se n√£o s√£o necess√°rias grandes pot√™ncias de um servidor dedicado - √© necess√°rio o <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">VDS de 150 rublos / m√™s</a></b> ! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt456896/">https://habr.com/ru/post/pt456896/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt456886/index.html">ASO Checklist: Como n√£o perder nada</a></li>
<li><a href="../pt456888/index.html">Como os sat√©lites se derretem na atmosfera da Terra</a></li>
<li><a href="../pt456890/index.html">Controle remoto IR em stm32</a></li>
<li><a href="../pt456892/index.html">Como procurar vulnerabilidades de aplicativos da Web: comparando oito scanners populares</a></li>
<li><a href="../pt456894/index.html">Docker e autentica√ß√£o atrav√©s do Nginx</a></li>
<li><a href="../pt456898/index.html">R√°pida multiplica√ß√£o de n√∫meros inteiros usando tabelas</a></li>
<li><a href="../pt456902/index.html">Notifica√ß√µes push seguras: da teoria √† pr√°tica</a></li>
<li><a href="../pt456904/index.html">Carregar teste de um projeto da web - sem dinheiro</a></li>
<li><a href="../pt456908/index.html">Como o Telegram funde voc√™ com a Rostelecom</a></li>
<li><a href="../pt456910/index.html">Projeto de Internet security.txt - conhecendo outro arquivo .well conhecido</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>