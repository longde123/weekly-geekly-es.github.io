<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßõüèΩ üïê üîµ Acerca de los espejos de repositorio de Centos y elegir el mejor üè≥Ô∏è üö¥üèª üç§</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="El a√±o pasado, alojamos espejos en l√≠nea para varias distribuciones de Linux. Este no es un proceso complicado y para proyectos grandes como Ubuntu, e...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Acerca de los espejos de repositorio de Centos y elegir el mejor</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/476262/">  El a√±o pasado, alojamos espejos en l√≠nea para varias distribuciones de Linux.  Este no es un proceso complicado y para proyectos grandes como Ubuntu, est√° casi completamente automatizado.  En otros casos, es necesario de una forma u otra ponerse en contacto con el proyecto, por ejemplo, en la lista de correo y expresar claramente su deseo. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/i5/vh/_l/i5vh_lmncsc_yjc6woir34ypw8o.png" alt="yum repolist"></div><br>  T√©cnicamente, es <code>rsync</code> , generalmente en un horario.  Alguien para esto proporciona un conjunto de scripts listos para usar, como Fedora, y alguien simplemente dice que necesita sincronizar aqu√≠ desde este servidor y el conjunto de par√°metros recomendado.  El recurso m√°s caro es el lugar, recientemente llegamos a 4 terabytes y esto es caro en nuestro caso, ya que no genera ning√∫n beneficio.  A cambio, recibimos la disponibilidad local de las distribuciones que utilizamos, lo que hizo posible simplificar la configuraci√≥n inicial de los servidores al eliminar el acceso obligatorio a Internet.  Y, por supuesto, nos alegra habernos unido a algo grande, incluso si nuestra participaci√≥n en esto no es muy notable. <br><br>  Nuestro espejo es p√∫blico, todos pueden recibir actualizaciones de √©l, lo que en realidad sucede si se juzga por las estad√≠sticas de las apelaciones.  Esto es principalmente Rusia, pero no solo.  Acerca de c√≥mo resulta y c√≥mo se selecciona el servidor general para actualizaciones en el ejemplo de la s√©ptima versi√≥n de Centos de esta publicaci√≥n. <a name="habracut"></a><br><br>  Hablaremos sobre el administrador de paquetes <code>yum</code> con el plugin m√°s <code>fastestmirror</code> instalado por defecto y solo nos interesar√° el proceso de selecci√≥n de un espejo espec√≠fico. <br><br><h2>  Lista de espejos </h2><br>  Se sabe que la lista de repositorios se especifica en los archivos en el directorio <code>/etc/yum.repos.d/</code> menos que se especifique lo contrario.  As√≠ es como se ve la configuraci√≥n del repositorio <code>Base</code> en el archivo <code>/etc/yum.repos.d/Centos-Base.repo</code> : <br><br><pre> <code class="bash hljs">[base] name=CentOS-<span class="hljs-variable"><span class="hljs-variable">$releasever</span></span> - Base mirrorlist=http://mirrorlist.centos.org/?release=<span class="hljs-variable"><span class="hljs-variable">$releasever</span></span>&amp;arch=<span class="hljs-variable"><span class="hljs-variable">$basearch</span></span>&amp;repo=os&amp;infra=<span class="hljs-variable"><span class="hljs-variable">$infra</span></span> <span class="hljs-comment"><span class="hljs-comment">#baseurl=http://mirror.centos.org/centos/$releasever/os/$basearch/ gpgcheck=1 gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7</span></span></code> </pre> <br>  Aqu√≠ puede ver dos opciones que especifican el lugar desde donde puede obtener datos.  La primera <b>base</b> apunta directamente al espejo, aqu√≠ no se necesita elecci√≥n.  La segunda lista de espejos indica un enlace a trav√©s del cual se devolver√° una lista de 10 espejos desde la cual se realizar√° la elecci√≥n, es esta opci√≥n la que est√° activa.  Tambi√©n vemos varias variables dentro del enlace, todas ellas reflejan en √∫ltima instancia un lugar espec√≠fico en el √°rbol del directorio del repositorio: <br><br><ul><li>  <b>lanzamiento</b> - versi√≥n: <code>6</code> , <code>7</code> , <code>8</code> , <code>8-stream</code> .  Las versiones anteriores se eliminan de la infraestructura existente, pero se pueden encontrar instant√°neas de sus repositorios en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">http://vault.centos.org/</a> </li><li>  <b>arch</b> es una arquitectura como <code>i386</code> o <code>x86_64</code> .  Para algunas versiones, algunas arquitecturas se referir√°n a repositorios alternativos y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">otro sistema espejo</a> , pero al mismo tiempo, la infraestructura de selecci√≥n espejo sigue siendo com√∫n.  Para la versi√≥n 7, el √∫nico espejo base compatible es <code>x86_64</code> , una alternativa al <code>i386</code> .  Para el primero, se formar√° una lista en la estructura b√°sica de los espejos, para el segundo de la alternativa </li><li>  <b>repo</b> : en nuestro caso, <code>os</code> , pero puede ser <code>updates</code> u otro, en realidad el tipo de repositorio refleja qu√© datos necesitamos.  Para la versi√≥n 8, el equivalente de <code>os</code> ser√° <code>baseos</code> </li><li>  <b>infra</b> : puedo suponer cuidadosamente que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">todav√≠a no se usa</a> , al menos no pude encontrar su procesamiento al formar una lista de espejos.  Es igual a <code>stock</code> , pero si omite este par√°metro, no habr√° cambios visibles. </li><li>  <b>cc</b> es el c√≥digo de pa√≠s; para EE. UU. y Canad√° tambi√©n es el c√≥digo de estado.  No est√° en el ejemplo del archivo anterior, ya que el pa√≠s se calcula cuando lo solicita la direcci√≥n IP de la solicitada.  Esta variable se puede usar para eliminar errores de geolocalizaci√≥n.  Para Rusia, <code>cc=ru</code> </li></ul><br>  Para la s√©ptima versi√≥n de Centos, obtenemos la siguiente l√≠nea: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">http://mirrorlist.centos.org/?release=7&amp;arch=x86_64&amp;repo=os&amp;infra=stock</a> que mostrar√° una lista de 10 espejos del siguiente tipo: <br><br><pre> <code class="bash hljs">http://&lt;   1&gt;/7.xxx/os/x86_64/ http://&lt;   2&gt;/7.xxx/os/x86_64/ ... http://&lt;   10&gt;/7.xxx/os/x86_64/</code> </pre> <br>  Tenga en cuenta que la ruta espec√≠fica para cada espejo coincide exactamente con las variables en la consulta.  Se indica la versi√≥n completa en lugar de la anterior, aunque tambi√©n puede usarla: <code>http://&lt;  &gt;/7/os/x86_64/</code> tambi√©n existe, implementado usando un enlace simb√≥lico a la √∫ltima versi√≥n. <br><br><div class="spoiler">  <b class="spoiler_title">Y todo esto en conjunto corresponde a la jerarqu√≠a de directorios directamente en el servidor.</b> <div class="spoiler_text"><pre>  ./centos
 ‚îú‚îÄ‚îÄ 6
 ‚îÇ ‚îú‚îÄ‚îÄ centosplus
 ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ i386
 ... ‚îÇ ‚îî‚îÄ‚îÄ x86_64
     ...
 ‚îÇ
 ‚îú‚îÄ‚îÄ 7
 ‚îÇ ‚îú‚îÄ‚îÄ at√≥mico
 ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ x86_64
 ‚îÇ ‚îú‚îÄ‚îÄ centosplus
 ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ x86_64
 ‚îÇ ‚îú‚îÄ‚îÄ cr
 ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ x86_64
 ‚îÇ ‚îú‚îÄ‚îÄ dotnet
 ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ x86_64
 ‚îÇ ‚îú‚îÄ‚îÄ extras
 ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ x86_64
 ‚îÇ ‚îú‚îÄ‚îÄ opstools
 ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ x86_64
 ‚îÇ ‚îú‚îÄ‚îÄ os
 ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ x86_64
 Po ‚îÇ ‚îî‚îÄ‚îÄ repodata
 ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ [repomd.xml]
 ‚îÇ ‚îú‚îÄ‚îÄ rt
 ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ x86_64
 ‚îÇ ‚îú‚îÄ‚îÄ actualizaciones
 ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ x86_64
 ‚îÇ ...
 ‚îÇ
 ‚îú‚îÄ‚îÄ 7.0.1406
 ‚îú‚îÄ‚îÄ 7.1.1503
 ‚îú‚îÄ‚îÄ 7.2.1511
 ‚îú‚îÄ‚îÄ 7.3.1611
 ‚îú‚îÄ‚îÄ 7.4.1708
 ‚îú‚îÄ‚îÄ 7.5.1804
 ‚îú‚îÄ‚îÄ 7.6.1810
 ‚îú‚îÄ‚îÄ 7.7.1908
 ‚îú‚îÄ‚îÄ 8
 ‚îú‚îÄ‚îÄ 8 secuencias
 ‚îú‚îÄ‚îÄ 8.0.1905 
 ... </pre></div></div><br><h3>  Implementaci√≥n </h3><br>  Ahora para la implementaci√≥n, que se puede encontrar en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://github.com/CentOS/mirrorlists-code</a> , estamos interesados ‚Äã‚Äãen c√≥mo se forma la lista de espejos.  El script de perlas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">makemirrorlists-combined.pl hace esto</a> .  Su tarea principal es verificar la vitalidad del espejo comparando el hash del <code>repodata/repomd.xml</code> con la referencia para la versi√≥n y arquitectura dadas.  En consecuencia, el archivo debe existir para todas las combinaciones disponibles de versiones, tipos de repositorios y arquitectura. <br><br>  La verificaci√≥n se lleva a cabo de acuerdo con la lista en el siguiente orden (cito del c√≥digo): <br><br><pre> <code class="perl hljs"><span class="hljs-comment"><span class="hljs-comment"># phase 1 -- this US state or Canada province # phase 2 -- this country # phase 3 -- other nearby countries # phase 4 -- mirrors from the same continent # phase 5 -- a random mirror from each continent (for fallback only) # note: phase 5 will be executed once for each continent (with "redo") # phase 6 -- random mirrors from any continent (for fallback only) # phase 7 -- centos servers from the same continent # phase 8 -- centos servers from other continents (used also for fallback)</span></span></code> </pre><br>  Las cl√°usulas 1 y 2 funcionan o para verificar no solo el c√≥digo de pa√≠s, sino tambi√©n el c√≥digo de estado.  En esencia, se intenta seleccionar los servidores geogr√°ficos m√°s cercanos.  Para cada paso, se realiza una consulta desde la base de datos, por ejemplo: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> $<span class="hljs-keyword"><span class="hljs-keyword">columns</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> mirrors <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> (<span class="hljs-string"><span class="hljs-string">'Direct'</span></span>, <span class="hljs-string"><span class="hljs-string">'Indirect'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> <span class="hljs-keyword"><span class="hljs-keyword">status</span></span> = <span class="hljs-string"><span class="hljs-string">'Active'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> cc = <span class="hljs-string"><span class="hljs-string">'$cc'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> $commonqueryparams $skipregion $altarch_where <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">RAND</span></span>();</code> </pre><br>  Luego, se verifica la vitalidad de los espejos en esta lista comparando hashes, como se describi√≥ anteriormente.  Si se reclutan 10 personas, entonces se ha completado la tarea requerida, se completa el trabajo.  Si no escribe, vaya al siguiente paso para obtener la lista general a 10 o hasta que hayamos agotado todas las opciones.  El resultado se guarda en un archivo y se transfiere al frente de la parte presentada por Python con el script <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ml.py</a> , cuya tarea es seleccionar y dar el archivo deseado, despu√©s de averiguar el pa√≠s de origen de la solicitud por direcci√≥n IP.  Tambi√©n se tiene en cuenta el tipo de protocolo IPv4 o IPv6, para el que se forman diferentes listas. <br><br>  Volviendo a la consulta que usa <code>ORDER BY RAND()</code> , ¬øsignifica esto que la lista ser√° aleatoria?  S√≠, cu√°n aleatoria es la implementaci√≥n en el DBMS, pero esto solo se aplica al orden dentro de cada paso.  Es decir, si para un pa√≠s en particular se tipean m√°s de 10 espejos del tipo requerido de repositorio y arquitectura (para Rusia solo hay 17), al final, cada vez obtendremos una lista aleatoria de 10 espejos diferentes en un pa√≠s.  Si hay menos, en la parte superior de la lista <b>siempre</b> habr√° repositorios aleatorios de un pa√≠s, repositorios adicionales de los pa√≠ses m√°s cercanos, y as√≠ sucesivamente.  Como resultado, obtenemos una lista no completamente aleatoria que consta de varias partes aleatorias.  Importa cuando no hay tantos espejos en funcionamiento en un pa√≠s, por ejemplo, los espejos IPv6 en Rusia son solo 7 y siempre estar√°n en la parte superior de la lista: <br><br><div class="spoiler">  <b class="spoiler_title">http://mirrorlist.centos.org/?release=7&amp;arch=x86_64&amp;repo=os&amp;infra=stock&amp;cc=en (la solicitud debe hacerse desde la direcci√≥n IPv6)</b> <div class="spoiler_text"> <code>http://mirror.corbina.net/pub/Linux/centos/7.7.1908/os/x86_64/ <br> http://mirror.yandex.ru/centos/7.7.1908/os/x86_64/ <br> http://mirrors.powernet.com.ru/centos/7.7.1908/os/x86_64/ <br> http://mirror.reconn.ru/centos/7.7.1908/os/x86_64/ <br> http://mirror.sale-dedic.com/centos/7.7.1908/os/x86_64/ <br> http://ftp.nsc.ru/pub/centos/7.7.1908/os/x86_64/ <br> http://dedic.sh/centos/7.7.1908/os/x86_64/ <br> <br> http://ftp.funet.fi/pub/mirrors/centos.org/7.7.1908/os/x86_64/ <br> http://centos.mirror.far.fi/7.7.1908/os/x86_64/ <br> http://mirrors.glesys.net/CentOS/7.7.1908/os/x86_64/ <br></code> </div></div><br>  Peor a√∫n, la arquitectura <code>i386</code> es una arquitectura alternativa para Centos 7 y un sistema de espejo separado.  En Rusia, solo hay uno de esos servidores que admite arquitecturas alternativas; siempre estar√° en primer lugar: <br><br><div class="spoiler">  <b class="spoiler_title">http://mirrorlist.centos.org/?release=7&amp;arch=i386&amp;repo=os&amp;infra=stock&amp;cc=en</b> <div class="spoiler_text"> <code>http://mirrors.powernet.com.ru/centos-altarch/7.7.1908/os/i386/ <br> <br> http://mirror.vpsnet.com/centos-altarch/7.7.1908/os/i386/ <br> http://mirrors.huaweicloud.com/centos-altarch/7.7.1908/os/i386/ <br> http://linux.darkpenguin.net/distros/CentOS-AltArch/7.7.1908/os/i386/ <br> http://ftp.agdsn.de/pub/mirrors/centos-altarch/7.7.1908/os/i386/ <br> http://mirror1.hs-esslingen.de/pub/Mirrors/centos-altarch/7.7.1908/os/i386/ <br> http://mirror.infonline.de/centos-altarch/7.7.1908/os/i386/ <br> http://ftp.rz.uni-frankfurt.de/pub/mirrors/centos-altarch/7.7.1908/os/i386/ <br> http://ftp.yz.yamagata-u.ac.jp/pub/linux/centos-altarch/7.7.1908/os/i386/ <br> http://mirrors.daticum.com/centos-altarch/7.7.1908/os/i386/ <br></code> </div></div><br>  La lista ya no es aleatoria, si te enfocas en la primera l√≠nea, la elecci√≥n est√° predeterminada.  El soporte para repositorios para arquitecturas Centos alternativas es una <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">cuesti√≥n de preocupaci√≥n principal</a> , pero para muchos, el altruismo puro est√° aqu√≠. <br><br>  Los repositorios se escanean continuamente y sin tener en cuenta los mecanismos de almacenamiento en cach√©, el resultado se actualiza aproximadamente cada 3 horas.  Cita de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">mirrorlist_crawler_deployment_notes.txt</a> : <br><blockquote> <code>- A full scan of all repos and all versions without any cached data is going to take close to 3 hours, but typically altarch is &lt;10min, C6 &lt;25min, C7 &lt;25min with all the repos enabled</code> </blockquote> <br>  En la pr√°ctica, comenc√© a obtener opciones de lista espejo en Rusia para IPv4 e IPv6 una vez por minuto para el repositorio de Base Centos 7: <code>http://mirrorlist.centos.org/?release=7&amp;arch=x86_64&amp;repo=os&amp;infra=stock&amp;cc=ru</code> y result√≥ as√≠ por un par de d√≠as de observaci√≥n: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/fx/qh/sn/fxqhsn08lhen5mke-jlprhlgjxa.png" alt="la lista de espejos cuenta actualizaciones"></div><br>  lista azul de IPv4, rojo IPv6.  El cambio no ocurre cada 25 minutos, pero no una vez cada 3 horas; todo cabe en el intervalo de media hora a dos.  La imagen con la arquitectura <code>i386</code> y los espejos alternativos es radicalmente diferente: <code>http://mirrorlist.centos.org/?release=7&amp;arch=i386&amp;repo=os&amp;infra=stock&amp;cc=ru</code> aproximadamente una semana de observaci√≥n: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/os/xy/wb/osxywbdutbktiud6-scyrul_lok.png" alt="altmirrors lista actualizaciones cuenta"></div><br>  Podemos esperar que cada 15 minutos tengamos una nueva lista, en 30 minutos suceder√°n algunos cambios.  Pero!  Recuerde que cuanto menos espejos est√© activo, menos aleatorio ser√° el orden y, en primer lugar, ahora en Rusia es siempre el mismo espejo. <br><br><h2>  El espejo m√°s r√°pido </h2><br>  En total, la lista de espejos se forma en el mejor de los casos por casualidad, lo que probablemente no sea malo para el equilibrio de carga.  En el peor de los casos, podemos esperar que al elegir solo el primer espejo de la lista, no tendremos otra opci√≥n como tal.  Adem√°s, la divisi√≥n territorial de los pa√≠ses en el caso de un pa√≠s grande como el nuestro puede ser un truco al poner un espejo de Petropavlovsk-Kamchatsky <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">http://mirror.vilkam.ru</a> para el cliente de Sochi en la parte superior de la lista.  Por lo tanto, ser√≠a bueno evaluar la disponibilidad de espejos de esta lista.  Esto se <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">realiza mediante el</a> complemento m√°s <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">r√°pido de espejo</a> .  La esencia de la cual se reduce a una simple acci√≥n: <br><br><pre> <code class="python hljs">time_before = time.time() sock.connect((self.host, self.port)) result = time.time() - time_before</code> </pre><br>  Sin <code>HTTP</code> o <code>ICMP</code> , abra el socket para el nodo, considere cu√°nto tiempo tard√≥, aplique <code>sort()</code> a los resultados.  Todos los 10 espejos que se obtuvieron en el paso anterior se env√≠an como par√°metros, en forma de la <code>URL</code> completa desde la que solo se utiliza el nombre de host.  Es f√°cil hacer que el complemento funcione por separado de <code>yum</code> , solo necesita comentar las l√≠neas 52 y 55: <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># from yum.plugins import TYPE_CORE requires_api_version = '2.5' # plugin_type = (TYPE_CORE,)</span></span></code> </pre><br><div class="spoiler">  <b class="spoiler_title">y puede ser usado</b> <div class="spoiler_text"><pre> <code class="bash hljs">$ ./fastestmirror.py http://mirror.sale-dedic.com/centos/7.7.1908/os/x86_64/ http://mirror.corbina.net/pub/Linux/centos/7.7.1908/os/x86_64/ http://mirrors.powernet.com.ru/centos/7.7.1908/os/x86_64/ http://ftp.nsc.ru/pub/centos/7.7.1908/os/x86_64/ http://mirror.reconn.ru/centos/7.7.1908/os/x86_64/ http://mirror.yandex.ru/centos/7.7.1908/os/x86_64/ http://dedic.sh/centos/7.7.1908/os/x86_64/ http://mirror.tversu.ru/centos/7.7.1908/os/x86_64/ http://mirror.awanti.com/centos/7.7.1908/os/x86_64/ http://mirror.linux-ia64.org/centos/7.7.1908/os/x86_64/repodata/repodm.xml http://mirrors.datahouse.ru/centos/7.7.1908/os/x86_64/ http://mirror.docker.ru/centos/7.7.1908/os/x86_64/ http://mirror.logol.ru/centos/7.7.1908/os/x86_64/ http://centos-mirror.rbc.ru/centos/7.7.1908/os/x86_64/ http://mirror.truenetwork.ru/centos/7.7.1908/os/x86_64/ http://mirror.vilkam.ru/centos/7.7.1908/os/x86_64/ http://mirror.axelname.ru/centos/7.7.1908/os/x86_64/ * mirror.corbina.net : 0.085000 secs * mirrors.powernet.com.ru : 0.097000 secs * mirror.sale-dedic.com : 0.117000 secs * ftp.nsc.ru : 0.181000 secs * mirror.reconn.ru : 0.184000 secs * mirror.yandex.ru : 0.222000 secs * dedic.sh : 0.261000 secs * mirror.tversu.ru : 0.295000 secs * mirror.awanti.com : 0.345000 secs * mirror.linux-ia64.org : 0.386000 secs * mirrors.datahouse.ru : 0.403000 secs * mirror.docker.ru : 0.435000 secs * mirror.logol.ru : 0.474000 secs * centos-mirror.rbc.ru : 0.519000 secs * mirror.truenetwork.ru : 0.587000 secs * mirror.axelname.ru : 0.528000 secs * mirror.vilkam.ru : 0.709000 secs Result: [<span class="hljs-string"><span class="hljs-string">'http://mirror.corbina.net/pub/Linux/centos/7.7.1908/os/x86_64/'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://mirrors.powernet.com.ru/centos/7.7.1908/os/x86_64/'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://mirror.sale-dedic.com/centos/7.7.1908/os/x86_64/'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://ftp.nsc.ru/pub/centos/7.7.1908/os/x86_64/'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://mirror.reconn.ru/centos/7.7.1908/os/x86_64/'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://mirror.yandex.ru/centos/7.7.1908/os/x86_64/'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://dedic.sh/centos/7.7.1908/os/x86_64/'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://mirror.tversu.ru/centos/7.7.1908/os/x86_64/'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://mirror.awanti.com/centos/7.7.1908/os/x86_64/'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://mirror.linux-ia64.org/centos/7.7.1908/os/x86_64/'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://mirrors.datahouse.ru/centos/7.7.1908/os/x86_64/'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://mirror.docker.ru/centos/7.7.1908/os/x86_64/'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://mirror.logol.ru/centos/7.7.1908/os/x86_64/'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://centos-mirror.rbc.ru/centos/7.7.1908/os/x86_64/'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://mirror.axelname.ru/centos/7.7.1908/os/x86_64/'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://mirror.truenetwork.ru/centos/7.7.1908/os/x86_64/'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://mirror.vilkam.ru/centos/7.7.1908/os/x86_64/'</span></span>]</code> </pre></div></div><br>  El procesamiento se realiza en varios subprocesos, por lo que no tiene que esperar mucho, incluso para los 17 espejos que se enumeran en Rusia.  El resultado del trabajo en forma de dos listas, la primera en la que se indica el tiempo de ejecuci√≥n, es la depuraci√≥n y no est√° ordenada, aunque pueda parecerlo.  El segundo despu√©s de que la palabra <code>Result</code> ordena de una respuesta m√°s peque√±a a una m√°s grande, es √©l quien se utiliza para el trabajo adicional en el orden recibido. <br><br>  <code>dnf</code> tambi√©n utiliza el <a href="">espejo m√°s r√°pido</a> del conjunto de bibliotecas RPM, pero all√≠ se resuelve a trav√©s de <code>libcurl</code> y, en general, todo es m√°s complicado. <br><br>  Al final, todo depende de qu√© tan r√°pido se reciba la respuesta del espejo, mientras que el almacenamiento en cach√© debe tenerse en cuenta, es decir, el c√°lculo directo del retraso no siempre se realiza.  Los intervalos de tiempo se ven muy afectados por el rendimiento interno de la m√°quina local y su carga de trabajo.  Los nodos cercanos que muestran resultados similares probablemente cambiar√°n de lugar con frecuencia.  Pero aqu√≠ se logra, me parece que el objetivo principal no es enviar un nodo desde Sochi para su renovaci√≥n a Petropavlovsk-Kamchatsky, para ir a Mosc√∫ o Volgogrado es bastante aceptable.  ¬øA qu√© m√°s prestamos atenci√≥n? La elecci√≥n se realiza de la lista que se recibi√≥ en el primer paso antes del <code>fastestmirror</code> , si estos datos a√∫n no est√°n en la cach√©, entonces el espejo m√°s cercano en el primer intento puede no ser el mejor, simplemente porque ni siquiera se analizar√° sin entrar en los diez primeros <br><br>  En la pr√°ctica, se obtuvieron los siguientes resultados de primer lugar en una encuesta semanal cada 10 minutos.  D√≠gitos: la cantidad de veces cu√°ntos nodos ganaron durante la comparaci√≥n, para el <code>fastestmirror</code> y <code>fastestmirror</code> : <br><blockquote> <code>1422,1013 mirror.logol.ru <br> 534,986 mirror.docker.ru <br> 28,8 mirrors.datahouse.ru <br> 16 centos-mirror.rbc.ru <br> 6 mirror.sale-dedic.com <br> 5,7 mirror.reconn.ru <br> 2 dedic.sh <br> 1 mirror.corbina.net</code> </blockquote> <br>  Y la versi√≥n IPv6 de la lista: <br><blockquote> <code>1989,1980 mirror.reconn.ru <br> 18,34 mirror.sale-dedic.com <br> 7 dedic.sh <br></code> </blockquote><br>  Se puede ver que la elecci√≥n no es directamente inequ√≠voca, pero aqu√≠ la proximidad del punto desde el que hice la encuesta probablemente juega un papel: hasta varios espejos, la diferencia es menos de un milisegundo.  El segundo punto, la lista de IPv6 es diferente y es peor: el host IPv6 m√°s cercano est√° m√°s lejos que el IPv4 m√°s cercano y la elecci√≥n es menor.  Dada la prioridad de IPv6 no es muy buena.  Los resultados de <code>fping</code> concisos, menos nodos ganadores, pero generalmente son los mismos con el <code>fastestmirror</code> . <br><br><h2>  Atlas maduro </h2><br>  Con una elecci√≥n local, todo est√° m√°s o menos claro, ahora veamos c√≥mo est√°n sucediendo las cosas en todo el pa√≠s.  ¬øPor qu√© utilizamos los servicios <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://atlas.ripe.net/</a> ? Un conjunto de sondas (sondas) y herramientas para trabajar con ellos bajo los auspicios de RIPE NCC. Le advertir√© de inmediato, este no es el sitio m√°s r√°pido y m√°s √°gil.  Cualquiera puede obtener una sonda, as√≠ como usar esta red.  Pero para ejecutar las pruebas, necesita una moneda interna que se acumule de los dispositivos que est√°n registrados y activos despu√©s de usted.  Seleccion√© todos los dispositivos en Rusia que admiten IPv6 e IPv4 al mismo tiempo, resultaron 82 de ellos. Seg√∫n los resultados de la medici√≥n, una parte tuvo que ser eliminada, por lo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">que</a> quedaron 67 de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">m√°s de 400</a> . <br><br>  Hay varias opciones de prueba que puede ejecutar, por supuesto, no hay lo que se usa en el <code>fastestmirror</code> , pero hay un <code>ping</code> regular.  Para todos los espejos, con la excepci√≥n de <code>mirror.linux-ia64.org</code> para el cual <code>ICMP</code> filtra <code>ICMP</code> y <code>mirror.axelname.ru</code> que apareci√≥ despu√©s de que se realizaron las pruebas, desde todos los dispositivos seleccionados, por separado para IPv6 e IPv4, cada 3 horas durante una semana 10 solicitudes cada uno.  Se registr√≥ el tiempo de respuesta promedio.  Del conjunto completo de mediciones, aproximadamente 50 por cada espejo, se tom√≥ la mediana y se compar√≥ con otros espejos en esta sonda.  El espejo con el menor tiempo de respuesta gan√≥. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/cg/ap/gf/cgapgfond47sh3phyalhc30s0na.jpeg" alt="mapa de espejos y sondas"></div><br>  Las sondas (marcadores azules) y los espejos (marcadores rojos) se distribuyen de manera demasiado desigual y gravitan hacia las may√∫sculas, por lo que los resultados no deben tomarse como algo significativo.  Los datos sin procesar est√°n disponibles a partir del n√∫mero de medici√≥n <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">23159879</a> a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">23159901</a> , si se desea, pueden analizarse m√°s estrictamente.  N√∫mero total resumido de primeros lugares para IPv4: <br><blockquote> <code>22 mirror.docker.ru <br> 12 mirror.awanti.com <br> 10 centos-mirror.rbc.ru <br> 6 dedic.sh <br> 4 mirror.truenetwork.ru <br> 3 mirror.corbina.net <br> 3 mirrors.powernet.com.ru <br> 2 ftp.nsc.ru <br> 2 mirrors.datahouse.ru <br> 1 mirror.reconn.ru <br> 1 mirror.vilkam.ru <br> 1 mirror.yandex.ru <br></code> </blockquote><br>  e IPv6: <br><blockquote> <code>20 dedic.sh <br> 20 mirror.reconn.ru <br> 10 mirror.yandex.ru <br> 8 mirror.sale-dedic.com <br> 5 ftp.nsc.ru <br> 3 mirror.corbina.net <br> 1 mirrors.powernet.com.ru <br></code> </blockquote><br>  Podemos decir que para casi todos los espejos, les recuerdo a los 17, hay consumidores.  Es interesante que <code>mirror.yandex.ru</code> en el √∫ltimo lugar junto con <code>mirror.vilkam.ru</code> de Petropavlovsk-Kamchatsky.  Al mismo tiempo, Yandex est√° disponible en casi todas partes, solo pierde un poco m√°s de respuesta cada vez, pero <code>mirror.vilkam.ru</code> gana una vez, pero m√°s que honestamente en comparaci√≥n con otros en la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">sonda 6606</a> de Khabarovsk (RTT en milisegundos): <br><blockquote> <code>centos-mirror.rbc.ru,105.4163369 <br> dedic.sh,109.2160474 <br> ftp.nsc.ru,106.4012836 <br> mirror.awanti.com,107.0802782 <br> mirror.corbina.net,98.5339837 <br> mirror.docker.ru,102.7883347 <br> mirror.logol.ru,105.9588192 <br> mirror.reconn.ru,106.5717624 <br> mirror.sale-dedic.com,106.1676841 <br> mirror.truenetwork.ru,110.9780753 <br> mirror.tversu.ru,107.9966083 <br> mirror.vilkam.ru,25.1486164 <br> mirror.yandex.ru,99.7320257 <br> mirrors.datahouse.ru,103.6546383 <br> mirrors.powernet.com.ru,116.4087614 <br></code> </blockquote><br>  Los mejores resultados en la regi√≥n de uno o varios milisegundos, y el peor resultado en respuesta en Salekhard, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">sonda 22767</a> : <br><blockquote> <code>centos-mirror.rbc.ru,59.9632155 <br> dedic.sh,63.765421 <br> ftp.nsc.ru,59.349309 <br> mirror.awanti.com,75.8998928571 <br> mirror.corbina.net,59.906047 <br> mirror.docker.ru,65.8720585 <br> mirror.logol.ru,63.2041255 <br> mirror.reconn.ru,63.7120505 <br> mirror.sale-dedic.com,63.052342 <br> mirror.truenetwork.ru,61.2567465 <br> mirror.tversu.ru,66.2593372222 <br> mirror.vilkam.ru,138.3730595 <br> mirror.yandex.ru,63.4150445 <br> mirrors.datahouse.ru,59.304435 <br> mirrors.powernet.com.ru,78.7411795 <br></code> </blockquote><br><h2>  Ep√≠logo </h2><br>  Para aquellos que llegaron a este lugar, responder√© la pregunta que se har√°: nuestro espejo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">http://mirrors.powernet.com.ru</a> y as√≠ es c√≥mo se usa: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/nl/rm/nb/nlrmnbe9g8tnuvym2u6jlyurnzc.png" alt="tr√°fico de datos mirrors.powernet.com.ru"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/tk/99/rn/tk99rnmoigycgl4ataoygkhs100.png" alt="tr√°fico de ancho de banda mirrors.powernet.com.ru"></div><br>  Adem√°s, la participaci√≥n de este tr√°fico desde nuestra red es insignificante. <br><br>  As√≠ es como termina el lugar en √©l: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ap/qk/zc/apqkzcw2htintu4idmjk5sixyfk.png" alt="disco mirrors.powernet.com.ru"></div><br>  Los pasos bien distinguibles son momentos en los que agregamos una nueva distribuci√≥n.  Cuando todo comenz√≥, fue VirtualBox ejecut√°ndose en Windows en una computadora de oficina en la que se almacenaron los archivos de video de nuestro departamento de publicidad.  Luego pasamos al sistema de virtualizaci√≥n de combate y se volvi√≥ un poco m√°s f√°cil: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/po/nl/hq/ponlhqp1327wrr6hmvpczednm8q.png" alt="imagen"></div><br>  A modo de comparaci√≥n, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">mirror.truenetwork.ru</a> devuelve 3 Gb / s de tr√°fico desde dos servidores.  Todo es mucho m√°s modesto con nosotros y, en general, es m√°s que suficiente para que disfrutemos el proceso, as√≠ como las raras cr√≠ticas de entusiastas y sorprendidos de amigos y suscriptores cuando alguien nota l√≠neas familiares repentinas mientras actualiza su sistema.  Y tambi√©n, a veces parpadea en segundo plano en varios art√≠culos y manuales, donde los enlaces a nuestro espejo son visibles en los registros o capturas de pantalla. <br><br>  Puede ver el estado de todos los espejos conocidos en Centos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> , y leer acerca de c√≥mo unirse al proyecto <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> , es simple y responsable al mismo tiempo, pero ciertamente no es in√∫til. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/476262/">https://habr.com/ru/post/476262/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../476252/index.html">Migraci√≥n de correo: c√≥mo moverse f√°cilmente de un servidor e ir a otro</a></li>
<li><a href="../476254/index.html">Desde estudiantes hasta incidentes o c√≥mo ingresar a una empresa de TI sin conocimiento y experiencia</a></li>
<li><a href="../476256/index.html">Siguiendo los pasos del movimiento ruso Scala. Parte 3</a></li>
<li><a href="../476258/index.html">Migraci√≥n de la base de datos de GitLab a PostgreSQL externo</a></li>
<li><a href="../476260/index.html">Recopilamos en rpm WireMock, una utilidad para crear stubs sobre servicios web en Fedora COPR, an√°logo de PPA en Ubuntu</a></li>
<li><a href="../476264/index.html">Telegram bot para aprender idiomas extranjeros: desde api√±ar palabras hasta hablar</a></li>
<li><a href="../476266/index.html">Pr√°cticas en Mars Digital Technologies. C√≥mo aplicamos el aprendizaje profundo en M&M</a></li>
<li><a href="../476268/index.html">Soluciones para los desaf√≠os de b√∫squeda de errores ofrecidos por el equipo de PVS-Studio en las conferencias en 2018-2019</a></li>
<li><a href="../476270/index.html">Nuestro ganado: TopCoder Open 2019</a></li>
<li><a href="../476272/index.html">Respuestas a las tareas del stand de PVS-Studio en las conferencias 2018-2019</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>