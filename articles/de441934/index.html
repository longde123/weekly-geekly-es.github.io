<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>♎️ 🤐 👩🏿‍🤝‍👨🏽 7 Schritte zur Verwendung von Room. Exemplarische Vorgehensweise zum Migrieren Ihrer Anwendung nach Room 🌏 🤚🏼 😿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Room ist eine Bibliothek, die Teil der Architekturkomponenten von Android ist. Es erleichtert die Arbeit mit SQLiteDatabase Objekten in der Anwendung,...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>7 Schritte zur Verwendung von Room. Exemplarische Vorgehensweise zum Migrieren Ihrer Anwendung nach Room</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/441934/"><p><img src="https://habrastorage.org/getpro/habr/post_images/810/7f6/165/8107f6165672ecb492fe2ff90d693b05.png" alt="7 Schritte zur Verwendung von Room. Exemplarische Vorgehensweise zum Migrieren Ihrer Anwendung nach Room"></p><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Room</a> ist eine Bibliothek, die Teil der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Architekturkomponenten von</a> Android ist.  Es erleichtert die Arbeit mit <code>SQLiteDatabase</code> Objekten in der Anwendung, reduziert die Menge an Standardcode und überprüft SQL-Abfragen beim Kompilieren. </p><br><p>  Haben Sie bereits ein Android-Projekt, das SQLite zum Speichern von Daten verwendet?  Wenn ja, können Sie es in Room migrieren.  Lassen Sie uns sehen, wie Sie ein vorhandenes Projekt in 7 einfachen Schritten umgestalten, um Room zu verwenden. </p><br><blockquote>  <em><strong>TL; DR:</strong> Aktualisieren Sie die Gradle-Abhängigkeiten, erstellen Sie Ihre Entitäten, DAO und Datenbank, ersetzen Sie <code>SQLiteDatabase</code> Aufrufe durch DAO-Methodenaufrufe, testen Sie alles, was Sie erstellt oder geändert haben, und löschen Sie nicht verwendete Klassen.</em>  <em>Das ist alles!</em> </blockquote><a name="habracut"></a><br><p>  In <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">unserer Beispielanwendung</a> für die Migration arbeiten wir mit Objekten vom Typ <code>User</code> .  Wir haben Produktvarianten verwendet, um verschiedene Implementierungen auf Datenebene zu demonstrieren: </p><br><ol><li>  <strong>sqlite</strong> - verwendet <code>SQLiteOpenHelper</code> und herkömmliche SQLite-Schnittstellen. </li><li>  <strong>room</strong> - ersetzt die Implementierung durch Room und bietet Migration. </li></ol><br><p>  Jede Option verwendet dieselbe Benutzeroberflächenebene, die dank des MVP-Musters mit der <code>UserRepository</code> Klasse funktioniert. </p><br><p>  In der SQLite-Variante sehen Sie viel Code, der häufig dupliziert wird und die Datenbank in den <code>LocalUserDataSource</code> <code>UsersDbHelper</code> und <code>LocalUserDataSource</code> .  Abfragen werden mit <code>ContentValues</code> , und die von <code>ContentValues</code> Daten werden spaltenweise gelesen.  All dieser Code trägt zum Auftreten impliziter Fehler bei.  Sie können beispielsweise das Hinzufügen einer Spalte zu einer Abfrage überspringen oder ein Objekt aus einer Datenbank falsch zusammenstellen. </p><br><p>  Mal sehen, wie Room unseren Code verbessert.  Zunächst kopieren wir einfach die Klassen aus der SQLite-Variante und ändern sie schrittweise. </p><br><h2 id="shag-1-obnovlenie-zavisimostey-gradle">  Schritt 1. Aktualisieren der Gradle-Abhängigkeiten </h2><br><p>  Abhängigkeiten für Room sind über das neue Google Maven-Repository verfügbar.  <code>build.gradle</code> Sie es einfach der Liste der Repositorys in Ihrer Hauptdatei <code>build.gradle</code> : </p><br><pre> <code class="plaintext hljs">allprojects { repositories { google() jcenter() } }</code> </pre> <br><p>  Definieren Sie die Version der Raumbibliothek in derselben Datei.  Während es in der Alpha-Version ist, aber bleiben Sie auf dem Laufenden für Versionsaktualisierungen auf den <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Entwicklerseiten</a> : </p><br><pre> <code class="plaintext hljs">ext { roomVersion = '2.1.0-alpha03' }</code> </pre> <br><p>  <code>app/build.gradle</code> Sie in <code>app/build.gradle</code> Abhängigkeiten für Room hinzu: </p><br><pre> <code class="plaintext hljs">dependencies { implementation “android.arch.persistence.room:runtime:$rootProject.roomVersion” annotationProcessor “android.arch.persistence.room:compiler:$rootProject.roomVersion” androidTestImplementation “android.arch.persistence.room:testing:$rootProject.roomVersion” }</code> </pre> <br><p>  Um nach Room zu migrieren, müssen wir die Version der Datenbank erhöhen und um Benutzerdaten zu speichern, müssen wir die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Migrationsklasse</a> implementieren.  Um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">die Migration</a> zu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">testen</a> , müssen wir das Schema exportieren.  <code>app/build.gradle</code> den folgenden Code <code>app/build.gradle</code> : </p><br><pre> <code class="plaintext hljs">android { defaultConfig { ... // used by Room, to test migrations javaCompileOptions { annotationProcessorOptions { arguments = ["room.schemaLocation": "$projectDir/schemas".toString()] } } } // used by Room, to test migrations sourceSets { androidTest.assets.srcDirs += files("$projectDir/schemas".toString()) } ...</code> </pre> <br><h2 id="shag-2-obnovlenie-klassov-modeli-do-suschnostey">  Schritt 2. Aktualisieren von Modellklassen auf Entitäten </h2><br><p>  Room erstellt für jede Klasse mit der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Bezeichnung @Entity</a> eine Tabelle.  Die Felder in der Klasse entsprechen den Spalten in der Tabelle.  Folglich sind Entitätsklassen in der Regel kleine Klassen von Modellen, die keine Logik enthalten.  Unsere <code>User</code> repräsentiert ein Modell für Daten in einer Datenbank.  Aktualisieren wir es also, um Room mitzuteilen, dass eine Tabelle basierend auf dieser Klasse erstellt werden soll: </p><br><ul><li>  Kommentieren Sie die Klasse mit <code>@Entity</code> und legen Sie den Tabellennamen mit der Eigenschaft <code>tableName</code> . </li><li>  <code>@PrimaryKey</code> Sie den Primärschlüssel fest, indem Sie die Annotation <code>@PrimaryKey</code> zu den richtigen Feldern hinzufügen. In unserem Fall ist dies die Benutzer-ID. </li><li>  Geben Sie den Spaltennamen für die Klassenfelder mithilfe der Annotation <code>@ColumnInfo(name = "column_name")</code> .  Sie können diesen Schritt überspringen, wenn Ihre Felder bereits so benannt sind, wie die Spalte benannt werden soll. </li><li>  Wenn die Klasse mehrere Konstruktoren enthält, fügen Sie die Annotation <code>@Ignore</code> , um Room mitzuteilen, welche verwendet werden sollen und welche nicht. </li></ul><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Entity</span></span>(tableName = <span class="hljs-string"><span class="hljs-string">"users"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">User</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@PrimaryKey</span></span> <span class="hljs-meta"><span class="hljs-meta">@ColumnInfo</span></span>(name = <span class="hljs-string"><span class="hljs-string">"userid"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String mId; <span class="hljs-meta"><span class="hljs-meta">@ColumnInfo</span></span>(name = <span class="hljs-string"><span class="hljs-string">"username"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String mUserName; <span class="hljs-meta"><span class="hljs-meta">@ColumnInfo</span></span>(name = <span class="hljs-string"><span class="hljs-string">"last_update"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Date mDate; <span class="hljs-meta"><span class="hljs-meta">@Ignore</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">User</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String userName)</span></span></span><span class="hljs-function"> </span></span>{ mId = UUID.randomUUID().toString(); mUserName = userName; mDate = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Date(System.currentTimeMillis()); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">User</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String id, String userName, Date date)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.mId = id; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.mUserName = userName; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.mDate = date; } ... }</code> </pre> <br><p>  <strong>Hinweis:</strong> <code>@Entity</code> <strong>Sie</strong> für eine reibungslose Migration genau auf die Namen der Tabellen und Spalten in der ursprünglichen Implementierung und stellen Sie sicher, dass Sie sie in den <code>@ColumnInfo</code> <code>@Entity</code> und <code>@ColumnInfo</code> korrekt <code>@Entity</code> <code>@ColumnInfo</code> . </p><br><h2 id="shag-3-sozdanie-obektov-dostupa-k-dannym-dao">  Schritt 3. Erstellen von Datenzugriffsobjekten (DAO) </h2><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">DAOs</a> sind für die Definition von Datenbankzugriffsmethoden verantwortlich.  Bei der ersten Implementierung unseres SQLite-Projekts wurden alle Datenbankabfragen in der <code>LocalUserDataSource</code> Klasse ausgeführt, in der wir mit <code>LocalUserDataSource</code> gearbeitet haben.  In Room benötigen wir nicht den gesamten Code, der dem Cursor zugeordnet ist, und wir können unsere Anforderungen einfach mithilfe von Anmerkungen in der <code>UserDao</code> Klasse definieren. </p><br><p>  Wenn Sie beispielsweise alle Benutzer aus der Datenbank abfragen, erledigt Room die gesamte „harte Arbeit“, und wir müssen nur schreiben: </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Query</span></span>(“SELECT * FROM Users”) <span class="hljs-function"><span class="hljs-function">List&lt;User&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getUsers</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>;</code> </pre> <br><h2 id="shag-4-sozdanie-bazy-dannyh">  Schritt 4. Erstellen einer Datenbank </h2><br><p>  Wir haben unsere <code>Users</code> und die entsprechenden Abfragen bereits definiert, aber noch keine Datenbank erstellt, die alle diese Komponenten von Room vereint.  Dazu müssen wir eine abstrakte Klasse definieren, die <code>RoomDatabase</code> .  Diese Klasse ist mit <code>@Database</code> gekennzeichnet und listet die in der Datenbank enthaltenen Objekte und das DAO auf, die auf sie zugreifen.  Die Datenbankversion sollte im Vergleich zum ursprünglichen Wert um 1 erhöht werden, in unserem Fall also um 2. </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Database</span></span>(entities = {User.class}, version = <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-meta"><span class="hljs-meta">@TypeConverters</span></span>(DateConverter.class) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UsersDatabase</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RoomDatabase</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> UsersDatabase INSTANCE; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">abstract</span></span></span><span class="hljs-function"> UserDao </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">userDao</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>;</code> </pre> <br><p>  Da wir Benutzerdaten speichern möchten, müssen wir die <code>Migration</code> implementieren, die Room mitteilt, was beim Wechsel von Version 1 zu 2 zu tun ist. In unserem Fall stellen wir einfach eine leere Implementierung bereit, da sich das Datenbankschema nicht geändert hat: </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Migration MIGRATION_1_2 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Migration(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>) { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">migrate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(SupportSQLiteDatabase database)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//     ,      . } };</span></span></code> </pre> <br><p>  Erstellen Sie ein Datenbankobjekt in der <code>UsersDatabase</code> Klasse, indem Sie den Datenbanknamen und die Migration definieren: </p><br><pre> <code class="java hljs">database = Room.databaseBuilder(context.getApplicationContext(), UsersDatabase.class, <span class="hljs-string"><span class="hljs-string">"Sample.db"</span></span>) .addMigrations(MIGRATION_1_2) .build();</code> </pre> <br><p>  In <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">diesem Beitrag</a> erfahren Sie mehr darüber, wie Sie die Datenbankmigration implementieren und wie sie unter der Haube funktioniert. </p><br><h2 id="shag-5-obnovlenie-repozitoriya-dlya-ispolzovaniya-room">  Schritt 5. Aktualisieren des Repositorys zur Verwendung von Room </h2><br><p>  Wir haben unsere Datenbank, unsere Benutzertabelle und Abfragen erstellt. Jetzt ist es Zeit, sie zu verwenden.  Zu diesem Zeitpunkt aktualisieren wir die <code>LocalUserDataSource</code> Klasse, um <code>UserDao</code> Methoden zu verwenden.  Dazu aktualisieren wir zuerst den Konstruktor: Entfernen Sie den <code>Context</code> und fügen Sie <code>UserDao</code> .  Natürlich muss auch jede Klasse aktualisiert werden, die eine Instanz von <code>LocalUserDataSource</code> erstellt. </p><br><p>  Als Nächstes aktualisieren wir die <code>LocalUserDataSource</code> Methoden, die Abfragen durchführen, indem wir die <code>LocalUserDataSource</code> Methoden aufrufen.  Eine Methode, die jetzt alle Benutzer anfordert, sieht jetzt folgendermaßen aus: </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List&lt;User&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getUsers</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> mUserDao.getUsers(); }</code> </pre> <br><p>  Und jetzt ist die Zeit zu starten, was wir getan haben. </p><br><p>  Eine der besten Funktionen von Room ist, dass Ihre Anwendung mit der folgenden Fehlermeldung abstürzt, wenn Sie Datenbankoperationen für den Hauptthread ausführen. </p><br><pre> <code class="xml hljs">java.lang.IllegalStateException: Cannot access database on the main thread since it may potentially lock the UI for a long period of time.</code> </pre> <br><p>  Eine zuverlässige Möglichkeit, E / A-Vorgänge aus dem Hauptthread zu verschieben, besteht darin, eine neue <code>Runnable</code> zu erstellen, die für jede Datenbankabfrage einen neuen Thread erstellt.  Da wir diesen Ansatz bereits in der SQLite-Variante verwenden, waren keine Änderungen erforderlich. </p><br><h2 id="shag-6-testirovanie-na-ustroystve">  Schritt 6. Testen auf dem Gerät </h2><br><p>  Wir haben neue Klassen erstellt - <code>UserDao</code> und <code>UsersDatabase</code> und unsere <code>LocalUserDataSource</code> geändert, um die Room-Datenbank zu verwenden.  Jetzt müssen wir sie testen. </p><br><h3 id="testirovanie-userdao">  Testen von UserDao </h3><br><p>  Um <code>UserDao</code> zu testen, müssen wir eine <code>AndroidJUnit4</code> .  Das Atemberaubende an Room ist die Möglichkeit, eine Datenbank im Speicher zu erstellen.  Dadurch muss nach jedem Test nicht mehr gereinigt werden. </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Before</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initDb</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{ mDatabase = Room.inMemoryDatabaseBuilder( InstrumentationRegistry.getContext(), UsersDatabase.class) .build(); }</code> </pre> <br><p>  Wir müssen auch sicherstellen, dass wir die Datenbankverbindung nach jedem Test schließen. </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@After</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">closeDb</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{ mDatabase.close(); }</code> </pre> <br><p>  Um beispielsweise die Anmeldung eines Benutzers zu testen, fügen wir einen Benutzer hinzu und prüfen dann, ob wir diesen Benutzer aus der Datenbank abrufen können. </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">insertAndGetUser</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//      mDatabase.userDao().insertUser(USER); //        List&lt;User&gt; users = mDatabase.userDao().getUsers(); assertThat(users.size(), is(1)); User dbUser = users.get(0); assertEquals(dbUser.getId(), USER.getId()); assertEquals(dbUser.getUserName(), USER.getUserName()); }</span></span></code> </pre> <br><h3 id="testirovanie-ispolzovaniya-userdao-v-localuserdatasource">  Testen der Verwendung von UserDao in LocalUserDataSource </h3><br><p>  Es ist einfach sicherzustellen, dass <code>LocalUserDataSource</code> weiterhin ordnungsgemäß funktioniert, da wir bereits Tests haben, die das Verhalten dieser Klasse beschreiben.  Wir müssen <code>UserDao</code> eine Datenbank im Speicher erstellen, ein <code>UserDao</code> Objekt daraus <code>UserDao</code> und es als Parameter für den <code>LocalUserDataSource</code> Konstruktor verwenden. </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Before</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initDb</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{ mDatabase = Room.inMemoryDatabaseBuilder( InstrumentationRegistry.getContext(), UsersDatabase.class) .build(); mDataSource = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LocalUserDataSource(mDatabase.userDao()); }</code> </pre> <br><p>  Auch hier müssen wir sicherstellen, dass wir die Datenbank nach jedem Test schließen. </p><br><h3 id="testirovanie-migracii-bazy-dannyh">  Testen der Datenbankmigration </h3><br><p>  In <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">diesem Beitrag</a> <code>MigrationTestHelper</code> Sie mehr darüber, wie Datenbankmigrationstests implementiert werden und wie <code>MigrationTestHelper</code> funktioniert. </p><br><p>  Sie können den Code auch anhand eines detaillierteren Beispiels für eine <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Migrationsanwendung sehen</a> . </p><br><h2 id="shag-7-udalenie-vsego-nenuzhnogo">  Schritt 7. Entfernen Sie alle unnötigen </h2><br><p>  Entfernen Sie alle nicht verwendeten Klassen und Codezeilen, die jetzt durch die Room-Funktionalität ersetzt werden.  In unserem Projekt müssen wir nur die <code>UsersDbHelper</code> Klasse entfernen, die die <code>SQLiteOpenHelper</code> Klasse erweitert hat. </p><br><p>  Wenn Sie eine größere und komplexere Datenbank haben und schrittweise zu Room wechseln möchten, empfehlen wir <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">diesen Beitrag</a> . </p><br><p>  Jetzt hat sich die Menge des fehleranfälligen Standardcodes verringert, Anforderungen werden beim Kompilieren überprüft und alles wird getestet.  In 7 einfachen Schritten konnten wir unsere vorhandene Anwendung nach Room migrieren.  Eine Beispielanwendung finden Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de441934/">https://habr.com/ru/post/de441934/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de441916/index.html">Hart arbeitende Realität - Xichang Satellite Launch Center - XSLC</a></li>
<li><a href="../de441918/index.html">Wir sind in UltraHD Morty! Wie man einen Film in 4K sieht</a></li>
<li><a href="../de441920/index.html">Informationssicherheitsstrategie: Haben Sie entschieden, wie Sie vorankommen möchten?</a></li>
<li><a href="../de441928/index.html">Starten Sie die Anwendung in Openshift und vergleichen Sie vorhandene Tools</a></li>
<li><a href="../de441932/index.html">Wettbewerbsvorteile: SIBUR entwickelt additive Fertigung</a></li>
<li><a href="../de441938/index.html">Formel für Koreanisch oder Hangul schnell, einfach und fehlerfrei erkennen.</a></li>
<li><a href="../de441942/index.html">Brechen - nicht bauen. Oder Devolution</a></li>
<li><a href="../de441944/index.html">Warum wir uns für den Lexus RX450h entschieden haben</a></li>
<li><a href="../de441946/index.html">REST-API auf Laravel in 100 Codezeilen</a></li>
<li><a href="../de441950/index.html">Eclipse Che 7 ist schon da</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>