<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚õ∫Ô∏è üîÆ üëßüèª Launch Predator - Reposit√≥rios de dados pr√©-compilados üññüèø üõ´ ü§π</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hoje, a equipe Micronaut da Object Computing Inc (OCI) apresentou o Predator , um novo projeto de c√≥digo aberto cujo objetivo √© melhorar significativa...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Launch Predator - Reposit√≥rios de dados pr√©-compilados</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/460839/"><p><img src="https://habrastorage.org/webt/zy/lo/n1/zylon1nrzso3rt7yshzjaia3krg.jpeg"></p><br><p>  Hoje, a equipe <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Micronaut</a> da Object Computing Inc (OCI) apresentou o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Predator</a> , um novo projeto de c√≥digo aberto cujo objetivo √© melhorar significativamente o tempo de execu√ß√£o e o desempenho (da mem√≥ria) do acesso a dados para microsservi√ßos e aplicativos sem servidor, sem perder a produtividade em compara√ß√£o com ferramentas como GORM e Spring Data. </p><a name="habracut"></a><br><h2 id="istoriya-instrumentov-dostupa-k-dannym">  Hist√≥rico das Ferramentas de Acesso a Dados </h2><br><p>  Podemos rastrear o hist√≥rico do modelo de reposit√≥rio de dados desde 2004, quando o Ruby on Rails saiu com o subsistema ActiveRecord, uma API que revolucionou nossa compreens√£o do acesso a dados em termos de produtividade do desenvolvedor. </p><br><p>  Em 2007, a equipe do Grails introduziu uma API semelhante ao ActiveRecord para a JVM - GORM (parte do Grails).  O GORM confiou na natureza din√¢mica do Groovy para implementar m√©todos de pesquisa no Hibernate e forneceu os mesmos benef√≠cios de produtividade para os usu√°rios da JVM. </p><br><p> Como o GORM depende da linguagem Groovy, foi criado em 2011 um projeto Spring Data que permitiu aos desenvolvedores Java definir m√©todos de pesquisa, como <code>findByTitle</code> , na interface e implementar automaticamente a l√≥gica de consulta em tempo de execu√ß√£o. </p><br><h2 id="kak-rabotayut-instrumenty-dostupa-k-dannym">  Como as ferramentas de acesso a dados funcionam </h2><br><p>  Todas as implementa√ß√µes mencionadas usam o mesmo modelo, que √© construir um metamodelo de entidades do projeto em tempo de execu√ß√£o que modela os relacionamentos entre suas classes de entidades.  No Spring Data, √© um MappingContext e, no GORM, tamb√©m √© chamado de MappingContext.  Eles s√£o constru√≠dos pela varredura de classes usando reflex√£o.  (A semelhan√ßa na nomea√ß√£o n√£o √© acidental aqui. Em 2010, trabalhei com a equipe do Spring Data para tentar recriar o GORM para Java, em um projeto que acabou se transformando no que hoje √© chamado Spring Data) </p><br><p>  Esse metamodelo √© usado para transformar uma express√£o de pesquisa, como <code>bookRepository.findByTitle("The Stand")</code> , em um modelo de consulta abstrata em tempo de execu√ß√£o, usando uma combina√ß√£o de an√°lise de express√£o regular e l√≥gica de estrutura.  Precisamos de um modelo de consulta abstrato porque o dialeto de destino da consulta √© diferente para cada banco de dados (SQL, JPA-QL, Cypher, Bson, etc.) </p><br><h2 id="podderzhka-repozitoriev-v-micronaut">  Suporte ao Reposit√≥rio Micronaut </h2><br><p>  Desde o lan√ßamento do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Micronaut, h√°</a> pouco mais de um ano, o principal recurso que nos faltava era o "GORM for Java" ou o suporte a Spring Data.  Muitos desenvolvedores est√£o apaixonados pela produtividade que essas ferramentas fornecem, bem como pela facilidade de definir as interfaces que a estrutura implementa.  Eu diria que a maior parte do sucesso do Grails e do Spring Boot pode ser atribu√≠da ao GORM e ao Spring Data, respectivamente. </p><br><p>  Para usu√°rios do Micronaut que usavam o Groovy, t√≠nhamos suporte ao GORM desde o primeiro dia, e os usu√°rios do Java e Kotlin ficaram sem nada, porque precisavam implementar reposit√≥rios por conta pr√≥pria. </p><br><p>  Seria tecnicamente poss√≠vel, e francamente mais f√°cil, simplesmente adicionar um m√≥dulo para o Micronaut que configurasse o Spring Data.  No entanto, seguindo esse caminho, fornecer√≠amos um subsistema implementado usando todos os m√©todos que o Micronaut tentava evitar: uso generalizado de proxies, reflex√£o e alto consumo de mem√≥ria. </p><br><h2 id="predstavlyaem-predator">  Apresentando Predator! </h2><br><p>  Predator, abrevia√ß√£o de Precomputed Data Repositories, usa a API Micronaut para compilar antes da execu√ß√£o (AoT, antecipadamente) para transferir um metamodelo de entidades e converter express√µes de pesquisa (como <code>findByTitle</code> ) no SQL ou JPA-QL apropriado no seu compilador .  Como resultado, a consulta executa uma camada de tempo de execu√ß√£o do programa muito fina sem reflex√£o e s√≥ resta executar a consulta e retornar os resultados. </p><br><p>  O resultado √© esmagador ... a partida a frio √© significativamente reduzida, obtemos um consumo de mem√≥ria incrivelmente baixo e uma melhoria acentuada no desempenho. </p><br><p>  Hoje, abrimos o c√≥digo-fonte do Predator sob a licen√ßa Apache 2; ele vir√° com duas implementa√ß√µes iniciais (mais recursos planejados para o futuro) para o JPA (baseado no Hibernate) e para o SQL com JDBC. </p><br><p>  A implementa√ß√£o JDBC me agrada mais, pois √© completamente independente da reflex√£o, n√£o usa proxies e carregamento de classe din√¢mica para o seu n√≠vel de acesso a dados, o que leva a um desempenho aprimorado.  A camada de tempo de execu√ß√£o √© t√£o leve que mesmo o c√≥digo do reposit√≥rio equivalente escrito √† m√£o n√£o ser√° executado mais rapidamente. </p><br><h2 id="proizvoditelnost-predator">  Predador de desempenho </h2><br><p>  Como o Predator n√£o precisa executar nenhuma transforma√ß√£o de consulta em tempo de execu√ß√£o, o ganho de desempenho √© significativo.  No mundo da utiliza√ß√£o da computa√ß√£o em nuvem, em que voc√™ paga pelo tempo que seu aplicativo executa ou pela execu√ß√£o de uma √∫nica fun√ß√£o, os desenvolvedores geralmente perdem de vista o desempenho de seus mecanismos de acesso a dados. </p><br><p>  A tabela a seguir resume as diferen√ßas de desempenho que podem ser esperadas para uma express√£o de pesquisa simples, como <code>findByTitle</code> , em compara√ß√£o com outras implementa√ß√µes.  Todos os testes foram realizados usando uma bancada de testes no Xeon iMac Pro de 8 n√∫cleos nas mesmas condi√ß√µes, os testes est√£o abertos e podem ser encontrados <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">no reposit√≥rio</a> : </p><br><div class="scrollable-table"><table><thead><tr><th>  Implementa√ß√£o </th><th>  Opera√ß√µes por segundo </th></tr></thead><tbody><tr><td>  Predator JDBC </td><td>  225K ops / s </td></tr><tr><td>  Predator jpa </td><td>  130K ops / s </td></tr><tr><td>  Jpa de dados do Spring </td><td>  90K ops / s </td></tr><tr><td>  GORM JPA </td><td>  50K ops / s </td></tr><tr><td>  Spring Data JDBC </td><td>  Localizadores n√£o suportados </td></tr></tbody></table></div><br><p>  Sim, voc√™ leu certo.  Com o Predator JDBC, voc√™ pode esperar um aumento de quase quatro vezes o desempenho em rela√ß√£o ao GORM e 2,5 vezes em rela√ß√£o ao Spring Data. </p><br><p>  E mesmo se voc√™ usar o Predator JPA, poder√° contar com mais de 2X melhorias de desempenho em compara√ß√£o com o GORM e um aumento de at√© 40% em compara√ß√£o com o Spring Data JPA. </p><br><p>  Observe a diferen√ßa no tamanho da pilha de execu√ß√£o ao usar o Predator em compara√ß√£o com as alternativas: </p><br><p>  <strong>Predador:</strong> </p><br><p><img src="https://habrastorage.org/webt/6_/5l/ns/6_5lnsvtlyng0zisy5updpoii30.png"></p><br><p>  <strong>JPA Predator:</strong> </p><br><p><img src="https://habrastorage.org/webt/dw/us/bc/dwusbcyeubxeu8l-glmhgq0r7me.png"></p><br><p>  <strong>Dados da Primavera:</strong> </p><br><p><img src="https://habrastorage.org/webt/di/m2/uv/dim2uvimrgxvs4ksszq0gsxujkq.png"></p><br><p>  <strong>GORM:</strong> </p><br><p><img src="https://habrastorage.org/webt/ad/7z/rs/ad7zrsyjfc1-fpr-cm3vqp9cmle.png"></p><br><p>  O JDBC do Predator usa apenas 15 quadros at√© o momento em que sua solicita√ß√£o √© executada, enquanto o JPA do Predator usa 30 (principalmente por causa do Hibernate), em compara√ß√£o com mais de 50 quadros de pilha no Spring Data ou GORM.  E tudo gra√ßas aos mecanismos AOP do Micronaut que n√£o usam reflex√£o. </p><br><p>  Stackraces mais curtos tamb√©m simplificam a depura√ß√£o de aplicativos.  Uma das vantagens de fazer a maior parte do trabalho durante a compila√ß√£o √© que erros podem ser detectados antes do lan√ßamento do aplicativo, o que melhora muito a experi√™ncia do desenvolvedor.  Obtemos erros de compila√ß√£o imediatamente, em vez de erros de tempo de execu√ß√£o, para os erros mais comuns. </p><br><h2 id="proverki-vremeni-kompilyacii">  Verifica√ß√µes de tempo de compila√ß√£o </h2><br><p>  A maioria das implementa√ß√µes do modelo de reposit√≥rio depende apenas da execu√ß√£o de todas as opera√ß√µes em tempo de execu√ß√£o.  Isso significa que, se o desenvolvedor cometer um erro ao definir a interface do reposit√≥rio, os erros n√£o ser√£o vis√≠veis at√© que o aplicativo seja realmente iniciado. </p><br><p>  Isso nos tira alguns dos benef√≠cios do Java para verifica√ß√£o de tipo e temos pouca experi√™ncia em dados.  Este n√£o √© o caso do Predator.  Considere o seguinte exemplo: </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@JdbcRepository</span></span>(dialect = Dialect.H2) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BookRepository</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CrudRepository</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Book</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Long</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-function"><span class="hljs-function">Book </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findByTile</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String t)</span></span></span></span>; }</code> </pre> <br><p>  Aqui <code>BookRepository</code> , declaramos uma solicita√ß√£o para um objeto chamado <code>Book</code> , que possui uma propriedade <code>title</code> .  Infelizmente, h√° um erro nesta declara√ß√£o: <code>findByTile</code> m√©todo <code>findByTile</code> vez de <code>findByTitle</code> .  Em vez de executar esse c√≥digo, o Predator n√£o permitir√° que seu c√≥digo seja compilado com uma mensagem de erro informativa: </p><br><pre> <code class="plaintext hljs">Error:(9, 10) java: Unable to implement Repository method: BookRepository.findByTile(String title). Cannot use [Equals] criterion on non-existent property path: tile</code> </pre> <br><p>  Muitos aspectos do Predator s√£o verificados no momento da compila√ß√£o, quando poss√≠vel, para garantir que um erro de tempo de execu√ß√£o n√£o seja causado por uma declara√ß√£o incorreta do reposit√≥rio. </p><br><h2 id="predator-jdbc-i-graalvm-substrate">  JDBC Predator e Substrato GraalVM </h2><br><p>  Outro motivo pelo qual o Predator deve ficar feliz √© que ele √© compat√≠vel com as imagens nativas do GraalVM Substrate e n√£o requer convers√µes complexas de bytecode durante a compila√ß√£o, ao contr√°rio do Hibernate no GraalVM. </p><br><p>  Ao eliminar completamente a reflex√£o e os proxies din√¢micos da camada de acesso a dados, o Predator simplifica bastante a cria√ß√£o de aplicativos que funcionam com dados em execu√ß√£o no GraalVM. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">O aplicativo de amostra Predator JDBC</a> √© executado no Substrate sem problemas e permite criar uma imagem nativa muito menor (25 MB a menos!) Do que o Hibernate precisa para trabalhar, gra√ßas a uma camada de tempo de execu√ß√£o muito mais fina. </p><br><p>  Vimos o mesmo resultado quando implementamos a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">compila√ß√£o de regras de Valida√ß√£o de Bean</a> para o Micronaut 1.2.  O tamanho da imagem nativa diminuiu 10 MB, assim que removemos a depend√™ncia do Hibernate Validator e o tamanho JAR em 2 MB. </p><br><p>  A vantagem aqui √© √≥bvia: ao fazer mais trabalho durante a compila√ß√£o e criar tempos de execu√ß√£o mais compactos, voc√™ obt√©m uma imagem nativa menor e um arquivo JAR, o que leva a menores e mais f√°ceis de implantar microsservi√ßos ao implantar pelo Docker.  O futuro das estruturas Java s√£o compiladores mais poderosos e tempos de execu√ß√£o menores e mais leves. </p><br><h2 id="predator-i-buduschee">  Predador e o futuro </h2><br><p>  Estamos apenas come√ßando a trabalhar com o Predator e estamos extremamente satisfeitos com as oportunidades que ele abre. </p><br><p>  Inicialmente, come√ßamos com suporte para JPA e SQL, mas no futuro voc√™ pode esperar suporte para MongoDB, Neo4J, SQL Reativo e outros bancos de dados.  Felizmente, esse trabalho √© muito mais simples, porque a maioria do Predator √© realmente baseada no c√≥digo-fonte GORM, e podemos reutilizar a l√≥gica GORM para Neo4J e a l√≥gica GORM para MongoDB para liberar essas implementa√ß√µes mais rapidamente do que o esperado. </p><br><p>  O Predator √© o ponto culminante da combina√ß√£o dos v√°rios blocos de constru√ß√£o no Micronaut Core que tornaram poss√≠vel implement√°-lo, desde as APIs do AoT, que tamb√©m s√£o usadas para gerar documenta√ß√£o do Swagger, at√© o relativamente novo suporte √† Introspec√ß√£o de Bean, que permite analisar objetos em tempo de execu√ß√£o sem reflex√£o. </p><br><p>  O Micronaut fornece blocos de constru√ß√£o para coisas incr√≠veis.  O Predator √© uma dessas coisas, e estamos apenas come√ßando a trabalhar em alguns dos recursos promissores do Micronaut 1.0. </p><br><p>  ATUALIZA√á√ÉO: Ap√≥s o an√∫ncio chocante, o assassino do Spring Data foi renomeado como Micronaut Data: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://micronaut-projects.github.io/micronaut-data/1.0.x/guide/</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt460839/">https://habr.com/ru/post/pt460839/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt460825/index.html">Introdu√ß√£o √† API do Screen Capture - Digitalize c√≥digos QR em um navegador</a></li>
<li><a href="../pt460827/index.html">Problema PGP</a></li>
<li><a href="../pt460831/index.html">Os perigos dos designers</a></li>
<li><a href="../pt460833/index.html">F√≠sica e Economia. Diferen√ßa gnoseol√≥gica e sua manifesta√ß√£o em TI</a></li>
<li><a href="../pt460837/index.html">Manual do Podcast para Iniciantes</a></li>
<li><a href="../pt460841/index.html">Os 23 melhores aplicativos de aprendizado de idiomas</a></li>
<li><a href="../pt460843/index.html">Apresentando o novo 3CX Call Flow Designer e o 3CX CRM Template Generator</a></li>
<li><a href="../pt460845/index.html">Fernando Corbato, pai do seu computador (e senha), morreu aos 93 anos</a></li>
<li><a href="../pt460847/index.html">12,3 milh√µes de WebSockets simult√¢neos</a></li>
<li><a href="../pt460849/index.html">Parte 4. Um modelo de gr√°fico para calcular fun√ß√µes l√≥gicas para processos paralelos ass√≠ncronos</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>