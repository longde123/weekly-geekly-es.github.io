<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üé≥ üßöüèæ üëî Partage d'authentification Yii1 / yii2 üëì ‚ùì ü§ôüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Cet article n'a pas de sens sans la premi√®re partie , dans laquelle il y a une r√©ponse ¬´pourquoi faire cela¬ª. 

 Il s'agit de la technique de migratio...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Partage d'authentification Yii1 / yii2</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/419999/"><img src="https://habrastorage.org/webt/ax/qo/vv/axqovvxw6vehedogcejd1obzehs.jpeg" alt="image"><br><br>  Cet article n'a pas de sens <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">sans la premi√®re partie</a> , dans laquelle il y a une r√©ponse ¬´pourquoi faire cela¬ª. <br><br>  Il s'agit de la technique de migration en douceur d'un projet de yii1 √† yii2.  Son essence est que les branches du projet sur yii1 et sa nouvelle version sur yii2 fonctionnent ensemble sur le m√™me domaine dans un h√¥te virtuel, et la migration se fait progressivement, par petites √©tapes (√† travers les pages, les contr√¥leurs, les modules, etc.). <br><br>  La premi√®re partie √©tait sur la fa√ßon d'ex√©cuter un projet nu sur yii2 dans un h√¥te virtuel existant, c'est-√†-dire  faire fonctionner les deux branches sans interf√©rer. <br><br>  Apr√®s cela commence l'√©tape la plus difficile psychologiquement: vous devez cr√©er une infrastructure minimale pour commencer.  Je distinguerais 2 t√¢ches: la conception en double et l'authentification des utilisateurs de bout en bout. <br><br>  La duplication de la conception est donn√©e en premier lieu par l'ennui.  Si vous n'avez pas de chance, vous pouvez simplement copier / restaurer l'ancien ¬´1 en 1¬ª.  Personnellement, j'ai toujours combin√© avec la refonte.  C'est-√†-dire  l'interface et le design ont √©t√© consid√©rablement mis √† jour et √† cet √©gard, le travail n'est pas stupide.  Mais ici, chacun a le sien - je porte beaucoup d'attention √† l'interface et au design, quelqu'un, au contraire, aime davantage le backend et la console.  N√©anmoins, quelles que soient les pr√©f√©rences, il n'y a aucun moyen de d√©passer cette t√¢che - vous devrez cr√©er une interface et la quantit√© de travail sera assez importante. <br><br>  L'authentification de bout en bout est un peu plus int√©ressante et il y aura moins de travail.  Comme dans le premier article, il n'y aura pas de r√©v√©lations.  Caract√®re de l'article: tutoriel pour ceux qui r√©solvent ce probl√®me pour la premi√®re fois. <br><br>  Si tel est votre cas, alors plus de d√©tails sous la coupe <br><a name="habracut"></a><br>  Tout d'abord, vous devez diviser la fonctionnalit√© entre les branches.  Parce que  Il est entendu que la phase de migration n'est qu'au d√©but, puis, tr√®s probablement, tous les travaux avec les utilisateurs (enregistrement, authentification, r√©cup√©ration de mot de passe, etc.) restent sur l'ancien site.  Et la nouvelle branche sur yii2 devrait juste voir des utilisateurs d√©j√† authentifi√©s. <br><br>  Les m√©canismes d'authentification de yii1 / yii2 sont l√©g√®rement diff√©rents et vous devez modifier le code yii2 pour qu'il puisse voir un utilisateur authentifi√©.  Parce que  les donn√©es d'authentification sont stock√©es dans la session, il vous suffit de vous mettre d'accord sur les param√®tres de lecture des donn√©es de session. <br><br>  Dans une session de yii1, cela est stock√© comme ceci: <br><br><pre><code class="php hljs">print_r($_SESSION); <span class="hljs-keyword"><span class="hljs-keyword">Array</span></span> ( [<span class="hljs-number"><span class="hljs-number">34e60</span></span>d27092d90364d1807021107e5a3__id] =&gt; <span class="hljs-number"><span class="hljs-number">123456</span></span> [<span class="hljs-number"><span class="hljs-number">34e60</span></span>d27092d90364d1807021107e5a3__name] =&gt; tester [<span class="hljs-number"><span class="hljs-number">34e60</span></span>d27092d90364d1807021107e5a3__states] =&gt; <span class="hljs-keyword"><span class="hljs-keyword">Array</span></span> ( ) )</code> </pre> <br>  Comment est-il stock√© avec vous - v√©rifiez, par exemple, que prefixKey est g√©n√©r√© diff√©remment dans diff√©rentes versions de yii1. <br><br>  Voici les donn√©es dont vous avez besoin de yii1 <br><br><pre> <code class="php hljs">Yii::app()-&gt;user-&gt;getStateKeyPrefix() Yii::app()-&gt;name Yii::app()-&gt;getBasePath() Yii::app()-&gt;getId() get_class(Yii::app()-&gt;user)</code> </pre><br>  Le moyen le plus simple consiste √† cr√©er une page de test et √† y afficher toutes les donn√©es n√©cessaires - elles seront n√©cessaires √† l'avenir. <br><br><h2>  Authentification en yii2 </h2><br>  Dans Yii2, toutes les fonctionnalit√©s dont nous avons besoin se trouvent dans le composant utilisateur ( <u>\ yii \ web \ User</u> ), qui contr√¥le l'√©tat d'authentification. <br><br><ul><li>  Dans sa m√©thode <u>getIdentity ()</u> , <u>renouvelleAuthStatus ()</u> est appel√©, dans lequel la session d'authentification est recherch√©e par la cl√© de la variable <u>$ idParam</u> (par d√©faut '__id' y est stock√©); </li><li>  Dans la variable de session, l'ID utilisateur est stock√© √† l'aide de la cl√© <u>$ idParam</u> (par exemple, depuis <u>app / model / User</u> ). </li></ul><br>  <i>L'algorithme d'authentification est <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">d√©crit en</a> d√©tail <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">dans le guide officiel</a> .</i> <br><br>  Bien s√ªr, dans yii1, les sessions sont stock√©es avec une cl√© diff√©rente.  Par cons√©quent, vous devez faire en sorte que yii2 recherche l'ID utilisateur √† l'aide des m√™mes cl√©s avec lesquelles il est stock√© dans yii1. <br><br>  <b>Pour ce faire:</b> <br><br>  1. Remplacez la classe du composant utilisateur responsable de la gestion de l'√©tat d'authentification par le n√¥tre, h√©rit√© de <u>yii / web / User</u> dans <u>config / web.php</u> <br><br><pre> <code class="php hljs"><span class="hljs-string"><span class="hljs-string">'components'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'user'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'class'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'app\models\WebUser'</span></span>, <span class="hljs-string"><span class="hljs-string">'identityClass'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'app\models\User'</span></span>, ], ]</code> </pre><br>  2. Ajustez la valeur de <u>$ idParam</u> dans <u>app \ models \ WebUser</u> . <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//  idParam (    //    ) $this-&gt;idParam = $this-&gt;getIdParamYii1(); }</span></span></code> </pre> <br>  Sous le spoiler, il y aura quelques m√©thodes qui √©muleront en quelque sorte un comportement similaire de yii1. <br><br>  En g√©n√©ral, vous pouvez simplement copier le <u>_keyPrefix</u> original (ou m√™me <u>idParam</u> tout de <u>suite</u> ) √† partir de yii1 et ne pas √©muler sa g√©n√©ration, mais ce serait comme l'instruction ¬´copier les d√©chets incompr√©hensibles¬ª. <br><br>  En effet, vous pouvez copier car _keyPrefix en yii1 est presque statique.  Cela d√©pend du nom de classe du composant utilisateur et de l'ID d'application, qui √† son tour est obtenu √† partir de l'emplacement de l'application et de son nom. <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">//   yii1  _keyPrefix $this-&gt;_keyPrefix = md5('Yii.'.get_class($this).'.'.Yii::app()-&gt;getId()); //   - ID  $this-&gt;_id=sprintf('%x',crc32($this-&gt;getBasePath().$this-&gt;name));</span></span></code> </pre><br>  Si nous nous limitons √† la t√¢che d'authentification uniquement, la copie de la valeur _keyPrefix r√©duit consid√©rablement la quantit√© de travail.  Mais j'aurai des exemples pour une utilisation plus large. <br><br><div class="spoiler">  <b class="spoiler_title">Composant utilisateur (app \ models \ WebUser)</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">app</span></span>\<span class="hljs-title"><span class="hljs-title">models</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">yii</span></span>\<span class="hljs-title"><span class="hljs-title">web</span></span>\<span class="hljs-title"><span class="hljs-title">User</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WebUser</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">User</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** *    cookies  yii2, *     yii1 */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $autoRenewCookie = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * _keyPrefix    CWebUser  Yii1 */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $_keyPrefix; <span class="hljs-comment"><span class="hljs-comment">/** *    Yii1,    */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $paramsYii1 = [ <span class="hljs-comment"><span class="hljs-comment">//    user   Yii1 'classUserComponent' =&gt; 'CWebUser', // ID  Yii1 //  ,  Yii::app()-&gt;getId() 'appId' =&gt; '', //     Yii1 'appName' =&gt; 'My Web Application', //     yii1  \Yii::getAlias('@app') 'relPath' =&gt; '../htdocs/protected', ]; public function init() { //  idParam (    //    ) $this-&gt;idParam = $this-&gt;getIdParamYii1(); } }</span></span></code> </pre><br>  Et des m√©thodes suppl√©mentaires (WebUser).  <i>S√©par√© pour une visualisation facile.</i> <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/** *     Yii1,    ID  */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getIdParamYii1</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getStateKeyPrefix() . <span class="hljs-string"><span class="hljs-string">'__id'</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/** *    Yii 1 * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getStateKeyPrefix</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_keyPrefix !== <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_keyPrefix; $class = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;paramsYii1[<span class="hljs-string"><span class="hljs-string">'classUserComponent'</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_keyPrefix = md5(<span class="hljs-string"><span class="hljs-string">'Yii.'</span></span> . $class . <span class="hljs-string"><span class="hljs-string">'.'</span></span> . <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getAppIdYii1()); } <span class="hljs-comment"><span class="hljs-comment">/** *   getId()  CApplication * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string ID  Yii1 */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getAppIdYii1</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;paramsYii1[<span class="hljs-string"><span class="hljs-string">'appId'</span></span>]) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;paramsYii1[<span class="hljs-string"><span class="hljs-string">'appId'</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;paramsYii1[<span class="hljs-string"><span class="hljs-string">'appId'</span></span>] = sprintf(<span class="hljs-string"><span class="hljs-string">'%x'</span></span>, crc32(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getBasePathYii1() . <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;paramsYii1[<span class="hljs-string"><span class="hljs-string">'appName'</span></span>])); } <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string    Yii1 */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getBasePathYii1</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $basePath = realpath(\Yii::getAlias(<span class="hljs-string"><span class="hljs-string">'@app'</span></span>) . DIRECTORY_SEPARATOR . <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;paramsYii1[<span class="hljs-string"><span class="hljs-string">'relPath'</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!$basePath) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InvalidConfigException(<span class="hljs-string"><span class="hljs-string">'basePath  yii1  .'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $basePath; }</code> </pre><br>  <i>La d√©composition des m√©thodes est un peu compliqu√©e uniquement pour " <u>convenir du format de la cl√© de session</u> ", mais elles sont utiles pour les exemples ci-dessous.</i> <br></div></div><br>  Apr√®s cela, dans une nouvelle branche sur yii2, la reconnaissance des utilisateurs pr√©c√©demment autoris√©s dans yii1 commence √† fonctionner.  Id√©alement, il faudrait s'arr√™ter √† cela, car le chemin glissant commence plus loin. <br><br><h2>  Connexion utilisateur dans yii2 </h2><br>  Une fois que le format de stockage de l'ID utilisateur dans la session a √©t√© convenu, il est possible que m√™me ¬´automatiquement¬ª la connexion de l'utilisateur fonctionne via yii2. <br><br>  <i>Je consid√®re qu'il est incorrect d'utiliser le formulaire de connexion sur yii2 en mode combat sans d√©sactiver le formulaire correspondant sur yii1, cependant, la fonctionnalit√© de base fonctionnera apr√®s un peu de coordination.</i> <br><br>  Parce que  Nous pensons que si l'enregistrement des utilisateurs et, par cons√©quent, le hachage des mots de passe, restent dans yii1, pour une connexion de travail via yii2, nous devons nous assurer que la m√©thode de validation du mot de passe enregistr√© dans yii2 peut comprendre ce qui a √©t√© hach√© et stock√© dans Yii1. <br><br>  V√©rifiez ce que font ces m√©thodes. <br><br>  Par exemple, si dans Yii2, le mod√®le utilisateur standard conditionnel User valide le mot de passe comme suit: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">validatePassword</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($password)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> \Yii::$app-&gt;getSecurity()-&gt;validatePassword($password, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;password); }</code> </pre><br>  Ensuite, regardez la <u>m√©thode</u> <u>validatePassword ($ password, $ hash)</u> de <u>yii \ base \ Security</u> (Yii2) <br><br><div class="spoiler">  <b class="spoiler_title">validatePassword ()</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">validatePassword</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($password, $hash)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!is_string($password) || $password === <span class="hljs-string"><span class="hljs-string">''</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InvalidArgumentException(<span class="hljs-string"><span class="hljs-string">'Password must be a string and cannot be empty.'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!preg_match(<span class="hljs-string"><span class="hljs-string">'/^\$2[axy]\$(\d\d)\$[\.\/0-9A-Za-z]{22}/'</span></span>, $hash, $matches) || $matches[<span class="hljs-number"><span class="hljs-number">1</span></span>] &lt; <span class="hljs-number"><span class="hljs-number">4</span></span> || $matches[<span class="hljs-number"><span class="hljs-number">1</span></span>] &gt; <span class="hljs-number"><span class="hljs-number">30</span></span> ) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InvalidArgumentException(<span class="hljs-string"><span class="hljs-string">'Hash is invalid.'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (function_exists(<span class="hljs-string"><span class="hljs-string">'password_verify'</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> password_verify($password, $hash); } $test = crypt($password, $hash); $n = strlen($test); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($n !== <span class="hljs-number"><span class="hljs-number">60</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;compareString($test, $hash); }</code> </pre></div></div><br>  Et si le hachage de mot de passe Yii1 dans le mod√®le utilisateur se fait comme ceci: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hashPassword</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($password)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> CPasswordHelper::hashPassword($password); }</code> </pre><br>  Comparez ensuite avec <u>verifyPassword ($ password, $ hash)</u> de <u>yii \ framework \ utils \ CPasswordHelper</u> <br><br><div class="spoiler">  <b class="spoiler_title">hashPassword ()</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hashPassword</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($password,$cost=</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">13</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::checkBlowfish(); $salt=<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::generateSalt($cost); $hash=crypt($password,$salt); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!is_string($hash) || (function_exists(<span class="hljs-string"><span class="hljs-string">'mb_strlen'</span></span>) ? mb_strlen($hash, <span class="hljs-string"><span class="hljs-string">'8bit'</span></span>) : strlen($hash))&lt;<span class="hljs-number"><span class="hljs-number">32</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CException(Yii::t(<span class="hljs-string"><span class="hljs-string">'yii'</span></span>,<span class="hljs-string"><span class="hljs-string">'Internal error while generating hash.'</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $hash; }</code> </pre><br></div></div><br>  Si les m√©thodes de hachage et de validation sont diff√©rentes, vous devez modifier la validation dans <u>validatePassword () √†</u> partir de <u>app \ model \ User</u> . <br><br>  √Ä partir des bo√Ætes des derni√®res versions du cadre, les hachages de mot de passe Yii1 / Yii2 sont compatibles.  Mais cela ne signifie pas du tout qu'ils seront compatibles avec vous ou qu'ils co√Øncideront √† l'avenir.  Avec un degr√© de probabilit√© √©lev√©, les m√©thodes de hachage du projet dans Yii1 et la validation dans le nouveau projet sur Yii2 seront diff√©rentes. <br><br><h2>  Connexion automatique dans Yii2 sur les cookies de yii1 </h2><br><blockquote>  Puisqu'une branche sur Yii2 sait d√©j√† comment utiliser de mani√®re transparente les donn√©es d'authentification des utilisateurs de Yii1, pourquoi ne pas configurer la connexion automatique par cookie? <br></blockquote>  Si une telle pens√©e vous arrive, alors je vous conseille de l'abandonner.  Je ne vois aucune bonne raison d'activer la connexion automatique sur Yii2 sans transf√©rer le travail de l'utilisateur (authentification, tout d'abord) sur ce fil.  C'est-√†-dire  Je veux dire le cas suivant: <br><br>  <i>l'authentification des utilisateurs est effectu√©e sur Yii1, mais la branche Yii2 devrait √™tre en mesure de s'authentifier sur les cookies stock√©s dans Yii1.</i> <i><br></i> <br>  Pour √™tre honn√™te, c'est une perversion franche.  Ce ne sera pas facile et √©l√©gant √† faire, et juste ici la ligne passe entre la t√¢che consciente et justifi√©e de la migration et l'invention des v√©los inutiles. <br><br>  La difficult√© est que dans les deux branches Yii est prot√©g√© contre les faux cookies, il est donc difficile de s'entendre sur les m√©thodes. <br><br><ul><li>  Les composants impliqu√©s dans Yii2 sont: utilisateur ( <u>\ yii \ web \ User</u> ), <u>Request</u> , <u>Security</u> + <u>CookieCollection</u> </li><li>  Dans Yii1: <u>CWebUser</u> , <u>CHttpRequest</u> , <u>CSecurityManager</u> , <u>CStatePersister</u> , <u>CCookieCollection</u> </li></ul><br>  Cependant, les cas sont diff√©rents.  Vous trouverez ci-dessous un exemple de cr√©ation d'une connexion automatique avec des v√©los. <br><br>  Dans yii2, nous nous int√©ressons √† la m√©thode <u>getIdentityAndDurationFromCookie ()</u> de <u>\ yii \ web \ User</u> .  Dans la premi√®re ligne de cette m√©thode, le cookie souhait√© doit √™tre obtenu: <br><br><pre> <code class="php hljs">$value = Yii::$app-&gt;getRequest()-&gt;getCookies()-&gt;getValue(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;identityCookie[<span class="hljs-string"><span class="hljs-string">'name'</span></span>]);</code> </pre> <br>  Mais elle ne le sera pas, car  la collection <u>Yii :: $ app-&gt; getRequest () -&gt; getCookies ()</u> sera vide, car dans <u>Request les</u> cookies sont charg√©s avec validation dans <u>loadCookies ()</u> et, bien s√ªr, cela ne passe pas. <br><br>  Le moyen le plus simple de bifurquer est le comportement standard en √©crasant <u>getIdentityAndDurationFromCookie ()</u> .  Par exemple, comme ceci: <br><br><ol><li>  T√©l√©chargez le cookie souhait√© directement depuis le superglobal $ _COOKIE afin de ne pas <s>casser</s> adapter le m√©canisme standard de chargement des cookies. <br><br>  Le nom du cookie d'identification est simplement _keyPrefix, que nous savons d√©j√† recevoir (ou copier).  Par cons√©quent, nous modifions le <u>$ identityCookie</u> standard dans <u>init ()</u> . <br></li><li>  D√©chiffrez le cookie r√©sultant "√† peu pr√®s comme dans yii1".  Comme vous le souhaitez.  Par exemple, j'ai copi√© les m√©thodes requises depuis <u>CSecurityManager</u> . </li></ol><br>  Ci-dessous, en fait, se trouve le code. <br><br><div class="spoiler">  <b class="spoiler_title">Nous travaillons en application / mod√®les / WebUser</b> <div class="spoiler_text">  1. Le nom des cookies cookie d'identit√© d√©finis conform√©ment √† yii1 <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;idParam = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getIdParamYii1(); <span class="hljs-comment"><span class="hljs-comment">//     $this-&gt;identityCookie = ['name' =&gt; $this-&gt;getStateKeyPrefix()]; }</span></span></code> </pre><br><br>  2. Ajoutez deux autres m√©thodes <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/** *    */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getIdentityAndDurationFromCookie</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $id = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getIdIdentityFromCookiesYii1(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!$id) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } $class = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;identityClass; $identity = $class::findOne($id); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($identity !== <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [<span class="hljs-string"><span class="hljs-string">'identity'</span></span> =&gt; $identity, <span class="hljs-string"><span class="hljs-string">'duration'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">0</span></span>]; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/** *  ID identity  cookies,   yii1 * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> null|integer  ID     null */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getIdIdentityFromCookiesYii1</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($_COOKIE[<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;identityCookie[<span class="hljs-string"><span class="hljs-string">'name'</span></span>]])) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; $cookieValue = $_COOKIE[<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;identityCookie[<span class="hljs-string"><span class="hljs-string">'name'</span></span>]]; <span class="hljs-comment"><span class="hljs-comment">// Cookies  yii1 ,  $utilSecurity = new UtilYii1Security($this-&gt;getBasePathYii1()); $data = $utilSecurity-&gt;validateData($cookieValue); if ($data === false) { return null; } $data = @unserialize($data); if (is_array($data) &amp;&amp; isset($data[0], $data[1], $data[2], $data[3])) { list($id, $name, $duration, $states) = $data; return $id; } return null; }</span></span></code> </pre><br></div></div><br>  Le code utilise une certaine classe <u>UtilYii1Security</u> - il s'agit d'un copier-coller modifi√© des m√©thodes n√©cessaires de <u>CSecurityManager</u> , de sorte qu'il ressemble d'une part √† l'original, mais avec des simplifications.  Par exemple, dans <u>CSecurityManager, il existe</u> plusieurs options pour g√©n√©rer HMAC (code d'authentification de message bas√© sur le hachage), qui d√©pendent de la version php et de la pr√©sence de mbstring.  Mais depuis  Il est connu que yii1 fonctionne dans le m√™me environnement que yii2, alors la t√¢che est simplifi√©e et, en cons√©quence, le code aussi. <br><br>  Parce que  il est bien clair qu'une b√©quille explicite est √©crite ici, alors pas besoin d'essayer de la rendre universelle et de lui donner une forme gracieuse, il suffit de "l'emprisonner" dans vos conditions. <br><br><div class="spoiler">  <b class="spoiler_title">UtilYii1Security.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">app</span></span>\<span class="hljs-title"><span class="hljs-title">components</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* *   CSecurityManager  Yii1, *     * */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">yii</span></span>\<span class="hljs-title"><span class="hljs-title">base</span></span>\<span class="hljs-title"><span class="hljs-title">Exception</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">yii</span></span>\<span class="hljs-title"><span class="hljs-title">base</span></span>\<span class="hljs-title"><span class="hljs-title">Model</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">yii</span></span>\<span class="hljs-title"><span class="hljs-title">base</span></span>\<span class="hljs-title"><span class="hljs-title">InvalidConfigException</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UtilYii1Security</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * ,   yii1 */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> STATE_VALIDATION_KEY = <span class="hljs-string"><span class="hljs-string">'Yii.CSecurityManager.validationkey'</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** *  ,    yii1 */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $hashAlgorithm = <span class="hljs-string"><span class="hljs-string">'sha1'</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** *   cookies */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $_validationKey; <span class="hljs-comment"><span class="hljs-comment">/** *    Yii1 */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $basePath; <span class="hljs-comment"><span class="hljs-comment">/** *      yii1 */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $stateFile; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> string $basePath -    Yii1 *        stateFile */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($basePath)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;basePath = $basePath; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;stateFile = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;basePath . DIRECTORY_SEPARATOR . <span class="hljs-string"><span class="hljs-string">'runtime'</span></span> . DIRECTORY_SEPARATOR . <span class="hljs-string"><span class="hljs-string">'state.bin'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!realpath(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;stateFile)) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InvalidConfigException(<span class="hljs-string"><span class="hljs-string">'    '</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">validateData</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($data, $key = null)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!is_string($data)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; $len = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;strlen(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;computeHMAC(<span class="hljs-string"><span class="hljs-string">'test'</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;strlen($data) &gt;= $len) { $hmac = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;substr($data, <span class="hljs-number"><span class="hljs-number">0</span></span>, $len); $data2 = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;substr($data, $len, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;strlen($data)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;compareString($hmac, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;computeHMAC($data2, $key)) ? $data2 : <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">computeHMAC</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($data, $key = null)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($key === <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) $key = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getValidationKey(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> hash_hmac(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;hashAlgorithm, $data, $key); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getValidationKey</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_validationKey !== <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_validationKey; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (($key = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;loadStateValidationKey(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::STATE_VALIDATION_KEY)) !== <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_validationKey = $key; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_validationKey; } <span class="hljs-comment"><span class="hljs-comment">//  validationKey    Yii1 private function loadStateValidationKey($key) { $content = $this-&gt;loadState(); if ($content) { $content = unserialize($content); if (isset($content[$key])) return $content[$key]; } return false; } //      Yii1 protected function loadState() { $filename = $this-&gt;stateFile; $file = fopen($filename, "r"); if ($file &amp;&amp; flock($file, LOCK_SH)) { $contents = @file_get_contents($filename); flock($file, LOCK_UN); fclose($file); return $contents; } return false; } public function compareString($expected, $actual) { $expected .= "\0"; $actual .= "\0"; $expectedLength = $this-&gt;strlen($expected); $actualLength = $this-&gt;strlen($actual); $diff = $expectedLength - $actualLength; for ($i = 0; $i &lt; $actualLength; $i++) $diff |= (ord($actual[$i]) ^ ord($expected[$i % $expectedLength])); return $diff === 0; } private function strlen($string) { return mb_strlen($string, '8bit'); } private function substr($string, $start, $length) { return mb_substr($string, $start, $length, '8bit'); } }</span></span></code> </pre><br></div></div><br><h2>  S√©quence d'actions </h2><br>  Lors de la migration de yii1 vers yii2 en termes d'authentification, j'ai suivi la s√©quence suivante: <br><br><ol><li>  Rendez l'authentification utilisateur transparente entre les branches. <br>  C'est-√†-dire  afin que la branche yii2 accepte les utilisateurs authentifi√©s avec yii1.  C'est rapide, pas difficile. <br></li><li>  Transf√©rez l'authentification (connexion utilisateur) de yii1 √† yii2. <br>  D√©sactiver en m√™me temps dans l'ancienne branche.  Notez qu'apr√®s cela, la connexion automatique pour les cookies cessera de fonctionner, car  les cookies de yii1 ne sont plus adapt√©s, et il y a encore peu de nouvelles pages sur yii2. </li><li>  Portez au moins la page principale du site vers yii2 <br>  Afin que vous puissiez utiliser la connexion automatique pour les nouveaux cookies stock√©s dans yii2. <br>  La pr√©sence d'une connexion automatique, au moins sur la connexion principale, aidera √† masquer la connexion automatique manquante sur la branche pr√©c√©dente. <br></li><li>  V√©rifiez que yii1 comprend authentifi√© dans yii2. <br>  Par la n√©gociation des cl√©s de session. <br></li><li>  Transf√©rez l'enregistrement de l'utilisateur vers yii2. <br>  Le transfert doit √™tre effectu√© avec la coordination des hachages de mot de passe pr√©c√©demment stock√©s.  Peut-√™tre conserver l'ancien format de hachage ou en introduire un nouveau, mais pour que la connexion comprenne les deux types. </li><li>  Pensez √† ajouter des utilisateurs au site, un service qui donne yii2 ¬´pr√™t √† l'emploi¬ª. <br>  Je veux dire la mise en ≈ìuvre de l'interface <u>IdentityInterface de l'</u> utilisateur, qui permet l'authentification par jeton, la r√©cup√©ration de mot de passe, etc.  Peut-√™tre avez-vous d√©j√† le harnais appropri√©, mais tout √† coup non?  C'est alors une excellente option pour am√©liorer le service avec un minimum d'effort. <br><br>  Si oui, cela conduira √† la mise en ≈ìuvre (migration) du compte personnel en yii2 (au moins partiellement). <br>  Si ¬´non¬ª, alors vous devriez toujours penser √† la migration de votre compte personnel (m√™me sans nouveaux produits). <br></li></ol><br><h4>  PS: </h4><br>  Il ne d√©crit pas toujours des solutions non ambigu√´s dans une t√¢che sp√©cifique et toutes n'ont pas besoin d'√™tre appliqu√©es. <br><br>  Ils ne sont pas d√©crits dans le but de dire ¬´fais comme moi¬ª.  Par exemple, faire l'autologinisation yii2 pour les cookies √† partir de yii1 est possible, mais, pour le dire l√©g√®rement, pas bon (et une telle b√©quille devrait √™tre justifi√©e d'une mani√®re ou d'une autre). <br><br>  Mais j'ai d√©j√† consacr√© du temps √† cette migration pas √† pas des projets et je serai content si quelqu'un, au vu de mon exp√©rience, le sauve. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr419999/">https://habr.com/ru/post/fr419999/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr419989/index.html">La Nouvelle-Z√©lande interdit les sacs en plastique</a></li>
<li><a href="../fr419991/index.html">Des drones autonomes conduiront des troupeaux d'oiseaux depuis les a√©roports</a></li>
<li><a href="../fr419993/index.html">Entretien de TypeScript: 20 questions et r√©ponses</a></li>
<li><a href="../fr419995/index.html">Une √©tude d'Ivy, le nouveau compilateur angulaire</a></li>
<li><a href="../fr419997/index.html">Analyser le mod√®le "Module" en JavaScript</a></li>
<li><a href="../fr420001/index.html">Pr√©sentation de 3CX v15.5 Update 6 BETA et WebRTC Browser Softphone</a></li>
<li><a href="../fr420003/index.html">Fen√™tre avec boutons sur JavaFX:</a></li>
<li><a href="../fr420005/index.html">La surveillance vid√©o non professionnelle de l'appartement est divertissante et peu co√ªteuse</a></li>
<li><a href="../fr420007/index.html">FidgetPen, lampe bizarre et cubes s√©parateurs: d√©couvrir Allocacoc</a></li>
<li><a href="../fr420009/index.html">Les subtilit√©s de la conception des produits</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>