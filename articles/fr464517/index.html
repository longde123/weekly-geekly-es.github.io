<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ò¢Ô∏è üíù üßìüèæ Nouvelles cartes CUBA üêò ‚ù§Ô∏è ‚úíÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="L'utilisation de donn√©es g√©ospatiales et de cartes cartographiques fait partie int√©grante de nombreuses applications commerciales. Il peut s'agir de s...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Nouvelles cartes CUBA</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/haulmont/blog/464517/"><p><img src="https://habrastorage.org/getpro/habr/post_images/2b4/8ca/a70/2b48caa7053d14a2edd9cfaecc6b6fb8.png" alt="des cartes"></p><br><p>  L'utilisation de donn√©es g√©ospatiales et de cartes cartographiques fait partie int√©grante de nombreuses applications commerciales.  Il peut s'agir de syst√®mes d'information urbains et r√©gionaux, d'applications pour l'industrie p√©troli√®re et gazi√®re, de syst√®mes de gestion des infrastructures de transport, ainsi que de services de livraison et bien d'autres.  Dans notre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">plate-forme CUBA,</a> pour cr√©er de telles applications, en plus des fonctionnalit√©s de base fournies, il existe un ensemble assez √©tendu de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">modules compl√©mentaires et de composants</a> .  L'un d'eux est <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Charts and Maps</a> , qui, en plus d'afficher des graphiques, vous permet d'int√©grer Google maps dans la partie visuelle de l'application.  L'ann√©e derni√®re, Google a mis √† jour les conditions d'utilisation de ses services de cartographie, ce qui a entra√Æn√© une augmentation des co√ªts, et a √©galement introduit la condition de la pr√©sence obligatoire d'un profil de paiement pour l'utilisation de l'API.  Ces circonstances ont amen√© la plupart de nos clients √† penser √† d'autres fournisseurs de cartes et nous avons √©t√© invit√©s √† d√©velopper un nouveau composant de carte. </p><a name="habracut"></a><br><p>  Nous sommes maintenant heureux de vous pr√©senter un tout nouveau composant - <strong><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">CUBA Maps</a></strong> .  CUBA Maps compl√®te la fonctionnalit√© de l'application avec une repr√©sentation visuelle et des outils intuitifs pour l'√©dition des donn√©es g√©ospatiales.  Le composant fonctionne avec les donn√©es raster et vectorielles.  Vous pouvez utiliser n'importe quel fournisseur de carte compatible avec le protocole Web Map Service ou fournir des vignettes au format XYZ en tant que donn√©es raster.  Pour travailler avec des donn√©es vectorielles, le composant utilise des types de donn√©es g√©om√©triques (point, polyligne, polygone) de la biblioth√®que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">JTS Topology Suite (JTS)</a> - la biblioth√®que Java la plus populaire pour travailler avec des donn√©es g√©ospatiales.  Le composant fournit tous les outils n√©cessaires pour cr√©er un syst√®me d'information g√©ographique complet bas√© sur CUBA. </p><br><p>  Dans cet article, nous parlerons des nouvelles fonctionnalit√©s offertes par le composant Maps, et le comparerons √©galement avec notre composant de carte pr√©c√©dent. </p><br><h2 id="struktura-osnovannaya-na-sloyah">  Structure bas√©e sur les couches </h2><br><p>  Le composant prend en charge la structure multicouche traditionnelle qui est largement utilis√©e dans les syst√®mes d'information g√©ographique professionnels.  Les couches sont principalement divis√©es en raster et vecteur.  <em>Les couches raster sont</em> constitu√©es d'images raster, tandis que les <em>couches</em> vectorielles contiennent des g√©om√©tries vectorielles. </p><br><p>  Le composant prend en charge les types de calques suivants: </p><br><ul><li>  <em>La couche de tuiles</em> affiche les tuiles fournies par les services de tuiles au format XYZ. </li><li>  <em>La couche Web Map Service (WMS)</em> affiche les images fournies par les services WMS. </li><li>  <em>La couche vectorielle</em> contient des g√©o-objets (entit√©s avec des attributs g√©om√©triques). </li></ul><br><p>  Ces couches sont des √©l√©ments structurels des cartes.  Par exemple, la couche inf√©rieure peut √™tre une carte de base compos√©e de tuiles, la deuxi√®me couche peut contenir des polygones d√©crivant des unit√©s territoriales, par exemple des r√©gions, et la couche sup√©rieure peut contenir des points g√©ographiques (localisation des clients, des magasins, etc.).  En superposant ces couches les unes sur les autres, nous obtenons la carte finale: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/b16/3b2/5f7/b163b25f702af4f76363340b899139b4.png" alt="couches"></p><br><p>  Gr√¢ce √† cette approche, vous pouvez cr√©er des cartes clairement structur√©es avec n'importe quel contenu. </p><br><p> CUBA Maps fournit un nouveau composant visuel - <code>GeoMap</code> .  Dans le descripteur XML du composant, vous pouvez d√©finir les param√®tres de base de la carte, ainsi qu'un ensemble de couches affich√©es.  Un exemple d'une telle configuration: </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:geoMap</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"map"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"600px"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"100%"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">center</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"37.615, 55.752"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">zoom</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"10"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:layers</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">selectedLayer</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"addressLayer"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:tile</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"tiles"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">tileProvider</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"maps_OpenStreetMap"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:vector</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"territoryLayer"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dataContainer</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"territoryDc"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:vector</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"addressLayer"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dataContainer</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"addressDc"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">editable</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:layers</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:geoMap</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Cette approche vous permet d'obtenir plus de flexibilit√© qui faisait d√©faut dans les <strong>graphiques et les cartes</strong> : </p><br><ul><li>  <em>Superposition.</em>  Cette structure vous permet de cr√©er des cartes avec n'importe quel contenu, par exemple, de combiner des tuiles fournies par divers services. </li><li>  <em>Les couches fournissent une abstraction qui rassemble des objets homog√®nes.</em>  Dans le composant <strong>Graphiques et cartes</strong> , tout le contenu de la carte (par exemple, des points, des polygones, etc.) a √©t√© vid√© dans un tas commun dans le composant d'interface utilisateur.  Afin de structurer ces objets, les √©quipes de projet ont d√ª √©crire une logique suppl√©mentaire. </li><li>  <em>Une m√©thode d√©clarative pour d√©crire les couches.</em>  Comme le montre l'exemple ci-dessus, vous pouvez sp√©cifier compl√®tement la structure de la carte (ensemble de couches) dans le descripteur XML.  Dans de nombreux cas, cela suffit pour ne pas impl√©menter de logique suppl√©mentaire dans le contr√¥leur d'√©cran.  √Ä l'aide de <strong>graphiques et de cartes,</strong> il √©tait presque impossible de faire sans √©crire de logique suppl√©mentaire. </li></ul><br><p>  L'utilisation de couches de tuiles ou de WMS vous permet de travailler avec n'importe quel fournisseur de cartes pr√©f√©r√©.  Vous n'√™tes pas li√© √† un fournisseur sp√©cifique, comme c'√©tait le cas dans les <strong>graphiques et les cartes</strong> . </p><br><p>  Les couches vectorielles simplifient consid√©rablement l'affichage, l'√©dition interactive et le dessin des g√©o-objets sur la carte. </p><br><p>  Il convient √©galement de noter que le composant visuel de <code>GeoMap</code> par d√©faut une couche auxiliaire sp√©ciale - <strong>Canvas</strong> .  Canvas fournit une API pratique pour afficher et dessiner des g√©om√©tries (points, polylignes, polygones) sur une carte.  Nous couvrirons des exemples d'utilisation de Canvas plus loin dans l'article. </p><br><h2 id="geo-obekty">  Objets g√©ographiques </h2><br><p>  Supposons que nous ayons une entit√© qui contient un attribut associ√© √† la g√©om√©trie (point, polyligne, polygone).  Nous appellerons cette entit√© un <em>g√©o-objet</em> .  Ainsi, le composant simplifie consid√©rablement le travail avec les g√©o-objets. </p><br><p>  Par exemple, consid√©rez l' <strong>adresse de l'</strong> objet g√©ographique: </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Entity</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Address</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StandardEntity</span></span></span><span class="hljs-class"> </span></span>{ ... <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"LOCATION"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@Geometry</span></span> <span class="hljs-meta"><span class="hljs-meta">@MetaProperty</span></span>(datatype = <span class="hljs-string"><span class="hljs-string">"GeoPoint"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@Convert</span></span>(converter = CubaPointWKTConverter.class) <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> Point location; ... }</code> </pre> <br><p>  Il a un attribut d' <code>location</code> de type <code>org.locationtech.jts.geom.Point</code> de la biblioth√®que JTS Topology Suite (JTS).  Le composant prend en charge les types g√©om√©triques suivants de JTS: </p><br><ul><li>  <code>org.locationtech.jts.geom.Point</code> - point. </li><li>  <code>org.locationtech.jts.geom.LineString</code> - polyligne. </li><li>  <code>org.locationtech.jts.geom.Polygon</code> - polygone. </li></ul><br><p>  L'attribut d' <code>location</code> est balis√© avec l'annotation <code>@Geometry</code> .  Cette annotation annonce que la valeur de cet attribut doit √™tre utilis√©e lors de l'affichage d'un g√©o-objet sur la carte.  L'attribut est √©galement marqu√© des annotations suivantes: </p><br><ul><li>  <code>@MetaProperty</code> - dans ce cas, utilis√© pour indiquer l'attribut de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">type de donn√©es</a> .  L'interface de <code>Datatype</code> utilis√©e par le framework CUBA pour convertir des valeurs vers et depuis une cha√Æne. </li><li>  <code>@Convert</code> - D√©finit un convertisseur JPA pour un attribut persistant.  Le convertisseur JPA convertit les valeurs d'attribut entre ses repr√©sentations dans la base de donn√©es et le code Java.  Le composant fournit un ensemble de types de donn√©es spatiales et de convertisseurs JPA.  Plus d'informations sont disponibles dans la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation des</a> composants.  Vous pouvez √©galement utiliser votre propre impl√©mentation du convertisseur JPA, qui permet de travailler avec diff√©rentes sources de donn√©es spatiales (par exemple, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">PostGIS</a> ). </li></ul><br><p>  Ainsi, pour transformer une entit√© en g√©o-objet, vous devez d√©finir un attribut du type de g√©om√©trie JTS et l'annoter avec <code>@Geometry</code> .  Il existe une autre option - cr√©er un attribut non persistant en fournissant des m√©thodes getter / setter.  Cela peut √™tre utile si vous ne souhaitez pas modifier le mod√®le de donn√©es et r√©g√©n√©rer les scripts DDL. </p><br><p>  Par exemple, consid√©rez l' <strong>adresse de</strong> l'entit√© avec des attributs distincts pour la latitude et la longitude: </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.haulmont.addon.maps.gis.utils.GeometryUtils; ... <span class="hljs-meta"><span class="hljs-meta">@Entity</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Address</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StandardEntity</span></span></span><span class="hljs-class"> </span></span>{ ... <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"LATITUDE"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> Double latitude; <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"LONGITUDE"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> Double longitude; ... <span class="hljs-meta"><span class="hljs-meta">@Geometry</span></span> <span class="hljs-meta"><span class="hljs-meta">@MetaProperty</span></span>(datatype = <span class="hljs-string"><span class="hljs-string">"GeoPoint"</span></span>, related = {<span class="hljs-string"><span class="hljs-string">"latitude"</span></span>, <span class="hljs-string"><span class="hljs-string">"longitude"</span></span>}) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Point </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getLocation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (getLatitude() == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> || getLongitude() == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> GeometryUtils.createPoint(getLongitude(), getLatitude()); } <span class="hljs-meta"><span class="hljs-meta">@Geometry</span></span> <span class="hljs-meta"><span class="hljs-meta">@MetaProperty</span></span>(datatype = <span class="hljs-string"><span class="hljs-string">"GeoPoint"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setLocation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Point point)</span></span></span><span class="hljs-function"> </span></span>{ Point prevValue = getLocation(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (point == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { setLatitude(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); setLongitude(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { setLatitude(point.getY()); setLongitude(point.getX()); } propertyChanged(<span class="hljs-string"><span class="hljs-string">"location"</span></span>, prevValue, point); } ... }</code> </pre> <br><p>  Si vous d√©cidez d'utiliser cette approche, assurez-vous que la m√©thode <code>propertyChanged</code> est appel√©e dans le setter, car le composant r√©pond √† cet √©v√©nement en mettant √† jour la g√©om√©trie sur la carte. </p><br><p>  Maintenant que nous avons pr√©par√© la classe de notre g√©o-objet, nous pouvons ajouter des instances de cette classe √† la couche vectorielle.  <em>Une couche vectorielle</em> est essentiellement un √©l√©ment de connexion entre des donn√©es (g√©o-objets) et une carte.  Pour connecter des g√©o-objets √† une couche, vous devez transf√©rer le conteneur de donn√©es ou, dans le cas d'√©crans obsol√®tes (jusqu'√† la version 7 de CUBA), la source de donn√©es vers la couche vectorielle.  Cela peut √™tre fait dans un descripteur XML: </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:geoMap</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"map"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:layers</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:vector</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"addressesLayer"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dataContainer</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"addressesDc"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:layers</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:geoMap</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Par cons√©quent, les instances de classe <code>Address</code> contenues dans le conteneur addressDc seront affich√©es sur la carte. </p><br><p>  Consid√©rons une t√¢che √©l√©mentaire: cr√©er un √©cran pour √©diter un g√©o-objet avec une carte, o√π vous pouvez √©diter la g√©om√©trie de l'objet.  Pour r√©soudre le probl√®me, vous devez d√©clarer le composant visuel de <code>GeoMap</code> dans le descripteur XML de l'√©cran d'√©dition et ajouter une couche vectorielle associ√©e au conteneur contenant le g√©o-objet √©dit√©: </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:geoMap</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"map"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"600px"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"100%"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">center</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"37.615, 55.752"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">zoom</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"10"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:layers</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">selectedLayer</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"addressLayer"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:tile</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">...</span></span></span><span class="hljs-tag">"/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:vector</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"addressLayer"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dataContainer</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"addressDc"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">editable</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:layers</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:geoMap</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Si vous marquez la couche vectorielle comme modifiable, l'√©dition interactive du g√©o-objet sur la carte est activ√©e.  Si la g√©om√©trie de l'objet est vide, la carte passe automatiquement en mode dessin.  Comme vous pouvez le voir, pour r√©soudre le probl√®me, il suffit de d√©clarer une couche vectorielle sur la carte et de lui passer le conteneur de donn√©es / source de donn√©es. </p><br><p>  C‚Äôest tout.  Si nous utilisions des <strong>graphiques et des cartes</strong> pour r√©soudre le m√™me probl√®me, nous aurions √† √©crire beaucoup de code dans le contr√¥leur d'√©cran pour fournir des fonctionnalit√©s similaires.  Avec le nouveau composant de <strong>Maps, la</strong> r√©solution de tels probl√®mes est beaucoup plus simple. </p><br><h2 id="canvas">  Toile </h2><br><p>  Il y a des moments o√π vous ne devez pas travailler avec des entit√©s.  Au lieu de cela, vous voulez une API simple pour ajouter et dessiner des g√©om√©tries sur une carte, comme c'√©tait le cas dans les <strong>graphiques et les cartes</strong> .  Pour cela, le composant visuel <code>GeoMap</code> a une couche sp√©ciale - <em>Canvas</em> .  Il s'agit d'une couche auxiliaire, qui est sur la carte par d√©faut et qui fournit une API simple pour ajouter et dessiner des g√©om√©tries sur la carte.  Vous pouvez <code>map.getCanvas()</code> carte de <code>map.getCanvas()</code> en appelant la m√©thode <code>map.getCanvas()</code> . </p><br><p>  Ensuite, nous examinerons quelques t√¢ches simples, comment elles ont √©t√© r√©solues dans les <strong>graphiques et les cartes</strong> et comment faire de m√™me √† l'aide de Canvas. </p><br><h3 id="otobrazhenie-geometriy-na-karte">  Afficher les g√©om√©tries sur une carte </h3><br><p>  Dans les <strong>graphiques et les cartes, les</strong> objets g√©om√©triques ont √©t√© cr√©√©s √† l'aide du composant visuel de la carte, utilis√© comme usine, puis ajout√©s √† la carte: </p><br><pre> <code class="java hljs">Marker marker = map.createMarker(); GeoPoint position = map.createGeoPoint(lat, lon); marker.setPosition(position); map.addMarker(marker);</code> </pre> <br><p>  Le nouveau composant <strong>Maps</strong> fonctionne directement avec les classes de la biblioth√®que JTS: </p><br><pre> <code class="java hljs">CanvasLayer canvasLayer = map.getCanvas(); Point point = address.getLocation(); canvasLayer.addPoint(point);</code> </pre> <br><h3 id="redaktirovanie-geometriy">  Modification de la g√©om√©trie </h3><br><p>  Dans les <strong>graphiques et les cartes,</strong> vous pouvez d√©signer la g√©om√©trie comme modifiable.  Lorsque de telles g√©om√©tries ont √©t√© modifi√©es via l'interface utilisateur, les √©v√©nements correspondants ont √©t√© appel√©s: </p><br><pre> <code class="java hljs">Marker marker = map.createMarker(); GeoPoint position = map.createGeoPoint(lat, lon); marker.setPosition(position); marker.setDraggable(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); map.addMarker(marker); map.addMarkerDragListener(event -&gt; { <span class="hljs-comment"><span class="hljs-comment">// do something });</span></span></code> </pre> <br><p>  Dans le composant <strong>Maps</strong> , lors de l'ajout d'une g√©om√©trie JTS √† Canvas, la m√©thode correspondante renvoie un objet sp√©cial qui est une repr√©sentation de cette g√©om√©trie sur la carte: <code>CanvasLayer.Point</code> , <code>CanvasLayer.Polyline</code> ou <code>CanvasLayer.Polygon</code> .  Cet objet poss√®de une interface fluide pour d√©finir divers param√®tres de g√©om√©trie, il peut √©galement √™tre utilis√© pour s'abonner √† des √©v√©nements li√©s √† la g√©om√©trie ou pour supprimer la g√©om√©trie d'un canevas. </p><br><pre> <code class="java hljs">CanvasLayer canvasLayer = map.getCanvas(); CanvasLayer.Point location = canvasLayer.addPoint(address.getLocation()); location.setEditable(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) .setPopupContent(address.getName()) .addModifiedListener(modifiedEvent -&gt; address.setLocation(modifiedEvent.getGeometry()));</code> </pre> <br><h3 id="risovanie-geometriy">  Dessin g√©om√©trique </h3><br><p>  Dans les anciens <strong>tableaux et cartes</strong> compl√©mentaires, il y avait un composant auxiliaire - <code>DrawingOptions</code> .  Il a √©t√© utilis√© pour activer la possibilit√© de dessiner sur la carte.  Une fois la g√©om√©trie dessin√©e, l'√©v√©nement correspondant a √©t√© d√©clench√©: </p><br><pre> <code class="java hljs">DrawingOptions options = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DrawingOptions(); PolygonOptions polygonOptions = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PolygonOptions(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, <span class="hljs-string"><span class="hljs-string">"#993366"</span></span>, <span class="hljs-number"><span class="hljs-number">0.6</span></span>); ControlOptions controlOptions = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ControlOptions( Position.TOP_CENTER, Arrays.asList(OverlayType.POLYGON)); options.setEnableDrawingControl(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); options.setPolygonOptions(polygonOptions); options.setDrawingControlOptions(controlOptions); options.setInitialDrawingMode(OverlayType.POLYGON); map.setDrawingOptions(options); map.addPolygonCompleteListener(event -&gt; { <span class="hljs-comment"><span class="hljs-comment">//do something });</span></span></code> </pre> <br><p>  Le composant Maps rend la m√™me chose beaucoup plus facile.  Le nouveau canevas de <strong>cartes</strong> contient un ensemble de m√©thodes pour dessiner des g√©om√©tries.  Par exemple, pour dessiner un polygone, utilisez la m√©thode <code>canvas.drawPolygon()</code> .  Apr√®s avoir appel√© cette m√©thode, la carte passe en mode de dessin de polygone.  La m√©thode accepte la fonction <code>Consumer&lt;CanvasLayer.Polygon&gt;</code> , dans laquelle vous pouvez effectuer des actions suppl√©mentaires avec le polygone dessin√©. </p><br><pre> <code class="java hljs">canvasLayer.drawPolygon(polygon -&gt; { territory.setPolygon(polygon.getGeometry()); });</code> </pre> <br><h2 id="instrumenty-dlya-geo-analiza">  Outils de g√©o-analyse </h2><br><h3 id="klasterizaciya">  Regroupement </h3><br><p>  Un autre outil utile pr√©sent dans le nouveau composant Maps est le regroupement de points.  Si la couche se compose d'un grand nombre de points, vous pouvez activer le clustering pour regrouper les points voisins en clusters afin que la carte soit plus nette et mieux per√ßue: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/e6c/166/4d7/e6c1664d7e9092880dfcf13cc4dca58c.jpg" alt="cluster"></p><br><p>  Le clustering est activ√© en ajoutant la balise de <code>cluster</code> √† l'int√©rieur de la balise <code>vector</code> dans le descripteur XML: </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:vector</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"locations"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dataContainer</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"locationsDc"</span></span></span><span class="hljs-tag"> &gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:cluster</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:vector</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Vous pouvez √©galement activer le clustering en fonction des poids ponctuels.  Le poids du point est la valeur de l'attribut sp√©cifi√© dans le param√®tre <code>weightProperty</code> . </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:vector</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"orders"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dataContainer</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ordersDc"</span></span></span><span class="hljs-tag"> &gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:cluster</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">weightProperty</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"amount"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:vector</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><h3 id="teplovye-karty">  Cartes thermiques </h3><br><p>  Les cartes thermiques sont une repr√©sentation visuelle de la densit√© des donn√©es sur plusieurs emplacements g√©ographiques.  Le composant visuel de GeoMap contient une m√©thode pour ajouter une carte thermique: <code>addHeatMap(Map&lt;Point, Double&gt; intensityMap)</code> . </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/722/10b/289/72210b289dd04fcf41cc4ebec062c2d5.jpg" alt="carte thermique"></p><br><h2 id="zaklyuchenie">  Conclusion </h2><br><p>  Le traitement, l'analyse et la visualisation des donn√©es g√©ospatiales sont un √©l√©ment essentiel de nombreuses applications commerciales.  Le composant <strong>CUBA Maps</strong> fournira √† votre application CUBA tous les outils n√©cessaires pour impl√©menter cette fonctionnalit√©. </p><br><p>  Une structure bas√©e sur les couches aide √† cr√©er des cartes avec n'importe quel contenu.  Avec les couches de tuiles / WMS, vous pouvez utiliser n'importe quel fournisseur dont vous avez besoin comme carte de base.  Les couches vectorielles vous permettent de travailler efficacement avec des ensembles de g√©o-objets homog√®nes.  Canvas fournit une API simple pour afficher et dessiner des g√©om√©tries sur une carte. </p><br><p>  Le composant fonctionne avec des types spatiaux de la biblioth√®que JTS, ce qui le rend compatible avec de nombreux autres cadres (par exemple, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">GeoTools</a> ) pour r√©soudre un large √©ventail de t√¢ches li√©es au traitement et √† l'analyse des donn√©es g√©ographiques. </p><br><p>  Nous esp√©rons que vous appr√©cierez le composant.  En attente de vos commentaires! </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr464517/">https://habr.com/ru/post/fr464517/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr464503/index.html">Correspondance de mot de passe Wi-Fi avec aircrack-ng</a></li>
<li><a href="../fr464509/index.html">Le livre "Grok deep learning"</a></li>
<li><a href="../fr464511/index.html">Comment collecter des cohortes d'utilisateurs sous forme de graphiques dans Grafana [+ image docker avec un exemple]</a></li>
<li><a href="../fr464513/index.html">Duffle: Transformer de XD Design</a></li>
<li><a href="../fr464515/index.html">Comment faire des e-mails et ne pas g√¢cher: conseils pratiques</a></li>
<li><a href="../fr464523/index.html">Syst√®mes de paiement (PSP) pour l'informatique: nous jouons gros</a></li>
<li><a href="../fr464525/index.html">Votre propre convertisseur JSON ou un peu plus sur ExpressionTrees</a></li>
<li><a href="../fr464529/index.html">Pour la publicit√© contextuelle par les noms des concurrents peut d√©sormais √™tre condamn√© √† une amende de 500 000 roubles</a></li>
<li><a href="../fr464535/index.html">D√©tails sur l'appareil et les fonctions du scooter √©lectrique KickScooter T60</a></li>
<li><a href="../fr464537/index.html">Arduino DIY Demonic Carrousel</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>