<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🥂 ⚕️ 👨🏻‍🔬 Revue indépendante de PVS-Studio (Linux, C ++) 👨🏻‍🚒 🕕 🌰</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="J'ai vu la publication que PVS a appris à analyser sous Linux et j'ai décidé d'essayer ses projets. Et c'est ce qui en est sorti. 

 Table des matière...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Revue indépendante de PVS-Studio (Linux, C ++)</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/463027/"><p>  J'ai vu la publication que PVS a appris à analyser sous Linux et j'ai décidé d'essayer ses projets.  Et c'est ce qui en est sorti. </p><a name="habracut"></a><br><a name="contents"></a><br><h2>  Table des matières </h2><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Avantages</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Inconvénients</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Résumé</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Postface</a> </li></ol><br><a name="pros"></a><br><h2>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Avantages</a> </h2><br><h3 id="otzyvchivaya-podderzhka">  Support réactif </h3><br><p>  J'ai demandé une clé d'essai, ils me l'ont envoyée le même jour. </p><br><h3 id="dostatochno-ponyatnaya-dokumentaciya">  Documentation suffisamment claire </h3><br><p>  Il a été possible de démarrer l'analyseur sans aucun problème.  L'aide pour les commandes de la console est également disponible (bien qu'il y ait des plaintes, voir la section <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Contre</a> ). </p><br><h3 id="vozmozhnost-mnogopotochnogo-analiza">  Capacité d'analyse multithread </h3><br><p> L'analyseur possède une option «standard» <code>-j</code> , qui permet d'analyser en parallèle dans plusieurs tâches.  Cela fait gagner beaucoup de temps. </p><br><h3 id="horoshaya-vizualizaciya">  Bonne visualisation </h3><br><p>  De nombreux formats de sortie différents, du texte au petit museau Web.  <a href="">La face Web est pratique, concise, avec des conseils à côté des lignes du code et des liens vers les descriptions des diagnostics</a> . </p><br><h3 id="prostaya-integraciya-v-sborku">  Intégration facile à l'assemblage </h3><br><p>  Toute la documentation est sur leur site web, je peux seulement dire que si votre projet est construit en utilisant CMake, alors tout est très simple. </p><br><h3 id="horoshie-opisaniya-diagnostik">  Bonnes descriptions diagnostiques </h3><br><p>  Si vous générez une sortie en mode <code>fullhtml</code> , chaque message contient un lien vers une description du diagnostic, avec des explications, des exemples de code et des liens supplémentaires. </p><br><a name="cons"></a><br><h2>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Inconvénients</a> </h2><br><h3 id="neznanie-analizatorom-yazyka-c">  Ignorance de l'analyseur de langage C ++ </h3><br><p>  Malheureusement, PVS se trompe parfois dans la syntaxe et génère de faux messages positifs avec un code parfaitement correct. </p><br><p>  Par exemple, il existe une fonction qui renvoie <code>void</code> : </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> T&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">auto</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">copy</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params"> * source, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params"> * destination)</span></span></span><span class="hljs-function"> -&gt; </span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-built_in">std</span></span></span><span class="hljs-function">::enable_if_t &lt; </span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-built_in">std</span></span></span><span class="hljs-function">::is_copy_constructible&lt;T&gt;::value &gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> (destination) T(*<span class="hljs-keyword"><span class="hljs-keyword">static_cast</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> T *&gt;(source)); }</code> </pre> <br><p>  Oui, le mot-clé <code>auto</code> peut signifier <code>void</code> , c'est pourquoi <em>auto</em> .  Mais PVS a émis ces messages: </p><br><pre> <code class="plaintext hljs">dynamic_tuple_management.hpp:29:1: error: V591 Non-void function should return a value. dynamic_tuple_management.hpp:29:1: error: V2542 Function with a non-void return type should return a value from all exit paths.</code> </pre> <br><h3 id="ochen-tormoznutyy-sayt">  Site très lent </h3><br><p>  Oui, dans le museau Web à côté de chaque message, il y a un lien vers la description correspondante du diagnostic avec des exemples.  Mais lorsque vous cliquez sur le lien, vous devez attendre assez longtemps, et parfois cela arrive <a href="">504 Gateway Time-out</a> . </p><br><h3 id="yazyk">  La langue </h3><br><p>  Toutes les descriptions sont en russe, c'est super.  Mais les liens du rapport mènent toujours à la version anglaise.  Ce serait bien de pouvoir changer de langue pour que vous puissiez voir les diagnostics immédiatement en russe.  Je n'ai pas trouvé une telle opportunité dans l'interface. </p><br><h3 id="neudobno-rabotat-s-urovnyami-diagnostik-cherez-konsol">  Inconvénient de travailler avec des niveaux de diagnostic via la console </h3><br><p>  Pour commencer, les deux commandes utilisées ( <code>pvs-studio-analyzer</code> et <code>plog-converter</code> ) ont des formats de travail de diagnostic différents. </p><br><p>  L'aide de <code>pvs-studio-analyzer</code> lit comme suit: </p><br><pre> <code class="plaintext hljs">-a [MODE], --analysis-mode [MODE] MODE defines the type of warnings: 1 - 64-bit errors; 2 - reserved; 4 - General Analysis; 8 - Micro-optimizations; 16 - Customers Specific Requests; 32 - MISRA. Modes can be combined by adding the values Default: 4</code> </pre> <br><p>  Pendant longtemps, j'ai essayé de comprendre où <em>ajouter</em> ("ajouter les valeurs") des clés.  J'ai essayé de lister avec une virgule: </p><br><pre> <code class="plaintext hljs">pvs-studio-analyzer analyze ... -a 1,4,16</code> </pre> <br><p>  J'ai essayé d'enregistrer la clé plusieurs fois: </p><br><pre> <code class="plaintext hljs">pvs-studio-analyzer analyze ... -a 1 -a 4 -a 16</code> </pre> <br><p>  Et c'est seulement alors que j'ai réalisé que ce sont des masques de bits!  Et vous devez <em>résumer</em> , pas <em>ajouter de</em> valeurs.  Par exemple, pour obtenir des diagnostics généraux, des diagnostics pour les microoptimisations et MISRA, vous devez les additionner (4 + 8 + 32 = 44): </p><br><pre> <code class="plaintext hljs">pvs-studio-analyzer analyze ... -a 44</code> </pre> <br><p>  L'utilisation de masques de bit dans les interfaces utilisateur est généralement une mauvaise idée.  Tout cela pourrait être résumé à l'intérieur, et l'utilisateur a défini un ensemble de drapeaux. </p><br><p>  En outre, il existe également l' <code>plog-converter</code> , qui génère des informations lisibles par l'homme sur l'analyse statique.  Elle a d'autres problèmes. </p><br><p>  Aide pour les rapports du programme <code>plog-converter</code> : </p><br><pre> <code class="plaintext hljs">-a, --analyzer Specifies analyzer(s) and level(s) to be used for filtering, ie 'GA:1,2;64:1;OP:1,2,3;CS:1;MISRA:1,2' Default: GA:1,2</code> </pre> <br><p>  Une sorte de «niveaux» est apparu ici, qui n'avait jamais été vu auparavant, et je n'ai rien trouvé à leur sujet dans la documentation. </p><br><p>  En général, ce n'est pas clair.  Par conséquent, j'ai tout réglé au maximum. </p><br><h3 id="kucha-bestolkovoy-rugani-na-catch">  Un tas de stupides jurons à Catch </h3><br><p>  Deux des trois projets que j'ai analysés utilisent la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">bibliothèque de</a> tests unitaires <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Catch2</a> .  Et la part du lion des messages (!!! 90 sur 138 dans un et 297 sur 344 dans un autre !!!) ont la forme suivante: </p><br><p><img src="https://habrastorage.org/webt/uh/fi/6g/uhfi6gcehf00hu0sarfkm9bnnqa.png" alt="Catch2"></p><br><h3 id="ne-uchityvaet-mnogopotochnost">  Ne considère pas le multithreading </h3><br><p>  Il existe de nombreux faux positifs sur les variables supposées immuables ou les boucles infinies, alors que travailler avec ces variables provient de différents threads, et si ce n'était pas le cas, les tests unitaires ne fonctionneraient pas. </p><br><p><img src="https://habrastorage.org/webt/xn/rs/zl/xnrszlmyu3m8mhyu6dgkrkk0bty.png" alt="Multithreading"></p><br><p>  Cependant, un analyseur statique peut-il prendre cela en compte?  Je ne sais pas. </p><br><a name="summary"></a><br><h2>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Résumé</a> </h2><br><p>  PVS n'a pas trouvé une seule véritable erreur dans mes projets ouverts <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Burst</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Proxima</a> , ainsi que dans un projet de travail, que je, pour des raisons évidentes, ne peux pas présenter.  Certes, il convient de garder à l'esprit que certains défauts ont déjà été <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">détectés</a> et corrigés plus tôt à l'aide de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Cppcheck</a> et de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>scan-build</code></a> . </p><br><p>  En général, l'impression de tous ces analyseurs est à peu près la même: oui, ils captent quelque chose, parfois même quelque chose d'important, mais dans l'ensemble le compilateur suffit. </p><br><p>  Il est possible (et personnellement, je suis heureux de le penser) que notre équipe utilise de telles pratiques de développement logiciel qui nous permettent de générer le minimum de merde.  Mieux vaut ne pas créer de problèmes que de les surmonter héroïquement. </p><br><p>  Par conséquent, je me permets de donner quelques conseils sur la façon d’écrire en C ++ de manière à ne tirer sur les jambes de personne et à ne pas ratisser sur le front. </p><br><h3 id="ispolzuyte-diagnostiki-kompilyatora-po-maksimumu">  Utilisez les diagnostics du compilateur au maximum </h3><br><p>  Notre équipe utilise (et vous conseille) les options de compilation suivantes: </p><br><pre> <code class="plaintext hljs">-Werror -Wall -Wextra -Wpedantic -Wcast-align -Wcast-qual -Wconversion -Wctor-dtor-privacy -Wenum-compare -Wfloat-equal -Wnon-virtual-dtor -Wold-style-cast -Woverloaded-virtual -Wredundant-decls -Wsign-conversion -Wsign-promo</code> </pre> <br><p>  Incluez-les dans votre projet, apprenez beaucoup sur votre code. </p><br><h3 id="priderzhivaytes-standarta">  Respectez la norme </h3><br><p>  Essayez de ne pas utiliser de choses dépendantes de la plate-forme s'il existe des analogues standard, et si vous ne pouvez pas vous en passer, enveloppez-les dans des blocs spéciaux pour les prises de vue macro (ou autre) et ne nous laissez pas compiler votre code dans des conditions non prises en charge. </p><br><h3 id="priderzhivaytes-standartnoy-semantiki-operaciy">  Respectez la sémantique de fonctionnement standard </h3><br><p>  L'addition doit être l'addition, la multiplication par multiplication, l'appel de fonction par appel de fonction, la copie doit copier, le transfert doit être transféré, le conteneur doit être itérable, l'itérateur doit avoir la promotion <code>++</code> et la déréférence <code>*</code> .  Et ainsi de suite et ainsi de suite. </p><br><p>  Je pense que l'idée est claire.  Il existe des accords établis qui ne sont pas contraignants mais que tous les utilisateurs et lecteurs de votre code s'attendent à voir.  N'essayez pas de déjouer les autres, ou bien de vous surpasser. </p><br><h3 id="pishite-sovmestimyy-kod">  Écrire un code compatible </h3><br><p>  Tout d'abord, je veux dire la bibliothèque standard.  Il est hautement souhaitable que les interfaces de vos classes et fonctions puissent être utilisées avec des bibliothèques standard et autres (par exemple, Bust). </p><br><p>  N'hésitez pas à jeter un œil aux interfaces STL et Boost.  À de rares exceptions près, vous y verrez un digne modèle. </p><br><h3 id="ispolzuyte-po-maksimumu-otkrytye-instrumenty">  Tirez le meilleur parti des outils ouverts </h3><br><p>  Pour la même analyse statique, il existe au moins deux outils libres ouverts qui sont connectés à n'importe quel projet avec le système de construction CMake au détriment du "temps". </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Vous pouvez en savoir plus à ce sujet dans ma récente publication</a> . </p><br><a name="afterword"></a><br><h2>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Postface</a> </h2><br><p>  En conclusion, je souligne que je n'encourage pas à ne pas utiliser PVS ou tout autre analyseur statique.  Mais je vous invite à réfléchir à la façon dont il s'est avéré que l'analyseur statique trouve constamment des erreurs importantes dans votre code. </p><br><p>  Ce n'est qu'une conséquence.  Il est nécessaire de rechercher et d'éliminer la cause. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr463027/">https://habr.com/ru/post/fr463027/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr463011/index.html">Ne jetez pas l'ancienne acoustique Nouvelle vie de l'ancienne acoustique</a></li>
<li><a href="../fr463019/index.html">Feuille de route des développeurs Android en 2019</a></li>
<li><a href="../fr463021/index.html">La première chose à faire lors du démarrage d'un projet sur Django</a></li>
<li><a href="../fr463023/index.html">Eduard Proydakov: «Les ordinateurs personnels ont sorti l'électronique en temps voulu. Les robots vont le retirer maintenant. "</a></li>
<li><a href="../fr463025/index.html">Comment les réseaux sociaux absorbent notre attention: une grande étude sur le temps d'écran</a></li>
<li><a href="../fr463031/index.html">Vivez et apprenez. Partie 3. Formation continue ou âge de l'éternel étudiant</a></li>
<li><a href="../fr463035/index.html">Nouvelles du monde d'OpenStreetMap n ° 471 (07.23.2019-29.07.2019)</a></li>
<li><a href="../fr463037/index.html">Vous cherchez de l'inspiration, ou comment vous sortir de F</a></li>
<li><a href="../fr463039/index.html">Aspirateur manucure bricolage</a></li>
<li><a href="../fr463041/index.html">Défini ou non défini? Nuances de création de tableaux en JavaScript</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>