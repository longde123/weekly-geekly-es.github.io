<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏾‍⚕️ 📈 🏡 了解Google Chrome将HTML转换为PDF功能 🧒🏻 😗 😅</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="最近，在一家初创公司中，我解决了生成PDF格式的票证的问题。 当时，一个已经建立了一套成熟技术的网站已经准备就绪，因此我正在寻找一种不需要使用其他工具的方法。 最后，我建议先创建HTML格式的票证，然后使用Chrome浏览器将其转换为PDF。 事实证明，此方法不仅可以生成使用CSS装饰丰富的票证，还...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>了解Google Chrome将HTML转换为PDF功能</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/459112/"><p><img src="https://habrastorage.org/webt/nl/zz/on/nlzzon_ar_4p3nuhes4p4cgq2ey.jpeg"></p><br><p> 最近，在一家初创公司中，我解决了生成PDF格式的票证的问题。 当时，一个已经建立了一套成熟技术的网站已经准备就绪，因此我正在寻找一种不需要使用其他工具的方法。 最后，我建议先创建HTML格式的票证，然后使用Chrome浏览器将其转换为PDF。 事实证明，此方法不仅可以生成使用CSS装饰丰富的票证，还可以使用JavaScript使用图表生成各种报告。 在本文中，我将讨论如何出于这些目的启动Chrome，提供一些自定义CSS的技巧，并讨论该解决方案的缺点。 </p><a name="habracut"></a><br><p> 此处不讨论其他选项，因为已经在它们上面写下了足够的文字，它们很容易找到，并且它们是现成的工具，有关信息的信息更容易在源代码中找到-官方网站的文档中。 所提出的方法不是独立的工具，而更像是几种技术发展的副产品。 在Internet的俄语部分中，收集到的信息很少，因此我决定填补这一空白。 </p><br><h2 id="pochemu-vybran-imenno-etot-variant"> 为什么选择此选项？ </h2><br><p>  Chrome的最大优势在于，无需扩展技术堆栈即可生成PDF。 前端开发人员使用熟悉的开发工具创建HTML，并立即在浏览器中看到工作的中间结果。 同时，Chrome可能正在测试中，将其传输到后端并不困难。 还应注意，编码器能够访问css属性的整个库，包括Flexbox和Grid。 <br> 在本文过程中，我将讨论缺点和解决它们的方法。 </p><br><h2 id="reshaem-zadachu-odnoy-strokoy"> 我们一站式解决问题 </h2><br><p> 在命令行上，我们以无头模式调用Chrome，并将页面保存为pdf： </p><br><pre><code class="bash hljs">chrome --headless --<span class="hljs-built_in"><span class="hljs-built_in">disable</span></span>-gpu --<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>-to-pdf https://google.com</code> </pre> <br><p>  Linux用户可能需要运行<code>chrome</code> <code>chromium-browser</code>而不是<code>chrome</code> 。 <br>  MAC用户可能会发现预先创建别名很有帮助： </p><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">alias</span></span> chrome=<span class="hljs-string"><span class="hljs-string">"/Applications/Google\\ \\Chrome.app/Contents/MacOS/Google\\ \\Chrome"</span></span></code> </pre> <br><p> 更新：注释澄清了Windows用户需要显式设置PDF文件的名称<code>--print-to-pdf=output.pdf</code> </p><br><p> 如果您已经有HTML文档生成器，而不是<code>https://google.com</code>指定接收该文档的URL。 </p><br><p> 在本地目录中打开文件<code>output.pdf</code>并查看结果。 <br> 引起您注意的第一件事是带有打印日期的页眉和带有URL和分页的页脚。 为了删除它们，您需要添加一些CSS规则。 这些规则不太可能添加到<code>google.com</code> ，因此，为了进行进一步的工作，最好创建自己的HTML文档。 </p><br><h2 id="dobavlyaem-css"> 添加CSS </h2><br><p>  CSS有一个特殊的媒体查询<code>@page</code> ，用于打印；我们将在其中设置缩进，以使Header和Footer根本不适合： </p><br><pre> <code class="css hljs">@<span class="hljs-keyword"><span class="hljs-keyword">page</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">size</span></span>: A4; <span class="hljs-attribute"><span class="hljs-attribute">margin</span></span>: <span class="hljs-number"><span class="hljs-number">0mm</span></span>; }</code> </pre> <br><p> 此方法仅适用于单页文档，当打印两页或更多页时，带有URL和页码的页脚将保留在底部。 您可以通过设置打印参数<code>displayHeaderFooter = False</code>来明确要求Chrome关闭页眉和页脚的显示，但此刻它尚未移至命令行界面。 要做到这一点，您将需要一些工具来自动化浏览器的工作：Selenium或puppeteer。 接下来，我将考虑第一个选项，因为我的项目使用的是Python。 </p><br><h2 id="zapuskaem-chrome-cherez-selenium"> 通过Selenium启动Chrome </h2><br><p> 因此，请使用<code>pip install selenium</code>命令安装Selenium，从<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">http://chromedriver.chromium.org/</a>下载与您的Chrome版本匹配的chrome驱动程序，并使用以下示例中的<code>get_pdf_from_html</code>函数： </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sys <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> selenium <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> webdriver <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> selenium.webdriver.chrome.options <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Options <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> json, base64 <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_pdf_from_html</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(path, chromedriver=</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'./chromedriver'</span></span></span></span><span class="hljs-function"><span class="hljs-params">, print_options = {})</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment">#  Chrome webdriver_options = Options() webdriver_options.add_argument('--headless') webdriver_options.add_argument('--disable-gpu') driver = webdriver.Chrome(chromedriver, options=webdriver_options) #   url driver.get(path) #    calculated_print_options = { 'landscape': False, 'displayHeaderFooter': False, 'printBackground': True, 'preferCSSPageSize': True, } calculated_print_options.update(print_options) #    pdf  result = send_devtools(driver, "Page.printToPDF", calculated_print_options) driver.quit() #    base64 -  return base64.b64decode(result['data']) def send_devtools(driver, cmd, params={}): resource = "/session/%s/chromium/send_command_and_get_result" % driver.session_id url = driver.command_executor._url + resource body = json.dumps({'cmd': cmd, 'params': params}) response = driver.command_executor._request('POST', url, body) if response['status']: raise Exception(response.get('value')) return response.get('value') if __name__ == "__main__": if len(sys.argv) != 3: print ("usage: converter.py &lt;html_page_sourse&gt; &lt;filename_to_save&gt;") exit() result = get_pdf_from_html(sys.argv[1]) with open(sys.argv[2], 'wb') as file: file.write(result)</span></span></code> </pre><br><p> 要获取PDF文件，您可以从命令行运行此示例，方法是指定URL和文件名以保存PDF，或者调用<code>get_pdf_from_html</code>函数并将三个参数传递给它： </p><br><ol><li>  path-HTML文档的url； </li><li>  chromedriver-本地计算机上chrome驱动程序的路径（默认情况下，它必须在本地目录中）； </li><li>  print_options-其他打印属性。 </li></ol><br><p> 应该注意的是，Selenium没有用于打印PDF页面的标准接口，只有Chrome可以做到这一点，因此您必须直接调用<code>driver.command_executor._request</code> 。 </p><br><p> 现在，让我们看看哪些工具可用于控制内容在多页文档中的放置。 </p><br><h2 id="tipografika-v-css">  CSS排版 </h2><br><p> 进行双面打印时，如果打算将来进行装订，可以分别为左右页面的边缘设置不同的边距： </p><br><pre> <code class="css hljs">@<span class="hljs-keyword"><span class="hljs-keyword">page</span></span> <span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:left</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">margin-left</span></span>: <span class="hljs-number"><span class="hljs-number">4cm</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">margin-right</span></span>: <span class="hljs-number"><span class="hljs-number">2cm</span></span>; } @<span class="hljs-keyword"><span class="hljs-keyword">page</span></span> <span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:right</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">margin-left</span></span>: <span class="hljs-number"><span class="hljs-number">4cm</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">margin-right</span></span>: <span class="hljs-number"><span class="hljs-number">2cm</span></span>; }</code> </pre> <br><p> 对于第一页，您可以指定自己的设计，例如，从顶部边缘增加缩进量： </p><br><pre> <code class="css hljs">@<span class="hljs-keyword"><span class="hljs-keyword">page</span></span> <span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:first</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">margin-top</span></span>: <span class="hljs-number"><span class="hljs-number">10cm</span></span> <span class="hljs-comment"><span class="hljs-comment">/* Top margin on first page 10cm */</span></span> }</code> </pre> <br><p> 可以在第一级标题之前设置分页符，以便它从奇数页开始： </p><br><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">h1</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">page-break-before </span></span>: right }</code> </pre> <br><p> 使用<code>page-break-after</code>属性，可以防止在某些元素（例如，第二级标题）之后立即分页： </p><br><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">h2</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">page-break-after </span></span>: avoid }</code> </pre> <br><p>  <code>page-break-inside</code>属性有助于避免不希望这样做的分页符，例如在表中间 </p><br><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">table</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">page-break-inside </span></span>: avoid }</code> </pre> <br><p>  <code>orphans</code>和<code>orphans</code>将有助于防止在段落的开头和结尾处出现分页符： </p><br><pre> <code class="css hljs">@<span class="hljs-keyword"><span class="hljs-keyword">page</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">orphans</span></span>:<span class="hljs-number"><span class="hljs-number">4</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">widows</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span>; }</code> </pre> <br><h2 id="chto-s-proizvoditelnostyu"> 性能如何？ </h2><br><p> 在3600MHz的i5-8600K Core i流中，一次简单的文档转换需要0.6秒。 在我的2013年底便携式打字机上，速度为2.4 GHz-1.5秒。 <br> 显然，主要资源都花在了启动浏览器上。 如果您将Chrome作为微服务运行一次并向其发送URL进行转换，则可以减少大量文件的转换时间。 此方法的实现超出了本文的范围。 </p><br><h2 id="chto-esche-ne-tak"> 还有什么问题吗？ </h2><br><p> 我看到两个主要问题： </p><br><ol><li> 无法简单确定文档中元素的位置。 这使得难以创建具有页码自动指示的目录，尤其是如果内容的大小事先未知时。 </li><li>  Chrome的转换是Google的产品，它收集有关用户的各种信息。 如果从文档中泄漏数据是不可接受的，则应谨慎考虑建议的解决方案-关闭可访问外部资源的浏览器，甚至寻找其他解决方案。 使用开源Chromium无法解决问题-已在其中找到Google的错误。 </li></ol><br><h2 id="vyvody"> 结论 </h2><br><p> 我建议就我自己使用这种方法的可取性得出结论。 每个项目都有其独特的方式。 此方法是否适合您的项目取决于您。 </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN459112/">https://habr.com/ru/post/zh-CN459112/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN459100/index.html">GitHub Package Registry将支持Swift软件包</a></li>
<li><a href="../zh-CN459102/index.html">给可乐和即食早餐爱好者的礼品碟或免费音乐</a></li>
<li><a href="../zh-CN459104/index.html">C＃还是Java？ TypeScript还是JavaScript？ 基于机器学习的编程语言分类</a></li>
<li><a href="../zh-CN459108/index.html">特斯拉将在今年下半年一次呈现一些惊喜</a></li>
<li><a href="../zh-CN459110/index.html">我们正在用Python开发的Albion Online游戏中编写一个钓鱼机器人</a></li>
<li><a href="../zh-CN459114/index.html">14个2019年最佳WordPress SEO插件</a></li>
<li><a href="../zh-CN459116/index.html">距胸腺修复更近一步</a></li>
<li><a href="../zh-CN459118/index.html">我们如何在莫斯科办公室的华为上设计和实现新网络，第2部分</a></li>
<li><a href="../zh-CN459120/index.html">UNO-1000 / 2000系列模块化嵌入式计算机</a></li>
<li><a href="../zh-CN459122/index.html">Aleksey Savvateev：因分析不完善的市场（2014年）和集体声誉而获得Jean Tyrol的诺贝尔奖</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>