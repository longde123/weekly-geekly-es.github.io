<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🕓 ⛹🏿 🖐🏽 Kotlin DSL, luminaires et tests d'interface utilisateur élégants dans Android 🙋🏼 ⚗️ 👨🏿‍🔬</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Quand j’ai rencontré Kotlin DSL, j’ai pensé: super, c’est dommage dans le développement de produits ça ne sera pas utile. Cependant, je me trompais: i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Kotlin DSL, luminaires et tests d'interface utilisateur élégants dans Android</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/hh/blog/455042/"><p>  Quand j’ai rencontré Kotlin DSL, j’ai pensé: super, c’est dommage dans le développement de produits ça ne sera pas utile.  Cependant, je me trompais: il nous a aidés à créer un moyen très concis et élégant d'écrire des tests d'interface utilisateur de bout en bout dans Android. </p><br><p><img src="https://habrastorage.org/webt/sh/f7/ej/shf7ejqt1wouqjj5vjej-vwbnzi.jpeg" alt="image"></p><a name="habracut"></a><br><h1 id="pro-servis-testovye-dannye-i-pochemu-vse-ne-tak-prosto">  À propos du service, des données de test et pourquoi ce n'est pas si simple </h1><br><p>  Pour commencer, un peu de contexte sur notre service, afin que vous compreniez pourquoi nous avons pris certaines décisions. </p><br><p>  Nous aidons les demandeurs d'emploi et les employeurs à se retrouver: </p><br><ul><li>  les employeurs enregistrent leurs entreprises et affichent les postes vacants </li><li>  les demandeurs d'emploi recherchent des emplois, les ajoutent aux favoris, s'abonnent aux résultats de la recherche, créent des CV et envoient des commentaires </li></ul><br><p>  Afin de simuler des scénarios d'utilisateurs réels et de s'assurer que l'application fonctionne correctement sur eux, nous devons créer toutes ces données de test sur le serveur.  Vous direz: "Créez donc à l'avance des employeurs et des demandeurs d'emploi pour les tests, puis travaillez avec eux dans les tests."  Mais il y a quelques problèmes: </p><br><ol><li>  pendant les tests, nous modifions les données; </li><li>  les tests se déroulent en parallèle. </li></ol><br><h1 id="testovoe-okruzhenie-i-fikstury">  Environnement de test et équipements </h1><br><p>  Des tests de bout en bout s'exécutent sur des bancs de test.  Ils ont presque un environnement militaire, mais il n'y a pas de données réelles.  À cet égard, lors de l'ajout de nouvelles données, l'indexation se produit presque instantanément. </p><br><p>  Pour ajouter des données au stand, nous utilisons des méthodes de fixation spéciales.  Ils ajoutent des données directement à la base de données et les indexent instantanément: </p><br><pre><code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestFixtureUserApi</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@POST(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"fx/employer/create"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createEmployerUser</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-meta"><span class="hljs-function"><span class="hljs-params"><span class="hljs-meta">@Body</span></span></span></span><span class="hljs-function"><span class="hljs-params"> employer: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">TestEmployer</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: Call&lt;TestEmployer&gt; }</code> </pre> <br><p>  Les luminaires ne sont disponibles que sur le réseau local et uniquement pour les bancs d'essai.  Les méthodes sont appelées à partir du test immédiatement avant de commencer l'activité de démarrage. </p><br><h1 id="dsl">  DSL </h1><br><p>  Nous sommes donc arrivés au plus juteux.  Comment les données sont-elles définies pour le test? </p><br><pre> <code class="kotlin hljs">initialisation{ applicant { resume { title = <span class="hljs-string"><span class="hljs-string">"Resume for similar Vacancy"</span></span> isOptional = <span class="hljs-literal"><span class="hljs-literal">true</span></span> resumeStatus = ResumeStatus.APPROVED } resume { title = <span class="hljs-string"><span class="hljs-string">"Some other Resume"</span></span> } } employer { vacancy { title = <span class="hljs-string"><span class="hljs-string">"Resume for similar Vacancy"</span></span> } vacancy { title = <span class="hljs-string"><span class="hljs-string">"Resume for similar Vacancy"</span></span> description = <span class="hljs-string"><span class="hljs-string">"Working hard"</span></span> } vacancy { title = <span class="hljs-string"><span class="hljs-string">"Resume for similar Vacancy"</span></span> description = <span class="hljs-string"><span class="hljs-string">"Working very hard"</span></span> } } }</code> </pre> <br><p>  Dans le bloc d'initialisation, nous démarrons les entités nécessaires au test: dans l'exemple ci-dessus, nous avons créé un demandeur d'emploi avec deux CV, ainsi qu'un employeur qui a fourni plusieurs postes vacants. </p><br><p>  Pour éliminer les erreurs associées à l'intersection des données de test, nous générons un identifiant unique pour le test et pour chaque entité. </p><br><p>  <strong>Relations entre entités</strong> </p><br><p>  Quelle est la principale limitation lorsque vous travaillez avec DSL?  En raison de sa structure arborescente, il est assez difficile d'établir des connexions entre les différentes branches d'un arbre. </p><br><p>  Par exemple, dans notre candidature pour les candidats, il y a une section «Postes vacants appropriés pour les CV».  Pour que les postes vacants apparaissent dans cette liste, nous devons les définir de manière à ce qu'ils soient liés au curriculum vitae de l'utilisateur actuel. </p><br><pre> <code class="kotlin hljs">initialisation { applicant { resume { title = <span class="hljs-string"><span class="hljs-string">"TEST_VACANCY_</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$uniqueTestId</span></span></span><span class="hljs-string">"</span></span> } } employer { vacancy { title = <span class="hljs-string"><span class="hljs-string">"TEST_VACANCY_</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$uniqueTestId</span></span></span><span class="hljs-string">"</span></span> } } }</code> </pre> <br><p>  Un identifiant de test unique est utilisé pour cela.  Ainsi, lorsque vous travaillez avec l'application, les postes vacants spécifiés sont recommandés pour ce CV.  De plus, il est important de noter qu'aucun autre poste vacant n'apparaîtra sur cette liste. </p><br><p>  <strong>Initialiser des données du même type</strong> </p><br><p>  Mais que se passe-t-il si vous devez faire beaucoup de postes vacants?  Est-ce que chaque bloc est copié?  Bien sûr que non!  Nous faisons une méthode avec un bloc de postes vacants, qui indique le nombre de postes vacants requis et un transformateur pour les diversifier en fonction de l'identifiant unique. </p><br><pre> <code class="kotlin hljs">initialisation { employer { vacancyBlock { size = <span class="hljs-number"><span class="hljs-number">10</span></span> transformer = { it.also { vacancyDsl -&gt; vacancyDsl.description = <span class="hljs-string"><span class="hljs-string">"Some description with text </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${vacancyDsl.uniqueVacancyId}</span></span></span><span class="hljs-string">"</span></span> } } } } }</code> </pre> <br><p>  Dans le bloc vacancyBlock, nous indiquons combien de clones de postes vacants nous devons créer et comment les transformer en fonction du numéro de série. </p><br><p>  <strong>Travailler avec des données dans le test</strong> </p><br><p>  Pendant le test, travailler avec des données devient très simple.  Toutes les données que nous créons sont à notre disposition.  Dans notre implémentation, ils sont stockés dans des emballages spéciaux pour les collections.  Les données peuvent être obtenues auprès d'eux à la fois par le numéro de série du travail (postes vacants [0]), et par la balise qui peut être définie dans dsl (postes vacants [«mon poste vacant»]), et par des raccourcis (postes vacants.first () </p><br><div class="spoiler">  <b class="spoiler_title">TaggedItemContainer</b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TaggedItemContainer</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">T</span></span></span><span class="hljs-class">&gt;</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> items: MutableList&lt;TaggedItem&lt;T&gt;&gt; ) { <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(index: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: T { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> items[index].<span class="hljs-keyword"><span class="hljs-keyword">data</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(tag: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: T { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> items.first { it.tag == tag }.<span class="hljs-keyword"><span class="hljs-keyword">data</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">plusAssign</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(item: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">TaggedItem</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">T</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt;)</span></span></span></span> { items += item } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">forEach</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(action: (</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">T</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> -&gt; <span class="hljs-built_in"><span class="hljs-built_in">Unit</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (item <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> items) action.invoke(item.<span class="hljs-keyword"><span class="hljs-keyword">data</span></span>) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">first</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: T { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> items[<span class="hljs-number"><span class="hljs-number">0</span></span>].<span class="hljs-keyword"><span class="hljs-keyword">data</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">second</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: T { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> items[<span class="hljs-number"><span class="hljs-number">1</span></span>].<span class="hljs-keyword"><span class="hljs-keyword">data</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">third</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: T { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> items[<span class="hljs-number"><span class="hljs-number">2</span></span>].<span class="hljs-keyword"><span class="hljs-keyword">data</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">last</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: T { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> items[items.size - <span class="hljs-number"><span class="hljs-number">1</span></span>].<span class="hljs-keyword"><span class="hljs-keyword">data</span></span> } }</code> </pre> </div></div><br><p>  Dans presque 100% des cas, lors de l'écriture des tests, nous utilisons les première () et seconde () méthodes, les autres sont conservées pour plus de flexibilité.  Voici un exemple de test avec initialisation et étapes sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Kakao</a> </p><br><pre> <code class="kotlin hljs">initialisation { applicant { resume { title = <span class="hljs-string"><span class="hljs-string">"TEST_VACANCY_</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$uniqueTestId</span></span></span><span class="hljs-string">"</span></span> } } }.run { mainScreen { positionField { click() } jobPositionScreen { positionEntry(vacancies.first().title) } searchButton { click() } } }</code> </pre> <br><p>  <strong>Ce qui ne rentre pas dans DSL</strong> </p><br><p>  Toutes les données peuvent-elles entrer dans DSL?  Notre objectif était de garder DSL aussi concis et simple que possible.  Dans notre mise en œuvre, étant donné que l'ordre de travail des candidats et des employeurs n'est pas important, il n'est pas possible d'adapter leur relation - les réponses. <br>  La création de réponses est déjà effectuée dans le bloc suivant par des opérations sur des entités déjà créées sur le serveur. </p><br><h1 id="realizaciya-dsl">  Implémentation DSL </h1><br><p>  Comme vous l'avez compris dans l'article, l'algorithme pour spécifier les données de test et effectuer le test est le suivant: </p><br><ul><li>  Une partie de la DSL est analysée lors de l'initialisation; </li><li>  Sur la base des valeurs obtenues, des données de test sont créées sur le serveur; </li><li>  Le bloc de transformation facultatif est exécuté, dans lequel vous pouvez définir des réponses; </li><li>  Un test est effectué avec un jeu de données déjà final. </li></ul><br><p>  <strong>Analyser les données d'un bloc d'initialisation</strong> </p><br><p>  Quel genre de magie se passe là-bas?  Considérez comment l'élément de niveau supérieur TestCaseDsl est construit: </p><br><pre> <code class="kotlin hljs"><span class="hljs-meta"><span class="hljs-meta">@TestCaseDslMarker</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestCaseDsl</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> applicants = mutableListOf&lt;ApplicantDsl&gt;() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> employers = mutableListOf&lt;EmployerDsl&gt;() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> uniqueTestId = CommonUtils.unique <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">applicant</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(block: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ApplicantDsl</span></span></span></span><span class="hljs-function"><span class="hljs-params">.()</span></span></span></span> -&gt; <span class="hljs-built_in"><span class="hljs-built_in">Unit</span></span> = {}) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> applicantDsl = ApplicantDsl( uniqueTestId, uniqueApplicantId = CommonUtils.unique applicantDsl.block() applicants += applicantDsl } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">employer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(block: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">EmployerDsl</span></span></span></span><span class="hljs-function"><span class="hljs-params">.()</span></span></span></span> -&gt; <span class="hljs-built_in"><span class="hljs-built_in">Unit</span></span> = {}) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> employerDsl = EmployerDsl( uniqueTestId = uniqueTestId, uniqueEmployerId = CommonUtils.unique employerDsl.block() employers += employerDsl } }</code> </pre> <br><p>  Dans la méthode du demandeur, nous créons ApplicantDsl. </p><br><div class="spoiler">  <b class="spoiler_title">ApplicantDsl</b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-meta"><span class="hljs-meta">@TestCaseDslMarker</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ApplicantDsl</span></span></span></span>( <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> uniqueTestId: String, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> uniqueApplicantId: String, <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tag: String? = <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> login: String? = <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> password: String? = <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> firstName: String? = <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> middleName: String? = <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> lastName: String? = <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> email: String? = <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> siteId: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>? = <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> areaId: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>? = <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> resumeViewLimit: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>? = <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> isMailingSubscription: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span>? = <span class="hljs-literal"><span class="hljs-literal">null</span></span> ) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> resumes = mutableListOf&lt;ResumeDsl&gt;() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resume</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(block: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ResumeDsl</span></span></span></span><span class="hljs-function"><span class="hljs-params">.()</span></span></span></span> -&gt; <span class="hljs-built_in"><span class="hljs-built_in">Unit</span></span> = {}) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> resumeDslBuilder = ResumeDsl( uniqueTestId = uniqueTestId, uniqueApplicantId = uniqueApplicantId, uniqueResumeId = CommonUtils.unique ) resumeDslBuilder.apply(block) <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.resumes += resumeDslBuilder } }</code> </pre> </div></div><br><p>  Ensuite, nous effectuons des opérations sur celui-ci à partir du bloc bloc: ApplicantDsl. () -&gt; Unit.  C'est cette conception qui nous permet de fonctionner facilement avec les champs ApplicantDsl dans notre DSL. </p><br><p>  Veuillez noter que uniqueTestId et uniqueApplicantId (identifiants uniques pour connecter des entités entre elles) au moment de l'exécution du bloc sont déjà définis et nous pouvons y accéder. </p><br><p>  Le bloc d'initialisation a en interne une structure similaire: </p><br><pre> <code class="kotlin hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initialisation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(block: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">TestCaseDsl</span></span></span></span><span class="hljs-function"><span class="hljs-params">.()</span></span></span></span> -&gt; <span class="hljs-built_in"><span class="hljs-built_in">Unit</span></span>): Initialisation { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> testCaseDsl = TestCaseDsl().apply(block) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> testCase = TestCaseCreator.create(testCaseDsl) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Initialisation(testCase) }</code> </pre> <br><p>  Nous créons un test, lui appliquons des actions de blocage, puis utilisons TestCaseCreator pour créer des données sur le serveur et les placer dans des collections.  La fonction TestCaseCreator.create () est assez simple - nous parcourons les données et les créons sur le serveur. </p><br><h1 id="podvodnye-kamni-i-idei">  Pièges et idées </h1><br><blockquote>  Certains tests sont très similaires et ne diffèrent que par les données d'entrée et les moyens de contrôler leurs affichages (par exemple, lorsque différentes devises sont indiquées dans le poste vacant). </blockquote><p>  Dans notre cas, il y avait peu de ces tests, et nous avons décidé de ne pas encombrer DSL avec une syntaxe spéciale </p><br><blockquote>  Avant la DSL, nous avons longtemps indexé les données et pour gagner du temps, nous avons fait beaucoup de tests dans une classe et créé toutes les données dans un bloc statique. </blockquote><p>  Ne faites pas cela - il vous sera impossible de redémarrer le test tombé.  Le fait est que lors du lancement du test tombé, nous pourrions changer les données initiales sur le serveur.  Par exemple, nous pourrions ajouter un poste vacant à vos favoris.  Ensuite, lorsque vous relancez le test, un clic sur l'astérisque entraînera au contraire la suppression de la vacance de la liste des favoris, et c'est un comportement auquel on ne s'attend pas. </p><br><h1 id="itogi">  Résumé </h1><br><p>  Cette méthode de spécification des données de test a grandement simplifié le travail avec les tests: <br>  Lorsque vous écrivez des tests, vous n'avez pas besoin de vous demander s'il existe un serveur et dans quel ordre vous devez initialiser les données; <br>  Toutes les entités qui peuvent être définies sur le serveur apparaissent facilement dans les conseils IDE; <br>  Il existe un moyen unique d'initialiser et de communiquer des données entre eux. </p><br><p>  <strong>Matériel connexe</strong> </p><br><p>  Si vous êtes intéressé par notre approche des tests d'interface utilisateur, alors avant de commencer, je vous suggère de vous familiariser avec les documents suivants: </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Constructeurs Type-Safe</a> - documentation officielle sur le site kotlinlang.org; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Kotlin DSL: Theory and Practice</a> - excellent rapport de jPoint 2018 sur kotlin dsl et son décodage; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Kakao - comment rendre les tests d'interface utilisateur à nouveau excellents</a> - connaissances de base sur le cadre Kakao pour les tests d'interface utilisateur; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Comment arrêter d'avoir peur et commencer à écrire des tests d'interface utilisateur avec Kakao</a> - une discussion sur Kakao avec AppsConf 2019. Jusqu'à présent, seules les diapositives sont disponibles, puis il y aura une vidéo. </li></ul><br><p>  <strong>Et ensuite</strong> </p><br><p>  Cet article est le premier d'une série sur les outils et les cadres de haut niveau pour écrire et prendre en charge les tests d'interface utilisateur dans Android.  Lorsque de nouvelles pièces seront disponibles, je les lierai à cet article. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr455042/">https://habr.com/ru/post/fr455042/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr455026/index.html">Téléphonie avec Snom: pour ceux qui travaillent à domicile</a></li>
<li><a href="../fr455030/index.html">Spécifications PHP</a></li>
<li><a href="../fr455032/index.html">Pas un insecte, mais une caractéristique: une étude de la motilité et de l'activité cérébrale d'une personne atteinte de polydactylie</a></li>
<li><a href="../fr455038/index.html">Comment Plesk a visité KubeCon</a></li>
<li><a href="../fr455040/index.html">Améliorer le travail du Wi-Fi. Partie 2. Caractéristiques de l'équipement</a></li>
<li><a href="../fr455046/index.html">N + 7 livres utiles</a></li>
<li><a href="../fr455048/index.html">Mise en œuvre technique de la méthode des potentiels thermiques pour l'analyse des territoires</a></li>
<li><a href="../fr455052/index.html">Meetup été DIYorDIE 16 juin</a></li>
<li><a href="../fr455054/index.html">Comment Apple (en privé) trouvera-t-il hors ligne votre appareil perdu?</a></li>
<li><a href="../fr455056/index.html">Graphiques primitifs pour lazy, oldfags et lazy oldfags</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>