<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üïì ‚õπüèø üñêüèΩ Kotlin DSL, luminaires et tests d'interface utilisateur √©l√©gants dans Android üôãüèº ‚öóÔ∏è üë®üèø‚Äçüî¨</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Quand j‚Äôai rencontr√© Kotlin DSL, j‚Äôai pens√©: super, c‚Äôest dommage dans le d√©veloppement de produits √ßa ne sera pas utile. Cependant, je me trompais: i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Kotlin DSL, luminaires et tests d'interface utilisateur √©l√©gants dans Android</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/hh/blog/455042/"><p>  Quand j‚Äôai rencontr√© Kotlin DSL, j‚Äôai pens√©: super, c‚Äôest dommage dans le d√©veloppement de produits √ßa ne sera pas utile.  Cependant, je me trompais: il nous a aid√©s √† cr√©er un moyen tr√®s concis et √©l√©gant d'√©crire des tests d'interface utilisateur de bout en bout dans Android. </p><br><p><img src="https://habrastorage.org/webt/sh/f7/ej/shf7ejqt1wouqjj5vjej-vwbnzi.jpeg" alt="image"></p><a name="habracut"></a><br><h1 id="pro-servis-testovye-dannye-i-pochemu-vse-ne-tak-prosto">  √Ä propos du service, des donn√©es de test et pourquoi ce n'est pas si simple </h1><br><p>  Pour commencer, un peu de contexte sur notre service, afin que vous compreniez pourquoi nous avons pris certaines d√©cisions. </p><br><p>  Nous aidons les demandeurs d'emploi et les employeurs √† se retrouver: </p><br><ul><li>  les employeurs enregistrent leurs entreprises et affichent les postes vacants </li><li>  les demandeurs d'emploi recherchent des emplois, les ajoutent aux favoris, s'abonnent aux r√©sultats de la recherche, cr√©ent des CV et envoient des commentaires </li></ul><br><p>  Afin de simuler des sc√©narios d'utilisateurs r√©els et de s'assurer que l'application fonctionne correctement sur eux, nous devons cr√©er toutes ces donn√©es de test sur le serveur.  Vous direz: "Cr√©ez donc √† l'avance des employeurs et des demandeurs d'emploi pour les tests, puis travaillez avec eux dans les tests."  Mais il y a quelques probl√®mes: </p><br><ol><li>  pendant les tests, nous modifions les donn√©es; </li><li>  les tests se d√©roulent en parall√®le. </li></ol><br><h1 id="testovoe-okruzhenie-i-fikstury">  Environnement de test et √©quipements </h1><br><p>  Des tests de bout en bout s'ex√©cutent sur des bancs de test.  Ils ont presque un environnement militaire, mais il n'y a pas de donn√©es r√©elles.  √Ä cet √©gard, lors de l'ajout de nouvelles donn√©es, l'indexation se produit presque instantan√©ment. </p><br><p>  Pour ajouter des donn√©es au stand, nous utilisons des m√©thodes de fixation sp√©ciales.  Ils ajoutent des donn√©es directement √† la base de donn√©es et les indexent instantan√©ment: </p><br><pre><code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestFixtureUserApi</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@POST(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"fx/employer/create"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createEmployerUser</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-meta"><span class="hljs-function"><span class="hljs-params"><span class="hljs-meta">@Body</span></span></span></span><span class="hljs-function"><span class="hljs-params"> employer: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">TestEmployer</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: Call&lt;TestEmployer&gt; }</code> </pre> <br><p>  Les luminaires ne sont disponibles que sur le r√©seau local et uniquement pour les bancs d'essai.  Les m√©thodes sont appel√©es √† partir du test imm√©diatement avant de commencer l'activit√© de d√©marrage. </p><br><h1 id="dsl">  DSL </h1><br><p>  Nous sommes donc arriv√©s au plus juteux.  Comment les donn√©es sont-elles d√©finies pour le test? </p><br><pre> <code class="kotlin hljs">initialisation{ applicant { resume { title = <span class="hljs-string"><span class="hljs-string">"Resume for similar Vacancy"</span></span> isOptional = <span class="hljs-literal"><span class="hljs-literal">true</span></span> resumeStatus = ResumeStatus.APPROVED } resume { title = <span class="hljs-string"><span class="hljs-string">"Some other Resume"</span></span> } } employer { vacancy { title = <span class="hljs-string"><span class="hljs-string">"Resume for similar Vacancy"</span></span> } vacancy { title = <span class="hljs-string"><span class="hljs-string">"Resume for similar Vacancy"</span></span> description = <span class="hljs-string"><span class="hljs-string">"Working hard"</span></span> } vacancy { title = <span class="hljs-string"><span class="hljs-string">"Resume for similar Vacancy"</span></span> description = <span class="hljs-string"><span class="hljs-string">"Working very hard"</span></span> } } }</code> </pre> <br><p>  Dans le bloc d'initialisation, nous d√©marrons les entit√©s n√©cessaires au test: dans l'exemple ci-dessus, nous avons cr√©√© un demandeur d'emploi avec deux CV, ainsi qu'un employeur qui a fourni plusieurs postes vacants. </p><br><p>  Pour √©liminer les erreurs associ√©es √† l'intersection des donn√©es de test, nous g√©n√©rons un identifiant unique pour le test et pour chaque entit√©. </p><br><p>  <strong>Relations entre entit√©s</strong> </p><br><p>  Quelle est la principale limitation lorsque vous travaillez avec DSL?  En raison de sa structure arborescente, il est assez difficile d'√©tablir des connexions entre les diff√©rentes branches d'un arbre. </p><br><p>  Par exemple, dans notre candidature pour les candidats, il y a une section ¬´Postes vacants appropri√©s pour les CV¬ª.  Pour que les postes vacants apparaissent dans cette liste, nous devons les d√©finir de mani√®re √† ce qu'ils soient li√©s au curriculum vitae de l'utilisateur actuel. </p><br><pre> <code class="kotlin hljs">initialisation { applicant { resume { title = <span class="hljs-string"><span class="hljs-string">"TEST_VACANCY_</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$uniqueTestId</span></span></span><span class="hljs-string">"</span></span> } } employer { vacancy { title = <span class="hljs-string"><span class="hljs-string">"TEST_VACANCY_</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$uniqueTestId</span></span></span><span class="hljs-string">"</span></span> } } }</code> </pre> <br><p>  Un identifiant de test unique est utilis√© pour cela.  Ainsi, lorsque vous travaillez avec l'application, les postes vacants sp√©cifi√©s sont recommand√©s pour ce CV.  De plus, il est important de noter qu'aucun autre poste vacant n'appara√Ætra sur cette liste. </p><br><p>  <strong>Initialiser des donn√©es du m√™me type</strong> </p><br><p>  Mais que se passe-t-il si vous devez faire beaucoup de postes vacants?  Est-ce que chaque bloc est copi√©?  Bien s√ªr que non!  Nous faisons une m√©thode avec un bloc de postes vacants, qui indique le nombre de postes vacants requis et un transformateur pour les diversifier en fonction de l'identifiant unique. </p><br><pre> <code class="kotlin hljs">initialisation { employer { vacancyBlock { size = <span class="hljs-number"><span class="hljs-number">10</span></span> transformer = { it.also { vacancyDsl -&gt; vacancyDsl.description = <span class="hljs-string"><span class="hljs-string">"Some description with text </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${vacancyDsl.uniqueVacancyId}</span></span></span><span class="hljs-string">"</span></span> } } } } }</code> </pre> <br><p>  Dans le bloc vacancyBlock, nous indiquons combien de clones de postes vacants nous devons cr√©er et comment les transformer en fonction du num√©ro de s√©rie. </p><br><p>  <strong>Travailler avec des donn√©es dans le test</strong> </p><br><p>  Pendant le test, travailler avec des donn√©es devient tr√®s simple.  Toutes les donn√©es que nous cr√©ons sont √† notre disposition.  Dans notre impl√©mentation, ils sont stock√©s dans des emballages sp√©ciaux pour les collections.  Les donn√©es peuvent √™tre obtenues aupr√®s d'eux √† la fois par le num√©ro de s√©rie du travail (postes vacants [0]), et par la balise qui peut √™tre d√©finie dans dsl (postes vacants [¬´mon poste vacant¬ª]), et par des raccourcis (postes vacants.first () </p><br><div class="spoiler">  <b class="spoiler_title">TaggedItemContainer</b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TaggedItemContainer</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">T</span></span></span><span class="hljs-class">&gt;</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> items: MutableList&lt;TaggedItem&lt;T&gt;&gt; ) { <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(index: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: T { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> items[index].<span class="hljs-keyword"><span class="hljs-keyword">data</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(tag: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: T { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> items.first { it.tag == tag }.<span class="hljs-keyword"><span class="hljs-keyword">data</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">plusAssign</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(item: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">TaggedItem</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">T</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt;)</span></span></span></span> { items += item } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">forEach</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(action: (</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">T</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> -&gt; <span class="hljs-built_in"><span class="hljs-built_in">Unit</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (item <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> items) action.invoke(item.<span class="hljs-keyword"><span class="hljs-keyword">data</span></span>) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">first</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: T { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> items[<span class="hljs-number"><span class="hljs-number">0</span></span>].<span class="hljs-keyword"><span class="hljs-keyword">data</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">second</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: T { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> items[<span class="hljs-number"><span class="hljs-number">1</span></span>].<span class="hljs-keyword"><span class="hljs-keyword">data</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">third</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: T { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> items[<span class="hljs-number"><span class="hljs-number">2</span></span>].<span class="hljs-keyword"><span class="hljs-keyword">data</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">last</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: T { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> items[items.size - <span class="hljs-number"><span class="hljs-number">1</span></span>].<span class="hljs-keyword"><span class="hljs-keyword">data</span></span> } }</code> </pre> </div></div><br><p>  Dans presque 100% des cas, lors de l'√©criture des tests, nous utilisons les premi√®re () et seconde () m√©thodes, les autres sont conserv√©es pour plus de flexibilit√©.  Voici un exemple de test avec initialisation et √©tapes sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Kakao</a> </p><br><pre> <code class="kotlin hljs">initialisation { applicant { resume { title = <span class="hljs-string"><span class="hljs-string">"TEST_VACANCY_</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$uniqueTestId</span></span></span><span class="hljs-string">"</span></span> } } }.run { mainScreen { positionField { click() } jobPositionScreen { positionEntry(vacancies.first().title) } searchButton { click() } } }</code> </pre> <br><p>  <strong>Ce qui ne rentre pas dans DSL</strong> </p><br><p>  Toutes les donn√©es peuvent-elles entrer dans DSL?  Notre objectif √©tait de garder DSL aussi concis et simple que possible.  Dans notre mise en ≈ìuvre, √©tant donn√© que l'ordre de travail des candidats et des employeurs n'est pas important, il n'est pas possible d'adapter leur relation - les r√©ponses. <br>  La cr√©ation de r√©ponses est d√©j√† effectu√©e dans le bloc suivant par des op√©rations sur des entit√©s d√©j√† cr√©√©es sur le serveur. </p><br><h1 id="realizaciya-dsl">  Impl√©mentation DSL </h1><br><p>  Comme vous l'avez compris dans l'article, l'algorithme pour sp√©cifier les donn√©es de test et effectuer le test est le suivant: </p><br><ul><li>  Une partie de la DSL est analys√©e lors de l'initialisation; </li><li>  Sur la base des valeurs obtenues, des donn√©es de test sont cr√©√©es sur le serveur; </li><li>  Le bloc de transformation facultatif est ex√©cut√©, dans lequel vous pouvez d√©finir des r√©ponses; </li><li>  Un test est effectu√© avec un jeu de donn√©es d√©j√† final. </li></ul><br><p>  <strong>Analyser les donn√©es d'un bloc d'initialisation</strong> </p><br><p>  Quel genre de magie se passe l√†-bas?  Consid√©rez comment l'√©l√©ment de niveau sup√©rieur TestCaseDsl est construit: </p><br><pre> <code class="kotlin hljs"><span class="hljs-meta"><span class="hljs-meta">@TestCaseDslMarker</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestCaseDsl</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> applicants = mutableListOf&lt;ApplicantDsl&gt;() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> employers = mutableListOf&lt;EmployerDsl&gt;() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> uniqueTestId = CommonUtils.unique <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">applicant</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(block: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ApplicantDsl</span></span></span></span><span class="hljs-function"><span class="hljs-params">.()</span></span></span></span> -&gt; <span class="hljs-built_in"><span class="hljs-built_in">Unit</span></span> = {}) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> applicantDsl = ApplicantDsl( uniqueTestId, uniqueApplicantId = CommonUtils.unique applicantDsl.block() applicants += applicantDsl } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">employer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(block: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">EmployerDsl</span></span></span></span><span class="hljs-function"><span class="hljs-params">.()</span></span></span></span> -&gt; <span class="hljs-built_in"><span class="hljs-built_in">Unit</span></span> = {}) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> employerDsl = EmployerDsl( uniqueTestId = uniqueTestId, uniqueEmployerId = CommonUtils.unique employerDsl.block() employers += employerDsl } }</code> </pre> <br><p>  Dans la m√©thode du demandeur, nous cr√©ons ApplicantDsl. </p><br><div class="spoiler">  <b class="spoiler_title">ApplicantDsl</b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-meta"><span class="hljs-meta">@TestCaseDslMarker</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ApplicantDsl</span></span></span></span>( <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> uniqueTestId: String, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> uniqueApplicantId: String, <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tag: String? = <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> login: String? = <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> password: String? = <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> firstName: String? = <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> middleName: String? = <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> lastName: String? = <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> email: String? = <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> siteId: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>? = <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> areaId: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>? = <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> resumeViewLimit: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>? = <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> isMailingSubscription: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span>? = <span class="hljs-literal"><span class="hljs-literal">null</span></span> ) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> resumes = mutableListOf&lt;ResumeDsl&gt;() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resume</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(block: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ResumeDsl</span></span></span></span><span class="hljs-function"><span class="hljs-params">.()</span></span></span></span> -&gt; <span class="hljs-built_in"><span class="hljs-built_in">Unit</span></span> = {}) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> resumeDslBuilder = ResumeDsl( uniqueTestId = uniqueTestId, uniqueApplicantId = uniqueApplicantId, uniqueResumeId = CommonUtils.unique ) resumeDslBuilder.apply(block) <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.resumes += resumeDslBuilder } }</code> </pre> </div></div><br><p>  Ensuite, nous effectuons des op√©rations sur celui-ci √† partir du bloc bloc: ApplicantDsl. () -&gt; Unit.  C'est cette conception qui nous permet de fonctionner facilement avec les champs ApplicantDsl dans notre DSL. </p><br><p>  Veuillez noter que uniqueTestId et uniqueApplicantId (identifiants uniques pour connecter des entit√©s entre elles) au moment de l'ex√©cution du bloc sont d√©j√† d√©finis et nous pouvons y acc√©der. </p><br><p>  Le bloc d'initialisation a en interne une structure similaire: </p><br><pre> <code class="kotlin hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initialisation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(block: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">TestCaseDsl</span></span></span></span><span class="hljs-function"><span class="hljs-params">.()</span></span></span></span> -&gt; <span class="hljs-built_in"><span class="hljs-built_in">Unit</span></span>): Initialisation { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> testCaseDsl = TestCaseDsl().apply(block) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> testCase = TestCaseCreator.create(testCaseDsl) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Initialisation(testCase) }</code> </pre> <br><p>  Nous cr√©ons un test, lui appliquons des actions de blocage, puis utilisons TestCaseCreator pour cr√©er des donn√©es sur le serveur et les placer dans des collections.  La fonction TestCaseCreator.create () est assez simple - nous parcourons les donn√©es et les cr√©ons sur le serveur. </p><br><h1 id="podvodnye-kamni-i-idei">  Pi√®ges et id√©es </h1><br><blockquote>  Certains tests sont tr√®s similaires et ne diff√®rent que par les donn√©es d'entr√©e et les moyens de contr√¥ler leurs affichages (par exemple, lorsque diff√©rentes devises sont indiqu√©es dans le poste vacant). </blockquote><p>  Dans notre cas, il y avait peu de ces tests, et nous avons d√©cid√© de ne pas encombrer DSL avec une syntaxe sp√©ciale </p><br><blockquote>  Avant la DSL, nous avons longtemps index√© les donn√©es et pour gagner du temps, nous avons fait beaucoup de tests dans une classe et cr√©√© toutes les donn√©es dans un bloc statique. </blockquote><p>  Ne faites pas cela - il vous sera impossible de red√©marrer le test tomb√©.  Le fait est que lors du lancement du test tomb√©, nous pourrions changer les donn√©es initiales sur le serveur.  Par exemple, nous pourrions ajouter un poste vacant √† vos favoris.  Ensuite, lorsque vous relancez le test, un clic sur l'ast√©risque entra√Ænera au contraire la suppression de la vacance de la liste des favoris, et c'est un comportement auquel on ne s'attend pas. </p><br><h1 id="itogi">  R√©sum√© </h1><br><p>  Cette m√©thode de sp√©cification des donn√©es de test a grandement simplifi√© le travail avec les tests: <br>  Lorsque vous √©crivez des tests, vous n'avez pas besoin de vous demander s'il existe un serveur et dans quel ordre vous devez initialiser les donn√©es; <br>  Toutes les entit√©s qui peuvent √™tre d√©finies sur le serveur apparaissent facilement dans les conseils IDE; <br>  Il existe un moyen unique d'initialiser et de communiquer des donn√©es entre eux. </p><br><p>  <strong>Mat√©riel connexe</strong> </p><br><p>  Si vous √™tes int√©ress√© par notre approche des tests d'interface utilisateur, alors avant de commencer, je vous sugg√®re de vous familiariser avec les documents suivants: </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Constructeurs Type-Safe</a> - documentation officielle sur le site kotlinlang.org; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Kotlin DSL: Theory and Practice</a> - excellent rapport de jPoint 2018 sur kotlin dsl et son d√©codage; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Kakao - comment rendre les tests d'interface utilisateur √† nouveau excellents</a> - connaissances de base sur le cadre Kakao pour les tests d'interface utilisateur; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Comment arr√™ter d'avoir peur et commencer √† √©crire des tests d'interface utilisateur avec Kakao</a> - une discussion sur Kakao avec AppsConf 2019. Jusqu'√† pr√©sent, seules les diapositives sont disponibles, puis il y aura une vid√©o. </li></ul><br><p>  <strong>Et ensuite</strong> </p><br><p>  Cet article est le premier d'une s√©rie sur les outils et les cadres de haut niveau pour √©crire et prendre en charge les tests d'interface utilisateur dans Android.  Lorsque de nouvelles pi√®ces seront disponibles, je les lierai √† cet article. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr455042/">https://habr.com/ru/post/fr455042/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr455026/index.html">T√©l√©phonie avec Snom: pour ceux qui travaillent √† domicile</a></li>
<li><a href="../fr455030/index.html">Sp√©cifications PHP</a></li>
<li><a href="../fr455032/index.html">Pas un insecte, mais une caract√©ristique: une √©tude de la motilit√© et de l'activit√© c√©r√©brale d'une personne atteinte de polydactylie</a></li>
<li><a href="../fr455038/index.html">Comment Plesk a visit√© KubeCon</a></li>
<li><a href="../fr455040/index.html">Am√©liorer le travail du Wi-Fi. Partie 2. Caract√©ristiques de l'√©quipement</a></li>
<li><a href="../fr455046/index.html">N + 7 livres utiles</a></li>
<li><a href="../fr455048/index.html">Mise en ≈ìuvre technique de la m√©thode des potentiels thermiques pour l'analyse des territoires</a></li>
<li><a href="../fr455052/index.html">Meetup √©t√© DIYorDIE 16 juin</a></li>
<li><a href="../fr455054/index.html">Comment Apple (en priv√©) trouvera-t-il hors ligne votre appareil perdu?</a></li>
<li><a href="../fr455056/index.html">Graphiques primitifs pour lazy, oldfags et lazy oldfags</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>