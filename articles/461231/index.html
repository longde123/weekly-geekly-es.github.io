<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üò¨ üç• üéÖüèø ¬øY qu√© diferencia elige Collation? üè´ üßúüèª üíñ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Este art√≠culo fue preparado para estudiantes del curso "MS SQL Server Developer" 
 Quiero compartir una historia de uno de los proyectos anteriores, q...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>¬øY qu√© diferencia elige Collation?</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/461231/"><p>  Este art√≠culo fue preparado para estudiantes del curso <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">"MS SQL Server Developer"</a> <br>  Quiero compartir una historia de uno de los proyectos anteriores, que ilustra que la recopilaci√≥n debe elegirse con mucho cuidado.  Y sobre lo que sucede si este par√°metro se elige de forma incorrecta y qu√© opciones existen para resolver el problema. </p><br><p>  Primero, una peque√±a introducci√≥n sobre qu√© es la colaci√≥n.  En SQL Server, el par√°metro Collation le dice al servidor c√≥mo ordenar y comparar filas.  Por ejemplo, las l√≠neas "Apple" y "apple".  ¬øSon diferentes o no?  Depende de la clasificaci√≥n especificada.  Si el registro se est√° volviendo menos o menos claro, ¬øqu√© hacer con el ejemplo de "√°rbol de Navidad" y "√°rbol de Navidad"?  ¬øLos cuenta igual o diferente?  Todo esto tambi√©n est√° en colaci√≥n. </p><br><p>  La historia sucedi√≥ en un proyecto cuya funcionalidad es muy similar a DropBox o Google Drive.  Proporciona la capacidad de administrar sus carpetas y archivos sincronizados en diferentes m√°quinas, as√≠ como la posibilidad de que otros usuarios tengan acceso a esta carpeta sincronizada. </p><br><p><img src="https://habrastorage.org/webt/zb/r_/ix/zbr_ixoq-dgwur4uwz_izd9myta.png" alt="imagen"></p><a name="habracut"></a><br><p>  Entonces, la historia comenz√≥ con el hecho de que en los servidores Prod hab√≠a 75-90% de errores en los registros (vea la captura de pantalla a continuaci√≥n), y no est√° claro de d√≥nde vinieron y cu√°l fue su raz√≥n.  El error fue: "ReadWrtLst no est√° completo".  Luego vinieron los detalles del usuario y sus carpetas. </p><br><p><img src="https://habrastorage.org/webt/i5/jz/lt/i5jzltkaco2jt9du8opn4ywi1du.png" alt="imagen"></p><br><p>  El c√≥digo encontr√≥ r√°pidamente un lugar que gener√≥ un error, pero no pudimos entender por qu√© ocurri√≥ y c√≥mo reproducirlo. Solo estaba claro que el error estaba relacionado de alguna manera con el hecho de que el usuario de alguna manera logr√≥ cree otra carpeta con el mismo nombre en su sistema operativo. </p><br><p>  Hemos recopilado informaci√≥n sobre los usuarios para quienes se emite este error.  Y aqu√≠ nos enfrentamos con la primera sorpresa: de millones de usuarios del sistema, solo 50 de ellos ten√≠an este error, y estos 50 usuarios generan el 90% de los registros de errores.  Como la situaci√≥n no se pudo reproducir, decidimos contactar a uno de los usuarios y averiguar por qu√© una de las carpetas no estaba sincronizada con ella.  La carpeta nos parec√≠a la misma que a las dem√°s, la √∫nica diferencia era que se llamaba en el idioma del usuario utilizando jerogl√≠ficos.  Y el usuario era japon√©s.  Por cierto, entre estos 50 usuarios, los japoneses eran la mayor√≠a. </p><br><p>  Gracias a uno de los desarrolladores del equipo, pudimos reproducir el error.  El error fue que el sistema operativo consideraba los nombres de las carpetas diferentes y SQL Server los consideraba iguales debido a la Clasificaci√≥n seleccionada. </p><br><p>  Colaci√≥n utilizada en el proyecto: <br>  SQL_Latin1_General_CP1_CI_AS </p><br><p>  Una peque√±a digresi√≥n sobre c√≥mo leer Colaci√≥n.  (Si est√° familiarizado con √©l, no dude en saltearlo). </p><br><p>  Entonces, hay varias partes en la Clasificaci√≥n: </p><br><ul><li>  SQL: opciones de ordenaci√≥n por SQL Server (SQL al comienzo de la Clasificaci√≥n) o Windows (entonces ser√≠a solo Latin1_ ...); </li><li>  Latin1_General: configuraci√≥n regional o idioma utilizado; </li><li>  CP1 - p√°gina de c√≥digos - p√°gina de c√≥digos; </li><li>  CI - Insensible a may√∫sculas y min√∫sculas - insensible a may√∫sculas y min√∫sculas; </li><li>  AS - Acento sensible: teniendo en cuenta los axones o los signos diacr√≠ticos, en otras palabras, 'a' no se considera igual a '·∫•'. </li></ul><br><p>  Esta intercalaci√≥n fue una vez la intercalaci√≥n predeterminada al instalar SQL Server. </p><br><p>  ¬øQu√© opciones hay? </p><br><ul><li>  _KS: teniendo en cuenta los caracteres japoneses de hiragana y katakana, si la opci√≥n no est√° seleccionada, SQL Server interpretar√° los jerogl√≠ficos de hiragana y katakana de la misma manera. </li><li> _WS: teniendo en cuenta el ancho de los caracteres, si el par√°metro no est√° seleccionado, entonces "Texto" y "T ext" se consideran las mismas l√≠neas. </li><li>  _VSS: teniendo en cuenta los signos de elegir la opci√≥n de ortograf√≠a en japon√©s, apareci√≥ a partir de la versi√≥n 2017. </li><li>  _UTF8: le permite almacenar datos en UTF8. </li></ul><br><p>  Todos los campos de texto en la base de datos utilizan el tipo NVARCHAR. <br>  Resulta que, dado que la Clasificaci√≥n actual ignor√≥ la diferencia en la ortograf√≠a de los caracteres japoneses y la diferencia en el ancho de los caracteres, SQL Server no compar√≥ las cadenas de la misma manera que el sistema operativo, lo que caus√≥ el problema, es decir.  el usuario podr√≠a crear carpetas, no podr√≠a agregarlas al sistema para sincronizaci√≥n.  Lo mismo suceder√≠a m√°s tarde al comparar nombres de archivos. </p><br><p>  Comenzamos a pensar en c√≥mo resolver este problema y cambiar la Clasificaci√≥n. </p><br><p>  La clasificaci√≥n se puede establecer en varios niveles: </p><br><ul><li>  Instancia de SQL Server </li><li>  Base de datos </li><li>  Mesa </li><li>  El campo </li></ul><br><p>  Al mismo tiempo, no se recomienda tener una clasificaci√≥n diferente dentro de la base de datos, ya que cada vez que compare filas con una clasificaci√≥n diferente, deber√° realizar la conversi√≥n usando COLLATE, que indica al servidor qu√© orden de comparaci√≥n debe usar. </p><br><p>  ¬øQu√© opciones hay en una situaci√≥n en la que est√° claro que la Clasificaci√≥n no est√° seleccionada correctamente? </p><br><ol><li>  Cambiar colaci√≥n a nivel de base de datos; </li><li>  Cambiar colaci√≥n a nivel de campo (en nuestro caso, no ten√≠a sentido cambiar para toda la tabla); </li><li>  Agregue el campo Varbinary, en el cual escribir un duplicado del campo con el nombre de la carpeta, y √∫selo para comparar; </li><li>  Indique a los usuarios que existen restricciones en el soporte de caracteres en los nombres de directorio. </li></ol><br><p>  La primera opci√≥n, cambiar la Clasificaci√≥n en el nivel de la base de datos, es la m√°s dif√≠cil.  En el caso de la base de datos, ser√≠a necesario recrear la base de datos y volver a cargar los datos all√≠.  Como el sistema funcionaba 24/7, esta opci√≥n fue rechazada de inmediato. </p><br><p>  La segunda opci√≥n para cambiar el campo: la opci√≥n m√°s f√°cil de implementar es agregar un campo con la Clasificaci√≥n deseada y transferir los datos all√≠.  Pero entonces ser√° necesario cambiar el c√≥digo en la base de datos que funciona con este campo, y hab√≠a mucho c√≥digo en la base de datos. </p><br><p>  La tercera opci√≥n nos gust√≥ m√°s, ya que en teor√≠a hizo los menores cambios, ya que el campo principal continuar√≠a existiendo con la Clasificaci√≥n actual, y no tendr√≠amos problemas con su conversi√≥n, mientras que toda la funcionalidad necesaria en forma de contabilidad para el alfabeto japon√©s o amplia Los personajes funcionar√≠an.  La desventaja era que era necesario realizar cambios en la parte del software, pero desde esta parte del servidor, esto se pod√≠a hacer. </p><br><p>  La cuarta opci√≥n era la m√°s simple en este caso, porque el n√∫mero total de usuarios era de varios millones, y solo 50 ten√≠an un problema. Sin embargo, si la aplicaci√≥n se usara activamente en Jap√≥n, esta soluci√≥n ser√≠a de poca utilidad. </p><br><p>  Despu√©s de presentar los datos a la administraci√≥n, se decidi√≥ notificar a los usuarios que el software no admite una serie de caracteres, y cuando se usa en nombre de archivos y carpetas sincronizados, el software puede no funcionar correctamente.  Esta es una soluci√≥n temporal, porque con una mayor distribuci√≥n, aumentar√° el n√∫mero de usuarios que enfrentan un problema similar, y ser√° necesario cambiar algo usando las tres primeras opciones. </p><br><p>  La mejor opci√≥n para elegir Colaci√≥n se basa en los requisitos de su aplicaci√≥n.  Si desea que SQL Server compare cadenas de la misma manera que el sistema operativo, entonces la Clasificaci√≥n es definitivamente incorrecta de forma predeterminada.  Desafortunadamente, tales matices rara vez son visibles al comienzo de un proyecto cuando se dise√±a un sistema, pero, con suerte, despu√©s de leer el art√≠culo, recordar√° la situaci√≥n descrita y no se subir√° a ese rastrillo. </p><br><p>  Recursos √∫tiles de recopilaci√≥n: <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://docs.microsoft.com/en-us/sql/relational-databases/collations/collation-and-unicode-support?view=sql-server-2017</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://www.red-gate.com/simple-talk/sql/sql-development/questions-sql-server-collations-shy-ask/</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://www.virtual-dba.com/sql-server-collation/</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/461231/">https://habr.com/ru/post/461231/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../461219/index.html">Dell Latitude 7400 2-en-1: una port√°til convertible corporativa hermosa y liviana con una carcasa de metal</a></li>
<li><a href="../461223/index.html">Resumen de IaaS: alto rendimiento, almacenamiento de datos y nuevas tecnolog√≠as para centros de datos</a></li>
<li><a href="../461225/index.html">C√≥mo llegar al Polo Norte desde la base a la deriva de Barneo</a></li>
<li><a href="../461227/index.html">Embarcadero RAD Studio 10.3.2 sali√≥ o lo que est√° muerto ... muri√≥</a></li>
<li><a href="../461229/index.html">Helsinki C√≥mo encontrar trabajo en la industria del juego finlandesa, comenzar a trabajar sin permiso y no violar las leyes rusas</a></li>
<li><a href="../461239/index.html">Aleteo en los ejemplos. Enlaces profundos en aplicaciones Flutter</a></li>
<li><a href="../461241/index.html">Wolfram Mathematica en Geof√≠sica</a></li>
<li><a href="../461243/index.html">No vayas a √Åfrica a caminar: ¬øcu√°l es la situaci√≥n con la censura de Internet en el continente negro?</a></li>
<li><a href="../461247/index.html">Las 50 mejores fuentes de gesti√≥n de productos para leer, escuchar y mirar</a></li>
<li><a href="../461249/index.html">Escribir una aplicaci√≥n de Android para fan√°ticos del cine - Parte 2 (Dise√±o)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>