<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üêã üêΩ üë∂üèΩ Panel de control centralizado para fuentes de iluminaci√≥n Rotor TsPKIO-2D üîï ü•Ä üëßüèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Lo siento, no me he divertido mucho con los nombres durante mucho tiempo, as√≠ como con los perif√©ricos para la automatizaci√≥n del hogar. Espec√≠ficamen...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Panel de control centralizado para fuentes de iluminaci√≥n Rotor TsPKIO-2D</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/411093/"><img src="https://habrastorage.org/getpro/geektimes/post_images/72f/6a9/ceb/72f6a9ceb826b19cdb266c3d334da65b.jpg" alt="imagen"><br><br>  Lo siento, no me he divertido mucho con los nombres durante mucho tiempo, as√≠ como con los perif√©ricos para la automatizaci√≥n del hogar.  Espec√≠ficamente, esta cosa, el control remoto de la luz, result√≥ porque quer√≠a algo con una interfaz de pulsar, girar y hacer clic, y no con una dispersi√≥n habitual de botones.  El efecto wow no se ha logrado: en casa no noto el control remoto a quemarropa, pero al menos cerr√© la gestalt. <br><a name="habracut"></a><br>  Breve TOR: <br><br>  1) Gesti√≥n de tres grupos de iluminaci√≥n en la cocina. <br>  2) Gesti√≥n de tres grupos de iluminaci√≥n en la sala. <br>  3) Gesti√≥n de todas las fuentes de luz al mismo tiempo. <br>  4) Duraci√≥n razonable de la bater√≠a (de una semana) <br>  5) Compatible con la codificaci√≥n Livolo, SC2260, EV1527 <br><br>  Por lo tanto, no necesita leer m√°s si no le gustan los interruptores Arduino, Livolo y los enchufes de radio chinos.  Porque el primero es la base del control remoto, y el segundo y el tercero son la periferia. <br><br><h2>  Concepto </h2><br>  La l√≥gica de control me pareci√≥ la siguiente: <br><br><ol><li>  Al presionar la ‚Äúperilla‚Äù se cambian las zonas del grupo de iluminaci√≥n en un anillo (cocina - habitaci√≥n - todo). </li><li>  Al girar la perilla, dependiendo del sentido de rotaci√≥n, se enciende o apaga la iluminaci√≥n del grupo seleccionado. </li><li>  El modo de funcionamiento (grupo seleccionado) se muestra mediante una discreta indicaci√≥n LED. </li></ol><br>  Como uso el control de radio de acuerdo con la opci√≥n m√°s despreciada, sin protecci√≥n contra interferencias y retroalimentaci√≥n, al mismo tiempo se proporciona un peque√±o truco en caso de una operaci√≥n perdida. <br><br>  Si girar la perilla no conduce al resultado deseado, la combinaci√≥n de presionar y girar en la direcci√≥n opuesta le permite omitir el comando.  Entonces el comando puede repetirse como de costumbre. <br><br>  Es decir, si gire la perilla en el sentido de las agujas del reloj y la luz principal no se enciende, entonces puedo presionar la perilla, girarla en sentido antihorario y luego soltarla y girarla en el sentido de las agujas del reloj nuevamente para repetir el encendido. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/V0ZpCxEb3-U" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  ¬øPor qu√© tan dif√≠cil?  Entonces, adem√°s de los protocolos inc√≥modos, tambi√©n tengo perif√©ricos inc√≥modos.  Por ejemplo, los interruptores de luz controlados por radio Livolo y los rel√©s de radio, que tienen el mismo comando para encender y apagar, junto con los enchufes de radio normales, en los que los comandos para encender y apagar est√°n separados. <br><br>  El truco de omisi√≥n del equipo le permite vencer creativamente la no inclusi√≥n (no exclusi√≥n) sin romper el esquema general de iluminaci√≥n.  Adem√°s, omitir un comando le permite saltar sobre fuentes de luz que no necesita encender o apagar. <br><br>  Bueno, por supuesto, para comprender lo que est√° sucediendo con el control remoto, tiene un indicador separado que se ilumina al enviar un comando. <br><br>  Si la consola no se toca durante alg√∫n tiempo (configurada en el c√≥digo), el controlador se pone en suspensi√≥n.  Sin embargo, no guarda el √∫ltimo estado, y cuando se despierta presionando la pluma, comienza la vida desde cero. <br><br>  Esto no es un error.  Repito, tengo interruptores sin retroalimentaci√≥n, y la consola es f√≠sicamente incapaz de obtener informaci√≥n sobre el estado actual de cada dispositivo perif√©rico controlado. <br><br>  Por lo tanto, inmediatamente despu√©s de despertarse, el giro de la perilla enciende o apaga la luz desde cero. <br><br><h2>  Primer acercamiento </h2><br>  El concepto visual del tipo "caja con un giro" requer√≠a, como puede suponer, dos cosas: cajas y giros.  En la primera versi√≥n, el papel de la caja lo desempe√±aba un banco de energ√≠a delgado, cuyo uso resolvi√≥ dos problemas a la vez: ten√≠a un estuche y un esquema de carga de la bater√≠a, adem√°s con un conector.  La bater√≠a en s√≠, por supuesto, tuvo que ser reemplazada por una m√°s compacta, de lo contrario el relleno ya no podr√≠a caber. <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/640/299/4df/6402994df7e71b82835d12f42541f1f0.jpg" alt="imagen"><br><br>  Result√≥ m√°s complejo con el giro.  Mientras buscaba, descubr√≠ que cuanto m√°s bonita es la perilla del potenci√≥metro y cuanto m√°s grande es, m√°s cercano es el costo de su gramo al costo de un gramo de oro.  Por lo tanto, adquir√≠ un bol√≠grafo, que me conven√≠a m√≠nimamente por sus propiedades est√©ticas. <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/232/a3e/b60/232a3eb6074d6d8724fdc76d353274cc.jpg" alt="imagen"><br><br>  La parte de control fue el resultado de un experimento con ATmega328P y una continuaci√≥n l√≥gica de la historia establecida por la automatizaci√≥n del hogar existente (en los mismos protocolos de radio Arduino y primitivos). <br><br>  No compr√© muy caro una dispersi√≥n de los controladores mencionados y prototipos condicionalmente (de hecho, un adaptador de una caja peque√±a a un escal√≥n grande) con el objetivo de tratar de hacer una versi√≥n de bajo presupuesto de Arduino con un n√∫mero m√≠nimo (pero razonable) de elementos. <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/625/ebb/095/625ebb0959641911621741e00fb1b699.jpg" alt="imagen"><br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/be0/e1c/ac4/be0e1cac460246c56f97f0c45e1c8bc7.jpg" alt="imagen"><br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/53d/bc5/9f1/53dbc59f1bb9ec5583f84de546b2df76.jpg" alt="imagen"><br><br>  El experimento result√≥ exitoso, y el controlador configurado para el entorno Arduino mostr√≥ el LED con bastante √©xito despu√©s de tragarse el cl√°sico Blink.  Bueno, entonces, en el principio de "terminar el b√∫ho", agregu√© un codificador (con un bot√≥n), tres LED y un transmisor normal con modulaci√≥n de amplitud en una portadora de 433.92 MHz a la placa resultante. <br><br>  Para colocar todos los elementos en un caso peque√±o, tuve que sufrir un poco, pero el control remoto a√∫n funcionaba.  Y aunque, al parecer, el problema est√° resuelto, quer√≠a m√°s: el caso original. <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/b0b/716/2cc/b0b7162cc2941009ef081f0f76e4a2a8.jpg" alt="imagen"><br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/36b/08b/c76/36b08bc76093a6b66fe3f5e1b3597b1a.jpg" alt="imagen"><br><br><h2>  Segundo enfoque </h2><br>  En realidad, la primera versi√≥n (quej√°ndose) en apariencia de un grupo de camaradas se hizo a√±icos, as√≠ que la pospuse indefinidamente.  Pero no lo desarm√≥: es una pena. <br><br>  Pero cuando apareci√≥ la impresora 3D, se prometi√≥ un d√≠a hacer el mismo estuche original y as√≠ cerrar la pregunta con el control remoto. <br><br>  No s√© si result√≥ bueno o malo. Realmente no s√© c√≥mo evaluar mis cosas.  Pero en 3DToday el equipo es m√°s acogedor que en MySKU (de lo que no me quejo, no es un regalo para m√≠), y calificaron el caso m√°s alto que yo. <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/5a1/89d/905/5a189d905d402c93afba5e4f4d88c1da.jpg" alt="imagen"><br><br>  Pero teniendo total libertad de acci√≥n, abandon√© las bater√≠as chinas fr√°giles y arrastradas, y tom√© el viejo 18650 como fuente de energ√≠a. Y, como puede ver f√°cilmente, son precisamente sus dimensiones las que determinan en gran medida las dimensiones de todo el caso. <br><br>  Comenc√© a hacer la carcasa modular, que consta de muchas partes, lo que me permiti√≥ reimprimir solo elementos individuales (err√≥neos o no muy √≥ptimos), y no todo el producto. <br><br>  Otro punto es que realmente no me gusta hacer recortes para los conectores, lo que realmente no puedo hacer.  Por lo tanto, en la cadena de suministro hay otro truco conocido por <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Evelyn the hedgehog</a> : la carga inal√°mbrica. <br><br><img src="https://habrastorage.org/webt/ie/zq/6m/iezq6m_73cckmk6y-bidsohs9ye.jpeg"><br><br>  En mi zashashnik yac√≠a otro receptor, que inmediatamente puse en acci√≥n. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/fDLqxxDvQhM" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Finalmente, el √∫ltimo truco es bastante obvio, pero a√∫n as√≠: para que el control remoto no se arrastre alrededor de la mesa, pegu√© un pedazo de una alfombrilla antideslizante en la parte inferior.  Y al final, esto es un monolito absoluto, aunque reorganizarlo a otro lugar tampoco es un problema. <br><br><h2>  Lo que se necesita para repetir </h2><br><h3>  Pieza de hierro </h3><br>  1) Controlador ATmega328P - 1 pc.  (en mi paquete TQFP, pero cualquiera puede) <br>  2) resistencia de 10 kOhm - 5 piezas  (4 para suprimir el rebote del codificador, 1 para el controlador) <br>  3) Resistencia de 100 ohmios - 3 piezas <br>  4) Condensadores de cer√°mica 0.1 microfaradios - 4 piezas.  (al controlador y supresi√≥n del rebote del codificador) <br>  5) Empuje codificador (valcoder) - 1 pc.  (Tengo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">PEC12-4220F-S0024</a> ) <br>  6) LED - 3 piezas  (di√°metro 3 mm) <br>  7) Tablero de carga de bater√≠a de litio - 1 pc.  (desde el banco de energ√≠a que lleg√≥ a la mano, en teor√≠a, cualquiera con encendido autom√°tico bajo carga lo har√°) <br>  8) Receptor de carga inal√°mbrico Qi - 1 pc. <br>  9) Un transmisor con modulaci√≥n de amplitud a 433 MHz - 1 pc.  ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">como este</a> ) <br>  10) Alguna fibra de vidrio para la placa codificadora <br>  11) impresora 3D <br>  12) Pl√°stico adecuado (imprim√≠ PLA) <br>  13) Tornillos M4x30 - 4 piezas <br><br>  En general, se puede reducir el n√∫mero de componentes.  Por ejemplo, en una versi√≥n muy m√≠nima, el controlador no requiere flejes, aunque decid√≠ seguir <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">el consejo de Nick Gammon</a> y no perdon√© un par de condensadores y una resistencia. <br><br>  Del mismo modo, no puede molestarse con la supresi√≥n de hardware del rebote de contactos e intentar sobrevivir con el software.  Luego puede tachar cuatro resistencias m√°s y un par de condensadores. <br><br>  Alternativamente, puede usar una placa Arduino preparada, como la Pro Mini, pero en este caso no puedo garantizar un bajo nivel de consumo de energ√≠a, y tendr√° que conjurarlo usted mismo.  Al mismo tiempo, el caso tendr√° que ser corregido. <br><br>  Esquema: <br><br><img src="https://habrastorage.org/webt/wo/xv/hh/woxvhhfaucpc3emhiyipfk56m1s.png"><br><br>  Como referencia, el pinout ATmega328p en el paquete TQFP-32 de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Hobby Electronics</a> : <br><br><img src="https://habrastorage.org/webt/1y/ea/sp/1yeasp0veriyrgvhrafu_inlwlm.jpeg"><br><br>  Para mi codificador, dibuj√© un peque√±o tablero: <br><br><img src="https://habrastorage.org/webt/i2/jg/d7/i2jgd7p7jlv1kyhbyjhoayd3d4k.jpeg"><br><br><img src="https://habrastorage.org/webt/ke/cr/yt/kecrytksno5yhwsjjdpcbwgc9-c.jpeg"><br><br><img src="https://habrastorage.org/webt/6y/vb/8j/6yvb8jl1h6zvpm-z-atgntumnsw.jpeg"><br><br>  Si es bueno, tendr√≠a que perforarlo para montar el codificador, o presionarlo con su "barriga a la placa (cuidando el aislamiento para que no haya cortocircuito) para que el codificador se monte a) m√°s o menos uniformemente yb) no se tambalee.  Hist√≥ricamente, tengo una segunda opci√≥n. <br><br>  Para el caso, es importante que la altura de la placa con piezas, excluyendo el codificador, no sea m√°s (o no mucho m√°s) de 5 mm. <br><br><div class="spoiler">  <b class="spoiler_title">Si la placa Arduino no est√° lista, entonces para que todo funcione, primero debe escribir el gestor de arranque Arduino en el controlador ATmega328P.</b> <div class="spoiler_text">  Para hacer esto, primero, agregue una descripci√≥n del controlador al entorno Arduino.  Para hacer esto, vaya <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">al sitio web oficial de Arduino</a> y descargue el archivo de descripci√≥n adecuado para su versi√≥n del entorno ( <a href="">para 1.6</a> , <a href="">para 1.5</a> , <a href="">para 1.0</a> ). <br><br>  El contenido del archivo debe extraerse en la carpeta de hardware de la carpeta del entorno Arduino.  En el futuro, describo lo que est√° sucediendo en el ejemplo del entorno 1.0.3, que todav√≠a uso. <br><br>  Cuando se copian las descripciones, debe iniciar Arduino y cargar el boceto del programador en Arduino, que se utilizar√° como este mismo programador.  El boceto se encuentra en el men√∫ Archivo - Ejemplos - ArduinoISP. <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/037/517/98f/03751798f648adb8fea47a284a912667.jpg" alt="imagen"><br><br>  Por supuesto, debe elegir su placa y puerto.  Elijo Mega, porque lo tengo: <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/7e7/483/4bd/7e74834bdd786979f926f4b65e2e344f.jpg" alt="imagen"><br><br>  Despu√©s de cargar el boceto del programador, debe cambiar al tablero de destino.  Es decir  en nuestro caso, ATmega328 con una frecuencia de 8 MHz y un oscilador maestro interno.  Estar√° en la lista de tableros si las descripciones mencionadas anteriormente se copian correctamente: <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/b89/e98/7b2/b89e987b2243a79cc1d36e95d5a7ebab.jpg" alt="imagen"><br><br>  Ahora necesita conectar las l√≠neas MISO, MOSI y SCK de la placa del programador y la placa con el futuro Arduino, y tambi√©n conectar RESET, GND y VCC.  Adem√°s, el poder es el mejor en √∫ltimo lugar. <br><br>  Basado en la infograf√≠a anterior y la descripci√≥n de Arduino Mega, emerge la siguiente imagen: <br><br>  SPI - Arduino Mega - ATmega328p <br><br>  MISO - 50 - 16 <br>  MOSI - 51 - 15 <br>  SCK - 52-17 <br>  SS (RESET) - 53 - 29 <br><br>  Conexi√≥n f√≠sica a su gusto, utilic√© un m√©todo exclusivamente b√°rbaro: cables de tablero ordinarios directamente en los orificios del tablero, sin soldadura ni aislamiento: <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/c14/df6/d5f/c14df6d5f4cdda937de81eb2fa555ee0.jpg" alt="imagen"><br><br>  Si todo est√° listo, escriba el gestor de arranque.  Primero, aseg√∫rese de seleccionar el programador correcto (Servicio - Programador - Arduino como ISP): <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/e0c/dc4/a0c/e0cdc4a0c8914fbed3f5328c676f0210.jpg" alt="imagen"><br><br>  Luego hacemos el Servicio - Grabar el gestor de arranque: <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/568/21e/12f/56821e12f02cd705995d40429b15eec6.jpg" alt="imagen"><br></div></div><br>  Despu√©s de eso, la salida es una placa Arduino minimalista, para cargar bocetos en los que puede usar el adaptador serie USB o una placa Arduino completa con dicho adaptador a bordo.  En el primer caso, debe conectar RX y TX en forma transversal, y no olvide conectar una tierra com√∫n.  En el segundo caso, tambi√©n es necesario acortar el RESET Arduino, que se usa como adaptador, a tierra. <br><br>  Si, como yo, no tiene un circuito para reiniciar autom√°ticamente el controlador antes de descargar el boceto, entonces hay dos opciones: ya sea reiniciarlo o simplemente encenderlo cuando el entorno Arduino dice que la descarga ha comenzado. <br><br><h3>  Vivienda </h3><br>  El caso, como dije, es modular.  Esto significa que en la parte interna oculta a los ojos, puede dejar entrar el pl√°stico que tiene rancio y ya no es adecuado.  Puedes ponerle electr√≥nica: <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/030/0a3/251/0300a325144382295c6e3b8d54971e23.jpg" alt="imagen"><br><br>  Llamo la atenci√≥n sobre el hecho de que el caso es espec√≠fico y est√° dise√±ado para adaptarse a mi versi√≥n del relleno. <br><br>  Propongo que el rotor sea transparente para que disperse la luz de los indicadores.  Para mayor peso, se puede insertar una tuerca M16 dentro del rotor: <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/9a0/8ef/68e/9a08ef68e2a079da4af3ed1eb148e961.jpg" alt="imagen"><br><br>  Todav√≠a necesito una camisa de rotor y una cubierta.  La tapa se inserta simplemente hacia adentro y descansa sobre la fricci√≥n.  Y, por supuesto, no puede prescindir de las partes superior e inferior de la carcasa exterior. <br><br>  Imprim√≠ un rotor con un relleno del 10%, el resto de los elementos con un relleno del 5%.  Pl√°stico - PLA.  La temperatura establecida de la boquilla en mi impresora es 200C en las primeras tres capas, 185C en la siguiente.  Desafortunadamente, no puedo decir cu√°l es la temperatura real de la boquilla.  La mesa est√° fr√≠a. <br><br>  El montaje es simple. <br><br><img src="https://habrastorage.org/webt/ka/cq/2-/kacq2-crn1cictkqxhpb0sok15u.jpeg"><br><br>  Los tableros se colocan en las ranuras de la caja duradera, los LED - patas en las ranuras de la parte inferior de la caja duradera.  La antena del transmisor se baja, el receptor de carga inal√°mbrico se baja de la misma manera, por lo que est√° m√°s cerca de esta misma carga. <br><br><img src="https://habrastorage.org/webt/d9/zu/ex/d9zuextrjywuvjbj4ve68-c2rgg.png"><br><br>  El relleno se fija mediante una placa intermedia, en cuya ranura pasa el arn√©s de cables del codificador. <br><br>  El codificador se fija con la placa superior, todos juntos se aprietan con tornillos M4x30, que cortan las roscas en pl√°stico. <br><br>  Ahora la carcasa duradera se puede encerrar en mitades de la carcasa exterior.  Se coloca un rotor en el eje del codificador y se coloca una camisa en el rotor.  Opcionalmente, una alfombrilla antideslizante se pega al fondo del cuerpo.  Otra opci√≥n es un inserto decorativo que oculta la costura entre las mitades del cuerpo. <br><br><div class="spoiler">  <b class="spoiler_title">C√≥digo</b> <div class="spoiler_text">  En el c√≥digo, debe especificar comandos para encender y apagar sus dispositivos perif√©ricos.  Opcional: cambie el tiempo de espera de apagado autom√°tico. <br><br>  Todo esto se encuentra en la secci√≥n variable. <br><br><pre><code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//  : http://donalmorrissey.blogspot.ru/2010/04/sleeping-arduino-part-5-wake-up-via.html //  Livolo: http://forum.arduino.cc/index.php?action=dlattach;topic=153525.0;attach=108106 #include &lt;avr/sleep.h&gt; #include &lt;avr/power.h&gt; #include &lt;livolo.h&gt; #define adc_disable() (ADCSRA &amp;= ~(1&lt;&lt;ADEN)) // disable ADC (before power-off) #define adc_enable() (ADCSRA |= (1&lt;&lt;ADEN)) // re-enable ADC #define txPin 7 //   Livolo livolo(txPin); #define PULSESHORT 450 #define PULSELONG 1350 #define PULSESYNC 13950 #define encA 5 #define encB 6 //   #define buttonPin 2 //   () #define roomLed 10 //    #define kitchenLed 9 //    #define switchLed 3 //     #define switchLedTimeOut 150 //      #define switchTreshold 4 //      #define offDelay 15000 //   #define rLev 3 //     #define kLev 3 //     #define glev 2 //     #define txPowerPin 8 //    #define kitchenBackLightOn1 12 #define kitchenBackLightOn2 34 #define kitchenMainLightOn 56 #define roomBackLightOn 12 #define roomMainLightOn1 34 #define roomMainLightOn2 56 #define mainLightOn 12 #define kitchenBackLightOff1 12 #define kitchenBackLightOff2 34 #define kitchenMainLightOff 56 #define roomBackLightOff 12 #define roomMainLighOtff1 34 #define roomMainLightOff2 56 #define mainLightOff 12 #define LivoloID 8500 volatile byte rotorMode = 0; //   byte currentMode = 0; //    int curEncA, prevEncA, curButton, prevButton; //   ,  byte encCountPlus = 0; //   byte encCountMinus = 0; //   unsigned long offTimeOut = 0; //    unsigned long modeTimeOut = 0; //        unsigned long switchLedTime = 0; //      unsigned long modeTime = 0; //   unsigned int modeTreshold = 500; //     (  ) unsigned int bounceTreshold = 200; //     byte rLevState = 0; byte kLevState = 0; byte gLevState = 0; //   k - , r - , h - , b -  boolean kBackState = false; boolean kBackState1 = false; boolean kMainState = false; boolean rBackState = false; boolean rMainState = false; boolean rMainState1 = false; boolean hMainState = false; boolean bMainState = false; boolean afterSleep = false; //      boolean modeTimeOutStart = false; boolean switchLedOn = false; boolean allOn = false; //  " "    boolean allOff = false; //  " "    static void ookPulse(int on, int off) { digitalWrite(txPin, HIGH); delayMicroseconds(on); digitalWrite(txPin, LOW); delayMicroseconds(off); } static void rcSend(long remoteCode) { for (byte reSend = 0; reSend &lt; 8; reSend++) { for(byte repeat=0; repeat&lt;4; repeat++){ for (byte i = 24; i&gt;0; i--) { // transmit remoteID byte txPulse=bitRead(remoteCode, i-1); // read bits from remote ID // Serial.print(txPulse); switch (txPulse) { case 0: // 00 ookPulse(PULSESHORT,PULSELONG); //ookPulse(PULSESHORT,PULSELONG); break; case 1: // 11 ookPulse(PULSELONG,PULSESHORT); //ookPulse(PULSELONG,PULSESHORT); break; } // switch } // for loop ookPulse(PULSESHORT,PULSESYNC); // S(ync) // Serial.println(); } // repeat } delay(150); } void switchLedToggle() { digitalWrite(switchLed, HIGH); switchLedTime = millis(); switchLedOn = true; } void lightsUp(boolean lightsUpMode) { //       ""     //   "" -   if (afterSleep == true) { if (lightsUpMode == false) { gLevState = 1; rLevState = 3; kLevState = 3; } else {gLevState = 0; rLevState = 0; kLevState = 0; } afterSleep = false; //   " " } //   if (rotorMode == 2) { if (lightsUpMode == false){ if (allOff == false) { switchLedToggle(); if (digitalRead(buttonPin) == HIGH) { //   gLevState = 0; rLevState = 0; kLevState = 0; rcSend(kitchenBackLightOff1); rcSend(kitchenBackLightOff2); rcSend(roomBackLightOff); livolo.sendButton(LivoloID, mainLightOff); } allOff = true; allOn = false; } } if (lightsUpMode == true){ //  ,    if (allOn == false) { switchLedToggle(); if (digitalRead(buttonPin) == HIGH) { gLevState = 1; rLevState = 3; kLevState = 3; rcSend(kitchenBackLightOn1); rcSend(kitchenBackLightOn2); rcSend(roomBackLightOn); livolo.sendButton(LivoloID, mainLightOff); //    Livolo livolo.sendButton(LivoloID, kitchenMainLightOn); //#1   livolo.sendButton(LivoloID, roomMainLightOn1); // #2 livolo.sendButton(LivoloID, roomMainLightOn2); // #3 livolo.sendButton(LivoloID, mainLightOn); // #6 } allOn = true; allOff = false; } } } //  if (rotorMode == 1) { if (lightsUpMode == false &amp;&amp; kLevState &gt; 0) { switchLedToggle(); if (digitalRead(buttonPin) == HIGH) { if (kLevState == 3) { //   livolo.sendButton(LivoloID, kitchenMainLightOff); // #3 } if (kLevState == 2) { //   2 livolo.sendButton(LivoloID, kitchenBackLightOff2); // #6 } if (kLevState == 1) { //   1 rcSend(kitchenBackLightOff1); } } if (kLevState!=0) { kLevState--;} // Serial.println(kLevState); } if (lightsUpMode == true &amp;&amp; kLevState &lt; 3) { switchLedToggle(); kLevState++; if (digitalRead(buttonPin) == HIGH) { if (kLevState &gt; 3) {kLevState = 3;} // Serial.println(kLevState); if (kLevState == 1) { //   1 rcSend(kitchenBackLightOn1); } if (kLevState == 2) { //   2 livolo.sendButton(LivoloID, kitchenBackLightOn2); // #6 } if (kLevState == 3) { //   livolo.sendButton(LivoloID, kitchenMainLightOn); // #3 } } } } //  if (rotorMode == 0) { if (lightsUpMode == false &amp;&amp; rLevState &gt; 0) { switchLedToggle(); if (digitalRead(buttonPin) == HIGH) { if (rLevState == 3) { //  1 livolo.sendButton(LivoloID, roomMainLighOtff1); //#1 } if (rLevState == 2) { //   livolo.sendButton(LivoloID, roomMainLightOff2); // #2 } if (rLevState == 1) { //   rcSend(roomBackLightOff); } } if (rLevState != 0) { rLevState--; } } if (lightsUpMode == true &amp;&amp; rLevState &lt; 3) { switchLedToggle(); rLevState++; if (digitalRead(buttonPin) == HIGH) { if (rLevState == 1) { //   rcSend(roomBackLightOn); } if (rLevState == 2) { //   livolo.sendButton(LivoloID, roomMainLightOn1); //#1 } if (rLevState == 3) { //   1 livolo.sendButton(LivoloID, roomMainLightOn2); // #2 } } } } } void wakeUp() { detachInterrupt(0); } void setMode() { if (rotorMode &gt;= 2 ) { rotorMode = 0; } else { rotorMode++; } offTimeOut = millis(); } void ledBlink() { for (byte iLed = 0; iLed&lt;3; iLed++) { digitalWrite(kitchenLed, HIGH); digitalWrite(roomLed, HIGH); delay(100); digitalWrite(kitchenLed, LOW); digitalWrite(roomLed, LOW); delay(100); } } void setLed() { if (rotorMode == 0) { //  digitalWrite(roomLed, HIGH); digitalWrite(kitchenLed, LOW); } if (rotorMode == 1) { //  digitalWrite(roomLed, LOW); digitalWrite(kitchenLed, HIGH); } if (rotorMode == 2) { //    digitalWrite(roomLed, HIGH); digitalWrite(kitchenLed, HIGH); } } void enterSleep() { // ledBlink(); afterSleep = true; digitalWrite(txPin, LOW); digitalWrite(txPowerPin, LOW); digitalWrite(roomLed, LOW); digitalWrite(kitchenLed, LOW); digitalWrite(switchLed, LOW); pinMode(txPin, INPUT); pinMode(txPowerPin, INPUT); pinMode(roomLed, INPUT); pinMode(kitchenLed, INPUT); pinMode(switchLed, INPUT); attachInterrupt(0, wakeUp, LOW); adc_disable(); set_sleep_mode(SLEEP_MODE_PWR_DOWN); sleep_enable(); sleep_mode(); sleep_disable(); power_all_enable(); pinMode(txPin, OUTPUT); pinMode(txPowerPin, OUTPUT); pinMode(roomLed, OUTPUT); pinMode(kitchenLed, OUTPUT); pinMode(switchLed, OUTPUT); digitalWrite(txPin, LOW); digitalWrite(txPowerPin, HIGH); // ledBlink(); setLed(); offTimeOut = millis(); allOn = false; allOff = false; } void setup() { // Serial.begin(115200); pinMode(txPin, OUTPUT); pinMode(txPowerPin, OUTPUT); pinMode(roomLed, OUTPUT); pinMode(kitchenLed, OUTPUT); pinMode(switchLed, OUTPUT); digitalWrite(txPin, LOW); digitalWrite(txPowerPin, HIGH); digitalWrite(roomLed, LOW); digitalWrite(kitchenLed, LOW); digitalWrite(switchLed, LOW); // pinMode(buttonPin, INPUT_PULLUP); pinMode(buttonPin, INPUT); pinMode(encA, INPUT); pinMode(encB, INPUT); prevEncA = digitalRead(encA); offTimeOut = millis(); rotorMode = 0; setLed(); prevButton = digitalRead(buttonPin); } void loop() { if ((millis() - offTimeOut) &gt; offDelay) { enterSleep(); } else { //     if (switchLedOn == true) { if ((millis() - switchLedTime) &gt; switchLedTimeOut) { digitalWrite(switchLed, LOW); switchLedOn = false; } } //       if (digitalRead(buttonPin) == LOW) { offTimeOut = millis(); } //   curButton = digitalRead(buttonPin); if ((prevButton == HIGH) &amp;&amp; (curButton == LOW)) { if (modeTimeOutStart == false) { modeTimeOut = millis(); modeTimeOutStart = true; } } else { if (modeTimeOutStart == true) { modeTime = millis() - modeTimeOut; if ((modeTime &lt; modeTreshold) &amp;&amp; (modeTime &gt; bounceTreshold)) { setMode(); modeTimeOutStart = false; prevButton = digitalRead(buttonPin); } else { modeTimeOutStart = false; prevButton = digitalRead(buttonPin); } } } //    if (currentMode != rotorMode) { //       ,     currentMode = rotorMode; //     setLed(); } //   curEncA = digitalRead(encA); if ((prevEncA == LOW) &amp;&amp; (curEncA == HIGH)) { offTimeOut = millis(); if (digitalRead(encB) == LOW) { encCountMinus++; encCountPlus = 0; // Serial.println("Encoder Minus"); if (encCountMinus &gt; switchTreshold) { encCountMinus = 0; lightsUp(false); } } else { encCountPlus++; encCountMinus = 0; // Serial.println("Encoder Plus"); if (encCountPlus &gt; switchTreshold) { encCountPlus = 0; lightsUp(true); } } } prevEncA = curEncA; } }</span></span></code> </pre> <br></div></div><br>  Modelo de caja <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">por referencia</a> . <br><br>  Eso es todo. <br><br>  PD: Trat√© de no olvidar nada, pero pude.  Si es as√≠, me disculpo y har√© todo lo posible para responder correctamente las preguntas principales y corregir los errores. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es411093/">https://habr.com/ru/post/es411093/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es411083/index.html">Puesta de sol "Estrellas de la humanidad"</a></li>
<li><a href="../es411085/index.html">Pi-Sonos v3.0: ¬øtrabajando en errores o en un proyecto completamente nuevo?</a></li>
<li><a href="../es411087/index.html">El futuro cercano de las tarjetas de video</a></li>
<li><a href="../es411089/index.html">C√≥mo identificar un sat√©lite en √≥rbita</a></li>
<li><a href="../es411091/index.html">Tecnolog√≠as de centro de datos: informaci√≥n general sobre conmutadores QFX</a></li>
<li><a href="../es411095/index.html">El telescopio Kepler se queda sin combustible. La final est√° cerca</a></li>
<li><a href="../es411097/index.html">Mensajero m√≥vil independiente</a></li>
<li><a href="../es411099/index.html">Es f√°cil evaluar PPFD cuando se ilumina una planta con LED blancos: 1000 lux = 15 Œºmol / s / m2</a></li>
<li><a href="../es411101/index.html">Las autoridades de Nueva York permitieron aumentar el costo de la electricidad para los mineros</a></li>
<li><a href="../es411105/index.html">El rendimiento del dron de mensajer√≠a depender√° de d√≥nde vivas</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>