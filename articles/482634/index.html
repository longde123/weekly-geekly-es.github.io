<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèª‚Äç‚öïÔ∏è üê¨ üêí Pero la esencia es algo, o minimizar el c√≥digo fuente es m√°s f√°cil de lo que parece. üßëüèΩ‚Äçü§ù‚Äçüßëüèª üßëüèø‚Äçü§ù‚Äçüßëüèº üëå</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En estos maravillosos d√≠as de enero, a todos nosotros, por supuesto, nos preocupa la cuesti√≥n de minimizar el c√≥digo fuente y preservar el invariante....">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Pero la esencia es algo, o minimizar el c√≥digo fuente es m√°s f√°cil de lo que parece.</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/482634/"><img src="https://habrastorage.org/webt/ls/g9/gy/lsg9gy2nbzs5m0redadf6s3sqjc.png"><br><p>  En estos maravillosos d√≠as de enero, a todos nosotros, por supuesto, nos preocupa la cuesti√≥n de minimizar el c√≥digo fuente y preservar el invariante.  Quiero decir, ¬øno te importa?  En vano ... Aqu√≠ el compilador cay√≥, y el programa es gigantesco, de alguna manera es un inconveniente para los desarrolladores enviar tal cosa.  Y luego comienza la diversi√≥n: ¬øqu√© pasa si la tiras?  Oh, no se cae, est√° bien, nos vamos, pero ¬øy si es as√≠?  - Todav√≠a se bloquea, y esto, y esto, y eso ... Oh, comenc√© el compilador en las fuentes antiguas. </p><br><p>  Al mismo tiempo, automatizar la b√∫squeda de errores es una cuesti√≥n de vida: git bisect, llvm-bugpoint, creduce, ... En este art√≠culo describir√© otra forma de resolver el problema de simplificar el caso de prueba, m√°s o menos universal con respecto al lenguaje de programaci√≥n, y mostrar algunos ejemplos de uso </p><a name="habracut"></a><br><p> Universal, digamos ... Tal vez, por supuesto, ya se ha implementado diez veces, pero esto detendr√≠a a un ciclista experimentado.  <em>Y cuando est√° en manos de un microscopio, todos los problemas parecen ser las u√±as.</em>  En el papel de un microscopio - <a href="https://pmd.github.io/" rel="nofollow">PMD</a> . </p><br><p>  En general, existe un lenguaje para escribir modelos descritos por ecuaciones diferenciales: Modelica.  Est√° bastante avanzado, hay una implementaci√≥n abierta muy buena y en general.  Pero hay un peque√±o problema: a veces se produce un error interno del compilador en el compilador.  En un <a href="https://habr.com/ru/post/474920/">art√≠culo anterior,</a> ya mostr√© c√≥mo agregar soporte de Modela al analizador est√°tico PMD (por cierto, algunos de mis errores surgieron durante el proceso de revisi√≥n) adem√°s de los diez m√≥dulos de idioma existentes.  As√≠ que ahora decid√≠, de qu√© sirve desaparecer, y envi√© una herramienta de prueba de concepto Source Code Minimizer, reutilizando los m√≥dulos de lenguaje existentes PMD.  Desafortunadamente, me enviaron, aunque no muy lejos, a un repositorio vecino: el medidor dijo que todav√≠a no decide apoyar esto hasta el final del siglo, y se pierde en la base de c√≥digo com√∫n, por lo que pronto encontr√© una invitaci√≥n para colaborar en mi bandeja de entrada <a href="https://github.com/pmd/pmd-scm" rel="nofollow">Reci√©n</a> creado <a href="https://github.com/pmd/pmd-scm" rel="nofollow">pmd / pmd-scm</a> . </p><br><p>  Primero, ¬øcu√°l es la declaraci√≥n del problema?  Se requiere reducir el tama√±o del c√≥digo fuente, preservando parte de su propiedad.  M√°s espec√≠ficamente, quiero </p><br><ul><li>  el c√≥digo resultante era previsible <br><ul><li>  no tiene que ser lo m√°s <strong>m√≠nimo posible</strong> , la "finalizaci√≥n del archivo" est√° permitida, pero no debe convertirse en tormento </li><li>  la ofuscaci√≥n autom√°tica no se considera </li></ul></li><li>  programa minimizado se puede dividir en varios archivos con c√≥digo fuente <br><ul><li> por ejemplo, en Java, cada clase <code>public</code> debe estar en un archivo separado con el nombre correcto, etc. </li><li>  Quiero que cada archivo permanezca visible al final </li></ul></li><li>  en el proceso de transformaciones, la invariante indicada debe ser preservada </li></ul><br><h2 id="vnutrennee-ustroystvo">  Dispositivo interno </h2><br><p>  En esta secci√≥n, describir√© aproximadamente la implementaci√≥n.  Para empezar, observo nuevamente que esta idea, por decirlo suavemente, no es nueva.  Y si cit√© git bisect simplemente como un ejemplo del "mecanismo de depuraci√≥n autom√°tica", me encontr√© con un <a href="https://github.com/csmith-project/creduce" rel="nofollow">producto</a> o algo similar durante bastante tiempo (aunque no lo <a href="https://github.com/csmith-project/creduce" rel="nofollow">us√©</a> ).  Pero tuve que usar <a href="https://llvm.org/docs/Bugpoint.html" rel="nofollow">llvm-bugpoint</a> , es impresionante: te sientas, depuras tu LLVM Pass y, como una infecci√≥n, se bloquea en algunos sistemas de archivos.  Por lo tanto, puede compilar este archivo en c√≥digo de bits LLVM, ejecutar <code>opt</code> en el archivo .bc con su complemento y asegurarse de que se bloquea.  Y luego, m√°s o menos, simplemente reemplac√© <code>opt</code> con <code>llvm-bugpoint</code> , y en un minuto obtuve un fuerte "esqueleto" de una de las funciones, que consiste en una nube de bloques de base y transiciones entre ellas;  todo menos las ramas fue descartado con √©xito.  Por cierto, como en mi declaraci√≥n del problema, despu√©s de una docena de minutos de simplificaci√≥n manual, todo se redujo al hecho de que proces√© incorrectamente uno de los tipos de rama, y ‚Äã‚Äãtodo lo dem√°s era solo un escenario.  En general, la idea no es nueva. </p><br><p>  Y ahora para la implementaci√≥n.  Como se supon√≠a que era una herramienta m√°s o menos universal, quer√≠a crear alg√∫n tipo de marco en el que pudi√©ramos incluir implementaciones optimizadas para diferentes idiomas.  Como resultado, se destacaron dos conceptos bastante ortogonales: </p><br><ul><li>  invariante apoyado </li><li>  estrategia de minimizaci√≥n </li></ul><br><h2 id="invariant">  Invariante </h2><br><p>  Ya he descrito una de las opciones para la propiedad que quiz√°s desee guardar: "el compilador imprimi√≥ una frase en la consola" ("Error interno del compilador", por ejemplo).  Adem√°s, las ideas se pueden obtener de una variedad de fuzzers: <a href="https://github.com/google/AFL" rel="nofollow">AFL</a> , <a href="https://github.com/grimm-co/killerbeez" rel="nofollow">Killerbeez</a> y otros: </p><br><ul><li>  el proceso finaliz√≥ con alg√∫n c√≥digo de retorno (en particular, "bloqueo de se√±al" en Linux) </li><li>  El proceso tom√≥ m√°s de T milisegundos.  Aqu√≠, por desgracia, la inestabilidad puede ocurrir debido a la carga flotante del sistema.  Para mayor precisi√≥n, puede usar el tiempo de CPU, aunque, idealmente, los contadores de rendimiento son √∫tiles </li><li>  el compilador puede (no) generar alg√∫n archivo de salida </li><li>  ... </li></ul><br><p>  Ya he implementado algunos de ellos (c√≥digo de retorno, l√≠nea impresa), algunos no, algunos pueden ser espec√≠ficos de idiomas individuales.  En general, esta es una parte bastante aut√≥noma de la tarea, a menudo completamente independiente de un lenguaje espec√≠fico. </p><br><h2 id="strategiya-minimizacii">  Estrategia de minimizaci√≥n </h2><br><p>  A primera vista, todo aqu√≠ depende √∫nicamente del idioma.  En alg√∫n lugar necesita tirar variables junto con casos de uso, en alg√∫n lugar, para mantener el mismo n√∫mero de ecuaciones e inc√≥gnitas.  Lo m√°s importante es abstraer esta parte del c√≥digo.  Pero algo b√°sico puede hacerse com√∫n para todos: por ejemplo, con un ligero movimiento de la mano, el motor de las reglas XPath gira ... gira ... ... oh, para XPath versi√≥n 1.0 no gira.  Lo sentimos, un peque√±o problema t√©cnico: una herramienta universal para cortar √°rboles de sintaxis <del>  para el invierno </del>  .  En general, la API de estrategia de minimizaci√≥n es bastante simple: en general, la funci√≥n tiene una funci√≥n de paso (se le da una lista de los nodos ra√≠z de los √°rboles de sintaxis), que puede preguntar "pero intente eliminar estas ramas" a trav√©s de la interfaz de operaci√≥n.  Si se viola el invariante, la funci√≥n devuelve el control; de lo contrario, hace girar la pila lanzando una excepci√≥n especial, y la versi√≥n resultante se toma como la pr√≥xima aproximaci√≥n.  Un proceso se considera completo si la funci√≥n de paso devolvi√≥ el control no a trav√©s de una excepci√≥n.  Puedes decir que esto es terriblemente ineficaz, tal vez as√≠, <del>  ¬°CONVENIENTE DE ZATO! 111 </del>  , pero de qu√© se trata, si se supone que debe iniciar regularmente el proceso del compilador externo cientos de veces en un ciclo. </p><br><p>  Esto plantea la pregunta: ¬øc√≥mo recuperar la fuente del AST reducido?  Por supuesto, puede intentar escribir un c√≥digo especial para cada idioma que genere un archivo de texto.  Pero, como sabes, un programador deber√≠a ser flojo.  Por lo tanto, no funcionar√°, ya que claramente no es de la serie "recogi√≥ implementaciones existentes y listo".  Afortunadamente, en los nodos del √°rbol hay informaci√≥n sobre las filas y columnas iniciales y finales de este nodo; eso significa que, si el m√≥dulo de idioma indica esta informaci√≥n correctamente, puede tomar el texto fuente y cortarlo cuidadosamente (por lo tanto, por cierto, y algunas dificultades con la ofuscaci√≥n: no es suficiente tirar algo, pero debes reemplazarlo: identificadores, por ejemplo).  Por cierto, en la base de c√≥digo PMD, incluso encontramos una clase para editar un archivo usando operaciones de corte de texto que no se cruzan (adem√°s de agregar, pero esto no es tan interesante para esta tarea en particular). </p><br><h2 id="teoriya-itog">  Teor√≠a: resumen </h2><br><p>  Por el momento he implementado dos estrategias.  Uno de ellos es el recorte XPath, que es, en cierto sentido, un caso degenerado, porque escribe el resultado por la fuerza, incluso si ya no es una fuente sint√°cticamente correcta.  El segundo ya es iterativo e interactivo "honesto" (en el sentido de que realmente interact√∫a con el compilador y comprueba el invariante): solo intenta lanzar ramas una por una en un bucle.  Aqu√≠ hay un poco m√°s al respecto: </p><br><ul><li>  en principio, verificar la fuente invariante, que no se analiza, tiene poco sentido para una estrategia "honesta": incluso si el compilador sobrevive a esto, el minimizador tendr√° que reiniciar la fuente.  Por lo tanto, tiene sentido desechar los archivos "rotos" de antemano: analizar el proceso es mucho m√°s r√°pido que ejecutar todo el compilador </li><li>  en el caso general, probablemente ser√≠a conveniente usar corutinas aqu√≠ (bueno, o girar el flujo de control al rev√©s), pero como esto est√° lejos de ser la parte m√°s dif√≠cil del trabajo para la computaci√≥n, en cada paso de la funci√≥n de paso simplemente doy la vuelta al √°rbol, contando la distancia tops.  Solo recuerdo el mostrador.  Entonces, al principio pens√© que la parte superior es m√°s grande, la parte superior es menor: ¬°qu√© diferencia hay, heur√≠stica de todos modos!  Result√≥ que el error por unidad puede cambiar la tasa de "convergencia" a veces.  En esencia, esto es l√≥gico: lanzar funciones completas de la clase en orden a menudo ser√° una estrategia efectiva.  Pero para saltear un poco, y cada vez <strong>que ingrese a la</strong> funci√≥n, en la mayor√≠a de los casos sin tener nada que ver con el problema, parece una idea regular. </li><li>  por cierto, sobre las corutinas y el despliegue del flujo de control: habr√≠a algunos problemas con esto, ya que despu√©s de reiniciar el texto modificado, el AST puede no cambiar de una manera muy obvia (es decir, no solo estas ramas se devolver√°n, sino que en alg√∫n lugar los nodos vac√≠os desaparecer√°n, en alg√∫n lugar el an√°lisis general ir√° en la otra direcci√≥n).  Sin mencionar que los nodos del nuevo AST no ser√°n id√©nticos en referencia a los antiguos, y la coincidencia l√≥gica por <code>equals</code> tambi√©n parece una tarea dif√≠cil. </li><li>  en principio, puede usar las capacidades de PMD en diversos grados: puede usar tipos calculados, dependencias de uso de definici√≥n, etc.  y hacer algo muy inteligente (pero debes considerar una API universal).  Por otro lado, para la estrategia descrita, es suficiente obtener un √°rbol de an√°lisis.  Y aqu√≠ incluso podr√≠a <a href="https://github.com/kaitai-io/kaitai_struct" rel="nofollow">conectar</a> algo de <a href="https://github.com/kaitai-io/kaitai_struct" rel="nofollow">Kaitai Struct</a> e intentar presionar <a href="https://github.com/google/AFL" rel="nofollow">afl-tmin</a> para minimizar los archivos binarios :) </li></ul><br><h2 id="praktika">  Practica </h2><br><p>  Para comenzar, construyamos un minimizador: </p><br><pre> <code class="plaintext hljs">git clone https://github.com/pmd/pmd-scm.git cd pmd-scm ./mvnw clean verify unzip pmd-scm-dist/target/pmd-scm-bin-1.0.0-SNAPSHOT.zip</code> </pre> <br><p>  Ahora necesitas alguna fuente.  Tomemos <a href="" rel="nofollow">GreedyStrategy.java</a> por ejemplo. </p><br><p>  Con <a href="https://github.com/pmd/pmd-designer" rel="nofollow">Rule Designer,</a> descubra c√≥mo es un AST t√≠pico para Java y ejecute </p><br><pre> <code class="plaintext hljs">$ ./bin/run.sh scm --language java \ --input-file ../pmd-scm/src/main/java/net/sourceforge/pmd/scm/strategies/GreedyStrategy.java \ --output-file GreedyStrategy-min.java \ --strategy xpath \ --xpath-expression '//BlockStatement[count(../BlockStatement) &gt; 1]' Original file(s): 6155 bytes, 1099 nodes. After initial white-space cleanup: size 4548 bytes (73%), 1099 nodes (100%) After pass #1: size 1984 bytes (32%), 1099 nodes (100%) After final white-space cleanup: size 1984 bytes (32%), 325 nodes (29%) After blank line clean up: size 1767 bytes (28%), 325 nodes (29%)</code> </pre> <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> net.sourceforge.pmd.scm.strategies; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.Collections; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.HashMap; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.HashSet; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.List; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.Map; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.Set; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> net.sourceforge.pmd.lang.ast.Node; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GreedyStrategy</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbstractMinimizationStrategy</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Configuration</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbstractConfiguration</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> MinimizationStrategy </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createStrategy</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> GreedyStrategy(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> MinimizationStrategyConfigurationFactory FACTORY = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AbstractFactory(<span class="hljs-string"><span class="hljs-string">"greedy"</span></span>) { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> MinimizationStrategyConfiguration </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createConfiguration</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Configuration(); } }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GreedyStrategy</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Configuration configuration)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(configuration); } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Map&lt;Node, HashSet&lt;Node&gt;&gt; directlyDependingNodes = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashMap&lt;&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Map&lt;Node, Set&lt;Node&gt;&gt; transitivelyDependingNodes = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashMap&lt;&gt;(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fetchDirectDependentsFromSubtree</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Node node)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// process depending nodes } private Set&lt;Node&gt; indirectlyDependentNodesFor(Node currentNode) { } private void collectNodesToRemove(Set&lt;Node&gt; result, Node node) { } private int previousPosition = 0; private int positionCountdown; private void findNodeToRemove(Node currentNode) throws Exception { } private void processSingleRoot(Node currentRoot) throws Exception { // cannot remove root for (int i = 0; i &lt; currentRoot.jjtGetNumChildren(); ++i) { findNodeToRemove(currentRoot.jjtGetChild(i)); } } @Override public void performSinglePass(List&lt;Node&gt; roots) throws Exception { } }</span></span></code> </pre> <br><p>  Es decir, vaciamos todas las funciones <em>que contienen directamente m√°s de una declaraci√≥n</em> .  Sin embargo, eliminar comentarios, l√≠neas en blanco, etc.  No lo he especificado. Despu√©s de todo, ¬øes esta (¬øhasta ahora?) Principalmente una herramienta para <strong>depurar compiladores</strong> , en lugar de crear hermosas descripciones de interfaz. </p><br><p>  Veamos algo m√°s interesante ahora: intente minimizar dos archivos con comentarios del compilador al mismo tiempo: </p><br><p>  <strong>orig / TestResource.java:</strong> </p><br><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestResource</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ System.err.println(<span class="hljs-string"><span class="hljs-string">"Hello World!"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">123</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">unused</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// unused } }</span></span></code> </pre> <br><p>  <strong>orig / Main.java:</strong> </p><br><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Main</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ String str = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TestResource().func(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">123</span></span>; } }</code> </pre> <br><p>  Como puede ver, no compilan: </p><br><pre> <code class="plaintext hljs">$ javac orig/TestResource.java orig/Main.java orig/Main.java:3: error: incompatible types: int cannot be converted to String String str = new TestResource().func(); ^ orig/Main.java:5: error: incompatible types: unexpected return value return 123; ^ 2 errors</code> </pre> <br><p>  Imaginemos que algo est√° mal con el primer error, e intentemos hacer un ejemplo m√≠nimo que produzca </p><br><pre> <code class="plaintext hljs">error: incompatible types: int cannot be converted to String</code> </pre> <br><p>  Para hacer esto, ejecuta </p><br><pre> <code class="plaintext hljs">$ bin/run.sh scm --language java \ --input-file orig/TestResource.java orig/Main.java \ --output-file TestResource.java Main.java \ --invariant message \ --printed-message "error: incompatible types: int cannot be converted to String"\ --command-line "javac TestResource.java Main.java" \ --strategy greedy Original file(s): 290 bytes, 77 nodes. After initial white-space cleanup: size 258 bytes (88%), 77 nodes (100%) After pass #1: size 255 bytes (87%), 64 nodes (83%) After pass #2: size 244 bytes (84%), 57 nodes (74%) After pass #3: size 205 bytes (70%), 51 nodes (66%) After pass #4: size 192 bytes (66%), 46 nodes (59%) After pass #5: size 181 bytes (62%), 39 nodes (50%) After pass #6: size 179 bytes (61%), 39 nodes (50%) After final white-space cleanup: size 149 bytes (51%), 39 nodes (50%) After blank line clean up: size 147 bytes (50%), 39 nodes (50%)</code> </pre> <br><p>  Como resultado, obtenemos </p><br><p>  <strong>TestResource.java:</strong> </p><br><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestResource</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ } }</code> </pre> <br><p>  <strong>Main.java:</strong> </p><br><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Main</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ String str = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TestResource().func(); } }</code> </pre> <br><pre> <code class="plaintext hljs">$ javac TestResource.java Main.java TestResource.java:3: error: missing return statement } ^ Main.java:3: error: incompatible types: int cannot be converted to String String str = new TestResource().func(); ^ 2 errors</code> </pre> <br><p>  Todo seg√∫n lo ordenado! </p><br><h2 id="itog">  Resumen </h2><br><p>  Hasta ahora, el proyecto se encuentra en una etapa bastante temprana, pero ya hay algo que demostrar.  En el futuro, hay ideas para hacer una API para dependencias de lenguaje agn√≥stico que indiquen dependencias entre los nodos AST, para que sea posible proporcionar estrategias espec√≠ficas del idioma.  Tambi√©n ser√≠a bueno hacer una estrategia universal que ejecute el script Groovy / Kotlin / script algo m√°s: despu√©s de todo, las personas que usan Java pueden nunca haberlo visto, pero saben perfectamente, por ejemplo, Modelika, y tienen en su cabeza sus formas avanzadas de exprimir la fuente. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/482634/">https://habr.com/ru/post/482634/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../482614/index.html">¬øUsar BSP en Doom es realmente un movimiento ingenioso?</a></li>
<li><a href="../482616/index.html">Foreve Elon 2019/2020 (reuni√≥n en l√≠nea NY2020)</a></li>
<li><a href="../482620/index.html">Slurm: Habr, felices fiestas ...</a></li>
<li><a href="../482626/index.html">Monitoreo de aplicaciones con Logger.</a></li>
<li><a href="../482628/index.html">Mira "La peque√±a ara√±a verde del tiempo"</a></li>
<li><a href="../482636/index.html">Experiencia en admisi√≥n a una magistratura en Alemania (an√°lisis detallado)</a></li>
<li><a href="../482642/index.html">OSCD: Sprint # 1 de detecci√≥n de amenazas, resultados</a></li>
<li><a href="../482644/index.html">Keylogger para Windows con cambio de derechos en DACL</a></li>
<li><a href="../482646/index.html">Mejore el rendimiento del SPA dividiendo sus bibliotecas angulares en varias partes</a></li>
<li><a href="../482648/index.html">Arthur Khachuyan: "Big Data real en publicidad"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>