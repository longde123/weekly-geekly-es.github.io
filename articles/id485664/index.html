<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üö§ üí™ üçö Membuat parameter dinamis dalam pekerjaan Jenkins, atau cara membuat tugas Anda lebih mudah digunakan ü§µüèΩ üç§ üëê</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Selamat siang, Habr ! 


 Hari ini saya ingin membagikan salah satu cara bagaimana menggunakan Plugin Pilihan Aktif untuk menjadikan tugas di Jenkins ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Membuat parameter dinamis dalam pekerjaan Jenkins, atau cara membuat tugas Anda lebih mudah digunakan</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/485664/"><p>  Selamat siang, <strong>Habr</strong> ! </p><br><p>  Hari ini saya ingin membagikan salah satu cara bagaimana menggunakan <strong><a href="https://wiki.jenkins.io/display/JENKINS/Active%2BChoices%2BPlugin">Plugin Pilihan Aktif</a></strong> untuk menjadikan tugas di <strong>Jenkins yang</strong> paling terpadu dan mudah dipahami oleh pengguna. </p><br><h4 id="vvedenie">  Pendahuluan </h4><br><p>  Singkatan seperti DevOps bukan lagi sesuatu yang baru untuk komunitas TI.  Bagi banyak orang, frasa ‚Äúmake DevOps‚Äù dikaitkan dengan semacam tombol ajaib, ketika Anda mengkliknya, kode aplikasi secara otomatis berubah menjadi aplikasi yang digunakan dan diuji (semuanya sebenarnya lebih rumit, tapi kami abstrak dari semua proses). </p><br><p> Jadi, kami menerima pesanan untuk membuat tombol ajaib sehingga administrator dapat menggunakan aplikasi dengan satu klik.  Ada berbagai jenis implementasi dari tugas ini: dari menulis bot untuk semua messenger hingga mengembangkan aplikasi terpisah.  Namun demikian, tujuan dari semua ini adalah sama - untuk membuat peluncuran perakitan dan penerapan aplikasi yang paling transparan dan nyaman. </p><br><p>  Dalam kasus kami, kami akan menggunakan <strong>Jenkins</strong> . </p><a name="habracut"></a><br><div style="text-align:center;"><img height="400" width="250" src="https://habrastorage.org/webt/fz/6r/hx/fz6rhxhctiu7yeni90vsqwfav4s.png"></div><br><h4 id="zadacha">  Tantangan </h4><br><p>  Buat pekerjaan Jenkins yang nyaman yang akan menjalankan perakitan dan / atau penyebaran layanan Microsoft yang dipilih dari versi tertentu. </p><br><div style="text-align:center;"><img height="300" width="300" src="https://habrastorage.org/webt/io/fe/bh/iofebhyveat79hhs1jzvclqx8ko.png"></div><br><h4 id="vhodnye-dannye">  Masukkan data </h4><br><p>  Kami memiliki beberapa repositori yang berisi kode sumber berbagai layanan microser. </p><br><h4 id="opredelenie-parametrov">  Definisi Parameter </h4><br><p>  Parameter berikut harus memasukkan input dari pekerjaan kami: </p><br><ol><li>  URL repositori dengan kode layanan mikro yang ingin kami kumpulkan dan terapkan saat memulai pekerjaan. </li><li>  ID komit dari mana majelis akan berlangsung. </li></ol><br><h4 id="as-is">  APA SAJA </h4><br><p>  Cara termudah untuk menyelesaikan tugas adalah membuat dua parameter tipe String. </p><br><div style="text-align:center;"><img height="700" width="700" src="https://habrastorage.org/webt/ax/ns/ko/axnskog8eayycc3r32btpms9zoy.png"></div><br><p>  Dalam hal ini, pengguna harus memasukkan path secara manual ke repositori dan melakukan id, yang, Anda lihat, tidak sepenuhnya nyaman. </p><br><div style="text-align:center;"><img height="400" width="400" src="https://habrastorage.org/webt/v8/en/pd/v8enpd-yenawguqsdhubab1tdqq.png"></div><br><h4 id="as-to-be">  SEPERTI APA SAJA </h4><br><p>  Sekarang mari kita coba berbagai jenis parameter untuk mempertimbangkan semua kelebihannya. <br>  Buat parameter pertama dari jenis Parameter Pilihan, yang kedua - Pilihan Aktif Parameter Referensi Reaktif.  Dalam parameter dengan tipe Pilihan, kami akan secara manual menambahkan nama-nama repositori di mana kode layanan microser kami disimpan di bidang Pilihan. </p><br><div style="text-align:center;"><img height="700" width="700" src="https://habrastorage.org/webt/ti/qh/oo/tiqhooykhwwiri560milgxkxsde.png"></div><br><blockquote>  Jika audiens menyukai artikel ini, maka pada artikel selanjutnya saya akan menjelaskan proses mengonfigurasi tugas di Jenkins menggunakan deskripsi melalui kode (Konfigurasi sebagai kode), yaitu  kita tidak perlu memasukkan nama repositori secara manual dan membuat parameter, semuanya akan terjadi secara otomatis (kode kita akan menerima daftar repositori dari SCM dan membuat parameter dengan daftar ini). </blockquote><p>  Nilai-nilai dari parameter kedua akan diisi secara dinamis dengan kami, tergantung pada nilai apa yang akan diambil oleh parameter pertama (test1 atau test2), karena setiap repositori memiliki daftar komit sendiri. </p><br><p>  <strong>Pilihan Aktif Parameter Referensi Reaktif</strong> memiliki bidang-bidang berikut untuk diisi: </p><br><ol><li>  <em>Nama</em> - nama parameter. </li><li>  <em>Script</em> - kode yang akan dieksekusi setiap kali nilai parameter dari bidang Parameter yang direferensikan diubah (dalam kasus kami, ketika kami memilih antara test1 dan test2). </li><li>  <em>Deskripsi</em> - deskripsi singkat tentang parameter. </li><li>  <em>Jenis Pilihan</em> - jenis objek yang dikembalikan oleh skrip (dalam kasus kami, kami akan mengembalikan kode html). </li><li>  <em>Parameter yang direferensikan</em> - nama parameter, ketika mengubah nilai kode dari bagian Script akan dieksekusi. </li></ol><br><div style="text-align:center;"><img height="700" width="700" src="https://habrastorage.org/webt/4f/ue/n6/4fuen6d1enjbwyp36fqrtvt7w4w.png"></div><br><p>  Kami melanjutkan langsung ke pengisian bidang utama dalam parameter ini.  Kami menawarkan dua jenis implementasi untuk dipilih: menggunakan <em>Script Groovy</em> atau <em>Scriptler Script</em> . <br>  Kami memilih yang pertama, karena Scriptler hanyalah sebuah plugin yang menyimpan skrip yang sudah Anda tulis dan memungkinkan Anda untuk menggunakannya dalam tugas-tugas lain tanpa harus menyalin lagi. </p><br><p>  Kode Groovy untuk mendapatkan semua komit dari repositori yang dipilih: </p><br><pre><code class="java hljs">AUTH = <span class="hljs-string"><span class="hljs-string">"    Base64"</span></span> GIT_URL = <span class="hljs-string"><span class="hljs-string">"url   SCM (https://bitbucket.org/)"</span></span> PROJECT_NAME = <span class="hljs-string"><span class="hljs-string">"  ,   "</span></span> <span class="hljs-function"><span class="hljs-function">def </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">htmlBuild</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ html = <span class="hljs-string"><span class="hljs-string">""</span></span><span class="hljs-string"><span class="hljs-string">" &lt;html&gt; &lt;head&gt; &lt;meta charset="</span></span>windows-<span class="hljs-number"><span class="hljs-number">1251</span></span><span class="hljs-string"><span class="hljs-string">"&gt; &lt;style type="</span></span>text/css<span class="hljs-string"><span class="hljs-string">"&gt; div.grayTable { text-align: left; border-collapse: collapse; } .divTable.grayTable .divTableCell, .divTable.grayTable .divTableHead { padding: 0px 3px; } .divTable.grayTable .divTableBody .divTableCell { font-size: 13px; } &lt;/style&gt; &lt;/head&gt; &lt;body&gt; "</span></span><span class="hljs-string"><span class="hljs-string">""</span></span> def commitOptions = <span class="hljs-string"><span class="hljs-string">""</span></span> getCommitsForMicroservice(MICROSERVICE_NAME).each { commitOptions += <span class="hljs-string"><span class="hljs-string">"&lt;option style='font-style: italic' value='COMMIT=${it.getKey()}'&gt;${it}&lt;/option&gt;"</span></span> } html += <span class="hljs-string"><span class="hljs-string">""</span></span><span class="hljs-string"><span class="hljs-string">"&lt;p style="</span></span>display: inline-block;<span class="hljs-string"><span class="hljs-string">"&gt; &lt;select id="</span></span>commit_id<span class="hljs-string"><span class="hljs-string">" size="</span></span><span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-string"><span class="hljs-string">" name="</span></span>value<span class="hljs-string"><span class="hljs-string">"&gt; ${commitOptions} &lt;/select&gt;&lt;/p&gt;&lt;/div&gt;"</span></span><span class="hljs-string"><span class="hljs-string">""</span></span> html += <span class="hljs-string"><span class="hljs-string">""</span></span><span class="hljs-string"><span class="hljs-string">" &lt;/div&gt; &lt;/div&gt; &lt;/div&gt; &lt;/body&gt; &lt;/html&gt; "</span></span><span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> html } <span class="hljs-function"><span class="hljs-function">def </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCommitsForMicroservice</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(microserviceRepo)</span></span></span><span class="hljs-function"> </span></span>{ def commits = [:] def endpoint = GIT_URL + <span class="hljs-string"><span class="hljs-string">"/rest/api/1.0/projects/${PROJECT_NAME}/repos/${microserviceRepo}/commits"</span></span> def conn = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> URL(endpoint).openConnection() conn.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Authorization"</span></span>, <span class="hljs-string"><span class="hljs-string">"Basic ${AUTH}"</span></span>) def response = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> groovy.json.JsonSlurper().parseText(conn.content.text) response.values.each { commits.put(it.displayId, it.message) } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> commits } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> htmlBuild()</code> </pre> <br><p>  Tanpa merinci, kode ini menerima nama layanan mikro (MICROSERVICE_NAME) sebagai input, mengirimkan permintaan ke <em>Bitbucket</em> (metode <em>getCommitsForMicroservice</em> ) menggunakan API-nya, dan menerima id dan komit semua komit untuk layanan microservice ini. <br>  Seperti yang disebutkan sebelumnya, kode ini harus mengembalikan html yang akan ditampilkan pada halaman <em>Build with Parameters</em> di Jenkins, jadi kami membungkus semua nilai yang diterima dari Bitbucket dalam daftar dan menambahkan untuk memilih. </p><br><p>  Setelah menyelesaikan semua langkah, kita harus mendapatkan halaman <em>Build with Parameters yang indah</em> . </p><br><p>  Jika Anda memilih microservice test1: </p><br><div style="text-align:center;"><img height="600" width="600" src="https://habrastorage.org/webt/xa/qo/iv/xaqoivcjirtx6yklqlcbkfsm-wy.png"></div><br><p>  Jika Anda memilih microservice test2: </p><br><div style="text-align:center;"><img height="600" width="600" src="https://habrastorage.org/webt/qt/u9/x9/qtu9x9rpdecqm8krb-cvnk3gfpi.png"></div><br><p>  Setuju bahwa akan lebih nyaman bagi pengguna untuk berinteraksi dengan tugas Anda dengan cara ini daripada menyalin url setiap kali dan mencari id komit yang diperlukan. </p><br><p>  <strong>PS</strong> Artikel ini memberikan contoh yang sangat sederhana, yang mungkin tidak memiliki aplikasi praktis dalam formulir ini, karena majelis memiliki parameter yang jauh lebih berbeda, tetapi tujuan artikel ini adalah untuk menunjukkan operasi alat dan tidak menyediakan solusi yang berfungsi. </p><br><p>  <strong>PSS</strong> Seperti yang saya tulis sebelumnya, jika artikel ini bermanfaat, yang berikutnya adalah tentang <em>mengkonfigurasi tugas Jenkins secara dinamis menggunakan kode</em> . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id485664/">https://habr.com/ru/post/id485664/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id485648/index.html">Pendekatan pythonic untuk for: range () dan enumerate () loop</a></li>
<li><a href="../id485650/index.html">Teknik Pengurangan Gambar Docker</a></li>
<li><a href="../id485652/index.html">Statistik komentar inline pertemuan</a></li>
<li><a href="../id485654/index.html">Sebuah ide yang diambil dari fisika membantu AI bekerja dalam dimensi yang lebih tinggi.</a></li>
<li><a href="../id485660/index.html">Perusahaan perlindungan DDoS sendiri meluncurkan serangan DDoS, diakui pendirinya</a></li>
<li><a href="../id485672/index.html">Redis Praktik Terbaik, Bagian 1</a></li>
<li><a href="../id485682/index.html">Manajemen waktu tidak akan membantu: penundaan adalah masalah mengatur emosi, bukan waktu</a></li>
<li><a href="../id485688/index.html">Myapp memperpanjang liburan</a></li>
<li><a href="../id485692/index.html">Saran spesialis TI kepada pelanggan, atau cara mengotomatisasi kekacauan</a></li>
<li><a href="../id485694/index.html">Embox pada prosesor Elbrus. Atau jangan pernah melupakan kecerdasan Anda</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>