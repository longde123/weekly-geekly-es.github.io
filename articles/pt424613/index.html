<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üåû üçÉ üë®üèø‚Äçü§ù‚Äçüë®üèª Experi√™ncia no uso de redux sem redutores ü§Ωüèæ üà∏ ü§≥üèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Gostaria de compartilhar minha experi√™ncia no uso do redux em um aplicativo corporativo. Falando sobre software corporativo como parte do artigo, conc...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Experi√™ncia no uso de redux sem redutores</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/424613/"><img src="https://habrastorage.org/webt/nn/at/cx/nnatcxzguqw8cg7b1nx315f3c8y.jpeg"><br><br>  Gostaria de compartilhar minha experi√™ncia no uso do redux em um aplicativo corporativo.  Falando sobre software corporativo como parte do artigo, concentro-me nos seguintes recursos: <br><br><ul><li>  Em primeiro lugar, este √© o volume de funcionalidade.  Estes s√£o sistemas desenvolvidos por muitos anos, continuando a construir novos m√≥dulos ou complicando o que j√° existe por tempo indeterminado. </li><li>  Em segundo lugar, frequentemente, se considerarmos n√£o uma tela de apresenta√ß√£o, mas o local de trabalho de algu√©m, um grande n√∫mero de componentes conectados pode ser montado em uma p√°gina. </li><li>  Terceiro, a complexidade da l√≥gica de neg√≥cios.  Se queremos obter um aplicativo responsivo e agrad√°vel de usar, uma parte significativa da l√≥gica ter√° que ser feita pelo cliente. </li></ul><br>  Os dois primeiros pontos imp√µem restri√ß√µes √† margem de produtividade.  Mais sobre isso mais tarde.  E agora, proponho discutir os problemas encontrados ao usar o redux - fluxo de trabalho cl√°ssico, desenvolvendo algo mais complicado que a lista TODO. <br><a name="habracut"></a><br><h3>  Redux cl√°ssico </h3><br>  Por exemplo, considere o seguinte aplicativo: <br><br><img src="https://image.ibb.co/ej3Pwp/1.png" alt="imagem"><br><br>  O usu√°rio dirige uma rima - obt√©m uma avalia√ß√£o de seu talento.  O controle com a introdu√ß√£o do vers√≠culo √© controlado e o rec√°lculo da avalia√ß√£o ocorre para cada mudan√ßa.  H√° tamb√©m um bot√£o no qual o texto com o resultado √© redefinido e uma mensagem √© exibida para o usu√°rio que ele pode iniciar desde o in√≠cio.  C√≥digo fonte neste <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">segmento</a> . <br><br>  Organiza√ß√£o do c√≥digo: <br><br><img src="https://image.ibb.co/dyXv2U/2.png" alt="imagem"><br><br>  Existem dois m√≥dulos.  Mais precisamente, um m√≥dulo √© diretamente poemaScoring.  E a raiz do aplicativo com fun√ß√µes comuns para todo o sistema √© app.  L√° temos informa√ß√µes sobre o usu√°rio, exibindo mensagens para o usu√°rio.  Cada m√≥dulo possui seus pr√≥prios redutores, a√ß√µes, controles, etc. √Ä medida que o aplicativo cresce, novos m√≥dulos se multiplicam. <br><br>  Uma cascata de redutores, usando imut√°vel por redux, forma o seguinte estado totalmente imut√°vel: <br><br><img src="https://image.ibb.co/nFrYp9/3.png" alt="imagem"><br><br>  Como funciona: <br><br>  1. Controle de envio de a√ß√£o-criador: <br><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> at <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../constants/actionTypes'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">poemTextChange</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">text</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">dispatch, getstate</span></span></span><span class="hljs-function">) </span></span>{ dispatch({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: at.POEM_TYPE, <span class="hljs-attr"><span class="hljs-attr">payload</span></span>: text }); }; }</code> </pre> <br>  As constantes dos tipos de a√ß√£o s√£o movidas para um arquivo separado.  Em primeiro lugar, estamos t√£o seguros de erros de digita√ß√£o.  Em segundo lugar, o intellisense estar√° dispon√≠vel para n√≥s. <br><br>  2. Depois, chega ao redutor. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> logic <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../logic/poem'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">poemScoringReducer</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state = Immutable.Map(</span></span></span><span class="hljs-function">), </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">action</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (action.type) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> at.POEM_TYPE: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> logic.onType(state, action.payload); <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state; } }</code> </pre> <br>  O processamento l√≥gico √© movido para uma <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">fun√ß√£o de caso</a> separada.  Caso contr√°rio, o c√≥digo do redutor rapidamente se tornar√° ileg√≠vel. <br><br>  3. A l√≥gica do processamento de cliques usando an√°lise lexical e intelig√™ncia artificial: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> { onType(state, text) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state .set(<span class="hljs-string"><span class="hljs-string">'poemText'</span></span>, text) .set(<span class="hljs-string"><span class="hljs-string">'score'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.calcScore(text)); }, calcScore(text) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> score = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.floor(text.length / <span class="hljs-number"><span class="hljs-number">10</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> score &gt; <span class="hljs-number"><span class="hljs-number">5</span></span> ? <span class="hljs-number"><span class="hljs-number">5</span></span> : score; } };</code> </pre> <br>  No caso do bot√£o "Novo poema", temos o seguinte criador de a√ß√£o: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">newPoem</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">dispatch, getstate</span></span></span><span class="hljs-function">) </span></span>{ dispatch({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: at.POEM_TYPE, <span class="hljs-attr"><span class="hljs-attr">payload</span></span>: <span class="hljs-string"><span class="hljs-string">''</span></span> }); dispatch({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: appAt.SHOW_MESSAGE, <span class="hljs-attr"><span class="hljs-attr">payload</span></span>: <span class="hljs-string"><span class="hljs-string">'You can begin a new poem now!'</span></span> }); }; }</code> </pre> <br>  Primeiro, despache a mesma a√ß√£o que redefine nosso texto e pontua√ß√£o.  Em seguida, envie a a√ß√£o, que ser√° capturada por outro redutor e exibir√° uma mensagem para o usu√°rio. <br>  Tudo √© lindo.  Vamos criar problemas para n√≥s mesmos: <br><br><h3>  Os problemas: </h3><br>  N√≥s postamos nosso aplicativo.  Mas nossos usu√°rios, ao serem solicitados a escrever poesia, naturalmente come√ßaram a publicar seus trabalhos, o que √© incompat√≠vel com os padr√µes corporativos da linguagem po√©tica.  Em outras palavras, precisamos moderar palavras obscenas. <br><br>  O que faremos: <br><br><ul><li>  no texto de entrada, √© necess√°rio substituir todas as palavras n√£o cultivadas por <b>* censurado *</b> </li><li>  al√©m disso, se o usu√°rio tiver dirigido uma palavra suja, voc√™ precisar√° avis√°-lo com uma mensagem de que est√° fazendo algo errado. </li></ul><br>  Bom  S√≥ precisamos analisar o texto, al√©m de calcular a pontua√ß√£o, para substituir os palavr√µes.  N√£o √© um problema.  E tamb√©m, para informar o usu√°rio, voc√™ precisa de uma lista do que exclu√≠mos.  O c√≥digo fonte est√° <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> . <br><br>  N√≥s refazemos a fun√ß√£o da l√≥gica para que, al√©m do novo estado, retorne as informa√ß√µes necess√°rias para a mensagem ao usu√°rio (palavras substitu√≠das): <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> { onType(state, text) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { reductedText, censoredWords } = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.redactText(text); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> newState = state .set(<span class="hljs-string"><span class="hljs-string">'poemText'</span></span>, reductedText) .set(<span class="hljs-string"><span class="hljs-string">'score'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.calcScore(reductedText)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { newState, censoredWords }; }, calcScore(text) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> score = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.floor(text.length / <span class="hljs-number"><span class="hljs-number">10</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> score &gt; <span class="hljs-number"><span class="hljs-number">5</span></span> ? <span class="hljs-number"><span class="hljs-number">5</span></span> : score; }, redactText(text) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> result = { <span class="hljs-attr"><span class="hljs-attr">reductedText</span></span>:text }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> censoredWords = []; obscenseWords.forEach(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">badWord</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (result.reductedText.indexOf(badWord) &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) { result.reductedText = result.reductedText.replace(badWord, <span class="hljs-string"><span class="hljs-string">'*censored*'</span></span>); censoredWords.push(badWord); } }); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (censoredWords.length &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { result.censoredWords = censoredWords.join(<span class="hljs-string"><span class="hljs-string">' ,'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } };</code> </pre> <br>  Vamos aplic√°-lo agora.  Mas como  No redutor, n√£o faz mais sentido cham√°-lo, pois colocaremos o texto e a avalia√ß√£o no estado, mas o que devemos fazer com a mensagem?  Para enviar uma mensagem, em qualquer caso, teremos que despachar a a√ß√£o correspondente.  Ent√£o, estamos finalizando o criador da a√ß√£o. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">poemTextChange</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">text</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">dispatch, getState</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> globalState = getState(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> scoringStateOld = globalState.get(<span class="hljs-string"><span class="hljs-string">'poemScoring'</span></span>); <span class="hljs-comment"><span class="hljs-comment">//        const { newState, censoredWords } = logic.onType(scoringStateOld, text); dispatch({ //        type: at.POEM_TYPE, payload: newState }); if (censoredWords) { //    ,    const userName = globalState.getIn(['app', 'account', 'name']); const message = `${userName}, avoid of using word ${censoredWords}, please!`; dispatch({ type: appAt.SHOW_MESSAGE, payload: message }); } }; }</span></span></code> </pre> <br>  Tamb√©m √© necess√°rio modificar o redutor, porque ele n√£o chama mais a fun√ß√£o l√≥gica: <br><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (action.type) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> at.POEM_TYPE: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> action.payload; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state;</code> </pre> <br>  O que aconteceu: <br><br><img src="https://image.ibb.co/nkmzU9/4.png" alt="imagem"><br><br>  <b>E agora, a quest√£o √©.</b>  Por que precisamos de um redutor que, na maioria das vezes, simplesmente retorne a carga √∫til em vez de um novo estado?  Quando outras a√ß√µes aparecerem que processam a l√≥gica da a√ß√£o, ser√° necess√°rio registrar um novo tipo de a√ß√£o?  Ou talvez crie um SET_STATE comum?  Provavelmente n√£o, porque ent√£o, o inspetor estar√° uma bagun√ßa.  Ent√£o, vamos produzir o mesmo tipo de caso? <br><br>  A ess√™ncia do problema √© a seguinte.  Se o processamento da l√≥gica envolve trabalhar com um peda√ßo de estado pelo qual v√°rios redutores s√£o respons√°veis, voc√™ deve escrever todos os tipos de pervers√µes.  Por exemplo, os resultados intermedi√°rios de fun√ß√µes de caso, que devem ser espalhadas por diferentes redutores usando v√°rias a√ß√µes. <br><br>  Uma situa√ß√£o semelhante, se a fun√ß√£o de caso precisar de mais informa√ß√µes do que o que est√° no seu redutor, voc√™ dever√° fazer sua chamada para a a√ß√£o, onde h√° acesso ao estado global, seguido pelo envio do novo estado como carga √∫til.  Um redutor ter√° que ser dividido em qualquer caso, se houver muita l√≥gica no m√≥dulo.  E isso cria um grande inconveniente. <br><br>  Vamos olhar para a situa√ß√£o de um lado.  Em nossa a√ß√£o, obtemos um peda√ßo de estado do global.  Isso √© necess√°rio para <i>modific√°-</i> lo ( <i>globalState.get ('poemScoring');</i> ).  Acontece que j√° sabemos em a√ß√£o com que parte do estado o trabalho est√° acontecendo.  Temos um novo peda√ßo de estado.  N√≥s sabemos onde coloc√°-lo.  Mas, em vez de coloc√°-lo em um global, o executamos com algum tipo de texto constante em toda a cascata de redutores, para que ele passe por cada caixa de comuta√ß√£o e a substitua apenas uma vez.  Eu da realiza√ß√£o disso, rugas.  Entendo que isso √© feito para facilitar o desenvolvimento e reduzir a conectividade.  Mas, no nosso caso, n√£o tem mais um papel. <br><br>  <b>Agora, listarei todos os pontos que n√£o gosto na implementa√ß√£o atual, se precisar ser dimensionado em profundidade e profundidade por um tempo ilimitado</b> : <br><br><ol><li>  Inconveniente significativo ao trabalhar com um estado fora do redutor. </li><li>  O problema da separa√ß√£o de c√≥digo.  Toda vez que despachamos uma a√ß√£o, ela passa por cada redutor, passa por cada caso.  √â conveniente n√£o incomodar quando voc√™ tem um aplicativo pequeno.  Mas, se voc√™ tem um monstro constru√≠do por v√°rios anos com dezenas de redutores e centenas de casos, ent√£o come√ßo a pensar na viabilidade de tal abordagem.  Talvez, mesmo com milhares de casos, isso n√£o tenha um impacto significativo no desempenho.  Mas, entendendo que, ao imprimir texto, cada impressora causar√° uma passagem por centenas de casos, n√£o posso deixar como est√°.  Qualquer um, o menor atraso, multiplicado pelo infinito, tende ao infinito.  Em outras palavras, se voc√™ n√£o pensar nessas coisas, mais cedo ou mais tarde, surgir√£o problemas. <br><br>  Quais s√£o as op√ß√µes? <br><br>  <b>a.</b>  Aplicativos isolados com seus pr√≥prios <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">provedores</a> .  Em cada m√≥dulo (subaplicativo), voc√™ ter√° que duplicar as partes gerais do estado (conta, mensagens, etc.). <br><br>  <b>b.</b>  Use <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">redutores ass√≠ncronos</a> conect√°veis.  Isso n√£o √© recomendado pelo pr√≥prio Dan. <br><br>  <b>c.</b>  Use <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">filtros de a√ß√£o</a> em redutores.  Ou seja, cada despacho deve ser acompanhado de informa√ß√µes sobre para qual m√≥dulo est√° sendo enviado.  E nos redutores de raiz dos m√≥dulos, escreva as condi√ß√µes apropriadas.  Eu tentei.  N√£o havia esse n√∫mero de erros involunt√°rios antes ou depois.  Existe uma confus√£o constante sobre onde a a√ß√£o vai. </li><li>  Cada vez que uma a√ß√£o √© despachada, n√£o h√° apenas uma execu√ß√£o para cada redutor, mas tamb√©m a coleta do estado reverso.  N√£o importa se o estado mudou no redutor - ele ser√° substitu√≠do nos combineReducers. </li><li>  Cada despacho for√ßa o mapStateToProps a ser processado para cada componente conectado que est√° montado na p√°gina.  Se dividirmos redutores, temos que dividir as expedi√ß√µes.  √â fundamental que tenhamos um bot√£o que substitua o texto e exiba a mensagem com diferentes despachos?  Provavelmente n√£o.  Mas tenho experi√™ncia em otimiza√ß√£o, ao reduzir o n√∫mero de expedi√ß√µes de 15 para 3, permitindo aumentar significativamente a capacidade de resposta do sistema, com a mesma quantidade de l√≥gica de neg√≥cios processada.  Eu sei que existem bibliotecas que podem combinar v√°rios despachos em um lote, mas isso √© uma luta com a investiga√ß√£o usando muletas. </li><li>  Ao esmagar despachos, √†s vezes √© muito dif√≠cil ver o que est√° acontecendo.  N√£o h√° um lugar, tudo est√° espalhado em arquivos diferentes.  √â necess√°rio procurar onde o processamento √© implementado, procurando constantes em todos os c√≥digos-fonte. </li><li>  No c√≥digo acima, componentes e a√ß√µes acessam o estado global diretamente: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> userName = globalState.getIn([<span class="hljs-string"><span class="hljs-string">'app'</span></span>, <span class="hljs-string"><span class="hljs-string">'account'</span></span>, <span class="hljs-string"><span class="hljs-string">'name'</span></span>]); ‚Ä¶ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> text = state.getIn([<span class="hljs-string"><span class="hljs-string">'poemScoring'</span></span>, <span class="hljs-string"><span class="hljs-string">'poemText'</span></span>]);</code> </pre> <br>  Isso n√£o √© bom por v√°rios motivos: <br><br>  <b>a.</b>  Idealmente, os m√≥dulos devem ser isolados.  Eles n√£o precisam saber em que estado vivem. <br><br>  <b>b.</b>  Mencionar os mesmos caminhos em lugares diferentes √© muitas vezes repleto n√£o apenas de erros / erros de digita√ß√£o, mas tamb√©m torna a refatora√ß√£o extremamente dif√≠cil no caso de alterar a configura√ß√£o do estado global ou alterar a maneira como ele √© armazenado. <br></li><li>  Cada vez mais, ao escrever uma nova a√ß√£o, tive a impress√£o de estar escrevendo c√≥digo por causa do c√≥digo.  Suponha que desejemos adicionar uma caixa de sele√ß√£o √† p√°gina e refletir seu estado booleano na hist√≥ria.  Se queremos uma organiza√ß√£o uniforme de a√ß√£o / redutores, precisamos: <br><br>  - Registrar constante do tipo de a√ß√£o <br>  - Escreva uma cratera de a√ß√£o <br>  - No controle, importe-o e registre-o em mapDispatchToProps <br>  - Registre-se em PropTypes <br>  - Crie um handleCheckBoxClick no controle e especifique-o na caixa de sele√ß√£o <br>  - Adicione um interruptor no redutor com uma chamada de fun√ß√£o de caso <br>  - Escreva uma fun√ß√£o de caso na l√≥gica <br><br>  Por uma quest√£o de boxe! </li><li>  O estado que √© gerado com combineReducers √© est√°tico.  N√£o importa se voc√™ j√° entrou no m√≥dulo B ou n√£o, esta pe√ßa estar√° na hist√≥ria.  Vazio, mas ser√°.  N√£o √© conveniente usar o inspetor quando houver muitos n√≥s vazios n√£o utilizados no steet. </li></ol><br><h3>  Como tentamos resolver alguns dos problemas descritos acima </h3><br>  Ent√£o, obtivemos redutores est√∫pidos e, na a√ß√£o-crateras / l√≥gica, escrevemos trechos de c√≥digo para trabalhar com estruturas imut√°veis ‚Äã‚Äãprofundamente embutidas.  Para me livrar disso, uso o mecanismo de seletores hier√°rquicos, que permitem n√£o apenas o acesso ao peda√ßo de estado desejado, mas tamb√©m o substitui (conveniente setIn).  Publiquei isso no pacote <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">immutable-selectors</a> . <br><br>  <b>Vejamos nosso exemplo de como funciona</b> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">reposit√≥rio</a> ): <br>  No m√≥dulo poemScoring, descrevemos o objeto seletores.  Descrevemos os campos do estado ao qual queremos ter acesso direto de leitura / grava√ß√£o.  Qualquer aninhamento e par√¢metros para acessar os elementos de cole√ß√µes s√£o permitidos.  N√£o √© necess√°rio descrever todos os campos poss√≠veis em nosso artigo. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> extendSelectors <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'immutable-selectors'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> selectors = { <span class="hljs-attr"><span class="hljs-attr">poemText</span></span>:{}, <span class="hljs-attr"><span class="hljs-attr">score</span></span>:{} }; extendSelectors(selectors, [ <span class="hljs-string"><span class="hljs-string">'poemScoring'</span></span> ]); <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> selectors;</code> </pre> <br>  Al√©m disso, o m√©todo extendSelectors transforma cada campo em nosso objeto em uma fun√ß√£o seletora.  O segundo par√¢metro indica o caminho para a parte do estado que o seletor controla.  N√£o criamos um novo objeto, mas alteramos o atual.  Isso nos d√° um b√¥nus na forma de intelig√™ncia de trabalho: <br><br><img src="https://image.ibb.co/iYdDp9/5.png" alt="imagem"><br><br>  Qual √© o nosso objeto - um seletor ap√≥s sua expans√£o: <br><br><img src="https://image.ibb.co/iAGcGp/5_5.png" alt="imagem"><br><br>  A fun√ß√£o <i>selectors.poemText (state)</i> simplesmente executa <i>state.getIn (['poemScoring', 'poemText'])</i> . <br><br>  Fun√ß√£o <i>root (state)</i> - obt√©m 'poemScoring'. <br><br>  Cada seletor possui sua pr√≥pria fun√ß√£o de <i>substitui√ß√£o (globalState, newPart)</i> , que atrav√©s de setIn retorna um novo estado global com a parte correspondente substitu√≠da. <br><br>  Al√©m disso, √© adicionado um objeto <i>plano</i> ao qual todas as chaves seletoras s√£o duplicadas.  Ou seja, se usarmos um estado profundo da forma <br><br><pre> <code class="javascript hljs">selectors = { <span class="hljs-attr"><span class="hljs-attr">dive</span></span>:{ <span class="hljs-attr"><span class="hljs-attr">in</span></span>:{ <span class="hljs-attr"><span class="hljs-attr">to</span></span>:{ <span class="hljs-attr"><span class="hljs-attr">the</span></span>:{ <span class="hljs-attr"><span class="hljs-attr">deep</span></span>:{} } } } }}</code> </pre> <br>  Voc√™ pode se aprofundar como <i>seletores.de</i> mergulho.para.de.deep <i>(estado)</i> ou como <i>seletores.de.pa√ßo (estado)</i> . <br><br>  V√° em frente.  Precisamos atualizar a aquisi√ß√£o de dados nos controles: <br><br>  Poema: <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mapStateToProps</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state, ownprops</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">text</span></span>:selectors.poemText(state) || <span class="hljs-string"><span class="hljs-string">''</span></span> }; }</code> </pre> <br><br>  Pontua√ß√£o: <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mapStateToProps</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state, ownprops</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> score = selectors.score(state); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { score }; }</code> </pre> <br>  Em seguida, altere o redutor de raiz: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> initialState <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./initialState'</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setStateReducer</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state = initialState, action</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (action.setState) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> action.setState; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state; <span class="hljs-comment"><span class="hljs-comment">// return combinedReducers(state, action); // } } export default setStateReducer;</span></span></code> </pre> <br>  Se desejar, podemos combinar usando combineReducers. <br><br>  Cratera de a√ß√£o, por exemplo, poemTextChange: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">poemTextChange</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">text</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">dispatch, getState</span></span></span><span class="hljs-function">) </span></span>{ dispatch({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'Poem typing'</span></span>, <span class="hljs-attr"><span class="hljs-attr">setState</span></span>: logic.onType(getState(), text), <span class="hljs-attr"><span class="hljs-attr">payload</span></span>: text }); }; }</code> </pre> <br>  N√£o podemos mais usar constantes do tipo a√ß√£o, porque agora o tipo √© usado apenas para visualiza√ß√£o no inspetor.  No projeto, escrevemos descri√ß√µes em texto completo da a√ß√£o em russo.  Voc√™ tamb√©m pode se livrar da carga √∫til, mas tento salv√°-la para que no inspetor, se necess√°rio, entenda com quais par√¢metros a a√ß√£o foi chamada. <br><br>  E, de fato, a pr√≥pria l√≥gica: <br><br><pre> <code class="javascript hljs"> onType(gState, text) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { reductedText, censoredWords } = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.redactText(text); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> poemState = selectors.root(gState) || Immutable.Map(); <span class="hljs-comment"><span class="hljs-comment">//     const newPoemState = poemState //  .set('poemText', reductedText) .set('score', this.calcScore(reductedText)); let newGState = selectors.root.replace(gState, newPoemState); //    if (censoredWords) { //  ,    const userName = appSelectors.flat.userName(gState); const messageText = `${userName}, avoid of using word ${censoredWords}, please!`; newGState = message.showMessage(newGState, messageText); } return newGState; },</span></span></code> </pre> <br>  Ao mesmo tempo, <i>message.showMessage √©</i> importado da l√≥gica do m√≥dulo vizinho, que descreve seus seletores: <br><br><pre> <code class="javascript hljs"> showMessage(gState, text) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> selectors.message.text.replace(gState, text); }.</code> </pre> <br>  O que acontece: <br><br><img src="https://image.ibb.co/hviDp9/6.png" alt="imagem"><br><br>  Observe que tivemos um despacho, os dados em dois m√≥dulos foram alterados. <br>  Tudo isso nos permitiu eliminar redutores e constantes do tipo a√ß√£o, al√©m de solucionar ou contornar a maioria dos gargalos descritos acima. <br><br><h4>  De que outra forma isso pode ser aplicado? </h4><br>  Essa abordagem √© conveniente de usar quando √© necess√°rio garantir que seus controles ou m√≥dulos forne√ßam trabalho com diferentes partes do estado.  Digamos que um poema n√£o seja suficiente para n√≥s.  Queremos que o usu√°rio seja capaz de compor poemas em duas abas diferentes em diferentes disciplinas (infantil, rom√¢ntica).  Nesse caso, n√£o podemos importar os seletores na l√≥gica / controles, mas especific√°-los como um par√¢metro no controle externo: <br><br><pre> <code class="javascript hljs"> &lt;Poem selectors = {selectors.hildPoem}/&gt; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Poem</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">selectors</span></span></span></span><span class="xml"><span class="hljs-tag"> = </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{selectors.romanticPoem}/</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre> <br>  E, al√©m disso, passe esse par√¢metro para crateras de a√ß√£o.  Isso √© suficiente para tornar uma combina√ß√£o complexa de componentes e l√≥gica completamente fechada, facilitando a reutiliza√ß√£o. <br><br>  <b>Limita√ß√µes ao usar seletores imut√°veis:</b> <br><br>  N√£o funcionar√° para usar a chave no estado "nome", porque para a fun√ß√£o pai, haver√° uma tentativa de substituir a propriedade reservada. <br><br><h3>  Qual √© o resultado </h3><br>  Como resultado, uma abordagem bastante flex√≠vel foi obtida, os relacionamentos impl√≠citos de c√≥digo por constantes de texto foram eliminados, a sobrecarga foi reduzida, mantendo a conveni√™ncia do desenvolvimento.  H√° tamb√©m um inspetor de redux em pleno funcionamento, com a possibilidade de viajar no tempo.  N√£o desejo voltar aos redutores padr√£o. <br><br>  Em geral, isso √© tudo.  Obrigado pelo seu tempo.  Talvez algu√©m esteja interessado em experimentar! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt424613/">https://habr.com/ru/post/pt424613/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt424603/index.html">O livro ‚ÄúPor que estamos errados? Armadilhas para o pensamento em a√ß√£o. ‚Äù Trechos Parte 1</a></li>
<li><a href="../pt424605/index.html">Fundos Zuckerberg: Colabora√ß√£o + Tecnologia + Ci√™ncia Aberta</a></li>
<li><a href="../pt424607/index.html">Ascens√£o de Helidon</a></li>
<li><a href="../pt424609/index.html">Como estender o Kubernetes</a></li>
<li><a href="../pt424611/index.html">Como criar um funcion√°rio de um freelancer</a></li>
<li><a href="../pt424615/index.html">Sa√≠da da fun√ß√£o curva para limitar par√¢metros, sinais e n√£o apenas no Wolfram Mathematica</a></li>
<li><a href="../pt424621/index.html">Super-her√≥is que n√£o s√£o filmes. Quem e como protege o canteiro de obras do Lakhta Center contra inc√™ndios?</a></li>
<li><a href="../pt424623/index.html">Vamos processar o som no Go</a></li>
<li><a href="../pt424625/index.html">Vazamento de c√≥digo-fonte dos servi√ßos Web da Aeroflot</a></li>
<li><a href="../pt424627/index.html">Altera√ß√£o de caixas registradoras. Parte 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>