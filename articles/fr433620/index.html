<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üé¥ üë©üèø‚Äçüç≥ üßòüèº Comment fonctionne SystemUI dans Android üçù üë≤üèΩ üë®üèª‚Äçüöí</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dans cet article, j'analyserai l'architecture et le principe de fonctionnement de la principale application Android - SystemUI. Je m'int√©ressais √† ce ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comment fonctionne SystemUI dans Android</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/433620/"><img src="https://habrastorage.org/webt/ku/m2/2u/kum22urbaazxg7rq-uvmucnkbm8.png"><br><br>  Dans cet article, j'analyserai l'architecture et le principe de fonctionnement de la principale application Android - SystemUI.  Je m'int√©ressais √† ce sujet, car je me demande comment fonctionne le syst√®me, qui est utilis√© par un si grand nombre d'utilisateurs et pour lequel des milliers d'applications sont t√©l√©charg√©es quotidiennement sur Google Play ou simplement sur Internet.  De plus, je m'int√©resse √† la question de la s√©curit√© de l'information d'Android et des applications cr√©√©es pour celui-ci. <br><br>  Sur Android, SystemUI est une application dont le chemin du code source se trouve dans <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">platform_frameworks_base / packages / SystemUI /</a> , sur l'appareil, il se trouve dans system / priv-app / -SystemUI. <br><br><a name="habracut"></a>  L'application priv est le r√©pertoire o√π sont stock√©es les applications privil√©gi√©es.  Soit dit en passant, sur le chemin du syst√®me / de l'application, il y a des applications pr√©install√©es, et les applications ordinaires que nous installons nous-m√™mes sur notre appareil sont stock√©es dans les donn√©es / l'application. <br><br>  Cela soul√®ve imm√©diatement la question: pourquoi toutes les applications pr√©install√©es et privil√©gi√©es ne peuvent-elles pas √™tre pouss√©es dans un r√©pertoire, pourquoi cette s√©paration est-elle n√©cessaire? <br><br>  Le fait est que certaines applications sont plus syst√©miques que d'autres :) Et cette s√©paration est n√©cessaire afin de r√©duire la couverture d'exploitation des applications syst√®me, afin d'acc√©der aux op√©rations prot√©g√©es.  Vous pouvez cr√©er une application qui aura un ApplicationInfo.FLAG_SYSTEM sp√©cial et dans le syst√®me obtiendra plus de droits, cependant, un fichier apk avec cette autorisation sera plac√© dans la section syst√®me. <br><br>  Donc, SystemUI est un fichier apk, qui est essentiellement une application normale.  Cependant, si vous regardez le p√©riph√©rique SystemUI complexe, il semble qu'il ne s'agisse que d'une simple application, non? <br><br><h4>  Cette application remplit des fonctions tr√®s importantes: </h4><br><ul><li>  La navigation </li><li>  Applications r√©centes </li><li>  Param√®tres rapides </li><li>  Barre de notification </li><li>  √âcran de verrouillage </li><li>  Contr√¥le du volume </li><li>  √âcran d'accueil </li><li>  ... </li></ul><br><h3>  Lancer SystemUI </h3><br>  Comme je l'ai dit plus haut, SystemUI n'est pas comme une application r√©guli√®re, donc son lancement ne s'accompagne pas du lancement d'une activit√©, comme c'est le cas avec la plupart des applications.  SystemUI est une <a href="">interface utilisateur globale</a> qui d√©marre pendant le processus de d√©marrage du syst√®me et ne peut pas √™tre termin√©e. <br><br><pre><code class="java hljs">&lt;application android:name=<span class="hljs-string"><span class="hljs-string">".SystemUIApplication"</span></span> android:persistent=<span class="hljs-string"><span class="hljs-string">"true"</span></span> android:allowClearUserData=<span class="hljs-string"><span class="hljs-string">"false"</span></span> android:allowBackup=<span class="hljs-string"><span class="hljs-string">"false"</span></span> android:hardwareAccelerated=<span class="hljs-string"><span class="hljs-string">"true"</span></span> android:label=<span class="hljs-string"><span class="hljs-string">"@string/app_label"</span></span> android:icon=<span class="hljs-string"><span class="hljs-string">"@drawable/icon"</span></span> android:process=<span class="hljs-string"><span class="hljs-string">"com.android.systemui"</span></span> android:supportsRtl=<span class="hljs-string"><span class="hljs-string">"true"</span></span> android:theme=<span class="hljs-string"><span class="hljs-string">"@style/Theme.SystemUI"</span></span> android:defaultToDeviceProtectedStorage=<span class="hljs-string"><span class="hljs-string">"true"</span></span> android:directBootAware=<span class="hljs-string"><span class="hljs-string">"true"</span></span> android:appComponentFactory=<span class="hljs-string"><span class="hljs-string">"androidx.core.app.CoreComponentFactory"</span></span>&gt;</code> </pre> <br>  Si nous entrons dans SystemServer, qui est l'un des deux piliers du monde Android (le deuxi√®me est Zygote, mais j'en parlerai une autre fois), alors nous pouvons trouver l'endroit o√π <a href="">SystemUI d√©marre au</a> d√©marrage du syst√®me. <br><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">final</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startSystemUi</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context, WindowManagerService windowManager)</span></span></span><span class="hljs-function"> </span></span>{ Intent intent = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Intent(); intent.setComponent(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ComponentName(<span class="hljs-string"><span class="hljs-string">"com.android.systemui"</span></span>, <span class="hljs-string"><span class="hljs-string">"com.android.systemui.SystemUIService"</span></span>)); intent.addFlags(Intent.FLAG_DEBUG_TRIAGED_MISSING); <span class="hljs-comment"><span class="hljs-comment">//Slog.d(TAG, "Starting service: " + intent); context.startServiceAsUser(intent, UserHandle.SYSTEM); windowManager.onSystemUiStarted(); }</span></span></code> </pre> <br>  Nous voyons ici comment le service SystemUI commence √† utiliser l'API non publique startServiceAsUser.  Si vous vouliez l'utiliser, vous devrez recourir √† la r√©flexion.  Mais si vous d√©cidez d'utiliser l'API de r√©flexion dans Android, r√©fl√©chissez √† plusieurs fois si cela en vaut la peine.  <s>Pensez cent fois :)</s> <br><br>  Donc, ici, nous cr√©ons un processus distinct pour l'application et, en fait, chaque section de <a href="">SystemUI</a> est un service distinct ou un module ind√©pendant. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SystemUI</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SysUiServiceProvider</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Context mContext; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Map&lt;Class&lt;?&gt;, Object&gt; mComponents; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">abstract</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onConfigurationChanged</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Configuration newConfig)</span></span></span><span class="hljs-function"> </span></span>{ } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dump</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(FileDescriptor fd, PrintWriter pw, String[] args)</span></span></span><span class="hljs-function"> </span></span>{ } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onBootCompleted</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ } <span class="hljs-meta"><span class="hljs-meta">@SuppressWarnings</span></span>(<span class="hljs-string"><span class="hljs-string">"unchecked"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> &lt;T&gt; <span class="hljs-function"><span class="hljs-function">T </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getComponent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Class&lt;T&gt; interfaceType)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (T) (mComponents != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> ? mComponents.get(interfaceType) : <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> &lt;T, C extends T&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">putComponent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Class&lt;T&gt; interfaceType, C component)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mComponents != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { mComponents.put(interfaceType, component); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overrideNotificationAppName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context, Notification.Builder n, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> system)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Bundle extras = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Bundle(); String appName = system ? context.getString(com.android.internal.R.string.notification_app_name_system) : context.getString(com.android.internal.R.string.notification_app_name_settings); extras.putString(Notification.EXTRA_SUBSTITUTE_APP_NAME, appName); n.addExtras(extras); } }</code> </pre><br>  La m√©thode start () est appel√©e pour d√©marrer <a href="">chaque service</a> , qui sont r√©pertori√©s ci-dessous. <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string-array</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"config_systemUIServiceComponents"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">translatable</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"false"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span>com.android.systemui.Dependency<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span>com.android.systemui.util.NotificationChannels<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span>com.android.systemui.statusbar.CommandQueue$CommandQueueStart<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span>com.android.systemui.keyguard.KeyguardViewMediator<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span>com.android.systemui.recents.Recents<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span>com.android.systemui.volume.VolumeUI<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span>com.android.systemui.stackdivider.Divider<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span>com.android.systemui.SystemBars<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span>com.android.systemui.usb.StorageNotification<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span>com.android.systemui.power.PowerUI<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span>com.android.systemui.media.RingtonePlayer<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span>com.android.systemui.keyboard.KeyboardUI<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span>com.android.systemui.pip.PipUI<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span>com.android.systemui.shortcut.ShortcutKeyDispatcher<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span>@string/config_systemUIVendorServiceComponent<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span>com.android.systemui.util.leak.GarbageMonitor$Service<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span>com.android.systemui.LatencyTester<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span>com.android.systemui.globalactions.GlobalActionsComponent<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span>com.android.systemui.ScreenDecorations<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span>com.android.systemui.fingerprint.FingerprintDialogImpl<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span>com.android.systemui.SliceBroadcastRelayHandler<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string-array</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><h3>  Contr√¥le du volume </h3><br>  Nous utilisons r√©guli√®rement les boutons de volume sur nos appareils, mais nous ne pensons pas aux processus qui devraient se produire dans le syst√®me afin que nous puissions augmenter ou diminuer le son.  L'op√©ration semble assez simple en termes de mots, mais si vous regardez le VolumeUI, qui est situ√© dans un sous-dossier de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">SystenUI / volume</a> , l'interface a sa propre variation dans diff√©rents modes. <br><br><img src="https://habrastorage.org/webt/tp/a0/nv/tpa0nvqhpyj6oeijp8dupz5poqw.png"><br>  J'ai d√©j√† dit que les services SystemUI sont d√©marr√©s par la m√©thode start ().  Si nous regardons la classe <a href="">VolumeUI</a> , elle h√©rite √©galement de SystemUI. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">VolumeUI</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SystemUI</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String TAG = <span class="hljs-string"><span class="hljs-string">"VolumeUI"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> LOGD = Log.isLoggable(TAG, Log.DEBUG); <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Handler mHandler = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Handler(); <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> mEnabled; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> VolumeDialogComponent mVolumeComponent; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> enableVolumeUi = mContext.getResources().getBoolean(R.bool.enable_volume_ui); <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> enableSafetyWarning = mContext.getResources().getBoolean(R.bool.enable_safety_warning); mEnabled = enableVolumeUi || enableSafetyWarning; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!mEnabled) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; mVolumeComponent = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> VolumeDialogComponent(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, mContext, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); mVolumeComponent.setEnableDialogs(enableVolumeUi, enableSafetyWarning); putComponent(VolumeComponent.class, getVolumeComponent()); setDefaultVolumeController(); } ‚Ä¶</code> </pre> <br>  Ici, nous voyons qu'avec mEnabled, nous d√©terminons si nous devons afficher un panneau avec les param√®tres sonores.  Et √† en juger par le VolumeDialogComponent, VolumeUI affiche la barre de son sous forme de dialogue.  Mais toutes les actions concernant la pression des touches de volume sont trait√©es dans <a href="">PhoneWindow</a> . <br><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onKeyDown</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> featureId, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> keyCode, KeyEvent event)</span></span></span><span class="hljs-function"> </span></span>{ ... <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (keyCode) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> KeyEvent.KEYCODE_VOLUME_UP: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> KeyEvent.KEYCODE_VOLUME_DOWN: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> KeyEvent.KEYCODE_VOLUME_MUTE: { <span class="hljs-comment"><span class="hljs-comment">// If we have a session send it the volume command, otherwise // use the suggested stream. if (mMediaController != null) { mMediaController.dispatchVolumeButtonEventAsSystemService(event); } else { getMediaSessionManager().dispatchVolumeKeyEventAsSystemService(event, mVolumeControlStreamType); } return true; } ... protected boolean onKeyUp(int featureId, int keyCode, KeyEvent event) { final KeyEvent.DispatcherState dispatcher = mDecor != null ? mDecor.getKeyDispatcherState() : null; if (dispatcher != null) { dispatcher.handleUpEvent(event); } //Log.i(TAG, "Key up: repeat=" + event.getRepeatCount() // + " flags=0x" + Integer.toHexString(event.getFlags())); switch (keyCode) { case KeyEvent.KEYCODE_VOLUME_UP: case KeyEvent.KEYCODE_VOLUME_DOWN: { // If we have a session send it the volume command, otherwise // use the suggested stream. if (mMediaController != null) { mMediaController.dispatchVolumeButtonEventAsSystemService(event); } else { getMediaSessionManager().dispatchVolumeKeyEventAsSystemService( event, mVolumeControlStreamType); } return true; } ‚Ä¶</span></span></code> </pre> <br>  Pour autant que nous puissions voir, KEYCODE_VOLUME_UP (+) n'est pas trait√© et passera au traitement KEYCODE_VOLUME_DOWN (-).  Dans les deux √©v√©nements, onKeyDown et onKeyUp, la m√©thode <a href="">dispatchVolumeButtonEventAsSystemService</a> est appel√©e. <br><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dispatchVolumeButtonEventAsSystemService</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@NonNull KeyEvent keyEvent)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (keyEvent.getAction()) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> KeyEvent.ACTION_DOWN: { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> direction = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (keyEvent.getKeyCode()) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> KeyEvent.KEYCODE_VOLUME_UP: direction = AudioManager.ADJUST_RAISE; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; ... mSessionBinder.adjustVolume(mContext.getPackageName(), mCbStub, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, direction, ... }</code> </pre><br>  Donc, ici, nous appelons la m√©thode adjustVolume, afin que nous puissions v√©rifier notre direction √† laquelle le param√®tre d'√©v√©nement sera affect√©. <br><br>  En cons√©quence, lorsque nous arrivons √† l' <a href="">AudioService</a> , o√π <a href="">sendVolumeUpdate</a> sera appel√©, o√π en plus d'appeler la m√©thode postVolumeChanged, l'interface HDMI sera install√©e. <br><br><pre> <code class="java hljs"> <span class="hljs-comment"><span class="hljs-comment">// UI update and Broadcast Intent protected void sendVolumeUpdate(int streamType, int oldIndex, int index, int flags) { ... mVolumeController.postVolumeChanged(streamType, flags); } private int updateFlagsForSystemAudio(int flags) { ... if (mHdmiSystemAudioSupported &amp;&amp; ((flags &amp; AudioManager.FLAG_HDMI_SYSTEM_AUDIO_VOLUME) == 0)) { flags &amp;= ~AudioManager.FLAG_SHOW_UI; } ... } return flags; } public void postVolumeChanged(int streamType, int flags) { ... mController.volumeChanged(streamType, flags); ... }</span></span></code> </pre> <br><h3>  Ringtoneplayer </h3><br>  RingtonePlayer dans Android agit comme un joueur.  Il h√©rite √©galement de SystemUI et dans la m√©thode <a href="">start ()</a> , nous voyons: <br><br><pre> <code class="java hljs"> <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ ... mAudioService.setRingtonePlayer(mCallback); ... }</code> </pre> <br>  Ici, nous installons mCallback, qui est essentiellement une instance d' <a href="">IRingtonePlayer</a> . <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> IRingtonePlayer mCallback = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IRingtonePlayer.Stub() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">play</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(IBinder token, Uri uri, AudioAttributes aa, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> volume, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> looping)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> RemoteException </span></span>{ ... } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(IBinder token)</span></span></span><span class="hljs-function"> </span></span>{ ... } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isPlaying</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(IBinder token)</span></span></span><span class="hljs-function"> </span></span>{ ... } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setPlaybackProperties</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(IBinder token, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> volume, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> looping)</span></span></span><span class="hljs-function"> </span></span>{ ... } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">playAsync</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Uri uri, UserHandle user, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> looping, AudioAttributes aa)</span></span></span><span class="hljs-function"> </span></span>{ ... } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopAsync</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ ... } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getTitle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Uri uri)</span></span></span><span class="hljs-function"> </span></span>{ ... } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ParcelFileDescriptor </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">openRingtone</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Uri uri)</span></span></span><span class="hljs-function"> </span></span>{ ... } };</code> </pre> <br>  √Ä la fin, vous pouvez contr√¥ler le RingtonePlayerService √† l'aide du classeur pour lire les fichiers audio. <br><br><h3>  Powerui </h3><br>  <a href="">PowerUI</a> est responsable de la gestion de l'alimentation et des notifications.  Il est √©galement h√©rit√© de SystemUI et poss√®de une m√©thode start (). <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ mPowerManager = (PowerManager) mContext.getSystemService(Context.POWER_SERVICE); mHardwarePropertiesManager = (HardwarePropertiesManager) mContext.getSystemService(Context.HARDWARE_PROPERTIES_SERVICE); mScreenOffTime = mPowerManager.isScreenOn() ? -<span class="hljs-number"><span class="hljs-number">1</span></span> : SystemClock.elapsedRealtime(); mWarnings = Dependency.get(WarningsUI.class); mEnhancedEstimates = Dependency.get(EnhancedEstimates.class); mLastConfiguration.setTo(mContext.getResources().getConfiguration()); ContentObserver obs = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ContentObserver(mHandler) { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onChange</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> selfChange)</span></span></span><span class="hljs-function"> </span></span>{ updateBatteryWarningLevels(); } }; <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> ContentResolver resolver = mContext.getContentResolver(); resolver.registerContentObserver(Settings.Global.getUriFor( Settings.Global.LOW_POWER_MODE_TRIGGER_LEVEL), <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, obs, UserHandle.USER_ALL); updateBatteryWarningLevels(); mReceiver.init(); showThermalShutdownDialog(); initTemperatureWarning(); }</code> </pre> <br>  Comme nous pouvons le voir dans le code ci-dessus, les modifications de Settings.Global.LOW_POWER_MODE_TRIGGER_LEVEL sont abonn√©es, et apr√®s cela, l'appel √† <a href="">mReceiver.init ()</a> est appel√©. <br><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// Register for Intent broadcasts for... IntentFilter filter = new IntentFilter(); filter.addAction(PowerManager.ACTION_POWER_SAVE_MODE_CHANGED); filter.addAction(Intent.ACTION_BATTERY_CHANGED); filter.addAction(Intent.ACTION_SCREEN_OFF); filter.addAction(Intent.ACTION_SCREEN_ON); filter.addAction(Intent.ACTION_USER_SWITCHED); mContext.registerReceiver(this, filter, null, mHandler); }</span></span></code> </pre> <br>  Ici, le r√©cepteur de diffusion est enregistr√©, √† l'aide duquel le suivi des modifications est effectu√©. <br><br><h3>  Les t√¢ches </h3><br>  <a href="">R√©cents</a> est une fonctionnalit√© principale et fr√©quemment utilis√©e dans les appareils mobiles Android. <br><br><h4>  Les fonctions principales: </h4><br><ul><li>  Afficher toutes les t√¢ches </li><li>  Basculer entre les t√¢ches </li><li>  Suppression de t√¢ches </li></ul><br><br>  En outre, Recents est √©galement h√©rit√© de SystemUI.  RecentsActivity cr√©e et met √† jour les derni√®res t√¢ches afin que nous puissions les voir sur notre √©cran. <br><br><img src="https://habrastorage.org/webt/82/m5/ms/82m5ms1gauzrja6tv5-m47jq62k.png"><br>  Et en utilisant <a href="">RecentTaskInfo,</a> nous pouvons obtenir des informations sur une t√¢che sp√©cifique. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RecentTaskInfo</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Parcelable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> id; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> persistentId; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Intent baseIntent; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ComponentName origActivity; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ComponentName realActivity; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> CharSequence description; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> stackId; ...</code> </pre> <br>  En g√©n√©ral, les t√¢ches en cours d'ex√©cution peuvent √™tre plac√©es dans une rubrique distincte.  Je l'ai √©tudi√© de tous les c√¥t√©s, car je voulais flouter l'√©cran de l'application avant de basculer l'application en arri√®re-plan, afin qu'une version illisible de l'instantan√© soit affich√©e dans RecentsTask.  Cependant, le probl√®me est que l'instantan√© de l'application est pris avant l'appel de onPause ().  Ce probl√®me peut √™tre r√©solu de plusieurs mani√®res.  Ou d√©finissez l'indicateur de sorte que le syst√®me cache simplement le contenu de l'√©cran avec <br><br><pre> <code class="java hljs">getWindow().setFlags(WindowManager.LayoutParams.FLAG_SECURE, WindowManager.LayoutParams.FLAG_SECURE);</code> </pre> <br>  Ce dont j'ai parl√© dans un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">article pr√©c√©dent</a> sur les instantan√©s. <br><br>  Vous pouvez g√©n√©ralement vous assurer que l'activit√© sp√©cifique de l'application n'appara√Æt pas dans les t√¢ches en inscrivant dans le manifeste <br><br><pre> <code class="xml hljs">android:excludeFromRecents = "true"</code> </pre> <br>  Ou vous pouvez utiliser l'astuce avec <br><br><pre> <code class="java hljs">Intent.FLAG_ACTIVITY_MULTIPLE_TASK</code> </pre> <br>  Vous pouvez d√©finir l'activit√© principale au-dessus de l'indicateur <i>excludeFromRecents = true</i> , afin que son √©cran ne se trouve pas dans les t√¢ches en cours d'ex√©cution, mais lorsque l'application se charge, ex√©cutez une t√¢che distincte qui affichera soit une capture d'√©cran floue de l'activit√© principale, soit toute autre image.  Plus en d√©tail, comment cela peut √™tre fait est d√©crit dans la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation officielle</a> sur l'exemple de Google Drive. <br><br><h3>  √âcran de verrouillage </h3><br>  Le clavier est d√©j√† plus compliqu√© que tous les modules ci-dessus.  Il s'agit d'un service qui s'ex√©cute dans SystemUI et est g√©r√© √† l'aide de KeyguardViewMediator. <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setupLocked</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ ... <span class="hljs-comment"><span class="hljs-comment">// Assume keyguard is showing (unless it's disabled) until we know for sure, unless Keyguard // is disabled. if (mContext.getResources().getBoolean( com.android.keyguard.R.bool.config_enableKeyguardService)) { setShowingLocked(!shouldWaitForProvisioning() &amp;&amp; !mLockPatternUtils.isLockScreenDisabled( KeyguardUpdateMonitor.getCurrentUser()), mAodShowing, mSecondaryDisplayShowing, true /* forceCallbacks */); } else { // The system's keyguard is disabled or missing. setShowingLocked(false, mAodShowing, mSecondaryDisplayShowing, true); } ... mLockSounds = new SoundPool(1, AudioManager.STREAM_SYSTEM, 0); String soundPath = Settings.Global.getString(cr, Settings.Global.LOCK_SOUND); if (soundPath != null) { mLockSoundId = mLockSounds.load(soundPath, 1); } ... int lockSoundDefaultAttenuation = mContext.getResources().getInteger( com.android.internal.R.integer.config_lockSoundVolumeDb); mLockSoundVolume = (float)Math.pow(10, (float)lockSoundDefaultAttenuation/20); ... }</span></span></code> </pre> <br>  Cependant, en r√©alit√©, KeyguardService ne fonctionne pas ind√©pendamment avec l'interface de l'√©cran de verrouillage, il transf√®re uniquement des informations au module StatusBar, o√π des actions sont d√©j√† prises concernant l'apparence visuelle de l'√©cran et l'affichage des informations. <br><br><h3>  Barre de notification </h3><br>  <a href="">SystemBars</a> a un dispositif et une structure assez complexes.  Son travail est divis√© en deux √©tapes: <br><ol><li>  Initialisation de SystemBars </li><li>  Afficher les notifications </li></ol><br>  Si vous regardez le lancement de SystemBars <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createStatusBarFromConfig</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ ... <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String clsName = mContext.getString(R.string.config_statusBarComponent); ... cls = mContext.getClassLoader().loadClass(clsName); ... mStatusBar = (SystemUI) cls.newInstance(); ... }</code> </pre> <br>  Ensuite, nous voyons un lien vers la ressource √† partir de laquelle <a href="">le nom de classe est lu</a> et une instance est cr√©√©e. <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"config_statusBarComponent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">translatable</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"false"</span></span></span><span class="hljs-tag">&gt;</span></span>com.android.systemui.statusbar.phone.StatusBar<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Ainsi, nous voyons qu'un StatusBar est appel√© ici, ce qui fonctionnera avec la notification et la sortie de l'interface utilisateur. <br><br>  Je pense que personne ne doutait qu'Android soit tr√®s compliqu√© et contienne de nombreuses astuces d√©crites dans un grand nombre de lignes de code.  SystemUI est l'une des parties les plus importantes de ce syst√®me et j'ai appr√©ci√© de l'apprendre.  √âtant donn√© qu'il y a tr√®s peu de mat√©riel sur ce sujet, si vous remarquez des erreurs, veuillez me corriger. <br><br>  PS <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">J'expose</a> toujours une s√©lection de documents et d'articles plus courts sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">@paradisecurity</a> dans les t√©l√©grammes. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr433620/">https://habr.com/ru/post/fr433620/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr433608/index.html">La voiture du futur. √âcrans au lieu de vitres automobiles?</a></li>
<li><a href="../fr433610/index.html">Notes d'un phytochimiste. Kaki</a></li>
<li><a href="../fr433612/index.html">FCC: satellites SpaceX en orbite - une source de d√©bris dangereux pour les habitants de la Terre</a></li>
<li><a href="../fr433614/index.html">Comment prendre le contr√¥le de votre infrastructure r√©seau. Chapitre un R√©tention</a></li>
<li><a href="../fr433618/index.html">Son "tube chaud" de vos propres mains. Et si vous traversez un magasin, un club et un atelier?</a></li>
<li><a href="../fr433624/index.html">Apprendre Rust: Comment j'ai fait le chat UDP avec Azul</a></li>
<li><a href="../fr433628/index.html">Culture du feedback: comment ne pas glisser dans les accusations</a></li>
<li><a href="../fr433630/index.html">Un pas de plus vers le vaccin contre le VIH: titre de singe en anticorps neutralisants s√©riques</a></li>
<li><a href="../fr433632/index.html">Une autre application mobile a "divulgu√©" les donn√©es de ses utilisateurs</a></li>
<li><a href="../fr433634/index.html">Surveillance des ruches | Moi Dadan et demi-ukrainien | Redondance des donn√©es</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>