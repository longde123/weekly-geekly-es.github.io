<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🅰️ 🌷 🌇 Anleitung: Testen von Ansible-Rollen und Informieren über Probleme vor der Produktion 👨🏾‍💻 🕘 📳</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo allerseits! 


 Ich arbeite als DevOps-Ingenieur im Hotelreservierungsservice Ostrovok.ru . In diesem Artikel möchte ich über unsere Erfahrungen...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Anleitung: Testen von Ansible-Rollen und Informieren über Probleme vor der Produktion</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ostrovok/blog/448136/"><p>  Hallo allerseits! </p><br><p>  Ich arbeite als DevOps-Ingenieur im Hotelreservierungsservice <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Ostrovok.ru</a> .  In diesem Artikel möchte ich über unsere Erfahrungen beim Testen ansibler Rollen sprechen. </p><br><p>  Bei Ostrovok.ru verwenden wir ansible als Konfigurationsmanager.  Wir hatten kürzlich die Notwendigkeit, Rollen zu testen, aber wie sich herausstellte, gibt es dafür nicht viele Tools - das Molecule-Framework ist vielleicht das beliebteste, deshalb haben wir uns für die Verwendung entschieden.  Es stellte sich jedoch heraus, dass seine Dokumentation über viele Fallstricke schweigte.  Wir konnten keinen ausreichend detaillierten Leitfaden auf Russisch finden und haben uns daher entschlossen, diesen Artikel zu schreiben. </p><br><img src="https://habrastorage.org/webt/a-/ia/np/a-ianpukaixuflfp5svh_vpj8tu.png"><a name="habracut"></a><br><h1>  Molekül </h1><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Molekül</a> - ein Framework zum Testen ansibler Rollen. </p><br><p>  Vereinfachte Beschreibung: Das Molekül erstellt eine Instanz auf der von Ihnen angegebenen Plattform (Cloud, virtuelle Maschine, Container; weitere Einzelheiten finden Sie im Abschnitt <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Treiber</a> ), führt Ihre Rolle darauf aus, führt dann die Tests aus und löscht die Instanz.  Im Falle eines Fehlers bei einem der Schritte informiert Sie das Molekül darüber. </p><br><p>  Jetzt genauer. </p><br><h3 id="nemnogo-teorii">  Ein bisschen Theorie </h3><br><p>  Betrachten Sie die beiden Schlüsselelemente des Moleküls: Szenario und Treiber. </p><br><h4 id="scenario">  Szenario </h4><br><p> Das Skript enthält eine Beschreibung dessen, was, wo, wie und in welcher Reihenfolge ausgeführt wird.  Eine Rolle kann mehrere Skripte enthalten, und jedes ist ein Verzeichnis entlang des Pfads <code>&lt;role&gt;/molecule/&lt;scenario&gt;</code> , das Beschreibungen der für den Test erforderlichen Aktionen enthält.  Das <code>default</code> muss vorhanden sein, das automatisch erstellt wird, wenn Sie die Rolle mit dem Molekül initialisieren.  Die Namen der folgenden Szenarien werden nach Ihrem Ermessen ausgewählt. </p><br><p>  Die Testsequenz im Skript wird als <strong>Matrix</strong> bezeichnet und ist standardmäßig wie folgt: </p><br><p>  <em>(Schritte markiert mit <code>?</code> standardmäßig übersprungen, wenn sie nicht vom Benutzer beschrieben wurden.)</em> </p><br><ul><li>  <code>lint</code> Linter.  Standardmäßig werden <code>yamllint</code> und <code>flake8</code> . </li><li>  <code>destroy</code> - Instanzen vom letzten Molekülstart entfernen (falls übrig), </li><li>  <code>dependency</code> ?  - Installation der Ansible-Abhängigkeit der getesteten Rolle, </li><li>  <code>syntax</code> - Überprüfen Sie die Syntax einer Rolle mit <code>ansible-playbook --syntax-check</code> , </li><li>  <code>create</code> - Instanz erstellen, </li><li>  <code>prepare</code> ?  - Vorbereitung der Instanz;  B. Python2 überprüfen / installieren </li><li>  <code>converge</code> - Start des getesteten Playbooks, </li><li>  <code>idempotence</code> - Starten Sie das Playbook für den Idempotenztest neu. </li><li>  <code>side_effect</code> ?  - Maßnahmen, die nicht direkt mit der Rolle zusammenhängen, aber für Tests erforderlich sind, </li><li>  <code>verify</code> - Führen Sie Tests der resultierenden Konfiguration mit <code>testinfra</code> (Standard) / <code>goss</code> / <code>inspec</code> . </li><li>  <code>cleanup</code> ?  - (in neuen Versionen) - grob gesagt die „Reinigung“ der vom Molekül betroffenen externen Infrastruktur, </li><li>  <code>destroy</code> - lösche eine Instanz. </li></ul><br><p>  Diese Sequenz deckt die meisten Fälle ab, kann jedoch bei Bedarf geändert werden. </p><br><p>  Jeder der obigen Schritte kann separat mit dem <code>molecule &lt;command&gt;</code> .  Es lohnt sich jedoch zu verstehen, dass für jeden solchen cli-Befehl eine eigene Abfolge von Aktionen existieren kann, die durch Ausführen der <code>molecule matrix &lt;command&gt;</code> erkannt werden kann.  Wenn Sie beispielsweise den Befehl <code>converge</code> ausführen (das getestete Playbook ausführen), werden die folgenden Aktionen ausgeführt: </p><br><pre> <code class="bash hljs">$ molecule matrix converge ... └── default <span class="hljs-comment"><span class="hljs-comment">#   ├── dependency #   ├── create #   ├── prepare #   └── converge #  </span></span></code> </pre> <br><p>  Die Reihenfolge dieser Aktionen kann bearbeitet werden.  Wenn etwas aus der Liste bereits abgeschlossen ist, wird es übersprungen.  Der aktuelle Status sowie die <code>$TMPDIR/molecule/&lt;role&gt;/&lt;scenario&gt;</code> werden im <code>$TMPDIR/molecule/&lt;role&gt;/&lt;scenario&gt;</code> gespeichert. </p><br><p>  Schritte hinzufügen mit <code>?</code>  Nachdem Sie die gewünschten Aktionen im Format von Ansible-Playbook beschrieben haben, können Sie den Dateinamen gemäß dem folgenden Schritt <code>prepare.yml</code> : <code>prepare.yml</code> / <code>side_effect.yml</code> .  Das Molekül wartet im Skriptordner auf diese Dateien. </p><br><h4 id="driver">  Fahrer </h4><br><p>  Ein Treiber ist eine Entität, in der Testinstanzen erstellt werden. <br>  Die Liste der Standardtreiber, für die das Molekül Vorlagen bereit hält, lautet wie folgt: Azure, Docker, EC2, GCE, LXC, LXD, OpenStack, Vagrant, Delegiert. </p><br><p>  In den meisten Fällen handelt es sich bei den Vorlagen um die <code>destroy.yml</code> <code>create.yml</code> und <code>destroy.yml</code> im <code>destroy.yml</code> , die das Erstellen bzw. Löschen der Instanz beschreiben. <br>  Ausnahmen sind Docker und Vagrant, da Interaktionen mit ihren Modulen ohne die oben genannten Dateien auftreten können. </p><br><p>  Es lohnt sich, den delegierten Treiber hervorzuheben, da, wenn er in den Dateien zum Erstellen und Löschen einer Instanz verwendet wird, nur die Arbeit mit der Konfiguration von Instanzen beschrieben wird, der Rest vom Techniker beschrieben werden sollte. </p><br><p>  Der Standardtreiber ist Docker. </p><br><p>  Nun wenden wir uns der Praxis zu und betrachten dort weitere Funktionen. </p><br><h3 id="nachalo-raboty">  Erste Schritte </h3><br><p>  Als "Hallo Welt" testen wir die einfache Rolle der Installation von Nginx.  Wir wählen Docker als Treiber - ich denke, es ist auf den meisten von Ihnen installiert (und denken Sie daran, dass Docker der Standardtreiber ist). </p><br><p>  <code>virtualenv</code> Sie <code>virtualenv</code> und installieren Sie das <code>molecule</code> darin: </p><br><pre> <code class="bash hljs">&gt; pip install virtualenv &gt; virtualenv -p `<span class="hljs-built_in"><span class="hljs-built_in">which</span></span> python2` venv &gt; <span class="hljs-built_in"><span class="hljs-built_in">source</span></span> venv/bin/activate &gt; pip install molecule docker <span class="hljs-comment"><span class="hljs-comment"># molecule  ansible  ; docker  </span></span></code> </pre> <br><p>  Der nächste Schritt besteht darin, eine neue Rolle zu initialisieren. <br>  Die Initialisierung einer neuen Rolle sowie eines neuen Szenarios erfolgt mit dem <code>molecule init &lt;params&gt;</code> : </p><br><pre> <code class="bash hljs">&gt; molecule init role -r nginx --&gt; Initializing new role nginx... Initialized role <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> &lt;path&gt;/nginx successfully. &gt; <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> nginx &gt; tree -L 1 . ├── README.md ├── defaults ├── handlers ├── meta ├── molecule ├── tasks └── vars 6 directories, 1 file</code> </pre> <br><p>  Das Ergebnis war eine typische ansible Rolle.  Ferner werden alle Wechselwirkungen mit den CLI-Molekülen von der Wurzel der Rolle aus hergestellt. </p><br><p>  Mal sehen, was sich im Rollenverzeichnis befindet: </p><br><pre> <code class="bash hljs">&gt; tree molecule/default/ molecule/default/ ├── Dockerfile.j2 <span class="hljs-comment"><span class="hljs-comment"># Jinja-  Dockerfile ├── INSTALL.rst. #       ├── molecule.yml #   ├── playbook.yml #    └── tests #     verify └── test_default.py 1 directory, 6 files</span></span></code> </pre> <br><p>  Lassen Sie uns die <code>molecule/default/molecule.yml</code> Konfiguration analysieren (wir ersetzen nur das Docker-Bild): </p><br><pre> <code class="plaintext hljs">--- dependency: name: galaxy driver: name: docker lint: name: yamllint platforms: - name: instance image: centos:7 provisioner: name: ansible lint: name: ansible-lint scenario: name: default verifier: name: testinfra lint: name: flake8</code> </pre> <br><h4 id="dependency">  Abhängigkeit </h4><br><p>  Dieser Abschnitt beschreibt die Quelle der Abhängigkeiten. </p><br><p>  Mögliche Optionen: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Galaxie</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">vergoldet</a> , Muschel. </p><br><p>  Shell ist nur eine Befehls-Shell, die verwendet wird, wenn Galaxie und Gold Ihre Anforderungen nicht erfüllen. </p><br><p>  Ich werde hier nicht lange aufhören, es ist in der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Dokumentation</a> ausreichend beschrieben. </p><br><h4 id="driver-1">  Fahrer </h4><br><p>  Der Name des Fahrers.  Wir haben diesen Docker. </p><br><h4 id="lint">  Flusen </h4><br><p>  Als Linter wird Yamllint verwendet. </p><br><p>  Nützliche Optionen in diesem Teil der Konfiguration sind die Möglichkeit, eine Konfigurationsdatei für yamllint anzugeben, Umgebungsvariablen weiterzuleiten oder den Linter zu deaktivieren: </p><br><pre> <code class="plaintext hljs">lint: name: yamllint options: config-file: foo/bar env: FOO: bar enabled: False</code> </pre> <br><h4 id="platforms">  Plattformen </h4><br><p>  Beschreibt die Konfiguration von Instanzen. <br>  Im Fall des Dockers als Treiber wird das Molekül über diesen Abschnitt iteriert, und jedes Listenelement ist in <code>Dockerfile.j2</code> als <code>Dockerfile.j2</code> verfügbar. </p><br><p>  Im Fall des Treibers, in dem <code>create.yml</code> und <code>destroy.yml</code> , ist der Abschnitt <code>create.yml</code> als <code>destroy.yml</code> verfügbar, und die Iterationen darauf sind bereits in diesen Dateien beschrieben. </p><br><p>  Da das Molekül eine Instanzsteuerung für ansible Module bietet, muss dort eine Liste möglicher Einstellungen gesucht werden.  Für Docker wird beispielsweise das Modul <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">docker_container_module verwendet</a> .  Welche Module in anderen Treibern verwendet werden, finden Sie in der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Dokumentation</a> . </p><br><p>  Beispiele für die Verwendung verschiedener Treiber finden sich <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">in Tests des Moleküls selbst</a> . </p><br><p>  Ersetzen Sie <strong>Centos: 7</strong> auf <strong>Ubuntu hier</strong> . </p><br><h4 id="provisioner">  Provisioner </h4><br><p>  "Provider" ist die Entität, die die Instanzen steuert.  Im Fall des Moleküls ist dies ansible, Unterstützung für andere ist nicht geplant, so dass dieser Abschnitt mit Vorbehalt die erweiterte Konfiguration von ansible genannt werden kann. <br>  Hier können Sie viele Dinge spezifizieren, ich werde die wichtigsten Momente meiner Meinung nach hervorheben: </p><br><ul><li>  <strong>Playbooks</strong> : Sie können festlegen, welche Playbooks in bestimmten Phasen verwendet werden sollen. </li></ul><br><pre> <code class="plaintext hljs">provisioner: name: ansible playbooks: create: create.yml destroy: ../default/destroy.yml converge: playbook.yml side_effect: side_effect.yml cleanup: cleanup.yml</code> </pre> <br><ul><li>  <strong>config_options</strong> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ansible config</a> </li></ul><br><pre> <code class="plaintext hljs">provisioner: name: ansible config_options: defaults: fact_caching: jsonfile ssh_connection: scp_if_ssh: True</code> </pre> <br><ul><li>  <strong>Verbindungsoptionen</strong> : <strong>Verbindungsparameter</strong> </li></ul><br><pre> <code class="plaintext hljs">provisioner: name: ansible connection_options: ansible_ssh_common_args: "-o 'UserKnownHostsFile=/dev/null' -o 'ForwardAgent=yes'"</code> </pre> <br><ul><li>  <strong>Optionen</strong> : Ansible Optionen und Umgebungsvariablen </li></ul><br><pre> <code class="plaintext hljs">provisioner: name: ansible options: vvv: true diff: true env: FOO: BAR</code> </pre> <br><h4 id="scenario-1">  Szenario </h4><br><p>  Der Name und die Beschreibung der Skriptsequenzen. <br>  Sie können die Standardaktionsmatrix eines <code>&lt;command&gt;_sequence</code> ändern, indem Sie den <code>&lt;command&gt;_sequence</code> und die Liste der Schritte festlegen, die wir als Wert dafür benötigen. <br>  Angenommen, wir möchten die Reihenfolge der Aktionen ändern, wenn wir den Befehl playbook run ausführen: <code>molecule converge</code> </p><br><pre> <code class="plaintext hljs"># : # - dependency # - create # - prepare # - converge scenario: name: default converge_sequence: - create - converge</code> </pre> <br><h4 id="verifier">  Prüfer </h4><br><p>  Einrichten des Frameworks für Tests und des Linter dazu.  Standardmäßig werden <code>testinfra</code> und <code>flake8</code> <code>testinfra</code> <code>flake8</code> .  Mögliche Optionen sind ähnlich wie oben: </p><br><pre> <code class="plaintext hljs">verifier: name: testinfra additional_files_or_dirs: - ../path/to/test_1.py - ../path/to/test_2.py - ../path/to/directory/* options: n: 1 enabled: False env: FOO: bar lint: name: flake8 options: benchmark: True enabled: False env: FOO: bar</code> </pre> <br><p>  Kommen wir zurück zu unserer Rolle.  Bearbeiten Sie die <code>tasks/main.yml</code> : </p><br><pre> <code class="plaintext hljs">--- - name: Install nginx apt: name: nginx state: present - name: Start nginx service: name: nginx state: started</code> </pre><br><p>  Und fügen Sie die Tests zu <code>molecule/default/tests/test_default.py</code> </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_nginx_is_installed</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(host)</span></span></span><span class="hljs-function">:</span></span> nginx = host.package(<span class="hljs-string"><span class="hljs-string">"nginx"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> nginx.is_installed <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_nginx_running_and_enabled</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(host)</span></span></span><span class="hljs-function">:</span></span> nginx = host.service(<span class="hljs-string"><span class="hljs-string">"nginx"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> nginx.is_running <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> nginx.is_enabled <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_nginx_config</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(host)</span></span></span><span class="hljs-function">:</span></span> host.run(<span class="hljs-string"><span class="hljs-string">"nginx -t"</span></span>)</code> </pre><br><p>  Fertig, es bleibt nur zu laufen (von der Wurzel der Rolle, erinnere ich Sie): </p><br><pre> <code class="bash hljs">&gt; molecule <span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Langer Auspuff unter dem Spoiler:</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">--&gt; Validating schema &lt;path&gt;/nginx/molecule/default/molecule.yml. Validation completed successfully. --&gt; Test matrix └── default ├── lint ├── destroy ├── dependency ├── syntax ├── create ├── prepare ├── converge ├── idempotence ├── side_effect ├── verify └── destroy --&gt; Scenario: 'default' --&gt; Action: 'lint' --&gt; Executing Yamllint on files found in &lt;path&gt;/nginx/... Lint completed successfully. --&gt; Executing Flake8 on files found in &lt;path&gt;/nginx/molecule/default/tests/... Lint completed successfully. --&gt; Executing Ansible Lint on &lt;path&gt;/nginx/molecule/default/playbook.yml... Lint completed successfully. --&gt; Scenario: 'default' --&gt; Action: 'destroy' PLAY [Destroy] ***************************************************************** TASK [Destroy molecule instance(s)] ******************************************** changed: [localhost] =&gt; (item=None) changed: [localhost] TASK [Wait for instance(s) deletion to complete] ******************************* ok: [localhost] =&gt; (item=None) ok: [localhost] TASK [Delete docker network(s)] ************************************************ PLAY RECAP ********************************************************************* localhost : ok=2 changed=1 unreachable=0 failed=0 --&gt; Scenario: 'default' --&gt; Action: 'dependency' Skipping, missing the requirements file. --&gt; Scenario: 'default' --&gt; Action: 'syntax' playbook: &lt;path&gt;/nginx/molecule/default/playbook.yml --&gt; Scenario: 'default' --&gt; Action: 'create' PLAY [Create] ****************************************************************** TASK [Log into a Docker registry] ********************************************** skipping: [localhost] =&gt; (item=None) TASK [Create Dockerfiles from image names] ************************************* changed: [localhost] =&gt; (item=None) changed: [localhost] TASK [Discover local Docker images] ******************************************** ok: [localhost] =&gt; (item=None) ok: [localhost] TASK [Build an Ansible compatible image] *************************************** changed: [localhost] =&gt; (item=None) changed: [localhost] TASK [Create docker network(s)] ************************************************ TASK [Create molecule instance(s)] ********************************************* changed: [localhost] =&gt; (item=None) changed: [localhost] TASK [Wait for instance(s) creation to complete] ******************************* changed: [localhost] =&gt; (item=None) changed: [localhost] PLAY RECAP ********************************************************************* localhost : ok=5 changed=4 unreachable=0 failed=0 --&gt; Scenario: 'default' --&gt; Action: 'prepare' Skipping, prepare playbook not configured. --&gt; Scenario: 'default' --&gt; Action: 'converge' PLAY [Converge] **************************************************************** TASK [Gathering Facts] ********************************************************* ok: [instance] TASK [nginx : Install nginx] *************************************************** changed: [instance] TASK [nginx : Start nginx] ***************************************************** changed: [instance] PLAY RECAP ********************************************************************* instance : ok=3 changed=2 unreachable=0 failed=0 --&gt; Scenario: 'default' --&gt; Action: 'idempotence' Idempotence completed successfully. --&gt; Scenario: 'default' --&gt; Action: 'side_effect' Skipping, side effect playbook not configured. --&gt; Scenario: 'default' --&gt; Action: 'verify' --&gt; Executing Testinfra tests found in &lt;path&gt;/nginx/molecule/default/tests/... ============================= test session starts ============================== platform darwin -- Python 2.7.15, pytest-4.3.0, py-1.8.0, pluggy-0.9.0 rootdir: &lt;path&gt;/nginx/molecule/default, inifile: plugins: testinfra-1.16.0 collected 4 items tests/test_default.py .... [100%] ========================== 4 passed in 27.23 seconds =========================== Verifier completed successfully. --&gt; Scenario: 'default' --&gt; Action: 'destroy' PLAY [Destroy] ***************************************************************** TASK [Destroy molecule instance(s)] ******************************************** changed: [localhost] =&gt; (item=None) changed: [localhost] TASK [Wait for instance(s) deletion to complete] ******************************* changed: [localhost] =&gt; (item=None) changed: [localhost] TASK [Delete docker network(s)] ************************************************ PLAY RECAP ********************************************************************* localhost : ok=2 changed=2 unreachable=0 failed=0</code> </pre></div></div><br><p>  Unsere einfache Rolle wurde ohne Probleme getestet. <br>  Es ist zu beachten, dass das <code>molecule test</code> die Instanz löscht, wenn während des Betriebs des <code>molecule test</code> Probleme <code>molecule test</code> sind. Wenn Sie die Standardsequenz nicht geändert haben. </p><br><p>  Die folgenden Befehle sind zum Debuggen hilfreich: </p><br><pre> <code class="bash hljs">&gt; molecule --debug &lt;<span class="hljs-built_in"><span class="hljs-built_in">command</span></span>&gt; <span class="hljs-comment"><span class="hljs-comment"># debug info.      . &gt; molecule converge #      . &gt; molecule login #    . &gt; molecule --help #   .</span></span></code> </pre> <br><h3 id="suschestvuyuschaya-rol">  Bestehende Rolle </h3><br><p>  Das Hinzufügen eines neuen Skripts zu einer vorhandenen Rolle erfolgt <strong>aus dem Rollenverzeichnis mit den</strong> folgenden Befehlen: </p><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#     &gt; molecule init scenarion --help #    &gt; molecule init scenario -r &lt;role_name&gt; -s &lt;scenario_name&gt;</span></span></code> </pre> <br><p>  Falls dies das erste Skript in der Rolle ist, kann die <code>-s</code> weggelassen werden, da das <code>default</code> erstellt wird. </p><br><h3 id="zaklyuchenie">  Fazit </h3><br><p>  Wie Sie sehen, ist das Molekül nicht sehr kompliziert. Wenn Sie Ihre eigenen Vorlagen verwenden, können Sie die Bereitstellung eines neuen Skripts auf das Bearbeiten von Variablen in Playbooks zum Erstellen und Löschen von Instanzen reduzieren.  Das Molekül lässt sich nahtlos in CI-Systeme integrieren, wodurch Sie die Entwicklungsgeschwindigkeit erhöhen können, indem Sie weniger Zeit für das manuelle Testen von Playbooks benötigen. </p><br><p>  Vielen Dank für Ihre Aufmerksamkeit.  Wenn Sie Erfahrung mit dem Testen ansibler Rollen haben und diese nicht mit dem Molekül zusammenhängen, teilen Sie uns dies in den Kommentaren mit! </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de448136/">https://habr.com/ru/post/de448136/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de448122/index.html">Wie ReactJS funktioniert Reaktionspaket</a></li>
<li><a href="../de448124/index.html">Mikrotik. SMS-Steuerung über WEB-Server</a></li>
<li><a href="../de448126/index.html">Geheimnisse der API von Android-Geräten. Yandex-Bericht</a></li>
<li><a href="../de448128/index.html">9 Tipps zur Verwendung der Katzenbibliothek in Scala</a></li>
<li><a href="../de448130/index.html">Deckbuilding-Design für Videospiele</a></li>
<li><a href="../de448140/index.html">SNA Hackathon 2019 - Ergebnisse</a></li>
<li><a href="../de448142/index.html">Wo Beweise, Fakten und Vorstellungskraft zusammenlaufen</a></li>
<li><a href="../de448144/index.html">NASA: Genetische Veränderungen durch Raumfahrt sind vorübergehend</a></li>
<li><a href="../de448146/index.html">Von der Prozessmodellierung bis zum Entwurf eines automatisierten Systems (Teil 1)</a></li>
<li><a href="../de448148/index.html">Infrastrukturplanung für die Installation der Zimbra Collaboration Suite</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>