<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤙🏼 🧑🏼 🖕🏾 Wie man einen Bot macht, der ein Foto in einen Comic verwandelt. Zweiter Teil Model Training 🏄 🤽🏽 🕴🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="⇨ Der erste Teil 
 ⇨ Dritter Teil 

 Hallo nochmal! 

 Wie Sie sehen, haben die Feiertage die Zeitachse für Artikel etwas verkrüppelt. 
 Ich denke, vi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Wie man einen Bot macht, der ein Foto in einen Comic verwandelt. Zweiter Teil Model Training</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/483168/">  <a href="https://habr.com/ru/post/479218/">⇨ Der erste Teil</a> <br>  <a href="https://habr.com/ru/post/485824/">⇨ Dritter Teil</a> <br><br>  Hallo nochmal! <br><br>  Wie Sie sehen, haben die Feiertage die Zeitachse für Artikel etwas verkrüppelt. <br>  Ich denke, viele haben es in dieser Zeit geschafft, ihr Modell zu trainieren und zumindest mit verschiedenen Datensätzen zu experimentieren. <br><blockquote>  1. Legen Sie die Verteilung <br>  2. Bilder herunterladen <br>  3. ??? <br>  4. Profit! <br></blockquote>  Wenn Sie mit unseren neuronalen Netzen nicht vertraut waren oder mit dem Lesen dieses Artikels beginnen, haben Sie, wie es heißt, keine Zeit, dies zu erklären. Wir nehmen das Distributionskit, laden die erforderlichen Bilder herunter und los geht's! <br><a name="habracut"></a><br>  Detaillierte Anweisungen finden Sie <a href="https://habr.com/ru/post/479218/">im vorherigen Artikel der Serie</a> . <br><br><h2>  Der erste Pfannkuchen ist klumpig </h2><br>  Als ich das Modell zum ersten Mal ohne weiteres für <a href="https://t.me/photo2comicsbot" rel="nofollow">@ photo2comicsbot</a> trainierte, habe ich nur ungefähr 1000 Seiten Comics in einen Datensatz gestopft. <br>  Ja, zusammen mit Deckblättern, Ankündigungen und anderen Füllern. <br><br>  Am Eingang sah es so aus: <br><br><img src="https://habrastorage.org/webt/vs/7t/p8/vs7tp8lqmuevcrv_3cpuzbyaef4.png"><br><br>  Das Ergebnis ist entsprechend: <br><br><img src="https://habrastorage.org/webt/2s/sf/5s/2ssf5st8mk1oge_9rrfbyepmlhk.png"><br><br><img src="https://habrastorage.org/webt/7x/dl/kp/7xdlkpn70yzd8qfljqusgn6jy5y.png"><br><br><img src="https://habrastorage.org/webt/ll/ll/v8/llllv8gmtfys_udt5euohplcjzw.png"><br><br><div class="spoiler">  <b class="spoiler_title">Weitere Bilder</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/tl/ey/8e/tley8enuh1qlcjt3nc7e9-wnzse.png"><br><br><img src="https://habrastorage.org/webt/2u/cz/5n/2ucz5nwpenvhonfh84m080tj_t0.png"><br><br><img src="https://habrastorage.org/webt/o7/qb/xt/o7qbxtxqcrgdcih_4m-ysiksd_e.png"><br><br><img src="https://habrastorage.org/webt/xc/-8/yl/xc-8ylyfuk71me4v59xxvn3qhj4.png"><br><br><img src="https://habrastorage.org/webt/ys/zx/vm/yszxvm-2hc8xt6rjsvvxcpuyy3w.png"><br><br><img src="https://habrastorage.org/webt/jl/p9/3t/jlp93trm26hwitdzgmdt_kylhfw.png"><br><br><img src="https://habrastorage.org/webt/3l/fb/y6/3lfby6xuenl47xlggsv9n2p9hss.png"><br><br><img src="https://habrastorage.org/webt/bq/mt/sd/bqmtsdr7xedmcxsogpa4j8olk8c.png"><br><br></div></div><br>  Das Modell vermittelt perfekt die allgemeinen Unterschiede zwischen Comics und Fotos: <br><br><ul><li>  Typische Farbkorrektur </li><li>  Gliederungsauswahl </li><li>  Blockieren </li><li>  Textwolke </li></ul><br>  Grundsätzlich kann diese Option für die Produktion durchaus ausreichen. <br><br>  Aber ich habe mich gefragt, welche Ergebnisse mit einem „saubereren“ Datensatz erzielt werden können. <br><br><h2>  Nimm zwei </h2><br>  Für das nächste Experiment habe ich die Seiten mit einem Block belassen und aus dem Rest die größten Stücke, bestehend aus einem Block, ausgeschnitten, um die vertikalen und horizontalen Trennlinien im endgültigen Modell zu beseitigen. <br><blockquote>  Vergessen Sie nicht, die vorherige Version zu speichern, wenn Sie Änderungen an Ihrem Datensatz vornehmen, z. B. Fotos löschen oder hinzufügen.  Sie haben einen Ort, an den Sie zurückkehren können, wenn etwas schief geht. </blockquote>  Der zweite Datensatz sah folgendermaßen aus: <br><br><img src="https://habrastorage.org/webt/ww/j9/8f/wwj98fxmy0d15c0xgxfz8w9bfs4.png"><br><br>  Das Ergebnis liegt auf der Hand: <br><br><img src="https://habrastorage.org/webt/zn/b3/sc/znb3sczf0ypubx8jya-uryrqbxm.png"><br><br><img src="https://habrastorage.org/webt/xp/n9/zv/xpn9zvimruobxodr4wa2vhrutxk.png"><br><br><img src="https://habrastorage.org/webt/xh/nf/sp/xhnfspsgqrkxvuvhdkj7vaqz5yy.png"><br><br><div class="spoiler">  <b class="spoiler_title">Weitere Bilder</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/ag/6b/pw/ag6bpwlw1xefb9o8igrdixarhqc.png"><br><br><img src="https://habrastorage.org/webt/h7/xb/di/h7xbdiuyzdmukmjalf3o6rdou8e.png"><br><br><img src="https://habrastorage.org/webt/by/j8/zk/byj8zkaujwhx52po8xqw37un2oo.png"><br><br><img src="https://habrastorage.org/webt/pl/po/0y/plpo0yucjtvt0sbfc-pefnxz940.png"><br><br><img src="https://habrastorage.org/webt/65/4f/el/654fellkdx6_ebimev8ardha_e0.png"><br><br><img src="https://habrastorage.org/webt/zj/9u/vq/zj9uvqeres9m1kr2nmzcpgt-8uc.png"><br></div></div><br>  Die Trennlinien verschwanden, aber mit ihnen die Ausdruckskraft, die der Text in den Wolken hinterließ: Sie traten viel seltener im Datensatz auf und waren nicht mehr das Hauptmerkmal. <br><br>  Der leere Raum, der früher mit Text gefüllt war, ist jetzt mit psychedelischem Rauschen gefüllt. <br><br><h2>  Das dritte Mal ist ein Zauber </h2><br>  Ich beschloss, den Text vollständig zu entfernen und nur die Teile der Comics zu belassen, in denen er nicht vorhanden ist.  Niemand überlebte: keine Wolke, keine Überschriften oder Seriennamen. <br><br>  Datensatz nach dem "sprachlichen Völkermord": <br><br><img src="https://habrastorage.org/webt/zu/pw/az/zupwaz8q1toeo9qvqncmfamino8.png"><br><br>  Das Endergebnis: <br><br><img src="https://habrastorage.org/webt/9s/o2/qg/9so2qgo6e6jpkdazfsqf2wlu1-w.png"><br><br><img src="https://habrastorage.org/webt/gs/nr/7p/gsnr7pfyfu4bcowe0bpyqlqn1vc.png"><br><br><img src="https://habrastorage.org/webt/me/vs/m6/mevsm6y3hlgvrvsa8qce0xhenqa.png"><br><br><div class="spoiler">  <b class="spoiler_title">Weitere Bilder</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/uv/hn/ua/uvhnuapobrpzdu8fxhyjqnz-ozg.png"><br><br><img src="https://habrastorage.org/webt/w1/gu/2e/w1gu2enojimz-lrpkzrzlkvihv8.png"><br><br><img src="https://habrastorage.org/webt/_e/j0/91/_ej091msilwm4hhlmbl3j7nw6sq.png"><br><br><img src="https://habrastorage.org/webt/ql/o6/th/qlo6thuiesfbqx_f2yx6yanf4ne.png"><br><br><img src="https://habrastorage.org/webt/cm/xg/4t/cmxg4tu9jp4-6dcjvjp2nwei3gq.png"><br></div></div><br>  Einerseits gibt es weniger Artefakte, andererseits ist die Ausdruckskraft weg.  Da im GAN-Training die Qualität des Ergebnisses weitgehend von Ihnen und mir bestimmt wird, gibt es kein einziges Rezept für ein gutes Modell. <br><br>  Schönheit liegt im Auge des Betrachters, also haben Sie keine Angst zu experimentieren und wählen Sie, was Ihnen am besten gefällt. <br><br><h2>  Auf die Waffe! </h2><br>  Nun, wir haben bereits über die wichtigsten Fallstricke und Methoden des Umgangs mit ihnen gesprochen. Es ist Zeit, sich an die Arbeit zu machen. <br><br>  Gehen Sie zu dem Ordner, in den wir die Distribution heruntergeladen haben.  Ich <b>möchte</b> Sie daran erinnern, dass es <b>pytorch-CycleGAN-and-pix2pix hieß</b> <br><br>  Da wir Anweisungen für Dummies haben, werden wir den Verteilungscode nicht berühren, da alle erforderlichen Parameter über die Befehlszeile eingestellt werden können. <br><br>  In dieser Verteilung findet das Standardtraining über zweihundert Epochen mit einer linearen Dämpfung der Lernrate nach der hundertsten Epoche statt. <br><blockquote>  Die maximale Auflösung, die meine 8-Gigabyte-Karte beherrschte, betrug 400 x 400.  Das komplette Training hat ungefähr 33 Stunden gedauert, also machen wir einen kleinen Life-Hack.  Zuerst werden wir das Modell in 128x128 Bildern trainieren, dann in 256x256, und erst im Endstadium werden wir ihr unsere wunderschönen 400x400 zeigen. <br>  Die erste Stufe wird 100 Epochen dauern, die zweite und die dritte jeweils 50. Dadurch können wir die Trainingszeit um fast die Hälfte reduzieren. <br><br>  Wie die Praxis zeigt, ist das Ergebnis mit diesem Ansatz nicht schlechter und manchmal sogar besser als beim sofortigen Training mit maximaler Auflösung. </blockquote>  Vielleicht genug Theorie, es ist Zeit, sich der Praxis zuzuwenden. <br><br>  Geben Sie an der Eingabeaufforderung Folgendes ein. <br><br><h3>  Stufe eins </h3><br><pre><code class="bash hljs">python train.py --dataroot {dataset root folder} --name {model name} --model cycle_gan --crop_size 128 --load_size 180 --init_type kaiming --netG resnet_9blocks --no_dropout --batch_size 4</code> </pre> <br>  <i>Vergessen Sie nicht, die Klammern durch Ihre eigenen Werte zu ersetzen.</i> <i><br></i> <br>  Wir werden einige Parameter genauer analysieren: <br><br><pre> <code class="bash hljs">--batch_size {number}</code> </pre> <br>  Dieser Parameter ist für die Anzahl der pro Zyklus verarbeiteten Bilder verantwortlich, was sich positiv auf die Geschwindigkeit und negativ auf die Völlerei des Modells auswirkt. <br><br>  Wählen Sie in jeder Phase die maximal mögliche --batch_size aus, die aufgrund des Mangels an GPU-Speicher keine Fehler verursacht. <br><br><pre> <code class="bash hljs">-- dataroot {dataset root folder}</code> </pre> <br>  - Ordner mit unserem Datensatz.  Darin sollten sich die Ordner trainA, trainB, testA, testB befinden, wie im vorherigen Artikel beschrieben. <br><br><pre> <code class="bash hljs">--name {model name}</code> </pre> <br>  - Der Name Ihres Projekts.  Es kann beliebig sein, aber ich empfehle, die Modellarchitektur, die maximale Auflösung und den Namen des Datensatzes in den Namen aufzunehmen. <br>  Zum Beispiel: "resnet9_128to400_comics8" <br>  Sie können also zwischen Experimenten mit verschiedenen Parametern und Daten unterscheiden. <br><br>  Die erste Stufe des Trainings kann im hundertsten Zeitalter gestoppt werden. <br><br>  Sie können den Fortschritt über den Browser verfolgen: <a href="http://localhost/" rel="nofollow">localhost</a> : 8097 / <br>  (oder ein anderer Link, der in der Konsole angezeigt wird) <br><br><h3>  Stufe zwei </h3><br><pre> <code class="bash hljs">python train.py --dataroot {dataset root folder} --name {model name} --model cycle_gan --crop_size 256 --load_size 290 --init_type kaiming --netG resnet_9blocks --no_dropout --batch_size 2 --epoch 100 --epoch_count 0 --continue_train</code> </pre> <br>  Es ist wichtig, die Ära anzugeben, in der wir unser Studium in der ersten Phase abgeschlossen haben. <br>  "--Epoch 100" bedeutet, dass wir das Modell vom Kontrollpunkt der hundertsten Ära laden <br>  "--Epoch_count 0" bedeutet, dass wir mit der maximalen Lerngeschwindigkeit von vorne beginnen. <br><br>  Die zweite Stufe des Trainings kann in der 50. Ära gestoppt werden. <br><br><h3>  Stufe drei </h3><br><pre> <code class="bash hljs">python train.py --dataroot {dataset root folder} --name {model name} --model cycle_gan --crop_size 400 --load_size 430 --init_type kaiming --netG resnet_9blocks --no_dropout --batch_size 1 --epoch 50 --epoch_count 0 --continue_train</code> </pre> <br><br>  Die dritte Stufe des Trainings kann im 50. Zeitalter abgebrochen werden, dies ist jedoch Geschmackssache.  Sie können bis zum Ende abschließen und das gewünschte Zwischenergebnis auswählen.  Es ist wichtig zu bedenken, dass das Ergebnis in der 200. Ära schlechter sein kann als in der 150. Ära. <br><br><h2>  Jetzt geh raus und schau, was du getan hast </h2><br>  Während des Trainings werden das Modell und die Zwischenergebnisse in einem Ordner gespeichert <br>  / pytorch-CycleGAN-and-pix2pix / checkpoints / {Modellname} <br><br>  Um das Modell zu testen, geben Sie einfach die Befehlszeile ein: <br><br><pre> <code class="bash hljs">python test.py --dataroot {dataset root folder} --name {model name} --model cycle_gan --netG resnet_9blocks --crop_size 512 --load_size 580 --epoch {epoch name}</code> </pre> <br>  Sie können das Ergebnis in einem Testdatensatz für einen beliebigen Prüfpunkt anzeigen. Geben Sie ihn einfach als {Epochenname} an.  Wenn {Epochenname} nicht angegeben ist, wird der letzte Prüfpunkt verwendet. <br><br>  Das Ergebnis wird im Ordner gespeichert: <br> <code>/pytorch-CycleGAN-and-pix2pix/results/{model name}/test_{epoch name}</code> <br> <blockquote>  Um nicht zu verwechseln, welches Modell auf welchem ​​Datensatz welches Ergebnis liefert, <br>  Fange an, ein kleines Tagebuch zu führen.  Erfassen Sie Basisdaten und Lernergebnisse. <br><br>  Zum Beispiel die Befehlszeile und die Zeit, bis zu der Sie gekommen sind.  Diese Daten reichen aus, um die Trainingsparameter und den Datensatz, auf den wir trainiert haben, zu speichern. <br><br>  Was ist schließlich der Unterschied zwischen einem wissenschaftlichen Experiment und herumalbern?  Dass bei uns alles dokumentiert ist! </blockquote>  Das ist alles für heute!  Im nächsten Artikel erfahren Sie, wie Sie ein fertiges Modell exportieren und in der Cloud hosten. <br><br>  Hab keine Angst zu experimentieren.  Probieren Sie verschiedene Datensätze aus, vergleichen Sie die Ergebnisse und teilen Sie sie in den Kommentaren mit! <br><br>  Bis bald <br><br>  <a href="https://habr.com/ru/post/485824/">⇨ Nächster Teil</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de483168/">https://habr.com/ru/post/de483168/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de483148/index.html">Wir diskutieren digitale Zwillinge und Simulationen mit dem Gründer eines Beratungsunternehmens</a></li>
<li><a href="../de483154/index.html">Ich gab 40.000 Dollar aus und ruinierte eine großartige Idee für ein Startup</a></li>
<li><a href="../de483156/index.html">Stellen Sie die Katze auf die Füße</a></li>
<li><a href="../de483160/index.html">Raum 2020: Mars, Konstellationen von Satelliten und neuen Raketen</a></li>
<li><a href="../de483166/index.html">Automatische Erkennung der Textkodierung</a></li>
<li><a href="../de483170/index.html">Messenger-Datenbank (Teil 2): ​​Wir partitionieren "Profit"</a></li>
<li><a href="../de483172/index.html">Wie lokalisiere ich eine App oder ein Spiel? Top Ten der kostenlosen E-Learning-Quellen</a></li>
<li><a href="../de483174/index.html">Nehmen Sie mit Multipeer Connectivity Ton auf und übertragen Sie ihn von Gerät zu Gerät</a></li>
<li><a href="../de483176/index.html">Messenger-Datenbank (Teil 1): Wir entwerfen den Basisrahmen</a></li>
<li><a href="../de483178/index.html">Hier ist ein Update zu Flutter 1.9 in Verbindung mit der Dart 2.5-Programmierung</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>