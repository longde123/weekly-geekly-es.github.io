<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👂🏾 🕴🏽 🛌🏽 Wie wir die Great Chinese Firewall durchbohrt haben (Teil 2) ♻️ 👦🏾 😄</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo! 


 Nikita ist wieder bei Ihnen - ein Systemingenieur von SEMrush . Und mit diesem Artikel setze ich die Geschichte fort, wie wir eine Lösung z...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Wie wir die Great Chinese Firewall durchbohrt haben (Teil 2)</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/semrush/blog/458840/"><p>  Hallo! </p><br><p>  Nikita ist wieder bei Ihnen - ein Systemingenieur von <strong>SEMrush</strong> .  Und mit diesem Artikel setze ich die Geschichte fort, wie wir eine Lösung zur Umgehung der <em>chinesischen Firewall</em> für unseren Dienst semrush.com gefunden haben. </p><br><p>  Im <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">vorherigen Teil habe</a> ich gesagt: </p><br><ul><li>  Welche Probleme treten auf, nachdem eine Entscheidung getroffen wurde? „Wir müssen dafür sorgen, dass unser Service in China funktioniert.“ </li><li>  Welche Probleme hat das chinesische Internet? </li><li>  Warum brauche ich eine ICP-Lizenz? </li><li>  wie und warum wir uns entschieden haben, unsere Prüfstände mit catchpoint zu testen </li><li>  Was war das Ergebnis unserer ersten Lösung, die auf Cloudflare China Network basiert? </li><li>  wie wir einen Fehler in DNS Cloudflare gefunden haben </li></ul><br><img src="https://habrastorage.org/webt/c8/e0/wt/c8e0wt5ps6j4bkc8glimogfgtxg.png"><br><p>  Dieser Teil ist meiner Meinung nach der interessanteste, da er sich auf bestimmte technische Implementierungen der Inszenierung konzentriert.  Und wir werden mit <strong>Alibaba Cloud</strong> beginnen oder vielmehr fortfahren. </p><a name="habracut"></a><br><h2 id="alibaba-cloud">  Alibaba Wolke </h2><br><p>  <strong>Alibaba Cloud</strong> ist ein ziemlich großer Cloud-Anbieter, der über alle Dienste verfügt, die es ihm ermöglichen, sich ehrlich als Cloud-Anbieter zu bezeichnen.  Es ist gut, dass sie die Möglichkeit haben, sich bei ausländischen Nutzern zu registrieren, und dass der größte Teil der Website ins Englische übersetzt wurde (für China ist dies ein Luxus).  In dieser Cloud können Sie mit vielen Regionen der Welt, dem chinesischen Festland sowie Ozeanien (Hongkong, Taiwan usw.) arbeiten. </p><br><h3 id="ipsec">  IPSEC </h3><br><p>  Begonnen mit Geographie.  Da sich unsere Testseite in Google Cloud befand, mussten wir Alibaba Cloud mit GCP „verknüpfen“, sodass wir eine Liste der Standorte öffneten, an denen Google präsent ist.  Zu diesem Zeitpunkt hatten sie noch kein eigenes Rechenzentrum in Hongkong. <br>  Die nächstgelegene Region war <strong>Asien-Ost1</strong> (Taiwan).  Ali hatte <strong>cn-shenzhen</strong> (Shenzhen) als die Taiwan am nächsten gelegene Region des chinesischen Festlandes. </p><br><p>  Mithilfe von <strong>Terraform haben sie</strong> die gesamte Infrastruktur in GCP und Ali beschrieben und erhöht.  Der 100-Mbit / s-Tunnel zwischen den Wolken stieg fast augenblicklich an.  Auf der Seite von Shenzhen und Taiwan haben sie virtuelle Proxy-Maschinen aufgestellt.  In Shenzhen wird der Benutzerverkehr beendet, durch einen Tunnel nach Taiwan geleitet und von dort direkt an das externe IP unseres Dienstes in den USA (Ostküste der USA) weitergeleitet.  Pingen Sie zwischen Virtuals im <strong>24-ms-</strong> Tunnel, was nicht so schlimm ist. </p><br><p>  Gleichzeitig haben wir eine Testzone in <strong>Alibaba Cloud DNS platziert</strong> .  Nach dem Delegieren der Zone an NS Ali verringerte sich die Auflösungszeit von 470 ms auf <strong>50 ms</strong> .  Zuvor befand sich die Zone auch auf Cloudlfare. </p><br><p>  Parallel zum Tunnel nach <em>Asien-Ost1</em> wurde ein weiterer Tunnel von Shenzhen direkt nach USA <em>-Ost4 errichtet</em> .  Dort erstellten sie mehr virtuelle Proxy-Maschinen und begannen, beide Lösungen zu messen und den Testverkehr mithilfe von Cookies oder DNS weiterzuleiten.  Der Prüfstand ist in der folgenden Abbildung schematisch beschrieben: </p><br><img src="https://habrastorage.org/webt/r8/c4/gv/r8c4gvhj7_joemea0hznmvo5gxk.png"><br><p>  Die Latenz für Tunnel ist wie folgt: <br>  <em>Ali cn-shenzhen &lt;-&gt; GCP Asien-Ost1 - 24ms</em> <em><br></em>  <em>Ali cn-shenzhen &lt;-&gt; GCP us-east4 - 200ms</em> </p><br><p>  Catchpoint-Browsertests haben hervorragende Leistungsverbesserungen gemeldet. </p><br><img src="https://habrastorage.org/webt/e0/ku/am/e0kuamjpkkcbj737036tyuirbuk.png"><br><p>  Vergleichen Sie die Testergebnisse für die beiden Lösungen: </p><br><div class="scrollable-table"><table><thead><tr><th>  Lösung </th><th>  Betriebszeit </th><th>  Median </th><th>  75 Perzentil </th><th>  95 Perzentil </th></tr></thead><tbody><tr><td>  Cloudflare </td><td>  86.6 </td><td>  18s </td><td>  30er Jahre </td><td>  60er Jahre </td></tr><tr><td>  <strong>IPsec</strong> </td><td>  <strong>99,79</strong> </td><td>  <strong>18s</strong> </td><td>  <strong>21s</strong> </td><td>  <strong>30er Jahre</strong> </td></tr></tbody></table></div><br><p>  Dies sind die Lösungsdaten, die den IPSEC-Tunnel durch <b>Asien-Ost1 verwenden</b> .  Durch us-east4 waren die Ergebnisse schlechter und es gab mehr Fehler, daher werde ich die Ergebnisse nicht angeben. </p><br><p>  Nach den Ergebnissen dieses Tests, zwei Tunneln, von denen einer in der nächstgelegenen Region zu China und der andere am endgültigen Ziel endet, wurde klar, dass es wichtig ist, so schnell wie möglich unter der chinesischen Firewall hervorzukommen und dann schnelle Netzwerke (CDN-Anbieter) zu verwenden. , Cloud-Anbieter usw.).  Sie müssen nicht auf einen Schlag versuchen, durch die Firewall zum Ziel zu gelangen.  Dies ist nicht der schnellste Weg. </p><br><p>  Im Allgemeinen sind die Ergebnisse nicht schlecht, jedoch hat semrush.com einen Median von 8,8 s und ein 75-Perzentil von 9,4 s (im selben Test). <br>  Und bevor ich weitermache, möchte ich einen Exkurs machen. </p><br><h2 id="liricheskoe-otstuplenie">  Lyrischer Exkurs </h2><br><p>  Nachdem der Benutzer die Website <em>www.semrushchina.cn</em> besucht <em>hat</em> , die über die „schnellen“ chinesischen DNS-Server aufgelöst wird, durchläuft die HTTP-Anfrage unsere schnelle Lösung.  Die Antwort wird auf die gleiche Weise zurückgegeben, aber in allen JS-Skripten, HTML-Seiten und anderen Elementen der Webseite wird die Domain <em>semrush.com</em> für zusätzliche Ressourcen angegeben, die beim Rendern der Seite geladen werden müssen.  Das heißt, der Client löst den "Haupt" <em>-Aufsatz</em> von <em>www.semrushchina.c</em> n auf und geht in den schnellen Tunnel, erhält schnell eine Antwort - eine HTML-Seite, die besagt: </p><br><ul><li>  Laden Sie diese und js von sso.semrush.com herunter. </li><li>  Nehmen Sie CSS-Dateien von cdn.semrush.com, </li><li>  und machen Sie mehr Bilder von dab.semrush.com </li><li>  usw. </li></ul><br><p>  Der Browser beginnt für diese Ressourcen, auf das „externe“ Internet zuzugreifen, und durchläuft jedes Mal eine Firewall, die die Antwortzeit verschlingt. </p><br><p>  Im vorherigen Test werden die Ergebnisse jedoch <em>angezeigt</em> , wenn auf der Seite keine <em>semrush.com-</em> Ressourcen vorhanden sind, <em>sondern</em> nur <em>semrushchina.cn</em> und * .semrushchina.cn an die Adresse der virtuellen Maschine in Shenzhen aufgelöst werden, um später in den Tunnel zu gelangen. </p><br><p>  Nur auf diese Weise können Sie akzeptable Geschwindigkeiten und Indikatoren für die Verfügbarkeit von Websites sowie ehrliche Ergebnisse von Testlösungen erhalten, indem Sie so viel Datenverkehr wie möglich durch Ihre Entscheidung, schnell durch die chinesische Firewall zu gelangen, werfen. <br>  Wir haben dies ohne eine einzige Code-Bearbeitung auf der Seite der Team-Produkte getan. </p><br><h3 id="subfilter">  Unterfilter </h3><br><p>  Die Lösung wurde fast unmittelbar nach dem Auftauchen dieses Problems geboren.  Wir brauchten <strong>PoC</strong> (Proof of Concept), damit unsere Firewall-Pass-Lösungen wirklich gut funktionieren.  Dazu müssen Sie den gesamten Datenverkehr zur Site in dieser Lösung maximieren.  Und wir haben <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://nginx.org/ru/docs/http/ngx_">Subfilter</a> in Nginx angewendet. </p><br><p>  <b>Subfilter</b> ist ein ziemlich einfaches Modul in Nginx, mit dem Sie eine Zeile im Hauptteil einer Antwort auf eine andere Zeile ändern können.  Deshalb haben wir alle Vorkommen von <em>semrush.com</em> in allen Antworten in <em>semrushchina.cn</em> geändert. </p><br><p>  Und ... das hat nicht funktioniert, weil wir komprimierten Inhalt von den Backends erhalten haben, sodass der Subfilter die erforderliche Zeile nicht finden konnte.  Ich musste nginx einen weiteren lokalen Server hinzufügen, der die Antwort erweiterte und an den nächsten lokalen Server weiterleitete, der bereits mit dem Ersetzen, Komprimieren und Übermitteln von Leitungen an den nächsten Proxy in der Kette befasst war. </p><br><img src="https://habrastorage.org/webt/pb/6m/jd/pb6mjdouldlxlm6hr1ilz9dpck0.png"><br><p>  Wenn der Kunde <strong>&lt;subdomain&gt; .semrush.com</strong> erhalten würde, würde er <strong>folglich</strong> <strong>&lt;subdomain&gt; .semrushchina.cn erhalten</strong> und unsere Entscheidung gehorsam durchgehen. </p><br><p>  Es reicht jedoch nicht aus, nur die Domain in eine Richtung zu ändern, da die Backends bei nachfolgenden Anforderungen des Clients immer noch semrush.com erwarten.  Dementsprechend erhalten wir auf demselben Server, auf dem das Ersetzen in eine Richtung erfolgt, mithilfe eines einfachen regulären Ausdrucks die Subdomain aus der Anforderung und führen dann <i>proxy_pass</i> mit der in <i>$</i> <i>subdomain.semrush.com festgelegten</i> <i>$ host-</i> Variablen aus.  Es mag verwirrend erscheinen, aber es funktioniert.  Und es funktioniert gut.  Für einzelne Domänen, die unterschiedliche Logik erfordern, erstellen sie einfach ihre Serverblöcke und nehmen eine separate Konfiguration vor.  Nachfolgend finden Sie verkürzte Nginx-Konfigurationen, um dieses Schema zu verdeutlichen und zu demonstrieren. </p><br><p>  Die folgende Konfiguration verarbeitet alle Anfragen von China an <i>.semrushchina.cn:</i> <br></p><pre><code class="plaintext hljs">listen 80; server_name ~^(?&lt;subdomain&gt;[\w\-]+)\.semrushchina.cn$; sub_filter '.semrush.com' '.semrushchina.cn'; sub_filter_last_modified on; sub_filter_once off; sub_filter_types *; gzip on; gzip_proxied any; gzip_types text/plain text/css application/json application/x-javascript text/xml application/xml application/xml+rss text/javascript application/javascript; location / { proxy_pass http://127.0.0.1:8083; proxy_set_header Accept-Encoding ""; proxy_set_header Host $subdomain.semrush.com; proxy_set_header X-Accept-Encoding $http_accept_encoding; } }</code> </pre> <br><p>  Diese Konfiguration wird an Port 83 an <i>localhost weitergeleitet</i> und wartet dort auf die folgende Konfiguration: </p><br><pre> <code class="plaintext hljs"> listen 127.0.0.1:8083; server_name *.semrush.com; location / { resolver 8.8.8.8 ipv6=off; gunzip on; proxy_pass https://$host; proxy_set_header Accept-Encoding gzip; } }</code> </pre> <br><p>  Auch dies sind zugeschnittene Konfigurationen. </p><br><p>  Ungefähr so.  Es mag kompliziert aussehen, aber es ist in Worten.  In der Tat ist alles einfacher als gedämpfte Rübe :) </p><br><h3 id="konec-liricheskogo-otstupleniya">  Das Ende des lyrischen Exkurses </h3><br><p>  Für eine Weile waren wir glücklich, weil der Mythos von fallenden IPSEC-Tunneln nicht bestätigt wurde.  Aber dann begannen die Tunnel zu fallen.  Mehrmals täglich für einige Minuten.  Ein bisschen, aber es passte nicht zu uns.  Da beide Tunnel auf der Ali-Seite auf demselben Router terminiert wurden, haben wir entschieden, dass dies möglicherweise ein regionales Problem ist und wir die Sicherungsregion erhöhen müssen. </p><br><p>  Aufgenommen.  Die Tunnel begannen zu unterschiedlichen Zeiten zu fallen, aber wir hatten ein fein abgestimmtes Failover auf der Upstream-Ebene in Nginx.  Aber dann begannen die Tunnel ungefähr zur gleichen Zeit zu fallen :) Und wieder 502 und 504. Die Betriebszeit begann sich zu verschlechtern, also begannen wir, die Option mit <b>Alibaba CEN</b> (Cloud Enterprise Network) auszuarbeiten. </p><br><h2 id="cen">  Cen </h2><br><p>  <b>CEN</b> ist die Konnektivität von zwei VPCs aus verschiedenen Regionen innerhalb der Alibaba Cloud, dh Sie können private Netzwerke aller Regionen innerhalb der Cloud miteinander verbinden.  Und vor allem: Dieser Kanal hat eine ziemlich strenge <em>SLA</em> .  Es ist sowohl in der Geschwindigkeit als auch in der Betriebszeit sehr stabil.  Aber es ist noch nie so einfach: </p><br><ul><li>  Es ist SEHR schwer zu bekommen, wenn Sie keine chinesischen Staatsbürger oder juristische Personen sind. </li><li>  Sie müssen für jedes Megabit Bandbreite bezahlen. </li></ul><br><p>  Mit der Möglichkeit, <em>Festlandchina</em> und <em>Übersee</em> zu verbinden, haben wir ein CEN zwischen zwei Ali-Regionen geschaffen: <b>cn-shenzhen</b> und <b>us-east-1</b> (der nächstgelegene Punkt zu us-east4).  In Ali <i>us-east-1 haben sie</i> eine weitere virtuelle Maschine angehoben, um einen weiteren <em>Hop zu erhalten</em> . </p><br><p>  Es stellte sich so heraus: </p><br><img src="https://habrastorage.org/webt/s5/0s/qs/s50sqsjxzjx0r1fqyx-cjsjkuvq.png"><br><p>  Browser-Testergebnisse unten: </p><br><img src="https://habrastorage.org/webt/9b/p0/oq/9bp0oqtuludsve8g5tlnqfsa75k.png"><br><div class="scrollable-table"><table><thead><tr><th>  Lösung </th><th>  Betriebszeit </th><th>  Median </th><th>  75 Perzentil </th><th>  95 Perzentil </th></tr></thead><tbody><tr><td>  Cloudflare </td><td>  86.6 </td><td>  18s </td><td>  30er Jahre </td><td>  60er Jahre </td></tr><tr><td>  IPsec </td><td>  99,79 </td><td>  18s </td><td>  21s </td><td>  30er Jahre </td></tr><tr><td>  <b>Cen</b> </td><td>  <b>99,75</b> </td><td>  <b>16s</b> </td><td>  <b>21s</b> </td><td>  <b>27s</b> </td></tr></tbody></table></div><br><p>  Die Leistung ist etwas besser als bei IPSEC.  Über IPSEC können Sie jedoch möglicherweise mit einer Geschwindigkeit von 100 Mbit / s und über CEN nur mit einer Geschwindigkeit von 5 Mbit / s und teurer herunterladen. </p><br><p>  Hybrid bittet, richtig?  Kombinieren Sie IPSEC-Geschwindigkeit und CEN-Stabilität. </p><br><p>  Dies haben wir getan, indem wir im Falle eines IPSEC-Tunnelabsturzes Verkehr durch IPSEC und CEN gelassen haben.  Die Betriebszeit ist viel höher geworden, aber die Ladegeschwindigkeit der Site ist schlecht.  Dann habe ich alle Schemata gezeichnet, die wir bereits verwendet und getestet haben, und beschlossen, diesem Schema etwas mehr GCP hinzuzufügen, nämlich <strong>GLB</strong> . </p><br><h2 id="glb">  GLB </h2><br><p>  <strong>GLB</strong> ist der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Global Load Balancer</a> (oder Google Cloud Load Balancer).  Für uns hat dies einen wichtigen Vorteil: Im Zusammenhang mit CDN verfügt es über eine <strong>Anycast-IP</strong> , mit der Sie den Datenverkehr zum Rechenzentrum weiterleiten können, das dem Client am nächsten liegt. Dadurch gelangt der Datenverkehr schneller und weniger über das „normale“ Internet zum schnellen Google-Netzwerk. </p><br><p>  Ohne nachzudenken, haben wir <em>HTTP / HTTPS LB</em> auf GCP umgestellt und unsere virtuellen Maschinen mit Subfilter-Backend ausgestattet. </p><br><p>  Es gab mehrere Schemata: </p><br><ul><li>  Verwenden Sie <em>Cloudflare China Network</em> , aber dieses Mal gibt Origin die globale <strong>GLB-IP an</strong> . </li><li>  Beenden Sie Clients in <em>cn-shenzhen</em> und von dort aus den Proxy-Verkehr sofort an <strong>GLB</strong> . </li><li>  Fahren Sie direkt von China zum <strong>GLB</strong> . </li><li>  Beenden Sie Clients in <em>cn-shenzhen</em> , von dort über IPSEC nach <em>Asien-Ost1</em> (in US <em>-Ost4</em> über CEN), von dort zu GLB (ruhig, es wird unten ein Bild und eine Erklärung geben). </li></ul><br><p>  Wir haben alle diese und einige weitere Hybridoptionen getestet: </p><br><ul><li>  <strong>Cloudflare + GLB</strong> </li></ul><br><img src="https://habrastorage.org/webt/aa/-z/5c/aa-z5cpge5r_2qazfvcsvne5loi.png"><br><p>  Dieses Schema war nicht für Verfügbarkeits- und DNS-Fehler geeignet.  Der Test wurde jedoch durchgeführt, bevor der Fehler von CF behoben wurde. Vielleicht ist er jetzt besser (dies schließt jedoch HTTP-Zeitüberschreitungen nicht aus). </p><br><ul><li>  <strong>Ali + GLB</strong> </li></ul><br><img src="https://habrastorage.org/webt/mm/ef/id/mmefid6fj_5fwsbvtjwealb6wnu.png"><br><p>  Dieses Schema war auch für die Verfügbarkeit nicht geeignet, da GLB häufig aus dem Upstream ausfiel, da keine Verbindung zu einem akzeptablen Zeitpunkt oder Zeitlimit hergestellt werden konnte, da für einen Server innerhalb Chinas die GLB-Adresse außerhalb und daher hinter der chinesischen Firewall verbleibt.  Die Magie ist nicht passiert. </p><br><ul><li>  <strong>Nur GLB</strong> </li></ul><br><img src="https://habrastorage.org/webt/yg/l9/jc/ygl9jcr4ugsqil_ry6zf4kj4dhy.png"><br><p>  Eine Variante ähnlich der vorherigen, nur dass in China selbst keine Server verwendet wurden: Der Datenverkehr ging sofort an GLB (geänderte DNS-Einträge).  Dementsprechend waren die Ergebnisse nicht zufriedenstellend, da gewöhnliche chinesische Kunden, die die Dienste gewöhnlicher Internetanbieter nutzen, eine viel schlimmere Situation beim Durchlaufen der Firewall haben als Ali Cloud. </p><br><ul><li>  <strong>Shenzhen -&gt; (CEN / IPSEC) -&gt; Proxy -&gt; GLB</strong> </li></ul><br><img src="https://habrastorage.org/webt/9f/v_/lw/9fv_lwec8yi4-rmuubqypun5mas.png"><br><p>  Hier haben wir uns entschieden, die beste aller Lösungen zu verwenden: </p><br><ul><li>  Stabilität und garantierte SLA von CEN </li><li>  hohe Geschwindigkeit von IPSEC </li><li>  Googles "schnelles" Netzwerk und sein Anycast. </li></ul><br><p>  Das Schema sieht ungefähr so ​​aus: Der Benutzerverkehr wird auf einer virtuellen Maschine in <em>ch-shenzhen beendet</em> .  Dort werden Nginx-Upstream-Einstellungen konfiguriert, von denen sich einige auf private IP-Server am anderen Ende des IPSEC-Tunnels und einige Upstream-Verbindungen zu privaten Serveradressen auf der anderen Seite des CEN beziehen.  IPSEC wurde in GCP für die Region <em>Asien-Ost1</em> konfiguriert (es war zum Zeitpunkt der <em>Erstellung</em> der Lösung die Region, die China am nächsten lag. Jetzt ist GCP auch in Hongkong präsent).  CEN - in die <em>Region us-east1</em> in Ali Cloud. </p><br><p>  Darüber hinaus wurde der Datenverkehr von beiden <strong>Seiten</strong> an <strong>anycast IP GLB</strong> , <em>dh</em> an den nächstgelegenen Punkt der Google-Präsenz, geleitet und über seine Netzwerke in die <em>Region us-east4</em> in GCP geleitet, in der virtuelle Ersatzmaschinen (mit Subfilter in nginx) vorhanden waren. </p><br><p>  Diese Hybridlösung ermöglichte es uns erwartungsgemäß, jede Technologie zu nutzen.  Im Allgemeinen wird der Datenverkehr schnell durch IPSEC geleitet. Wenn jedoch Probleme auftreten, werfen wir diese Server schnell und für einige Minuten aus dem Upstream und senden den Datenverkehr nur über CEN, bis sich der Tunnel stabilisiert hat. </p><br><p>  Nachdem wir die vierte Lösung aus der obigen Liste implementiert hatten, erreichten wir, was wir wollten und was das Geschäft zu diesem Zeitpunkt von uns verlangte. </p><br><p>  Browser-Testergebnisse für die neue Lösung im Vergleich zu den vorherigen: </p><br><div class="scrollable-table"><table><thead><tr><th>  Lösung </th><th>  Betriebszeit </th><th>  Median </th><th>  75 Perzentil </th><th>  95 Perzentil </th></tr></thead><tbody><tr><td>  Cloudflare </td><td>  86.6 </td><td>  18s </td><td>  30er Jahre </td><td>  60er Jahre </td></tr><tr><td>  IPsec </td><td>  99,79 </td><td>  18s </td><td>  21s </td><td>  30er Jahre </td></tr><tr><td>  Cen </td><td>  99,75 </td><td>  16s </td><td>  21s </td><td>  27s </td></tr><tr><td>  <strong>CEN / IPsec + GLB</strong> </td><td>  <strong>99,79</strong> </td><td>  <strong>13s</strong> </td><td>  <strong>16s</strong> </td><td>  <strong>25s</strong> </td></tr></tbody></table></div><br><h2 id="cdn">  Cdn </h2><br><p>  In der von uns implementierten Lösung ist alles in Ordnung, aber es gibt kein CDN, das den Verkehr auf der Ebene von Regionen und sogar Städten beschleunigen könnte.  Theoretisch sollte dies die Site für Endbenutzer durch die Verwendung schneller Kommunikationskanäle des CDN-Anbieters beschleunigen.  Und wir haben die ganze Zeit darüber nachgedacht.  Und jetzt ist die Zeit für die nächste Iteration des Projekts gekommen: Suchen und Testen von CDN-Anbietern in China. </p><br><p>  Und ich werde dir im nächsten, letzten Teil davon erzählen :) </p><br><h3 id="vse-chasti">  Alle Teile </h3><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Teil 1</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Teil 3</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de458840/">https://habr.com/ru/post/de458840/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de458828/index.html">Warum, warum und wann ValueTask verwendet werden soll</a></li>
<li><a href="../de458830/index.html">Dell Technologies-Webinare: Alle Details unseres Tutorials</a></li>
<li><a href="../de458832/index.html">Fünf Studenten und drei verteilte Schlüsselwertspeicher</a></li>
<li><a href="../de458834/index.html">Seite der Persönlichkeit von Paul Allen, von der nicht so viele Menschen wussten, wie ich möchte</a></li>
<li><a href="../de458836/index.html">Borsch Index. Ein systematischer Ansatz zur Bewertung, zum Vergleich und zur Bestimmung des Preis-Leistungs-Verhältnisses</a></li>
<li><a href="../de458842/index.html">Geduld und Arbeit werden den gesamten Text extrahieren</a></li>
<li><a href="../de458844/index.html">Silozerstörung durch VeriSM ™ -Anpassungsansatz</a></li>
<li><a href="../de458846/index.html">So entwickeln Sie mit Unity einen weiteren Plattformer. Ein weiteres Tutorial</a></li>
<li><a href="../de458848/index.html">Rust 1.36.0 Release: Zukünftiges Merkmal, Allokationsstabilisierung und MaybeUninit <T></a></li>
<li><a href="../de458850/index.html">Lerne Englisch billig und effizient. Teil 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>