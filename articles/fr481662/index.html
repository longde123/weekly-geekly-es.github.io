<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§ó üî™ üå± Essayer de nouveaux outils pour cr√©er et automatiser le d√©ploiement dans Kubernetes üëßüèΩ üï∑Ô∏è ‚òÑÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Salut R√©cemment, de nombreux outils d'automatisation int√©ressants ont √©t√© publi√©s √† la fois pour la cr√©ation d'images Docker et pour le d√©ploiement su...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Essayer de nouveaux outils pour cr√©er et automatiser le d√©ploiement dans Kubernetes</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/481662/"><p><img src="https://habrastorage.org/webt/fu/wy/ia/fuwyia7huxrflvry8lzz2dbl2tw.png"></p><br><p>  Salut  R√©cemment, de nombreux outils d'automatisation int√©ressants ont √©t√© publi√©s √† la fois pour la cr√©ation d'images Docker et pour le d√©ploiement sur Kubernetes.  √Ä cet √©gard, j'ai d√©cid√© de jouer avec le gitlab, comment √©tudier ses capacit√©s et, bien s√ªr, configurer le pipeline. </p><br><p>  L'inspiration pour ce travail a √©t√© le site <a href="https://kubernetes.io/" rel="nofollow">kubernetes.io</a> , qui est g√©n√©r√© automatiquement √† partir des <a href="http://github.com/kubernetes/website" rel="nofollow">codes sources</a> , et pour chaque pool envoy√©, le robot g√©n√®re automatiquement une version d'aper√ßu du site avec vos modifications et fournit un lien pour la visualisation. </p><br><p>  J'ai essay√© de cr√©er un processus similaire √† partir de z√©ro, mais enti√®rement bas√© sur Gitlab CI et des outils gratuits que j'utilisais pour d√©ployer des applications dans Kubernetes.  Aujourd'hui, je vais enfin vous en dire plus √† leur sujet. </p><br><p>  L'article examinera des outils tels que: <br>  <strong>Hugo</strong> , <strong>qbec</strong> , <strong>kaniko</strong> , <strong>git-crypt</strong> et <strong>GitLab CI</strong> avec la cr√©ation d'environnements dynamiques. </p><a name="habracut"></a><br><hr><br><h1 id="coderzhanie">  Table des mati√®res </h1><br><ol><li>  <a href="https://habr.com/ru/post/481662/"><strong>Pr√©sentation de Hugo</strong></a> </li><li>  <a href="https://habr.com/ru/post/481662/"><strong>Pr√©paration de Dockerfile</strong></a> </li><li>  <a href="https://habr.com/ru/post/481662/"><strong>Connaissance de kaniko</strong></a> </li><li>  <a href="https://habr.com/ru/post/481662/"><strong>Pr√©sentation du qbec</strong></a> </li><li>  <a href="https://habr.com/ru/post/481662/"><strong>Essayer Gitlab-runner avec Kubernetes-executor</strong></a> </li><li>  <a href="https://habr.com/ru/post/481662/"><strong>D√©ploiement des cartes Helm avec qbec</strong></a> </li><li>  <a href="https://habr.com/ru/post/481662/"><strong>Pr√©sentation de git-crypt</strong></a> </li><li>  <a href="https://habr.com/ru/post/481662/"><strong>Cr√©er une image de bo√Æte √† outils</strong></a> </li><li>  <a href="https://habr.com/ru/post/481662/"><strong>Notre premier pipeline et assemblage d'images par tags</strong></a> </li><li>  <a href="https://habr.com/ru/post/481662/"><strong>Automatisation du d√©ploiement</strong></a> </li><li>  <a href="https://habr.com/ru/post/481662/"><strong>Artefacts et push build dans master</strong></a> </li><li>  <a href="https://habr.com/ru/post/481662/"><strong>Environnements dynamiques</strong></a> </li><li>  <a href="https://habr.com/ru/post/481662/"><strong>Examiner les applications</strong></a> </li></ol><br><hr><br><h1 id="1-znakomstvo-s-hugoanchorhugoanchor">  1. Pr√©sentation de Hugo <a name="hugo"></a></h1><br><p>  √Ä titre d'exemple de notre projet, nous allons essayer de cr√©er un site web pour publier de la documentation construite sur Hugo.  Hugo est un g√©n√©rateur de contenu statique. </p><br><p>  Pour ceux qui ne connaissent pas les g√©n√©rateurs statiques, je vais vous en dire un peu plus √† leur sujet.  Contrairement aux moteurs de sites de bases de donn√©es classiques et √† certains moteurs php qui, lorsqu'ils sont demand√©s par un utilisateur, g√©n√®rent des pages √† la vol√©e, les g√©n√©rateurs statiques sont organis√©s un peu diff√©remment.  Ils vous permettent de prendre la source, en r√®gle g√©n√©rale, il s'agit d'un ensemble de fichiers dans les mod√®les de balisage et de th√®me Markdown, puis de les compiler dans un site enti√®rement termin√©. </p><br><p>  Autrement dit, √† la sortie, vous obtiendrez une structure de r√©pertoires et un ensemble de fichiers HTML g√©n√©r√©s, qui peuvent √™tre simplement t√©l√©charg√©s sur n'importe quel h√©bergement bon march√© et obtenir un site de travail. </p><br><p>  Hugo peut √™tre install√© localement et l'essayer: </p><br><p>  Nous initialisons le nouveau site: </p><br><pre><code class="bash hljs">hugo new site docs.example.org</code> </pre> <br><p>  Et en m√™me temps le d√©p√¥t git: </p><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> docs.example.org git init</code> </pre> <br><p>  Jusqu'√† pr√©sent, notre site est vierge et pour que quelque chose y apparaisse d'abord, nous devons connecter un th√®me, un th√®me - c'est juste un ensemble de mod√®les et de r√®gles pr√©d√©finies par lesquelles notre site est g√©n√©r√©. </p><br><p>  Comme sujet, nous utiliserons <a href="https://themes.gohugo.io/hugo-theme-learn/" rel="nofollow"><strong>Learn</strong></a> , qui, √† mon avis, est le mieux adapt√© pour un site avec de la documentation. </p><br><p>  Je voudrais porter une attention particuli√®re au fait que nous n'avons pas besoin d'enregistrer les fichiers de th√®me dans le r√©f√©rentiel de notre projet, nous pouvons simplement le connecter en utilisant le <strong>sous</strong> - <strong>module git</strong> : </p><br><pre> <code class="bash hljs">git submodule add https://github.com/matcornic/hugo-theme-learn themes/learn</code> </pre> <br><p>  Ainsi, seuls les fichiers directement li√©s √† notre projet seront dans notre r√©f√©rentiel, et le sujet connect√© restera sous la forme d'un lien vers un r√©f√©rentiel sp√©cifique et s'y engagera, c'est-√†-dire qu'il peut toujours √™tre extrait de la source d'origine et ne pas avoir peur des modifications incompatibles. </p><br><p>  Corrigez la configuration <strong>config.toml</strong> : </p><br><pre> <code class="plaintext hljs">baseURL = "http://docs.example.org/" languageCode = "en-us" title = "My Docs Site" theme = "learn"</code> </pre> <br><p>  D√©j√† √† ce stade, vous pouvez ex√©cuter: </p><br><pre> <code class="bash hljs">hugo server</code> </pre> <br><p>  Et sur <a href="http://localhost:1313/" rel="nofollow">http: // localhost: 1313 /</a> consultez notre site nouvellement cr√©√©, toutes les modifications apport√©es au r√©pertoire sont automatiquement mises √† jour et la page ouverte dans le navigateur est tr√®s pratique! </p><br><p>  Essayons de cr√©er une page de garde dans <strong>content / _index.md</strong> : </p><br><pre> <code class="markdown hljs"><span class="hljs-section"><span class="hljs-section"># My docs site ## Welcome to the docs! You will be very smart :-)</span></span></code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Capture d'√©cran de la page nouvellement cr√©√©e</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/gb/yx/nv/gbyxnvagfs6bks4iqbwcrrovumu.png"></p></div></div><br><p>  Pour g√©n√©rer un site, lancez simplement: </p><br><pre> <code class="bash hljs">hugo</code> </pre> <br><p>  Le contenu du r√©pertoire <strong>public /</strong> sera votre site. <br>  Oui, au fait, ajoutons-le imm√©diatement √† <strong>.gitignore</strong> : </p><br><pre> <code class="plaintext hljs">echo /public &gt; .gitignore</code> </pre> <br><p>  N'oubliez pas de valider nos modifications: </p><br><pre> <code class="plaintext hljs">git add . git commit -m "New site created"</code> </pre> <br><hr><br><h1 id="2-podgotovka-dockerfileanchordockerfileanchor">  2. Pr√©paration du Dockerfile <a name="dockerfile"></a></h1><br><p>  Il est temps de d√©terminer la structure de notre r√©f√©rentiel.  Habituellement, j'utilise quelque chose comme: </p><br><pre> <code class="plaintext hljs">. ‚îú‚îÄ‚îÄ deploy ‚îÇ ‚îú‚îÄ‚îÄ app1 ‚îÇ ‚îî‚îÄ‚îÄ app2 ‚îî‚îÄ‚îÄ dockerfiles ‚îú‚îÄ‚îÄ image1 ‚îî‚îÄ‚îÄ image2</code> </pre> <br><ul><li>  <strong>dockerfiles /</strong> - contient des r√©pertoires avec Dockerfiles et tout ce dont vous avez besoin pour construire nos images de docker. </li><li>  <strong>deploy /</strong> - contient des r√©pertoires pour d√©ployer nos applications sur Kubernetes </li></ul><br><p>  Ainsi, nous allons cr√©er notre premier Dockerfile le long du chemin <strong>dockerfiles / website / Dockerfile</strong> </p><br><pre> <code class="bash hljs">FROM alpine:3.11 as builder ARG HUGO_VERSION=0.62.0 RUN wget -O- https://github.com/gohugoio/hugo/releases/download/v<span class="hljs-variable"><span class="hljs-variable">${HUGO_VERSION}</span></span>/hugo_<span class="hljs-variable"><span class="hljs-variable">${HUGO_VERSION}</span></span>_linux-64bit.tar.gz | tar -xz -C /usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/bin ADD . /src RUN hugo -s /src FROM alpine:3.11 RUN apk add --no-cache darkhttpd COPY --from=builder /src/public /var/www ENTRYPOINT [ <span class="hljs-string"><span class="hljs-string">"/usr/bin/darkhttpd"</span></span> ] CMD [ <span class="hljs-string"><span class="hljs-string">"/var/www"</span></span> ]</code> </pre> <br><p>  Comme vous pouvez le voir, le Dockerfile contient deux FROM, cette fonctionnalit√© est appel√©e construction en <a href="https://docs.docker.com/develop/develop-images/multistage-build/" rel="nofollow"><strong>plusieurs √©tapes</strong></a> et vous permet d'exclure tout ce qui n'est pas n√©cessaire de l'image Docker finale. <br>  Ainsi, l'image finale ne contiendra que <strong>darkhttpd</strong> (un serveur HTTP l√©ger) et <strong>public /</strong> - le contenu de notre site g√©n√©r√© statiquement. </p><br><p>  N'oubliez pas de valider nos modifications: </p><br><pre> <code class="plaintext hljs">git add dockerfiles/website git commit -m "Add Dockerfile for website"</code> </pre> <br><hr><br><h1 id="3-znakomstvo-s-kanikoanchorkanikoanchor">  3. Connaissance de kaniko <a name="kaniko"></a></h1><br><p>  En tant que collectionneur d'images docker, j'ai d√©cid√© d'utiliser <strong><a href="https://github.com/GoogleContainerTools/kaniko" rel="nofollow">kaniko</a></strong> , car il ne n√©cessite pas de d√©mon docker pour fonctionner, et l'assemblage lui-m√™me peut √™tre effectu√© sur n'importe quelle machine et stocker le cache directement dans le registre, √©liminant le besoin d'avoir un stockage persistant complet . </p><br><p>  Pour construire l'image, il suffit de d√©marrer le conteneur avec <strong>kaniko executor</strong> et de lui passer le contexte de construction actuel, vous pouvez le faire localement, via docker: </p><br><pre> <code class="bash hljs">docker run -ti --rm \ -v <span class="hljs-variable"><span class="hljs-variable">$PWD</span></span>:/workspace \ -v ~/.docker/config.json:/kaniko/.docker/config.json:ro \ gcr.io/kaniko-project/executor:v0.15.0 \ --cache \ --dockerfile=dockerfiles/website/Dockerfile \ --destination=registry.gitlab.com/kvaps/docs.example.org/website:v0.0.1</code> </pre> <br><p>  Lorsque <strong>Registry.gitlab.com/kvaps/docs.example.org/website</strong> est le nom de votre image Docker, apr√®s l'assemblage, elle sera automatiquement ins√©r√©e dans le registre Docker. </p><br><p>  Le param√®tre <strong>--cache</strong> vous permet de mettre en cache les couches dans le registre docker, pour l'exemple donn√©, elles seront enregistr√©es dans <strong>Registry.gitlab.com/kvaps/docs.example.org/website/cache</strong> , mais vous pouvez sp√©cifier un autre chemin √† l'aide du param√®tre <strong>--cache- repo</strong> . </p><br><div class="spoiler">  <b class="spoiler_title">Screenshot docker-registry</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/0-/31/qx/0-31qxfta2gk7-colutf2l_qtmm.png"></p></div></div><br><hr><br><h1 id="4-znakomstvo-s-qbecanchorqbecanchor">  4. Connaissance du qbec <a name="qbec"></a></h1><br><p>  <a href="https://qbec.io/" rel="nofollow">Qbec</a> est un outil de d√©ploiement qui vous permet de d√©crire de mani√®re d√©clarative le manifeste de votre application et de le d√©ployer sur Kubernetes.  L'utilisation de Jsonnet comme syntaxe principale vous permet de simplifier consid√©rablement la description des diff√©rences pour plusieurs environnements, et √©limine √©galement presque compl√®tement la r√©p√©tabilit√© du code. </p><br><p>  Cela peut √™tre particuli√®rement vrai dans les cas o√π vous devez d√©ployer une application dans plusieurs clusters avec diff√©rents param√®tres et que vous souhaitez les d√©crire de mani√®re d√©clarative dans Git. </p><br><p>  Qbec vous permet √©galement de rendre des graphiques Helm en leur transmettant les param√®tres n√©cessaires et en les faisant ensuite fonctionner ainsi que des manifestes r√©guliers, y compris diverses mutations qui peuvent leur √™tre appliqu√©es, ce qui, √† son tour, √©limine la n√©cessit√© d'utiliser le ChartMuseum.  Autrement dit, vous pouvez stocker et rendre des graphiques directement √† partir de git, o√π ils ont la place. </p><br><p>  Comme je l'ai d√©j√† dit, nous allons stocker tous les d√©ploiements dans le r√©pertoire <strong>deploy /</strong> : </p><br><pre> <code class="bash hljs">mkdir deploy <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> deploy</code> </pre> <br><p>  Initialisons notre premi√®re application: </p><br><pre> <code class="bash hljs">qbec init website <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> website</code> </pre> <br><p>  Maintenant, la structure de notre application ressemble √† ceci: </p><br><pre> <code class="plaintext hljs">. ‚îú‚îÄ‚îÄ components ‚îú‚îÄ‚îÄ environments ‚îÇ  ‚îú‚îÄ‚îÄ base.libsonnet ‚îÇ  ‚îî‚îÄ‚îÄ default.libsonnet ‚îú‚îÄ‚îÄ params.libsonnet ‚îî‚îÄ‚îÄ qbec.yaml</code> </pre> <br><p>  regardez le fichier <strong>qbec.yaml</strong> : </p><br><pre> <code class="plaintext hljs">apiVersion: qbec.io/v1alpha1 kind: App metadata: name: website spec: environments: default: defaultNamespace: docs server: https://kubernetes.example.org:8443 vars: {}</code> </pre> <br><p>  Ici, nous nous int√©ressons principalement aux <strong>environnements sp√©cifiques</strong> , qbec a d√©j√† cr√©√© un environnement par d√©faut pour nous et a pris l'adresse du serveur, ainsi que l'espace de noms de notre kubeconfig actuel. <br>  D√©sormais, lors du d√©ploiement dans l'environnement <strong>par d√©faut</strong> , qbec ne sera toujours d√©ploy√© que sur le cluster Kubernetes sp√©cifi√© et sur l'espace de noms sp√©cifi√©, c'est-√†-dire que vous n'aurez plus √† basculer entre les contextes et les espaces de noms pour effectuer un d√©ploiement. <br>  Si n√©cessaire, vous pouvez toujours mettre √† jour les param√®tres de ce fichier. </p><br><p>  Tous vos environnements sont d√©crits dans <strong>qbec.yaml</strong> et dans le fichier <strong>params.libsonnet</strong> , o√π il indique o√π vous devez prendre les param√®tres pour eux. </p><br><p>  Ensuite, nous voyons deux r√©pertoires: </p><br><ul><li>  <strong>composants /</strong> - tous les manifestes pour notre application seront stock√©s ici, ils peuvent √™tre d√©crits √† la fois dans jsonnet et dans des fichiers yaml ordinaires </li><li>  <strong>environnements /</strong> - nous d√©crirons ici toutes les variables (param√®tres) de nos environnements. </li></ul><br><p>  Par d√©faut, nous avons deux fichiers: </p><br><ul><li>  <strong>environnements / base.libsonnet</strong> - il contiendra des param√®tres g√©n√©raux pour tous les environnements </li><li>  <strong>environnements / default.libsonnet</strong> - contient les param√®tres remplac√©s pour l'environnement <strong>par d√©faut</strong> </li></ul><br><p>  Ouvrons <strong>environnement / base.libsonnet</strong> et ajoutons-y les param√®tres de notre premier composant: </p><br><pre> <code class="javascript hljs">{ <span class="hljs-attr"><span class="hljs-attr">components</span></span>: { <span class="hljs-attr"><span class="hljs-attr">website</span></span>: { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'example-docs'</span></span>, <span class="hljs-attr"><span class="hljs-attr">image</span></span>: <span class="hljs-string"><span class="hljs-string">'registry.gitlab.com/kvaps/docs.example.org/website:v0.0.1'</span></span>, <span class="hljs-attr"><span class="hljs-attr">replicas</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">containerPort</span></span>: <span class="hljs-number"><span class="hljs-number">80</span></span>, <span class="hljs-attr"><span class="hljs-attr">servicePort</span></span>: <span class="hljs-number"><span class="hljs-number">80</span></span>, <span class="hljs-attr"><span class="hljs-attr">nodeSelector</span></span>: {}, <span class="hljs-attr"><span class="hljs-attr">tolerations</span></span>: [], <span class="hljs-attr"><span class="hljs-attr">ingressClass</span></span>: <span class="hljs-string"><span class="hljs-string">'nginx'</span></span>, <span class="hljs-attr"><span class="hljs-attr">domain</span></span>: <span class="hljs-string"><span class="hljs-string">'docs.example.org'</span></span>, }, }, }</code> </pre> <br><p>  Nous allons √©galement cr√©er notre premier <strong>composant / website.jsonnet</strong> : </p><br><pre> <code class="javascript hljs">local env = { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: std.extVar(<span class="hljs-string"><span class="hljs-string">'qbec.io/env'</span></span>), <span class="hljs-attr"><span class="hljs-attr">namespace</span></span>: std.extVar(<span class="hljs-string"><span class="hljs-string">'qbec.io/defaultNs'</span></span>), }; local p = <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">'../params.libsonnet'</span></span>; local params = p.components.website; [ { <span class="hljs-attr"><span class="hljs-attr">apiVersion</span></span>: <span class="hljs-string"><span class="hljs-string">'apps/v1'</span></span>, <span class="hljs-attr"><span class="hljs-attr">kind</span></span>: <span class="hljs-string"><span class="hljs-string">'Deployment'</span></span>, <span class="hljs-attr"><span class="hljs-attr">metadata</span></span>: { <span class="hljs-attr"><span class="hljs-attr">labels</span></span>: { <span class="hljs-attr"><span class="hljs-attr">app</span></span>: params.name }, <span class="hljs-attr"><span class="hljs-attr">name</span></span>: params.name, }, <span class="hljs-attr"><span class="hljs-attr">spec</span></span>: { <span class="hljs-attr"><span class="hljs-attr">replicas</span></span>: params.replicas, <span class="hljs-attr"><span class="hljs-attr">selector</span></span>: { <span class="hljs-attr"><span class="hljs-attr">matchLabels</span></span>: { <span class="hljs-attr"><span class="hljs-attr">app</span></span>: params.name, }, }, <span class="hljs-attr"><span class="hljs-attr">template</span></span>: { <span class="hljs-attr"><span class="hljs-attr">metadata</span></span>: { <span class="hljs-attr"><span class="hljs-attr">labels</span></span>: { <span class="hljs-attr"><span class="hljs-attr">app</span></span>: params.name }, }, <span class="hljs-attr"><span class="hljs-attr">spec</span></span>: { <span class="hljs-attr"><span class="hljs-attr">containers</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'darkhttpd'</span></span>, <span class="hljs-attr"><span class="hljs-attr">image</span></span>: params.image, <span class="hljs-attr"><span class="hljs-attr">ports</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">containerPort</span></span>: params.containerPort, }, ], }, ], <span class="hljs-attr"><span class="hljs-attr">nodeSelector</span></span>: params.nodeSelector, <span class="hljs-attr"><span class="hljs-attr">tolerations</span></span>: params.tolerations, <span class="hljs-attr"><span class="hljs-attr">imagePullSecrets</span></span>: [{ <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'regsecret'</span></span> }], }, }, }, }, { <span class="hljs-attr"><span class="hljs-attr">apiVersion</span></span>: <span class="hljs-string"><span class="hljs-string">'v1'</span></span>, <span class="hljs-attr"><span class="hljs-attr">kind</span></span>: <span class="hljs-string"><span class="hljs-string">'Service'</span></span>, <span class="hljs-attr"><span class="hljs-attr">metadata</span></span>: { <span class="hljs-attr"><span class="hljs-attr">labels</span></span>: { <span class="hljs-attr"><span class="hljs-attr">app</span></span>: params.name }, <span class="hljs-attr"><span class="hljs-attr">name</span></span>: params.name, }, <span class="hljs-attr"><span class="hljs-attr">spec</span></span>: { <span class="hljs-attr"><span class="hljs-attr">selector</span></span>: { <span class="hljs-attr"><span class="hljs-attr">app</span></span>: params.name, }, <span class="hljs-attr"><span class="hljs-attr">ports</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">port</span></span>: params.servicePort, <span class="hljs-attr"><span class="hljs-attr">targetPort</span></span>: params.containerPort, }, ], }, }, { <span class="hljs-attr"><span class="hljs-attr">apiVersion</span></span>: <span class="hljs-string"><span class="hljs-string">'extensions/v1beta1'</span></span>, <span class="hljs-attr"><span class="hljs-attr">kind</span></span>: <span class="hljs-string"><span class="hljs-string">'Ingress'</span></span>, <span class="hljs-attr"><span class="hljs-attr">metadata</span></span>: { <span class="hljs-attr"><span class="hljs-attr">annotations</span></span>: { <span class="hljs-string"><span class="hljs-string">'kubernetes.io/ingress.class'</span></span>: params.ingressClass, }, <span class="hljs-attr"><span class="hljs-attr">labels</span></span>: { <span class="hljs-attr"><span class="hljs-attr">app</span></span>: params.name }, <span class="hljs-attr"><span class="hljs-attr">name</span></span>: params.name, }, <span class="hljs-attr"><span class="hljs-attr">spec</span></span>: { <span class="hljs-attr"><span class="hljs-attr">rules</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">host</span></span>: params.domain, <span class="hljs-attr"><span class="hljs-attr">http</span></span>: { <span class="hljs-attr"><span class="hljs-attr">paths</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">backend</span></span>: { <span class="hljs-attr"><span class="hljs-attr">serviceName</span></span>: params.name, <span class="hljs-attr"><span class="hljs-attr">servicePort</span></span>: params.servicePort, }, }, ], }, }, ], }, }, ]</code> </pre> <br><p>  Dans ce fichier, nous avons imm√©diatement d√©crit trois entit√©s Kubernetes, √† savoir: <strong>D√©ploiement</strong> , <strong>Service</strong> et <strong>Ingress</strong> .  Si vous le souhaitez, nous pourrions les transporter dans diff√©rents composants, mais √† ce stade, un suffit pour nous. </p><br><p>  La syntaxe <strong>jsonnet est</strong> tr√®s similaire √† json standard, en principe json standard est d√©j√† un jsonnet valide, donc au d√©but il pourrait √™tre plus facile d'utiliser des services en ligne comme <strong>yaml2json</strong> pour convertir votre yaml habituel en json, ou si vos composants ne contiennent aucune variable, alors ils peuvent √™tre d√©crits sous forme de yaml ordinaire. </p><br><blockquote>  Lorsque vous travaillez avec <strong>jsonnet, je</strong> recommande fortement d'installer un plugin pour votre √©diteur <br><br>  Par exemple, pour vim, il existe un <strong>plugin vim-jsonnet</strong> qui active la coloration syntaxique et ex√©cute automatiquement <strong>jsonnet fmt</strong> chaque fois qu'il est enregistr√© (n√©cessite l'installation de jsonnet). </blockquote><p>  Tout est pr√™t, nous pouvons maintenant commencer le d√©ploiement: </p><br><p>  Pour voir ce qui s'est pass√©, nous allons faire: </p><br><pre> <code class="bash hljs">qbec show default</code> </pre> <br><p>  En sortie, vous verrez des manifestes yaml rendus qui seront appliqu√©s au cluster par d√©faut. </p><br><p>  Ok, appliquez maintenant: </p><br><pre> <code class="bash hljs">qbec apply default</code> </pre> <br><p>  √Ä la sortie, vous verrez toujours ce qui se fera dans votre grappe, qbec vous demandera d'accepter les modifications, en tapant <strong>y</strong> vous pourrez confirmer vos intentions. </p><br><p>  Termin√©, maintenant notre application est ancr√©e! </p><br><p>  Si vous apportez des modifications, vous pouvez toujours: </p><br><pre> <code class="bash hljs">qbec diff default</code> </pre> <br><p>  pour voir comment ces changements affecteront le d√©ploiement actuel </p><br><p>  N'oubliez pas de valider nos modifications: </p><br><pre> <code class="plaintext hljs">cd ../.. git add deploy/website git commit -m "Add deploy for website"</code> </pre> <br><hr><br><h1 id="5-probuem-gitlab-runner-s-kubernetes-executoranchorgitlab-runneranchor">  5. Essayer Gitlab-runner avec Kubernetes-executor <a name="gitlab-runner"></a></h1><br><p>  Jusqu'√† r√©cemment, je n'utilisais que le <strong>gitlab-runner</strong> habituel sur une machine pr√©-pr√©par√©e (conteneur LXC) avec un shell ou un docker-executor.  Initialement, nous avions plusieurs de ces coureurs d√©finis globalement dans notre hitlab.  Ils ont collect√© des images de docker pour tous les projets. </p><br><p>  Mais comme la pratique l'a montr√©, cette option n'est pas la plus id√©ale, tant en termes de praticit√© qu'en termes de s√©curit√©.  Il est beaucoup mieux et id√©ologiquement plus correct de d√©ployer des coureurs s√©par√©s pour chaque projet, et m√™me pour chaque environnement. </p><br><p>  Heureusement, ce n'est pas un probl√®me du tout, car nous allons maintenant d√©ployer <strong>gitlab-runner</strong> directement dans le cadre de notre projet directement sur Kubernetes. </p><br><p>  Gitlab fournit un graphique de barre pr√™t √† l'emploi pour le d√©ploiement de gitlab-runner dans Kubernetes.  Ainsi, tout ce que vous avez √† faire est de trouver le <strong>jeton d'enregistrement</strong> de notre projet dans <strong>Param√®tres -&gt; CI / CD -&gt; Runners</strong> et de lui passer la barre: </p><br><pre> <code class="bash hljs">helm repo add gitlab https://charts.gitlab.io helm install gitlab-runner \ --<span class="hljs-built_in"><span class="hljs-built_in">set</span></span> gitlabUrl=https://gitlab.com \ --<span class="hljs-built_in"><span class="hljs-built_in">set</span></span> runnerRegistrationToken=yga8y-jdCusVDn_t4Wxc \ --<span class="hljs-built_in"><span class="hljs-built_in">set</span></span> rbac.create=<span class="hljs-literal"><span class="hljs-literal">true</span></span> \ gitlab/gitlab-runner</code> </pre> <br><p>  O√π: </p><br><ul><li>  <strong><a href="https://gitlab.com/" rel="nofollow">https://gitlab.com</a></strong> est l'adresse de votre serveur Gitlab. </li><li>  <strong>yga8y-jdCusVDn_t4Wxc</strong> - jeton d'enregistrement pour votre projet. </li><li>  <strong>rbac.create = true</strong> - Donne au coureur le nombre de privil√®ges requis pour pouvoir cr√©er des pods pour effectuer nos t√¢ches en utilisant l'ex√©cuteur kubernetes. </li></ul><br><p>  Si tout est fait correctement, vous devriez voir le coureur enregistr√© dans la section <strong>Coureurs</strong> , dans les param√®tres de votre projet. </p><br><div class="spoiler">  <b class="spoiler_title">Capture d'√©cran du coureur ajout√©</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/at/lx/g_/atlxg_u6rjn4n0pkcpn8--2gare.png"></p></div></div><br><p>  C'est aussi simple que √ßa?  - oui, si simple!  Plus de tracas avec l'enregistrement manuel des coureurs, d√©sormais les coureurs seront cr√©√©s et d√©truits automatiquement. </p><br><hr><br><h1 id="6-deploy-helm-chartov-s-qbecanchorqbec-helmanchor">  6. D√©ploiement des cartes Helm avec QBEC <a name="qbec-helm"></a></h1><br><p>  Puisque nous avons d√©cid√© de consid√©rer <strong>gitlab-runner comme</strong> faisant partie de notre projet, il est temps de le d√©crire dans notre r√©f√©rentiel Git. </p><br><p>  Nous pourrions le d√©crire comme un composant distinct du <strong>site Web</strong> , mais √† l'avenir, nous pr√©voyons de d√©ployer tr√®s souvent diff√©rentes copies du <strong>site Web</strong> , contrairement √† <strong>gitlab-runner</strong> , qui ne sera d√©ploy√© qu'une seule fois pour chaque cluster Kubernetes.  Alors initialisons une application distincte pour cela: </p><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> deploy qbec init gitlab-runner <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> gitlab-runner</code> </pre> <br><p>  Cette fois, nous ne d√©crirons pas les entit√©s Kubernetes manuellement, mais prenons un graphique Helm pr√™t √† l'emploi.  L'un des avantages de qbec est la possibilit√© de rendre les graphiques Helm directement √† partir du r√©f√©rentiel Git. </p><br><p>  Branchez-le √† l'aide du sous-module git: </p><br><pre> <code class="bash hljs">git submodule add https://gitlab.com/gitlab-org/charts/gitlab-runner vendor/gitlab-runner</code> </pre> <br><p>  Maintenant, le <strong>r√©pertoire vendor / gitlab-runner</strong> contient notre r√©f√©rentiel avec un graphique pour gitlab-runner. </p><br><blockquote>  De m√™me, vous pouvez connecter d'autres r√©f√©rentiels, par exemple, l'ensemble du r√©f√©rentiel avec les graphiques officiels <strong><a href="https://github.com/helm/charts" rel="nofollow">https://github.com/helm/charts</a></strong> </blockquote><p>  <strong>D√©crivons</strong> le <strong>composant components / gitlab-runner.jsonnet</strong> : </p><br><pre> <code class="javascript hljs">local env = { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: std.extVar(<span class="hljs-string"><span class="hljs-string">'qbec.io/env'</span></span>), <span class="hljs-attr"><span class="hljs-attr">namespace</span></span>: std.extVar(<span class="hljs-string"><span class="hljs-string">'qbec.io/defaultNs'</span></span>), }; local p = <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">'../params.libsonnet'</span></span>; local params = p.components.gitlabRunner; std.native(<span class="hljs-string"><span class="hljs-string">'expandHelmTemplate'</span></span>)( <span class="hljs-string"><span class="hljs-string">'../vendor/gitlab-runner'</span></span>, params.values, { <span class="hljs-attr"><span class="hljs-attr">nameTemplate</span></span>: params.name, <span class="hljs-attr"><span class="hljs-attr">namespace</span></span>: env.namespace, <span class="hljs-attr"><span class="hljs-attr">thisFile</span></span>: std.thisFile, <span class="hljs-attr"><span class="hljs-attr">verbose</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, } )</code> </pre> <br><p>  Le premier argument pour <strong>expandHelmTemplate</strong> nous passons le chemin vers le graphique, puis <strong>params.values</strong> , que nous prenons des param√®tres d'environnement, puis un objet avec </p><br><ul><li>  <strong>nameTemplate</strong> - nom de la version </li><li>  <strong>namespace</strong> - namespace pass√© √† la barre </li><li>  <strong>thisFile</strong> - param√®tre obligatoire transmettant le chemin d'acc√®s au fichier actuel </li><li>  <strong>verbeux</strong> - affiche la <strong>commande de mod√®le de barre</strong> avec tous les arguments lors du rendu du graphique </li></ul><br><p>  Nous allons maintenant d√©crire les param√®tres de notre composant dans <strong>environnements / base.libsonnet</strong> : </p><br><pre> <code class="javascript hljs">local secrets = <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">'../secrets/base.libsonnet'</span></span>; { <span class="hljs-attr"><span class="hljs-attr">components</span></span>: { <span class="hljs-attr"><span class="hljs-attr">gitlabRunner</span></span>: { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'gitlab-runner'</span></span>, <span class="hljs-attr"><span class="hljs-attr">values</span></span>: { <span class="hljs-attr"><span class="hljs-attr">gitlabUrl</span></span>: <span class="hljs-string"><span class="hljs-string">'https://gitlab.com/'</span></span>, <span class="hljs-attr"><span class="hljs-attr">rbac</span></span>: { <span class="hljs-attr"><span class="hljs-attr">create</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, }, <span class="hljs-attr"><span class="hljs-attr">runnerRegistrationToken</span></span>: secrets.runnerRegistrationToken, }, }, }, }</code> </pre> <br><p>  Faites attention √† <strong>runnerRegistrationToken que</strong> nous prenons du <strong>fichier</strong> externe <strong>secrets / base.libsonnet</strong> , cr√©ons-le: </p><br><pre> <code class="javascript hljs">{ <span class="hljs-attr"><span class="hljs-attr">runnerRegistrationToken</span></span>: <span class="hljs-string"><span class="hljs-string">'yga8y-jdCusVDn_t4Wxc'</span></span>, }</code> </pre> <br><p>  V√©rifiez si tout fonctionne: </p><br><pre> <code class="bash hljs">qbec show default</code> </pre> <br><p>  si tout est en ordre, nous pouvons supprimer notre version ant√©rieure via la version Helm: </p><br><pre> <code class="bash hljs">helm uninstall gitlab-runner</code> </pre> <br><p>  et le d√©ployer, mais d√©j√† via qbec: </p><br><pre> <code class="bash hljs">qbec apply default</code> </pre> <br><hr><br><h1 id="7-znakomstvo-s-git-cryptanchorgit-cryptanchor">  7. Pr√©sentation de git-crypt <a name="git-crypt"></a></h1><br><p>  <strong><a href="https://github.com/AGWA/git-crypt" rel="nofollow">Git-crypt</a></strong> est un outil qui vous permet de configurer un cryptage transparent pour votre r√©f√©rentiel. </p><br><p>  Pour le moment, la structure de notre r√©pertoire pour gitlab-runner ressemble √† ceci: </p><br><pre> <code class="plaintext hljs">. ‚îú‚îÄ‚îÄ components ‚îÇ  ‚îú‚îÄ‚îÄ gitlab-runner.jsonnet ‚îú‚îÄ‚îÄ environments ‚îÇ  ‚îú‚îÄ‚îÄ base.libsonnet ‚îÇ  ‚îî‚îÄ‚îÄ default.libsonnet ‚îú‚îÄ‚îÄ params.libsonnet ‚îú‚îÄ‚îÄ qbec.yaml ‚îú‚îÄ‚îÄ secrets ‚îÇ  ‚îî‚îÄ‚îÄ base.libsonnet ‚îî‚îÄ‚îÄ vendor ‚îî‚îÄ‚îÄ gitlab-runner (submodule)</code> </pre> <br><p>  Mais garder des secrets dans Git n'est pas s√ªr, n'est-ce pas?  Nous devons donc les chiffrer correctement. </p><br><blockquote>  Habituellement, pour le bien d'une seule variable, cela n'a pas toujours de sens.  Vous pouvez transmettre des secrets √† <strong>qbec</strong> et via les variables d'environnement de votre syst√®me CI. <br>  Mais il convient de noter qu'il existe des projets plus complexes qui peuvent contenir beaucoup plus de secrets; il sera extr√™mement difficile de les transf√©rer tous via des variables d'environnement. <br><br>  De plus, dans ce cas, je ne serais pas en mesure de vous parler d'un outil aussi merveilleux que <strong>git-crypt</strong> . <br><br>  <strong>git-crypt est</strong> √©galement pratique car il vous permet de sauvegarder l'historique complet des secrets, ainsi que de comparer, de fusionner et de r√©soudre les conflits de la m√™me mani√®re que nous le faisions dans le cas de Git. </blockquote><p>  Tout d'abord, apr√®s avoir install√© <strong>git-crypt,</strong> nous devons g√©n√©rer des cl√©s pour notre r√©f√©rentiel: </p><br><pre> <code class="plaintext hljs">git crypt init</code> </pre> <br><p>  Si vous avez une cl√© PGP, vous pouvez imm√©diatement vous ajouter en tant que collaborateur pour ce projet: </p><br><pre> <code class="plaintext hljs">git-crypt add-gpg-user kvapss@gmail.com</code> </pre> <br><p>  Ainsi, vous pouvez toujours d√©crypter ce r√©f√©rentiel √† l'aide de votre cl√© priv√©e. </p><br><p>  Si vous n'avez pas de cl√© PGP et que vous n'√™tes pas attendu, vous pouvez alors aller dans l'autre sens et exporter la cl√© de projet: </p><br><pre> <code class="plaintext hljs">git crypt export-key /path/to/keyfile</code> </pre> <br><p>  De cette fa√ßon, toute personne poss√©dant un <strong>fichier de cl√©s</strong> export√© pourra d√©crypter votre r√©f√©rentiel. </p><br><p>  Il est temps de mettre en place notre premier secret. <br>  Permettez-moi de vous rappeler que nous sommes toujours dans le <strong>r√©pertoire deploy / gitlab-runner /</strong> , o√π nous avons le r√©pertoire <strong>secrets /, chiffrons</strong> tous les fichiers qu'il <strong>contient</strong> , pour cela nous cr√©ons le <strong>fichier secrets / .gitattributes</strong> avec le contenu suivant: </p><br><pre> <code class="plaintext hljs">* filter=git-crypt diff=git-crypt .gitattributes !filter !diff</code> </pre> <br><p>  Comme vous pouvez le voir dans le contenu, tous les fichiers par mask <strong>*</strong> seront ex√©cut√©s via <strong>git-crypt</strong> , √† l'exception de <strong>.gitattributes</strong> lui-m√™me </p><br><p>  Nous pouvons le v√©rifier en ex√©cutant: </p><br><pre> <code class="bash hljs">git crypt status -e</code> </pre> <br><p>  √Ä la sortie, nous obtenons une liste de tous les fichiers du r√©f√©rentiel pour lesquels le cryptage est activ√© </p><br><p>  C'est tout, maintenant nous pouvons valider nos modifications en toute s√©curit√©: </p><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ../.. git add . git commit -m <span class="hljs-string"><span class="hljs-string">"Add deploy for gitlab-runner"</span></span></code> </pre> <br><p>  Pour bloquer le r√©f√©rentiel, faites simplement: </p><br><pre> <code class="bash hljs">git crypt lock</code> </pre> <br><p>  et puis tous les fichiers crypt√©s se transforment en quelque chose de binaire, il sera impossible de les lire. <br>  Pour d√©crypter un r√©f√©rentiel, proc√©dez comme suit: </p><br><pre> <code class="bash hljs">git crypt unlock</code> </pre> <br><hr><br><h1 id="8-sozdayom-toolbox-obrazanchortoolboxanchor">  8. Cr√©ez une image de bo√Æte √† outils <a name="toolbox"></a></h1><br><p>  Une image de bo√Æte √† outils est une telle image avec tous les outils que nous utiliserons pour d√©ployer notre projet.  Il sera utilis√© par le runner gitlab pour effectuer des t√¢ches de d√©ploiement typiques. </p><br><p>  Ici, tout est simple, nous cr√©ons un nouveau <strong>dockerfiles / toolbox / Dockerfile</strong> avec le contenu suivant: </p><br><pre> <code class="bash hljs">FROM alpine:3.11 RUN apk add --no-cache git git-crypt RUN QBEC_VER=0.10.3 \ &amp;&amp; wget -O- https://github.com/splunk/qbec/releases/download/v<span class="hljs-variable"><span class="hljs-variable">${QBEC_VER}</span></span>/qbec-linux-amd64.tar.gz \ | tar -C /tmp -xzf - \ &amp;&amp; mv /tmp/qbec /tmp/jsonnet-qbec /usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/bin/ RUN KUBECTL_VER=1.17.0 \ &amp;&amp; wget -O /usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/bin/kubectl \ https://storage.googleapis.com/kubernetes-release/release/v<span class="hljs-variable"><span class="hljs-variable">${KUBECTL_VER}</span></span>/bin/linux/amd64/kubectl \ &amp;&amp; chmod +x /usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/bin/kubectl RUN HELM_VER=3.0.2 \ &amp;&amp; wget -O- https://get.helm.sh/helm-v<span class="hljs-variable"><span class="hljs-variable">${HELM_VER}</span></span>-linux-amd64.tar.gz \ | tar -C /tmp -zxf - \ &amp;&amp; mv /tmp/linux-amd64/helm /usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/bin/helm</code> </pre> <br><p>  Comme vous pouvez le voir, dans cette image, nous installons tous les utilitaires que nous avons utilis√©s pour d√©ployer notre application.  Nous n'avons pas besoin de <strong>kubectl ici</strong> , mais vous voudrez peut-√™tre jouer avec lui lors de la configuration du pipeline. </p><br><p>  De plus, afin de pouvoir communiquer avec Kubernetes et y effectuer un d√©ploiement, nous devons configurer le r√¥le des pods g√©n√©r√©s par gitlab-runner. </p><br><p>  Pour ce faire, allez dans le r√©pertoire avec gitlab-runner: </p><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> deploy/gitlab-runner</code> </pre> <br><p>  et ajoutez un nouveau composant <strong>components / rbac.jsonnet</strong> : </p><br><pre> <code class="javascript hljs">local env = { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: std.extVar(<span class="hljs-string"><span class="hljs-string">'qbec.io/env'</span></span>), <span class="hljs-attr"><span class="hljs-attr">namespace</span></span>: std.extVar(<span class="hljs-string"><span class="hljs-string">'qbec.io/defaultNs'</span></span>), }; local p = <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">'../params.libsonnet'</span></span>; local params = p.components.rbac; [ { <span class="hljs-attr"><span class="hljs-attr">apiVersion</span></span>: <span class="hljs-string"><span class="hljs-string">'v1'</span></span>, <span class="hljs-attr"><span class="hljs-attr">kind</span></span>: <span class="hljs-string"><span class="hljs-string">'ServiceAccount'</span></span>, <span class="hljs-attr"><span class="hljs-attr">metadata</span></span>: { <span class="hljs-attr"><span class="hljs-attr">labels</span></span>: { <span class="hljs-attr"><span class="hljs-attr">app</span></span>: params.name, }, <span class="hljs-attr"><span class="hljs-attr">name</span></span>: params.name, }, }, { <span class="hljs-attr"><span class="hljs-attr">apiVersion</span></span>: <span class="hljs-string"><span class="hljs-string">'rbac.authorization.k8s.io/v1'</span></span>, <span class="hljs-attr"><span class="hljs-attr">kind</span></span>: <span class="hljs-string"><span class="hljs-string">'Role'</span></span>, <span class="hljs-attr"><span class="hljs-attr">metadata</span></span>: { <span class="hljs-attr"><span class="hljs-attr">labels</span></span>: { <span class="hljs-attr"><span class="hljs-attr">app</span></span>: params.name, }, <span class="hljs-attr"><span class="hljs-attr">name</span></span>: params.name, }, <span class="hljs-attr"><span class="hljs-attr">rules</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">apiGroups</span></span>: [ <span class="hljs-string"><span class="hljs-string">'*'</span></span>, ], <span class="hljs-attr"><span class="hljs-attr">resources</span></span>: [ <span class="hljs-string"><span class="hljs-string">'*'</span></span>, ], <span class="hljs-attr"><span class="hljs-attr">verbs</span></span>: [ <span class="hljs-string"><span class="hljs-string">'*'</span></span>, ], }, ], }, { <span class="hljs-attr"><span class="hljs-attr">apiVersion</span></span>: <span class="hljs-string"><span class="hljs-string">'rbac.authorization.k8s.io/v1'</span></span>, <span class="hljs-attr"><span class="hljs-attr">kind</span></span>: <span class="hljs-string"><span class="hljs-string">'RoleBinding'</span></span>, <span class="hljs-attr"><span class="hljs-attr">metadata</span></span>: { <span class="hljs-attr"><span class="hljs-attr">labels</span></span>: { <span class="hljs-attr"><span class="hljs-attr">app</span></span>: params.name, }, <span class="hljs-attr"><span class="hljs-attr">name</span></span>: params.name, }, <span class="hljs-attr"><span class="hljs-attr">roleRef</span></span>: { <span class="hljs-attr"><span class="hljs-attr">apiGroup</span></span>: <span class="hljs-string"><span class="hljs-string">'rbac.authorization.k8s.io'</span></span>, <span class="hljs-attr"><span class="hljs-attr">kind</span></span>: <span class="hljs-string"><span class="hljs-string">'Role'</span></span>, <span class="hljs-attr"><span class="hljs-attr">name</span></span>: params.name, }, <span class="hljs-attr"><span class="hljs-attr">subjects</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">kind</span></span>: <span class="hljs-string"><span class="hljs-string">'ServiceAccount'</span></span>, <span class="hljs-attr"><span class="hljs-attr">name</span></span>: params.name, <span class="hljs-attr"><span class="hljs-attr">namespace</span></span>: env.namespace, }, ], }, ]</code> </pre> <br><p>  Nous d√©crirons √©galement les nouveaux param√®tres dans <strong>environnements / base.libsonnet</strong> , qui ressemble maintenant √† ceci: </p><br><pre> <code class="javascript hljs">local secrets = <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">'../secrets/base.libsonnet'</span></span>; { <span class="hljs-attr"><span class="hljs-attr">components</span></span>: { <span class="hljs-attr"><span class="hljs-attr">gitlabRunner</span></span>: { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'gitlab-runner'</span></span>, <span class="hljs-attr"><span class="hljs-attr">values</span></span>: { <span class="hljs-attr"><span class="hljs-attr">gitlabUrl</span></span>: <span class="hljs-string"><span class="hljs-string">'https://gitlab.com/'</span></span>, <span class="hljs-attr"><span class="hljs-attr">rbac</span></span>: { <span class="hljs-attr"><span class="hljs-attr">create</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, }, <span class="hljs-attr"><span class="hljs-attr">runnerRegistrationToken</span></span>: secrets.runnerRegistrationToken, <span class="hljs-attr"><span class="hljs-attr">runners</span></span>: { <span class="hljs-attr"><span class="hljs-attr">serviceAccountName</span></span>: $.components.rbac.name, <span class="hljs-attr"><span class="hljs-attr">image</span></span>: <span class="hljs-string"><span class="hljs-string">'registry.gitlab.com/kvaps/docs.example.org/toolbox:v0.0.1'</span></span>, }, }, }, <span class="hljs-attr"><span class="hljs-attr">rbac</span></span>: { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'gitlab-runner-deploy'</span></span>, }, }, }</code> </pre> <br><p>  Remarque <strong>$ .components.rbac.name</strong> fait r√©f√©rence au <strong>nom</strong> du composant <strong>rbac</strong> </p><br><p>  V√©rifions ce qui a chang√©: </p><br><pre> <code class="bash hljs">qbec diff default</code> </pre> <br><p>  et appliquer nos modifications √† Kubernetes: </p><br><pre> <code class="bash hljs">qbec apply default</code> </pre> <br><p>  N'oubliez pas non plus de valider nos modifications dans git: </p><br><pre> <code class="plaintext hljs">cd ../.. git add dockerfiles/toolbox git commit -m "Add Dockerfile for toolbox" git add deploy/gitlab-runner git commit -m "Configure gitlab-runner to use toolbox"</code> </pre> <br><hr><br><h1 id="9-nash-pervyy-payplayn-i-sborka-obrazov-po-tegamanchorpipeline-buildanchor">  9. Notre premier pipeline et assemblage d'images par tags <a name="pipeline-build"></a></h1><br><p>  √Ä la racine du projet, nous cr√©erons <strong>.gitlab-ci.yml</strong> avec le contenu suivant: </p><br><pre> <code class="plaintext hljs">.build_docker_image: stage: build image: name: gcr.io/kaniko-project/executor:debug-v0.15.0 entrypoint: [""] before_script: - echo "{\"auths\":{\"$CI_REGISTRY\":{\"username\":\"$CI_REGISTRY_USER\",\"password\":\"$CI_REGISTRY_PASSWORD\"}}}" &gt; /kaniko/.docker/config.json build_toolbox: extends: .build_docker_image script: - /kaniko/executor --cache --context $CI_PROJECT_DIR/dockerfiles/toolbox --dockerfile $CI_PROJECT_DIR/dockerfiles/toolbox/Dockerfile --destination $CI_REGISTRY_IMAGE/toolbox:$CI_COMMIT_TAG only: refs: - tags build_website: extends: .build_docker_image variables: GIT_SUBMODULE_STRATEGY: normal script: - /kaniko/executor --cache --context $CI_PROJECT_DIR --dockerfile $CI_PROJECT_DIR/dockerfiles/website/Dockerfile --destination $CI_REGISTRY_IMAGE/website:$CI_COMMIT_TAG only: refs: - tags</code> </pre> <br><p>  Veuillez noter que nous utilisons <strong>GIT_SUBMODULE_STRATEGY: normal</strong> pour les travaux o√π vous devez initialiser explicitement les sous-modules avant l'ex√©cution. </p><br><p>  N'oubliez pas de valider nos modifications: </p><br><pre> <code class="plaintext hljs">git add .gitlab-ci.yml git commit -m "Automate docker build"</code> </pre> <br><p>  Je pense que vous pouvez l'appeler en toute s√©curit√© la version <strong>v0.0.1</strong> et accrocher une balise: </p><br><pre> <code class="bash hljs">git tag v0.0.1</code> </pre> <br><p>  Nous accrocherons les balises chaque fois que nous aurons besoin de publier une nouvelle version.  Les balises dans les images Docker seront li√©es aux balises Git.  Chaque pouss√©e avec une nouvelle balise initialisera l'assemblage d'images avec cette balise. </p><br><p>  Ex√©cutez <strong>git push --tags</strong> et regardez notre premier pipeline: </p><br><div class="spoiler">  <b class="spoiler_title">Capture d'√©cran du premier pipeline</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/5u/ce/fg/5ucefgejcfjz7jpwvou206mwufy.png"></p></div></div><br><blockquote>  Il convient de pr√™ter votre attention au fait que l'assemblage par balises convient √† l'assemblage d'images Docker, mais ne convient pas au d√©ploiement d'une application dans Kubernetes.  √âtant donn√© que de nouvelles balises peuvent √©galement √™tre affect√©es √† d'anciennes validations, dans ce cas, l'initialisation du pipeline pour elles entra√Ænera le d√©ploiement de l'ancienne version. <br><br>  Pour r√©soudre ce probl√®me, g√©n√©ralement l'assemblage d'images docker est attach√© √† des balises et le d√©ploiement de l'application √† la branche principale, dans laquelle les versions des images collect√©es sont cod√©es en dur.  C'est dans ce cas que vous pouvez initialiser la restauration avec une simple balise <strong>ma√Ætre de</strong> restauration. </blockquote><br><hr><br><h1 id="10-avtomatizaciya-deployaanchorpipeline-deployanchor">  10. Automatisation du d√©ploiement <a name="pipeline-deploy"></a></h1><br><p>  Pour que Gitlab-runner d√©chiffre nos secrets, nous devons exporter la cl√© du r√©f√©rentiel et l'ajouter aux variables d'environnement de notre CI: </p><br><pre> <code class="plaintext hljs">git crypt export-key /tmp/docs-repo.key base64 -w0 /tmp/docs-repo.key; echo</code> </pre> <br><p>  enregistrez la cha√Æne r√©sultante dans Gitlab, pour cela nous allons aller dans les param√®tres de notre projet: <br>  <strong>Param√®tres -&gt; CI / CD -&gt; Variables</strong> </p><br><p>    : </p><br><div class="scrollable-table"><table><thead><tr><th>  Tapez </th><th>  Cl√© </th><th> Value </th><th> Protected </th><th> Masked </th><th> Scope </th></tr></thead><tbody><tr><td> <code>File</code> </td> <td> <code>GITCRYPT_KEY</code> </td> <td> <code>&lt;your string&gt;</code> </td> <td> <code>true</code> <em>(     <code>false</code> )</em> </td><td> <code>true</code> </td> <td> <code>All environments</code> </td> </tr></tbody></table></div><br><div class="spoiler"> <b class="spoiler_title">  </b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/vj/li/ea/vjliealfwwsmiy4-nvjfvcf89ig.png"></p></div></div><br><p>    <strong>.gitlab-ci.yml</strong>   : </p><br><pre> <code class="plaintext hljs">.deploy_qbec_app: stage: deploy only: refs: - master deploy_gitlab_runner: extends: .deploy_qbec_app variables: GIT_SUBMODULE_STRATEGY: normal before_script: - base64 -d "$GITCRYPT_KEY" | git-crypt unlock - script: - qbec apply default --root deploy/gitlab-runner --force:k8s-context __incluster__ --wait --yes deploy_website: extends: .deploy_qbec_app script: - qbec apply default --root deploy/website --force:k8s-context __incluster__ --wait --yes</code> </pre> <br><p>        qbec: </p><br><ul><li> <strong>--root some/app</strong> ‚Äî      </li><li> <strong>--force:k8s-context __incluster__</strong> ‚Äî   ,             gtilab-runner.   ,      qbec     Kubernetes-   kubeconfig </li><li> <strong>--wait</strong> ‚Äî  qbec ,        Ready       exit-code. </li><li> <strong>--yes</strong> ‚Äî     <strong>Are you sure?</strong>  . </li></ul><br><p>     : </p><br><pre> <code class="plaintext hljs">git add .gitlab-ci.yml git commit -m "Automate deploy"</code> </pre> <br><p>   <strong>git push</strong>       : </p><br><div class="spoiler"> <b class="spoiler_title">  </b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/0p/aj/vs/0pajvs-a-lrxvfuw8zylnj6lleg.png"></p></div></div><br><hr><br><h1 id="11-artefakty-i-sborka-pri-push-v-masteranchorartifactsanchor"> 11.     push  master <a name="artifacts"></a></h1><br><p>            ,             .           digest  master-. </p><br><p>  :    <strong>website</strong>      push  <strong>master</strong> ,       Kubernetes. </p><br><p>        <strong>.gitlab-ci.yml</strong> : </p><br><pre> <code class="plaintext hljs">build_website: extends: .build_docker_image variables: GIT_SUBMODULE_STRATEGY: normal script: - mkdir -p $CI_PROJECT_DIR/artifacts - /kaniko/executor --cache --context $CI_PROJECT_DIR --dockerfile $CI_PROJECT_DIR/dockerfiles/website/Dockerfile --destination $CI_REGISTRY_IMAGE/website:$CI_COMMIT_REF_NAME --digest-file $CI_PROJECT_DIR/artifacts/website.digest artifacts: paths: - artifacts/ only: refs: - master - tags deploy_website: extends: .deploy_qbec_app script: - DIGEST="$(cat artifacts/website.digest)" - qbec apply default --root deploy/website --force:k8s-context __incluster__ --wait --yes --vm:ext-str digest="$DIGEST"</code> </pre> <br><p>  ,    <strong>master</strong>  <strong>refs</strong>   <strong>build_website</strong>     <strong>$CI_COMMIT_REF_NAME</strong>  <strong>$CI_COMMIT_TAG</strong> ,        Git           .  ,        ,           docker-registry. </p><br><p>   docker-       ,        Kubernetes,           ,         . </p><br><p>  <strong>--vm:ext-str digest="$DIGEST"</strong>  qbec ‚Äî      jsonnet.            .   ,     ,     ,               . </p><br><p>     Kaniko  digest    ( <strong>--digest-file</strong> ) <br>          . </p><br><p>     <strong>deploy/website/environments/base.libsonnet</strong>     : </p><br><pre> <code class="javascript hljs">{ <span class="hljs-attr"><span class="hljs-attr">components</span></span>: { <span class="hljs-attr"><span class="hljs-attr">website</span></span>: { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'example-docs'</span></span>, <span class="hljs-attr"><span class="hljs-attr">image</span></span>: <span class="hljs-string"><span class="hljs-string">'registry.gitlab.com/kvaps/docs.example.org/website@'</span></span> + std.extVar(<span class="hljs-string"><span class="hljs-string">'digest'</span></span>), <span class="hljs-attr"><span class="hljs-attr">replicas</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">containerPort</span></span>: <span class="hljs-number"><span class="hljs-number">80</span></span>, <span class="hljs-attr"><span class="hljs-attr">servicePort</span></span>: <span class="hljs-number"><span class="hljs-number">80</span></span>, <span class="hljs-attr"><span class="hljs-attr">nodeSelector</span></span>: {}, <span class="hljs-attr"><span class="hljs-attr">tolerations</span></span>: [], <span class="hljs-attr"><span class="hljs-attr">ingressClass</span></span>: <span class="hljs-string"><span class="hljs-string">'nginx'</span></span>, <span class="hljs-attr"><span class="hljs-attr">domain</span></span>: <span class="hljs-string"><span class="hljs-string">'docs.example.org'</span></span>, }, }, }</code> </pre> <br><p> ,     <strong>master</strong>   docker-  <strong>website</strong> ,      Kubernetes. </p><br><p>     : </p><br><pre> <code class="bash hljs">git add . git commit -m <span class="hljs-string"><span class="hljs-string">"Configure dynamic build"</span></span></code> </pre> <br><p> ,  <strong>git push</strong>    - : </p><br><div class="spoiler"> <b class="spoiler_title">   master</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/7_/ry/nh/7_rynh5lgu_8hqnnl_gasx73zwq.png"></p></div></div><br><p>       gitlab-runner   push, , ,      ,     <strong>.gitlab-ci.yml</strong> : </p><br><pre> <code class="plaintext hljs">deploy_gitlab_runner: extends: .deploy_qbec_app variables: GIT_SUBMODULE_STRATEGY: normal before_script: - base64 -d "$GITCRYPT_KEY" | git-crypt unlock - script: - qbec apply default --root deploy/gitlab-runner --force:k8s-context __incluster__ --wait --yes only: changes: - deploy/gitlab-runner/**/*</code> </pre> <br><p> <strong>changes</strong>      <strong>deploy/gitlab-runner/</strong>          </p><br><p>     : </p><br><pre> <code class="bash hljs">git add .gitlab-ci.yml git commit -m <span class="hljs-string"><span class="hljs-string">"Reduce gitlab-runner deploy"</span></span></code> </pre> <br><p> <strong>git push</strong> , - : </p><br><div class="spoiler"> <b class="spoiler_title">  </b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/-t/9b/3m/-t9b3mtofbunu7xfogpmb0pacsm.png"></p></div></div><br><hr><br><h1 id="12-dynamic-environmentsanchordynamic-environmentsanchor"> 12. Dynamic environments <a name="dynamic-environments"></a></h1><br><p>       . </p><br><p>     <strong>build_website</strong>   <strong>.gitlab-ci.yml</strong> ,     <strong>only</strong> ,   Gitlab        : </p><br><pre> <code class="plaintext hljs">build_website: extends: .build_docker_image variables: GIT_SUBMODULE_STRATEGY: normal script: - mkdir -p $CI_PROJECT_DIR/artifacts - /kaniko/executor --cache --context $CI_PROJECT_DIR --dockerfile $CI_PROJECT_DIR/dockerfiles/website/Dockerfile --destination $CI_REGISTRY_IMAGE/website:$CI_COMMIT_REF_NAME --digest-file $CI_PROJECT_DIR/artifacts/website.digest artifacts: paths: - artifacts/</code> </pre> <br><p>    <strong>deploy_website</strong> ,    <strong>environment</strong> : </p><br><pre> <code class="plaintext hljs">deploy_website: extends: .deploy_qbec_app environment: name: prod url: https://docs.example.org script: - DIGEST="$(cat artifacts/website.digest)" - qbec apply default --root deploy/website --force:k8s-context __incluster__ --wait --yes --vm:ext-str digest="$DIGEST"</code> </pre> <br><p>   Gitlab    <strong>prod</strong>       . </p><br><p>     : </p><br><pre> <code class="plaintext hljs">deploy_website: extends: .deploy_qbec_app environment: name: prod url: https://docs.example.org script: - DIGEST="$(cat artifacts/website.digest)" - qbec apply default --root deploy/website --force:k8s-context __incluster__ --wait --yes --vm:ext-str digest="$DIGEST" deploy_review: extends: .deploy_qbec_app environment: name: review/$CI_COMMIT_REF_NAME url: http://$CI_ENVIRONMENT_SLUG.docs.example.org on_stop: stop_review script: - DIGEST="$(cat artifacts/website.digest)" - qbec apply review --root deploy/website --force:k8s-context __incluster__ --wait --yes --vm:ext-str digest="$DIGEST" --vm:ext-str subdomain="$CI_ENVIRONMENT_SLUG" --app-tag "$CI_ENVIRONMENT_SLUG" only: refs: - branches except: refs: - master stop_review: extends: .deploy_qbec_app environment: name: review/$CI_COMMIT_REF_NAME action: stop stage: deploy before_script: - git clone "$CI_REPOSITORY_URL" master - cd master script: - qbec delete review --root deploy/website --force:k8s-context __incluster__ --yes --vm:ext-str digest="$DIGEST" --vm:ext-str subdomain="$CI_ENVIRONMENT_SLUG" --app-tag "$CI_ENVIRONMENT_SLUG" variables: GIT_STRATEGY: none only: refs: - branches except: refs: - master when: manual</code> </pre> <br><p>     push     master    preview  . </p><br><p>      qbec: <strong>--app-tag</strong> ‚Äî             ,       Kubernetes qbec    . <br>           review,       . </p><br><p>      <strong>qbec apply review</strong> ,  <strong>qbec apply default</strong> ‚Äî               (review  default): </p><br><p>  <strong>review</strong>   <strong>deploy/website/qbec.yaml</strong> </p><br><pre> <code class="plaintext hljs">spec: environments: review: defaultNamespace: docs server: https://kubernetes.example.org:8443</code> </pre> <br><p>     <strong>deploy/website/params.libsonnet</strong> : </p><br><pre> <code class="javascript hljs">local env = std.extVar(<span class="hljs-string"><span class="hljs-string">'qbec.io/env'</span></span>); local paramsMap = { <span class="hljs-attr"><span class="hljs-attr">_</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">'./environments/base.libsonnet'</span></span>, <span class="hljs-attr"><span class="hljs-attr">default</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">'./environments/default.libsonnet'</span></span>, <span class="hljs-attr"><span class="hljs-attr">review</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">'./environments/review.libsonnet'</span></span>, }; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> std.objectHas(paramsMap, env) then paramsMap[env] <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> error <span class="hljs-string"><span class="hljs-string">'environment '</span></span> + env + <span class="hljs-string"><span class="hljs-string">' not defined in '</span></span> + std.thisFile</code> </pre> <br><p>        <strong>deploy/website/environments/review.libsonnet</strong> : </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// this file has the param overrides for the default environment local base = import './base.libsonnet'; local slug = std.extVar('qbec.io/tag'); local subdomain = std.extVar('subdomain'); base { components+: { website+: { name: 'example-docs-' + slug, domain: subdomain + '.docs.example.org', }, }, }</span></span></code> </pre> <br><p>       <strong>stop_review</strong> ,         gitlab    checkout    <strong>GIT_STRATEGY: none</strong> ,    <strong>master</strong> -   review  . <br>  ,        . <br>       review   ,     . </p><br><p>     : </p><br><pre> <code class="plaintext hljs">git add . git commit -m "Enable automatic review"</code> </pre> <br><p> <strong>git push</strong> , <strong>git checkout -b test</strong> , <strong>git push origin test</strong> , : </p><br><div class="spoiler"> <b class="spoiler_title">  environments  Gitlab</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/wc/pz/ce/wcpzcedcwgfqvr0h_thgcw4ylqk.png"></p></div></div><br><p>  ? ‚Äî ,    : <strong>git checkout master</strong> , <strong>git push origin :test</strong> ,      environment   . </p><br><blockquote>    ,        ,     <strong>.gitlab-ci.yml</strong>       . <br>          protected-,   <strong>master</strong> ,        . </blockquote><br><hr><br><h1 id="13-review-appsanchorreview-appsanchor"> 13. Review Apps <a name="review-apps"></a></h1><br><p> <strong><a href="https://docs.gitlab.com/ee/ci/review_apps/" rel="nofollow">Review Apps</a></strong>    ,                . </p><br><p>      ,    <strong>.gitlab/route-map.yml</strong>       ,       : </p><br><pre> <code class="plaintext hljs"># Indices - source: /content\/(.+?)_index\.(md|html)/ public: '\1' # Pages - source: /content\/(.+?)\.(md|html)/ public: '\1/'</code> </pre> <br><p>     : </p><br><pre> <code class="plaintext hljs">git add .gitlab/ git commit -m "Enable review apps"</code> </pre> <br><p> <strong>git push</strong> ,  : </p><br><div class="spoiler"> <b class="spoiler_title">  Review App</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/ns/wi/za/nswizajvjjozyoluazo21pzq7t8.png"></p></div></div><br><h1 id="job-is-done"> Job is done! </h1><br><p> <strong> :</strong> </p><br><ul><li>  Gitlab: <a href="" rel="nofollow">https://gitlab.com/kvaps/docs.example.org</a> </li><li>  GitHub: <a href="" rel="nofollow">https://github.com/kvaps/docs.example.org</a> </li></ul><br><p>   ,    <img src="https://habrastorage.org/getpro/habr/post_images/cd7/2c7/9c3/cd72c79c3eeb7355e20bba58e9088654.gif" alt="image"></p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr481662/">https://habr.com/ru/post/fr481662/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr481644/index.html">Comment survivre √† une base de donn√©es SQL au 21e si√®cle: Cloud, Kubernetes et PostgreSQL multimaster</a></li>
<li><a href="../fr481648/index.html">Junos PyEZ sur l'exemple de la t√¢che de trouver des sous-r√©seaux ipv4 gratuits</a></li>
<li><a href="../fr481652/index.html">Backdoor (?) Sur les smartphones BlackBerry Android</a></li>
<li><a href="../fr481654/index.html">L'histoire de la fa√ßon dont l'ing√©nieur QA vous a simplifi√© la vie avec l'aide de Test IT, en utilisant le Bot Framework</a></li>
<li><a href="../fr481656/index.html">PagerDuty, ou pourquoi le service des op√©rations peut ne pas dormir la nuit</a></li>
<li><a href="../fr481664/index.html">Prix ‚Äã‚Äãet co√ªts sans serveur: AWS Lambda</a></li>
<li><a href="../fr481666/index.html">R√®gles SwiftLint personnalis√©es</a></li>
<li><a href="../fr481668/index.html">Le premier probl√®me de visionneuse ou les difficult√©s de conversion des flux vid√©o WebRTC en HLS</a></li>
<li><a href="../fr481670/index.html">Cr√©er un plan d'action √† l'aide de AWS Cloud Adoption Framework</a></li>
<li><a href="../fr481672/index.html">Automates cellulaires dans le navigateur</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>