<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üò´ üîç üî≠ Test de configuration pour les d√©veloppeurs Java: exp√©rience pratique üë©üèæ‚Äçüé® üë©üèæ‚Äçü§ù‚Äçüë©üèª üòû</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Avec les tests du code, tout est clair (enfin, au moins le fait qu'ils doivent √™tre √©crits). Avec les tests de configuration, tout est beaucoup moins ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Test de configuration pour les d√©veloppeurs Java: exp√©rience pratique</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jugru/blog/427487/"><img src="https://habrastorage.org/webt/9o/r3/24/9or324raqccmfaeghrlyaagxmja.jpeg"><br><br>  Avec les tests du code, tout est clair (enfin, au moins le fait qu'ils doivent √™tre √©crits).  Avec les tests de configuration, tout est beaucoup moins √©vident, √† commencer par leur existence m√™me.  Quelqu'un les √©crit-il?  Est-ce important?  C'est dur?  Quels types de r√©sultats peuvent √™tre obtenus avec leur aide? <br><br>  Il s'av√®re que cela est √©galement tr√®s utile, commencer √† le faire est tr√®s simple, et en m√™me temps, il existe de nombreuses nuances dans le test de la configuration.  Lesquelles - peintes sous la coupe en fonction de l'exp√©rience pratique. <br><a name="habracut"></a><br>  <i>Le mat√©riel est bas√© sur une transcription d'un rapport de <b>Ruslan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">cheremin</a> Cheremin</b> (d√©veloppeur Java √† la Deutsche Bank).</i>  <i>Vient ensuite le discours √† la premi√®re personne.</i> <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/Tk_nmV-mWOA" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Je m'appelle Ruslan, je travaille pour la Deutsche Bank.  Nous commen√ßons par ceci: <br><br><img src="https://habrastorage.org/webt/vg/xr/rq/vgxrrqh1taa98cujjske1r5usa4.jpeg"><br><br>  Il y a beaucoup de texte, de loin il peut sembler qu'il est russe.  Mais ce n'est pas vrai.  C'est une langue tr√®s ancienne et dangereuse.  J'ai fait une traduction en russe simple: <br><br><ul><li>  Tous les personnages sont constitu√©s </li><li>  √Ä utiliser avec prudence </li><li>  Fun√©railles √† ses frais </li></ul><br><br>  Je d√©crirai bri√®vement de quoi je vais parler aujourd'hui.  Supposons que nous ayons un code: <br><br><img src="https://habrastorage.org/webt/qv/ip/gd/qvipgdp4a8n1bjo79z29aicqmik.jpeg"><br><br>  Autrement dit, au d√©part, nous avions une sorte de t√¢che, nous √©crivons un code pour le r√©soudre, et cela nous rapporte soi-disant de l'argent.  Si pour une raison quelconque, ce code ne fonctionne pas correctement, il r√©sout la mauvaise t√¢che et nous rapporte le mauvais argent.  Les entreprises n'aiment pas ce genre d'argent - elles semblent mauvaises dans les √©tats financiers. <br><br>  Par cons√©quent, pour notre code important, nous avons des tests: <br><br><img src="https://habrastorage.org/webt/0e/9g/-k/0e9g-klbunmtoyvlhf9q0-vl-4o.jpeg"><br><br>  Habituellement l√†.  Maintenant, probablement, presque tout le monde l'a.  Les tests v√©rifient que le code r√©sout le bon probl√®me et fait le bon argent.  Mais le service n'est pas limit√© au code, et √† c√¥t√© du code il y a aussi une configuration: <br><br><img src="https://habrastorage.org/webt/z7/75/sq/z775sqxlsy1nha5hrclznn6biq0.jpeg"><br><br>  Au moins dans presque tous les projets auxquels j'ai particip√©, cette configuration √©tait, sous une forme ou une autre.  (Je ne me souviens que de quelques cas de mes premi√®res ann√©es d'interface utilisateur, o√π il n'y avait pas de fichiers de configuration, mais tout a √©t√© configur√© via l'interface utilisateur). Dans cette configuration, il y a des ports, des adresses et des param√®tres d'algorithme. <br><br><h2>  Pourquoi la configuration est-elle importante √† tester? </h2><br>  Voici l'astuce: les erreurs dans la configuration nuisent √† l'ex√©cution du programme pas moins que les erreurs dans le code.  Eux aussi peuvent provoquer l'ex√©cution incorrecte du code - et voir ci-dessus. <br><br>  Et trouver des erreurs dans la configuration est encore plus difficile que dans le code, car la configuration ne se compile g√©n√©ralement pas.  J'ai cit√© les propri√©t√©s-fichiers √† titre d'exemple, en g√©n√©ral, il existe diff√©rentes options (JSON, XML, quelqu'un stocke dans YAML), mais il est important que rien de tout cela ne soit compil√© et, par cons√©quent, ne soit pas v√©rifi√©.  Si vous avez accidentellement scell√© un fichier Java - tr√®s probablement, il ne passera tout simplement pas la compilation.  Une faute de frappe al√©atoire dans la propri√©t√© n'excitera personne, elle fonctionnera. <br><br>  Et l'IDE ne met pas non plus en √©vidence l'erreur dans la configuration, car il ne conna√Æt que les plus primitifs sur le format (par exemple) des fichiers de propri√©t√©s: qu'il doit y avoir une cl√© et une valeur, et entre eux est "√©gal", deux points ou un espace.  Mais le fait que la valeur doit √™tre un nombre, un port r√©seau ou une adresse - l'IDE ne sait rien. <br><br>  Et m√™me si vous testez l'application dans un UAT ou dans un environnement de transfert, cela ne garantit rien non plus.  Parce que la configuration, en r√®gle g√©n√©rale, dans chaque environnement est diff√©rente, et dans l'UAT, vous avez uniquement test√© la configuration UAT. <br><br>  Une autre subtilit√© est que m√™me en production, les erreurs de configuration n'apparaissent parfois pas imm√©diatement.  Un service peut ne pas d√©marrer du tout - et c'est un bon sc√©nario.  Mais il peut d√©marrer et fonctionner tr√®s longtemps - jusqu'au moment X, o√π il faudra exactement le param√®tre dans lequel l'erreur.  Et ici, vous constatez qu'un service qui n'a m√™me pas beaucoup chang√© r√©cemment a soudainement cess√© de fonctionner. <br><br>  Apr√®s tout ce que j'ai dit - il semblerait que le test des configurations devrait √™tre un sujet br√ªlant.  Mais en pratique, cela ressemble √† ceci: <br><br><img src="https://habrastorage.org/webt/9o/r3/24/9or324raqccmfaeghrlyaagxmja.jpeg"><br><br>  C'√©tait du moins le cas pour nous - jusqu'√† un certain point.  Et l'une des t√¢ches de mon rapport est de cesser de ressembler √† ceci pour vous aussi.  J'esp√®re que je pourrai vous pousser √† cela. <br><br>  Il y a trois ans dans notre Deutsche Bank, dans mon √©quipe, Andrei Satarin a travaill√© en tant que responsable QA.  C'est lui qui a donn√© l'id√©e de tester les configurations - c'est-√†-dire qu'il a simplement pris et commis le premier test de ce type.  Il y a six mois, lors du pr√©c√©dent Heisenbug, il a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">parl√©</a> de tester la configuration telle qu'il la voit.  Je vous recommande de regarder, car l√†, il a donn√© un large aper√ßu du probl√®me: √† la fois du c√¥t√© des articles scientifiques et de l'exp√©rience des grandes entreprises qui ont rencontr√© des erreurs de configuration et leurs cons√©quences. <br><br>  Mon rapport sera plus √©troit - sur l'exp√©rience pratique.  Je parlerai des probl√®mes que j'ai rencontr√©s en tant que d√©veloppeur lorsque j'ai √©crit des tests de configuration et comment j'ai r√©solu ces probl√®mes.  Mes d√©cisions peuvent ne pas √™tre les meilleures d√©cisions, ce ne sont pas les meilleures pratiques - c'est mon exp√©rience personnelle, j'ai essay√© de ne pas faire de g√©n√©ralisations g√©n√©rales. <br><br>  Aper√ßu g√©n√©ral du rapport: <br><br><ul><li>  ¬´Ce que vous pouvez faire avant le lundi apr√®s-midi¬ª: exemples simples et utiles. </li><li>  ¬´Lundi, deux ans plus tard¬ª: o√π et comment faire mieux. </li><li>  Prise en charge de la refactorisation de la configuration: comment obtenir une couverture dense;  mod√®le de configuration logicielle. </li></ul><br><br>  La premi√®re partie est motivante: je d√©crirai les tests les plus simples avec lesquels tout a commenc√© avec nous.  Il y aura une grande vari√©t√© d'exemples.  J'esp√®re qu'au moins l'un d'entre eux r√©sonne avec vous, c'est-√†-dire que vous verrez une sorte de probl√®me similaire et sa solution. <br><br>  Les tests eux-m√™mes dans la premi√®re partie sont simples, voire primitifs - d'un point de vue technique, il n'y a pas de science de fus√©e.  Mais le simple fait qu'elles puissent √™tre faites rapidement est particuli√®rement pr√©cieux.  Il s'agit d'une ¬´entr√©e facile¬ª dans les tests de configuration, et c'est important car il y a une barri√®re psychologique √† l'√©criture de ces tests.  Et je veux montrer que "vous pouvez le faire": maintenant, nous l'avons fait, cela a bien fonctionn√© pour nous, et bien que personne ne soit mort, nous vivons depuis trois ans maintenant. <br><br>  La deuxi√®me partie concerne ce qu'il faut faire apr√®s.  Lorsque vous avez √©crit de nombreux tests simples, la question du support se pose.  Certains d'entre eux commencent √† tomber, vous comprenez les erreurs qu'ils auraient mises en √©vidence.  Il s'av√®re que ce n'est pas toujours pratique.  Et la question se pose d'√©crire des tests plus complexes - apr√®s tout, vous avez d√©j√† couvert des cas simples, je veux quelque chose de plus int√©ressant.  Et l√† encore, il n'y a pas de meilleures pratiques, je vais simplement d√©crire certaines des solutions qui ont fonctionn√© pour nous. <br><br>  La troisi√®me partie concerne la fa√ßon dont les tests peuvent prendre en charge la refactorisation d'une configuration plut√¥t complexe et d√©routante.  Encore une fois, √©tude de cas - comment nous l'avons fait.  De mon point de vue, c'est un exemple de la fa√ßon dont les tests de configuration peuvent √™tre mis √† l'√©chelle pour r√©soudre des t√¢ches plus importantes, et pas seulement pour boucher de petits trous. <br><br><h2>  Partie 1. ¬´Vous pouvez le faire comme √ßa¬ª </h2><br>  Il est maintenant difficile de comprendre quel √©tait le premier test de configuration avec nous.  Andrei est assis dans le couloir, il peut dire que j'ai menti.  Mais il me semble que tout a commenc√© par ceci: <br><br><img src="https://habrastorage.org/webt/6t/dr/d8/6tdrd8-mwyj8otcngbcjsjqi3ge.jpeg"><br><br>  La situation est la suivante: nous avons n services sur le m√™me h√¥te, chacun d'eux l√®ve son propre serveur JMX sur son port, exporte quelques JMX de surveillance.  Les ports de tous les services sont configur√©s dans le fichier.  Mais le fichier occupe plusieurs pages, et il existe de nombreuses autres propri√©t√©s - il s'av√®re souvent que les ports de diff√©rents services entrent en conflit.  Il est facile de se tromper.  Ensuite, tout est trivial: certains services n'augmentent pas, apr√®s cela, ils n'augmentent pas pour ceux qui en d√©pendent - les testeurs sont furieux. <br><br>  Ce probl√®me est r√©solu en plusieurs lignes.  Ce test, qui (il me semble) √©tait le premier, ressemblait √† ceci: <br><br><img src="https://habrastorage.org/webt/ka/ln/51/kaln51onx8-1yzdr2vq0ltcmegq.jpeg"><br><br>  Ce n'est rien de compliqu√©: on parcourt le dossier o√π se trouvent les fichiers de configuration, on les charge, on les analyse en tant que propri√©t√©s, on filtre les valeurs dont le nom contient ¬´jmx.port¬ª, et on v√©rifie que toutes les valeurs sont uniques.  Il n'est m√™me pas n√©cessaire de convertir les valeurs en entier.  Vraisemblablement, il n'y a que des ports. <br><br>  Ma premi√®re r√©action quand j'ai vu cela a √©t√© mitig√©e: <br><br><img src="https://habrastorage.org/webt/ka/ln/51/kaln51onx8-1yzdr2vq0ltcmegq.jpeg"><br><br>  Premi√®re impression: qu'est-ce que c'est dans mes beaux tests unitaires?  Pourquoi avons-nous grimp√© dans le syst√®me de fichiers? <br><br>  Et puis la surprise est venue: "Quoi, est-ce possible?" <br><br>  J'en parle parce qu'il semble y avoir une sorte de barri√®re psychologique qui rend difficile la r√©daction de tels tests.  Trois ans se sont √©coul√©s depuis, le projet regorge de tels tests, mais je constate souvent que mes coll√®gues, tombant sur une erreur commise dans la configuration, n'y √©crivent pas de tests.  Pour le code, tout le monde a d√©j√† l'habitude d'√©crire des tests de r√©gression - pour que l'erreur trouv√©e ne soit plus reproduite.  Mais ils ne le font pas pour la configuration, quelque chose interf√®re.  Il y a une sorte de barri√®re psychologique qui doit √™tre surmont√©e - c'est pourquoi je mentionne une telle r√©action afin que vous la reconnaissiez de vous-m√™me si elle appara√Æt. <br><br><img src="https://habrastorage.org/webt/ka/ln/51/kaln51onx8-1yzdr2vq0ltcmegq.jpeg"><br><br>  L'exemple suivant est presque le m√™me, mais l√©g√®rement modifi√© - j'ai supprim√© tous les ¬´jmx¬ª.  Cette fois, nous v√©rifions toutes les propri√©t√©s appel√©es quelque chose de l√†-bas.  Ils doivent √™tre des valeurs enti√®res et √™tre un port r√©seau valide.  Matcher validNetworkPort () cache notre matcher hamcrest personnalis√©, qui v√©rifie que la valeur est au-dessus de la plage de ports syst√®me, en dessous de la plage de ports √©ph√©m√®res, eh bien, nous savons que certains ports de nos serveurs sont pr√©-occup√©s - voici la liste compl√®te d'entre eux est √©galement cach√©e dans c'est matcher. <br><br>  Ce test est encore tr√®s primitif.  Notez qu'il n'y a aucune indication sur la propri√©t√© sp√©cifique que nous v√©rifions - elle est massive.  Un seul de ces tests peut v√©rifier 500 propri√©t√©s avec le nom "... port" et v√©rifier que tous sont des entiers dans la plage souhait√©e, avec toutes les conditions n√©cessaires.  Une fois qu'ils ont √©crit, une douzaine de lignes - et c'est tout.  C'est une fonctionnalit√© tr√®s pratique, elle appara√Æt car la configuration a un format simple: deux colonnes, une cl√© et une valeur.  Par cons√©quent, il peut √™tre trait√© en masse. <br><br>  Un autre exemple de test.  Que v√©rifions-nous ici? <br><br><img src="https://habrastorage.org/webt/7j/wt/wr/7jwtwr0zn93gy0fhfaqykbeyeyy.jpeg"><br><br>  Il v√©rifie que les vrais mots de passe ne fuient pas en production.  Tous les mots de passe doivent ressembler √† ceci: <br><br><img src="https://habrastorage.org/webt/yg/4_/ft/yg4_ftjvkm_bhqqzmdxppafoaii.jpeg"><br><br>  Vous pouvez √©crire de nombreux tests pour les fichiers de propri√©t√©s.  Je ne donnerai pas plus d'exemples - je ne veux pas me r√©p√©ter, l'id√©e est tr√®s simple, alors tout doit √™tre clair. <br><br>  ... et apr√®s avoir √©crit suffisamment de ces tests, une question int√©ressante surgit: qu'entendons-nous par configuration, o√π est sa fronti√®re?  Nous consid√©rons le fichier de propri√©t√©s comme une configuration, nous l'avons couvert - et quoi d'autre peut √™tre couvert dans le m√™me style? <br><br><h2>  Que consid√©rer une configuration </h2><br>  Il s'av√®re qu'il existe de nombreux fichiers texte dans le projet qui ne sont pas compil√©s - du moins dans le processus de construction normal.  Ils ne sont en aucun cas v√©rifi√©s tant qu'ils ne sont pas ex√©cut√©s sur le serveur, c'est-√†-dire que les erreurs y apparaissent tardivement.  Tous ces fichiers - avec une certaine extension - peuvent √™tre appel√©s une configuration.  Au moins, ils seront test√©s √† peu pr√®s de la m√™me mani√®re. <br><br>  Par exemple, nous avons un syst√®me de correctifs SQL qui sont transf√©r√©s sur la base de donn√©es pendant le processus de d√©ploiement. <br><br><img src="https://habrastorage.org/webt/jz/bk/c7/jzbkc7m5zo0k6phy-9kuzvkqkam.jpeg"><br><br>  Ils sont √©crits pour SQL * Plus.  SQL * Plus est un outil des ann√©es 60, et il n√©cessite toutes sortes de choses √©tranges: par exemple, pour s'assurer que la fin du fichier est sur une nouvelle ligne.  Bien s√ªr, les gens oublient r√©guli√®rement d'y mettre fin, car ils ne sont pas n√©s dans les ann√©es 60. <br><br><img src="https://habrastorage.org/webt/nr/oj/3w/nroj3wxkhriqqeqa-iwxwus0a0a.jpeg"><br><br>  Et encore une fois, il est r√©solu par la m√™me douzaine de lignes: nous s√©lectionnons tous les fichiers SQL, v√©rifions qu'il y a une barre oblique √† la fin.  Simple, pratique, rapide. <br><br>  Les crontabs sont un autre exemple de ¬´comme un fichier texte¬ª.  Nos services crontab d√©marrent et s'arr√™tent.  Ils provoquent le plus souvent deux erreurs: <br><br><img src="https://habrastorage.org/webt/02/i0/ch/02i0chpobgao-lexobckwr5ffd4.jpeg"><br><br>  Tout d'abord, le format d'expression de planification.  Ce n'est pas si compliqu√©, mais personne ne le v√©rifie avant le lancement, il est donc facile de mettre un espace suppl√©mentaire, une virgule, etc. <br><br>  Deuxi√®mement, comme dans l'exemple pr√©c√©dent, la fin du fichier doit √©galement se trouver sur une nouvelle ligne. <br><br>  Et tout cela est assez facile √† v√©rifier.  La fin du fichier est compr√©hensible, mais pour v√©rifier le calendrier, vous pouvez trouver des biblioth√®ques pr√™tes √† l'emploi qui analysent l'expression cron.  Avant le rapport, j'ai fait une recherche sur Google: il y en avait au moins six.  J'en ai trouv√© six, mais en g√©n√©ral il peut y en avoir plus.  Lorsque nous avons √©crit, nous avons pris la plus simple de celles trouv√©es, car nous n'avions pas besoin de v√©rifier le contenu de l'expression, mais seulement sa justesse syntaxique, afin que cron la charge avec succ√®s. <br><br>  En principe, vous pouvez liquider plus de ch√®ques - v√©rifiez que vous commencez le bon jour de la semaine, que vous n'arr√™tez pas les services au milieu de la journ√©e de travail.  Mais cela s'est av√©r√© ne pas √™tre si utile pour nous, et nous n'avons pas pris la peine. <br><br>  Les scripts shell sont une autre id√©e qui fonctionne tr√®s bien.  Bien s√ªr, √©crire en Java un analyseur √† part enti√®re de scripts bash est un plaisir pour les courageux.  Mais l'essentiel est qu'un grand nombre de ces scripts ne sont pas un bash complet.  Oui, il y a des scripts bash o√π le code est direct, enfer et enfer, o√π ils tombent une fois par an et, jurant, s'enfuient.  Mais de nombreux scripts bash ont les m√™mes configurations.  Il existe un certain nombre de variables syst√®me et de variables d'environnement qui sont d√©finies sur la valeur souhait√©e, configurant ainsi d'autres scripts qui utilisent ces variables.  Et ces variables sont faciles √† comprendre √† partir de ce fichier bash et √† v√©rifier quelque chose √† leur sujet. <br><br><img src="https://habrastorage.org/webt/5s/4d/z_/5s4dz_wtejguewyqrat5ipxa7by.jpeg"><br><br>  Par exemple, v√©rifiez que JAVA_HOME est install√© sur chaque environnement ou que la biblioth√®que jni que nous utilisons se trouve dans LD_LIBRARY_PATH.  D'une mani√®re ou d'une autre, nous sommes pass√©s d'une version de Java √† une autre et avons √©tendu le test: nous avons v√©rifi√© que JAVA_HOME contient ¬´1,8¬ª sur ce m√™me sous-ensemble d'environnement, que nous avons progressivement transf√©r√© vers la nouvelle version. <br><br>  Voici quelques exemples.  Permettez-moi de r√©sumer la premi√®re partie des conclusions: <br><br><ul><li>  Les tests de configuration sont d√©routants au d√©but, il y a une barri√®re psychologique.  Mais apr√®s l'avoir surmont√©, il existe de nombreux endroits dans l'application qui ne sont pas couverts par les ch√®ques et peuvent l'√™tre. </li><li>  Ensuite, ils sont √©crits <b>facilement et joyeusement</b> : il y a beaucoup de ¬´fruits bas¬ª qui donnent rapidement de grands avantages). </li><li>  R√©duisez le <b>co√ªt de</b> d√©tection et de correction des erreurs de configuration.  Comme il s'agit en fait de tests unitaires, vous pouvez les ex√©cuter sur votre ordinateur, m√™me avant de vous engager - cela r√©duit consid√©rablement la boucle de r√©troaction.  Beaucoup d'entre eux, bien s√ªr, auraient √©t√© test√©s au stade du d√©ploiement des tests, par exemple.  Et beaucoup ne seraient pas test√©s - s'il s'agit d'une configuration de production.  Et donc ils sont v√©rifi√©s directement sur l'ordinateur local. </li><li>  Ils donnent une seconde jeunesse.  En ce sens qu'il y a le sentiment que vous pouvez toujours tester beaucoup de choses int√©ressantes.  En effet, dans le code il n'est plus si facile de trouver ce que l'on peut tester. </li></ul><br><br><h2>  Partie 2. Cas plus complexes </h2><br>  Passons √† des tests plus complexes.  Apr√®s avoir couvert la plupart des v√©rifications triviales, telles que celles pr√©sent√©es ici, la question se pose: est-il possible de v√©rifier quelque chose de plus compliqu√©? <br><br>  Qu'est-ce que cela signifie ¬´plus difficile¬ª?  Les tests que je viens de d√©crire ont approximativement la structure suivante: <br><br><img src="https://habrastorage.org/webt/er/an/sx/eransxujnuprewkr1lcrk1nweui.jpeg"><br><br>  Ils v√©rifient quelque chose par rapport √† un fichier sp√©cifique.  Autrement dit, nous parcourons les fichiers, appliquons une certaine v√©rification de condition √† chacun.  Ainsi, beaucoup de choses peuvent √™tre v√©rifi√©es, mais il existe des sc√©narios plus utiles: <br><br><ul><li>  L'application d'interface utilisateur se connecte au serveur de <b>son</b> environnement. </li><li>  Tous les services du m√™me environnement se connectent au <b>m√™me</b> serveur de gestion. </li><li>  Tous les services dans le m√™me environnement utilisent <b>la m√™me</b> base de donn√©es. </li></ul><br><br>  Par exemple, une application d'interface utilisateur se connecte √† son serveur d'environnement.  Tr√®s probablement, l'interface utilisateur et le serveur sont des modules diff√©rents, sinon des projets du tout, et ils ont des configurations diff√©rentes, il est peu probable qu'ils utilisent les m√™mes fichiers de configuration.  Par cons√©quent, vous devrez les lier afin que tous les services d'un environnement soient connect√©s √† un serveur de gestion de cl√©s via lequel les commandes sont distribu√©es.  Encore une fois, tr√®s probablement, ce sont diff√©rents modules, diff√©rents services et g√©n√©ralement diff√©rentes √©quipes les d√©veloppent. <br><br>  Ou tous les services utilisent la m√™me base de donn√©es, la m√™me chose - des services dans diff√©rents modules. <br><br>  En fait, il y a une telle image: beaucoup de services, chacun d'eux a sa propre structure de configurations, vous devez en r√©duire quelques-uns et v√©rifier quelque chose √† l'intersection: <br><br><img src="https://habrastorage.org/webt/tw/et/op/twetop-jheecrf02felhlhchnvi.jpeg"><br><br>  Bien s√ªr, vous pouvez faire exactement cela: charger un, le second, retirer quelque chose quelque part, le coller dans le code de test.  Mais vous pouvez imaginer la taille du code et sa lisibilit√©.  Nous sommes partis de cela, mais nous avons r√©alis√© √† quel point c'√©tait difficile.  Comment faire mieux? <br><br>  Si vous r√™vez, ce serait plus pratique, alors j'ai r√™v√© que le test ressemblerait √† l'expliquer en langage humain: <br><br><pre><code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Theory</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">eachEnvironmentIsXXX</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( Environment environment )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( Server server : environment.servers() ) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( Service service : server.services() ) { Properties config = buildConfigFor( environment, server, service ); <span class="hljs-comment"><span class="hljs-comment">//‚Ä¶ check {something} about config } } }</span></span></code> </pre> <br>  Pour chaque environnement, une condition est remplie.  Pour v√©rifier cela, vous avez besoin de l'environnement pour trouver une liste de serveurs, une liste de services.  Chargez ensuite les configurations et v√©rifiez quelque chose √† l'intersection.  Par cons√©quent, j'ai besoin d'une telle chose, je l'ai appel√©e Disposition de d√©ploiement. <br><br><img src="https://habrastorage.org/webt/cs/um/3u/csum3u7sucokbnlydgulc18cdhs.jpeg"><br><br>  Nous avons besoin d'une opportunit√© du code pour acc√©der √† la fa√ßon dont l'application est d√©ploy√©e: sur quels serveurs quels services sont plac√©s, dans quel environnement - pour obtenir cette structure de donn√©es.  Et √† partir de l√†, je commence √† charger la configuration et √† la traiter. <br><br>  La disposition de d√©ploiement est sp√©cifique √† chaque √©quipe et √† chaque projet.  J'ai dessin√© - c'est un cas g√©n√©ral: g√©n√©ralement il y a un ensemble de serveurs, de services, un service a parfois un ensemble de fichiers de configuration, et pas seulement un.  Parfois, des param√®tres suppl√©mentaires sont n√©cessaires qui sont utiles pour les tests, ils doivent √™tre ajout√©s.  Par exemple, le rack dans lequel se trouve le serveur peut √™tre important.  Andrey dans son rapport a donn√© un exemple lorsqu'il √©tait important pour leurs services que les services de sauvegarde / primaires doivent √™tre dans des racks diff√©rents - pour son cas, il aurait besoin de garder une indication du rack dans la disposition de d√©ploiement: <br><br><img src="https://habrastorage.org/webt/gj/oh/ip/gjohipszob-edpgkekfr1zvdfp0.jpeg"><br><br>  Pour nos besoins, la r√©gion du serveur est importante, le centre de donn√©es sp√©cifique, en principe √©galement, de sorte que la sauvegarde / primaire se trouve dans diff√©rents centres de donn√©es.  Ce sont toutes des propri√©t√©s de serveur suppl√©mentaires, elles sont sp√©cifiques au projet, mais sur la diapositive, c'est un d√©nominateur commun. <br><br>  O√π obtenir la disposition du d√©ploiement?  Il semble que dans toute grande entreprise, il existe un syst√®me de gestion des infrastructures, tout y est d√©crit, il est fiable, fiable et tout √ßa ... en fait pas. <br><br>  Au moins, ma pratique dans deux projets a montr√© qu'il est plus facile de coder en dur d'abord, puis, apr√®s trois ans ... de laisser la peau dure. <br><br>  Nous vivons avec ce projet depuis trois ans maintenant.  Dans le second, semble-t-il, nous nous int√©grons toujours √† la gestion des infrastructures en un an, mais toutes ces ann√©es nous avons v√©cu comme √ßa.  Par exp√©rience, il est judicieux de diff√©rer la t√¢che d'int√©gration avec IM afin d'obtenir des tests pr√™ts √† l'emploi d√®s que possible, ce qui montrera qu'ils fonctionnent et sont utiles.  Et puis, il se peut que cette int√©gration ne soit pas si n√©cessaire, car la distribution des services sur les serveurs n'est pas si souvent modifi√©e. <br><br>  Le code dur peut litt√©ralement ressembler √† ceci: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> Environment { PROD( PROD_UK_PRIMARY, PROD_UK_BACKUP, PROD_US_PRIMARY, PROD_US_BACKUP, PROD_SG_PRIMARY, PROD_SG_BACKUP ) ‚Ä¶ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Server[] servers() {‚Ä¶} } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> Server { PROD_UK_PRIMARY(‚Äúrflx-ldn-<span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-string"><span class="hljs-string">"), PROD_UK_BACKUP("</span></span>rflx-ldn-<span class="hljs-number"><span class="hljs-number">2</span></span><span class="hljs-string"><span class="hljs-string">"), PROD_US_PRIMARY(‚Äúrflx-nyc-1"</span></span>), PROD_US_BACKUP(<span class="hljs-string"><span class="hljs-string">"rflx-nyc-2"</span></span>), PROD_SG_PRIMARY(‚Äúrflx-sng-<span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-string"><span class="hljs-string">"), PROD_SG_BACKUP("</span></span>rflx-sng-<span class="hljs-number"><span class="hljs-number">2</span></span><span class="hljs-string"><span class="hljs-string">"), public Service[] services() {‚Ä¶} }</span></span></code> </pre><br>  La fa√ßon la plus simple que nous utilisons dans notre premier projet est d'√©num√©rer l'environnement avec une liste de serveurs dans chacun d'eux.  Il y a une liste de serveurs et, il semblerait, il devrait y avoir une liste de services, mais nous avons trich√©: nous avons des scripts de d√©marrage (qui font √©galement partie de la configuration). <br><br><img src="https://habrastorage.org/webt/m0/ww/jw/m0wwjwoo1xhqahbdppfbf8q5rno.jpeg"><br><br>  Ils ex√©cutent des services pour chaque environnement.  Et la m√©thode services () grep'a simplement tous les services du fichier de son serveur.  Cela est d√ª au fait qu'il n'y a pas tant d'environnements et que les serveurs sont √©galement rarement ajout√©s ou supprim√©s - mais il existe de nombreux services et ils sont m√©lang√©s assez souvent.  Il √©tait logique de charger la disposition r√©elle des services √† partir de scripts afin de ne pas changer trop souvent la disposition cod√©e en dur. <br><br>  Apr√®s avoir cr√©√© un tel mod√®le de configuration logicielle, des bonus agr√©ables apparaissent.  Par exemple, vous pouvez √©crire un test comme celui-ci: <br><br><img src="https://habrastorage.org/webt/ht/-o/lk/ht-olkpuql9rl2jhdkpm23yfnlm.jpeg"><br><br>  Le test est que sur chaque environnement tous les services cl√©s sont pr√©sents.  Supposons qu'il existe quatre services cl√©s, et que les autres le soient ou non, mais sans ces quatre, cela n'a aucun sens.  Vous pouvez v√©rifier que vous ne les avez oubli√©s nulle part, qu'ils ont tous des sauvegardes dans le m√™me environnement.  Le plus souvent, ces erreurs se produisent lors de la configuration de l'UAT de ces instances, mais elles peuvent √©galement fuir dans PROD.  Au final, les erreurs dans l'UAT font √©galement perdre du temps et des nerfs aux testeurs. <br><br>  La question se pose de maintenir la pertinence du mod√®le de configuration.  Vous pouvez √©galement √©crire un test pour cela. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HardCodedLayoutConsistencyTest</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Theory</span></span> eachHardCodedEnvironmentHasConfigFiles(Environment env){ ‚Ä¶ } <span class="hljs-meta"><span class="hljs-meta">@Theory</span></span> eachConfigFileHasHardCodedEnvironment(File configFile){ ‚Ä¶ } }</code> </pre><br>  Il existe des fichiers de configuration et une disposition de d√©ploiement dans le code.  Et vous pouvez le v√©rifier pour chaque environnement / serveur / etc.  il existe un fichier de configuration correspondant, et pour chaque fichier du format requis - l'environnement correspondant.  D√®s que vous oubliez d'ajouter quelque chose √† un endroit, le test tombe. <br><br>  L'essentiel est la disposition du d√©ploiement: <br><br><ul><li>  Simplifie l'√©criture de tests complexes qui rassemblent des configurations de diff√©rentes parties de l'application. </li><li>  Les rend plus clairs et plus lisibles.  Ils regardent la fa√ßon dont vous pensez d'eux √† un niveau √©lev√©, et non la fa√ßon dont ils passent par les configurations. </li><li>  Lors de sa cr√©ation, lorsque les gens posent des questions, il se r√©v√®le beaucoup de choses int√©ressantes sur le d√©ploiement.  Des limitations, des connaissances sacr√©es implicites, surgissent, par exemple, concernant la possibilit√© d'h√©berger deux environnements sur un m√™me serveur.  Il s'av√®re que les d√©veloppeurs pensent diff√©remment et √©crivent leurs services en cons√©quence.  Et ces moments sont utiles pour s'installer entre les d√©veloppeurs. </li><li>  Compl√®te bien la documentation (surtout si ce n'est pas le cas).  M√™me s'il y en a, il est plus agr√©able pour moi, en tant que d√©veloppeur, de voir cela dans le code.  De plus, vous pouvez y √©crire des commentaires importants pour moi et non pour quelqu'un d'autre.  Et vous pouvez √©galement coder en dur.  Autrement dit, si vous d√©cidez qu'il ne peut pas y avoir deux environnements sur le m√™me serveur, vous pouvez ins√©rer un ch√®que, et maintenant ce ne sera pas le cas.  Au moins, vous saurez si quelqu'un essaie.  Autrement dit, il s'agit d'une documentation avec la possibilit√© de l'appliquer.  C'est tr√®s utile. </li></ul><br>  Continuons.  Apr√®s avoir pass√© les tests, ils se sont ¬´install√©s¬ª pendant un an, certains commencent √† tomber.  Certains commencent √† tomber plus t√¥t, mais ce n'est pas si effrayant.  C'est effrayant quand un test √©crit il y a un an tombe, vous regardez son message d'erreur et vous ne comprenez pas. <br><img src="https://habrastorage.org/webt/gm/e1/kb/gme1kb6jzdvbvfpfxlxydbxbktw.jpeg"><br><br>  Supposons que je comprenne et accepte qu'il s'agit d'un port r√©seau non valide - mais o√π est-il?  Avant la conf√©rence, j'ai examin√© le fait que nous avons 1 200 fichiers de propri√©t√©s dans le projet, r√©partis sur 90 modules, avec un total de 24 000 lignes.  (Bien que j'ai √©t√© surpris, mais si vous comptez, ce n'est pas un si grand nombre - pour un service pour 4 fichiers.) O√π est ce port? <br><br>  Il est clair que assertThat () a un argument de message, vous pouvez y entrer quelque chose qui aidera √† identifier le lieu.  Mais quand vous √©crivez un test, vous n'y pensez pas.  Et m√™me si vous pensez, vous devez toujours deviner quelle description sera suffisamment d√©taill√©e pour √™tre comprise dans un an.  Je voudrais automatiser ce moment, afin qu'il existe un moyen d'√©crire des tests avec g√©n√©ration automatique d'une description plus ou moins claire, par laquelle vous pouvez trouver une erreur. <br><br>  Encore une fois, j'ai r√™v√© et r√™v√© de quelque chose comme √ßa: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> environment, <span class="hljs-keyword"><span class="hljs-keyword">server</span></span>, component, configLocation, propertyName, propertyValue <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> configuration(environment, <span class="hljs-keyword"><span class="hljs-keyword">server</span></span>, component) <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> propertyName <span class="hljs-keyword"><span class="hljs-keyword">like</span></span> ‚Äú%.port%‚Äù <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> propertyValue <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> validNetworkPort()</code> </pre><br>  C'est un tel pseudo-SQL - eh bien, je connais juste SQL, et le cerveau a jet√© la solution de ce qui est familier.  L'id√©e est que la plupart des tests de configuration consistent en plusieurs morceaux du m√™me type.  Tout d'abord, un sous-ensemble de param√®tres est s√©lectionn√© par la condition: <br><br><img src="https://habrastorage.org/webt/ig/om/g_/igomg_lacmbr2w7xdnuqtxgrnoc.jpeg"><br><br>  Ensuite, concernant ce sous-ensemble, nous v√©rifions quelque chose par rapport √† la valeur: <br><br><img src="https://habrastorage.org/webt/xm/zr/1p/xmzr1p3brb_ixbgiafqteeiltgg.jpeg"><br><br>  Et puis, s'il y avait des propri√©t√©s dont les valeurs ne satisfont pas le souhait, c'est la ¬´feuille¬ª que nous voulons recevoir dans le message d'erreur: <br><br><img src="https://habrastorage.org/webt/6d/ci/jr/6dcijrp9yesvndnn6hq2udo5fw8.jpeg"><br><br>  √Ä un moment donn√©, je me suis m√™me demand√© si je pouvais √©crire un analyseur comme SQL, car maintenant ce n'est pas difficile.  Mais je me suis alors rendu compte que l'EDI ne le prendrait pas en charge et ne le sugg√©rerait pas, donc les gens devront √©crire aveugl√©ment sur ce ¬´SQL¬ª autodidacte, sans invites IDE, sans compilation, sans v√©rification - ce n'est pas tr√®s pratique.  J'ai donc d√ª chercher des solutions support√©es par notre langage de programmation.  Si nous avions .NET, LINQ aiderait, c'est presque comme SQL. <br><br>  Il n'y a pas de LINQ en Java, aussi proche que possible des flux.  Voici √† quoi devrait ressembler ce test dans les flux: <br><br><pre> <code class="java hljs">ValueWithContext[] incorrectPorts = flattenedProperties( environment ) .filter( propertyNameContains( <span class="hljs-string"><span class="hljs-string">".port"</span></span> ) ) .filter( !isInteger( propertyValue ) || !isValidNetworkPort( propertyValue ) ) .toArray(); assertThat( incorrectPorts, emptyArray() );</code> </pre><br>  flattenedProperties () prend toutes les configurations de cet environnement, tous les fichiers pour tous les serveurs, services et les d√©veloppe dans une grande table.  Il s'agit essentiellement d'une table de type SQL, mais sous la forme d'un ensemble d'objets Java.  Et flattenedProperties () renvoie cet ensemble de cha√Ænes sous forme de flux. <br><br><img src="https://habrastorage.org/webt/8b/ep/jb/8bepjbpkln50gcn1hlgdizwxkxe.jpeg"><br><br>  Ensuite, vous ajoutez quelques conditions sur cet ensemble d'objets Java.  Dans cet exemple: nous s√©lectionnons ceux contenant "port" dans le nom de propri√©t√© et filtrons ceux dont les valeurs ne sont pas converties en entier, ou non dans la plage valide.  Ce sont des valeurs erron√©es et, en th√©orie, elles devraient √™tre un ensemble vide. <br><br><img src="https://habrastorage.org/webt/4z/8i/db/4z8idb1t_vtoprcjg3f23ct0aeq.jpeg"><br><br>  S'ils ne sont pas un ensemble vide, nous lan√ßons une erreur qui ressemblera √† ceci: <br><br><img src="https://habrastorage.org/webt/ia/wq/wy/iawqwytklkjtldsc-afzmw7-cui.jpeg"><br><br><h2>  Partie 3. Les tests comme support pour la refactorisation </h2><br>  En r√®gle g√©n√©rale, le test de code est l'un des supports de refactorisation les plus puissants.  Le refactoring est un processus dangereux, beaucoup de refaire, et je veux m'assurer qu'apr√®s cela l'application est toujours viable.  Une fa√ßon de s'en assurer est de tout superposer tout d'abord avec des tests de tous les c√¥t√©s, puis de le refactoriser. <br><br>  Et maintenant, devant moi √©tait la t√¢che de refactoriser la configuration.  Il y a une application qui a √©t√© √©crite il y a sept ans par une personne intelligente.  La configuration de cette application ressemble √† ceci: <br><br><img src="https://habrastorage.org/webt/d4/vc/wz/d4vcwzxtgvecd-be0n51ysi9mho.jpeg"><br><br>  Ceci est un exemple, il y en a beaucoup plus.  Triple permutations d'imbrication, et ceci est utilis√© tout au long de la configuration: <br><br><img src="https://habrastorage.org/webt/ua/gt/t7/uagtt7xt289h6xfpc0swrmfztca.jpeg"><br><br>  Il y a peu de fichiers dans la configuration elle-m√™me, mais ils sont inclus les uns dans les autres.  Il utilise une petite extension des propri√©t√©s iu - Configuration Apache Commons, qui prend simplement en charge les inclusions et les autorisations entre accolades. <br><br>  Et l'auteur a fait un travail fantastique en utilisant seulement ces deux choses.  Je pense qu'il y a construit une machine de Turing.  √Ä certains endroits, il semble vraiment qu'il essaie de faire des calculs en utilisant des inclusions et des substitutions.  Je ne sais pas si ce syst√®me de Turing est complet, mais il a, √† mon avis, essay√© de prouver que c'est le cas. <br><br>  Et l'homme est parti.  A √©crit, l'application fonctionne, et il a quitt√© la banque.  Tout fonctionne, seul personne ne comprend parfaitement la configuration. <br><br>  Si nous prenons un service s√©par√©, alors il s'av√®re 10 inclusions, √† une profondeur triple, et au total, si tout est √©tendu, 450 param√®tres.  En fait, ce service particulier en utilise 10 √† 15%, les autres param√®tres sont pour d'autres services, car les fichiers sont partag√©s, ils sont utilis√©s par plusieurs services.  Mais ce que 10 √† 15% utilisent exactement ce service particulier n'est pas si facile √† comprendre.  L'auteur a apparemment compris.  Personne tr√®s intelligente, tr√®s. <br><br>  La t√¢che, respectivement, √©tait de simplifier la configuration, sa refactorisation.  En m√™me temps, je voulais que l'application continue de fonctionner, car dans cette situation, les chances sont faibles.  Je veux: <br><br><ul><li>  Simplifiez la configuration. </li><li>  Pour qu'apr√®s refactoring, chaque service ait toujours tous ses param√®tres n√©cessaires. </li><li>  Pour qu'il n'ait pas de param√®tres suppl√©mentaires.  85% de ceux qui ne lui sont pas li√©s ne devraient pas encombrer la page. </li><li>  Ces services sont toujours connect√©s avec succ√®s dans des clusters et ont effectu√© une collaboration. </li></ul><br>  Le probl√®me est qu'on ne sait pas √† quel point ils se connectent maintenant, car le syst√®me est tr√®s redondant.  Par exemple, pour l'avenir: lors de la refactorisation, il s'est av√©r√© que dans l'une des configurations de production, il devait y avoir quatre serveurs dans le clip de sauvegarde, mais en fait il y en avait deux.  En raison du niveau √©lev√© de redondance, personne ne l'a remarqu√© - l'erreur est apparue accidentellement, mais en fait, le niveau de redondance a √©t√© longtemps inf√©rieur √† ce que nous attendions.  Le fait est que nous ne pouvons pas compter sur le fait que la configuration actuelle est correcte partout. <br><br>  Je m√®ne au fait que vous ne pouvez pas simplement comparer la nouvelle configuration avec l'ancienne.  Il peut √™tre √©quivalent, mais rester en m√™me temps quelque part mal.  Il est n√©cessaire de v√©rifier le contenu logique. <br><br>  Programme minimum: isolez chaque param√®tre distinct de chaque service dont il a besoin et v√©rifiez l'exactitude, que le port est un port, l'adresse est une adresse, TTL est un nombre positif, etc.  Et v√©rifiez les relations cl√©s que les services connectent essentiellement aux principaux points de terminaison.  Je voulais au moins y parvenir.  Autrement dit, contrairement aux exemples pr√©c√©dents, la t√¢che ici n'est pas de v√©rifier des param√®tres individuels, mais de couvrir la configuration enti√®re avec un r√©seau complet de v√©rifications. <br><br>  Comment le tester? <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SimpleComponent</span></span></span><span class="hljs-class"> </span></span>{ ‚Ä¶ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">configure</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Configuration conf )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> port = conf.getInt( <span class="hljs-string"><span class="hljs-string">"Port"</span></span>, -<span class="hljs-number"><span class="hljs-number">1</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( port &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ConfigurationException(); String ip = conf.getString( <span class="hljs-string"><span class="hljs-string">"Address"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( ip == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ConfigurationException(); ‚Ä¶ } ‚Ä¶ }</code> </pre><br>  Comment ai-je r√©solu ce probl√®me?  Il y a un composant simple, dans l'exemple il est simplifi√© au maximum.  (Pour ceux qui n'ont pas rencontr√© la configuration Apache Commons: l'objet Configuration est comme Propri√©t√©s, mais il a toujours les m√©thodes typ√©es getInt (), getLong (), etc.; nous pouvons supposer que ce sont des juProperties sur de petits st√©ro√Ødes.) Supposons qu'un composant n√©cessite deux param√®tres: par exemple, une adresse TCP et un port TCP.  Nous les retirons et v√©rifions.  Quelles sont les quatre parties communes ici? <br><br><img src="https://habrastorage.org/webt/ou/s0/0k/ous00k4owrh8kqvf20fqqpzrfg0.jpeg"><br><br>  Il s'agit du nom du param√®tre, du type, des valeurs par d√©faut (ici elles sont triviales: null et -1, parfois il y a des valeurs sens√©es) et quelques validations.  Le port ici est valid√© trop simplement, incompl√®tement - vous pouvez sp√©cifier le port qui le traversera, mais ce ne sera pas un port r√©seau valide.  Par cons√©quent, je voudrais √©galement am√©liorer ce moment.  Mais tout d'abord, je veux transformer ces quatre choses en une seule.  Par exemple, ceci: <br><br><pre> <code class="java hljs">IProperty&lt;Integer&gt; PORT_PROPERTY = intProperty( <span class="hljs-string"><span class="hljs-string">"Port"</span></span> ) .withDefaultValue( -<span class="hljs-number"><span class="hljs-number">1</span></span> ) .matchedWith( validNetworkPort() ); IProperty&lt;String&gt; ADDRESS_PROPERTY = stringProperty( <span class="hljs-string"><span class="hljs-string">"Address"</span></span> ) .withDefaultValue( <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> ) .matchedWith( validIPAddress() );</code> </pre><br>  Un tel objet composite est une description d'une propri√©t√© qui conna√Æt son nom, sa valeur par d√©faut, peut faire la validation (ici, j'utilise √† nouveau le matcher hamcrest).  Et cet objet a quelque chose comme cette interface: <br><br><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IProperty</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* (name, defaultValue, matcher‚Ä¶) */</span></span> <span class="hljs-comment"><span class="hljs-comment">/** lookup (or use default), * convert type, * validate value against matcher */</span></span> <span class="hljs-function"><span class="hljs-function">FetchedValue&lt;T&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fetch</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Configuration config )</span></span></span><span class="hljs-function"> } class FetchedValue&lt;T&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String propertyName; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> T propertyValue; ‚Ä¶ }</code> </pre><br>  Autrement dit, apr√®s avoir cr√©√© un objet sp√©cifique √† une impl√©mentation sp√©cifique, vous pouvez lui demander d'extraire le param√®tre qu'il repr√©sente de la configuration.  Et il va retirer ce param√®tre, v√©rifier dans le processus, s'il n'y a pas de param√®tre, il donnera une valeur par d√©faut, conduira au type souhait√© et le renverra imm√©diatement avec le nom. <br><br>  Autrement dit, voici le nom du param√®tre et une valeur r√©elle telle que le service verra s'il demande √† cette configuration.  Cela vous permet d'envelopper plusieurs lignes de code dans une seule entit√©, c'est la premi√®re simplification dont j'ai besoin. <br><br>  La deuxi√®me simplification dont j'avais besoin pour r√©soudre le probl√®me √©tait d'introduire un composant qui a besoin de plusieurs propri√©t√©s pour sa configuration.  Mod√®le de configuration des composants: <br><br><img src="https://habrastorage.org/webt/gf/rr/ku/gfrrkugkjdimk8kcunvu4vijrsu.jpeg"><br><br>  Nous avions un composant utilisant ces deux propri√©t√©s, il existe un mod√®le pour sa configuration - l'interface IConfigurationModel, que cette classe impl√©mente.  IConfigurationModel fait tout ce que fait le composant, mais seulement la partie qui se rapporte √† la configuration.  Si le composant a besoin de param√®tres dans un certain ordre avec certaines valeurs par d√©faut - IConfigurationModel combine ces informations en elles-m√™mes, les encapsule.  Toutes les autres actions du composant ne sont pas importantes pour lui.  Il s'agit d'un mod√®le de composant en termes d'acc√®s √† la configuration. <br><br><img src="https://habrastorage.org/webt/1v/-b/0d/1v-b0dpycb6qscw_n5sul8tbzec.jpeg"><br><br>  L'astuce de cette vue est que les mod√®les sont combinables.  S'il existe un composant qui utilise d'autres composants, et qu'ils y sont combin√©s, alors de la m√™me mani√®re le mod√®le de ce composant complexe peut fusionner les r√©sultats des appels de deux sous-composants. <br><br>  Autrement dit, il est possible de construire une hi√©rarchie de mod√®les de configuration parall√®le √† la hi√©rarchie des composants eux-m√™mes.  Sur le mod√®le sup√©rieur, appelez fetch (), qui renverra la feuille des param√®tres qu'il a extraits de la configuration avec leurs noms - exactement ceux dont le composant correspondant aura besoin en temps r√©el.  Si nous avons √©crit tous les mod√®les correctement, bien s√ªr. <br><br>  Autrement dit, la t√¢che consiste √† √©crire de tels mod√®les pour chaque composant de l'application qui a acc√®s √† la configuration.  Dans mon application, il y avait pas mal de tels composants: l'application elle-m√™me est assez feuillue, mais r√©utilise activement le code, donc seulement 70 classes principales sont configur√©es.  Pour eux, j'ai d√ª √©crire 70 mod√®les. <br><br>  Ce qu'il en co√ªte: <br><br><ul><li>  12 services </li><li>  70 classes configurables </li><li>  =&gt; 70 ConfigurationModels (~ 60 sont triviaux); </li><li>  1 √† 2 semaines par personne. </li></ul><br>  J'ai simplement ouvert l'√©cran avec le code du composant qui se configure lui-m√™me, et sur l'√©cran suivant, j'ai √©crit le code du ConfigurationModel correspondant.  La plupart d'entre eux sont triviaux, comme l'exemple illustr√©.  Dans certains cas, il y a des branches et des transitions conditionnelles - l√†, le code devient plus ramifi√©, mais tout est √©galement r√©solu.  En une semaine et demie √† deux semaines, j'ai r√©solu ce probl√®me, pour les 70 composants, j'ai d√©crit les mod√®les. <br><br>  Par cons√©quent, lorsque nous mettons tout cela ensemble, nous obtenons le code suivant: <br><br><img src="https://habrastorage.org/webt/dq/ab/vf/dqabvfz99qwfnortpempmtvaalm.jpeg"><br><br>  Pour chaque service / environnement / etc.  nous prenons le mod√®le de configuration, c'est-√†-dire le n≈ìud sup√©rieur de cet arbre, et demandons de tout r√©cup√©rer dans la configuration.  √Ä ce stade, toutes les validations passent √† l'int√©rieur, chacune des propri√©t√©s, lorsqu'elle se retire de la configuration, v√©rifie l'exactitude de sa valeur.  Si au moins un ne passe pas, une exception s'envolera.  Tout le code est obtenu en v√©rifiant que toutes les valeurs sont valides isol√©ment. <br><br><h2>  Interd√©pendances de service </h2><br>  Nous avions encore une question sur la fa√ßon de v√©rifier l'interd√©pendance des services.  C'est un peu plus compliqu√©, vous devez regarder quel genre d'interd√©pendance il y a.  Il s'est av√©r√© pour moi que les interd√©pendances se r√©sument au fait que les services doivent ¬´se rencontrer¬ª sur les points de terminaison du r√©seau.  Le service A doit √©couter exactement l'adresse √† laquelle le service B envoie des paquets, et vice versa.  Dans mon exemple, toutes les d√©pendances entre les configurations des diff√©rents services se r√©sumaient √† cela.  Il √©tait possible de r√©soudre ce probl√®me d'une mani√®re aussi simple: obtenir des ports et des adresses de diff√©rents services et les v√©rifier.  Il y aurait de nombreux tests, ils seraient encombrants.  Je suis une personne paresseuse et je ne voulais pas √ßa.  J'ai donc fait autrement. <br><br>  Tout d'abord, je voulais en quelque sorte r√©sumer ce point de terminaison de r√©seau lui-m√™me.  Par exemple, pour une connexion TCP, vous n'avez besoin que de deux param√®tres: l'adresse et le port.  Pour une connexion multicast, quatre param√®tres.  Je voudrais l'√©craser dans une sorte d'objet.  J'ai fait cela dans l'objet Endpoint, qui cache √† l'int√©rieur tout ce dont vous avez besoin.  La diapositive est un exemple d'OutcomingTCPEndpoint, une connexion r√©seau TCP sortante. <br><br><pre> <code class="java hljs">IProperty&lt;IEndpoint&gt; TCP_REQUEST = outcomingTCP( <span class="hljs-comment"><span class="hljs-comment">// (+matchers, +default values) ‚ÄúTCP.Request.Address‚Äù, ‚ÄúTCP.Request.Port¬ª ); class OutcomingTCPEndpoint implements IEndpoint { //(localInterface, localAddress, multicastGroup, port) @Override boolean matches( IEndpoint other); }</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En dehors, l'interface Endpoint est √©mise par la seule m√©thode matches (), dans laquelle vous pouvez donner un autre Endpoint et savoir si cette paire est similaire aux parties serveur et client d'une connexion. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pourquoi est-ce "comme"? Parce que nous ne savons pas ce qui se passera dans la r√©alit√©: peut-√™tre, formellement, il devrait se connecter aux adresses de port, mais sur un vrai r√©seau, il y a un pare-feu entre ces n≈ìuds - nous ne pouvons le v√©rifier que par configuration. Mais nous pouvons savoir s'ils ne correspondent pas officiellement aux ports / adresses. Alors, tr√®s probablement, et en r√©alit√©, eux aussi, ne se connecteront pas entre eux.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En cons√©quence, au lieu des valeurs de propri√©t√© primitives, des groupes d'adresses de port-multidiffusion, nous avons maintenant une propri√©t√© complexe qui renvoie Endpoint. Et dans tous les ConfigurationModels, au lieu de propri√©t√©s distinctes, il y en a de si complexes. Qu'est-ce que cela nous donne? Cela nous donne ce type de v√©rification de la connectivit√© du cluster:</font></font><br><br><pre> <code class="java hljs">ValueWithContext[] allEndpoints = flattenedConfigurationValues(environment) .filter( valueIsEndpoint() ) .toArray(); ValueWithContext[] unpairedEndpoints = Arrays.stream( allEndpoints ) .filter( e -&gt; !hasMatchedEndpoint(e, allEndpoints) ) .toArray(); assertThat( unpairedEndpoints, emptyArray() );</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De toutes les propri√©t√©s de cet environnement, nous s√©lectionnons des points de terminaison, puis nous sp√©cifions simplement s'il y en a qui ne se connectent √† personne et ne se connectent √† personne. Toutes les machines pr√©c√©dentes vous permettent d'effectuer cette v√©rification sur plusieurs lignes. Ici, plus pr√©cis√©ment, la complexit√© de la v√©rification de ¬´tout le monde avec tout le monde¬ª sera O (n ^ 2), mais ce n'est pas si important, car il existe une centaine de points de terminaison, vous ne pouvez m√™me pas les optimiser. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C'est-√†-dire que pour chaque Endpoint, nous passons par tout le reste et d√©couvrons s'il y en a au moins un qui s'y connecte. Si aucun n'a √©t√© trouv√©, il aurait probablement d√ª √™tre l√†, mais √† cause d'une erreur, il √©tait parti.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En g√©n√©ral, il se peut que le service pr√©sente des trous qui d√©passent, c'est-√†-dire aux services externes, en dehors de l'application actuelle. </font><font style="vertical-align: inherit;">Ces trous devront √™tre explicitement filtr√©s. </font><font style="vertical-align: inherit;">J'ai eu de la chance, dans mon cas, les clients externes se connectent √† travers les m√™mes trous que le service lui-m√™me utilise √† l'int√©rieur de lui-m√™me. </font><font style="vertical-align: inherit;">C'est un tel ferm√© et √©conomique dans le sens des connexions r√©seau. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ceci est la solution au probl√®me de test. </font><font style="vertical-align: inherit;">Et la t√¢che principale, je me souviens, √©tait la refactorisation. </font><font style="vertical-align: inherit;">Et j'√©tais pr√™t √† faire le refactoring avec mes mains, mais quand j'ai fait tous ces tests et qu'ils ont commenc√© √† travailler, j'ai r√©alis√© que j'√©tais en mesure de faire le refactoring automatiquement pour le changement. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Toute cette hi√©rarchie ConfigurationModel vous permet de:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Convertir dans un autre format </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Effectuer des demandes de configuration (¬´tous les ports udp utilis√©s par les services sur ce serveur¬ª) </font></font></li><li>        . </li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Je peux faire glisser la configuration enti√®re dans la m√©moire de telle mani√®re que chaque propri√©t√© retrace son origine. Apr√®s cela, je peux convertir cette configuration en m√©moire et la verser dans d'autres fichiers, dans un ordre diff√©rent, dans un format diff√©rent - comme cela me convient. Alors je l'ai fait: j'ai √©crit un petit code pour convertir cette feuille sous la forme dans laquelle je voulais la convertir. En fait, j'ai d√ª le faire plusieurs fois, car au d√©part, il n'√©tait pas √©vident de savoir quel format serait pratique et compr√©hensible, et j'ai d√ª faire plusieurs visites pour l'essayer. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mais cela ne suffit pas. Avec cette construction, en utilisant ConfigurationModels, je peux ex√©cuter des demandes de configuration. Soulevez-le en m√©moire et d√©couvrez quels ports UDP sp√©cifiques sont utilis√©s sur ce serveur par diff√©rents services, demandez une liste des ports utilis√©s, avec les instructions des services.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De plus, je peux connecter les services sur des endpoints et les afficher sous forme de diagramme, exporter vers .dot. </font><font style="vertical-align: inherit;">Et d'autres demandes similaires sont facilement faites. </font><font style="vertical-align: inherit;">Le r√©sultat a √©t√© un tel couteau suisse - les co√ªts de sa construction ont pay√© assez bien. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C'est l√† que je termine.</font></font> Conclusions: <br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √Ä mon avis, d'apr√®s mon exp√©rience, tester la configuration est important et amusant. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il y a beaucoup de fruits bas, le seuil d'entr√©e pour un d√©but est bas. </font><font style="vertical-align: inherit;">Vous pouvez r√©soudre des probl√®mes complexes, mais il existe √©galement de nombreux probl√®mes simples.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Si vous utilisez un petit cerveau, vous pouvez obtenir des outils puissants qui vous permettent non seulement de tester, mais aussi d'avoir beaucoup √† voir avec la configuration. </font></font></li></ul><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si vous avez aim√© ce reportage du Heisenbug 2018 Piter, veuillez noter: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">du 6 au 7 d√©cembre, le</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> prochain </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Heisenbug</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> se tiendra </font><b><font style="vertical-align: inherit;">√† Moscou</font></b><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">La plupart des descriptions des nouveaux rapports sont d√©j√† disponibles </font><font style="vertical-align: inherit;">sur </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">le site Web de la conf√©rence</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Et √† partir du 1er novembre, le prix des billets augmente - il est donc logique de prendre une d√©cision maintenant.</font></font></blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr427487/">https://habr.com/ru/post/fr427487/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr427477/index.html">Nous pr√©parons le clustering hi√©rarchique, ou comment j'ai identifi√© les sp√©cialisations dans le CV</a></li>
<li><a href="../fr427479/index.html">L'utilisation des donn√©es utilisateurs et la vente de m√©gadonn√©es propos√©es pour l√©gitimer</a></li>
<li><a href="../fr427481/index.html">Caract√©ristiques de la construction d'un r√©seau Wi-Fi dans une production alimentaire innovante</a></li>
<li><a href="../fr427483/index.html">√âcole d'intelligence artificielle dans le quartier binaire</a></li>
<li><a href="../fr427485/index.html">Le probl√®me avec Windows n'est pas le taux de mise √† jour, mais le processus de d√©veloppement</a></li>
<li><a href="../fr427489/index.html">HomeData: comment l'analyse des donn√©es est utilis√©e en architecture et en urbanisme</a></li>
<li><a href="../fr427491/index.html">vDud en anglais: 7 enqu√™teurs occidentaux, dont chacun prend un exemple</a></li>
<li><a href="../fr427493/index.html">Amplificateurs de classes basse fr√©quence: A, B, AB, D, G, H</a></li>
<li><a href="../fr427495/index.html">Combien d'instructions Habr + comment savoir combien d'autres entreprises gagnent</a></li>
<li><a href="../fr427499/index.html">De quoi parlent-ils dans le support technique du streamer vid√©o?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>