<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèΩ‚Äçü§ù‚Äçüë®üèø üéø ü•É Cuidado - G√ÅS! ou Como fizemos contratos inteligentes n√£o carbonatados üëãüèø üÜí üéÆ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Blockchain e contratos inteligentes ainda s√£o um t√≥pico importante entre desenvolvedores e t√©cnicos. H√° muita pesquisa e discuss√£o sobre o futuro dele...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Cuidado - G√ÅS! ou Como fizemos contratos inteligentes n√£o carbonatados</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/waves/blog/440702/"><p><img src="https://habrastorage.org/webt/ps/lh/d4/pslhd4hgoxgjskexszwtn40mivo.png"></p><br><p>  Blockchain e contratos inteligentes ainda s√£o um t√≥pico importante entre desenvolvedores e t√©cnicos.  H√° muita pesquisa e discuss√£o sobre o futuro deles, para onde tudo se move e para onde levar√°.  N√≥s da <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Waves Platform temos</a> nossa pr√≥pria vis√£o sobre o que devem ser os contratos inteligentes e, neste artigo, mostrarei como os fizemos, quais problemas encontramos e por que eles n√£o s√£o como contratos inteligentes de outros projetos de blockchain (antes de tudo Ethereum). </p><br><p>  Este artigo tamb√©m √© um guia para quem deseja entender como os contratos inteligentes funcionam na rede Waves, tenta escrever seu pr√≥prio contrato e se familiarizar com as ferramentas que os desenvolvedores j√° t√™m √† sua disposi√ß√£o. </p><a name="habracut"></a><br><h2 id="kak-my-doshli-do-zhizni-takoy">  Como chegamos a essa vida? </h2><br><p>  Muitas vezes nos perguntam quando √© que conseguimos contratos inteligentes, porque os desenvolvedores gostaram da facilidade de trabalhar com a rede, da velocidade da rede (gra√ßas ao <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Waves NG</a> ) e do baixo n√≠vel de comiss√µes.  No entanto, contratos inteligentes oferecem muito mais espa√ßo para a imagina√ß√£o. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Os contratos inteligentes</a> se tornaram muito populares nos √∫ltimos anos devido √† dissemina√ß√£o da blockchain.  Aqueles que encontraram a tecnologia blockchain em seu trabalho, ao mencionar contratos inteligentes, geralmente pensam no Ethereum e no Solidity.  Mas existem muitas plataformas blockchain com contratos inteligentes, e a maioria delas simplesmente repetiu o que a Ethereum fez (m√°quina virtual + sua pr√≥pria linguagem de contrato).  Uma lista interessante com diferentes idiomas e abordagens est√° <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">neste reposit√≥rio</a> . </p><br><h2 id="chto-takoe-smart-kontrakt">  O que √© um contrato inteligente? </h2><br><p>  Em um sentido amplo, um contrato inteligente √© um protocolo projetado para suportar, verificar e fazer cumprir os termos de uma transa√ß√£o ou a execu√ß√£o de contratos entre as partes.  A id√©ia foi proposta pela primeira vez em 1996 por Nick Szabo, mas os contratos inteligentes se tornaram populares apenas nos √∫ltimos anos. </p><br><p>  Do ponto de vista t√©cnico (o que mais nos interessa), um contrato inteligente √© um algoritmo (c√≥digo) que n√£o √© executado em nenhum servidor ou computador, mas em muitos (ou todos) n√≥s da rede blockchain, ou seja,  descentralizado. </p><br><h2 id="kak-eto-rabotaet">  Como isso funciona? </h2><br><p>  O primeiro prot√≥tipo de um contrato inteligente na blockchain √© considerado corretamente o Bitcoin Script - incompleto por Turing, uma linguagem baseada em pilha na rede Bitcoin.  N√£o h√° conceito de conta no Bitcoin; em vez disso, existem entradas e sa√≠das.  No Bitcoin, ao fazer uma transa√ß√£o (criando uma sa√≠da), √© necess√°rio consultar a transa√ß√£o de recebimento (entrada).  Se voc√™ estiver interessado nos detalhes t√©cnicos do dispositivo Bitcoin, recomendo que voc√™ leia <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">esta s√©rie de artigos</a> .  Como n√£o h√° contas no Bitcoin, o Bitcoin Script determina em que casos uma ou outra sa√≠da pode ser gasta. </p><br><p> O Ethereum oferece muito mais recursos, como  Fornece Solidity, uma linguagem completa de Turing que √© executada em uma m√°quina virtual dentro de cada n√≥.  Com grande poder, vem grande responsabilidade, e com uma ampla gama de possibilidades - um n√∫mero bastante grande de restri√ß√µes, sobre as quais falaremos mais adiante. </p><br><h1 id="smart-kontrakty-waves">  Contratos inteligentes Waves </h1><br><p>  Como escrevi acima, muitas vezes nos perguntam sobre contratos inteligentes, mas n√£o quer√≠amos "gostar no ar" ou "como em qualquer nome de bloco", e h√° <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">muitas raz√µes para isso</a> .  Portanto, analisamos os casos existentes para contratos e como podemos ajudar a resolver problemas reais com a ajuda deles. </p><br><p>  Ap√≥s analisar os cen√°rios de uso, descobrimos que existem 2 grandes categorias de tarefas que geralmente s√£o resolvidas usando contratos inteligentes: </p><br><ol><li>  Tarefas simples e diretas, como multisig, swaps at√¥micos ou compromisso. </li><li>  dApps, aplicativos descentralizados completos com l√≥gica de usu√°rio.  Para ser mais preciso, este √© um back-end para aplicativos descentralizados.  Os exemplos mais impressionantes s√£o Cryptokitties ou Bancor. </li></ol><br><p>  H√° tamb√©m um terceiro tipo mais popular de contrato - tokens.  Na rede Ethereum, por exemplo, a grande maioria dos contratos de trabalho s√£o tokens padr√£o ERC20.  No Waves, para criar tokens, n√£o √© necess√°rio fazer contratos inteligentes, pois  eles fazem parte do pr√≥prio blockchain e, para emitir um token (com a capacidade de negoci√°-lo imediatamente em uma troca descentralizada (DEX)), basta enviar uma transa√ß√£o do tipo emiss√£o (transa√ß√£o de emiss√£o). </p><br><p>  Para os dois tipos de tarefas acima (por simplicidade, chamaremos de casos simples e complexos), os requisitos para a linguagem, contratos e conceitos s√£o muito diferentes.  Sim, podemos dizer que ter uma linguagem completa de Turing pode resolver problemas simples e complexos, mas h√° uma condi√ß√£o importante: a linguagem deve ajudar a evitar erros.  Esse requisito tamb√©m √© importante para idiomas comuns e, para idiomas inteligentes de contrato, √© especialmente importante, porque  as opera√ß√µes est√£o relacionadas financeiramente e os contratos geralmente s√£o imut√°veis, e n√£o h√° como corrigir um erro r√°pida e facilmente. </p><br><p>  Considerando os tipos de tarefas descritos acima, decidimos avan√ßar gradualmente e fornecer uma ferramenta para resolver problemas simples como o primeiro passo e fornecer uma linguagem que possa implementar facilmente qualquer l√≥gica do usu√°rio no pr√≥ximo passo.  Como resultado, o sistema acabou sendo muito mais poderoso do que imagin√°vamos no in√≠cio da jornada. </p><br><h2 id="sdelaem-akkaunty-umnymi">  Vamos tornar as contas inteligentes </h2><br><p>  Gradualmente, chegamos ao conceito de contas inteligentes, projetadas para resolver tarefas principalmente simples.  A ideia deles √© muito semelhante ao Bitcoin Script: regras adicionais podem ser adicionadas √† conta que determinam a validade da transa√ß√£o de sa√≠da.  Os principais requisitos para contas inteligentes foram: </p><br><ol><li>  Seguran√ßa m√°xima.  Quase todo m√™s voc√™ encontra <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">not√≠cias de</a> que outra vulnerabilidade foi encontrada nos contratos do modelo Ethereum.  Quer√≠amos evitar isso. </li><li>  N√£o h√° necessidade de g√°s, para que a comiss√£o seja fixa.  Para fazer isso, o script deve ser executado em um tempo previs√≠vel e ter limites de tamanho bastante r√≠gidos. </li></ol><br><p>  Antes de prosseguir com os detalhes t√©cnicos da implementa√ß√£o e reda√ß√£o de contratos, descrevemos algumas caracter√≠sticas da blockchain Waves que ser√£o importantes para um entendimento mais aprofundado: </p><br><ol><li>  A blockchain Waves atualmente possui <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">13 tipos diferentes de transa√ß√µes.</a> </li></ol><br><p><img src="https://habrastorage.org/webt/dx/to/mz/dxtomzcjjyp7jgwa9wcsmfana1u.png"></p><br><ol><li>  Na blockchain Waves, n√£o entradas e sa√≠das (como no Bitcoin), mas contas (como, por exemplo, no Nxt).  Uma transa√ß√£o √© realizada em nome de uma conta espec√≠fica. </li><li>  Por padr√£o, a corre√ß√£o de uma transa√ß√£o √© determinada pelo estado atual da blockchain e pela validade da assinatura em nome da qual a transa√ß√£o √© enviada.  A representa√ß√£o JSON da transa√ß√£o parece bastante simples: </li></ol><br><p><img src="https://habrastorage.org/webt/gl/0a/m-/gl0am-s8dyjwnsgnksk0tf1fzyu.png"></p><br><p> Como j√° temos tipos diferentes de transa√ß√µes na blockchain, decidimos que n√£o far√≠amos uma entidade separada como uma conta inteligente, mas adicionar√≠amos uma nova transa√ß√£o que transforma uma conta regular em uma conta inteligente.  Qualquer conta pode se tornar uma conta inteligente com regras de valida√ß√£o de transa√ß√£o alteradas; para isso, a conta deve simplesmente enviar uma transa√ß√£o do tipo <code>SetScriptTransaction</code> , que cont√©m o contrato compilado. </p><br><p>  No caso de uma conta inteligente, o contrato √© uma regra de valida√ß√£o para cada transa√ß√£o de sa√≠da. </p><br><h2 id="a-chto-tam-s-gazom">  E o g√°s? </h2><br><p>  Uma das principais tarefas que estabelecemos para n√≥s mesmos √© livrar-nos do g√°s para opera√ß√µes simples.  Isso n√£o significa que n√£o haver√° comiss√£o.  √â necess√°rio para que os mineradores tenham interesse em executar scripts.  Abordamos a quest√£o do lado pr√°tico e decidimos realizar testes de desempenho e calcular a velocidade de v√°rias opera√ß√µes.  Para isso, foram desenvolvidos benchmarks usando JMH.  Os resultados podem ser vistos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> .  As limita√ß√µes resultantes s√£o: </p><br><ol><li>  O script deve executar mais rapidamente do que 20 opera√ß√µes de verifica√ß√£o de assinatura, o que significa que as verifica√ß√µes de uma conta inteligente n√£o ser√£o 20 vezes mais lentas do que as de uma conta normal.  O tamanho do script n√£o deve exceder 8 KB. </li><li>  Para tornar lucrativo para os mineradores cumprir contratos inteligentes, estabelecemos uma comiss√£o adicional m√≠nima para contas inteligentes no valor de 0,004 WAVES.  A comiss√£o m√≠nima na rede Waves para uma transa√ß√£o √© 0,001 WAVES, no caso de uma conta inteligente - 0,005 WAVES. </li></ol><br><h1 id="yazyk-dlya-smart-kontraktov">  Idioma para contratos inteligentes </h1><br><p>  Uma das tarefas mais dif√≠ceis foi a cria√ß√£o de sua pr√≥pria linguagem de contratos inteligentes.  Pegar qualquer linguagem completa de turing existente e adaptar (aparar) para nossas tarefas parece estar disparando de um canh√£o para pardais: al√©m disso, dependendo da base de c√≥digo de outra pessoa em um projeto de blockchain √© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">extremamente arriscado</a> . </p><br><p>  Vamos tentar imaginar qual deve ser a linguagem ideal para contratos inteligentes.  Na minha opini√£o, qualquer linguagem de programa√ß√£o deve for√ßar a escrever c√≥digo "correto" e seguro, ou seja,  idealmente, deve haver um caminho certo.  Sim, se voc√™ quiser, pode escrever c√≥digo completamente ileg√≠vel e sem suporte em qualquer idioma, mas isso deve ser mais dif√≠cil do que escrev√™-lo corretamente (ol√° PHP e JavaScript).  Ao mesmo tempo, a linguagem deve ser conveniente para o desenvolvimento.  Como o idioma √© executado em todos os n√≥s da rede, √© necess√°rio que seja o mais eficiente poss√≠vel - a execu√ß√£o lenta pode economizar bastante recursos.  Eu tamb√©m gostaria de ter um sistema de tipos poderoso na linguagem, de prefer√™ncia alg√©brico, porque ajuda a descrever o contrato da forma mais clara poss√≠vel e aproximar-me do sonho de "C√≥digo √© lei".  Se formalizarmos um pouco mais nossos requisitos, obteremos os seguintes par√¢metros de idioma: </p><br><ol><li>  Ser digitado estrita e estaticamente.  A digita√ß√£o forte elimina automaticamente muitos erros potenciais do programador. </li><li>  Tenha um sistema de tipos poderoso para dificultar o tiro no p√©. </li><li>  Seja pregui√ßoso para n√£o perder preciosos ciclos do processador. </li><li>  Possui fun√ß√µes espec√≠ficas na biblioteca padr√£o para trabalhar com blockchain, por exemplo, hashes.  Ao mesmo tempo, a biblioteca de idiomas padr√£o n√£o deve estar sobrecarregada, porque sempre deve haver um caminho certo. </li><li>  N√£o h√° exce√ß√µes em tempo de execu√ß√£o. </li></ol><br><p>  Em nossa linguagem RIDE, tentamos levar esses recursos importantes em considera√ß√£o e, como desenvolvemos muito no Scala e como programa√ß√£o funcional, a linguagem em alguns aspectos √© semelhante ao Scala e ao F #. </p><br><p>  Os maiores problemas na implementa√ß√£o na pr√°tica surgiram com o √∫ltimo requisito, porque se voc√™ n√£o tiver exce√ß√µes no idioma, por exemplo, a opera√ß√£o de adi√ß√£o precisar√° retornar uma <em>Op√ß√£o</em> , que precisar√° ser verificada quanto ao estouro, o que definitivamente ser√° inconveniente para os desenvolvedores.  As exce√ß√µes eram um compromisso, mas sem a capacidade de captur√°-las - se houvesse uma exce√ß√£o, a transa√ß√£o era inv√°lida.  Outro problema foi transferir para a linguagem todos os modelos de dados que temos na blockchain.  Eu j√° descrevi que no Waves existem 13 tipos diferentes de transa√ß√µes que devem ser suportadas no idioma e ter acesso a todos os seus campos. </p><br><p>  Informa√ß√µes completas sobre opera√ß√µes dispon√≠veis e tipos de dados no RIDE est√£o na <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">p√°gina de descri√ß√£o do idioma</a> .  Entre os recursos interessantes da linguagem, tamb√©m podemos destacar o fato de que a linguagem √© baseada em express√µes, ou seja, tudo √© express√£o, bem como a presen√ßa de correspond√™ncia de padr√µes, que permite descrever convenientemente as condi√ß√µes para diferentes tipos de transa√ß√µes: </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">match</span></span> tx { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> t:<span class="hljs-type"><span class="hljs-type">TransferTransaction</span></span> =&gt; t.recepient <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> t:<span class="hljs-type"><span class="hljs-type">MassTransferTransaction</span></span> =&gt; t.transfers <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> _ =&gt; <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> }</code> </pre> <br><p>  Qualquer pessoa interessada em aprender como funciona o trabalho com o c√≥digo RIDE vale a pena conferir o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">white paper</a> , que descreve todas as etapas do trabalho com um contrato: an√°lise, compila√ß√£o, desserializa√ß√£o, c√°lculo da complexidade e execu√ß√£o do script.  Os dois primeiros est√°gios - a an√°lise e a compila√ß√£o s√£o realizadas fora da cadeia, apenas o contrato compilado na base64 entra no blockchain.  A desserializa√ß√£o, o c√°lculo da complexidade e a execu√ß√£o s√£o feitos on-chain e v√°rias vezes em diferentes est√°gios: </p><br><ol><li>  Quando voc√™ recebe uma transa√ß√£o e a adiciona √† UTX, caso contr√°rio, haver√° uma situa√ß√£o em que a transa√ß√£o ser√° aceita pelo n√≥ blockchain, por exemplo, atrav√©s da API REST, mas nunca entrar√° no bloco. </li><li>  Quando um bloco √© formado, o n√≥ de minera√ß√£o valida transa√ß√µes e o script √© necess√°rio. </li><li>  Ap√≥s o recebimento, por n√≥s n√£o mineradores, de um bloco e a valida√ß√£o das transa√ß√µes inclu√≠das nele. </li></ol><br><p>  Cada otimiza√ß√£o no trabalho com contratos se torna valiosa, porque √© realizada v√°rias vezes em muitos n√≥s da rede.  Agora, os n√≥s Waves s√£o executados silenciosamente em m√°quinas virtuais por US $ 15 na DigitalOcean, apesar do aumento nas cargas de trabalho ap√≥s o lan√ßamento de contas inteligentes. </p><br><h2 id="a-chto-v-itoge">  Qual √© o resultado? </h2><br><p>  Agora vamos ver o que conseguimos no Waves.  Escreveremos nosso primeiro contrato, seja um contrato multisig padr√£o 2-de-3.  Para escrever um contrato, voc√™ pode usar o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">IDE online</a> (ajuste para o idioma - um t√≥pico para um artigo separado).  Crie um novo contrato vazio (Novo ‚Üí Contrato Vazio). </p><br><p>  Primeiro, anunciaremos as chaves p√∫blicas de Alice, Bob e Cooper, que controlar√£o a conta.  Voc√™ precisar√° de duas das tr√™s assinaturas: </p><br><pre> <code class="scala hljs">let alicePubKey = base58<span class="hljs-symbol"><span class="hljs-symbol">'B1Yz7fH1bJ2gVDjyJnuyKNTdMFARkKEp</span></span>V' let bobPubKey = base58<span class="hljs-symbol"><span class="hljs-symbol">'7hghYeWtiekfebgAcuCg9ai2NXbRreNz</span></span>c' let cooperPubKey = base58<span class="hljs-symbol"><span class="hljs-symbol">'BVqYXrapgJP9atQccdBPAgJPwHDKkh6A</span></span>8'</code> </pre> <br><p>  A <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">documenta√ß√£o descreve</a> a fun√ß√£o <code>sigVerify</code> , que permite verificar a assinatura da transa√ß√£o: </p><br><p><img src="https://habrastorage.org/webt/fw/am/py/fwampygopgdhgrmb9v4z67mkszq.png"></p><br><p>  Os argumentos para a fun√ß√£o s√£o o corpo da transa√ß√£o, a assinatura verificada e a chave p√∫blica.  Um objeto <code>tx</code> est√° dispon√≠vel no contrato no escopo global, no qual as informa√ß√µes da transa√ß√£o s√£o armazenadas.  Este objeto possui um campo <code>tx.bodyBytes</code> que cont√©m os bytes da transa√ß√£o que est√° sendo enviada.  H√° tamb√©m uma variedade de <code>tx.proofs</code> , que armazena assinaturas, que podem ter at√© 8. Vale a pena notar que, de fato, voc√™ pode enviar n√£o apenas assinaturas para <code>tx.proofs</code> , mas qualquer outra informa√ß√£o que possa ser usada pelo contrato. </p><br><p>  Podemos garantir que todas as assinaturas sejam apresentadas e estejam na ordem correta usando tr√™s linhas simples: </p><br><pre> <code class="scala hljs">let aliceSigned = <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(sigVerify(tx.bodyBytes, tx.proofs[<span class="hljs-number"><span class="hljs-number">0</span></span>], alicePubKey )) then <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> let bobSigned = <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(sigVerify(tx.bodyBytes, tx.proofs[<span class="hljs-number"><span class="hljs-number">1</span></span>], bobPubKey )) then <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> let cooperSigned = <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(sigVerify(tx.bodyBytes, tx.proofs[<span class="hljs-number"><span class="hljs-number">2</span></span>], cooperPubKey )) then <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre> <br><p>  Bem, o √∫ltimo passo ser√° verificar se pelo menos 2 assinaturas foram enviadas. </p><br><pre> <code class="scala hljs">aliceSigned + bobSigned + cooperSigned &gt;= <span class="hljs-number"><span class="hljs-number">2</span></span></code> </pre> <br><p>  Todo o contrato 2 de 3 com v√°rias assinaturas se parece com o seguinte: </p><br><pre> <code class="scala hljs">#    let alicePubKey = base58<span class="hljs-symbol"><span class="hljs-symbol">'B1Yz7fH1bJ2gVDjyJnuyKNTdMFARkKEp</span></span>V' let bobPubKey = base58<span class="hljs-symbol"><span class="hljs-symbol">'7hghYeWtiekfebgAcuCg9ai2NXbRreNz</span></span>c' let cooperPubKey = base58<span class="hljs-symbol"><span class="hljs-symbol">'BVqYXrapgJP9atQccdBPAgJPwHDKkh6A</span></span>8' #       let aliceSigned = <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(sigVerify(tx.bodyBytes, tx.proofs[<span class="hljs-number"><span class="hljs-number">0</span></span>], alicePubKey )) then <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> let bobSigned = <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(sigVerify(tx.bodyBytes, tx.proofs[<span class="hljs-number"><span class="hljs-number">1</span></span>], bobPubKey )) then <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> let cooperSigned = <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(sigVerify(tx.bodyBytes, tx.proofs[<span class="hljs-number"><span class="hljs-number">2</span></span>], cooperPubKey )) then <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> # ,      <span class="hljs-number"><span class="hljs-number">2</span></span>   aliceSigned + bobSigned + cooperSigned &gt;= <span class="hljs-number"><span class="hljs-number">2</span></span></code> </pre> <br><p>  Observe: n√£o h√° palavras-chave como <code>return</code> no c√≥digo, porque a √∫ltima linha executada √© considerada o resultado do script, e √© por isso que sempre deve retornar <code>true</code> ou <code>false</code> </p><br><p>  Em compara√ß√£o, o contrato comum de v√°rias assinaturas da Ethereum <a href="">parece muito mais complicado</a> .  Mesmo varia√ß√µes relativamente simples s√£o assim: </p><br><pre> <code class="plaintext hljs"> pragma solidity ^0.4.22; contract SimpleMultiSig { uint public nonce; // (only) mutable state uint public threshold; // immutable state mapping (address =&gt; bool) isOwner; // immutable state address[] public ownersArr; // immutable state // Note that owners_ must be strictly increasing, in order to prevent duplicates constructor(uint threshold_, address[] owners_) public { require(owners_.length &lt;= 10 &amp;&amp; threshold_ &lt;= owners_.length &amp;&amp; threshold_ &gt;= 0); address lastAdd = address(0); for (uint i = 0; i &lt; owners_.length; i++) { require(owners_[i] &gt; lastAdd); isOwner[owners_[i]] = true; lastAdd = owners_[i]; } ownersArr = owners_; threshold = threshold_; } // Note that address recovered from signatures must be strictly increasing, in order to prevent duplicates function execute(uint8[] sigV, bytes32[] sigR, bytes32[] sigS, address destination, uint value, bytes data) public { require(sigR.length == threshold); require(sigR.length == sigS.length &amp;&amp; sigR.length == sigV.length); // Follows ERC191 signature scheme: https://github.com/ethereum/EIPs/issues/191 bytes32 txHash = keccak256(byte(0x19), byte(0), this, destination, value, data, nonce); address lastAdd = address(0); // cannot have address(0) as an owner for (uint i = 0; i &lt; threshold; i++) { address recovered = ecrecover(txHash, sigV[i], sigR[i], sigS[i]); require(recovered &gt; lastAdd &amp;&amp; isOwner[recovered]); lastAdd = recovered; } // If we make it here all signatures are accounted for. // The address.call() syntax is no longer recommended, see: // https://github.com/ethereum/solidity/issues/2884 nonce = nonce + 1; bool success = false; assembly { success := call(gas, destination, value, add(data, 0x20), mload(data), 0, 0) } require(success); } function () payable public {} }</code> </pre> <br><p>  O IDE possui um console interno que permite compilar imediatamente um contrato, implant√°-lo, criar transa√ß√µes e ver o resultado da execu√ß√£o.  E se voc√™ quiser trabalhar seriamente com contratos, recomendo procurar nas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">bibliotecas diferentes idiomas</a> e no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">plug</a> - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">in do Visual Studio Code</a> . </p><br><p>  Se suas m√£os estiverem com coceira, no final do artigo existem os links mais importantes para iniciar o mergulho. </p><br><h2 id="sistema-moschnee-chem-yazyk">  O sistema √© mais poderoso que o idioma </h2><br><p>  A blockchain Waves possui tipos de dados especiais para armazenamento de dados - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">transa√ß√µes de dados</a> .  Eles funcionam como armazenamento de valor-chave associado a uma conta, ou seja, de certa forma, esse √© o estado da conta. </p><br><p><img src="https://habrastorage.org/webt/3o/oh/4h/3ooh4hitfov4sdfhobfhglpec98.png"></p><br><p>  A data da transa√ß√£o pode conter cadeias, n√∫meros, valores booleanos e matrizes de bytes de at√© 32 KB por chave.  Um exemplo de trabalho com transa√ß√µes de dados, que permite enviar uma transa√ß√£o apenas se o armazenamento de valores-chave da conta j√° contiver o n√∫mero 42 na chave de <code>key</code> : </p><br><pre> <code class="scala hljs">let keyName = <span class="hljs-string"><span class="hljs-string">"key"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">match</span></span> (tx) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> tx:<span class="hljs-type"><span class="hljs-type">DataTransaction</span></span> =&gt; let x = extract(getInteger(tx.sender, keyName)) x == <span class="hljs-number"><span class="hljs-number">42</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> _ =&gt; <span class="hljs-literal"><span class="hljs-literal">false</span></span> }</code> </pre> <br><blockquote>  Gra√ßas √† transa√ß√£o de dados, as contas inteligentes se tornam uma ferramenta extremamente poderosa que permite trabalhar com or√°culos, gerenciar estado e descrever convenientemente o comportamento. </blockquote><p><img src="https://habrastorage.org/webt/ew/ce/gf/ewcegfy0nsj4s8t34c6sn2v7hew.png"></p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Este artigo</a> descreve como voc√™ pode implementar NFT (tokens n√£o fung√≠veis) usando transa√ß√µes de dados e um contrato inteligente que controla o estado.  Como resultado, o estilo da conta conter√° entradas como: </p><br><pre> <code class="plaintext hljs">+------------+-----------------------------------------------+ | Token Name | Owner Publc Key | +------------+-----------------------------------------------+ | "Token #1" | "6iQaHazE9NVAJfAjMpHifDXMfr1euWcy8fmW6rNcdhr" | | "Token #2" | "3tNLxyJnyxLzDkMkqiZmUjRqXe1UuwFeSyQ14GRYnGL" | | "Token #3" | "3wH7rENpbS78uohErXHq77yKzQwRyKBYhzCR9nKU17q" | | "Token #4" | "6iQaHazE9NVAJfAjMpHifDXMfr1euWcy8fmW6rNcdhr" | | "Token #5" | "6iQaHazE9NVAJfAjMpHifDXMfr1euWcy8fmW6rNcdhr" | +------------+-----------------------------------------------+</code> </pre> <br><p>  O contrato da NFT parece extremamente simples: </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">match</span></span> tx { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> dt: <span class="hljs-type"><span class="hljs-type">DataTransaction</span></span> =&gt; let oldOwner = extract(getString(dt.sender, dt.data[<span class="hljs-number"><span class="hljs-number">0</span></span>].key)) let newOwner = getBinary(dt.data, <span class="hljs-number"><span class="hljs-number">0</span></span>) size(dt.data) == <span class="hljs-number"><span class="hljs-number">1</span></span> &amp;&amp; sigVerify(dt.bodyBytes, dt.proofs[<span class="hljs-number"><span class="hljs-number">0</span></span>], fromBase58String(oldOwner)) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> _ =&gt; <span class="hljs-literal"><span class="hljs-literal">false</span></span> }</code> </pre> <br><h1 id="a-chto-dalshe">  O que vem a seguir? </h1><br><p>  O desenvolvimento adicional de contratos inteligentes da Waves √© o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Ride4DApps</a> , que permitir√° a chamada de contratos em outras contas, e um idioma (ou sistema) completo de Turing que permitir√° resolver todos os tipos de tarefas, acionar outras tarefas etc. </p><br><p>  Outra dire√ß√£o interessante para o desenvolvimento de contratos inteligentes no ecossistema Waves √© o Smart Assets, que trabalha com um princ√≠pio semelhante - contratos incompletos de Turing relacionados ao token.  O contrato controla as condi√ß√µes sob as quais as transa√ß√µes de token podem ser conclu√≠das.  Por exemplo, com a ajuda deles, ser√° poss√≠vel congelar tokens at√© uma certa altura de blockchain ou proibir a negocia√ß√£o de token p2p.  Voc√™ pode ler mais sobre ativos inteligentes <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">no blog</a> . </p><br><p>  Bem, no final, darei mais uma lista do que ser√° necess√°rio para come√ßar a trabalhar com contratos inteligentes na rede Waves. </p><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">A documenta√ß√£o</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">IDE com console</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">White paper para os mais curiosos</a> </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt440702/">https://habr.com/ru/post/pt440702/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt440690/index.html">Recursos do trabalho com o Mesh in Unity</a></li>
<li><a href="../pt440692/index.html">O que h√° de errado com o teste A / B</a></li>
<li><a href="../pt440694/index.html">Crie uma cena b√°sica no A-Frame</a></li>
<li><a href="../pt440696/index.html">Kit de Ferramentas de Refatora√ß√£o de Banco de Dados: Flyway vs. Liquibase</a></li>
<li><a href="../pt440698/index.html">6 id√©ias interessantes de aplicativos de realidade aumentada (AR)</a></li>
<li><a href="../pt440706/index.html">Confer√™ncia profissional da IoT da InoThings ++ - O que foi e o que ser√°</a></li>
<li><a href="../pt440708/index.html">Semin√°rio on-line aberto "Trabalho: um e outro"</a></li>
<li><a href="../pt440710/index.html">Dois aspectos do WebView: sobre o in√≠cio r√°pido de projetos e o roubo de dados pessoais</a></li>
<li><a href="../pt440712/index.html">A nuvem √© apenas o computador de algu√©m</a></li>
<li><a href="../pt440714/index.html">Como a redu√ß√£o da taxa de aquisi√ß√£o nos afeta (portadores de cart√£o)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>