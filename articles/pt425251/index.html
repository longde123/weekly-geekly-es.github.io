<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©‚Äç‚öïÔ∏è üò¥ üå≥ LoJax: o primeiro rootkit UEFI conhecido usado em uma campanha maliciosa ü§∑üèø üëª ‚úãüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="O Sednit Cybergroup, tamb√©m conhecido como ART28, Strontium e Fancy Bear, opera desde pelo menos 2004. Acredita-se que o grupo esteja por tr√°s de uma ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>LoJax: o primeiro rootkit UEFI conhecido usado em uma campanha maliciosa</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/eset/blog/425251/">  O Sednit Cybergroup, tamb√©m conhecido como ART28, Strontium e Fancy Bear, opera desde pelo menos 2004.  Acredita-se que o grupo esteja por tr√°s de uma s√©rie de ataques cibern√©ticos ressonantes.  Algumas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">empresas do IB</a> e o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Departamento de Justi√ßa dos EUA</a> chamaram Sednit respons√°vel por invadir o Comit√™ Nacional Democrata antes das elei√ß√µes de 2016 nos EUA.  O grupo √© acusado de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">hackear a</a> rede global de televis√£o TV5Monde, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">vazamento de</a> e-mails da Ag√™ncia Mundial Antidopagem (WADA) e outros incidentes.  Sednit tem muitos objetivos e uma ampla gama de ferramentas, algumas das quais j√° <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">documentamos</a> anteriormente, mas pela primeira vez neste trabalho descreveremos em detalhes o uso do rootkit UEFI. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ai/yf/nq/aiyfnqxa7dzic4myqh6eircpapo.jpeg"></div><br><a name="habracut"></a><h2>  Breve revis√£o </h2><br>  Descobrimos que, pelo menos desde o in√≠cio de 2017, a Sednit usa uma vers√£o trojanizada do antigo agente de usu√°rio do programa para proteger os dispositivos contra roubo pelo desenvolvedor do Absolute Software - LoJack.  A ferramenta atraiu a aten√ß√£o dos profissionais de seguran√ßa da informa√ß√£o devido ao uso do m√≥dulo UEFI / BIOS como mecanismo para garantir a persist√™ncia.  Chamamos a vers√£o <b>trojanizada</b> deste programa de <b>LoJax</b> . <br><br>  A presen√ßa de ferramentas Sednit conhecidas em sistemas infectados, juntamente com amostras LoJax, bem como o fato de que alguns servidores de comando usados ‚Äã‚Äãpor agentes trojanizados faziam parte da infraestrutura Sednit, permite associar de forma confi√°vel um rootkit UEFI a esse grupo. <br><br>  Juntamente com os agentes LoJax, foram descobertas ferramentas para ler o firmware do sistema UEFI e, em um dos casos, essa ferramenta poderia despejar, corrigir e reescrever parte da mem√≥ria flash SPI do sistema.  O objetivo final da ferramenta √© instalar um m√≥dulo UEFI mal-intencionado em um sistema cuja prote√ß√£o SPI flash √© vulner√°vel ou configurada incorretamente. <br><br>  O m√≥dulo UEFI √© respons√°vel pela implementa√ß√£o do agente LoJax no sistema; este √© o primeiro rootkit identificado pela UEFI do grupo Sednit.  Como est√° no firmware do sistema, ele pode sobreviver √† reinstala√ß√£o do Windows e √† substitui√ß√£o do disco r√≠gido. <br><br>  Houve pelo menos um caso em que este rootkit foi instalado com sucesso na mem√≥ria flash SPI do sistema.  De acordo com nossas informa√ß√µes, este √© o primeiro rootkit UEFI descoberto in-the-wild. <br><br><h2>  1. Introdu√ß√£o </h2><br>  O Sednit usa v√°rias fam√≠lias de malware.  Uma descri√ß√£o detalhada das ferramentas de grupo usadas com freq√º√™ncia que fornecemos no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">relat√≥rio</a> . <br><br>  Temos acompanhado a atividade da Sednit h√° v√°rios anos e divulgamos muitos relat√≥rios sobre o trabalho do grupo, desde <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">descri√ß√µes de</a> vulnerabilidades de dia zero at√© programas personalizados como o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Zebrocy</a> .  Os componentes descritos neste relat√≥rio formam um grupo separado. <br><br>  Os rootkits UEFI foram descritos em relat√≥rios de empresas de seguran√ßa da informa√ß√£o anteriormente.  Por exemplo, o rkloader, que apareceu em uma <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">apresenta√ß√£o</a> sobre vazamento de dados na equipe de hackers, e o DerStarke, um implante no macOS EFI / UEFI download, dos documentos do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Vault7</a> , s√£o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">conhecidos</a> .  Estamos cientes da exist√™ncia dessas ferramentas, no entanto, nenhum relat√≥rio de comprometimento da UEFI foi emitido pelos rootkits. <br><br>  Agora, n√£o apenas provamos o uso de firmware in-the-wild com o mal-intencionado m√≥dulo LoJax UEFI, mas tamb√©m encontramos toda a gama de ferramentas que provavelmente foram usadas para instal√°-lo.  √â interessante notar que o Sednit usa o kit de inicializa√ß√£o DownDelph, que foi usado em 2013 e 2014 para manter o Downdelph, um dos primeiros backdoors do Sednit em est√°gio inicial.  A id√©ia √© semelhante, mas na nova vers√£o do UEFI, o uso de bootkits n√£o √© mais poss√≠vel.  Assim, esses dois componentes diferem significativamente no comportamento. <br><br>  Este trabalho est√° dividido em tr√™s se√ß√µes.  No primeiro, analisaremos os primeiros estudos de seguran√ßa LoJack / Computrace e o potencial de uso malicioso do programa.  A segunda se√ß√£o √© dedicada ao processo de pesquisa, que finalmente nos levou ao UEFI rootkit.  Finalmente, na terceira se√ß√£o, descrevemos em detalhes os v√°rios componentes LoJax e como eles fornecem persist√™ncia no sistema, mesmo ap√≥s a reinstala√ß√£o do Windows e a substitui√ß√£o do disco r√≠gido. <br><br><h4>  Atribui√ß√£o </h4><br>  Embora muitos fornecedores j√° tenham feito declara√ß√µes sobre o grupo Sednit no passado, a ESET de forma alguma determina sua afilia√ß√£o geopol√≠tica.  Desde a publica√ß√£o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">do estudo de</a> 2016, nossa posi√ß√£o n√£o mudou.  Determinar a fonte de um ataque cibern√©tico com base em uma abordagem cient√≠fica √© uma tarefa complexa que est√° al√©m do escopo de compet√™ncias dos especialistas da ESET.  O que chamamos de "grupo Sednit" √© apenas um conjunto de software e uma infraestrutura de rede associada que n√£o podemos associar autoritariamente a nenhuma organiza√ß√£o em particular. <br><br><h4>  Objetivos </h4><br>  Durante o estudo, encontramos um pequeno n√∫mero de imagens LoJax diferentes.  Com base em nossos dados de telemetria e em um estudo de outros programas Sednit descobertos na natureza, estamos confiantes de que esse m√≥dulo espec√≠fico raramente foi usado em compara√ß√£o com outras ferramentas.  Os objetivos, principalmente, eram organiza√ß√µes estatais localizadas nos Balc√£s, na Europa Central e Oriental. <br><br><h2>  Pesquisa sobre Computertrace / LoJack </h2><br>  LoJack - software para proteger computadores contra roubo e perda, desenvolvido pela Absolute Software Corporation.  As vers√µes anteriores do agente s√£o conhecidas como Computrace.  Como o nome anterior indica, ap√≥s a ativa√ß√£o do servi√ßo, o computador pode acessar seu servidor de comando - o propriet√°rio ser√° notificado sobre a localiza√ß√£o do dispositivo em caso de perda ou roubo. <br><br>  A se√ß√£o abaixo descreve a arquitetura anterior do LoJack.  Somente a vers√£o antiga do software foi Trojaned por criminosos cibern√©ticos, portanto, focaremos nisso.  Al√©m disso, a Absolute Software lan√ßou em maio de 2018 uma <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">declara√ß√£o</a> informando que as vulnerabilidades descritas abaixo n√£o afetam a opera√ß√£o das vers√µes mais recentes de seus agentes. <br><br>  O programa Computrace atraiu a aten√ß√£o dos profissionais de seguran√ßa da informa√ß√£o porque usava um m√©todo incomum de garantir persist√™ncia.  Seu objetivo √© proteger contra roubo, portanto, √© importante que seja resistente √† reinstala√ß√£o do SO e √† substitui√ß√£o do disco r√≠gido - tudo isso √© implementado no m√≥dulo UEFI / BIOS que pode sobreviver ap√≥s essas a√ß√µes.  A solu√ß√£o √© pr√©-instalada no firmware de uma parte significativa de laptops de diferentes fabricantes, o usu√°rio precisa apenas ativar esta fun√ß√£o.  A ativa√ß√£o pode ser feita no BIOS, como mostrado na figura abaixo. <br><br><img src="https://habrastorage.org/webt/rf/vx/i_/rfvxi_hexr1f29e0hqddhak97ag.png"><br>  <i>Figura 1. Ativando o Computrace no BIOS</i> <br><br>  Um dos primeiros relat√≥rios de implementa√ß√£o do LoJack / Computrace foi publicado em 2009.  A arquitetura global do produto, a libera√ß√£o do m√≥dulo UEFI / BIOS do agente do usu√°rio em disco e a maneira como o agente se comunica com um servidor da Web controlado pela Absolute Software foram divulgadas.  O diagrama pode ser entendido na figura abaixo. <br><br><img src="https://habrastorage.org/webt/mh/5a/u2/mh5au2bhmrriy8sn8dtsd1g1avw.png"><br>  <i>Figura 2. Mecanismo de persist√™ncia LoJack (aproximadamente 2008)</i> <br><br>  A seguir, √© apresentada uma descri√ß√£o das etapas listadas acima: <br><br>  1. Se ativado, o m√≥dulo UEFI / BIOS √© executado no momento da inicializa√ß√£o.  Ele est√° tentando encontrar a parti√ß√£o FAT / FAT32 / NTFS.  Em seguida, usando o driver NTFS, ele cria um backup do arquivo <code>autochk.exe</code> e sobrescreve seu conte√∫do com o conta-gotas, respons√°vel pela instala√ß√£o do componente do agente do usu√°rio.  O arquivo <code>autochk.exe</code> √© um arquivo execut√°vel do Windows iniciado no est√°gio inicial da inicializa√ß√£o do sistema para verificar poss√≠veis danos ao disco r√≠gido. <br><br>  2. Quando o <code>autochk.exe</code> modificado <code>autochk.exe</code> iniciado, seu objetivo principal √© implementar o mini-agente <code>rpcnetp.exe</code> e adicion√°-lo como um servi√ßo, para que ele seja iniciado sempre que for reiniciado.  A etapa final neste componente √© restaurar a vers√£o original do <code>autochk.exe</code> . <br><br>  3. Mini-agente <code>rpcnetp.exe</code> - um pequeno arquivo execut√°vel, cujo objetivo √© garantir a opera√ß√£o do agente principal.  Se o agente prim√°rio n√£o funcionar, o <code>rpcnetp.exe</code> tentar√° se conectar ao servidor de comando Absolute Software C&amp;C para fazer o download e execut√°-lo.  Primeiro, o mini-agente far√° uma c√≥pia de si mesmo e, em seguida, far√° altera√ß√µes no cabe√ßalho do PE para converter em uma DLL.  Esta biblioteca √© ent√£o carregada na mem√≥ria, chama o processo <code>svchost.exe</code> e injeta a DLL l√°.  Em seguida, o processo do Internet Explorer <code>iexplore.exe</code> √© iniciado e a DLL √© injetada nele.  O √∫ltimo processo ser√° usado para comunica√ß√£o pela Internet.  A inje√ß√£o de mini-agentes da Computrace em processos de terceiros geralmente √© encontrada em malware e raramente √© associada a software leg√≠timo. <br><br>  4. Agora, um agente totalmente funcional est√° em execu√ß√£o no sistema e pode usar as fun√ß√µes do Computrace para rastreamento e recupera√ß√£o. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Uma descri√ß√£o</a> desse processo e o protocolo de rede envolvido entre o miniagente e o servidor C&amp;C foi publicado em 2014.  Devido √† falta de um mecanismo de autentica√ß√£o, se os invasores controlarem o servidor com o qual o mini-agente se comunica, eles podem for√ß√°-lo a baixar c√≥digo arbitr√°rio.  Existem v√°rios mecanismos que permitem que os atacantes entrem em contato diretamente com o mini-agente.  O mais importante para n√≥s usa o m√©todo de obter o endere√ßo do servidor C&amp;C pelo mini-agente.  De fato, essas informa√ß√µes s√£o armazenadas no arquivo de configura√ß√£o no pr√≥prio arquivo execut√°vel. <br><br><img src="https://habrastorage.org/webt/qc/ww/es/qcwwesoicwoyw1aghae1smpgnao.png"><br>  <i>Figura 3. Arquivo de configura√ß√£o de descriptografia parcial LoJack criptografada √† direita</i> <br><br>  A figura mostra o arquivo de configura√ß√£o do mini-agente LoJack.  O m√©todo de "criptografia" usado √© um XOR simples com uma chave de byte √∫nico.  A tecla 0xB5 √© a mesma para todos os mini-agentes estudados.  Como pode ser visto na figura, o dom√≠nio C&amp;C √© especificado no arquivo  Os quatro bytes anteriores cont√™m o endere√ßo IP do servidor C&amp;C.  Na aus√™ncia de valida√ß√£o do conte√∫do do arquivo de configura√ß√£o, os invasores com permiss√µes de grava√ß√£o em <code>%WINDIR%</code> podem alterar seu conte√∫do para que o mini-agente se comunique com seu servidor de comandos, em vez de leg√≠timo.  Compreendendo o protocolo de rede, voc√™ pode fazer o mini-agente baixar e executar c√≥digo arbitr√°rio.  Esses riscos s√£o conhecidos h√° muito tempo, mas at√© recentemente, o mecanismo n√£o era usado na pr√°tica. <br><br><h4>  LoJack se transforma em LoJax </h4><br>  Em maio de 2018, as amostras Trobor do mini-agente LoJack, rpcnetp.exe, foram descritas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">no blog da</a> Arbor Network.  Suas configura√ß√µes de rede codificadas foram alteradas para que amostras maliciosas estabelecessem uma conex√£o com o servidor C&amp;C do invasor, em vez do servidor leg√≠timo da Absolute Software.  Alguns dos dom√≠nios encontrados nas amostras Trojanized foram atendidos anteriormente - eles foram usados ‚Äã‚Äãno final de 2017 como dom√≠nios de servidor C&amp;C para o SedUploader, a porta dos fundos do primeiro est√°gio do cibergrupo Sednit.  A figura abaixo mostra um exemplo de configura√ß√£o modificada em um dos mini-agentes LoJax. <br><br><img src="https://habrastorage.org/webt/om/ts/md/omtsmdgqzbkn-fbqrpjd59abp7a.png"><br>  <i>Figura 4. √Ä esquerda, h√° um arquivo de configura√ß√£o leg√≠timo, √† direita, um arquivo modificado</i> <br><br>  As diferen√ßas entre agentes leg√≠timos e trojanizados s√£o extremamente pequenas, quase todas apresentadas acima.  As amostras de mini-agentes LoJax que conseguimos encontrar s√£o vers√µes trojanizadas da mesma amostra de mini-agentes Computrace, <code>rpcnetp.exe</code> .  Todos eles t√™m registros de data e hora de compila√ß√£o id√™nticos e apenas algumas dezenas de bytes diferem do original.  Al√©m das altera√ß√µes no arquivo de configura√ß√£o, h√° diferen√ßas nas vari√°veis ‚Äã‚Äãdo cron√¥metro que determinam os intervalos entre as conex√µes com o servidor C&amp;C. <br><br>  No momento da publica√ß√£o, descobrimos v√°rios mini-agentes LoJax usados ‚Äã‚Äãem ataques a v√°rias organiza√ß√µes nos Balc√£s, na Europa Central e Oriental, mas n√£o t√≠nhamos id√©ias sobre como instal√°-los.  Uma explica√ß√£o √≥bvia seria instalar usando um dos famosos backdoors Sednit.  N√£o se esque√ßa que o LoJack, como uma ferramenta bem estabelecida, foi inclu√≠do na lista de permiss√µes por muitos fornecedores de antiv√≠rus.  Portanto, mesmo nesta campanha, apenas um miniagente foi usado e n√£o sobreviveu ap√≥s a reinstala√ß√£o do Windows, ainda tinha uma vantagem - era menos prov√°vel que fosse detectado como malware.  Mas e se o comprometimento fosse ainda mais profundo e os invasores tentassem copiar o LoJack para acessar o firmware do sistema? <br><br><h2>  Busca pelo componente de n√≠vel inferior </h2><br>  Registramos ataques LoJax destinados a v√°rias organiza√ß√µes nos Balc√£s, na Europa Central e Oriental.  Em todos eles, conseguimos encontrar tra√ßos de malware Sednit, incluindo: <br><br><ul><li>  SedUploader, backdoor do primeiro est√°gio </li><li>  XAgent, o principal backdoor de Sednit </li><li>  Xtunnel, uma ferramenta de proxy de rede que pode transferir qualquer tr√°fego de rede entre um servidor C&amp;C na Internet e um computador de destino em uma rede local </li></ul><br>  Encontramos vest√≠gios de ferramentas Sednit na maioria dos sistemas estudados que se tornaram alvos LoJax, bem como em alguns sistemas em que apenas LoJax estava presente.  Pode-se supor que, em alguns casos, o LoJax tenha sido usado como uma ferramenta separada, provavelmente como um backdoor adicional para restaurar o acesso dos operadores Sednit √† rede. <br><br>  O backdoor do XAgent geralmente coloca m√≥dulos adicionais em um sistema comprometido, de modo que imediatamente se lembra que as amostras LoJax foram entregues da mesma maneira, sem outros mecanismos.  Pode-se supor que a Sednit emprestou apenas um mini-agente da solu√ß√£o LoJack.  No entanto, logo ap√≥s o in√≠cio da an√°lise, encontramos v√°rias evid√™ncias indicando que a fonte de inspira√ß√£o era um pouco mais extensa. <br><br><h4>  Driver RWEverything (RwDrv) e info_efi.exe </h4><br>  A primeira evid√™ncia foi encontrada gra√ßas a uma ferramenta personalizada de cibercriminosos, que, quando executados, descarregavam informa√ß√µes sobre as configura√ß√µes do sistema de n√≠vel inferior em um arquivo de texto.  A ferramenta foi descoberta junto com algumas amostras de LoJax.  A figura a seguir mostra um fragmento do arquivo de <code>info_efi.exe</code> desta ferramenta com o nome l√≥gico <code>info_efi.exe</code> . <br><br><img src="https://habrastorage.org/webt/8j/9x/kc/8j9xkcnbmste_xynugnkenaar6g.png"><br>  <i>Figura 5. Trecho dos logs de arquivo gerados por info_efi .exe</i> <br><br>  Para ler esse tipo de informa√ß√£o, a ferramenta inclui um driver chamado <code>RwDrv.sys</code> .  O driver do kernel vem com o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">RWEverything</a> , um utilit√°rio gratuito dispon√≠vel na rede que pode ser usado para ler informa√ß√µes em quase todas as configura√ß√µes de n√≠vel inferior, incluindo a interface PCI Express, mem√≥ria, ROMs de op√ß√£o PCI, etc.  O driver do kernel √© um software leg√≠timo e √© assinado com um certificado v√°lido. <br><br><img src="https://habrastorage.org/webt/2u/o-/mb/2uo-mbk6so15sdz9iusnxzl15qq.png"><br>  <i>Figura 6. Certificado de assinatura de c√≥digo RwDrv.sys</i> <br><br>  O RWEverything vem com uma interface gr√°fica do usu√°rio que permite acessar todas essas informa√ß√µes. <br><br><img src="https://habrastorage.org/webt/if/yp/dp/ifypdpu-hnounvupxelxhcp5el4.png"><br>  <i>Figura 7. Captura de tela da interface RWEverything</i> <br><br>  A descoberta da ferramenta <code>info_efi</code> foi o primeiro sinal de que um m√≥dulo UEFI LoJax poderia existir.  Ao tentar atualizar o firmware do sistema, √© importante ter informa√ß√µes sobre seu fornecedor, vers√£o etc.  Dadas as vulnerabilidades que permitem aos processos do usu√°rio acessar e modificar o conte√∫do da mem√≥ria flash SPI onde os m√≥dulos UEFI est√£o armazenados, a obten√ß√£o de dados de firmware do sistema √© o primeiro passo para um ataque bem-sucedido. <br><br>  A pista final que nos permitiu encontrar o primeiro rootkit UEFI do grupo Sednit foram duas ferramentas - para descarregar a mem√≥ria flash SPI e grav√°-la. <br><br><h4>  Despejar o SPI Flash </h4><br>  A primeira pe√ßa do quebra-cabe√ßa foi um arquivo chamado <code>ReWriter_read.exe</code> .  Ele continha todo o c√≥digo necess√°rio para despejar o flash SPI do sistema usando o driver <code>RwDrv.sys</code> , <code>RwDrv.sys</code> .  Para que o driver do dispositivo execute as opera√ß√µes necess√°rias, a ferramenta de despejo deve enviar os c√≥digos de controle de E / S corretos (IOCTL).  Enquanto o <code>RwDrv.sys</code> suporta muitos c√≥digos IOCTL diferentes, a ferramenta de dumper e a ferramenta de <code>RwDrv.sys</code> descritas nesta e na pr√≥xima se√ß√£o usam apenas quatro delas. <br><br>  RwDrv.sys: c√≥digos IOCTL suportados: <br><br>  <i>0x22280c</i> - grava na √°rea de mem√≥ria alocada para E / S <br>  <i>0x222808</i> - l√™ a √°rea de mem√≥ria alocada para entrada e sa√≠da <br>  <i>0x222840</i> - l√™ o dword do registro de configura√ß√£o PCI especificado <br>  <i>0x222834</i> - grava um byte no registro de configura√ß√£o PCI especificado <br><br>  <code>ReWriter_read</code> primeiro cria um servi√ßo com o <code>RwDrv.sys</code> kernel <code>RwDrv.sys</code> e grava as informa√ß√µes de configura√ß√£o UEFI / BIOS, os valores correspondentes dos tr√™s campos contidos no registro de gerenciamento do BIOS (BIOS_CNTL): BIOS Lock Enable (BLE), BIOS Write Enable (BIOSWE) e SMM BIOS Desativar prote√ß√£o contra grava√ß√£o (SMM_BWP).  Embora <code>ReWrite_read</code> n√£o use esses valores, nas se√ß√µes a seguir explicaremos por que esses campos s√£o de interesse para esta ferramenta. <br><br>  A pr√≥xima tarefa da ferramenta √© obter o endere√ßo base da √°rea de mem√≥ria do BIOS no SPI e seu tamanho.  Esta informa√ß√£o est√° contida no registro da interface SPI principal como regi√£o principal do BIOS Flash.  Todos os registros s√£o exibidos na mem√≥ria no RCRB (Root Complex Register Block), cujo endere√ßo base pode ser obtido atrav√©s da leitura do registro de configura√ß√£o PCI desejado.  <code>ReWriter_read</code> obt√©m esse endere√ßo usando RwDrv IOCTL 0x22840 e lendo o recuo correto (no nosso caso, 0xF0).  Assim que o endere√ßo base da √°rea do BIOS e seu tamanho s√£o conhecidos, a ferramenta de despejo l√™ o conte√∫do correspondente da mem√≥ria flash SPI e o grava em um arquivo no disco.  O processo de leitura da mem√≥ria flash SPI √© ilustrado na figura a seguir.  Defini√ß√µes de abrevia√ß√µes s√£o fornecidas no gloss√°rio abaixo. <br><br><img src="https://habrastorage.org/webt/mw/wm/tb/mwwmtbzbrwmm18l1w7-2iugvpxc.png"><br>  <i>Figura 8. A sequ√™ncia de leitura da mem√≥ria flash SPI</i> <br><br>  Al√©m das duas primeiras etapas, executadas apenas uma vez, as opera√ß√µes s√£o repetidas em um ciclo at√© que todos os dados da mem√≥ria flash SPI tenham sido lidos.  O processo tamb√©m √© bem descrito <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> .  Em seguida, <code>ReWriter_read</code> valida o tamanho da imagem mesclada.  Ele analisa o descritor de mem√≥ria de imagem para obter uma variedade de √°reas BIOS, Gigabit Ethernet (GbE) e Management Engine (ME).  A adi√ß√£o das dimens√µes dessas tr√™s √°reas permite que a ferramenta de dumper calcule todo o conte√∫do do SPI do flash.  Se o tamanho corresponder ao tamanho obtido da leitura da √°rea de registro do BIOS prim√°rio do Flash, a imagem ser√° considerada correta. <br><br><h4>  Patch de firmware UEFI </h4><br>  A segunda pe√ßa do quebra-cabe√ßa era um arquivo chamado <code>ReWriter_binary.exe</code> .  Este arquivo cont√©m evid√™ncias de que o Sednit chegou ao firmware.  O arquivo cont√©m c√≥digo para aplicar o patch da imagem UEFI baixada e gravar a vers√£o trojanizada na mem√≥ria flash SPI.  Nesta se√ß√£o, descrevemos como esse arquivo bin√°rio est√° estruturado. <br><br>  Depois que o conte√∫do da mem√≥ria flash √© descarregado e verificado pela ferramenta acima, um m√≥dulo UEFI malicioso √© adicionado √† imagem.  Para fazer isso, a imagem UEFI deve ser analisada para destacar as informa√ß√µes necess√°rias. <br><br>  Os dados armazenados na imagem UEFI s√£o decompostos em volumes por meio do sistema de arquivos (FFS).  Como o nome indica, este √© um sistema de arquivos especial para armazenar imagens de firmware.  Os volumes cont√™m arquivos com GUIDs.  Cada arquivo geralmente consiste em v√°rias se√ß√µes, uma das quais cont√©m o PE / COFF execut√°vel real, que √© uma imagem UEFI.  Abaixo est√° uma captura de tela do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">UEFITool</a> , um projeto de c√≥digo aberto para trabalhar com imagens de firmware UEFI, para uma compreens√£o mais simples do circuito. <br><br><img src="https://habrastorage.org/webt/s6/th/mp/s6thmpgjnornwankifoul8d9zlk.png"><br>  <i>Figura 9. Exemplo de uma imagem de firmware UEFI carregada no UEFITool</i> <br><br>  ReWriter_binary analisa todos os volumes de firmware encontrados na √°rea do BIOS SPI da mem√≥ria flash e procura por arquivos espec√≠ficos: <br><br><ul><li>  IP4Dxe (8f92960f-2880-4659-b857-915a8901bdc8) </li><li>  NtfsDxe (768bedfd-7b4b-4c9f-b2ff-6377e3387243) </li><li>  SmiFlash (bc327dbd-b982-4f55-9f79-056ad7e987c5) </li><li>  Dxe core </li></ul><br><img src="https://habrastorage.org/webt/zt/ou/kc/ztoukch8w0mdyv-whzpkaibpc9u.png"><br>  <i>Figura 10. O resultado do uso do descompilador Hex-Rays nos volumes de firmware</i> <br><br>  Ip4Dxe e NtfsDxe s√£o drivers DXE.  No firmware UEFI, os drivers DXE s√£o imagens PE / COFF criadas para abstra√ß√£o de hardware ou para servi√ßos de organiza√ß√£o para uso por outros drivers DXE ou aplicativos UEFI.  Esses drivers s√£o detectados e baixados pela DXE Foundation por meio do DXE Manager (kernel DXE) em um est√°gio inicial do processo de inicializa√ß√£o.  Ap√≥s concluir esta fase, todos os servi√ßos, como o carregador do SO, est√£o dispon√≠veis para trabalhar com aplicativos UEFI.  Normalmente, os drivers DXE s√£o armazenados no mesmo volume.  No entanto, o distribuidor DXE pode ser separado. <br><br>  ReWriter_binary procura Ip4Dxe apenas para descobrir se um determinado volume cont√©m drivers DXE.  Como descrevemos mais adiante, esse volume se torna um candidato √† instala√ß√£o do driver DXE mal-intencionado.  Ele tamb√©m procura o kernel DXE e adiciona o volume no qual est√° localizado como outro candidato a um local para gravar um rootkit.  O espa√ßo dispon√≠vel livre em cada um desses volumes √© armazenado e posteriormente usado para verificar a sufici√™ncia para adicionar um driver mal-intencionado. <br><br>  NtfsDxe - driver AMI NTFS DXE.  Se ele estiver presente no volume do firmware, seu local ser√° salvo e posteriormente usado para remover esse arquivo do volume.  Na se√ß√£o UEFI rootkit, veremos por que ele exclui este arquivo. <br><br>  Quanto √† imagem SmiFlash, as informa√ß√µes relacionadas a ela s√£o armazenadas, mas n√£o s√£o usadas em nenhum lugar em Malvari.  Curiosamente, a imagem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">√© vulner√°vel</a> .  Portanto, acreditamos que os operadores da Sednit podem trabalhar para explorar essas vulnerabilidades.  Isso pode permitir que eles gravem at√© sistemas configurados corretamente na mem√≥ria flash SPI.  Como veremos mais adiante, em sua forma atual, a ferramenta s√≥ pode gravar na √°rea do BIOS de sistemas incorretamente configurados ou relativamente antigos (em placas-m√£e com chipsets mais antigos que o Platform Controller Hub, lan√ßado em 2008). <br><br>  Depois que os metadados necess√°rios s√£o alocados, <code>ReWriter_binary</code> corrige o despejo da imagem UEFI e adiciona o driver DXE mal-intencionado.  Primeiro, ele cria o cabe√ßalho do arquivo (EFI_FFS_FILE_HEADER).  Ele ent√£o seleciona o volume de destino com base na localiza√ß√£o do Ip4Dxe e no kernel DXE, bem como no espa√ßo livre dispon√≠vel nesses volumes.  <code>ReWriter_binary</code> incorpora uma se√ß√£o compactada que cont√©m uma imagem do PE e uma se√ß√£o da interface do usu√°rio que define um nome de arquivo leg√≠vel por humanos: SecDxe.  A se√ß√£o compactada √© adicionada ao cabe√ßalho do arquivo e √© gravada no final do volume, em espa√ßo livre.  A figura abaixo mostra a estrutura - sua exibi√ß√£o no UEFITool. <br><br><img src="https://habrastorage.org/webt/g6/9-/-a/g69--aub7xrb5b1iinzwrtpxyo8.png"><br>  <i>Figura 11. Visualiza√ß√£o do arquivo SecDxe no UEFITool</i> <br><br>  Por fim, se o driver NtfsDxe estiver presente na imagem, ele ser√° removido.  O sistema de arquivos do firmware armazena arquivos e seu conte√∫do sequencialmente, portanto, o processo √© bastante simples: <br><br><ul><li>  recuar para um espa√ßo livre no final do volume </li><li>  Bytes 0xFF gravados na parte superior da imagem NtfsDxe </li><li>  a pr√≥xima parte do volume do firmware √© copiada, come√ßando com o recuo onde o NtfsDxe estava localizado </li><li>  o restante do sistema de arquivos √© preenchido com 0xFF bytes, ou seja, espa√ßo livre </li></ul><br><h4>  Gravando firmware corrigido de volta na mem√≥ria flash SPI </h4><br>  Ap√≥s fazer altera√ß√µes na imagem do firmware, a pr√≥xima etapa √© grav√°-la na mem√≥ria flash SPI.  Antes de mergulhar nesse processo, precisamos caracterizar parte da prote√ß√£o contra grava√ß√£o do BIOS que √© importante nesse caso.  Outros mecanismos existentes, como o BIOS Range Protection Protection, permanecem distantes porque o ReWriter_binary n√£o os verifica. <br><br>  A plataforma usa v√°rios mecanismos de seguran√ßa para bloquear tentativas n√£o autorizadas de gravar na √°rea do BIOS.  Devo dizer que esses mecanismos n√£o est√£o habilitados por padr√£o.  O firmware √© respons√°vel por sua configura√ß√£o correta.  Essas configura√ß√µes s√£o apresentadas no registro de controle do BIOS (BIOS_CNTL).  Ele cont√©m o bit BIOS Write Enable (BIOSWE), que deve ser alternado para "1" para gravar na √°rea do BIOS da mem√≥ria flash SPI.  Como a plataforma n√£o deve permitir nenhuma tentativa de grava√ß√£o na √°rea do BIOS, h√° mais um bit no BIOS_CNTL para proteger o BIOSWE - este √© o BIOS Lock Enable (BLE).  Quando definido, o mecanismo deve bloquear o bit BIOSWE e deixar o valor igual a "0".  No entanto, a solu√ß√£o tem uma vulnerabilidade.  Quando chega a solicita√ß√£o de alterar o bit BIOSWE para "1", o bit BIOSWE para "1" e somente depois que a plataforma interrompe a tarefa usando SMI (System Management Interrupt), o c√≥digo desse SMI altera o bit BIOSWE de volta para "0". <br><br>  Existem muitos problemas nesta vers√£o da solu√ß√£o.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em primeiro lugar, o processador SMI √© deixado para os desenvolvedores de firmware. Portanto, se esse c√≥digo n√£o for implementado no firmware, o bit BLE ser√° in√∫til, pois o bit BIOSWE n√£o ser√° definido como "0". Em segundo lugar, nesse caso, temos uma " </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vulnerabilidade de condi√ß√£o de corrida</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " que nos permite contornar completamente esse mecanismo, mesmo que o manipulador SMI seja implementado corretamente. Para explorar essa vulnerabilidade, um invasor precisa executar um thread que define continuamente o BIOSWE como "1", enquanto outro thread deve gravar dados na mem√≥ria flash do SPI. De acordo com o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">trabalho de</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Kallenberg e Wojtchuk, esse ataque funciona em processadores com v√°rios n√∫cleos e tamb√©m pode ser usado com sucesso em processadores de n√∫cleo √∫nico com a tecnologia Hyper-Threading ativada.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para resolver esse problema, um novo mecanismo de prote√ß√£o configurado atrav√©s do BIOS_CNTL foi adicionado √† plataforma. √â introduzido na fam√≠lia de chipsets do Intel Platform Controller Hub (PCH). Se o bit de configura√ß√£o estiver definido, o SMM BIOS Write Protect Disable (SMM_BWP) somente permitir√° a grava√ß√£o na √°rea do BIOS se todos os n√∫cleos estiverem no Modo de Gerenciamento do Sistema (SMM) e o BIOSWE estiver definido como "1". Isso protege efetivamente o sistema da ‚Äúvulnerabilidade de condi√ß√£o de corrida‚Äù descrita acima. No entanto, como no caso do BLE, o SMM_BWP deve ser ativado no lado do firmware. Portanto, o firmware no qual esses mecanismos est√£o configurados incorretamente deixa o sistema em risco de conceder direitos de grava√ß√£o n√£o autorizados √† √°rea do BIOS. </font></font><br><br> <code>ReWriter_binary</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">l√™ o conte√∫do do registro de controle do BIOS para selecionar o caminho correto.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ele primeiro verifica se o BIOSWE est√° configurado. Nesse caso, entra na fase de grava√ß√£o. Se o BIOSWE estiver desativado, ele verifica o valor do bit BLE. Se n√£o estiver instalado, ele altera o valor do bit BIOSWE e come√ßa a gravar o firmware corrigido. Se o bit BLE estiver definido, ele verifica o estado desabilitado SMM_BWP e aplica a "vulnerabilidade de condi√ß√£o de corrida" descrita acima. Se o bit SMM_BWP estiver definido, a opera√ß√£o falhar√°. A figura abaixo ilustra o processo. </font></font><br><br><img src="https://habrastorage.org/webt/db/3t/n5/db3tn5tpff0bgjciq9ciiy3a6p4.png"><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figura 12. A √°rvore de decis√£o durante o processo de grava√ß√£o</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Supondo que o arquivo analisado espec√≠fico foi </font></font><code>ReWriter_binary</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">usado para implantar o UEFI rootkit, podemos concluir que o firmware configurou incorretamente a prote√ß√£o contra grava√ß√£o do BIOS ou o chipset da m√°quina v√≠tima √© mais antigo que o Platform Controller Hub.</font></font><br><br> <code>ReWriter_binary</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N√£o pude substituir o firmware UEFI em um sistema moderno bem ajustado. No entanto, ao procurar uma imagem vulner√°vel do SmiFlash UEFI, a an√°lise dos volumes de firmware UEFI sugere que os invasores tamb√©m podem trabalhar com t√©cnicas mais avan√ßadas </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de prote√ß√£o contra grava√ß√£o do BIOS</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De maneira muito semelhante ao procedimento de leitura, ocorre a grava√ß√£o na mem√≥ria flash SPI: </font></font><br><br><img src="https://habrastorage.org/webt/ct/wi/v3/ctwiv38relsl9rpveltd8imrpjy.png"><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figura 13. Sequ√™ncia de grava√ß√£o na mem√≥ria flash SPI</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Al√©m das duas primeiras etapas, que s√£o executadas apenas uma vez, essas opera√ß√µes s√£o repetidas em um ciclo at√© que todas as informa√ß√µes sejam gravadas na mem√≥ria flash SPI . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quando o processo de grava√ß√£o √© conclu√≠do, o conte√∫do da mem√≥ria flash SPI √© descarregado novamente em um arquivo </font></font><code>image.bin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. A mesma verifica√ß√£o de integridade que foi realizada</font></font><code>ReWriter_read</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, √© executado em uma nova imagem mesclada. </font><font style="vertical-align: inherit;">Em seguida, a imagem lida na mem√≥ria flash SPI √© comparada com a imagem corrigida na mem√≥ria. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se algum bytes for diferente, seu endere√ßo ser√° gravado no log. </font><font style="vertical-align: inherit;">A presen√ßa ou aus√™ncia de diferen√ßas n√£o afeta o progresso do malware. </font><font style="vertical-align: inherit;">Essas informa√ß√µes s√£o registradas apenas para que os operadores entendam o que est√° acontecendo. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No est√°gio final, a chave do Registro √© definida como: </font></font><br><br> <code>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Session Manager\BootExecute = ‚Äúautocheck autochk *‚Äù</code> <br> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em seguida, o servi√ßo RwDrv √© parado e exclu√≠do. </font><font style="vertical-align: inherit;">√â importante que o valor dessa linha seja atribu√≠do √† chave de registro do Windows, pois o UEFI rootkit est√° procurando exatamente essa linha para alter√°-la e executar seu componente durante a inicializa√ß√£o do Windows. </font><font style="vertical-align: inherit;">Falaremos sobre isso com mais detalhes quando descrevermos o UEFI rootkit e seus componentes.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> An√°lise T√©cnica LoJax </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A ferramenta para descarregar, aplicar patches e gravar na mem√≥ria flash SPI √© personalizada para uma imagem de firmware espec√≠fica e n√£o pode ser usada em nenhum sistema. Nesse caso, o m√≥dulo UEFI completo pode ser alocado. A primeira coisa que fizemos ap√≥s o recebimento deste m√≥dulo foi estudar os dados de telemetria para descobrir se j√° haviam sido vistos antes. Nisso, tivemos que confiar no novo scanner UEFI, que pode digitalizar o firmware do sistema. Descobrimos que o m√≥dulo UEFI do grupo Sednit foi instalado pelo menos uma vez no sistema, o que significa que esse rootkit √© realmente usado in-the-wild.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ainda n√£o est√° estabelecido como as ferramentas maliciosas foram entregues aos sistemas comprometidos. Provavelmente, outros programas foram usados ‚Äã‚Äãpara isso - por exemplo, XAgent. As ferramentas de despejo e grava√ß√£o foram encontradas no mesmo sistema, mas em momentos diferentes - provavelmente, os operadores trabalharam em v√°rias etapas. Primeiro, eles descarregaram o firmware na m√°quina de destino, certificaram-se de que a ferramenta para fazer ajustes no programa funcionasse sem falhas e, em seguida, recarregaram e, na verdade, corrigiram o firmware. Encontramos apenas uma vers√£o da ferramenta para despejo e grava√ß√£o, mas existe a possibilidade de existirem outras vers√µes para outro firmware com vulnerabilidades que eles possam encontrar.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A figura abaixo fornece uma vis√£o geral da opera√ß√£o do UEFI rootkit at√© a inicializa√ß√£o do SO. </font><font style="vertical-align: inherit;">Primeiro, o driver SecDxe DXE √© carregado pelo DXE Manager. </font><font style="vertical-align: inherit;">Dessa forma, a fun√ß√£o de notifica√ß√£o para o grupo de eventos est√° configurada </font></font><code>EFI_EVENT_GROUP_READY_TO_BOOT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Quando o firmware estiver pronto para selecionar o dispositivo de inicializa√ß√£o e iniciar o carregador de inicializa√ß√£o, a fun√ß√£o de notifica√ß√£o ser√° chamada. </font><font style="vertical-align: inherit;">Ela realiza tr√™s a√ß√µes:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> carrega o driver NTFS DXE interno para fornecer acesso e capacidade de grava√ß√£o para parti√ß√µes NTFS </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> grava dois arquivos na parti√ß√£o NTFS do Windows: rpcnetp.exe e autoche.exe </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">altera a chave do Registro 'HKEY_LOCAL_MACHINE \ SYSTEM \ CurrentControlSet \ Control \ Session Manager \ BootExecute': para: 'autocheck autochk *'; </font><font style="vertical-align: inherit;">depois: 'autocheck autoche *'.</font></font></li></ul><br><img src="https://habrastorage.org/webt/at/qy/ec/atqyecti3adwerrfljy0ccirxgy.png"><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figura 14. Processo de inicializa√ß√£o de um sistema infectado com um rootkit UEFI</font></font></i> <br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> SecDxe: Driver DXE malicioso </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nesta se√ß√£o, revelaremos a sequ√™ncia de eventos que ocorrem em um sistema comprometido. Come√ßamos com uma descri√ß√£o do rootkit e seguimos a cadeia de eventos at√© que os componentes finais sejam implementados no n√≠vel do sistema operacional. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O UEFI rootkit da Sednit √© um driver DXE com um GUID </font></font><code>682894B5-6B70-4EBA-9E90-A607E5676297</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como n√£o est√° assinado, n√£o pode ser executado em um sistema com a prote√ß√£o de Inicializa√ß√£o Segura ativada. Ap√≥s a implanta√ß√£o em um dos volumes de firmware, o DXE Foundation o baixa sempre que o sistema √© iniciado. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O SecDxe √© um pequeno driver DXE que basicamente faz duas coisas. Ele configura um protocolo espec√≠fico para GUID.</font></font><code>832d9b4d-d8d5-425f-bd52-5c5afb2c85dc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que nunca √© usado. Em seguida, ele cria um evento associado √† fun√ß√£o de notifica√ß√£o. A fun√ß√£o de notifica√ß√£o est√° configurada para chamar um sinal por grupo </font></font><code>EFI_EVENT_GROUP_READY_TO_BOOT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. O sinal para esse grupo de eventos vem do gerenciador de inicializa√ß√£o quando estiver pronto para selecionar o dispositivo a ser inicializado. </font></font><br><br><img src="https://habrastorage.org/webt/sj/ff/6o/sjff6ohskqe2ewtsv8xnyis3oss.png"><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figura 15. O resultado do descompilador Hex-Rays passando pelo processo de cria√ß√£o de eventos</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O recurso de notifica√ß√£o explora o comportamento mal-intencionado do UEFI Sednit rootkit. Ela grava componentes no sistema de arquivos NTFS Windows. Como regra, o firmware UEFI sozinho funciona com a parti√ß√£o do sistema EFI; portanto, o driver NTFS geralmente n√£o est√° inclu√≠do. Somente sistemas de arquivos FAT s√£o suportados como parti√ß√µes para download. Portanto, o firmware UEFI n√£o vem necessariamente com os drivers NTFS. Por esse motivo, o SecDxe possui seu pr√≥prio driver NTFS interno. Este driver inicializa primeiro e se conecta ao dispositivo de disco. Ou seja, ele √© instalado </font></font><code>EFI_SIMPLE_FILE_SYSTEM_PROTOCOL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">em dispositivos de disco com parti√ß√µes NTFS, incluindo acesso a arquivos. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agora que tudo est√° pronto para gravar arquivos nas parti√ß√µes do Windows, o SecDxe redefine </font></font><code>rpcnetp.exe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>autoche.exe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Em seguida, √© </font></font><code>rpcnetp.exe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">instalado </font></font><code>%WINDIR%\SysWOW64</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nas vers√µes de 64 bits do Windows ou</font></font><code>%WINDIR%\System32</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nas vers√µes de 32 bits. </font><font style="vertical-align: inherit;">A est√° </font></font><code>autoche.exe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">definido como </font></font><code>%WINDIR%\SysWOW64</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">A figura a seguir mostra o processo respons√°vel por gravar esses arquivos no disco. </font></font><br><br><img src="https://habrastorage.org/webt/si/jo/pn/sijopnar5xrablwh02xdrv5e37a.png"><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figura 16. O resultado do descompilador Hex-Rays passando pelo processo de grava√ß√£o de arquivos no disco e, em</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> seguida, o SecDxe abre um </font></font><code>%WINDIR%\System32\config\SYSTEM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">arquivo com um backup de um conjunto de chaves do Registro </font></font><code>HKLM\SYSTEM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Ele analisa o arquivo at√© encontrar </font></font><code>'autocheck autochk *'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e substitui </font></font><code>'k'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">em </font></font><code>'autochk'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">on </font></font><code>'e'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Como resultado, ele </font></font><code>'HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Session Manager\ BootExecute'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">muda para </font></font><code>'autocheck autoche *'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Na pr√≥xima vez que o Windows inicializar, o autoche.exe ser√° iniciado </font></font><code>autochk.exe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Driver NTFS da equipe de hackers </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como discutido anteriormente, o driver NTFS est√° embutido no m√≥dulo SecDxe. H√° fortes evid√™ncias de que os operadores da Sednit n√£o escreveram seu pr√≥prio driver, mas compilaram uma c√≥pia do driver NTFS DXE anunciado da Equipe de Hacking. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O driver NTFS deles usa o projeto ntfs-3g como um kernel. Este √© apenas um inv√≥lucro para faz√™-lo funcionar como um driver UEFI DXE. O pr√≥prio arquivo INF do conjunto do driver da Hacking Team lista os nomes dos arquivos do projeto ntfs-3g. As linhas de c√≥digo do driver SecDxe NTFS tamb√©m listam muitos desses nomes de arquivo: </font><font style="vertical-align: inherit;">√â interessante observar que o caminho do projeto √© o mesmo encontrado no vetor-edk, o projeto de desenvolvimento do Hacking Team EFI. Existe um subprojeto no vetor-edk</font></font><br><br> <code>- c:\edk2\NtfsPkg\NtfsDxe\ntfs\inode.c <br> - c:\edk2\NtfsPkg\NtfsDxe\ntfs\volume.c <br> - c:\edk2\NtfsPkg\NtfsDxe\ntfs\bootsect.c <br> - c:\edk2\NtfsPkg\NtfsDxe\ntfs\unistr.c <br> - c:\edk2\NtfsPkg\NtfsDxe\ntfs\attrib.c <br> - c:\edk2\NtfsPkg\NtfsDxe\ntfs\mft.c <br> - c:\edk2\NtfsPkg\NtfsDxe\ntfs\index.c <br> - c:\edk2\NtfsPkg\NtfsDxe\ntfs\cache.c <br> - c:\edk2\NtfsPkg\NtfsDxe\ntfs\misc.c <br> - c:\edk2\NtfsPkg\NtfsDxe\ntfs\dir.c <br> - c:\edk2\NtfsPkg\NtfsDxe\ntfs\runlist.c <br> - c:\edk2\NtfsPkg\NtfsDxe\ntfs\logfile.c <br> - c:\edk2\NtfsPkg\NtfsDxe\ntfs\uefi_io.c <br> - c:\edk2\NtfsPkg\NtfsDxe\ntfs\ntfsinternal.c <br> - c:\edk2\NtfsPkg\NtfsDxe\ntfs\mst.c <br> - c:\edk2\NtfsPkg\NtfsDxe\ntfs\lcnalloc.c <br> - c:\edk2\NtfsPkg\NtfsDxe\ntfs\compress.c <br> - c:\edk2\NtfsPkg\NtfsDxe\ntfs\bitmap.c <br> - c:\edk2\NtfsPkg\NtfsDxe\ntfs\collate.c <br> - c:\edk2\NtfsPkg\NtfsDxe\ntfs\security.c</code> <br> <br><font style="vertical-align: inherit;"></font><code>NtfsPkg</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">com um layout de diret√≥rio absolutamente id√™ntico. Os arquivos de origem do projeto ntfs-3g est√£o localizados no mesmo caminho de endere√ßo. E embora os caminhos em si n√£o sejam dignos de nota, acreditamos que isso n√£o √© uma mera coincid√™ncia. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comparando o c√≥digo fonte vazado para a rede com o que obtivemos na sa√≠da do descompilador Hex-Rays, torna-se √≥bvio que esse √© o mesmo projeto. A figura abaixo mostra um exemplo de compara√ß√£o de uma fun√ß√£o </font></font><code>NtfsDriverBindingStart</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">retirada </font></font><code>vector-edk/NtfsPkg/NtfsDxe/Ntfs.c</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Os coment√°rios do c√≥digo HT original s√£o removidos para melhor percep√ß√£o. A l√≥gica e a sequ√™ncia de chamadas de fun√ß√£o s√£o as mesmas. Ambos os projetos ainda usam uma vari√°vel (LockedByMe) para salvar um estado bloqueado. </font></font><br><br><img src="https://habrastorage.org/webt/qn/-k/ut/qn-kutvxgtnyuqkcvvo8zwfglya.png"><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figura 17. Compara√ß√£o dos resultados na sa√≠da do driver Sednit do descompilador NTFS Hex-Rays (√† esquerda) e do driver NTFS HT (√† direita)</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O c√≥digo acima mostra os desenvolvedores da equipe de hackers, que n√£o est√° no c√≥digo aberto ntfs-3g. Conforme mencionado na se√ß√£o </font></font><code>ReWriter_binary</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, durante a an√°lise do sistema de arquivos do firmware, o arquivo execut√°vel tenta remover o driver NTFS da AMI. Quer√≠amos descobrir por que ele est√° sendo removido em vez de usado.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Analisamos o driver e descobrimos que ele s√≥ pode executar opera√ß√µes de leitura. Como a grava√ß√£o no sistema de arquivos n√£o est√° dispon√≠vel, os desenvolvedores n√£o puderam us√°-lo para seus pr√≥prios fins. Tamb√©m √© prov√°vel que os operadores do Sednit tenham encontrado dificuldades devido ao fato de j√° haver outro driver NTFS no firmware, ent√£o eles decidiram simplesmente remov√™-lo. Al√©m de implementar os recursos de leitura e grava√ß√£o, o driver da Equipe de hackers n√£o respeita as permiss√µes de arquivo. Por exemplo, ele pode substituir um arquivo somente leitura sem causar nenhum erro.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Neste ponto, j√° descrevemos v√°rias opera√ß√µes de comprometimento do sistema executadas pelo UEFI rootkit. </font><font style="vertical-align: inherit;">Tamb√©m discutimos as raz√µes pelas quais os operadores Sednit usaram o c√≥digo-fonte vector-edk da Hacking Team para desenvolver seu driver NTFS para gravar arquivos em parti√ß√µes NTFS no Windows. </font><font style="vertical-align: inherit;">Mais adiante neste artigo, apresentaremos uma an√°lise dos componentes fornecidos pelo SecDxe.</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">autoche.exe vs. </font><font style="vertical-align: inherit;">autochk.exe</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mal-intencionado √© </font></font><code>autoche.exe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">usado para garantir a persist√™ncia do mini-agente </font></font><code>rpcnetp.exe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Como voc√™ pode ver na figura a seguir, ele usa chamadas nativas para a API do Windows para criar um servi√ßo. </font></font><br><br><img src="https://habrastorage.org/webt/wc/dk/fv/wcdkfvfmcoog14t1orjmryouwd4.png"><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figura 18. O autoche malicioso .exe configura a persist√™ncia do rpcnetp.exe.</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Observe que o nome do servi√ßo √© igual ao usado pelo agente leg√≠timo do Computrace. Ap√≥s criar o servi√ßo, ele restaura o valor anterior da chave do Registro </font></font><code>BootExecute</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><img src="https://habrastorage.org/webt/yz/wc/lj/yzwclj1loxeconb728wvsxqvyse.png"><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figura 19. O malicioso autoche.exe restaura o valor original da chave de registro BootExecute.Como</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> o processo ocorre durante a inicializa√ß√£o do Windows, √© improv√°vel que o usu√°rio note uma altera√ß√£o no valor da chave.</font></font><code>BootExecute</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Deve-se observar que no autoche .exe s√£o vis√≠veis algumas semelhan√ßas com o m√≥dulo autochk.exe no Computrace, por exemplo, as chamadas de API aplicadas e o registro de servi√ßos, mas o restante √© bem diferente. </font><font style="vertical-align: inherit;">O m√≥dulo Computrace √© maior e restaura o arquivo execut√°vel original em </font></font><code>autochk.exe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vez de alterar a chave do Registro. </font><font style="vertical-align: inherit;">Ele tamb√©m √© respons√°vel pela implanta√ß√£o do mini-agente em disco, enquanto LoJax faz isso com o UEFI rootkit.</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> rpcnetp.exe </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Embora o mini-agente </font></font><code>rpcnetp.exe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">possa ser implementado pelo UEFI rootkit, √© prov√°vel que, na maioria dos casos, quando encontramos uma vers√£o trojanizada do LoJack, o mini-agente n√£o tenha usado esse componente. √â prov√°vel que eles tenham procedido de considera√ß√µes oportunistas e instalado o UEFI rootkit somente quando tiveram essa oportunidade e nas organiza√ß√µes mais interessantes para eles. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Durante a investiga√ß√£o, descobrimos v√°rias vers√µes do mini-agente LoJax. A lista de indicadores de comprometimento mostra seus hashes e os dom√≠nios / endere√ßos IP correspondentes. Como j√° dissemos, todas as amostras encontradas foram uma vers√£o trojanizada do mesmo antigo agente Computrace, compilado em 2008.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nunca vimos um agente LoJax baixar e instalar m√≥dulos adicionais, mas sabemos que essa funcionalidade existe. </font><font style="vertical-align: inherit;">Como as melhores qualidades do LoJax s√£o discri√ß√£o e persist√™ncia, ele pode definitivamente ser usado para fornecer acesso aos principais recursos.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Preven√ß√£o e recupera√ß√£o de ataques </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para evitar um ataque, √© necess√°rio um ecossistema complexo que consiste em muitos componentes ativos. </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O primeiro mecanismo de seguran√ßa que pode bloquear esse ataque √© a Inicializa√ß√£o segura. Quando a Inicializa√ß√£o segura est√° ativada, cada componente do firmware baixado mediante solicita√ß√£o do firmware deve ser assinado corretamente, garantindo assim sua integridade.</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Recomendamos </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que voc√™ ative a fun√ß√£o</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Inicializa√ß√£o segura, esta √© a prote√ß√£o b√°sica contra ataques no firmware UEFI. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como no software, o firmware UEFI sempre deve ser atualizado em tempo h√°bil. Visite o site do fabricante da placa-m√£e para verificar se voc√™ possui a vers√£o mais recente dispon√≠vel.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Voc√™ tamb√©m deve certificar-se de que todos os seus sistemas estejam equipados com chipsets modernos com o Platform Controller Hub (come√ßando com os chipsets Intel Series 5 e al√©m). Isso garantir√° que os mecanismos de seguran√ßa funcionem contra a ‚Äúvulnerabilidade das condi√ß√µes de corrida‚Äù, que, como </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">indicamos</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , est√° presente na plataforma. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Outra parte da seguran√ßa do firmware est√° nas m√£os dos fornecedores da UEFI / BIOS. Os mecanismos de seguran√ßa fornecidos pela plataforma devem ser corretamente configurados pelo firmware do sistema para garantir realmente sua prote√ß√£o. Portanto, o firmware deve ser constru√≠do inicialmente com um entendimento das medidas de seguran√ßa. Felizmente, mais e mais pesquisadores de seguran√ßa est√£o prestando aten√ß√£o √† seguran√ßa do firmware, atraindo a aten√ß√£o dos fornecedores. Tamb√©m vale a pena mencionar a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CHIPSEC</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, uma estrutura de c√≥digo aberto que executa uma avalia√ß√£o de seguran√ßa de baixo n√≠vel para determinar se a plataforma est√° configurada corretamente. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eliminar as consequ√™ncias do comprometimento via firmware UEFI √© uma tarefa dif√≠cil. </font><font style="vertical-align: inherit;">N√£o h√° maneiras f√°ceis de limpar o sistema contra essas amea√ßas e n√£o h√° produtos de seguran√ßa especiais que possam corrigir tudo. </font><font style="vertical-align: inherit;">No caso descrito aqui, para remover o rootkit, √© necess√°rio atualizar novamente a mem√≥ria flash SPI. </font><font style="vertical-align: inherit;">Esta √© uma tarefa n√£o trivial; n√£o √© adequada para o usu√°rio m√©dio. </font><font style="vertical-align: inherit;">A atualiza√ß√£o do firmware UEFI pode remover o rootkit se toda a √°rea SPI da mem√≥ria flash for reescrita. </font><font style="vertical-align: inherit;">Se a interfer√™ncia UEFI n√£o for poss√≠vel, a √∫nica solu√ß√£o √© substituir a placa-m√£e do sistema infectado.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Conclus√µes </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O UEFI rootkit √© uma das ferramentas mais perigosas e poderosas dos cibercriminosos devido √† sua alta persist√™ncia e imunidade √† reinstala√ß√£o do sistema operacional e √† substitui√ß√£o de um disco r√≠gido, al√©m da excepcional dificuldade de detec√ß√£o e remo√ß√£o. Embora a imagem UEFI do sistema seja dif√≠cil de alterar, poucas solu√ß√µes permitem que voc√™ varra os m√≥dulos UEFI e identifique entre eles os maliciosos. Al√©m disso, limpar o firmware UEFI significa atualiz√°-lo, o que n√£o √© uma opera√ß√£o comum que um usu√°rio normal n√£o possa executar. Esses benef√≠cios explicam por que os cibergrupos com recursos ilimitados continuar√£o atacando os sistemas UEFI. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para qualquer d√∫vida sobre este trabalho, entre em contato com ameaintel@eset.com </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e queremos agradecer √†queles que est√£o trabalhando no projeto opensecuritytraining.info. Curso</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A introdu√ß√£o ao BIOS e SMM</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> realmente nos ajudou quando analisamos as intera√ß√µes com o chip flash SPI.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Gloss√°rio </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Consulte as especifica√ß√µes da </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Intel</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para obter uma descri√ß√£o mais detalhada das abrevia√ß√µes. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- BIOS_CNTL: Registro de controle do BIOS </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- BIOSWE: Grava√ß√£o do BIOS ativada </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- BLE: Bloqueio do BIOS ativado </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- FADDR: Endere√ßo do Flash </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- FDATAX: Dados do Flash do FDATA0 ao FDATAN </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- FDBC: Contagem de bytes de dados do Flash </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- FGO: Ciclo de Flash Go </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- HSFC: Sequ√™ncia de hardware Controle de Flash </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- HSFS: Status do Flash de Sequenciamento de Hardware </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- IOCTL: Controle de Entrada / Sa√≠da </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- PCH: Hub do Controlador de Plataforma </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- RCBA: Registro de Endere√ßo Base do Complexo Raiz </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- RCRB: Bloco de Registro do Complexo Raiz </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- SCIP: Ciclo de </font><font style="vertical-align: inherit;">Registro do Complexo Raiz </font><font style="vertical-align: inherit;">- SCIP: Ciclo SPI em andamento </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- SMI: Interrup√ß√£o de gerenciamento do sistema </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- SMM: Modo de Gerenciamento do Sistema</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- SMM_BWP: Desabilita√ß√£o de prote√ß√£o contra grava√ß√£o de BIOS do SMM </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- SPI: Interface Perif√©rica Serial</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Indicadores de compromisso </font></font></h2><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ReWriter_read.exe </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Detec√ß√£o ESET </font></font><br> <code>Win32/SPIFlash.A</code> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SHA-1</font></font><br> <code>ea728abe26bac161e110970051e1561fd51db93b</code> <br> <br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ReWriter_binary.exe </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Detec√ß√£o ESET </font></font><br> <code>Win32/SPIFlash.A</code> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SHA-1</font></font><br> <code>cc217342373967d1916cb20eca5ccb29caaf7c1b</code> <br> <br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Secdexe </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Detec√ß√£o ESET </font></font><br> <code>EFI/LoJax.A</code> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SHA-1</font></font><br> <code>f2be778971ad9df2082a266bd04ab657bd287413</code> <br> <br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> info_efi.exe </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Detec√ß√£o ESET </font></font><br> <code>Win32/Agent.ZXZ</code> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SHA-1</font></font><br> <code>4b9e71615b37aea1eaeb5b1cfa0eee048118ff72</code> <br> <br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> autoche.exe </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Detec√ß√£o ESET </font></font><br> <code>Win32/LoJax.A</code> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SHA-1</font></font><br> <code>700d7e763f59e706b4f05c69911319690f85432e</code> <br> <br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> EXE Mini Agent </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Detec√ß√£o ESET </font><font style="vertical-align: inherit;">SHA-1</font></font><br> <code>Win32/Agent.ZQE <br> Win32/Agent.ZTU</code> <br><font style="vertical-align: inherit;"></font><br> <code>1771e435ba25f9cdfa77168899490d87681f2029 <br> ddaa06a4021baf980a08caea899f2904609410b9 <br> 10d571d66d3ab7b9ddf6a850cb9b8e38b07623c0 <br> 2529f6eda28d54490119d2123d22da56783c704f <br> e923ac79046ffa06f67d3f4c567e84a82dd7ff1b <br> 8e138eecea8e9937a83bffe100d842d6381b6bb1 <br> ef860dca7d7c928b68c4218007fb9069c6e654e9 <br> e8f07caafb23eff83020406c21645d8ed0005ca6 <br> 09d2e2c26247a4a908952fee36b56b360561984f <br> f90ccf57e75923812c2c1da9f56166b36d1482be</code> <br> <br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Nomes de dom√≠nio do servidor de comando </font></font></h4><br> <code>secao[.]org <br> ikmtrust[.]com <br> sysanalyticweb[.]com <br> lxwo[.]org <br> jflynci[.]com <br> remotepx[.]net <br> rdsnets[.]com <br> rpcnetconnect[.]com <br> webstp[.]com <br> elaxo[.]org</code> <br> <br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Endere√ßos IP do servidor de comandos </font></font></h4><br> <code>185.77.129[.]106 <br> 185.144.82[.]239 <br> 93.113.131[.]103 <br> 185.86.149[.]54 <br> 185.86.151[.]104 <br> 103.41.177[.]43 <br> 185.86.148[.]184 <br> 185.94.191[.]65 <br> 86.106.131[.]54</code> <br> <br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Mini agente DLL </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nomes de dom√≠nio do servidor de comando </font><font style="vertical-align: inherit;">ESET </font></font><br> <code>Win32/Agent.ZQE</code> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SHA-1 </font><font style="vertical-align: inherit;">Endere√ßos IP do </font></font><br> <code>397d97e278110a48bd2cb11bb5632b99a9100dbd</code> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">servidor de comando</font></font><br> <code>elaxo.org</code> <br><font style="vertical-align: inherit;"></font><br> <code>86.106.131[.]54</code> </div> </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt425251/">https://habr.com/ru/post/pt425251/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt425241/index.html">Desenvolvedor 20 anos depois: Vasily Lebedev sobre ICRE, educa√ß√£o, seu livro e programa√ß√£o</a></li>
<li><a href="../pt425243/index.html">O manual de john willis</a></li>
<li><a href="../pt425245/index.html">An√∫ncio do RamblerFront & # 6</a></li>
<li><a href="../pt425247/index.html">Crowdsourcing em testes</a></li>
<li><a href="../pt425249/index.html">Como √© o conhecimento do LLP na ITMO University: o curso "Programa√ß√£o de baixo n√≠vel"</a></li>
<li><a href="../pt425253/index.html">Estamos desenvolvendo um projeto de aprendizado de m√°quina em Python. Parte 1</a></li>
<li><a href="../pt425255/index.html">Algoritmo de compacta√ß√£o sem perdas de Broo e codifica√ß√£o delta, compara√ß√£o com o Xdelta3. Desenvolvimento de projetos residenciais</a></li>
<li><a href="../pt425259/index.html">Fazendo backup do seu site usando git e Makefile</a></li>
<li><a href="../pt425261/index.html">Certificados EV est√£o mortos</a></li>
<li><a href="../pt425263/index.html">O festival iFEST ser√° realizado em N√≠jni Novgorod</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>