<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>游꿝 游눉 游븹游낖 Zircon destacado: vDSO (objeto virtual din치mico compartido) 游빂游낕 游댓 游눵</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Circ칩n? Que es esto 


 En agosto de 2016, sin ning칰n anuncio oficial de Google, se descubrieron las fuentes del nuevo sistema operativo.  Fucsia. Est...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Zircon destacado: vDSO (objeto virtual din치mico compartido)</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/435482/"><h2 id="zircon-chto-eto">  Circ칩n?  Que es esto </h2><br><p>  En agosto de 2016, sin ning칰n anuncio oficial de Google, se descubrieron las fuentes del nuevo sistema operativo. <img src="https://habrastorage.org/webt/s3/vk/vq/s3vkvqkdg0wsatckxecdfekkdyk.png">  Fucsia.  Este sistema operativo se basa en un microkernel llamado Zircon, que a su vez se basa en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">LK (Little Kernel)</a> . </p><br><blockquote>  Fuchsia no es Linux </blockquote><br><div class="spoiler">  <b class="spoiler_title">Notas del traductor</b> <div class="spoiler_text"><p>  Yo no <del>  soldador real </del>  Soy desarrollador y / o experto en Zircon.  El texto debajo del corte es una <em>compilaci칩n de</em> traducciones parciales: la <a href="">documentaci칩n oficial de Zircon vDSO</a> y el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">art칤culo Admiring</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">the Zircon Part 1: Understanding Minimal Process Creation</a> de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">@depletionmode</a> , donde <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">se</a> ha agregado una peque침a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">mordaza</a> (que se ha eliminado para spoilers).  Por lo tanto, sugerencias constructivas para mejorar el art칤culo, como siempre, son bienvenidas. </p></div></div><br><h2 id="o-chem-poydet-rech-v-state">  쯈u칠 se discutir치 en el art칤culo? </h2><br><p>  vDSO en Zircon es el <strong>칰nico</strong> medio para acceder a las <a href="">llamadas del sistema (syscalls)</a> . </p><br><p>  쮼s realmente imposible llamar directamente a las instrucciones del procesador SYSENTER / SYSCALL desde nuestro c칩digo?  No, estas instrucciones de procesador no forman parte del sistema ABI.  El c칩digo de usuario tiene prohibido seguir directamente estas instrucciones. </p><br><p>  Aquellos que quieran conocer m치s detalles sobre este paso arquitect칩nico, los invito a Cat. </p><br><p><img src="https://habrastorage.org/webt/ns/64/h3/ns64h3y_inuxdxyycmdcmedcjba.png"></p><a name="habracut"></a><br><h2 id="zircon-vdso-virtual-dynamic-shared-object">  Zircon vDSO (objeto virtual compartido din치mico) </h2><br><p>  El acr칩nimo vDSO significa <strong>V</strong> ithual <strong>D</strong> din치mico <strong>S</strong> hared <strong>O</strong> bject: </p><br><ul><li>  Dynamic Shared Object es un t칠rmino utilizado para referirse a bibliotecas compartidas para el formato ELF (archivos .so). </li><li>  Este objeto es virtual porque no se carga desde un archivo separado existente en el sistema de archivos.  La imagen vDSO es proporcionada directamente por el n칰cleo. </li></ul><br><h2 id="podderzhka-so-storony-yadra">  Soporte de kernel </h2><br><p>  El soporte para vDSO como el 칰nico ABI controlado para aplicaciones en modo de usuario se implementa de dos maneras: </p><br><ol><li><p> Proyectar un objeto de memoria virtual ( <a href="">VMO, objeto de memoria virtual</a> ). <br><br>  Cuando <a href="">zx_vmar_map</a> procesa VMO para vDSO (y <code>ZX_VM_PERM_EXECUTE</code> solicita <code>ZX_VM_PERM_EXECUTE</code> en los argumentos), el n칰cleo requiere que el desplazamiento y el tama침o coincidan estrictamente con el segmento ejecutable de vDSO.  Esto (incluido) garantiza solo una proyecci칩n vDSO en la memoria del proceso.  Despu칠s de la primera proyecci칩n exitosa de vDSO en el proceso, ya no se puede eliminar.  Y un intento de volver a proyectar vDSO en la memoria del proceso, intenta eliminar el VMO proyectado para vDSO o el proyecto con el desplazamiento y / o tama침o incorrecto falla con el error <code>ZX_ERR_ACCESS_DENIED</code> . <br>  El desplazamiento y el tama침o del c칩digo vDSO se extraen en la etapa de compilaci칩n del archivo ELF y luego se utilizan en el c칩digo del n칰cleo para realizar las comprobaciones anteriores.  Despu칠s de la primera proyecci칩n exitosa de vDSO, el n칰cleo del sistema operativo recuerda la direcci칩n del proceso de destino para acelerar las comprobaciones. </p><br></li><li><p>  Verifique las direcciones de retorno para las funciones de llamada del sistema. <br><br>  Cuando el c칩digo de modo de usuario llama al n칰cleo, se transmite un n칰mero de llamada de sistema de bajo nivel en el registro.  Las llamadas de sistema de bajo nivel son la interfaz interna (privada) entre vDSO y el n칰cleo Zircon.  Algunos (la mayor칤a) corresponden directamente a las llamadas del sistema de la ABI p칰blica, mientras que otros no. <br>  Para cada llamada de sistema de bajo nivel en el c칩digo vDSO, hay un conjunto fijo de compensaciones en el c칩digo que realiza esta llamada.  El c칩digo fuente de vDSO define caracteres internos que identifican cada una de esas ubicaciones.  En el momento de la compilaci칩n, estas ubicaciones se recuperan de la tabla de s칤mbolos vDSO y se utilizan para generar el c칩digo del n칰cleo que determina la predicci칩n de la validez de la direcci칩n del c칩digo para cada llamada de sistema de bajo nivel.  Estos predicados le permiten verificar r치pidamente la validez del c칩digo de llamada, dado el desplazamiento desde el comienzo del segmento de c칩digo vDSO. <br>  Si el predicado determina que el c칩digo de llamada no tiene permiso para realizar una llamada al sistema, se genera una excepci칩n sint칠tica, similar a la de si el c칩digo de llamada intentara ejecutar una instrucci칩n inexistente o privilegiada. </p><br></li></ol><br><h2 id="vdso-pri-sozdanii-novogo-processa">  vDSO al crear un nuevo proceso </h2><br><p>  Para iniciar la ejecuci칩n del primer subproceso de un proceso reci칠n creado, se <a href="">utiliza la</a> llamada al sistema <a href="">zx_process_start</a> .  El 칰ltimo par치metro de esta llamada al sistema (ver arg2 en la documentaci칩n) pasa el argumento para el primer hilo del proceso creado.  Seg칰n el acuerdo aceptado, el cargador del programa asigna vDSO al espacio de direcciones del nuevo proceso (a un lugar aleatorio seleccionado por el sistema) y transfiere la direcci칩n base de la asignaci칩n con el argumento arg2 al primer subproceso del proceso creado.  Esta direcci칩n es la direcci칩n del encabezado del archivo ELF, en el que se pueden encontrar las funciones con nombre necesarias para realizar llamadas al sistema. </p><br><h2 id="karta-pamyati-layout-vdso">  Tarjeta de memoria (dise침o) vDSO </h2><br><p>  vDSO es una biblioteca compartida EFL regular que puede considerarse como cualquier otra.  Pero para vDSO, se selecciona intencionalmente un peque침o subconjunto de todo el formato ELF.  Esto tiene varias ventajas: </p><br><ul><li>  El mapeo de dicho ELF en el proceso es simple y no incluye ning칰n caso l칤mite complejo que se requiera para apoyar completamente los programas ELF. </li><li>  El uso de vDSO no requiere un enlace ELF din치mico completamente funcional.  En particular, vDSO no tiene reubicaciones din치micas.  Proyectar segmentos PT_LOAD de un archivo ELF es la 칰nica acci칩n requerida. </li><li>  El c칩digo vDSO no tiene estado y es reentrante.  Funciona exclusivamente con registros de procesador y la pila.  Esto lo hace adecuado para su uso en una amplia variedad de contextos con restricciones m칤nimas, que cumple con el sistema operativo ABI obligatorio.  Tambi칠n simplifica el an치lisis de c칩digo y la verificaci칩n de confiabilidad y seguridad. </li></ul><br><p>  Toda la memoria vDSO est치 representada por dos segmentos consecutivos, cada uno de los cuales contiene p치ginas enteras alineadas: </p><br><ol><li>  El primer segmento es de solo lectura e incluye encabezados ELF y datos constantes. </li><li>  El segundo segmento es ejecutable y contiene c칩digo vDSO. </li></ol><br><p>  Toda la imagen vDSO consta de solo las p치ginas de estos dos segmentos.  Solo se requieren dos valores extra칤dos de los encabezados ELF para mostrar la memoria vDSO: el n칰mero de p치ginas en cada segmento. </p><br><h2 id="konstantnye-dannye-vremeni-zagruzki-os">  Datos constantes del tiempo de arranque del sistema operativo </h2><br><p>  Algunas llamadas al sistema simplemente devuelven valores que son constantes (los valores deben solicitarse en tiempo de ejecuci칩n y no pueden compilarse en el c칩digo de modo de usuario).  Estos valores son fijos en el n칰cleo en el momento de la compilaci칩n, o determinados por el n칰cleo en el momento del arranque (par치metros de arranque y par치metros de hardware).  Por ejemplo: <a href="">zx_system_get_version ()</a> , <a href="">zx_system_get_num_cpus ()</a> y <a href="">zx_ticks_per_second ()</a> .  El valor de retorno de la 칰ltima funci칩n, por ejemplo, se ve afectado por el par치metro de <a href="">l칤nea de comando</a> del <a href="">n칰cleo</a> . </p><br><div class="spoiler">  <b class="spoiler_title">Espera, 쯘s constante el n칰mero de CPU?</b> <div class="spoiler_text"><p>  Curiosamente, la descripci칩n de la funci칩n <a href="">zx_system_get_num_cpus ()</a> tambi칠n establece expl칤citamente que el sistema operativo no admite el <a href="">intercambio en</a> <em>caliente</em> <a href="">del</a> n칰mero de procesadores: </p><br><blockquote>  Este n칰mero no puede cambiar durante una ejecuci칩n del sistema, solo en el momento del arranque. </blockquote><p>  Esto, al menos, indica indirectamente que el sistema operativo no est치 posicionado como un servidor. </p></div></div><br><p>  Como estos valores son constantes, no tiene sentido pagar las llamadas reales del sistema al n칰cleo del sistema operativo.  En cambio, su implementaci칩n son funciones simples de C ++ que devuelven datos le칤dos del segmento constante vDSO.  Los valores capturados durante la compilaci칩n (como la cadena de versi칩n del sistema) simplemente se compilan en vDSO. </p><br><p>  Para valores determinados en el momento del arranque, el n칰cleo debe modificar el contenido de vDSO.  Esto se realiza utilizando un c칩digo ejecutable temprano que forma el VMO vDSO antes de que el n칰cleo inicie el primer proceso de usuario (y le pase el descriptor de VMO).  Durante la compilaci칩n, las compensaciones de la imagen vDSO ( <a href="">vdso_constants</a> ) se extraen del archivo ELF y luego se incrustan en el n칰cleo.  Y en el momento del arranque, el n칰cleo muestra temporalmente p치ginas que abarcan <a href="">vdso_constants</a> en su propio espacio de direcciones para preinicializar la estructura con los valores correctos (para el inicio actual del sistema). </p><br><h2 id="k-chemu-vsya-eta-golovnaya-bol">  쯇or qu칠 todo este <em>dolor de cabeza</em> ? </h2><br><p>  Una de las razones m치s importantes es la seguridad.  Es decir, si un atacante logra ejecutar c칩digo arbitrario (shell), tendr치 que usar funciones vDSO para llamar a las funciones del sistema.  El primer obst치culo ser치 la aleatorizaci칩n antes mencionada de la direcci칩n de inicio de vDSO para cada proceso creado.  Y dado que el kernel del sistema operativo es responsable del VMO (objeto de memoria virtual) de vDSO, puede elegir asignar un vDSO completamente diferente a un proceso espec칤fico, lo que proh칤be las llamadas de sistema peligrosas (y no necesarias para un proceso en particular).  Por ejemplo: puede evitar que los <a href="">controladores</a> generen procesos secundarios o manejar 치reas MMIO proyectadas.  Esta es una gran herramienta para reducir la superficie de ataque. </p><br><p>  Nota: Actualmente, el soporte para varios vDSO se est치 desarrollando activamente.  Ya existe una implementaci칩n de prueba de concepto y pruebas simples, pero se necesita m치s trabajo para mejorar la confiabilidad de la implementaci칩n y determinar qu칠 opciones est치n disponibles.  El concepto actual proporciona opciones de imagen vDSO que solo exportan un subconjunto de la interfaz de llamada completa del sistema vDSO. </p><br><div class="spoiler">  <b class="spoiler_title">쯈u칠 pasa con otros sistemas operativos?</b> <div class="spoiler_text"><p>  Cabe se침alar que t칠cnicas similares ya se han utilizado con 칠xito en otros sistemas operativos.  Por ejemplo, en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Windows hay un ProcessSystemCallDisablePolicy</a> : </p><br><blockquote>  Restricci칩n de desactivaci칩n de llamadas del sistema Win32k para restringir la capacidad de usar NTUser y GDI </blockquote></div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es435482/">https://habr.com/ru/post/es435482/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es435466/index.html">React Tutorial Part 6: Algunas caracter칤sticas del curso, JSX y JavaScript</a></li>
<li><a href="../es435468/index.html">Tutorial React Parte 7: Estilos en l칤nea</a></li>
<li><a href="../es435470/index.html">Tutorial de React, Parte 8: Trabajo continuo en una aplicaci칩n TODO, Introducci칩n de propiedades de componentes</a></li>
<li><a href="../es435476/index.html">Mkcert: certificados HTTPS v치lidos para localhost</a></li>
<li><a href="../es435480/index.html">Microsoft y Kroger le dar치n a Amazon una pelea en el campo ... el comercio de alimentos</a></li>
<li><a href="../es435484/index.html">Fuzzing style 1989</a></li>
<li><a href="../es435488/index.html">Simulacros, trozos y esp칤as en el marco de Spock</a></li>
<li><a href="../es435490/index.html">Cambios de impuestos de Google en 2019</a></li>
<li><a href="../es435494/index.html">Servidor cliente sin interrupciones</a></li>
<li><a href="../es435496/index.html">Tesla demand칩 por un accidente en el que murieron el conductor y el pasajero del Modelo S</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>