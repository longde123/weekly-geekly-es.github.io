<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë¶üèΩ üì£ üî¢ Le livre "Linux en action" üë®üèø‚Äçüè≠ üçü ü§Ω</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Salut, habrozhiteli! Dans le livre, David Clinton d√©crit 12 projets du monde r√©el, notamment l'automatisation d'un syst√®me de sauvegarde et de r√©cup√©r...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Le livre "Linux en action"</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/piter/blog/461879/"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/d4/en/xh/d4enxhes8pqnlk78urqxopa7ley.jpeg" align="left" alt="image"></a>  Salut, habrozhiteli!  Dans le livre, David Clinton d√©crit 12 projets du monde r√©el, notamment l'automatisation d'un syst√®me de sauvegarde et de r√©cup√©ration, la configuration d'un cloud de fichiers de style Dropbox personnel et la cr√©ation de votre propre serveur MediaWiki.  Avec des exemples int√©ressants, vous d√©couvrirez la virtualisation, la reprise apr√®s sinistre, la s√©curit√©, la sauvegarde, le d√©ploiement de DevOps et le d√©pannage des probl√®mes syst√®me.  Chaque chapitre se termine par un examen des recommandations pratiques, un glossaire de nouveaux termes et des exercices. <br><br><h3>  Extrait "10.1.  Cr√©ation d'un tunnel OpenVPN ¬ª </h3><br><a name="habracut"></a>  Dans ce livre, j'ai d√©j√† beaucoup parl√© du chiffrement.  SSH et SCP peuvent prot√©ger les donn√©es transmises via des connexions √† distance (chapitre 3), le cryptage des fichiers vous permet de prot√©ger les donn√©es lorsqu'elles sont stock√©es sur le serveur (chapitre 8), et les certificats TLS / SSL peuvent prot√©ger les donn√©es lors de la transmission entre les sites et les navigateurs clients (chapitre 9).  Mais parfois, vos donn√©es n√©cessitent une protection dans un plus large √©ventail de connexions.  Par exemple, il est possible que certains membres de votre √©quipe doivent travailler sur la route et se connecter au r√©seau via le Wi-Fi via des points d'acc√®s publics.  Vous ne devez certainement pas supposer que tous ces points d'acc√®s sont s√ªrs, mais vos employ√©s ont vraiment besoin d'un moyen de se connecter aux ressources de l'entreprise - auquel cas un VPN vous aidera. <br><br>  Un tunnel VPN correctement con√ßu fournit une connexion directe entre les clients distants et le serveur de mani√®re √† masquer les donn√©es lorsqu'elles sont transmises sur un r√©seau non s√©curis√©.  Et alors?  Vous avez d√©j√† vu de nombreux outils qui peuvent le faire avec le cryptage.  La vraie valeur d'un VPN est qu'en ouvrant un tunnel, vous pouvez connecter des r√©seaux distants comme s'ils √©taient tous ensemble locaux.  Dans un sens, vous utilisez une solution de contournement. <br><br>  En utilisant un tel r√©seau √©tendu, les administrateurs peuvent effectuer leur travail sur leurs serveurs de n'importe o√π.  Mais, plus important encore, une entreprise avec des ressources r√©parties sur plusieurs succursales peut les rendre toutes visibles et accessibles √† tous les groupes qui en ont besoin, o√π qu'ils se trouvent (Fig. 10.1). <br><br>  Le tunnel lui-m√™me ne garantit pas la s√©curit√©.  Mais l'une des normes de chiffrement peut √™tre incluse dans la structure du r√©seau, ce qui augmente consid√©rablement le niveau de s√©curit√©.  Les tunnels cr√©√©s √† l'aide du package OpenVPN open source utilisent le m√™me cryptage TLS / SSL que vous avez d√©j√† lu.  OpenVPN n'est pas la seule option disponible pour le tunneling, mais l'une des plus c√©l√®bres.  On pense qu'il est l√©g√®rement plus rapide et plus s√ªr qu'un autre protocole de tunneling de couche 2 qui utilise le cryptage IPsec. <br><br>  Voulez-vous que tous les membres de votre √©quipe communiquent en toute s√©curit√© entre eux sur la route ou dans diff√©rents b√¢timents?  Pour ce faire, vous devez cr√©er un serveur OpenVPN pour permettre le partage d'application et l'acc√®s √† l'environnement de r√©seau local du serveur.  Pour que cela fonctionne, il suffit de d√©marrer deux machines virtuelles ou deux conteneurs: l'un pour agir en tant que serveur / h√¥te et l'autre pour le client.  La cr√©ation d'un VPN n'est pas un processus facile, il vaut donc probablement la peine de prendre quelques minutes pour avoir une vue d'ensemble. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/vg/gc/o1/vggco1j4npzsjj4rqo8r-5bzmz8.png" alt="image"></div><br><h3>  10.1.1.  Configuration du serveur OpenVPN </h3><br>  Avant de commencer, je vous donnerai des conseils utiles.  Si vous allez tout faire vous-m√™me (et je vous le recommande vivement), vous constaterez probablement que vous travaillez avec plusieurs fen√™tres de terminal ouvertes sur le bureau, chacune √©tant connect√©e √† sa machine.  Il y a un risque qu'√† un moment donn√© vous entriez la mauvaise commande dans la fen√™tre.  Pour √©viter cela, vous pouvez utiliser la commande hostname pour changer le nom de la machine affich√© sur la ligne de commande en quelque chose qui vous indiquera clairement o√π vous √™tes.  D√®s que vous effectuez cette op√©ration, vous devrez quitter le serveur et vous reconnecter pour que les nouveaux param√®tres prennent effet.  Voici √† quoi √ßa ressemble: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/b8/d9/o9/b8d9o9pzt2-m5-rtirtr46hl1lu.png" alt="image"></div><br>  En adh√©rant √† cette approche et en attribuant les noms correspondants √† chacune des machines avec lesquelles vous travaillez, vous pouvez facilement suivre o√π vous √™tes. <br><br><blockquote>  Apr√®s avoir utilis√© le nom d'h√¥te, vous pouvez rencontrer des messages g√™nants Impossible de r√©soudre les serveurs OpenVPN-Server lorsque vous ex√©cutez les commandes suivantes.  La mise √† jour du fichier / etc / hosts avec le nouveau nom d'h√¥te correspondant devrait r√©soudre le probl√®me. </blockquote><br><h3>  Pr√©paration de votre serveur pour OpenVPN </h3><br>  L'installation d'OpenVPN sur votre serveur n√©cessite deux packages: openvpn et easy-rsa (pour contr√¥ler le processus de g√©n√©ration de la cl√© de chiffrement).  Si n√©cessaire, les utilisateurs CentOS doivent d'abord installer le d√©p√¥t epel-release, comme vous l'avez fait au chapitre 2. Pour pouvoir v√©rifier l'acc√®s √† l'application serveur, vous pouvez √©galement installer le serveur Web Apache (apache2 pour Ubuntu et httpd sur CentOS). <br><br>  Pendant que vous configurez le serveur, je vous conseille d'activer un pare-feu qui bloque tous les ports sauf 22 (SSH) et 1194 (le port OpenVPN par d√©faut).  Cet exemple illustre comment ufw fonctionnera sur Ubuntu, mais je suis s√ªr que vous vous souvenez toujours du programme pare-feu CentOS du chapitre 9: <br><br><pre><code class="javascript hljs"># ufw enable # ufw allow <span class="hljs-number"><span class="hljs-number">22</span></span> # ufw allow <span class="hljs-number"><span class="hljs-number">1194</span></span></code> </pre> <br>  Pour autoriser le routage interne entre les interfaces r√©seau sur le serveur, vous devez d√©commenter une ligne (net.ipv4.ip_forward = 1) dans le fichier /etc/sysctl.conf.  Cela vous permettra de rediriger les clients distants au besoin apr√®s leur connexion.  Pour faire fonctionner le nouveau param√®tre, ex√©cutez sysctl -p: <br><br><pre> <code class="javascript hljs"># nano /etc/sysctl.conf # sysctl -p</code> </pre> <br>  L'environnement serveur est maintenant enti√®rement configur√©, mais il y a autre chose √† faire avant d'√™tre pr√™t: vous devrez effectuer les √©tapes suivantes (nous les examinerons plus en d√©tail ci-dessous). <br><br><ol><li>  Cr√©ez un jeu de cl√©s sur le serveur pour chiffrer l'infrastructure √† cl√© publique (PKI) √† l'aide des scripts fournis avec le package easy-rsa.  En substance, le serveur OpenVPN agit √©galement comme sa propre autorit√© de certification (CA). </li><li>  Pr√©parez les cl√©s appropri√©es pour le client </li><li>  Configurer le fichier server.conf pour le serveur </li><li>  Configurez votre client OpenVPN </li><li>  V√©rifiez votre VPN </li></ol><br><h3>  G√©n√©ration de cl√©s de chiffrement </h3><br>  Afin de ne pas vous compliquer la vie, vous pouvez configurer votre infrastructure cl√© sur la m√™me machine o√π le serveur OpenVPN est en cours d'ex√©cution.  Cependant, les recommandations de s√©curit√© sugg√®rent g√©n√©ralement d'utiliser un serveur CA distinct pour les d√©ploiements dans un environnement de production.  Le processus de g√©n√©ration et d'allocation des ressources de cl√© de chiffrement √† utiliser dans OpenVPN est illustr√© sur la Fig.  10.2. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/rw/vl/a0/rwvla0o86yzylrzsytcf--7bnms.png" alt="image"></div><br>  Lorsque vous avez install√© OpenVPN, le r√©pertoire / etc / openvpn / a √©t√© cr√©√© automatiquement, mais il ne contient encore rien.  Les packages openvpn et easy-rsa sont fournis avec des exemples de fichiers de mod√®le que vous pouvez utiliser comme base pour votre configuration.  Pour d√©marrer le processus de certification, copiez le r√©pertoire du mod√®le easy-rsa depuis / usr / share / vers / etc / openvpn et acc√©dez au r√©pertoire easy-rsa /: <br><br><pre> <code class="javascript hljs"># cp -r /usr/share/easy-rsa/ <span class="hljs-regexp"><span class="hljs-regexp">/etc/</span></span>openvpn $ cd /etc/openvpn/easy-rsa</code> </pre> <br>  Le r√©pertoire easy-rsa contiendra d√©sormais pas mal de scripts.  Dans le tableau.  10.1 r√©pertorie les outils que vous utiliserez pour cr√©er des cl√©s. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ih/zx/zt/ihzxztprk0hm0gr9ozc8sz9qsgs.png" alt="image"></div><br><blockquote>  Ces op√©rations n√©cessitent des privil√®ges root, donc via sudo su vous devez devenir root. </blockquote><br>  Le premier fichier avec lequel vous travaillerez s'appelle vars et contient les variables d'environnement que easy-rsa utilise lors de la g√©n√©ration des cl√©s.  Vous devez modifier le fichier pour utiliser vos propres valeurs au lieu des valeurs par d√©faut qui existent d√©j√†.  Voici √† quoi ressemblera mon fichier (Listing 10.1). <br><br>  Listing 10.1.  Les principaux fragments du fichier / etc / openvpn / easy-rsa / vars <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> KEY_COUNTRY=<span class="hljs-string"><span class="hljs-string">"CA"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> KEY_PROVINCE=<span class="hljs-string"><span class="hljs-string">"ON"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> KEY_CITY=<span class="hljs-string"><span class="hljs-string">"Toronto"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> KEY_ORG=<span class="hljs-string"><span class="hljs-string">"Bootstrap IT"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> KEY_EMAIL=<span class="hljs-string"><span class="hljs-string">"info@bootstrap-it.com"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> KEY_OU=<span class="hljs-string"><span class="hljs-string">"IT"</span></span></code> </pre> <br>  L'ex√©cution du fichier vars vous permettra de transf√©rer ses valeurs dans l'environnement shell, d'o√π elles seront incluses dans le contenu de vos nouvelles cl√©s.  Pourquoi la commande sudo ne fonctionne-t-elle pas seule?  Parce qu'√† la premi√®re √©tape, nous √©ditons le script appel√© vars, puis l'appliquons.  Application et signifie que le fichier vars transf√®re ses valeurs √† l'environnement shell, d'o√π elles seront incluses dans le contenu de vos nouvelles cl√©s. <br><br>  Assurez-vous de r√©ex√©cuter le fichier √† l'aide du nouveau shell pour terminer le processus inachev√©.  Lorsque cela est fait, le script vous invite √† ex√©cuter un autre script, tout nettoyer, pour supprimer tout contenu dans le r√©pertoire / etc / openvpn / easy-rsa / keys /: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/2v/b4/ot/2vb4otncxyedhork8j0cs29s_64.png" alt="image"></div><br>  Naturellement, l'√©tape suivante consiste √† ex√©cuter le script clean-all, suivi de build-ca, qui utilise le script pkitool pour cr√©er le certificat racine.  Il vous sera demand√© de confirmer les param√®tres d'authentification fournis par vars: <br><br><pre> <code class="javascript hljs"># ./clean-all # ./build-ca Generating a <span class="hljs-number"><span class="hljs-number">2048</span></span> bit RSA private key</code> </pre> <br>  Vient ensuite le script build-key-server.  Puisqu'il utilise le m√™me script pkitool avec le nouveau certificat racine, vous verrez les m√™mes questions pour confirmer la cr√©ation de la paire de cl√©s.  Les cl√©s recevront des noms en fonction des arguments que vous passez, qui, sauf si vous d√©marrez plusieurs VPN sur cet ordinateur, seront g√©n√©ralement des serveurs, comme dans l'exemple: <br><br><pre> <code class="javascript hljs"># ./build-key-server server [...] Certificate is to be certified until Aug <span class="hljs-number"><span class="hljs-number">15</span></span> <span class="hljs-number"><span class="hljs-number">23</span></span>:<span class="hljs-number"><span class="hljs-number">52</span></span>:<span class="hljs-number"><span class="hljs-number">34</span></span> <span class="hljs-number"><span class="hljs-number">2027</span></span> GMT (<span class="hljs-number"><span class="hljs-number">3650</span></span> days) Sign the certificate? [y/n]:y <span class="hljs-number"><span class="hljs-number">1</span></span> out <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> certificate requests certified, commit? [y/n]y Write out database <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> entries Data Base Updated</code> </pre> <br>  OpenVPN utilise les param√®tres g√©n√©r√©s par l'algorithme Diffie-Hellman (en utilisant build-dh) pour n√©gocier l'authentification pour les nouvelles connexions.  Le fichier cr√©√© ici ne doit pas √™tre secret, mais doit √™tre g√©n√©r√© √† l'aide du script build-dh pour les cl√©s RSA actuellement actives.  Si vous cr√©ez de nouvelles cl√©s RSA √† l'avenir, vous devrez √©galement mettre √† jour le fichier en fonction de l'algorithme Diffie-Hellman: <br><br><pre> <code class="javascript hljs"># ./build-dh</code> </pre> <br>  Vos cl√©s c√¥t√© serveur seront d√©sormais dans le r√©pertoire / etc / openvpn / easy-rsa / keys /, mais OpenVPN ne le sait pas.  Par d√©faut, OpenVPN recherchera les cl√©s dans / etc / openvpn /, alors copiez-les: <br><br><pre> <code class="javascript hljs"># cp /etc/openvpn/easy-rsa/keys/server* <span class="hljs-regexp"><span class="hljs-regexp">/etc/</span></span>openvpn # cp /etc/openvpn/easy-rsa/keys/dh2048.pem /etc/openvpn # cp /etc/openvpn/easy-rsa/keys/ca.crt /etc/openvpn</code> </pre> <br><h3>  Pr√©paration des cl√©s de chiffrement client </h3><br>  Comme vous l'avez d√©j√† vu, le cryptage TLS utilise des paires de cl√©s correspondantes: l'une est install√©e sur le serveur et l'autre sur le client distant.  Cela signifie que vous aurez besoin de cl√©s client.  Notre vieil ami pkitool est exactement ce dont vous avez besoin pour cela.  Dans cet exemple, en ex√©cutant le programme dans le r√©pertoire / etc / openvpn / easy-rsa /, nous lui passons l'argument client pour g√©n√©rer des fichiers appel√©s client.crt et client.key: <br><br><pre> <code class="javascript hljs"># ./pkitool client</code> </pre> <br>  Les deux fichiers client, ainsi que le fichier ca.crt d'origine, qui se trouve toujours dans le r√©pertoire keys /, doivent maintenant √™tre transf√©r√©s en toute s√©curit√© vers votre client.  En raison de leurs droits d'affiliation et d'acc√®s, cela peut ne pas √™tre si facile.  L'approche la plus simple consiste √† copier manuellement le contenu du fichier source (et rien que ce contenu) sur le terminal ex√©cut√© sur le bureau de votre PC (s√©lectionnez le texte, faites un clic droit dessus et s√©lectionnez Copier dans le menu).  Collez-le ensuite dans un nouveau fichier avec le m√™me nom que vous cr√©ez dans le deuxi√®me terminal connect√© √† votre client. <br><br>  Mais n'importe qui peut couper et coller.  Au lieu de cela, pensez en tant qu'administrateur, car vous n'aurez pas toujours acc√®s √† l'interface graphique, o√π une op√©ration couper / coller est possible.  Copiez les fichiers dans le r√©pertoire personnel de votre utilisateur (afin que l'op√©ration scp distante puisse y acc√©der), puis utilisez chown pour changer le propri√©taire des fichiers de root en un utilisateur non root normal afin que l'action scp distante puisse √™tre effectu√©e.  Assurez-vous que tous vos fichiers sont actuellement install√©s et accessibles.  Vous les d√©placerez vers le client un peu plus tard: <br><br><pre> <code class="javascript hljs"># cp /etc/openvpn/easy-rsa/keys/client.key /home/ubuntu/ # cp /etc/openvpn/easy-rsa/keys/ca.crt /home/ubuntu/ # cp /etc/openvpn/easy-rsa/keys/client.crt /home/ubuntu/ # chown ubuntu:ubuntu /home/ubuntu/client.key # chown ubuntu:ubuntu /home/ubuntu/client.crt # chown ubuntu:ubuntu /home/ubuntu/ca.crt</code> </pre> <br>  Avec un ensemble complet de cl√©s de chiffrement pr√™tes √† l'action, vous devez indiquer au serveur comment vous souhaitez cr√©er un VPN.  Cela se fait √† l'aide du fichier server.conf. <br><br><blockquote>  <b>R√©duisez le nombre de frappes</b> <br><br>  Trop √† imprimer?  Une extension entre parenth√®ses aidera √† r√©duire ces six commandes √† deux.  Je suis s√ªr que vous pouvez √©tudier ces deux exemples et comprendre ce qui se passe.  Plus important encore, vous pouvez comprendre comment appliquer ces principes √† des op√©rations impliquant des dizaines voire des centaines d'√©l√©ments: <br><br><pre> <code class="javascript hljs"># cp /etc/openvpn/easy-rsa/keys/{ca.crt,client.{key,crt}} /home/ubuntu/ # chown ubuntu:ubuntu /home/ubuntu/{ca.crt,client.{key,crt}}</code> </pre> <br></blockquote><br><h3>  Configuration du fichier server.conf </h3><br>  Comment savoir √† quoi devrait ressembler le fichier server.conf?  Rappelez-vous le mod√®le de r√©pertoire easy-rsa que vous avez copi√© √† partir de / usr / share /?  Pendant l'installation d'OpenVPN, un fichier de mod√®le de configuration compress√© est rest√©, que vous pouvez copier dans / etc / openvpn /.  Je m'appuierai sur le fait que le mod√®le a √©t√© archiv√© et je vous pr√©senterai un outil utile: zcat. <br><br>  Vous savez d√©j√† comment afficher le contenu textuel d'un fichier √† l'aide de la commande cat, mais que faire si le fichier est compress√© √† l'aide de gzip?  Vous pouvez toujours d√©compresser le fichier, puis cat l'affichera volontiers, mais cela repr√©sente une ou deux √©tapes de plus que n√©cessaire.  Au lieu de cela, comme vous l'avez probablement d√©j√† devin√©, vous pouvez entrer la commande zcat pour charger le texte d√©compress√© en m√©moire en une seule √©tape.  Dans l'exemple suivant, au lieu d'imprimer du texte √† l'√©cran, vous le redirigez vers un nouveau fichier appel√© server.conf: <br><br><pre> <code class="javascript hljs"># zcat \ /usr/share/doc/openvpn/examples/sample-config-files/server.conf.gz \ &gt; <span class="hljs-regexp"><span class="hljs-regexp">/etc/</span></span>openvpn/server.conf $ cd /etc/openvpn</code> </pre> <br>  Nous laissons de c√¥t√© la documentation compl√®te et utile fournie avec le fichier et voyons √† quoi il pourrait ressembler une fois la modification termin√©e.  Notez que le point-virgule (;) indique √† OpenVPN de ne pas lire ou ex√©cuter la ligne suivante (Listing 10.2). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ft/en/4r/ften4rayxj99stxecmfjb9mx8eg.png" alt="image"></div><br>  Passons en revue certains de ces param√®tres. <br><br><ul><li>  Par d√©faut, OpenVPN fonctionne via le port 1194. Vous pouvez modifier cela, par exemple, pour masquer encore plus vos actions ou pour √©viter les conflits avec d'autres tunnels actifs.  √âtant donn√© que 1194 n√©cessite une coordination minimale avec les clients, il est pr√©f√©rable de le faire. </li><li>  OpenVPN utilise le protocole TCP (Transmission Control Protocol) ou le protocole UDP (User Datagram Protocol) pour le transfert de donn√©es.  TCP peut √™tre un peu plus lent, mais il est plus fiable et plus susceptible d'√™tre compris par les applications s'ex√©cutant aux deux extr√©mit√©s du tunnel. </li><li>  Vous pouvez dire √† dev tun quand vous voulez cr√©er un tunnel IP plus simple et plus efficace qui transmet le contenu des donn√©es et rien de plus.  Si, en revanche, vous devez connecter plusieurs interfaces r√©seau (et les r√©seaux qu'elles repr√©sentent) en cr√©ant un pont Ethernet, vous devrez s√©lectionner dev tap.  Si vous ne comprenez pas ce que tout cela signifie, utilisez l'argument tun. </li><li>  Les quatre lignes suivantes transmettent les noms OpenVPN des trois fichiers d'authentification sur le serveur et le fichier de param√®tres dh2048 que vous avez cr√©√© pr√©c√©demment. </li><li>  La ligne de serveur d√©finit la plage et le masque de sous-r√©seau qui seront utilis√©s pour attribuer des adresses IP aux clients lors de la connexion. </li><li>  Le param√®tre push optionnel ¬´route 10.0.3.0 255.255.255.0¬ª permet aux clients distants d'acc√©der √† des sous-r√©seaux priv√©s derri√®re le serveur.  Pour effectuer ce travail, vous devez √©galement configurer le r√©seau sur le serveur lui-m√™me, afin que le sous-r√©seau priv√© connaisse le sous-r√©seau OpenVPN (10.8.0.0). </li><li>  La ligne port-share localhost 80 vous permet de rediriger le trafic client provenant du port 1194 vers le serveur Web local √©coutant sur le port 80. (Cela sera utile si vous avez l'intention d'utiliser le serveur Web pour tester votre VPN.) Cela ne fonctionne que si lorsque le protocole TCP est s√©lectionn√©. </li><li>  Les lignes utilisateur nobody et group nogroup doivent √™tre actives - pour ce faire, supprimez les points-virgules (;).  Forcer les clients distants √† travailler sous personne et nogroup garantit que les sessions sur le serveur ne sont pas privil√©gi√©es. </li><li>  log indique que les entr√©es de journal actuelles remplaceront les anciennes entr√©es √† chaque d√©marrage d'OpenVPN, tandis que log-append ajoute de nouvelles entr√©es √† un fichier journal existant.  Le fichier openvpn.log lui-m√™me est √©crit dans le r√©pertoire / etc / openvpn /. </li></ul><br>  En outre, la valeur client √† client est √©galement souvent ajout√©e au fichier de configuration afin que plusieurs clients puissent se voir en plus du serveur OpenVPN.  Si vous √™tes satisfait de votre configuration, vous pouvez d√©marrer le serveur OpenVPN: <br><br><pre> <code class="javascript hljs"># systemctl start openvpn</code> </pre> <br><blockquote>  En raison de la nature changeante de la relation entre OpenVPN et systemd, la syntaxe suivante peut parfois √™tre requise pour d√©marrer un service: systemctl start openvpn @ server. </blockquote><br>  Ex√©cuter ip addr pour afficher la liste des interfaces r√©seau de votre serveur devrait maintenant afficher un lien vers une nouvelle interface nomm√©e tun0.  OpenVPN le cr√©era pour servir les clients entrants: <br><br><pre> <code class="javascript hljs">$ ip addr [...] <span class="hljs-number"><span class="hljs-number">4</span></span>: tun0: mtu <span class="hljs-number"><span class="hljs-number">1500</span></span> qdisc [...] link/none inet <span class="hljs-number"><span class="hljs-number">10.8</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> peer <span class="hljs-number"><span class="hljs-number">10.8</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span>/<span class="hljs-number"><span class="hljs-number">32</span></span> scope global tun0 valid_lft forever preferred_lft forever</code> </pre> <br>  Vous devrez peut-√™tre red√©marrer le serveur avant que tout commence √† fonctionner compl√®tement.  L'arr√™t suivant est l'ordinateur client. <br><br><h3>  10.1.2.  Configuration du client OpenVPN </h3><br>  Traditionnellement, les tunnels sont construits avec au moins deux sorties (sinon nous les appellerions des grottes).  Un OpenVPN correctement configur√© sur le serveur dirige le trafic vers et depuis le tunnel d'une part.  Mais vous avez √©galement besoin d'une sorte de logiciel c√¥t√© client, c'est-√†-dire √† l'autre bout du tunnel. <br><br>  Dans cette section, je vais me concentrer sur la configuration manuelle d'un ordinateur Linux d'un type ou d'un autre pour fonctionner en tant que client OpenVPN.  Mais ce n'est pas la seule fa√ßon dont cette opportunit√© est disponible.  OpenVPN prend en charge les applications client qui peuvent √™tre install√©es et utilis√©es sur les ordinateurs de bureau et portables avec Windows ou macOS, ainsi que sur les smartphones et tablettes bas√©s sur Android et iOS.  Voir openvpn.net pour plus de d√©tails. <br><br>  Le package OpenVPN devra √™tre install√© sur l'ordinateur client, comme il a √©t√© install√© sur le serveur, bien qu'il n'y ait pas besoin d'easy-rsa, car les cl√©s que vous utilisez existent d√©j√†.  Vous devez copier le fichier de mod√®le client.conf dans le r√©pertoire / etc / openvpn / que vous venez de cr√©er.  Cette fois, le fichier ne sera pas archiv√©, donc la commande cp r√©guli√®re fera parfaitement cette t√¢che: <br><br><pre> <code class="javascript hljs"># apt install openvpn # cp /usr/share/doc/openvpn/examples/sample-config-files/client.conf \ /etc/openvpn/</code> </pre> <br>  La plupart des param√®tres de votre fichier client.conf seront assez simples: ils doivent correspondre aux valeurs du serveur.  Comme vous pouvez le voir dans l'exemple de fichier suivant, le param√®tre unique est distant 192.168.1.23 1194, qui indique au client l'adresse IP du serveur.  Encore une fois, assurez-vous qu'il s'agit de l'adresse de votre serveur.  Vous devez √©galement forcer l'ordinateur client √† authentifier le certificat de serveur pour emp√™cher une √©ventuelle attaque de l'homme du milieu.  Une fa√ßon de proc√©der consiste √† ajouter le serveur de ligne remote-cert-tls (Listing 10.3). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/m1/nw/2w/m1nw2wwrhwag7fct4mr4ggng5n4.png" alt="image"></div><br>  Vous pouvez maintenant aller dans le r√©pertoire / etc / openvpn / et extraire les cl√©s de certification du serveur.  Remplacez l'adresse IP ou le nom de domaine du serveur dans l'exemple par vos valeurs: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ng/u1/rm/ngu1rmk8tyxrntuepummte1wxuo.png" alt="image"></div><br>  Rien d'excitant n'est susceptible de se produire jusqu'√† ce que vous ex√©cutiez OpenVPN sur le client.  Puisque vous devez passer quelques arguments, vous le ferez √† partir de la ligne de commande.  L'argument --tls-client indique √† OpenVPN que vous agirez en tant que client et que vous vous connecterez √† l'aide du chiffrement TLS, et --config pointe vers votre fichier de configuration: <br><br><pre> <code class="javascript hljs"># openvpn --tls-client --config /etc/openvpn/client.conf</code> </pre> <br>  Lisez attentivement la sortie de la commande pour vous assurer que vous √™tes correctement connect√©.  Si, pour la premi√®re fois, quelque chose ne va pas, cela peut √™tre d√ª √† un d√©calage entre les param√®tres entre les fichiers de configuration du serveur et du client ou √† un probl√®me de connexion r√©seau / pare-feu.  Voici quelques conseils de d√©pannage. <br><br><ul><li>  Lisez attentivement la sortie de l'op√©ration OpenVPN sur le client.  Il contient souvent de pr√©cieux conseils sur ce qui ne peut pas √™tre effectu√© exactement et pourquoi. </li><li>  V√©rifiez les messages d'erreur dans les fichiers openvpn.log et openvpn-status.log dans le r√©pertoire / etc / openvpn / sur le serveur. </li><li>  V√©rifiez les messages li√©s √† OpenVPN et appropri√©s dans le temps dans les journaux syst√®me sur le serveur et le client.  (journalctl -ce affichera les entr√©es les plus r√©centes.) </li><li>  Assurez-vous que vous disposez d'une connexion r√©seau active entre le serveur et le client (pour plus de d√©tails, voir le chapitre 14). </li></ul><br><h3>  √Ä propos de l'auteur </h3><br>  <b>David Clinton</b> est administrateur syst√®me, enseignant et √©crivain.  Il a administr√©, √©crit √† ce sujet et cr√©√© du mat√©riel de formation pour de nombreuses disciplines techniques importantes, y compris les syst√®mes Linux, le cloud computing (en particulier AWS) et les technologies de conteneurs telles que Docker.  Il a √©crit le livre Learn Amazon Web Services in a Month of Lunches (Manning, 2017).  Beaucoup de ses didacticiels vid√©o peuvent √™tre trouv√©s sur Pluralsight.com, et des liens vers ses autres livres (sur l'administration Linux et la virtualisation des serveurs) sont disponibles sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">bootstrap-it.com</a> . <br><br>  ¬ªPlus d'informations sur le livre sont disponibles sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">le site Web de l'√©diteur</a> <br>  ¬ª <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Contenu</a> <br>  ¬ª <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Extrait</a> <br><br>  25% de r√©duction sur les colporteurs - <b>Linux</b> <br>  Lors du paiement de la version papier du livre, un livre √©lectronique est envoy√© par e-mail. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr461879/">https://habr.com/ru/post/fr461879/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr461867/index.html">Comment reconna√Ætre des images et des textes sur votre t√©l√©phone √† l'aide de ML Kit</a></li>
<li><a href="../fr461871/index.html">101 conseils pour devenir un bon programmeur (et humain)</a></li>
<li><a href="../fr461873/index.html">ViewPager 2 - nouvelle fonctionnalit√© dans l'ancien wrapper</a></li>
<li><a href="../fr461875/index.html">5 nm vs 3 nm</a></li>
<li><a href="../fr461877/index.html">Java vs Kotlin pour Android: avis des d√©veloppeurs</a></li>
<li><a href="../fr461881/index.html">Guide de journalisation Node.js</a></li>
<li><a href="../fr461885/index.html">EDS est un autre type de fraude</a></li>
<li><a href="../fr461887/index.html">Entr√©e dans Aeronet Episode 2: Homing Drone</a></li>
<li><a href="../fr461891/index.html">Comment nous nous sommes fait des amis dans l'infrastructure bancaire √† l'aide de ManageIQ</a></li>
<li><a href="../fr461895/index.html">Apprenez en voyage - comment nous avons conduit lors de la premi√®re journ√©e europ√©enne de l'analyse commerciale</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>