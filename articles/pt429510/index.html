<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©‚Äç‚ù§Ô∏è‚Äçüíã‚Äçüë® ü¶î üìã ArduPilot para iniciantes. Instale e configure no BeagleBone Blue üö£üèª ‚è¨ üíï</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="N√≥s, com uma equipe (da qual voc√™ pode se juntar ) de pessoas com id√©ias semelhantes da Habr, estamos desenvolvendo um rob√¥ para coletar bolas de golf...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ArduPilot para iniciantes. Instale e configure no BeagleBone Blue</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/robogazon/blog/429510/"> N√≥s, com uma equipe (da <b>qual voc√™ pode se juntar</b> ) de pessoas com id√©ias semelhantes da Habr, estamos desenvolvendo um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">rob√¥ para coletar bolas de golfe no driving range</a> .  Como √© um rob√¥ de servi√ßo altamente especializado, planejamos desenvolver simultaneamente um √∫nico complexo de software e hardware que possa ser usado posteriormente como base para outros rob√¥s de servi√ßo e <b>UGV</b> . <br><br><img src="https://habrastorage.org/webt/3x/wy/of/3xwyof39bhwkwbvvqoyjqmxdmay.jpeg"><br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">No √∫ltimo post,</a> descrevemos por que paramos neste software.  Ao configurar nosso projeto, usamos as <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">informa√ß√µes do artigo</a> .  Na verdade, aqui apresentamos a tradu√ß√£o deste breve guia, talvez para algu√©m seja √∫til e o ajude a fazer seu primeiro ou pr√≥ximo rob√¥. <br><a name="habracut"></a><br>  Antes de come√ßar, quero enfatizar que vale a pena usar o BeagleBone Blue (ainda √© azul).  Como regra, anexaremos alguns dispositivos perif√©ricos relacionados √† navega√ß√£o, e eles n√£o funcionar√£o corretamente sem energia suficiente. <br><br><h2>  Parte 1. Preparando o BeagleBone </h2><br>  V√° para <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://rcn-ee.net/rootfs/bb.org/testing/</a> e selecione o diret√≥rio com a data mais recente.  Em seguida, abra o subdiret√≥rio do <b>console extens√≠vel</b> .  Aqui voc√™ ver√° v√°rios arquivos.  Fa√ßa o download de um arquivo chamado Algo como <b>'bone-debian-VV-console-armhf-20AA-MM-DD-1gb.img.xz'</b> .  Esta √© uma distribui√ß√£o Debian m√≠nima contendo apenas o essencial.  Uma alternativa √© a imagem da Internet das coisas (Internet das coisas), que vem com software adicional e pode tornar o trabalho mais confort√°vel se voc√™ for novo no Linux.  Est√° dispon√≠vel no mesmo site. <br><br>  Usamos: <a href="">https://rcn-ee.net/rootfs/bb.org/testing/2018-10-07/stretch-console/bone-debian-9.5-console-armhf-2018-10-07-1gb.img .xz</a> . <br><br>  Em seguida, voc√™ precisar√° piscar a imagem no cart√£o microSD.  Se voc√™ usa Linux ou Windows, eu recomendo um programa chamado Etcher para esta tarefa ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://etcher.io/</a> ). <br><br>  Agora voc√™ pode baixar o BeagleBone Blue do cart√£o microSD.  Isso est√° al√©m do escopo deste documento para descrever em detalhes todos os m√©todos de intera√ß√£o, mas geralmente isso √© alcan√ßado atrav√©s da conex√£o via cabo micro-USB ou via SSH (para 'debian@192.168.7.2', senha 'temppwd') ou pela porta COM ( Usu√°rio Debian ', senha' temppwd) em um programa como minicom ou PuTTY.  Essa conex√£o com o console Linux atrav√©s da porta COM.  O UART1 nas vers√µes BBB √© sempre vinculado ao console, primeiro ao U-boot e depois ao Linux.  Mais informa√ß√µes podem ser encontradas aqui: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://beagleboard.org/blue</a> <br><br>  Os drivers BeagleBone v√™m com o Windows 10. No Linux, o BBB como uma porta COM USB universal n√£o pode ser atendido.  Se voc√™ estiver tendo problemas, tente: <br><br><pre><code class="bash hljs">sudo -s cat &gt;/etc/udev/rules.d/73-beaglebone.rules &lt;&lt;EOF ACTION==<span class="hljs-string"><span class="hljs-string">"add"</span></span>, SUBSYSTEM==<span class="hljs-string"><span class="hljs-string">"usb"</span></span>, ENV{DEVTYPE}==<span class="hljs-string"><span class="hljs-string">"usb_interface"</span></span>, ATTRS{idVendor}==<span class="hljs-string"><span class="hljs-string">"0403"</span></span>, ATTRS{idProduct}==<span class="hljs-string"><span class="hljs-string">"a6d0"</span></span>, DRIVER==<span class="hljs-string"><span class="hljs-string">""</span></span>, RUN+=<span class="hljs-string"><span class="hljs-string">"/sbin/modprobe -b ftdi_sio"</span></span> ACTION==<span class="hljs-string"><span class="hljs-string">"add"</span></span>, SUBSYSTEM==<span class="hljs-string"><span class="hljs-string">"drivers"</span></span>, ENV{DEVPATH}==<span class="hljs-string"><span class="hljs-string">"/bus/usb-serial/drivers/ftdi_sio"</span></span>, ATTR{new_id}=<span class="hljs-string"><span class="hljs-string">"0403 a6d0"</span></span> ACTION==<span class="hljs-string"><span class="hljs-string">"add"</span></span>, KERNEL==<span class="hljs-string"><span class="hljs-string">"ttyUSB*"</span></span>, ATTRS{interface}==<span class="hljs-string"><span class="hljs-string">"BeagleBone"</span></span>, ATTRS{bInterfaceNumber}==<span class="hljs-string"><span class="hljs-string">"00"</span></span>, SYMLINK+=<span class="hljs-string"><span class="hljs-string">"beaglebone-jtag"</span></span> ACTION==<span class="hljs-string"><span class="hljs-string">"add"</span></span>, KERNEL==<span class="hljs-string"><span class="hljs-string">"ttyUSB*"</span></span>, ATTRS{interface}==<span class="hljs-string"><span class="hljs-string">"BeagleBone"</span></span>, ATTRS{bInterfaceNumber}==<span class="hljs-string"><span class="hljs-string">"01"</span></span>, SYMLINK+=<span class="hljs-string"><span class="hljs-string">"beaglebone-serial"</span></span> EOF udevadm control --reload-rules <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span></code> </pre> <br>  Espero que voc√™ esteja logado na linha de comando.  Come√ßaremos permitindo que o usu√°rio debian execute o sudo sem ter que digitar uma senha toda vez (subseq√ºente): <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"debian ALL=(ALL) NOPASSWD: ALL"</span></span> | sudo tee -a /etc/sudoers.d/debian &gt;/dev/null</code> </pre><br>  O pr√≥ximo trabalho √© atualizar e instalar o software usando uma conex√£o de Internet acess√≠vel, por isso √© hora de configurar o connman para acesso Wi-Fi.  Fa√ßo isso porque facilitar√° o trabalho no futuro.  Primeiro, anote a senha SSID e WiFi do seu roteador.  Em seguida, digite o seguinte: <br><br><pre> <code class="bash hljs"> sudo -s connmanctl services | grep <span class="hljs-string"><span class="hljs-string">'&lt;your SSID&gt;'</span></span> | grep -Po <span class="hljs-string"><span class="hljs-string">'wifi_[^ ]+'</span></span></code> </pre><br>  A resposta ser√° mais ou menos assim: 'wifi_38d279e099a8_4254487562142d4355434b_managed_psk'.  Se voc√™ n√£o vir nada, tente novamente. Voc√™ provavelmente cometeu um erro de digita√ß√£o. <br><br>  Agora, usando esse ID de rede, vamos inserir o arquivo diretamente do teclado (stdin) usando cat, uma linha de cada vez: <br><br><pre> <code class="bash hljs"> cat &gt;/var/lib/connman/wifi.config [service_&lt;your <span class="hljs-built_in"><span class="hljs-built_in">hash</span></span>&gt;] Type = wifi Security = wpa2 Name = &lt;your SSID&gt; Passphrase = &lt;your WiFi password&gt;</code> </pre><br>  Importante!  Antes de Ctrl + C, pressione Enter, caso contr√°rio, toda a linha atual ser√° perdida. <br>  Pressione Ctrl-C para sair e digite: exit <br><br>  O LED verde vis√≠vel acender√°, o que significa que o Wi-Fi est√° ativado.  O BBBlue est√° conectado ao roteador e seu endere√ßo IP na sua rede Wi-Fi pode ser encontrado usando: <br><br><pre> <code class="bash hljs">ip addr show wlan0</code> </pre><br>  Se, por algum motivo, voc√™ n√£o puder solicitar o BBBlue diretamente, use outros utilit√°rios, como o nmap (sudo nmap 192.168.0.0/24) ou fa√ßa o login no seu roteador e procure nele de outras maneiras para encontrar seu endere√ßo IP. <br><br>  Agora tente conectar-se via SSH usando seu endere√ßo IP Wi-Fi.  Lembre-se de que 192.168.7.2 tamb√©m funcionar√°. <br><br>  Se voc√™ n√£o conseguir que o WiFi funcione com o connman, ou se simplesmente n√£o quiser usar o connman, use o seguinte m√©todo.  Primeiro, digite: sudo systemctl disable connman.  Em seguida, com sua senha SSID e WiFi, edite / etc / network / interfaces <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># The loopback network interface. auto lo iface lo inet loopback # WiFi w/ onboard device (dynamic IP). auto wlan0 iface wlan0 inet dhcp wpa-ssid "&lt;your SSID&gt;" wpa-psk "&lt;your WiFi password&gt;" dns-nameservers 8.8.8.8 1.1.1.1 # Ethernet/RNDIS gadget (g_ether). # Used by: /opt/scripts/boot/autoconfigure_usb0.sh iface usb0 inet static address 192.168.7.2 netmask 255.255.255.252 network 192.168.7.0 gateway 192.168.7.1</span></span></code> </pre><br>  Agora recarregue BBBlue com: <b>sudo reboot</b> <br><br>  Ap√≥s o login, digite: sudo ifup wlan0.  O LED verde deve acender. <br><br>  Se voc√™ deseja que o BB tenha um IP est√°tico (por exemplo, 192.168.0.99), altere "# WiFi com dispositivo integrado (IP din√¢mico)". Se√ß√£o / etc / network / interfaces para ler: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># WiFi w/ onboard device (static IP). auto wlan0 iface wlan0 inet static wpa-ssid "&lt;your SSID&gt;" wpa-psk "&lt;your WiFi password&gt;" address 192.168.0.99 # &lt;--- The desired static IP address of the BBBlue. netmask 255.255.255.0 gateway 192.168.0.1 # &lt;--- The address of your router. dns-nameservers 8.8.8.8 1.1.1.1</span></span></code> </pre><br>  Atualizando e instalando todos os programas de suporte necess√°rios: <br><br><pre> <code class="bash hljs">sudo apt-get -y update sudo apt-get -y dist-upgrade sudo apt-get install -y cpufrequtils git</code> </pre><br>  Scripts de atualiza√ß√£o: cd / opt / scripts &amp; &amp; git pull <br><br>  <b>O kernel em tempo real atualmente cont√©m bugs!</b>  <b>Use a seguinte corre√ß√£o: Especifique o kernel em tempo real Ti 4_4.</b>  <b>N√£o use 4_14.</b> <br><br><pre> <code class="bash hljs">sudo /opt/scripts/tools/update_kernel.sh --ti-rt-channel --lts-4_4 sudo sed -i <span class="hljs-string"><span class="hljs-string">'s|uboot_overlay_pru=/lib/firmware/AM335X-PRU-RPROC-4-14-TI-00A0.dtbo|#uboot_overlay_pru=/lib/firmware/AM335X-PRU-RPROC-4-14-TI-00A0.dtbo|g'</span></span> /boot/uEnv.txt sudo sed -i <span class="hljs-string"><span class="hljs-string">'s|#uboot_overlay_pru=/lib/firmware/AM335X-PRU-RPROC-4-4-TI-00A0.dtbo|uboot_overlay_pru=/lib/firmware/AM335X-PRU-RPROC-4-4-TI-00A0.dtbo|g'</span></span> /boot/uEnv.txt</code> </pre><br>  Por fim, copie am335x-bone blue.dtb (do diret√≥rio bin deste reposit√≥rio) para /boot/dtbs/4.4.113-ti-rt-r149 <br><br>  Instale o script na execu√ß√£o autom√°tica <br><br><pre> <code class="bash hljs">sudo sed -i <span class="hljs-string"><span class="hljs-string">'s/#dtb=/dtb=am335x-boneblue.dtb/g'</span></span> /boot/uEnv.txt</code> </pre><br>  Definir frequ√™ncia <br><br><pre> <code class="bash hljs">sudo sed -i <span class="hljs-string"><span class="hljs-string">'s/GOVERNOR="ondemand"/GOVERNOR="performance"/g'</span></span> /etc/init.d/cpufrequtils</code> </pre><br>  Configurando bb-wl18xx-wlan0.service <br><br><pre> <code class="bash hljs">sudo sed -i <span class="hljs-string"><span class="hljs-string">'s/RestartSec=5/RestartSec=1/g'</span></span> /lib/systemd/system/bb-wl18xx-wlan0.service</code> </pre><br>  Configurando bb-wl18xx-wlan0.service <br><br><pre> <code class="bash hljs">sudo sed -i <span class="hljs-string"><span class="hljs-string">'s/RestartSec=5/RestartSec=1/g'</span></span> /lib/systemd/system/bb-wl18xx-wlan0.service</code> </pre><br>  Desativar Bluetooth (opcional) <br><br><pre> <code class="bash hljs">sudo systemctl <span class="hljs-built_in"><span class="hljs-built_in">disable</span></span> bb-wl18xx-bluetooth.service</code> </pre><br>  Expanda a parti√ß√£o do cart√£o microSD existente (/ dev / mmcblk0p1): <br><br><pre> <code class="bash hljs">sudo /opt/scripts/tools/grow_partition.sh</code> </pre><br>  Reinicie agora: <br><br><pre> <code class="bash hljs">sudo reboot</code> </pre><br><h2>  Parte 2. Instale o ArduPilot em um BeagleBone </h2><br>  Quando o BeagleBone √© reiniciado, precisamos criar alguns arquivos de texto.  Primeiro, melhorando o arquivo de configura√ß√£o do ambiente, / etc / default / ardupilot: <br>  <i>(Dica: digite sudoedit / etc / default / ardupilot e insira seu pr√≥prio endere√ßo IP de destino, por exemplo, 192.168.0.13)</i> <br><br><pre> <code class="bash hljs">TELEM1=<span class="hljs-string"><span class="hljs-string">"-C /dev/ttyO1"</span></span> TELEM2=<span class="hljs-string"><span class="hljs-string">"-A udp:&lt;target IP address&gt;:14550"</span></span> GPS=<span class="hljs-string"><span class="hljs-string">"-B /dev/ttyS2"</span></span></code> </pre><br>  Essa √© uma configura√ß√£o bastante t√≠pica. <br><br>  Este √© o par√¢metro de inicializa√ß√£o -C mapeia a porta serial "Telem1" do ArduPilot (SERIAL1, padr√£o 57600) para UART1 no BBBlue.  Por exemplo, eu tenho um r√°dio RFDesign 868x conectado ao UART1.  Este √© um canal de dados bidirecional com o meu drone.  Ele envia v√°rios dados de telemetria para a esta√ß√£o base e recebe comandos RTK e corre√ß√µes diferenciais da esta√ß√£o base. <br><br>  Este √© o par√¢metro de inicializa√ß√£o -A mapeia a porta serial ‚ÄúConsole‚Äù do ArduPilot (SERIAL0, padr√£o 115200) com protocolo, endere√ßo IP de destino e n√∫mero da porta opcional.  Por exemplo, isso permite que eu receba dados do MAVLink vindos do Wi-Fi para fins de teste.  Realmente √∫til, especialmente porque os dados podem ir imediatamente para o Mission Planner e o QGroundControl. <br><br><img src="https://habrastorage.org/webt/3d/d7/m1/3dd7m1ilxlbkd3elqxnddq_1rcm.jpeg" alt="imagem"><br><br>  Este √© o par√¢metro de inicializa√ß√£o -B mapeia a porta serial ‚ÄúGPS‚Äù do ArduPilot (SERIAL3, padr√£o 57600) com Uart2 BBBlue (UART, vagamente marcado como 'GPS' na pr√≥pria placa).  Por exemplo, eu tenho um U-blox NEO-M8P conectado ao UART2. <br><br>  Existem outras possibilidades - existem outras op√ß√µes de inicializa√ß√£o, com velocidades de porta predefinidas e as pr√≥prias portas: <br><br><pre> <code class="bash hljs">Switch -A --&gt; <span class="hljs-string"><span class="hljs-string">"Console"</span></span>, SERIAL0, default 115200 Switch -B --&gt; <span class="hljs-string"><span class="hljs-string">"GPS"</span></span>, SERIAL3, default 57600 Switch -C --&gt; <span class="hljs-string"><span class="hljs-string">"Telem1"</span></span>, SERIAL1, default 57600 Switch -D --&gt; <span class="hljs-string"><span class="hljs-string">"Telem2"</span></span>, SERIAL2, default 38400 Switch -E --&gt; Unnamed, SERIAL4, default 38400 Switch -F --&gt; Unnamed, SERIAL5, default 57600</code> </pre><br>  Consulte a documenta√ß√£o oficial do ArduPilot para obter mais informa√ß√µes sobre as v√°rias portas seriais: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">http://ardupilot.org/plane/docs/parameters.html?highlight=parameters</a> <br><br>  Em seguida, criaremos os arquivos de servi√ßo do systemd do ArduPilot, um para o ArduCopter, /lib/systemd/system/arducopter.service: <br><br><pre> <code class="bash hljs">[Unit] Description=ArduCopter Service After=networking.service StartLimitIntervalSec=0 Conflicts=arduplane.service ardurover.service antennatracker.service [Service] EnvironmentFile=/etc/default/ardupilot ExecStartPre=/usr/bin/ardupilot/aphw ExecStart=/usr/bin/ardupilot/arducopter <span class="hljs-variable"><span class="hljs-variable">$TELEM1</span></span> <span class="hljs-variable"><span class="hljs-variable">$TELEM2</span></span> <span class="hljs-variable"><span class="hljs-variable">$GPS</span></span> Restart=on-failure RestartSec=1 [Install] WantedBy=multi-user.target</code> </pre><br>  Um para o ArduPlane, /lib/systemd/system/arduplane.service: <br><br><pre> <code class="bash hljs">[Unit] Description=ArduPlane Service After=networking.service StartLimitIntervalSec=0 Conflicts=arducopter.service ardurover.service antennatracker.service [Service] EnvironmentFile=/etc/default/ardupilot ExecStartPre=/usr/bin/ardupilot/aphw ExecStart=/usr/bin/ardupilot/arduplane <span class="hljs-variable"><span class="hljs-variable">$TELEM1</span></span> <span class="hljs-variable"><span class="hljs-variable">$TELEM2</span></span> <span class="hljs-variable"><span class="hljs-variable">$GPS</span></span> Restart=on-failure RestartSec=1 [Install] WantedBy=multi-user.target</code> </pre><br>  Um para o ArduRover, /lib/systemd/system/ardurover.service: <br><br><pre> <code class="bash hljs">[Unit] Description=ArduRover Service After=networking.service StartLimitIntervalSec=0 Conflicts=arducopter.service arduplane.service antennatracker.service [Service] EnvironmentFile=/etc/default/ardupilot ExecStartPre=/usr/bin/ardupilot/aphw ExecStart=/usr/bin/ardupilot/ardurover <span class="hljs-variable"><span class="hljs-variable">$TELEM1</span></span> <span class="hljs-variable"><span class="hljs-variable">$TELEM2</span></span> <span class="hljs-variable"><span class="hljs-variable">$GPS</span></span> Restart=on-failure RestartSec=1 [Install] WantedBy=multi-user.target</code> </pre><br>  E o AntennaTracker tamb√©m?  Crie /lib/systemd/system/antennatracker.service: <br><br><pre> <code class="bash hljs">[Unit] Description=AntennaTracker Service After=networking.service StartLimitIntervalSec=0 Conflicts=arducopter.service arduplane.service ardurover.service [Service] EnvironmentFile=/etc/default/ardupilot ExecStartPre=/usr/bin/ardupilot/aphw ExecStart=/usr/bin/ardupilot/antennatracker <span class="hljs-variable"><span class="hljs-variable">$TELEM1</span></span> <span class="hljs-variable"><span class="hljs-variable">$TELEM2</span></span> <span class="hljs-variable"><span class="hljs-variable">$GPS</span></span> Restart=on-failure RestartSec=1 [Install] WantedBy=multi-user.target</code> </pre><br>  Vamos para a pasta sudo mkdir -p / usr / bin / ardupilot <br><br>  Crie um arquivo de configura√ß√£o do ArduPilot, / usr / bin / ardupilot / aphw, que √© executado antes dos arquivos execut√°veis. <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash # aphw # ArduPilot hardware configuration. /bin/echo 80 &gt;/sys/class/gpio/export /bin/echo out &gt;/sys/class/gpio/gpio80/direction /bin/echo 1 &gt;/sys/class/gpio/gpio80/value /bin/echo pruecapin_pu &gt;/sys/devices/platform/ocp/ocp:P8_15_pinmux/state</span></span></code> </pre><br>  As linhas 5-7 incluem a pot√™ncia servo BBBlue + 5V, ou seja, quando voc√™ estiver usando servos.  N√£o √© necess√°rio para o ESC. <br><br>  A linha 8 inclui a PRU. <br><br>  Use sudo chmod 0755 / usr / bin / ardupilot / aphw para definir permiss√µes para este arquivo. <br><br>  Quase aconteceu!  Agora voc√™ deve obter os arquivos execut√°veis ‚Äã‚Äãmais recentes do ArduCopter, ArduPlane etc. criados especificamente para a arquitetura Arm BBBlue e coloc√°-los no diret√≥rio / usr / bin / ardupilot.  Mirko Denecke os carregou em seu site aqui: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">http://bbbmini.org/download/blue/</a> <br><br>  Copie para este reposit√≥rio: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://github.com/imfatant/test/blob/master/bin/</a> <br><br>  N√£o se esque√ßa de definir os direitos: sudo chmod 0755 / usr / bin / ardupilot / a * <br><br>  Se voc√™ acha que precisa compilar a partir da fonte, n√£o se assuste - n√£o √© t√£o dif√≠cil.  Al√©m disso, isso significa que voc√™ pode criar seu pr√≥prio software ArduPilot. <br><br>  Colet√°-los no pr√≥prio BBBlue levar√° muito tempo.  Patrick Poirier explica o processo do BBBMINI (baseado no BeagleBone preto) em seu site.  Aqui est√° o procedimento espec√≠fico do BBBlue, supondo que voc√™ tenha conclu√≠do todas as etapas at√© agora e esteja no diret√≥rio / home / debian: <br><br><pre> <code class="bash hljs">sudo apt-get install g++ make pkg-config python python-dev python-lxml python-pip sudo pip install future git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/ArduPilot/ardupilot <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ardupilot git checkout Copter-3.6 <span class="hljs-comment"><span class="hljs-comment"># &lt;-- For ArduCopter. git submodule update --init --recursive ./waf configure --board=blue # &lt;-- BeagleBone Blue. ./waf sudo cp ./build/blue/bin/a* /usr/bin/ardupilot</span></span></code> </pre><br>  Patrick tamb√©m fornece instru√ß√µes para compil√°-los em um PC desktop x64 relativamente poderoso no Ubuntu, que √© muito, muito mais r√°pido. <br><br>  Dependendo da op√ß√£o de software necess√°ria <br>  sudo systemctl enable arducopter.service <br>  ou <br>  sudo systemctl enable arduplane.service <br>  ou <br>  sudo systemctl enable ardurover.service <br>  ou <br>  sudo systemctl enable antennatracker.service <br><br>  Ap√≥s a reinicializa√ß√£o, o seu ArduPilot deve iniciar automaticamente.  Voc√™ ver√° um LED vermelho piscando! <br><br>  Voc√™ pode conferir o systemctl ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://www.freedesktop.org/software/systemd/man/systemctl.html</a> ).  Alguns exemplos de comandos √∫teis: <br><br><pre> <code class="bash hljs">sudo systemctl <span class="hljs-built_in"><span class="hljs-built_in">disable</span></span> ... sudo systemctl start ... sudo systemctl stop ...</code> </pre><br><h3>  Parte 3. Conectando perif√©ricos </h3><br><img src="https://habrastorage.org/webt/fx/xo/ae/fxxoaey0otck_4ti6yl0p1dzbgu.jpeg" alt="imagem"><br><br>  A configura√ß√£o m√≠nima b√°sica provavelmente incluir√°: <br><br><ul><li>  Receptor R / C. </li><li>  Receptor GPS (com ou sem b√∫ssola integrada). </li><li>  Um modem de r√°dio para um canal de dados bidirecional, especialmente em longas dist√¢ncias. </li><li>  (O WiFi BBBlue embutido √© √≥timo para depura√ß√£o e teste a curta dist√¢ncia, se 2,4 GHz estiver dispon√≠vel, mas para algo mais interessante, √© recomendado um canal de dados bidirecional dedicado. Lembre-se tamb√©m do tipo e do posicionamento das antenas que usam todos esses elementos. ) </li></ul><br>  Algumas palavras sobre os conectores, cabos e ferramentas que voc√™ precisa.  Vou dar algumas recomenda√ß√µes, caso contr√°rio, se voc√™ √© iniciante, pode gastar muito tempo, esfor√ßo e dinheiro.  O tipo de conector mais usado √© o JST-SH 1,0 mm.  Voc√™ precisa comprar v√°rios conectores f√™mea em tamanhos de posi√ß√£o 4 e 6 e contatos de crimpagem.  Ent√£o pegue alguns metros de fios de cores diferentes. <br><br>  Ent√£o, voltando √† conex√£o de perif√©ricos: <br><br><img src="https://habrastorage.org/webt/h4/mq/7k/h4mq7kn51qxgbc4orkk4ghmluoo.jpeg"><br><br>  Receptor R / C: pode ser desligado em qualquer contato + 5V e GND.  Tudo o que resta √© conectar a sa√≠da SBUS, DSM ou PPM do receptor a um dos dois pinos SBUS marcados no diagrama.  Os seguintes receptores foram testados e est√£o funcionando: <br><br>  FrSky ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://www.frsky-rc.com/</a> ): R-XSR, XR4SB, X6R, X8R, R9 Slim e R9 Mini (ambos os firmwares EU LBT 868 MHz e Universal 915 MHz). <br><br>  Spektrum ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://www.spektrumrc.com/</a> ): AR7700 DSMX com PPM / SRXL / Rx remoto. <br><br>  TBS ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">http://team-blacksheep.com/</a> ): Crossfire 'Full' com Nano Rx (Rx definido no modo SBUS). <br><br>  Ali√°s, eles falam muito sobre o ‚ÄúSBUS invertido‚Äù.  Na verdade, o SBUS √© apenas um protocolo de transfer√™ncia de dados serial que Futaba inventou e que FrSky copiou.  Est√° de cabe√ßa para baixo em compara√ß√£o com o UART "padr√£o".  Felizmente, o Ardupilot Blue espera esse sinal SBUS invertido, portanto n√£o h√° necessidade de um inversor de sinal. <br><br>  Receptor GPS: a maioria das pessoas usa receptores u-blox, especialmente NEO-M8N e NEO-M8P.  O NEO-M8N √© barato e acess√≠vel a partir de empresas chinesas como o HobbyKing, geralmente em forma de disco.  Convenientemente, eles cont√™m o pr√≥prio receptor, uma antena muito pequena de cer√¢mica e geralmente incluem uma b√∫ssola.  Enquanto o BBBlue j√° possui uma b√∫ssola embutida (AKM AK8963), o ArduPilot pode ser configurado para usar essa b√∫ssola ‚Äúexterna‚Äù em vez da sua, para evitar interfer√™ncias. <br><br>  Uma alternativa (muito) mais cara ao NEO-M8N √© o NEO-M8P.  Este receptor suporta um modo de opera√ß√£o conhecido como ‚ÄúRTK‚Äù, ou cinem√°tico em tempo real, que pode alcan√ßar precis√£o de posicionamento de alguns cent√≠metros em tempo real.  No entanto, esse tipo de apresenta√ß√£o tem um pre√ßo cerca de 10 vezes mais caro que o NEO-M8N, e isso √© sem uma esta√ß√£o base.  Posteriormente neste manual, dedicarei uma se√ß√£o especial ao M8P. <br><br>  Arquivo de configura√ß√£o do I2C ArduPilot: /var/APM/{ArduCopter.stg,ArduPlane.stg,APMrover2.stg,AntennaTracker.stg} <br><br><pre> <code class="bash hljs">sudo apt-get install i2c-tools sudo i2cdetect -r -y 0 sudo i2cdetect -r -y 1 sudo i2cdetect -r -y 2</code> </pre><br><pre> <code class="bash hljs">$ sudo i2cdetect -r -y 2 0 1 2 3 4 5 6 7 8 9 abcdef 00: -- -- -- -- -- -- -- -- -- 0c -- -- -- 10: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 20: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 30: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 40: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 50: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 60: -- -- -- -- -- -- -- -- 68 -- -- -- -- -- -- -- 70: -- -- -- -- -- -- 76 --</code> </pre><br>  68 = IMU InvenSense MPU-9250 (a bordo), 0c = b√∫ssola AKM AK8963 (a bordo), 76 = bar√¥metro Bosch BMP280 (a bordo). <br><br><pre> <code class="bash hljs">$ sudo i2cdetect -r -y 1 0 1 2 3 4 5 6 7 8 9 abcdef 00: -- -- -- -- -- -- -- -- -- -- -- -- -- 10: -- -- -- -- -- -- -- -- -- -- -- -- -- -- 1e -- 20: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 30: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 40: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 50: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 60: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 70: -- -- -- -- -- -- -- --</code> </pre><br>  1e = b√∫ssola Honeywell HMC5843 (externa) - frequentemente integrada aos m√≥dulos de GPS baseados em u-blox NEO-M8N. <br><br><h2>  Introdu√ß√£o ao software Ground Control Station (GCS) </h2><br>  Fa√ßa o download de qualquer planejador de miss√£o (http://firmware.ardupilot.org/Tools/MissionPlanner/MissionPlanner-latest.msi) para Windows ou QGroundControl (http://qgroundcontrol.com/) para Linux e Windows.  Ambos os programas se conectam aos fluxos de dados do MAVLink que chegam pela rede (por exemplo, via porta UDP 14550) ou pelas portas COM. <br><br><h2>  Opcional </h2><br>  Equipar o seu bbblue baseado em drone com um alto-falante Bluetooth pode ser divertido, desde que as transmiss√µes de RF por Bluetooth n√£o interfiram com outros sistemas.  H√° uma tonelada de informa√ß√µes sobre o BlueZ / PulseAudio / ALSA, mas, felizmente, tudo se resume a algo bastante simples. <br><br>  a) primeiro instale o software necess√°rio (usando o console ou a imagem da IoT): <br><br><pre> <code class="bash hljs"> sudo apt-get install -y bluetooth pulseaudio pulseaudio-module-bluetooth alsa-utils</code> </pre><br>  b) Ativar Bluetooth (se desativado): sudo systemctl enable bb-wl18xx-bluetooth.service <br><br>  c) Edite /etc/pulse/default.pa: <br><pre> <code class="bash hljs"> <span class="hljs-comment"><span class="hljs-comment">### Automatically suspend sinks/sources that become idle for too long # load-module module-suspend-on-idle</span></span></code> </pre><br>  d) Reinicializa√ß√£o: sudo reboot <br><br>  e) Ap√≥s carregar o BBBlue, ative a coluna Bluetooth no modo de conex√£o: <br><br><pre> <code class="bash hljs"> bluetoothctl scan on agent on default-agent pair &lt;Bluetooth speaker<span class="hljs-string"><span class="hljs-string">'s MAC address&gt; # &lt;--- eg AB:58:EC:5C:0C:03 connect &lt;Bluetooth speaker'</span></span>s MAC address&gt; <span class="hljs-comment"><span class="hljs-comment"># &lt;--- Sometimes unnecessary. trust &lt;Bluetooth speaker's MAC address&gt; scan off exit</span></span></code> </pre><br>  f) Finalmente: <br><br><pre> <code class="bash hljs"> pulseaudio --start <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"connect &lt;Bluetooth speaker's MAC address&gt;"</span></span> | bluetoothctl pactl list <span class="hljs-comment"><span class="hljs-comment"># &lt;--- Use this to check that your Bluetooth speaker has been picked up by PulseAudio. pacmd set-card-profile 0 a2dp_sink aplay /usr/share/sounds/alsa/Front_Center.wav</span></span></code> </pre><br>  Isso √© tudo!  A prop√≥sito, se voc√™ for usar um sintetizador de voz, recomendo o Festival. <br><br>  Se voc√™ quiser ajudar - por favor escreva-me na LAN ou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">VK</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">FB</a> . <br><br><img src="https://habrastorage.org/webt/mt/lh/91/mtlh91x8jag1t-ibt_np3uayuke.jpeg" alt="imagem">  <a href="">habrastorage.org/webt/mt/lh/91/mtlh91x8jag1t-ibt_np3uayuke.jpeg</a> <br><br>  Obrigado pela leitura, pergunte e nos critique completamente. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt429510/">https://habr.com/ru/post/pt429510/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt429500/index.html">"Hora de fazer neg√≥cios" finalmente voou</a></li>
<li><a href="../pt429502/index.html">Vale a pena desenvolver compet√™ncias cruzadas</a></li>
<li><a href="../pt429504/index.html">Como chamar m√©todos de √°udio vk</a></li>
<li><a href="../pt429506/index.html">N√≥s olhamos sob o cap√¥ do novo Gmail</a></li>
<li><a href="../pt429508/index.html">Resumo do relat√≥rio ‚ÄúComo se tornar um especialista legal em banco de dados‚Äù (HL2018, Data Egret, Ilya Kosmodemyansky)</a></li>
<li><a href="../pt429512/index.html">Eventos digitais em Moscou de 12 a 18 de novembro</a></li>
<li><a href="../pt429514/index.html">A Microsoft explicou como resolver o problema de seguran√ßa de dados em SSDs com criptografia de hardware com vazamento</a></li>
<li><a href="../pt429522/index.html">Projetando um rob√¥ de servi√ßo. Declara√ß√£o do problema, arquitetura da solu√ß√£o</a></li>
<li><a href="../pt429524/index.html">A API JSON ou JSON RPC correta</a></li>
<li><a href="../pt429528/index.html">O resumo de materiais frescos do mundo do front-end da √∫ltima semana n ¬∞ 338 (5 a 11 de novembro de 2018)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>