<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèº üòΩ üçò ¬øQu√© pasa si no hay un analizador est√°tico para su idioma favorito? üç† üëÉüèø üßõüèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bueno, si tu idioma favorito es ruso, ingl√©s, etc., entonces este est√° en otro centro . Y si el lenguaje de programaci√≥n o marcado, entonces, por supu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>¬øQu√© pasa si no hay un analizador est√°tico para su idioma favorito?</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/474920/"><p>  Bueno, si tu idioma favorito es ruso, ingl√©s, etc., entonces este est√° en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">otro centro</a> .  Y si el lenguaje de programaci√≥n o marcado, entonces, por supuesto, escriba usted mismo el analizador.  A primera vista, esto es muy dif√≠cil, pero, afortunadamente, hay herramientas multiling√ºes listas para usar que son relativamente f√°ciles de agregar soporte para un nuevo idioma.  Hoy mostrar√© c√≥mo agregar soporte de lenguaje <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Modelica</a> al <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">analizador PMD</a> con una cantidad de tiempo bastante peque√±a. </p><br><p> Por cierto, ¬øsabe qu√© puede degradar la calidad de la base de c√≥digo obtenida de una secuencia de solicitudes de extracci√≥n ideales?  El hecho de que los programadores de terceros copiaron fragmentos de c√≥digo de proyecto existente en sus parches en lugar de una abstracci√≥n competente.  Debe admitir que, hasta cierto punto, es a√∫n m√°s dif√≠cil detectar una banalidad que el c√≥digo de mala calidad: es de alta calidad e incluso se depura con cuidado, por lo que la verificaci√≥n local no es suficiente aqu√≠, debe tener en cuenta toda la base del c√≥digo, pero esto no es f√°cil para una persona ... Entonces: si agregar soporte completo para Modelica (sin crear reglas espec√≠ficas) al estado "puede ejecutar comprobaciones primitivas" me tom√≥ alrededor de una semana, ¬°luego el soporte para el detector de copiar y pegar a menudo se puede agregar en un d√≠a! </p><a name="habracut"></a><br><h2 id="kakaya-eschyo-modelica">  ¬øQu√© m√°s es Modelica? </h2><br><p> Modelica es, como su nombre indica, un lenguaje para escribir modelos de sistemas f√≠sicos.  De hecho, no solo f√≠sico: es posible describir procesos qu√≠micos, el comportamiento cuantitativo de las poblaciones animales, etc., que se describe mediante sistemas de ecuaciones diferenciales de la forma <code>der(X) = f(X)</code> , donde <code>X</code> es el vector de las inc√≥gnitas.  Piezas de c√≥digo imperativo tambi√©n son compatibles.  Las ecuaciones diferenciales parciales no se admiten expl√≠citamente, pero es posible dividir el √°rea de estudio en partes (como probablemente habr√≠amos hecho en un lenguaje de prop√≥sito general), y luego escribir las ecuaciones para cada elemento, reduciendo el problema al anterior.  El truco de Modelka es que la soluci√≥n a este <code>der(X) = f(X)</code> recae en el compilador: solo puede cambiar el solucionador <strong>en la configuraci√≥n</strong> , la ecuaci√≥n no tiene que ser lineal, etc. En resumen, hay algunas ventajas (escrib√≠ la f√≥rmula del libro de texto, y funcion√≥), y los contras (con m√°s abstracci√≥n, tenemos menos control).  Una introducci√≥n a Modelika es el tema de un art√≠culo separado (que ya ha aparecido varias veces en Habr√©), e incluso un ciclo completo, hoy me interesa como abierto y tener varias implementaciones, pero, por desgracia, sigue siendo un est√°ndar h√∫medo. </p><br><p>  Adem√°s, Modelika, por un lado, tiene una tipificaci√≥n est√°tica (que nos ayudar√° a escribir un an√°lisis significativo m√°s r√°pido), por otro lado, al crear instancias de un modelo, no se requiere que el compilador verifique completamente la biblioteca completa (por lo tanto, un analizador est√°tico es muy √∫til para atrapar ‚Äúdurmiendo‚Äù errores)  Finalmente, a diferencia de algunos C ++, para los cuales hay una nube de analizadores est√°ticos y compiladores con hermosos, <del>  y lo m√°s importante detallado, ver plantillas de C ++ </del>  diagn√≥stico de errores, compiladores Los modelos a√∫n generan peri√≥dicamente un error interno del compilador, lo que significa que hay espacio para ayudar al usuario incluso con un analizador bastante simple. </p><br><h2 id="a-chto-za-pmd">  ¬øQu√© es el PMD? </h2><br><p>  Voy a responder <del>  cancion </del>  en bicicleta  Una vez que quer√≠a hacer una peque√±a solicitud de extracci√≥n en el entorno de desarrollo para OpenModelica.  Al ver c√≥mo se procesa el guardado del modelo en otra parte del c√≥digo, not√© una peque√±a y no muy clara pieza interior de cuatro l√≠neas de c√≥digo que admit√≠a alg√∫n tipo de invariante.  No entiendo con qu√© tipo de editor interno interact√∫a, pero me doy cuenta de que desde el punto de vista de este c√≥digo, mi tarea es completamente id√©ntica, simplemente lo puse en una funci√≥n para poder reutilizarlo y no romperlo.  Menteiner dijo que es maravilloso, solo entonces reemplace este c√≥digo con una llamada a la funci√≥n en los veinte lugares restantes ... Decid√≠ no involucrarme a√∫n, e hice otra copia, notando que de alguna manera tendr√≠a que peinar todo de una vez sin mezclarlo con el parche actual  En Google, encontr√© el Detector de copiar y pegar (CPD), parte del analizador est√°tico PMD, que admite incluso m√°s idiomas que el analizador en s√≠.  Habi√©ndolo establecido en la base del c√≥digo OMEdit, esperaba ver esas dos docenas de piezas de cuatro l√≠neas.  Simplemente no los vi (cada uno de ellos simplemente no super√≥ el umbral en el n√∫mero de tokens), pero vi, por ejemplo, la repetici√≥n de casi cincuenta l√≠neas de c√≥digo C ++.  Como ya dije, es poco probable que el medidor simplemente copie una pieza gigantesca de otro archivo.  Pero podr√≠a f√°cilmente perderse esto en relaciones p√∫blicas, porque el c√≥digo, por definici√≥n, ¬°ya cumpl√≠a con todos los est√°ndares del proyecto!  Cuando compart√≠ la observaci√≥n con el medidor, √©l estuvo de acuerdo en que ser√≠a necesario limpiar como parte de una tarea separada. </p><br><p>  En consecuencia, el Detector de errores de programa (PMD) es un analizador est√°tico f√°cilmente extensible.  Tal vez no calcule el conjunto de valores que puede tomar una variable (aunque qui√©n sabe ...), pero para agregarle reglas, ¬°ni siquiera necesita conocer Java y cambiar su c√≥digo de alguna manera!  El hecho es que lo primero que √©l, y no es sorprendente, es construir archivos AST con c√≥digos fuente.  ¬øY c√≥mo se ve el √°rbol de an√°lisis fuente?  ¬°Al √°rbol de an√°lisis XML!  Por lo tanto, puede describir las reglas simplemente como solicitudes XPath, para las cuales coincide, luego emitimos una advertencia.  ¬°Incluso tienen un depurador gr√°fico para las reglas!  Las reglas m√°s complejas, por supuesto, se pueden escribir directamente en Java como visitantes para el AST. </p><br><p>  <em><strong>Consecuencia</strong></em> : PMD se puede usar no solo para las reglas duras y universales que los programadores de Java severos se han comprometido con el c√≥digo del analizador, sino tambi√©n para el estilo de codificaci√≥n local, ¬°incluso si inserta su propio juego de reglas local.xml en cada repositorio! </p><br><h2 id="uroven-1-nahodim-kopipast-avtomatizirovanno">  Nivel 1: busque copiar y pegar autom√°ticamente </h2><br><p>  En principio, agregar soporte para un nuevo lenguaje en CPD es a menudo muy simple.  No veo ning√∫n sentido en volver a contar la documentaci√≥n "c√≥mo hacerlo": es muy clara, estructurada y paso a paso.  Para volver a contar tal cosa, solo juega en un tel√©fono da√±ado.  Mejor describo lo que te espera <em>(TLDR: est√° bien)</em> : </p><br><ul><li>  El analizador (tanto PMD como CPD) se desarrolla en el github en el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">repositorio pmd / pmd</a> </li><li>  El depurador de reglas visuales se ha movido a un repositorio <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">pmd / pmd-designer</a> separado.  Tenga en cuenta que el sobrenombre de jar terminado se incrusta autom√°ticamente en la <em>distribuci√≥n binaria PMD</em> , que Gradle recopilar√° para usted en el repositorio anterior, no necesita clonar especialmente <code>pmd-designer</code> para esto. </li><li>  El proyecto tiene una <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">documentaci√≥n del desarrollador</a> .  El que le√≠ fue muy detallado.  Es cierto, un poco anticuado, pero esto es tratado por la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">segunda solicitud de extracci√≥n</a> :) </li></ul><br><p>  Te advertir√© que estoy desarrollando en Ubuntu.  En Windows, tambi√©n deber√≠a funcionar perfectamente, tanto en t√©rminos de calidad como en el sentido de una forma ligeramente diferente de iniciar herramientas. </p><br><p>  Entonces, para agregar un nuevo idioma al CPD, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">solo</a> necesita ... </p><br><ul><li>  <strong>ATENCI√ìN:</strong> si desea soporte completo para PMD antes del lanzamiento de PMD 7, entonces es mejor pasar directamente al nivel 2, ya que el soporte normal para el camino f√°cil a trav√©s de la gram√°tica Antlr terminada aparecer√°, seg√∫n los rumores, en la versi√≥n 7, pero por ahora solo pasar√° tiempo (aunque y un poquito ...) </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Bifurca el repositorio pmd / pmd</a> . </li><li>  Encuentre en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">antlr / grammars-v4</a> una gram√°tica preparada para su idioma; por supuesto, si el idioma es interno, debe escribirlo usted mismo, pero para Modelika, por ejemplo, se encontr√≥.  Aqu√≠, por supuesto, debe cumplir con los tr√°mites de las licencias: no soy un abogado, pero al menos necesito especificar la fuente desde donde copi√©. </li><li>  Despu√©s de eso, debe crear el <code>pmd-&lt;your language name&gt;</code> , agregarlo a Gradle y colocar el archivo de gram√°tica all√≠.  Adem√°s, despu√©s de leer dos p√°ginas de documentaci√≥n no estresante, vuelva a hacer el script de ensamblaje del m√≥dulo para Go, un par de clases para cargar el m√≥dulo a trav√©s de la reflexi√≥n, <em>bueno, hay una peque√±a cosa ...</em> </li><li>  Corrija la salida de referencia en una de las pruebas, porque ahora CPD admite un idioma m√°s.  ¬øC√≥mo encuentras esta prueba?  Muy f√°cil: <em>quiere romper la construcci√≥n</em> . </li><li>  BENEFICIOS!  Es realmente simple <em>siempre que haya una gram√°tica preparada</em> </li></ul><br><p>  Ahora, estando en la ra√≠z del repositorio pmd, puede escribir <code>./mvnw clean verify</code> , mientras que en <code>pmd-dist/target</code> obtendr√°, entre otras cosas, distribuci√≥n binaria en forma de archivo zip que necesita descomprimir y ejecutar usando <code>./bin/run.sh cpd --minimum-tokens 100 --files /path/to/source/dir --language &lt;your language name&gt;</code> del directorio desempaquetado.  En principio, puede hacer <code>../mvnw clean verify</code> desde su nuevo m√≥dulo, lo que acelerar√° dr√°sticamente el ensamblaje, pero luego deber√° colocar correctamente el apodo del jar ensamblado en la distribuci√≥n binaria desempaquetada (por ejemplo, ensamblado una vez despu√©s de registrar un nuevo m√≥dulo). </p><br><h2 id="uroven-2-nahodim-oshibki-i-narusheniya-style-guide">  Nivel 2: encontrar errores y violaciones de la gu√≠a de estilo </h2><br><p>  Como dije, se <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">promete</a> soporte completo para Antlr <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">en PMD 7</a> .  Si usted, como yo, no quiere esperar a la liberaci√≥n del mar, tendr√° que obtener una descripci√≥n de la gram√°tica del idioma en formato JJTree de alguna parte.  Tal vez pueda anular el soporte de un analizador arbitrario usted mismo: la documentaci√≥n dice que esto es posible, <em>pero no dicen c√≥mo exactamente</em> ... Acabo de tomar <code>modelica.g4</code> del mismo repositorio con gram√°ticas para Anltr como base, y volver a convertirlo manualmente en JJTree.  Naturalmente, si la gram√°tica result√≥ ser un procesamiento de la existente, nuevamente, indique la fuente, verifique el cumplimiento de las licencias y.  etc. </p><br><p>  Por cierto, para una persona que conoce bien todo tipo de generadores de analizadores, es poco probable que esto sea una sorpresa.  Antes de eso, realmente utilic√© solo mis propios escritores regulares y combinadores de analizador en Scala.  Por lo tanto, lo obvio, de hecho, me entristeci√≥ al principio: AST, por supuesto, obtendr√© de <code>modelica.g4</code> , pero no se ve muy claro y "utilizable": habr√° nubes de nodos adicionales en √©l, y si no miras los <strong>tokens</strong> , pero solo en nodos, no siempre est√° claro d√≥nde, por ejemplo, termina la rama y luego comienza. </p><br><p>  Nuevamente, no volver√© a contar la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">documentaci√≥n en JJTree</a> y un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">buen tutorial</a> ; esta vez, sin embargo, no porque el original brille con detalle y claridad, sino porque yo mismo no lo descubr√≠ por completo, pero la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">documentaci√≥n se retransmiti√≥</a> incorrectamente, pero con confianza, obviamente peor que no volver a contar.  Ser√° mejor que deje una peque√±a pista, descubierta en el camino: </p><br><ul><li>  En primer lugar, el <strong>c√≥digo de descripci√≥n del analizador JavaCC supone inserciones Java que se inscribir√°n en el analizador generado</strong> </li><li>  No se confunda con el hecho de que al construir un AST, una sintaxis como <code>[ Expression() ]</code> significa opcional, y en el contexto de describir tokens, elegir un car√°cter, como en una expresi√≥n regular.  Hasta donde entiendo la explicaci√≥n de los desarrolladores de PMD, estas son construcciones similares que tienen un significado tan diferente: legado, se√±or ... </li><li>  Para el nodo ra√≠z (en mi caso, <code>StoredDefinition</code> ), debe especificar su tipo en lugar de <code>void</code> (es decir, <code>ASTStoredDefiniton</code> ) </li><li>  Usando la sintaxis <code>#void</code> despu√©s del nombre del nodo, puede ocultarlo del √°rbol analizado (es decir, solo afectar√° cu√°l es la fuente correcta y cu√°l no, y c√≥mo se anidar√°n los otros nodos) </li><li>  Usando una construcci√≥n del formulario <code>void SimpleExpression() #SimpleExpression(&gt;1)</code> podemos decir que el nodo debe mostrarse en el AST resultante, si tiene m√°s de un descendiente.  Esto es muy conveniente cuando se describen expresiones con muchos operadores con diferentes prioridades: es decir, desde el punto de vista del analizador, la constante <code>1</code> solitaria ser√° algo as√≠ como <code>LogicExpression(AdditiveExpression(MultiplicativeExperssion(Constant(1))))</code> - <em>ingrese todos los n niveles de prioridades de operaci√≥n</em> , pero el c√≥digo del analizador solo obtendr√° <code>Constant(1)</code> </li><li>  El nodo tiene una <code>image</code> variable est√°ndar (ver <code>setImage</code> <code>getImage</code> , <code>setImage</code> ), que generalmente <code>setImage</code> la "esencia" de este nodo: por ejemplo, para un nodo correspondiente al nombre de una variable local, es l√≥gico copiar el token coincidente con el identificador en la <code>image</code> (por defecto, todos los tokens de los √°rboles se tirar√°n, por lo que vale la pena copiar el significado que contienen, en cualquier caso, si es algo variable y no solo palabras clave) </li><li>  <strong>LOOKAHEAD</strong> : bueno, esta es una canci√≥n separada, incluso un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">cap√≠tulo separado</a> en la documentaci√≥n est√° dedicada a ella <br><ul><li>  En t√©rminos generales, en JavaCC, si va a un nodo, no puede devolverlo e intentar analizarlo de manera diferente, pero puede mirar hacia adelante con anticipaci√≥n y decidir si desea ir o no. </li><li>  en el caso m√°s simple, al ver una advertencia de JavaCC, <del>  solo dices en el encabezado <code>LOOKAHEAD = n</code> </del>  y obtienes errores de an√°lisis misteriosos, porque en el caso general, al parecer, no puede resolver todos los problemas (bueno, excepto que al configurar unos pocos miles de millones de tokens, realmente obtienes una vista previa de todo, pero no el hecho de que funciona de esa manera ... .) </li><li>  delante del nombre del nodo incrustado, puede indicar expl√≠citamente sobre la base de cu√°ntos tokens aqu√≠ definitivamente puede tomar la decisi√≥n final </li><li>  si en el caso general no existe <strong>un</strong> n√∫mero <strong>fijo</strong> de tokens, puede decir "vaya aqu√≠, si anteriormente, a partir de este punto, logramos hacer coincidir dicho prefijo, y luego la descripci√≥n habitual del sub√°rbol" </li><li>  tenga cuidado: en el caso general, JavaCC no puede verificar la exactitud de las directivas <code>LOOKAHEAD</code> : conf√≠a en usted, as√≠ que al menos <code>LOOKAHEAD</code> la prueba matem√°tica de por qu√© es suficiente esa anticipaci√≥n ... </li></ul></li></ul><br><p>  Ahora que tiene una descripci√≥n de la gram√°tica del idioma en formato JJTree, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">estos simples 14 pasos</a> lo ayudar√°n a agregar compatibilidad con el idioma.  La mayor√≠a de ellos tienen la forma "crear una clase similar a la implementaci√≥n para Java o VM, pero adaptada".  Notar√© solo las caracter√≠sticas t√≠picas, algunas de ellas aparecer√°n en la documentaci√≥n principal si aceptan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">mi solicitud de extracci√≥n de documentaci√≥n</a> : </p><br><ul><li>  Al comentar la eliminaci√≥n de todos los archivos generados en el script de ensamblaje <code>alljavacc.xml</code> (que est√° en su nuevo m√≥dulo), puede transferirlos al √°rbol de origen desde las fuentes de <code>target/generated-sources</code> .  Pero mejor no.  Probablemente, solo se cambiar√° una peque√±a parte, por lo que es mejor eliminar solo unos pocos: vieron la necesidad de cambiar la implementaci√≥n predeterminada, se copiaron en el √°rbol de origen, se agregaron a la lista de archivos eliminados, se reconstruyeron, y ahora administran el archivo, <strong>espec√≠ficamente este archivo</strong> .  De lo contrario, ser√° dif√≠cil averiguar qu√© se ha cambiado exactamente, y el soporte dif√≠cilmente se puede llamar agradable. </li><li>  ahora que tiene una implementaci√≥n del modo PMD "principal", tambi√©n puede colgar f√°cilmente en su analizador JJTree un enlace para CPD, similar a Java u otra implementaci√≥n disponible </li><li>  Recuerde implementar un m√©todo que devuelva el nombre de host para las consultas XPath.  En la implementaci√≥n predeterminada, se obtiene una recursi√≥n infinita (el nombre del nodo es a trav√©s de <code>toString</code> y viceversa), o algo m√°s, en general, debido a esto, tampoco es posible mirar el √°rbol en PMD Designer, y sin esta depuraci√≥n la gram√°tica es realmente triste </li><li>  parte de los registros de componentes se realiza agregando archivos de texto de puntos de entrada de nombre de clase totalmente calificados a <code>META-INF/services</code> </li><li>  lo que puede describirse declarativamente en las reglas (por ejemplo, una descripci√≥n detallada de la verificaci√≥n y ejemplos de errores) no se describe en el c√≥digo, sino en la <code>category/&lt;language name&gt;/&lt;ruleset&gt;.xml</code> ; en cualquier caso, deber√° registrar sus reglas all√≠ </li><li>  ... pero al implementar las pruebas, aparentemente, se utiliza activamente alg√∫n mecanismo de autodescubrimiento, quiz√°s de cosecha propia, <br><ul><li>  si le dicen, "agregue una prueba trivial para cada versi√≥n del idioma" - mejor no discuta, dicen "No lo necesito, funciona as√≠" - tal vez este es el mecanismo de auto descubrimiento </li><li>  si ve una prueba para una regla espec√≠fica con un cuerpo de clase que contiene solo un comentario <code>// no additional unit tests</code> , entonces estas no son pruebas, solo se encuentran en los recursos en forma de descripci√≥n XML de los datos de entrada y las reacciones esperadas del analizador, de inmediato: algunas correctas y algunos ejemplos incorrectos </li></ul></li></ul><br><h2 id="malenkiy-no-vazhnyy-kvest-dopili-pmd-designer">  Una b√∫squeda peque√±a pero importante: termin√≥ el Dise√±ador PMD </h2><br><p>  Quiz√°s pueda depurar todo sin un visualizador.  Pero por que?  En primer lugar, terminarlo es muy simple.  En segundo lugar, ayudar√° mucho a sus usuarios que no est√©n familiarizados con Java: son f√°ciles y simples (si esto se aplica a XPath), bueno, o al menos sin recompilar, PMD podr√° describir patrones simples de lo que no les gusta (en el caso m√°s simple). - una gu√≠a de estilo como "el nombre de un paquete de modelo siempre comienza con una p min√∫scula"). </p><br><p>  A diferencia de otros errores que son visibles de inmediato, los problemas con PMD Designer son bastante insidiosos: parece que ya entendi√≥ que la inscripci√≥n de Java en el lado derecho del men√∫ no es un bot√≥n, sino una lista desplegable de la selecci√≥n de idioma O_o, en la que ya apareci√≥ Modelica, porque un nuevo m√≥dulo con registro de puntos de entrada ha aparecido en el classpath.  Pero aqu√≠ puede elegir su idioma, descargar un archivo de prueba y ver AST.  Y parece ser una victoria, pero de alguna manera es en blanco y negro, y el sub√°rbol resaltado podr√≠a resaltarse en el texto, aunque no, hay un resaltado, pero se actualiza de forma torcida, y, sin embargo, ¬øc√≥mo no adivinaron para resaltar las coincidencias encontradas con XPath ... Ya estimando la cantidad de trabajo, piensa en la pr√≥xima solicitud de extracci√≥n, pero luego decide accidentalmente cambiar el idioma a Java y descargar alg√∫n c√≥digo fuente del PMD en s√≠ ... ¬°Oh!  ¬°Est√° coloreado! .. ¬°Y el resaltado del sub√°rbol funciona!  Uh ... y resulta que normalmente resalta las coincidencias encontradas y escribe fragmentos de texto en el cuadro a la derecha de la solicitud ... Parece que cuando ocurre una excepci√≥n en el c√≥digo JavaFX mientras se procesa la interfaz, interrumpe la representaci√≥n, pero no se imprime en la consola ... </p><br><p>  En general, solo necesita agregar una clase ma-a-scarlet para resaltar la sintaxis basada en expresiones regulares.  En mi caso, era <code>net.sourceforge.pmd.util.fxdesigner.util.codearea.syntaxhighlighting.ModelicaSyntaxHighlighter</code> , que debe registrarse en la clase <code>AvailableSyntaxHighlighters</code> .  Tenga en cuenta que estos dos cambios ocurren en el repositorio <code>pmd-designer</code> , cuyo artefacto del ensamblaje debe colocarse en su distribuci√≥n binaria. </p><br><p>  Al final, se parece a esto (GIF tomado de README en el repositorio de PMD Designer): </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/289/e3e/92b/289e3e92b353b29c696ed466434307ed.gif" alt="PMD Designer en el trabajo"></p><br><h2 id="promezhutochnyy-itog">  Subtotal </h2><br><p>  Si ha completado todos estos niveles, ahora tiene: </p><br><ul><li>  detector de copiar y pegar </li><li>  motor de reglas </li><li>  visualizador para depurar AST y llevarlo a una forma conveniente para el an√°lisis (como ya hemos visto, ¬°no todas las gram√°ticas del mismo idioma son igualmente √∫tiles!) </li><li>  el mismo visualizador para depurar las reglas XPath que sus usuarios pueden escribir sin recompilar PMD y, en general, conocimiento de Java (XPath, por supuesto, tampoco es B√ÅSICO, pero es al menos un lenguaje de consulta est√°ndar y no local) </li></ul><br><p>  Espero que tambi√©n comprenda el hecho de que la gram√°tica ahora es una API estable para su implementaci√≥n de soporte de idiomas: no la cambie (o m√°s bien la funci√≥n de convertir la fuente a AST descrita por √©l) a menos que sea absolutamente necesario, y si ha cambiado, notif√≠quelo como un cambio importante, y luego los usuarios se molestar√°n: lo m√°s probable es que no todos escriban pruebas para sus reglas, pero es muy triste cuando las reglas verificaron el c√≥digo y luego se detuvieron sin previo aviso, casi como una copia de seguridad, que de repente se rompi√≥, y hace un a√±o ... </p><br><p>  La historia no termina ah√≠: al menos algunas reglas √∫tiles tienen que ser escritas. </p><br><p>  Pero eso no es todo: PMD admite de forma nativa √°mbitos y declaraciones.  Cada nodo AST tiene un alcance asociado: el cuerpo de la clase, funci√≥n, bucle ... ¬°Todo el archivo, en el peor de los casos!  Y en cada √°mbito hay una lista de definiciones (declaraciones) que contiene directamente.  Como en otros casos, se propone implementar por analog√≠a con otros idiomas, por ejemplo, Modelika (pero al momento de escribir, la l√≥gica en mi solicitud de extracci√≥n es, francamente, sin formato).   scopes  declarations    visitor,  -  <code>ScopeAndDeclarationFinder</code> ,           ‚Äî  ,    ,  ,  - ,  read-only    AST.        ,    . </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ModelicaHandler</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbstractLanguageVersionHandler</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// ... @Override public VisitorStarter getSymbolFacade() { return new VisitorStarter() { @Override public void start(Node rootNode) { new SymbolFacade().initializeWith((ASTStoredDefinition) rootNode); } }; } }</span></span></code> </pre> <br><h2 id="vyvod">  Conclusi√≥n </h2><br><p>   PMD     .  ,     ¬´¬ª  Clang Static Analyzer   ,           .      ,      CPD (   ),         . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/474920/">https://habr.com/ru/post/474920/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../474906/index.html">Xamarin.Forms - Mapeo decorativo de QRCode con SkiaSharp</a></li>
<li><a href="../474910/index.html">Que jugar con los ni√±os antes de la escuela</a></li>
<li><a href="../474912/index.html">Mensajes y alertas en Android a trav√©s de JSON</a></li>
<li><a href="../474916/index.html">Aplicar el entorno Nix-Shell en Visual Studio Code</a></li>
<li><a href="../474918/index.html">Mejora del dise√±o conjunto de componentes electromec√°nicos.</a></li>
<li><a href="../474922/index.html">C√≥mo elegir un VPS</a></li>
<li><a href="../474924/index.html">¬øC√≥mo convertirse en un buen gerente? 4 formas de llenar el vac√≠o en las habilidades de gesti√≥n</a></li>
<li><a href="../474928/index.html">Aprendiendo a seguir el navegador Vivaldi</a></li>
<li><a href="../474930/index.html">Meetup Burning Leads: Obt√©n Streaming</a></li>
<li><a href="../474936/index.html">15 excelentes herramientas para crear, almacenar y administrar enlaces (bourget)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>