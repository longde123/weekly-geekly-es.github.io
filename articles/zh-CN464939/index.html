<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸš£ğŸ½ ğŸ“ ğŸš• æµ‹è¯•@ NonNull / @ Nullableæ‰¹æ³¨ ğŸ’œ ğŸŒ´ ğŸ…ğŸ»</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="è€Œä¸æ˜¯â€œä¸“ç”¨äº...â€ 
 ä¸‹æ–‡æè¿°çš„ä»»åŠ¡ä¸æ˜¯åˆ›æ–°æ€§çš„ï¼Œä¹Ÿä¸æ˜¯æœ‰ç”¨çš„ï¼Œæˆ‘å·¥ä½œçš„å…¬å¸ä¸ä¼šå› æ­¤è·åˆ©ï¼Œä½†æˆ‘ä¼šå¾—åˆ°å¥½å¤„ã€‚ 

 ä½†æ˜¯è¿™é¡¹ä»»åŠ¡å·²ç»å®Œæˆï¼Œå› æ­¤å¿…é¡»è§£å†³ã€‚ 

 å‰è¨€ 
 åœ¨æœ¬æ–‡ä¸­ï¼Œæ‚¨ç»å¸¸ä¼šé‡åˆ°â€œé¾™ç›®å²›ï¼ˆLombokï¼‰â€ä¸€è¯ï¼Œæˆ‘è¯·é‚£äº›è®¨åŒçš„äººä¸è¦æ€¥äºä¸‹ç»“è®ºã€‚ 
 æˆ‘ä¸ä¼šå› ä¸ºé¾™ç›®å²›ï¼ˆLombokï¼‰æˆ–...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>æµ‹è¯•@ NonNull / @ Nullableæ‰¹æ³¨</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/464939/"><h3> è€Œä¸æ˜¯â€œä¸“ç”¨äº...â€ </h3><br> ä¸‹æ–‡æè¿°çš„ä»»åŠ¡ä¸æ˜¯åˆ›æ–°æ€§çš„ï¼Œä¹Ÿä¸æ˜¯æœ‰ç”¨çš„ï¼Œæˆ‘å·¥ä½œçš„å…¬å¸ä¸ä¼šå› æ­¤è·åˆ©ï¼Œä½†æˆ‘ä¼šå¾—åˆ°å¥½å¤„ã€‚ <br><br> ä½†æ˜¯è¿™é¡¹ä»»åŠ¡å·²ç»å®Œæˆï¼Œå› æ­¤å¿…é¡»è§£å†³ã€‚ <br><br><h3> å‰è¨€ </h3><br> åœ¨æœ¬æ–‡ä¸­ï¼Œæ‚¨ç»å¸¸ä¼šé‡åˆ°â€œé¾™ç›®å²›ï¼ˆLombokï¼‰â€ä¸€è¯ï¼Œæˆ‘è¯·é‚£äº›è®¨åŒçš„äººä¸è¦æ€¥äºä¸‹ç»“è®ºã€‚ <br> æˆ‘ä¸ä¼šå› ä¸ºé¾™ç›®å²›ï¼ˆLombokï¼‰æˆ–å®ƒçš„ç¼ºå¸­è€Œâ€œæ²‰è¿·â€ï¼Œæˆ‘åƒGeralt Sapkovskyä¸€æ ·ä¿æŒä¸­ç«‹ï¼Œå¹¶ä¸”æˆ‘å¯ä»¥åœ¨æœ‰æˆ–æ²¡æœ‰é¾™ç›®å²›çš„æƒ…å†µä¸‹å†·é™åœ°é˜…è¯»ä»£ç ï¼Œè€Œä¸ä¼šåœ¨æœ¬ä¸–çºªé¢¤æŠ–ã€‚ <br><br> ä½†æ˜¯åœ¨å½“å‰é¡¹ç›®ä¸­ï¼Œå­˜åœ¨æåˆ°çš„åº“ï¼Œå¹¶ä¸”æœ‰äº›ä¸œè¥¿å‘Šè¯‰æˆ‘ï¼Œæˆ‘ä»¬çš„é¡¹ç›®ä¸æ˜¯å”¯ä¸€çš„ä¸€ä¸ªã€‚ <br> æ‰€ä»¥åœ¨è¿™é‡Œã€‚ <br><a name="habracut"></a><br>  Javaä¸Šä¸€æ¬¡å‡ºç°è‚¯å®šæ˜¯æœannotashkiçš„è¶‹åŠ¿ã€‚ å¿«é€Ÿå¤±è´¥æ¦‚å¿µçš„è£è€€åœ¨äºï¼Œæ–¹æ³•çš„å‚æ•°é€šå¸¸ä½¿ç”¨@NonNullæ‰¹æ³¨è¿›è¡Œæ‰¹æ³¨ï¼ˆè¿™æ ·ï¼Œå¦‚æœå‡ºç°é—®é¢˜ï¼Œåˆ™å¯ä»¥è§£å†³ï¼‰ã€‚ <br><br> å¯¹æ­¤æœ‰å¾ˆå¤šå¯¼å…¥é€‰é¡¹ï¼ˆæˆ–æ„è¯†å½¢æ€ä¸Šçš„æ³¨é‡Šç±»ä¼¼ï¼‰ï¼Œä½†æ˜¯ï¼Œç”±äºå·²ç»å¾ˆæ¸…æ¥šï¼Œæˆ‘ä»¬å°†é‡ç‚¹å…³æ³¨ç‰ˆæœ¬ <br><br><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> lombok.NonNull;</code> </pre> <cut></cut><br> å¦‚æœæ‚¨ä½¿ç”¨æ­¤ï¼ˆæˆ–ç±»ä¼¼çš„ï¼‰æ³¨é‡Šï¼Œé‚£ä¹ˆæ‚¨éœ€è¦ä¸ä¸€äº›åˆåŒè¿›è¡Œæµ‹è¯•æ£€æŸ¥ï¼Œä»»ä½•é™æ€ä»£ç åˆ†æå™¨éƒ½ä¼šå‘Šè¯‰æ‚¨ï¼ˆSonarä¼šå‘Šè¯‰æ‚¨ï¼‰ã€‚ <br><br> ä½¿ç”¨å•å…ƒæµ‹è¯•æ¥æµ‹è¯•æ­¤æ‰¹æ³¨éå¸¸ç®€å•ï¼Œé—®é¢˜åœ¨äºè¿™æ ·çš„æµ‹è¯•å°†ä»¥æ˜¥å­£å…”å­çš„é€Ÿåº¦åœ¨æ‚¨çš„é¡¹ç›®ä¸­æˆå€å¢åŠ ï¼Œå¹¶ä¸”æ‚¨çŸ¥é“å…”å­è¿åäº†DRYåŸç†ã€‚ <br><br> åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†ç¼–å†™ä¸€ä¸ªå°çš„æµ‹è¯•æ¡†æ¶æ¥æµ‹è¯•@NonNullæ‰¹æ³¨çš„çº¦å®šï¼ˆè¿™æ ·ï¼ŒSonarä¸ä¼šåœ¨æ‚¨çš„çœ¼ç›ä¸­å‘å‡ºè®¨åŒçš„çº¢å…‰ï¼‰ã€‚ <br><br> é™„è¨€ï¼šè¿™é¦–æ­Œçš„åå­—æ˜¯å—PowerWolfä¹é˜Ÿçš„æ­Œå¯å‘çš„ï¼Œå½“æˆ‘å†™ä¸‹åå­—æ—¶ï¼Œè¿™é¦–æ­Œï¼ˆç”±gollyæ¼”å¥ï¼‰ï¼ˆåå­—å¬èµ·æ¥å¾ˆè‚¯å®šï¼‰ <br><br><h3> ä¸»ä½“ </h3><br> æœ€åˆï¼Œæˆ‘ä»¬æµ‹è¯•äº†æ³¨é‡Šï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">methodNameWithNullArgumentThrowException</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { instance.getAnyType(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); fail(<span class="hljs-string"><span class="hljs-string">"Exception not thrown"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">final</span></span> NullPointerException e) { assertNotNull(e); } }</code> </pre> <br> ä»–ä»¬è°ƒç”¨äº†è¯¥æ–¹æ³•å¹¶ä¼ é€’äº†nullä½œä¸ºå¸¦æœ‰@NonNullæ‰¹æ³¨çš„å‚æ•°ã€‚ <br> ä»–ä»¬è·å¾—äº†NPEå¹¶æ„Ÿåˆ°æ»¡æ„ï¼ˆSonarä¹Ÿå¾ˆé«˜å…´ï¼‰ã€‚ <br><br> ç„¶åä»–ä»¬å¼€å§‹åšåŒæ ·çš„äº‹æƒ…ï¼Œä½†æ˜¯æœ‰äº†ä¸€ä¸ªæ›´æ—¶å°šçš„assertThrowï¼Œå®ƒå¯ä»¥é€šè¿‡Supplierï¼ˆæˆ‘ä»¬å–œæ¬¢lambdaï¼‰å·¥ä½œï¼š <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@TestUnitRepeatOnce</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">methodNameWithNullArgumentThrowException</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ assertThrows(NullPointerException.class, () -&gt; instance.getAnyType(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>)); }</code> </pre> <br> æ—¶å°šã€‚ æ—¶å°šã€‚ é’å¹´æ—¶æœŸ <br><br> ä¼¼ä¹å¯ä»¥å®Œæˆï¼Œæ³¨é‡Šå·²ç»è¿‡æµ‹è¯•ï¼Œè¿˜æœ‰ä»€ä¹ˆå‘¢ï¼Ÿ <br><br> æœ‰ä¸€å¤©ï¼Œå½“æˆ‘ä¸ºæŸä¸ªæ–¹æ³•ç¼–å†™æµ‹è¯•ï¼Œè¯¥æµ‹è¯•æ–¹æ³•çš„é—®é¢˜ï¼ˆä¸æ˜¯é—®é¢˜ï¼Œä½†ä»ç„¶æ˜¯â€œå¼¹å‡ºâ€ï¼‰æˆåŠŸå®Œæˆåï¼Œæˆ‘æ³¨æ„åˆ°è¯¥å‚æ•°ä¸Šæ²¡æœ‰@NonNullæ‰¹æ³¨ã€‚ <br><br> è¿™æ˜¯å¯ä»¥ç†è§£çš„ï¼šæ‚¨å¯ä»¥é€šè¿‡whenï¼ˆï¼‰/ thenï¼ˆï¼‰è°ƒç”¨testæ–¹æ³•ï¼Œè€Œä¸æè¿°Moqueç±»çš„è¡Œä¸ºã€‚ æ‰§è¡Œçº¿ç¨‹å®‰å…¨åœ°åœ¨æœªé”å®šï¼ˆæˆ–é”å®šï¼Œä½†æ²¡æœ‰whenï¼ˆï¼‰/ thenï¼ˆï¼‰ï¼‰å¯¹è±¡ä¸Šçš„æŸä¸ªåœ°æ–¹æ•è·NPEçš„æƒ…å†µä¸‹è¿›å…¥è¯¥æ–¹æ³•ï¼Œä½†æ˜¯å¦‚æ‚¨æ‰€è­¦å‘Šçš„é‚£æ ·ï¼Œå´©æºƒæ—¶ä½¿ç”¨äº†NPEï¼Œè¿™æ„å‘³ç€æµ‹è¯•æ˜¯ç»¿è‰²çš„ <br><br> äº‹å®è¯æ˜ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ­£åœ¨æµ‹è¯•ï¼Œè€Œä¸æ˜¯æ³¨é‡Šï¼Œä½†æ˜¯ä¸æ¸…æ¥šæ˜¯ä»€ä¹ˆã€‚ åœ¨æµ‹è¯•æ­£å¸¸è¿›è¡Œçš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ç”šè‡³ä¸å¿…æ›´æ·±å…¥åœ°ç ”ç©¶è¯¥æ–¹æ³•ï¼ˆé™ä½é˜ˆå€¼ï¼‰ã€‚ <cut></cut><br>  Lombokçš„@NonNullæ‰¹æ³¨å…·æœ‰ä¸€ä¸ªåŠŸèƒ½ï¼šå¦‚æœæˆ‘ä»¬ä»NPEå˜ä¸ºæ‰¹æ³¨ï¼Œåˆ™å°†å‚æ•°åç§°å†™å…¥é”™è¯¯ã€‚ <br><br> æˆ‘ä»¬å°†å‚ä¸å…¶ä¸­ï¼Œä»NPEè„±ç¦»åï¼Œæˆ‘ä»¬è¿˜å°†å¦å¤–æ£€æŸ¥stacktraceçš„æ–‡æœ¬ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š <br><br><pre> <code class="java hljs">exception.getCause().getMessage().equals(parameter.getName())</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">å¦‚æœçªç„¶...</b> <div class="spoiler_text"> å¦‚æœLombokçªç„¶åˆ·æ–°å¹¶åœæ­¢ç¼–å†™åœ¨å †æ ˆè·Ÿè¸ªä¸­æ¥æ”¶åˆ°nullçš„å‚æ•°çš„åç§°ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°†å›é¡¾Andrei Panginåœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">JVM TI</a>ä¸Šçš„æ¼”è®²ï¼Œå¹¶ä¸º<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">JVM</a>ç¼–å†™ä¸€ä¸ªæ’ä»¶ï¼Œåœ¨å…¶ä¸­æˆ‘ä»¬å°†ä¼ é€’å‚æ•°åç§°ã€‚ <br></div></div><br> ä¸€åˆ‡ä¼¼ä¹ä¸€æ— æ˜¯å¤„ï¼Œç°åœ¨æˆ‘ä»¬çœŸçš„æ£€æŸ¥äº†éœ€è¦ä»€ä¹ˆï¼Œä½†æ˜¯â€œå…”å­â€é—®é¢˜æ²¡æœ‰è§£å†³ã€‚ <br><br> æˆ‘æƒ³è¦ä¸€ä¸ªå¯ä»¥è¯´çš„å·¥å…·ï¼Œä¾‹å¦‚ï¼š <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@TestUnitRepeatOnce</span></span> <span class="hljs-meta"><span class="hljs-meta">@SneakyThrows</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">nonNullAnnotationTest</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ assertNonNullAnnotation(YourPerfectClass.class); }</code> </pre> <br> ä»–æœ¬äººå°†å»æ‰«ææŒ‡å®šç±»çš„æ‰€æœ‰å…¬å…±æ–¹æ³•ï¼Œå¹¶é€šè¿‡æµ‹è¯•æ£€æŸ¥å…¶æ‰€æœ‰@NonNullå‚æ•°ã€‚ <br><br> æ‚¨ä¼šè¯´ï¼Œè¿›è¡Œåæ€ï¼Œå¹¶æ£€æŸ¥æ–¹æ³•@NonNullæ˜¯å¦æ‰“å¼€ä»¥åŠå…¶ä¸­æ˜¯å¦æœ‰é¡¹ç›®ç¬¦å·ä¸ºnullã€‚ <br><br> ä¸€åˆ‡éƒ½å°†ä¸€äº‹æ— æˆï¼Œä½†RetentionPolicyå¹¶éå¦‚æ­¤ã€‚ <br><br> æ‰€æœ‰æ³¨é‡Šéƒ½å…·æœ‰RetentionPolicyå‚æ•°ï¼Œè¯¥å‚æ•°å¯ä»¥ä¸º3ç§ç±»å‹ï¼šSOURCEï¼ŒCLASSå’ŒRUNTIMEï¼Œå› æ­¤Lomboké»˜è®¤å…·æœ‰RetentionPolicy.SOURCEï¼Œè¿™æ„å‘³ç€è¯¥æ³¨é‡Šåœ¨Runtimeä¸­ä¸å¯è§ï¼Œå¹¶ä¸”æ‚¨ä¸ä¼šé€šè¿‡åå°„æ‰¾åˆ°å®ƒã€‚ <br><br> åœ¨æˆ‘ä»¬çš„é¡¹ç›®ä¸­ï¼Œå¯¹å…¬å…±æ–¹æ³•çš„æ‰€æœ‰å‚æ•°éƒ½è¿›è¡Œäº†æ³¨é‡Šï¼ˆä¸è®¡ç®—åŸºå…ƒï¼‰ï¼Œå¦‚æœå¯ä»¥ç†è§£å‚æ•°ä¸èƒ½ä¸ºnullï¼Œåˆ™å‡å®šå‚æ•°ç›¸åï¼Œåˆ™è¯¥å‚æ•°ç”±spring @Nullableè¿›è¡Œæ³¨é‡Šã€‚ æ‚¨å¯ä»¥å‚ä¸å…¶ä¸­ï¼Œæˆ‘ä»¬å°†å¯»æ‰¾æ‰€æœ‰å…¬å…±æ–¹æ³•ï¼Œä»¥åŠå…¶ä¸­æ‰€æœ‰æœªæ ‡è®°ä¸º@Nullableä¸”ä¸æ˜¯åŸè¯­çš„å‚æ•°ã€‚ <br> æˆ‘ä»¬çš„æ„æ€æ˜¯ï¼Œå¯¹äºæ‰€æœ‰å…¶ä»–æƒ…å†µï¼Œæ³¨é‡Š@NonNullåº”è¯¥åœ¨å‚æ•°ä¸Šã€‚ <br><br> ä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œæˆ‘ä»¬å°†å°½å¯èƒ½åœ°é€šè¿‡ç§æœ‰æ–¹æ³•æ¥ä¼ æ’­é€»è¾‘ï¼Œé¦–å…ˆï¼Œæˆ‘ä»¬å°†è·å¾—æ‰€æœ‰å…¬å…±æ–¹æ³•ï¼š <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> List&lt;Method&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getPublicMethods</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Class clazz)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Arrays.stream(clazz.getDeclaredMethods()) .filter(METHOD_FILTER) .collect(toList()); }</code> </pre> <br> å…¶ä¸­METHOD_FILTERæ˜¯ä¸€ä¸ªå¸¸è§„è°“è¯ï¼Œå…¶ä¸­æˆ‘ä»¬è¯´ï¼š <br><br><ul><li> è¯¥æ–¹æ³•å¿…é¡»æ˜¯å…¬å¼€çš„ </li><li> å®ƒä¸åº”è¯¥æ˜¯å¥æ³•çš„ï¼ˆå½“æ‚¨ä½¿ç”¨å¸¦æœ‰åŸå§‹å‚æ•°çš„æ–¹æ³•æ—¶ï¼Œå°±ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µï¼‰ </li><li> å®ƒä¸åº”è¯¥æ˜¯æŠ½è±¡çš„ï¼ˆå…³äºå•ç‹¬çš„æŠ½è±¡ç±»å’Œä¸‹é¢çš„æŠ½è±¡ç±»ï¼‰ </li><li> æ–¹æ³•åä¸åº”è¯¥ç­‰äºï¼ˆå¦‚æœæŸç§é‚ªæ¶çš„äººå†³å®šåœ¨æˆ‘ä»¬çš„POJOæ¡†æ¶çš„è¾“å…¥ä¸­å†³å®šä½¿ç”¨è¦†ç›–çš„equalsï¼ˆï¼‰å¡«å……ç±»ï¼‰ </li></ul><br> åœ¨è·å¾—æ‰€éœ€çš„æ‰€æœ‰æ–¹æ³•ä¹‹åï¼Œæˆ‘ä»¬å¼€å§‹å¾ªç¯åœ°å¯¹å®ƒä»¬è¿›è¡Œæ’åºï¼Œ <br> å¦‚æœè¯¥æ–¹æ³•æ ¹æœ¬æ²¡æœ‰ä»»ä½•å‚æ•°ï¼Œåˆ™è¿™ä¸æ˜¯æˆ‘ä»¬çš„å€™é€‰æ–¹æ³•ï¼š <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (method.getParameterCount() == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; }</code> </pre> <br> å¦‚æœæœ‰å‚æ•°ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£å®ƒä»¬æ˜¯å¦å¸¦æœ‰@NonNullæ³¨é‡Šï¼ˆæ›´ç¡®åˆ‡åœ°è¯´ï¼Œæ ¹æ® <br><br><div class="spoiler">  <b class="spoiler_title">é€»è¾‘å­¦</b> <div class="spoiler_text"><ul><li> å…¬å…±æ–¹æ³• </li><li> ä¸æ˜¯@Nullable </li><li> ä¸æ˜¯åŸå§‹çš„ </li></ul><br></div></div><br> ä¸ºæ­¤ï¼Œåˆ¶ä½œä¸€ä¸ªåœ°å›¾ï¼Œå¹¶æ ¹æ®æ–¹æ³•ä¸­çš„é¡ºåºå°†å‚æ•°æ”¾å…¥å…¶ä¸­ï¼Œå¹¶åœ¨å®ƒä»¬å¯¹é¢æ”¾ç½®ä¸€ä¸ªæ ‡å¿—ï¼Œä»¥æŒ‡ç¤º@NonNullæ³¨é‡Šæ˜¯å¦åº”ä½äºä¸Šæ–¹ï¼š <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> nonNullAnnotationCount = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> index = <span class="hljs-number"><span class="hljs-number">0</span></span>; val parameterCurrentMethodArray = method.getParameters(); val notNullAnnotationParameterMap = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashMap&lt;Integer, Boolean&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (val parameter : parameterCurrentMethodArray) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isNull(parameter.getAnnotation(Nullable.class)) &amp;&amp; isFalse(parameter.getType().isPrimitive())) { notNullAnnotationParameterMap.put(index++, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); nonNullAnnotationCount++; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { notNullAnnotationParameterMap.put(index++, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (nonNullAnnotationCount == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; }</code> </pre> <br> è¯¥æ˜ å°„å¯¹æˆ‘ä»¬å¾ˆæœ‰ç”¨ï¼Œç„¶åè°ƒç”¨è¯¥æ–¹æ³•å¹¶å°†å…¶nullä¾æ¬¡ä¼ é€’ç»™å¸¦æœ‰æ‰¹æ³¨@NonNullçš„æ‰€æœ‰å‚æ•°ï¼Œè€Œä¸ä»…ä»…æ˜¯ç¬¬ä¸€ä¸ªã€‚ <br><br>  nonNullAnnotationCountå‚æ•°è®¡ç®—è¯¥æ–¹æ³•ä¸­åº”æ³¨é‡Šçš„å‚æ•°æ•°é‡@NonNullï¼Œå®ƒå°†ç¡®å®šæ¯ä¸ªæ–¹æ³•çš„è°ƒç”¨é›†æˆäº¤äº’çš„æ¬¡æ•°ã€‚ <br><br> é¡ºä¾¿è¯´ä¸€å¥ï¼Œå¦‚æœæ²¡æœ‰@NonNullæ³¨é‡Šï¼ˆæœ‰å‚æ•°ï¼Œä½†æ˜¯éƒ½æ˜¯åŸå§‹çš„æˆ–@Nullableï¼‰ï¼Œé‚£ä¹ˆå°±æ²¡æœ‰ä»€ä¹ˆå¯è°ˆçš„äº†ï¼š <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (nonNullAnnotationCount == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; }</code> </pre> <br> æˆ‘ä»¬æ‰‹ä¸Šæœ‰ä¸€ä¸ªå‚æ•°å›¾ã€‚ æˆ‘ä»¬çŸ¥é“è°ƒç”¨ä¸€ä¸ªæ–¹æ³•å¤šå°‘æ¬¡ï¼Œå¹¶ä¸”åœ¨å“ªä¸ªä½ç½®å¯ä»¥ä¸ºç©ºï¼Œè¿™æ˜¯ä¸€ä»¶å¾ˆå°çš„äº‹æƒ…ï¼ˆæ­£å¦‚æˆ‘å¤©çœŸçš„ä»¥ä¸ºæ²¡æœ‰ç†è§£ï¼‰ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºè¯¥ç±»çš„å®ä¾‹å¹¶åœ¨å…¶ä¸Šè°ƒç”¨æ–¹æ³•ã€‚ <br><br> å½“æ‚¨æ„è¯†åˆ°å®ä¾‹çš„ä¸åŒä¹‹å¤„æ—¶ï¼Œé—®é¢˜å°±å¼€å§‹äº†ï¼šå®ƒå¯ä»¥æ˜¯ä¸€ä¸ªç§æœ‰ç±»ï¼Œå®ƒå¯ä»¥æ˜¯ä¸€ä¸ªå¸¦æœ‰ä¸€ä¸ªé»˜è®¤æ„é€ å‡½æ•°çš„ç±»ï¼Œä¸€ä¸ªå¸¦æœ‰å‚æ•°çš„æ„é€ å‡½æ•°ï¼Œå¸¦æœ‰è¿™æ ·çš„æ„é€ å‡½æ•°ï¼Œä¸€ä¸ªæŠ½è±¡ç±»ï¼Œä¸€ä¸ªæ¥å£ï¼ˆå¸¦æœ‰å…¶é»˜è®¤æ–¹æ³•ï¼Œå®ƒä»¬ä¹Ÿæ˜¯å…¬å…±çš„ï¼‰å¹¶ä¸”è¿˜éœ€è¦è¿›è¡Œæµ‹è¯•ï¼‰ã€‚ <br><br> å½“æˆ‘ä»¬é€šè¿‡é’©å­æˆ–å¼¯é’©æ„å»ºå®ä¾‹æ—¶ï¼Œæˆ‘ä»¬éœ€è¦å°†å‚æ•°ä¼ é€’ç»™invokeæ–¹æ³•ï¼Œå¹¶ä¸”åœ¨è¿™é‡Œä¹Ÿæ˜¯å¦‚æ­¤ï¼šå¦‚ä½•åˆ›å»ºæœ€ç»ˆç±»çš„å®ä¾‹ï¼Ÿ å’Œæšä¸¾ï¼Ÿ å’ŒåŸå§‹çš„ï¼Ÿ ä»¥åŠä¸€ç»„åŸºæœ¬å…ƒç´ ï¼ˆå®ƒä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œä¹Ÿå¯ä»¥æ·»åŠ æ³¨é‡Šï¼‰ã€‚ <br><br> å¥½å§ï¼Œè®©æˆ‘ä»¬æŒ‰é¡ºåºè¿›è¡Œã€‚ <br><br> ç¬¬ä¸€ç§æƒ…å†µæ˜¯å…·æœ‰ä¸€ä¸ªç§æœ‰æ„é€ å‡½æ•°çš„ç±»ï¼š <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ONLY_ONE_PRIVATE_CONSTRUCTOR_FILTER.test(clazz)) { notNullAnnotationParameterMap.put(currentNullableIndex, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); method.invoke(clazz, invokeMethodParameterArray); makeErrorMessage(method); }</code> </pre> <br> ç„¶åæˆ‘ä»¬åªéœ€è°ƒç”¨æˆ‘ä»¬çš„invokeæ–¹æ³•ï¼Œå°±å°†æ¥è‡ªå¤–éƒ¨çš„clazzä¼ é€’ç»™æµ‹è¯•ï¼Œå¹¶ä¼ é€’ä¸€ä¸ªå‚æ•°æ•°ç»„ï¼Œå…¶ä¸­å·²ä½¿ç”¨æ³¨é‡Š@NonNullçš„æ ‡å¿—å°†nullå¡«å……åˆ°ç¬¬ä¸€ä¸ªä½ç½®ï¼ˆè¯·è®°ä½ï¼Œåœ¨ä¸Šé¢æˆ‘ä»¬åˆ›å»ºäº†åœ°å›¾@ NonNullsï¼‰ï¼Œæˆ‘ä»¬å¼€å§‹å¾ªç¯è¿è¡Œå¹¶åˆ›å»ºå‚æ•°æ•°ç»„ï¼Œäº¤æ›¿æ›´æ”¹nullå‚æ•°çš„ä½ç½®ï¼Œå¹¶åœ¨è°ƒç”¨è¯¥æ–¹æ³•ä¹‹å‰å°†æ ‡å¿—æ¸…é›¶ï¼Œä»¥ä¾¿åœ¨ä¸‹ä¸€æ¬¡é›†æˆä¸­å¦ä¸€ä¸ªå‚æ•°å˜ä¸ºnullã€‚ <br><br> åœ¨ä»£ç ä¸­ï¼Œå®ƒçœ‹èµ·æ¥åƒè¿™æ ·ï¼š <br><br><pre> <code class="java hljs">val invokeMethodParameterArray = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Object[parameterCurrentMethodArray.length]; <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> hasNullParameter = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> currentNullableIndex = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; invokeMethodParameterArray.length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (notNullAnnotationParameterMap.get(i) &amp;&amp; isFalse(hasNullParameter)) { currentNullableIndex = i; invokeMethodParameterArray[i] = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; hasNullParameter = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { mappingParameter(parameterCurrentMethodArray[i], invokeMethodParameterArray, i); } }</code> </pre> <br> å®ä¾‹åŒ–çš„ç¬¬ä¸€ä¸ªé€‰é¡¹å·²è¢«æŒ‘é€‰å‡ºæ¥ã€‚ <br><br> åœ¨å…¶ä»–æ¥å£ä¸Šï¼Œä¸å¯èƒ½é‡‡ç”¨å’Œåˆ›å»ºæ¥å£çš„å®ä¾‹ï¼ˆå®ƒç”šè‡³æ²¡æœ‰æ„é€ å‡½æ•°ï¼‰ã€‚ <br><br> å› æ­¤ï¼Œä½¿ç”¨è¯¥æ¥å£å°†å¦‚ä¸‹æ‰€ç¤ºï¼š <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (INTERFACE_FILTER.test(clazz)) { notNullAnnotationParameterMap.put(currentNullableIndex, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); method.invoke(createInstanceByDynamicProxy(clazz, invokeMethodParameterArray), invokeMethodParameterArray); makeErrorMessage(method); }</code> </pre> <br> å¦‚æœcreateInstanceByDynamicProxyå®ç°äº†è‡³å°‘ä¸€ä¸ªæ¥å£ï¼Œæˆ–è€…å®ƒæœ¬èº«æ˜¯ä¸€ä¸ªæ¥å£ï¼Œåˆ™å…è®¸æˆ‘ä»¬åœ¨ç±»ä¸Šåˆ›å»ºå®ä¾‹ <br><br><div class="spoiler">  <b class="spoiler_title">ç»†å¾®å·®åˆ«</b> <div class="spoiler_text"> è¯·è®°ä½ï¼Œä»æ ¹æœ¬ä¸Šè®²ï¼Œè¿™æ˜¯ç±»å®ç°çš„æ¥å£ï¼Œç±»å‹æ¥å£ï¼ˆè€Œä¸æ˜¯æŸäº›Comparableï¼‰å¾ˆé‡è¦ï¼Œåœ¨è¯¥ç±»ä¸­ï¼Œæ‚¨éœ€è¦åœ¨ç›®æ ‡ç±»ä¸­å®ç°æ–¹æ³•ï¼Œå¦åˆ™å®ä¾‹ä¼šè®©æ‚¨æƒŠè®¶äºå…¶ç±»å‹ <br></div></div><br> ä½†æ˜¯é‡Œé¢æ˜¯è¿™æ ·çš„ï¼š <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> Object </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createInstanceByDynamicProxy</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Class clazz, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Object[] invokeMethodParameterArray)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> newProxyInstance( currentThread().getContextClassLoader(), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Class[]{clazz}, (proxy, method1, args) -&gt; { Constructor&lt;Lookup&gt; constructor = Lookup.class .getDeclaredConstructor(Class.class); constructor.setAccessible(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); constructor.newInstance(clazz) .in(clazz) .unreflectSpecial(method1, clazz) .bindTo(proxy) .invokeWithArguments(invokeMethodParameterArray); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } ); }</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">è€™å­</b> <div class="spoiler_text"> é¡ºä¾¿è¯´ä¸€ä¸‹ï¼Œè¿™é‡Œä¹Ÿæœ‰ä¸€äº›è€™å­ï¼Œæˆ‘ä¸è®°å¾—äº†ï¼Œæœ‰å¾ˆå¤šï¼Œä½†æ˜¯æ‚¨éœ€è¦é€šè¿‡Lookup.classåˆ›å»ºä¸€ä¸ªä»£ç†ã€‚ <br></div></div><br> ä¸‹ä¸€ä¸ªå®ä¾‹ï¼ˆæˆ‘çš„æœ€çˆ±ï¼‰æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ã€‚ åœ¨è¿™é‡Œï¼ŒåŠ¨æ€ä»£ç†å°†ä¸å†å¯¹æˆ‘ä»¬æœ‰å¸®åŠ©ï¼Œå› ä¸ºå¦‚æœæŠ½è±¡ç±»å®ç°äº†æŸç§ç±»å‹çš„æ¥å£ï¼Œé‚£ä¹ˆæ˜¾ç„¶è¿™ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ç±»å‹ã€‚ å°±åƒé‚£æ ·ï¼Œæˆ‘ä»¬ä¸èƒ½ä»æŠ½è±¡ç±»ä¸­è·å–å¹¶åˆ›å»ºnewInstanceï¼ˆï¼‰ã€‚ è¿™é‡Œçš„CGLIBå°†ä¸ºæˆ‘ä»¬æä¾›å¸®åŠ©ï¼Œä¸€ä¸ªspring libï¼Œå®ƒåŸºäºç»§æ‰¿åˆ›å»ºä»£ç†ï¼Œä½†æ˜¯éº»çƒ¦çš„æ˜¯ï¼Œç›®æ ‡ç±»å¿…é¡»å…·æœ‰é»˜è®¤çš„ï¼ˆæ²¡æœ‰å‚æ•°ï¼‰æ„é€ å‡½æ•° <br><br><div class="spoiler">  <b class="spoiler_title">å…«å¦</b> <div class="spoiler_text"> å°½ç®¡ä»æ˜¥å­£4æœˆå¼€å§‹é€šè¿‡äº’è”ç½‘ä¸Šçš„å…«å¦æ¥åˆ¤æ–­ï¼Œä½†CGLIBå¯ä»¥åœ¨æ²¡æœ‰å®ƒçš„æƒ…å†µä¸‹è¿è¡Œï¼Œå› æ­¤ï¼š <b>å®ƒä¸èµ·ä½œç”¨ï¼</b> <br></div></div> å®ä¾‹åŒ–æŠ½è±¡ç±»çš„é€‰é¡¹æ˜¯è¿™æ ·çš„ï¼š <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isAbstract(clazz.getModifiers())) { createInstanceByCGLIB(clazz, method, invokeMethodParameterArray); makeErrorMessage(); }</code> </pre> <br> åœ¨ä»£ç ç¤ºä¾‹ä¸­å·²ç»çœ‹åˆ°çš„makeErrorMessageï¼ˆï¼‰ä¼šä¸¢å¼ƒæµ‹è¯•ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨å¸¦nullçš„å¸¦æ³¨é‡Šçš„@NonNullå‚æ•°è°ƒç”¨è¯¥æ–¹æ³•å¹¶ä¸”è¯¥æ–¹æ³•æ²¡æœ‰å¤±è´¥ï¼Œåˆ™è¯¥æµ‹è¯•æ— æ•ˆï¼Œæ‚¨å¿…é¡»åˆ é™¤è¯¥æµ‹è¯•ã€‚ <br><br> å¯¹äºå‚æ•°æ˜ å°„ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªé€šç”¨çš„æ–¹æ³•å¯ä»¥æ˜ å°„å’Œé”å®šæ„é€ å‡½æ•°å’Œæ–¹æ³•å‚æ•°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mappingParameter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Parameter parameter, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Object[] methodParam, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> index)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> InstantiationException, IllegalAccessException </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isFinal(parameter.getType().getModifiers())) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (parameter.getType().isEnum()) { methodParam[index] = Enum.valueOf( (Class&lt;Enum&gt;) (parameter.getType()), parameter.getType().getEnumConstants()[<span class="hljs-number"><span class="hljs-number">0</span></span>].toString() ); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (parameter.getType().isPrimitive()) { mappingPrimitiveName(parameter, methodParam, index); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (parameter.getType().getTypeName().equals(<span class="hljs-string"><span class="hljs-string">"byte[]"</span></span>)) { methodParam[index] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[<span class="hljs-number"><span class="hljs-number">0</span></span>]; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { methodParam[index] = parameter.getType().newInstance(); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { methodParam[index] = mock(parameter.getType()); } }</code> </pre> <br> é€šå¸¸è¦æ³¨æ„Enumï¼ˆè›‹ç³•ä¸Šçš„æ¨±æ¡ƒï¼‰çš„åˆ›å»ºï¼Œä¸€èˆ¬æ¥è¯´ï¼Œæ‚¨ä¸èƒ½ä»…ä»…é‡‡ç”¨å¹¶åˆ›å»ºEnumã€‚ <br><br> å¯¹äºæœ€ç»ˆå‚æ•°ï¼Œè¿™é‡Œæ˜¯æ‚¨è‡ªå·±çš„æ˜ å°„ï¼Œå¯¹äºéæœ€ç»ˆå‚æ•°æ˜¯æ‚¨è‡ªå·±çš„æ˜ å°„ï¼Œç„¶ååªéœ€åœ¨æ–‡æœ¬ï¼ˆä»£ç ï¼‰ä¸­å³å¯ã€‚ <br><br> å¥½äº†ï¼Œåœ¨ä¸ºæ„é€ å‡½æ•°å’Œæ–¹æ³•åˆ›å»ºå‚æ•°ä¹‹åï¼Œæˆ‘ä»¬å½¢æˆäº†å®ä¾‹ï¼š <br><br><pre> <code class="java hljs">val firstFindConstructor = clazz.getConstructors()[<span class="hljs-number"><span class="hljs-number">0</span></span>]; val constructorParameterArray = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Object[firstFindConstructor.getParameters().length]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; constructorParameterArray.length; i++) { mappingParameter(firstFindConstructor.getParameters()[i], constructorParameterArray, i); } notNullAnnotationParameterMap.put(currentNullableIndex, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); createAndInvoke(clazz, method, invokeMethodParameterArray, firstFindConstructor, constructorParameterArray); makeErrorMessage(method);</code> </pre> <cut></cut><br> æˆ‘ä»¬å·²ç»ç¡®å®šåœ°çŸ¥é“ï¼Œç”±äºæˆ‘ä»¬å·²ç»åˆ°äº†ä»£ç çš„è¿™ä¸€é˜¶æ®µï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬è‡³å°‘æœ‰ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»»ä½•ä¸€ä¸ªæ„é€ å‡½æ•°æ¥åˆ›å»ºå®ä¾‹ï¼Œå› æ­¤æˆ‘ä»¬é‡‡ç”¨æˆ‘ä»¬çœ‹åˆ°çš„ç¬¬ä¸€ä¸ªå®ä¾‹ï¼Œçœ‹çœ‹æ„é€ å‡½æ•°ä¸­æ˜¯å¦æœ‰å‚æ•°ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™è°ƒç”¨åƒè¿™æ ·ï¼š <br><br><pre> <code class="java hljs">method.invoke(spy(clazz.getConstructors()[<span class="hljs-number"><span class="hljs-number">0</span></span>].newInstance()), invokeMethodParameterArray);</code> </pre> <br><br> å¥½å§ï¼Œå¦‚æœæœ‰è¿™æ ·çš„äº‹æƒ…ï¼š <br><pre> <code class="java hljs">method.invoke(spy(clazz.getConstructors()[<span class="hljs-number"><span class="hljs-number">0</span></span>].newInstance()), invokeMethodParameterArray);</code> </pre> <cut></cut><br> è¿™æ˜¯æ‚¨çœ‹åˆ°çš„æ›´é«˜ä¸€ç‚¹çš„createAndInvokeï¼ˆï¼‰æ–¹æ³•ä¸­å‘ç”Ÿçš„é€»è¾‘ã€‚ <br> æ‰°æµå™¨ä¸‹çš„æµ‹è¯•ç±»çš„å®Œæ•´ç‰ˆæœ¬ï¼Œæ²¡æœ‰åƒæˆ‘åœ¨ä¸€ä¸ªå·¥ä½œé¡¹ç›®ä¸­æ‰€å†™çš„é‚£æ ·ä¸Šä¼ åˆ°gitï¼Œä½†å®é™…ä¸Šï¼Œå®ƒåªæ˜¯å¯ä»¥åœ¨æ‚¨çš„æµ‹è¯•ä¸­ç»§æ‰¿å’Œä½¿ç”¨çš„ä¸€ä¸ªç±»ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">æºä»£ç </b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestUtil</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Predicate&lt;Method&gt; METHOD_FILTER = method -&gt; isPublic(method.getModifiers()) &amp;&amp; isFalse(method.isSynthetic()) &amp;&amp; isFalse(isAbstract(method.getModifiers())) &amp;&amp; isFalse(method.getName().equals(<span class="hljs-string"><span class="hljs-string">"equals"</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Predicate&lt;Class&gt; ONLY_ONE_PRIVATE_CONSTRUCTOR_FILTER = clazz -&gt; clazz.getConstructors().length == <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; isFalse(clazz.isInterface()); <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Predicate&lt;Class&gt; INTERFACE_FILTER = clazz -&gt; clazz.getConstructors().length == <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> BiPredicate&lt;Exception, Parameter&gt; LOMBOK_ERROR_FILTER = (exception, parameter) -&gt; isNull(exception.getCause().getMessage()) || isFalse(exception.getCause().getMessage().equals(parameter.getName())); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">assertNonNullAnnotation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Class clazz)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Throwable </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (val method : getPublicMethods(clazz)) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (method.getParameterCount() == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> nonNullAnnotationCount = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> index = <span class="hljs-number"><span class="hljs-number">0</span></span>; val parameterCurrentMethodArray = method.getParameters(); val notNullAnnotationParameterMap = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashMap&lt;Integer, Boolean&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (val parameter : parameterCurrentMethodArray) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isNull(parameter.getAnnotation(Nullable.class)) &amp;&amp; isFalse(parameter.getType().isPrimitive())) { notNullAnnotationParameterMap.put(index++, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); nonNullAnnotationCount++; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { notNullAnnotationParameterMap.put(index++, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (nonNullAnnotationCount == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> j = <span class="hljs-number"><span class="hljs-number">0</span></span>; j &lt; nonNullAnnotationCount; j++) { val invokeMethodParameterArray = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Object[parameterCurrentMethodArray.length]; <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> hasNullParameter = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> currentNullableIndex = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; invokeMethodParameterArray.length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (notNullAnnotationParameterMap.get(i) &amp;&amp; isFalse(hasNullParameter)) { currentNullableIndex = i; invokeMethodParameterArray[i] = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; hasNullParameter = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { mappingParameter(parameterCurrentMethodArray[i], invokeMethodParameterArray, i); } } <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ONLY_ONE_PRIVATE_CONSTRUCTOR_FILTER.test(clazz)) { notNullAnnotationParameterMap.put(currentNullableIndex, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); method.invoke(clazz, invokeMethodParameterArray); makeErrorMessage(method); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (INTERFACE_FILTER.test(clazz)) { notNullAnnotationParameterMap.put(currentNullableIndex, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); method.invoke(createInstanceByDynamicProxy(clazz, invokeMethodParameterArray), invokeMethodParameterArray); makeErrorMessage(method); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isAbstract(clazz.getModifiers())) { createInstanceByCGLIB(clazz, method, invokeMethodParameterArray); makeErrorMessage(); } val firstFindConstructor = clazz.getConstructors()[<span class="hljs-number"><span class="hljs-number">0</span></span>]; val constructorParameterArray = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Object[firstFindConstructor.getParameters().length]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; constructorParameterArray.length; i++) { mappingParameter(firstFindConstructor.getParameters()[i], constructorParameterArray, i); } notNullAnnotationParameterMap.put(currentNullableIndex, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); createAndInvoke(clazz, method, invokeMethodParameterArray, firstFindConstructor, constructorParameterArray); makeErrorMessage(method); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Exception e) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (LOMBOK_ERROR_FILTER.test(e, parameterCurrentMethodArray[currentNullableIndex])) { makeErrorMessage(method); } } } } } <span class="hljs-meta"><span class="hljs-meta">@SneakyThrows</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createAndInvoke</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Class clazz, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Method method, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Object[] invokeMethodParameterArray, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Constructor firstFindConstructor, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Object[] constructorParameterArray )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (firstFindConstructor.getParameters().length == <span class="hljs-number"><span class="hljs-number">0</span></span>) { method.invoke(spy(clazz.getConstructors()[<span class="hljs-number"><span class="hljs-number">0</span></span>].newInstance()), invokeMethodParameterArray); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { method.invoke(spy(clazz.getConstructors()[<span class="hljs-number"><span class="hljs-number">0</span></span>].newInstance(constructorParameterArray)), invokeMethodParameterArray); } } <span class="hljs-meta"><span class="hljs-meta">@SneakyThrows</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createInstanceByCGLIB</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Class clazz, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Method method, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Object[] invokeMethodParameterArray)</span></span></span><span class="hljs-function"> </span></span>{ MethodInterceptor handler = (obj, method1, args, proxy) -&gt; proxy.invoke(clazz, args); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (clazz.getConstructors().length &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { val firstFindConstructor = clazz.getConstructors()[<span class="hljs-number"><span class="hljs-number">0</span></span>]; val constructorParam = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Object[firstFindConstructor.getParameters().length]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; constructorParam.length; i++) { mappingParameter(firstFindConstructor.getParameters()[i], constructorParam, i); } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (val constructor : clazz.getConstructors()) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (constructor.getParameters().length == <span class="hljs-number"><span class="hljs-number">0</span></span>) { val proxy = Enhancer.create(clazz, handler); method.invoke(proxy.getClass().newInstance(), invokeMethodParameterArray); } } } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> Object </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createInstanceByDynamicProxy</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Class clazz, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Object[] invokeMethodParameterArray)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> newProxyInstance( currentThread().getContextClassLoader(), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Class[]{clazz}, (proxy, method1, args) -&gt; { Constructor&lt;Lookup&gt; constructor = Lookup.class .getDeclaredConstructor(Class.class); constructor.setAccessible(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); constructor.newInstance(clazz) .in(clazz) .unreflectSpecial(method1, clazz) .bindTo(proxy) .invokeWithArguments(invokeMethodParameterArray); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } ); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">makeErrorMessage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ fail(<span class="hljs-string"><span class="hljs-string">"  @NonNull     DefaultConstructor  "</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">makeErrorMessage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Method method)</span></span></span><span class="hljs-function"> </span></span>{ fail(<span class="hljs-string"><span class="hljs-string">"    "</span></span> + method.getName() + <span class="hljs-string"><span class="hljs-string">"   @NonNull"</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> List&lt;Method&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getPublicMethods</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Class clazz)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Arrays.stream(clazz.getDeclaredMethods()) .filter(METHOD_FILTER) .collect(toList()); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mappingParameter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Parameter parameter, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Object[] methodParam, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> index)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> InstantiationException, IllegalAccessException </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isFinal(parameter.getType().getModifiers())) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (parameter.getType().isEnum()) { methodParam[index] = Enum.valueOf( (Class&lt;Enum&gt;) (parameter.getType()), parameter.getType().getEnumConstants()[<span class="hljs-number"><span class="hljs-number">0</span></span>].toString() ); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (parameter.getType().isPrimitive()) { mappingPrimitiveName(parameter, methodParam, index); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (parameter.getType().getTypeName().equals(<span class="hljs-string"><span class="hljs-string">"byte[]"</span></span>)) { methodParam[index] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[<span class="hljs-number"><span class="hljs-number">0</span></span>]; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { methodParam[index] = parameter.getType().newInstance(); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { methodParam[index] = mock(parameter.getType()); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mappingPrimitiveName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Parameter parameter, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Object[] methodParam, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> index)</span></span></span><span class="hljs-function"> </span></span>{ val name = parameter.getType().getName(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-string"><span class="hljs-string">"long"</span></span>.equals(name)) { methodParam[index] = <span class="hljs-number"><span class="hljs-number">0L</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-string"><span class="hljs-string">"int"</span></span>.equals(name)) { methodParam[index] = <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-string"><span class="hljs-string">"byte"</span></span>.equals(name)) { methodParam[index] = (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>) <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-string"><span class="hljs-string">"short"</span></span>.equals(name)) { methodParam[index] = (<span class="hljs-keyword"><span class="hljs-keyword">short</span></span>) <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-string"><span class="hljs-string">"double"</span></span>.equals(name)) { methodParam[index] = <span class="hljs-number"><span class="hljs-number">0.0</span></span>d; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-string"><span class="hljs-string">"float"</span></span>.equals(name)) { methodParam[index] = <span class="hljs-number"><span class="hljs-number">0.0f</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-string"><span class="hljs-string">"boolean"</span></span>.equals(name)) { methodParam[index] = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-string"><span class="hljs-string">"char"</span></span>.equals(name)) { methodParam[index] = <span class="hljs-string"><span class="hljs-string">'A'</span></span>; } } }</code> </pre> <br></div></div><br><h3> ç»“è®º </h3><br> è¿™æ®µä»£ç å¯ä»¥åœ¨çœŸå®é¡¹ç›®ä¸­å·¥ä½œå¹¶æµ‹è¯•æ³¨é‡Šï¼Œè€Œå½“æ‰€æœ‰å†…å®¹éƒ½å¯ä»¥æŠ˜å æ—¶ï¼Œç›®å‰åªæœ‰ä¸€ç§é€‰æ‹©ã€‚ <br><br> åœ¨ç­çº§ä¸­å£°æ˜ä¸€ä¸ªLombockå¡ç‰¹çŠ¬ï¼ˆå¦‚æœæœ‰ä¸€ä¸ªä¸“å®¶æ²¡æœ‰åœ¨Pojoç­çº§ä¸­è®¾ç½®å¡ç‰¹çŠ¬ï¼Œå°½ç®¡é‚£æ²¡æœ‰å‘ç”Ÿï¼‰ï¼Œå¹¶ä¸”å®£å‘Šå¡ç‰¹çŠ¬çš„é¢†åŸŸå°†ä¸æ˜¯æœ€ç»ˆçš„ã€‚ <br><br> ç„¶åæ¡†æ¶å°†å‹å–„åœ°è¯´ä¸€ä¸ªå…¬å…±æ–¹æ³•ï¼Œå¹¶ä¸”å®ƒæœ‰ä¸€ä¸ªæ²¡æœ‰@NonNullæ‰¹æ³¨çš„å‚æ•°ï¼Œè§£å†³æ–¹æ¡ˆå¾ˆç®€å•ï¼šæ˜¾å¼å£°æ˜setterå¹¶æ ¹æ®é€»è¾‘@NonNull / @ Nullableå¯¹å…¶å‚æ•°è¿›è¡Œæ³¨é‡Šã€‚ <br><br> è¯·æ³¨æ„ï¼Œå¦‚æœæ‚¨å¸Œæœ›æˆ‘ç»‘å®šåˆ°æµ‹è¯•ï¼ˆæˆ–å…¶ä»–æ–¹å¼ï¼‰ä¸­æ–¹æ³•å‚æ•°çš„åç§°ï¼Œåˆ™åœ¨è¿è¡Œæ—¶ä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹æ–¹æ³•ä¸­çš„å˜é‡åç§°ä¸å¯ç”¨ï¼Œæ‚¨ä¼šå‘ç°arg [0]å’Œarg [1]ç­‰ã€‚ ã€‚ <br> è¦åœ¨è¿è¡Œæ—¶ä¸­æ˜¾ç¤ºæ–¹æ³•åç§°ï¼Œè¯·ä½¿ç”¨Mavenæ’ä»¶ï¼š <br><br><pre> <code class="java hljs">&lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt; &lt;version&gt;${maven.compiler.plugin.version}&lt;/version&gt; &lt;configuration&gt; &lt;source&gt;${compile.target.source}&lt;/source/&gt; &lt;target&gt;${compile.target.source}&lt;/target&gt; &lt;encoding&gt;${project.build.sourceEncoding}&lt;/encoding&gt; &lt;compilerArgs&gt;&lt;arg&gt;-parameters&lt;/arg&gt;&lt;/compilerArgs&gt; &lt;/configuration&gt; &lt;/plugin&gt;</code> </pre><br> ç‰¹åˆ«æ˜¯æ­¤å¯†é’¥ï¼š <br><br><pre> <code class="java hljs">&lt;compilerArgs&gt;&lt;arg&gt;-parameters&lt;/arg&gt;&lt;/compilerArgs&gt;</code> </pre> <br> æˆ‘å¸Œæœ›ä½ æœ‰å…´è¶£ã€‚ </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN464939/">https://habr.com/ru/post/zh-CN464939/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN464929/index.html">å»¶è¿Ÿæµè§ˆå™¨å›¾åƒåŠ è½½ï¼ˆåŠ è½½å±æ€§ï¼‰</a></li>
<li><a href="../zh-CN464931/index.html">æ±‡ç¼–ç¨‹åºæ’å…¥...åœ¨Cï¼ƒä¸­ï¼Ÿ</a></li>
<li><a href="../zh-CN464933/index.html">Androidæ“ä½œç³»ç»Ÿä¸Šçš„ç”µå­ä¹¦åº”ç”¨ç¨‹åºã€‚ ç¬¬4éƒ¨åˆ†ã€‚æ¸¸æˆ</a></li>
<li><a href="../zh-CN464935/index.html">èˆ’é€‚çš„DevOpsSecï¼šé€‚ç”¨äºNGINXçš„Nemesida WAF Freeï¼Œå…·æœ‰APIå’Œä¸ªäººå¸æˆ·</a></li>
<li><a href="../zh-CN464937/index.html">ï¼ƒ312ç§»åŠ¨å¼€å‘äººå‘˜çš„æœ‰è¶£ææ–™æ‘˜è¦ï¼ˆ8æœˆ19æ—¥è‡³25æ—¥ï¼‰</a></li>
<li><a href="../zh-CN464949/index.html">å†ä¸€æ¬¡ä»‹ç»GCDï¼Œæ¬§å‡ é‡Œå¾—ç®—æ³•å’Œä¸€èˆ¬ç®—æ³•çš„å†å²ã€‚ å½“ç„¶æœ‰Swiftçš„ä¾‹å­</a></li>
<li><a href="../zh-CN464951/index.html">ä»»åŠ¡è¶Šç®€å•ï¼Œæˆ‘å°±è¶Šå®¹æ˜“è¯¯è§£</a></li>
<li><a href="../zh-CN464955/index.html">é“è¿ˆå…‹Â·æ³°æ£®ï¼ˆIron Mike Tysonï¼‰å’ŒåŒºå—é“¾é¡¹ç›®ã€Šå¥‹æ–—æˆåã€‹</a></li>
<li><a href="../zh-CN464959/index.html">è§£æä¿„è¯­å¥å­</a></li>
<li><a href="../zh-CN464961/index.html">åœ¨Unity UIä¸­åˆ›å»ºå¯è§†ç»„ä»¶ã€‚ ç²’å­ç³»ç»Ÿ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>