<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèª‚Äçüöí üßù ‚åöÔ∏è [Javawatch Live] L'histoire d'une demande de tirage. `os.version` dans SubstrateVM üÜö ü§∑üèº üë©üèæ‚Äç‚úàÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Un an s'est √©coul√© depuis la r√©ussite de l'astuce pr√©c√©dente: publier une vid√©o sur YouTube au lieu d'un article. ¬´Discours honteux sur singleton¬ª a g...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>[Javawatch Live] L'histoire d'une demande de tirage. `os.version` dans SubstrateVM</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jugru/blog/420455/">  Un an s'est √©coul√© depuis la r√©ussite de l'astuce pr√©c√©dente: publier une vid√©o sur YouTube au lieu d'un article.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">¬´Discours honteux sur singleton¬ª a</a> gagn√© 7 000 vues sur YouTube et deux fois plus sur Habr√© dans la version texte.  Pour un article √©crit dans un √©tat compl√®tement t√™tu et parlant de l'ancien accord√©on √† boutons - c'est un peu un succ√®s. <br><br>  Aujourd'hui, j'ai install√© une nouvelle version toute la nuit.  Cette fois, le sujet est beaucoup plus r√©cent: l'histoire du commit √† la technologie exp√©rimentale - SubstrateVM.  Mais le degr√© de t√©nacit√© a atteint un nouveau niveau. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/f0nD_8G1uB0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br>  Au plaisir de vos commentaires!  Je vous rappelle que si vous voulez vraiment am√©liorer quelque chose dans ce post, il est pr√©f√©rable de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">d√©poser celui-ci sur Github</a> .  Je voudrais dire "aimez et abonnez-vous <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">√† la nouvelle cha√Æne</a> , mais toutes ses versions seront-elles de toute fa√ßon dans votre hub Java?" <br><br>  Techniquement: la vid√©o a un collage plus proche de la fin.  Je viens d'√©crire une vid√©o non compress√©e et mon ssd m2 de seulement cinq cents gigaoctets a rapidement d√©bord√©.  Et aucun autre disque dur ne pourrait r√©sister √† une telle pression de donn√©es.  Par cons√©quent, j'ai d√ª me d√©connecter pendant une demi-heure et je me suis mis en quatre pour trouver cinquante concerts suppl√©mentaires pour enregistrer les derni√®res minutes.  Cela a √©t√© r√©alis√© en supprimant les fichiers <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">compil√©s par GoogleChrome</a> .  J'ai √©crit sur le logiciel d'enregistrement dans le FB <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">juste au moment de l'enregistrement</a> , il y a beaucoup de douleur. <br><br>  Un autre des aspects techniquement int√©ressants: YouTube pour une raison quelconque m'a bloqu√© la diffusion en direct.  Dans le m√™me temps, il n'y a pas une seule gr√®ve et stigmatisation sur le compte.  Esp√©rons que ce n'est qu'un jambage, et apr√®s 90 jours, tout sera retourn√©. <br><a name="habracut"></a><br><blockquote>  Cet article citera un code appartenant √† Oracle.  Vous ne pouvez pas utiliser ce code pour vous-m√™me (√† moins que vous n'ayez lu la licence d'origine et qu'il ne l'autorise dans les conditions, par exemple, de la GPL).  Ce n'est pas une blague.  Olso, j'ai pr√©venu. <br></blockquote><br><h1>  Prikazka (et un conte de f√©es sera √† venir) </h1><br>  Beaucoup ont d√©j√† entendu des histoires selon lesquelles ¬´le nouveau Java sera √©crit en Java¬ª et se demandent comment cela pourrait √™tre.  Il y a un document de politique de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Project Metropolis</a> et une lettre correspondante de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">John Rose</a> , mais tout y est assez vague. <br><br>  Cela ressemble √† une sorte de magie effrayante et sanglante.  Dans la m√™me chose que vous pouvez essayer en ce moment, non seulement il n'y a pas de magie, mais tout est stupide comme le dos d'une pelle lorsque vous enlevez vos dents avec.  Bien s√ªr, il y a quelques nuances, mais ce sera un jour tr√®s tard. <br><br>  Je vais le montrer sur l'exemple d'une histoire instructive qui s'est produite pendant l'√©t√©.  Comment ils √©crivent l'essai ¬´Comment j'ai pass√© l'√©t√©¬ª dans les √©coles. <br><br>  Pour commencer une petite remarque.  Le projet en cours de compilation Ahead-of-Time dans Oracle Labs est GraalVM.  Le composant qui, en fait, fait nishtyaki et transforme le code Java en un fichier ex√©cutable (en un ex√©cutable) est SubstrateVM ou SVM pour faire court.  Ne confondez pas cela avec la m√™me abr√©viation utilis√©e par les satanistes de donn√©es (support vector machine).  Il s'agit de SVM, en tant que partie cl√©, nous parlerons plus loin. <br><br><h1>  √ânonc√© du probl√®me </h1><br>  Donc, "comment j'ai pass√© l'√©t√©."  Je me suis assis en vacances, j'ai pass√© deux F5 sur le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">github</a> du <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Graal</a> et je suis tomb√© sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">celui-ci</a> : <br><br><img src="https://habrastorage.org/webt/uy/pg/ig/uypgig4krayn8dmvfzif_rd3em0.png"><br><br>  Une personne veut que <code>os.version</code> donne la bonne valeur. <br><br>  Eh bien cho, je voulais corriger le bug?  Le gar√ßon a dit - le gar√ßon l'a fait. <br><br>  Nous allons v√©rifier si notre client ment. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Main</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ System.out.println(System.getProperty(<span class="hljs-string"><span class="hljs-string">"os.version"</span></span>)); } }</code> </pre><br>  Tout d'abord, √† quoi ressemble l'√©chappement en vrai Java: <code>4.15.0-32-generic</code> .  Oui, c'est une nouvelle version d'Ubuntu LTS Bionic. <br><br>  Essayez maintenant de faire de m√™me sur SVM: <br><br><pre> <code class="bash hljs">$ ls Main.java $ javac -cp . Main.java $ ls Main.class Main.java $ native-image Main Build on Server(pid: 18438, port: 35415) classlist: 151.77 ms (<span class="hljs-built_in"><span class="hljs-built_in">cap</span></span>): 1,662.32 ms setup: 1,880.78 ms error: Basic header file missing (&lt;zlib.h&gt;). Make sure libc and zlib headers are available on your system. Error: Processing image build request failed</code> </pre><br>  Et bien oui.  En effet, j'ai cr√©√© une toute nouvelle machine virtuelle sp√©cialement pour le test ¬´propre¬ª. <br><br><pre> <code class="bash hljs">$ sudo apt-get install zlib1g-dev libc6 libc6-dev $ native-image Main Build on Server(pid: 18438, port: 35415) classlist: 135.17 ms (<span class="hljs-built_in"><span class="hljs-built_in">cap</span></span>): 877.34 ms setup: 1,253.49 ms (typeflow): 4,103.97 ms (objects): 1,441.97 ms (features): 41.74 ms analysis: 5,690.63 ms universe: 252.43 ms (parse): 1,024.49 ms (inline): 819.27 ms (compile): 4,243.15 ms compile: 6,356.02 ms image: 632.29 ms write: 236.99 ms [total]: 14,591.30 ms</code> </pre><br>  Les chiffres absolus d'ex√©cution peuvent √™tre horribles.  Mais, d‚Äôabord, c‚Äôest ce qu‚Äôon voulait faire: des optimisations tr√®s infernales sont appliqu√©es ici.  Et deuxi√®mement, c'est une machine virtuelle fragile que vous voulez. <br><br>  Et enfin, le moment de v√©rit√©: <br><br><pre> <code class="hljs cs">$ ./main <span class="hljs-literal"><span class="hljs-literal">null</span></span></code> </pre><br>  Il semble que notre invit√© n'a pas menti, ne fonctionne vraiment pas. <br><br><h1>  Premi√®re approche: voler les propri√©t√©s de l'h√¥te </h1><br>  Ensuite, j'ai recherch√© <code>os.version</code> dans le <code>os.version</code> et <code>os.version</code> constat√© que toutes ces propri√©t√©s se <code>SystemPropertiesSupport</code> dans la classe <code>SystemPropertiesSupport</code> . <br><br>  Je n'√©crirai pas le chemin complet du fichier, car la possibilit√© de g√©n√©rer les projets corrects pour IntelliJ IDEA et Eclipse est int√©gr√©e directement dans SVM.  C'est tr√®s cool et ne rappelle pas du tout le tourment que la plupart du temps OpenJDK doit vivre.  Laissez l'IDE ouvrir des classes pour nous.  Donc: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SystemPropertiesSupport</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String[] HOSTED_PROPERTIES = { <span class="hljs-string"><span class="hljs-string">"java.version"</span></span>, ImageInfo.PROPERTY_IMAGE_KIND_KEY, <span class="hljs-string"><span class="hljs-string">"line.separator"</span></span>, <span class="hljs-string"><span class="hljs-string">"path.separator"</span></span>, <span class="hljs-string"><span class="hljs-string">"file.separator"</span></span>, <span class="hljs-string"><span class="hljs-string">"os.arch"</span></span>, <span class="hljs-string"><span class="hljs-string">"os.name"</span></span>, <span class="hljs-string"><span class="hljs-string">"file.encoding"</span></span>, <span class="hljs-string"><span class="hljs-string">"sun.jnu.encoding"</span></span>, }; <span class="hljs-comment"><span class="hljs-comment">//... }</span></span></code> </pre><br>  Ensuite, sans inclure la t√™te du tout, je <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">suis</a> simplement <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">all√© ajouter</a> une autre variable √† cet ensemble: <br><br><pre> <code class="java hljs"><span class="hljs-string"><span class="hljs-string">"os.arch"</span></span>, <span class="hljs-string"><span class="hljs-string">"os.name"</span></span>, <span class="hljs-string"><span class="hljs-string">"os.version"</span></span></code> </pre><br>  Je reconstruis, je cours, j'obtiens la ligne convoit√©e <code>4.15.0-32-generic</code> .  Hourra! <br><br>  Mais voici le probl√®me: maintenant sur <em>chaque</em> machine o√π ce code est ex√©cut√©, il √©met toujours <code>4.15.0-32-generic</code> .  M√™me l√† o√π <code>uname -a</code> rend la version pr√©c√©dente du bucket, sur l'ancien Ubunt. <br><br>  Il devient clair que ces variables sont √©crites dans le fichier source au moment de la compilation. <br>  Et vraiment, vous devez lire attentivement les commentaires: <br><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">/** System properties that are taken from the VM hosting the image generator. */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String[] HOSTED_PROPERTIES</code> </pre><br>  D'autres m√©thodes doivent √™tre appliqu√©es. <br><br><h2>  Conclusions </h2><br><ul><li>  Si vous voulez qu'une propri√©t√© syst√®me de ¬´Java principal¬ª apparaisse dans SVM, c'est tr√®s simple.  Nous √©crivons la propri√©t√© souhait√©e au bon endroit, c'est tout. </li><li>  Vous pouvez travailler dans l'IDE, qui prend en charge Java et Python en m√™me temps.  Par exemple, dans IntelliJ IDEA Ultimate avec un plugin Python ou le m√™me dans Eclipse. </li></ul><br><h1>  Deuxi√®me approche </h1><br>  Si vous fouillez dans le <code>SystemPropertiesSupport</code> SystemPropertiesSupport, nous trouvons une chose beaucoup plus raisonnable: <br><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">/** System properties that are lazily computed at run time on first access. */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Map&lt;String, Supplier&lt;String&gt;&gt; lazyRuntimeValues;</code> </pre><br>  Entre autres choses, l'utilisation de ces propri√©t√©s ne bloque toujours pas le processus de construction d'un ex√©cutable.  Il est clair que si nous <code>HOSTED_PROPERTIES</code> beaucoup dans <code>HOSTED_PROPERTIES</code> , alors tout ralentira. <br><br>  L'enregistrement des propri√©t√©s paresseuses se produit de mani√®re √©vidente, par r√©f√©rence √† une m√©thode qui renvoie: <br><br><pre> <code class="hljs kotlin">lazyRuntimeValues.put(<span class="hljs-string"><span class="hljs-string">"user.name"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>::userNameValue); lazyRuntimeValues.put(<span class="hljs-string"><span class="hljs-string">"user.home"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>::userHomeValue); lazyRuntimeValues.put(<span class="hljs-string"><span class="hljs-string">"user.dir"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>::userDirValue);</code> </pre><br>  De plus, toutes ces r√©f√©rences de m√©thode sont des interfaces, et la m√™me <code>this::userDirValue</code> est impl√©ment√©e pour chacune des plateformes prises en charge.  Dans ce cas, ce sont <code>PosixSystemPropertiesSupport</code> et <code>WindowsSystemPropertiesSupport</code> . <br><br>  Si nous sortons par curiosit√© d'une impl√©mentation pour Windows, nous verrons la triste chose: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">userDirValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"C:\\Users\\somebody"</span></span>; }</code> </pre><br>  Comme vous pouvez le voir, Windows n'est pas encore pris en charge :-) Cependant, le vrai probl√®me est que la g√©n√©ration d'ex√©cutables pour Windows n'est pas encore termin√©e, donc la prise en charge de ces m√©thodes serait en fait des efforts compl√®tement inutiles. <br><br>  Autrement dit, vous devez impl√©menter la m√©thode suivante: <br><br><pre> <code class="java hljs">lazyRuntimeValues.put(<span class="hljs-string"><span class="hljs-string">"os.version"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>::osVersionValue);</code> </pre><br>  Et puis le prendre en charge dans deux ou trois interfaces disponibles. <br><br>  Mais quoi y √©crire? <br><br><h2>  Conclusions </h2><br><ul><li>  Si vous souhaitez ajouter une nouvelle propri√©t√© calcul√©e en runtime, il s'agit d'√©crire une m√©thode.  Le r√©sultat peut d√©pendre du syst√®me d'exploitation actuel, le m√©canisme de commutation fonctionne d√©j√† et ne le demande pas. </li></ul><br><h1>  Un peu d'arch√©ologie </h1><br>  La premi√®re chose qui me vient √† l'esprit est de jeter un ≈ìil √† une impl√©mentation dans OpenJDK et de copier-coller effront√©ment.  Un peu d'arch√©ologie et de pillages n'emp√™cheront jamais un courageux explorateur! <br><br>  N'h√©sitez pas √† ouvrir n'importe quel projet Java dans l'Idea, √† y √©crire <code>System.getProperty("os.version")</code> et, en <code>System.getProperty("os.version")</code> + clic, acc√©dez √† l'impl√©mentation de la m√©thode <code>getProperty()</code> .  Il s'av√®re que tout cela se trouve b√™tement dans les <code>Properties</code> . <br><br>  Il semblerait, juste copier-coller l'endroit o√π ces <code>Properties</code> sont remplies, et rire avec ferveur, s'enfuir dans le vide.  Malheureusement, nous rencontrons un probl√®me: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">native</span></span></span><span class="hljs-function"> Properties </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initProperties</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Properties props)</span></span></span></span>;</code> </pre><br>  Noooooooooooooo. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d4d/ca9/698/d4dca9698ffccaf0de2944194698e857.gif"><br><br>  Mais tout a si bien commenc√©. <br><br><h1>  Y avait-il un gar√ßon? </h1><br>  Comme nous le savons, l'utilisation de C ++ est mauvaise.  Le C ++ est-il utilis√© dans SVM? <br><br>  Comme √ßa!  Il existe m√™me un package sp√©cial pour cela: <code>src/com.oracle.svm.native</code> . <br><br>  Et dans ce paquet, horror-horror, se trouve le fichier <code>getEnviron.c</code> avec quelque chose comme ceci: <br><br><pre> <code class="hljs cpp"><span class="hljs-keyword"><span class="hljs-keyword">extern</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> **environ; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">char</span></span></span><span class="hljs-function"> **</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getEnviron</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> environ; }</code> </pre><br><h1>  Il est temps de jouer avec C ++ </h1><br>  Maintenant, plongez un peu plus et ouvrez toutes les sources OpenJDK. <br><br>  Si quelqu'un ne les a pas d√©j√†, vous pouvez les <a href="">consulter sur le Web</a> ou les t√©l√©charger.  Je vous pr√©viens, ils <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">se</a> balancent <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">d'ici</a> , toujours avec l'aide de Mercurial, et cela prendra encore environ une demi-heure. <br><br>  Le fichier dont nous avons besoin se trouve dans <code>src/java.base/share/native/libjava/System.c</code> . <br><br>  Avez-vous remarqu√© qu'il s'agit du chemin d'acc√®s au fichier, et pas seulement du nom?  C'est vrai, vous pouvez pousser votre nouvelle id√©e √† la mode brillante, achet√©e 200 $ par an.  Vous pouvez <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">essayer CLion</a> , mais afin d'√©viter des dommages mentaux irr√©versibles, il est pr√©f√©rable de simplement prendre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Visual Studio Code</a> .  Il met d√©j√† en √©vidence quelque chose, mais ne comprend toujours pas ce qu'il a vu (il ne raye pas tout en rouge). <br><br>  Relecture courte de <code>System.c</code> : <br><br><pre> <code class="hljs lisp">java_props_t *sprops = GetJavaProperties(<span class="hljs-name"><span class="hljs-name">env</span></span>)<span class="hljs-comment"><span class="hljs-comment">; PUTPROP(props, "os.version", sprops-&gt;os_version);</span></span></code> </pre><br>  √Ä leur tour, ils sont pris dans <code>src/java.base/unix/native/libjava/java_props_md.c</code> . <br>  Chaque plate-forme a son propre fichier, ils passent par <code>#define</code> . <br><br>  Et ici √ßa commence.  Il existe de nombreuses plateformes.  Toute n√©crophilie comme AIX peut √™tre not√©e, car GraalVM ne la prend pas officiellement en charge (pour autant que je sache, GNU-Linux, macOS et Windows sont pr√©vus au d√©but).  GNU / Linux et Windows prennent en charge l'utilisation de <code>&lt;sys/utsname.h&gt;</code> , qui a des m√©thodes pr√©d√©finies pour obtenir le nom et la version du syst√®me d'exploitation. <br><br>  Mais macOS a un <a href="">terrible morceau de govnokod</a> . <br><br><ul><li>  Le nom ¬´Mac OS X¬ª y est enduit dur (bien qu'il ait longtemps √©t√© macOS); </li><li>  Cela d√©pend de la version de makoshi.  Avant la version 10.9, le SDK n'avait pas de fonction <code>operatingSystemVersion</code> et vous deviez lire <code>SystemVersion.plist</code> main; </li><li>  Pour cette soustraction, il utilise l'extension ObjC quelque chose comme ceci: </li></ul><br><pre> <code class="objectivec hljs"><span class="hljs-comment"><span class="hljs-comment">// Fallback if running on pre-10.9 Mac OS if (osVersionCStr == NULL) { NSDictionary *version = [NSDictionary dictionaryWithContentsOfFile : @"/System/Library/CoreServices/SystemVersion.plist"]; if (version != NULL) { NSString *nsVerStr = [version objectForKey : @"ProductVersion"]; if (nsVerStr != NULL) { osVersionCStr = strdup([nsVerStr UTF8String]); } } }</span></span></code> </pre><br>  Si au d√©part il y avait une id√©e de r√©√©crire manuellement dans un bon style, alors √ßa s'est rapidement √©cras√© dans la r√©alit√©.  Et si je d√©conne quelque part dans la jungle de ces nouilles de ifs, quelqu'un le cassera et me suspendra sur la place centrale?  Eh bien nafig.  <strong>Il est n√©cessaire de copier-coller.</strong> <br><br><h2>  Conclusions </h2><br><ul><li>  L'IDE n'est pas n√©cessaire; </li><li>  Toute communication avec C ++ est douloureuse, d√©sagr√©able, incomprise √† premi√®re vue. </li></ul><br><h1>  Le copier-coller est la norme? </h1><br>  C'est une question importante dont d√©pend la quantit√© de tourments suppl√©mentaires.  Je ne voulais vraiment pas r√©√©crire manuellement, mais aller en justice pour avoir viol√© des licences est encore pire.  Je suis donc all√© au github et j'ai directement demand√© √† Codrut Stancu.  Voici ce qu'il a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">r√©pondu</a> : <br><br>  <em>¬ªLa r√©utilisation du code OpenJDK, par exemple, le copier-coller est une chose normale du point de vue des licences.</em>  <em>Cependant, il y a une tr√®s bonne raison √† cela.</em>  <em>Si une fonctionnalit√© peut √™tre impl√©ment√©e en r√©utilisant le code JDK sans copier, par exemple en le patchant avec une substitution, ce sera bien mieux. "</em> <br><br>  Cela ressemble √† une autorisation officielle de copier-coller! <br><br><h1>  Nous avons parl√© normalement ... </h1><br>  J'ai commenc√© √† porter ce morceau de code, mais j'ai rencontr√© ma paresse.  Pour tester macOS pour diff√©rentes versions, vous devez en trouver au moins un avec le Mountain Lion n√©crophile 10.8.  J'ai deux de mes appareils Apple disponibles et un d'un ami, et je peux le d√©ployer sur un VMWare d'essai. <br><br>  Mais la paresse.  Et cette paresse m'a sauv√©. <br><br>  Je suis all√© dans la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">salle de chat</a> et j'ai demand√© √† Chris Seaton quelle cha√Æne d'outils √©tait la plus appropri√©e pour l'assemblage.  Quelle version du syst√®me d'exploitation est prise en charge, compilateur C ++, etc. <br><br>  En r√©ponse, il a re√ßu un silence surpris de la conversation et Chris a r√©pondu qu'il ne comprenait pas l'essence du probl√®me. <br><br>  Il a fallu un peu de temps pour que Chris puisse comprendre ce que je voulais faire et lui a demand√© de <strong>ne plus jamais le faire</strong> . <br><blockquote>  Il manque vraiment l'id√©e de SVM.  SVM est pur Java, il n'est pas cens√© y avoir du code √† partir d'OpenJDK.  Vous pouvez le lire, le convertir en Java, mais personne ne veut de code C ++ d'OpenJDK.  C'est la derni√®re chose que nous voulons. <br></blockquote><br>  L'exemple des biblioth√®ques de math√©matiques ne l'a pas convaincu.  Au minimum, ils sont √©crits en C, et l'inclusion de C ++ signifierait la connexion d'un tout nouveau langage √† la base de code.  Et celui qui est fufufu. <br><br>  Que faut-il faire?  √âcrivez en <strong>Java syst√®me</strong> . <br><br>  Et si les appels au SDK de la plateforme C / C ++ ne peuvent pas √™tre √©vit√©s, il doit s'agir d'un appel syst√®me unique encapsul√© dans l'API C.  Les donn√©es sont extraites en Java, puis la logique m√©tier est √©crite strictement en Java, m√™me si le Kit de d√©veloppement Platform SDK dispose de m√©thodes pr√™tes √† l'emploi pratiques pour le faire diff√©remment du c√¥t√© C ++. <br><br>  J'ai soupir√© et j'ai commenc√© √† √©tudier le code source pour comprendre comment cela peut √™tre fait diff√©remment. <br><br><h2>  Conclusions </h2><br><ul><li>  Discutez avec les gens du <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">chat de</a> tout d√©tail obscur.  Ils r√©pondent si les questions ne sont pas compl√®tement idiotes.  Bien que cet exemple montre que Chris est pr√™t √† discuter de questions idiotes, m√™me si cela ne lui fait pas gagner du temps personnellement; </li><li>  C ++ n'est pas du tout pr√©sent dans le projet.  Il n'y a aucune raison de croire que quelqu'un le laissera le tra√Æner sous le plancher; </li><li>  Au lieu de cela, vous devez √©crire dans System Java en utilisant C en dernier recours (par exemple, lors de l'appel du SDK de la plate-forme). </li></ul><br><h1>  Le violoniste n'est pas n√©cessaire </h1><br><blockquote>  Un violoniste n'est pas n√©cessaire, cher.  Il ne mange que trop de carburant. <br></blockquote><br>  Ensuite, j'ai √©t√© submerg√© de tristesse, car regardez ici.  Si sous Windows, nous avons <code>&lt;sys/utsname.h&gt;</code> , et nous esp√©rons b√™tement pour sa r√©ponse - c'est facile et simple. <br><br>  Mais s'il n'est pas l√†, que devra-t-il faire? <br><br><ul><li>  Appeler les commandes int√©gr√©es cmd ou les utilitaires Windows?  Publier du texte en russe qui doit √™tre analys√©.  C'est tout en bas, et cela peut ne pas co√Øncider avec ce que le vrai OpenJDK r√©pondra √† cet endroit. </li><li>  Prendre du registre?  M√™me ici, il y a des nuances, par exemple, lors du passage de Windows 7 √† 10, la m√©thode de stockage des num√©ros num√©riques dans le Registre a chang√©, et dans Windows 10, la version doit √™tre coll√©e avec les mains des composants majeurs et mineurs, ou simplement r√©pondre qu'il s'agit de Windows 10 √† un chiffre.  Laquelle de ces m√©thodes est la plus correcte (ne fera pas repentir les culs des utilisateurs) n'est pas claire. </li></ul><br>  Heureusement, mon angoisse a √©t√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">interrompue par la</a> qu√™te de traction de Paul Woegerer, qui a tout r√©gl√©. <br><br>  Fait int√©ressant, au d√©but, tout a √©t√© r√©par√© dans l'assistant ( <code>os.version</code> cess√© de donner la valeur <code>null</code> dans le test), et ce n'est qu'alors que j'ai remarqu√© une pull pull.  Le probl√®me est que ce commit n'est pas marqu√© sur le github comme une requ√™te de pull - c'est un commit simple avec l'inscription <code>PullRequest: graal/1885</code> dans le commentaire.  Le fait est que les mecs d'Oracle Labs n'utilisent pas Github, ils en ont seulement besoin pour interagir avec des committers externes.  Tous ceux d'entre nous qui n'ont pas eu la chance de travailler chez Oracle Labs doivent s'abonner aux notifications de nouveaux commits dans le r√©f√©rentiel et les lire tous. <br><br>  Mais maintenant, vous pouvez vous d√©tendre et voir comment impl√©menter <em>correctement</em> cette fonctionnalit√©. <br><br>  Voyons de quel genre de b√™te il s'agit, System Java. <br><br>  Comme je l'ai dit plus t√¥t, tout est simple, comme le dos d'une pelle, quand ils essaient de vous casser les dents.  Et tout aussi douloureux.  Jetez un ≈ìil √† la citation de la piscine: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">osVersionValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (osVersionValue != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> osVersionValue; } <span class="hljs-comment"><span class="hljs-comment">/* On OSX Java returns the ProductVersion instead of kernel release info. */</span></span> CoreFoundation.CFDictionaryRef dict = CoreFoundation._CFCopyServerVersionDictionary(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (dict.isNull()) { dict = CoreFoundation._CFCopySystemVersionDictionary(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (dict.isNull()) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> osVersionValue = <span class="hljs-string"><span class="hljs-string">"Unknown"</span></span>; } CoreFoundation.CFStringRef dictKeyRef = DarwinCoreFoundationUtils.toCFStringRef(<span class="hljs-string"><span class="hljs-string">"MacOSXProductVersion"</span></span>); CoreFoundation.CFStringRef dictValue = CoreFoundation.CFDictionaryGetValue(dict, dictKeyRef); CoreFoundation.CFRelease(dictKeyRef); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (dictValue.isNull()) { dictKeyRef = DarwinCoreFoundationUtils.toCFStringRef(<span class="hljs-string"><span class="hljs-string">"ProductVersion"</span></span>); dictValue = CoreFoundation.CFDictionaryGetValue(dict, dictKeyRef); CoreFoundation.CFRelease(dictKeyRef); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (dictValue.isNull()) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> osVersionValue = <span class="hljs-string"><span class="hljs-string">"Unknown"</span></span>; } osVersionValue = DarwinCoreFoundationUtils.fromCFStringRef(dictValue); CoreFoundation.CFRelease(dictValue); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> osVersionValue; }</code> </pre><br>  En d'autres termes, nous √©crivons en Java mot pour mot ce que nous √©cririons en C. <br><br>  <code>DarwinExecutableName</code> √† l' <code>DarwinExecutableName</code> : <br><br><pre> <code class="java hljs"> <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Object </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">apply</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Object[] args)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* Find out how long the executable path is. */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> CIntPointer sizePointer = StackValue.get(CIntPointer.class); sizePointer.write(<span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (DarwinDyld._NSGetExecutablePath(WordFactory.nullPointer(), sizePointer) != -<span class="hljs-number"><span class="hljs-number">1</span></span>) { VMError.shouldNotReachHere(<span class="hljs-string"><span class="hljs-string">"DarwinExecutableName.getExecutableName: Executable path length is 0?"</span></span>); } <span class="hljs-comment"><span class="hljs-comment">/* Allocate a correctly-sized buffer and ask again. */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] byteBuffer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[sizePointer.read()]; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> (PinnedObject pinnedBuffer = PinnedObject.create(byteBuffer)) { <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> CCharPointer bufferPointer = pinnedBuffer.addressOfArrayElement(<span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (DarwinDyld._NSGetExecutablePath(bufferPointer, sizePointer) == -<span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-comment"><span class="hljs-comment">/* Failure to find executable path. */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String executableString = CTypeConversion.toJavaString(bufferPointer); <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String result = realpath(executableString); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } }</code> </pre><br>  Tous ces <code>CIntPointer</code> , <code>CCharPointer</code> , <code>PinnedObject</code> , quoi. <br><br>  √Ä mon go√ªt, c'est inconfortable et moche.  Vous devez travailler manuellement avec des pointeurs qui ressemblent √† des classes Java.  Vous devez appeler la <code>release</code> appropri√©e √† temps pour que la m√©moire ne coule pas. <br><br>  Mais s'il vous semble que ce sont <em>des</em> mesures <em>injustifi√©es</em> , alors vous pouvez regarder √† nouveau l' <a href="">impl√©mentation de GC dans .NET</a> et √™tre horrifi√© de ce √† quoi m√®ne le C ++ si vous n'arr√™tez pas √† temps.  Je vous rappelle qu'il s'agit d'un √©norme fichier CPP plus grand qu'un m√©gaoctet.  Il existe <a href="">quelques descriptions de</a> son travail, mais elles sont clairement insuffisantes pour √™tre comprises par un contributeur externe.  Le code ci-dessus, bien qu'assez m√©chant, est tout √† fait compr√©hensible et analys√© au moyen d'une analyse statique pour Java. <br><br>  Quant √† l'essence du commit, j'ai des questions pour lui.  Et au moins le support de Windows n'y est pas impl√©ment√©.  Lorsqu'un codegen appara√Æt pour Windows, je vais essayer de me charger de cette t√¢che. <br><br><h2>  Conclusions </h2><br><ul><li>  Besoin d'√©crire en Java syst√®me.  Louange, appelle le pain sucr√©.  Il n'y a toujours pas d'options; </li><li>  Abonnez-vous aux notifications du r√©f√©rentiel sur GitHub et lisez les commits, sinon les PR importants passeront; </li><li>  Si possible, renseignez-vous sur toute caract√©ristique importante de ceux qui sont responsables de ce domaine.  Il y a beaucoup de choses qui sont mises en ≈ìuvre, mais elles ne sont pas encore connues du grand public.  Il y a une chance d'inventer un v√©lo, et bien pire que celui fabriqu√© par les gars d'Oracle Labs; </li><li>  Lorsque vous abordez une fonctionnalit√©, assurez-vous d'en informer le responsable du github.  S'il ne r√©pond pas - √©crivez une lettre, les adresses de tous les membres de l'√©quipe sont facilement googl√©. </li></ul><br><h1>  √âpilogue </h1><br>  Cette bataille se termine, mais pas la guerre du tout. <br><br>  Combattant, attendez avec sensibilit√© les nouveaux articles sur Habr√© et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">rentrez dans nos rangs</a> ! <br><br>  Je tiens √† vous rappeler qu'Oleg Shelaev, le seul √©vang√©liste <strong>officiel</strong> GraalVM d'Oracle, viendra √† la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">prochaine conf√©rence Joker</a> .  Pas seulement "le seul russophone", mais "le seul en g√©n√©ral".  Le titre du rapport ( <em><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">¬´Compilation Java √† l'avance avec GraalVM¬ª</a></em> ) indique que SubstrateVM ne peut pas s'en passer. <br><br>  Soit dit en passant, Oleg a r√©cemment re√ßu une arme de service - un compte rendu sur Habr√©, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">shelajev-oleg</a> .  Il n'y a pas encore de messages, mais vous pouvez lancer ce nom d'utilisateur. <br><br>  Vous pouvez parler avec Oleg et Oleg dans notre chat room-chat en Telegram: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">@graalvm_ru</a> .  Contrairement √† ishshuyev sur Github, vous pouvez y communiquer sous n'importe quelle forme, et personne ne sera interdit ( <em>mais ce n'est pas exact</em> ). <br><br>  Je vous rappelle √©galement que chaque semaine, avec le podcast Debriefing, nous faisons la sortie du Java Digest.  Par exemple, c'√©tait le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">dernier condens√©</a> .  De temps en temps, les informations sur GraalVM sautent l√†-bas (en fait, je ne transforme pas le probl√®me en un communiqu√© de presse GraalVM juste pour le respect du public :-) <br><br>  Merci d'avoir lu ceci - et √† bient√¥t! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr420455/">https://habr.com/ru/post/fr420455/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr420441/index.html">Les 10 erreurs de s√©curit√© les plus courantes en Python et comment les √©viter</a></li>
<li><a href="../fr420443/index.html">Des experts en cybers√©curit√© ont cr√©√© un d√©tecteur d'√©cumoire - SkimReaper</a></li>
<li><a href="../fr420447/index.html">Computer History Museum - l'endroit o√π l'informatique est enregistr√©e</a></li>
<li><a href="../fr420451/index.html">Serveur dans les nuages: se pr√©parer au lancement</a></li>
<li><a href="../fr420453/index.html">Webinaires Skillbox Friday: d√©veloppement et tout ce qui s'y rapporte</a></li>
<li><a href="../fr420457/index.html">Pr√©sentation du logiciel d'impression 3D Simplify3D</a></li>
<li><a href="../fr420459/index.html">Ic√¥ne avec un compteur dans la barre d'outils sup√©rieure: un exemple d'une vari√©t√© d'approches pour une t√¢che</a></li>
<li><a href="../fr420461/index.html">10 citations de mauvais designers</a></li>
<li><a href="../fr420463/index.html">ICO √† juste titre en d√©clin, mais ils ont une chance de changer</a></li>
<li><a href="../fr420465/index.html">Variables Nginx avec njs: simples, indolores et via JavaScript</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>