<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ง๐ฟ ๐๐ป โ๏ธ ุชุฌุงูุฒ ุชุฃููู ILV ูุน DNSTap ู BGP ๐ง๐ผโ๐คโ๐ง๐ป ๐ณ ๐</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ุงูููุถูุน ุฌููู ูู ุงูุตูุฑุฉ ุ ูุฃูุง ุฃุนูู. ุนูู ุณุจูู ุงููุซุงู ุ ููุงู ููุงู ููุชุงุฒ ุ ูููู ููุท ุฌุฒุก IP ูู ูุงุฆูุฉ ุงูุญุธุฑ ูุนุชุจุฑ ููุงู. ุณูุถูู ุฃูุถุง ุงููุฌุงูุงุช. 


 ูุธุฑูุง ูุญูู...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ุชุฌุงูุฒ ุชุฃููู ILV ูุน DNSTap ู BGP</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/467547/" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/zg/if/qq/zgifqqqqol7bai9dlh3_e-3cgn8.png"></p><br><p style=";text-align:right;direction:rtl">  ุงูููุถูุน ุฌููู ูู ุงูุตูุฑุฉ ุ ูุฃูุง ุฃุนูู.  ุนูู ุณุจูู ุงููุซุงู ุ ููุงู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุงู</a> ููุชุงุฒ ุ ูููู ููุท ุฌุฒุก IP ูู ูุงุฆูุฉ ุงูุญุธุฑ ูุนุชุจุฑ ููุงู.  ุณูุถูู ุฃูุถุง ุงููุฌุงูุงุช. </p><br><p style=";text-align:right;direction:rtl">  ูุธุฑูุง ูุญูููุฉ ุฃู ุงููุญุงูู ู ILV ุชุณุฏ ูู ุดูุก ุฅูู ุงููููู ูุงููุณุงุฑ ุ ููุญุงูู ููุฏูู ุงูุฎุฏูุงุช ุฌุงูุฏุฉ ุนุฏู ุงููููุน ูู ุงูุบุฑุงูุงุช ุงูุตุงุฏุฑุฉ ุนู "Revizorro" - ุงูุฎุณุงุฆุฑ ุงููุฑุชุจุทุฉ ุจุงูุฃููุงู ูุจูุฑุฉ ุฌุฏูุง.  ูุนู ุ ููู ุจูู ุงูููุงูุน "ุงููุญุธูุฑุฉ ูุงููููุง" ููุงู ุงูุนุฏูุฏ ูู ุงูููุงูุน ุงููููุฏุฉ (ูุฑุญุจูุง ุ rutracker) </p><br><p style=";text-align:right;direction:rtl"> ุฃุนูุด ุฎุงุฑุฌ ูุทุงู ุงุฎุชุตุงุต ILV ุ ููู ูุงูุฏู ูุฃูุงุฑุจู ูุฃุตุฏูุงุฆู ุธููุง ูู ุงูููุฒู.  ูุฐูู ุชูุฑุฑ ุงูุชูุตู ุฅูู ุทุฑููุฉ ูุชุฌุงูุฒ ุงูุฃููุงู ุงูุณููุฉ ููู ุจุนูุฏูู ุนู ุชูููููุฌูุง ุงููุนูููุงุช ุ ูููุถู ุฃู ูููู ุฐูู ุฏูู ูุดุงุฑูุชูู. </p><br><p style=";text-align:right;direction:rtl">  ูู ูุฐู ุงูููุงูุฉ ุ ูู ุฃุตู ุฃุดูุงุก ุงูุดุจูุฉ ุงูุฃุณุงุณูุฉ ูู ุฎุทูุงุช ุ ููููู ุฃุตู ุงููุจุงุฏุฆ ุงูุนุงูุฉ ูููููุฉ ุชูููุฐ ูุฐุง ุงููุฎุทุท.  ูุฐุง ูุฅู ูุนุฑูุฉ ููููุฉ ุนูู ุงูุดุจูุฉ ุจุดูู ุนุงู ููู ูุธุงู Linux ุจุดูู ุฎุงุต ุฃูุฑ ูุง ุจุฏ ููู. </p><a name="habracut"></a><br><h1 id="tipy-blokirovok" style=";text-align:right;direction:rtl">  ุฃููุงุน ุงูุฃููุงู </h1><br><p style=";text-align:right;direction:rtl">  ุฃููุงู ุ ุฏุนููุง ูุฌุฏุฏ ูุง ุชู ุญุธุฑู. </p><br><p style=";text-align:right;direction:rtl">  ููุงู ุนุฏุฉ ุฃููุงุน ูู ุงูุฃููุงู ูู XML ุงูููุณู ุฅูู ุตูุญุงุช ูู ILV: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  IP </li><li style=";text-align:right;direction:rtl">  ูุทุงู </li><li style=";text-align:right;direction:rtl">  URL </li></ul><br><p style=";text-align:right;direction:rtl">  ููุจุณุงุทุฉ ุ ุณูููู ุจุชูููููุง ุฅูู ูุณููู: IP ูุงููุฌุงู ุ ูุณูููู ุจุจุณุงุทุฉ ุจุณุญุจ ุงููุฌุงู ูู ุญุธุฑ ุนูุงููู URL (ุจุดูู ุฃูุซุฑ ุฏูุฉ ุ ููุฏ ูููุง ุจุฐูู ุจุงููุนู). </p><br><p style=";text-align:right;direction:rtl">  ููุฏ ูุงู ุฃูู ุงูุฎูุฑ ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Roskomsvoboda</a> ุจุชูููุฐ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุงุฌูุฉ ุจุฑูุฌุฉ ุชุทุจููุงุช</a> ุฑุงุฆุนุฉ ูููููุง ูู ุฎูุงููุง ุงูุญุตูู ุนูู ูุง ูุญุชุงุฌ ุฅููู: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  IP: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">https://api.reserve-rbl.ru/api/v2/ips/json</a> </li><li style=";text-align:right;direction:rtl">  ุงููุฌุงูุงุช: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">https://api.reserve-rbl.ru/api/v2/domains/json</a> </li></ul><br><h1 id="dostup-k-zablokirovannym-saytam" style=";text-align:right;direction:rtl">  ุงููุตูู ุฅูู ุงูููุงูุน ุงููุญุฌูุจุฉ </h1><br><p style=";text-align:right;direction:rtl">  ููููุงู ุจุฐูู ุ ูุญู ุจุญุงุฌุฉ ุฅูู ุจุนุถ VPS ุงูุฃุฌูุจูุฉ ุงูุตุบูุฑุฉ ุ ูููุถู ุฃู ูููู ุฐูู ูุน ุญุฑูุฉ ูุฑูุฑ ุบูุฑ ูุญุฏูุฏุฉ - ููุงู ุงูุนุฏูุฏ ูู 3-5 ุฏููุงุฑุงุช.  ุชุญุชุงุฌ ุฅูู ุฃุฎุฐูุง ูู ุงูุฎุงุฑุฌ ุงููุฑูุจ ุญุชู ูุง ูููู ุญุฌู ping ูุจูุฑูุง ุฌุฏูุง ุ ููู ูุฌุจ ูุฑุงุนุงุฉ ุฃู ุงูุฅูุชุฑูุช ูุงูุฌุบุฑุงููุง ูุง ูุชุทุงุจูุงู ุฏุงุฆููุง.  ูุจูุง ุฃูู ูุง ููุฌุฏ ุฌูุด ุชุญุฑูุฑ ุงูุณูุฏุงู ููุฏุฉ 5 ุฏููุงุฑุงุช ุ ููู ุงูุฃูุถู ุฃู ุชุฃุฎุฐ ูุทุนุชูู + ูู ูุฒูุฏู ุฎุฏูุงุช ูุฎุชูููู ูุชุญูู ุงูุฃุฎุทุงุก. </p><br><p style=";text-align:right;direction:rtl">  ุจุนุฏ ุฐูู ุ ูุญุชุงุฌ ุฅูู ุชูููู ุงูููู ุงููุดูุฑ ูู ุฌูุงุฒ ุชูุฌูู ุงูุนููู ุฅูู VPS.  ูููููู ุงุณุชุฎุฏุงู Wireguard ูุฃุณุฑุน ูุฃุณูู ูุชูููู ููุฐ ุฐูู ุงูุญูู  ูุฏู ุฃูุถูุง ุฃุฌูุฒุฉ ุชูุฌูู ุนููู ุชุณุชูุฏ ุฅูู Linux ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">APU2</a> ุฃู ุดูุก ูุง ุนูู OpenWRT).  ูู ุญุงูุฉ ุจุนุถ Mikrotik / Cisco ุ ููููู ุงุณุชุฎุฏุงู ุงูุจุฑูุชููููุงุช ุงููุชุงุญุฉ ุนูููุง ูุซู OpenVPN ู GRE-over-IPSEC. </p><br><h1 id="identifikaciya-i-perenapravlenie-interesuyuschego-traffika" style=";text-align:right;direction:rtl">  ุชุญุฏูุฏ ูุฅุนุงุฏุฉ ุชูุฌูู ุญุฑูุฉ ุงูุงูุชูุงู </h1><br><p style=";text-align:right;direction:rtl">  ููููู ุ ุจุงูุทุจุน ุ ุงุฎุชุชุงู ูู ุญุฑูุฉ ุงููุฑูุฑ ุนูู ุงูุฅูุชุฑูุช ุนุจุฑ ุงูุฎุงุฑุฌ.  ูููู ุ ุนูู ุงูุฃุฑุฌุญ ุ ุณุชุนุงูู ุณุฑุนุฉ ุงูุนูู ูุน ุงููุญุชูู ุงููุญูู ุจุดูู ูุจูุฑ ูู ูุฐุง.  ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ุณุชููู ูุชุทูุจุงุช ุงููุทุงู ุงูุชุฑุฏุฏู ุนูู VPS ุฃุนูู ุจูุซูุฑ. </p><br><p style=";text-align:right;direction:rtl">  ูุฐูู ุ ุณูุญุชุงุฌ ุฅูู ุชุฎุตูุต ุญุฑูุฉ ูุฑูุฑ ุจุทุฑููุฉ ูุง ููููุงูุน ุงููุญุธูุฑุฉ ูุฅุฑุณุงููุง ุจุดูู ุงูุชูุงุฆู ุฅูู ุงูููู.  ุญุชู ุฅุฐุง ูุงู ููุงู ุฌุฒุก ูู ุญุฑูุฉ ุงููุฑูุฑ "ุงูุฅุถุงููุฉ" ุ ูุฅูู ูุง ูุฒุงู ุฃูุถู ุจูุซูุฑ ูู ููุงุฏุฉ ูู ุดูุก ุนุจุฑ ููู. </p><br><p style=";text-align:right;direction:rtl">  ูุฅุฏุงุฑุฉ ุญุฑูุฉ ุงููุฑูุฑ ุ ุณูู ูุณุชุฎุฏู ุจุฑูุชูููู BGP ููุนูู ุนู ุงูุทุฑู ุงููุคุฏูุฉ ุฅูู ุงูุดุจูุงุช ุงูุถุฑูุฑูุฉ ูู VPS ุฅูู ุงูุนููุงุก.  ุจุตูุชู ุฎูููุง ูู BGP ุ ุฏุนูุง ูุฃุฎุฐ BIRD ุ ููุงุญุฏ ูู ุฃูุซุฑ ุงููุธุงุฆู ุนูููุฉ ูููุงุกูุฉ. </p><br><h3 id="ip" style=";text-align:right;direction:rtl">  IP </h3><br><p style=";text-align:right;direction:rtl">  ูุน ุญุธุฑ IP ุ ูู ุดูุก ูุงุถุญ: ูุนูู ููุท ุนู ุฌููุน ุนูุงููู IP ุงููุญุธูุฑุฉ ุจุงุณุชุฎุฏุงู VPS.  ุงููุดููุฉ ูู ุฃู ููุงู ุญูุงูู 600 ุฃูู ุดุจูุฉ ูุฑุนูุฉ ูู ุงููุงุฆูุฉ ุงูุชู ุชุนุทููุง API ุ ูุงูุบุงูุจูุฉ ุงูุนุธูู ูููุง / 32 ูุถูููุง.  ูุฏ ูููู ูุฐุง ุงูุนุฏุฏ ูู ุงูุทุฑู ูุฑุจููุง ูุฃุฌูุฒุฉ ุงูุชูุฌูู ุงูุนูููุฉ ุงูุถุนููุฉ. </p><br><p style=";text-align:right;direction:rtl">  ูุฐูู ุ ุชูุฑุฑ ุชูุฎูุต ุงูุดุจูุฉ / 24 ุนูุฏ ูุนุงูุฌุฉ ุงููุงุฆูุฉ ุฅุฐุง ูุงู ููุงู ูุถููุงู ุฃู ุฃูุซุฑ.  ูุจุงูุชุงูู ุ ุชู ุชุฎููุถ ุนุฏุฏ ุงูุทุฑู ุฅูู ~ 100 ุฃูู.  ุงูุจุฑูุงูุฌ ุงููุตู ููุฐุง ุณูููู ุงูุชุงูู. </p><br><h3 id="domeny" style=";text-align:right;direction:rtl">  ุงููุฌุงูุงุช </h3><br><p style=";text-align:right;direction:rtl">  ุงูุฃูุฑ ุฃูุซุฑ ุชุนููุฏูุง ูููุงู ุนุฏุฉ ุทุฑู.  ุนูู ุณุจูู ุงููุซุงู ุ ููููู ูุถุน Squid ุดูุงู ุนูู ูู ุฌูุงุฒ ุชูุฌูู ุนููู ูุงูููุงู ุจุงุนุชุฑุงุถ HTTP ูุงูุชุตูุญ ูู ูุตุงูุญุฉ TLS ูู ุฃุฌู ุงูุญุตูู ุนูู ุนููุงู URL ุงููุทููุจ ูู ุงูุญุงูุฉ ุงูุฃููู ูุงููุฌุงู ูู SNI ูู ุงูุซุงููุฉ. </p><br><p style=";text-align:right;direction:rtl">  ูููู ูุธุฑูุง ูุฌููุน ุชูููุงุช TLS1.3 + eSNI ุงูุฌุฏูุฏุฉ ุ ุฃุตุจุญ ุชุญููู HTTPS ุฃูู ูุงูุนูุฉ ูู ููู.  ูุฃุตุจุญุช ุงูุจููุฉ ุงูุชุญุชูุฉ ูู ุฌุงูุจ ุงูุนููู ุฃูุซุฑ ุชุนููุฏูุง - ุณูุชุนูู ุนููู ุงุณุชุฎุฏุงู OpenWRT ุนูู ุงูุฃูู. </p><br><p style=";text-align:right;direction:rtl">  ูุฐูู ุ ูุฑุฑุช ุฃู ุชุฃุฎุฐ ูุณุงุฑ ุงุนุชุฑุงุถ ุงูุฑุฏูุฏ ุนูู ุงุณุชูุณุงุฑุงุช DNS.  ููุง ุฃูุถูุง ุ ูุจุฏุฃ ุฃู DNS-over-TLS / HTTPS ูู ุงูุงุฑุชูุงุน ููู ุฑุคูุณูุง ุ ููู ูููููุง (ูู ุงูููุช ุงูุญุงูู) ุงูุชุญูู ูู ูุฐุง ุงูุฌุฒุก ุนูู ุงูุนููู - ุฅูุง ุชุนุทููู ุฃู ุงุณุชุฎุฏุงู ุฎุงุฏููุง ุงูุฎุงุต ุจู DoT / DoH. </p><br><h4 id="kak-perehvatyvat-dns" style=";text-align:right;direction:rtl">  ููููุฉ ุงุนุชุฑุงุถ DNSุ </h4><br><p style=";text-align:right;direction:rtl">  ูุฏ ูููู ููุงู ุฃูุถุง ุงูุนุฏูุฏ ูู ุงูููุฌ. </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุงุนุชุฑุงุถ ุญุฑูุฉ ูุฑูุฑ DNS ูู ุฎูุงู PCAP ุฃู NFLOG <br>  ูุชู ุชุทุจูู ูู ูู ุฃุณุงููุจ ุงูุงุนุชุฑุงุถ ูุฐู ูู ุงูุฃุฏุงุฉ ุงููุณุงุนุฏุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">sidmat</a> .  ูููู ูู ูุชู ุฏุนููุง ููุชุฑุฉ ุทูููุฉ ููุงูุช ุงููุธููุฉ ุจุฏุงุฆูุฉ ููุบุงูุฉ ุ ูุฐูู ุชุญุชุงุฌ ุฅูู ูุชุงุจุฉ ุฑุงุจุท ุฅูููุง ุนูู ุฃู ุญุงู. </li><li style=";text-align:right;direction:rtl">  ุชุญููู ุณุฌู ุฎุงุฏู DNS <br>  ูุณูุก ุงูุญุธ ุ ูุง ุชุนุฑู ุงููุตุงุฏุฑ ุงูุชู ุฃุนุฑููุง ููููุฉ ุชุณุฌูู ุงูุฅุฌุงุจุงุช ุ ูููู ุงูุทูุจุงุช ููุท.  ูู ุญูุซ ุงููุจุฏุฃ ุ ูุฐุง ููุทูู ุ ูุฃูู ุนูู ุนูุณ ุงูุทูุจุงุช ุ ูุฅู ุงูุฅุฌุงุจุงุช ููุง ุจููุฉ ูุนูุฏุฉ ููู ุงูุตุนุจ ูุชุงุจุชูุง ูู ุดูู ูุตู. </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">DNSTap</a> <br>  ูุญุณู ุงูุญุธ ุ ุงูุนุฏูุฏ ูููู ูุฏุนููู ุจุงููุนู DNSTap ููุฐู ุงูุฃุบุฑุงุถ. </li></ul><br><h4 id="chto-takoe-dnstap" style=";text-align:right;direction:rtl">  ูุง ูู DNSTapุ </h4><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/gc/4g/qs/gc4gqsppif5ypkbf06ok0oihll4.png"></p><br><p style=";text-align:right;direction:rtl">  ูุฐุง ุจุฑูุชูููู ุฎุงุฏู ุนููู ูุณุชูุฏ ุฅูู "ูุฎุงุฒู ุจุฑูุชูููู" ู "ุชุฏููุงุช ุฅุทุงุฑ" ููููู ูู ุฎุงุฏู DNS ุฅูู ูุฌููุนุฉ ูู ุงุณุชุนูุงูุงุช DNS ุงูููุธูุฉ ูุงุณุชุฌุงุจุงุชูุง.  ูู ุงููุงูุน ุ ูููู ุฎุงุฏู DNS ุงูุจูุงูุงุช ุงููุตููุฉ ููุทูุจุงุช ูุงูุงุณุชุฌุงุจุงุช (ููุน ุงูุฑุณุงูุฉ ุ ุนููุงู IP ููุนููู / ุงูุฎุงุฏู ุ ููุง ุฅูู ุฐูู) ุจุงูุฅุถุงูุฉ ุฅูู ุฑุณุงุฆู DNS ุงููุงููุฉ ูู ุงููููุฐุฌ (ุงูุซูุงุฆู) ุงูุฐู ูุนูู ุจู ูุนูู ุนุจุฑ ุงูุดุจูุฉ. </p><br><p style=";text-align:right;direction:rtl">  ูู ุงูููู ุฃู ูููู ุฃูู ูู ูููุฐุฌ DNSTap ุ ูุนูู ุฎุงุฏู DNS ูุนููู ุ ูุงููุฌูุน ูุฎุงุฏู.  ุฃู ุฃู ุฎุงุฏู DNS ูุชุตู ุจุงูุฌุงูุน ุ ูููุณ ุงูุนูุณ. </p><br><p style=";text-align:right;direction:rtl">  ูุชู ุฏุนู DNSTap ุงูููู ูู ุฌููุน ุฎูุงุฏู DNS ุงูุดุงุฆุนุฉ.  ูููู ุ ุนูู ุณุจูู ุงููุซุงู ุ ูุชู ุฅูุดุงุก BIND ูู ุงูุนุฏูุฏ ูู ุงูุชูุฒูุนุงุช (ูุซู Ubuntu LTS) ุบุงูุจูุง ูุณุจุจ ูุง ุฏูู ุฏุนููุง.  ูุฐูู ูู ูุฒุนุฌ ุนูููุฉ ุฅุนุงุฏุฉ ุงูุฅุนูุงุฑ ุ ููููุง ูุฃุฎุฐ ุฏูุฑ ุงูุนุฏุงุฏ ุฃุฎู ูุฃุณุฑุน - ุบูุฑ ูุญุฏูุฏ. </p><br><h4 id="chem-lovit-dnstap" style=";text-align:right;direction:rtl">  ููููุฉ ุงูุชูุงุท DNSTapุ </h4><br><p style=";text-align:right;direction:rtl">  ููุงู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุนุฏุฏ ูู</a> ุงูุฃุฏูุงุช ุงููุณุงุนุฏุฉ CLI ููุนูู ูุน ุฏูู ูู ุฃุญุฏุงุซ DNSTap ุ ููููุง ูุง ุชุนูู ุจุดูู ุฌูุฏ ููููุชูุง.  ูุฐูู ูุฑุฑุช ุฃู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><strong>ุฃุฎุชุฑุน</strong></a> ุฏุฑุงุฌุชู ุงูุฎุงุตุฉ ุงูุชู ุณุชูุนู ูู ูุง ูุชุทูุจู ุงูุฃูุฑ: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><strong>dnstap-bgp</strong></a> </p><br><p style=";text-align:right;direction:rtl">  ุฎูุงุฑุฒููุฉ ุงูุชุดุบูู: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุนูุฏ ุฅุทูุงูู ุ ูููู ุจุชุญููู ูุงุฆูุฉ ุจุงููุทุงูุงุช ูู ููู ูุตู ุ ููุญูููุง (habr.com -&gt; com.habr) ุ ููุณุชุจุนุฏ ุงูุฎุทูุท ุงูููุฑุฑุฉ ูุงูุชูุฑุงุฑุงุช ูุงููุทุงูุงุช ุงููุฑุนูุฉ (ุฃู ุฅุฐุง ูุงู habr.com ู www.habr.com ูู ุงููุงุฆูุฉ - ุณูุชู ุชุญูููู ููุท ุฃูู ูุงุญุฏ) ููุจูู ุดุฌุฑุฉ ุจุงุฏุฆุฉ ููุจุญุซ ุงูุณุฑูุน ูู ูุฐู ุงููุงุฆูุฉ </li><li style=";text-align:right;direction:rtl">  ูุฎุงุฏู DNSTap ุ ูุฅูู ููุชุธุฑ ุงุชุตุงู ูู ุฎุงุฏู DNS.  ูู ุญูุซ ุงููุจุฏุฃ ุ ูุฏุนู ููุง ูู ูุขุฎุฐ UNIX ู TCP ุ ููู ุฎูุงุฏู DNS ุงูุชู ุฃุนุฑููุง ูุง ูููููุง ุงุณุชุฎุฏุงู ูุขุฎุฐ UNIX </li><li style=";text-align:right;direction:rtl">  ูุชู ุฅูุบุงุก ุชุณูุณู ุญุฒู DNSTap ุงููุงุฑุฏุฉ ุฃููุงู ุฅูู ุจููุฉ Protobuf ุ ุซู ูุชู ุชุญููู ุฑุณุงูุฉ DNS ุงูุซูุงุฆูุฉ ุงูููุฌูุฏุฉ ูู ุฃุญุฏ ุญููู Protobuf ุฅูู ูุณุชูู ุณุฌูุงุช RR RR </li><li style=";text-align:right;direction:rtl">  ูุชู ุงูุชุญูู ููุง ุฅุฐุง ูุงู ุงููุถูู ุงููุทููุจ (ุฃู ุงููุฌุงู ุงูุฃุตูู ูู) ูู ุงููุงุฆูุฉ ุงููุญููุฉ ุ ูุฅุฐุง ูู ููู ุงูุฃูุฑ ูุฐูู ุ ูุณูุชู ุชุฌุงูู ุงูุงุณุชุฌุงุจุฉ </li><li style=";text-align:right;direction:rtl">  ูุชู ุชุญุฏูุฏ ููุท A / AAAA / CNAME RR ูู ุงูุงุณุชุฌุงุจุฉ ููุชู ุณุญุจ ุนูุงููู IPv4 / IPv6 ุงูููุงุจูุฉ ูููุง </li><li style=";text-align:right;direction:rtl">  ูุชู ุชุฎุฒูู ุนูุงููู IP ูุคูุชูุง ูุน TTLs ุงููุฎุตุตุฉ ููุชู ุงูุฅุนูุงู ุนููุง ูุฌููุน ุฃูุฑุงู BGP </li><li style=";text-align:right;direction:rtl">  ุนูุฏ ุงุณุชูุงู ุฑุฏ ูุดูุฑ ุฅูู ูุฌูุฏ IP ูุฎุฒูุฉ ูุคูุชูุง ุจุงููุนู - ูุชู ุชุญุฏูุซ TTL ุงูุฎุงุต ุจู </li><li style=";text-align:right;direction:rtl">  ุจุนุฏ ุงูุชูุงุก ุตูุงุญูุฉ TTL ุ ูุชู ุญุฐู ุงูุณุฌู ูู ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ูุฅุนูุงูุงุช BGP </li></ul><br><p style=";text-align:right;direction:rtl">  ูุธุงุฆู ุฅุถุงููุฉ: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุฅุนุงุฏุฉ ูุฑุงุกุฉ ูุงุฆูุฉ ุงููุฌุงู ุจูุงุณุทุฉ SIGHUP </li><li style=";text-align:right;direction:rtl">  ูุฒุงููุฉ ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ูุน <strong>ูุซููุงุช dnstap-bgp</strong> ุงูุฃุฎุฑู ุนุจุฑ HTTP / JSON </li><li style=";text-align:right;direction:rtl">  ุชูุฑุงุฑ ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ุนูู ุงููุฑุต (ูู ูุงุนุฏุฉ ุจูุงูุงุช BoltDB) ูุงุณุชุนุงุฏุฉ ูุญุชููุงุชู ุจุนุฏ ุฅุนุงุฏุฉ ุงูุชุดุบูู </li><li style=";text-align:right;direction:rtl">  ุฏุนู ููุชุจุฏูู ุฅูู ูุณุงุญุฉ ุงุณู ุดุจูุฉ ูุฎุชููุฉ (ููุงุฐุง ุณูุชู ูุตู ุฐูู ุฃุฏูุงู) </li><li style=";text-align:right;direction:rtl">  ุฏุนู IPv6 </li></ul><br><p style=";text-align:right;direction:rtl">  ุงููููุฏ: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูุทุงูุงุช IDN ุบูุฑ ูุฏุนููุฉ ุญุชู ุงูุขู </li><li style=";text-align:right;direction:rtl">  ุจุนุถ ุฅุนุฏุงุฏุงุช BGP </li></ul><br><p style=";text-align:right;direction:rtl">  ููุช ุจุชุฌููุน ุญุฒู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">RPM ู DEB</a> ูุณูููุฉ ุงูุชุซุจูุช.  ูุฌุจ ุฃู ุชุนูู ุนูู ุฌููุน ุฃูุธูุฉ ุงูุชุดุบูู ุงูุญุฏูุซุฉ ูุณุจูุง ูุน SYSTEMD ุ ููุง  ููุณ ูุฏููู ุชุจุนูุงุช. </p><br><h1 id="shema" style=";text-align:right;direction:rtl">  ูุฎุทุท </h1><br><p style=";text-align:right;direction:rtl">  ูุฐูู ุ ุฏุนููุง ูุจุฏุฃ ุชุฌููุน ุฌููุน ุงูููููุงุช ูุนุง.  ูุชูุฌุฉู ูุฐูู ุ ูุฌุจ ุฃู ูุญุตู ุนูู ุดูุก ูุซู ุทุจูููุฌูุง ุงูุดุจูุฉ: <br><img src="https://habrastorage.org/webt/cm/ks/uo/cmksuol_njfgyjznmlf3oj6u94m.png"></p><br><p style=";text-align:right;direction:rtl">  ุฃุนุชูุฏ ุฃู ููุทู ุงูุนูู ูุงุถุญ ูู ุงููุฎุทุท: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูุงู ุงูุนููู ุจุชูููู ุฎุงุฏููุง ุนูู ุฃูู DNS ุ ููุฌุจ ุฃู ุชุฐูุจ ุงุณุชูุณุงุฑุงุช DNS ุฃูุถูุง ุนุจุฑ VPN.  ูุฐุง ุถุฑูุฑู ุญุชู ูุง ูุชููู ุงููููุฑ ูู ุงุณุชุฎุฏุงู ุงุนุชุฑุงุถ DNS ูุญุธุฑู. </li><li style=";text-align:right;direction:rtl">  ุนูุฏูุง ูุชู ูุชุญ ุงููููุน ุ ูุฑุณู ุงูุนููู ุงุณุชุนูุงู DNS ูููููุฐุฌ "ูุง ูู ุนูุงููู IP ุงูููุฌูุฏุฉ ูู xxx.orgุ" </li><li style=";text-align:right;direction:rtl">  <strong>ูููู Unbound</strong> ุจุญู xxx.org (ุฃู ูุฃุฎุฐูุง ูู ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช) ููุฑุณู ุงุณุชุฌุงุจุฉ ุฅูู ุงูุนููู "xxx.org ูุฏูู ูุซู ูุฐู IPs ููุง ุดุงุจู ุฐูู" ุ ูุน ุชูุฑุงุฑูุง ุจุงูุชูุงุฒู ูู ุฎูุงู DNSTap </li><li style=";text-align:right;direction:rtl">  <strong>ุชุนูู dnstap-bgp</strong> ูุฐู ุงูุนูุงููู ูู <strong>BIRD</strong> ุจูุงุณุทุฉ BGP ุฅุฐุง ูุงู ุงููุฌุงู ูู ูุงุฆูุฉ ุงููุญุธูุฑุฉ </li><li style=";text-align:right;direction:rtl"> ุชุนูู ุดุฑูุฉ <strong>BIRD</strong> ุนู <strong>ุชูุฌูููุง</strong> ุฅูู ุนูุงููู IP ูุฐู ูู <code>next-hop self</code> ุฌูุงุฒ ุงูุชูุฌูู <code>next-hop self</code> ุงูุชูุฌูู ุงูุนููู </li><li style=";text-align:right;direction:rtl">  ุชูุฑ ุงูุญุฒู ุงููุงุญูุฉ ูู ุงูุนููู ุฅูู ุนูุงููู IP ูุฐู ุนุจุฑ ุงูููู </li></ul><br><p style=";text-align:right;direction:rtl">  ุนูู ุงูุฎุงุฏู ุ ุจุงููุณุจุฉ ููุทุฑู ุฅูู ุงูููุงูุน ุงููุญุฌูุจุฉ ุ ูุฏู ุฌุฏูู ูููุตู ุฏุงุฎู BIRD ููุง ูุชูุงุทุน ูุน ูุธุงู ุงูุชุดุบูู. </p><br><p style=";text-align:right;direction:rtl">  ููุงู ุนูุจ ูู ูุฐุง ุงููุฎุทุท: ูู ุงููุฑุฌุญ ุฃู ุชุชุงุญ ูุฃูู ุญุฒูุฉ SYN ูู ุงูุนููู ุงูููุช ููุบุงุฏุฑุฉ ุงููุฒูุฏ ุงููุญูู ููุฐ  ูู ูุชู ุงูุฅุนูุงู ุนู ุงูุทุฑูู ุนูู ุงูููุฑ.  ูููุง ุชููู ุงูุฎูุงุฑุงุช ููููุฉ ุงุนุชูุงุฏูุง ุนูู ููููุฉ ููุงู ุงููุฒูุฏ ุจุนูู ุงูููู.  ุฅุฐุง ูุงู ูุณูุท ุญุฑูุฉ ุงููุฑูุฑ ููุท ุ ููุง ุชูุฌุฏ ูุดุงูู.  ูุฅุฐุง ูุงู ูุนูุฏ ุชูุฌููู ุฅูู ุจุนุถ DPI ุ ููู ุงููููู (ูุธุฑูุง) ุงููุคุซุฑุงุช ุงูุฎุงุตุฉ. </p><br><p style=";text-align:right;direction:rtl">  ุงููุนุฌุฒุงุช ููููุฉ ุฃูุถูุง ูุน ุงูุนููุงุก ุงูุฐูู ูุง ูุชุงุจุนูู DNS TTL ุ ููุง ูุฏ ูุคุฏู ุฅูู ุงุณุชุฎุฏุงู ุงูุนููู ุจุนุถ ุงูุฅุฏุฎุงูุงุช ุงููุฏููุฉ ูู ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ุงููุงุณุฏุฉ ุจุฏูุงู ูู ุทูุจ Unbound. </p><br><p style=";text-align:right;direction:rtl">  ูู ุงูููุงุฑุณุฉ ุงูุนูููุฉ ุ ูู ุชุณุจุจ ูู ุงููุดุงูู ุงูุฃููู ุฃู ุงูุซุงููุฉ ุ ูููู ูุฏ ุชุฎุชูู ุงููุณุงูุฉ ุงูููุทูุนุฉ. </p><br><h2 id="nastroyka-servera" style=";text-align:right;direction:rtl">  ุฅุนุฏุงุฏ ุงูุฎุงุฏู </h2><br><p style=";text-align:right;direction:rtl">  ูุณูููุฉ ุงููุชุฏุงูู ุ ูุชุจุช <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุฏูุฑูุง ูู Ansible</a> .  ููููู ุชูููู ูู ูู ุงูุฎูุงุฏู ูุงูุนููุงุก ุงููุนุชูุฏูู ุนูู Linux (ูุตูู ููุชูุฒูุนุงุช ุงููุณุชูุฏุฉ ุฅูู deb).  ุฌููุน ุงูุฅุนุฏุงุฏุงุช ูุงุถุญุฉ ุชูุงููุง ููุชู ุถุจุทูุง ูู <em>ุงูุฌุฑุฏ</em> .  ุชู ูุทุน ูุฐุง ุงูุฏูุฑ ุนู ูุชุงุจ ุงููุนุจ ุงููุจูุฑ ุงูุฎุงุต ุจู ุ ูุฐุง ููุฏ ูุญุชูู ุนูู ุฃุฎุทุงุก - ูุฑุญุจ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุจุทูุจุงุช ุงูุณุญุจ</a> :) </p><br><p style=";text-align:right;direction:rtl">  ุฏุนูุง ูุฐูุจ ูู ุฎูุงู ุงูููููุงุช ุงูุฑุฆูุณูุฉ. </p><br><h3 id="bgp" style=";text-align:right;direction:rtl">  BGP </h3><br><p style=";text-align:right;direction:rtl">  ุนูุฏ ุจุฏุก ุชุดุบูู ุดูุงุทูู BGP ุนูู ููุณ ุงููุถูู ุ ุชูุดุฃ ูุดููุฉ ุฃุณุงุณูุฉ: BIRD ูุง ูุฑูุฏ ุฑูุน ูุธูุฑ BGP ูุน ูุถูู ูุญูู (ุฃู ูุน ุฃู ูุงุฌูุฉ ูุญููุฉ).  ูู ุงููููุฉ ุนูู ุงูุฅุทูุงู.  ูู ูุณุงุนุฏ ุบูุบู ููุฑุงุกุฉ ุงูููุงุฆู ุงูุจุฑูุฏูุฉ ุ ูุฏุนูู ุฃูู ุญุณุจ ุงูุชุตููู.  ุฑุจูุง ููุงู ุทุฑููุฉ ูุง ุ ููููู ูู ุฃุฌุฏูุง. </p><br><p style=";text-align:right;direction:rtl">  ููููู ุชุฌุฑุจุฉ ุจุฑูุงูุฌ ุขุฎุฑ ูู BGP ุ ูููู ุฃุญุจ BIRD ููุชู ุงุณุชุฎุฏุงูู ูู ูู ููุงู ูุนู ุ ูุง ุฃุฑูุฏ ุฅูุชุงุฌ ููุงูุงุช. </p><br><p style=";text-align:right;direction:rtl">  ูุฐูู ุ ุงุฎุชุจุฃุช dnstap-bgp ุฏุงุฎู ูุณุงุญุฉ ุงุณู ุงูุดุจูุฉ ุ ุงูุชู ุชุชุตู ุจุงูุฌุฐุฑ ุนุจุฑ ูุงุฌูุฉ veth: ุฅููุง ุชุดุจู ุงูุฃูุงุจูุจ ุงูุชู ุชูุชูู ููุงูุงุชูุง ูู ูุณุงุญุฉ ุงุณู ูุฎุชููุฉ.  ุนูู ูู ูู ูุฐู ุงูุบุงูุงุช ุ ูููู ุจุชุนููู ุนูุงููู IP p2p ุงูุฎุงุตุฉ ุงูุชู ูุง ุชุฐูุจ ุฎุงุฑุฌ ุงููุถูู ุ ุจุญูุซ ูููู ุฃู ุชููู ููุฌูุฏุฉ.  ูุฐู ูู ููุณ ุงูุขููุฉ ุงูุชู ูุชู ุงุณุชุฎุฏุงููุง ูููุตูู ุฅูู ุงูุนูููุงุช ุฏุงุฎู ุญูุถ ุงูุณูู <em>ุงููุญุจูุจ</em> ูุงูุญุงููุงุช ุงูุฃุฎุฑู. </p><br><p style=";text-align:right;direction:rtl">  ููุฐุง ุงูุบุฑุถ ุ ุชูุช ูุชุงุจุฉ <a href="">ุงูุจุฑูุงูุฌ ุงููุตู</a> ููู dnstap-bgp ุชูุช ุฅุถุงูุฉ ุงููุธููุฉ ุงูููุถุญุฉ ุฃุนูุงู ูุณุญุจ ููุณู ูู ุงูุดุนุฑ ุฅูู ูุณุงุญุฉ ุงุณู ุฃุฎุฑู.  ููุฐุง ุงูุณุจุจ ุ ูุฌุจ ุชุดุบููู ูุฌุฐุฑ ุฃู ุฅุฑุฌุงุนู ุฅูู ููู CAP_SYS_ADMIN ุงูุซูุงุฆู ุนุจุฑ ุฃูุฑ setcap. </p><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ูุซุงู ุงูุจุฑูุงูุฌ ุงููุตู ูุฅูุดุงุก ูุณุงุญุฉ ุงูุงุณู</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash NS="dtap" IP="/sbin/ip" IPNS="$IP netns exec $NS $IP" IF_R="veth-$NS-r" IF_NS="veth-$NS-ns" IP_R="192.168.149.1" IP_NS="192.168.149.2" /bin/systemctl stop dnstap-bgp || true $IP netns del $NS &gt; /dev/null 2&gt;&amp;1 $IP netns add $NS $IP link add $IF_R type veth peer name $IF_NS $IP link set $IF_NS netns $NS $IP addr add $IP_R remote $IP_NS dev $IF_R $IP link set $IF_R up $IPNS addr add $IP_NS remote $IP_R dev $IF_NS $IPNS link set $IF_NS up /bin/systemctl start dnstap-bgp</span></span></code> </pre> </div></div><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">dnstap-bgp.conf</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">namespace = "dtap" domains = "/var/cache/rkn_domains.txt" ttl = "168h" [dnstap] listen = "/tmp/dnstap.sock" perm = "0666" [bgp] as = 65000 routerid = "192.168.149.2" peers = [ "192.168.149.1", ]</code> </pre> </div></div><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">bird.conf</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">router id 192.168.1.1; table rkn; # Clients protocol bgp bgp_client1 { table rkn; local as 65000; neighbor 192.168.1.2 as 65000; direct; bfd on; next hop self; graceful restart; graceful restart time 60; export all; import none; } # DNSTap-BGP protocol bgp bgp_dnstap { table rkn; local as 65000; neighbor 192.168.149.2 as 65000; direct; passive on; rr client; import all; export none; } # Static routes list protocol static static_rkn { table rkn; include "rkn_routes.list"; import all; export none; }</code> </pre> </div></div><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">rkn_routes.list</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">route 3.226.79.85/32 via "ens3"; route 18.236.189.0/24 via "ens3"; route 3.224.21.0/24 via "ens3"; ...</code> </pre> </div></div><br><h3 id="dns" style=";text-align:right;direction:rtl">  DNS </h3><br><p style=";text-align:right;direction:rtl">  ุจุดูู ุงูุชุฑุงุถู ุ ูู Ubuntu ุ ูุชู ุชุซุจูุช ุงูุซูุงุฆู ุบูุฑ ุงูููุถู ุจูุงุณุทุฉ ููู ุชุนุฑูู AppArmor ุ ููุง ูููุนู ูู ุงูุงุชุตุงู ุจุฃู ูุขุฎุฐ DNSTap ููุงู.  ููููู ุฅูุง ุฅุฒุงูุฉ ููู ุงูุชุนุฑูู ูุฐุง ุฃู ุชุนุทููู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"># cd /etc/apparmor.d/disable &amp;&amp; ln -s ../usr.sbin.unbound . # apparmor_parser -R /etc/apparmor.d/usr.sbin.unbound</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุฑุจูุง ููุจุบู ุฃู ูุถุงู ูุฐุง ุฅูู ููุงุนุฏ ุงููุนุจุฉ ุงูุชู ุชูุงุฑุณูุง.  ูู ุงููุซุงูู ุ ุจุงูุทุจุน ุ ุชุตุญูุญ ุงูููู ุงูุดุฎุตู ูุฅุตุฏุงุฑ ุงูุญููู ุงููุงุฒูุฉ ุ ููููู ููุช ูุณูููุง ุฌุฏูุง. </p><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">unbound.conf</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">server: chroot: "" port: 53 interface: 0.0.0.0 root-hints: "/var/lib/unbound/named.root" auto-trust-anchor-file: "/var/lib/unbound/root.key" access-control: 192.168.0.0/16 allow remote-control: control-enable: yes control-use-cert: no dnstap: dnstap-enable: yes dnstap-socket-path: "/tmp/dnstap.sock" dnstap-send-identity: no dnstap-send-version: no dnstap-log-client-response-messages: yes</code> </pre> </div></div><br><h3 id="skachivanie-i-obrabotka-spiskov" style=";text-align:right;direction:rtl">  ุชุญููู ููุนุงูุฌุฉ ุงููุงุฆูุฉ </h3><br><p style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูุจุฑูุงูุฌ ุงููุตู ูุชูุฒูู ููุนุงูุฌุฉ ูุงุฆูุฉ ุนูุงููู IP</a> <br>  ูููู ุจุชูุฒูู ุงููุงุฆูุฉ ุ ูููุฎุต ูุจู ุจุงุฏุฆุฉ <em>pfx</em> .  ูู <em>dont_add</em> ู <em>dont_summarize ุ</em> ููููู ุฅุฎุจุงุฑ IP ูุงูุดุจูุงุช ุจุชุฎุทู ุฃู ุนุฏู ุชูุฎูุตูุง.  ุฃูุง ูู ุญุงุฌุฉ ุฅูููุง ู  ูุงูุช ุดุจูุฉ VPS ุงูุฎุงุตุฉ ุจู ูู ูุงุฆูุฉ ุงูุญุธุฑ :) </p><br><p style=";text-align:right;direction:rtl">  ุงูุทุฑูู ูู ุงูุฃูุฑ ูู ุฃู ูุงุฌูุฉ ุจุฑูุฌุฉ ุชุทุจููุงุช RosKomSvoboda ุชุญุธุฑ ุงูุทูุจุงุช ุจุงุณุชุฎุฏุงู ูููู ูุณุชุฎุฏู Python ุงูุงูุชุฑุงุถู.  ูุจุฏู ููุฃูู ุณููุฏู ุญุตูุช ุนููู.  ูุฐูู ุ ูุบูุฑู ุฅูู Firelis. </p><br><p style=";text-align:right;direction:rtl">  ุญุชู ุงูุขู ุ ูุนูู ููุท ูุน IPv4 ู  IPv6 ุตุบูุฑ ุ ููู ุณูููู ูู ุงูุณูู ุฅุตูุงุญู.  ูุง ูู ููู ูู ุงูุถุฑูุฑู ุงุณุชุฎุฏุงู bird6 ุฃูุถุง. </p><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">rkn.py</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/python3 import json, urllib.request, ipaddress as ipa url = 'https://api.reserve-rbl.ru/api/v2/ips/json' pfx = '24' dont_summarize = { # ipa.IPv4Network('1.1.1.0/24'), } dont_add = { # ipa.IPv4Address('1.1.1.1'), } req = urllib.request.Request( url, data=None, headers={ 'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.47 Safari/537.36' } ) f = urllib.request.urlopen(req) ips = json.loads(f.read().decode('utf-8')) prefix32 = ipa.IPv4Address('255.255.255.255') r = {} for i in ips: ip = ipa.ip_network(i) if not isinstance(ip, ipa.IPv4Network): continue addr = ip.network_address if addr in dont_add: continue m = ip.netmask if m != prefix32: r[m] = [addr, 1] continue sn = ipa.IPv4Network(str(addr) + '/' + pfx, strict=False) if sn in dont_summarize: tgt = addr else: tgt = sn if not sn in r: r[tgt] = [addr, 1] else: r[tgt][1] += 1 o = [] for n, v in r.items(): if v[1] == 1: o.append(str(v[0]) + '/32') else: o.append(n) for k in o: print(k)</span></span></code> </pre> </div></div><br><p style=";text-align:right;direction:rtl">  <a href="">ุงููุตู ููุชุญุฏูุซ</a> <br>  ูุจุฏุฃ ุนูุฏ ุชุงุฌู ูุฑุฉ ูุงุญุฏุฉ ูููููุง ุ ุฑุจูุง ูููู ุงูุฃูุฑ ูุณุชุญู ุงูุณุญุจ ูู 4 ุณุงุนุงุช ุ ูุฃูู  ูุฐุง ุ ูู ุฑุฃูู ุ ูู ูุชุฑุฉ ุงูุชุญุฏูุซ ุงูุชู ูุชุทูุจูุง ILV ูู ููุฏูู ุงูุฎุฏูุงุช.  ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ููุงู ุจุนุถ ุงูุฃููุงู ุงูุนุงุฌูุฉ ุงูุฅุถุงููุฉ ุงูุชู ูููู ุฃู ุชุทูุฑ ุจุดูู ุฃุณุฑุน. </p><br><p style=";text-align:right;direction:rtl">  ูู ูุง ููู: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูููู ุจุชุดุบูู ุงูุจุฑูุงูุฌ ุงููุตู ุงูุฃูู ูุชุญุฏูุซ ูุงุฆูุฉ <code>rkn_routes.list</code> ( <code>rkn_routes.list</code> ) ูู BIRD </li><li style=";text-align:right;direction:rtl">  ุชุญุฏูุซ BIRD </li><li style=";text-align:right;direction:rtl">  ุชุญุฏูุซ ูุชูุธูู ูุงุฆูุฉ ุงููุฌุงู ู dnstap-bgp </li><li style=";text-align:right;direction:rtl">  ููู dnstap-bgp </li></ul><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">rkn_update.sh</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash ROUTES="/etc/bird/rkn_routes.list" DOMAINS="/var/cache/rkn_domains.txt" # Get &amp; summarize routes /opt/rkn.py | sed 's/\(.*\)/route \1 via "ens3";/' &gt; $ROUTES.new if [ $? -ne 0 ]; then rm -f $ROUTES.new echo "Unable to download RKN routes" exit 1 fi if [ -e $ROUTES ]; then mv $ROUTES $ROUTES.old fi mv $ROUTES.new $ROUTES /bin/systemctl try-reload-or-restart bird # Get domains curl -s https://api.reserve-rbl.ru/api/v2/domains/json -o - | jq -r '.[]' | sed 's/^\*\.//' | sort | uniq &gt; $DOMAINS.new if [ $? -ne 0 ]; then rm -f $DOMAINS.new echo "Unable to download RKN domains" exit 1 fi if [ -e $DOMAINS ]; then mv $DOMAINS $DOMAINS.old fi mv $DOMAINS.new $DOMAINS /bin/systemctl try-reload-or-restart dnstap-bgp</span></span></code> </pre> </div></div><br><p style=";text-align:right;direction:rtl">  ููุฏ ุชู ูุชุงุจุชูุง ุฏูู ุชูููุฑ ูุซูุฑ ุ ูุฐุง ุฅุฐุง ุฑุฃูุช ูุง ูููู ุชุญุณููู ุ ูุงุจุญุซ ุนูู. </p><br><h2 id="nastroyka-klienta" style=";text-align:right;direction:rtl">  ุฅุนุฏุงุฏ ุงูุนููู </h2><br><p style=";text-align:right;direction:rtl">  ุณุฃูุฏู ููุง ุฃูุซูุฉ ูุฃุฌูุฒุฉ ุชูุฌูู Linux ุ ูููู ูู ุญุงูุฉ Mikrotik / Cisco ุ ูุฌุจ ุฃู ูููู ูุฐุง ุงูุฃูุฑ ุฃูุซุฑ ุจุณุงุทุฉ. </p><br><p style=";text-align:right;direction:rtl">  ุฃููุงู ุ ูู ุจุชูููู BIRD: </p><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">bird.conf</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">router id 192.168.1.2; table rkn; protocol device { scan time 10; }; # Servers protocol bgp bgp_server1 { table rkn; local as 65000; neighbor 192.168.1.1 as 65000; direct; bfd on; next hop self; graceful restart; graceful restart time 60; rr client; export none; import all; } protocol kernel { table rkn; kernel table 222; scan time 10; export all; import none; }</code> </pre> </div></div><br><p style=";text-align:right;direction:rtl">  ูุจุงูุชุงูู ุ ุณูููู ุจูุฒุงููุฉ ุงููุณุงุฑุงุช ุงููุณุชููุฉ ูู BGP ูุน ุฌุฏูู ุชูุฌูู kernel ุฑูู 222. </p><br><p style=";text-align:right;direction:rtl">  ุจุนุฏ ุฐูู ุ ูููู ุฃู ุชุทูุจ ูู ุงูููุงุฉ ุฅููุงุก ูุธุฑุฉ ุนูู ูุฐู ุงูููุญุฉ ูุจู ุงููุธุฑ ูู ุงูุฅุนุฏุงุฏ ุงูุงูุชุฑุงุถู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"># ip rule add from all pref 256 lookup 222 # ip rule 0: from all lookup local 256: from all lookup 222 32766: from all lookup main 32767: from all lookup default</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูู ูุง ุชุจูู ูู ุชูููู DHCP ุนูู ุฌูุงุฒ ุงูุชูุฌูู ูุชูุฒูุน ุนููุงู IP ููููู ููุฎุงุฏู ุจุงุนุชุจุงุฑู DNS ูุงููุธุงู ุฌุงูุฒูุง. </p><br><h1 id="nedostatki" style=";text-align:right;direction:rtl">  ุงููุตูุฑ </h1><br><p style=";text-align:right;direction:rtl">  ุจุงุณุชุฎุฏุงู ุงูุฎูุงุฑุฒููุฉ ุงูุญุงููุฉ ูุฅูุดุงุก ููุนุงูุฌุฉ ูุงุฆูุฉ ุงููุฌุงูุงุช ุ ููุฏุฑุฌ <code>youtube.com</code> ู CDNs ููู. </p><br><p style=";text-align:right;direction:rtl">  ููุฐุง ูุคุฏู ุฅูู ุญูููุฉ ุฃู ุฌููุน ููุงุทุน ุงูููุฏูู ุณูู ุชูุฑ ุนุจุฑ VPN ุ ูุงูุชู ูููู ุฃู ุชุณุฏ ุงูููุงุฉ ุจุฃููููุง.  ุฑุจูุง ูุณุชุญู ุงูุฃูุฑ ุชุฌููุน ูุงุฆูุฉ ูู ูุฌุงูุงุช ุงูุงุณุชุซูุงุก ุงูุดุงุฆุนุฉ ุงููุญุธูุฑุฉ ูู ILV ูู ุงูููุช ุงูุญุงูู.  ูุชุฎุทููู ุฃุซูุงุก ุงูุชุญููู. </p><br><h1 id="zaklyuchenie" style=";text-align:right;direction:rtl">  ุงุณุชูุชุงุฌ </h1><br><p style=";text-align:right;direction:rtl">  ุชุณูุญ ูู ุงูุทุฑููุฉ ุงูููุตููุฉ ุจุชุฌุงูุฒ ุฃู ุฃููุงู ุชูุฑูุจูุง ูููู ุงููุฒูุฏูู ุจุชูููุฐูุง ุญุงูููุง. </p><br><p style=";text-align:right;direction:rtl">  ูู ุญูุซ ุงููุจุฏุฃ ุ ูููู ุงุณุชุฎุฏุงู <em>dnstap-bgp</em> ูุฃู ุบุฑุถ ุขุฎุฑ ุญูุซ ููุฒู ูุณุชูู ูุนูู ูู ุงูุชุญูู ูู ุญุฑูุฉ ุงููุฑูุฑ ุจูุงุกู ุนูู ุงุณู ุงููุฌุงู.  ููุท ุถุน ูู ุงุนุชุจุงุฑู ุฃูู ูู ุงูููุช ุงูุญุงูู ุ ูููู ุฃู ูุชู ุชุนููู ุฃูู ูููุน ุนูู ููุณ ุนููุงู IP (ุจุงููุณุจุฉ ูุจุนุถ Cloudflare ุ ุนูู ุณุจูู ุงููุซุงู) ุ ูุจุงูุชุงูู ูุฅู ูุฐู ุงูุทุฑููุฉ ุชุชููุฒ ุจุงูุฏูุฉ ุงูููุฎูุถุฉ. </p><br><p style=";text-align:right;direction:rtl">  ูููู ูุงุญุชูุงุฌุงุช ุชุฌุงูุฒ ุงูุฃููุงู ุ ููุฐุง ูููู ุชูุงูุง. </p><br><p style=";text-align:right;direction:rtl">  ุงูุฅุถุงูุงุช ูุงูุชุนุฏููุงุช ูุณุญุจ ุงูููุงู ููุถุน ุชุฑุญูุจ! </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar467547/">https://habr.com/ru/post/ar467547/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar467531/index.html">ุขูุฉ ุงูุญุงูุฉ ุงูุชูุงุนููุฉ</a></li>
<li><a href="../ar467533/index.html">ุงูุงุณุชูุงุน ุฅูู ุงูุถูุถุงุก ุงููุนูููุงุชูุฉ: ุงูููุณููู ูููุงุทุน ุงูููุฏูู ุงูุชู ูุง ููุจุบู ูุฃุญุฏ ุงูุนุซูุฑ ุนูููุง</a></li>
<li><a href="../ar467539/index.html">ุชู ุงูุชุตููุช ุนูู CA / B Forum ุถุฏ ุชูุตูุฑ ุดูุงุฏุงุช SSL ุฅูู 397 ููููุง</a></li>
<li><a href="../ar467543/index.html">ุณู ุงูุฏุฑุฏุดุฉ ุ ุงูุฌุฒุก 2</a></li>
<li><a href="../ar467545/index.html">ShIoTiny: ุณุงุนุฉ ุจุฏูู ุฑุจูุน ุฃู ูู ุงูููุช ุงูุญูููู ูููููุฉ ุงูุชุนุงูู ูุนูุง</a></li>
<li><a href="../ar467549/index.html">ูุฎุทุท SpaceX ููุดุฑ ุดุจูุฉ ุงูุฅูุชุฑูุช ุนุจุฑ ุงูุฃููุงุฑ ุงูุตูุงุนูุฉ ูู ููุช ูุจูุฑ ุนู ุงููุฎุทุท</a></li>
<li><a href="../ar467551/index.html">Frontend Weekly Digest (9 - 15 ุณุจุชูุจุฑ 2019)</a></li>
<li><a href="../ar467555/index.html">ููู ุฌูุฏุง ูู ุชุนุฑู CSSุ (+ ุงุฎุชุจุงุฑ ุตุบูุฑ)</a></li>
<li><a href="../ar467557/index.html">ููุฎุต ุงูููุงุฏ ุงูุทุงุฒุฌุฉ ูู ุนุงูู ุงููุงุฌูุฉ ุงูุฃูุงููุฉ ููุฃุณุจูุน ุงููุงุถู ุฑูู 380 (ูู 8 ุฅูู 15 ุณุจุชูุจุฑ 2019)</a></li>
<li><a href="../ar467559/index.html">ุงูุฃุญุฏุงุซ ุงูุฑูููุฉ ูู ููุณูู ูู 16 ุณุจุชูุจุฑ ุฅูู 22 ุณุจุชูุจุฑ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>