<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üéÜ üë®üèΩ‚Äçüé® üéÖüèø Connexion d'un √©cran 10 "ER-TFT101-1 au STM32F429 via FMC üèüÔ∏è ‚ôÇÔ∏è üë®üèº‚Äçüöí</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonne journ√©e √† tous. Dans cet article, nous analyserons la connexion de l'√©cran TFT ER-TFT101-1 (10 pouces, pilote RA8876) √† la carte Discovery STM32...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Connexion d'un √©cran 10 "ER-TFT101-1 au STM32F429 via FMC</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/483538/">  Bonne journ√©e √† tous.  Dans cet article, nous analyserons la connexion de l'√©cran TFT ER-TFT101-1 (10 pouces, pilote RA8876) √† la carte Discovery STM32F429L via une interface parall√®le 8080 16 bits √† l'aide du module FMC (flexible memory controller). <br><br><img src="https://habrastorage.org/webt/cp/ut/gd/cputgdq9cwztakwkxazqyzraay0.jpeg"><br><img src="https://habrastorage.org/webt/2m/om/jf/2momjfwxhdkw_lmxfx76jxeelpw.jpeg"><br><br><h4>  A propos de l'assemblage d'√©cran </h4><br>  Le ER-TFT101-1 d'EastRising est un assemblage d'une matrice TFT de 10 pouces avec une r√©solution de 1024x600 et d'une carte avec un pilote RA8876.  La carte avec le pilote dispose de toutes les alimentations n√©cessaires, la m√©moire SD-RAM est de 16 m√©gaoctets (bus 16 bits, fr√©quence maximale de 166 MHz, capacit√© maximale de 64 Mo), il y a un emplacement pour carte microSD standard.  Il y a des empreintes vides sous EEPROM avec des polices externes et sous la m√©moire flash pour les images avec des connecteurs de sortie pour les programmer.  De plus, un panneau tactile r√©sistif ou capacitif peut √™tre install√© en option sur l'ensemble. <br><a name="habracut"></a><br>  Sur la carte se trouve le pilote RAiO RA8876 haut de gamme avec une fr√©quence de fonctionnement maximale de 120 MHz, qui, si vous le souhaitez, peut lui-m√™me fonctionner comme un microcontr√¥leur de contr√¥le.  Vous pouvez √©crire un petit programme (seulement 12 instructions) et le mettre dans une m√©moire flash externe.  Lorsque l'affichage d√©marre, ce programme commencera √† s'ex√©cuter en premier lieu, dupliquant essentiellement toutes les options de contr√¥le via l'interface externe. <br><br><img src="https://habrastorage.org/webt/pf/up/ld/pfupldlxpv0p0xzjk1uliqmypeo.png"><br><br>  RA8876 n'a pas sa propre RAM et utilise donc une m√©moire SD-RAM externe.  Il peut lire des images √† partir de la m√©moire flash √† l'aide de DMA et les charger dans son tampon de trame et a une configuration tr√®s flexible de celui-ci.  Le pilote est connect√© √† la matrice elle-m√™me √† l'aide d'une interface RVB standard de 18 bits de large.  Seuls 6 bits par canal rouge, 6 bits par canal vert et 6 bits bleu sont utilis√©s.  Les deux bits inf√©rieurs de chaque canal ne sont pas utilis√©s, ce qui donne en th√©orie 262 144 couleurs. <br><br>  Le module DMA du RA8876 est tr√®s similaire au DMA2D de STM - il peut copier des sections rectangulaires de m√©moire d'un endroit √† un autre, avec conversion de couleur, transparence et autres puces. <br><br>  Le RA8876 poss√®de √©galement des polices anglaises et chinoises int√©gr√©es (8x16,12x24,16x32 pixels) avec des param√®tres flexibles pour leur affichage (rotation, √©chelle, etc.) et une interface matricielle s√©par√©e (5 x 5) pour les boutons mat√©riels (pour les non seulement utiliser) avec un tas de param√®tres, comme une pression longue et courte, r√©veiller l'affichage en appuyant sur un bouton et en appuyant sur plusieurs boutons en m√™me temps. <br><br>  Il existe une fonction d'image dans l'image (sans prise en charge de la transparence) pour afficher les fen√™tres contextuelles et les menus. <br><br>  Le pilote lui-m√™me peut dessiner des primitives graphiques, telles que carr√©, cercle, courbe, ovale, triangle, carr√© arrondi, avec et sans remplissage.  Soit dit en passant, dans RA8875 et RA8876, il y a un petit bug pour remplir le triangle, et chaque pilote a le sien.  Mais RAiO n'en a rien √† foutre du haut clocher ... J'ai essay√© de leur √©crire une lettre d'une mani√®re ou d'une autre, alors ils n'ont m√™me pas r√©pondu.  Le dessin de telles primitives vous permet de cr√©er de beaux graphismes m√™me avec un microcontr√¥leur lent. <br><br>  Avec le monde ext√©rieur, le RA8876 communique via des interfaces 8080/6800 8/16 bits, 3/4 fil SPI et I2C.  De plus, la puce du pilote elle-m√™me peut agir en tant que ma√Ætre SPI et I2C.  Dans le RA8876, deux sorties PWM peuvent √™tre utilis√©es pour un contr√¥le flexible du r√©tro√©clairage.  La fr√©quence SPI CLK maximale est d√©clar√©e √† 66 MHz avec une fr√©quence pilote de 120 MHz, ce qui donne en th√©orie 6 images par seconde d'une mise √† jour plein √©cran (√† 1024 x 600 x 16 bits).  Cette connexion a √©t√© test√©e par mes soins et a montr√© qu'elle a droit √† la vie si on n'affiche pas la vid√©o √† l'√©cran. <br><br>  Dans notre cas, nous allons connecter l'affichage en utilisant le protocole 8080 avec une largeur de 16 bits au STM32F429ZIT6 via le module FMC (contr√¥leur de m√©moire flexible), ce qui nous permettra d'obtenir plus de vitesse de remplissage d'√©cran et moins de charge sur le microcontr√¥leur. <br><br><h4>  Configuration des broches 8080 et FMC </h4><br>  Nous allons regarder le sch√©ma de connexion pour 8080 dans la fiche technique √† l'√©cran: <br><br><img src="https://habrastorage.org/webt/cu/6f/hq/cu6fhqbkgfnugnpjk7pxxy5k5ts.png"><br><br>  Nous examinons les broches n√©cessaires pour la connexion au STM32 dans CubeMX.  Nous sommes int√©ress√©s par la banque # 1 (NOR Flash / PSRAM / SRAM / ROM / LDC 1). <br><br><img src="https://habrastorage.org/webt/9u/rr/dt/9urrdt8fmvcz-6d10pblahs24te.png"><br><br>  Concernant XnWAIT dans la fiche technique, vous pouvez lire ce qui suit: <br><blockquote>  <i>La vitesse d'√©criture continue des donn√©es d√©termine la vitesse de mise √† jour de l'affichage.</i>  <i>L'intervalle de cycle √† cycle doit √™tre sup√©rieur √† 5 de la p√©riode d'horloge syst√®me si l'utilisateur sans adopter XnWait pour ins√©rer l'√©tat d'attente.</i>  <i>Une sp√©cification excessive peut entra√Æner la perte de donn√©es ou l'√©chec de la fonction si le m√©canisme xnwait n'est pas utilis√©.</i> </blockquote>  Litt√©ralement, entre les cycles de fonctionnement du protocole 8080, un d√©lai de 5 unit√©s syst√®me RA8876 doit √™tre ins√©r√© si l'utilisateur n'utilise pas le m√©canisme XnWAIT pour attendre la sortie de RA8876.  Nous utiliserons √† nouveau cette √©pingle, car  en pratique, j'ai essay√© d'ins√©rer un retard de cinq cycles, et cela n'a pas fonctionn√©. <br><br>  Au lieu d'un bus d'adresse complet pour l'unit√© FMC, nous utilisons une seule broche A16. <br><br><ol><li>  Nous configurons les broches de donn√©es (D0 - D15) comme une fonction alternative # 12, comme le pool de pouss√©e, la vitesse maximale et sans bretelles. </li><li>  Les broches XnWAIT, XnWR, XnRD, XA0 et XnCS sont configur√©es comme une fonction alternative # 12, telle que push-pull avec un ascenseur vers le plus (PULL UP). </li><li>  Nous configurons XnRST comme un GPIO ordinaire sans bretelle (il est sur la carte elle-m√™me). </li><li>  XnINTR est configurable en tant que GPIO √† l'entr√©e avec un ascenseur au plus. </li></ol><br>  J'ai √©galement connect√© le r√©tro-√©clairage √† 100% sans le contr√¥ler via PWM.  Pour ce faire, la broche n ¬∞ 14 du connecteur de l'ensemble √©cran est connect√©e au VDD. <br><br>  Je ne fournis pas le code de configuration pour les broches, car  J'utilise mes propres biblioth√®ques de configuration, et la configuration GPIO elle-m√™me a d√©j√† √©t√© centr√©e sur le concentrateur et sur d'autres sources. <br><br>  <a href="https://github.com/Yoda49/RA8876-Driver-for-STM32F429ZIT6-FMC" rel="nofollow">La biblioth√®que d'initialisation est ici</a> . <br><br><h4>  Param√®tres FMC </h4><br>  Trois banques pour chaque banque sont responsables de la configuration des banques du module FMC (NOR Flash / PSRAM / SRAM / ROM / LDC 1).  Ce sont FMC_BCRx, FMC_BTRx et FMC_BWTRx.  Dans les d√©finitions STM32F429 MK, les registres FMC_BCRx et FMC_BTRx sont combin√©s en un tableau commun appel√© FMC_BTCR avec huit √©l√©ments, o√π l'√©l√©ment z√©ro est FMC_BCR1, le premier √©l√©ment est FMC_BTR1, le deuxi√®me √©l√©ment est FMC_BCR2, etc.  FMC_BWTRx sont combin√©s en un tableau FMC_BWTR avec sept √©l√©ments, bien qu'il devrait y en avoir quatre.  Ne me demandez pas pourquoi ... <br><br>  FMC_BCRx contient des param√®tres de base, FMC_BTRx contient des temporisations g√©n√©rales et FMC_BWTRx contient des temporisations distinctes pour la lecture, si le p√©riph√©rique l'exige. <br><br>  Diagramme de synchronisation et synchronisations pour l'interaction de STM32F429 et RA8876. <br><br><img src="https://habrastorage.org/webt/fc/q5/sx/fcq5sxlxvbr0tqg1bz0mthfgzpm.png"><br><br>  Pour faciliter la configuration, nous allons ins√©rer les temporisations du protocole 8080 dans les constantes.  J'ai choisi les horaires moi-m√™me de mani√®re empirique, en r√©duisant un peu la valeur, car  La table de chronom√©trage avec une fiche technique ressemble plus √† un cheval sph√©rique dans le vide. <br><br><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> ADDSET = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> ADDHLD = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> DATAST = <span class="hljs-number"><span class="hljs-number">5</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> BUSTURN = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> CLKDIV = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> DATLAT = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> ACCMOD = <span class="hljs-number"><span class="hljs-number">0</span></span>; RCC-&gt;AHB3ENR |= RCC_AHB3ENR_FMCEN; <span class="hljs-comment"><span class="hljs-comment">//  FMC FMC_Bank1-&gt;BTCR[0] = 0; //    FMC_Bank1-&gt;BTCR[0] |= FMC_BCR1_MWID_0; //    16  FMC_Bank1-&gt;BTCR[0] |= FMC_BCR1_WREN; //    FMC_Bank1-&gt;BTCR[0] |= FMC_BCR1_WAITEN; //   XnWAIT FMC_Bank1-&gt;BTCR[0] |= FMC_BCR1_ASYNCWAIT; // XnWAIT    FMC_Bank1-&gt;BTCR[0] |= FMC_BCR1_WAITCFG; //  XnWAIT FMC_Bank1-&gt;BTCR[1] = 0; //    FMC_Bank1-&gt;BTCR[1] |= (ADDSET &lt;&lt; 0) | (ADDHLD &lt;&lt; 4) | (DATAST &lt;&lt; 8) | (BUSTURN &lt;&lt; 16) | (CLKDIV &lt;&lt; 20) | (DATLAT &lt;&lt; 24) | (ACCMOD &lt;&lt; 28); //   FMC_Bank1-&gt;BTCR[0] |= 1; //   </span></span></code> </pre> <br>  La valeur du registre FMC_BTCRx apr√®s r√©initialisation est 0x0FFF FFFF, c'est-√†-dire  des dur√©es maximales sont d√©finies.  Si vous avez un nouvel affichage ou une nouvelle m√©moire, r√©duisez simplement les temps et essayez de lancer. <br><br><h4>  Initialisation de l'affichage </h4><br>  Travailler avec l'√©cran revient √† lire ou √† √©crire dans certaines zones de la m√©moire.  FMC s'occupe du reste du travail.  Pour simplifier le travail, nous d√©finissons deux d√©finitions: <br><br><pre> <code class="plaintext hljs">#define LCD_DATA 0x60020000 #define LCD_REG 0x60000000</code> </pre> <br>  Et maintenant, nous d√©crivons les fonctions de bas niveau: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LCD_CmdWrite</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> cmd)</span></span></span><span class="hljs-function"> </span></span>{ *(<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">short</span></span> *)(LCD_REG) = cmd; }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LCD_DataWrite</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">short</span></span></span></span><span class="hljs-function"><span class="hljs-params"> data)</span></span></span><span class="hljs-function"> </span></span>{ *(<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">short</span></span> *)(LCD_DATA)= data; }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">unsigned</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">char</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LCD_StatusRead</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">short</span></span> data = *(<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">short</span></span> *)(LCD_REG); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> data; }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">unsigned</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">char</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LCD_DataRead</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">short</span></span> data = * (<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">short</span></span> *)(LCD_DATA); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>)data; }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LCD_RegisterWrite</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> cmd, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> data)</span></span></span><span class="hljs-function"> </span></span>{ *(<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">short</span></span> *)(LCD_REG) = cmd; *(<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">short</span></span> *)(LCD_DATA) = data; }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">unsigned</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">char</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LCD_RegisterRead</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> cmd)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">volatile</span></span> <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> data = <span class="hljs-number"><span class="hljs-number">0</span></span>; LCD_CmdWrite (cmd); data = LCD_DataRead (); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> data; };</code> </pre> <br>  De plus, la fonction d'initialisation de l'affichage elle-m√™me.  Le code provient du fournisseur d'affichage et est l√©g√®rement repens√© pour r√©pondre √† vos besoins.  Les sous-fonctions occupent une √©norme quantit√© et dans cet article, je ne les donnerai pas. <br><br>  <a href="" rel="nofollow">Lien vers le pilote sur le github</a> <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RA8876_Init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ RA8876_PLL_Init (); <span class="hljs-comment"><span class="hljs-comment">//   RA8876  120  RA8876_SDRAM_Init (); //  SDRAM  166  TFT_24bit (); //    24   ??? Host_Bus_16bit (); //   16  RGB_16b_16bpp (); //   16  MemWrite_Left_Right_Top_Down (); //       . Graphic_Mode (); //    Memory_Select_SDRAM (); //   SDRAM /*  RGB     RA8876 */ HSCAN_L_to_R (); VSCAN_T_to_B (); PDATA_Set_RGB (); PCLK_Falling (); DE_High_Active (); HSYNC_High_Active (); VSYNC_High_Active (); LCD_HorizontalWidth_VerticalHeight (1024, 600); LCD_Horizontal_Non_Display (160); LCD_HSYNC_Start_Position (160); LCD_HSYNC_Pulse_Width (70); LCD_Vertical_Non_Display (23); LCD_VSYNC_Start_Position (12); LCD_VSYNC_Pulse_Width (10); //   Frame_Buffer_Start_Address (PAGE0_START_ADDR); Frame_Buffer_Width (1024); Frame_Buffer_Start_XY (0, 0); Frame_Buffer_Color_Mode_16bpp (); //   Canvas_Window_Start_Address (PAGE0_START_ADDR); Canvas_Window_Width (1024); Canvas_Window_Start_XY (0, 0); Canvas_Window_WH (1024, 600); Canvas_Memory_XY_Mode (); Canvas_Window_Color_Mode_16bpp (); }</span></span></code> </pre><br>  √Ä propos du framebuffer et de la zone active un peu plus.  Pour ces deux param√®tres, nous d√©finissons les d√©finitions suivantes: <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> PAGE0_START_ADDR 0 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> PAGE1_START_ADDR (1024 * 600 * 2 * 1) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> PAGE2_START_ADDR (1024 * 600 * 2 * 2) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> PAGE3_START_ADDR (1024 * 600 * 2 * 3) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> PAGE4_START_ADDR (1024 * 600 * 2 * 4) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> PAGE5_START_ADDR (1024 * 600 * 2 * 5) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> PAGE6_START_ADDR (1024 * 600 * 2 * 6) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> PAGE7_START_ADDR (1024 * 600 * 2 * 7) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> PAGE8_START_ADDR (1024 * 600 * 2 * 8) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> PAGE9_START_ADDR (1024 * 600 * 2 * 9) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> PAGE10_START_ADDR (1024 * 600 * 2 * 10) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> PAGE11_START_ADDR (1024 * 600 * 2 * 11) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> PAGE12_START_ADDR (1024 * 600 * 2 * 12)</span></span></code> </pre> <br>  Chaque page (PAGEx_START_ADDR) est l'adresse de d√©part dans la SDRAM.  En 16 m√©gaoctets de m√©moire, nous pouvons placer 13 couches compl√®tes de taille 1228800 octets (1024 * 600 * 2). <br>  La fonction Frame_Buffer_Start_Address d√©finit la zone de m√©moire initiale pour le framebuffer (ce qui est actuellement affich√©). <br><br>  La fonction Canvas_Window_Start_Address d√©finit la zone m√©moire initiale du canevas.  De plus, la toile peut √™tre plus grande que le tampon de cadre, vous pouvez donc faire d√©filer l'image sur l'√©cran.  Par exemple, pour un jeu de plateforme, vous pouvez cr√©er un long canevas mesurant 13312 x 600 pixels, puis le faire d√©filer horizontalement, en d√©pla√ßant horizontalement le framebuffer. <br><br>  Si vous comparez la sortie graphique avec LTDM de STM32, alors tout n'est pas si rose ici.  Dans le m√™me temps, le pilote lui-m√™me ne peut afficher qu'une seule couche finale (tampon) et LTDC imm√©diatement deux, en les m√©langeant, sans n√©cessiter votre participation √† ce processus. <br><br><h4>  Dessin de primitives </h4><br>  Code d'un fournisseur d'affichage avec des fonctionnalit√©s pr√©d√©finies: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start_Line</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start_Triangle</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start_Triangle_Fill</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Line_Start_XY</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">short</span></span></span></span><span class="hljs-function"><span class="hljs-params"> WX, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">short</span></span></span></span><span class="hljs-function"><span class="hljs-params"> HY)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Line_End_XY</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">short</span></span></span></span><span class="hljs-function"><span class="hljs-params"> WX, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">short</span></span></span></span><span class="hljs-function"><span class="hljs-params"> HY)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Triangle_Point1_XY</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">short</span></span></span></span><span class="hljs-function"><span class="hljs-params"> WX, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">short</span></span></span></span><span class="hljs-function"><span class="hljs-params"> HY)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Triangle_Point2_XY</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">short</span></span></span></span><span class="hljs-function"><span class="hljs-params"> WX, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">short</span></span></span></span><span class="hljs-function"><span class="hljs-params"> HY)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Triangle_Point3_XY</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">short</span></span></span></span><span class="hljs-function"><span class="hljs-params"> WX, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">short</span></span></span></span><span class="hljs-function"><span class="hljs-params"> HY)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Square_Start_XY</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">short</span></span></span></span><span class="hljs-function"><span class="hljs-params"> WX, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">short</span></span></span></span><span class="hljs-function"><span class="hljs-params"> HY)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Square_End_XY</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">short</span></span></span></span><span class="hljs-function"><span class="hljs-params"> WX, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">short</span></span></span></span><span class="hljs-function"><span class="hljs-params"> HY)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start_Circle_or_Ellipse</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start_Circle_or_Ellipse_Fill</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start_Left_Down_Curve</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start_Left_Up_Curve</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start_Right_Up_Curve</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start_Right_Down_Curve</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start_Left_Down_Curve_Fill</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start_Left_Up_Curve_Fill</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start_Right_Up_Curve_Fill</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start_Right_Down_Curve_Fill</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start_Square</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start_Square_Fill</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start_Circle_Square</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start_Circle_Square_Fill</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Circle_Center_XY</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">short</span></span></span></span><span class="hljs-function"><span class="hljs-params"> WX, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">short</span></span></span></span><span class="hljs-function"><span class="hljs-params"> HY)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Ellipse_Center_XY</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">short</span></span></span></span><span class="hljs-function"><span class="hljs-params"> WX, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">short</span></span></span></span><span class="hljs-function"><span class="hljs-params"> HY)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Circle_Radius_R</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">short</span></span></span></span><span class="hljs-function"><span class="hljs-params"> WX)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Ellipse_Radius_RxRy</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">short</span></span></span></span><span class="hljs-function"><span class="hljs-params"> WX, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">short</span></span></span></span><span class="hljs-function"><span class="hljs-params"> HY)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Circle_Square_Radius_RxRy</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">short</span></span></span></span><span class="hljs-function"><span class="hljs-params"> WX, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">short</span></span></span></span><span class="hljs-function"><span class="hljs-params"> HY)</span></span></span></span>;</code> </pre> <br>  Par exemple, pour dessiner un triangle plein, nous d√©finissons trois points: Triangle_Point1_XY, Triangle_Point2_XY, Triangle_Point2_XY et ex√©cutons la fonction Start_Triangle_Fill. <br><br><h4>  Travailler avec DMA </h4><br>  Pour plus de commodit√©, j'ai √©crit ma fonction avec une structure comme param√®tre pass√©: <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GFX_BTE_options</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> layer_s0_addr; <span class="hljs-comment"><span class="hljs-comment">//     0 unsigned long layer_s1_addr; //     1 unsigned long layer_d_addr; //     unsigned short layer_s0_width; //    0 unsigned short layer_s1_width; //    1 unsigned short layer_d_width; //    unsigned short layer_s0_start_x; //     0 unsigned short layer_s0_start_y; //   Y  0 unsigned short layer_s1_start_x; //   X  1 unsigned short layer_s1_start_y; //   Y  1 unsigned short layer_d_start_x; //   X   unsigned short layer_d_start_y; //   Y   unsigned short window_size_x; //     unsigned short window_size_y; //     unsigned char rop_code; //  ROP unsigned char operation_code; //   DMA };       DMA: void GFX_BTE_operation (struct GFX_BTE_options options) { BTE_S0_Color_16bpp (); BTE_S0_Memory_Start_Address (options.layer_s0_addr); BTE_S0_Image_Width (options.layer_s0_width); BTE_S0_Window_Start_XY (options.layer_s0_start_x, options.layer_s0_start_y); BTE_S1_Color_16bpp (); BTE_S1_Memory_Start_Address (options.layer_s1_addr); BTE_S1_Image_Width (options.layer_s1_width); BTE_S1_Window_Start_XY (options.layer_s1_start_x, options.layer_s1_start_y); BTE_Destination_Color_16bpp (); BTE_Destination_Memory_Start_Address (options.layer_d_addr); BTE_Destination_Image_Width (options.layer_d_width); BTE_Destination_Window_Start_XY (options.layer_d_start_x, options.layer_d_start_y); BTE_Window_Size (options.window_size_x, options.window_size_y); BTE_ROP_Code (options.rop_code); BTE_Operation_Code (options.operation_code); BTE_Enable (); Check_BTE_Busy (); }</span></span></code> </pre> <br>  <u>Description des codes de fonctionnement (CODE D'OP√âRATION):</u> <br><br>  0000: √âcrire en m√©moire avec ROP en utilisant MK. <br>  0001: Lire la m√©moire sans ROP √† l'aide de MK. <br>  0010: Copiez un bloc de m√©moire vers l'avant √† l'aide de ROP. <br>  0011: Copie d'un bloc m√©moire en sens inverse √† l'aide de ROP. <br>  0100: √©criture dans la m√©moire (avec transparence) sans ROP √† l'aide de MK. <br>  0101: Copiez (d√©placez) un bloc de m√©moire (avec transparence) vers l'avant sans ROP. <br>  0110: Remplissez avec un motif en utilisant ROP. <br>  0111: remplissez le mod√®le de chromakey. <br>  1000: Extension de couleur <br>  1001: Couleur am√©lior√©e avec transparence <br>  1010: D√©placement d'un bloc de m√©moire vers l'avant avec le m√©lange alpha <br>  1011: √©criture dans la m√©moire avec un m√©lange alpha √† l'aide de MK. <br>  1100: remplit la zone m√©moire d'une couleur unie. <br>  1101: R√©serv√© <br>  1110: R√©serv√© <br>  1111: R√©serv√© <br><br>  <u>Description des codes raster (ROP CODE):</u> <br><br>  0000b: 0 (noir) <br>  0001b: ~ S0 „Éª ~ S1 ou ~ (S0 + S1) <br>  0010b: ~ S0 „Éª S1 <br>  0011b: ~ S0 <br>  0100b: S0 „Éª ~ S1 <br>  0101b: ~ S1 <br>  0110b: S0 ^ S1 <br>  0111b: ~ S0 + ~ S1 ou ~ (S0 „Éª S1) <br>  1000b: S0 „Éª S1 <br>  1001b: ~ (S0 ^ S1) <br>  1010b: S1 <br>  1011b: ~ S0 + S1 <br>  1100b: S0 <br>  1101b: S0 + ~ S1 <br>  1110b: S0 + S1 <br>  1111b: 1 (blanc) <br><br>  S0 est la couche z√©ro, S1 est la premi√®re couche.  L'interaction entre eux se produit √† l'aide d'op√©rations arithm√©tiques et binaires. <br><br><h4>  Sortie de police en ligne </h4><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GFX_Show_String_TMODE</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">short</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">short</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *ptr, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">short</span></span></span></span><span class="hljs-function"><span class="hljs-params"> charColor, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">short</span></span></span></span><span class="hljs-function"><span class="hljs-params"> bkColor)</span></span></span><span class="hljs-function"> </span></span>{ Foreground_color_65k (charColor); Background_color_65k (bkColor); CGROM_Select_Internal_CGROM (); Font_Select_12x24_24x24 (); Text_Mode (); Goto_Text_XY (x, y); LCD_CmdWrite (<span class="hljs-number"><span class="hljs-number">0x04</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (*ptr != <span class="hljs-string"><span class="hljs-string">'\0'</span></span>) { LCD_DataWrite (*ptr); Check_Mem_WR_FIFO_not_Full (); ++ptr; } Check_2D_Busy (); Graphic_Mode (); <span class="hljs-comment"><span class="hljs-comment">//back to graphic mode }</span></span></code> </pre> <br>  <a href="https://github.com/Yoda49/RA8876-Driver-for-STM32F429ZIT6-FMC" rel="nofollow">La version compl√®te du pilote peut √™tre trouv√©e sur le github au lien</a> <br><br>  Merci √† tous d'avoir lu! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr483538/">https://habr.com/ru/post/fr483538/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr483526/index.html">Gestion de l'√©tat des applications avec RxJS / Immer comme alternative simple √† Redux / MobX</a></li>
<li><a href="../fr483528/index.html">L'API REST doit √™tre bas√©e sur l'hypertexte</a></li>
<li><a href="../fr483530/index.html">Comment nous avons fait un jeu de soci√©t√©. Pourquoi et pourquoi?</a></li>
<li><a href="../fr483532/index.html">Conf√©rence DefCon 27: Dans les coulisses de la cr√©ation de badges √©lectroniques Partie 1</a></li>
<li><a href="../fr483536/index.html">L'histoire du microprocesseur et de l'ordinateur personnel: 1974 - 1980</a></li>
<li><a href="../fr483540/index.html">ChaiScript - langage de script pour C ++</a></li>
<li><a href="../fr483542/index.html">Telecom digest - documents sur le travail des fournisseurs</a></li>
<li><a href="../fr483544/index.html">De nouvelles donn√©es r√©futent l'hypoth√®se cl√© de l'√©nergie sombre</a></li>
<li><a href="../fr483550/index.html">D√©veloppement de services et IaaS: une compilation du cloud, du stockage de donn√©es et de 1cloud Evolution</a></li>
<li><a href="../fr483552/index.html">MVVM et s√©lection d'√©l√©ments dans l'adaptateur</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>