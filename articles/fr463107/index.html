<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üé¥ üêß üè´ ShIoTiny: petite automatisation, Internet des objets, ou ¬´six mois avant les vacances¬ª üßúüèæ ‚úîÔ∏è üéà</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Points cl√©s ou sujet de cet article 


 √âtant donn√© que les int√©r√™ts des gens sont diff√©rents et que les gens ont peu de temps, parlons bri√®vement du ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ShIoTiny: petite automatisation, Internet des objets, ou ¬´six mois avant les vacances¬ª</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/463107/"><br><img src="https://habrastorage.org/webt/op/yn/2p/opyn2pdqpdygsj93bqeqbyhuv6i.jpeg"><br><br><h4 id="osnovnye-tezisy-ili-o-chem-eta-statya">  Points cl√©s ou sujet de cet article </h4><br><p>  √âtant donn√© que les int√©r√™ts des gens sont diff√©rents et que les gens ont peu de temps, parlons bri√®vement du contenu de l'article. </p><br><p>  <strong>Cet</strong> article est un aper√ßu du projet de contr√¥leur avec un prix minimum et la possibilit√© de <strong>programmation visuelle</strong> via un navigateur WEB. </p><br><p>  Puisqu'il s'agit d'un article de revue visant √† montrer ¬´ce qui peut √™tre retir√© d'un contr√¥leur de penny¬ª, vous ne devriez pas y chercher des v√©rit√©s profondes et des algorithmes d√©taill√©s. </p><br><p>  <strong>La</strong> motivation, les id√©es et les r√©sultats de la construction d'un contr√¥leur bas√© sur la puce WiFI ESP8266 sont pris en compte. </p><a name="habracut"></a><br><h4 id="ipreduprezhdeniei">  <i>Avertissement</i> </h4><br><p>  <i>Je ne voulais pas √©crire cet article.</i>  <i>Je ne suis pas du tout fan d'√©crire des articles.</i>  <i>Il faut r√©fl√©chir et en plus - beaucoup.</i>  <i>Penser comment √©crire pour minimiser le nombre d'incompr√©hensions.</i>  <i>Penser comment ne pas aller aux extr√™mes.</i>  <i>Et bien plus encore.</i> <i><br></i>  <i>Mais des amis ont dit que puisque mes efforts dans le domaine de l'IoT et d'autres petites automatisations sont int√©ressants pour eux, ils peuvent √™tre int√©ressants pour d'autres pour le grand public.</i>  <i>Eh bien, o√π va le public qui s'int√©resse √† cela?</i>  <i>Bien s√ªr, sur un habr.</i>  <i>Et me voici.</i>  <i>Ancien lecteur et nouvel √©crivain.</i> <i><br><br></i>  <i>Pour les erreurs, inexactitudes, fautes de frappe, style de pr√©sentation non moderne, etc. qui pourraient ne pas plaire au lecteur, je n'assume aucune responsabilit√©.</i>  <i>Lisez √† vos risques et p√©rils.</i> <i><br><br></i>  <i>Je pr√©viens √©galement imm√©diatement que je n'expliquerai pas ce que la multidiffusion MQTT, WiFi et UDP et d'autres choses qui ne sont pas directement li√©es au sujet.</i>  <i>Certains liens se trouvent √† la fin de l'article.</i> </p><br><h4 id="rozhdenie-idei-ili-nemnogo-liriki">  La naissance d'une id√©e ou de quelques paroles </h4><br><p>  Eh bien, la vie n'est pas une chose simple, et Sa Majest√© Chance y joue un r√¥le important.  Je veux donc partager comment les √©v√©nements al√©atoires, multipli√©s par la paresse r√©guli√®re, ont abouti √† une conception de contr√¥leur plut√¥t int√©ressante bas√©e sur ESP8266. </p><br><p>  Tout a commenc√© de fa√ßon plut√¥t nonchalante: je voulais construire un syst√®me de contr√¥le du syst√®me d'alimentation en eau et arroser les parterres du jardin √† la campagne. </p><br><p>  <strong>Mais √†</strong> peu pr√®s, puisque je ne peux m'engager pleinement dans des camions-citernes-grues qu'en vacances, avant lesquelles il y avait encore plus de six mois - tout √©tait limit√© √† des discussions au travail avec des coll√®gues et des amis-camarades dans un cadre informel. </p><br><p>  <strong>Le</strong> sujet de la ¬´petite automatisation¬ª ou, comme il est d'usage de le dire dans ¬´ces √©coliers hacker-hacker¬ª - le sujet de l'IoT - l'Internet des objets - m'int√©resse depuis longtemps.  Bien avant l'av√®nement d'Internet en tant que tel, largement utilis√©. </p><br><p>  M√™me dans mon enfance, je voulais que les choses fassent quelque chose ¬´elles-m√™mes¬ª.  Et il est souhaitable que je puisse les contr√¥ler √† distance.  Mais √† cette √©poque (les ann√©es 80, le d√©but des ann√©es 90 du dernier mill√©naire), c'√©tait difficile.  Internet n'√©tait pas disponible partout dans le monde, car il n'y avait nulle part et des t√©l√©phones portables, des tablettes et m√™me des √©crans LCD et des cl√©s USB.  J'ai donc d√ª me limiter aux "interrupteurs d'√©clairage sur le clap" et aux t√©l√©commandes radio les plus simples.  Mais pour ces temps et cet √¢ge, c'√©tait agr√©able et int√©ressant. </p><br><p>  <strong>Mais</strong> c'est le pass√©.  Nonche dans la cour du XXI√®me si√®cle.  Et tout le monde a un smartphone dans sa poche, Internet est presque partout o√π il est n√©cessaire et non n√©cessaire, et la base de donn√©es des composants √©lectroniques disponibles est maintenant telle qu'il y a 15 ans, l'habitant ordinaire de la plan√®te Terre n'en r√™vait m√™me pas. </p><br><p>  Par cons√©quent, ayant d√©cid√© de mouler un contr√¥leur pour les affaires de l'eau dans le pays, j'ai tourn√© mes yeux vers la puce ESP8266. <br>  Tout d'abord, cette puce est bon march√©.  Et si un contr√¥leur ne suffit pas - vous pouvez en mettre deux, trois ou cinq.  Deuxi√®mement, il dispose du WiFi √† bord.  Autrement dit, vous pouvez regarder ce qui se passe via Internet et m√™me contr√¥ler le processus depuis n'importe quel smartphone.  Bien s√ªr, vous avez besoin d'un point d'acc√®s avec acc√®s √† Internet, mais ce n'est pas un probl√®me.  Quoi qu'il en soit, c'est presque partout, ou est sur le point de l'√™tre, y compris - et dans ma maison de campagne. </p><br><p>  Apr√®s avoir plong√© dans le monde merveilleux des projets pour ESP8266, j'ai √©t√© surpris de constater que, malgr√© les capacit√©s impressionnantes de cette puce, les projets dessus, √† de rares exceptions pr√®s, sont divis√©s en deux types: ce sont des programmes extr√™mement primitifs comme ¬´cliquez sur les rouleaux du smartphone et regardez l'√©tat capteur de temp√©rature via Internet ¬ª;  ou de bons et solides interpr√®tes de JavaScript ou Lua, mais malheureusement, ils consomment presque toute la m√©moire et ne vous permettent pas de faire quelque chose de s√©rieux. </p><br><p>  Ma premi√®re id√©e √©tait aussi simple qu'une cr√™pe - √©crire un programme de contr√¥le de pompe simple bas√© sur l'√©tat des capteurs et c'est tout.  Mais, comme un kalach d√©chiquet√© en termes de sauter sur le r√¢teau d'introduire diff√©rents syst√®mes, j'ai r√©alis√© que je ne serais certainement pas en mesure de pr√©voir tous les virages de l'algorithme que j'aimerais ou que je devrais redresser pendant la construction du syst√®me d'approvisionnement en eau et d'irrigation. </p><br><p>  <strong>D</strong> √©laborer le programme dans le pays, dans une grange sombre - n'est pas tr√®s pratique.  Et vous devez. <br>  Quelle est la sortie?  Bien s√ªr, la premi√®re chose qui m'est venue √† l'esprit √©tait de rendre l'algorithme personnalisable.  Un de mes coll√®gues a donn√© de nombreux conseils - quoi configurer et comment.  Avec cela, il a coup√© ma premi√®re id√©e dans l'≈ìuf.  Merci √† lui.  S'il n'avait pas d√©ploy√© sous mes yeux le nombre de param√®tres que je devrais configurer, je ne refuserais probablement pas cette option: cr√©er une page de param√®tres d'algorithme. </p><br><p>  <strong>Mais</strong> une image terrifiante du nombre de param√®tres de r√©glage, et m√™me de s'influencer mutuellement - m'a d√©gris√©.  Encore une fois, je me suis rendu compte que rien ne pouvait √™tre pr√©vu ... </p><br><p>  Je vais r√©server tout de suite: je suis paresseux.  Tr√®s paresseux!  Je suis franchement paresseux pour r√©√©crire le programme √† chaque fois.  Par cons√©quent, la t√¢che s'est pos√©e - comment d√©finir rapidement et facilement un algorithme, de pr√©f√©rence sans programmation?  De plus, cet algorithme sera assez compliqu√©;  aura beaucoup de param√®tres;  Elle sera individuelle pour mon cas et inadapt√©e aux autres.  Et je veux vraiment rendre l'appareil plus ou moins universel ... </p><br><p>  Puisqu'il y avait encore environ six mois avant les vacances et toute la tuyauterie, j'ai d√©cid√© de prendre mon temps pour r√©fl√©chir: comment le rendre pratique et beau?  Comment programmer sans programmation?  Comment faire sans un billion de param√®tres qui peuvent √™tre modifi√©s lors de la configuration? </p><br><p>  Comme d'habitude, tout a d√©j√† √©t√© pens√© devant nous: j'ai r√©alis√© que je voulais dessiner un algorithme sous forme de carr√©s d'action et les connecter avec des lignes de communication qui montrent d'o√π et d'o√π les donn√©es volent.  Eh bien, en fouillant dans la bo√Æte, je veux pouvoir configurer certains de ses param√®tres individuels. </p><br><p>  <strong>Et l'</strong> acte de d√©finir l'algorithme, de le dessiner avec des carr√©s n'est pas nouveau.  Ces syst√®mes √©taient de retour dans les ann√©es 80;  il existe un syst√®me NodeRed super populaire qui est bien connu de ceux qui ont d√©j√† rejoint le monde de la petite automatisation / IoT. </p><br><p>  <strong>Mais</strong> ce n'est pas de chance: de tels syst√®mes sont con√ßus pour les ¬´gros PC¬ª.  Au pire, sur le Raspberry PI.  Mais pas du tout sur l'ESP8266, qui n'a que quelques dizaines de kilo-octets de RAM et il n'y a pas de syst√®me d'exploitation! </p><br><p>  Comment √™tre?  Et il n'y a que deux solutions: √©crire et dessiner un programme sur un "grand PC" ou un ordinateur portable, puis le transf√©rer sous une forme ou une autre sur ESP8266 ou essayer de "fourrer les ind√©sirables" dans le contr√¥leur ESP8266 lui-m√™me. </p><br><p>  Par cons√©quent, le programme maximum que j'avais √©tait le suivant: pour programmer votre contr√¥leur, il ne devrait y avoir besoin de rien d'autre qu'un ordinateur portable avec un navigateur WEB!  C'est-√†-dire, un ordinateur portable avec un navigateur WEB et mon contr√¥leur - cela devrait suffire pour configurer compl√®tement et √©crire des programmes de contr√¥le. </p><br><p>  <strong>Et</strong> , il s'est av√©r√© qu'il √©tait tout √† fait possible de le r√©aliser! <br>  Je ne vous ennuierai pas avec tous les d√©tails de l'√©laboration du projet.  Je peux seulement dire que sur la base des mots qui me sont venus √† l'esprit et √† la langue au cours du processus de d√©veloppement, il serait possible de compiler un ¬´ <em>Dictionnaire de la vulgarit√© des travailleurs √©lectroniques</em> ¬ª distinct.  Mais tout est derri√®re.  Plus pr√©cis√©ment, pas tous, mais la premi√®re √©tape, la plus difficile, quand ce n'est pas clair - votre id√©e sera-t-elle de vivre ou est-ce simplement un non-sens du hongre un soir de pleine lune. </p><br><p>  <strong>Je</strong> partagerai le r√©sultat de ce qui est sorti et s'appelle le <b>¬´contr√¥leur ShIoTiny¬ª</b> . </p><br><h4 id="i-chto-zhe-vyshlo">  Et que s'est-il pass√©? </h4><br><p>  <b>Le mat√©riel du</b> contr√¥leur ShIoTiny est standard et simple: trois entr√©es con√ßues pour les capteurs √† contact sec (boutons, interrupteurs reed, ils sont √©galement des capteurs de niveau d'eau dans le r√©servoir), une entr√©e ADC, une entr√©e pour connecter un capteur de temp√©rature et d'humidit√© comme DHT22 ou similaire .  Et enfin, trois sorties sous forme de relais de commutation pour 220V, 1 Amp.  Le relais dit 10A, mais je suis r√©aliste et je ne les laisserai pas passer la carte d'ampli 10A.  Et pour contr√¥ler les d√©marreurs des pompes et 1 amp√®re suffit.  Tout cela est aliment√© par une source d'alimentation avec une tension de 5 √† 9 volts. </p><br><p>  Bien s√ªr, j'ai ajout√© le capteur de temp√©rature comme ¬´Schaub √©tait¬ª, mais sur l'ADC, on esp√©rait mesurer la tension du secteur.  N'est-ce pas suffisant? </p><br><p>  Bien s√ªr, toutes les entr√©es, √† l'exception de l'entr√©e pour connecter le DHT22, sont prot√©g√©es contre les r√©sistances et les diodes: je n'avais aucune envie de graver ESP8266, et les diodes et r√©sistances ne co√ªtent que quelques centimes. </p><br><p>  <strong>Une photo du</strong> produit fini peut √™tre vue au d√©but de l'article.  J'ai command√© plusieurs de ces planches - que se passe-t-il si je les br√ªle ou dois-je couper les chemins et les jambes? <br>  Mais, heureusement - n'a pas eu √† le faire. </p><br><p>  <strong>Le</strong> produit est, bien s√ªr, la beaut√© et la grandeur.  Mais pour plus de commodit√©, ce qui suit est un sch√©ma de connexion de la carte aux simulateurs de capteurs et d'actionneurs. </p><br><br><img src="https://habrastorage.org/webt/_v/qm/_k/_vqm_kjyjzpgxqvsqzjte7ct6y8.jpeg"><br><br><p>  <strong>√Ä la</strong> place des capteurs de niveau - boutons Input1..3, au lieu des d√©marreurs - LED connect√©es au relais Relay1..3.  Eh bien, une r√©sistance variable sur l'ADC pour simuler la tension d'entr√©e. <br>  Lorsque le relais est √©teint, la LED rouge est allum√©e.  Et lorsqu'il est allum√© - vert.  J'ai donc d√©bogu√© sur la table. </p><br><p>  <strong>En</strong> plus de tout cela, il y a un connecteur d'alimentation sur la gauche de la carte et deux boutons de service sur la droite: Reset et AP.  Eh bien, un interrupteur DIP qui met l'appareil en mode de programmation.  Le connecteur de programmation ESP8266 via l'adaptateur USB-UART est √©galement disponible. </p><br><p>  <strong>Quelques explications sur les boutons.</strong>  Qu'est-ce que la <strong>r√©initialisation</strong> - et c'est donc clair.  Mais le bouton <strong>AP</strong> est n√©cessaire pour mettre <strong>ShIoTiny</strong> en mode point d'acc√®s ouvert (mode configuration ou mode config).  Pourquoi est-ce n√©cessaire?  Eh bien, par exemple, vous avez foir√© les param√®tres r√©seau et souhaitez les modifier.  Appuyez sur le bouton AP pendant quelques secondes (jusqu'√† ce que la belle LED bleue s'allume).  Ensuite, prenez votre smartphone ou votre ordinateur portable, allumez le WiFi et voyez-y un point d'acc√®s ouvert avec le nom esp_8266_xxxx et connectez-vous.  Ensuite, allez dans le navigateur de votre smartphone ou ordinateur portable et tapez dans la barre d'adresse: 192.168.4.1.  Si tout est en ordre, vous serez redirig√© vers la page du contr√¥leur ShIoTiny et vous pourrez le configurer d'une nouvelle mani√®re. </p><br><p>  <strong>Comme</strong> nous le voyons, le mat√©riel n'a rien de compliqu√©.  Par cons√©quent, √† propos de la <strong>partie logicielle</strong> . </p><br><p>  <strong>Dans</strong> tous les sauts d'impl√©mentation, je d√©crirai, mais ensuite.  Un jour.  Et aujourd'hui, je ne consid√©rerai le logiciel que "√† l'ext√©rieur", c'est-√†-dire du point de vue de l'utilisateur - moi-m√™me ou quelqu'un d'autre qui a os√© utiliser mon m√©tier (il y a de tels cascadeurs). </p><br><p>  <strong>Du</strong> point de vue de l'utilisateur, l'appareil est un serveur HTTP accessible via WiFi.  Tous les param√®tres, la programmation et ainsi de suite - se fait √† l'aide d'un navigateur WEB. </p><br><p>  <strong>Et</strong> donc, nous sommes all√©s √† la page du contr√¥leur.  Que voyons-nous?  Et nous voyons l'onglet ¬´Contr√¥le et √©tat¬ª, qui montre l'√©tat actuel des appareils utilis√©s: entr√©es, sorties, ADC, DHT22.  De plus, les param√®tres de connexion au point d'acc√®s sont affich√©s (si nous travaillons en mode station WiFi);  les param√®tres du point d'acc√®s (si nous travaillons en mode point d'acc√®s WiFi) ou les deux.  Eh bien, en plus, les param√®tres de connexion avec le courtier MQTT sont affich√©s si le protocole MQTT est utilis√©. </p><br><br><img src="https://habrastorage.org/webt/lm/02/tw/lm02twe6qzwhrrby1v9jhf8alb8.jpeg"><br><br><p>  <strong>A</strong> voir, rien de sp√©cial et d'int√©ressant.  Il n'y a rien √† presser!  Bien que ... Il y a deux autres onglets!  Configuration des param√®tres r√©seau <strong>Mise</strong> en <strong>r√©seau</strong> et sch√©mas de sch√©ma de l'√©diteur <strong>ElDraw</strong> . </p><br><p>  Vous l'avez devin√©, le <strong>r√©seautage</strong> est la mise en place d'un r√©seau, mais pas seulement cela.  Il a quelques param√®tres plus int√©ressants.  ¬´Poke¬ª sur l'onglet <strong>Networking</strong> et voyez-y approximativement ce qui est montr√© dans la figure. <br>  Configuration du nom et du mot de passe du point d'acc√®s pour chacun des modes - stations WiFi et points d'acc√®s WiFi.  Tout semble clair.  En plus de l'objectif du <strong>bouton Scan WiFi,</strong> il est compl√®tement transparent. <br>  <strong>Mais</strong> la liste d√©roulante <strong>"Mode ShIoTiny"</strong> n√©cessite une clarification.  Le fait est que je ne pouvais pas d√©cider dans quel mode il serait plus pratique pour moi de travailler.  Et donc, pr√©vu pour 5 modes de fonctionnement de l'appareil. </p><br><br><img src="https://habrastorage.org/webt/kd/s_/hh/kds_hhoiybre9ivtlr1kl1peh24.png"><br><br><p>  Nous listons bri√®vement ces modes de fonctionnement. </p><br><p>  <strong>Mode config</strong> - mode configuration.  Il s'agit du mode point d'acc√®s ouvert avec une adresse fixe 192.168.4.1 et le nom esp_8266_xxxx. </p><br><p>  <strong>Mode Station</strong> - le mode de la station WiFi connect√©e √† votre point d'acc√®s. </p><br><p>  <strong>Mode AP</strong> - mode point d'acc√®s ferm√©.  Vous d√©finissez vous-m√™me le nom et le mot de passe. </p><br><p>  <strong>Le mode AP + Station</strong> est l'inclusion simultan√©e du mode AP + du mode Station. </p><br><p>  <strong>Mode unique</strong> - fonctionne sans se connecter au r√©seau.  Un seul contr√¥leur portant sa lourde part ... </p><br><p>  <strong>Dans</strong> tous les modes, √† l'exception du <strong>¬´Mode de configuration¬ª</strong> , vous pouvez bloquer la page WEB en cochant la case <strong>¬´Verrouiller le Web en mode Station¬ª</strong> .  Il s'agit d'un type pour des raisons de s√©curit√©. </p><br><p>  <strong>Les</strong> param√®tres sont √©vidents pour MQTT: serveur, port, mot de passe, connexion ouverte ou <strong>SSL</strong> .  Je ne m'√©tendrai pas ici en d√©tail. </p><br><p>  <strong>En</strong> plus de tout le reste, le contr√¥leur ShIoTiny peut envoyer et recevoir des paquets dans un format sp√©cial pour la multidiffusion.  Ses param√®tres sont √©galement √©vidents: l'adresse du groupe et le port. <br>  Bien s√ªr, si vous d√©crivez toutes les nuances des param√®tres, vous obtenez un article s√©par√©, mais ce n'est pas inclus dans mes plans. </p><br><p>  <strong>Et</strong> donc, avec l'onglet <strong>R√©seau</strong> , tout est plus ou moins clair.  Passons √† la caract√©ristique principale du contr√¥leur - l' <strong>√©diteur de</strong> programme <strong>ElDraw</strong> . </p><br><p>  En appuyant sur l'onglet ElDraw, nous voyons quelque chose comme ce qui suit.  Bien s√ªr, si l'appareil n'a pas de circuit charg√©, le champ du circuit sera vide. </p><br><br><img src="https://habrastorage.org/webt/hr/on/kc/hronkcmousbzptjr1olyag1whbk.png"><br><br><p>  <strong>√Ä</strong> gauche, une palette d'√©l√©ments ou de n≈ìuds (n≈ìuds). <br>  <strong>A</strong> droite, un champ de diagramme ou simplement un ¬´diagramme¬ª. <br>  <strong>Du</strong> haut - boutons pour le chargement et le d√©chargement sur le disque et sur l'appareil, ainsi que des boutons pour l'√©dition. </p><br><p>  <strong>Pour</strong> ceux qui ont travaill√© avec des √©diteurs, la gestion est g√©n√©ralement √©vidente.  Nous devons ajouter un √©l√©ment au diagramme - prenez-le avec la souris et faites-le glisser de la palette vers le diagramme.  Il est n√©cessaire de supprimer l'√©l√©ment ou le lien du diagramme - piquez dessus ou dessus avec la souris et appuyez sur la touche <strong>SUPPR</strong> .  Nous devons connecter les √©l√©ments - nous prenons l'entr√©e d'un √©l√©ment et le connectons √† la sortie d'un autre. </p><br><p>  <strong>Il y a</strong> toujours une mise √† l'√©chelle (MAJ + molette de la souris).  Malheureusement, il n'existe aucun moyen de copier des √©l√©ments et des groupes d'√©l√©ments.  Mais cela n'interf√®re pas beaucoup. </p><br><p>  <strong>De</strong> plus, pour des raisons de logique, l'entr√©e d'un n≈ìud ne peut √™tre connect√©e qu'√† une sortie d'un autre n≈ìud.  Mais la sortie du n≈ìud est avec plusieurs entr√©es d'autres n≈ìuds.  Les entr√©es sont toujours √† gauche des n≈ìuds.  Les sorties sont toujours √† droite. </p><br><p>  <strong>Quelles</strong> capacit√©s avons-nous pour impl√©menter des algorithmes? <br>  <strong>En</strong> opportunit√©s - assez vaste.  La palette contient des n≈ìuds repr√©sentant tout le mat√©riel du contr√¥leur <strong>ShIoTiny</strong> : entr√©es, relais, ADC, DHT11 / 22. </p><br><p>  Il existe des n≈ìuds logiques et arithm√©tiques pour le traitement des donn√©es. </p><br><p>  Afin que nous puissions travailler avec l'appareil via Internet, il existe des n≈ìuds pour l'abonnement et la publication des param√®tres au courtier MQTT. </p><br><p>  Si nous voulons que plusieurs contr√¥leurs ShIoTiny √©changent des informations entre eux - vous pouvez utiliser les n≈ìuds pour transmettre et recevoir des param√®tres √† l'aide du protocole de multidiffusion UDP. </p><br><p>  <strong>Pour</strong> ce rhum, il y a des n≈ìuds de temporisation;  n≈ìuds de contr√¥le de gestion des √©v√©nements. </p><br><p>  <strong>Je vais</strong> donner quelques exemples.  Par exemple, souhaitez-vous que les donn√©es de temp√©rature et d'humidit√© soient publi√©es toutes les 30 minutes sur un serveur MQTT?  Rien de plus simple.  Dessine comme √ßa. </p><br><br><img src="https://habrastorage.org/webt/gf/bu/op/gfbuopoey6qqzbgtglgqm14otme.jpeg"><br><br><p>  <strong>Eh bien le</strong> bouton meme "Upload".  C‚Äôest tout! <br>  Si vous avez correctement configur√© la connexion avec le courtier MQTT dans l'onglet R√©seau, c'est tout! <br>  Toutes les demi-heures, la temp√©rature sera publi√©e sur le courtier sous le sujet / T, et l'humidit√© - sous le sujet / H.  Ou, si vous demandez les noms de vos sujets, puis sous eux. <br>  Question: Pourquoi 18 000 30 minutes?  Parce que tous les temps sont mesur√©s en dixi√®mes de seconde. </p><br><p>  Maintenant, vous voulez ajouter √† ce circuit la possibilit√© d'activer le relais Relay1 via Internet, et m√™me pendant un certain temps?  Pas de probl√®me.  Faites comme √ßa. </p><br><br><img src="https://habrastorage.org/webt/mb/ai/l6/mbail6skmkridba4jx6zhnvpjng.png"><br><br><p>  <strong>Environ</strong> cinq, cliquez sur le bouton "T√©l√©charger".  C‚Äôest tout!  D√©sormais, en plus du fait que toutes les demi-heures, la temp√©rature et l'humidit√© seront publi√©es sur le courtier MQTT, il sera possible d'activer le relais Relay1.  Oui, non seulement allumez-le, mais pendant exactement 10 minutes.  Vous pouvez activer le relais en publiant le sujet / r1cmd, d√©fini sur 1. Et l'√©tat r√©el du relais sera publi√© dans le sujet / r1status. </p><br><p>  <strong>Est</strong> -ce que je veux non seulement allumer, mais aussi d√©sactiver le relais √† l'avance?  Oui, comme tu dis.  La figure ci-dessous montre comment le faire! </p><br><br><img src="https://habrastorage.org/webt/nq/nm/qz/nqnmqznqcj9ia1tco5tumywbblg.png"><br><br><p>  Le principe est-il clair?  Vous dessinez simplement l'algorithme avec la souris!  Et √©crivez quelques param√®tres: heure, nom du sujet et tout.  C'est beaucoup plus clair que d'√©crire un tas de code. </p><br><p>  <strong>Soit dit en passant</strong> , mettre en √©vidence des liens de diff√©rentes couleurs n'est pas un ¬´photoshop¬ª - c'est l'une des fonctions de l'√©diteur.  Vous pouvez coloriser les liens √† votre guise, afin de ne pas les confondre. </p><br><p>  <strong>Mais</strong> oh et ce n'est pas tout!  Afin de d√©boguer l'algorithme, il existe un bouton ¬´Monitor start¬ª.  Aussi √©trange que cela puisse para√Ætre, il active le mode ¬´moniteur¬ª.  Dans ce mode, l'√©tat de toutes les sorties de tous les n≈ìuds est lu p√©riodiquement √† partir du contr√¥leur <strong>ShIoTiny</strong> et affich√© sur le circuit.  √Ä peu pr√®s comme dans la figure ci-dessous. </p><br><br><img src="https://habrastorage.org/webt/av/zo/ev/avzoevodxkpmwylcw2da2tzqicq.png"><br><br><p>  Autrement dit, nous pouvons voir en ¬´presque temps r√©el¬ª ce que nous avons √† l'entr√©e et √† la sortie de chaque n≈ìud.  Cela aide beaucoup lorsque quelque chose n'est pas clair. </p><br><p>  <strong>Il y a</strong> encore beaucoup de ¬´puces et fonctionnalit√©s¬ª que je voudrais d√©crire, et ma conscience ne vous permettra pas d'y consacrer votre temps dans un seul article.  L'id√©e principale r√©alis√©e est d√©j√† claire: un minimum de param√®tres configurables - un maximum de visibilit√©. </p><br><h4 id="lozhka-degtya">  Voler dans la pommade </h4><br><p>  Bien s√ªr, je veux qu'il n'y ait pas de mouche dans la pommade, mais le monde n'est pas parfait.  Mon √©diteur et mon contr√¥leur ne sont pas parfaits.  J'ai trouv√© deux fonctionnalit√©s principales que je n'ai pas encore pu √©liminer. </p><br><p>  Premi√®rement, des probl√®mes surviennent parfois lors du mouvement de groupe d'√©l√©ments.  Mais cela n'interf√®re pas beaucoup avec le travail.  Plus probablement une fonctionnalit√© qu'un bug. </p><br><p> <strong></strong> , -,          ¬´Upload¬ª,  .    ,     . </p><br><h4 id="zaklyuchenie">  Conclusion </h4><br><p> <strong></strong> ,      ,  ,   .    ,         . </p><br><p> <strong></strong> , -,      .     . <br> <strong></strong>   ,                    ¬´ ¬ª. <br> <strong></strong>         ‚Äî   : <strong>shiotiny@yandex.ru</strong> </p><br><p> <strong></strong>      ,  , ,  . </p><br><p> <strong></strong>   ,   . </p><br><h4 id="ssylki-otsylki-i-posylki"> ,    </h4><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">  ShIoTiny</a> </p><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ESP8266</a> <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">WiFi</a> <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">MQTT</a> <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">UDP Multicast</a> </p><br><h4 id="po-prosbam-trudyaschihsya">    </h4><br><p> <strong></strong>      (). </p><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://github.com/shiotiny/ShIoTinyBin</a> </p><br><p> : <a href="">https://github.com/shiotiny/ShIoTinyBin/blob/master/bin/esp-07-shiotiny.bin</a> </p><br><p> : <a href="">https://github.com/shiotiny/ShIoTinyBin/blob/master/doc/esp-07-shiotiny.png</a> </p><br><p>  : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://github.com/shiotiny/ShIoTinyBin/blob/master/doc/ShIoT-esp8266-01_obzor.pdf</a> </p><br><p>  " "  . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr463107/">https://habr.com/ru/post/fr463107/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr463095/index.html">Pourquoi pas SQL?</a></li>
<li><a href="../fr463097/index.html">Go Product Development: One Project History</a></li>
<li><a href="../fr463099/index.html">1000 et 1 r√©troaction. Comment donner du feedback et enseigner aux autres, l'exp√©rience Lamoda</a></li>
<li><a href="../fr463101/index.html">Gestion de centaines de serveurs pour les tests de charge: mise √† l'√©chelle automatique, surveillance personnalis√©e, culture DevOps</a></li>
<li><a href="../fr463105/index.html">Mon quatri√®me jour avec Haiku: probl√®mes d'installation et de d√©marrage</a></li>
<li><a href="../fr463113/index.html">Contr√¥le de version des donn√©es et des mod√®les dans la rencontre Computer Vision</a></li>
<li><a href="../fr463115/index.html">Le probl√®me des portes dans la conception des tireurs</a></li>
<li><a href="../fr463117/index.html">Pr√©chargement en PHP 7.4</a></li>
<li><a href="../fr463121/index.html">Nous mangeons l'√©l√©phant par parties. Exemple de strat√©gie de surveillance de l'int√©grit√© des applications</a></li>
<li><a href="../fr463123/index.html">Biblioth√®que de g√©n√©rateur de code assembleur pour microcontr√¥leurs AVR. 3e partie</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>