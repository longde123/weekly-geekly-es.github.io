<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>📥 🎀 🍠 التحكم في الإضاءة على زيجبي 🖕🏼 🏯 👏🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="مرحبا أصدقاء! اليوم أريد أن أخبركم عن تطور واحد مثير للاهتمام لنظام التحكم في الإضاءة عن بعد. 



 المنزل الحديث هو عدد ضخم من الأسلاك لتقليل وتبسيط م...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>التحكم في الإضاءة على زيجبي</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/460637/" style=";text-align:right;direction:rtl">  مرحبا أصدقاء!  اليوم أريد أن أخبركم عن تطور واحد مثير للاهتمام لنظام التحكم في الإضاءة عن بعد. <br><br><img src="https://habrastorage.org/webt/ro/yx/l6/royxl62-z2oqpfn6hwt5izou3_y.jpeg" alt="صورة"><br><br>  المنزل الحديث هو عدد ضخم من الأسلاك لتقليل وتبسيط ما لا يقل عن عدد راديو يأتي لانقاذ.  في الواقع ، ليس هذا النظام جديدًا ، ولكن في سياق ميزانية محدودة ، فقد برر نفسه تمامًا. <br><br>  التطلع إلى المستقبل ، أريد أن أعرض على الفور الرسم الوظيفي لنظام التحكم. <br><br><img src="https://habrastorage.org/webt/fh/ey/gj/fheygj8s-fn_phg3oqnva6ajrye.jpeg" alt="صورة"><br>  <i>التين.</i>  <i>1</i> <br><br>  أنا مهتم بشخص ما تحت القط. <br><a name="habracut"></a><br>  السؤال المنطقي هو لماذا كل هذا مطلوب؟  يعطي استخدام نظام التحكم في الإضاءة اللاسلكية: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  تقليل عدد الأسلاك التي تنتقل من كل مفتاح إلى مربع التقاطع في الغرفة. </li><li style=";text-align:right;direction:rtl">  إمكانية تنفيذ مفاتيح المشي. </li><li style=";text-align:right;direction:rtl">  المرونة في التحكم في أي حمولات من أي مفتاح وكذلك استخدام أزرار مفتوحة عادة مغلقة. </li><li style=";text-align:right;direction:rtl">  القدرة على تنفيذ أي تأخير زمني للتشغيل / الإيقاف. </li></ul><br>  كانت المهمة الفنية ، في البداية ، مجرد كلمات وبدا موحلة للغاية وغير مفهومة.  النقطة المهمة هي أنه في كوخ من طابقين تبلغ مساحته 208 مترًا مربعًا ، من الضروري التحكم في / إيقاف الإضاءة الداخلية ، يجب تشغيل النظام من 220 فولت والتبديل بين 21-23pcs.  الأحمال (المصابيح) بسعة لا تزيد عن 200W.  في وقت التفتيش الأول للكائن ، بدا كل شيء على هذا النحو <br><br><img src="https://habrastorage.org/webt/cz/bi/_b/czbi_bdenvipzshelqjbmh0himq.jpeg"><br>  <i>التين.</i>  <i>2. يتم وضع الجزء الرئيسي من الاتصالات في الأرض ، ثم يتم سكب كل ذلك مع ذراع التسوية الخرساني</i> <br><br><img src="https://habrastorage.org/webt/sh/h-/7m/shh-7mxsspyefbi-nlti3wisn8m.jpeg"><br>  <i>التين.</i>  <i>3. مكان لتثبيت خزانة التوزيع في الطابق الثاني</i> <br><br>  كانت التوصية القوية هي استخدام أقل عدد ممكن من الأسلاك.  من الناحية المثالية ، فقط تلك التي وضعت بالفعل في الأرض والجدران والسقف ، فإنها تنتقل من موقع تركيب لوحة التبديل إلى كل مصباح كهربائي.  نظرًا للتوافق الكهرومغناطيسي لجميع الأجهزة الموجودة في المنزل ، لم يوصى باستخدام شبكة wi-fi العادية  هناك عدد لا يحصى من هذه الأجهزة والعميل على هذا الحساب لديه بدعة في رأسه أن الأجهزة في المنزل سوف تبدأ في العيش حياتهم الخاصة وسوف طباخ بطيء المدرجة سيؤثر على الضوء في الحمام أو المرحاض.  أول شيء فعلته هو تحديد مخطط الكتلة ، كما أتخيل حل هذه المشكلة.  في fig_4 هذا الخيار. <br><br><img src="https://habrastorage.org/webt/80/wk/x2/80wkx2kcoelxunryvcivzi8n7e8.jpeg"><br>  <i>التين.</i>  <i>4. مخطط وظيفي للتحكم في الإضاءة.</i> <br><br>  تم الحصول على الأساس بواسطة وحدة الراديو Texas Instruments CC2530 التي تدعم تقنية ZiegBee وتمت برمجتها تمامًا في C ++ باستخدام IAR-studio 5.5.  يتم تنفيذ أحمال التبديل المباشر باستخدام وحدات ترحيل WB-MR6 (لوحة wirenboard) ، لقد اخترت هذا العنصر لأنه في حالة مدمجة على سكة din ، يتم تثبيت ستة مرحلات مع قنوات مستقلة على عنصر التحكم 16A ، وتؤخذ جميع ميزات تبديل أحمال الطاقة للأغراض العامة في الاعتبار في t. ح.  مع التيارات الانطلاق عالية: السيطرة على مصابيح LED ، المصابيح المتوهجة ، وتبديل إمدادات الطاقة.  بالإضافة إلى ذلك ، كل اتصال تتابع محمي ضد الجهد الزائد بواسطة متغير.  تم تثبيت ستة من هذه الوحدات من أجل إدارة عدد معين من الأحمال بهدوء.  يتم توصيل جميع WB-MR6 عبر واجهة ModBus في شبكة واحدة.  يتم تعيين كل وحدة ترحيل إلى عنوان مطابق لمخطط الاتصال ، ويتم تثبيت النظام بالكامل مع كتل الإدخال ، والصمامات ، وقواطع الدوائر بإحكام في لوحة مفاتيح اثنين SHCHMP2-1 500x400x450.  من أجل وضع مدمج للكابلات 46 × 3 × 1.5 (نواة أحادية النواة) ، كان من الضروري تغيير الوضع التقليدي لقضبان الدين إلى عمودي. <br><br><img src="https://habrastorage.org/webt/xv/fx/mn/xvfxmnadqjpt8l0wy8jtzxmaopo.jpeg"><br>  <i>التين.</i>  <i>5. لوحة مفاتيح مع وضع أجهزة التحكم في الإضاءة.</i> <br><br>  تجدر الإشارة إلى أن الوظيفة المفيدة بشكل لا يصدق لـ WB-MR6 هي القدرة على التحكم في مخرجات الترحيل من خلال ربط الأزرار المفتوحة عادة بلوك الطرف السفلي ، وهذا ما تحتاجه لرسم تخطيطي مؤقت للسلك.  TK  ظهر التحكم ModBus بعد خمسة أشهر ، بعد تجميع لوحات المفاتيح وتركيبها.  خلال هذا الوقت ، تم اختبار وترقيم جميع الكابلات المتجهة إلى كل حمولة.  وقد تم وضع مخطط تبديل مفصل ، مع منطق التحكم للمفتاح - المصباح الكهربائي في Fig_6. <br><br><img src="https://habrastorage.org/webt/59/ca/lj/59caljsa6bx9fv1bkzm6x9cgz2g.jpeg"><br>  <i>التين.</i>  <i>6. مخطط التحكم في الإضاءة ووضع وحدات الاقتراع والتحميل.</i> <br><br>  بالنسبة لوحدات الاستقصاء ، أستطيع أن أقول ما يلي ، تبين أن الرسم البياني الوظيفي الموضح في الشكل 7 كان وظيفيًا تمامًا.  ليست هناك حاجة عمليا لإعادة أي شيء ، وحدة ss2530 RF تسمح لك بتعيين أي مدخلات لأي مخرجات.  الاستثناء الوحيد هو UART (pin20-Tx ، pin21-Rx) ، حيث تم شراء معظم قائمة العناصر على ali. تم طلب لوحات الدوائر المطبوعة على صداها. لقد قمت بلحام جميع القطع العشرين بيدي ، إنها صعبة ، استغرق الأمر أسبوعًا ، ولم تنجح على الفور بحاجة إلى.  لكن اكتسبت تجربة لا تقدر بثمن تثبيت مكونات مصلحة الارصاد الجوية. <br><br><img src="https://habrastorage.org/webt/vv/a3/d6/vva3d686ixu6dxa3rh-fxmemqig.jpeg"><br>  <i>التين.</i>  <i>7. الرسم البياني وظيفي من وحدة الاقتراع زر</i> <br><br>  استغرقت عملية تصحيح النظام وإدخاله في حالة التشغيل الكامل أكثر من ثلاثة أشهر بقليل.  كانت الخطوات الأولى بعد تجميع لوحات Rice_8 ، والتحقق من الطاقة والاتصال بالمبرمج ، هي كتابة برنامج لاستقصاء الأزرار وإنشاء أوامر تحكم لوحدات ترحيل WB-MR6 عبر ناقل ModBus. <br><br><img src="https://habrastorage.org/webt/zj/qq/cg/zjqqcgo-dewjpy6dpqvydmmjpu4.jpeg"><br>  <i>التين.</i>  <i>8. زر الاقتراع وحدة</i> <br><br>  اتضح بسرعة وسهولة.  وحدة استطلاع زر واحدة متصلة بوحدة ترحيل واحدة عبر RS485 حتى الآن بدون واجهة شبكة.  تمكنت على الفور من تطبيق النجاح الذي تم الحصول عليه على الكائن pic_9 ، تم وضع UTP الزوج الملتوي ، من الأزرار الموجودة في غرفة النوم ، مقدمًا.  مع تثبيت الوحدات ، لم أكن متطورة للغاية ، فالمسادات ذاتية اللصق والمشابك البلاستيكية تساعد كثيرًا. <br><br><img src="https://habrastorage.org/webt/qq/2m/f2/qq2mf2-bsvhphquu_bb_bikcajw.jpeg"><br>  <i>التين.</i>  <i>9. ربط وحدات الاقتراع زر.</i> <br><br>  ثم أضاف برمجيًا عنوان كل وحدة ، والذي تم تعيينه باستخدام مفتاح dip وبطاقة التحويل المقابلة ، ووضع تشغيل السيد / العبد ونقل الأوامر عبر الراديو.  كانت خطوة للأمام خطيرة ، وبالتالي كانت هناك العديد من الصعوبات في تصحيح الأخطاء.  الأخطر من ذلك هو نقل المعلومات حول الزر المضغوط إلى الوحدة الرئيسية المتصلة بنقل Modbus بمجرد تنشيط بروتوكول نقل البيانات zig-bee ، فقد أصبح كل شيء أكثر تعقيدًا.  بالنسبة لأولئك الذين قرأوا إلى هنا ، أستطيع أن أقول إن المشكلة تكمن في أن أجهزة ضبط الوقت في المعالج الأساسية تعمل بشكل غير متوقع ، وبشكل أكثر دقة في برنامج التحويل البرمجي IAR ، تحتاج إلى تحديد إعداداته باستمرار عند استدعاء إجراء حساب الوقت.  لإيجاد طريقة لحل هذه المشكلة ، تمت إضافة وظائف المراقبة والتحكم في البيانات المرسلة عبر الراديو.  تم عرض التحكم في الضغط على زر في وضع الخدمة على الفور في الجهاز الطرفي للكمبيوتر ، والذي يتم توصيله عبر محول RS485-USB بوحدة الاقتراع.  هناك مشكلة خطيرة أخرى في تنظيم شبكة التحكم في الإضاءة وهي النطاق غير الكافي لواجهة الراديو.  أكثر أو أقل ، بثقة تم تبديل كل شيء فقط داخل حدود الجدول الذي تم تجميع التصميم عليه.  هذا ناتج عن ميزة وضع توفير الطاقة SS2530 ، فقد تعطلت وظيفة تقليل طاقة الإشعاع ، بعد تكوين الرابط ، لا أعرف لماذا تم ذلك ، ولكن تم العثور عليه عبر jtag في وضع تصحيح الأخطاء خطوة بخطوة.  بعد إيقاف تشغيل هذا الوضع ، بدأت الشبكة تعمل داخل طابق واحد فقط في الكوخ ، في الواقع ، تمت معالجة أوامر تشغيل / إيقاف الضوء بواسطة الخادم ، فقط من وحدات الاقتراع الموجودة داخل دائرة نصف قطرها 12-14 م.  شريطة عدم وجود جدران.  لحل هذه المشكلة ، اخترنا طريقة لاستبدال الوحدة النمطية CC2530 بهوائي مستوٍ بهيكل بهوائي خارجي (بموصل IPEX) ، وذلك لأنه كان ناجحًا للغاية في شراء ثلاث وحدات في إصدار E18-MSI-IPX بالإضافة إلى هوائي وكابل في أحد سانت بطرسبرغ المخازن على الانترنت.  تم لحام كل هذا بسرعة ، وتم صنع زوايا تركيب الهوائيات وربطها بلوحات المحولات Fig_10. <br><br><img src="https://habrastorage.org/webt/es/20/je/es20jewxb7gxff5iefdsr9uzmbu.jpeg"><br>  <i>التين.</i>  <i>10. استخدام هوائي خارجي</i> <br><br>  كانت نتيجة هذه الترقية محيرة للغاية بالنسبة لي - نظرًا لأن النطاق لم يتغير كثيرًا ، بل قد أقول إنه انخفض قليلاً.  بدأت في البحث عن طريقة للخروج من هذا الموقف في تحسين خوارزميات البرنامج ، كان على الإعدادات الأولية لـ SS2530 إعادة قراءة سيارة ورقة البيانات والمنتديات حول هذا الموضوع.  كان الهدف هو جعل كل وحدة على الشبكة تعمل كمكرر ، لا سيما وأن هذه الوظيفة ممكّنة بشكل افتراضي ويدعمها أي جهاز يقوم بتشغيل بروتوكول Zig-Bee.  لكن في حالتي لم يكن الأمر واضحًا.  كنتيجة لذلك ، قررت إدخال وحدة نمطية إضافية في النظام ، والتي سيكون لها برنامج ثابت فريد تم تنشيطه عن طريق رفع pin_6 فقط على مفتاح التبديل.  كان عليه ، كان على سقف الطابق الأول وبث الأوامر المتلقاة فقط ، أي  يكون الداعم إشارة. <br><br>  سأقول على الفور أن هذا كان طريق مسدود.  لكن أثناء تنفيذ هذه الفكرة ، قمت بقياس معلمات الهوائي "الأسود" عن طريق الخطأ ، والتي قمت ببيعها في متجر عبر الإنترنت جنبا إلى جنب مع CC2530 والكابل.  أظهر محلل الشبكة SWR 1.9 على تردد 2.4 جيجا هرتز - التعليقات غير ضرورية ، تحتاج إلى إنشاء هوائي خاص بك.  يعطي الطلب إلى محرك البحث على الفور الإجابة الصحيحة ، هوائي Clover وتعليمات التصنيع التفصيلية. <br><br><img src="https://habrastorage.org/webt/8f/fo/2s/8ffo2soyaf4iikrhcw75ymoxwwi.jpeg"><br>  <i>التين.</i>  <i>11. هوائي وجهاز لتصنيعها.</i> <br><br>  حرفيا في المساء ، صنعت ثلاث قطع من هذه الهوائيات ، وفحصت SWR الخاصة بها ليس أسوأ من 1.2.  لا أستطيع أن أقول عن الخصائص الأخرى ، ونمط الإشعاع وكسب.  ولكن الحقيقة هي أن نطاق الاستقبال الموثوق به وإرسال الأوامر قد تضاعف.  Ris_12 <br><br><img src="https://habrastorage.org/webt/ye/ba/bd/yebabdzcf80hy4yoaoilnapxxz4.jpeg"><br>  <i>التين.</i>  <i>12. قياس الهوائي</i> <br><br>  ونتيجة لذلك ، تمكنا من تحقيق استقبال إشارة الخادم العادية في جميع وحدات الاقتراع الاثني عشر المثبتة في الكوخ.  وهكذا  الوفاء التام بمتطلبات المعارف التقليدية في الوقت المحدد ؛ التقيت عمليًا بالمواعيد النهائية.  العميل راض. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar460637/">https://habr.com/ru/post/ar460637/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar460627/index.html">vGPU - لا يمكن تجاهل الاستخدام</a></li>
<li><a href="../ar460629/index.html">احتمال أن 2 من عمال المناجم لديهم نفس العالم</a></li>
<li><a href="../ar460631/index.html">حول الشارة في 80 يومًا: على الجانب الآخر OFFZONE</a></li>
<li><a href="../ar460633/index.html">تفاصيل تنفيذ RSTP والملكية التكرار الطوق</a></li>
<li><a href="../ar460635/index.html">CLRium # 6: التزامن والتوازي. يومين: من المعالج إلى المزامنة / الانتظار</a></li>
<li><a href="../ar460641/index.html">YouTokenToMe: أداة لترميز النص بسرعة من فريق VKontakte</a></li>
<li><a href="../ar460643/index.html">توزيع موحد للنقاط على الكرة</a></li>
<li><a href="../ar460645/index.html">عمل الخير: سوء كتابة الشر مع Go ، الجزء 1</a></li>
<li><a href="../ar460647/index.html">حل وظيفة مع pwnable.kr 05 - رمز المرور. أعد كتابة جدول ارتباط الإجراء من خلال مشكلة عدم حصانة سلسلة التنسيق</a></li>
<li><a href="../ar460651/index.html">اجتماع جمعية اختبار مجهول: TMS ، رصد الرصد ، وتقييم جودة البحث واختبارات دائرة الرقابة الداخلية الأصلية</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>