<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üòÜ üëäüèø ‚õîÔ∏è Emby Source Code Analyse mit dem PVS-Studio Analyzer ü¶Ö üåÑ üèÖ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Emby ist neben Plex und Kodi ein ziemlich bekannter Medienserver. In diesem Artikel werden wir versuchen, den Quellcode mithilfe des statischen Analys...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Emby Source Code Analyse mit dem PVS-Studio Analyzer</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/484050/"><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/rr/ar/h3/rrarh3smm2vkgpopwdn2fgqan0s.png" alt="Bild 3"></div><br>  Emby ist neben Plex und Kodi ein ziemlich bekannter Medienserver.  In diesem Artikel werden wir versuchen, den Quellcode mithilfe des statischen Analysators PVS-Studio zu √ºberpr√ºfen.  Auf der offiziellen Emby-Website befindet sich eine kleine Marke ‚ÄûBuilt with ReSharper‚Äú.  Nun, es ist noch interessanter. <br><a name="habracut"></a><br><h2>  PVS-Studio Code Analyzer </h2><br>  PVS-Studio l√§uft auf 64-Bit-Systemen unter Windows, Linux und MacOS.  Er wei√ü, wie man nach Fehlern im Quellcode von Programmen sucht, die in C, C ++, C # und Java geschrieben sind. <br><br><h2>  Gepr√ºftes Projekt </h2><br>  Emby ist ein Medienserver, dessen Quellcode auf <a href="https://github.com/MediaBrowser/Emby">GitHub</a> zu finden ist.  Sie k√∂nnen damit Sendungen organisieren und von jedem Ger√§t aus auf Medieninhalte (Video, Audio, Fotos) zugreifen.  <a href="https://emby.media/">Dr√ºcken Sie</a> von der offiziellen <a href="https://emby.media/">Emby-</a> Website: <br><br><ul><li>  Emby konvertiert Ihre Medien automatisch im Handumdrehen f√ºr die Wiedergabe auf jedem Ger√§t. </li><li>  Umfangreiche Kindersicherungsfunktionen erleichtern die Kontrolle des Zugriffs auf Inhalte, die f√ºr Familien mit kleinen Kindern relevant sind. </li><li>  Emby organisiert Ihre Medien in einfachen und eleganten Pr√§sentationen.  Sie werden niemals gleich aussehen. </li><li>  Streaming von Daten mit Synchronisation in der Cloud; </li><li>  Teilen Sie Ihre Mediendateien ganz einfach mit Freunden und der Familie. </li><li>  Und vieles mehr. </li></ul><br><h2>  Codeteile, die bei der Pr√ºfung eines Analyseberichts aufgefallen sind </h2><br>  <b>PVS-Studio Warnung:</b> <a href="https://www.viva64.com/ru/w/v3001/">V3001</a> Es gibt identische Unterausdr√ºcke 'c! =' &lt;'' Links und rechts vom Operator '&amp;&amp;'.  HttpListenerRequest.Managed.cs 49 <br><br><pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">internal</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetRequestLine</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> req</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((ic &gt;= <span class="hljs-string"><span class="hljs-string">'A'</span></span> &amp;&amp; ic &lt;= <span class="hljs-string"><span class="hljs-string">'Z'</span></span>) || (ic &gt; <span class="hljs-number"><span class="hljs-number">32</span></span> &amp;&amp; c &lt; <span class="hljs-number"><span class="hljs-number">127</span></span> &amp;&amp; c != <span class="hljs-string"><span class="hljs-string">'('</span></span> &amp;&amp; c != <span class="hljs-string"><span class="hljs-string">')'</span></span> &amp;&amp; c != <span class="hljs-string"><span class="hljs-string">'&lt;'</span></span> &amp;&amp; <span class="hljs-comment"><span class="hljs-comment">// &lt;= c != '&lt;' &amp;&amp; c != '&gt;' &amp;&amp; c != '@' &amp;&amp; c != ',' &amp;&amp; c != ';' &amp;&amp; // &lt;= c != ':' &amp;&amp; c != '\\' &amp;&amp; c != '"' &amp;&amp; c != '/' &amp;&amp; c != '[' &amp;&amp; c != ']' &amp;&amp; c != '?' &amp;&amp; c != '=' &amp;&amp; c != '{' &amp;&amp; c != '}')) continue; .... }</span></span></code> </pre> <br>  Der Analysator hat einen doppelten Unterausdruck <i>c! = '&lt;'</i> Festgestellt.  M√∂glicherweise hat sich ein Fehler in diesen Code eingeschlichen, und anstelle von <i>'&lt;'</i> h√§tte etwas anderes verwendet werden m√ºssen.  Oder, wahrscheinlicher, der zweite Unterausdruck ist √ºberfl√ºssig und Sie m√ºssen ihn nur l√∂schen. <br><br>  <b>PVS-Studio Warnung:</b> <a href="https://www.viva64.com/ru/w/v3001/">V3001</a> Es gibt identische Unterausdr√ºcke 'SmbConstants.AttrHidden' links und rechts vom '|'  Betreiber.  SmbComDelete.cs 29 <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">internal</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SmbComDelete</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> fileName</span></span></span><span class="hljs-function">)</span></span> { Path = fileName; Command = SmbComDelete; _searchAttributes = SmbConstants.AttrHidden | SmbConstants.AttrHidden | SmbConstants.AttrSystem; }</code> </pre> <br>  Der Analysator hat erneut einen Tippfehler festgestellt, der mit wiederholten Unterausdr√ºcken verbunden ist.  Mit Blick auf die Zukunft werde ich sagen, dass es in diesem Projekt ein bisschen zu viele √§hnliche Fehler gibt, die durch Nachl√§ssigkeit verursacht wurden.  Ich beschuldige die Sch√∂pfer von Emby √ºberhaupt nicht, wir sind manchmal auf diese Weise verstreut ( <a href="https://www.viva64.com/ru/examples/v501/">Beispiele</a> , <a href="https://www.viva64.com/ru/examples/v3001/">Beispiele</a> , <a href="https://www.viva64.com/ru/examples/v6001/">Beispiele</a> ), und um vor solchen Fehlern sicher zu sein, gibt es nur eine statische Analyse. <br><br>  <b>PVS-Studio Warnung:</b> <a href="https://www.viva64.com/ru/w/v3004/">V3004</a> Die Anweisung 'then' entspricht der Anweisung 'else'.  SqliteItemRepository.cs 5648 <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> QueryResult&lt;Tuple&lt;BaseItem, ItemCounts&gt;&gt; GetItemValues(....) { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (typesToCount.Length == <span class="hljs-number"><span class="hljs-number">0</span></span>) { whereText += <span class="hljs-string"><span class="hljs-string">" And CleanName In (Select CleanValue from ItemValues where "</span></span> + typeClause + <span class="hljs-string"><span class="hljs-string">" AND ItemId in (select guid from TypedBaseItems"</span></span> + innerWhereText + <span class="hljs-string"><span class="hljs-string">"))"</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-comment"><span class="hljs-comment">//whereText += " And itemTypes not null"; whereText += " And CleanName In (Select CleanValue from ItemValues where " + typeClause + " AND ItemId in (select guid from TypedBaseItems" + innerWhereText + "))"; } .... }</span></span></code> </pre> <br>  Und das ist sehr √§hnlich zu dem Problem, das beim Kopieren und Einf√ºgen auftrat, weil  <i>ob</i> und <i>sonst</i> Blockk√∂rper v√∂llig identisch sind.  Warum mussten Sie die Gr√∂√üen des Arrays <i>typesToCount</i> √ºberpr√ºfen, wenn unabh√§ngig von der Anzahl der darin geschriebenen Elemente derselbe Code ausgef√ºhrt wird - dies ist nur Entwicklern bekannt. <br><br>  <b>PVS-Studio Warnung:</b> <a href="https://www.viva64.com/ru/w/v3005/">V3005</a> Die Variable '_validProviderIds' ist sich selbst zugewiesen.  BaseNfoParser.cs 77 <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Dictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt; _validProviderIds; .... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Fetch</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">....</span></span></span><span class="hljs-function">)</span></span> { .... _validProviderIds = _validProviderIds = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Dictionary&lt;....&gt;(....); .... }</code> </pre> <br>  Wieder ein Tippfehler, der die Zuweisung einer Variablen an sich selbst zur Folge hatte.  Es lohnt sich, diesen Codeabschnitt zu √ºberpr√ºfen. <br><br>  <b>PVS-Studio Warnung:</b> <a href="https://www.viva64.com/ru/w/v3008/">V3008</a> Der Variablen 'Chapters' werden nacheinander zweimal Werte zugewiesen.  Vielleicht ist das ein Fehler.  Check lines: 29, 28. Title.cs 29 <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Title</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint</span></span></span></span><span class="hljs-function"><span class="hljs-params"> titleNum</span></span></span><span class="hljs-function">)</span></span> { ProgramChains = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;ProgramChain&gt;(); Chapters = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;Chapter&gt;(); Chapters = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;Chapter&gt;(); TitleNumber = titleNum; }</code> </pre> <br>  Wieder Unaufmerksamkeit und Tippfehler ... Der Variablen <i>Chapters wird</i> zweimal ein Wert zugewiesen.  Es ist klar, dass dieser zus√§tzliche Code nichts Schlimmes bedroht, aber dennoch.  Es macht keinen Sinn, in diesem Beispiel zu verweilen, lasst uns weitermachen. <br><br>  <b>PVS-Studio Warnung:</b> <a href="https://www.viva64.com/ru/w/v3013/">V3013</a> Es ist merkw√ºrdig, dass der Hauptteil der ' <a href="https://www.viva64.com/ru/w/v3013/">Lesen'</a> -Funktion dem Hauptteil der' Schreiben'-Funktion (407, Zeile 415) vollst√§ndig entspricht.  BaseSqliteRepository.cs 407 <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> IDisposable </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Read</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ReaderWriterLockSlim obj</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WriteLockToken(obj); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> IDisposable </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Write</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ReaderWriterLockSlim obj</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WriteLockToken(obj); } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">WriteLockToken</span></span> : <span class="hljs-title"><span class="hljs-title">IDisposable</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ReaderWriterLockSlim _sync; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WriteLockToken</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ReaderWriterLockSlim sync</span></span></span><span class="hljs-function">)</span></span> { _sync = sync; sync.EnterWriteLock(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Dispose</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_sync != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { _sync.ExitWriteLock(); _sync = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } } }</code> </pre> <br>  Die K√∂rper der <i>Lese-</i> und <i>Schreibfunktionen</i> sind absolut identisch, wie im Warnungstext des Analyseger√§ts angegeben.  Die <a href="https://docs.microsoft.com/en-us/dotnet/api/system.threading.readerwriterlockslim.enterwritelock%3Fview%3Dnetframework-4.8"><i>EnterWriteLock-</i></a> Methode <a href="https://docs.microsoft.com/en-us/dotnet/api/system.threading.readerwriterlockslim.enterwritelock%3Fview%3Dnetframework-4.8"><i>wird</i></a> ben√∂tigt, um die Sperre im Schreibmodus <a href="https://docs.microsoft.com/en-us/dotnet/api/system.threading.readerwriterlockslim.enterwritelock%3Fview%3Dnetframework-4.8"><i>aufzurufen</i></a> .  F√ºr den Lesemodus <i>empfiehlt</i> sich die Verwendung der <i>EnterReadLock-</i> Methode, mit der eine Ressource in mehreren Threads gleichzeitig gelesen werden kann. <br><br>  Der Entwickler sollte sich diesen Abschnitt des Codes genauer ansehen, da m√∂glicherweise ein Fehler vorliegt.  Dar√ºber hinaus wurde im Code die folgende Klasse gefunden, die nicht verwendet wird: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ReadLockToken</span></span> : <span class="hljs-title"><span class="hljs-title">IDisposable</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ReaderWriterLockSlim _sync; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ReadLockToken</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ReaderWriterLockSlim sync</span></span></span><span class="hljs-function">)</span></span> { _sync = sync; sync.EnterReadLock(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Dispose</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_sync != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { _sync.ExitReadLock(); _sync = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } } }</code> </pre> <br>  <b>PVS-Studio Warnung:</b> <a href="https://www.viva64.com/ru/w/v3021/">V3021</a> Es gibt zwei If-Anweisungen mit identischen Bedingungsausdr√ºcken.  Die erste 'if'-Anweisung enth√§lt die Methode return.  Dies bedeutet, dass die zweite "if" -Anweisung sinnlos ist. SkiaEncoder.cs 537 <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EncodeImage</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> inputPath, DateTime dateModified, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> outputPath, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> autoOrient, ImageOrientation? orientation, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> quality, ImageProcessingOptions options, ImageFormat selectedOutputFormat</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.IsNullOrWhiteSpace(inputPath)) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentNullException(<span class="hljs-string"><span class="hljs-string">"inputPath"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.IsNullOrWhiteSpace(inputPath)) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentNullException(<span class="hljs-string"><span class="hljs-string">"outputPath"</span></span>); } .... }</code> </pre> <br>  Hier hat der Entwickler anscheinend die ersten vier Zeilen kopiert, aber vergessen, die getestete Variable von <i>inputPath</i> in <i>outputPath</i> zu <i>√§ndern</i> .  Der Code enth√§lt mehrere Zeilen, die <i>outputPath verwenden,</i> ohne auf <i>null</i> zu pr√ºfen, was dazu f√ºhren kann, dass eine Ausnahme ausgel√∂st wird. <br><br>  <b>PVS-Studio Warnungen:</b> <br><br><ul><li>  V3022 Der Ausdruck 'processUnsupportedFrame (frame, CloseStatusCode.PolicyViolation, null)' ist immer falsch.  WebSocket.cs 462 </li><li>  V3022 Der Ausdruck 'processCloseFrame (frame)' ist immer falsch.  WebSocket.cs 461 </li><li>  V3022 Ausdruck 'frame.IsClose?  processCloseFrame (frame): processUnsupportedFrame (frame, CloseStatusCode.PolicyViolation, null) 'ist immer false.  WebSocket.cs 460 </li><li>  V3022 Der Ausdruck 'processPongFrame (frame)' ist immer wahr.  WebSocket.cs 459 </li><li>  V3022 Der Ausdruck 'processPingFrame (frame)' ist immer wahr.  WebSocket.cs 457 </li><li>  V3022 Der Ausdruck 'processDataFrame (frame)' ist immer wahr.  WebSocket.cs 455 </li><li>  V3022 Ausdruck ist immer falsch.  WebSocket.cs 448 </li></ul><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">processWebSocketFrame</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">WebSocketFrame frame</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> frame.IsCompressed &amp;&amp; _compression == CompressionMethod.None ? processUnsupportedFrame(....) : frame.IsFragmented ? processFragmentedFrame(frame) : frame.IsData ? processDataFrame(frame) : frame.IsPing ? processPingFrame(frame) : frame.IsPong ? processPongFrame(frame) : frame.IsClose ? processCloseFrame(frame) : processUnsupportedFrame(....); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">processUnsupportedFrame</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">....</span></span></span><span class="hljs-function">)</span></span> { processException(....); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">processDataFrame</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">WebSocketFrame frame</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">processPingFrame</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">WebSocketFrame frame</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> mask = Mask.Unmask; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">processPongFrame</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">WebSocketFrame frame</span></span></span><span class="hljs-function">)</span></span> { _receivePong.Set(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">processCloseFrame</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">WebSocketFrame frame</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> payload = frame.PayloadData; close(payload, !payload.ContainsReservedCloseStatusCode, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; }</code> </pre> <br>  In meinem Konto gibt es im Vergleich zum Rest des PVS-Studio-Teams nicht so viele, die vom Projektanalysator √ºberpr√ºft wurden. Dies h√§ngt m√∂glicherweise damit zusammen, dass ich zum ersten Mal sehe, dass in 13 Codezeilen bis zu 13 Warnungen des Analysators ausgegeben werden (etwas mehr als jede zweite Zeile).  Daher glaube ich, dass dieser Code es verdient, in den Artikel aufgenommen zu werden.  Als n√§chstes schreibe ich auf, worauf der Analysator speziell schw√∂rt. <br><br><ol><li>  Zun√§chst wird der Ausdruck <i>frame.IsCompressed &amp;&amp; _compression == CompressionMethod.None ber√ºcksichtigt</i> . Wenn der Ausdruck true ist, wird die <i>processUnsupportedFrame-</i> Methode ausgef√ºhrt, die in jedem Fall <i>false</i> zur√ºckgibt (daher die erste Warnung des Analysators).  Wenn es falsch war, fahren Sie mit dem n√§chsten Punkt fort. </li><li>  Als n√§chstes wird der Wert von <i>frame.IsFragmented √ºberpr√ºft</i> .  Es gibt keine Probleme, also lasst uns weitermachen. </li><li>  Hier wird der Wert von <i>frame.IsData gepr√ºft</i> .  Wenn true, gibt die <i>processDataFrame-</i> Methode trotzdem <i>true zur√ºck</i> .  Daher die zweite Warnung des Analysators. </li><li>  Dann √ºberpr√ºfen wir <i>frame.IsPing</i> .  True - <i>processPingFrame gibt</i> <i>true zur√ºck</i> .  Dies ist die dritte Warnung des Analysators. </li><li>  Wir schauen uns <i>frame.IsPong an</i> .  Alles ist √§hnlich wie beim Vorg√§nger. </li><li>  Und der letzte: <i>frame.IsClose</i> .  <i>processCloseFrame</i> und <i>processUnsupportedFrame geben</i> auf jeden Fall <i>false zur√ºck</i> . </li></ol><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/sq/ut/pe/squtpenxx02rmgsg31uyqk7yt6q.png" alt="Bild 1"></div><br>  Ich hoffe, ich habe dich nicht langweilen.  Es wird weiter einfacher sein. <br><br>  <b>PVS-Studio Warnung:</b> <a href="https://www.viva64.com/ru/w/v3085/">V3085</a> Der Name des Feldes 'RtpHeaderBytes' in einem verschachtelten Typ ist nicht eindeutig.  Der √§u√üere Typ enth√§lt ein statisches Feld mit identischem Namen.  HdHomerunUdpStream.cs 200 <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">HdHomerunUdpStream</span></span> : <span class="hljs-title"><span class="hljs-title">LiveStream</span></span>, <span class="hljs-title"><span class="hljs-title">IDirectStreamProvider</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> RtpHeaderBytes = <span class="hljs-number"><span class="hljs-number">12</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">UdpClientStream</span></span> : <span class="hljs-title"><span class="hljs-title">Stream</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> RtpHeaderBytes = <span class="hljs-number"><span class="hljs-number">12</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> PacketSize = <span class="hljs-number"><span class="hljs-number">1316</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> MediaBrowser.Model.Net.ISocket _udpClient; <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> disposed; .... } .... }</code> </pre> <br>  Die verschachtelte Klasse <i>UdpClientStream</i> verwendet ein Feld mit einem Namen, der dem in der externen Klasse <i>HdHomerunUdpStream</i> verwendeten <i>√§hnlich ist</i> .  Dies ist kein Fehler, aber es ist ein guter Grund zu pr√ºfen, ob mit diesem Code alles in Ordnung ist.  Das Problem besteht darin, dass diese beiden Variablen m√∂glicherweise verwechselt werden und der Code nicht wie vom Entwickler beabsichtigt funktioniert, obwohl dies keine Beschwerden des Compilers zur Folge hat. <br><br>  <b>PVS-Studio Warnungen:</b> <br><br><ul><li>  V3090 Unsichere Verriegelung eines Typs.  Alle Instanzen eines Typs haben dasselbe 'Type'-Objekt.  Lmhosts.cs 49 </li><li>  V3090 Unsichere Verriegelung eines Typs.  Alle Instanzen eines Typs haben dasselbe 'Type'-Objekt.  Lmhosts.cs 57 </li></ul><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Lmhosts</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> NbtAddress </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetByName</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> host</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">lock</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(Lmhosts)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> GetByName(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Name(host, <span class="hljs-number"><span class="hljs-number">0x20</span></span>, <span class="hljs-literal"><span class="hljs-literal">null</span></span>)); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">internal</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> NbtAddress </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetByName</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Name name</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">lock</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(Lmhosts)) { .... } } }</code> </pre> <br>  Der Analysator warnt, dass in diesem Codefragment eine unsichere Sperre verwendet wird.  Die Verwendung der <i>Sperre ist</i> unerw√ºnscht, da das zum Sperren verwendete Objekt gemeinsam genutzt wird und an anderer Stelle gesperrt werden kann, ohne dass der Entwickler, der dieses Objekt zum ersten Mal verwendet hat, davon Kenntnis hat.  Das Ergebnis ist ein Deadlock f√ºr dasselbe Objekt. <br><br>  Idealerweise sollten Sie ein privates Feld zum Sperren verwenden, zum Beispiel so: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Object locker = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Object(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> NbtAddress </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetByName</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> host</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">lock</span></span> (locker) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> GetByName(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Name(host, <span class="hljs-number"><span class="hljs-number">0x20</span></span>, <span class="hljs-literal"><span class="hljs-literal">null</span></span>)); } }</code> </pre> <br>  <b>PVS-Studio Warnung:</b> <a href="https://www.viva64.com/ru/w/v3142/">V3142</a> Unerreichbarer Code erkannt.  M√∂glicherweise liegt ein Fehler vor.  HdHomerunHost.cs 621 <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> Task&lt;ILiveStream&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetChannelStream</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">....</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> enableHttpStream = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (enableHttpStream) { mediaSource.Protocol = MediaProtocol.Http; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> httpUrl = channelInfo.Path; <span class="hljs-comment"><span class="hljs-comment">// If raw was used, the tuner doesn't support params if (!string.IsNullOrWhiteSpace(profile) &amp;&amp; !string.Equals(profile, "native", StringComparison.OrdinalIgnoreCase)) { httpUrl += "?transcode=" + profile; } mediaSource.Path = httpUrl; return new SharedHttpStream(....); } return new HdHomerunUdpStream(....); }</span></span></code> </pre> <br>  Der Analyzer gibt an, dass die letzte Zeile in diesem Codefragment niemals ausgef√ºhrt wird.  Und warum deklariert und setzt der Entwickler die Variable enableHttpStream auf true und √ºberpr√ºft diese Variable dann sofort in der if-Anweisung? <br><br>  Vielleicht ist dieser Code einfach √ºberfl√ºssig.  In jedem Fall lohnt sich eine √úberpr√ºfung. <br><br>  <b>PVS-Studio Warnung:</b> <a href="https://www.viva64.com/ru/w/v3083/">V3083</a> Unsicherer Aufruf des Ereignisses 'RefreshStarted', NullReferenceException ist m√∂glich.  √úberlegen Sie, ob Sie einer lokalen Variablen ein Ereignis zuweisen m√∂chten, bevor Sie sie aufrufen.  ProviderManager.cs 943 <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnRefreshStart</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">BaseItem item</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (RefreshStarted != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { RefreshStarted(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> GenericEventArgs&lt;BaseItem&gt;(item)); } }</code> </pre> <br>  Diese Methode verwendet einen m√∂glicherweise unsicheren Aufruf des <i>RefreshStarted-</i> Ereignishandlers, wie vom Analyzer angegeben. <br><br>  Jetzt werde ich erkl√§ren, warum der Analysator diesen Aufruf <i>RefreshStarted</i> im Code als unsicher eingestuft hat.  Angenommen, zwischen der √úberpr√ºfung auf <i>Null</i> und dem direkten Aufrufen des Ereignishandlers im <i>if-</i> Body wird eine Abmeldung vom Ereignis in einem anderen Thread durchgef√ºhrt.  Und wenn keine weiteren Abonnenten vorhanden sind, ist <i>RefreshStarted</i> <i>null</i> .  In einem anderen Thread, in dem bereits eine <i>Nullpr√ºfung</i> stattgefunden hat, wird die folgende Zeile ausgef√ºhrt: <br><pre> <code class="cs hljs">RefreshStarted(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> GenericEventArgs&lt;BaseItem&gt;(item));</code> </pre> <br>  Dies <i>l√∂st</i> eine <i>NullReferenceException aus</i> . <br><br>  <b>PVS-Studio Warnung:</b> <a href="https://www.viva64.com/ru/w/v3029/">V3029</a> Die bedingten Ausdr√ºcke der <a href="https://www.viva64.com/ru/w/v3029/">nebeneinander stehenden</a> ' <a href="https://www.viva64.com/ru/w/v3029/">if'</a> -Anweisungen sind identisch.  √úberpr√ºfen Sie die Zeilen: 142, 152. LocalImageProvider.cs 142 <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PopulateImages</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">....</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-comment"><span class="hljs-comment">// Logo if (!isEpisode &amp;&amp; !isSong &amp;&amp; !isPerson) { added = AddImage(....); if (!added) { added = AddImage(....); } } // Art if (!isEpisode &amp;&amp; !isSong &amp;&amp; !isPerson) { AddImage(....); } .... }</span></span></code> </pre> <br>  In diesem Codeteil stehen zwei <i>if-Anweisungen</i> mit denselben Bedingungen nebeneinander.  Die K√∂rper der <i>if-Anweisungen</i> sind unterschiedlich.  Schwer zu sagen, ob dies ein Fehler oder ein redundanter Code ist.  Vielleicht ist alles in Ordnung und der Autor wollte nur zwei verschiedene Aktionen logisch trennen, von denen eine mit einem bestimmten ‚ÄûLogo‚Äú und die andere mit einer bestimmten ‚ÄûKunst‚Äú verkn√ºpft ist. <br><br>  <b>PVS-Studio Warnung:</b> <a href="https://www.viva64.com/ru/w/v3041/">V3041</a> Der Ausdruck wurde implizit vom Typ 'int' in den Typ 'double' umgewandelt.  Erw√§gen Sie die Verwendung einer expliziten Typumwandlung, um den Verlust eines Bruchteils zu vermeiden.  Ein Beispiel: double A = (double) (X) / Y;  LiveTvManager.cs 1085 <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> Task </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RefreshChannelsInternal</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">....</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> progressPerService = _services.Length == <span class="hljs-number"><span class="hljs-number">0</span></span> ? <span class="hljs-number"><span class="hljs-number">0</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span> / _services.Length; .... }</code> </pre> <br>  Dieser Code enth√§lt die Operation zum Teilen ganzzahliger Datentypen.  Der resultierende Wert wird implizit in einen Gleitkommatyp konvertiert, was √§u√üerst verd√§chtig ist. <br><br>  Tats√§chlich ist die Variable <i>progressPerService</i> nur dann gleich 1.0, wenn <i>_services.Length = 1 ist</i> .  F√ºr alle anderen <i>_services.Length-</i> Werte ist das Ergebnis <i>0.0</i> . <br><br>  Anscheinend sollte es hier geschrieben werden: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">double</span></span> progressPerService = _services.Length == <span class="hljs-number"><span class="hljs-number">0</span></span> ? <span class="hljs-number"><span class="hljs-number">0</span></span> : (<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>)<span class="hljs-number"><span class="hljs-number">1</span></span> / _services.Length;</code> </pre> <br><br>  <b>PVS-Studio Warnung:</b> <a href="https://www.viva64.com/ru/w/v3050/">V3050</a> M√∂glicherweise falsches HTML.  Das &lt;/ u&gt; schlie√üende Tag wurde gefunden, w√§hrend das &lt;/ i&gt; -Tag erwartet wurde.  SrtParserTests.cs 64 <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TestParse</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> expectedSubs = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SubtitleTrackInfo { TrackEvents = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SubtitleTrackEvent[] { .... <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SubtitleTrackEvent { Id = <span class="hljs-string"><span class="hljs-string">"6"</span></span>, StartPositionTicks = <span class="hljs-number"><span class="hljs-number">330000000</span></span>, EndPositionTicks = <span class="hljs-number"><span class="hljs-number">339990000</span></span>, Text = <span class="hljs-string"><span class="hljs-string">"This contains nested &lt;b&gt;bold, &lt;i&gt;italic, &lt;u&gt;underline&lt;/u&gt; and &lt;s&gt;strike-through&lt;/s&gt;&lt;/u&gt;&lt;/i&gt;&lt;/b&gt; HTML tags"</span></span> }, .... } }; }</code> </pre> <br>  Achten Sie auf die Linie <br><br><pre> <code class="cs hljs">&lt;u&gt;underline&lt;/u&gt;</code> </pre> <br>  Es hat bereits ein schlie√üendes Tag <i>&lt;/ u&gt;</i> .  Als n√§chstes sehen wir diesen Text: <br><pre> <code class="cs hljs">&lt;/s&gt;&lt;/u&gt;&lt;/i&gt;&lt;/b&gt; HTML tags<span class="hljs-string"><span class="hljs-string">"</span></span></code> </pre> <br>  Hier ist das schlie√üende Tag <i>&lt;/ u&gt;</i> √ºberfl√ºssig, wie der Analysator angibt. <br>  <b>Warnung PVS-Studio:</b> <a href="https://www.viva64.com/ru/w/v3051/">V3051</a> Eine √ºberm√§√üige Typpr√ºfung.  Das Objekt ist bereits vom Typ 'Ausnahme'.  SmbFileInputStream.cs 107 <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">internal</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> IOException </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SeToIoe</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">SmbException se</span></span></span><span class="hljs-function">)</span></span> { IOException ioe = se; Exception root = se.GetRootCause(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (root <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> TransportException) { ioe = (TransportException)root; root = ((TransportException)ioe).GetRootCause(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (root <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> Exception) { ioe = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IOException(root.Message); ioe.InitCause(root); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ioe; }</code> </pre> <br>  Und hier ist offen gesagt nicht ganz klar, was der Entwickler generell erreichen wollte.  Der Analyzer warnt, dass die zweite <i>if-Anweisung</i> das <i>Stammobjekt</i> auf Kompatibilit√§t mit seinem eigenen Typ √ºberpr√ºft.  H√∂chstwahrscheinlich ist dies nur redundanter Code, aber er sieht verd√§chtig aus. Der Entwickler sollte ihn sich genauer ansehen. <br><br><h2>  Fazit </h2><br>  In jeder Hinsicht haben die Entwickler bei der Entwicklung von Emby gro√üartige Arbeit geleistet (das Projekt enth√§lt 215.539 Codezeilen, 4,6% - Kommentare).  Sie sind wirklich gro√üartig.  Der Analysator hat es jedoch auch versucht, indem er Warnungen mit <a href="https://www.viva64.com/ru/m/0007/">den Pegeln "</a> Hoch - 113", "Mittel - 213" und "Niedrig - 112" ausgegeben hat. <br><br>  Beispielsweise wurden <a href="https://www.viva64.com/ru/w/v3022/">allein bei</a> den Warnungen <a href="https://www.viva64.com/ru/w/v3022/">V3022</a> (der Ausdruck ist immer falsch / wahr) 106 <a href="https://www.viva64.com/ru/w/v3022/">Punkte</a> erzielt.  Sie k√∂nnen nat√ºrlich √ºberpr√ºfen, welcher Teil von ihnen falsch positiv war, und den Rest dem Artikel hinzuf√ºgen, aber dies f√ºhrt zu einem sehr langweiligen Text, den niemand lesen wird. <br><br>  Ich hoffe, es ist mir gelungen, die N√ºtzlichkeit des statischen Analysators in der Entwicklung zu demonstrieren.  Einmalige √úberpr√ºfungen reichen nat√ºrlich nicht aus, und ein statischer Analysator muss st√§ndig verwendet werden.  Weitere Informationen hierzu finden Sie im Artikel <a href="https://www.viva64.com/ru/b/0594/">Godot: Zur regelm√§√üigen Verwendung von Static Code Analyzers</a> . <br><br><p> <a href="https://habr.com/en/company/pvs-studio/blog/484046/"><img src="https://habrastorage.org/getpro/habr/post_images/898/3b6/5a7/8983b65a74adb29a2113eba12fbec3f1.png" align="left"></a> </p><br><br>  Wenn Sie diesen Artikel mit einem englischsprachigen Publikum teilen m√∂chten, verwenden Sie bitte den Link zur √úbersetzung: Ekaterina Nikiforova.  <a href="https://habr.com/en/company/pvs-studio/blog/484046/">Emby mit PVS-Studio √ºberpr√ºfen</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de484050/">https://habr.com/ru/post/de484050/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de484028/index.html">Horseshoe Bend - Cabrio-Tablet mit Klappdisplay</a></li>
<li><a href="../de484034/index.html">Umsetzung des Arbeitsschemas der gezielten Warenlagerung auf Basis der Lagerabrechnungseinheit 1C Integrated Automation 2</a></li>
<li><a href="../de484036/index.html">Neue Industriegruppe schafft universellen Standard f√ºr Smart Homes</a></li>
<li><a href="../de484046/index.html">Emby mit PVS-Studio √ºberpr√ºfen</a></li>
<li><a href="../de484048/index.html">PHP und regul√§re Ausdr√ºcke: die Grundlagen f√ºr Anf√§nger</a></li>
<li><a href="../de484052/index.html">Aufgaben f√ºr die Mondbasis</a></li>
<li><a href="../de484056/index.html">Brauchen Sie f√ºr Ihr Projekt wirklich Tests?</a></li>
<li><a href="../de484062/index.html">Englisch lernen mit MEMASICS</a></li>
<li><a href="../de484064/index.html">Wie bereite ich ein Spiel f√ºr die Lokalisierung vor? 10 Grundregeln</a></li>
<li><a href="../de484066/index.html">Geld gegen Team. Nicht die offensichtlichsten Aspekte des Verh√§ltnisses von Unternehmern, Gr√ºndern und Investoren</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>