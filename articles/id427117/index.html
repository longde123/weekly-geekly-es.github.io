<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§πüèΩ ü¶Å üñ•Ô∏è Ruang pertemuan berdasarkan Asterisk üë∂üèΩ üßëüèæ‚Äçü§ù‚Äçüßëüèª üïµÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Kata Pengantar 
 Selamat siang 

 Ada 2 hal yang mendorong saya untuk menulis artikel ini: sejumlah kecil atau kurangnya contoh kerja modern pada "chi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Ruang pertemuan berdasarkan Asterisk</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/427117/"><h3>  Kata Pengantar </h3><br>  Selamat siang <br><br>  Ada 2 hal yang mendorong saya untuk menulis artikel ini: sejumlah kecil atau kurangnya contoh kerja modern pada "chip" Asterisk, serta keengganan spesialis untuk berbagi "chip" yang sama ini dengan yang lain.  Inilah saya sekarang tentang komunitas RU.  Segala macam "Kakek" di forum lebih cenderung menghujani Anda dengan slop dan mengirim Anda membaca buku sepuluh tahun yang lalu daripada memberikan sedikit informasi yang bermanfaat.  Topik-topik forum itu sendiri, dibuat pada 2005-2010, sudah sangat ketinggalan zaman dan kadang-kadang ada sesuatu yang telah digergaji dari versi asterisk saat ini, dan sesuatu perlu dikerjakan ulang untuk membuatnya berfungsi. <br><a name="habracut"></a><br>  Jadi disini. <br>  Sebagai akibat dari pengabaian CUCM demi Asterisk, manajemen ditugasi menjaga layanan paling populer di kalangan pengguna dalam bentuk paling asli, agar tidak membuat orang frustrasi.  Salah satunya adalah penciptaan konferensi.  Pada saat itu, saya sudah terbiasa dengan Asterisk, tetapi tidak terlalu dalam, jadi saya butuh sekitar satu setengah minggu untuk memilah-milah semua jenis opsi konferensi, dan tugas yang berbeda muncul dengan keputusan akhir. <br><br>  Masalahnya adalah bahwa dari solusi yang mirip dengan itu ada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">artikel</a> dengan meetme yang sudah ketinggalan zaman, serta beberapa jenis <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">monster</a> yang saya masih belum bisa mulai bekerja.  Saya menyarankan sesuatu yang tidak terlalu besar. <br><cut></cut><br><h3>  Bubur kertas </h3><br>  Saya tidak akan menjelaskan apa itu jembatan, bagian mana dalam konfigurasi tertentu yang bertanggung jawab dan apa opsi ini, saya hanya akan memiliki informasi ini dan mutakhir.  Sekarang tentang keputusan secara keseluruhan. <br><br>  Tujuan: membuat konferensi dimungkinkan untuk dibuat selama percakapan, dan kemudian mengundang lebih banyak pelanggan di sana.  Masalah utama adalah bahwa fungsi channelredirect tidak berfungsi seperti yang kita inginkan.  Artinya, jika Anda menjalankannya dari dialplan selama percakapan, maka salah satu saluran akan terbang di mana diperlukan, dan yang kedua akan runtuh, dan memanjat seluruh dialplan menjadi 2 baris dan mendaftarkan opsi g pada Dials adalah malas.  Dan saya tidak mengerti mengapa dalam kebanyakan manual semua orang mencoba menyelesaikan masalah hanya melalui dialplan, mengabaikan kemampuan asterisk untuk bekerja dengan skrip eksternal dan ami. <br><cut></cut><br>  Jadi  Asterisk 14.4.0 <br><br>  Skrip konferensi untuk 2 opsi (dengan komentar): <br><br><div class="spoiler">  <b class="spoiler_title">conference.php</b> <div class="spoiler_text"><pre><code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">//    $host = "192.168.1.1"; $port = "5038"; $timeout = "10"; $user = "conference"; $pass = "1111"; // ,    1   2  $kusok = $argv[1]; //       if ($kusok == 1){ //  $channel = $argv[2]; $bridgepeer = $argv[3]; $confnum = $argv[4]; print_r($bridgepeer); print_r($confnum); // $sconn = fsockopen ($host, $port, $timeout) or die ("Connection to $host:$port failed!"); fputs ($sconn, "Action: Login\r\n"); fputs ($sconn, "Username: $user\r\n"); fputs ($sconn, "Secret: $pass\r\n\r\n"); //   fputs ($sconn, "Action: Setvar\r\n"); fputs ($sconn, "Channel: $channel\r\n"); fputs ($sconn, "Variable: CONFNUM\r\n"); fputs ($sconn, "Value: $confnum\r\n\r\n"); fputs ($sconn, "Action: Setvar\r\n"); fputs ($sconn, "Channel: $bridgepeer\r\n"); fputs ($sconn, "Variable: CONFNUM\r\n"); fputs ($sconn, "Value: $confnum\r\n\r\n"); // fputs ($sconn, "Action: Redirect\r\n"); fputs ($sconn, "Channel: $bridgepeer\r\n"); fputs ($sconn, "ExtraChannel: $channel\r\n"); fputs ($sconn, "Context: service_code-ael\r\n"); fputs ($sconn, "Exten: conference\r\n"); fputs ($sconn, "Priority: 1\r\n\r\n"); fputs($sconn, "Action: Logoff\r\n\r\n"); sleep(2); fclose ($sconn); } //     if ($kusok == 2) { //  $confnum = $argv[2]; $inviten = $argv[3]; $sconn = fsockopen ($host, $port, $errno, $errstr, $timeout) or die ("Connection to $host:$port failed!"); // fputs ($sconn, "Action: Login\r\n"); fputs ($sconn, "Username: $user\r\n"); fputs ($sconn, "Secret: $pass\r\n\r\n"); //     fputs ($sconn, "Action: Originate\r\n"); fputs ($sconn, "Channel: Local/".$inviten."@out-ael\r\n"); fputs ($sconn, "Context: service_code-ael\r\n"); fputs ($sconn, "Exten: conference\r\n"); fputs ($sconn, "Priority: 1\r\n"); fputs ($sconn, "Variable: CONFNUM=".$confnum."\r\n\r\n"); fputs($sconn, "Action: Logoff\r\n\r\n"); sleep(2); fclose ($sconn); } }</span></span></code> </pre> <br></div></div><br>  Pemrograman guru dapat memperbaiki kode dengan membuat permen dari itu, saya menulis sebaik mungkin. <br>  Selanjutnya, kita mulai menggunakan skrip ini secara langsung di Asterisk itu sendiri. <br><br>  Untuk membuat konferensi, saya memilih kombinasi * 1.  Secara singkat dan tidak berpotongan dengan penomoran utama. <br><br>  Tambahkan panggilan skrip ke features.conf dengan variabel yang diperlukan diteruskan ke sana <br><br><pre> <code class="hljs ruby">[applicationmap] conference =&gt; *<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>,System(<span class="hljs-regexp"><span class="hljs-regexp">/usr/bin</span></span><span class="hljs-regexp"><span class="hljs-regexp">/php /home</span></span><span class="hljs-regexp"><span class="hljs-regexp">/script/conference</span></span>.php <span class="hljs-number"><span class="hljs-number">1</span></span> ${CHANNEL} ${BRIDGEPEER} ${CALLERID(num)})</code> </pre><br>  Kemudian, agar ini berfungsi, buat variabel di dialplan di bagian [global] dan tambahkan fitur kami <br><br><pre> <code class="hljs">DYNAMIC_FEATURES=conference</code> </pre> <br>  Untuk menambahkan peserta baru ke konferensi yang sudah dibuat, Anda harus mendaftarkan kode di confbridge.conf <br><br><pre> <code class="hljs haskell">[default_menu] <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> = menu *1=dialplan_exec(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">service_code</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ael</span></span></span><span class="hljs-class">,</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">conference_add</span></span></span><span class="hljs-class">,1)</span></span></code> </pre><br>  Nah, sekarang bagian terbaiknya adalah extensions.ael: <br><br>  Untuk membuat konferensi (skrip php membahas kedua saluran bicara di sini): <br><br><pre> <code class="hljs perl"> <span class="hljs-string"><span class="hljs-string">conference =&gt;</span></span> { ConfBridge(${CONFNUM},,,default_menu); }</code> </pre><br>  Untuk menambahkan pengguna baru (alamat dialplan_exec di sini): <br><br><pre> <code class="hljs ruby">conference_add =&gt; { Read(INVITEN,dial,<span class="hljs-number"><span class="hljs-number">11</span></span>,i); System(<span class="hljs-regexp"><span class="hljs-regexp">/usr/bin</span></span><span class="hljs-regexp"><span class="hljs-regexp">/php /home</span></span><span class="hljs-regexp"><span class="hljs-regexp">/script/conference</span></span>.php <span class="hljs-number"><span class="hljs-number">2</span></span> ${CALLERID(num)} ${INVITEN}); }</code> </pre><br>  Itu saja.  Tidak ada kode dalam dialplan.  Semuanya luas.  * 1 dalam percakapan dan Anda berada di sebuah conf, lagi * 1 bip dan panggilan, siapa yang akan ditambahkan. <br><br><h3>  Pertumbuhan </h3><br>  Bingung dengan keinginan pengguna, saya mulai mengembangkan fitur ini. <br><br>  Yang berikutnya adalah kesempatan untuk membuat konferensi dari awal (bukan dari percakapan), serta pergi ke konferensi yang sudah dibuat dengan nomor mereka, dan tidak menunggu panggilan undangan <br><br>  Tambahkan ke dialplan: <br><br><pre> <code class="hljs ruby"><span class="hljs-number"><span class="hljs-number">_</span></span>*<span class="hljs-number"><span class="hljs-number">1</span></span>XXXX =&gt; { NoOp(${CONFCHAN}); Set(__CONFNUM=${<span class="hljs-symbol"><span class="hljs-symbol">EXTEN:</span></span><span class="hljs-number"><span class="hljs-number">2</span></span>}); System(<span class="hljs-regexp"><span class="hljs-regexp">/usr/bin</span></span><span class="hljs-regexp"><span class="hljs-regexp">/php /home</span></span><span class="hljs-regexp"><span class="hljs-regexp">/script/conference</span></span>.php <span class="hljs-number"><span class="hljs-number">3</span></span> ${CONFCHAN} ${CONFNUM} ); }</code> </pre><br>  Tambahkan ke skrip: <br><br><div class="spoiler">  <b class="spoiler_title">conference.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">//     if ($kusok == 3){ //  $channel = $argv[2]; $confnum = $argv[3]; // $sconn = fsockopen ($host, $port, $timeout) or die ("Connection to $host:$port failed!"); fputs ($sconn, "Action: Login\r\n"); fputs ($sconn, "Username: $user\r\n"); fputs ($sconn, "Secret: $pass\r\n\r\n"); //   fputs ($sconn, "Action: Setvar\r\n"); fputs ($sconn, "Channel: $channel\r\n"); fputs ($sconn, "Variable: CONFNUM\r\n"); fputs ($sconn, "Value: $confnum\r\n\r\n"); // fputs ($sconn, "Action: Redirect\r\n"); fputs ($sconn, "Channel: $channel\r\n"); fputs ($sconn, "Context: service_code-ael\r\n"); fputs ($sconn, "Exten: conference\r\n"); fputs ($sconn, "Priority: 1\r\n\r\n"); fputs($sconn, "Action: Logoff\r\n\r\n"); sleep(2); fclose ($sconn);</span></span></code> </pre> <br></div></div><br>  Saya juga harus memodifikasi baris _ * X. <br><br><pre> <code class="hljs perl"> <span class="hljs-number"><span class="hljs-number">_</span></span>*X. =&gt; { set(__CONFCHAN=${CHANNEL}); Dial(Local/${EXTEN}@service_code-ael);</code> </pre><br>  Sekarang, untuk memasuki konferensi atau membuatnya dari awal, Anda cukup melakukan panggilan ke * 1 dan nomor, misalnya * 15234. <br><br>  Mutasi terakhir dari layanan ini adalah apa yang disebut "konferensi kelompok".  Ini adalah saat bos besar terlalu malas untuk menambahkan semua orang secara manual, tetapi saya ingin menekan satu tombol dan semuanya sudah terpasang.  Untuk melakukan ini, saya memutuskan untuk membuat kode layanan terpisah (* XXX) sehingga orang-orang itu sendiri tidak akan bingung.  Untuk organisasi kami, lebih dari 1000 grup konferensi kemungkinan tidak diperlukan dalam 100 tahun ke depan, jadi harus ada stok penomoran yang cukup.  Di rumah, Anda dapat menambahkan awalan yang berbeda, jadi pilih kapasitas penomoran yang berbeda. <br><br>  Dialplan: <br><br><pre> <code class="hljs ruby"> <span class="hljs-number"><span class="hljs-number">_</span></span>*XXX=&gt; { Set(CONFNUM=${CALLERID(num)}); System(<span class="hljs-regexp"><span class="hljs-regexp">/usr/bin</span></span><span class="hljs-regexp"><span class="hljs-regexp">/php /home</span></span><span class="hljs-regexp"><span class="hljs-regexp">/script/groups</span></span>.php ${<span class="hljs-symbol"><span class="hljs-symbol">EXTEN:</span></span><span class="hljs-number"><span class="hljs-number">1</span></span>} ${CONFNUM}); ConfBridge(${CONFNUM},,,default_menu); }</code> </pre><br>  Derit peserta sendiri: <br><br><div class="spoiler">  <b class="spoiler_title">groups.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">//  function call ($group, $confnum) { $many = count($group); //       for ($i=0; $many&gt;$i; $i++) { //    $num = trim(array_shift($group[$i])); // system("asterisk -rx \"channel originate Local/$num@out-ael application ConfBridge $confnum\""); } } //    function conf_group ($groupid) { //   $opt = array( PDO::ATTR_ERRMODE =&gt; PDO::ERRMODE_EXCEPTION, PDO::ATTR_DEFAULT_FETCH_MODE =&gt; PDO::FETCH_ASSOC ); $pdo = new PDO("odbc:mssql_asterisk, "asterisk, "121212", $opt); //   $sql = "SELECT extension FROM [asterisk].[dbo].[conf_groups] where groupid = $groupid"; $select = $pdo-&gt;query($sql); $result = $select-&gt;fetchAll(); // $pdo = NULL; return $result; } //  ,    $groupid = $argv[1]; //   $confnum = $argv[2]; //   $group=conf_group($groupid); // call($group, $confnum); }</span></span></code> </pre><br></div></div><br>  Semua grup disimpan dalam database sesuai dengan struktur "Grup, nomor, nama, deskripsi".  Jika grup baru muncul, maka cukup tambahkan ke database. <br><br>  Sekarang, untuk mengumpulkan, misalnya, semua direktur untuk rapat, sang jenderal hanya perlu menekan * 100.  Dan sebagai aturan, bos besar memiliki telepon besar.  Oleh karena itu, kami mengikat * 100 ke tombol speeddial apa pun, kami menandatanganinya sebagai "direktur" dan pengguna tidak peduli apa yang harus diketik.  Saya menekan tombol - saya mengumpulkan pertemuan. <br><br>  <b>Sekarang mengantisipasi pertanyaan Anda:</b> <br><br>  Mengapa skrip dan ami?  Karena dengan dialplan saya tidak berhasil membuat pengalihan yang waras dari kedua saluran tanpa kehilangan mereka di sepanjang jalan.  Di ami, pada fungsi redirect, Anda dapat melampirkan saluran tambahan + mengatur variabel untuknya (misalnya, nomor konferensi, sehingga ia juga dapat menambahkan seseorang ke dalamnya). <br><br>  Anda juga dapat memperhatikan bahwa saya menempatkan fitur dalam konteks service_code-ael yang terpisah.  Ini nyaman ketika Anda memiliki lebih dari beberapa fitur.  Saya memutuskan untuk membuatnya melalui *, oleh karena itu, dalam konteks apa pun, saya hanya menulis _ * X.  dan alamatkan dalam konteks ini.  Mungkin seseorang akan menemukan solusi yang lebih elegan, tetapi saya belum menemukannya selama beberapa bulan.  Dan fungsi ini menarik bagi pengguna. <br><br>  Kenapa ael, bukan conf?  Ya, karena lebih terstruktur dan lebih mudah dibaca. <br>  dan lebih bisa dimengerti.  Satu fungsi gotoif sepadan.  Saya belum mencapai lua. <br><br>  Mengapa dalam pengumpulan massal, contoh berasal dilakukan melalui bash dan bukan melalui AMI?  Masalahnya adalah bahwa dengan mengeksekusi sekelompok berasal dari satu baris melalui ami, sistem menunggu yang sebelumnya untuk menyelesaikan untuk memberikan yang berikutnya.  Dan jika tidak ada yang mengangkat telepon, dan ada 20 detik no_ans dan 5 buah lainnya?  Anda bisa menunggu sampai malam untuk mengumpulkan. <br><br>  Yah, mungkin itu saja.  Saya harap artikel ini akan membantu para pencari yang sama seperti saya ketika semua ini perlu dilakukan dengan cepat, nyaman bagi pengguna, dan yang paling penting, di masa depan untuk menjaga sistem ini nyaman bagi saya sendiri, sehingga untuk berbicara, dengan cadangan untuk masa depan. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id427117/">https://habr.com/ru/post/id427117/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id427105/index.html">Belajar belajar: melanjutkan pendidikan adalah kunci daya saing di era ekonomi digital</a></li>
<li><a href="../id427107/index.html">Parsim X12 "di lutut"</a></li>
<li><a href="../id427109/index.html">Pembajakan di Luar Angkasa - Delta-V yang Lezat dan Hidrogen Stealth Steamboats - Bagian 1</a></li>
<li><a href="../id427111/index.html">Transformasi proses pengembangan dan pengiriman untuk aplikasi lawas</a></li>
<li><a href="../id427113/index.html">Array Gerbang yang Dapat Diprogram: Bagaimana Mereka Membantu Jaringan 5G</a></li>
<li><a href="../id427123/index.html">Turing game</a></li>
<li><a href="../id427129/index.html">Ancaman Intelijen - pendekatan modern terhadap keamanan informasi</a></li>
<li><a href="../id427131/index.html">Berkenalan dengan Audiomania: 15 materi tematik tentang produksi, desain, kantor, dan bisnis</a></li>
<li><a href="../id427133/index.html">Assortment - tugas optimasi klasik</a></li>
<li><a href="../id427135/index.html">Implementasi cutscene dan urutan aksi dalam game</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>