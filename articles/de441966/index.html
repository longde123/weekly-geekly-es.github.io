<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🍂 🐴 🙎🏿 Starter Kit zum Testen der Web-Sicherheit 💰 👨🏾‍🚒 🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo allerseits! 

 Mein Name ist Andrew. Seit 10 Jahren suche ich nach Schwachstellen in verschiedenen Webdiensten. und bereit, mein Wissen mit Ihne...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Starter Kit zum Testen der Web-Sicherheit</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/semrush/blog/441966/"> Hallo allerseits! <br><br>  Mein Name ist Andrew.  Seit 10 Jahren suche ich nach Schwachstellen in verschiedenen Webdiensten.  und bereit, mein Wissen mit Ihnen zu teilen.  Letzten Mai habe ich auf der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Heisenbug-</a> Konferenz darüber berichtet, und jetzt bin ich bereit, mein Wissen auch hier in den offenen Räumen von Habr zu teilen.  Also fangen wir an. <br><br>  Einmal <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">fand</a> ich <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">eine Schwachstelle</a> auf den Servern der berüchtigten Firma Facebook.  Die Jungs haben vergessen, ImageMagick (die Bibliothek für die Bildverarbeitung) zu aktualisieren und haben dafür bezahlt :) Mit diesem Beispiel wollte ich zeigen, dass wir alle Menschen sind und Fehler machen können, egal in welchen Unternehmen und in welchen Positionen wir arbeiten.  Das einzige Problem ist, dass diese Fehler zu allen möglichen Risiken führen können. <br>  Je komplizierter Ihre Anwendung / Website / Ihr Tool ist, desto wahrscheinlicher ist es, dass etwas schief geht. <br>  Sie müssen nach Schwachstellen suchen.  Es ist dumm, das überhaupt nicht zu tun. <br><a name="habracut"></a><br>  Die folgenden Elemente können Phasen der Überprüfung von Webanwendungen sein: <br><ul><li>  Vorbereitung: <ul><li>  Definieren Sie Einstiegspunkte - tatsächlich, woher die Daten in der Anwendung stammen können. </li><li>  Technologiebestand identifizieren; </li><li>  Bestimmen Sie, welche Schwachstellen überprüft werden müssen. </li></ul></li><li>  Überprüfung  Sie müssen alle Schwachstellen überprüfen, die für den technischen Bereich Ihrer Webanwendung gelten. </li><li>  Code-Analyse.  Seien Sie nicht faul, überspringen Sie diesen Artikel nicht.  In einigen Fällen ist es ohne Zugriff auf den Code schwierig, Schwachstellen zu finden, und Sie können auch die Filterung umgehen, die möglicherweise in Ihre Anwendung eingebettet ist. </li></ul><br>  Ich werde darüber ausführlich sprechen. <br><br>  Also Vorbereitung.  Ich werde mich nicht auf alle Arten von Sicherheitslücken konzentrieren, da sonst die Textmenge im Artikel alle denkbaren und unvorstellbaren Größen überschreitet.  Ich empfehle Ihnen, aus der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">OWASP Top Ten-Projektliste</a> zu lernen.  Alle paar Jahre erstellt <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">das OWASP-Konsortium</a> eine Liste der derzeit wichtigsten Schwachstellen.  Wir werden einige davon im Detail betrachten. <br><br><h2>  Xss </h2><br>  <i>XSS (Cross-Site Scripting)</i> ist ein Angriff auf einen Benutzer, bei dem ein Angreifer ein beliebiges Skript im Kontext des Browsers seines Opfers ausführen kann.  Meistens impliziert dies die Implementierung von <i>HTML-</i> Tags und <i>JS-</i> Skripten. <br>  Beispiel: Zu einer Zeit gab es einen solchen Dienst <i>Yahoo!</i>  <i>Ad Exchange</i>  Das Formular zur Kennwortwiederherstellung hatte den Parameter " <i>URL zurückgeben</i> ".  Es kann angeben, zu welcher Seite nach dem Zurücksetzen des Kennworts zurückgekehrt werden soll.  Wenn Sie dort den einen oder anderen Vektor einfügen, der zur Ausführung des <i>JS-</i> Codes führt, können Sie alle <i>Cookies</i> des Benutzers <i>abrufen</i> .  Wir werden analysieren, wie dies geschieht und warum. <br><img src="https://habrastorage.org/webt/0m/uz/t0/0muzt08lkueaenx2gle8ydaidce.png"><br><br>  Hier ist der Vektor selbst.  Auf einmal: <br><img src="https://habrastorage.org/webt/ua/ko/8l/uako8l_hpqr4bov7qmzhm97xwj4.png"><br>  Um eine Injektion durchzuführen, müssen Sie den Kontext der Variablen verlassen, in der wir uns standardmäßig befanden (standardmäßig - dies hat der Programmierer beim Schreiben des Codes angenommen). <br>  Unten ist der ursprüngliche Wert.  Dies ist ein gültiges Verhalten. <br><img src="https://habrastorage.org/webt/v4/rm/l7/v4rml7dzf1rqpkyvgq8yxdnl3oi.png"><br>  Wir sehen, dass returnURL = / login.jsp <br>  Dies fällt in den Wert des <i>&lt;input&gt; -Tags</i> . <br>  Wenn wir nach <i>jsp</i> ein Anführungszeichen <i>einfügen</i> , sehen wir, dass die <i>HTML-</i> Syntax überfüllt ist.  Glücklicherweise ist die <i>HTML-</i> Sprache nicht streng, der Parser überspringt und es gibt keine Probleme: <br><img src="https://habrastorage.org/webt/3o/s6/z1/3os6z130clrrtkshbktmqgkguto.png"><br>  Füge ein weiteres Zeichen hinzu.  Hier sind wir völlig aus dem Kontext des <i>&lt;input&gt; -Tags heraus</i> : <br><img src="https://habrastorage.org/webt/lg/x9/av/lgx9avfst6nskdlowyzx0uasgyy.png"><br>  Jetzt fügen wir die Öffnung des <i>&lt;svg&gt; -Tags hinzu</i> und erhalten zwei gültige Tags in Bezug auf die Syntax: <br><img src="https://habrastorage.org/webt/u8/pe/tg/u8petg6ghf1gajt49dvsvtfnzn0.png"><br>  Fügen Sie als Nächstes den gesamten Angriffsvektor hinzu: <br><img src="https://habrastorage.org/webt/o2/t5/n8/o2t5n8-li9jpdao1cbzghum-mhe.png"><br>  In diesem Fall wird das <i>SVG-</i> Bild gezeichnet.  Mit dem <i>JavaScript-</i> Handler " <i>onload</i> " führen wir eine Warnung mit den <i>Cookies des</i> Dokuments aus.  Das ist alles!  Der Angreifer hat Ihre <i>Cookies erhalten</i> . <br>  Wenn im Beweis nur die Warnung selbst angezeigt wird, ist es für einen Angreifer nicht schwierig, Cookies an einen von ihm kontrollierten Server zu senden und im schlimmsten Fall Ihr Konto zu beschlagnahmen.  Mal sehen, wie es wieder aussieht: <br><img src="https://habrastorage.org/webt/0m/uz/t0/0muzt08lkueaenx2gle8ydaidce.png"><br><br>  Es gibt auch mehr Angriffsmethoden auf den Client.  Ich werde einige Beispiele mit einer kurzen Beschreibung geben.  Aber zuerst müssen Sie verstehen, wie Sie aus dem Kontext herauskommen: <br><ul><li>  Aus dem Zusammenhang gerissen.  Diese 6 Zeichen helfen dabei, nicht nur aus dem Kontext des HTML-Parameterwerts herauszukommen, sondern auch aus vielen anderen: <br>  -&gt; '"&gt; <br></li></ul><br>  Nun, in der Tat, die zwei einfachsten Angriffsvektoren: <br><ul><li>  Fügen Sie insbesondere Links ein.  Aber im allgemeinen Fall - Ändern des Erscheinungsbilds der Seite.  Beispielsweise können sie HTML-Code in Ihre Seite einbetten und ein gefälschtes Fenster anzeigen, in dem nach Daten gefragt wird: <br><img src="https://habrastorage.org/webt/dt/-p/yz/dt-pyzv0wcrhgxqihw3iuoccbnc.png"><br>  Die Zeichenfolge " <i>aaaa</i> " zeigt auf <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">google.com</a> .  Sie können sehen, dass der Link auf der Seite gerendert wird, aber Sie sehen ihn möglicherweise nicht, aber dies hebt seine Anwesenheit im Code nicht auf.  In beiden Fällen kann der Fall als abgeschlossen betrachtet werden. </li><li>  Skriptausführung, zum Beispiel Abfangen von Benutzercookies: <br><img src="https://habrastorage.org/webt/w8/yd/yb/w8ydybkf9oucxuawq_vumapupda.png"><br></li></ul><br><br><h3>  Wo und wie nach XSS suchen? </h3><br>  Suchen Sie zunächst die Informations- / Datenausgabefunktionen auf der Seite.  Analysieren Sie, welche Daten dort ankommen?  Hier kommt das Konzept einer <i>nicht vertrauenswürdigen Quelle</i> .  Und so ist in erster Linie <i>Ihr Benutzer</i> .  Angriffsvektoren können in anderen Quellen enthalten sein: RSS-Feeds, andere externe und interne Dienste. <br>  Hier ist ein Beispiel aus dem wirklichen Leben: Ich arbeite für SEMrush IT.  Wir entwickeln eine Online-Plattform, die ein universelles Tool für Online-Vermarkter ist.  Ein Dienst speicherte Daten, der andere folgerte, jedes der Teams verließ sich aufeinander. Es stellte sich heraus, dass beim zweiten Dienst <i>XSS</i> aufgrund der fehlenden ordnungsgemäßen Verarbeitung der Ausgabedaten entstand und der erste Befehl es überhaupt nicht für notwendig hielt, die eingehenden Daten zu filtern in irgendeiner Weise und hielt sie " <i>wie es ist</i> ".  Schlussfolgerung: Wenn Sie nicht wissen, wie diese oder jene Daten gespeichert werden, sollten Sie sie als nicht vertrauenswürdig betrachten.  Oder vereinbaren Sie im Voraus, wer speichert und wie Daten filtert und anzeigt. <br><br>  Wenn Sie bereits Daten aus nicht vertrauenswürdigen Quellen haben, empfehle ich: <br><ul><li>  Untersuchung der Filterung eingehender Daten; </li><li>  Untersuchen Sie den Kontext der Ausgabe.  Nicht in allen Fällen kann <i>XSS</i> ausgeführt werden, auch ohne Filterung.  Zum Beispiel, wenn der <i>Inhaltstyp der</i> Antwort lautet: <i>text / plain;</i> </li><li>  Verlassen Sie sich nicht auf das Filtern eingebetteter Sicherheitssystem-Frameworks. </li></ul><br><br><h2>  SQL-Injection </h2><br><img src="https://habrastorage.org/webt/do/b8/ry/dob8ryjj2vifp3w1th18oroewis.png"><br><br>  <i>Implementierung von SQL-Code (English SQL Injection)</i> - Einführung in die Abfrage der Datenbank von Anweisungen, die dort nicht impliziert waren. <br><br>  Beispiel (nicht aus dem Leben, aber auch gut): <br>  Wir sehen ein Skript, das eine Benutzertabelle anzeigt.  In diesem Fall kann er nach Benutzername suchen. <br>  Rechts wird angezeigt, wie die Abfrage an die Datenbank aussieht, und links wird das Ergebnis des Skripts im Browser angezeigt. <br><img src="https://habrastorage.org/webt/ng/u2/ou/ngu2ouq8da3jtb18gkjj2amzxss.png"><br>  Um zu testen und zumindest ein primäres Ergebnis zu erhalten, fügen wir zwei Anführungszeichen in den Wert des Namensparameters ein.  Einzel und Doppel: <br><img src="https://habrastorage.org/webt/0a/fd/ck/0afdckohg1xuacw-7olxyrzifha.png"><br>  Wir sehen, dass aus Sicht der Ausgabe alles auseinander fiel, der Tisch komplett verschwand.  Die Anfrage erhält außerdem die zusätzlichen 2 Anführungszeichen.  Die gesamte Syntax der <i>SQL-</i> Abfrage wird verletzt. <br>  Wenn wir diese Konstruktion nehmen und zum Parameterwert hinzufügen ( <i>Hrsg.: Siehe im gelben Feld</i> ), erhalten wir eine absolut gültige Anfrage.  Die Seitenausgabe ist vollständig identisch mit der ersten Anforderung, die keine Injektion enthielt: <br><img src="https://habrastorage.org/webt/nh/9q/gu/nh9qguk8d0unxfz1bsxlfb0n8vo.png"><br>  Um zu überprüfen, ob eine Sicherheitsanfälligkeit vorliegt, fügen wir anstelle der Einheit eine Zwei hinzu: <br><img src="https://habrastorage.org/webt/lx/je/a6/lxjea6hv3hebohiv96gpauuo4o0.png"><br>  Es stellt sich heraus, dass die Anforderung aus Sicht der Booleschen Logik falsch wird und daher keine Daten enthält.  Im Gegensatz zu dem Moment, in dem wir einen Fehler hatten, haben wir jedoch die Ausgabe der Tabelle selbst. <br><br>  Um nicht alles aufzulisten, was sich in verschiedenen Datenbankmodulen und Abfragen verschiedener Typen befindet, habe ich alles auf eine Zeile reduziert: <br><img src="https://habrastorage.org/webt/xz/ok/mn/xzokmnhyzqdepnyax-n1bzd8siq.png"><br>  Dies ist etwas, das Sie versuchen können, in den Parameter einzugeben, und dann entsprechend den Unterschieden in den Antworten versuchen, zu verstehen, was passiert, ob es eine Sicherheitslücke gibt oder nicht.  Etwa 80% der Fälle können Sie mit dieser Manipulation abdecken. <br>  Es bleiben 20% der schwierigen Situationen, in denen Sie keine Informationen erhalten, z. B. verschachtelte Abfragen / Filterung usw.  In meiner Praxis habe ich mich nur einmal mit einem ähnlichen getroffen.  Dann musste ich die Filterung auf der Serviceseite umgehen. <br><br>  Was ist die Gefahr in SQL? <br><ul><li>  Aus dem Offensichtlichen - <i>Informationsleck</i> .  Wenn ein Angreifer Abfragen an Ihre Datenbanken generieren konnte, kann er auf die eine oder andere Weise Werte abrufen, die nicht ausgegeben werden sollten (Kennwort-Hashes, Client-Adressen usw.). </li><li>  <i>Datenänderung</i> .  Jetzt verwenden viele Entwickler Datenbanken über <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ORM-</a> Systeme.  Diese Systeme selbst ermöglichen es Ihnen standardmäßig, mehrere Abfragen gleichzeitig durchzuführen. Mit der SQL-Syntax können Sie dies auch tun.  Wenn es eine Sicherheitsanfälligkeit gibt, kann sich alles nicht nur auf die Auswahl der Daten, sondern auch auf deren Änderung beziehen (bis zum Löschen von Tabellen, Ändern der Datenbankstruktur usw.). <br>  In der gleichen Situation ist eine Erhöhung der Benutzerrechte möglich.  Ändern Sie die Felder in bestimmten Tabellen (z. B. setzen Sie <i>is_admins = true</i> in die <i>Benutzerdatenbank</i> ) und erhöhen Sie dadurch Ihre Rechte gegenüber dem Administrator. </li><li>  <i>DoS</i> .  In einigen Fällen kann eine Injektion zu einem Denial-of-Service führen.  Es werden mehrere umfangreiche Abfragen an die Datenbank generiert, die in mehreren Threads gestartet werden, und Ihr Dienst funktioniert möglicherweise für einige Zeit nicht mehr. </li><li>  <i>Das Lesen von Systemdateien</i> ist eine weitere Katastrophe, die SQL Injection mit sich bringen kann.  Das Auftreten dieses Risikos hängt davon ab, welches Datenbanksystem Sie verwenden und welcher Benutzer damit arbeitet (privilegiert oder nicht). </li><li>  <i>RCE (Remote Code Execution)</i> ist die Codeausführung.  Dies hängt direkt vom verwendeten Datenbanktyp ab (zuvor war dies standardmäßig mit den Standarddatenbankeinstellungen in MSSQL möglich). </li></ul><br>  Die folgende Tabelle zeigt die Sicherheitsanfälligkeiten in der <i>SQL-</i> Abfrage.  Natürlich müssen Sie es nicht auswendig lernen.  Darüber hinaus sind dies nicht alle möglichen Optionen, sondern lediglich Beispiele.  Beachten Sie nur, dass die Stellen, an denen die Injection in die <i>SQL-</i> Abfrage erfolgen kann, wenn Rohdaten dort ankommen, rot hervorgehoben sind.  Ein erfahrener Angreifer kann einen Weg finden, dies auszunutzen.  Sei vorsichtig und aufmerksam. <br><img src="https://habrastorage.org/webt/gz/bt/xh/gzbtxhbbrkng9axlc2av07rax9o.png"><br><br><h2>  SSRF (Server Side Request Forgery) </h2><br>  Wörtliche Übersetzung - gefälschte Anfragen auf der Serverseite.  Dies ist ein Angriff, mit dem Sie die Daten, die Sie an die Anwendung senden, bearbeiten können, sodass Sie die Anforderung nicht an die Stelle stellen müssen, an der die Geschäftslogik ursprünglich geplant war. <br>  Die Funktionsweise von <i>SSRF ist</i> in der folgenden Abbildung dargestellt: <br><img src="https://habrastorage.org/webt/cn/3m/xc/cn3mxclin9jb7tr5fdg6zcowez8.png"><br>  Es gibt einen Angreifer, es gibt Ihren Server, der von der <i>Firewall</i> geschlossen wird, aber gleichzeitig gibt es eine Funktionalität, mit der Sie weitere Anforderungen im Namen des Servers stellen können. <br>  Wenn diese Funktionalität nicht ordnungsgemäß geschützt und / oder falsch ist, wie es normalerweise der Fall ist :), verarbeitet eingehende Daten, kann sich der Angreifer an <i>Memcached</i> , <i>Redis</i> wenden oder Zugriff auf interne Ressourcen des Opfers erhalten. <br><br>  Betrachten Sie als anschaulicheres Beispiel den Stand, den SEMrush für die interne Mitarbeiterschulung verwendet. <br>  Es ist wichtig, auf die Bedeutung der " <i>Avatar-URL</i> " zu achten: <br><img src="https://habrastorage.org/webt/yi/yp/fr/yiypfrzdsu-pqg0adlbup1ziqgk.png"><br>  Hier achten wir auf 2 Punkte: <br><ul><li>  Avatar-URL selbst </li><li>  und die Möglichkeit, es mithilfe einer Datei herunterzuladen. </li></ul><br>  Bitte beachten Sie, dass das Feld " <i>Avatar-URL</i> " ein Textfeld für die Eingabe ist. Dies bedeutet, dass wir diesen Wert bearbeiten können.  Versuchen wir, auf dem Avatar das vielleicht berühmteste Bild im Internet zu platzieren - Googlebot von der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">404-Fehlerseite</a> . <br>  Mach es einmal: <br><img src="https://habrastorage.org/webt/hg/8d/oa/hg8doavbzbji9apfewlydlpxhyq.png"><br>  Machen Sie zwei - klicken Sie auf " <i>Speichern</i> ".  Wir bekommen einen Roboter anstelle meines Fotos: <br><img src="https://habrastorage.org/webt/kf/4x/lr/kf4xlr2atwvebex_dmsiqlxvmbi.png"><br>  Hier ist zu beachten, dass sich der Wert der " <i>Avatar-URL</i> " in einen lokalen Pfad geändert hat - anscheinend hat die Anwendung ein Bild angefordert, es auf dem Server gespeichert und einen neuen Wert ersetzt. <br><br>  Wir gehen weiter.  <i>Geben Sie im</i> Feld " <i>URL-Avatar</i> " die <i>Wertedatei ein: /// etc / passwd</i> .  Mit diesem Design können Sie auf die Dateistruktur zugreifen.  In einigen Bibliotheken, die für die Arbeit mit <i>HTTP verwendet werden</i> , ist die Arbeit mit der Dateistruktur standardmäßig aktiviert und empfängt Daten von den Servern, auf denen sie gestartet wurden: <br><img src="https://habrastorage.org/webt/_j/2i/jb/_j2ijbofjimkfmd2tjxmoegkh4k.png"><br>  Was passiert nach dem Klicken auf die Schaltfläche " <i>Speichern</i> "? <br>  Erstens wurde das Bild zu „ <i>Fledermaus</i> “, und zweitens änderte sich der Pfad zur Datei. <br><img src="https://habrastorage.org/webt/bn/ro/d5/bnrod5bxckue0avxxbvvktglimg.png"><br>  Wenn wir versuchen, dieses Bild im Browser anzufordern, wird uns nichts angezeigt (die Datei ist " <i>kaputt</i> ").  Aber wir sind nicht der erste Tag in der Informationssicherheit, wir wissen, was zu tun ist :) Durch einfache Manipulationen erhalten wir den Inhalt der Datei auf unserem Computer: <br><img src="https://habrastorage.org/webt/vd/sw/97/vdsw97u1ce8abtqa2aqcp_zb2ac.png"><br>  Mithilfe dieser Sicherheitsanfälligkeit kann ich als Angreifer dem Benutzer, der den Webdienst ausführt, alle Quellcodes Ihres Dienstes und andere Daten zum Lesen zur Verfügung stellen. <br>  Schauen wir uns die Gefahren der SSRF an: <br><ul><li>  Port-Scan.  Für ein externes Netzwerk besteht Ihr Dienst aus einem Einstiegspunkt und zwei Ports (http und https).  Durch das Scannen von Ports aus Ihrer Infrastruktur heraus kann ein Angreifer offene Ports erkennen. </li><li>  Hostbasierte Authentifizierung umgehen.  Was ist der Punkt?  Möglicherweise gibt es in Ihrer Struktur Dienste, die nur für bestimmte Ressourcen verfügbar sind (siehe: IP-Whitelist).  Wenn sich Ihr anfälliger Server in der weißen Liste befindet, erhalten Sie Zugriff auf die Dienste, die ihm zur Verfügung stehen, und können sie daher manipulieren. </li><li>  Wenn Sie die Entwicklung des oben genannten Angriffs fortsetzen, können Sie weiterhin anfällige Programme ausnutzen, die im Intranet oder auf dem lokalen Server ausgeführt werden.  Sehr oft gibt es Situationen, in denen die interne Infrastruktur, auf die von außen nicht zugegriffen werden kann, schlecht überwacht wird (Versionen / Sicherheitspatches usw. werden nicht immer aktualisiert).  Dies kann auch zu Angriffen und Datendiebstahl führen. </li><li>  Lokale Daten lesen.  Ich habe es oben mit einem Beispiel gezeigt.  Ihre Konfigurationen können gelesen und abgerufen werden, Token und Passwörter. </li></ul><br><br><h3>  Wo kann man nach SSRF suchen? </h3><br>  Dies ist keine Standardanfälligkeit.  Es kann an verschiedenen, oft an den unerwartetsten Orten gefunden werden.  In dieser Situation funktioniert die Technik „Schau hier, aber du siehst vielleicht nicht einmal hier“ nicht. <br>  Anzeichen einer möglichen <i>SSRF</i> : <br><ul><li>  <i>Webhook</i> .  Wenn sie schlecht konfiguriert sind und die Firewall auf den Servern, von denen Webhooks Anforderungen stellen, nicht ordnungsgemäß konfiguriert ist, kann eine Sicherheitsanfälligkeit festgestellt werden. </li><li>  <i>HTML-Konvertierung</i> .  Versuchen Sie, ein <i>&lt;iframe&gt; -</i> , <i>&lt;img&gt; -</i> , <i>&lt;base&gt; -</i> , <i>&lt;script&gt; -</i> oder <i>CSS-</i> <i>URL-</i> Konstrukt <i>einzubetten</i> , das auf einen internen Dienst verweist. </li><li>  <i>Gelöschte Dateien herunterladen</i> .  Erinnerst du dich an das Avatar-Beispiel?  Wenn ein Benutzer die Möglichkeit hat, Daten per URL auf den Server hochzuladen, ist dies mit großen Problemen verbunden.  Versuchen Sie, die URL mit dem Port zu senden, und sehen Sie, welche Inhalte hochgeladen werden. </li></ul><br><br><h3>  Wie suche ich nach SSRF? </h3><br><ul><li>  Heben Sie den Server an und führen Sie den <i>Listener aus</i> : <br><pre><code class="bash hljs">user$ nc -1 -n -vv -p 8080 -k</code> </pre> <br>  Auf diese Weise sehen Sie alle Anforderungen, die an Ihren Server an Port <i>8080</i> gesendet werden.  Einerseits handelt es sich um einen von Ihren Webservern nicht belegten Port, andererseits handelt es sich um einen Port, der häufig nicht von der <i>Firewall</i> gefiltert wird.  Es wird angenommen, dass es für das <i>http-</i> Protokoll verwendet wird, und das Verbot scheint optional zu sein. </li><li>  Suchen Sie in der untersuchten Anwendung den Parameter, an den Sie den Pfad zum Anfordern von Daten von unserem Host (an unseren <i>Listener</i> ) übergeben können. </li><li>  Untersuchen <i>Sie die</i> Ausgabe des <i>Listeners</i> oder die zurückgegebene Antwort. </li></ul><br><br><h2>  XXE (XML External Entity) </h2><br>  Ich werde die Geschichte wie immer mit einem Beispiel beginnen, damit es klarer wird: <br>  Im oben genannten SEMrush-Dienst gibt es ein solches Tool, das sich mit der Inhaltsanalyse befasst.  Der Benutzer gibt die URL seiner Website oder der Website eines Mitbewerbers ein, und bevor er sie analysiert, lädt der Dienst genau diesen Inhalt herunter.  Sehen Sie sich das Video an: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/WS3pJoyWwto" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br>  Zum Herunterladen greift der Dienst auf die angegebene Site zu und der Crawler lädt die Datei <i>sitemap.xml</i> herunter.  Und genau über dieses <i>XML</i> sprechen wir in diesem Block. <br>  Im Video können wir beobachten, wie die angreifende Site <i>sitemap.xml</i> eine Definition der externen Entität <i>XXE</i> <i>hinzugefügt hat</i> , die auf " <i>file: /// etc / hosts</i> " verweist.  Auf Linux-Systemen ist dies eine Datei, die beschreibt, welche IP den Hosts entspricht, wenn für sie keine <i>DNS-</i> Einträge vorhanden sind. <br>  Als nächstes gibt der Angreifer im <i>&lt;loc&gt; -Tag die</i> Erweiterung dieser Variablen an.  Nach dem Parsen des <i>XML und</i> nach dem Verarbeiten des gesamten <i>XML</i> im Fach wird der Wert in " <i>file: /// etc / hosts</i> " in die <i>Standortvariable</i> eingefügt (im Video rot hervorgehoben). <br>  Der Angreifer startet den Start unseres Parsers, geht zu den Protokollen und hier erscheint eine Linie, die im Video weiß hervorgehoben ist.  Dies ist der Inhalt der Datei " <i>file: /// etc / hosts</i> ", die in der <i>GET-</i> Anforderung in den Protokollen eines von ihr gesteuerten Servers abgerufen wurde. <br>  Was weiter?  Der Angreifer wird überprüfen, ob er Recht hatte.  Der Dateiname wird in " <i>file: /// etc / fstab</i> " geändert, der Parser erneut ausgeführt und Statistiken zum Ausführen von Prozessen abgerufen. <br><br>  Und schließlich: " <i>file: /// etc / hostname</i> ", starten Sie den Parser, gehen Sie zu den Protokollen und rufen Sie den <i>Hostnamen des</i> Computers ab, auf dem wir uns befinden. <br>  Dies ist ein echter Fehler, der von einer echten Person entdeckt wurde, die nicht mit unserem Unternehmen verwandt ist.  Ich musste Asche auf meinen Kopf streuen und Geld bezahlen :) <br><br>  Ein weiteres Beispiel für <i>XXE</i> : <br><img src="https://habrastorage.org/webt/3t/va/i9/3tvai98kmgwwmpjwh0wjjuzodk0.png"><br>  Angenommen, wir haben einen bestimmten <i>Endpunkt</i> , der als <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Beispiel.com/xxe bezeichnet wird</a></i> . <br>  Wir senden die <i>XML-</i> Struktur an sie → in <i>XML</i> deklarieren <i>wir</i> die Entität <i></i> → die Entität <i></i> bezieht sich auf die Systemdatei <i>/ etc / passwd</i> und öffnet sich weiter im Hauptteil der Antwort → wir erhalten den Inhalt dieser Datei als Antwort. <br>  Es ist erwähnenswert, dass dies nicht so oft vorkommt, wie wir möchten. <br><br><h3>  Warum funktioniert es? </h3><br>  <i>XML-</i> Dokumente sind ein strukturiertes Datenformat, mit dem Sie unter anderem die darin enthaltenen Datentypen mithilfe eines speziellen <i>DOCTYPE-</i> Tags beschreiben können. <br>  <i>Datentypdefinition (DTD)</i> - Die Definition von Datentypen in diesem <i>XML-</i> Dokument.  Es gibt drei Möglichkeiten, wie dies getan werden kann: <br><ul><li>  Wenn das Dokument <i>DTD</i> unterstützt.  Das folgende Beispiel zeigt einige <i>XML-Dateien,</i> in denen eine Bestellstruktur, ein <i>Produktelement</i> und ein <i>Zählelement vorhanden sind</i> (vermutlich: die Bestandsnummer des Produkts und die Anzahl der Artikel in der Bestellung).  <i>Die Reihenfolge</i> ist das übergeordnete Element für diese beiden Elemente: <br><img src="https://habrastorage.org/webt/ft/to/kb/fttokbp3vkqsknatvo8yql9p5h4.png"></li><li>  Externe DTDs auf dem lokalen Server. <br>  Wir machen dasselbe wie in der ersten Ausführungsform, aber wir machen alle Definitionen in einer separaten Datei, die sich auf dem lokalen Server befindet: <br><img src="https://habrastorage.org/webt/qy/re/3m/qyre3m2bfjatzni4bdq6t-3opko.png"><br></li><li>  Externe DTDs auf einem Server eines Drittanbieters: <br><img src="https://habrastorage.org/webt/wf/dj/tp/wfdjtpme3bh_lnhgiyr56m-p5si.png"></li></ul><br>  Wenn Sie ein aufmerksamer Leser sind, haben Sie wahrscheinlich die Tatsache korreliert, dass die Möglichkeit, solche Anforderungen an Ihren Dienst zu stellen und externe <i>DTD-</i> Schemata anzufordern, eine Sicherheitsanfälligkeit an sich ist, über die wir oben gesprochen haben, nämlich die <i>SSRF-</i> Sicherheitsanfälligkeit. <br>  Ein häufiges Ereignis: Entwickler beheben die <i>XXE-</i> Sicherheitsanfälligkeit, vergessen jedoch, die Verarbeitung externer <i>DTDs</i> zu verbieten und <i>SSRF abzurufen</i> .  Daraus ergeben sich keine fatalen Folgen, die Sie jedoch nicht vergessen sollten. <br><br><h3>  Was sind Entitäten in XML? </h3><br>  <i>Entitäten</i> in <i>XML</i> .  Was ist das?  Dies ist eine Gelegenheit, bestimmte Werte zu definieren und sie in Variablen umzuwandeln.  Entitäten haben drei verschiedene Typen: <br><img src="https://habrastorage.org/webt/er/lb/h7/erlbh7l8z_adl4nla3ll_tir1rm.png"><br>  <i>Vordefiniert</i> - vordefiniert.  <i>Ermöglichen</i> Sie ähnlich wie bei <i>HTML-</i> Code die Verwendung von Zeichen, die Teil der Syntax der Sprache sind, als Textstruktur.  Hier werden sie als Beispiel gegeben, damit Sie verstehen, was es ist.  Ja, in den meisten Angriffen werden sie nicht verwendet, können aber in einigen Ausnahmefällen erforderlich sein. <br>  <i>Allgemein</i> und <i>Parameter</i> .  Dies ist ein und dasselbe, nur die Syntax ihrer Deklaration ändert sich und wie sie nach der Deklaration aufgerufen werden können <br><br><h3>  Wo kann man nach <i>XXE</i> suchen? </h3><br>  Mehrere Optionen: <br><ul><li>  <i>XML-</i> Verarbeitung in jeder Manifestation: <br><ul><li>  <i>SVG;</i> </li><li>  <i>Sitemap;</i> </li></ul></li><li>  Konvertieren Sie <i>HTML</i> in andere Formate. </li><li>  Umgang mit <i>docx</i> , <i>xlsx</i> und ähnlichen Formaten. </li></ul><br><br><h3>  Wie suche ich sie? </h3><br><img src="https://habrastorage.org/webt/eo/ce/tl/eocetlpzyfdgocqc2qwv1hbxnhe.png"><br>  Das Bild zeigt nur ein Beispiel für den Start.  Es ist kein universeller Schlüssel.  Es muss für die Formate optimiert werden, die Sie im untersuchten Dienst verwenden. <br><br>  Das erste, was wir tun: Deklarieren Sie eine bestimmte Entität <i>Z</i> , die auf den vom angreifenden Host kontrollierten Host zugreift, und erweitern Sie sie im Hauptteil des <i>XML-</i> Dokuments. <br>  Hier ist die zweite Option möglich - nur die Essenz von <i>Parameter</i> .  Unterscheidet sich von der ersten Anzeige ( <i>%</i> -Zeichen).  Und um sich dieser Essenz zuzuwenden, wird der Hauptteil des Dokuments nicht mehr benötigt.  Wir können direkt in der <i>DOCTYPE-</i> Struktur darauf <i>zugreifen</i> und diese Entität <i>verfügbar machen</i> : <br><img src="https://habrastorage.org/webt/3-/hc/xo/3-hcxohtjre3dee0mbed39vlfzq.png"><br>  Das dritte Szenario besteht darin, <i>festzustellen,</i> ob die Möglichkeit, <i>DOCTYPE</i> von externen Diensten anzufordern, <i>aktiviert</i> oder <i>deaktiviert</i> ist: <br><img src="https://habrastorage.org/webt/xn/yo/nj/xnyonjotk9gmb4l1ba-d818g3k4.png"><br>  Als nächstes betrachten wir die Ausgabe eines von uns gesteuerten Servers.  Wenn wir einen Aufruf der <i>URL</i> <i>/ Überprüfung</i> von verschiedenen <i>IP-</i> Adressen sehen, bedeutet dies, dass die Sicherheitsanfälligkeit mit hoher Wahrscheinlichkeit behoben wurde, und wir müssen nur herausfinden, wie wir interessantere Daten für uns erhalten können. <br><img src="https://habrastorage.org/webt/xl/7d/oz/xl7dozt94jtm9zf3c_zfr39kacq.png"><br>  Was ist die Gefahr von <i>XXE</i> ?  Ich werde kurz und Punkt für Punkt schreiben: <br><ul><li>  Lokale Dateien lesen; </li><li>  Zugang zu lokalen Ressourcen; </li><li>  Port / Host-Scan </li><li>  <i>Nur-Text-Wrapper</i> .  Dies ist eine Gelegenheit, auf Ihre Dienste zuzugreifen, die mit dem Nur-Text-Protokoll arbeiten. </li><li>  <i>Remote Code Execution</i> (nicht oft).  Es ist standardmäßig deaktiviert. </li><li>  <i>DoS</i> .  Aufgrund der Tatsache, dass Entitäten verkettet werden können, ist es leicht möglich, eine exponentielle Zunahme der von diesen Parametern belegten Speichermenge zu erhalten.  Das Ergebnis ist ein <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Milliarden-Lach-Angriff</a> .  Mit anderen Worten, Sie überlasten einfach den Speicher des angegriffenen Servers. </li></ul><br>  Abschließend möchte ich sagen, dass all dies (der Artikel und alle Kenntnisse, die Sie erworben haben) ohne praktische Anwendung keinen Sinn ergibt.  Daher werde ich Sie nach einer echten Kleinigkeit fragen: Denken Sie an die Anwendung, die Sie gestern geschrieben / getestet haben, und versuchen Sie, sie auf Schwachstellen zu überprüfen.  Gibt es Eingabeformulare oder <i>XML-</i> Verarbeitung?  Ist diese Anwendung geschützt?  Wird die Filterung hinzugefügt und die <i>DTD</i> deaktiviert? <br>  Öffnen Sie das <i>SQLmap-</i> Handbuch und finden Sie heraus, wie Sie Ihre Anwendung damit überprüfen können.  Wenn er nichts findet, nehmen Sie ein anderes Tool, untersuchen Sie es und testen Sie Ihre Anwendung auf andere Schwachstellen.  Wie ich zu Beginn sagte, untersucht der Artikel nur einige Schwachstellen, aber <i>Tausende von ihnen</i> . <br>  Ich glaube nicht, dass Sie absolut sicheren Code schreiben können.  Es gibt immer Schwachstellen, die Sie nur <i><u>noch nicht gefunden</u></i> haben. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de441966/">https://habr.com/ru/post/de441966/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de441952/index.html">Auswahl eines Dateispeichersystems für die Teamarbeit</a></li>
<li><a href="../de441954/index.html">Benutzerbelohnung an Habrs Autoren</a></li>
<li><a href="../de441956/index.html">Einheitliche Fehlerbehandlung (C ++ - Option für Mikrocontroller)</a></li>
<li><a href="../de441962/index.html">Indizes in PostgreSQL - 1</a></li>
<li><a href="../de441964/index.html">Tipps und Tricks von Kubernetes: Verschieben von Clusterressourcen auf Helm 2</a></li>
<li><a href="../de441968/index.html">Entwicklung einer neuen Produktbranche: Wie man Unpraktisches loswird und nützlich bleibt</a></li>
<li><a href="../de441970/index.html">FinFisher Butkit-Analyse</a></li>
<li><a href="../de441972/index.html">Invidious - alternatives YouTube-Frontend</a></li>
<li><a href="../de441974/index.html">Der Weg des Historikers von der Personalabteilung zu Java-Programmierern: ein bisschen Glück und Ausdauer</a></li>
<li><a href="../de441976/index.html">Mit Ihnen FizTech.Science: Wir suchen nach versteckten Parametern und tauchen in die wunderbare Quantenwelt ein</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>