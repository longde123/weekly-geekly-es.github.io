<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëô üè™ ü§öüèº Les 10 erreurs les plus courantes lors de l'utilisation de la plate-forme Spring. 2e partie üïπÔ∏è ü§£ üë©üèæ‚Äçü§ù‚Äçüë®üèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Salut, Khabrovsk. La traduction de la deuxi√®me partie de l'article pr√©par√©e sp√©cialement pour les √©tudiants du cours "Developer on the Spring Framewor...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Les 10 erreurs les plus courantes lors de l'utilisation de la plate-forme Spring. 2e partie</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/465063/">  <i>Salut, Khabrovsk.</i>  <i>La traduction de la deuxi√®me partie de l'article pr√©par√©e sp√©cialement pour les √©tudiants du cours <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">"Developer on the Spring Framework"</a> est donc arriv√©e √† temps.</i>  <i>La premi√®re partie peut √™tre lue <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> .</i> <br><br><img src="https://habrastorage.org/webt/-i/va/66/-iva66o8uvrummnptqda3getv_i.png"><br><br><p>  <font color="gray">Spring est peut-√™tre l'une des plateformes de d√©veloppement Java les plus populaires.</font>  <font color="gray">Il s'agit d'un outil puissant, mais plut√¥t difficile √† apprendre.</font>  <font color="gray">Ses concepts de base sont assez faciles √† comprendre et √† apprendre, mais il faut du temps et des efforts pour devenir un d√©veloppeur Spring exp√©riment√©.</font> <font color="gray"><br><br></font>  <font color="gray">Dans cet article, nous examinerons certaines des erreurs les plus courantes commises lors de l'utilisation de Spring et li√©es, en particulier, au d√©veloppement d'applications Web et √† l'utilisation de la plate-forme Spring Boot.</font>  <font color="gray">Comme indiqu√© sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">le site Web de Spring Boot</a> , Spring Boot adopte une approche <i>standardis√©e</i> pour cr√©er des applications pr√™tes √† l'emploi, et cet article suivra cette approche.</font>  <font color="gray">Il fournira un certain nombre de recommandations qui peuvent √™tre utilis√©es efficacement dans le d√©veloppement d'applications Web standard bas√©es sur Spring Boot.</font> <font color="gray"><br><br></font>  <font color="gray">Dans le cas o√π vous n'√™tes pas tr√®s familier avec la plate-forme Spring Boot, mais que vous souhaitez exp√©rimenter avec les exemples de cet article, j'ai cr√©√© un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">r√©f√©rentiel GitHub avec des mat√©riaux suppl√©mentaires pour cet article</a> .</font>  <font color="gray">Si √† un moment donn√© vous avez √©t√© un peu confus en lisant cet article, je vous conseillerais de cr√©er un clone de ce r√©f√©rentiel et d'exp√©rimenter le code sur votre ordinateur.</font> </p><a name="habracut"></a><br><hr><br><h2>  Erreur courante n ¬∞ 6: ne pas utiliser la validation des donn√©es bas√©e sur les annotations </h2><br>  Imaginons que notre service TopTalent des exemples pr√©c√©dents ait besoin d'un point de terminaison pour ajouter de nouvelles donn√©es TopTalent.  Supposons √©galement que pour une raison tr√®s importante, chaque nom que vous ajoutez doit comporter exactement 10 caract√®res.  Cela peut √™tre impl√©ment√©, par exemple, comme suit: <br><br><pre><code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@RequestMapping</span></span>(<span class="hljs-string"><span class="hljs-string">"/put"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addTopTalent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@RequestBody TopTalentData topTalentData)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> nameNonExistentOrHasInvalidLength = Optional.ofNullable(topTalentData) .map(TopTalentData::getName) .map(name -&gt; name.length() == <span class="hljs-number"><span class="hljs-number">10</span></span>) .orElse(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (nameNonExistentOrInvalidLength) { <span class="hljs-comment"><span class="hljs-comment">//   } topTalentService.addTopTalent(topTalentData); }</span></span></code> </pre> <br>  Cependant, le code ci-dessus est non seulement mal structur√©, mais ce n'est pas vraiment une solution ¬´propre¬ª.  Nous effectuons plusieurs types de validation des donn√©es (√† savoir, nous v√©rifions que l'objet <code>TopTalentData</code> pas nul, que la valeur du champ TopTalentData.name n'est pas nulle et que la longueur du champ <code>TopTalentData.name</code> est de 10 caract√®res), et <code>TopTalentData.name</code> √©galement une exception si les donn√©es sont incorrectes. <br><br>  Tout cela peut √™tre fait avec plus de pr√©cision en utilisant le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">validateur Hibernate</a> au printemps.  <code>addTopTalent</code> abord la m√©thode <code>addTopTalent</code> , en ajoutant la prise en charge de la validation des donn√©es: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@RequestMapping</span></span>(<span class="hljs-string"><span class="hljs-string">"/put"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addTopTalent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@Valid @NotNull @RequestBody TopTalentData topTalentData)</span></span></span><span class="hljs-function"> </span></span>{ topTalentService.addTopTalent(topTalentData); } <span class="hljs-meta"><span class="hljs-meta">@ExceptionHandler</span></span> <span class="hljs-meta"><span class="hljs-meta">@ResponseStatus</span></span>(HttpStatus.BAD_REQUEST) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ErrorResponse </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handleInvalidTopTalentDataException</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(MethodArgumentNotValidException methodArgumentNotValidException)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//    }</span></span></code> </pre> <br>  De plus, nous devons indiquer quelle validation de propri√©t√© nous voulons effectuer dans la classe <code>TopTalentData</code> : <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TopTalentData</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Length</span></span>(min = <span class="hljs-number"><span class="hljs-number">10</span></span>, max = <span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-meta"><span class="hljs-meta">@NotNull</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String name; }</code> </pre> <br>  Spring va maintenant intercepter la demande et la v√©rifier avant d'appeler la m√©thode, donc aucune v√©rification manuelle suppl√©mentaire ne sera requise. <br><br>  L'objectif souhait√© peut √©galement √™tre atteint en cr√©ant vos propres annotations.  Dans des conditions r√©elles, il est g√©n√©ralement judicieux d'utiliser vos propres annotations uniquement lorsque vos besoins d√©passent les capacit√©s de l'ensemble <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">int√©gr√© de restrictions Hibernate</a> , mais pour cet exemple, imaginons que les annotations <code>@Length</code> pas.  Vous pouvez cr√©er un validateur de donn√©es qui v√©rifie la longueur d'une cha√Æne en cr√©ant deux classes suppl√©mentaires: une pour la validation et une pour l'annotation des propri√©t√©s: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Target</span></span>({ElementType.METHOD, ElementType.FIELD, ElementType.PARAMETER}) <span class="hljs-meta"><span class="hljs-meta">@Retention</span></span>(RetentionPolicy.RUNTIME) <span class="hljs-meta"><span class="hljs-meta">@Documented</span></span> <span class="hljs-meta"><span class="hljs-meta">@Constraint</span></span>(validatedBy = { MyAnnotationValidator.class }) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-meta"><span class="hljs-meta">@interface</span></span> MyAnnotation { <span class="hljs-function"><span class="hljs-function">String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">message</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">default</span></span></span><span class="hljs-function"> "String length does not match expected"</span></span>; Class&lt;?&gt;[] groups() <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> {}; Class&lt;? extends Payload&gt;[] payload() <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> {}; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">value</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; } <span class="hljs-meta"><span class="hljs-meta">@Component</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyAnnotationValidator</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ConstraintValidator</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyAnnotation</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">String</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> expectedLength; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initialize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(MyAnnotation myAnnotation)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.expectedLength = myAnnotation.value(); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isValid</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String s, ConstraintValidatorContext constraintValidatorContext)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> s == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> || s.length() == <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.expectedLength; } }</code> </pre> <br><br>  Veuillez noter que dans ces cas, l'application correcte du principe de s√©paration des responsabilit√©s n√©cessite de marquer la propri√©t√© comme valide si sa valeur est nulle <code>(s == null</code> dans la m√©thode <code>isValid</code> ), puis d'utiliser l'annotation <code>@NotNull</code> si cela est en outre requis pour cette propri√©t√©: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TopTalentData</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@MyAnnotation</span></span>(value = <span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-meta"><span class="hljs-meta">@NotNull</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String name; }</code> </pre> <br><h2>  Erreur courante n ¬∞ 7: utilisation de configurations bas√©es sur XML h√©rit√©es </h2><br>  L'utilisation de XML √©tait une n√©cessit√© lors de l'utilisation des versions pr√©c√©dentes de Spring, mais maintenant la plupart des t√¢ches de configuration peuvent √™tre impl√©ment√©es √† l'aide de code Java et d'annotations.  Les configurations XML font d√©sormais office de code de mod√®le suppl√©mentaire et facultatif. <br><br>  Dans cet article (et √©galement dans les mat√©riaux du r√©f√©rentiel GitHub), les annotations sont utilis√©es pour configurer Spring, et Spring sait quels composants JavaBean doivent √™tre li√©s, car le package racine est annot√© √† l'aide de l'annotation composite @SpringBootApplication - comme ceci: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@SpringBootApplication</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Application</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ SpringApplication.run(Application.class, args); } }</code> </pre> <br>  Cette annotation composite (voir la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation Spring pour</a> plus d'informations) indique simplement √† la plate-forme Spring les packages √† analyser pour extraire les composants JavaBean.  Dans notre cas particulier, cela signifie que les sous-packages co.kukurin suivants seront utilis√©s pour la liaison: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">Composant</a> (TopTalentConverter, MyAnnotationValidator) </li><li>  @RestController (TopTalentController) </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">R√©f√©rentiel</a> (TopTalentRepository) </li><li>  Classes de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">service</a> (TopTalentService) </li></ul><br>  Si nous avons des classes suppl√©mentaires qui ont l'annotation <code>@Configuration</code> , leur configuration Java sera √©galement v√©rifi√©e. <br><br><h2>  Erreur courante # 8: ne pas utiliser de profils de configuration </h2><br>  Lors du d√©veloppement de syst√®mes de serveurs, un probl√®me courant est de basculer entre diff√©rentes configurations (en r√®gle g√©n√©rale, il s'agit de configurations pour les environnements d'exploitation et de d√©veloppement).  Au lieu de modifier manuellement divers param√®tres √† chaque transition entre les modes de test et de fonctionnement, il est plus efficace d'utiliser des profils de configuration. <br><br>  Imaginez le cas o√π dans l'environnement de d√©veloppement local vous utilisez la base de donn√©es en RAM et dans l'environnement du fonctionnement r√©el de votre application, la base de donn√©es MySQL est utilis√©e.  Cela signifie essentiellement que vous utiliserez diff√©rentes URL et, vraisemblablement, diff√©rentes informations d'identification pour acc√©der √† chacune de ces bases de donn√©es.  Voyons comment cela peut √™tre impl√©ment√© √† l'aide de deux fichiers de configuration: <br><br>  <b>FILE APPLICATION.YAML</b> <br><br><pre> <code class="java hljs"># set <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> profile to <span class="hljs-string"><span class="hljs-string">'dev'</span></span> spring.profiles.active: dev # production database details spring.datasource.url: <span class="hljs-string"><span class="hljs-string">'jdbc:mysql://localhost:3306/toptal'</span></span> spring.datasource.username: root spring.datasource.password:</code> </pre> <br><br>  <b>FILE APPLICATION-DEV.YAML</b> <br><br><pre> <code class="java hljs">spring.datasource.url: <span class="hljs-string"><span class="hljs-string">'jdbc:h2:mem:'</span></span> spring.datasource.platform: h2</code> </pre> <br><br>  Il faut supposer que lorsque vous travaillez avec du code, vous ne voudriez pas effectuer certaines actions al√©atoires avec une base de donn√©es destin√©e √† l'environnement d'exploitation, il est donc logique de s√©lectionner le profil pour l'environnement de d√©veloppement (DEV) comme profil par d√©faut.  Par la suite, vous pouvez remplacer manuellement le profil de configuration sur le serveur en sp√©cifiant <code>-Dspring.profiles.active=prod</code> pour la JVM.  De plus, le profil de configuration par d√©faut peut √™tre sp√©cifi√© dans la variable d'environnement du syst√®me d'exploitation. <br><br><h2>  Erreur courante num√©ro 9. D√©faut d'utiliser le m√©canisme d'injection de d√©pendance </h2><br>  Une utilisation appropri√©e du m√©canisme d'injection de d√©pendances dans Spring signifie que Spring peut lier tous vos objets en analysant toutes les classes de configuration n√©cessaires.  Ceci est utile pour rel√¢cher les interd√©pendances et facilite grandement les tests.  Au lieu de lier √©troitement les classes, quelque chose comme ceci: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TopTalentController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> TopTalentService topTalentService; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TopTalentController</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.topTalentService = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TopTalentService(); } }</code> </pre> <br>  ... nous permettons √† la plateforme Spring de lier: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TopTalentController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> TopTalentService topTalentService; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TopTalentController</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(TopTalentService topTalentService)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.topTalentService = topTalentService; } }</code> </pre> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">La conf√©rence de Mishko Hevery sur la cha√Æne Google Tech Talks</a> explique en d√©tail pourquoi l'injection de d√©pendance doit √™tre utilis√©e, mais nous verrons ici comment ce m√©canisme est utilis√© dans la pratique.  Dans la division des responsabilit√©s (¬´Common Mistake # 3¬ª), nous avons cr√©√© les classes de service et de contr√¥leur.  Supposons que nous voulons tester un contr√¥leur, en supposant que la classe <code>TopTalentService</code> fonctionne correctement.  Nous pouvons ins√©rer un objet simulateur au lieu de l'impl√©mentation de service actuelle en cr√©ant une classe de configuration distincte: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SampleUnitTestConfig</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> TopTalentService </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">topTalentService</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ TopTalentService topTalentService = Mockito.mock(TopTalentService.class); Mockito.when(topTalentService.getTopTalent()).thenReturn( Stream.of(<span class="hljs-string"><span class="hljs-string">"Mary"</span></span>, <span class="hljs-string"><span class="hljs-string">"Joel"</span></span>).map(TopTalentData::<span class="hljs-keyword"><span class="hljs-keyword">new</span></span>).collect(Collectors.toList())); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> topTalentService; } }</code> </pre> <br>  Apr√®s cela, nous pouvons impl√©menter l'objet simulateur en <code>SampleUnitTestConfig</code> plate-forme Spring que nous devons utiliser <code>SampleUnitTestConfig</code> comme source de configuration: <br> <code>@ContextConfiguration(classes = { SampleUnitTestConfig.class })</code> <br> <br>  Par la suite, cela nous permettra d'utiliser la configuration contextuelle pour int√©grer le composant JavaBean personnalis√© dans un test unitaire. <br><br><h2>  Erreur courante num√©ro 10. Absence de test ou test incorrect </h2><br>  Malgr√© le fait que l'id√©e des tests unitaires n'est pas nouvelle, il semble que de nombreux d√©veloppeurs "l'oublient" (surtout si ce n'est <i>pas obligatoire</i> ) ou le d√©pensent trop tard.  √âvidemment, c'est faux, car les tests vous permettent non seulement de v√©rifier le bon fonctionnement du code, mais servent √©galement de documentation montrant comment l'application doit se comporter dans diverses situations. <br>  Lorsque vous testez des services Web, vous ex√©cutez rarement des tests unitaires exceptionnellement ¬´propres¬ª, car pour une connexion HTTP, vous devez g√©n√©ralement utiliser le servlet Spring <code>DispatcherServlet</code> et voir ce qui se passe lorsque vous recevez une vraie demande <code>HttpServletRequest</code> (c'est-√†-dire qu'il s'av√®re qu'un test d' <i>int√©gration</i> utilise validation, s√©rialisation, etc.).  Une solution √©l√©gante et √©prouv√©e consiste √† utiliser <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">REST Assured</a> , une biblioth√®que Java pour tester facilement les services REST, avec MockMVC.  Consid√©rez le fragment de code suivant avec injection de d√©pendance: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@RunWith</span></span>(SpringJUnit4ClassRunner.class) <span class="hljs-meta"><span class="hljs-meta">@ContextConfiguration</span></span>(classes = { Application.class, SampleUnitTestConfig.class }) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RestAssuredTestDemonstration</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> TopTalentController topTalentController; <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">shouldGetMaryAndJoel</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// given MockMvcRequestSpecification givenRestAssuredSpecification = RestAssuredMockMvc.given() .standaloneSetup(topTalentController); // when MockMvcResponse response = givenRestAssuredSpecification.when().get("/toptal/get"); // then response.then().statusCode(200); response.then().body("name", hasItems("Mary", "Joel")); } }</span></span></code> </pre> <br>  <code>SampleUnitTestConfig</code> lie l'impl√©mentation de substitution de la classe <code>TopTalentService</code> au <code>TopTalentController</code> , et toutes les autres classes sont li√©es √† l'aide de la configuration standard obtenue en analysant les packages en fonction du package de la classe Application.  <code>RestAssuredMockMvc</code> simplement utilis√© pour configurer un environnement l√©ger et envoyer une demande <code>GET</code> au <code>/toptal/get</code> . <br><br><h3>  Utilisez Spring professionnellement </h3><br>  Spring est une plate-forme puissante facile √† d√©marrer, mais il faut du temps et des efforts pour la ma√Ætriser pleinement.  Si vous prenez le temps de vous familiariser avec cette plateforme, elle augmentera sans aucun doute l'efficacit√© de votre travail, vous aidera √† cr√©er un code plus propre et √† augmenter vos qualifications en tant que d√©veloppeur. <br><br>  Je vous recommande de pr√™ter attention √† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Spring In Action</a> - c'est un bon livre orient√© vers les applications qui aborde de nombreux sujets importants li√©s √† la plate-forme Spring. <br><br>  √Ä ce stade, la traduction de cet article a pris fin. <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Lisez la premi√®re partie</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr465063/">https://habr.com/ru/post/fr465063/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr465049/index.html">10 livres sur la gestion de projet Agile √† emporter avec vous en 2020</a></li>
<li><a href="../fr465055/index.html">Six comp√©tences pour faire passer votre carri√®re en Data Science au niveau sup√©rieur.</a></li>
<li><a href="../fr465057/index.html">Conteneurs et fen√™tres. De Hello World √† Kubernetes. Premi√®re partie, introduction</a></li>
<li><a href="../fr465059/index.html">PoE √† une distance de plus de 200 m√®tres. Surveillance et red√©marrage automatique des clients PoE</a></li>
<li><a href="../fr465061/index.html">Pourquoi au lieu d'une semaine de travail de quatre jours, il vaut mieux penser √† une journ√©e de travail de six heures</a></li>
<li><a href="../fr465069/index.html">Nouveau dans Hadoop: d√©couvrez les diff√©rents formats de fichiers dans Hadoop</a></li>
<li><a href="../fr465071/index.html">TechTrain 2019 IT festival: comment JUG.ru, JUGNsk et JUG.MSK y ont particip√©</a></li>
<li><a href="../fr465073/index.html">Ne sautez pas! Transitions interruptibles dans iOS</a></li>
<li><a href="../fr465075/index.html">Dans la cabine du conducteur du train</a></li>
<li><a href="../fr465077/index.html">Unsafe.AsSpan: Span <T> comment remplacer les pointeurs?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>