<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👙 🏪 🤚🏼 Les 10 erreurs les plus courantes lors de l'utilisation de la plate-forme Spring. 2e partie 🕹️ 🤣 👩🏾‍🤝‍👨🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Salut, Khabrovsk. La traduction de la deuxième partie de l'article préparée spécialement pour les étudiants du cours "Developer on the Spring Framewor...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Les 10 erreurs les plus courantes lors de l'utilisation de la plate-forme Spring. 2e partie</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/465063/">  <i>Salut, Khabrovsk.</i>  <i>La traduction de la deuxième partie de l'article préparée spécialement pour les étudiants du cours <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">"Developer on the Spring Framework"</a> est donc arrivée à temps.</i>  <i>La première partie peut être lue <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> .</i> <br><br><img src="https://habrastorage.org/webt/-i/va/66/-iva66o8uvrummnptqda3getv_i.png"><br><br><p>  <font color="gray">Spring est peut-être l'une des plateformes de développement Java les plus populaires.</font>  <font color="gray">Il s'agit d'un outil puissant, mais plutôt difficile à apprendre.</font>  <font color="gray">Ses concepts de base sont assez faciles à comprendre et à apprendre, mais il faut du temps et des efforts pour devenir un développeur Spring expérimenté.</font> <font color="gray"><br><br></font>  <font color="gray">Dans cet article, nous examinerons certaines des erreurs les plus courantes commises lors de l'utilisation de Spring et liées, en particulier, au développement d'applications Web et à l'utilisation de la plate-forme Spring Boot.</font>  <font color="gray">Comme indiqué sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">le site Web de Spring Boot</a> , Spring Boot adopte une approche <i>standardisée</i> pour créer des applications prêtes à l'emploi, et cet article suivra cette approche.</font>  <font color="gray">Il fournira un certain nombre de recommandations qui peuvent être utilisées efficacement dans le développement d'applications Web standard basées sur Spring Boot.</font> <font color="gray"><br><br></font>  <font color="gray">Dans le cas où vous n'êtes pas très familier avec la plate-forme Spring Boot, mais que vous souhaitez expérimenter avec les exemples de cet article, j'ai créé un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">référentiel GitHub avec des matériaux supplémentaires pour cet article</a> .</font>  <font color="gray">Si à un moment donné vous avez été un peu confus en lisant cet article, je vous conseillerais de créer un clone de ce référentiel et d'expérimenter le code sur votre ordinateur.</font> </p><a name="habracut"></a><br><hr><br><h2>  Erreur courante n ° 6: ne pas utiliser la validation des données basée sur les annotations </h2><br>  Imaginons que notre service TopTalent des exemples précédents ait besoin d'un point de terminaison pour ajouter de nouvelles données TopTalent.  Supposons également que pour une raison très importante, chaque nom que vous ajoutez doit comporter exactement 10 caractères.  Cela peut être implémenté, par exemple, comme suit: <br><br><pre><code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@RequestMapping</span></span>(<span class="hljs-string"><span class="hljs-string">"/put"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addTopTalent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@RequestBody TopTalentData topTalentData)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> nameNonExistentOrHasInvalidLength = Optional.ofNullable(topTalentData) .map(TopTalentData::getName) .map(name -&gt; name.length() == <span class="hljs-number"><span class="hljs-number">10</span></span>) .orElse(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (nameNonExistentOrInvalidLength) { <span class="hljs-comment"><span class="hljs-comment">//   } topTalentService.addTopTalent(topTalentData); }</span></span></code> </pre> <br>  Cependant, le code ci-dessus est non seulement mal structuré, mais ce n'est pas vraiment une solution «propre».  Nous effectuons plusieurs types de validation des données (à savoir, nous vérifions que l'objet <code>TopTalentData</code> pas nul, que la valeur du champ TopTalentData.name n'est pas nulle et que la longueur du champ <code>TopTalentData.name</code> est de 10 caractères), et <code>TopTalentData.name</code> également une exception si les données sont incorrectes. <br><br>  Tout cela peut être fait avec plus de précision en utilisant le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">validateur Hibernate</a> au printemps.  <code>addTopTalent</code> abord la méthode <code>addTopTalent</code> , en ajoutant la prise en charge de la validation des données: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@RequestMapping</span></span>(<span class="hljs-string"><span class="hljs-string">"/put"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addTopTalent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@Valid @NotNull @RequestBody TopTalentData topTalentData)</span></span></span><span class="hljs-function"> </span></span>{ topTalentService.addTopTalent(topTalentData); } <span class="hljs-meta"><span class="hljs-meta">@ExceptionHandler</span></span> <span class="hljs-meta"><span class="hljs-meta">@ResponseStatus</span></span>(HttpStatus.BAD_REQUEST) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ErrorResponse </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handleInvalidTopTalentDataException</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(MethodArgumentNotValidException methodArgumentNotValidException)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//    }</span></span></code> </pre> <br>  De plus, nous devons indiquer quelle validation de propriété nous voulons effectuer dans la classe <code>TopTalentData</code> : <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TopTalentData</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Length</span></span>(min = <span class="hljs-number"><span class="hljs-number">10</span></span>, max = <span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-meta"><span class="hljs-meta">@NotNull</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String name; }</code> </pre> <br>  Spring va maintenant intercepter la demande et la vérifier avant d'appeler la méthode, donc aucune vérification manuelle supplémentaire ne sera requise. <br><br>  L'objectif souhaité peut également être atteint en créant vos propres annotations.  Dans des conditions réelles, il est généralement judicieux d'utiliser vos propres annotations uniquement lorsque vos besoins dépassent les capacités de l'ensemble <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">intégré de restrictions Hibernate</a> , mais pour cet exemple, imaginons que les annotations <code>@Length</code> pas.  Vous pouvez créer un validateur de données qui vérifie la longueur d'une chaîne en créant deux classes supplémentaires: une pour la validation et une pour l'annotation des propriétés: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Target</span></span>({ElementType.METHOD, ElementType.FIELD, ElementType.PARAMETER}) <span class="hljs-meta"><span class="hljs-meta">@Retention</span></span>(RetentionPolicy.RUNTIME) <span class="hljs-meta"><span class="hljs-meta">@Documented</span></span> <span class="hljs-meta"><span class="hljs-meta">@Constraint</span></span>(validatedBy = { MyAnnotationValidator.class }) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-meta"><span class="hljs-meta">@interface</span></span> MyAnnotation { <span class="hljs-function"><span class="hljs-function">String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">message</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">default</span></span></span><span class="hljs-function"> "String length does not match expected"</span></span>; Class&lt;?&gt;[] groups() <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> {}; Class&lt;? extends Payload&gt;[] payload() <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> {}; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">value</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; } <span class="hljs-meta"><span class="hljs-meta">@Component</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyAnnotationValidator</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ConstraintValidator</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyAnnotation</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">String</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> expectedLength; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initialize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(MyAnnotation myAnnotation)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.expectedLength = myAnnotation.value(); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isValid</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String s, ConstraintValidatorContext constraintValidatorContext)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> s == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> || s.length() == <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.expectedLength; } }</code> </pre> <br><br>  Veuillez noter que dans ces cas, l'application correcte du principe de séparation des responsabilités nécessite de marquer la propriété comme valide si sa valeur est nulle <code>(s == null</code> dans la méthode <code>isValid</code> ), puis d'utiliser l'annotation <code>@NotNull</code> si cela est en outre requis pour cette propriété: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TopTalentData</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@MyAnnotation</span></span>(value = <span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-meta"><span class="hljs-meta">@NotNull</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String name; }</code> </pre> <br><h2>  Erreur courante n ° 7: utilisation de configurations basées sur XML héritées </h2><br>  L'utilisation de XML était une nécessité lors de l'utilisation des versions précédentes de Spring, mais maintenant la plupart des tâches de configuration peuvent être implémentées à l'aide de code Java et d'annotations.  Les configurations XML font désormais office de code de modèle supplémentaire et facultatif. <br><br>  Dans cet article (et également dans les matériaux du référentiel GitHub), les annotations sont utilisées pour configurer Spring, et Spring sait quels composants JavaBean doivent être liés, car le package racine est annoté à l'aide de l'annotation composite @SpringBootApplication - comme ceci: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@SpringBootApplication</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Application</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ SpringApplication.run(Application.class, args); } }</code> </pre> <br>  Cette annotation composite (voir la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation Spring pour</a> plus d'informations) indique simplement à la plate-forme Spring les packages à analyser pour extraire les composants JavaBean.  Dans notre cas particulier, cela signifie que les sous-packages co.kukurin suivants seront utilisés pour la liaison: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">Composant</a> (TopTalentConverter, MyAnnotationValidator) </li><li>  @RestController (TopTalentController) </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">Référentiel</a> (TopTalentRepository) </li><li>  Classes de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">service</a> (TopTalentService) </li></ul><br>  Si nous avons des classes supplémentaires qui ont l'annotation <code>@Configuration</code> , leur configuration Java sera également vérifiée. <br><br><h2>  Erreur courante # 8: ne pas utiliser de profils de configuration </h2><br>  Lors du développement de systèmes de serveurs, un problème courant est de basculer entre différentes configurations (en règle générale, il s'agit de configurations pour les environnements d'exploitation et de développement).  Au lieu de modifier manuellement divers paramètres à chaque transition entre les modes de test et de fonctionnement, il est plus efficace d'utiliser des profils de configuration. <br><br>  Imaginez le cas où dans l'environnement de développement local vous utilisez la base de données en RAM et dans l'environnement du fonctionnement réel de votre application, la base de données MySQL est utilisée.  Cela signifie essentiellement que vous utiliserez différentes URL et, vraisemblablement, différentes informations d'identification pour accéder à chacune de ces bases de données.  Voyons comment cela peut être implémenté à l'aide de deux fichiers de configuration: <br><br>  <b>FILE APPLICATION.YAML</b> <br><br><pre> <code class="java hljs"># set <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> profile to <span class="hljs-string"><span class="hljs-string">'dev'</span></span> spring.profiles.active: dev # production database details spring.datasource.url: <span class="hljs-string"><span class="hljs-string">'jdbc:mysql://localhost:3306/toptal'</span></span> spring.datasource.username: root spring.datasource.password:</code> </pre> <br><br>  <b>FILE APPLICATION-DEV.YAML</b> <br><br><pre> <code class="java hljs">spring.datasource.url: <span class="hljs-string"><span class="hljs-string">'jdbc:h2:mem:'</span></span> spring.datasource.platform: h2</code> </pre> <br><br>  Il faut supposer que lorsque vous travaillez avec du code, vous ne voudriez pas effectuer certaines actions aléatoires avec une base de données destinée à l'environnement d'exploitation, il est donc logique de sélectionner le profil pour l'environnement de développement (DEV) comme profil par défaut.  Par la suite, vous pouvez remplacer manuellement le profil de configuration sur le serveur en spécifiant <code>-Dspring.profiles.active=prod</code> pour la JVM.  De plus, le profil de configuration par défaut peut être spécifié dans la variable d'environnement du système d'exploitation. <br><br><h2>  Erreur courante numéro 9. Défaut d'utiliser le mécanisme d'injection de dépendance </h2><br>  Une utilisation appropriée du mécanisme d'injection de dépendances dans Spring signifie que Spring peut lier tous vos objets en analysant toutes les classes de configuration nécessaires.  Ceci est utile pour relâcher les interdépendances et facilite grandement les tests.  Au lieu de lier étroitement les classes, quelque chose comme ceci: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TopTalentController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> TopTalentService topTalentService; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TopTalentController</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.topTalentService = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TopTalentService(); } }</code> </pre> <br>  ... nous permettons à la plateforme Spring de lier: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TopTalentController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> TopTalentService topTalentService; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TopTalentController</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(TopTalentService topTalentService)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.topTalentService = topTalentService; } }</code> </pre> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">La conférence de Mishko Hevery sur la chaîne Google Tech Talks</a> explique en détail pourquoi l'injection de dépendance doit être utilisée, mais nous verrons ici comment ce mécanisme est utilisé dans la pratique.  Dans la division des responsabilités («Common Mistake # 3»), nous avons créé les classes de service et de contrôleur.  Supposons que nous voulons tester un contrôleur, en supposant que la classe <code>TopTalentService</code> fonctionne correctement.  Nous pouvons insérer un objet simulateur au lieu de l'implémentation de service actuelle en créant une classe de configuration distincte: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SampleUnitTestConfig</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> TopTalentService </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">topTalentService</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ TopTalentService topTalentService = Mockito.mock(TopTalentService.class); Mockito.when(topTalentService.getTopTalent()).thenReturn( Stream.of(<span class="hljs-string"><span class="hljs-string">"Mary"</span></span>, <span class="hljs-string"><span class="hljs-string">"Joel"</span></span>).map(TopTalentData::<span class="hljs-keyword"><span class="hljs-keyword">new</span></span>).collect(Collectors.toList())); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> topTalentService; } }</code> </pre> <br>  Après cela, nous pouvons implémenter l'objet simulateur en <code>SampleUnitTestConfig</code> plate-forme Spring que nous devons utiliser <code>SampleUnitTestConfig</code> comme source de configuration: <br> <code>@ContextConfiguration(classes = { SampleUnitTestConfig.class })</code> <br> <br>  Par la suite, cela nous permettra d'utiliser la configuration contextuelle pour intégrer le composant JavaBean personnalisé dans un test unitaire. <br><br><h2>  Erreur courante numéro 10. Absence de test ou test incorrect </h2><br>  Malgré le fait que l'idée des tests unitaires n'est pas nouvelle, il semble que de nombreux développeurs "l'oublient" (surtout si ce n'est <i>pas obligatoire</i> ) ou le dépensent trop tard.  Évidemment, c'est faux, car les tests vous permettent non seulement de vérifier le bon fonctionnement du code, mais servent également de documentation montrant comment l'application doit se comporter dans diverses situations. <br>  Lorsque vous testez des services Web, vous exécutez rarement des tests unitaires exceptionnellement «propres», car pour une connexion HTTP, vous devez généralement utiliser le servlet Spring <code>DispatcherServlet</code> et voir ce qui se passe lorsque vous recevez une vraie demande <code>HttpServletRequest</code> (c'est-à-dire qu'il s'avère qu'un test d' <i>intégration</i> utilise validation, sérialisation, etc.).  Une solution élégante et éprouvée consiste à utiliser <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">REST Assured</a> , une bibliothèque Java pour tester facilement les services REST, avec MockMVC.  Considérez le fragment de code suivant avec injection de dépendance: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@RunWith</span></span>(SpringJUnit4ClassRunner.class) <span class="hljs-meta"><span class="hljs-meta">@ContextConfiguration</span></span>(classes = { Application.class, SampleUnitTestConfig.class }) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RestAssuredTestDemonstration</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> TopTalentController topTalentController; <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">shouldGetMaryAndJoel</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// given MockMvcRequestSpecification givenRestAssuredSpecification = RestAssuredMockMvc.given() .standaloneSetup(topTalentController); // when MockMvcResponse response = givenRestAssuredSpecification.when().get("/toptal/get"); // then response.then().statusCode(200); response.then().body("name", hasItems("Mary", "Joel")); } }</span></span></code> </pre> <br>  <code>SampleUnitTestConfig</code> lie l'implémentation de substitution de la classe <code>TopTalentService</code> au <code>TopTalentController</code> , et toutes les autres classes sont liées à l'aide de la configuration standard obtenue en analysant les packages en fonction du package de la classe Application.  <code>RestAssuredMockMvc</code> simplement utilisé pour configurer un environnement léger et envoyer une demande <code>GET</code> au <code>/toptal/get</code> . <br><br><h3>  Utilisez Spring professionnellement </h3><br>  Spring est une plate-forme puissante facile à démarrer, mais il faut du temps et des efforts pour la maîtriser pleinement.  Si vous prenez le temps de vous familiariser avec cette plateforme, elle augmentera sans aucun doute l'efficacité de votre travail, vous aidera à créer un code plus propre et à augmenter vos qualifications en tant que développeur. <br><br>  Je vous recommande de prêter attention à <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Spring In Action</a> - c'est un bon livre orienté vers les applications qui aborde de nombreux sujets importants liés à la plate-forme Spring. <br><br>  À ce stade, la traduction de cet article a pris fin. <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Lisez la première partie</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr465063/">https://habr.com/ru/post/fr465063/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr465049/index.html">10 livres sur la gestion de projet Agile à emporter avec vous en 2020</a></li>
<li><a href="../fr465055/index.html">Six compétences pour faire passer votre carrière en Data Science au niveau supérieur.</a></li>
<li><a href="../fr465057/index.html">Conteneurs et fenêtres. De Hello World à Kubernetes. Première partie, introduction</a></li>
<li><a href="../fr465059/index.html">PoE à une distance de plus de 200 mètres. Surveillance et redémarrage automatique des clients PoE</a></li>
<li><a href="../fr465061/index.html">Pourquoi au lieu d'une semaine de travail de quatre jours, il vaut mieux penser à une journée de travail de six heures</a></li>
<li><a href="../fr465069/index.html">Nouveau dans Hadoop: découvrez les différents formats de fichiers dans Hadoop</a></li>
<li><a href="../fr465071/index.html">TechTrain 2019 IT festival: comment JUG.ru, JUGNsk et JUG.MSK y ont participé</a></li>
<li><a href="../fr465073/index.html">Ne sautez pas! Transitions interruptibles dans iOS</a></li>
<li><a href="../fr465075/index.html">Dans la cabine du conducteur du train</a></li>
<li><a href="../fr465077/index.html">Unsafe.AsSpan: Span <T> comment remplacer les pointeurs?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>