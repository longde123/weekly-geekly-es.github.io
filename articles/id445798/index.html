<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßõ ü§ò üë©üèº‚Äçüéì Badak di dalam kucing - jalankan firmware di emulator Kopycat üéª üôéüèª üë©üèø‚Äçüç≥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dalam kerangka pertemuan 0x0A DC7831 DEF CON Nizhny Novgorod pada 16 Februari, kami menyajikan laporan tentang prinsip-prinsip dasar emulasi kode bine...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Badak di dalam kucing - jalankan firmware di emulator Kopycat</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/inforion/blog/445798/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/gi/pb/7e/gipb7e8ucwinvebjerxy1fk2d-8.jpeg" width="80%"></div><br><p>  Dalam kerangka pertemuan 0x0A DC7831 <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">DEF CON Nizhny Novgorod</a> pada 16 Februari, kami menyajikan laporan tentang prinsip-prinsip dasar emulasi kode biner dan pengembangan kami sendiri - sebuah emulator platform perangkat keras <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Kopycat</a> . </p><br><p>  Dalam artikel ini, kami akan menjelaskan peluncuran firmware perangkat di emulator, menunjukkan interaksi dengan debugger dan melakukan analisis dinamis kecil dari firmware. </p><a name="habracut"></a><br><h2 id="predystoriya">  Latar belakang </h2><br><p><del>  Dahulu kala di galaksi jauh sekali </del></p><br><p>  Beberapa tahun yang lalu di laboratorium kami ada kebutuhan untuk mempelajari firmware perangkat.  Firmware dikompresi, dibongkar oleh bootloader.  Dia melakukan ini dengan cara yang sangat membingungkan, beberapa kali menggeser data dalam memori.  Ya, dan firmware itu sendiri kemudian secara aktif berinteraksi dengan periferal.  Dan semua ini pada inti MIPS. </p><br><p> Untuk alasan obyektif, emulator yang ada tidak cocok untuk kita, tetapi saya masih ingin menjalankan kode.  Kemudian kami memutuskan untuk membuat emulator kami sendiri, yang akan membuat minimum dan memungkinkan untuk membongkar firmware utama.  Kami mencoba - ternyata.  Kami pikir, bagaimana jika kami menambah periferal agar juga melakukan firmware utama.  Itu tidak terlalu menyakitkan - dan itu berhasil juga.  Kami berpikir lagi dan memutuskan untuk membuat emulator lengkap. </p><br><p>  Hasilnya adalah emulator sistem komputasi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Kopycat</a> . </p><br><img src="https://habrastorage.org/webt/eb/cx/b6/ebcxb6pxtiypy0s-usvu6i_hdwu.png" align="right"><br><div class="spoiler">  <b class="spoiler_title">Kenapa Kopycat?</b> <div class="spoiler_text"><p>  Ada permainan kata-kata. </p><br><ol><li>  <em>copycat</em> (Bahasa Inggris, n. [Ààk…íp…™k√¶t]) - copycat, peniru </li><li>  <em>cat</em> (Bahasa Inggris, n. [Ààk√¶t]) - kucing, kucing - hewan favorit salah satu pencipta proyek </li><li>  Huruf "K" - dari bahasa pemrograman Kotlin </li></ol></div></div><br><h2 id="kopycat">  Kopycat </h2><br><p>  Saat membuat emulator, tujuan yang sangat spesifik ditetapkan: </p><br><ul><li>  kemampuan untuk dengan cepat membuat periferal, modul, inti prosesor baru; </li><li>  kemampuan untuk merakit perangkat virtual dari berbagai modul; </li><li>  kemampuan untuk memuat data biner (firmware) apa pun ke dalam memori perangkat virtual; </li><li>  kemampuan untuk bekerja dengan snapshot (snapshot dari keadaan sistem); </li><li>  kemampuan untuk berinteraksi dengan emulator melalui debugger bawaan; </li><li>  bahasa modern yang bagus untuk dikembangkan. </li></ul><br><p>  Akibatnya, Kotlin dipilih untuk implementasi, arsitektur bus (inilah saat modul berkomunikasi satu sama lain melalui bus data virtual), JSON sebagai format deskripsi perangkat, dan GDB RSP sebagai protokol untuk berinteraksi dengan debugger. </p><br><p>  Pembangunan telah berlangsung selama lebih dari dua tahun dan secara aktif sedang berlangsung.  Selama waktu ini, inti prosesor MIPS, x86, V850ES, ARM, PowerPC diimplementasikan. </p><br><p>  Proyek ini berkembang, dan sekarang saatnya untuk memperkenalkannya kepada masyarakat umum.  Kami akan membuat deskripsi rinci tentang proyek nanti, tetapi sekarang kami akan fokus menggunakan Kopycat. </p><br><p>  Untuk yang paling tidak sabar - versi promo dari emulator dapat diunduh di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> . </p><br><h2 id="nosorog-v-emulyatore">  Badak di emulator </h2><br><p>  Ingatlah bahwa sebelumnya untuk konferensi SMARTRHINO-2018, alat uji "Badak" diciptakan untuk pelatihan keterampilan rekayasa terbalik.  Proses analisis firmware statis dijelaskan dalam <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">artikel ini</a> . </p><br><p>  Sekarang mari kita coba menambahkan "speaker" dan menjalankan firmware di emulator. </p><br><p>  Kami akan membutuhkan: <br>  1) Jawa 1.8 <br>  2) Python dan modul <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Jep</a> untuk menggunakan Python di dalam emulator.  Perakitan WHL dari modul Jep untuk Windows dapat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">diunduh di sini</a> . </p><br><p>  <strong>Untuk Windows:</strong> <br>  1) <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">com0com</a> <br>  2) <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Putty</a> </p><br><p>  <strong>Untuk Linux:</strong> <br>  1) socat </p><br><p>  Anda dapat menggunakan Eclipse, IDA Pro, atau radare2 sebagai klien GDB. </p><br><h2 id="kak-eto-rabotaet">  Bagaimana cara kerjanya? </h2><br><p>  Untuk melakukan firmware pada emulator, Anda harus "merakit" perangkat virtual, yang merupakan analog dari perangkat nyata. </p><br><p>  Perangkat nyata ("badak") dapat ditampilkan dalam diagram blok: </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/nh/ph/ph/nhphph7rjwm3xiv52mvp_uefdq8.jpeg" alt="Sirkuit perangkat nyata" width="60%"></div><br><p>  Emulator memiliki struktur modular dan perangkat virtual final dapat dijelaskan dalam file JSON. </p><br><div class="spoiler">  <b class="spoiler_title">JSON di 105 baris</b> <div class="spoiler_text"><pre><code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"top"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, // Plugin name should be the same as file name (or full path from library start) <span class="hljs-attr"><span class="hljs-attr">"plugin"</span></span>: <span class="hljs-string"><span class="hljs-string">"rhino"</span></span>, // Directory where plugin places <span class="hljs-attr"><span class="hljs-attr">"library"</span></span>: <span class="hljs-string"><span class="hljs-string">"user"</span></span>, // Plugin parameters (constructor parameters if jar-plugin version) <span class="hljs-attr"><span class="hljs-attr">"params"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"tty_dbg"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"String"</span></span>}, { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"tty_bt"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"String"</span></span>}, { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"firmware"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"String"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"default"</span></span>: <span class="hljs-string"><span class="hljs-string">"NUL"</span></span>} ], // Plugin outer ports <span class="hljs-attr"><span class="hljs-attr">"ports"</span></span>: [ ], // Plugin internal buses <span class="hljs-attr"><span class="hljs-attr">"buses"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"mem"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"size"</span></span>: <span class="hljs-string"><span class="hljs-string">"BUS30"</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"nand"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"size"</span></span>: <span class="hljs-string"><span class="hljs-string">"4"</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"gpio"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"size"</span></span>: <span class="hljs-string"><span class="hljs-string">"BUS32"</span></span> } ], // Plugin internal components <span class="hljs-attr"><span class="hljs-attr">"modules"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"u1_stm32"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"plugin"</span></span>: <span class="hljs-string"><span class="hljs-string">"STM32F042"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"library"</span></span>: <span class="hljs-string"><span class="hljs-string">"mcu"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"params"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"firmware:String"</span></span>: <span class="hljs-string"><span class="hljs-string">"params.firmware"</span></span> } }, { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"usart_debug"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"plugin"</span></span>: <span class="hljs-string"><span class="hljs-string">"UartSerialTerminal"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"library"</span></span>: <span class="hljs-string"><span class="hljs-string">"terminals"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"params"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"tty"</span></span>: <span class="hljs-string"><span class="hljs-string">"params.tty_dbg"</span></span> } }, { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"term_bt"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"plugin"</span></span>: <span class="hljs-string"><span class="hljs-string">"UartSerialTerminal"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"library"</span></span>: <span class="hljs-string"><span class="hljs-string">"terminals"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"params"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"tty"</span></span>: <span class="hljs-string"><span class="hljs-string">"params.tty_bt"</span></span> } }, { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"bluetooth"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"plugin"</span></span>: <span class="hljs-string"><span class="hljs-string">"BT"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"library"</span></span>: <span class="hljs-string"><span class="hljs-string">"mcu"</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"led_0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"plugin"</span></span>: <span class="hljs-string"><span class="hljs-string">"LED"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"library"</span></span>: <span class="hljs-string"><span class="hljs-string">"mcu"</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"led_1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"plugin"</span></span>: <span class="hljs-string"><span class="hljs-string">"LED"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"library"</span></span>: <span class="hljs-string"><span class="hljs-string">"mcu"</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"led_2"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"plugin"</span></span>: <span class="hljs-string"><span class="hljs-string">"LED"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"library"</span></span>: <span class="hljs-string"><span class="hljs-string">"mcu"</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"led_3"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"plugin"</span></span>: <span class="hljs-string"><span class="hljs-string">"LED"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"library"</span></span>: <span class="hljs-string"><span class="hljs-string">"mcu"</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"led_4"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"plugin"</span></span>: <span class="hljs-string"><span class="hljs-string">"LED"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"library"</span></span>: <span class="hljs-string"><span class="hljs-string">"mcu"</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"led_5"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"plugin"</span></span>: <span class="hljs-string"><span class="hljs-string">"LED"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"library"</span></span>: <span class="hljs-string"><span class="hljs-string">"mcu"</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"led_6"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"plugin"</span></span>: <span class="hljs-string"><span class="hljs-string">"LED"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"library"</span></span>: <span class="hljs-string"><span class="hljs-string">"mcu"</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"led_7"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"plugin"</span></span>: <span class="hljs-string"><span class="hljs-string">"LED"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"library"</span></span>: <span class="hljs-string"><span class="hljs-string">"mcu"</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"led_8"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"plugin"</span></span>: <span class="hljs-string"><span class="hljs-string">"LED"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"library"</span></span>: <span class="hljs-string"><span class="hljs-string">"mcu"</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"led_9"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"plugin"</span></span>: <span class="hljs-string"><span class="hljs-string">"LED"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"library"</span></span>: <span class="hljs-string"><span class="hljs-string">"mcu"</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"led_10"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"plugin"</span></span>: <span class="hljs-string"><span class="hljs-string">"LED"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"library"</span></span>: <span class="hljs-string"><span class="hljs-string">"mcu"</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"led_11"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"plugin"</span></span>: <span class="hljs-string"><span class="hljs-string">"LED"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"library"</span></span>: <span class="hljs-string"><span class="hljs-string">"mcu"</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"led_12"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"plugin"</span></span>: <span class="hljs-string"><span class="hljs-string">"LED"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"library"</span></span>: <span class="hljs-string"><span class="hljs-string">"mcu"</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"led_13"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"plugin"</span></span>: <span class="hljs-string"><span class="hljs-string">"LED"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"library"</span></span>: <span class="hljs-string"><span class="hljs-string">"mcu"</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"led_14"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"plugin"</span></span>: <span class="hljs-string"><span class="hljs-string">"LED"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"library"</span></span>: <span class="hljs-string"><span class="hljs-string">"mcu"</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"led_15"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"plugin"</span></span>: <span class="hljs-string"><span class="hljs-string">"LED"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"library"</span></span>: <span class="hljs-string"><span class="hljs-string">"mcu"</span></span> } ], // Plugin connection between components <span class="hljs-attr"><span class="hljs-attr">"connections"</span></span>: [ [ <span class="hljs-string"><span class="hljs-string">"u1_stm32.ports.usart1_m"</span></span>, <span class="hljs-string"><span class="hljs-string">"usart_debug.ports.term_s"</span></span>], [ <span class="hljs-string"><span class="hljs-string">"u1_stm32.ports.usart1_s"</span></span>, <span class="hljs-string"><span class="hljs-string">"usart_debug.ports.term_m"</span></span>], [ <span class="hljs-string"><span class="hljs-string">"u1_stm32.ports.usart2_m"</span></span>, <span class="hljs-string"><span class="hljs-string">"bluetooth.ports.usart_m"</span></span>], [ <span class="hljs-string"><span class="hljs-string">"u1_stm32.ports.usart2_s"</span></span>, <span class="hljs-string"><span class="hljs-string">"bluetooth.ports.usart_s"</span></span>], [ <span class="hljs-string"><span class="hljs-string">"bluetooth.ports.bt_s"</span></span>, <span class="hljs-string"><span class="hljs-string">"term_bt.ports.term_m"</span></span>], [ <span class="hljs-string"><span class="hljs-string">"bluetooth.ports.bt_m"</span></span>, <span class="hljs-string"><span class="hljs-string">"term_bt.ports.term_s"</span></span>], [ <span class="hljs-string"><span class="hljs-string">"led_0.ports.pin"</span></span>, <span class="hljs-string"><span class="hljs-string">"u1_stm32.buses.pin_output_a"</span></span>, <span class="hljs-string"><span class="hljs-string">"0x00"</span></span>], [ <span class="hljs-string"><span class="hljs-string">"led_1.ports.pin"</span></span>, <span class="hljs-string"><span class="hljs-string">"u1_stm32.buses.pin_output_a"</span></span>, <span class="hljs-string"><span class="hljs-string">"0x01"</span></span>], [ <span class="hljs-string"><span class="hljs-string">"led_2.ports.pin"</span></span>, <span class="hljs-string"><span class="hljs-string">"u1_stm32.buses.pin_output_a"</span></span>, <span class="hljs-string"><span class="hljs-string">"0x02"</span></span>], [ <span class="hljs-string"><span class="hljs-string">"led_3.ports.pin"</span></span>, <span class="hljs-string"><span class="hljs-string">"u1_stm32.buses.pin_output_a"</span></span>, <span class="hljs-string"><span class="hljs-string">"0x03"</span></span>], [ <span class="hljs-string"><span class="hljs-string">"led_4.ports.pin"</span></span>, <span class="hljs-string"><span class="hljs-string">"u1_stm32.buses.pin_output_a"</span></span>, <span class="hljs-string"><span class="hljs-string">"0x04"</span></span>], [ <span class="hljs-string"><span class="hljs-string">"led_5.ports.pin"</span></span>, <span class="hljs-string"><span class="hljs-string">"u1_stm32.buses.pin_output_a"</span></span>, <span class="hljs-string"><span class="hljs-string">"0x05"</span></span>], [ <span class="hljs-string"><span class="hljs-string">"led_6.ports.pin"</span></span>, <span class="hljs-string"><span class="hljs-string">"u1_stm32.buses.pin_output_a"</span></span>, <span class="hljs-string"><span class="hljs-string">"0x06"</span></span>], [ <span class="hljs-string"><span class="hljs-string">"led_7.ports.pin"</span></span>, <span class="hljs-string"><span class="hljs-string">"u1_stm32.buses.pin_output_a"</span></span>, <span class="hljs-string"><span class="hljs-string">"0x07"</span></span>], [ <span class="hljs-string"><span class="hljs-string">"led_8.ports.pin"</span></span>, <span class="hljs-string"><span class="hljs-string">"u1_stm32.buses.pin_output_a"</span></span>, <span class="hljs-string"><span class="hljs-string">"0x08"</span></span>], [ <span class="hljs-string"><span class="hljs-string">"led_9.ports.pin"</span></span>, <span class="hljs-string"><span class="hljs-string">"u1_stm32.buses.pin_output_a"</span></span>, <span class="hljs-string"><span class="hljs-string">"0x09"</span></span>], [ <span class="hljs-string"><span class="hljs-string">"led_10.ports.pin"</span></span>, <span class="hljs-string"><span class="hljs-string">"u1_stm32.buses.pin_output_a"</span></span>, <span class="hljs-string"><span class="hljs-string">"0x0A"</span></span>], [ <span class="hljs-string"><span class="hljs-string">"led_11.ports.pin"</span></span>, <span class="hljs-string"><span class="hljs-string">"u1_stm32.buses.pin_output_a"</span></span>, <span class="hljs-string"><span class="hljs-string">"0x0B"</span></span>], [ <span class="hljs-string"><span class="hljs-string">"led_12.ports.pin"</span></span>, <span class="hljs-string"><span class="hljs-string">"u1_stm32.buses.pin_output_a"</span></span>, <span class="hljs-string"><span class="hljs-string">"0x0C"</span></span>], [ <span class="hljs-string"><span class="hljs-string">"led_13.ports.pin"</span></span>, <span class="hljs-string"><span class="hljs-string">"u1_stm32.buses.pin_output_a"</span></span>, <span class="hljs-string"><span class="hljs-string">"0x0D"</span></span>], [ <span class="hljs-string"><span class="hljs-string">"led_14.ports.pin"</span></span>, <span class="hljs-string"><span class="hljs-string">"u1_stm32.buses.pin_output_a"</span></span>, <span class="hljs-string"><span class="hljs-string">"0x0E"</span></span>], [ <span class="hljs-string"><span class="hljs-string">"led_15.ports.pin"</span></span>, <span class="hljs-string"><span class="hljs-string">"u1_stm32.buses.pin_output_a"</span></span>, <span class="hljs-string"><span class="hljs-string">"0x0F"</span></span>] ] }</code> </pre> <br><p>  Perhatikan parameter <em>firmware</em> di bagian <strong>params</strong> - ini adalah nama file yang dapat diunduh ke perangkat virtual sebagai firmware. </p></div></div><br><p>  Perangkat virtual dan interaksinya dengan sistem operasi utama dapat direpresentasikan sebagai berikut: </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/m9/i_/27/m9i_27btauj0onjugttzj3srmfg.jpeg" alt="Perangkat yang diemulasi sirkuit" width="80%"></div><br><p>  Contoh pengujian emulator saat ini melibatkan interaksi dengan port COM pada OS utama (debug UART dan UART untuk modul Bluetooth).  Ini bisa menjadi port nyata yang terhubung dengan perangkat atau port COM virtual ( <em>com0com / socat</em> hanya untuk ini <em>)</em> . </p><br><p>  Saat ini ada dua cara utama untuk berinteraksi dengan emulator dari luar: </p><br><ul><li>  Protokol GDB RSP (masing-masing, mendukung protokol ini, alat - Eclipse / IDA / radare2); </li><li>  baris perintah internal emulator (Argparse atau Python). </li></ul><br><h3 id="virtualnye-com-porty">  Port COM Virtual </h3><br><p>  Untuk berinteraksi dengan UART perangkat virtual pada mesin lokal melalui terminal, Anda perlu membuat beberapa port COM virtual yang terhubung.  Dalam kasus kami, satu port menggunakan emulator, dan yang kedua program terminal (Putty atau layar): </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/5d/jr/0w/5djr0wz88dgdaiw1xaasrof2wyk.png" alt="Port COM Virtual" width="80%"></div><br><h4 id="ispolzovanie-com0com">  Menggunakan com0com </h4><br><p>  Port COM virtual dikonfigurasi dengan utilitas pengaturan dari kit com0com (versi konsol adalah <em>C: \ Program Files (x86) \ com0com \ setup.exe,</em> atau versi GUI adalah <em>C: \ Program Files (x86) \ com0com \ setupg.exe</em> ) : </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/v-/j9/pf/v-j9pfquunpiezqhkcr6cuyq-9k.png" alt="Konfigurasikan port COM virtual"></div><br><p>  <strong><em>Periksa kotak centang aktifkan buffer overrun</em></strong> untuk semua port virtual yang dibuat, jika tidak emulator akan menunggu respons dari port COM. </p><br><h4 id="ispolzovanie-socat">  Menggunakan socat </h4><br><p>  Pada sistem UNIX, port COM virtual secara otomatis dibuat oleh emulator menggunakan utilitas socat, untuk ini cukup untuk menentukan awalan <code>socat:</code> pada nama port ketika memulai emulator. </p><br><h3 id="vnutrenniy-interfeys-komandnoy-stroki-argparse-ili-python">  Antarmuka baris perintah internal (Argparse atau Python) </h3><br><p>  Karena Kopycat adalah aplikasi konsol, emulator menyediakan dua opsi untuk antarmuka baris perintah untuk berinteraksi dengan objek dan variabelnya: Argparse dan Python. </p><br><p>  Argparse adalah CLI yang dibangun di Kopycat, selalu tersedia untuk semua orang. </p><br><p>  CLI alternatif adalah juru bahasa Python.  Untuk menggunakannya, Anda perlu menginstal modul Jep Python dan mengkonfigurasi emulator agar berfungsi dengan Python (interpreter Python yang diinstal pada sistem utama pengguna akan digunakan). </p><br><h4 id="ustanovka-python-modulya-jep">  Instal Modul Python Jep </h4><br><p>  Di Linux, Jep dapat diinstal melalui pip: </p><br><pre> <code class="bash hljs">pip install jep</code> </pre> <br><p>  Untuk menginstal Jep di Windows, Anda harus terlebih dahulu menginstal Windows SDK dan Microsoft Visual Studio yang sesuai.  Kami sedikit menyederhanakan tugas Anda dan membuat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">rakitan WHL</a> JEP untuk versi Python untuk Windows saat ini, sehingga modul dapat diinstal dari sebuah file: </p><br><pre> <code class="bash hljs">pip install jep-3.8.2-cp27-cp27m-win_amd64.whl</code> </pre> <br><p>  Untuk memverifikasi instalasi Jep, Anda harus menjalankan baris perintah: </p><br><pre> <code class="bash hljs">python -c <span class="hljs-string"><span class="hljs-string">"import jep"</span></span></code> </pre> <br><p>  Sebagai tanggapan, sebuah pesan harus diterima: </p><br><pre> <code class="bash hljs">ImportError: Jep is not supported <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> standalone Python, it must be embedded <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Java.</code> </pre> <br><p>  Dalam file batch emulator untuk sistem Anda ( <em>kopycat.bat</em> untuk Windows, <em>kopycat</em> untuk Linux) tambahkan parameter tambahan <code>Djava.library.path</code> ke daftar parameter <code>DEFAULT_JVM_OPTS</code> - itu harus berisi path ke modul Jep yang diinstal. </p><br><p>  Akibatnya, untuk Windows, Anda harus mendapatkan garis seperti ini: </p><br><pre> <code class="plaintext hljs">set DEFAULT_JVM_OPTS="-XX:MaxMetaspaceSize=256m" "-XX:+UseParallelGC" "-XX:SurvivorRatio=6" "-XX:-UseGCOverheadLimit" "-Djava.library.path=C:/Python27/Lib/site-packages/jep"</code> </pre> <br><h2 id="zapusk-kopycat">  Peluncuran Kopycat </h2><br><p>  Emulator adalah aplikasi konsol JVM.  Peluncuran ini dilakukan melalui skrip baris perintah dari sistem operasi (sh / cmd). </p><br><p>  Perintah untuk dijalankan di bawah Windows: </p><br><pre> <code class="plaintext hljs">bin\kopycat -g 23946 -n rhino -l user -y library -p firmware=firmware\rhino_pass.bin,tty_dbg=COM26,tty_bt=COM28</code> </pre> <br><p>  Perintah untuk dijalankan di Linux menggunakan utilitas socat: </p><br><pre> <code class="plaintext hljs">./bin/kopycat -g 23946 -n rhino -l user -y library -p firmware=./firmware/rhino_pass.bin,tty_dbg=socat:./COM26,tty_bt=socat:./COM28</code> </pre> <br><ul><li>  <code>-g 23646</code> - Port TCP yang akan terbuka untuk akses ke server GDB; </li><li>  <code>-n rhino</code> - nama modul utama sistem (perakitan perangkat); </li><li>  <code>-l user</code> - nama perpustakaan untuk mencari modul utama; </li><li>  <code>-y library</code> - jalur untuk mencari modul yang termasuk dalam perangkat; </li><li>  <code>firmware\rhino_pass.bin</code> - path ke file firmware; </li><li>  COM26 dan COM28 adalah port COM virtual. </li></ul><br><p>  Hasilnya adalah <code>Argparse &gt;</code> <code>Python &gt;</code> (atau <code>Argparse &gt;</code> ): </p><br><pre> <code class="plaintext hljs">18:07:59 INFO [eFactoryBuilder.create ]: Module top successfully created as top 18:07:59 INFO [ Module.initializeAndRes]: Setup core to top.u1_stm32.cortexm0.arm for top 18:07:59 INFO [ Module.initializeAndRes]: Setup debugger to top.u1_stm32.dbg for top 18:07:59 WARN [ Module.initializeAndRes]: Tracer wasn't found in top... 18:07:59 INFO [ Module.initializeAndRes]: Initializing ports and buses... 18:07:59 WARN [ Module.initializePortsA]: ATTENTION: Some ports has warning use printModulesPortsWarnings to see it... 18:07:59 FINE [ ARMv6CPU.reset ]: Set entry point address to 08006A75 18:07:59 INFO [ Module.initializeAndRes]: Module top is successfully initialized and reset as a top cell! 18:07:59 INFO [ Kopycat.open ]: Starting virtualization of board top[rhino] with arm[ARMv6Core] 18:07:59 INFO [ GDBServer.debuggerModule ]: Set new debugger module top.u1_stm32.dbg for GDB_SERVER(port=23946,alive=true) Python &gt;</code> </pre> <br><h2 id="vzaimodeystvie-s-ida-pro">  Interaksi dengan IDA Pro </h2><br><p>  Untuk menyederhanakan pengujian, kami menggunakan firmware Badak sebagai <a href="">file ELF</a> (meta-informasi disimpan di sana) sebagai file sumber untuk analisis dalam IDA. </p><br><p>  Anda juga dapat menggunakan firmware utama tanpa meta-informasi. </p><br><p>  Setelah memulai Kopycat di IDA Pro, di menu Debugger, buka item " <em>Tukar debugger ...</em> " dan pilih " <em>Remote GDB debugger</em> ".  Selanjutnya, konfigurasikan koneksi: Menu <em>Debugger - Opsi proses ...</em> </p><br><p>  Tetapkan nilai: </p><br><ul><li>  Aplikasi - nilai apa pun </li><li>  Hostname: 127.0.0.1 (atau alamat IP mesin jarak jauh tempat Kopycat berjalan) </li><li>  Port: 23946 </li></ul><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/mx/kw/-l/mxkw-lbzq_igoewovazplw4moho.png" alt="Mengonfigurasi koneksi ke server GDB"></div><br><p>  Sekarang tombol mulai debug tersedia (tombol F9): </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/af/mu/-q/afmu-qpi0ymfpsga-orunargmas.png"></div><br><p>  Tekan itu - itu terhubung ke modul debugger di emulator.  IDA masuk ke mode debug, jendela tambahan tersedia: informasi tentang register, tentang stack. </p><br><p>  Sekarang kita dapat menggunakan semua fitur standar untuk bekerja dengan debugger: </p><br><ul><li>  langkah-langkah pelaksanaan instruksi ( <em>Langkah ke</em> dan <em>Langkah</em> - masing-masing kunci F7 dan F8); </li><li>  memulai dan menghentikan eksekusi; </li><li>  membuat breakpoint pada kode dan data (kunci F2). </li></ul><br><p>  Menghubungkan ke debugger tidak berarti memulai kode firmware.  Posisi saat ini untuk eksekusi harus alamat <code>0x08006A74</code> - awal dari fungsi <em>Reset_Handler</em> .  Jika Anda menggulir daftar ke bawah, Anda dapat melihat panggilan ke fungsi <em>utama</em> .  Anda dapat menempatkan kursor pada baris ini (alamat <code>0x08006ABE</code> ) dan melakukan operasi <em>Run hingga kursor</em> (tombol F4). </p><br><p><img src="https://habrastorage.org/webt/wx/k4/3r/wxk43r-316cpnsdabb9eydkzus4.png" alt="gambar"></p><br><p>  Selanjutnya, Anda dapat menekan F7 untuk masuk ke fungsi <em>utama</em> . </p><br><p>  Jika Anda menjalankan perintah <em>Lanjutkan proses</em> (tombol F9), jendela "Silakan tunggu" akan muncul dengan satu tombol <em>Tangguhkan</em> : </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/9e/78/tg/9e78tgoterc50rqvmosunzp1u5i.png"></div><br><p>  Ketika <em>Ditangguhkan</em> ditekan, eksekusi kode firmware ditangguhkan dan dapat dilanjutkan dari alamat yang sama dalam kode tempat kode itu terputus. </p><br><p>  Jika Anda terus mengeksekusi kode, maka di terminal yang terhubung ke port COM virtual, Anda dapat melihat baris berikut: </p><br><p><img src="https://habrastorage.org/webt/fi/vi/j-/fivij-hshz3izcxoo0lnewnznc8.png" alt="gambar"></p><br><p><img src="https://habrastorage.org/webt/2m/cn/oq/2mcnoqd__te1i0sq5z28jd29mdg.png" alt="gambar"></p><br><p>  Kehadiran string "state bypass" menunjukkan bahwa modul Bluetooth virtual telah beralih ke mode penerimaan data dari port COM pengguna. </p><br><p>  Sekarang di terminal Bluetooth (pada gambar - COM29) Anda dapat memasukkan perintah sesuai dengan protokol Badak.  Misalnya, string "mur-mur" kembali ke perintah "MEOW" di terminal Bluetooth: </p><br><img src="https://habrastorage.org/webt/yq/td/ab/yqtdabgfdd3jlzswsrk3rvbdzds.png"><br><br><h3 id="emuliruy-menya-ne-polnostyu">  Meniru saya tidak sepenuhnya </h3><br><p>  Saat membangun emulator, Anda dapat memilih tingkat detail / emulasi perangkat.  Jadi, misalnya, modul Bluetooth dapat ditiru dengan berbagai cara: </p><br><ul><li>  perangkat yang sepenuhnya ditiru dengan serangkaian perintah; </li><li>  Perintah AT ditiru, dan aliran data diterima dari port COM dari sistem utama; </li><li>  perangkat virtual menyediakan pengalihan data lengkap ke perangkat nyata; </li><li>  sebagai rintisan sederhana yang selalu mengembalikan "OK". </li></ul><br><p>  Dalam versi emulator saat ini, pendekatan kedua digunakan - modul Bluetooth virtual melakukan konfigurasi, setelah itu beralih ke mode proxy data dari port COM sistem utama ke port UART emulator. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/e6/5c/m_/e65cm_tl2bggpbg0-q0azjvdz64.jpeg"></div><br><p>  Pertimbangkan kemungkinan instrumentasi kode yang sederhana jika beberapa bagian periferal tidak diterapkan.  Misalnya, jika timer tidak dibuat yang mengontrol transfer data dalam DMA (verifikasi dilakukan di fungsi <em>ws2812b_wait yang</em> terletak di <code>0x08006840</code> ), maka firmware akan selalu menunggu bendera <em>sibuk yang</em> terletak di <code>0x200004C4</code> untuk mengatur ulang garis data DMA: </p><br><img src="https://habrastorage.org/webt/pt/jj/su/ptjjsutfya2dkoqdoshkeyeeqzw.png"><br><p>  Kami dapat menghindari situasi ini dengan menyetel ulang bendera <em>sibuk</em> secara manual segera setelah menyetelnya.  Di IDA Pro, Anda dapat membuat fungsi Python dan memanggilnya di breakpoint, dan breakpoint harus diatur dalam kode setelah menuliskan nilai 1 ke flag yang <em>sibuk</em> . </p><br><h4 id="breakpoint-obrabotchik">  Penangan breakpoint </h4><br><p>  Pertama, buat fungsi Python di IDA.  Menu <em>file - Perintah skrip ...</em> </p><br><p>  Tambahkan potongan baru di daftar di sebelah kiri, berikan nama (misalnya, <em>BPT</em> ), <br>  di kotak teks di sebelah kanan kita masukkan kode fungsi: </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">skip_dma</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">"Skipping wait ws2812..."</span></span> value = Byte(<span class="hljs-number"><span class="hljs-number">0x200004C4</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> value == <span class="hljs-number"><span class="hljs-number">1</span></span>: PatchDbgByte(<span class="hljs-number"><span class="hljs-number">0x200004C4</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">False</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/zi/za/-d/ziza-ddx3arqlqfbd-o6jvdmnjc.png"></div><br><p>  Setelah itu, klik <em>Jalankan</em> dan tutup jendela skrip. </p><br><p>  Sekarang mari kita pergi ke kode di <code>0x0800688A</code> , atur breakpoint (tombol F2), edit ( <em>Edit breakpoint ...</em> menu konteks), jangan lupa atur jenis skrip - Python: </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/fo/pn/1v/fopn1vb8fbxqrhn6xoia_rgnsau.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/h6/yq/b2/h6yqb29r1m9sngr3csfimxcxsew.png"></div><br><p>  Jika nilai saat ini dari bendera <em>sibuk</em> adalah 1, maka fungsi <em>skip_dma</em> harus <em>dieksekusi</em> di baris skrip: </p><br><img src="https://habrastorage.org/webt/m-/t8/in/m-t8in2th7ei6neigdzgzq17kxy.png"><br><p>  Jika Anda menjalankan firmware untuk dieksekusi, maka kode breakpoint-handler dapat dilihat di IDA di jendela <em>Output</em> pada baris <code>Skipping wait ws2812...</code>  Sekarang firmware tidak akan menunggu untuk mengatur ulang flag yang <em>sibuk</em> . </p><br><h4 id="vzaimodeystvie-s-emulyatorom">  Interaksi emulator </h4><br><p>  Persaingan demi persaingan tidak mungkin menyebabkan kegembiraan dan kegembiraan.  Akan jauh lebih menarik jika emulator membantu peneliti untuk melihat data dalam memori atau untuk membangun interaksi arus. </p><br><p>  Kami menunjukkan cara membangun interaksi tugas RTOS secara dinamis.  Pertama, jeda eksekusi kode jika sedang berjalan.  Jika Anda beralih ke fungsi <em>bluetooth_task_entry</em> di cabang pemrosesan perintah "LED" (alamat <code>0x080057B8</code> ), Anda dapat melihat apa yang pertama kali dibuat, dan kemudian pesan dikirim ke antrian sistem <em>ledControlQueueHandle</em> . </p><br><p><img src="https://habrastorage.org/webt/po/bk/zm/pobkzmapmust02eaafle7d_pxba.png" alt="gambar"></p><br><p>  Anda harus mengatur breakpoint untuk mengakses variabel <em>ledControlQueueHandle yang</em> terletak di <code>0x20000624</code> dan terus menjalankan kode: </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ev/wo/g3/evwog3vrv7ozxlxjozd4itvve0a.png"></div><br><p>  Akibatnya, pada awalnya ia akan berhenti di alamat <code>0x080057CA</code> sebelum memanggil fungsi <em>osMailAlloc</em> , kemudian pada <code>0x08005806</code> sebelum memanggil fungsi <em>osMailPut</em> , kemudian setelah beberapa saat di alamat <code>0x08005BD4</code> (sebelum memanggil fungsi <em>osMailGet</em> ), yang termasuk dalam fungsi <em>leds_task_entry</em> (tugas LED), i.e. ada saklar tugas, dan sekarang kontrol telah menerima tugas LED. </p><br><p><img src="https://habrastorage.org/webt/th/ni/zh/thnizhzqykfn20l9-btkuqhawlc.png" alt="gambar"></p><br><p>  Sedemikian sederhana, Anda dapat menetapkan bagaimana tugas RTOS berinteraksi satu sama lain. </p><br><p>  Tentu saja, dalam kenyataannya, interaksi tugas bisa lebih rumit, tetapi menggunakan emulator untuk melacak interaksi ini menjadi lebih sulit. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Di sini</a> Anda dapat menonton video pendek peluncuran emulator dan interaksi dengan IDA Pro. </p><br><h2 id="zapusk-s-radare2">  Luncurkan dengan Radare2 </h2><br><p>  Anda tidak dapat mengabaikan alat universal seperti Radare2. </p><br><p>  Untuk terhubung ke emulator menggunakan r2, perintahnya akan terlihat seperti ini: </p><br><pre> <code class="plaintext hljs">radare2 -A -a arm -b 16 -d gdb://localhost:23946 rhino_fw42k6.elf</code> </pre> <br><p>  Sekarang mulai ( <code>dc</code> ) dan eksekusi jeda (Ctrl + C) tersedia. </p><br><p>  Sayangnya, saat ini di r2 ada masalah ketika bekerja dengan server gdb hardware dan markup memori, karena ini, breakpoints dan Langkah (perintah <code>ds</code> ) tidak berfungsi.  Kami berharap ini akan diperbaiki dalam waktu dekat. </p><br><h2 id="zapusk-s-eclipse">  Luncurkan dengan Eclipse </h2><br><p>  Salah satu opsi untuk menggunakan emulator adalah debugging firmware perangkat yang sedang dikembangkan.  Untuk kejelasan, kami juga akan menggunakan firmware Badak.  Anda dapat mengunduh sumber firmware <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">dari sini</a> . </p><br><p>  Kami akan menggunakan Eclipse dari <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">System Workbench untuk STM32</a> suite sebagai IDE. </p><br><p>  Agar firmware yang langsung dikompilasi dalam Eclipse untuk dimuat ke emulator, Anda perlu menambahkan parameter <code>firmware=null</code> ke perintah mulai emulator: </p><br><pre> <code class="plaintext hljs">bin\kopycat -g 23946 -n rhino -l user -y library -p firmware=null,tty_dbg=COM26,tty_bt=COM28</code> </pre> <br><h3 id="nastroyka-debug-konfiguracii">  Konfigurasi debug </h3><br><p>  Di Eclipse, pilih menu <em>Run - Debug Configurations ....</em> Di jendela yang terbuka, di bagian <em>Debugging Hardware GDB</em> , Anda perlu menambahkan konfigurasi baru, dan kemudian tentukan proyek dan aplikasi saat ini untuk debugging pada tab "Main": </p><br><img src="https://habrastorage.org/webt/f-/yk/eo/f-ykeob2i5vg25qbrz_egbqntou.png"><br><p>  Pada tab Debugger, Anda harus menentukan perintah GDB: <br> <code>${openstm32_compiler_path}\arm-none-eabi-gdb</code> </p> <br><p>  Dan juga memasukkan parameter untuk menghubungkan ke server GDB (host dan port): </p><br><img src="https://habrastorage.org/webt/ef/ud/fo/efudfommb7a9gkr4kcvp0vtnqfm.png"><br><p>  Parameter berikut harus ditentukan pada tab "Startup": </p><br><ul><li>  aktifkan kotak centang <em>Muat gambar</em> (sehingga gambar firmware yang dikumpulkan dimuat ke emulator); </li><li>  aktifkan tanda centang <em>Muat simbol</em> ; </li><li>  tambahkan perintah mulai: <code>set $pc = *0x08000004</code> (set nilai dari memori ke alamat <code>0x08000004</code> dalam register PC - alamat <code>0x08000004</code> disimpan di sana). </li></ul><br><p>  <strong>Harap dicatat</strong> bahwa jika Anda tidak ingin mengunduh file firmware dari Eclipse, Anda tidak perlu menentukan parameter <em>Load image</em> and <em>Run commands</em> . </p><br><img src="https://habrastorage.org/webt/w3/q8/2f/w3q82fvei4c91385rlcipmuiy_i.png"><br><p>  Setelah mengklik Debug, Anda dapat bekerja dalam mode debug: </p><br><ul><li>  eksekusi kode langkah-demi-langkah <br><img src="https://habrastorage.org/webt/1h/6n/ax/1h6nax1gpgcdyrwakdmzzlu6_x8.png"></li><li>  interaksi dengan breakpoints <br><img src="https://habrastorage.org/webt/4d/n1/5e/4dn15e4hzaukbif58ggwhy_wg18.png"></li></ul><br><p>  <strong><em>Catatan</em></strong>  <em>Eclipse memiliki, hmm ... beberapa fitur ... dan Anda harus hidup dengannya.</em>  <em>Misalnya, jika pesan "Tidak ada sumber yang tersedia untuk" 0x0 "" muncul ketika memulai debugger, kemudian jalankan perintah Langkah (F5)</em> </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ra/uz/ko/rauzko55hgnj1y_uapnqbz8ftrw.png"></div><br><h2 id="vmesto-zaklyucheniya">  Alih-alih sebuah kesimpulan </h2><br><p>  Emulasi kode asli adalah hal yang sangat menarik.  Untuk pengembang perangkat, menjadi mungkin untuk men-debug firmware tanpa perangkat nyata.  Untuk peneliti - kemampuan untuk melakukan analisis kode dinamis, yang tidak selalu mungkin bahkan dengan perangkat. </p><br><p>  Kami ingin memberikan alat yang akan mudah bagi para spesialis, cukup sederhana dan tidak membutuhkan banyak upaya dan waktu untuk mengonfigurasi dan meluncurkan. </p><br><p>  Tulis di komentar tentang pengalaman Anda menggunakan emulator perangkat keras.  Kami mengundang Anda untuk berdiskusi dan dengan senang hati akan menjawab pertanyaan. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id445798/">https://habr.com/ru/post/id445798/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id445786/index.html">Kriptografi di Jawa. Kelas KeyStore</a></li>
<li><a href="../id445788/index.html">Surveilans video cloud mandiri: fitur-fitur baru dari Ivideon Web SDK</a></li>
<li><a href="../id445792/index.html">Bagaimana kami mengembangkan dokumentasi dalam proyek Embox yang terbuka</a></li>
<li><a href="../id445794/index.html">Raksasa IT mengungkap solusi penyebaran cloud hybrid hybrid</a></li>
<li><a href="../id445796/index.html">Fintech Digest: Dorsey membayar dengan bitcoin, strategi blockchain Australia, Levi's IPO, walikota Chicago dan bitcoin yang tak terhindarkan</a></li>
<li><a href="../id445800/index.html">Monads dalam 15 menit</a></li>
<li><a href="../id445802/index.html">5 Hal Tren Internet yang Harus Diketahui Setiap Orang</a></li>
<li><a href="../id445804/index.html">Enkapsulasi untuk samurai asli, atau nuansa yang terkait dengan kata kunci internal di C #</a></li>
<li><a href="../id445806/index.html">Bagaimana kecerdasan buatan mengubah ilmu pengetahuan</a></li>
<li><a href="../id445808/index.html">Kami membenci dan memburu: kehidupan berbahaya seorang cracker virus yang membuat musuh yang kuat</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>