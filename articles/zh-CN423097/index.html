<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏾 💚 👎🏿 PostgreSQL战斗机的任务和解决方案 👨🏼‍⚕️ ▫️ ✍🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="向所有SQL爱好者致以问候！ 

 在Internet上，我很少见到涉及与SQL数据处理相关的不同工作点和细节的文章。 
 当您一次可以从一篇文章中学到很多东西时，即使是一般而言，我也喜欢。 
 因此，我决定写我的文章，其中包含各种任务和答案以及对它们的解释。 
 适合那些已经熟练掌握所有基本技能并...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>PostgreSQL战斗机的任务和解决方案</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/423097/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/x3/ee/eo/x3eeeo65jv-nyf7mh9ks2dordqg.jpeg"></div><br> 向所有SQL爱好者致以问候！ <br><br> 在Internet上，我很少见到涉及与<b>SQL数据处理</b>相关的不同工作点和细节的文章。 <br> 当您一次可以从一篇文章中学到很多东西时，即使是一般而言，我也喜欢。 <br> 因此，我决定写我的文章，其中包含各种任务和答案以及对它们的解释。 <br> 适合那些已经熟练掌握所有基本技能并想要进一步发展的人。 <br><br> 提供的答案适用于<b>PostgreSQL</b> （ <u>大多数任务都适用于其他DBMS</u> ，但是结果和解决方案可能有所不同。出现差异之处甚至很有趣） <br><br>  <i>打开扰流板之前， <u>请尝试回答自己</u> 。</i> <i><br></i> <br> 走吧 <br><a name="habracut"></a><br><br> 我将尝试用星号标记纯粹用于PostgreSQL的内容（这种情况并不多） <br><br><h4>  1.关于数值运算的一些知识 </h4><br>  <b>1.1</b>这些要求会得到满足吗？ 他们将返回什么结果？ <br><br><pre><code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">-- )     SELECT 3/2; -- ) SELECT min('- '::TEXT), avg('- '::TEXT); -- )*      FALSE,     ? SELECT 7.2 = (3.8::FLOAT + 3.4) -- ) SELECT (20/25)*25.0;</span></span></code> </pre> <br><br><div class="spoiler">  <b class="spoiler_title">1.1的答案</b> <div class="spoiler_text">  A）答案： <b>1</b> <br> 仅显示整个部分，因为 该操作使用整数。 通常在其他语言中找到。 <br><br>  B）回答：请求<b>将不会执行</b> 。 <br><br>  <b>avg</b>将给出一个错误，因为 仅接受数字和时间间隔* <br><br> 但是，可以对文本数据执行<b>min / max</b>函数（根据数据库中的字母排序）。 <br> 有时当您需要至少查看<i>GROUP BY中</i>未列出的列时，这可能会很有用 <br> 或者当您需要对数字应用字母排序时，其中'10'&lt;'2' <br><br>  B）答案： <b>假</b> <br><br> 可能看起来很奇怪，但这是<u>可以接受的</u> ，因为 这是代表某些浮点数的计算机的功能；数字可以采用7.1（9）的形式 <br> 我记得曾经很长时间不知如何处理请求。 <br><br>  D）回答： <b>0</b> 。 问题是括号中的表达式将= 0 <br><br>  SELECT（20 / 25.0）* 25会更正确地工作 </div></div><br><br>  <b>1.2</b>给定表“ <i>table_2</i> ”（单列“ <i>value</i> ”（INTEGER））由以下5行组成： <br><table border="1" cellpadding="1"><tbody><tr><th width="120"> 价值 </th></tr><tr><td>  5 </td></tr><tr><td>  5 </td></tr><tr><td> 空值 </td></tr><tr><td>  5 </td></tr><tr><td>  5 </td></tr></tbody></table><br> 什么结果将返回查询： <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">avg</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>)*<span class="hljs-keyword"><span class="hljs-keyword">count</span></span>(*)) - <span class="hljs-keyword"><span class="hljs-keyword">sum</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> table_2;</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">答案选项</b> <div class="spoiler_text"><ul><li>  -4 </li><li>  0 </li><li> 空值 </li><li>  5 </li><li> 这将导致错误，因为 未指定GROUP BY </li><li> 没有列出 </li></ul><br></div></div><br><div class="spoiler">  <b class="spoiler_title">答案1.2</b> <div class="spoiler_text"> 答案： <b>5</b> <br><br> 应用于特定列的聚合函数将忽略<i>NULL</i> ，但是count <b>（*）将对</b>所有行进行计数 <br>  5 * 5-20 </div></div><br><br><h4>  2.一般问题 </h4><br>  <b>2.1</b>在什么情况下查询不能返回表的所有内容？  （ <i>parent_id</i> INTEGER，表中填充了各种数据） <br><br><pre> <code class="sql hljs"> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> any_table <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> parent_id = parent_id;</code> </pre><br> 以下请求的行为如何？ 它将输出什么数据？  <i>* PostgreSQL</i> <br><br><pre> <code class="sql hljs"> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> any_table <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> parent_id <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DISTINCT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> parent_id;</code> </pre><br><div class="spoiler">  <b class="spoiler_title">答案2.1</b> <div class="spoiler_text"> 第一个查询将显示所有条目，但<i>parent_id</i>为<b>NULL的</b>条目除外 <br><br> 第二个查询将显示所有表条目。  <u>IS DISTINCT FROM</u>在逻辑上类似于运算符<b>！=</b>其中NULL等于NULL <br>  <u>从</u>逻辑上看<u><b>并不一致</b></u> <br></div></div><br>  <b>2.2。</b> 请求的结果是什么？ <br><br><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">-- ) SELECT * FROM ( SELECT 1 UNION ALL SELECT 1 ) x(y) UNION ( SELECT 2 UNION ALL SELECT 2 );</span></span></code> </pre> <br><div class="spoiler">  <b class="spoiler_title">回复2.2</b> <div class="spoiler_text"> 结果将是2行，其值为<b>1</b>和<b>2</b> ， <i>UNION</i>将删除<u>结果</u>选择中的所有重复项，而不仅仅是两个联接表之间的重复项。 我注意到这对每个人都不是显而易见的。 </div></div><br>  <b>2.3</b>编写查询以显示明天的日期。 <br><br><div class="spoiler">  <b class="spoiler_title">回答2.3</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CAST</span></span>((<span class="hljs-keyword"><span class="hljs-keyword">now</span></span>()+ <span class="hljs-built_in"><span class="hljs-built_in">INTERVAL</span></span> <span class="hljs-string"><span class="hljs-string">'1 DAY'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-built_in"><span class="hljs-built_in">DATE</span></span>)</code> </pre> <br> 并非每个人都经常使用日期，但值得掌握一些最低要求 <br>  * Postgres解决方案，但我认为其他DBMS差别不大 <br><br> 如果您不喜欢使用日期，建议您尝试一下 <br> 例如： <br>  -将DAY替换为（周，月，年等） <br>  -用-9000代替+1 <br>  -将DATE替换为TIME <br>  -删除CAST <br>  -现在只留下（） <br> 等 <br><br> 并且，受一些结果的启发，请阅读<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">MANUAL</a> ，其中详细介绍了所有主题 <br><br></div></div><br>  <b>2.4</b> <b>UPDATE</b> ， <b>DELETE</b> ， <b>INSERT</b>和<b>MERGE</b> <b>语句</b>旨在处理表中的数据。  <b>SELECT ..</b>执行是否“安全”？ 任何查询都会影响表中的数据吗？ <br><div class="spoiler">  <b class="spoiler_title">回答2.4</b> <div class="spoiler_text"> 这个问题似乎很原始，但是... <br><br> 在学习SQL的一开始，我认为该语句只能显示数据，但是： <br><br>  SELECT能够锁定表以进行更改（BEGIN； SELECT ... FOR UPDATE）* <br>  SELECT能够调用几乎可以执行任何操作的函数。 <br><br> 初学者需要立即理解这一点，而不是在<s>生产</s>服务器上完成“少量信息性”请求之后 </div></div><br><br><h4>  3.仅PostgreSQL </h4><br>  <b>3.1</b>描述在SQL对话框中执行此查询时会发生什么： <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> wtf <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> pg_stat_activity;</code> </pre><br><div class="spoiler">  <b class="spoiler_title">回复3.1</b> <div class="spoiler_text"> 通常，在<i>plpgsql</i>函数中使用SELECT INTO将值写入变量。 <br><br> 在plpgsql之外，该命令的效果将类似于以下查询： <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> wtf <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> pg_stat_activity;</code> </pre> <br></div></div><br>  <b>3.2</b>此“简单”请求将显示什么 <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> wtf_ <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> pg_stat_activity <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> wtf_ ;</code> </pre><br><div class="spoiler">  <b class="spoiler_title">回复3.2</b> <div class="spoiler_text">  pg_stat_activity数据库中活动进程的系统视图（VIEW）。 <br><br> 该查询的特殊性是将显示具有类型pg_stat_activity的行（ROW）的一列（或另一表）。 您需要对编写函数的人早一点了解这一点，您可以在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">手册中</a>阅读更多内容<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">。</a> <br> 添加该问题的原因是，初学者很容易会错误地得到这样的结果，并且不了解问题所在 </div></div><br><h4>  4.处理文本。 正则表达式 </h4><br> 我认为您不仅需要能够构建查询，而且还必须以正确的方式呈现结果。 <br> 正则表达式是一个单独的庞大主题，包含许多优质文章。 因此，我将仅显示示例，而没有详细说明。 <br><br>  <b>4.1。</b> 假设存在一个带有文本列“ <i>X</i> ”和许多不同行的表“ <i>table_5</i> ”。 什么查询可以获取每行的最后10个字符？ <br><br><div class="spoiler">  <b class="spoiler_title">回复4.1</b> <div class="spoiler_text">  SQL使您可以针对同一问题提出很多解决方案，例如： <br> 想到的最简单的事情是<b>正确的（X，10）</b> <br> 可以使用正则表达式： <b>子字符串（X，'。{0,10} $'）</b> <br> 您甚至可以像这样<s>nakostylyat</s> “躲避”（在所有意义上）： <b>反向（子字符串（反向（X）为10））</b> </div></div><br><br>  <b>4.2</b>存在一个带有文本列“ X”的表“ table_6”。 该表包含一行（所有文本均为英文和俄文）： <br><pre> <code class="sql hljs">'Lorem 3 Ipsum 23 standard 7 dummy 17 text Ultimate Answer of Life ?? 777'</code> </pre> <br>  A）编写一个查询，该查询将从该字符串返回第42至68个字符 <br>  B）如何使用SQL仅提取字符串中的大写字母（俄语或英语）？ <br>  C）如何使用SQL计算字符串中的<u>数字</u>总和（ <u>不是数字</u> ） <br><br><div class="spoiler">  <b class="spoiler_title">SQL草图</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> table_6(X) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-string"><span class="hljs-string">'Lorem 3 Ipsum 23 standard 7 dummy 17 text Ultimate Answer of Life ?? 777'</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">TEXT</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> X <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> table_6</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">答案4.2</b> <div class="spoiler_text"><pre> <code class="sql hljs"> <span class="hljs-comment"><span class="hljs-comment">--    WITH  "SQL " -- ) SELECT SUBSTRING(LEFT(X,68) FROM 42 ) FROM table_6 -- 1  SELECT SUBSTRING(X, 42, (68-42)+1) FROM table_6 -- 2  -- 3    -- )  ,        SELECT regexp_replace(X,'[^A-Z-]', '','g') FROM table_6 --  ''      - --   'g'    1  -- )        --   regexp_matches   **     ,      SELECT sum(x[1]::INT) FROM ( SELECT regexp_matches(X,'[0-9]+','g') FROM table_6 ) AS y(x) -- *        -- **   +,     (   1 ,     )</span></span></code> </pre> </div></div><br><br>  <b>4.3。</b>如何用文本（表格单元格）中的单个空格替换所有双（三倍或更多）空格？  （按照传统：表“ <i>table_7</i> ”和“ <i>X</i> ”列）（PS足以写返回所需结果的<i>SELECT</i> ，而不是<i>UPDATE table_7 ...</i> ） <br><br><div class="spoiler">  <b class="spoiler_title">回复4.3</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> table_7(X) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-string"><span class="hljs-string">'Lorem 3 Ipsum 23 standard 7 dummy 11 text'</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">TEXT</span></span>) <span class="hljs-comment"><span class="hljs-comment">-- 1 .    (2   ) SELECT regexp_replace(X, '( ){2,}', ' ', 'g') FROM table_7 -- 2 .     (,  ,    ..)   ,      SELECT regexp_replace(X, '\s+', ' ', 'g') FROM table_7 --  !  ,  -    ,    "" .    .. --   ,    , ,        --    ,      ,    SELECT replace(replace(replace(X, ' ', '&lt;&gt;'), '&gt;&lt;', ''), '&lt;&gt;', ' ') FROM table_7</span></span></code> </pre><br></div></div><br>  <b>4.4</b>存在一个允许输入错误的字符串“ <i>X</i> ”。 代替俄语字母（e，o，s，C），使用了英文字母的向外相似字符。 将这些字符替换为SQL。 <br><br>  PS该行应仅包含俄语字符，并且您不必担心英语单词可能会发生变化。 <br><br>  （如果您难以替换所有字符，则至少替换一个） <br><br> 示例行： <br><br> <code>X = 'Coeo  eoc oe'</code> <br> <br><div class="spoiler">  <b class="spoiler_title">回复4.4</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">-- , Replace(Replace(Replace(..  ,  --        (1   1 ) SELECT TRANSLATE('Coeo  eoc oe', 'Cceo', '')</span></span></code> </pre> </div></div><br>  <b>4.5</b>编写一个转换字符串的查询： <br>  <b>'</b> <b>伊万·伊万诺夫和伊万诺维奇'</b>到物种<b>'伊万·伊万诺夫</b> <br><br><div class="spoiler">  <b class="spoiler_title">回复4.5</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">--  ,     SELECT initcap('  ') *     </span></span></code> </pre></div></div><br><div class="spoiler">  <b class="spoiler_title">对那些应付的人的奖励</b> <div class="spoiler_text">  <s>如果有现成的功能，那就太好了</s> <br> 您能换一种方式吗？  （最好不要丢失填充）。 <br> 也许任务不是典型的，但对开发很有用。 <br><br>  <b>'IVANOV IVAN IVANOVICH'</b>转换为<b>'IVANOV IVAN IVANOVICH'</b> <br>  <s>并反转大小写？</s> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">奖励挑战响应</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> string_agg(<span class="hljs-keyword"><span class="hljs-keyword">LOWER</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span>(x,<span class="hljs-number"><span class="hljs-number">1</span></span>)) || <span class="hljs-keyword"><span class="hljs-keyword">UPPER</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">SUBSTRING</span></span>(x <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>)), <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> rn) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> regexp_split_to_table(<span class="hljs-string"><span class="hljs-string">'    4 TesT'</span></span>, <span class="hljs-string"><span class="hljs-string">'\y'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ORDINALITY</span></span> y(x, rn) ) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> z <span class="hljs-comment"><span class="hljs-comment">-- *  PostgreSQL,      --    ,     --      ,      --      . -- WITH ORDINALITY      (   9.4) --      --          -- ..</span></span></code> </pre> </div></div><br><h4>  5.关于交易的一点 </h4><br> 在DBMS中，交易是非常重要的事情；了解要点很重要。 <br><br> 我将尝试模拟一个示例： <br><br> 假设有一个“商品”表，两个用户将使用该表进行工作。 <br> 对于所有行，它都有一个等于<u>10</u>的整数<i>折扣</i>列。 <br> 数据库设置是标准的（READ COMMITTED-读取提交的数据）。 <br><br> 用户<i>User_1</i>打开一个事务，执行以下请求： <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> goods <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> discount = discount + <span class="hljs-number"><span class="hljs-number">5</span></span>;</code> </pre><br> 一秒钟后，另一个用户（ <i>User_2</i> ） <br> 它执行几乎相同的请求而无需打开事务： <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> goods <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> discount = discount + <span class="hljs-number"><span class="hljs-number">10</span></span>;</code> </pre><br> 您认为在以下情况下会发生什么： <br><br>  <b>A）</b>如果User_1保留交易未打开（即不确认交易/不回滚更改），User_2将得到什么结果？ <br>  User_1会应要求看到的内容： <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> discount <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> goods <span class="hljs-keyword"><span class="hljs-keyword">LIMIT</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>;</code> </pre> <br>  <b>B）</b>如果User_1做ROLLBACK会怎样？  User_2将得到什么结果？ <br><br>  <b>问）</b>如果User_1进行COMMIT会怎样？  User_2将得到什么结果？ <br><br><div class="spoiler">  <b class="spoiler_title">答案</b> <div class="spoiler_text"> 据我所知，PostgreSQL不支持READ <b>UN</b> COMMITTED，并且脏数据（未确认）无法读取 <br><br> 答案如下： <br><br>  A）请求<u>User_2</u>将等待<u>User_1</u>的COMMIT或ROLLBACK。  （该请求似乎冻结了） <br> 交易中的<u>User_1</u>将看到他的数据库快照版本，其中<i>折扣</i>已经等于<b>15</b> <br><br>  B）如果User_1进行ROLLBACK，则<i>折扣</i>值将保持不变，然后执行User_2，这将为<i>折扣</i>加10，折扣为<b>20</b> <br><br>  C）如果User_1执行COMMIT，则<i>折扣</i>值将增加5，然后执行User_2，这将为<i>折扣</i>加10，折扣为<b>25</b> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">此任务的另一个版本</b> <div class="spoiler_text"> 任务13与用户<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link">kirill_petrov</a>在READ COMMITTED上的版本稍有不同 <br><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">--      CREATE TABLE goods (discount) AS (SELECT 10::INT UNION ALL SELECT 15); -- 1. User_1   (  ): BEGIN; UPDATE goods SET discount = discount + 5; --2. User_2  : UPDATE goods SET discount = discount + 100 WHERE discount = 15 --3. User_1  COMMIT;</span></span></code> </pre> 表格中将包含哪些数据？ <br></div></div><br><h4> 结论 </h4><br> 我认为这涉及到非常有趣的观点。 <br><br> 我希望这些任务将有助于激发初学者，因为学习没有特定目标/目的/方向的东西很无聊。 <br><br> 我为那些容易回答所有问题的人感到高兴。 我希望那些遇到困难的人能够朝着发展方向发展。 那些不太了解但想学习SQL的人，我在上一篇文章中邀请<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">PostgreSQL少年战士课程</a> 。 <br><br> 我期待对特别有趣的问题（您可以挖掘）的任何补充，解决方案以及其他意见！ <br><br> 感谢您的关注！ 祝您学习SQL成功！ </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN423097/">https://habr.com/ru/post/zh-CN423097/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN423087/index.html">不要推我的眼睛</a></li>
<li><a href="../zh-CN423089/index.html">MBLT DEV 2018的程序员</a></li>
<li><a href="../zh-CN423091/index.html">适用于Android开发人员的Flutter。 如何使用Flutter为活动创建UI</a></li>
<li><a href="../zh-CN423093/index.html">我们增加了[可能] [几乎]是偶然的事实的随机性</a></li>
<li><a href="../zh-CN423095/index.html">Apple Presentation上的新功能</a></li>
<li><a href="../zh-CN423101/index.html">为Proxmox部署LINSTOR存储</a></li>
<li><a href="../zh-CN423103/index.html">Python播客：仅此而已</a></li>
<li><a href="../zh-CN423105/index.html">System.IO.Pipelines：.NET中的高性能IO</a></li>
<li><a href="../zh-CN423107/index.html">我们邀请您参加生产中的会议</a></li>
<li><a href="../zh-CN423109/index.html">苹果介绍了什么以及iOS开发人员对此有何看法</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>