<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ¤±ğŸ» ğŸ§“ğŸ½ âš°ï¸ Integrasi berkelanjutan di Unity: cara mengurangi waktu perakitan dan menghemat sumber daya + payline sebagai hadiah ğŸ¤¾ğŸ½ ğŸ¤¸ ğŸ”</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Halo semuanya, saya berhubungan dengan Alexander Panov, pakar teknis dari Pixonic. Di perusahaan saya bertanggung jawab untuk solusi antar-proyek dan ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Integrasi berkelanjutan di Unity: cara mengurangi waktu perakitan dan menghemat sumber daya + payline sebagai hadiah</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pixonic/blog/484172/"><img src="https://habrastorage.org/webt/gu/jv/tz/gujvtzrponhszxkg1z_lmobwdt8.png"><br><br>  Halo semuanya, saya berhubungan dengan Alexander Panov, pakar teknis dari Pixonic.  Di perusahaan saya bertanggung jawab untuk solusi antar-proyek dan periferal dekat-proyek dan hari ini saya ingin berbagi pengalaman dan praktik terbaik saya. <br><br>  Platform pengembangan dan integrasi berkelanjutan, atau CI / CD, sekarang digunakan di mana-mana di industri-industri tersebut di mana proses teknis yang berulang dan berfungsi dengan baik memainkan peran yang menentukan.  Dalam artikel ini, kita akan berbicara tentang CI / CD untuk mengimplementasikan proyek Unity kami untuk pengembangan game mobile: masalah apa yang kami temui, bagaimana kami berhasil menyelesaikannya, perbaikan apa yang kami capai dan bagaimana perakitan pipa yang kami buat terdaftar. <br><br>  Segera setuju bahwa kami menggunakan TeamCity dari <a href="https://habr.com/ru/company/JetBrains/">JetBrains</a> sebagai server CI, GitHub sebagai repositori repositori Git, dan Nexus untuk menyimpan artefak perakitan. <br><a name="habracut"></a><br>  Jadi, kami menghadapi masalah berikut: <br><br><ul><li>  <i>Kurangnya standar pembuatan perakitan umum:</i> praktis semua pengembang memiliki akses ke server TeamCity, sebagai akibatnya skrip perakitan ditulis dalam bahasa pemrograman yang berbeda (BASH, PowerShell, Python), dan logikanya sering diduplikasi; </li><li>  <i>Armada yang lemah:</i> karena kami harus membangun build untuk iOS, kami harus menggunakan armada mobil dari Mac mini.  Dan karena di Unity hampir seluruh rakitan berlangsung dalam satu utas, memparalelkan rakitan pada satu mesin terbukti bermasalah; </li><li>  <i>Sedikit efisiensi operasional yang tidak jelas:</i> karena produktivitas yang rendah dari dukungan teknis kami, perakitan membutuhkan waktu yang sangat lama; </li><li>  <i>Antrian besar menunggu perakitan</i> dengan jumlah agen TeamCity yang memadai; </li><li>  <i>Kumpulan agen terpisah untuk setiap proyek:</i> karena lingkungan instalasi yang berbeda pada perangkat, serta file konfigurasi yang saling bertentangan antara proyek (file konfigurasi server cache, dll.), Tidak mungkin untuk mengorganisasikan kumpulan bersama. </li></ul><br><h2>  Apa yang Anda lakukan sebagai akibatnya? </h2><br><ul><li>  <b>Repositori untuk skrip perakitan</b> </li></ul><br>  Pertama-tama, kami membuat repositori tunggal skrip untuk majelis dengan Python.  Peluncuran ini dilakukan di lingkungan manajemen lingkungan virtual Pipenv dengan mem-proxy-kan perpustakaan pihak ketiga di server-nya untuk memperbarui secara cepat dan mengontrol versi dari perpustakaan yang diperlukan.  Dengan demikian, kami menyediakan satu titik masuk untuk majelis semua proyek yang ada.  Kami menulis ulang semua skrip dengan Python, menyatukan konfigurasi, menyebabkan standar umum, menghapus duplikat kode. <br><br><ul><li>  <b>Armada mobil baru</b> </li></ul><br>  Itu perlu untuk mengurangi waktu perakitan, mungkin mengurangi jumlah perangkat yang digunakan. <br><br>  Awalnya, kami memiliki sebuah peternakan komputer mini 13 Mac, tetapi solusi ini masih jauh dari optimal: karena kekhasan rakitan di Unity, sekitar 80% waktu perakitan akan dilakukan hanya dalam satu utas.  Tambahkan ke ini sejumlah besar akses tulis ke hard drive dan kami mendapatkan bahwa satu mini Mac hampir tidak dapat mengatasi 1-2 rakitan simultan. <br><br>  Hasilnya adalah kebutuhan untuk meninjau perangkat keras. <br><br>  Saat mencari dan membandingkan alternatif untuk rakitan Unity, kami memperhatikan bahwa komputer berbasis AMD Ryzen, karena kinerjanya, memungkinkan perakitan hingga 8-12 rakitan pada saat yang sama tanpa kehilangan kinerja yang signifikan, sehubungan dengan itu diputuskan untuk membeli empat perangkat tersebut dengan enam SSD dan menginstal dua agen per hard drive. <br><br>  Perbandingan bagaimana itu dan apa yang diberikan diberikan dalam tabel. <br><br><img src="https://habrastorage.org/webt/zt/u2/sf/ztu2sfkhfk_xhz3v2tke-upw8eu.png"><br><br>  Waktu pembuatan rata-rata: <br><br><img src="https://habrastorage.org/webt/x5/x0/5t/x5x05txnepni2gtkygvorspm_le.png"><br><br>  Selain itu, kami mengatur prioritas pemilihan agen TeamCity untuk mengurangi waktu yang dihabiskan majelis dalam antrian.  Sebelumnya, masing-masing proyek kami memiliki kumpulan agen sendiri, dan karena sifat multi platform dari permainan, lingkungan yang bergantung pada proyek tidak memungkinkan membuat kumpulan bersama.  Sekarang, setelah reorganisasi sistem, kami meninggalkan sejumlah agen yang ditugaskan untuk proyek, yang digunakan untuk rakitan otomatis, tetapi dapat menambahkan beberapa agen umum untuk semua proyek: mereka dimasukkan dalam pekerjaan ketika semua agen yang terkait dengan proyek yang diinginkan sedang sibuk. <br><br><ul><li>  <b>Perpustakaan BuildPipeline untuk Persatuan</b> </li></ul><br>  Mereka memulai perpustakaan kecil untuk Unity, yang memungkinkan untuk mengatur build build di jendela editor Unity yang terpisah, dan juga memiliki kemampuan untuk menjalankan build build dalam mode batchmode.  Dari fungsi utama perpustakaan: ini memungkinkan Anda untuk menambah dan menghapus definisi sebelum perakitan, menonaktifkan perpustakaan pihak ketiga atau file tertentu, menambahkan langkah pra-dan pasca-pemrosesan kustom, semua pengaturannya disimpan dalam file konfigurasi, ada juga kemungkinan warisannya. <br><br><img src="https://habrastorage.org/webt/87/qc/kv/87qckvdpssyfxuexcy7dirr9zw0.png"><br>  <i>Jendela mendefinisikan di pustaka BuildPipeline</i> <br><br><h2>  CI / CD pipa kami saat ini </h2><br>  <b>Perakitan PullRequest.</b>  Untuk setiap komitmen: <br><br><ol><li>  meluncurkan Unity untuk memeriksa kesalahan kompilasi, menentukan pembaruan dan menghasilkan solusi; </li><li>  menjalankan tes; </li><li>  peluncuran penganalisis statis: dengan bantuannya, analisis tambahan dilakukan pada file yang dipengaruhi oleh PullRequest saat ini; </li><li>  Pesan tentang hasil verifikasi, yang disimpan di GitHub. </li></ol><br>  <b>Langkah-langkah membangun proyek persatuan:</b> <br><br>  1. Menginstal Pipenv dan menjalankan skrip untuk membangun di Python: memperbarui dan menginstal pustaka Python pihak ketiga dari server kami ( <a href="https://pypi.org/">proksi</a> repositori <a href="https://pypi.org/">pypi.org</a> ) dan kemudian menjalankan skrip build. <br><br>  2. Persiapan awal untuk perakitan Persatuan: <br><br><ul><li>  menghapus folder Library, Bundel, aset selektif (berdasarkan mask dan / atau file tertentu), menghapus solusi (file .sln) - jika perlu; </li><li>  Membuat file informasi rakitan: nama cabang, nomor rakitan, dll.  - untuk penggunaan lebih lanjut dalam pembuatan untuk debugging dan pengujian; </li><li>  menyiapkan server cache Persatuan untuk suatu proyek.  Setiap proyek memiliki sendiri.  Setiap pengembang juga memiliki server cache yang diatur untuk pengisian lebih cepat: ketika seorang pengembang menambahkan aset baru, itu akan secara otomatis muncul di server cache dan pada server build - sehingga mengimpor aset jauh lebih cepat. </li></ul><br>  3. Menjalankan Unity untuk memeriksa kesalahan kompilasi, memperbarui mendefinisikan, dan menghasilkan solusi. <br><br>  4. Jalankan tes dan keluarlah jika ada kesalahan - jika perlu. <br><br>  5. Peluncuran Unity BuildPipeline dengan konfigurasi yang diperlukan dan parameter proyek tambahan. <br><br>  6. Untuk Android / iOS build - meluncurkan Gradle / Xcode: <br><br><ul><li>  Gradle - GradleWrapper; </li><li>  Xcode - arsipkan XcodeProject yang diperoleh setelah Unity dan salin ke Mac mini.  Secara terpisah instal dan perbarui semua sertifikat yang diperlukan dan file Profil Penyedia.  Jalankan perintah Bersihkan, Arsipkan, Ekspor. </li><li>  Pada tahap ekspor, dimungkinkan untuk memisahkan tanda tangan dari build, developer dan AppStore.  Tergantung pada apa yang kami kumpulkan, pilih plist yang diinginkan, atau masing-masing pada gilirannya.  Pada output, kami mendapatkan dua file: Pengembang dan Rilis - untuk instalasi pada perangkat uji dan masing-masing untuk mengunggah ke AppStore. </li></ul><br>  7. Menuangkan build yang dikumpulkan dan file terkait (log, hasil tes, .obb, manifes untuk menginstal aplikasi iOS, file dsym, dll.) Ke penyimpanan artefak, untuk rakitan mandiri - mengunggah build yang dikumpulkan ke penyimpanan arsip. <br><br>  8. Membuat halaman dengan kode QR untuk menginstal build, menambahkan tautan dari repositori dan membangun informasi ke database untuk pekerjaan lebih lanjut dengan aplikasi PixLauncher - kita akan membicarakannya nanti. <br><br>  9. Pesan ke Slack tentang hasil perakitan: kepada orang yang meluncurkan perakitan, serta ke saluran yang diperlukan. <br><br><img src="https://habrastorage.org/webt/dd/uu/ap/dduuapzv8vkhqbirksspxw8eqra.png"><br>  <i>Pesan seperti itu datang ke Slack</i> <br><br><h2>  Langkah selanjutnya </h2><br>  Sebagai langkah terakhir dari rencana, bangunan yang dikumpulkan didistribusikan ke perangkat untuk pengujian dan pengunggahan lebih lanjut ke toko. <br><br>  Untuk menginstal build pada perangkat, kami menulis aplikasi kecil untuk Android dan iOS - PixLauncher.  Kami menginstalnya di setiap perangkat di mana ada kemungkinan untuk memilih build dari TeamCity.  Untuk kenyamanan, Anda dapat mengatur filter di dalamnya - misalnya, menambahkan konfigurasi ke favorit Anda dan kemudian melakukan tindakan dengan itu dalam satu klik.  Dalam kasus build untuk Android, jika perlu, file dalam resolusi .obb diunduh secara otomatis. <br><br>  Selain itu, kami mengatur kemungkinan pemasangan build melalui pemberitahuan push: kami menambahkan plug-in yang ditulis sendiri ke server TeamCity, yang memungkinkan kami untuk memilih alamat MAC perangkat yang terhubung ke jaringan lokal di halaman build.  Kemudian pemberitahuan push dikirim ke perangkat ini dengan tautan ke instalasi - cara ini sekarang dilakukan dalam satu klik. <br><br>  Jadi, aplikasi diizinkan untuk mempercepat pencarian build QA yang diinginkan oleh departemen dan instalasi pada perangkat untuk verifikasi selanjutnya. <br><br><img src="https://habrastorage.org/webt/8t/nm/_b/8tnm_bbygilukr-n5krvxb1yq_c.png"><br>  <i>Penampilan Aplikasi iOS PixLauncher</i> <br><br><h2>  Akhirnya, mengunggah bangunan ke toko </h2><br>  Setelah semua tindakan dilakukan, kebutuhan untuk pengisian bangunan dan meta-informasi yang dijamin pada aplikasi kepada para pihak secara alami terbentuk. <br><br>  Awalnya, sebagian besar masalah muncul dengan AppStore: <br><br><ul><li>  mengisi gerbang dibuat hanya dari perangkat MacOS; </li><li>  Anda harus mengunggah video, tangkapan layar, dan deskripsi aplikasi dalam lebih dari 25 bahasa. </li></ul><br>  Ini menyebabkan hilangnya banyak waktu untuk mengisi dan macet dalam mengunduh file ke panel admin.  Karena itu, kami memikirkan proses otomatisasi. <br><br>  Sebagai hasilnya, kami memiliki yang berikut: <br><br><ol><li>  Di Google Disk, kami mendapatkan tablet dengan deskripsi aplikasi dalam semua bahasa; </li><li>  Video dan tangkapan layar aplikasi disusun dalam folder dengan penamaan tertentu; </li><li>  Di Teamcity, untuk memilih build yang sudah dirakit, mereka membuat konfigurasi tergantung pada build rilis; </li><li>  Melalui GooglePlay API dan iTMSTransporter untuk Apple, isi informasi build dan meta tentang aplikasi di store untuk semua bahasa yang diperlukan.  Jika terjadi masalah (misalnya, dengan jaringan) - kami melakukan beberapa upaya dan mengirim pesan ke Slack dengan teks kesalahan. </li></ol><br><img src="https://habrastorage.org/webt/lf/qu/un/lfquunvooflyh40dlkshhvmhg2m.png"><br>  <i>Seperti inilah tampilan unggahan bangunan ke AppStore</i> <br><br><h2>  Akibatnya - beberapa angka </h2><br><ul><li>  Sekarang kami memiliki sekitar 400 rakitan dan hingga 60 instalasi build di perangkat per hari; </li><li>  Ada 57 konfigurasi build berbeda di TeamCity; </li><li>  Kami menggunakan 22 agen TeamCity, sementara itu dimungkinkan untuk berkembang tanpa kehilangan kinerja yang signifikan menjadi 48 agen; </li><li>  Ada kemungkinan perluasan armada secara horizontal. </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id484172/">https://habr.com/ru/post/id484172/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id484160/index.html">Bakat Elusif: Rusia Kehilangan Profesional TI Terbaik</a></li>
<li><a href="../id484164/index.html">Sejarah buku dan masa depan perpustakaan</a></li>
<li><a href="../id484166/index.html">VVVVVV ??? VVVVVV !!! :)</a></li>
<li><a href="../id484168/index.html">Kami menulis strategi kami untuk pengguliran virtual dari Angular CDK</a></li>
<li><a href="../id484170/index.html">Perbarui Titik Periksa dari R77.30 hingga 80.20</a></li>
<li><a href="../id484174/index.html">Castle minum dalam kondisi "ekstrim" atau bagaimana kami mengambil bagian dalam acara "DOZOR"</a></li>
<li><a href="../id484176/index.html">Menerapkan Template Status dalam Persatuan</a></li>
<li><a href="../id484178/index.html">Saklar Ethernet Cerdas untuk Planet Bumi</a></li>
<li><a href="../id484180/index.html">Rostelecom virtual PBX: apa dan bagaimana bisa dilakukan melalui API</a></li>
<li><a href="../id484182/index.html">Xenobots: nanorobots hidup dari sel katak</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>