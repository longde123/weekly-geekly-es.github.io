<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>⏮️ 👉🏾 👩🏾‍✈️ Bicara tentang PostgreSQL. Wawancara dengan Alexei Lesovsky di podcast Zinc Prod. Bagian satu 👩🏼‍💻 👩‍🎤 🤰🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Baru-baru ini, kami mengundang Alexei Lesovsky dari Data Egret untuk menyiarkan Zinc Sale . Percakapan itu ternyata menarik dan informatif, jadi saya ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Bicara tentang PostgreSQL. Wawancara dengan Alexei Lesovsky di podcast Zinc Prod. Bagian satu</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/485322/"><blockquote>  Baru-baru ini, kami mengundang Alexei Lesovsky dari <a href="https://www.dataegret.ru/" rel="nofollow">Data Egret</a> untuk menyiarkan <a href="https://soundcloud.com/znprod" rel="nofollow">Zinc Sale</a> .  Percakapan itu ternyata menarik dan informatif, jadi saya menawarkan transkrip masalah ini kepada Anda.  Karena volume yang mengesankan, itu perlu untuk memecah teks menjadi beberapa bagian.  Jika Anda terlalu malas untuk menunggu kelanjutannya, Anda bisa mendengarkan versi audio di <a href="https://soundcloud.com/znprod/040-aleksey-lesovskiy-kak-vlyubit-v-sebya-postgres" rel="nofollow">sini</a> . </blockquote><p>  Halo semuanya, ini adalah masalah keempat puluh dari podcast Zinc Prod, dan Anton Okolelov, Nikita Vasilchenko dan Oleg Gritsak adalah tuan rumah permanen bersama kami di studio. </p><br><p>  <strong>Anton</strong> : Jadi, hari ini kita punya tamu, Alexey Lesovsky.  Lesha, tolong perkenalkan diri Anda, siapa Anda, apa yang Anda lakukan, dan sebagainya. </p><a name="habracut"></a><br><p> <strong>Alexei</strong> : Halo semuanya, namaku Alexei Lesovsky, karena Antokha sudah mengenalkanku.  Saya mengelola Postgres, Saya PostgreSQL DBA (administrator database), saya bekerja dengan login setiap hari, 7 hari seminggu, dan mengelola basis data klien.  Kami memiliki kantor - ini adalah perusahaan konsultan, yang bergerak di bidang administrasi, dukungan dan dukungan.  Dan orang-orang yang sangat berbeda datang kepada kami dengan database mereka, sebagai aturan ini adalah perusahaan - kecil, besar, kecil, semua jenis berbeda - mereka memiliki masalah dengan database, kami menganalisis masalah ini dan entah bagaimana mencoba memperbaikinya.  Sebenarnya, kami memecahkan masalah orang lain, perusahaan lain.  Sesuatu seperti itu. </p><br><p>  Ya, di waktu senggang saya suka melakukan hal-hal yang berbeda, berjalan melalui hutan, bermain seluncur salju, hiking, minum bir </p><br><p>  <strong>Anton</strong> : minum bir asap </p><br><p>  <strong>Nikita</strong> : sebelum rilis, Lyokha berbicara tentang merokok </p><br><p>  <strong>Alexei</strong> : ya, merokok, ada yang enak, saya sarankan.  Rauchbier Merzen. </p><br><p>  <strong>Anton</strong> : ok, tolong beri tahu saya, Anda dbshnik, Anda telah bekerja untuk waktu yang lama, beberapa tahun.  Seberapa sulit?  Mereka memanggil Anda pada malam hari dan meminta Anda untuk memperbaiki pangkalan.  Saya menelepon Anda jam lima pagi sekitar satu setengah tahun yang lalu. </p><br><p>  <strong>Alexei</strong> : ya, itu, itu masalah. </p><br><p>  <strong>Anton</strong> : bagaimana Anda bertahan hidup, katakan padaku </p><br><p>  <strong>Alexey</strong> : dengarkan, saya sudah bekerja sejak 2014.  Hingga 2014, saya bekerja sebagai administrator Linux dalam pengembangan web.  Admin memiliki banyak hal, kami memiliki virtualisasi kvm, ada banyak Linux, ada semua jenis Ruby-on-rails, nginxs, php, rails ... </p><br><p>  <strong>Oleg</strong> : Docker sudah? </p><br><p>  <strong>Alexey</strong> : buruh pelabuhan baru saja mulai, kami belum memperkenalkannya di mana pun dalam produksi, tetapi kecenderungan untuk ini sudah dimulai. </p><br><p>  Dan ada banyak postgres di kantor kami.  Kemudian saya mengejar rubel yang panjang dan memutuskan bahwa saya bisa mengerjakan dua pekerjaan pada saat yang sama.  Dan dia mulai bekerja sebagai administrator jarak jauh di kantor Moskow.  Saya menggabungkan dua karya, hanya ada database yang dikelola oleh konsultasi Postgresql.  Ada Max Boguk, Ilya Kosmodemyansky, dan sebagai administrator, saya mulai melakukan bagian dari tugas yang terkait dengan kedutaan.  Ya, yaitu  Aku mulai diam-diam mengambil roti mereka.  Dan pada suatu saat Max mengatakan ini padaku: dengarkan, dan biarkan kamu pergi bekerja bersama kami.  Anda akan meninggalkan semua pekerjaan Anda, pekerjaan paruh waktu, Anda akan datang kepada kami untuk waktu penuh. </p><br><p>  Yah, saya setuju, saya tidak ragu, pada prinsipnya saya ditawari gaji yang sebanding, dan saya mendapat pekerjaan dan mulai bekerja dari rumah, dan sekarang sejak 2014, ternyata, saya telah bekerja selama 5 tahun, saya bekerja secara khusus dengan tuan, ya, dalam mode lama semua jenis tema admin, saya bekerja dengan mereka karena kebiasaan.  Yaitu  jika di perusahaan kami ada masalah dengan sesuatu untuk dipahami dari sisi admin, mereka mengusir saya, saya mengerti </p><br><p>  <strong>Anton</strong> : Tapi secara umum, perlukah mengetahui hal-hal admin ini?  Bukan hanya di sana, pangkalan berada dalam ruang hampa, berputar di suatu tempat, Anda perlu mengkonfigurasi sistem operasi, kan? </p><br><p>  <strong>Alexei</strong> : ya, ya, itu persis karena dia umumnya sangat bergantung pada subsistem sistem operasi, memori virtual, dan manajemen disk, mis.  seolah-olah dia sendiri tidak secara langsung mengoperasikan sumber daya, dia seolah-olah membongkar semua pekerjaan ini ke sistem operasi, dan itu sendiri mengelola disk I / O, manajemen halaman memori, itu saja, proses switching, dan karenanya, jika Anda menemukan shutdown postgres, Anda perlu ada juga sedikit peretasan di sistem operasi, cara kerja semuanya di sana dan cara kerjanya di antarmuka dengan postgres. </p><br><p>  Misalnya, jika dibandingkan dengan Oracle, Oracle memiliki, misalnya, subsistemnya sendiri yang bekerja dengan input-output, mis.  mereka melewati sistem operasi, mereka dapat bekerja secara langsung dengan disk, tetapi dalam Posgres ini tidak, Anda perlu tahu bagaimana sistem operasi bekerja dengan database. </p><br><p>  <strong>Oleg</strong> : apakah Anda harus mendukung postgres di Windows? </p><br><p>  <strong>Alexei</strong> : ya, saya harus, kami punya klien, mereka dengan Windows, kami melayani semacam kantor St. Petersburg, melakukan audit terhadap database untuk mereka.  Basis mereka ada di Windows, umumnya menakutkan, kami terhubung ke beberapa protokol melalui protokol terminal, Remote Desktop dibuka, kami meluncurkan beberapa hal yang berkaitan dengan merekam kinerja di sana.  Singkatnya, itu sulit, menakutkan, bagaimana mimpi mengerikan sekarang diingat.  Dan sekarang pelanggan pada dasarnya semua duduk di Linux.  Sebenarnya tidak ada orang di Windows. </p><br><p>  <strong>Oleg</strong> : apa rasa sakit utama pada Postgre yang bisa dilihat semua orang? </p><br><p>  <strong>Alexey</strong> : banyak orang menginginkan filer otomatis dan multi-master.  Nah, multimaster, tentu saja, hal seperti itu, tidak mungkin tercapai.  Tetapi semua orang bekerja dengan Galera (dengan Mysql), dan mereka berkata: mengapa, kami juga menginginkan multimaster sedang berlangsung. </p><br><p>  Nah, dalam perkembangannya ada hal-hal seperti itu, tetapi tidak dalam inti progresif itu sendiri, ada hal-hal seperti itu yang menerapkan jenis multi-master, tetapi belum diproduksi sama sekali.  Tetapi orang-orang menginginkan multimaster.  Dan orang-orang juga menginginkan filer otomatis.  Tapi sekarang, terima kasih Tuhan Patroni telah muncul, di Patroni Anda dapat melakukan auto-filer, orang-orang secara perlahan memperkenalkannya.  Secara umum, dari sudut pandang saya, Patroni telah menjadi standar de facto.  Banyak perusahaan besar sudah menerapkannya.  Gitlab yang sama, mereka baru-baru ini membuat laporan, mereka menggunakan Patroni, mereka senang dengan segalanya, semua orang senang. </p><br><p>  <strong>Anton</strong> : Dengar, bisakah Anda memberi tahu kami secara singkat, apa itu patron untuk programmer sederhana?  Kami terutama mendengarkan para pemimpin tim dan programmer </p><br><p>  <strong>Nikita</strong> : tunggu, bolehkah aku membunuhmu, dan aku akan meminta lebih banyak lagi bagi yang bukan programmer untuk menjelaskan apa itu multimaster </p><br><p>  <strong>Alexei</strong> : lihat, bayangkan sekarang, Antokha adalah seorang programmer, dia menulis aplikasi, dan aplikasi perlu menyimpan datanya di suatu tempat.  Dia menempatkan mereka di pangkalan, di kedutaan.  Pada titik tertentu, database terletak pada satu server, dan kemudian server sekali - dan berhenti bekerja.  Catu daya terbakar, dan aplikasi harus terus bekerja dengan pangkalan.  Dan di sini muncul opsi bahwa kita perlu memiliki semacam salinan database dan terus bekerja dengannya.  Dan baik beralih ke itu, dan idealnya, jangan melakukan peralihan sehingga aplikasi kita tahu tentang basis kedua ini dan terus menulis untuk itu. </p><br><p>  Ini sebenarnya multimaster, ketika kami memiliki beberapa node yang tersedia untuk membaca dan menulis, dan aplikasi kami dapat bekerja secara bersamaan dengan mereka dan menulis data ke salah satu node ini dan membaca data dari node ini, tetapi sifatnya diatur sedemikian rupa sehingga tidak cukup ideal dicapai, dan ada pro dan kontra, ada kerugian, kasus penggunaannya sendiri untuk menggunakan multimaster.  Contoh paling umum adalah bahwa Anda tidak dapat menulis data yang sama, secara relatif, menjadi dua contoh, misalnya bekerja dengan tabel yang sama, menulis ke tabel yang sama melalui dua server, akan ada konflik dan mereka perlu diselesaikan, ini adalah masalah oleh karena itu perlu untuk menulis jika kita menulis dalam satu tabel, maka kita hanya menulis melalui satu server. </p><br><p>  <strong>Nikita</strong> : dan ini berhubungan langsung dengan kipas-otomatis, ya, apakah itu terhubung? </p><br><p>  <strong>Alexei</strong> : ya, dan ini karena auto-fielder, di sini, seolah-olah, satu mengikuti dari yang lain.  Jika kita tidak mampu membeli multimaster, maka kita menginginkan semacam mekanisme transparan yang akan mengalihkan node cadangan ke mode master, yaitu.  kami memiliki aplikasi, ini berfungsi, dan segera setelah aplikasi tersebut dihilangkan dari database, pengembang tidak ingin mengubah konfigurasi aplikasi ini dan menunjukkan alamat database baru di sana, restart aplikasi, terutama jika ada banyak aplikasi.  Saya ingin semacam mekanisme transparan yang akan bekerja di suatu tempat di bawah tenda, beralih database, dan aplikasi kita akan bekerja dengan alamat yang sama dan terus membaca dari database ini.  Untuk melakukan ini, Anda sudah memerlukan filer otomatis yang secara transparan mengalihkan node cadangan ke mode penyihir, dan untuk Patroni ini hanya digunakan </p><br><p>  <strong>Anton</strong> : Apakah Patroni saklar murni atau garpu postgres, semacam tambahan? </p><br><p>  <strong>Alexei</strong> : ini, bisa dikatakan, adalah layanan terpisah, proses terpisah yang berjalan pada host dengan database.  Dan dia memantau keadaan post-cluster cluster.  Dua tujuan dikejar di sini - autofailover dan manajemen klaster.  Tetapi dalam kasus ini kami mendapatkan cluster terdistribusi, tetapi kami memiliki beberapa node di cluster, master dan beberapa replika.  Oleh karena itu, Anda perlu terus memantau keadaan cluster, terus-menerus melihat apakah master masih hidup.  Jika dia tiba-tiba mati - Anda harus beralih ke peran "master" server lain.  Dan untuk ini digunakan, secara umum, ada dua pendekatan, bagaimana mendukung cluster view ini, representasi dalam cluster tentang bagaimana ia harus hidup saat ini.  Ada opsi ketika masing-masing node cluster - mereka memeriksa satu sama lain.  Dan Anda dapat menyimpan keadaan ini di luar, mis.  Di luar cluster.  Dan hanya Patroni yang menggunakan pendekatan ini, ia mengambil dan menyimpan status cluster dalam sistem ketiga.  Ini biasanya semacam DCS (konfigurasi sistem penyimpanan terdistribusi).  Itu bisa menjadi etcd, consul, atau bisa juga kuberenetesovsky etcd.  Yaitu  tergantung pada infrastrukturnya.  Dengan baik dan sesuai Patroni hanya menyimpan negara cluster dalam sistem DCS ini dan memperbaruinya. </p><br><p>  Jika tiba-tiba salah satu node tiba-tiba gagal, node baru dipilih.  Jika master ini, misalnya, jatuh, master baru dipilih, dan status ini diperbarui lagi di DCS.  Dan di sini dengan mengorbankan DCS Patroni mendukung kesehatan cluster. </p><br><p>  <strong>Anton</strong> : Dan jika jaringan berkedip antara Patroni dan pangkalan? </p><br><p>  <strong>Alexei</strong> : Begini, ada database, entah itu semacam server, atau, katakanlah, di Kubernet itu bisa berupa sub.  Pertimbangkan kasus sederhana, katakanlah ini adalah server.  Di server yang sama, kami memiliki database yang berjalan, dan pada server yang sama kami menjalankan agen Patroni.  Ini adalah proses yang ringan, mereka bekerja pada host yang sama dan berkomunikasi secara relatif di localhost.  Jaringan kami mungkin berkedip antara repositori DCS dan host tempat basis dan Patroni bekerja. </p><br><p>  Mungkin ada opsi yang berbeda.  Bergantung pada seberapa parah kedipan jaringan ini terjadi.  Itu terjadi jika itu adalah seorang master, dan ia ternyata terisolasi, maka node lain akan menemukan bahwa master itu sudah pergi.  Mereka hanya akan memilih master baru, dan dia akan melihat master lama bahwa dia terisolasi, dan Patroni akan memulai kembali dalam mode hanya baca.  Nah, agar tidak ada otak yang terbelah.  Sangat buruk jika aplikasi kita menulis ke dua node secara bersamaan.  Maka pengembang harus menyapu data, dan ini pekerjaan yang sangat sulit - untuk mengumpulkan data ini dalam bentuk yang konsisten.  Oleh karena itu, chuck hanya me-restart node dalam read only dan hanya itu, dan itu berfungsi.  Segera setelah jaringan dipulihkan, Patroni akan dapat mencapai DCS, mereka akan mengoordinasikan pandangan gugus lebih jauh di sana dan akan datang ke beberapa jenis solusi yang disepakati.  Kemungkinan besar simpul yang terisolasi ini, yang merupakan master lama, akan terhubung sebagai replika ke master baru ... </p><br><p>  <strong>Anton</strong> .  Nah, dalam praktiknya, bagaimana cara kerjanya?  Apakah ada masalah, jebakan.  Agar Oleg mengambil dan mengimplementasikan, misalnya, Patroni, ia perlu membuat keputusan untuk ini. </p><br><p>  <strong>Oleg</strong> .  Ya, segera </p><br><p>  <strong>Alexey</strong> .  Begini, kami telah menggunakan Patroni dengan pelanggan sejak tahun lalu.  Klien pertama kami muncul menurut pendapat saya pada November 2018.  Dan pada saat itu kami tidak memiliki ide yang sangat bagus tentang bagaimana bekerja dengan ini, tetapi untuk tahun ini kami bekerja, pada prinsipnya, semuanya cocok untuk kami.  Kami belajar cara memasaknya.  Pada prinsipnya, untuk mengingatkan, secara umum, itu tidak benar-benar membutuhkan banyak langkah, secara harfiah dua atau tiga tindakan dari sisi postgres, dari sisi konfigurasi patron, dan semua ini bekerja dengan cukup baik. </p><br><p>  Sepotong itu dapat diandalkan.  Pertama-tama sederhana, ditulis dengan Python, memakan sedikit memori dan bekerja secara andal.  Satu-satunya hal dalam infrastruktur adalah DCS ini.  Tetapi sebagai aturan itu perlu baik Konsul atau etcd.  Tetapi bagi banyak perusahaan, benda ini sudah digunakan untuk semua jenis penemuan layanan yang berbeda, oleh karena itu, sebagai suatu peraturan, tidak ada masalah dengan ini. </p><br><p>  Dan masalah apa yang muncul: masalah paling mendasar yang tidak langsung dirasakan orang adalah kita bisa kehilangan sebagian data dengan pengarsipan otomatis </p><br><p>  <strong>Oleg</strong> : karena lag replikasi? </p><br><p>  <strong>Alexei</strong> : bayangkan sebuah situasi di mana pengarsipan otomatis terjadi selama replikasi, master tua menjadi offline, tetapi kami masih menulis beberapa bagian dari data ke dalamnya.  Misalkan ada semacam replikasi lag, master baru dipilih dari replika lain.  Master baru dinaikkan dan jika Patroni dikonfigurasi sedemikian rupa sehingga simpul yang jatuh secara otomatis dimasukkan dalam cluster, misalnya, autostart layanan dihidupkan, maka ketika master lama naik, ia melihat bahwa ia tidak lagi master, ia di belakang, ia akan mencoba untuk terhubung ke master baru dan menjadi isyaratnya.  Dan pada saat itu dia menjalankan perintah pg_rewind. </p><br><p>  Perintah ini memundurkan log transaksi pada node lama (master lama) hingga dapat terhubung ke master baru, yaitu, log transaksi ditimpa.  Pada titik ini, kami mungkin kehilangan sebagian data.  Di Patroni sendiri ada sedikit perlindungan, ada beberapa tikungan yang memungkinkan replika untuk tidak mengambil bagian dalam pemilihan dengan tumpukan besar.  Jika, misalnya, semua replika memiliki kelambatan besar, maka pemilihan tidak akan dimulai, dan kemudian intervensi manual administrator diperlukan bagi admin untuk masuk dan memulai file otomatis dengan tangan.  Atau mereka semua akan menunggu sampai tuan tua naik.  Sampai karyanya dipulihkan.  Dan mereka sudah terhubung dengan itu dan akan terus menangkapnya. </p><br><p>  Yaitu, di Patroni ada mekanisme yang memungkinkan Anda untuk tidak kehilangan data, tetapi ada risiko, jadi Anda harus hati-hati </p><br><p>  <strong>Anton</strong> : bagaimana dengan replikasi sinkron? </p><br><p>  <strong>Alexei</strong> : replikasi sinkron, Anda tahu, ketika kita menggunakan replikasi sinkron, kita kehilangan kinerja.  Tidak semua orang bisa melakukan kesepakatan ini.  Tetapi jika kita menggunakan replikasi sinkron, risiko kehilangan data berkurang.  Tetapi jika kita menggunakan beberapa node, katakanlah lebih dari dua, maka kita masih perlu mempertimbangkan opsi ketika kita mengalami kecelakaan baik pada master dan pada replika sinkron.  Dan kami masih memiliki replika kedua, dan mungkin ternyata kami dapat menjebaknya dan kehilangan beberapa data lagi.  Pilihan yang berbeda dimungkinkan, mereka perlu dievaluasi, dilihat dan dipahami apakah perilaku seperti itu cocok untuk kita atau tidak. </p><br><p>  <strong>Anton</strong> : dengarkan, hanya ada dua server yang jatuh - itu seperti menyediakan invasi alien </p><br><p>  <strong>Aleksey</strong> : dan ada pukulan keras pada wanita tua itu </p><br><p>  <strong>Oleg</strong> : apakah kamu ingat panggilan yang sama pada jam lima pagi ke Lesha untuk terakhir kalinya, apa hubungannya dengan hal yang menarik, Anton, dan bukannya kita segera kehilangan dua pangkalan? </p><br><p>  <strong>Anton</strong> : itu faktor manusia.  Ya, itu terjadi. </p><br><p>  <strong>Alexey</strong> : ngomong-ngomong, saya tidak ingat alasan panggilan itu </p><br><p>  <strong>Anton</strong> : kami mentransfer dua server di sana, mereka bekerja secara paralel, mencatat data, itu tidak masalah.  Dan sistem dapat bekerja pada satu, tetapi satu ditransfer ke pusat data lain, dihidupkan.  Yang kedua diangkut sejauh ini, dan ada semacam kabel yang disentuh pada saat instalasi, dan yang lama juga dihancurkan - mereka mencampur sesuatu.  Secara umum, kami dua server jatuh, mulai naik, dan karena mereka dikonfigurasi secara kaku untuk merekam, mereka memiliki pos pemeriksaan yang sangat jarang atau sesuatu seperti itu.  Itu dimulai untuk waktu yang lama, kami tidak mengerti apa yang terjadi </p><br><p>  <strong>Oleg</strong> : seratus pertunjukan wal-log </p><br><p>  <strong>Anton</strong> : kami tidak mengerti apa yang terjadi, mengapa itu tidak dimulai, dan akibatnya saya harus menelepon.  Sebenarnya tidak ada yang istimewa yang harus dilakukan ... </p><br><p>  <strong>Alexei</strong> : well, ada satu-satunya hal yang mungkin kita sambungkan, kita telah melihat bahwa semuanya beres </p><br><p>  <strong>Oleg</strong> : mengkonfirmasi kematian pasien </p><br><p>  <strong>Anton</strong> : sebenarnya, Anda hanya harus menunggu, pada umumnya. </p><br><p>  <strong>Alexey</strong> .  Ya, ini masalah yang diketahui.  Dengan beberapa pengaturan, pos-pos pemeriksaannya panjang.  Ada masalah seperti itu. </p><br><p>  Tetapi secara umum, jika Anda mengingat panggilan malam ini, dalam praktiknya kami jarang menelepon pada malam hari, kami memiliki otomatisasi khusus yang diatur - bertugas, semuanya sebagaimana mestinya, dipilih sesuai dengan jadwal khusus.  Jadi, jika Anda ingat, mungkin sekali setiap enam bulan seseorang akan menelepon </p><br><p>  <strong>Oleg</strong> : semuanya dari perusahaan kami mungkin </p><br><p>  <strong>Alexey</strong> : tidak, berbeda </p><br><p>  <strong>Anton</strong> : Oleg, teleponlah lebih sering </p><br><p>  <strong>Oleg</strong> : kami akan melakukan peralihan hari ini, saya mungkin akan menelepon </p><br><p>  <strong>Alexey</strong> : kita punya teman, waktu malam mereka sudah tutup, mereka hanya akan bekerja </p><br><p>  <strong>Anton</strong> : dengarkan, Lech, Anda mengatakan bahwa Patroni memiliki beberapa analog.  Bagaimana mereka berbeda, apa yang ada </p><br><p>  <strong>Alexey</strong> : pada dasarnya ada dua opsi, ada repmgr, hal ini muncul sejak lama, sekitar 10 tahun yang lalu.  Ini mengimplementasikan mekanisme ketika node dari post-grace cluster saling memeriksa, siapa yang hidup, siapa yang tidak hidup.  Tapi menurut saya ini tidak terlalu, saya tidak terlalu suka skema kerja ini. </p><br><p>  Dan tidak ada auto-filer di luar kotak, repmgr awalnya dipertajam khusus untuk mengelola cluster dan untuk beralih manual, untuk peralihan tersebut.  Dan jika Anda ingin langsung melakukan auto-filer, maka Anda perlu menginstal demo repmgrd secara terpisah, dan, ternyata, file otomatis dimulai di sini.  Masalahnya nyaman, bagus, tapi ya - kami tidak memiliki filer otomatis di luar kotak.  Anda harus meletakkannya secara terpisah.  Secara umum, masalahnya bagus, nyaman, dalam arti dapat dikonfigurasi dengan baik, nyaman untuk mempertahankan cluster berbasis cluster.  Dia sangat fleksibel, dapat disesuaikan.  Replika dapat dituangkan dalam berbagai cara.  Dari backup, dari replika untuk menuangkan yang lain, dari master.  Singkatnya, hal yang fleksibel, karena 10 tahun.  Dan banyak fitur yang berbeda didorong ke dalamnya, itu sangat bagus. </p><br><p>  Dan opsi lain adalah Stolon.  Dia muncul pada waktu yang hampir bersamaan dengan Patroni, beberapa saat kemudian.  Itu ditulis di Go. </p><br><p>  Tetapi memiliki arsitektur yang lebih bercabang.  Jika Anda membuka situs web proyek, akan ada gambar, dan Stolon sendiri terdiri dari beberapa komponen.  Dia memiliki node penjaga yang bekerja dengan database yang meningkatkan Postges.  Lalu ada yang disebut simpul Sentinel.  Mereka memantau keadaan cluster, memeriksa ketersediaannya, memverifikasi bahwa node itu hidup atau tidak hidup.  Mereka mengelola keadaan cluster dan mengkonfigurasi ulang jika terjadi sesuatu. </p><br><p>  Dan ada yang disebut node proxy, semua lalu lintas melewati mereka.  Aplikasi klien berfungsi dengan proksi.   -,  -   ,       .  Yaitu    .  ,   , Stolon     DCS,    consul, etcd.  -       . </p><br><p>    ,      -  ,    bare metal  ,  ,       - ,   .       .        (   -)    ,       ,       . </p><br><p>      ,     .      . ,           . ,         .     oltp-      .   Stolon    ,       . </p><br><p>     ,  6  8,    .     ,    ,  .   ,     — wal_keep_segments —   - ,   ,    , .      ,    -  . ,        .       .  Yaitu        ,    . , ,    .   ,     —     .      . </p><br><p> <strong></strong> : , ,   -  Citus?   ,    . </p><br><p> <strong></strong> : Citus —    . Citus   ,      CitusDB, -.       ,      ,     ,     </p><br><p> <strong></strong> :  ? </p><br><p> <strong></strong> :  ,  ,    .      .           ,  pg autofailover.       ,      .    ,      ,   . ,      ,        .    ,   ,  .    ,       ,        .  Yaitu         . </p><br><p> <strong></strong> :  Citus.    ,       ,          .   —   ,    ... </p><br><p> <strong></strong> : , ,  </p><br><p> <strong></strong> : ,     ,           ,  ,   ,  </p><br><p> <strong></strong> :  ,     ,      .  ,   ,  ,   .     "in the wild"  .        ,    . </p><br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dekripsi lebih lanjut dari masalah ini akan diposting di Habr dalam waktu dekat, tetapi untuk sekarang berlangganan podcast </font></font><a href="https://soundcloud.com/znprod" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zinc Prod</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , ada banyak hal menarik di depan!</font></font></p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id485322/">https://habr.com/ru/post/id485322/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id485300/index.html">Wabah baru H2Miner menemukan cacing yang mengeksploitasi Redis RCE</a></li>
<li><a href="../id485304/index.html">Beberapa trik elemen iframe</a></li>
<li><a href="../id485312/index.html">DevOps untuk Aplikasi Seluler</a></li>
<li><a href="../id485316/index.html">Semua Google SERP sekarang terlihat seperti iklan</a></li>
<li><a href="../id485318/index.html">Menambahkan keindahan dan interaktivitas ke Notebook Jupyter</a></li>
<li><a href="../id485324/index.html">Multithreading di Widget Qt</a></li>
<li><a href="../id485326/index.html">Membuat Micro Frontends Menggunakan Elemen Sudut: Panduan Pemula</a></li>
<li><a href="../id485328/index.html">Spesifikasi Steroid</a></li>
<li><a href="../id485330/index.html">Cara mengalahkan acak tanpa jiwa di game roguelike</a></li>
<li><a href="../id485334/index.html">Polling Sesi</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>