<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸŒ â›°ï¸ ğŸ‘· Estados globais: por que e como evitÃ¡-los ğŸ§€ ğŸ³ï¸â€ğŸŒˆ ğŸ‚</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="CondiÃ§Ãµes globais. Essa frase causa medo e dor no coraÃ§Ã£o de todo desenvolvedor que teve o infortÃºnio de enfrentar esse fenÃ´meno. VocÃª jÃ¡ encontrou um...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Estados globais: por que e como evitÃ¡-los</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/mailru/blog/454946/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/il/xm/yl/ilxmyllyrjl50zu_shop-i-3fus.jpeg"></div><br>  CondiÃ§Ãµes globais.  Essa frase causa medo e dor no coraÃ§Ã£o de todo desenvolvedor que teve o infortÃºnio de enfrentar esse fenÃ´meno.  VocÃª jÃ¡ encontrou um comportamento inesperado do aplicativo, sem entender seus motivos, como um cavaleiro infeliz tentando matar Hydra com muitas cabeÃ§as?  VocÃª acaba em um ciclo interminÃ¡vel de tentativa e erro, 90% do tempo se perguntando o que estÃ¡ acontecendo? <br><br>  Tudo isso pode ser conseqÃ¼Ãªncias irritantes de globais: variÃ¡veis â€‹â€‹ocultas que mudam de estado em lugares desconhecidos, por razÃµes que vocÃª ainda nÃ£o descobriu. <br><a name="habracut"></a><br>  VocÃª gosta de passear no escuro enquanto tenta alterar o aplicativo?  Claro que nÃ£o gosto disso.  Felizmente, tenho velas para vocÃª: <br><br><ol><li>  Primeiro, descreverei o que chamamos mais frequentemente de estados globais.  Esse termo nem sempre Ã© usado com precisÃ£o, portanto, requer esclarecimentos. <br></li><li>  A seguir, descobriremos por que os globais sÃ£o prejudiciais Ã  nossa base de cÃ³digos. <br></li><li>  Depois, explicarei como aparar o escopo dos globais para transformÃ¡-los em variÃ¡veis â€‹â€‹locais. <br></li><li>  Por fim, falarei sobre encapsulamento e por que a cruzada contra variÃ¡veis â€‹â€‹globais Ã© apenas parte do grande problema. <br></li></ol><br>  Espero que este artigo explique tudo o que vocÃª precisa saber sobre estados globais.  Se vocÃª acha que senti muita falta e me odeia por isso e nÃ£o quer mais me ver, escreva sobre isso nos comentÃ¡rios.  SerÃ¡ agradÃ¡vel para mim, meus leitores e todos que apareceram de repente nesta pÃ¡gina. <br><br>  VocÃª estÃ¡ pronto, querido leitor, para pular a cavalo e conhecer seu inimigo?  VÃ¡ encontrar esses globais e fazÃª-los provar o aÃ§o de nossas espadas! <br><br><h1>  O que Ã© uma condiÃ§Ã£o? </h1><br><img src="https://habrastorage.org/getpro/habr/post_images/7dd/561/59c/7dd56159c2c3d32176e249ea71ed13ad.jpg"><br><br>  Vamos comeÃ§ar com o bÃ¡sico, para que os desenvolvedores se entendam. <br><br>  Um estado Ã© uma definiÃ§Ã£o de um sistema ou entidade.  Os estados sÃ£o encontrados na vida real: <br><br><ul><li>  Quando o computador estÃ¡ desligado, seu estado estÃ¡ desligado. <br></li><li>  Quando uma xÃ­cara de chÃ¡ estÃ¡ quente, sua condiÃ§Ã£o estÃ¡ quente. <br></li></ul><br>  No desenvolvimento de software, algumas construÃ§Ãµes (como variÃ¡veis) podem ter estados.  Digamos que a string "olÃ¡" ou o nÃºmero 11 nÃ£o sejam considerados estados, sÃ£o valores.  Tornam-se estado quando sÃ£o anexados a uma variÃ¡vel e colocados na memÃ³ria. <br><br><pre><code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"hello"</span></span>; <span class="hljs-comment"><span class="hljs-comment">// No state here! $lala = "hello"; // The variable $lala has the state 'hello'.</span></span></code> </pre> <br>  Dois tipos de estados podem ser distinguidos: <br><br>  Estados variÃ¡veis: apÃ³s a inicializaÃ§Ã£o, eles podem mudar durante a execuÃ§Ã£o do seu aplicativo a qualquer momento. <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> $lala = <span class="hljs-string"><span class="hljs-string">"hello"</span></span>; <span class="hljs-comment"><span class="hljs-comment">// Initialisation of the variable. $lala = "hallo"; // The state of the variable $lala can be changed at runtime.</span></span></code> </pre> <br>  Estados imutÃ¡veis: nÃ£o podem ser alterados durante a execuÃ§Ã£o.  VocÃª atribui o primeiro estado Ã  sua variÃ¡vel e seu valor nÃ£o Ã© alterado posteriormente.  "Constantes" na vida cotidiana sÃ£o chamadas de exemplos de estados imutÃ¡veis: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> define(<span class="hljs-string"><span class="hljs-string">"GREETING"</span></span>, <span class="hljs-string"><span class="hljs-string">"hello"</span></span>); <span class="hljs-comment"><span class="hljs-comment">// Constant definition. echo GREETING; GREETING = "hallo"; // This line will produce an error!</span></span></code> </pre> <br>  Agora vamos ouvir uma conversa hipotÃ©tica entre Denis e Vasily, seus colegas desenvolvedores: <br><br>  Dan!  VocÃª criou variÃ¡veis â€‹â€‹globais em todos os lugares!  Eles nÃ£o podem ser alterados sem tudo quebrar!  Eu vou te matar! <br>  - Nifiga, Vasek!  Minhas fortunas globais sÃ£o incrÃ­veis!  Coloquei minha alma neles, sÃ£o obras-primas!  Eu adoro meus globals! <br><br>  Na maioria das vezes, os desenvolvedores chamam estados globais, variÃ¡veis â€‹â€‹globais ou globais do que devem chamar estados globais mutÃ¡veis.  Ou seja, estados que podem ser modificados no maior dos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">escopos</a> disponÃ­veis para vocÃª: em todo o aplicativo. <br><br>  Quando uma variÃ¡vel nÃ£o tem todo o aplicativo como escopo, estamos falando de variÃ¡veis â€‹â€‹locais ou localidades.  Eles existem em algumas Ã¡reas de visibilidade, menos que a Ã¡rea de todo o aplicativo. <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Ecommerce</span></span>; $global = <span class="hljs-string"><span class="hljs-string">"I'm a mutable global variable!"</span></span>; <span class="hljs-comment"><span class="hljs-comment">// global variable class Shipment { public $warehouse; // local variable existing in the whole class public function __construct() { $info = "You're creating a shipment object!"; // local variable bound to the constructor scope echo $info; } } class Product { public function __construct() { global $global; $global = "I change the state now 'cause I can!"; echo "You're creating a product object!"; // no state here } }</span></span></code> </pre> <br>  VocÃª pode pensar: como Ã© conveniente ter variÃ¡veis â€‹â€‹que vocÃª possa acessar de qualquer lugar e alterÃ¡-las!  Eu posso transferir estados de uma parte do aplicativo para outra!  NÃ£o hÃ¡ necessidade de passar por funÃ§Ãµes e escrever tanto cÃ³digo!  Salve, estado mutÃ¡vel global! <br><br>  Se vocÃª realmente pensou assim, eu recomendo continuar lendo. <br><br><h1>  Estados globais piores que peste e cÃ³lera? </h1><br><h2>  O maior diagrama de links </h2><br>  Fato: serÃ¡ mais fÃ¡cil criar um diagrama de conexÃ£o de aplicativo preciso se ele contiver apenas localidades com escopos pequenos e definidos, sem globais. <br><br>  Porque <br><br>  Digamos que vocÃª tenha um aplicativo grande com variÃ¡veis â€‹â€‹globais.  Toda vez que vocÃª precisar alterar algo, vocÃª deve: <br><br><ul><li>  Lembre-se de que esses estados globais mutÃ¡veis â€‹â€‹existem. <br></li><li>  Estime se eles afetarÃ£o o escopo que vocÃª vai alterar. <br></li></ul><br>  Normalmente, vocÃª nÃ£o precisa pensar em variÃ¡veis â€‹â€‹locais que estÃ£o em outros escopos, mas faÃ§a o que fizer, sempre mantenha em seu cÃ©rebro cansado um lugar para estados mutÃ¡veis â€‹â€‹globais, pois eles podem afetar todos os escopos. <br><br>  AlÃ©m disso, seus estados mutÃ¡veis â€‹â€‹globais podem mudar em qualquer lugar do aplicativo.  Geralmente, Ã© preciso se perguntar qual Ã© o estado atual deles.  Isso significa que vocÃª Ã© forÃ§ado a pesquisar em todo o aplicativo, tentando calcular os valores dos globais no escopo modificÃ¡vel. <br><br>  Isso nÃ£o Ã© tudo.  Se vocÃª precisar alterar o estado dos globais, nÃ£o imaginarÃ¡ qual o escopo afetado.  Isso levarÃ¡ a um comportamento inesperado de outra classe, mÃ©todo ou funÃ§Ã£o?  Sucesso na busca. <br><br>  Em resumo, vocÃª combina todas as classes, mÃ©todos e funÃ§Ãµes que usam o mesmo estado global.  NÃ£o se esqueÃ§a: as <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">dependÃªncias aumentam bastante a complexidade</a> .  Isso te assusta?  Deveria ser.  Pequenas Ã¡reas especÃ­ficas de visibilidade sÃ£o muito Ãºteis: vocÃª nÃ£o precisa se lembrar de toda a aplicaÃ§Ã£o; basta lembrar apenas das Ã¡reas com as quais trabalha. <br><br>  As pessoas nÃ£o rastreiam imediatamente uma grande quantidade de informaÃ§Ãµes.  Quando tentamos fazer isso, esgotamos rapidamente o suprimento de capacidades cognitivas, torna-se difÃ­cil nos concentrarmos e comeÃ§amos a criar bugs e coisas estÃºpidas.  Ã‰ por isso que Ã© tÃ£o desagradÃ¡vel atuar no escopo global do seu aplicativo. <br><br><h2>  ColisÃµes de nomes globais </h2><br>  Existem dificuldades ao usar bibliotecas de terceiros.  Imagine que vocÃª deseja usar a biblioteca super bacana que colore aleatoriamente cada personagem com um efeito de cintilaÃ§Ã£o.  O sonho de todo desenvolvedor!  Se essa biblioteca tambÃ©m usar globais que tenham os mesmos nomes que os seus, vocÃª poderÃ¡ desfrutar de colisÃµes de nomes.  Seu aplicativo falharÃ¡ e vocÃª descobrirÃ¡ os motivos, provavelmente por um longo tempo: <br><br><ul><li>  Primeiro, vocÃª precisarÃ¡ descobrir que sua biblioteca usa variÃ¡veis â€‹â€‹globais. <br></li><li>  Em segundo lugar, vocÃª precisa calcular qual variÃ¡vel foi usada durante a execuÃ§Ã£o - sua ou bibliotecas?  NÃ£o Ã© tÃ£o simples, os nomes sÃ£o os mesmos! <br></li><li>  Em terceiro lugar, como vocÃª nÃ£o pode alterar a biblioteca, renomeie suas variÃ¡veis â€‹â€‹mutÃ¡veis â€‹â€‹globais.  Se usado em todo o aplicativo, vocÃª chorarÃ¡. <br></li></ul><br>  Em cada estÃ¡gio, vocÃª arranca o cabelo da raiva e do desespero.  Em breve vocÃª nÃ£o precisarÃ¡ mais de um pente.  Ã‰ improvÃ¡vel que esse cenÃ¡rio o seduza.  Talvez alguÃ©m se lembre de que as bibliotecas JavaScript Mootools, Underscore e jQuery sempre se chocavam entre si se nÃ£o fossem colocadas em escopos menores.  Ah, e o famoso objeto global <code>$</code> no jQuery! <br><br><h2>  Os testes se transformarÃ£o em um pesadelo </h2><br>  Se ainda nÃ£o o convenci, vejamos a situaÃ§Ã£o do ponto de vista do teste de unidade: como vocÃª escreve testes na presenÃ§a de variÃ¡veis â€‹â€‹globais?  Como os testes podem mudar globais, vocÃª nÃ£o sabe em que teste estava o estado.  VocÃª precisa isolar os testes um do outro, e estados globais os unem. <br><br>  VocÃª jÃ¡ teve isso para que, isoladamente, os testes funcionem bem e, quando vocÃª executa o pacote inteiro, eles falham?  NÃ£o?  E eu tive.  Toda vez que me lembro disso, sofro. <br><br><h2>  Problemas de simultaneidade </h2><br>  Estados globais variÃ¡veis â€‹â€‹podem causar muitos problemas se vocÃª precisar de simultaneidade.  Quando vocÃª altera o estado dos globais em vÃ¡rios segmentos de execuÃ§Ã£o, fique de cabeÃ§a para baixo em um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">estado</a> poderoso <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">da corrida</a> . <br><br>  Se vocÃª Ã© um desenvolvedor PHP, isso nÃ£o o incomoda, a menos que vocÃª use bibliotecas que permitem criar paralelismo.  No entanto, quando vocÃª <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aprende um novo idioma</a> no qual o paralelismo Ã© fÃ¡cil de implementar, espero que vocÃª se lembre da minha prosa. <br><br><h1>  Evitando estados globais mutÃ¡veis </h1><br><img src="https://habrastorage.org/getpro/habr/post_images/6df/acf/801/6dfacf801044e2e081ffd24ed7502a98.jpg"><br><br>  Embora os estados mutÃ¡veis â€‹â€‹globais possam causar muitos problemas, Ã s vezes sÃ£o difÃ­ceis de evitar. <br><br>  Adote a API REST: os terminais recebem algum tipo de solicitaÃ§Ã£o HTTP com parÃ¢metros e enviam respostas.  Esses parÃ¢metros HTTP enviados ao servidor podem ser exigidos em vÃ¡rios nÃ­veis do seu aplicativo.  Ã‰ muito tentador tornar esses parÃ¢metros globais ao receber uma solicitaÃ§Ã£o HTTP, modificando-os antes de enviar uma resposta.  Adicione paralelismo em cima de cada solicitaÃ§Ã£o e a receita do desastre estÃ¡ pronta. <br><br>  Estados mutÃ¡veis â€‹â€‹globais tambÃ©m podem ser diretamente suportados em implementaÃ§Ãµes de idiomas.  Por exemplo, no PHP existem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">superglobais</a> . <br><br>  Se os globais vÃªm de algum lugar, como lidar com eles?  Como refatorar a aplicaÃ§Ã£o de Denis, seu colega desenvolvedor que criou globals sempre que possÃ­vel, porque ele nÃ£o leu nada sobre desenvolvimento nos Ãºltimos 20 anos? <br><br><h2>  Argumentos de FunÃ§Ã£o </h2><br>  A maneira mais fÃ¡cil de evitar globais Ã© passar variÃ¡veis â€‹â€‹usando argumentos de funÃ§Ã£o.  Veja um exemplo simples: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Router</span></span>\<span class="hljs-title"><span class="hljs-title">HttpRequest</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Product</span></span>\<span class="hljs-title"><span class="hljs-title">ProductData</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Exceptions</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ProductController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(HttpRequest $httpReq)</span></span></span><span class="hljs-function"> </span></span>{ $productData = $httpReq-&gt;get(<span class="hljs-string"><span class="hljs-string">"productData"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;productModel-&gt;validateProduct($productData)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ValidationException(sprintf(<span class="hljs-string"><span class="hljs-string">"The product %d is not valid"</span></span>, $productData[<span class="hljs-string"><span class="hljs-string">"id"</span></span>])); } $product = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;productModel-&gt;createProduct($productData); } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Product</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createProduct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(array $productData)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Product</span></span></span><span class="hljs-function"> </span></span>{ $productData[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] = <span class="hljs-string"><span class="hljs-string">"SuperProduct"</span></span>.$productData[<span class="hljs-string"><span class="hljs-string">"name"</span></span>]; <span class="hljs-comment"><span class="hljs-comment">// This is not what you should do; I talk about it later in the article. try { $product = $this-&gt;productDao-&gt;find($productData["id"]); return product; } catch (NotFoundException $e) { $product = $this-&gt;productDao-&gt;save($productData); return $product; } } } class ProductDao { private $db; public function find(int $id): array { return $this-&gt;db-&gt;find(['product' =&gt; $id]); } public function save(array $productData): array { return $this-&gt;db-&gt;saveProduct($productData); } }</span></span></code> </pre> <br>  Como vocÃª pode ver, a <code>$productData</code> do controlador, atravÃ©s de uma solicitaÃ§Ã£o HTTP, passa por diferentes nÃ­veis: <br><br><ol><li>  O controlador recebeu uma solicitaÃ§Ã£o HTTP. <br></li><li>  ParÃ¢metros passados â€‹â€‹para o modelo. <br></li><li>  ParÃ¢metros passados â€‹â€‹para o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">DAO</a> . <br></li><li>  Os parÃ¢metros sÃ£o salvos no banco de dados do aplicativo. <br></li></ol><br>  PoderÃ­amos tornar esse conjunto de parÃ¢metros global quando o recuperarmos da solicitaÃ§Ã£o HTTP.  Parece tÃ£o mais simples: nÃ£o hÃ¡ necessidade de transferir dados para 4 funÃ§Ãµes diferentes.  No entanto, passando parÃ¢metros como argumentos para funÃ§Ãµes: <br><br><ul><li>  Obviamente, isso mostrarÃ¡ que essas funÃ§Ãµes usam a <code>$productData</code> . <br></li><li>  Obviamente, mostrarÃ¡ quais funÃ§Ãµes usam quais parÃ¢metros.  Pode-se observar que, para <code>ProductDao::find</code> da <code>$productData</code> , apenas <code>$id</code> necessÃ¡rio e nÃ£o tudo. <br></li></ul><br>  Os Globals tornam o cÃ³digo menos compreensÃ­vel e associam mÃ©todos entre si, o que Ã© um preÃ§o muito alto pela quase completa ausÃªncia de vantagens. <br><br>  VocÃª jÃ¡ ouviu Denis protestar: â€œE se uma funÃ§Ã£o tiver trÃªs ou mais argumentos?  Se vocÃª precisar adicionar ainda mais, a complexidade da funÃ§Ã£o aumentarÃ¡!  E as variÃ¡veis, objetos e outras construÃ§Ãµes necessÃ¡rias em todos os lugares?  VocÃª os passarÃ¡ para cada funÃ§Ã£o no aplicativo? â€ <br><br>  As perguntas sÃ£o justas, caro leitor.  Como um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">bom desenvolvedor</a> , vocÃª deve explicar a Denis, usando suas habilidades de comunicaÃ§Ã£o, isto Ã© o que: <br><br>  <i>â€œDenis, se suas funÃ§Ãµes tiverem muitos argumentos, elas poderÃ£o ser um problema.</i>  <i>Eles provavelmente fazem demais, sÃ£o responsÃ¡veis â€‹â€‹por muitas coisas.</i>  <i>VocÃª nÃ£o pensou em dividi-los em funÃ§Ãµes menores? "</i>  . <br><br>  Sentindo-se como um orador na AcrÃ³pole de Atenas, vocÃª continua: <br><br>  <i>â€œSe vocÃª precisar de variÃ¡veis â€‹â€‹em muitas Ã¡reas de visibilidade, isso Ã© um problema, e em breve falaremos sobre isso.</i>  <i>Mas se vocÃª realmente precisa deles, o que hÃ¡ de errado em passar por argumentos de funÃ§Ã£o?</i>  <i>Sim, vocÃª terÃ¡ que digitÃ¡-las no teclado, mas somos desenvolvedores, Ã© nosso trabalho escrever cÃ³digo. â€</i> <br><br>  Pode parecer mais complicado quando vocÃª tem mais argumentos (talvez seja assim), mas repito, as vantagens superam as desvantagens: Ã© melhor que o cÃ³digo seja o mais claro possÃ­vel e nÃ£o use estados mutÃ¡veis â€‹â€‹globais ocultos. <br><br><h2>  Objetos de contexto </h2><br>  Objetos contextuais sÃ£o aqueles que contÃªm dados definidos por algum contexto.  Normalmente, esses dados sÃ£o armazenados como uma construÃ§Ã£o de par de chaves, como uma matriz associativa em PHP.  Esse objeto nÃ£o possui comportamento, apenas dados, semelhantes <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">a um objeto de valor</a> . <br><br>  Um objeto de contexto pode substituir qualquer estado mutÃ¡vel global.  Retorne ao exemplo de cÃ³digo anterior.  Em vez de passar dados da solicitaÃ§Ã£o pelos nÃ­veis, podemos usar um objeto que encapsula esses dados. <br><br>  O contexto serÃ¡ a prÃ³pria consulta: outra consulta - outro contexto - outro conjunto de dados.  Em seguida, o objeto de contexto serÃ¡ passado para qualquer mÃ©todo que precise desses dados. <br><br>  VocÃª diz: "Ã‰ incrÃ­vel e tudo isso, mas o que isso dÃ¡?" <br><br><ul><li>  Os dados sÃ£o encapsulados em um objeto.  Na maioria das vezes, sua tarefa serÃ¡ tornar os dados imutÃ¡veis, ou seja, para que vocÃª nÃ£o possa alterar o estado - o valor dos dados no objeto apÃ³s a inicializaÃ§Ã£o. <br></li><li>  Obviamente, o contexto precisa dos dados do objeto de contexto, pois Ã© transferido para todas as funÃ§Ãµes (ou mÃ©todos) que precisam desses dados. <br></li><li>  Isso resolve o problema de simultaneidade: se cada solicitaÃ§Ã£o tiver seu prÃ³prio objeto de contexto, vocÃª poderÃ¡ gravÃ¡-los ou lÃª-los com seguranÃ§a em seus prÃ³prios encadeamentos de execuÃ§Ã£o. <br></li></ul><br>  Mas tudo no desenvolvimento tem um preÃ§o.  Objetos de contexto podem ser prejudiciais: <br><br><ul><li>  Observando os argumentos da funÃ§Ã£o, vocÃª nÃ£o saberÃ¡ quais dados estÃ£o no objeto de contexto. <br></li><li>  VocÃª pode colocar qualquer coisa em um objeto de contexto.  Cuidado para nÃ£o colocar muito, por exemplo, toda a sessÃ£o do usuÃ¡rio ou atÃ© a maioria dos dados do aplicativo.  E entÃ£o isso pode acontecer: <code>$context-&gt;getSession()-&gt;getUser()-&gt;getProfil()-&gt;getUsername()</code> .  Quebre a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">lei de DemÃ©ter</a> e sua maldiÃ§Ã£o serÃ¡ uma complexidade insana. <br></li><li>  Quanto maior o objeto de contexto, mais difÃ­cil Ã© descobrir quais dados e em qual escopo ele usa. <br></li></ul><br>  Em geral, eu evitaria usar objetos contextuais o mÃ¡ximo possÃ­vel.  Eles podem causar muitas dÃºvidas.  A imutabilidade dos dados Ã© uma grande vantagem, mas nÃ£o devemos esquecer as deficiÃªncias.  Se vocÃª estiver usando um objeto de contexto, verifique se ele Ã© pequeno o suficiente e passe-o para um escopo pequeno e cuidadosamente definido. <br><br>  Se antes de executar um programa vocÃª nÃ£o tem idÃ©ia de quantos estados serÃ£o passados â€‹â€‹para suas funÃ§Ãµes (por exemplo, parÃ¢metros de uma solicitaÃ§Ã£o HTTP), os objetos de contexto podem ser Ãºteis.  Portanto, alguns deles os utilizam, lembre-se, por exemplo, do objeto <code>Request</code> no Symfony. <br><br><h2>  InjeÃ§Ã£o de DependÃªncia </h2><br>  Outra boa alternativa para os estados mutÃ¡veis â€‹â€‹globais seria incorporar diretamente os dados necessÃ¡rios no objeto quando vocÃª os criar.  Esta Ã© a definiÃ§Ã£o de injeÃ§Ã£o de dependÃªncia: um conjunto de tÃ©cnicas para incorporar objetos em seus componentes (classes). <br><br><h3>  Por que exatamente injeÃ§Ã£o de dependÃªncia? </h3><br>  O objetivo Ã© limitar o uso de suas variÃ¡veis, objetos ou outras construÃ§Ãµes e colocÃ¡-las em um escopo limitado.  Se vocÃª possui dependÃªncias incorporadas e, portanto, sÃ³ pode atuar no escopo de um objeto, serÃ¡ mais fÃ¡cil descobrir em que contexto elas sÃ£o usadas e por quÃª.  Sem angÃºstia e tormento! <br><br>  A injeÃ§Ã£o de dependÃªncia divide o ciclo de vida do aplicativo em duas fases importantes: <br><br><ol><li>  Criando objetos de aplicativo e implementando suas dependÃªncias. <br></li><li>  Use objetos para atingir seus objetivos. <br></li></ol><br>  Essa abordagem torna o cÃ³digo mais claro: vocÃª nÃ£o precisa instanciar tudo em locais aleatÃ³rios ou, pior ainda, usar objetos globais em qualquer lugar. <br><br>  Muitas estruturas usam injeÃ§Ã£o de dependÃªncia, Ã s vezes em esquemas bastante complexos, com arquivos de configuraÃ§Ã£o e um DIC (Dependency Injection Container).  Mas nÃ£o Ã© de todo necessÃ¡rio para complicar as coisas.  VocÃª pode simplesmente criar dependÃªncias em um nÃ­vel e implementÃ¡-las em um nÃ­vel inferior.  Por exemplo, no mundo Go, nÃ£o conheÃ§o ninguÃ©m que usaria o DIC.  VocÃª simplesmente cria as dependÃªncias no arquivo principal com o cÃ³digo (main.go) e as transfere para o prÃ³ximo nÃ­vel.  VocÃª tambÃ©m pode instanciar tudo em pacotes diferentes para indicar claramente que a "fase de injeÃ§Ã£o de dependÃªncia" deve ser executada apenas nesse nÃ­vel especÃ­fico.  No Go, o escopo dos pacotes pode facilitar as coisas do que no PHP, no qual as DICs sÃ£o amplamente usadas em todas as estruturas que conheÃ§o, incluindo Symfony e Laravel. <br><br><h3>  ImplementaÃ§Ã£o via construtor ou setter </h3><br>  Existem duas maneiras de injetar dependÃªncias: atravÃ©s do construtor ou dos setters.  Eu aconselho, se possÃ­vel, a seguir o primeiro mÃ©todo: <br><br><ul><li>  Se vocÃª precisa saber o que sÃ£o dependÃªncias de classe, tudo o que vocÃª precisa fazer Ã© encontrar um construtor.  NÃ£o hÃ¡ necessidade de procurar mÃ©todos espalhados por toda a classe. <br></li><li>  Definir dependÃªncias durante a instalaÃ§Ã£o darÃ¡ a vocÃª confianÃ§a na seguranÃ§a do uso do objeto. <br></li></ul><br>  Vamos falar um pouco sobre o Ãºltimo ponto: isso Ã© chamado de "imposiÃ§Ã£o de invariante".  Ao criar uma instÃ¢ncia de um objeto e implementar suas dependÃªncias, vocÃª sabe que nÃ£o importa o que seu objeto precise, ele estÃ¡ configurado corretamente.  E se vocÃª usa setters, como vocÃª sabe que suas dependÃªncias jÃ¡ estÃ£o definidas no momento do uso do objeto?  VocÃª pode ir para a pilha e tentar descobrir se os setters foram chamados, mas tenho certeza que vocÃª nÃ£o quer fazer isso. <br><br><h1>  ViolaÃ§Ã£o de encapsulamento </h1><br>  Afinal, a Ãºnica diferenÃ§a entre estados locais e globais Ã© seu escopo.  Eles sÃ£o limitados para estados locais e, para global, todo o aplicativo estÃ¡ disponÃ­vel.  No entanto, vocÃª pode encontrar problemas especÃ­ficos para estados globais se vocÃª usar estados locais.  Porque <br><br><h2>  VocÃª disse encapsulamento? </h2><br>  O uso de estados globais acabarÃ¡ com o encapsulamento, assim como vocÃª pode quebrÃ¡-lo com os estados locais. <br><br>  Vamos comeÃ§ar do comeÃ§o.  O que a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Wikipedia</a> nos diz sobre a definiÃ§Ã£o de encapsulamento?  O mecanismo de linguagem para restringir o acesso direto a alguns componentes de um objeto.  RestriÃ§Ã£o de acesso?  Porque <br><br>  Bem, como vimos acima, Ã© muito mais fÃ¡cil argumentar no Ã¢mbito local do que no global.  Estados mutÃ¡veis â€‹â€‹globais estÃ£o, por definiÃ§Ã£o, disponÃ­veis em todos os lugares, e isso Ã© contra o encapsulamento!  Sem restriÃ§Ãµes de acesso para vocÃª. <br><br><h2>  Escopo crescente e vazamento de estado </h2><br><img src="https://habrastorage.org/getpro/habr/post_images/0a4/466/ed1/0a4466ed1a0cb8710127f819e160be0f.jpg"><br><br>  Vamos imaginar um estado em seu prÃ³prio escopo pequeno.  Infelizmente, com o tempo, o aplicativo cresce, esse estado local Ã© passado como argumento para a funÃ§Ã£o em todo o aplicativo.  Agora seu cÃ³digo de idioma Ã© usado em muitos escopos e em todos eles o acesso direto ao cÃ³digo de idioma Ã© autorizado.  Agora Ã© difÃ­cil calcular o estado exato do cÃ³digo do idioma sem examinar todas as Ã¡reas de visibilidade em que ele existe e onde pode ser alterado.  Tudo isso jÃ¡ vimos com estados globais mutÃ¡veis. <br><br>  Tomemos um exemplo: O <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Modelo de DomÃ­nio AnÃªmico</a> pode aumentar o escopo de seus modelos mutÃ¡veis.  De fato, o Modelo de DomÃ­nio AnÃªmico divide os dados e o comportamento de seus objetos de domÃ­nio em dois grupos: modelos (objetos apenas com dados) e serviÃ§os (objetos apenas com comportamento).  Na maioria das vezes, esses modelos serÃ£o usados â€‹â€‹em todos os serviÃ§os.  Portanto, Ã© provÃ¡vel que algum tipo de modelo aumente constantemente o escopo.  VocÃª nÃ£o entenderÃ¡ qual modelo Ã© usado em que contexto, o estado deles mudarÃ¡ e os mesmos problemas cairÃ£o sobre vocÃª. <br><br>  Quero transmitir uma idÃ©ia importante: se vocÃª evitar estados globais mutÃ¡veis, isso nÃ£o significa que vocÃª pode relaxar, segurar um coquetel em uma mÃ£o e pressionar os botÃµes com a outra, curtindo a vida e seu cÃ³digo lendÃ¡rio. -, <a href="https://res.cloudinary.com/practicaldev/image/fetch/s--CWGA3Ax4--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/">    </a> ,  -,     ,           . <br><br>       ,       .   ,        . <br><br>     ?  -  .     ,         ,  -. <br><br> ,  -    ,    ,    .     ,      ,   â€”  .    ,   :       ,   .           .      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="></a> . <br><br><h2>    </h2><br>            .      <code>Product</code> , ,   : <br><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Product</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createProduct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(array $productData)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Product</span></span></span><span class="hljs-function"> </span></span>{ $productData[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] = <span class="hljs-string"><span class="hljs-string">"SuperProduct"</span></span>.$productData[<span class="hljs-string"><span class="hljs-string">"name"</span></span>]; <span class="hljs-comment"><span class="hljs-comment">// This is not what you should do; I talk about it later in the article. try { $product = $this-&gt;productDao-&gt;find($productData["id"]); return product; } catch (NotFoundException $e) { $product = $this-&gt;productDao-&gt;save($productData); return $product; } } }</span></span></code> </pre> <br>  <code>$productData</code>   .      ,     ,      ,     . <br><br>         ,  .   ,   -   ?   ,        .         . <br><br>    ,       ,    .    . <br><br>   : <br><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Product</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createProduct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(array $productData)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Product</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// Since $productData is passed to other variable, it has to be immutable. $name = "SuperProduct".$productData["name"]; try { $product = $this-&gt;productDao-&gt;find($productData["id"]); return product; } catch (NotFoundException $e) { $product = $this-&gt;productDao-&gt;save($name, $productData); return $product; } } }</span></span></code> </pre> <br>   ,      ,       <code>$productData</code> .  ,   .      <code>$productData</code>    ,    ,        HTTP-. <br><br>          ,    : Â«,     Â». <br><br><h1>     ? </h1><br><img src="https://habrastorage.org/getpro/habr/post_images/0cd/d30/a3f/0cdd30a3fbd1097b15e7f5457d3d5c55.jpg"><br><br>        . ,    . <br><br>    ? <br><br><ul><li>      ,      ,      . <br></li><li>  ,      ,        (,     ) . <br></li></ul><br>          .  ,      . <br><br>  ,  <code>ShipmentDelay</code>  , ,  ,     .   ,  -,   <code>ShipmentDelay</code>   ,    ,      ,     . ?    ,         <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> DRY</a> . <br><br>           ,      ,     .       :      ,   ,        .  ,       ,    ,      .          ,    ,        . <br><br><h1>        ? </h1><br>  ,      (,   ),   ,    ,        .       ,    ,   ,    ,   . <br><br>    .  : <br><br><ul><li>        . <br></li><li>            ,     . <br></li><li>   â€”   :         ,    ,        . <br></li><li>     ,        . <br></li></ul><br>           .       ,       â€”      .  ,      . <br><br>   ,         ,  . <br><br>        ,   ,   .    ,        .  ,     ,     .  ,       ! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt454946/">https://habr.com/ru/post/pt454946/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt454930/index.html">Coleta de lixo na V8: como o novo GC Orinoco funciona</a></li>
<li><a href="../pt454932/index.html">Investimentos e software: 5 terminais de negociaÃ§Ã£o para negociaÃ§Ã£o na bolsa</a></li>
<li><a href="../pt454936/index.html">Vivaldi: o bloqueio de anÃºncios deve ser a escolha do usuÃ¡rio</a></li>
<li><a href="../pt454940/index.html">Seguro de saÃºde de viagem: instruÃ§Ãµes detalhadas</a></li>
<li><a href="../pt454944/index.html">Como o formato JPEG funciona</a></li>
<li><a href="../pt454958/index.html">Um olhar por dentro: pÃ³s-graduaÃ§Ã£o na EPFL. Parte 4.1: vida cotidiana</a></li>
<li><a href="../pt454960/index.html">Microbiota. Como os medicamentos afetam as bactÃ©rias intestinais</a></li>
<li><a href="../pt454962/index.html">Como as empresas de TI do mundo se protegem dos concorrentes em face dos ex-funcionÃ¡rios?</a></li>
<li><a href="../pt454964/index.html">O uso da visÃ£o computacional em pesquisas marÃ­timas ou 12 pessoas no peito de um morto</a></li>
<li><a href="../pt454966/index.html">Crie jogos instantÃ¢neos no Unity no Google Play InstantÃ¢neo</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>