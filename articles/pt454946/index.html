<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🌞 ⛰️ 👷 Estados globais: por que e como evitá-los 🧀 🏳️‍🌈 🏂</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Condições globais. Essa frase causa medo e dor no coração de todo desenvolvedor que teve o infortúnio de enfrentar esse fenômeno. Você já encontrou um...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Estados globais: por que e como evitá-los</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/mailru/blog/454946/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/il/xm/yl/ilxmyllyrjl50zu_shop-i-3fus.jpeg"></div><br>  Condições globais.  Essa frase causa medo e dor no coração de todo desenvolvedor que teve o infortúnio de enfrentar esse fenômeno.  Você já encontrou um comportamento inesperado do aplicativo, sem entender seus motivos, como um cavaleiro infeliz tentando matar Hydra com muitas cabeças?  Você acaba em um ciclo interminável de tentativa e erro, 90% do tempo se perguntando o que está acontecendo? <br><br>  Tudo isso pode ser conseqüências irritantes de globais: variáveis ​​ocultas que mudam de estado em lugares desconhecidos, por razões que você ainda não descobriu. <br><a name="habracut"></a><br>  Você gosta de passear no escuro enquanto tenta alterar o aplicativo?  Claro que não gosto disso.  Felizmente, tenho velas para você: <br><br><ol><li>  Primeiro, descreverei o que chamamos mais frequentemente de estados globais.  Esse termo nem sempre é usado com precisão, portanto, requer esclarecimentos. <br></li><li>  A seguir, descobriremos por que os globais são prejudiciais à nossa base de códigos. <br></li><li>  Depois, explicarei como aparar o escopo dos globais para transformá-los em variáveis ​​locais. <br></li><li>  Por fim, falarei sobre encapsulamento e por que a cruzada contra variáveis ​​globais é apenas parte do grande problema. <br></li></ol><br>  Espero que este artigo explique tudo o que você precisa saber sobre estados globais.  Se você acha que senti muita falta e me odeia por isso e não quer mais me ver, escreva sobre isso nos comentários.  Será agradável para mim, meus leitores e todos que apareceram de repente nesta página. <br><br>  Você está pronto, querido leitor, para pular a cavalo e conhecer seu inimigo?  Vá encontrar esses globais e fazê-los provar o aço de nossas espadas! <br><br><h1>  O que é uma condição? </h1><br><img src="https://habrastorage.org/getpro/habr/post_images/7dd/561/59c/7dd56159c2c3d32176e249ea71ed13ad.jpg"><br><br>  Vamos começar com o básico, para que os desenvolvedores se entendam. <br><br>  Um estado é uma definição de um sistema ou entidade.  Os estados são encontrados na vida real: <br><br><ul><li>  Quando o computador está desligado, seu estado está desligado. <br></li><li>  Quando uma xícara de chá está quente, sua condição está quente. <br></li></ul><br>  No desenvolvimento de software, algumas construções (como variáveis) podem ter estados.  Digamos que a string "olá" ou o número 11 não sejam considerados estados, são valores.  Tornam-se estado quando são anexados a uma variável e colocados na memória. <br><br><pre><code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"hello"</span></span>; <span class="hljs-comment"><span class="hljs-comment">// No state here! $lala = "hello"; // The variable $lala has the state 'hello'.</span></span></code> </pre> <br>  Dois tipos de estados podem ser distinguidos: <br><br>  Estados variáveis: após a inicialização, eles podem mudar durante a execução do seu aplicativo a qualquer momento. <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> $lala = <span class="hljs-string"><span class="hljs-string">"hello"</span></span>; <span class="hljs-comment"><span class="hljs-comment">// Initialisation of the variable. $lala = "hallo"; // The state of the variable $lala can be changed at runtime.</span></span></code> </pre> <br>  Estados imutáveis: não podem ser alterados durante a execução.  Você atribui o primeiro estado à sua variável e seu valor não é alterado posteriormente.  "Constantes" na vida cotidiana são chamadas de exemplos de estados imutáveis: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> define(<span class="hljs-string"><span class="hljs-string">"GREETING"</span></span>, <span class="hljs-string"><span class="hljs-string">"hello"</span></span>); <span class="hljs-comment"><span class="hljs-comment">// Constant definition. echo GREETING; GREETING = "hallo"; // This line will produce an error!</span></span></code> </pre> <br>  Agora vamos ouvir uma conversa hipotética entre Denis e Vasily, seus colegas desenvolvedores: <br><br>  Dan!  Você criou variáveis ​​globais em todos os lugares!  Eles não podem ser alterados sem tudo quebrar!  Eu vou te matar! <br>  - Nifiga, Vasek!  Minhas fortunas globais são incríveis!  Coloquei minha alma neles, são obras-primas!  Eu adoro meus globals! <br><br>  Na maioria das vezes, os desenvolvedores chamam estados globais, variáveis ​​globais ou globais do que devem chamar estados globais mutáveis.  Ou seja, estados que podem ser modificados no maior dos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">escopos</a> disponíveis para você: em todo o aplicativo. <br><br>  Quando uma variável não tem todo o aplicativo como escopo, estamos falando de variáveis ​​locais ou localidades.  Eles existem em algumas áreas de visibilidade, menos que a área de todo o aplicativo. <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Ecommerce</span></span>; $global = <span class="hljs-string"><span class="hljs-string">"I'm a mutable global variable!"</span></span>; <span class="hljs-comment"><span class="hljs-comment">// global variable class Shipment { public $warehouse; // local variable existing in the whole class public function __construct() { $info = "You're creating a shipment object!"; // local variable bound to the constructor scope echo $info; } } class Product { public function __construct() { global $global; $global = "I change the state now 'cause I can!"; echo "You're creating a product object!"; // no state here } }</span></span></code> </pre> <br>  Você pode pensar: como é conveniente ter variáveis ​​que você possa acessar de qualquer lugar e alterá-las!  Eu posso transferir estados de uma parte do aplicativo para outra!  Não há necessidade de passar por funções e escrever tanto código!  Salve, estado mutável global! <br><br>  Se você realmente pensou assim, eu recomendo continuar lendo. <br><br><h1>  Estados globais piores que peste e cólera? </h1><br><h2>  O maior diagrama de links </h2><br>  Fato: será mais fácil criar um diagrama de conexão de aplicativo preciso se ele contiver apenas localidades com escopos pequenos e definidos, sem globais. <br><br>  Porque <br><br>  Digamos que você tenha um aplicativo grande com variáveis ​​globais.  Toda vez que você precisar alterar algo, você deve: <br><br><ul><li>  Lembre-se de que esses estados globais mutáveis ​​existem. <br></li><li>  Estime se eles afetarão o escopo que você vai alterar. <br></li></ul><br>  Normalmente, você não precisa pensar em variáveis ​​locais que estão em outros escopos, mas faça o que fizer, sempre mantenha em seu cérebro cansado um lugar para estados mutáveis ​​globais, pois eles podem afetar todos os escopos. <br><br>  Além disso, seus estados mutáveis ​​globais podem mudar em qualquer lugar do aplicativo.  Geralmente, é preciso se perguntar qual é o estado atual deles.  Isso significa que você é forçado a pesquisar em todo o aplicativo, tentando calcular os valores dos globais no escopo modificável. <br><br>  Isso não é tudo.  Se você precisar alterar o estado dos globais, não imaginará qual o escopo afetado.  Isso levará a um comportamento inesperado de outra classe, método ou função?  Sucesso na busca. <br><br>  Em resumo, você combina todas as classes, métodos e funções que usam o mesmo estado global.  Não se esqueça: as <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">dependências aumentam bastante a complexidade</a> .  Isso te assusta?  Deveria ser.  Pequenas áreas específicas de visibilidade são muito úteis: você não precisa se lembrar de toda a aplicação; basta lembrar apenas das áreas com as quais trabalha. <br><br>  As pessoas não rastreiam imediatamente uma grande quantidade de informações.  Quando tentamos fazer isso, esgotamos rapidamente o suprimento de capacidades cognitivas, torna-se difícil nos concentrarmos e começamos a criar bugs e coisas estúpidas.  É por isso que é tão desagradável atuar no escopo global do seu aplicativo. <br><br><h2>  Colisões de nomes globais </h2><br>  Existem dificuldades ao usar bibliotecas de terceiros.  Imagine que você deseja usar a biblioteca super bacana que colore aleatoriamente cada personagem com um efeito de cintilação.  O sonho de todo desenvolvedor!  Se essa biblioteca também usar globais que tenham os mesmos nomes que os seus, você poderá desfrutar de colisões de nomes.  Seu aplicativo falhará e você descobrirá os motivos, provavelmente por um longo tempo: <br><br><ul><li>  Primeiro, você precisará descobrir que sua biblioteca usa variáveis ​​globais. <br></li><li>  Em segundo lugar, você precisa calcular qual variável foi usada durante a execução - sua ou bibliotecas?  Não é tão simples, os nomes são os mesmos! <br></li><li>  Em terceiro lugar, como você não pode alterar a biblioteca, renomeie suas variáveis ​​mutáveis ​​globais.  Se usado em todo o aplicativo, você chorará. <br></li></ul><br>  Em cada estágio, você arranca o cabelo da raiva e do desespero.  Em breve você não precisará mais de um pente.  É improvável que esse cenário o seduza.  Talvez alguém se lembre de que as bibliotecas JavaScript Mootools, Underscore e jQuery sempre se chocavam entre si se não fossem colocadas em escopos menores.  Ah, e o famoso objeto global <code>$</code> no jQuery! <br><br><h2>  Os testes se transformarão em um pesadelo </h2><br>  Se ainda não o convenci, vejamos a situação do ponto de vista do teste de unidade: como você escreve testes na presença de variáveis ​​globais?  Como os testes podem mudar globais, você não sabe em que teste estava o estado.  Você precisa isolar os testes um do outro, e estados globais os unem. <br><br>  Você já teve isso para que, isoladamente, os testes funcionem bem e, quando você executa o pacote inteiro, eles falham?  Não?  E eu tive.  Toda vez que me lembro disso, sofro. <br><br><h2>  Problemas de simultaneidade </h2><br>  Estados globais variáveis ​​podem causar muitos problemas se você precisar de simultaneidade.  Quando você altera o estado dos globais em vários segmentos de execução, fique de cabeça para baixo em um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">estado</a> poderoso <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">da corrida</a> . <br><br>  Se você é um desenvolvedor PHP, isso não o incomoda, a menos que você use bibliotecas que permitem criar paralelismo.  No entanto, quando você <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aprende um novo idioma</a> no qual o paralelismo é fácil de implementar, espero que você se lembre da minha prosa. <br><br><h1>  Evitando estados globais mutáveis </h1><br><img src="https://habrastorage.org/getpro/habr/post_images/6df/acf/801/6dfacf801044e2e081ffd24ed7502a98.jpg"><br><br>  Embora os estados mutáveis ​​globais possam causar muitos problemas, às vezes são difíceis de evitar. <br><br>  Adote a API REST: os terminais recebem algum tipo de solicitação HTTP com parâmetros e enviam respostas.  Esses parâmetros HTTP enviados ao servidor podem ser exigidos em vários níveis do seu aplicativo.  É muito tentador tornar esses parâmetros globais ao receber uma solicitação HTTP, modificando-os antes de enviar uma resposta.  Adicione paralelismo em cima de cada solicitação e a receita do desastre está pronta. <br><br>  Estados mutáveis ​​globais também podem ser diretamente suportados em implementações de idiomas.  Por exemplo, no PHP existem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">superglobais</a> . <br><br>  Se os globais vêm de algum lugar, como lidar com eles?  Como refatorar a aplicação de Denis, seu colega desenvolvedor que criou globals sempre que possível, porque ele não leu nada sobre desenvolvimento nos últimos 20 anos? <br><br><h2>  Argumentos de Função </h2><br>  A maneira mais fácil de evitar globais é passar variáveis ​​usando argumentos de função.  Veja um exemplo simples: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Router</span></span>\<span class="hljs-title"><span class="hljs-title">HttpRequest</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Product</span></span>\<span class="hljs-title"><span class="hljs-title">ProductData</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Exceptions</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ProductController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(HttpRequest $httpReq)</span></span></span><span class="hljs-function"> </span></span>{ $productData = $httpReq-&gt;get(<span class="hljs-string"><span class="hljs-string">"productData"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;productModel-&gt;validateProduct($productData)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ValidationException(sprintf(<span class="hljs-string"><span class="hljs-string">"The product %d is not valid"</span></span>, $productData[<span class="hljs-string"><span class="hljs-string">"id"</span></span>])); } $product = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;productModel-&gt;createProduct($productData); } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Product</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createProduct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(array $productData)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Product</span></span></span><span class="hljs-function"> </span></span>{ $productData[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] = <span class="hljs-string"><span class="hljs-string">"SuperProduct"</span></span>.$productData[<span class="hljs-string"><span class="hljs-string">"name"</span></span>]; <span class="hljs-comment"><span class="hljs-comment">// This is not what you should do; I talk about it later in the article. try { $product = $this-&gt;productDao-&gt;find($productData["id"]); return product; } catch (NotFoundException $e) { $product = $this-&gt;productDao-&gt;save($productData); return $product; } } } class ProductDao { private $db; public function find(int $id): array { return $this-&gt;db-&gt;find(['product' =&gt; $id]); } public function save(array $productData): array { return $this-&gt;db-&gt;saveProduct($productData); } }</span></span></code> </pre> <br>  Como você pode ver, a <code>$productData</code> do controlador, através de uma solicitação HTTP, passa por diferentes níveis: <br><br><ol><li>  O controlador recebeu uma solicitação HTTP. <br></li><li>  Parâmetros passados ​​para o modelo. <br></li><li>  Parâmetros passados ​​para o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">DAO</a> . <br></li><li>  Os parâmetros são salvos no banco de dados do aplicativo. <br></li></ol><br>  Poderíamos tornar esse conjunto de parâmetros global quando o recuperarmos da solicitação HTTP.  Parece tão mais simples: não há necessidade de transferir dados para 4 funções diferentes.  No entanto, passando parâmetros como argumentos para funções: <br><br><ul><li>  Obviamente, isso mostrará que essas funções usam a <code>$productData</code> . <br></li><li>  Obviamente, mostrará quais funções usam quais parâmetros.  Pode-se observar que, para <code>ProductDao::find</code> da <code>$productData</code> , apenas <code>$id</code> necessário e não tudo. <br></li></ul><br>  Os Globals tornam o código menos compreensível e associam métodos entre si, o que é um preço muito alto pela quase completa ausência de vantagens. <br><br>  Você já ouviu Denis protestar: “E se uma função tiver três ou mais argumentos?  Se você precisar adicionar ainda mais, a complexidade da função aumentará!  E as variáveis, objetos e outras construções necessárias em todos os lugares?  Você os passará para cada função no aplicativo? ” <br><br>  As perguntas são justas, caro leitor.  Como um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">bom desenvolvedor</a> , você deve explicar a Denis, usando suas habilidades de comunicação, isto é o que: <br><br>  <i>“Denis, se suas funções tiverem muitos argumentos, elas poderão ser um problema.</i>  <i>Eles provavelmente fazem demais, são responsáveis ​​por muitas coisas.</i>  <i>Você não pensou em dividi-los em funções menores? "</i>  . <br><br>  Sentindo-se como um orador na Acrópole de Atenas, você continua: <br><br>  <i>“Se você precisar de variáveis ​​em muitas áreas de visibilidade, isso é um problema, e em breve falaremos sobre isso.</i>  <i>Mas se você realmente precisa deles, o que há de errado em passar por argumentos de função?</i>  <i>Sim, você terá que digitá-las no teclado, mas somos desenvolvedores, é nosso trabalho escrever código. ”</i> <br><br>  Pode parecer mais complicado quando você tem mais argumentos (talvez seja assim), mas repito, as vantagens superam as desvantagens: é melhor que o código seja o mais claro possível e não use estados mutáveis ​​globais ocultos. <br><br><h2>  Objetos de contexto </h2><br>  Objetos contextuais são aqueles que contêm dados definidos por algum contexto.  Normalmente, esses dados são armazenados como uma construção de par de chaves, como uma matriz associativa em PHP.  Esse objeto não possui comportamento, apenas dados, semelhantes <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">a um objeto de valor</a> . <br><br>  Um objeto de contexto pode substituir qualquer estado mutável global.  Retorne ao exemplo de código anterior.  Em vez de passar dados da solicitação pelos níveis, podemos usar um objeto que encapsula esses dados. <br><br>  O contexto será a própria consulta: outra consulta - outro contexto - outro conjunto de dados.  Em seguida, o objeto de contexto será passado para qualquer método que precise desses dados. <br><br>  Você diz: "É incrível e tudo isso, mas o que isso dá?" <br><br><ul><li>  Os dados são encapsulados em um objeto.  Na maioria das vezes, sua tarefa será tornar os dados imutáveis, ou seja, para que você não possa alterar o estado - o valor dos dados no objeto após a inicialização. <br></li><li>  Obviamente, o contexto precisa dos dados do objeto de contexto, pois é transferido para todas as funções (ou métodos) que precisam desses dados. <br></li><li>  Isso resolve o problema de simultaneidade: se cada solicitação tiver seu próprio objeto de contexto, você poderá gravá-los ou lê-los com segurança em seus próprios encadeamentos de execução. <br></li></ul><br>  Mas tudo no desenvolvimento tem um preço.  Objetos de contexto podem ser prejudiciais: <br><br><ul><li>  Observando os argumentos da função, você não saberá quais dados estão no objeto de contexto. <br></li><li>  Você pode colocar qualquer coisa em um objeto de contexto.  Cuidado para não colocar muito, por exemplo, toda a sessão do usuário ou até a maioria dos dados do aplicativo.  E então isso pode acontecer: <code>$context-&gt;getSession()-&gt;getUser()-&gt;getProfil()-&gt;getUsername()</code> .  Quebre a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">lei de Deméter</a> e sua maldição será uma complexidade insana. <br></li><li>  Quanto maior o objeto de contexto, mais difícil é descobrir quais dados e em qual escopo ele usa. <br></li></ul><br>  Em geral, eu evitaria usar objetos contextuais o máximo possível.  Eles podem causar muitas dúvidas.  A imutabilidade dos dados é uma grande vantagem, mas não devemos esquecer as deficiências.  Se você estiver usando um objeto de contexto, verifique se ele é pequeno o suficiente e passe-o para um escopo pequeno e cuidadosamente definido. <br><br>  Se antes de executar um programa você não tem idéia de quantos estados serão passados ​​para suas funções (por exemplo, parâmetros de uma solicitação HTTP), os objetos de contexto podem ser úteis.  Portanto, alguns deles os utilizam, lembre-se, por exemplo, do objeto <code>Request</code> no Symfony. <br><br><h2>  Injeção de Dependência </h2><br>  Outra boa alternativa para os estados mutáveis ​​globais seria incorporar diretamente os dados necessários no objeto quando você os criar.  Esta é a definição de injeção de dependência: um conjunto de técnicas para incorporar objetos em seus componentes (classes). <br><br><h3>  Por que exatamente injeção de dependência? </h3><br>  O objetivo é limitar o uso de suas variáveis, objetos ou outras construções e colocá-las em um escopo limitado.  Se você possui dependências incorporadas e, portanto, só pode atuar no escopo de um objeto, será mais fácil descobrir em que contexto elas são usadas e por quê.  Sem angústia e tormento! <br><br>  A injeção de dependência divide o ciclo de vida do aplicativo em duas fases importantes: <br><br><ol><li>  Criando objetos de aplicativo e implementando suas dependências. <br></li><li>  Use objetos para atingir seus objetivos. <br></li></ol><br>  Essa abordagem torna o código mais claro: você não precisa instanciar tudo em locais aleatórios ou, pior ainda, usar objetos globais em qualquer lugar. <br><br>  Muitas estruturas usam injeção de dependência, às vezes em esquemas bastante complexos, com arquivos de configuração e um DIC (Dependency Injection Container).  Mas não é de todo necessário para complicar as coisas.  Você pode simplesmente criar dependências em um nível e implementá-las em um nível inferior.  Por exemplo, no mundo Go, não conheço ninguém que usaria o DIC.  Você simplesmente cria as dependências no arquivo principal com o código (main.go) e as transfere para o próximo nível.  Você também pode instanciar tudo em pacotes diferentes para indicar claramente que a "fase de injeção de dependência" deve ser executada apenas nesse nível específico.  No Go, o escopo dos pacotes pode facilitar as coisas do que no PHP, no qual as DICs são amplamente usadas em todas as estruturas que conheço, incluindo Symfony e Laravel. <br><br><h3>  Implementação via construtor ou setter </h3><br>  Existem duas maneiras de injetar dependências: através do construtor ou dos setters.  Eu aconselho, se possível, a seguir o primeiro método: <br><br><ul><li>  Se você precisa saber o que são dependências de classe, tudo o que você precisa fazer é encontrar um construtor.  Não há necessidade de procurar métodos espalhados por toda a classe. <br></li><li>  Definir dependências durante a instalação dará a você confiança na segurança do uso do objeto. <br></li></ul><br>  Vamos falar um pouco sobre o último ponto: isso é chamado de "imposição de invariante".  Ao criar uma instância de um objeto e implementar suas dependências, você sabe que não importa o que seu objeto precise, ele está configurado corretamente.  E se você usa setters, como você sabe que suas dependências já estão definidas no momento do uso do objeto?  Você pode ir para a pilha e tentar descobrir se os setters foram chamados, mas tenho certeza que você não quer fazer isso. <br><br><h1>  Violação de encapsulamento </h1><br>  Afinal, a única diferença entre estados locais e globais é seu escopo.  Eles são limitados para estados locais e, para global, todo o aplicativo está disponível.  No entanto, você pode encontrar problemas específicos para estados globais se você usar estados locais.  Porque <br><br><h2>  Você disse encapsulamento? </h2><br>  O uso de estados globais acabará com o encapsulamento, assim como você pode quebrá-lo com os estados locais. <br><br>  Vamos começar do começo.  O que a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Wikipedia</a> nos diz sobre a definição de encapsulamento?  O mecanismo de linguagem para restringir o acesso direto a alguns componentes de um objeto.  Restrição de acesso?  Porque <br><br>  Bem, como vimos acima, é muito mais fácil argumentar no âmbito local do que no global.  Estados mutáveis ​​globais estão, por definição, disponíveis em todos os lugares, e isso é contra o encapsulamento!  Sem restrições de acesso para você. <br><br><h2>  Escopo crescente e vazamento de estado </h2><br><img src="https://habrastorage.org/getpro/habr/post_images/0a4/466/ed1/0a4466ed1a0cb8710127f819e160be0f.jpg"><br><br>  Vamos imaginar um estado em seu próprio escopo pequeno.  Infelizmente, com o tempo, o aplicativo cresce, esse estado local é passado como argumento para a função em todo o aplicativo.  Agora seu código de idioma é usado em muitos escopos e em todos eles o acesso direto ao código de idioma é autorizado.  Agora é difícil calcular o estado exato do código do idioma sem examinar todas as áreas de visibilidade em que ele existe e onde pode ser alterado.  Tudo isso já vimos com estados globais mutáveis. <br><br>  Tomemos um exemplo: O <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Modelo de Domínio Anêmico</a> pode aumentar o escopo de seus modelos mutáveis.  De fato, o Modelo de Domínio Anêmico divide os dados e o comportamento de seus objetos de domínio em dois grupos: modelos (objetos apenas com dados) e serviços (objetos apenas com comportamento).  Na maioria das vezes, esses modelos serão usados ​​em todos os serviços.  Portanto, é provável que algum tipo de modelo aumente constantemente o escopo.  Você não entenderá qual modelo é usado em que contexto, o estado deles mudará e os mesmos problemas cairão sobre você. <br><br>  Quero transmitir uma idéia importante: se você evitar estados globais mutáveis, isso não significa que você pode relaxar, segurar um coquetel em uma mão e pressionar os botões com a outra, curtindo a vida e seu código lendário. -, <a href="https://res.cloudinary.com/practicaldev/image/fetch/s--CWGA3Ax4--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/">    </a> ,  -,     ,           . <br><br>       ,       .   ,        . <br><br>     ?  -  .     ,         ,  -. <br><br> ,  -    ,    ,    .     ,      ,   —  .    ,   :       ,   .           .      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="></a> . <br><br><h2>    </h2><br>            .      <code>Product</code> , ,   : <br><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Product</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createProduct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(array $productData)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Product</span></span></span><span class="hljs-function"> </span></span>{ $productData[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] = <span class="hljs-string"><span class="hljs-string">"SuperProduct"</span></span>.$productData[<span class="hljs-string"><span class="hljs-string">"name"</span></span>]; <span class="hljs-comment"><span class="hljs-comment">// This is not what you should do; I talk about it later in the article. try { $product = $this-&gt;productDao-&gt;find($productData["id"]); return product; } catch (NotFoundException $e) { $product = $this-&gt;productDao-&gt;save($productData); return $product; } } }</span></span></code> </pre> <br>  <code>$productData</code>   .      ,     ,      ,     . <br><br>         ,  .   ,   -   ?   ,        .         . <br><br>    ,       ,    .    . <br><br>   : <br><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Product</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createProduct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(array $productData)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Product</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// Since $productData is passed to other variable, it has to be immutable. $name = "SuperProduct".$productData["name"]; try { $product = $this-&gt;productDao-&gt;find($productData["id"]); return product; } catch (NotFoundException $e) { $product = $this-&gt;productDao-&gt;save($name, $productData); return $product; } } }</span></span></code> </pre> <br>   ,      ,       <code>$productData</code> .  ,   .      <code>$productData</code>    ,    ,        HTTP-. <br><br>          ,    : «,     ». <br><br><h1>     ? </h1><br><img src="https://habrastorage.org/getpro/habr/post_images/0cd/d30/a3f/0cdd30a3fbd1097b15e7f5457d3d5c55.jpg"><br><br>        . ,    . <br><br>    ? <br><br><ul><li>      ,      ,      . <br></li><li>  ,      ,        (,     ) . <br></li></ul><br>          .  ,      . <br><br>  ,  <code>ShipmentDelay</code>  , ,  ,     .   ,  -,   <code>ShipmentDelay</code>   ,    ,      ,     . ?    ,         <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> DRY</a> . <br><br>           ,      ,     .       :      ,   ,        .  ,       ,    ,      .          ,    ,        . <br><br><h1>        ? </h1><br>  ,      (,   ),   ,    ,        .       ,    ,   ,    ,   . <br><br>    .  : <br><br><ul><li>        . <br></li><li>            ,     . <br></li><li>   —   :         ,    ,        . <br></li><li>     ,        . <br></li></ul><br>           .       ,       —      .  ,      . <br><br>   ,         ,  . <br><br>        ,   ,   .    ,        .  ,     ,     .  ,       ! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt454946/">https://habr.com/ru/post/pt454946/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt454930/index.html">Coleta de lixo na V8: como o novo GC Orinoco funciona</a></li>
<li><a href="../pt454932/index.html">Investimentos e software: 5 terminais de negociação para negociação na bolsa</a></li>
<li><a href="../pt454936/index.html">Vivaldi: o bloqueio de anúncios deve ser a escolha do usuário</a></li>
<li><a href="../pt454940/index.html">Seguro de saúde de viagem: instruções detalhadas</a></li>
<li><a href="../pt454944/index.html">Como o formato JPEG funciona</a></li>
<li><a href="../pt454958/index.html">Um olhar por dentro: pós-graduação na EPFL. Parte 4.1: vida cotidiana</a></li>
<li><a href="../pt454960/index.html">Microbiota. Como os medicamentos afetam as bactérias intestinais</a></li>
<li><a href="../pt454962/index.html">Como as empresas de TI do mundo se protegem dos concorrentes em face dos ex-funcionários?</a></li>
<li><a href="../pt454964/index.html">O uso da visão computacional em pesquisas marítimas ou 12 pessoas no peito de um morto</a></li>
<li><a href="../pt454966/index.html">Crie jogos instantâneos no Unity no Google Play Instantâneo</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>