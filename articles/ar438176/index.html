<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ฉ๐ฟโ๐คโ๐ฉ๐ผ ๐ ๐ ูุธุฑุฉ ุนุงูุฉ ุนูู IPSec ูู Mikrotik ๐พ โ๏ธ ๐</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="IPSec (ุฃูุงู IP) - ูุฌููุนุฉ ูู ุงูุจุฑูุชููููุงุช ูุงูุฎูุงุฑุฒููุงุช ูุชุดููุฑ ุงูุจูุงูุงุช ูู ุดุจูุงุช IPv4 ู IPv6. ูุง ูุจุฏู ุงูุฃูุฑ ูุนูุฏูุง ุ ููู IPSec ูุง ูุถุน ููุงุนุฏ ูุงุถุญุฉ ูุชุดููุฑ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ูุธุฑุฉ ุนุงูุฉ ุนูู IPSec ูู Mikrotik</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/438176/" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  IPSec (ุฃูุงู IP) - ูุฌููุนุฉ ูู ุงูุจุฑูุชููููุงุช ูุงูุฎูุงุฑุฒููุงุช ูุชุดููุฑ ุงูุจูุงูุงุช ูู ุดุจูุงุช IPv4 ู IPv6.  ูุง ูุจุฏู ุงูุฃูุฑ ูุนูุฏูุง ุ ููู IPSec ูุง ูุถุน ููุงุนุฏ ูุงุถุญุฉ ูุชุดููุฑ ุญุฑูุฉ ุงููุฑูุฑ ุ ูุจุฏูุงู ูู ุฐูู ุ ูููู ุงููุทูุฑูู ุจุชุทุจูู ูุฌููุนุฉ ูู ุงูุฃุฏูุงุช (ุงูุจุฑูุชููููุงุช ูุงูุฎูุงุฑุฒููุงุช) ุ ุจุงุณุชุฎุฏุงู ุงููุณุคูู ุงูุฐู ููุดุฆ ููุงุฉ ุขููุฉ ููุจูุงูุงุช. </p><br><p style=";text-align:right;direction:rtl">  ุฃุฑูุฏ ุฃู ุฃุชุทุฑู ุฅูู IPSec ูู RouterOS ุฃุนูู ููููุงู ูู HOWTO ุงูุจุณูุท ุ ูุน ุงูุญุฏ ุงูุฃุฏูู ูู ุงููุธุฑูุฉ ูุงูุฃูุซูุฉ ุนูู ููููุฉ ุชูููู ูุชุตุญูุญ IPSec.  ูุฐุง ููุณ ุฏููููุง ุ ูุจุฏูู ููุงุฑุณุฉ ุนูู ููุตุฉ ุงุฎุชุจุงุฑ ุ ูุง ููุตู ุจุจุฏุก ุฅุนุฏุงุฏ ุฃููุงู ุญููููุฉ ูุฎูุงุฏู VPN. </p><a name="habracut"></a><br><h3 id="preimuschestva-i-nedostatki-ipsec" style=";text-align:right;direction:rtl">  ูุฒุงูุง ูุนููุจ IPSec </h3><br><p style=";text-align:right;direction:rtl">  ููุงุท ุงูููุฉ: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูุนูู ุนูู ูุณุชูู ุดุจูุฉ ูููุฐุฌ OSI </li><li style=";text-align:right;direction:rtl">  ููููู ุชุดููุฑ ุงูุญุฒูุฉ ุงููุตุฏุฑ ุจุงููุงูู ุฃู ูู ุทุจูุฉ ุงูููู ูุฃุนูู </li><li style=";text-align:right;direction:rtl">  ููุงู ุขููุฉ ููุชุบูุจ ุนูู NAT </li><li style=";text-align:right;direction:rtl">  ูุฌููุนุฉ ูุงุณุนุฉ ูู ุงูุชุดููุฑ ูุฎูุงุฑุฒููุงุช ุงูุชุฌุฒุฆุฉ ุงููุฑูุฑ ููุงุฎุชูุงุฑ ูู ุจูููุง </li><li style=";text-align:right;direction:rtl">  IPSec - ูุฌููุนุฉ ูู ุงููุนุงููุฑ ุงูููุชูุญุฉ ุงููุงุจูุฉ ููุชูุณุนุฉ </li><li style=";text-align:right;direction:rtl">  ูู ุญุงูุฉ Mikrotik ุ ูุง ูุชุทูุจ ุดุฑุงุก ุฑุณูู ุฃู ุชุฑุงุฎูุต ุฅุถุงููุฉ </li></ul><br><p style=";text-align:right;direction:rtl">  ููุงุท ุงูุถุนู: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุตุนูุจุฉ </li><li style=";text-align:right;direction:rtl">  ุฃุฏูุงุช ุงูุชูููู ูุงููุตุทูุญุงุช ุงููุฎุชููุฉ ูุจุงุฆุนู ูุฎุชููุฉ </li><li style=";text-align:right;direction:rtl">  ูุชุทูุจ ุงุณุชุฎุฏุงู ุฎูุงุฑุฒููุงุช ุชุดููุฑ ูููุฉ ููุฉ ุญุณุงุจูุฉ ุฌูุฏุฉ. </li><li style=";text-align:right;direction:rtl">  ูู ุงูุณูู ุงูุชุดุงู DPI </li></ul><br><h3 id="protokoly-v-sostave-ipsec" style=";text-align:right;direction:rtl">  ุงูุจุฑูุชููููุงุช ูู IPSec </h3><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/nd/k6/0m/ndk60mwkllka7jpnl2flzdqt8ce.png"></p><br><p style=";text-align:right;direction:rtl">  ุนูู ุงูุตุนูุฏ ุงูุนุงููู ุ ูููู ุชูุณูู ุฌููุน ุงูุจุฑูุชููููุงุช ุงูุชู ุณุชุชุนุงูู ูุนูุง ุฃุซูุงุก ุงูุชูููู ุฅูู ูุฌููุนุชูู: ุจุฑูุชููููุงุช ุงูุชุจุงุฏู ุงูุฑุฆูุณูุฉ ูุจุฑูุชููููุงุช ุญูุงูุฉ ุงูุจูุงูุงุช. </p><br><p style=";text-align:right;direction:rtl">  <strong>ุจุฑูุชููููุงุช ุชุจุงุฏู ุงูููุงุชูุญ (IKE)</strong> <br>  ูุชุชูุซู ุงููููุฉ ุงูุฑุฆูุณูุฉ ูู ูุตุงุฏูุฉ ุงููุดุงุฑููู ูู ุงูุงุชุตุงู ูุงูุงุชูุงู ุนูู ูุนููุงุช ุงูุชุดููุฑ ูููุงุชูุญ ูุญูุงูุฉ ุงููุนูููุงุช ุงููุฑุณูุฉ. </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  IKE (ุชุจุงุฏู ููุงุชูุญ ุงูุฅูุชุฑูุช) - ุชู ุชุนุฑููู ูู ุนุงู 1998.  ุชูุช ุฅุถุงูุฉ ุงูุนุฏูุฏ ูู ุงูููุฒุงุช (ุนูู ุณุจูู ุงููุซุงู ุ ุณุฏ NAT) ูุงุญููุง ููุธุงุฆู ุฅุถุงููุฉ ููุฏ ูุง ูุชู ุชูููุฐูุง ูุน ุงูุนุฏูุฏ ูู ุงูุจุงุฆุนูู.  ุฃุณุงุณ ุงูุชูุงูุถ ุงูุฑุฆูุณู ูู ISAKMP. </li><li style=";text-align:right;direction:rtl">  IKEv2 (Internet Key Exchange ุงูุฅุตุฏุงุฑ 2) - ุฃุญุฏุซ ูุฑุงุฌุนุฉ ูู 2014.  ุฅูู ุชุทูุฑ ูุจุฑูุชูููู IKE ุ ุญูุซ ุชู ุญู ุจุนุถ ุงููุดููุงุช ุ ูุชู ุชุจุณูุท ุขููุฉ ุงูุงุชูุงููุฉ ุงูุฑุฆูุณูุฉ ุ ูุฃุตุจุญุช ุงูุงูุชุฏุงุฏุงุช (NAT-T ุ Keepalives ุ Mode Mode) ุฌุฒุกูุง ูู ุงูุจุฑูุชูููู. </li></ul><br><p style=";text-align:right;direction:rtl">  ูู ุงูููุงุฑุณุฉ ุงูุนูููุฉ ุ ูุชู ุชูููุฐ ูุนุธู ุงุชุตุงูุงุช IPSec ุจุงุณุชุฎุฏุงู IKE ุจุณุจุจ ุงููุนุฏุงุช ุงููุฏููุฉ ุฃู ุฅุญุฌุงู ุงููุณุคูููู ุนู ุชุบููุฑ ุดูุก ูุง. </p><br><p style=";text-align:right;direction:rtl">  <strong>ุจุฑูุชููููุงุช ุญูุงูุฉ ุงูุจูุงูุงุช (ESP ุ AH)</strong> <br>  ุงููููุฉ ุงูุฑุฆูุณูุฉ ูู ุญูุงูุฉ ุจูุงูุงุช ุงููุณุชุฎุฏู. </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ESP (Encapsulating Security Payload) - ุชุดููุฑ ุงูุจูุงูุงุช ุงููุฑุณูุฉ ูุงููุตุงุฏูุฉ ุนูููุง ุฌุฒุฆููุง </li><li style=";text-align:right;direction:rtl">  AH (ุฑุฃุณ ุงููุตุงุฏูุฉ) - ูุตุงุฏู ุงูุญุฒูุฉ ุจุฃููููุง (ุจุงุณุชุซูุงุก ุงูุญููู ุงููุงุจูุฉ ููุชุบููุฑ) ุ ููุง ูููู ุจุชุดููุฑ ุงูุจูุงูุงุช ุ ูููู ูุณูุญ ูู ุจุงูุชุฃูุฏ ูู ุฃู ุงูุญุฒูุฉ ูู ุชุชุบูุฑ ุฃุซูุงุก ุงูุฅุฑุณุงู ุนุจุฑ ุงูุดุจูุฉ </li></ul><br><h3 id="poryadok-ustanovki-ipsec-soedineniya" style=";text-align:right;direction:rtl">  ุฅุฌุฑุงุก ุชุซุจูุช ุงุชุตุงู IPSec </h3><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/lu/rv/ps/lurvpsvrdub2tcgkmpx8ut5ep58.png"></p><br><p style=";text-align:right;direction:rtl">  ุนุงุฏุฉ ูุง ูุทูู ุนูู ุงููุดุงุฑููู ูู ุงุชุตุงู IPSec ุงูุฃูุฑุงู ุ ููุง ูุดูุฑ ุฅูู ุชูุงูุคูู ูู ุงูุงุชุตุงู ุงูุซุงุจุช.  ูู ุงููููู ุชูููู ุฃูุฑุจ ุฅูู ุฎุงุฏู ุงูุนููู ุ ูููู ุนูุฏ ุฅูุดุงุก ุฃููุงู IPSec ุฏุงุฆูุฉ ุ ูููู ูุฃู ูู ุฃูุฑุงูู ุฃู ูููู ููููุฆูุง. </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุฃุญุฏ ุฃูุฑุงูู ูุจุฏุฃ ุงุชุตุงู IPSec </li><li style=";text-align:right;direction:rtl">  ููุงู ุชุจุงุฏู ุงููุนูููุงุช ุงูุฃุณุงุณูุฉ ุ ูุตุงุฏูุฉ ุงูุฃูุฑุงู ุ ูุชูุณูู ูุนููุงุช ุงูุงุชุตุงู </li><li style=";text-align:right;direction:rtl">  ุจูุงุกู ุนูู ุงููุนูููุงุช ุงูุฃุณุงุณูุฉ ุงููุณุชููุฉ ุ ูุชู ุชูููู ููู ูุดูุฑ ุฅุถุงูู </li><li style=";text-align:right;direction:rtl">  ุจุงุณุชุฎุฏุงู ููู ูุดูุฑ ุ ูุญุฏุฏ ุงูุฃูุฑุงู ูุนููุงุช ุชุดููุฑ ุงูุจูุงูุงุช ูุชุจุงุฏู ุงููุนูููุงุช ูุฅูุดุงุก ุงูููุงุชูุญ </li><li style=";text-align:right;direction:rtl">  ูุชูุฌุฉ ุงููุฑุญูุฉ ุงูุณุงุจูุฉ ูู ูุฌููุนุฉ ูู ุงูููุงุนุฏ ูุงูููุงุชูุญ ูุญูุงูุฉ ุงูุจูุงูุงุช (SA) </li><li style=";text-align:right;direction:rtl">  ูููู ุฃูุฑุงููู ุจุดูู ุฏูุฑู ุจุชุญุฏูุซ ููุงุชูุญ ุงูุชุดููุฑ </li></ol><br><p style=";text-align:right;direction:rtl">  ูุงุญุฏุฉ ูู ุงูููุงููู ุงูุฃุณุงุณูุฉ ูู IPSec ูู SA (Security Association) - ูุฌููุนุฉ ูู ุฎูุงุฑุฒููุงุช ุงูุชุดููุฑ ูุชุดููุฑ ุงููุนูููุงุช ูุชุฌุฒุฆุฉูุง ุ ููุฐูู ููุงุชูุญ ุงูุชุดููุฑ ุ ุงููุชูู ุนูููุง ูู ูุจู ุงูุฒููุงุก. </p><br><p style=";text-align:right;direction:rtl">  ูู ุจุนุถ ุงูุฃุญูุงู ููููู ุงูุนุซูุฑ ุนูู ูุณู ุฅูู: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ISAKMP SA - ุงููุนููุงุช ูุงูููุงุชูุญ ุงููุชุนููุฉ ุจุงูููู ุงูุฅุถุงูู </li><li style=";text-align:right;direction:rtl">  Data SA (ุฃู ุจุจุณุงุทุฉ SA) - ุงููุนููุงุช ูุงูููุงุชูุญ ุงููุชุนููุฉ ุจุชุดููุฑ ุญุฑูุฉ ุงููุฑูุฑ </li></ul><br><h3 id="poryadok-raboty-protokolov-soglasovaniya-klyuchey" style=";text-align:right;direction:rtl">  ุจุฑูุชููููุงุช ุงูุงุชูุงู ุงูุฑุฆูุณูุฉ </h3><br><p style=";text-align:right;direction:rtl">  ูููู ุฃู ูุนูู ุจุฑูุชูููู IKE ูู ูุถุนูู: ุฑุฆูุณู (ุฑุฆูุณู) ูุนุฏูุงูู (ุนุฏูุงูู) ุ ูุญุชูู ุจุฑูุชูููู IKEv2 ุนูู ูุถุน ูุงุญุฏ. </p><br><h4 id="ike-main" style=";text-align:right;direction:rtl">  ุงูู ุงูุฑุฆูุณูุฉ </h4><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/zw/jb/yv/zwjbyvrpmup5t7nfgaol329rudi.png"></p><br><p style=";text-align:right;direction:rtl">  ุชุชููู ุงููุฑุญูุฉ ุงูุฃููู ูู ุณุช ูุฌููุนุงุช: <br>  1-2: ูุญุงุฐุงุฉ ุฅุนุฏุงุฏุงุช ุชุดููุฑ ุงูููู ุงูุซุงููู ูุฎูุงุฑุงุช IPSec ุงููุฎุชููุฉ <br>  3-4: ูุดุงุฑูุฉ ุงููุนูููุงุช ูุฅูุดุงุก ููุชุงุญ ุณุฑู <br>  5-6: ูุตุงุฏูุฉ ุงูุฃูุฑุงู ุจุงุณุชุฎุฏุงู ููุงุฉ ูุดูุฑุฉ ูุณุงุนุฏุฉ </p><br><p style=";text-align:right;direction:rtl">  ุชุชููู ุงููุฑุญูุฉ ุงูุซุงููุฉ ูู ุซูุงุซ ูุฌููุนุงุช: <br>  1-3: ุงุณุชุฎุฏุงู ููุงุฉ ูุณุงุนุฏุฉ ูุดูุฑุฉ.  ุชูุณูู ุงููุนููุงุช ุญูุงูุฉ ุญุฑูุฉ ุงููุฑูุฑ ุ ูุชุจุงุฏู ุงููุนูููุงุช ูุฅูุดุงุก ููุชุงุญ ุณุฑู </p><br><h3 id="ike-aggressive" style=";text-align:right;direction:rtl">  ุงูู ุงูุนุฏูุงููุฉ </h3><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/xu/wz/qu/xuwzqu4qle5lxlcvb-hnvuhqehg.png"></p><br><p style=";text-align:right;direction:rtl">  ุชุชููู ุงููุฑุญูุฉ ุงูุฃููู ูู ุซูุงุซ ูุฌููุนุงุช: <br>  1: ุชูุฏูู ุนุฑุถ ูุชุซุจูุช ููุงุฉ ูุดูุฑุฉ ูุณุงุนุฏุฉ ููุนูููุงุช ูุฅูุดุงุก ููุชุงุญ ุฎุงุต <br>  2: ุงูุฑุฏ ุนูู ุงูุนุฑุถ ุ ูุนูููุงุช ูุฅูุดุงุก ุงูููุชุงุญ ุงูุณุฑู ุ ุจูุงูุงุช ุงููุตุงุฏูุฉ <br>  3: ุจูุงูุงุช ุงููุตุงุฏูุฉ </p><br><p style=";text-align:right;direction:rtl">  ุชุชููู ุงููุฑุญูุฉ ุงูุซุงููุฉ ูู ุซูุงุซ ูุฌููุนุงุช: <br>  1-3: ุงุณุชุฎุฏุงู ููุงุฉ ูุณุงุนุฏุฉ ูุดูุฑุฉ.  ุชูุณูู ุงููุนููุงุช ุญูุงูุฉ ุญุฑูุฉ ุงููุฑูุฑ ุ ูุชุจุงุฏู ุงููุนูููุงุช ูุฅูุดุงุก ููุชุงุญ ุณุฑู </p><br><p style=";text-align:right;direction:rtl">  ูู ุงููุถุน ุงูุนุฏูุงูู ุ ูุฑุณู ุงูุจุงุฏุฆ ูุฌููุนุฉ ูุงุญุฏุฉ ููุท ูู ุงููุนููุงุช ูู ุงูุฌููุฉ.  ูุญุฏุซ ุชุจุงุฏู ุงููุนูููุงุช ููุตุงุฏูุฉ ุงูุฃูุฑุงู ูุจู ุชุซุจูุช ููู ุฅุถุงูู ุขูู.  ุงููุถุน ุงูุนุฏูุงูู ุซุงุจุช ุจุดูู ุฃุณุฑุน ุ ููููู ุฃูู ุฃูุงููุง. </p><br><h3 id="ikev2" style=";text-align:right;direction:rtl">  IKEv2 </h3><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/ev/mq/ni/evmqnimq5_sdeybuz63x3ddssbu.png"></p><br><p style=";text-align:right;direction:rtl">  ูู IKEv2 ุ ุชุชู ุชุณููุฉ ุงููุฑุงุญู: IKE_SA_INIT ู IKE_AUTH.  <em>ูููู ุฅุฐุง ููุช ุฃุชุญุฏุซ ุนู ุงููุฑุญูุฉ ุงูุฃููู ูุงููุฑุญูุฉ ุงูุซุงููุฉ ูุงุญููุง ูู ุงููุต ุ ูุฅู ูุฐุง ููุทุจู ุฃูุถูุง ุนูู ูุฑุงุญู IKEv2.</em> </p><br><p style=";text-align:right;direction:rtl">  ุชุชููู ูู ูุฑุญูุฉ ูู ูุฑุงุญู IKEv2 ูู ุนุจูุชูู: <br>  IKE_SA_INIT: ุชูุณูู ูุนููุงุช ุชุดููุฑ ุงูููู ุงูุฅุถุงููุฉ ุ ูุชุจุงุฏู ุงููุนูููุงุช ูุฅูุดุงุก ููุชุงุญ ุฎุงุต </p><br><p style=";text-align:right;direction:rtl">  IKE_AUTH: ุงุณุชุฎุฏุงู ุงูููุงุฉ ุงููุณุงุนุฏุฉ ุงููุดูุฑุฉ.  ูุตุงุฏูุฉ ุงูุฃูุฑุงู ุ ูุชูุณูู ูุนููุงุช ุงูุญูุงูุฉ ุงููุฑูุฑูุฉ ุ ูุชุจุงุฏู ุงููุนูููุงุช ูุฅูุดุงุก ููุชุงุญ ุณุฑู </p><br><h3 id="security-assotiations-database-sad" style=";text-align:right;direction:rtl">  ูุงุนุฏุฉ ุจูุงูุงุช ุงูุฃูุงู (SAD) </h3><br><p style=";text-align:right;direction:rtl">  ูุชูุฌุฉ IKE (ู IKEv2) ูู Assotiations ุงูุฃูุงู (SA) ุ ุงูุชู ุชุญุฏุฏ ุฅุนุฏุงุฏุงุช ุงูุญูุงูุฉ ุงููุฑูุฑูุฉ ูููุงุชูุญ ุงูุชุดููุฑ.  ูู SA ุฃุญุงุฏู ุงูุงุชุฌุงู ููุญุชูู ุงุชุตุงู IPSec ุนูู ุฒูุฌ ูู SAs.  ูุชู ุชุฎุฒูู ุฌููุน SAs ูู ูุงุนุฏุฉ ุจูุงูุงุช SAD ููููู ุงููุตูู ุฅูููุง ูู ูุจู ุงููุณุคูู ููุนุฑุถ ูุฅุนุงุฏุฉ ุชุนููู. </p><br><h3 id="inkapsulyaciya-dannyh" style=";text-align:right;direction:rtl">  ุชุบููู ุงูุจูุงูุงุช </h3><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/3z/3k/aa/3z3kaaj2rwmnx59apvueigp3lno.png"></p><br><p style=";text-align:right;direction:rtl">  ูููุฑ IPSec ุฎูุงุฑูู ูุชุบููู ุงูุจูุงูุงุช: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูุถุน ุงูููู - ููุท ุญูููุฉ ุงูุฑุฒูุฉ ูุญููุฉ ุ ุชุงุฑููุง ุงูุฑุฃุณ ุงูุฃุตูู.  ูุจูุงุก ุงูุฃููุงู ุ ูุชู ุงุณุชุฎุฏุงู ูุถุน ุงูููู ุนุงุฏุฉู ุจุงูุชุฒุงูู ูุน ipip ุฃู gre ุ ุงูุฐู ูุญุชูู ุญูููุชู ุจุงููุนู ุนูู ุงูุญุฒูุฉ ุงููุตุฏุฑ ุจุงููุงูู. </li><li style=";text-align:right;direction:rtl">  ูุถุน ุงูููู - ูุชู ุชุบููู ุงูุญุฒูุฉ ุงูุฃุตููุฉ ุจุงููุงูู ูู ุญุฒูุฉ ุฌุฏูุฏุฉ (ุนูู ุบุฑุงุฑ gre ุฃู ipip).  ูููู ุจุงููุณุจุฉ ููููู ipsec ุ ูุง ูุชู ุฅูุดุงุก ูุงุฌูุฉ ุตุฑูุญุฉ ูู ุงููุธุงู ุ ููุฏ ุชููู ูุฐู ูุดููุฉ ุฅุฐุง ุชู ุงุณุชุฎุฏุงู ุชูุฌูู ุซุงุจุช ุฏููุงูููู ุฃู ูุนูุฏ. </li></ul><br><h3 id="security-policy-database-spd" style=";text-align:right;direction:rtl">  ูุงุนุฏุฉ ุจูุงูุงุช ุณูุงุณุฉ ุงูุฃูุงู (SPD) </h3><br><p style=";text-align:right;direction:rtl">  ูุงุนุฏุฉ ุจูุงูุงุช ูู ุงูููุงุนุฏ ุงูุชู ุชุญุฏุฏ ุญุฑูุฉ ุงููุฑูุฑ ุงูุชู ูุฌุจ ุชุดููุฑูุง ุ ูุจุฑูุชูููู ุญูุงูุฉ ุงูุจูุงูุงุช ุ ูููุน ุงูุชุบููู ูุนุฏุฏ ูู ุงููุนููุงุช ุงูุฃุฎุฑู. <br>  ูููู ุนุฑุถ ููุถุน ูุญุต SPD ุนูู ูุฎุทุท ุชุฏูู ุงูุญุฒูุฉ. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/nh/jo/rm/nhjorm-je866yymx0_cxwdnyop8.png"></p><br><h3 id="preodolenie-nat" style=";text-align:right;direction:rtl">  ุณุฏ NAT </h3><br><p style=";text-align:right;direction:rtl">  ูุณุชุฎุฏู IPSec ุจุฑูุชููููุงุช ุทุจูุฉ ุงูุดุจูุฉ ูููู ุงูุจูุงูุงุช ุงูุชู ูุง ูููู ูู NAT ูุนุงูุฌุชูุง.  ูุญู ุงููุดููุฉ ุ ูุชู ุงุณุชุฎุฏุงู ุจุฑูุชูููู NAT-T (ุงูุชุฏุงุฏ ูู IKE ูุฌุฒุก ูู IKEv2).  ุฌููุฑ NAT-T ูู ูู ุชุบููู ุฅุถุงูู ูู ุญุฒู IPSec ูู ุญุฒู UDP ุงูุชู ูุนุงูุฌูุง NAT. </p><br><h3 id="ipsec-v-mikrotik" style=";text-align:right;direction:rtl">  IPSec ูู Mikrotik </h3><br><p style=";text-align:right;direction:rtl">  ูุชููุฑ IPSec ูุฌุงููุง ุนูู ุฃู ุฌูุงุฒ ูููู ุจุชุดุบูู RouterOS ูุน ุชุซุจูุช ุญุฒูุฉ ุงูุฃูุงู. </p><br><h3 id="apparatnoe-shifrovanie" style=";text-align:right;direction:rtl">  ุชุดููุฑ ุงูุฃุฌูุฒุฉ </h3><br><p style=";text-align:right;direction:rtl">  ูุฅูุบุงุก ุชุญููู ูุญุฏุฉ ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉ ุ ุชุชู ุฅุถุงูุฉ ุชุณุฑูุน ุชุดููุฑ ุงูุฃุฌูุฒุฉ ุฅูู ุจุนุถ ุทุฑุงุฒุงุช ุฃุฌูุฒุฉ ุชูุฌูู MikroTik ุ ูููู ุงูุนุซูุฑ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุนูู</a> ูุงุฆูุฉ ูุงููุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุนูู ุงููููู</a> . <br>  ุฃูุซุฑ ุฎูุงุฑุงุช ุงูููุฒุงููุฉ: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">RB750Gr3</a> ุ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">RB3011</a> ุ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">HAP AC ^ 2</a> . </p><br><p style=";text-align:right;direction:rtl">  ููุญุฏู ุฑุงุฌุนุช ุณุฑุนุฉ IPSec ุจูู RB1100AHx2 ูุงุซููู RB750Gr3. </p><br><p style=";text-align:right;direction:rtl">  ูุชุญููู ุฃูุตู ูุฏุฑ ูู ุงููุชุงุฆุฌ ุนูู RB1100AHx2 ุ ูุฌุจ ุนููู: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุงุณุชุฎุฏู ุงููููุฐ 11 ุงููุชุตู ูุจุงุดุฑุฉ ุจูุญุฏุฉ ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉ ููู ุจุชูููู ูุญุฏุฉ ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉ ุงูุฃุณุงุณูุฉ ูุงุญุฏุฉ ููุนุงูุฌุฉ ุญุฑูุฉ ูุฑูุฑ 11 ูููุฐูุง </li><li style=";text-align:right;direction:rtl">  ุงุณุชุฎุฏู ููุงุฆู ุงูุชุธุงุฑ ุงูุฃุฌูุฒุฉ ููุท ุนูู ุงููุงุฌูุงุช ุ ููู ุจุชุนุทูู RPS </li><li style=";text-align:right;direction:rtl">  ุชูููู Layer3 FastPath (ุญูุงูู 800 ููุฌุงุจุงูุช / ุซุงููุฉ) ุ ุฃู ุงุณุชุจุนุงุฏ ุญุฑูุฉ ูุฑูุฑ IPSec ูู ูููุชุฑุงู (ุญูุงูู 700 ููุฌุงุจุงูุช / ุซุงููุฉ) <br>  ุจุฏูู ุนูููุงุช ุงููุนุงูุฌุฉ ุงูููุตููุฉ ุนูู ุงููููุฐ ุงูุฃุจุทุฃ (ether13) ุ ูู ุงููููู ุงูุญุตูู ุนูู ~ 170 ููุฌุง ุจุงูุช / ุซุงููุฉ ุ ุนูู ูุญู 400 ููุฌุงุจุงูุช / ุซุงููุฉ ูู ุงููุนุชุงุฏ. </li></ul><br><p style=";text-align:right;direction:rtl">  ุนูู RB750Gr3 ุฏูู ุชุญุณููุงุช ุญูู 200MB / ุซุงููุฉ. </p><br><p style=";text-align:right;direction:rtl">  ุชุธูุฑ ุฃุฌูุฒุฉ ุงูุชูุฌูู ุฃุญุงุฏูุฉ ุงูููุงุฉ ูู ููุงูููู ูุชูุฌุฉ ุชุชุฑุงูุญ ุจูู 10 ู 40 ููุฌุงุจุงูุช ูู ุงูุซุงููุฉ ุจูุงุกู ุนูู ุทุฑุงุฒ ุนูููุงุช ุงูุชุญุณูู ุงูุฃุฎุฑู ูุนุจุก ุงูุนูู ุนูููุง. </p><br><p style=";text-align:right;direction:rtl">  ุฃูุตู ุจุฃู ุชุชุนุฑู ุนูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูุนุฑุถ ุงูุชูุฏููู</a> ูู ุฃุญุฏ ููุธูู mikrotik ุ ููุฏ ุชุทุฑููุง ุฅูู ููุงุถูุน ุชุญุณูู ุงูุฅุนุฏุงุฏุงุช ูุชูููู ุงูุญูู ุนูู ูุญุฏุฉ ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉ ูุฒูุงุฏุฉ ุงูุณุฑุนุฉ ุ ูุงูุชู ูู ุฃูู ุจุฅุถุงูุชูุง ุฅูู ุงููุต. </p><br><h3 id="razlichiya-642x-i-643x" style=";text-align:right;direction:rtl">  ุงูุงุฎุชูุงูุงุช 6.42.X ู 6.43.X </h3><br><p style=";text-align:right;direction:rtl">  ุจูุงุกู ุนูู ุฅุตุฏุงุฑ RouterOS ุงูุฐู ุชุณุชุฎุฏูู ุ ุณุชุฎุชูู ูุงุฆูุฉ ุชูููู IPSec. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/6q/pz/5c/6qpz5cgthate04bihl8gq2zr9t8.png"></p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/ng/ug/hi/ngughirhx6nwd1v8mjaa9omfb7g.png"></p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/kv/ow/3-/kvow3-bmivzfr_tf6bqnywr5wu8.png"></p><br><p style=";text-align:right;direction:rtl">  ููุงู ุจุงููุนู ุชุบููุฑุงุช ุฌุฏูุฏุฉ ูู ุฅุตุฏุงุฑ ุงูุงุฎุชุจุงุฑ ุ ูุฐูู ุงูุฑุฃ ููุงุญุธุงุช ุงูุฅุตุฏุงุฑ ูุจู ุงูุชุฑููุฉ. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/ri/rd/gu/rirdgucrebbf1ucxjqbj65gzf-s.png"></p><br><h3 id="konfiguraciya-ipsec" style=";text-align:right;direction:rtl">  ุชูููู IPsec </h3><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/r6/lf/j5/r6lfj5hlclkbx9qmph0owsqf_ak.png"><br>  ูุงุฆูุฉ [IP] -&gt; [IPSec] ููุณุช ูุฎููุฉ ููุง ุชุจุฏู ูููููุฉ ุงูุฃููู.  ููุถุญ ุงูุฑุณู ุงูุชุฎุทูุทู ุฃู ุนูุงุตุฑ ุงูุชูููู ุงูุฑุฆูุณูุฉ ูู: ุงูุฃูุฑุงู ูุงููููุงุช ุงูุดุฎุตูุฉ. <br>  ุนูุงูุชุง ุงูุชุจููุจ ูุธุฑุงุก ุนู ุจุนุฏ ู SA ุงููุซุจุชุฉ ูู ูุนูููุงุช. </p><br><h4 id="peers-i-peers-profiles" style=";text-align:right;direction:rtl">  ุงูุฃูุฑุงู ูุงูุฃูุฑุงู </h4><br><p style=";text-align:right;direction:rtl">  ุชูููู ูุธูุฑ IPSec ูุชุฃุณูุณ ุงุชุตุงู IKE ูุฅูุดุงุก ููู ุขูู ุฅุถุงูู. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/e2/kj/e1/e2kje1zwzhubqsyriypavj3bmfm.png" alt="ุงูุตูุฑุฉ"></p><br><p style=";text-align:right;direction:rtl">  <strong>ุชูููู ูุธูุฑุงุช IPSec ุนู ุจุนุฏ</strong> </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/pq/9d/cv/pq9dcvyqrf64pdklohgf1eapoze.png"></p><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ููุงุญุธุงุช</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุจุฏุกูุง ูู 6.43 ุ ุฃูุณู RouterOS ุนูุฏ ุงุณุชุฎุฏุงู PSK ุฏูู ูุตุงุฏูุฉ ุฅุถุงููุฉ.  ุฅุฐุง ููุช ูุง ุชุฑุบุจ ูู ุชูููู ููุงุชูุญ ุฃู ุดูุงุฏุงุช ุฃู xAuth ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ููููู ุงูุชุจุฏูู ุฅูู IKEv2 ุฃู ุชุฌุงูู ุงูุชุญุฐูุฑ. </li><li style=";text-align:right;direction:rtl">  ูุฃูุฑุงู ุ ููููู ุชุญุฏูุฏ ุนูุงููู IP ุฃู ุดุจูุงุช ูุฑุนูุฉ ูุญุฏุฏุฉ (ุฐุงุช ุตูุฉ ุจู Client-Server VPN) </li><li style=";text-align:right;direction:rtl">  ุฅุฐุง ูุงูุช ููุงู ููุงุนุฏ ูุชุนุงุฑุถุฉ ุ ูุณูุชู ุงุณุชุฎุฏุงู ูุงุนุฏุฉ ุจูุง ุดุจูุฉ ูุฑุนูุฉ ุฃูุซุฑ ุฏูุฉ ููุงุชุตุงู ุจุงููุธูุฑ (ุนูู ุบุฑุงุฑ ุงูุทุฑู) </li><li style=";text-align:right;direction:rtl">  ูุตุงุฏูุฉ ุงูููุชุงุญ XAuth ู rsa ูุง ุชุนูู ูู IKEv2 </li><li style=";text-align:right;direction:rtl">  ุจุงููุณุจุฉ ูู IKEv2 ุ ุฌุนู Mikrotik ุชูููุฐูุง ูู xAuth ุบูุฑ ูุชูุงูู ูุน ุงูุฃูุธูุฉ ุงูุฃุณุงุณูุฉ ุงูุฃุฎุฑู </li><li style=";text-align:right;direction:rtl">  ุนุงุฏุฉู ูุง ูุณุชุฎุฏู ุงููุถุน ุงูุณูุจู ูุฅูุดุงุก VPN Client-Server (ุชููุฆุฉ ูุถุน L2TP / IPsec ุฃู IKEv2) ุ ูููู ูููู ุฃู ูููู ูููุฏูุง ุนูุฏ ุชูุตูู ุนุฏุฏ ูุจูุฑ ูู ุฃููุงู ุงููููุน ุฅูู ููุทุฉ ูุงุญุฏุฉ ุ ูุชูููู ุญุฑูุฉ ุงููุฑูุฑ ุงูุฒุงุฆูุฉ. </li><li style=";text-align:right;direction:rtl">  ุฅุฐุง ููุช ุชุฎุทุท ูุงุณุชุฎุฏุงู xAuth ุ ููุฌุจ ุฃู ูููู "ุงูุฎุงุฏู" ุฎุงูููุง.  ูุชู ุฅูุดุงุก ูุณุชุฎุฏูู ุงูุฎุงุฏู ูู [IPSec] -&gt; [ุงููุณุชุฎุฏููู] </li><li style=";text-align:right;direction:rtl">  ุนูุฏ ุงุณุชุฎุฏุงู "ุฅูุดุงุก ุณูุงุณุฉ" ุ ุญุฏุฏ ูุถุน ุชูููุฏ ุงููููุฐ </li></ul></div></div><br><p style=";text-align:right;direction:rtl">  <strong>ุฅุนุฏุงุฏ ูููุงุช ุงูุชุนุฑูู (ููุชุฑุญุงุช) ููุชูุณูู ุงููุฑุญูุฉ 1</strong> </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/w8/s9/vj/w8s9vjxiguir63a_hfpci1ih1bi.png" alt="ุงูุตูุฑุฉ"></p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/_v/x3/ff/_vx3ff1ogwsxjggebdjqazfqhve.png"></p><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ููุงุญุธุงุช</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุชุตุจุญ ุงูุฎูุงุฑุงุช ุงูุฅุถุงููุฉ ูู IKE ุฌุฒุกูุง ูู IKEv2 ุ ูุชู ุชุฌุงูู ุงูุฅุนุฏุงุฏุงุช </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงุฑุชุจุงุท ูุฌููุนุงุช DH ุจุฃุฑูุงููุง</a> (ูุชู ุงุณุชุฎุฏุงู ุฃุฑูุงู ุงููุฌููุนุฉ ูู ูุจู ุงูุจุงุฆุนูู ุงูุขุฎุฑูู) </li><li style=";text-align:right;direction:rtl">  ุนูุฏ ุฅุฑุณุงู ุงูุงูุชุฑุงุญุงุช ุ ูููู ุงููุธุงู ุจูุฑุฒ ุฎูุงุฑุฒููุฉ ุฃุฒูุงุฌ + ูุฌููุนุฉ dh ูู ุฃูุซุฑ ุซุจุงุชูุง ุฅูู ุฃูู ุซุจุงุชูุง <br><img src="https://habrastorage.org/webt/7i/h8/fj/7ih8fjegurxodmq-daxuwxfhpii.png"></li></ul></div></div><br><h4 id="policies-i-policy-proposals" style=";text-align:right;direction:rtl">  ุงูุณูุงุณุงุช ูููุชุฑุญุงุช ุงูุณูุงุณุฉ </h4><br><p style=";text-align:right;direction:rtl">  ูููู ุงูุณูุงุณููู ุจูุญุต ุงูุญุฒู ุงููุงุฑุฉ ููุชุฃูุฏ ูู ูุทุงุจูุชูุง ููุดุฑูุท ูุชุทุจูู ุงูุฅุฌุฑุงุกุงุช ุงููุญุฏุฏุฉ.  ุฅุฐุง ุนุฏุช ุฅูู ุชุฏูู ุงูุญุฒู ุ ูุฅู ุงููุชู ูุน ุณูุงุณุฉ IPSec ูู ุงูุชุณููุฉ ูุน ุงูุณูุงุณุงุช.  ุชุญุฏุฏ ุงูุฅุฌุฑุงุกุงุช: ุจุฑูุชูููู ุฃูุงู IPSec (ESP ุฃู AH) ูููุชุฑุญุงุช ููุชูุงูุถ SA ููุถุน ุงูุชุบููู. <br><img src="https://habrastorage.org/webt/tp/bk/1n/tpbk1nrkowlvaqdnrfvgpvbaxg0.png" alt="ุงูุตูุฑุฉ"></p><br><p style=";text-align:right;direction:rtl">  ุชูุฑุฑ ุงูุญุฒูุฉ ุงูุณูุงุณุฉ ูุงุญุฏุฉ ุชูู ุงูุฃุฎุฑู ุญุชู ุชุชูุงูู ูุน ุดุฑูุท ุฃุญุฏูุง. </p><br><p style=";text-align:right;direction:rtl">  <strong>ุฅุนุฏุงุฏ ุงูุณูุงุณุฉ</strong> <br><img src="https://habrastorage.org/webt/yw/cp/nj/ywcpnjdyjonrxpnfel79irfov4g.png"></p><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุงูุดุฑูุญ</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุนุงุฏุฉ ูุง ููุฒู Src ูุนูู.  ู DST.  ูููุฐ ุ ูููู ุจุดูู ุนุงู ุ ุงููุฏุฑุฉ ุนูู ุชุดููุฑ ุญุฑูุฉ ุงููุฑูุฑ ูู ุชุทุจูู ุงููุฑุฏูุฉ ูุซูุฑุฉ ููุงูุชูุงู </li><li style=";text-align:right;direction:rtl">  ูุง ูุชู ุชูุฏูู ุฌููุน ุจุฑูุชููููุงุช ip ูู ูุงุฆูุฉ ุงูุจุฑูุชููููุงุช (ุนูู ุณุจูู ุงููุซุงู ุ ูุง ููุฌุฏ gre) ุ ููููู ุชุญุฏูุฏ ุนุฏุฏ ุงูุจุฑูุชูููู ุงููุทููุจ ูุฏูููุง. </li><li style=";text-align:right;direction:rtl">  ุงูููุงูุจ ููุณุช ุณุงุณุฉ!  ูุชู ุงุณุชุฎุฏุงููุง ุฅุฐุง ุชู ุชุนููู ุณูุงุณุฉ ุงูุชูููุฏ ูู ุชูููู ุงููุธูุฑ. </li><li style=";text-align:right;direction:rtl">  ูุงุฐุง ุชูุนู ุฅุฐุง ูู ูุชู ุงูุนุซูุฑ ุนูู ุถูุงูุงุช ูุนููุฉ ููุณูุงุณุฉ.  ูู ุงูุณุงุจู ุ ูุงูุช ููุงู ูุดููุฉ ูู L2TP / IPSec ุนูุฏูุง ุชุนุฐุฑ ุนูู ุงูุนุฏูุฏ ูู ุงูุนููุงุก ุงูุงุชุตุงู ุจุณุจุจ ููุณ NAT (ุนูุฏ ุงุณุชุฎุฏุงู IKE) ุ ูุชู ุญู ูุฐุง ุงูุฎุทุฃ (ุนูู ุงูุชุฑุงุถ ุฃู ูุคูุงุก ุงูุนููุงุก ููุณูุง ููุงูุฐ) ุฅุฐุง ููุช ุจุชุนููู ูุณุชูู = ูุฑูุฏ.  ุฎูุงู ุฐูู ุ ูู ุจุงูุชุจุฏูู ุฅูู IKEv2 </li><li style=";text-align:right;direction:rtl">  ุนูุฏ ุฅุนุฏุงุฏ ุงูุณูุงุณุงุช ุ ุงุณุชุฎุฏู [ุงููุถุน ุงูุขูู] ุ ุฎุทูุฉ ูุงุญุฏุฉ ูุญุฑุฌุฉ ูุชุฎุงุทุฑ ุจููุฏุงู ุงููุตูู ุฅูู ุฌูุงุฒ ุงูุชูุฌูู ุจุงุณุชุฎุฏุงู Level3 </li></ul></div></div><br><p style=";text-align:right;direction:rtl">  <strong>ุฅุนุฏุงุฏ ููุชุฑุญุงุช ููุญุตูู ุนูู ููุงููุฉ SA</strong> <br><img src="https://habrastorage.org/webt/mh/yf/cd/mhyfcd2-2nsxbouuxhgbecj3kyu.png"></p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/0n/xk/tw/0nxktwxmxyu2quyanfw-rco-yqa.png"></p><br><h4 id="groups" style=";text-align:right;direction:rtl">  ูุฌููุนุงุช </h4><br><p style=";text-align:right;direction:rtl">  ุชุณุชุฎุฏู ูุฑุจุท ููุงูุจ ุงูุณูุงุณุฉ ูุงูุฃูุฑุงู. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/do/r7/gc/dor7gc6s4zuwlo2mmz5irrc3alm.png" alt="ุงูุตูุฑุฉ"></p><br><p style=";text-align:right;direction:rtl">  ูู ุฃุญุฏ ุงูุฅุตุฏุงุฑุงุช ุงููุฏููุฉ ูู RouterOS ุ ูุงู ููุงู ุฎุทุฃ ูู ุงููุฌููุนุฉ ุงูุงูุชุฑุงุถูุฉ ุบูุฑ ุงูุนุงููุฉ. </p><br><h4 id="mode-config" style=";text-align:right;direction:rtl">  ุงูุชูููู ุงููุถุน </h4><br><p style=";text-align:right;direction:rtl">  ุฅุฑุณุงู ูุงุณุชูุจุงู ูุนููุงุช IP ุฏูู ุงุณุชุฎุฏุงู ุจุฑูุชููููุงุช ุฅุถุงููุฉ.  ูุณูุญ ูู ุจุฅูุดุงุก VPN ุนููู ูุณุชูู ุฅูู IPSec ููุท. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/sr/s2/dl/srs2dl4tcpixxiwi2mrletlguva.png"></p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/os/r2/gg/osr2ggrnm_0-vqtoukxb5hnzfjs.png"></p><br><h4 id="keys-i-users" style=";text-align:right;direction:rtl">  ุงูููุงุชูุญ ูุงููุณุชุฎุฏููู </h4><br><p style=";text-align:right;direction:rtl">  ุชุณุชุฎุฏู ููุตุงุฏูุฉ ุงูุฃูุฑุงู ุงููุชูุฏูุฉ. <br>  <strong>ููุงุชูุญ</strong> <br>  ููุงุชูุญ RSA: ุงูุชูููุฏ ุ ุงูุงุณุชูุฑุงุฏ ุ ุงูุชุตุฏูุฑ.  ุบูุฑ ูุฏุนูู ูู IKEv2. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/ec/7z/j4/ec7zj4doiqkdgwe4soh7lrk21f8.png"></p><br><p style=";text-align:right;direction:rtl">  <strong>ุงููุณุชุฎุฏููู</strong> <br>  ูุงุนุฏุฉ ุจูุงูุงุช ูุณุชุฎุฏู XAuth ูู "ุงูุฎุงุฏู".  ูุญุฏุฏ ุงูุนููู ุฅุนุฏุงุฏุงุช xAuth ูู ุชูููู ุงููุธูุฑ.  ูู ุงููููู ุฅุนุงุฏุฉ ุชูุฌูู ูุตุงุฏูุฉ xAuth ุฅูู ุฎุงุฏู RADIUS. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/pi/wl/vq/piwlvq80v1cnndmhyjg91jzrqle.png"></p><br><h4 id="remote-peers" style=";text-align:right;direction:rtl">  ุฃูุฑุงููู ุนู ุจุนุฏ </h4><br><p style=";text-align:right;direction:rtl">  ูุงุฆูุฉ ุจุฌููุน ุงูุฃูุฑุงู ุงูุฐูู ูููููู ุจุชุซุจูุช ูุชุซุจูุช ููู ุฅุถุงูู (ุงููุฑุญูุฉ 1).  ููููู ุฅุฒุงูุฉ ุฃูุฑุงููู ูุชุญุฏูุซ ููุงุชูุญ ุงูููู ุงูุฅุถุงูู. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/j2/-g/ct/j2-gct_8wrf7bl2zgtzqsswwbgk.png" alt="ุงูุตูุฑุฉ"></p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/2k/37/3m/2k373mg8qxox4y-ruph-jza_d0m.png" alt="ุงูุตูุฑุฉ"></p><br><h4 id="installed-sas" style=";text-align:right;direction:rtl">  ุณุงุณ ุงููุซุจุชุฉ </h4><br><p style=";text-align:right;direction:rtl">  ูุงุนุฏุฉ ุจูุงูุงุช SAD ุฃู ูุงุฆูุฉ ุจุฌููุน ุงูุฃุฌูุฒุฉ ุงููุณุงุนุฏุฉ ุงููุชูุงูุถ ุนูููุง.  ููููู ุฑุคูุฉ ุฎูุงุฑุฒููุงุช ุญูุงูุฉ ุงูุจูุงูุงุช ุงููุณุชุฎุฏูุฉ ูุงูููุงุชูุญ. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/jw/jb/su/jwjbsuorsms85vw656xfgvcneuc.png" alt="ุงูุตูุฑุฉ"></p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/wd/8x/gr/wd8xgrc-h0ngxcfq77qun4ymuhk.png" alt="ุงูุตูุฑุฉ"></p><br><p style=";text-align:right;direction:rtl">  ุชุดูุฑ ุนูุงูุฉ ุงูุฃุฌูุฒุฉ AEAD ุฅูู ุงุณุชุฎุฏุงู ุชุดููุฑ ุงูุฃุฌูุฒุฉ. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/jz/5-/yv/jz5-yv-xaw_a8gx5zrxz1hlesye.png" alt="ุงูุตูุฑุฉ"></p><br><p style=";text-align:right;direction:rtl">  ูููู ูููุณุคูู ุฅุนุงุฏุฉ ุถุจุท SA ุ ูููู ููุท ูู ููุณ ุงูููุน (esp ุฃู ah) ูู ููุณ ุงูููุช. </p><br><h4 id="ipsec-i-firewall" style=";text-align:right;direction:rtl">  IPSec ูุฌุฏุงุฑ ุงูุญูุงูุฉ </h4><br><p style=";text-align:right;direction:rtl">  ูู ุฌุฏุงุฑ ุงูุญูุงูุฉ ุ ููููู ุงูุชุญูู ููุง ุฅุฐุง ูุงูุช ุญุฑูุฉ ุงููุฑูุฑ ูู ุณูุงุณุฉ IPSec ุงููุงุฑุฏุฉ ุฃู ุงูุตุงุฏุฑุฉ ุฃู ูุง.  ุชุทุจูู ูุงุถุญ ูู L2TP / IPSec ุ ููููู ุญุธุฑ ุชุซุจูุช ุงุชุตุงูุงุช L2TP ุฅุฐุง ูู ูุชู ุชุดููุฑ ุญุฑูุฉ ุงููุฑูุฑ ูุณุจููุง. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/xt/06/sw/xt06swif3vlsv_vjcyywb1lepf0.png"></p><br><p style=";text-align:right;direction:rtl">  <strong>ุงูุจุฑูุชููููุงุช ูุงูููุงูุฐ ุงููุณุชุฎุฏูุฉ ูู IPSec</strong> </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุงูู - UDP: 500 </li><li style=";text-align:right;direction:rtl">  IKEv2 - UDP: 4500 </li><li style=";text-align:right;direction:rtl">  NAT-T - UDP: 4500 </li><li style=";text-align:right;direction:rtl">  ESP - ipsec-esp (50) </li><li style=";text-align:right;direction:rtl">  ุขู - ipsec-ah (51) </li></ul><br><h3 id="ipsec-i-endpoinds" style=";text-align:right;direction:rtl">  IPSec ู Endpoinds </h3><br><p style=";text-align:right;direction:rtl">  ูุงูุขู ุนู ุงููุฑุญุฉ ... <br>  ูุญุชูู wiki mikrotik ุนูู ุฌุฏุงูู ูุน ุฎูุงุฑุฒููุงุช ุงูุชุฌุฒุฆุฉ ูุงูุชุดููุฑ ูู: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Windows</a> ุ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">iOS</a> ุ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">OS-X</a> . </p><br><p style=";text-align:right;direction:rtl">  ูู ุฃุฌุฏ ูุนูููุงุช ุญูู ุจุฑูุงูุฌ vpn ุงููุฏูุฌ ูู ูุธุงู ุฃูุฏุฑููุฏ ุ ููููู ุจุดูู ุนุงู ูุนูู ูุน ููุชุฑุญุงุช ูู windows.  ูุง ููุฌุฏ ุฃู ุฏุนู IKEv2 ูู Android ุ ูุฌุจ ุนููู ุงุณุชุฎุฏุงู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">StrongSwan</a> . </p><br><h3 id="primery-konfiguracii" style=";text-align:right;direction:rtl">  ุฃูุซูุฉ ุงูุชูููู </h3><br><p style=";text-align:right;direction:rtl">  ูุฎุทุท ูุงูุชูููู ุงูุฃุณุงุณู ููุญุตูู ุนูู ุฃูุซูุฉ ูุน ุฃููุงู ุงููููุน ุฅูู ุงููููุน: </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/bn/a7/xu/bna7xud0pazv4ipia2k0083wqom.png"></p><br><pre style=";text-align:right;direction:rtl"><code class="plaintext hljs">#Mikrotik1 /ip address add address=10.10.10.10/24 interface=ether1 network=10.10.10.0 add address=192.168.100.1/24 interface=ether2 network=192.168.100.0 /ip firewall nat add action=masquerade chain=srcnat out-interface=ether1 /ip route add distance=1 gateway=10.10.10.1 dst-address=0.0.0.0/0 #Mikrotik2 /ip address add address=10.20.20.20/24 interface=ether1 network=10.20.20.0 add address=192.168.200.1/24 interface=ether2 network=192.168.200.0 /ip firewall nat add action=masquerade chain=srcnat out-interface=ether1 /ip route add distance=1 gateway=10.20.20.1 dst-address=0.0.0.0/0</code> </pre> <br><h4 id="ipsec-v-tunnelnom-rezhime" style=";text-align:right;direction:rtl">  IPSec ูู ูุถุน ุงูููู </h4><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/wy/cg/ad/wycgadjksxuyftckhoctoxciub4.png"></p><br><p style=";text-align:right;direction:rtl">  ุงูุชูููู ุฎุทูุฉ ุจุฎุทูุฉ: </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุฅูุดุงุก ุงูุชุฑุงุญุงุช ูู IKE Phase1 </li><li style=";text-align:right;direction:rtl">  ุงุตูุน ููููุฉ  ูุดูุฑ ุฅูู ุงูุนููุงู ูุงูููุชุฑุญุงุช ููุถุน ุงูุชุจุงุฏู ูููุชุงุญ PSK.  ุงุฎุชุฑุช IKEv2 ุ ููููู ุงุณุชุฎุฏุงู ุงูุฑุฆูุณู / ุงูุนุฏูุงูู ุนูู ุงููุญู ุงููุฑุบูุจ ููู </li><li style=";text-align:right;direction:rtl">  ุฅูุดุงุก ููุชุฑุญุงุช ูู SA </li><li style=";text-align:right;direction:rtl">  ุญุฏุฏ ุงูุดุจูุงุช ุงููุฑุนูุฉ ุงูุชู ูููู ุจุฅูุดุงุก ุงูููู ุจูููุง </li><li style=";text-align:right;direction:rtl">  ุญุฏุฏ ุนูุงููู SA ููุถุน ุงูููู ูููุชุฑุญุงุช ูุชุดููุฑ ุญุฑูุฉ ุงููุฑูุฑ </li><li style=";text-align:right;direction:rtl">  ุชุญุฑูุฑ ูุงุนุฏุฉ NAT </li></ol><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">Mikrotik1</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl"> <a href=""><img src="https://habrastorage.org/webt/c2/tg/at/c2tgatfqb3bgw5qer0u6lvi_jt0.png"></a> </p><br><p style=";text-align:right;direction:rtl">  ุฎูุงุฑ ูุญุฏุฉ ุงูุชุญูู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">#1 /ip ipsec peer profile add dh-group=modp2048 enc-algorithm=aes-128 hash-algorithm=sha256 name=ipsec-tunnel-ike nat-traversal=no #2 /ip ipsec peer add address=10.20.20.20/32 exchange-mode=ike2 profile=ipsec-tunnel-ike secret=test-ipsec #3 /ip ipsec proposal add auth-algorithms=sha256 enc-algorithms=aes-256-cbc name=ipsec-tunnel-sa #4-5 /ip ipsec policy add dst-address=192.168.200.0/24 proposal=ipsec-tunnel-sa sa-dst-address=10.20.20.20 sa-src-address=10.10.10.10 src-address=192.168.100.0/24 tunnel=yes #6 /ip firewall nat set 0 ipsec-policy=out,none</code> </pre> </div></div><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">Mikrotik2</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl"> <a href=""><img src="https://habrastorage.org/webt/je/5y/gq/je5ygqbnhfjklyqxu8pg1kf2saq.png"></a> </p><br><p style=";text-align:right;direction:rtl">  ุฎูุงุฑ ูุญุฏุฉ ุงูุชุญูู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">#1 /ip ipsec peer profile add dh-group=modp2048 enc-algorithm=aes-128 hash-algorithm=sha256 name=ipsec-tunnel-ike nat-traversal=no #2 /ip ipsec peer add address=10.10.10.10/32 exchange-mode=ike2 profile=ipsec-tunnel-ike secret=test-ipsec #3 /ip ipsec proposal add auth-algorithms=sha256 enc-algorithms=aes-256-cbc name=tets-ipsec-sa #4-5 /ip ipsec policy add dst-address=192.168.100.0/24 proposal=tets-ipsec-sa sa-dst-address=10.10.10.10 sa-src-address=10.20.20.20 src-address=192.168.200.0/24 tunnel=yes #6 /ip firewall nat set 0 ipsec-policy=out,none</code> </pre> </div></div><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ูููุง NATุ</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  ููุนูู ูู ูุถุน ุงูููู ุ ูุฃูุช ุจุญุงุฌุฉ ุฅูู ุทุฑูู ูุฒูู ุฅูู ุงูุดุจูุฉ ุงููุฑุนูุฉ ุงูุจุนูุฏุฉ ุ ุฃู ุฅูู ูุณุงุฑ ุงูุชุฑุงุถู ุ ูุฅูุง ููู ุชุฐูุจ ุงูุญุฒู ุฃุจุนุฏ ูู ูุฑุงุฑ ุงูุชูุฌูู.  ูุน ุงูุฎูุงุฑ ุงูุฃูู ุ ูุง ุชูุฌุฏ ุนุงุฏุฉ ูุดุงูู ุ ูููู ูุน ุงููุณุงุฑ ุงูุงูุชุฑุงุถู ููุตุฏุฑ NAT (ุงูุฃูู ูุงูุซุงูู ููุฌูุฏุงู ุนูู ุงูุบุงูุจูุฉ ุงูุนุธูู ูู ุฃุฌูุฒุฉ ุงูุชูุฌูู ุงูููุฒููุฉ ูุงูููุชุจูุฉ) ุณุชููู ููุงู ูุดููุงุช. </p><br><p style=";text-align:right;direction:rtl">  ุฃุฐูุฑ ุชุฏูู ุงูุญุฒูุฉ.  ุชูุฑ ุงูุญุฒู ุนุจุฑ Source Source ูู ููุช ุณุงุจู ุนู ุณูุงุณุงุช IPSec ุ ููุง ุชุนุฑู ุงููุงุนุฏุฉ ุฐุงุช ุงูููุฒูุฉ ุฃู ุดูุก ูุฑูู ุฅูู ุฅุฑุณุงู ุญุฑูุฉ ุงููุฑูุฑ ุฅูู ุงูููู "ุงููุคูุช" ูุณูู ุชุจุซ ุฑุคูุณ ุงูุญุฒู ููุชู ุฅุฑุณุงููุง ุฅูู IPSec ุนูุฏูุง ูุชู ุงูุชุญูู ูู ุงูุญุฒูุฉ ุฐุงุช ุงูุฑุฃุณ ุงูุฐู ุชู ุชุบููุฑู ูู ุนููุงู ูุตุฏุฑ ุงูุณูุงุณุงุช ูู ูู ูุชูุงุกู ุงูุฑุฃุณ ูุน ุงููุงุนุฏุฉ ูุณุชูุชูู ุงูุญุฒูุฉ ุฅูู ุงููุณุงุฑ ุงูุงูุชุฑุงุถู ุ ูุงูุฐู ูู ุงููุญุชูู ุฃู ูุณูุทูุง ุจุนุฏ ุฑุคูุฉ ุนููุงู ุงููุฌูุฉ ูู ุงูุดุจูุฉ ุงูุฎุงุตุฉ. </p><br><p style=";text-align:right;direction:rtl">  ููุงู ุงูุนุฏูุฏ ูู ุงูุญููู ูููุดููุฉ: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุจุงุณุชุฎุฏุงู ุทุฑูู ููููุฉ </li><li style=";text-align:right;direction:rtl">  ุจุงุณุชุฎุฏุงู ูุงุนุฏุฉ ูุจูู ุงุฎุชูุงุฑูุฉ ูุจู SourceNAT </li><li style=";text-align:right;direction:rtl">  ุชุฎุถุน src-nat ููุท ูุชูู ุงูุญุฒู ุงูุชู ูุง ุชูุฌุฏ ุจูุง ุณูุงุณุงุช IPSec (ูู ุงููุซุงู) </li><li style=";text-align:right;direction:rtl">  ุงุณุชุจุนุฏ ุญุฑูุฉ ุงููุฑูุฑ ูู ุชุชุจุน ุงูุงุชุตุงู ุจุงุณุชุฎุฏุงู RAW </li></ul></div></div><br><p style=";text-align:right;direction:rtl">  <strong>ุชุญูู ูู ุงุชุตุงู ุงูููุดุฃุฉ</strong> <br><img src="https://habrastorage.org/webt/no/xd/cn/noxdcnqrsbftj6mfsxlmpruizmq.png" alt="ุงูุตูุฑุฉ"></p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูุฑู ุฌุงุฑุฉ ูู ุฃูุฑุงููู ุนู ุจุนุฏ </li><li style=";text-align:right;direction:rtl">  ูุฑู SA ุงููุซุจุชุฉ (ูู ุชุชุบูุฑ ุนุฏุงุฏุงุช ุงููุฑูุฑ ุญุชู ุชุจุฏุฃ) </li><li style=";text-align:right;direction:rtl">  ูู ุงูุณูุงุณุฉ ุ ูุถุน ุงูุฑุงูุฉ ูุงูุนูู (ุฃ) ctive </li></ol><br><h4 id="ipipipsec" style=";text-align:right;direction:rtl">  IPIP / IPSec </h4><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/2b/hy/1d/2bhy1d1tnwd57iyppymvb8dbkww.png"></p><br><p style=";text-align:right;direction:rtl">  ูุณุจูุง IPIP ุงูููู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">#Mikrotik1 #  ipip /interface ipip add allow-fast-path=no clamp-tcp-mss=no name=ipip-vpn remote-address=10.20.20.20 # ip   ipip  /ip address add address=10.30.30.1/30 interface=ipip-vpn #     /ip route add distance=1 dst-address=192.168.200.0/24 gateway=10.30.30.2 #Mikrotik2 # ,      /interface ipip add allow-fast-path=no clamp-tcp-mss=no name=ipip-vpn remote-address=10.10.10.10 /ip address add address=10.30.30.2/30 interface=ipip-vpn /ip route add distance=1 dst-address=192.168.100.0/24 gateway=10.30.30.1</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุชูููู ุฎุทูุฉ ุจุฎุทูุฉ IPSec: </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุฅูุดุงุก ุงูุชุฑุงุญุงุช ูู IKE Phase1 </li><li style=";text-align:right;direction:rtl">  ุงุตูุน ููููุฉ  ุญุฏุฏ ุงูุนููุงู ูุงูููุชุฑุญุงุช ููุถุน ุงูุชุจุงุฏู ูููุชุงุญ PSK </li><li style=";text-align:right;direction:rtl">  ุฅูุดุงุก ููุชุฑุญุงุช ูู SA </li><li style=";text-align:right;direction:rtl">  ุญุฏุฏ ุงูุดุจูุงุช ุงููุฑุนูุฉ ุงูุชู ูููู ุจุฅูุดุงุก ุงูููู ุจูููุง </li><li style=";text-align:right;direction:rtl">  ูุญุฏุฏ ุนูุงููู SA ุ ูููุน ุญุฑูุฉ ุงููุฑูุฑ ุงูุชู ุณูููู ุจุชุดููุฑูุง ูุงูููุชุฑุญุงุช </li></ol><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">Mikrotik1</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl"> <a href=""><img src="https://habrastorage.org/webt/5e/mf/_w/5emf_wcxb3ulnjv3fykuino9stg.png"></a> </p><br><p style=";text-align:right;direction:rtl">  ุฎูุงุฑ ูุญุฏุฉ ุงูุชุญูู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">#1 /ip ipsec peer profile add dh-group=modp2048 enc-algorithm=aes-128 hash-algorithm=sha256 name=ipsec-tunnel-ike nat-traversal=no #2 /ip ipsec peer add address=10.20.20.20/32 exchange-mode=ike2 profile=ipsec-tunnel-ike secret=test-ipsec #3 /ip ipsec proposal add auth-algorithms=sha256 enc-algorithms=aes-256-cbc name=ipsec-tunnel-sa #4-5 /ip ipsec policy add dst-address=10.20.20.20/32 proposal=ipsec-tunnel-sa protocol=ipencap src-address=10.10.10.10/32 sa-dst-address=10.20.20.20 sa-src-address=10.10.10.10</code> </pre> </div></div><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">Mikrotik2</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl"> <a href=""><img src="https://habrastorage.org/webt/9o/dk/oy/9odkoy8krqem4mck9rkfibhm220.png"></a> </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">#1 /ip ipsec peer profile add dh-group=modp2048 enc-algorithm=aes-128 hash-algorithm=sha256 name=ipsec-tunnel-ike nat-traversal=no #2 /ip ipsec peer add address=10.10.10.10/32 exchange-mode=ike2 profile=ipsec-tunnel-ike secret=test-ipsec #3 /ip ipsec proposal add auth-algorithms=sha256 enc-algorithms=aes-256-cbc name=tets-ipsec-sa #4-5 /ip ipsec policy add dst-address=10.10.10.10/32 proposal=tets-ipsec-sa protocol=ipencap src-address=10.20.20.20/32 sa-dst-address=10.10.10.10 sa-src-address=10.20.20.20</code> </pre> </div></div><br><p style=";text-align:right;direction:rtl">  ุจุงููุณุจุฉ ุฅูู ุนุฏู ุงูุงูุชุจุงู ุ ุงููุฑู ุงูุญูููู ูู ุชูููู ุงูููู ููุถุน ุงูููู ูู ูููุฌ IPSec: <br><img src="https://habrastorage.org/webt/5v/ka/fg/5vkafg3ca8vilvv0s-lv1tdbxhw.png" alt="ุงูุตูุฑุฉ"></p><br><p style=";text-align:right;direction:rtl">  ูุญุต ุงูุงุชุตุงู ูุดุงุจู ููุถุน ุงูููู. </p><br><h4 id="l2tpipsec" style=";text-align:right;direction:rtl">  L2TP / IPSec </h4><br><p style=";text-align:right;direction:rtl">  ุชุนุฏ ุงูุฃูุซูุฉ ุงูุณุงุจูุฉ ููุงุณุจุฉ ุชูุงููุง ูุฅูุดุงุก ุดุจูุงุช VPN ุฏุงุฆูุฉ ุจูู ุฒููููู ุ ูุน ุนูุงููู IP ุฎุงุฑุฌูุฉ ุซุงุจุชุฉ. </p><br><p style=";text-align:right;direction:rtl">  ุฅุฐุง ูุงู ุนููุงู ุฃุญุฏ ุงูุฃูุฑุงู ุฏููุงูููููุง (ูุนุงุฏุฉู ูุง ููุน ุฎูู NAT) ุ ููุฌุจ ุนููู ุงุณุชุฎุฏุงู VPN Client-to-Server ุขุฎุฑ. <br><img src="https://habrastorage.org/webt/ms/l5/3a/msl53ahdcdv8fl2vd-62m1exdmk.png" alt="ุงูุตูุฑุฉ"></p><br><p style=";text-align:right;direction:rtl">  L2TP ุงูุชูููู ุงููุณุจู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">#     /ip pool add name=pool-l2tp ranges=192.168.77.10-192.168.77.20 #    /ppp profile add change-tcp-mss=yes local-address=192.168.77.1 name=l2tp-ipsec only-one=yes remote-address=pool-l2tp use-compression=no use-encryption=no use-mpls=no use-upnp=no #   /ppp secret add name=user1 password=test1 profile=l2tp-ipsec service=l2tp add name=user2 password=test2 profile=l2tp-ipsec service=l2tp add name=user3 password=test3 profile=l2tp-ipsec service=l2tp #  L2TP (  ipsec) /interface l2tp-server server set authentication=chap,mschap2 default-profile=l2tp-ipsec enabled=yes</code> </pre> <br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ููุงุฐุง ุฃุชุฌุงูู ุงูุถุจุท ุงูุชููุงุฆู ูู IPsec</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  ูู ุชูููู ipip ุ gre ุ eoip ุ l2tp ุ ููุฌุฏ ุชูููู ุชููุงุฆู ูุงุชุตุงู ipsec ุ ูู ุงููุงูุน ุ ูููู ุงููุธุงู ุจุฅูุดุงุก ููุงุนุฏ ุฏููุงููููุฉ ูููุธุฑุงุก ูุงูุณูุงุณุงุช ูู ุฃุฌูู ุ ููู ุฃููุงู ูุง ูุจุญุซ ุนู ุทุฑู ุณููุฉ ุ ูุซุงููุงู ุ ุนูุฏ ุงูุชุฑููุฉ ูู 6.42 ุฅูู 6.43 ุ ูุชู ุฅูุดุงุก ุงูุฃููุงู ุชููุงุฆููุง ูุณุฑ ูููุณ ุญูููุฉ ุฃู ูุฐุง ูู ูุญุฏุซ ูุฑุฉ ุฃุฎุฑู. </p></div></div><br><p style=";text-align:right;direction:rtl">  ุชูููู ุฎุทูุฉ ุจุฎุทูุฉ IPSec: </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุฅูุดุงุก ูุฌููุนุฉ ุฌุฏูุฏุฉ (ููููู ุงุณุชุฎุฏุงู ุงูุงูุชุฑุงุถู) </li><li style=";text-align:right;direction:rtl">  ุฅูุดุงุก ุงูุชุฑุงุญุงุช ูู IKE Phase1 </li><li style=";text-align:right;direction:rtl">  ูุฎูู ููููุฉ ุ ุฃู ุจุงูุฃุญุฑู ุดุจูุฉ ูุฑุนูุฉ.  ููุณู ุนูู ููุชุงุญ PSK ุ ูููู ุฅุฐุง ููุง ูุชุนุงูู ูุน windows ูุนููู ุ ููุฏููุง ุฎูุงุฑ: ุงูุดูุงุฏุงุช ุฃู PSK. </li><li style=";text-align:right;direction:rtl">  ุงุถุจุท ุงููุงูู = ูุนู ู send-init-contact = ูุง ุ ูู ุณูุงุณุฉ ุงูุชูููุฏ = ูููุฐ ุตุงุฑู (ูุจูู ูููุฐ ูู ุงูุนููู) </li><li style=";text-align:right;direction:rtl">  ุฅูุดุงุก ููุชุฑุญุงุช ูู SA </li><li style=";text-align:right;direction:rtl">  ุฅูุดุงุก ูุงูุจ ูุฅูุดุงุก ุงูุณูุงุณุงุช </li><li style=";text-align:right;direction:rtl">  ุชุญุฏูุฏ ุงูุชุฑุงุญ SA </li></ol><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุชูููู Mikrotik</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl"> <a href=""><img src="https://habrastorage.org/webt/ua/a8/ph/uaa8phm-3iy-qvrxuc6m4kbirr8.png" alt="ุงูุตูุฑุฉ"></a> <br>  <em>ูู ููุทุฉ ุงูุดุงุดุฉ ุ ุงูุฎุทุฃ ูู ุชุญุฏูุฏ ุงูุชูููุช ุงูุตููู.</em>  <em>ุงููููุงุก ู src.</em>  <em>ููุณุช ููุงู ุญุงุฌุฉ ุงููููุงุก</em> </p><br><p style=";text-align:right;direction:rtl">  ุฎูุงุฑ ูุญุฏุฉ ุงูุชุญูู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">#1 /ip ipsec policy group add name=l2tp-ipsec #2 /ip ipsec peer profile add dh-group=modp1024 enc-algorithm=aes-256 hash-algorithm=sha256 name=l2tp-ipsec-ike #3-4 /ip ipsec peer add address=0.0.0.0/0 generate-policy=port-strict passive=yes policy-template-group=l2tp-ipsec profile=l2tp-ipsec-ike secret=secret-ipsec-pass send-initial-contact=no #5 /ip ipsec proposal add auth-algorithms=sha256,sha1 enc-algorithms=aes-256-cbc,aes-128-cbc name=l2tp-ipsec-sa pfs-group=none #6-7 /ip ipsec policy add dst-address=0.0.0.0/0 group=l2tp-ipsec proposal=l2tp-ipsec-sa protocol=udp src-address=0.0.0.0/0 template=yes</code> </pre> </div></div><br><p style=";text-align:right;direction:rtl">  <strong>ุชูููู ุฌุฏุงุฑ ุงูุญูุงูุฉ ูุฅูุดุงุก ุงุชุตุงูุงุช L2TP ููุท ุจุนุฏ IPSec</strong> </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">/ip firewall filter # IKE, NAT-T  ipsec-esp add chain=input protocol=17 dst-port=500,4500 action=accept add chain=input protocol=50 action=accept # L2TP,     ipsec    add chain=input protocol=17 dst-port=1701 ipsec-policy=in,ipsec action=accept add chain=input protocol=17 dst-port=1701 action-drop</code> </pre> <br><h4 id="ikev2-vpn" style=";text-align:right;direction:rtl">  VPN IKEv2 </h4><br><p style=";text-align:right;direction:rtl">  ูุนุฏ ุฎูุงุฑ L2TP ุดุงุฆุนูุง ุ ูููู ุจูุถู ุชููุฆุฉ ุงููุถุน ุ ููููู ุชูููู ุฎุงุฏู VPN ุจุงุณุชุฎุฏุงู IPSec ููุท.  ูุฐุง ููุน ูุงุนุฏ ูู VPN ุ ูููู ูุงุฏุฑุงู ูุง ูุณุชุฎุฏู ุ ูุฐูู ุจุงูุฅุถุงูุฉ ุฅูู ุชููุฆุฉ ุฌุงูุจ ุงูุฎุงุฏู ุ ุณุฃูุฏู ูุซุงูุงู ุนูู ุฅุนุฏุงุฏ ุนููู strongSwan ุนูู ูุธุงู Android. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/el/un/fu/elunfukm2k6qajijslvcfd-zvuy.png" alt="ุงูุตูุฑุฉ"></p><br><p style=";text-align:right;direction:rtl">  ุจุงูุทุจุน ุ ููุณ ูู ุดูุก ูุฑุฏูุฉ ููุบุงูุฉ.  ุชูุงูู ูุนุธู ุฃูุธูุฉ ุงูุชุดุบูู "ุงููุณุชุฎุฏู" (ุฎุงุตุฉ Windows ู Android) ุนูู ุงูุนูู ูุน VPN ูุซู ููุท ุฅุฐุง ูุงูุช ูุตุงุฏูุฉ ุจูุงุณุทุฉ ุดูุงุฏุงุช ุฃู EAP. </p><br><p style=";text-align:right;direction:rtl">  <em>ุงูุดูุงุฏุงุช ูู ููุทุฉ ุถุนูู ุ ุฅุฐุง ูุงู ุฃู ุดุฎุต ูุนุฑู ููููุฉ ุฅูุดุงุก ุดูุงุฏุฉ ูููุนุฉ ุฐุงุชููุง ุจุดูู ุตุญูุญ ูุงูุชู ูุณุชูุฑุฏูุง Windows ูุณูุณุชุฎุฏููุง ูู ุงูุงุชุตุงู ุ ูุงูุชุจ ูู ุงูุชุนูููุงุช.</em> </p><br><p style=";text-align:right;direction:rtl">  ุงูุฌูู ุงูุฃููู ูู ุงูุดูุงุฏุงุช: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">#Root CA   /certificate add name=ca common-name="IKEv2 CA" days-valid=6928 /certificate sign ca ca-crl-host=&lt;IP &gt; #   vpn /certificate add common-name=&lt;IP &gt; subject-alt-name=IP:&lt;IP &gt; key-usage=tls-server name=vpn days-valid=6928 #   /certificate sign vpn ca=ca #   #       ,       #     Revoke   /certificate add common-name=client key-usage=tls-client name=client days-valid=6928 #   /certificate sign client ca=ca</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุชูููู ุฎุทูุฉ ุจุฎุทูุฉ ูู IKEv2 VPN: </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูููู ุจุฅูุดุงุก ูุฌููุนุฉ ูู ุงูุนูุงููู ูุชูุฒูุนูุง ุนูู ุงูุนููุงุก </li><li style=";text-align:right;direction:rtl">  ุฅูุดุงุก ููู ุชุนุฑูู ุชูููู ุงููุถุน ูุชูุฒูุน ูุนููุงุช IP ููุนููุงุก </li><li style=";text-align:right;direction:rtl">  ูู ุจุฅูุดุงุก ูุฌููุนุงุช ูุฑุจุท ููุงูุจ ุงููุธุฑุงุก ูุงูุณูุงุณุงุช </li><li style=";text-align:right;direction:rtl">  ุฅูุดุงุก ุงูุชุฑุงุญุงุช ูู IKE Phase1 </li><li style=";text-align:right;direction:rtl">  ุฅูุดุงุก ููู ุชุนุฑูู ูุฑุจุท ุฃูุฑุงููู.  ูุตุงุฏูุฉ ุงูุดูุงุฏุฉ ุ ุจุฑูุชูููู IKEv2 ุ ุงููุถุน ุงูุณูุจู </li><li style=";text-align:right;direction:rtl">  ุญุฏุฏ ููู ุชุนุฑูู ุชููุฆุฉ ุงููุถุน ุ ูุฌููุนุฉ ูู 3 ุฎุทูุงุช ูุชูููู ุฅูุดุงุก ุงูุณูุงุณุฉ </li><li style=";text-align:right;direction:rtl">  ุฅูุดุงุก ููุชุฑุญุงุช ูู SA </li><li style=";text-align:right;direction:rtl">  ุฅูุดุงุก ูุงูุจ ูุฅูุดุงุก ุงูุณูุงุณุงุช </li><li style=";text-align:right;direction:rtl">  ุญุฏุฏ ุงูููุชุฑุญุงุช ูู SA </li></ol><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุชูููู Mikrotik</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl"> <a href=""><img src="https://habrastorage.org/webt/1r/8w/vj/1r8wvjsgjjwhijje2dhwb90qv78.png" alt="ุงูุตูุฑุฉ"></a> </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">#1 /ip pool add name=pool-ike ranges=192.168.77.10-192.168.77.20 #2 /ip ipsec mode-config add address-pool=pool-ike address-prefix-length=32 name=ikev2-vpn static-dns=77.88.8.8 system-dns=no #3 /ip ipsec policy group add name=ikev2-vpn #4 /ip ipsec peer profile add enc-algorithm=aes-256,aes-128 hash-algorithm=sha256 name=ikev2-vpn #5-6 /ip ipsec peer add address=0.0.0.0/0 auth-method=rsa-signature certificate=vpn exchange-mode=ike2 generate-policy=port-strict mode-config=ikev2-vpn passive=yes policy-template-group=ikev2-vpn profile=ikev2-vpn send-initial-contact=no #7 /ip ipsec proposal add auth-algorithms=sha256,sha1 enc-algorithms=aes-256-cbc,aes-128-cbc name=ikev2-vpn #8-9 /ip ipsec policy add dst-address=0.0.0.0/0 group=ikev2-vpn proposal=ikev2-vpn src-address= 0.0.0.0/0 template=yes</code> </pre> </div></div><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุงูุชูููู StrongSwan ุนูู ุงูุฑูุจูุช.</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  <em>ุชุญุชุงุฌ ุฃููุงู ุฅูู ููู ุดูุงุฏุงุช ุงูุนููู ููุงููููุฑููุง ุฅูู ุงููุงุชู.</em> <br>  <a href="">https://habrastorage.org/webt/tp/pk/ad/tppkadaifd1k7xi6hf3jxgg7vcs.png</a> </p><br><p style=";text-align:right;direction:rtl">  <em>ููุนููู ุงููุจูุฑุฉ: ุตููุจ ูุฑุจ ูุงู ูุงู ููู ู</em>  <em>ูุชู ุญุธุฑ ูุนุธู ุชุทุจููุงุช ุงููุธุงู ุจูุงุณุทุฉ AFWall +.</em> </p></div></div><br><p style=";text-align:right;direction:rtl">  ุฅุฐุง ูุงู ุงูุงุชุตุงู ูุงุฌุญูุง ุ ูุณุชุฑู: ุงูุณูุงุณุฉ ุงูุฏููุงููููุฉ ูุงููุชุงุจุฉ ุฅูู ุฃูุฑุงููู ุนู ุจูุนุฏ ูุฒูุฌ ูู SAs. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/89/ov/4w/89ov4wsqvw7r-dvsoz2crontmlk.png" alt="ุงูุตูุฑุฉ"></p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/cc/b2/ic/ccb2icr_nqz32btmghwptrz7svc.png" alt="ุงูุตูุฑุฉ"></p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/sl/cn/gz/slcngz0e3objej8x3fw4-m3wypc.png" alt="ุงูุตูุฑุฉ"></p><br><p style=";text-align:right;direction:rtl">  <em>ููุณ ูุฏู ุชุฑุงุฎูุต RouterOS x86 ุงูุชุฌุฑูุจูุฉ ูููุฏ ุนูู ุนุฏุฏ ุฃููุงู IPSec ุ ุจูุง ูู ุฐูู IKEv2 VPN.</em>  <em>ููููู ูุดุฑ ุงูุนุฑุถ ุงูุชูุถูุญู RouterOS x86 (ูุง ุชุฎูุท ุจูู RouterOS CHR ูุฌุงููุง ุ ูู ุดูุก ูุญุฒู) ุนูู VPS ูุงูุญุตูู ุนูู ุฎุงุฏู VPN ุดุฎุตู ุจุฃูู ุฌูุฏ ุฅุฏุงุฑู ุ ุฏูู ุดุฑุงุก ุชุฑุฎูุต ูู RouterOS ุฃู RouterOS CHR.</em> </p><br><h3 id="para-slov-pro-analiz-logov-ipsec" style=";text-align:right;direction:rtl">  ุจุถุน ูููุงุช ุญูู ุชุญููู ุณุฌู IPSec </h3><br><p style=";text-align:right;direction:rtl">  ุงูุณุฌูุงุช ูู Mikrotik ูู ูุตุฉ ูููุตูุฉ ุ ูุฃุญูุงููุง ุชููู ููุตูุฉ ุจูุง ูููู ูุชุญููู ุงููุดููุงุช ุ ูููู ุงูุงูุชูุงุฑ ุฅูู ููุฒุงุช ุนุงุฏูุฉ: ูุธููุฉ ุ ููุณุฎ ุ ูุงูุนุซูุฑ ุนูู ุงูููุฉ ูุชุซุจูุช ุฎุงุฏู ุณุฌู ูููุตู. </p><br><p style=";text-align:right;direction:rtl">  ุจุงููุณุจุฉ ุฅูู IPSec ุ ุฅููู ุฎูุงุฑ ุชุญููู ุงูุณุฌู ุงูุณุฑูุน (ูุชุฑู ููุท ูุง ูู ุถุฑูุฑู ูู ุนูุงูุฉ ุชุจููุจ ูููุตูุฉ): </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/05/rz/_g/05rz_grffjd7zz1r-a8zhsi87cy.png" alt="ุงูุตูุฑุฉ"></p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">/system logging action add memory-lines=100000 name=ipsec target=memory /system logging add action=ipsec topics=ipsec,error add action=ipsec topics=ipsec,debug,!packet add action=ipsec topics=ipsec,info</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุจุนุถ ุงูุฃูุซูุฉ ุนูู ูุดุงูู ุชูููู IPSec ุงููููุฐุฌูุฉ: </p><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ูุดููุฉ ุชูุงุณู ุงูููุชุฑุญุงุช ูู ุงููุฑุญูุฉ ุงูุฃููู</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/bp/jm/y1/bpjmy12i4eieobnfhrnj3hlvpcq.png" alt="ุงูุตูุฑุฉ"></p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุงูุฑุฃ ุฑุณุงูุฉ ุงูุฎุทุฃ.  ุงููุดููุฉ ูู ุนูุฏ ุงูุชูููู ุจูู ุงูููุชุฑุญุงุช ูู ุงููุฑุญูุฉ ุงูุฃููู. </li><li style=";text-align:right;direction:rtl">  ููุธุฑ ุฃุนูุงู ุ ุฌูุงุฒ ุงูุชูุฌูู ููุณู ูุดูุฑ ุฅูู ุฃูู ุฃุฑุณู ููููุฉ ุ ููุง ุชู ุชููููู ูุญููุง </li></ol></div></div><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ูุดููุฉ ุชุณููุฉ ุงููุดููุฉ IKE_SA_INIT</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  ูู ุงูุณุฌูุงุช ุ ุณุชุฑู ุดูุฆูุง ููุง ููู: </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/8i/d9/gh/8id9ghqgdgxsjjsfhn3zcn5_vtq.png"></p><br><p style=";text-align:right;direction:rtl">  ุชุญููู ุญุฑูุฉ ุงููุฑูุฑ </p><br><p style=";text-align:right;direction:rtl">  ูู ุงูุทูุจ ุ ููููู ุฑุคูุฉ ููุชุฑุญุงุช ูู ุงููุฃุฏุจุฉ: </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/pw/u2/ib/pwu2ibw3dyxswemrr74wcbphcoy.png"></p><br><p style=";text-align:right;direction:rtl">  ูู ุงูุฅุฌุงุจุฉ ูุฑู ุฃูู ูู ูุชู ุงูุนุซูุฑ ุนูู ููุชุฑุญุงุช ููุงุณุจุฉ: </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/q2/lb/qk/q2lbqkcr8qvtd1hgia4fj0hrb44.png"></p></div></div><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ูุณุฃูุฉ ุชุณููุฉ ุงูููุชุฑุญุงุช ูู SA</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/2y/yg/7m/2yyg7ma7ko4lce5vsyef4nmojdi.png"><br>  ูุทุงูุจ ุฌูุงุฒ ุงูุชูุฌูู ุจูุฌูุฏ ุฎุทุฃ ูู ุงูููุชุฑุญุงุช ูู ุงููุฑุญูุฉ 2 ููุธูุฑ ูุง ุชู ุชููููู ูุญูููุง ููุง ูู ุจุนูุฏ. </p></div></div><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุงูููุชุฑุญุงุช IKE_AUTH ูุดููุฉ ุงูุชุณููุฉ</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/bn/pk/vn/bnpkvnfazxyqmpbvdg78e26mfgy.png"><br>  ูุฑู ุฃูู ูุงู ููุงู ุงุชุตุงู ููุตุงุฏูุฉ ูู ุงูุฃูุฑุงู ุ ูููู ุฎุทุฃ ุฅุถุงูู ุงูููุชุฑุญุงุช.  ูู ุชุฑู ุฃู ุชูุงุตูู ูู ุชุตุญูุญ ุงูุฃุฎุทุงุก ุ ุฃู ูู wireshark ุฅูุง (ูุชู ุชุดููุฑ ุญุฑูุฉ ูุฑูุฑ IKE_AUTH). </p></div></div><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุฎุทุฃ ูุตุงุฏูุฉ PSK</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  ู IKE: </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/cp/wm/b5/cpwmb55qp8qyjmba_xijboxmiwa.png"></p><br><p style=";text-align:right;direction:rtl">  ู IKEv2: <br><img src="https://habrastorage.org/webt/ks/fn/k0/ksfnk0qdgmgizzusfsyrlwxvcfs.png"></p></div></div><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ูุถุน IKE ุบูุฑ ุตุญูุญ</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/md/fb/ll/mdfbllmvedawn5ptdd-yvjcsrpw.png" alt="ุงูุตูุฑุฉ"><br>  ูุฑู ุฃู ุงููุฑุญูุฉ ุงูุฃููู ุชููุถู ูู ุงููููุฉ ุ ุนูู ุงูุฑุบู ูู ุฃู ุงูุญุฒู ุชูุฑ ุจูู ุงูุฃูุฑุงู.  ูููู ุญุฌู ุงูุญุฒูุฉ ุงููุงุฑุฏุฉ ุฃูุจุฑ ุจูุซูุฑ ุ ุฅุฐุง ุญูููุง ูู ุฎูุงู wireshark ุ ูุณูุฑู ุฃู ุงููุธูุฑ ุงูุจุนูุฏ ูุณุชุฎุฏู ุงููุถุน ุงูุนุฏูุงูู. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/3g/ke/ii/3gkeiidaj8m-fs0ky7ucxqjxx6k.png"><br>  ูุฑู ุฃู ุงูุญุฒู ูุชู ุฅุฑุณุงููุง ููุง ุฅูู UDP: 500 ุ ูุฃููุง ุชุฃุชู ุฅูู UDP: 4500 ููู ูุจูุฑุฉ ุฅูู ุญุฏ ูุง.  ููุง ูุญุชูู ุงููุธูุฑ ุงูุจุนูุฏ ุนูู ูุถุน IKEv2. </p></div></div><br><p style=";text-align:right;direction:rtl">  ุฃุฎูุฑูุง ุ ุงูุฑุฃ ูุณู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุชุญุฑูู ุงูุฎูู ูุฅุตูุงุญู ูู ุงููููู</a> .  ูุฌููุน ุงูููุงุฏ ุงููุชุนููุฉ ุจู IPSec ูุฑุบูุจุฉ ููุชุนุงุฑู ุ ููุฏ ูุตูุช ุงููุฌููุนุฉ ุงูุฃุณุงุณูุฉ ููุท ูู ุงูุฃุฏูุงุช ูุงูุฅุนุฏุงุฏุงุช. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar438176/">https://habr.com/ru/post/ar438176/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar438166/index.html">ุงูุชูุงุนู ุจูู ูููุน ูู ูุชุตูุญ ูุจุฑูุงูุฌ ูุนูู ูุญููุง</a></li>
<li><a href="../ar438168/index.html">ููู ุชุตุฏุน ูุงููุฑุง ุบุงููุฉ ุงูุซูู ุญุชู ูุง ุชูุชู ุฒูุฌุชู</a></li>
<li><a href="../ar438170/index.html">ุฌุงุฆุฒุฉ ุณููุช ุงูููุง ุณูุฌุงููููุชุด. ูุตุฉ ุนู ุนููู ุงูุญุงุณูุจ ูุฅุทูุงู ุงูููุดูุฑุงุช</a></li>
<li><a href="../ar438172/index.html">Apple ุบูุฑ ูุงุฏุฑุฉ ุนูู ููู ุฅูุชุงุฌ ุฃุฌูุฒุชูุง ุฅูู ุงูููุงูุงุช ุงููุชุญุฏุฉ ุงูุฃูุฑูููุฉ</a></li>
<li><a href="../ar438174/index.html">ุงูุฃุตูุฑ - ูุฑุงุบ - ุณุญุงุจุฉ</a></li>
<li><a href="../ar438178/index.html">ุฅูุดุงุก ุฃูู ุชุทุจูู ARCore ุงูุฎุงุต ุจู</a></li>
<li><a href="../ar438180/index.html">ุชุณุฌูู ูุนุงููุฉ ุนูุงุฑูุฉ ุนุจุฑ ุงูุฅูุชุฑูุช</a></li>
<li><a href="../ar438182/index.html">ูุฌุฏุช ุงูุฏุฑุงุณุฉ ููุงุฆุฏ ุงููุฑุตูุฉ ุงููุนุชุฏูุฉ ูููุชุฌู ูููุฒุนู ุงููุญุชูู</a></li>
<li><a href="../ar438186/index.html">ูุงุฆูุฉ ุงูุชุญูู: ูุง ุงูุฐู ูุฌุจ ุงูููุงู ุจู ูุจู ูุดุฑ ุงูุฎุฏูุงุช ุงููุตุบุฑุฉ ููุฅูุชุงุฌ</a></li>
<li><a href="../ar438188/index.html">ุจูู ุจููุฒ ูููุงุนู ุงูุตูุฏููู ุงูุณุฑูุน</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>